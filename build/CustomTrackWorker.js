(function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i})({1:[function(e,t,n){t.exports=function(t){function s(e,t){if(!e)return;var r=e.type&&i(e.type.toLowerCase()).split(/\s+/)||["bed"];e.type=this._type=r[0];var s=this.type();if(s===null)throw new Error("Unsupported track type '"+e.type+"' encountered on line "+e.lineNum);this.opts=n.extend({},this.constructor.defaults,s.defaults||{},e),this.opts.priority=parseInt10(this.opts.priority),n.extend(this,{browserOpts:t,typeArgs:r.slice(1),stretchHeight:!1,heights:{min:15},sizes:["dense"],mapSizes:[],areas:{},scales:{},noAreaLabels:!1,expectsSequence:!1,isSearchable:!1,finishSetupCalled:!1,onSyncProps:null}),this.init()}var n=e("../underscore.min.js"),r=e("./track-types/utils/utils.js"),i=r.strip;return parseInt10=r.parseInt10,s.defaults={name:"User Track",description:"",color:"0,0,0",priority:1},s.types={bed:e("./track-types/bed.js"),featuretable:e("./track-types/featuretable.js"),bedgraph:e("./track-types/bedgraph.js"),wiggle_0:e("./track-types/wiggle_0.js"),vcftabix:e("./track-types/vcftabix.js"),bedgz:e("./track-types/bedgz.js"),bigbed:e("./track-types/bigbed.js"),bam:e("./track-types/bam.js"),bigwig:e("./track-types/bigwig.js"),biggenepred:e("./track-types/biggenepred.js")},s.types.beddetail=n.clone(s.types.bed),s.types.beddetail.defaults=n.extend({},s.types.beddetail.defaults,{detail:!0}),n.each(["init","parse","render","renderSequence","prerender","search"],function(e){s.prototype[e]=function(){var t=n.toArray(arguments),r=this.type();return r[e]?r[e].apply(this,t):!1}}),s.prototype.finishSetup=function(){var e=n.toArray(arguments),t=this.type();return!t.finishSetup||this.finishSetupCalled?!1:(this.finishSetupCalled=!0,t.finishSetup.apply(this,e))},s.prototype.loadOpts=function(e,t){var n=this.type(),r=this.opts,i=r.description||(t?"Genome Annotation ":"User Supplied")+" Track";e.find(".custom-opts-form").hide(),e.find(".custom-opts-form."+this._type).show(),e.find(".custom-name").text(r.name),e.find(".custom-desc").text(i),e.find(".custom-format").text(this._type),e.find("[name=color]").val(r.color).change(),n.loadOpts&&n.loadOpts.call(this,e),e.find(".enabler").change()},s.prototype.saveOpts=function(e){var n=this.type(),r=this.opts;r.color=e.find("[name=color]").val(),this.validateColor(r.color)||(r.color="0,0,0"),n.saveOpts&&n.saveOpts.call(this,e),this.applyOpts(),t.CustomTracks.worker()&&this.applyOptsAsync()},s.prototype.applyOpts=function(e){var t=this.type();e&&(this.opts=e),t.applyOpts&&t.applyOpts.call(this)},s.prototype.syncProps=function(e,r){var i=this;if(r===!0)return!n.isObject(e)||n.isArray(e)?!1:(n.extend(i,e),n.isFunction(i.onSyncProps)&&t.HTMLDocument&&i.onSyncProps(e),i);n.isArray(e)&&(e=n.object(e,n.map(e,function(e){return i[e]})));if(t.HTMLDocument){if(!t.CustomTracks.worker())return i.syncProps(e,!0)}else t.CustomTrackWorker&&t.CustomTrackWorker.syncPropsAsync(i,e)},s.prototype.erase=function(e){var t=this,n=e.getContext&&e.getContext("2d");n&&n.clearRect(0,0,e.width,e.height)},s.prototype.type=function(e){return n.isUndefined(e)&&(e=this._type),this.constructor.types[e]||null},s.prototype.warn=function(e){if(this.opts.strict)throw new Error(e);this.warnings||(this.warnings=[]),this.warnings.push(e)},s.prototype.isOn=function(e){return/^(on|yes|true|t|y|1)$/i.test(n.isUndefined(e)?"":e.toString())},s.prototype.chrList=function(){if(!this._chrList){var e=n.map(this.browserOpts.chrPos,function(e,t){return[e,t]});this._chrList=n.sortBy(e,function(e){return e[0]})}return this._chrList},s.prototype.chrAt=function(e){var t=this.chrList(),r=n.sortedIndex(t,[e],function(e){return e[0]}),i=r>0?t[r-1][1]:null;return{i:r-1,c:i,p:e-this.browserOpts.chrPos[i]}},s.prototype.chrRange=function(e,t,r){if(e>=t-1)throw"Invalid interval provided to chrRange (expecting 1-based, right-OPEN)";var i=this.browserOpts.chrLengths,s=this.chrAt(e),o=this.chrAt(t-1),u=r?1:0,a;return s.c&&s.i===o.i?[s.c+":"+(s.p-u)+"-"+o.p]:(a=n.map(this.chrList().slice(s.i+1,o.i),function(e){return e[1]+":"+(1-u)+"-"+i[e[1]]}),s.c&&a.unshift(s.c+":"+(s.p-u)+"-"+i[s.c]),o.c&&a.push(o.c+":"+(1-u)+"-"+o.p),a)},s.prototype.prerenderAsync=function(){t.CustomTracks.async(this,"prerender",arguments,[this.id])},s.prototype.applyOptsAsync=function(){t.CustomTracks.async(this,"applyOpts",[this.opts,function(){}],[this.id])},s.prototype.finishSetupAsync=function(){t.CustomTracks.async(this,"finishSetup",arguments,[this.id])},s.prototype.searchAsync=function(){t.CustomTracks.async(this,"search",arguments,[this.id])},s.prototype.ajaxDir=function(){return(t.HTMLDocument?"":"../")+this.browserOpts.ajaxDir},s.prototype.rgbToHsl=function(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n),s,o,u=(r+i)/2;if(r==i)s=o=0;else{var a=r-i;o=u>.5?a/(2-r-i):a/(r+i);switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4}s/=6}return[s,o,u]},s.prototype.hslToRgb=function(e,t,n){var r,i,s;if(t==0)r=i=s=n;else{function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var u=n<.5?n*(1+t):n+t-n*t,a=2*n-u;r=o(a,u,e+1/3),i=o(a,u,e),s=o(a,u,e-1/3)}return[r*255,i*255,s*255]},s.prototype.validateColor=function(e){var t=e.match(/(\d+),(\d+),(\d+)/);return t?(t.shift(),n.all(n.map(t,parseInt10),function(e){return e>=0&&e<=255})):!1},s}},{"../underscore.min.js":22,"./track-types/bam.js":5,"./track-types/bed.js":6,"./track-types/bedgraph.js":7,"./track-types/bedgz.js":8,"./track-types/bigbed.js":9,"./track-types/biggenepred.js":10,"./track-types/bigwig.js":11,"./track-types/featuretable.js":12,"./track-types/utils/utils.js":19,"./track-types/vcftabix.js":20,"./track-types/wiggle_0.js":21}],2:[function(e,t,n){var r=self;e("./jquery.nodom.min.js")(r),r._=e("../underscore.min.js"),e("./CustomTracks.js")(r);if(!r.console||!r.console.log)r.console=r.console||{},r.console.log=function(){r.postMessage({log:JSON.stringify(_.toArray(arguments))})};var i={_tracks:[],_throwErrors:!1,parse:function(){var e=this,t=CustomTracks.parse.apply(CustomTracks,arguments);return _.map(t,function(t){t.id=e._tracks.push(t)-1;var n=_.extend({},t);return delete n.data,n})},syncPropsAsync:function(e,t){r.postMessage({id:e.id,syncProps:t})},throwErrors:function(e){this._throwErrors=e}};_.each(["prerender","applyOpts","finishSetup","search"],function(e){i[e]=function(){var t=_.toArray(arguments),n=_.first(t),r=this._tracks[n];r[e].apply(r,_.rest(t))}}),r.CustomTrackWorker=i,r.addEventListener("message",function(e){var t=e.data,n=function(e){r.postMessage({id:t.id,ret:JSON.stringify(e||null)})},s;if(i._throwErrors)s=i[t.op].apply(i,t.args.concat(n));else try{s=i[t.op].apply(i,t.args.concat(n))}catch(o){r.postMessage({id:t.id,error:JSON.stringify(o)})}_.isUndefined(s)||n(s)})},{"../underscore.min.js":22,"./CustomTracks.js":3,"./jquery.nodom.min.js":4}],3:[function(e,t,n){t.exports=function(t){function o(e,t,n,r){this.name="TrackParseError",this.message=e,this.context=t.context,this.lineno=n,this.line=r.slice(0,200)}var n=e("../underscore.min.js"),r=e("./track-types/utils/utils.js"),i=r.parseDeclarationLine,s=e("./CustomTrack.js")(t);o.prototype=new Error;var u={_tracks:{},parse:function(e,t,r){function h(){f.parse(a)&&u.push(f)}var u=[],a=[],f,l,c;return typeof e=="string"&&(e=[e]),u.browser={},n.each(e,function(e){n.each(e.split("\n"),function(e,p){if(!/^#/.test(e))if(/^browser\s+/.test(e)){c=e.match(/^browser\s+(\w+)\s+(\S*)/);if(!c)throw new o("Could not parse browser line",t,p+1,e);u.browser[c[1]]=c[2]}else if(/^track\s+/i.test(e)){f&&h(),l=i(e,/^track\s+/i);if(!l)throw new o("Could not parse track line",t,p+1,e);r&&n.isObject(r)&&(l=n.extend({},r,l)),l.lineNum=p+1,f=new s(l,t),a=[]}else if(/\S/.test(e)){if(!f)throw new o('Plaintext track formats require a track definition line. For an example, see <a href="http://useast.ensembl.org/info/website/upload/bed.html#tracklines">this page from Ensembl.</a>',t,p+1,e);a.push(e)}})}),f&&h(),u},parseDeclarationLine:i,error:function(e){console.log(e)},_workerScript:"build/CustomTrackWorker.js",_disableWorkers:!1,worker:function(){var e=this,n=[];return!e._worker&&t.Worker&&(e._worker=new t.Worker(e._workerScript),e._worker.addEventListener("error",function(t){e.error(t)},!1),e._worker.addEventListener("message",function(t){if(t.data.log){console.log(JSON.parse(t.data.log));return}if(t.data.error){t.data.id&&delete n[t.data.id],e.error(JSON.parse(t.data.error));return}if(t.data.syncProps){e._tracks[t.data.id].syncProps(t.data.syncProps,!0);return}n[t.data.id](JSON.parse(t.data.ret)),delete n[t.data.id]}),e._worker.call=function(e,t,r){var i=n.push(r)-1;this.postMessage({op:e,id:i,args:t})},e._worker.throwErrors=function(e){this.postMessage({op:"throwErrors",args:[e]})}),e._disableWorkers?null:e._worker},async:function(e,t,r,i,s){r=n.toArray(r),s=s||n.identity;var o=n.initial(r),u=n.last(r),a=this.worker();if(!a)return u(e[t].apply(e,o));Array.prototype.unshift.apply(o,i),a.call(t,o,function(e){u(s(e))})},parseAsync:function(){var e=this;e.async(e,"parse",arguments,[],function(t){return n.map(t,function(t){return e._tracks[t.id]=n.extend(new s,t,{prerender:function(){s.prototype.prerenderAsync.apply(this,arguments)}}),e._tracks[t.id]})})},guessFormat:function(e){if(n.isUndefined(Uint8Array)||n.isUndefined(Uint32Array))return{};var t=new Uint8Array(e),r=new Uint32Array(e),i={binary:n.some(t,function(e){return e<32&&e!=9&&e!=10&&e!=13||e>127})};return i.format=n.findKey(s.types,function(e,t){return!!e.magicBytes&&n.contains(e.magicBytes,r[0])}),i}};t.CustomTracks=u}},{"../underscore.min.js":22,"./CustomTrack.js":1,"./track-types/utils/utils.js":19}],4:[function(e,t,n){t.exports=function(e){e.window=e.window||e,e.window.document=e.window.document||{},function(e,t){function n(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function r(){try{return new e.XMLHttpRequest}catch(t){}}function i(e,n){e.dataFilter&&(n=e.dataFilter(n,e.dataType));var r=e.dataTypes,i={},s,o,u=r.length,a,f=r[0],l,c,h,d,v;for(s=1;s<u;s++){if(s===1)for(o in e.converters)typeof o=="string"&&(i[o.toLowerCase()]=e.converters[o]);l=f,f=r[s];if(f==="*")f=l;else if(l!=="*"&&l!==f){c=l+" "+f,h=i[c]||i["* "+f];if(!h){v=t;for(d in i){a=d.split(" ");if(a[0]===l||a[0]==="*"){v=i[a[1]+" "+f];if(v){d=i[d],d===!0?h=v:v===!0&&(h=d);break}}}}!h&&!v&&p.error("No conversion from "+c.replace(" "," to ")),h!==!0&&(n=h?h(n):v(d(n)))}}return n}function s(e,n,r){var i=e.contents,s=e.dataTypes,o=e.responseFields,u,a,f,l;for(a in o)a in r&&(n[o[a]]=r[a]);while(s[0]==="*")s.shift(),u===t&&(u=e.mimeType||n.getResponseHeader("content-type"));if(u)for(a in i)if(i[a]&&i[a].test(u)){s.unshift(a);break}if(s[0]in r)f=s[0];else{for(a in r){if(!s[0]||e.converters[a+" "+s[0]]){f=a;break}l||(l=a)}f=f||l}if(f)return f!==s[0]&&s.unshift(f),r[f]}function o(e,t,n,r){if(p.isArray(t))p.each(t,function(t,i){n||g.test(e)?r(e,i):o(e+"["+(typeof i=="object"||p.isArray(i)?t:"")+"]",i,n,r)});else if(!n&&t!=null&&typeof t=="object")for(var i in t)o(e+"["+i+"]",t[i],n,r);else r(e,t)}function u(e,n){var r,i,s=p.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);i&&p.extend(!0,e,i)}function a(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u=e[s],f=0,l=u?u.length:0,c=e===_,h;for(;f<l&&(c||!h);f++)h=u[f](n,r,i),typeof h=="string"&&(!c||o[h]?h=t:(n.dataTypes.unshift(h),h=a(e,n,r,i,h,o)));return(c||!h)&&!o["*"]&&(h=a(e,n,r,i,"*",o)),h}function f(e){return function(t,n){typeof t!="string"&&(n=t,t="*");if(p.isFunction(n)){var r=t.toLowerCase().split(L),i=0,s=r.length,o,u,a;for(;i<s;i++)o=r[i],a=/^\+/.test(o),a&&(o=o.substr(1)||"*"),u=e[o]=e[o]||[],u[a?"unshift":"push"](n)}}}var l=e.document,c=e.navigator,h=e.location,p=function(){function n(){if(r.isReady)return;try{l.documentElement.doScroll("left")}catch(e){setTimeout(n,1);return}r.ready()}var r=function(e,t){return new r.fn.init(e,t,o)},i=e.jQuery,s=e.$,o,u=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,a=/\S/,f=/^\s+/,h=/\s+$/,p=/\d/,d=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,v=/^[\],:{}\s]*$/,m=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,g=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,y=/(?:^|:|,)(?:\s*\[)+/g,b=/(webkit)[ \/]([\w.]+)/,w=/(opera)(?:.*version)?[ \/]([\w.]+)/,E=/(msie) ([\w.]+)/,S=/(mozilla)(?:.*? rv:([\w.]+))?/,x=/-([a-z])/ig,T=function(e,t){return t.toUpperCase()},N=c.userAgent,C,k,L,A=Object.prototype.toString,O=Object.prototype.hasOwnProperty,M=Array.prototype.push,_=Array.prototype.slice,D=String.prototype.trim,P=Array.prototype.indexOf,H={};return r.fn=r.prototype={constructor:r,init:function(e,n,i){var s,o,a,f;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(e==="body"&&!n&&l.body)return this.context=l,this[0]=l.body,this.selector=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?s=[null,e,null]:s=u.exec(e);if(s&&(s[1]||!n)){if(s[1])return n=n instanceof r?n[0]:n,f=n?n.ownerDocument||n:l,a=d.exec(e),a?r.isPlainObject(n)?(e=[l.createElement(a[1])],r.fn.attr.call(e,n,!0)):e=[f.createElement(a[1])]:(a=r.buildFragment([s[1]],[f]),e=(a.cacheable?r.clone(a.fragment):a.fragment).childNodes),r.merge(this,e);o=l.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return i.find(e);this.length=1,this[0]=o}return this.context=l,this.selector=e,this}return!n||n.jquery?(n||i).find(e):this.constructor(n).find(e)}return r.isFunction(e)?i.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),r.makeArray(e,this))},selector:"",jquery:"1.6.3pre",length:0,size:function(){return this.length},toArray:function(){return _.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var i=this.constructor();return r.isArray(e)?M.apply(i,e):r.merge(i,e),i.prevObject=this,i.context=this.context,t==="find"?i.selector=this.selector+(this.selector?" ":"")+n:t&&(i.selector=this.selector+"."+t+"("+n+")"),i},each:function(e,t){return r.each(this,e,t)},ready:function(e){return r.bindReady(),k.done(e),this},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(_.apply(this,arguments),"slice",_.call(arguments).join(","))},map:function(e){return this.pushStack(r.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:M,sort:[].sort,splice:[].splice},r.fn.init.prototype=r.fn,r.extend=r.fn.extend=function(){var e,n,i,s,o,u,a=arguments[0]||{},f=1,l=arguments.length,c=!1;typeof a=="boolean"&&(c=a,a=arguments[1]||{},f=2),typeof a!="object"&&!r.isFunction(a)&&(a={}),l===f&&(a=this,--f);for(;f<l;f++)if((e=arguments[f])!=null)for(n in e){i=a[n],s=e[n];if(a===s)continue;c&&s&&(r.isPlainObject(s)||(o=r.isArray(s)))?(o?(o=!1,u=i&&r.isArray(i)?i:[]):u=i&&r.isPlainObject(i)?i:{},a[n]=r.extend(c,u,s)):s!==t&&(a[n]=s)}return a},r.extend({noConflict:function(t){return e.$===r&&(e.$=s),t&&e.jQuery===r&&(e.jQuery=i),r},isReady:!1,readyWait:1,holdReady:function(e){e?r.readyWait++:r.ready(!0)},ready:function(e){if(e===!0&&!--r.readyWait||e!==!0&&!r.isReady){if(!l.body)return setTimeout(r.ready,1);r.isReady=!0;if(e!==!0&&--r.readyWait>0)return;k.resolveWith(l,[r]),r.fn.trigger&&r(l).trigger("ready").unbind("ready")}},bindReady:function(){if(k)return;k=r._Deferred();if(l.readyState==="complete")return setTimeout(r.ready,1);if(l.addEventListener)l.addEventListener("DOMContentLoaded",L,!1),e.addEventListener("load",r.ready,!1);else if(l.attachEvent){l.attachEvent("onreadystatechange",L),e.attachEvent("onload",r.ready);var t=!1;try{t=e.frameElement==null}catch(i){}l.documentElement.doScroll&&t&&n()}},isFunction:function(e){return r.type(e)==="function"},isArray:Array.isArray||function(e){return r.type(e)==="array"},isWindow:function(e){return e&&typeof e=="object"&&"setInterval"in e},isNaN:function(e){return e==null||!p.test(e)||isNaN(e)},type:function(e){return e==null?String(e):H[A.call(e)]||"object"},isPlainObject:function(e){if(!e||r.type(e)!=="object"||e.nodeType||r.isWindow(e))return!1;if(e.constructor&&!O.call(e,"constructor")&&!O.call(e.constructor.prototype,"isPrototypeOf"))return!1;var n;for(n in e);return n===t||O.call(e,n)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw e},parseJSON:function(t){if(typeof t!="string"||!t)return null;t=r.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(v.test(t.replace(m,"@").replace(g,"]").replace(y,"")))return(new Function("return "+t))();r.error("Invalid JSON: "+t)},parseXML:function(n){var i,s;try{e.DOMParser?(s=new DOMParser,i=s.parseFromString(n,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(n))}catch(o){i=t}return(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)&&r.error("Invalid XML: "+n),i},noop:function(){},globalEval:function(t){t&&a.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(x,T)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,i){var s,o=0,u=e.length,a=u===t||r.isFunction(e);if(i){if(a){for(s in e)if(n.apply(e[s],i)===!1)break}else for(;o<u;)if(n.apply(e[o++],i)===!1)break}else if(a){for(s in e)if(n.call(e[s],s,e[s])===!1)break}else for(;o<u;)if(n.call(e[o],o,e[o++])===!1)break;return e},trim:D?function(e){return e==null?"":D.call(e)}:function(e){return e==null?"":e.toString().replace(f,"").replace(h,"")},makeArray:function(e,t){var n=t||[];if(e!=null){var i=r.type(e);e.length==null||i==="string"||i==="function"||i==="regexp"||r.isWindow(e)?M.call(n,e):r.merge(n,e)}return n},inArray:function(e,t){if(P)return P.call(t,e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1},merge:function(e,n){var r=e.length,i=0;if(typeof n.length=="number")for(var s=n.length;i<s;i++)e[r++]=n[i];else while(n[i]!==t)e[r++]=n[i++];return e.length=r,e},grep:function(e,t,n){var r=[],i;n=!!n;for(var s=0,o=e.length;s<o;s++)i=!!t(e[s],s),n!==i&&r.push(e[s]);return r},map:function(e,n,i){var s,o,u=[],a=0,f=e.length,l=e instanceof r||f!==t&&typeof f=="number"&&(f>0&&e[0]&&e[f-1]||f===0||r.isArray(e));if(l)for(;a<f;a++)s=n(e[a],a,i),s!=null&&(u[u.length]=s);else for(o in e)s=n(e[o],o,i),s!=null&&(u[u.length]=s);return u.concat.apply([],u)},guid:1,proxy:function(e,n){if(typeof n=="string"){var i=e[n];n=e,e=i}if(!r.isFunction(e))return t;var s=_.call(arguments,2),o=function(){return e.apply(n,s.concat(_.call(arguments)))};return o.guid=e.guid=e.guid||o.guid||r.guid++,o},access:function(e,n,i,s,o,u){var a=e.length;if(typeof n=="object"){for(var f in n)r.access(e,f,n[f],s,o,i);return e}if(i!==t){s=!u&&s&&r.isFunction(i);for(var l=0;l<a;l++)o(e[l],n,s?i.call(e[l],l,o(e[l],n)):i,u);return e}return a?o(e[0],n):t},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=b.exec(e)||w.exec(e)||E.exec(e)||e.indexOf("compatible")<0&&S.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,n){return new e.fn.init(t,n)}r.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function n(i,n){return n&&n instanceof r&&!(n instanceof e)&&(n=e(n)),r.fn.init.call(this,i,n,t)},e.fn.init.prototype=e.fn;var t=e(l);return e},browser:{}}),r.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){H["[object "+t+"]"]=t.toLowerCase()}),C=r.uaMatch(N),C.browser&&(r.browser[C.browser]=!0,r.browser.version=C.version),r.browser.webkit&&(r.browser.safari=!0),a.test(" ")&&(f=/^[\s\xA0]+/,h=/[\s\xA0]+$/),o=r(l),l.addEventListener?L=function(){l.removeEventListener("DOMContentLoaded",L,!1),r.ready()}:l.attachEvent&&(L=function(){l.readyState==="complete"&&(l.detachEvent("onreadystatechange",L),r.ready())}),r}(),d="done fail isResolved isRejected promise then always pipe".split(" "),v=[].slice;p.extend({_Deferred:function(){var e=[],t,n,r,i={done:function(){if(!r){var n=arguments,s,o,u,a,f;t&&(f=t,t=0);for(s=0,o=n.length;s<o;s++)u=n[s],a=p.type(u),a==="array"?i.done.apply(i,u):a==="function"&&e.push(u);f&&i.resolveWith(f[0],f[1])}return this},resolveWith:function(i,s){if(!r&&!t&&!n){s=s||[],n=1;try{while(e[0])e.shift().apply(i,s)}finally{t=[i,s],n=0}}return this},resolve:function(){return i.resolveWith(this,arguments),this},isResolved:function(){return!!n||!!t},cancel:function(){return r=1,e=[],this}};return i},Deferred:function(e){var t=p._Deferred(),n=p._Deferred(),r;return p.extend(t,{then:function(e,n){return t.done(e).fail(n),this},always:function(){return t.done.apply(t,arguments).fail.apply(this,arguments)},fail:n.done,rejectWith:n.resolveWith,reject:n.resolve,isRejected:n.isResolved,pipe:function(e,n){return p.Deferred(function(r){p.each({done:[e,"resolve"],fail:[n,"reject"]},function(e,n){var i=n[0],s=n[1],o;p.isFunction(i)?t[e](function(){o=i.apply(this,arguments),o&&p.isFunction(o.promise)?o.promise().then(r.resolve,r.reject):r[s+"With"](this===t?r:this,[o])}):t[e](r[s])})}).promise()},promise:function(e){if(e==null){if(r)return r;r=e={}}var n=d.length;while(n--)e[d[n]]=t[d[n]];return e}}),t.done(n.cancel).fail(t.cancel),delete t.cancel,e&&e.call(t,t),t},when:function(e){function t(e){return function(t){n[e]=arguments.length>1?v.call(arguments,0):t,--s||o.resolveWith(o,v.call(n,0))}}var n=arguments,r=0,i=n.length,s=i,o=i<=1&&e&&p.isFunction(e.promise)?e:p.Deferred();if(i>1){for(;r<i;r++)n[r]&&p.isFunction(n[r].promise)?n[r].promise().then(t(r),o.reject):--s;s||o.resolveWith(o,n)}else o!==e&&o.resolveWith(o,i?[e]:[]);return o.promise()}}),p.support=p.support||{};var m=/%20/g,g=/\[\]$/,y=/\r?\n/g,b=/#.*$/,w=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,E=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,S=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,x=/^(?:GET|HEAD)$/,T=/^\/\//,N=/\?/,C=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,k=/^(?:select|textarea)/i,L=/\s+/,A=/([?&])_=[^&]*/,O=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,M=p.fn.load,_={},D={},P,H;try{P=h.href}catch(B){P=l.createElement("a"),P.href="",P=P.href}H=O.exec(P.toLowerCase())||[],p.fn.extend({load:function(e,n,r){if(typeof e!="string"&&M)return M.apply(this,arguments);if(!this.length)return this;var i=e.indexOf(" ");if(i>=0){var s=e.slice(i,e.length);e=e.slice(0,i)}var o="GET";n&&(p.isFunction(n)?(r=n,n=t):typeof n=="object"&&(n=p.param(n,p.ajaxSettings.traditional),o="POST"));var u=this;return p.ajax({url:e,type:o,dataType:"html",data:n,complete:function(e,t,n){n=e.responseText,e.isResolved()&&(e.done(function(e){n=e}),u.html(s?p("<div>").append(n.replace(C,"")).find(s):n)),r&&u.each(r,[n,t,e])}}),this},serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?p.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||k.test(this.nodeName)||E.test(this.type))}).map(function(e,t){var n=p(this).val();return n==null?null:p.isArray(n)?p.map(n,function(e,n){return{name:t.name,value:e.replace(y,"\r\n")}}):{name:t.name,value:n.replace(y,"\r\n")}}).get()}}),p.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){p.fn[t]=function(e){return this.bind(t,e)}}),p.each(["get","post"],function(e,n){p[n]=function(e,r,i,s){return p.isFunction(r)&&(s=s||i,i=r,r=t),p.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),p.extend({getScript:function(e,n){return p.get(e,t,n,"script")},getJSON:function(e,t,n){return p.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?u(e,p.ajaxSettings):(t=e,e=p.ajaxSettings),u(e,t),e},ajaxSettings:{url:P,isLocal:S.test(H[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:f(_),ajaxTransport:f(D),ajax:function(e,n){function r(e,n,r,a){if(k===2)return;k=2,S&&clearTimeout(S),E=t,g=a||"",B.readyState=e>0?4:0;var v,m,y,b=n,w=r?s(o,B,r):t,x,T;if(e>=200&&e<300||e===304){if(o.ifModified){if(x=B.getResponseHeader("Last-Modified"))p.lastModified[d]=x;if(T=B.getResponseHeader("Etag"))p.etag[d]=T}if(e===304)b="notmodified",v=!0;else try{m=i(o,w),b="success",v=!0}catch(N){b="parsererror",y=N}}else{y=b;if(!b||e)b="error",e<0&&(e=0)}B.status=e,B.statusText=""+(n||b),v?l.resolveWith(u,[m,b,B]):l.rejectWith(u,[B,b,y]),B.statusCode(h),h=t,M&&f.trigger("ajax"+(v?"Success":"Error"),[B,o,v?m:y]),c.resolveWith(u,[B,b]),M&&(f.trigger("ajaxComplete",[B,o]),--p.active||p.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var o=p.ajaxSetup({},n),u=o.context||o,f=u!==o&&(u.nodeType||u instanceof p)?p(u):p.event,l=p.Deferred(),c=p._Deferred(),h=o.statusCode||{},d,v={},m={},g,y,E,S,C,k=0,M,P,B={readyState:0,setRequestHeader:function(e,t){if(!k){var n=e.toLowerCase();e=m[n]=m[n]||e,v[e]=t}return this},getAllResponseHeaders:function(){return k===2?g:null},getResponseHeader:function(e){var n;if(k===2){if(!y){y={};while(n=w.exec(g))y[n[1].toLowerCase()]=n[2]}n=y[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return k||(o.mimeType=e),this},abort:function(e){return e=e||"abort",E&&E.abort(e),r(0,e),this}};l.promise(B),B.success=B.done,B.error=B.fail,B.complete=c.done,B.statusCode=function(e){if(e){var t;if(k<2)for(t in e)h[t]=[h[t],e[t]];else t=e[B.status],B.then(t,t)}return this},o.url=((e||o.url)+"").replace(b,"").replace(T,H[1]+"//"),o.dataTypes=p.trim(o.dataType||"*").toLowerCase().split(L),o.crossDomain==null&&(C=O.exec(o.url.toLowerCase()),o.crossDomain=!(!C||C[1]==H[1]&&C[2]==H[2]&&(C[3]||(C[1]==="http:"?80:443))==(H[3]||(H[1]==="http:"?80:443)))),o.data&&o.processData&&typeof o.data!="string"&&(o.data=p.param(o.data,o.traditional)),a(_,o,n,B);if(k===2)return!1;M=o.global,o.type=o.type.toUpperCase(),o.hasContent=!x.test(o.type),M&&p.active++===0&&p.event.trigger("ajaxStart");if(!o.hasContent){o.data&&(o.url+=(N.test(o.url)?"&":"?")+o.data,delete o.data),d=o.url;if(o.cache===!1){var j=p.now(),F=o.url.replace(A,"$1_="+j);o.url=F+(F===o.url?(N.test(o.url)?"&":"?")+"_="+j:"")}}(o.data&&o.hasContent&&o.contentType!==!1||n.contentType)&&B.setRequestHeader("Content-Type",o.contentType),o.ifModified&&(d=d||o.url,p.lastModified[d]&&B.setRequestHeader("If-Modified-Since",p.lastModified[d]),p.etag[d]&&B.setRequestHeader("If-None-Match",p.etag[d])),B.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+(o.dataTypes[0]!=="*"?", */*; q=0.01":""):o.accepts["*"]);for(P in o.headers)B.setRequestHeader(P,o.headers[P]);if(!o.beforeSend||o.beforeSend.call(u,B,o)!==!1&&k!==2){for(P in{success:1,error:1,complete:1})B[P](o[P]);E=a(D,o,n,B);if(!E)r(-1,"No Transport");else{B.readyState=1,M&&f.trigger("ajaxSend",[B,o]),o.async&&o.timeout>0&&(S=setTimeout(function(){B.abort("timeout")},o.timeout));try{k=1,E.send(v,r)}catch(I){k<2?r(-1,I):p.error(I)}}return B}return B.abort(),!1},param:function(e,n){var r=[],i=function(e,t){t=p.isFunction(t)?t():t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=p.ajaxSettings.traditional);if(p.isArray(e)||e.jquery&&!p.isPlainObject(e))p.each(e,function(){i(this.name,this.value)});else for(var s in e)o(s,e[s],n,i);return r.join("&").replace(m,"+")}}),p.extend({active:0,lastModified:{},etag:{}});var j=e.ActiveXObject?function(){for(var e in I)I[e](0,1)}:!1,F=0,I;p.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&r()||n()}:r,function(e){p.extend(p.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(p.ajaxSettings.xhr()),p.support.ajax&&p.ajaxTransport(function(n){if(!n.crossDomain||p.support.cors){var r;return{send:function(i,s){var o=n.xhr(),u,a;n.username?o.open(n.type,n.url,n.async,n.username,n.password):o.open(n.type,n.url,n.async);if(n.xhrFields)for(a in n.xhrFields)o[a]=n.xhrFields[a];n.mimeType&&o.overrideMimeType&&o.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(a in i)o.setRequestHeader(a,i[a])}catch(f){}o.send(n.hasContent&&n.data||null),r=function(e,i){var a,f,l,c,h;try{if(r&&(i||o.readyState===4)){r=t,u&&(o.onreadystatechange=p.noop,j&&delete I[u]);if(i)o.readyState!==4&&o.abort();else{a=o.status,l=o.getAllResponseHeaders(),c={},h=o.responseXML,h&&h.documentElement&&(c.xml=h),c.text=o.responseText;try{f=o.statusText}catch(d){f=""}!a&&n.isLocal&&!n.crossDomain?a=c.text?200:404:a===1223&&(a=204)}}}catch(v){i||s(-1,v)}c&&s(a,f,c,l)},!n.async||o.readyState===4?r():(u=++F,j&&(I||(I={},p(e).unload(j)),I[u]=r),o.onreadystatechange=r)},abort:function(){r&&r(0,1)}}}}),p.ajaxSettings.global=!1,e.jQuery=e.$=p}(e)}},{}],5:[function(e,t,n){var r=e("./utils/utils.js"),i=r.floorHack,s=r.parseInt10,o=r.deepClone,u=r.guessChrScheme,a=e("./utils/PairedIntervalTree.js").PairedIntervalTree,f=e("./utils/RemoteTrack.js").RemoteTrack,l={defaults:{chromosomes:"",itemRgb:"off",color:"188,188,188",colorByStrand:"",useScore:0,group:"user",priority:"user",offset:0,detail:!1,viewLimits:"",url:"",htmlUrl:"",drawLimit:{squish:2e3,pack:2e3},covHeight:{dense:24,squish:38,pack:38},alleleFreqThreshold:.2,optimalFetchWindow:0,maxFetchWindow:0,convertChrScheme:"auto",viewAsPairs:!1,expectedInsertSizePercentiles:[.005,.995]},magicBytes:[529205252],flags:{isReadPaired:1,isReadProperlyAligned:2,isReadUnmapped:4,isMateUnmapped:8,readStrandReverse:16,mateStrandReverse:32,isReadFirstOfPair:64,isReadLastOfPair:128,isSecondaryAlignment:256,isReadFailingVendorQC:512,isDuplicateRead:1024,isSupplementaryAlignment:2048},init:function(){if(!this.opts.bigDataUrl)throw new Error("Required parameter bigDataUrl not found for BAM track at "+JSON.stringify(this.opts)+(this.opts.lineNum+1));this.type().initOpts.call(this),this.browserChrScheme=u(_.keys(this.browserOpts.chrPos))},initOpts:function(){var e=this.opts;e.viewAsPairs=this.isOn(e.viewAsPairs),_.isArray(e.viewLimits)||(e.viewLimits=_.map(e.viewLimits.split(":"),parseFloat))},applyOpts:function(){var e=this,t=this.opts;t.viewAsPairs!=this.prevOpts.viewAsPairs&&this.data&&this.data.pileup&&(this.data.pileup={}),this.drawRange=t.autoScale||t.viewLimits.length<2?this.coverageRange:t.viewLimits,this.scales=_.mapObject({dense:0,squish:0,pack:0},function(n,r){return[{limits:e.drawRange,specialTicks:[Math.round(e.drawRange[1]/2)],top:0,height:t.covHeight[r]||24}]}),this.syncProps(["opts","drawRange","coverageRange","scales"]),this.prevOpts=o(t)},parse:function(e){var t=this,n=t.opts,r=t.browserOpts.genomeSize/2,s=new a(i(r),{startKey:"start",endKey:"end"},{startKey:"templateStart",endKey:"templateEnd",pairedLengthKey:"tlen",pairingKey:"qname"}),u=t.ajaxDir()+"bam.php?"+$.param({url:t.opts.bigDataUrl}),l;return l=new f(s,function(e,r,i){range=t.chrRange(e,r).join(" ");switch(n.convertChrScheme=="auto"?t.data.info.convertChrScheme:n.convertChrScheme){case"ensembl_ucsc":range=_.map(range,function(e){return e.replace(/^chr/,"")});break;case"ucsc_ensembl":range=_.map(range,function(e){return e.replace(/^(\d\d?|X):/,"chr$1:")})}$.ajax(u,{type:range.length>500?"POST":"GET",data:{range:range},success:function(e){var n=_.filter(e.split("\n"),function(e){var t=e.match(/\t/g);return t&&t.length>=2}),r=_.map(n,function(e){return t.type("bam").parseLine.call(t,e)});i(r)}})}),t.data={cache:s,remote:l,pileup:{},info:{}},t.heights={max:null,min:24,start:24},t.sizes=["dense","squish","pack"],t.mapSizes=["pack"],t.noAreaLabels=!0,t.expectsSequence=!0,t.renderSequenceCallbacks={},t.coverageRange=[0,0],t.prevOpts=o(n),!0},finishSetup:function(){var e=this,t=e.opts,n=e.ajaxDir()+"bam.php",r=e.data.remote,i=e.chrRange(Math.round(e.browserOpts.pos),Math.round(e.browserOpts.pos+1e4)).join(" ");$.ajax(n,{data:{info:1,range:i,url:t.bigDataUrl},success:function(n){var i=0,s=_.max(_.values(t.drawLimit)),o=[],a=n.split("\n\n"),f=[],l=t.expectedInsertSizePercentiles,c=10,h=5e3,p,d,v,m,g;if(a[0]=="")throw new Error("samtools failed to retrieve data for this BAM track.");_.each(a[0].split("\n"),function(e){var t=e.split("	"),n=parseInt(t[2],10);if(t.length==1&&
t[0]=="")return;o.push(t[0]);if(_.isNaN(n))throw new Error("Invalid output for samtools idxstats on this BAM track.");i+=n}),e.data.info.chrScheme=m=u(o),m&&e.browserChrScheme&&(e.data.info.convertChrScheme=m!=e.browserChrScheme?m+"_"+e.browserChrScheme:null),p=_.compact(_.map(a[1].split("\n"),function(t){return e.type("bam").parseLine.call(e,t)})),p.length&&(d=_.reduce(p,function(e,t){return e+(t.end-t.start)},0),d=Math.round(d/p.length),v=_.some(p,function(e){return e.flags.isReadFirstOfPair||e.flags.isReadLastOfPair}),f=_.compact(_.map(p,function(e){return e.tlen?Math.abs(e.tlen):0})),f.sort(function(e,t){return e-t})),e.data.info.meanItemsPerBp=g=i/e.browserOpts.genomeSize,e.data.info.meanItemLength=d=_.isUndefined(d)?100:d;if(!t.optimalFetchWindow||!t.maxFetchWindow)t.optimalFetchWindow=Math.floor(s/g/(Math.max(d,100)/100)*.5),t.maxFetchWindow=t.optimalFetchWindow*2;e.coverageRange[1]||(e.coverageRange[1]=Math.ceil(g*d*2)),e.type("bam").applyOpts.call(e),v?(f.length&&(c=f[Math.floor(f.length*l[0])],h=f[Math.floor(f.length*l[1])]),e.data.cache.setPairingInterval(c,h)):e.data.cache.disablePairing(),r.setupBins(e.browserOpts.genomeSize,t.optimalFetchWindow,t.maxFetchWindow)}})},parseFlags:function(e,t){e.flags={},_.each(this.type("bam").flags,function(t,n){e.flags[n]=!!(e.flag&t)})},parseTags:function(e,t){var n=/^[A-Za-z][A-Za-z0-9]$/,r=/^[A-Za-z]$/;e.tags={},_.each(t,function(t){tagPieces=t.split(":",3);if(tagPieces.length!==3||!n.test(tagPieces[0])||!r.test(tagPieces[1]))return;e.tags[tagPieces[0]]=tagPieces[2]})},parseCigar:function(e,t){var n=e.cigar,r=!e.seq||e.seq=="*"?"":e.seq,i=0,o=0,u,a;e.blocks=[],e.insertions=[],ops=n.split(/\d+/).slice(1),a=n.split(/[A-Z=]/).slice(0,-1);if(ops.length!=a.length){this.warn("Invalid CIGAR '"+n+"' for "+e.desc);return}a=_.map(a,s),_.each(ops,function(t,n){var s=a[n],u,f;/^[MX=]$/.test(t)?(u={start:e.start+i},u.end=u.start+s,u.type=t,u.seq=r.slice(o,o+s),e.blocks.push(u),i+=s,o+=s):/^[ND]$/.test(t)?i+=s:t=="I"?(f={start:e.start+i,end:e.start+i},f.seq=r.slice(o,o+s),e.insertions.push(f),o+=s):t=="S"&&(o+=s)}),e.end=e.start+i},parseLine:function(e,t){var n=this.opts,r=["qname","flag","rname","pos","mapq","cigar","rnext","pnext","tlen","seq","qual"],i={},o=e.split("	"),u=this.type("bam").flags,a,f;_.each(_.first(o,r.length),function(e,t){i[r[t]]=e});switch(n.convertChrScheme=="auto"?this.data.info.convertChrScheme:n.convertChrScheme){case"ucsc_ensembl":i.rname=i.rname.replace(/^chr/,"");break;case"ensembl_ucsc":i.rname=(/^(\d\d?|X)$/.test(i.rname)?"chr":"")+i.rname}return i.name=i.qname,i.flag=s(i.flag),a=this.browserOpts.chrPos[i.rname],t=t||0,_.isUndefined(a)?(this.warn("Invalid RNAME '"+i.rname+"' at line "+(t+1+this.opts.lineNum)),null):i.pos==="0"||!i.cigar||i.cigar=="*"||i.flag&u.isReadUnmapped?null:(i.score=_.isUndefined(i.score)?"?":i.score,i.start=a+s(i.pos),i.desc=i.qname+" at "+i.rname+":"+i.pos,i.tlen=s(i.tlen),this.type("bam").parseFlags.call(this,i,t),this.type("bam").parseTags.call(this,i,o.slice(r.length)),i.strand=i.flags.readStrandReverse?"-":"+",this.type("bam").parseCigar.call(this,i,t),i.id=[i.qname,i.flag,i.rname,i.pos,i.cigar].join("	"),i)},pileup:function(e,t,n){var r=this.data.pileup,i={},s=0,o;for(o=t;o<n;o++)r[o]||(i[o]=!0,s++);if(s===0)return;_.each(e,function(e){var s=[e.data.blocks];e.data.drawAsMates&&e.data.mate&&s.push(e.data.mate.blocks),_.each(s,function(e){_.each(e,function(e){var s,o;for(o=Math.max(e.start,t);o<Math.min(e.end,n);o++){if(!i[o])continue;s=(e.seq[o-e.start]||"").toUpperCase(),r[o]=r[o]||{A:0,C:0,G:0,T:0,N:0,cov:0},r[o][/[ACTG]/.test(s)?s:"N"]+=1,r[o].cov+=1}})})})},coverage:function(e,t,n){var i=e,s=this.data.pileup[i],o=[],u,a,f;for(f=0;f<t;f++){a=s&&i+1>=f*n+e?[s.cov]:[],u=this.data.pileup[i+1];while(i+1<(f+1)*n+e&&i+2>=f*n+e)u&&a.push(u.cov),++i,s=u,u=this.data.pileup[i+1];o.push(r.wigBinFunctions.maximum(a))}return o},alleles:function(e,t,n){var r=this.data.pileup,i=this.opts.alleleFreqThreshold,s=[],o,u,a,f;for(a=0;a<t.length;a++)u=t[a].toUpperCase(),f=r[e+a],f&&f.cov&&f[u]/(f.cov-f.N)<1-i&&(o={x:a/n,splits:[]},_.each(["A","C","G","T"],function(e){f[e]>0&&o.splits.push({nt:e,h:f[e]})}),s.push(o));return s},mismatches:function(e,t,n,r,i,s,o){var u=[],o=this.opts.viewAsPairs;return t=t.toUpperCase(),_.each(r,function(r){var a=[r.data.blocks];o&&r.data.drawAsMates&&r.data.mate&&a.push(r.data.mate.blocks),_.each(a,function(o){_.each(o,function(o){var a=s(r.data),f,l,c;for(l=Math.max(o.start,e);l<Math.min(o.end,e+i*n);l++)c=(l-e)/n,f=(o.seq[l-o.start]||"").toUpperCase(),f&&f!=t[l-e]&&a&&u.push({x:c,nt:f,line:a})})})}),u},prerender:function(e,t,n,i,s){function d(e,t){var r=p+"_"+n+"_"+(l?"p":"u");return _.isUndefined(t)?e.line&&e.line[r]:(e.line||(e.line={}),e.line[r]=t)}var o=this,u=i.width,a=i.sequence,f=o.data,l=o.opts.viewAsPairs,c=l?"templateStart":"start",h=l?"templateEnd":"end",p=(t-e)/u;o.opts.maxFetchWindow&&t-e>o.opts.maxFetchWindow?s({tooMany:!0}):o.data.remote.fetchAsync(e,t,l,function(n){var i={sequence:!!a,width:u},f=new r.pixIntervalCalculator(e,u,p,4,!1,c,h),v=new r.pixIntervalCalculator(e,u,p,4);if(n.tooMany)return s(n);a?(i.bppp=p,i.alleles=o.type("bam").alleles.call(o,e,a,p),i.mismatches=o.type("bam").mismatches.call(o,e,a,p,n,u,d)):(o.type("bam").pileup.call(o,n,e,t),i.layout=o.type("bed").stackedLayout.call(o,n,u,f,d),_.each(i.layout,function(e){_.each(e,function(e){e.insertionPts=_.map(e.d.insertions,v);if(!l)return;e.d.drawAsMates&&e.d.mate?(e.mateInts=_.map([e.d,e.d.mate],v),e.mateBlockInts=_.map(e.d.mate.blocks,v),e.mateInsertionPts=_.map(e.d.mate.insertionPts,v)):e.d.mateExpected&&(e.mateInts=[v(e)],e.mateBlockInts=[],e.mateInsertionPts=[])})}),i.coverage=o.type("bam").coverage.call(o,e,u,p)),s(i)})},tipTipData:function(e){function f(e){return e?"yes":"no"}function l(t,n,r){var i=n.cigar&&n.cigar.length>25?n.cigar.substr(0,24)+"...":n.cigar;r=r||"",_.each({position:n.rname+":"+n.pos,".cigar":n.cigar,cigar:i,"read strand":n.flags.readStrandReverse?"(-)":"(+)",mapped:f(!n.flags.isReadUnmapped),"map quality":n.mapq,secondary:f(n.flags.isSecondaryAlignment),supplementary:f(n.flags.isSupplementaryAlignment),duplicate:f(n.flags.isDuplicateRead),"failed QC":f(n.flags.isReadFailingVendorQC),".read sequence":n.seq,".base quality":n.qual},function(e,n){t[n+r]=e}),_.each(e.tags,function(e,n){t["."+n+r]=e})}var t=this.opts,n={},r=e,i=e.mate,s=["this alignment","mate pair alignment"],o,u,a;return e.mate&&e.mate.flags&&(o=e.start<e.mate.start?e:e.mate,u=e.start<e.mate.start?e.mate:e,a=(o.flags.readStrandReverse?"R":"F")+(o.flags.isReadFirstOfPair?"1":"2"),a+=(u.flags.readStrandReverse?"R":"F")+(u.flags.isReadLastOfPair?"2":"1")),t.viewAsPairs&&e.drawAsMates&&e.mate&&(r=o,i=u,s=["left alignment","right alignment"]),i?(_.isUndefined(e.insertSize)||(n["insert size"]=e.insertSize),_.isUndefined(a)||(n["pair orientation"]=a),n[s[0]]="---",l(n,r),n[s[1]]="---",l(n,i," ")):l(n,e),n},drawCoverage:function(e,t,n){var r=this.drawRange[1];_.each(t,function(t,i){if(t===null)return;var s=t*n/r;e.fillRect(i,Math.max(n-s,0),1,Math.min(s,n))})},drawStrandIndicator:function(e,t,n,r,i,s){var o=e.fillStyle;s?(e.beginPath(),e.moveTo(t-2*i,n),e.lineTo(t+3*i,n+r/2),e.lineTo(t-2*i,n+r),e.closePath(),e.fill()):(e.fillStyle="rgb(140,140,140)",e.beginPath(),e.moveTo(t-2*i,n),e.lineTo(t+1.5*i,n+r/2),e.lineTo(t-2*i,n+r),e.closePath(),e.fill(),e.fillStyle=o)},drawAlignment:function(e,t,n,r,i){var s=this,o=n.mateInts,u=s.opts.color,a=i>6?2:0,f=r*i+a/2,l=i-a,c=2,h=i>6?2:1,p=Math.round(.5*i)-c*.5,d=[{blockInts:n.blockInts,strand:n.d.strand}];o&&(e.fillStyle=e.strokeStyle="rgb("+u+")",e.fillRect(n.pInt.x,r*i+p,n.pInt.w,c)),e.fillStyle=e.strokeStyle="rgb(0,0,0)",_.each(o||[n.pInt],function(t){if(t.w<=0)return;e.fillRect(t.x,r*i+p,t.w-1,c)}),s.opts.altColor&&n.d.strand=="-"&&(u=s.opts.altColor),e.fillStyle=e.strokeStyle="rgb("+u+")",o&&n.d.mate&&d.push({blockInts:n.mateBlockInts,strand:n.d.mate.strand}),_.each(d,function(n){var r=n.strand;_.each(n.blockInts,function(r,o){if(r.x+r.w<0||r.x>t)return;o==0&&n.strand=="-"&&!r.oPrev?(e.fillRect(r.x+2,f,r.w-2,l),s.type("bam").drawStrandIndicator.call(s,e,r.x,f,l,-1,i>6)):o==n.blockInts.length-1&&n.strand=="+"&&!r.oNext?(e.fillRect(r.x,f,r.w-2,l),s.type("bam").drawStrandIndicator.call(s,e,r.x+r.w,f,l,1,i>6)):e.fillRect(r.x,f,r.w,l)})}),e.fillStyle=e.strokeStyle="rgb(114,41,218)",_.each(o?[n.insertionPts,n.mateInsertionPts]:[n.insertionPts],function(n){_.each(n,function(n){if(n.x+n.w<0||n.x>t)return;e.fillRect(n.x-1,r*i,2,i),e.fillRect(n.x-2,r*i,4,h),e.fillRect(n.x-2,(r+1)*i-h,4,h)})})},drawAlleles:function(e,t,n,r){var i={A:"255,0,0",T:"255,0,255",C:"0,0,255",G:"0,180,0"},s=this.drawRange[1],o;_.each(t,function(t){o=n,_.each(t.splits,function(u){var a=u.h*n/s;e.fillStyle="rgb("+i[u.nt]+")",e.fillRect(t.x,o-=a,Math.max(r,1),a)})})},drawMismatch:function(e,t,n,r,i){var s={A:"255,0,0",T:"255,0,255",C:"0,0,255",G:"0,180,0"},o=r>6?2:0,u;e.fillStyle="rgb("+s[t.nt]+")",e.fillRect(t.x,(t.line+n)*r+o/2,Math.max(i,1),r-o),i>7&&r>10&&(e.fillStyle="rgb(255,255,255)",e.fillText(t.nt,t.x+i*.5,(t.line+n+1)*r-o))},drawSpec:function(e,t,n){var r=this,i=e.getContext,s='javascript:void("'+r.opts.name+':$$")',o=r.opts.drawLimit&&r.opts.drawLimit[n],u=n=="pack"?14:4,a=r.opts.covHeight[n]||38,f=7,l=(a+f)/u,c=r.opts.color,h=null;if(!i)throw"Canvas not supported";if(!t.sequence){if(t.tooMany||o&&t.layout.length>o){e.unscaledHeight(0),e.className=e.className+" too-many";return}n=="pack"&&!r.areas[e.id]&&(h=r.areas[e.id]=[]),e.unscaledHeight(a+(n=="dense"?0:f+t.layout.length*u)),i=e.getContext("2d"),i.fillStyle="rgb(159,159,159)",r.type("bam").drawCoverage.call(r,i,t.coverage,a),n!="dense"&&(i.fillStyle="rgb(109,109,109)",i.fillRect(0,a+1,t.width,1),i.fillStyle=i.strokeStyle="rgb("+c+")",_.each(t.layout,function(e,n){n+=l,_.each(e,function(e){r.type("bam").drawAlignment.call(r,i,t.width,e,n,u,t.viewAsPairs),r.type("bed").addArea.call(r,h,e,n,u,s)})}))}else i=e.getContext("2d"),r.type("bam").drawAlleles.call(r,i,t.alleles,a,1/t.bppp),i.font="12px 'Menlo','Bitstream Vera Sans Mono','Consolas','Lucida Console',monospace",i.textAlign="center",i.textBaseline="baseline",_.each(t.mismatches,function(e){r.type("bam").drawMismatch.call(r,i,e,l,u,1/t.bppp)})},render:function(e,t,n,r,i){var s=this;s.prerender(t,n,r,{width:e.unscaledWidth()},function(o){var u=t+"-"+n+"-"+r;s.type("bam").drawSpec.call(s,e,o,r),_.isFunction(s.renderSequenceCallbacks[u])&&(s.renderSequenceCallbacks[u](),delete s.renderSequenceCallbacks[u]),_.isFunction(i)&&i()})},renderSequence:function(e,t,n,r,i,s){function u(){o.prerender(t,n,r,{width:e.unscaledWidth(),sequence:i},function(t){o.type("bam").drawSpec.call(o,e,t,r),_.isFunction(s)&&s()})}var o=this;if(!i)return!1;(" "+e.className+" ").indexOf(" unrendered ")>-1?o.renderSequenceCallbacks[t+"-"+n+"-"+r]=u:u()},loadOpts:function(e){var t=this.opts;e.find("[name=viewAsPairs]").attr("checked",!!t.viewAsPairs),e.find("[name=convertChrScheme]").val(t.convertChrScheme).change()},saveOpts:function(e){var t=this.opts;t.viewAsPairs=e.find("[name=viewAsPairs]").is(":checked"),t.convertChrScheme=e.find("[name=convertChrScheme]").val(),this.type().initOpts.call(this),t.viewAsPairs!=this.prevOpts.viewAsPairs&&(this.areas={},delete e.data("genobrowser").genobrowser("areaIndex")[e.data("track").n])}};t.exports=l},{"./utils/PairedIntervalTree.js":16,"./utils/RemoteTrack.js":17,"./utils/utils.js":19}],6:[function(e,t,n){var r=e("./utils/utils.js"),i=r.floorHack,s=r.parseInt10,o=r.strip,u=r.convertUrlTemplateFormat,a=r.urlForFeature,f=e("./utils/IntervalTree.js").IntervalTree,l=e("./utils/LineMask.js").LineMask,c=e("./utils/GeneticCode.js").GeneticCode,h=["chrom","chromStart","chromEnd","name","score","strand","thickStart","thickEnd","itemRgb","blockCount","blockSizes","blockStarts"],p=["id","description"],d={defaults:{itemRgb:"off",colorByStrand:"",useScore:0,group:"user",priority:"user",offset:0,detail:!1,url:"",htmlUrl:"",searchable:!1,drawLimit:{squish:null,pack:null},bedPlusFields:null,baseColorUseCds:null,drawCodonsUnder:1,translTable:1,minCodonLetterWidth:9,mostIntronsBelow:15e3},init:function(){this.type().initOpts.call(this)},initOpts:function(){var e=this,t=e.opts,n=t.colorByStrand.split(/\s+/),r=n.length>1&&_.all(n,e.validateColor);e.numStandardColumns=h.length,t.useScore=e.isOn(t.useScore),t.itemRgb=e.isOn(t.itemRgb),t.searchable=e.isOn(t.searchable),e.typeArgs.length>0&&/^\d+$/.test(e.typeArgs[0])&&(e.numStandardColumns=s(e.typeArgs[0])),t.bedPlusFields&&!_.isArray(t.bedPlusFields)&&(t.bedPlusFields=t.bedPlusFields.split(",")),/%s/.test(t.url)?t.url=u(t.url):t.url&&!/\$\$/.test(t.url)&&(t.url+="$$"),r?t.altColor=n[1]:(t.colorByStrand="",t.altColor=null),e.expectsSequence=t.drawCodons=t.baseColorUseCds==="given",e.expectedSequencePadding=t.mostIntronsBelow},calcExonFrames:function(e,t){var n=!1,r,i;error=_.find(e.blocks,function(t){t.exonFrame=null;if(i&&t.start<i.end)return!0;!n&&e.thickStart>=t.start&&e.thickStart<t.end?(n=!0,t.exonFrame=0,r=(t.end-e.thickStart)%3):n&&(t.exonFrame=r,e.thickEnd<=t.end?n=!1:r=(r+t.end-t.start)%3),i=t}),error&&(e.blocks=null,this.warn("Blocks either overlap or are out of order at line "+t))},parseLine:function(e,t){var n=h,r=this.numStandardColumns,i=this.opts.bedPlusFields||(r>=4?p:null),o={extra:{}},u=/\t/.test(e)?e.split("	"):e.split(/\s+/),a,f;return this.opts.detail&&(r=Math.min(u.length-2,12),i=p),_.each(u,function(e,t){var s;r&&t<r?o[n[t]]=e:(i&&t-r<i.length&&(s=i[t-r]),_.contains(p,s)?o[s]=e:o.extra[s]=e)}),a=this.browserOpts.chrPos[o.chrom],t=t||0,_.isUndefined(a)?(this.warn("Invalid chromosome '"+o.chrom+"' at line "+(t+1+this.opts.lineNum)),null):(o.score=_.isUndefined(o.score)?"?":o.score,o.start=a+s(o.chromStart)+1,o.end=a+s(o.chromEnd)+1,o.end===o.start&&(o.end+=.1,o.zeroWidth=!0),o.blocks=null,/^\d+$/.test(o.thickStart)&&/^\d+$/.test(o.thickEnd)?(o.thickStart=a+s(o.thickStart)+1,o.thickEnd=a+s(o.thickEnd)+1,o.thickEnd<o.thickStart?(o.thickStart=o.thickEnd=null,this.warn("thickEnd position cannot precede thickStart at line "+(t+1+this.opts.lineNum))):/^\d+(,\d*)*$/.test(o.blockSizes)&&/^\d+(,\d*)*$/.test(o.blockStarts)&&(o.blocks=[],f=o.blockSizes.split(/,/),_.each(o.blockStarts.split(/,/),function(e,t){if(e==="")return;var n={start:o.start+s(e)};n.end=n.start+s(f[t]),o.blocks.push(n)}),this.type("bed").calcExonFrames.call(this,o,t+1+this.opts.lineNum))):o.thickStart=o.thickEnd=null,o)},parse:function(e){var t=this,n=t.browserOpts.genomeSize/2,r=new f(i(n),{startKey:"start",endKey:"end"});return _.each(e,function(e,n){var i=t.type().parseLine.call(t,e,n);i&&r.add(i)}),t.data=r,t.heights={max:null,min:15,start:15},t.sizes=["dense","squish","pack"],t.mapSizes=["pack"],t.isSearchable=t.opts.searchable,t.renderSequenceCallbacks={},!0},stackedLayout:function(e,t,n,r){r=_.isFunction(r)?r:function(){return};var i=[],s=_.max(_.map(e,function(e){return r(e.data)||0}))+1,o=_.sortBy(e,function(e){var t=r(e.data);return _.isUndefined(t)?1:-t});while(s-->0)i.push(new l(t,5));return _.each(o,function(e){var s=e.data,o=r(s),u=n(s),a=s.thickStart!==null&&n({start:s.thickStart,end:s.thickEnd}),f=s.blocks!==null&&_.map(s.blocks,n),c=0,h=i.length;if(!_.isUndefined(o))i[o].conflict(u.tx,u.tw)&&console.log("Unresolvable LineMask conflict!"),i[o].add(u.tx,u.tw,{pInt:u,thickInt:a,blockInts:f,d:s});else{while(c<h&&i[c].conflict(u.tx,u.tw))++c;c==h&&i.push(new l(t,5)),r(s,c),i[c].add(u.tx,u.tw,{pInt:u,thickInt:a,blockInts:f,d:s})}}),_.map(i,function(e){return _.pluck(e.items,"data")})},codons:function(e,t,n,r,i,s,o){function h(e,t){return o.slice(e-i+l,t-i+l)}var u=[],a=(s-i)/t,f=c(this.opts.translTable),l=this.expectedSequencePadding||0;return _.each(e,function(e){var t=e.data,o=r(t),a=t.strand==="-",l=t.thickStart!==null?t.thickStart:t.start,c=t.thickEnd!==null?t.thickEnd:t.end,p=t.blocks!==null?t.blocks:[{start:t.start,end:t.end,exonFrame:0}],d,v,m,g,y,b,w,E,S;_.each(p,function(e){e.partialCodons=e.partialCodons||[null,null]});for(var x=0;x<p.length;x++){d=p[x],v=x>0?p[x-1]:null,m=p[x+1]||null;if(d.exonFrame===null)continue;b=Math.max(d.start,l)-d.exonFrame,w=Math.min(d.end,c),E=Math.min(w-2,s),b<i&&(b=i-(i-b)%3);if(b<d.start){if(v===null||d.start-b>2)throw"Impossible intron pattern encountered!";g=v.partialCodons[1]||h(b-d.start+v.end,v.end),d.partialCodons[0]=h(d.start,b+3),g+=d.partialCodons[0],S=f(g,a),S&&(y=n({start:d.start,end:b+3}),u.push({ln:o,pInt:y,partial:!0,transl:S})),b+=3}for(var T=b;T<E;T+=3){g=h(T,T+3),S=f(g,a);if(!S)continue;y=n({start:T,end:T+3}),u.push({ln:o,pInt:y,partial:!1,transl:S})}if(T>=w-2&&T<w){if(m===null)continue;d.partialCodons[1]=h(T,w),g=m.partialCodons[0]||h(m.start,m.start+3-w+T),g=d.partialCodons[1]+g,S=f(g,a),S&&(y=n({start:T,end:w}),u.push({ln:o,pInt:y,partial:!0,transl:S}))}}}),u},prerender:function(e,t,n,i,s){function h(e,t){var r=a+"_"+n;return _.isUndefined(t)?e.line&&e.line[r]:(e.line||(e.line={}),e.line[r]=t)}var o=i.width,u=i.sequence,a=(t-e)/o,f=this.data.search(e,t),l=[],c=new r.pixIntervalCalculator(e,o,a,n=="pack");return n=="dense"?_.each(f,function(e){var t=c(e.data);t.v=e.data.score,l.push(t)}):(u?l={codons:this.type("bed").codons.call(this,f,o,c,h,e,t,u)}:l={layout:this.type("bed").stackedLayout.call(this,f,o,c,h)},l.width=o,l.bppp=a),_.isFunction(s)?s(l):l},calcUrl:function(e,t){var n=/\t/.test(t.id),r={$$:n||_.isUndefined(t.id)?t.name:t.id,$T:this.opts.name,$S:t.chrom,"${":t.chromStart,"$}":t.chromEnd,$D:this.browserOpts.genome.replace(/^ucsc:|:.*/ig,"")};return _.each(r,function(t,n){e=e.split(n).join(t)}),e},tipTipData:function(e){var t={},n=/\t/.test(e.id);return _.isUndefined(e.description)||(t.description=e.description),!_.isUndefined(e.score)&&e.score>0&&(t.score=e.score),_.extend(t,{position:e.chrom+":"+(s(e.chromStart)+1),size:e.chromEnd-e.chromStart}),this.opts.bedPlusFields&&_.extend(t,_.omit(e.extra,function(e){return e===""})),!_.isUndefined(e.id)&&!n&&(t.id=e.id),t},addArea:function(e,t,n,i,s){var o={},u=this.type().tipTipData,a=this.type().nameFunc,f=_.isFunction(a)?a:r.defaultNameFunc;if(!e)return;_.isFunction(u)||(u=this.type("bed").tipTipData),o=u.call(this,t.d),e.push([t.pInt.x,n*i+1,t.pInt.x+t.pInt.w,(n+1)*i,f(t.d),this.type("bed").calcUrl.call(this,s,t.d),t.pInt.oPrev,this.type("bed").calcFeatureColor.call(this,t)||null,null,o])},calcAlpha:function(e){return Math.max(e,166)/1e3},calcGradient:function(e,t){var n=[230,230,230],r=[];return _.isArray(e)||(e=_.map(e.split(","),s)),_.each(n,function(n,i){r[i]=(n-e[i])*((1e3-t)/1e3)+e[i]}),_.map(r,s).join(",")},calcFeatureColor:function(e){var t=this,n=t.opts,r=n.color;return n.altColor&&e.d.strand=="-"&&(r=n.altColor),n.itemRgb&&e.d.itemRgb&&this.validateColor(e.d.itemRgb)&&(r=e.d.itemRgb),n.useScore&&(r=t.type("bed").calcGradient(r,e.d.score)),r},drawArrows:function(e,t,n,r,i,s,o){var u=Math.min(r,3),a,f;i=Math.max(i,0),s=Math.min(s,t);if(s-i<5)return;if(o!=="+"&&o!=="-")return;e.beginPath(),a=o=="+"?.5:u+.5,f=o=="+"?u+.5:.5;for(var l=Math.floor(i)+2;l<s-u;l+=7)e.moveTo(l+a,n+r-u+.5),e.lineTo(l+f,n+r+.5),e.lineTo(l+a,n+r+u+.5);e.stroke()},drawFeature:function(e,t,n,i,s,o){var u=this,a=u.opts,f=a.color,l=i*s,c=Math.round(.5*(s-1)),h=Math.ceil(.25*(s-1)),p=s>6?2:1,d=null,v=null;if(a.itemRgb||a.altColor||a.useScore)f=u.type("bed").calcFeatureColor.call(u,n),e.fillStyle=e.strokeStyle="rgb("+f+")";n.thickInt?(n.blockInts?(v=null,e.fillRect(n.pInt.x,l+c,n.pInt.w,1),e.strokeStyle=f,_.each(n.blockInts,function(i){i.w>0&&i.x+i.w<=t&&i.x>=0&&e.fillRect(i.x,l+c-h+1,Math.max(i.w,1),h*2-1),d=n.thickInt.w>0&&r.pixIntervalOverlap(i,n.thickInt),d&&e.fillRect(d.x,l+1,Math.max(d.w,1),s-p),n.d.strand&&v&&(e.strokeStyle="rgb("+f+")",u.type("bed").drawArrows(e,t,l,c,v.x+v.w,i.x,n.d.strand)),v=i})):(e.fillRect(n.pInt.x,l+c-h+1,n.pInt.w,h*2-1),e.fillRect(n.thickInt.x,l+1,n.thickInt.w,s-p)),(!n.blockInts||n.blockInts.length==1)&&!o&&(e.strokeStyle="white",u.type("bed").drawArrows(e,t,l,c,n.thickInt.x,n.thickInt.x+n.thickInt.w,n.d.strand))):(e.fillRect(n.pInt.x,l+1,Math.max(n.pInt.w,1),s-p),o||(e.strokeStyle="white",u.type("bed").drawArrows(e,t,l,c,n.pInt.x,n.pInt.x+n.pInt.w,n.d.strand)))},drawStripes:function(e,t,n,r,i,s,o){for(var u=i;u<Math.min(s,t);u+=o*2)e.fillRect(u,n,o,r)},drawCodons:function(e,t,n,i,s,o){function v(e,t){t=t||0;var n=e.ox<0?e.ox%(c*2)+c:e.x+c;return n-t*o}var u=this,a=u.opts,f=i*s+1,l=s-(s>6?2:1),c=o*3,h=null,p=null,d=null;e.fillStyle="rgba(255,255,255,0.4)",n.thickInt?n.blockInts&&n.blockInts.length>1?_.each(n.blockInts,function(i,s){h=n.thickInt.w>0&&r.pixIntervalOverlap(i,n.thickInt),h&&h.w>0&&(p=n.d.blocks[s].exonFrame,d=v(h,p),u.type("bed").drawStripes(e,t,f,l,d,h.x+h.w,c))}):(d=v(n.thickInt),u.type("bed").drawStripes(e,t,f,l,d,n.thickInt.x+n.thickInt.w,c)):(d=v(n.pInt),u.type("bed").drawStripes(e,t,f,l,d,n.pInt.x+n.pInt.w,c)),e.fillStyle="rgb("+a.color+")"},drawTranslatedCodon:function(e,t,n,r,i){var s=this,o=s.opts,u=n.pInt,a=u.oPrev?u.ox:u.x,f=u.x+u.w+u.ow,l=(a+f)*.5,c=n.ln*r+1,h=r-(r>6?2:1),p={M:"0,255,0","*":"255,0,0"},d=p[n.transl.special],v=n.partial?"122,241,255":"255,255,255";u.w>0&&u.x+u.w<=t&&u.x>=0&&(d&&(e.fillStyle="rgb("+d+")",e.fillRect(u.x,c,n.pInt.w,h)),f-a>=o.minCodonLetterWidth&&r>10&&(e.fillStyle="rgb("+v+")",e.fillText(n.transl.aa,l,c+h+i)))},drawSpec:function(e,t,n){var r=this,i=r.opts,s=t.bppp&&1/t.bppp,o=e.getContext,u=i.url?i.url:'javascript:void("'+i.name+':$$")',a=i.drawLimit&&i.drawLimit[n],f=i.drawCodons&&t.bppp<=i.drawCodonsUnder,l=n=="pack"?15:6,c=i.color,h=null;u.match(/\$\$/)||(u+="$$");if(!o)throw"Canvas not supported";n=="pack"&&!r.areas[e.id]&&(h=r.areas[e.id]=[]);if(n=="dense")e.unscaledHeight(15),o=e.getContext("2d"),o.fillStyle="rgb("+c+")",_.each(t,function(e){i.useScore&&(o.fillStyle="rgba("+r.type("bed").calcGradient(c,e.v)+")"),o.fillRect(e.x,1,e.w,13)});else if(t.codons)o=e.getContext("2d"),o.font=(s>5?12:9)+"px 'Menlo','Bitstream Vera Sans Mono','Consolas','Lucida Console',monospace",o.textAlign="center",o.textBaseline="baseline",_.each(t.codons,function(e){r.type("bed").drawTranslatedCodon.call(r,o,t.width,e,l,s>5?-2:-3)});else{if(a&&t.layout&&t.layout.length>a||t.tooMany){e.unscaledHeight(0),e.className=e.className+" too-many";return}e.unscaledHeight(Math.max(t.layout.length*l,1)),o=e.getContext("2d"),o.fillStyle=o.strokeStyle="rgb("+c+")",_.each(t.layout,function(e,n){_.each(e,function(e){r.type("bed").drawFeature.call(r,o,t.width,e,n,l,f),r.type("bed").addArea.call(r,h,e,n,l,u),f&&r.type("bed").drawCodons.call(r,o,t.width,e,n,l,s)})})}},render:function(e,t,n,r,i){var s=this;s.prerender(t,n,r,{width:e.unscaledWidth()},function(o){var u=t+"-"+n+"-"+r;s.type().drawSpec.call(s,e,o,r),_.isFunction(s.renderSequenceCallbacks[u])&&(s.renderSequenceCallbacks[u](),delete s.renderSequenceCallbacks[u]),_.isFunction(i)&&i()})},renderSequence:function(e,t,n,r,i,s){function l(){o.prerender(t,n,r,{width:u,sequence:i},function(t){o.type("bed").drawSpec.call(o,e,t,r),_.isFunction(s)&&s()})}var o=this,u=e.unscaledWidth(),a=o.opts.drawCodons,f=o.opts.drawCodonsUnder;if(!a||!i||(n-t)/u>f)return!1;(" "+e.className+" ").indexOf(" unrendered ")>-1?o.renderSequenceCallbacks[t+"-"+n+"-"+r]=l:l()},loadOpts:function(e){var t=this.opts,n=/\d+,\d+,\d+\s+\d+,\d+,\d+/.test(t.colorByStrand),r=n?t.colorByStrand.split(/\s+/)[1]:"0,0,0";e.find("[name=colorByStrandOn]").attr("checked",!!n),e.find("[name=colorByStrand]").val(r).change(),e.find("[name=useScore]").attr("checked",this.isOn(t.useScore)),e.find("[name=url]").val(t.url)},saveOpts:function(e){var t=this.opts,n=e.find("[name=colorByStrandOn]").is(":checked"),r=e.find("[name=colorByStrand]").val(),i=this.validateColor(r);t.colorByStrand=n&&i?t.color+" "+r:"",t.useScore=e.find("[name=useScore]").is(":checked")?1:0,t.url=e.find("[name=url]").val(),this.type("bed").initOpts.call(this)}};t.exports=d},{"./utils/GeneticCode.js":13,"./utils/IntervalTree.js":14,"./utils/LineMask.js":15,"./utils/utils.js":19}],7:[function(e,t,n){var r=e("./utils/utils.js"),i=e("./wiggle_0.js"),s=r.parseInt10,o=_.extend({},i,{defaults:{altColor:"",priority:100,autoScale:"on",alwaysZero:"off",gridDefault:"off",maxHeightPixels:"128:128:15",graphType:"bar",viewLimits:"",yLineMark:0,yLineOnOff:"off",windowingFunction:"maximum",smoothingWindow:"off"},parse:function(e){var t=this,n=this.browserOpts.genomeSize,r={all:[]},i,o,u,a;return t.range=t.isOn(this.opts.alwaysZero)?[0,0]:[Infinity,-Infinity],_.each(e,function(e,n){var i=["chrom","chromStart","chromEnd","dataValue"],o={},u,a,f,l;_.each(e.split(/\s+/),function(e,t){o[i[t]]=e}),u=t.browserOpts.chrPos[o.chrom],_.isUndefined(u)&&t.warn("Invalid chromosome at line "+(n+1+t.opts.lineNum)),a=s(o.chromStart),f=s(o.chromEnd),l=parseFloat(o.dataValue),r.all.push({start:u+a,end:u+f,val:l})}),t.type("wiggle_0").finishParse.call(t,r)}});t.exports=o},{"./utils/utils.js":19,"./wiggle_0.js":21}],8:[function(e,t,n){var r=e("./bigbed.js"),i=e("./utils/utils.js"),s=i.floorHack,o=e("./utils/IntervalTree.js").IntervalTree,u=e("./utils/RemoteTrack.js").RemoteTrack,a=_.extend({},r,{magicBytes:null,parse:function(e){var t=this,n=t.browserOpts.genomeSize/2,r=new o(s(n),{startKey:"start",endKey:"end"}),i=t.ajaxDir()+"tabix.php?"+$.param({url:t.opts.bigDataUrl,density:"pack"}),a;return a=new u(r,function(e,n,r){range=t.chrRange(e,n).join(" "),$.ajax(i,{type:range.length>500?"POST":"GET",data:{range:range},success:function(e){var n=_.filter(e.split("\n"),function(e){var t=e.match(/\t/g);return t&&t.length>=2}),i=_.map(n,function(e){var n=t.type("bed").parseLine.call(t,e);return _.isUndefined(n.id)&&(n.id=[n.name,n.chrom,n.chromStart,n.chromEnd,n.strand,n.blockCount].join("	")),n});r(i)}})}),t.data={cache:r,remote:a},t.heights={max:null,min:15,start:15},t.sizes=["dense","squish","pack"],t.mapSizes=["pack"],!0},finishSetup:function(){var e=this,t=e.ajaxDir()+"tabix.php",n=1e5,r=e.chrRange(Math.round(e.browserOpts.pos),Math.round(e.browserOpts.pos+n)).join(" "),i=e.data.remote;$.ajax(t,{data:{info:4,range:r,url:e.opts.bigDataUrl},success:function(t){var r=e.opts,s=t.split("\n\n"),o=s[0].split("\n"),u;if(s[0]==""||s.length==1)throw new Error("tabix failed to retrieve data for this track.");u=s[1];if(!r.maxFetchWindow){var a=u.length/n,f=_.max(_.values(r.drawLimit));r.maxFetchWindow=f/a,r.optimalFetchWindow=Math.floor(r.maxFetchWindow/3)}i.setupBins(e.browserOpts.genomeSize,e.opts.optimalFetchWindow,e.opts.maxFetchWindow)}})},prerender:function(e,t,n,r,s){function l(e,t){var r=f+"_"+n;return _.isUndefined(t)?e.line&&e.line[r]:(e.line||(e.line={}),e.line[r]=t)}var o=this,u=r.width,a=o.data,f=(t-e)/u;o.opts.maxFetchWindow>0&&t-e>o.opts.maxFetchWindow?s({tooMany:!0}):o.data.remote.fetchAsync(e,t,function(t){var r,a=[];if(t.tooMany)return s(t);r=new i.pixIntervalCalculator(e,u,f,n=="pack"),n=="dense"?_.each(t,function(e){a.push(r(e.data))}):(a={layout:o.type("bed").stackedLayout.call(o,t,u,r,l)},a.width=u),s(a)})},render:function(e,t,n,r,i){var s=this,o=s.opts.drawLimit&&s.opts.drawLimit[r];s.prerender(t,n,r,{width:e.unscaledWidth()},function(t){o&&t.layout&&t.layout.length>o||t.tooMany?(e.unscaledHeight(0),e.className=e.className+" too-many"):s.type("bed").drawSpec.call(s,e,t,r),_.isFunction(i)&&i()})}});t.exports=a},{"./bigbed.js":9,"./utils/IntervalTree.js":14,"./utils/RemoteTrack.js":17,"./utils/utils.js":19}],9:[function(e,t,n){var r=e("./utils/utils.js"),i=r.floorHack,s=e("./utils/IntervalTree.js").IntervalTree,o=e("./utils/RemoteTrack.js").RemoteTrack,u=e("./bed.js"),a={defaults:_.extend({},u.defaults,{chromosomes:"",drawLimit:{squish:500,pack:100},optimalFetchWindow:0,maxFetchWindow:0}),magicBytes:[2273964779,3958540679],init:function(){if(!this.opts.bigDataUrl)throw new Error("Required parameter bigDataUrl not found for bigBed track at "+JSON.stringify(this.opts)+(this.opts.lineNum+1));this.type("bed").initOpts.call(this)},applyOpts:function(){this.syncProps(["opts","isSearchable"])},parse:function(e){var t=this,n=t.browserOpts.genomeSize/2,r=new s(i(n),{startKey:"start",endKey:"end"}),u=t.ajaxDir()+"bigbed.php?"+$.param({url:t.opts.bigDataUrl,density:"pack"}),a;return a=new o(r,function(e,n,r){range=t.chrRange(e,n,!0).join(" "),$.ajax(u,{type:range.length>500?"POST":"GET",data:{range:range},success:function(e){var n=_.filter(e.split("\n"),function(e){var t=e.match(/\t/g);return t&&t.length>=2}),i=_.map(n,function(e){var n=t.type("bed").parseLine.call(t,e);return _.isUndefined(n.id)&&(n.id=[n.name,n.chrom,n.chromStart,n.chromEnd,n.strand,n.blockCount].join("	")),n});r(i)}})}),t.data={cache:r,remote:a},t.heights={max:null,min:15,start:15},t.sizes=["dense","squish","pack"],t.mapSizes=["pack"],t.isSearchable=t.opts.searchable,t.renderSequenceCallbacks={},!0},finishSetup:function(){var e=this,t=e.ajaxDir()+"bigbed.php",n=e.data.remote;$.ajax(t,{data:{url:e.opts.bigDataUrl},success:function(t){e.isSearchable=e.opts.searchable=t.extraIndexCount>0;if(!e.opts.maxFetchWindow){var r=t.itemCount/e.browserOpts.genomeSize,i=_.max(_.values(e.opts.drawLimit));e.opts.maxFetchWindow=i/r,e.opts.optimalFetchWindow=Math.floor(e.opts.maxFetchWindow/3)}e.type("bigbed").applyOpts.call(e),n.setupBins(e.browserOpts.genomeSize,e.opts.optimalFetchWindow,e.opts.maxFetchWindow)}})},prerender:function(e,t,n,i,s){function p(e,t){var r=l+"_"+n;return _.isUndefined(t)?e.line&&e.line[r]:(e.line||(e.line={}),e.line[r]=t)}function d(e){var t=[],n;n=e.split(/\s+/g),_.each(n,function(e,n){e!="n/a"&&e.length&&t.push({x:n,w:1,v:parseFloat(e)*1e3})}),s(t)}var o=this,u=i.width,a=i.sequence,f=o.data,l=(t-e)/u,c=this.chrRange(e,t,!0).join(" "),h;n!="dense"&&o.opts.maxFetchWindow>0&&t-e>o.opts.maxFetchWindow?s({tooMany:!0}):n=="dense"?(h=o.ajaxDir()+"bigbed.php?"+$.param({url:o.opts.bigDataUrl,width:u,density:n}),$.ajax(h,{type:c.length>500?"POST":"GET",data:{range:c},success:d})):o.data.remote.fetchAsync(e,t,function(i){var f,c={};if(i.tooMany)return s(i);f=new r.pixIntervalCalculator(e,u,l,n=="pack"),a?c.codons=o.type("bed").codons.call(o,i,u,f,p,e,t,a):c.layout=o.type("bed").stackedLayout.call(o,i,u,f,p),c.width=u,c.bppp=l,s(c)})},render:function(e,t,n,r,i){var s=this;s.prerender(t,n,r,{width:e.unscaledWidth()},function(o){var u=t+"-"+n+"-"+r;s.type("bed").drawSpec.call(s,e,o,r),_.isFunction(s.renderSequenceCallbacks[u])&&(s.renderSequenceCallbacks[u](),delete s.renderSequenceCallbacks[u]),_.isFunction(i)&&i()})},renderSequence:function(e,t,n,r,i,s){function l(){o.prerender(t,n,r,{width:u,sequence:i},function(t){o.type("bed").drawSpec.call(o,e,t,r),_.isFunction(s)&&s()})}var o=this,u=e.unscaledWidth(),a=o.opts.drawCodons,f=o.opts.drawCodonsUnder;if(!a||!i||(n-t)/u>f)return!1;(" "+e.className+" ").indexOf(" unrendered ")>-1?o.renderSequenceCallbacks[t+"-"+n+"-"+r]=l:l()},search:function(e,t){var n=this,i=n.ajaxDir()+"bigbed.php";$.ajax(i,{data:{url:n.opts.bigDataUrl,search:e},success:function(i){var s={choices:[]},o=n.type().nameFunc,u=n.type().tipTipData,a=_.isFunction(o)?o:r.defaultNameFunc,f=_.filter(i.split("\n"),function(e){var t=e.match(/\t/g);return t&&t.length>=2});_.isFunction(u)||(u=n.type("bed").tipTipData),_.each(f,function(e){var t=n.type("bed").parseLine.call(n,e);if(t===null)return;var r=u.call(n,t),i=a(t),o=t.name||t.id||"",f=t.chrom+":"+t.chromStart+"-"+t.chromEnd,l={name:i,desc:r.description||f,pos:f};o&&o!=i&&(l.altName=o),s.choices.push(l)}),s.choices=_.first(_.sortBy(s.choices,function(t){return t.name.toLowerCase()==e.toLowerCase()?0:1}),10),t(s)}})},loadOpts:function(){return this.type("bed").loadOpts.apply(this,arguments)},saveOpts:function(){return this.type("bed").saveOpts.apply(this,arguments)}};t.exports=a},{"./bed.js":6,"./utils/IntervalTree.js":14,"./utils/RemoteTrack.js":17,"./utils/utils.js":19}],10:[function(e,t,n){var r=e("./bigbed.js"),i=e("./utils/utils.js"),s=i.strip,o=_.extend({},r,{defaults:_.extend({},r.defaults,{baseColorUseCds:"given"}),tipTipData:function(e){var t={};return _.isUndefined(e.extra.geneName2)||(t.description=e.extra.geneName2),_.extend(t,{id:e.name,position:e.chrom+":"+(parseInt10(e.chromStart)+1),size:e.chromEnd-e.chromStart}),!_.isUndefined(e.score)&&e.score>0&&(t.score=e.score),t},nameFunc:function(e){return s(e.extra.name2||e.extra.geneName||e.name||e.id||"")}});t.exports=o},{"./bigbed.js":9,"./utils/utils.js":19}],11:[function(e,t,n){var r={defaults:{altColor:"128,128,128",priority:100,autoScale:"on",alwaysZero:"off",gridDefault:"off",maxHeightPixels:"128:128:15",graphType:"bar",viewLimits:"",yLineMark:0,yLineOnOff:"off",windowingFunction:"maximum",smoothingWindow:"off"},magicBytes:[2291137574,654086024],init:function(){if(!this.opts.bigDataUrl)throw new Error("Required parameter bigDataUrl not found for bigWig track at "+JSON.stringify(this.opts)+(this.opts.lineNum+1));this.type("wiggle_0").initOpts.call(this)},_binFunctions:{minimum:1,maximum:1,mean:1,min:1,max:1,std:1,coverage:1},applyOpts:function(){this.type
("wiggle_0").applyOpts.apply(this,arguments),this.syncProps(["opts","drawRange","scales"])},parse:function(e){var t=this;return t.stretchHeight=!0,t.range=t.isOn(t.opts.alwaysZero)?[0,0]:[Infinity,-Infinity],!0},finishSetup:function(){var e=this;$.ajax(e.ajaxDir()+"bigwig.php",{data:{info:1,url:e.opts.bigDataUrl},async:!1,success:function(t){var n=t.split("\n");_.each(n,function(t){var n=t.split(": ");n[0]=="min"&&(e.range[0]=Math.min(parseFloat(n[1]),e.range[0])),n[0]=="max"&&(e.range[1]=Math.max(parseFloat(n[1]),e.range[1]))})}}),e.type().applyOpts.apply(e)},prerender:function(e,t,n,r,i){function f(e){var t=s.type("wiggle_0").initDrawSpec.call(s,r),n=e.split(/\s+/g);_.each(n,function(e){e=="n/a"?t.bars.push(null):e.length&&t.bars.push((parseFloat(e)-s.drawRange[0])/t.vScale)}),i(t)}var s=this,o=r.width,u=s.chrRange(e,t,!0).join(" "),a=$.param({url:s.opts.bigDataUrl,width:o,winFunc:s.opts.windowingFunction});$.ajax(s.ajaxDir()+"bigwig.php?"+a,{type:u.length>500?"POST":"GET",data:{range:u},success:f})},render:function(e,t,n,r,i){var s=this,o=e.unscaledWidth(),u=e.getContext&&e.getContext("2d");if(!u)throw"Canvas not supported";s.prerender(t,n,r,{width:o},function(t){s.type("wiggle_0").drawBars.call(s,u,t,e.unscaledHeight(),o),_.isFunction(i)&&i()})},loadOpts:function(){return this.type("wiggle_0").loadOpts.apply(this,arguments)},saveOpts:function(){return this.type("wiggle_0").saveOpts.apply(this,arguments)}};t.exports=r},{}],12:[function(e,t,n){var r=e("./utils/IntervalTree.js").IntervalTree,i=e("./utils/utils.js"),s=i.strip,o=i.floorHack,u=i.parseInt10,a={defaults:{collapseByGene:"off",keyColumnWidth:21,itemRgb:"off",colorByStrand:"",useScore:0,group:"user",priority:"user",offset:0,url:"",htmlUrl:"",drawLimit:{squish:null,pack:null}},init:function(){this.type("bed").initOpts.call(this),this.opts.collapseByGene=this.isOn(this.opts.collapseByGene),this.featureTypeCounts={},this.renderSequenceCallbacks={}},parseEntry:function(e,t,n){var r={chrom:e,score:"?",blocks:null,qualifiers:{}},i=this.opts.keyColumnWidth,o=null,a=[],f=["locus_tag","gene","db_xref"],l=["gene","locus_tag","db_xref"],c=["rrna","trna"],h=["product"],p,d,v;return d=this.browserOpts.chrPos[e],n=n||0,_.isUndefined(d)?(this.warn("Invalid chromosome at line "+(lineno+1+this.opts.lineNum)),null):(_.each(t,function(e,t){var n=e.substr(0,i),u=e.substr(i),f=u.match(/^\/(\w+)(=?)(.*)/);n.match(/\w/)?(r.type=s(n),o=null,a.push(u)):f?(o=f[1],r.qualifiers[o]||(r.qualifiers[o]=[]),r.qualifiers[o].push([f[2]?f[3]:!0])):o!==null?_.last(r.qualifiers[o]).push(u):a.push(u)}),r.fullLocation=a=a.join(""),p=_.map(_.filter(a.split(/\D+/),_.identity),u),r.chromStart=_.min(p),r.chromEnd=_.max(p)+1,r.start=d+r.chromStart,r.end=d+r.chromEnd,r.strand=/complement/.test(a)?"-":"+",r.thickStart=r.thickEnd=null,r.blocks=null,_.each(r.qualifiers,function(e,t){_.each(e,function(t,n){e[n]=s(t.join(" ")),/^"[\s\S]*"$/.test(e[n])&&(e[n]=e[n].replace(/^"|"$/g,"").replace(/""/g,'"'))})}),r.name=r.type,_.contains(c,r.type.toLowerCase())&&Array.prototype.push.apply(l,h),_.find(l,function(e){if(r.qualifiers[e]&&r.qualifiers[e][0])return r.name=r.qualifiers[e][0]}),r.name==r.type&&(this.featureTypeCounts[r.type]||(this.featureTypeCounts[r.type]=1),r.name=r.name+"_"+this.featureTypeCounts[r.type]++),this.opts.collapseByGene&&_.find(f,function(e){if(r.qualifiers[e]&&r.qualifiers[e][0])return r._collapseKey=r.qualifiers[e][0]}),r.name=="Q"&&console.log(r),r)},collapseFeatures:function(e){var t=this.browserOpts.chrPos,n=["mrna","gene","cds"],r=["exon","cds"],i=e[0],s=[],o,u,a;return o=_.find(n,function(t){var n=_.find(e,function(e){return e.type.toLowerCase()==t});if(n)return i=n,!0}),_.find(r,function(t){a=_.select(e,function(e){return e.type.toLowerCase()==t});if(a.length)return!0}),u=_.find(e,function(e){return e.type.toLowerCase()=="cds"}),_.each(a,function(e){e.fullLocation.replace(/(\d+)\.\.[><]?(\d+)/g,function(n,r,i){s.push({start:t[e.chrom]+Math.min(r,i),end:t[e.chrom]+Math.max(r,i)+1})})}),s.length&&(i.blocks=_.sortBy(s,function(e){return e.start}),i.thickStart=u?u.start:feature.start,i.thickEnd=u?u.end:feature.end),_.each(e,function(e){if(e===i)return;_.each(e.qualifiers,function(e,t){i.qualifiers[t]||(i.qualifiers[t]=[]),_.each(e,function(e){_.contains(i.qualifiers[t],e)||i.qualifiers[t].push(e)})})}),i},parse:function(e){function h(r){f!==null&&(c=t.type().parseEntry.call(t,a,e.slice(f,r),f),c&&(n.collapseByGene?(l[c._collapseKey]=l[c._collapseKey]||[],l[c._collapseKey].push(c)):s.add(c)))}var t=this,n=t.opts,i=this.browserOpts.genomeSize/2,s=new r(o(i),{startKey:"start",endKey:"end"}),u=e.length,a=null,f=null,l={},c;return _.each(e,function(e,t){e.substr(0,12)=="ACCESSION   "?(h(t),a=e.substr(12),f=null):a!==null&&e.substr(5,1).match(/\w/)&&(h(t),f=t)}),a!==null&&h(e.length),n.collapseByGene&&_.each(l,function(e,n){s.add(t.type().collapseFeatures.call(t,e))}),t.data=s,t.heights={max:null,min:15,start:15},t.sizes=["dense","squish","pack"],t.mapSizes=["pack"],!0},tipTipData:function(e){var t={translation:1},n={type:e.type,position:e.chrom+":"+e.chromStart,size:e.chromEnd-e.chromStart};return _.each(e.qualifiers,function(e,r){if(r=="note"){n.description=e.join("; ");return}n[r]=e.join("; "),t[r]&&n[r].length>25&&(n["."+r]=n[r].replace(/\s+/g,""),n[r]=n[r].substr(0,25)+"…")}),n},prerender:function(e,t,n,r,i){return this.type("bed").prerender.call(this,e,t,n,r,i)},drawSpec:function(){return this.type("bed").drawSpec.apply(this,arguments)},render:function(e,t,n,r,i){this.type("bed").render.call(this,e,t,n,r,i)},loadOpts:function(){return this.type("bed").loadOpts.apply(this,arguments)},saveOpts:function(){return this.type("bed").saveOpts.apply(this,arguments)}};t.exports=a},{"./utils/IntervalTree.js":14,"./utils/utils.js":19}],13:[function(e,t,n){function o(e){var t=e.split("").reverse().join("");return t.replace(/[ATCG]/g,function(e){return s[e]})}var r=e("../../../underscore.min.js"),i={},s={A:"T",T:"A",G:"C",C:"G"};t.exports.GeneticCode=function(e){e=(e||1).toString();if(i[e])return i[e];if(!u[e])throw"Unsupported NCBI transl_table value provided to geneticCode()";var t=function(e){var t=e.split("\n"),n={},r,i,s;for(var u=0;u<64;u++)r=t[2][u+11]+t[3][u+11]+t[4][u+11],s=t[0][u+11],i=t[1][u+11],i=i==="-"?!1:r!=="ATG"?i.toLowerCase():i,n[r]={aa:s,special:i};return function(e,t){return e=t===!0?o(e.toUpperCase()):e.toUpperCase(),n[e]||!1}}(u[e]);return i[e]=t};var u={1:"    AAs  = FFLLSSSSYY**CC*WLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = ---M------**--*----M---------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",2:"    AAs  = FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIMMTTTTNNKKSS**VVVVAAAADDEEGGGG\n  Starts = ----------**--------------------MMMM----------**---M------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",3:"    AAs  = FFLLSSSSYY**CCWWTTTTPPPPHHQQRRRRIIMMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = ----------**----------------------MM----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",4:"    AAs  = FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = --MM------**-------M------------MMMM---------------M------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",5:"    AAs  = FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIMMTTTTNNKKSSSSVVVVAAAADDEEGGGG\n  Starts = ---M------**--------------------MMMM---------------M------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",6:"    AAs  = FFLLSSSSYYQQCC*WLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = --------------*--------------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",9:"    AAs  = FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIIMTTTTNNNKSSSSVVVVAAAADDEEGGGG\n  Starts = ----------**-----------------------M---------------M------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",10:"    AAs  = FFLLSSSSYY**CCCWLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = ----------**-----------------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",11:"    AAs  = FFLLSSSSYY**CC*WLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = ---M------**--*----M------------MMMM---------------M------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",12:"    AAs  = FFLLSSSSYY**CC*WLLLSPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = ----------**--*----M---------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",13:"    AAs  = FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIMMTTTTNNKKSSGGVVVVAAAADDEEGGGG\n  Starts = ---M------**----------------------MM---------------M------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",14:"    AAs  = FFLLSSSSYYY*CCWWLLLLPPPPHHQQRRRRIIIMTTTTNNNKSSSSVVVVAAAADDEEGGGG\n  Starts = -----------*-----------------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",16:"    AAs  = FFLLSSSSYY*LCC*WLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = ----------*---*--------------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",21:"    AAs  = FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIMMTTTTNNNKSSSSVVVVAAAADDEEGGGG\n  Starts = ----------**-----------------------M---------------M------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",22:"    AAs  = FFLLSS*SYY*LCC*WLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = ------*---*---*--------------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",23:"    AAs  = FF*LSSSSYY**CC*WLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = --*-------**--*-----------------M--M---------------M------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",24:"    AAs  = FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSSKVVVVAAAADDEEGGGG\n  Starts = ---M------**-------M---------------M---------------M------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",25:"    AAs  = FFLLSSSSYY**CCGWLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = ---M------**-----------------------M---------------M------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",26:"    AAs  = FFLLSSSSYY**CC*WLLLAPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = ----------**--*----M---------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",27:"    AAs  = FFLLSSSSYYQQCCWWLLLAPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = --------------*--------------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",28:"    AAs  = FFLLSSSSYYQQCCWWLLLAPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = ----------**--*--------------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",29:"    AAs  = FFLLSSSSYYYYCC*WLLLAPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = --------------*--------------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",30:"    AAs  = FFLLSSSSYYEECC*WLLLAPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = --------------*--------------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n",31:"    AAs  = FFLLSSSSYYEECCWWLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG\n  Starts = ----------**-----------------------M----------------------------\n  Base1  = TTTTTTTTTTTTTTTTCCCCCCCCCCCCCCCCAAAAAAAAAAAAAAAAGGGGGGGGGGGGGGGG\n  Base2  = TTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGGTTTTCCCCAAAAGGGG\n  Base3  = TCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAGTCAG\n"}},{"../../../underscore.min.js":22}],14:[function(e,t,n){(function(t){function r(e,t){t||(t={}),this.startKey=t.startKey||0,this.endKey=t.endKey||1,this.intervalHash={},this.pointTree=new n({compare:function(e,t){if(e==null)return-1;if(t==null)return 1;var n=e[0]-t[0];return n>0?1:n==0?0:-1}}),this._autoIncrement=0;if(!e||typeof e!="number")throw new Error("you must specify center index as the 2nd argument.");this.root=new a(e,this)}function i(e){return e>2147483647||e<-2147483648?Math.floor(e/2):e>>>1}function s(e,t){for(;;)if(t.end<e.idx)e.left||(e.left=new a(i(t.start+t.end),this)),e=e.left;else{if(!(e.idx<t.start))return e.insert(t);e.right||(e.right=new a(i(t.start+t.end),this)),e=e.right}}function o(e,t,n){for(;;){if(!e)break;if(t<e.idx)e.starts.arr.every(function(e){var r=e.start<=t;return r&&n.push(e.result()),r}),e=e.left;else{if(!(t>e.idx)){e.starts.arr.map(function(e){n.push(e.result())});break}e.ends.arr.every(function(e){var r=e.end>=t;return r&&n.push(e.result()),r}),e=e.right}}}function u(e,t,n){if(t-e<=0)throw new Error("end must be greater than start. start: "+e+", end: "+t);var r={},s=[];o.call(this,this.root,i(e+t),s,!0),s.forEach(function(e){r[e.id]=!0});var u=this.pointTree.bsearch([e,null]);while(u>=0&&this.pointTree.arr[u][0]==e)u--;var a=this.pointTree.bsearch([t,null]),f=this.pointTree.arr.length-1;while(a==-1||a<=f&&this.pointTree.arr[a][0]<=t)a++;this.pointTree.arr.slice(u+1,a).forEach(function(e){var t=e[1];r[t]=!0},this),Object.keys(r).forEach(function(r){var i=this.intervalHash[r];n.push(i.result(e,t))},this)}function a(e){this.idx=e,this.starts=new n({compare:function(e,t){if(e==null)return-1;if(t==null)return 1;var n=e.start-t.start;return n>0?1:n==0?0:-1}}),this.ends=new n({compare:function(e,t){if(e==null)return-1;if(t==null)return 1;var n=e.end-t.end;return n<0?1:n==0?0:-1}})}function f(e,t,n,r){this.id=t,this.start=e[n],this.end=e[r],this.data=e;if(typeof this.start!="number"||typeof this.end!="number")throw new Error("start, end must be number. start: "+this.start+", end: "+this.end);if(this.start>=this.end)throw new Error("start must be smaller than end. start: "+this.start+", end: "+this.end)}function l(e){this.name="DuplicateError",this.message=e,this.stack=(new Error).stack}var n=e("./SortedList.js").SortedList;r.prototype.add=function(e,t){if(this.contains(t))throw new l("id "+t+" is already registered.");if(t==undefined){while(this.intervalHash[this._autoIncrement])this._autoIncrement++;t=this._autoIncrement}var n=new f(e,t,this.startKey,this.endKey);this.pointTree.insert([n.start,t]),this.pointTree.insert([n.end,t]),this.intervalHash[t]=n,this._autoIncrement++,s.call(this,this.root,n)},r.prototype.contains=function(e){return!!this.get(e)},r.prototype.get=function(e){return this.intervalHash[e]||null},r.prototype.addIfNew=function(e,t){try{this.add(e,t)}catch(n){if(n instanceof l)return;throw n}},r.prototype.search=function(e,t){var n=[];if(typeof e!="number")throw new Error(e+": invalid input");if(t==undefined)o.call(this,this.root,e,n);else{if(typeof t!="number")throw new Error(e+","+t+": invalid input");u.call(this,e,t,n)}return n},r.prototype.remove=function(e){throw".remove() is currently unimplemented"},a.prototype.insert=function(e){this.starts.insert(e),this.ends.insert(e)},f.prototype.result=function(e,t){var n={id:this.id,data:this.data};if(typeof e=="number"&&typeof t=="number"){var r=Math.max(this.start,e),i=Math.min(this.end,t),s=i-r;n.rate1=s/(t-e),n.rate2=s/(this.end-this.start)}return n},l.prototype=new Error,t.IntervalTree=r})(t&&t.exports||this)},{"./SortedList.js":18}],15:[function(e,t,n){(function(n){(function(t){function s(e,t){this.fudge=t=t||1,this.items=[],this.length=Math.ceil(e/t),this.mask=n.Uint8Array?new Uint8Array(this.length):new Array(this.length)}var r=e("./utils.js"),i=r.floorHack;s.prototype.add=function(e,t,n){var r=Math.ceil((e+t)/this.fudge);this.items.push({x:e,w:t,data:n});for(var s=Math.max(i(e/this.fudge),0);s<Math.min(r,this.length);s++)this.mask[s]=1},s.prototype.conflict=function(e,t){var n=Math.ceil((e+t)/this.fudge);for(var r=Math.max(i(e/this.fudge),0);r<Math.min(n,this.length);r++)if(this.mask[r])return!0;return!1},t.LineMask=s})(t&&t.exports||this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./utils.js":19}],16:[function(e,t,n){(function(t){function a(e,t,i){var s={startKey:0,endKey:1};this.unpaired=new n(e,t),this.unpairedOptions=r.extend({},s,t),this.paired=new n(e,i),this.pairedOptions=r.extend({pairingKey:"qname",pairedLengthKey:"tlen"},s,i);if(this.pairedOptions.startKey===this.unpairedOptions.startKey)throw new Error("startKey for unpairedOptions and pairedOptions must be different in a PairedIntervalTree");if(this.pairedOptions.endKey===this.unpairedOptions.endKey)throw new Error("endKey for unpairedOptions and pairedOptions must be different in a PairedIntervalTree");this.pairingDisabled=!1,this.pairingMinDistance=this.pairingMaxDistance=null}function f(e,t){var n=t.flags;return n.isSecondaryAlignment||n.isReadFailingVendorQC||n.isDuplicateRead||n.isSupplementaryAlignment?!1:!0}function l(e,t,n){var a=t[e.pairedOptions.pairedLengthKey],f=t.end-t.start,l,c;r.isUndefined(n)&&(n={_mocked:!0,flags:{isReadPaired:!0,isReadProperlyAligned:!0,isReadFirstOfPair:t.flags.isReadLastOfPair,isReadLastOfPair:t.flags.isReadFirstOfPair}});if(!t.flags.isReadPaired||!n.flags.isReadPaired)return s;if(!t.flags.isReadProperlyAligned||!n.flags.isReadProperlyAligned)return s;if(t.flags.isReadUnmapped||n.flags.isReadUnmapped)return s;if(t.flags.isMateUnmapped||n.flags.isMateUnmapped)return s;if(t.flags.isReadFirstOfPair&&!n.flags.isReadLastOfPair)return s;if(t.flags.isReadLastOfPair&&!n.flags.isReadFirstOfPair)return s;n._mocked&&r.extend(n,{rname:t.rnext=="="?t.rname:t.rnext,pos:t.pnext,start:t.rnext=="="?i(t.pnext)+(t.start-i(t.pos)):0,end:a>0?t.start+a:a<0?t.end+a+f:0,rnext:t.rnext=="="?"=":t.rname,pnext:t.pos});if(t.rnext!="="||n.rnext!="=")return t.rnext!=n.rname||t.rnext!=n.rname?s:t.pnext!=n.pos||t.pos!=n.pnext?s:o;n._mocked&&r.extend(n.flags,{readStrandReverse:t.flags.mateStrandReverse,mateStrandReverse:t.flags.readStrandReverse}),l=t.start>n.start,c=Math.abs(a);if(l){if(!t.flags.readStrandReverse||t.flags.mateStrandReverse)return o;if(n.flags.readStrandReverse||!n.flags.mateStrandReverse)return o}else{if(t.flags.readStrandReverse||!t.flags.mateStrandReverse)return o;if(!n.flags.readStrandReverse||n.flags.mateStrandReverse)return o}return t.insertSize=n.insertSize=c,c>this.pairingMaxDistance||c<this.pairingMinDistance?o:u}var n=e("./IntervalTree.js").IntervalTree,r=e("../../../underscore.min.js"),i=e("./utils.js").parseInt10,s=0,o=1,u=2;a.prototype.disablePairing=function(){this.pairingDisabled=!0,this.paired=this.unpaired},a.prototype.setPairingInterval=function(e,t){if(typeof e!="number")throw new Error("you must specify min as the 1st argument.");if(typeof t!="number")throw new Error("you must specify max as the 2nd argument.");if(this.pairingMinDistance!==null)throw new Error("Can only be called once. You can't change the pairing interval.");this.pairingMinDistance=e,this.pairingMaxDistance=t},a.prototype.addIfNew=function(e,t){var n=!1,i=0,a=this.unpairedOptions.startKey,c=this.unpairedOptions.endKey,h=this.pairedOptions.startKey,p=this.pairedOptions.endKey,d=e[this.pairedOptions.pairedLengthKey],v=s,m,g;if(this.unpaired.contains(t))return;this.unpaired.add(e,t);if(!this.pairingDisabled&&f(this,e)){if(this.pairingMinDistance===null)throw new Error("Can only add paired data after the pairing interval has been set!");m=e[this.pairedOptions.pairingKey],g=this.paired.get(m);if(g!==null){g=g.data,v=l(this,e,g);if(v===u||v===o)g.mate=e,e.mate=r.extend({},r.omit(g,function(e,t){return r.isObject(e)})),e.mate.flags=r.clone(g.flags)}if(v===u||v===o&&g.mateExpected)e.drawAsMates=g.drawAsMates=!0;else{while(this.paired.contains(m))m=m.replace(/\t.*/,"")+"	"+ ++i;e.mateExpected=l(this,e)===u,e.mateExpected&&d>0?(e[h]=e[a],e[p]=e[a]+d):e.mateExpected&&d<0?(e[p]=e[c],e[h]=e[c]+d):(e[h]=e[a],e[p]=e[c]),this.paired.add(e,m)}}},a.prototype.add=a.prototype.addIfNew,a.prototype.search=function(e,t,n){return n&&!this.pairingDisabled?this.paired.search(e,t):this.unpaired.search(e,t)},a.prototype.remove=function(e){throw".remove() is currently unimplemented"},t.PairedIntervalTree=a})(t&&t.exports||this)},{"../../../underscore.min.js":22,"./IntervalTree.js":14,"./utils.js":19}],17:[function(e,t,n){(function(t){function s(e,t){if(typeof e!="object"||!e.addIfNew&&(!n.keys(e).length||e[n.keys(e)[0]].addIfNew))throw new Error("you must specify an IntervalTree cache, or an object/array containing IntervalTrees, as the 1st argument.");if(typeof t!="function")throw new Error("you must specify a fetcher function as the 2nd argument.");this.cache=e,this.fetcher=t,this.callbacks=[],this.afterBinSetup=[],this.binsLoaded=null}function o(e,t,r){if(!e.binsLoaded)throw new Error("you cannot calculate bin overlap before setupBins is called.");var i=Math.floor((t-1)/e.optimalFetchWindow),s=Math.floor((r-1)/e.optimalFetchWindow);return n.range(i,s+1)}function u(e,t,s){var o=t*e.optimalFetchWindow+1,u=(t+1)*e.optimalFetchWindow+1;e.binsLoaded[t]=r,e.fetcher(o,u,function(o){n.each(o,function(t){if(!t)return;e.cache.addIfNew(t,t.id)}),e.binsLoaded[t]=i,n.isFunction(s)&&s()})}function a(e){e.callbacks=n.filter(e.callbacks,function(t){var r=t.callback,s=n.isUndefined(t.extraArgs)?[]:t.extraArgs,u,a;return t.end-t.start>e.maxFetchWindow?(r({tooMany:!0}),!1):(u=o(e,t.start,t.end),a=n.filter(u,function(t){return e.binsLoaded[t]!==i}).length>0,a?!0:(r(e.cache.search.apply(e.cache,[t.start,t.end].concat(s))),!1))})}function f(e){e.callbacks=n.filter(e.callbacks,function(t){var n=t.callback;return t.end-t.start>e.maxFetchWindow?(n({tooMany:!0}),!1):!0})}var n=e("../../../underscore.min.js"),r=1,i=2;s.prototype.setupBins=function(e,t,r){var i=this;if(i.binsLoaded)throw new Error("you cannot run setupBins more than once.");if(typeof e!="number")throw new Error("you must specify the genomeSize as the 1st argument.");if(typeof t!="number")throw new Error("you must specify optimalFetchWindow as the 2nd argument.");if(typeof r!="number")throw new Error("you must specify maxFetchWindow as the 3rd argument.");i.genomeSize=e,i.optimalFetchWindow=t,i.maxFetchWindow=r,i.numBins=Math.ceil(e/t),i.binsLoaded={},n.each(this.afterBinSetup,function(e){i.fetchAsync(e.start,e.end,e.extraArgs)}),f(i)},s.prototype.fetchAsync=function(e,t,r,s){var f=this;n.isFunction(r)&&n.isUndefined(s)&&(s=r,r=undefined);if(!f.binsLoaded)n.isFunction(s)&&f.callbacks.push({start:e,end:t,extraArgs:r,callback:s}),f.afterBinSetup.push({start:e,end:t,extraArgs:r});else{var l=o(f,e,t),c=n.filter(l,function(e){return f.binsLoaded[e]===i}),h=n.filter(l,function(e){return!f.binsLoaded[e]});if(c.length==l.length)return r=n.isUndefined(r)?[]:r,n.isFunction(s)&&s(f.cache.search.apply(f.cache,[e,t].concat(r)));if(t-e>f.maxFetchWindow)return n.isFunction(s)&&s({tooMany:!0});n.isFunction(s)&&f.callbacks.push({start:e,end:t,extraArgs:r,callback:s}),n.each(h,function(e){u(f,e,function(){a(f)})})}},t.RemoteTrack=s})(t&&t.exports||this)},{"../../../underscore.min.js":22}],18:[function(e,t,n){(function(e){function t(){var e=null,n={},r=arguments;["0","1"].forEach(function(t){var i=r[t];Array.isArray(i)?e=i:i&&typeof i=="object"&&(n=i)}),this.arr=[],["filter","compare"].forEach(function(e){typeof n[e]=="function"?this[e]=n[e]:n[e]&&t[e][n[e]]&&(this[e]=t[e][n[e]])},this),e&&this.massInsert(e)}t.prototype.bsearch=function(e){var t,n=0,r=this.arr.length;while(r-n>1){t=Math.floor((n+r)/2),mval=this.arr[t];switch(this.compare(e,mval)){case 1:default:n=t;break;case-1:r=t;break;case 0:return t}}return this.arr[0]==null||n==0&&this.arr[0]!=null&&this.compare(this.arr[0],e)==1?-1:n},t.prototype.get=function(e){return this.arr[e]},t.prototype.toArray=function(e){return this.arr.slice()},t.prototype.slice=function(){return this.arr.slice.apply(this.arr,arguments)},t.prototype.size=function(){return this.arr.length},t.prototype.head=function(){return this.arr[0]},t.prototype.tail=function(){return this.arr.length==0?null:this.arr[this.arr.length-1]},t.prototype.massInsert=function(e){for(var t=0;t<e.length;t+=4096)Array.prototype.push.apply(this.arr,Array.prototype.slice.call(e,t,t+4096));this.arr.sort(this.compare)},t.prototype.insert=function(){arguments.length>100?this.massInsert(arguments):Array.prototype.forEach.call(arguments,function(e){var t=this.bsearch(e);this.filter(e,t)&&this.arr.splice(t+1,0,e)},this)},t.prototype.filter=function(e,t){return!0},t.prototype.add=t.prototype.insert,t.prototype["delete"]=function(e){this.arr.splice(e,1)},t.prototype.remove=t.prototype["delete"],t.prototype.massRemove=function(e,t){this.arr.splice(e,t)},t.compare={number:function(e,t){var n=e-t;return n>0?1:n==0?0:-1},string:function(e,t){return e>t?1:e==t?0:-1}},t.prototype.compare=t.compare.number,e.SortedList=t})(t&&t.exports||this)},{}],19:[function(e,t,n){var r=e("../../../underscore.min.js");t.exports.floorHack=function(e){return(e<<0)-(e<0?1:0)};var s=t.exports.strip=function(e){return e.replace(/^\s+|\s+$/g,"")};t.exports.parseInt10=function(e){return parseInt(e,10)},t.exports.deepClone=function(e){return JSON.parse(JSON.stringify(e))};var o=t.exports.defaultNameFunc=function(e){return s(e.name||e.id||"")};t.exports.shortHash=function(e){var t=0;if(e.length==0)return t;for(i=0;i<e.length;i++)chr=e.charCodeAt(i),t=(t<<5)-t+chr,t&=t;return t},t.exports.parseDeclarationLine=function(e,t){function u(e){o="optname",n[r.replace(/^\s+|\s+$/g,"")]=s,r=s=""}var n={},r="",s="",o="optname";for(i=e.match(t)[0].length;i<e.length;i++)c=e[i],o=="optname"?c=="="?o="startvalue":r+=c:o=="startvalue"?/'|"/.test(c)?o=c:(s+=c,o="value"):o=="value"?/\s/.test(c)?u():s+=c:/'|"/.test(o)&&(c==o?u(o):s+=c);return o=="value"&&u(),o!="optname"?!1:n},t.exports.pixIntervalCalculator=function(e,t,n,i,s,u,a){return r.isFunction(s)||(s=o),r.isUndefined(u)&&(u="start"),r.isUndefined(a)&&(a="end"),function(o){var f=r.isUndefined(o[u])?o.start:o[u],l=r.isUndefined(o[a])?o.end:o[a],c={x:Math.round((f-e)/n),w:(l-f)/n,t:0,oPrev:!1,ox:0,oNext:!1,ow:0};return c.w=c.w>0&&c.w<1?1:Math.round(c.w),c.tx=c.x,c.tw=c.w,c.x<0?(c.w+=c.x,c.ox=c.x,c.x=0,c.oPrev=!0):i&&(c.t=r.isNumber(i)?i:Math.min(s(o).length*10+2,c.x),c.tx-=c.t,c.tw+=c.t),c.x+c.w>t&&(c.ow=c.w-t+c.x,c.w-=c.ow,c.oNext=!0),c}},t.exports.pixIntervalOverlap=function(e,t){var n={ox:0},r;return e.x>t.x&&(r=t,t=e,e=r),!e.w||!t.w||e.x+e.w<t.x?null:(n.x=t.x,n.ox=Math.max(e.ox,t.ox),n.w=Math.min(e.w-t.x+e.x,t.w),n)},t.exports.guessChrScheme=function(e){return limit=Math.min(e.length*.8,20),r.filter(e,function(e){return/^chr/.test(e)}).length>limit?"ucsc":r.filter(e,function(e){return/^\d\d?$/.test(e)}).length>limit?"ensembl":null},t.exports.wigBinFunctions={minimum:function(e){return e.length?Math.min.apply(Math,e):0},mean:function(e){return r.reduce(e,function(e,t){return e+t},0)/e.length},maximum:function(e){return e.length?Math.max.apply(Math,e):0}},t.exports.convertUrlTemplateFormat=function(e){var t={$$$$:"%s",$S:"%s","${":"%d","$}":"%d",$T:"%s",$D:"%s"};return r.each(t,function(t,n){e=e.replace(t,n)}),e}},{"../../../underscore.min.js":22}],20:[function(e,t,n){var r=e("./utils/utils.js"),i=r.parseInt10,s=r.floorHack,o=r.guessChrScheme,u=r.shortHash,a=e("./utils/IntervalTree.js").IntervalTree,f=e("./utils/RemoteTrack.js").RemoteTrack,l={defaults:{priority:100,drawLimit:{squish:1e3,pack:200},optimalFetchWindow:0,maxFetchWindow:0,chromosomes:"",convertChrScheme:"auto"},init:function(){if(!this.opts.bigDataUrl)throw new Error("Required parameter bigDataUrl not found for vcfTabix track at "+JSON.stringify(this.opts)+(this.opts.lineNum+1));this.browserChrScheme=o(_.keys(this.browserOpts.chrPos))},applyOpts:function(){var e=this,t=this.opts;this.syncProps(["opts"])},parseLine:function(e){var t=e.split("	"),n=t[0],r=this.opts,s={},o={};switch(r.convertChrScheme=="auto"?this.data.info.convertChrScheme:r.convertChrScheme){case"ucsc_ensembl":n=n.replace(/^chr/,"");break;case"ensembl_ucsc":n=(/^(\d\d?|X)$/.test(n)?"chr":"")+n}t[7]&&_.each(t[7].split(";"),function(e){e=e.split("="),e.length>1&&(o[e[0]]=e[1])}),s.start=this.browserOpts.chrPos[n]+i(t[1]),s.id=t[2],s.end=s.start+1,s.ref=t[3],s.alt=t[4],s.qual=parseFloat(t[5]),s.info=o;if(s.id=="."||s.id=="")s.id=[n,t[1],s.ref,s.alt,u(t[7])].join("	");return s},parse:function(e){var t=this,n=t.browserOpts.genomeSize/2,r=new a(s(n),{startKey:"start",endKey:"end"}),i=t.ajaxDir()+"tabix.php?"+$.param({url:t.opts.bigDataUrl}),o;return o=new f(r,function(e,n,r){var s=t.opts,o=t.chrRange(e,n).join(" ");switch(s.convertChrScheme=="auto"?t.data.info.convertChrScheme:s.convertChrScheme){case"ensembl_ucsc":o=_.map(o,function(e){return e.replace(/^chr/,"")});break;case"ucsc_ensembl":o=_.map(o,function(e){return e.replace(/^(\d\d?|X):/,"chr$1:")})}$.ajax(i,{type:o.length>500?"POST"
:"GET",data:{range:o},success:function(e){var n=_.filter(e.split("\n"),function(e){var t=e.match(/\t/g);return t&&t.length>=2}),i=_.map(n,function(e){var n=t.type().parseLine.call(t,e);return n});r(i)}})}),t.data={cache:r,remote:o,info:{}},t.heights={max:null,min:15,start:15},t.sizes=["dense","squish","pack"],t.mapSizes=["pack"],!0},finishSetup:function(){var e=this,t=e.ajaxDir()+"tabix.php",n=1e5,r=e.chrRange(Math.round(e.browserOpts.pos),Math.round(e.browserOpts.pos+n)).join(" "),i=e.data.remote;$.ajax(t,{data:{info:3,range:r,url:e.opts.bigDataUrl},success:function(t){var r=e.opts,s=t.split("\n\n"),u=s[0].split("\n"),a;if(s[0]==""||s.length==1)throw new Error("tabix failed to retrieve data for this track.");e.data.info.chrScheme=chrScheme=o(u),chrScheme&&e.browserChrScheme&&(e.data.info.convertChrScheme=chrScheme!=e.browserChrScheme?chrScheme+"_"+e.browserChrScheme:null),a=s[1];if(!r.maxFetchWindow){var f=a.length/n,l=_.max(_.values(r.drawLimit));r.maxFetchWindow=l/f,r.optimalFetchWindow=Math.floor(r.maxFetchWindow/3)}e.type().applyOpts.call(e),i.setupBins(e.browserOpts.genomeSize,r.optimalFetchWindow,r.maxFetchWindow)}})},prerender:function(e,t,n,i,s){function l(e,t){var r=f+"_"+n;return _.isUndefined(t)?e.line&&e.line[r]:(e.line||(e.line={}),e.line[r]=t)}function c(e){var t=e.ref||"",n=e.alt||"";return(t.length>n.length?t:n)||""}var o=this,u=i.width,a=o.data,f=(t-e)/u;o.opts.maxFetchWindow>0&&t-e>o.opts.maxFetchWindow?s({tooMany:!0}):o.data.remote.fetchAsync(e,t,function(t){var i,a=[];if(t.tooMany)return s(t);i=new r.pixIntervalCalculator(e,u,f,n=="pack",c),n=="dense"?_.each(t,function(e){a.push(i(e.data))}):(a={layout:o.type("bed").stackedLayout.call(o,t,u,i)},a.width=u),s(a)})},render:function(e,t,n,r,i){var s=e.getContext,o=this.opts.url?this.opts.url:'javascript:void("'+this.opts.name+':$$")',u=r=="pack"?27:6,a={a:"255,0,0",t:"255,0,255",c:"0,0,255",g:"0,255,0",other:"114,41,218"},f=this.opts.drawLimit&&this.opts.drawLimit[r],l=null;if(!s)throw"Canvas not supported";r=="pack"&&!this.areas[e.id]&&(l=this.areas[e.id]=[]),this.prerender(t,n,r,{width:e.unscaledWidth()},function(t){f&&t.length>f||t.tooMany?(e.unscaledHeight(0),e.className=e.className+" too-many"):r=="dense"?(e.unscaledHeight(15),s=e.getContext("2d"),s.fillStyle="rgb(0,0,0)",_.each(t,function(e){s.fillRect(e.x,1,e.w,13)})):(e.unscaledHeight(Math.max(t.layout.length*u,1)),s=e.getContext("2d"),_.each(t.layout,function(e,t){_.each(e,function(e){var n,i;r=="pack"&&(i=a[e.d.ref.toLowerCase()]||a.other,n=a[e.d.alt.toLowerCase()]||a.other,s.fillStyle="rgb("+n+")"),s.fillRect(e.pInt.x,t*u+1,e.pInt.w,u-1),l&&l.push([e.pInt.x,t*u+1,e.pInt.x+e.pInt.w,(t+1)*u,e.d.ref+" > "+e.d.alt,o.replace("$$",e.d.id),e.pInt.oPrev,n,e.d.ref+"["+i+"]"+"\n"+e.d.alt,e.d.info])})})),_.isFunction(i)&&i()})}};t.exports=l},{"./utils/IntervalTree.js":14,"./utils/RemoteTrack.js":17,"./utils/utils.js":19}],21:[function(e,t,n){(function(n){var r=e("./utils/utils.js"),i=r.parseInt10,s=r.parseDeclarationLine,o=e("./utils/SortedList.js").SortedList,u={defaults:{altColor:"",priority:100,autoScale:"on",alwaysZero:"off",gridDefault:"off",maxHeightPixels:"128:128:15",graphType:"bar",viewLimits:"",yLineMark:0,yLineOnOff:"off",windowingFunction:"maximum",smoothingWindow:"off"},init:function(){this.type().initOpts.call(this)},_binFunctions:r.wigBinFunctions,initOpts:function(){var e=this.opts,t=this.type()._binFunctions,n;this.validateColor(e.altColor)||(e.altColor=""),e.viewLimits=_.map(e.viewLimits.split(":"),parseFloat),n=e.viewLimits.length>=2&&!_.isNaN(e.viewLimits[0])&&!_.isNaN(e.viewLimits[1]),e.maxHeightPixels=_.map(e.maxHeightPixels.split(":"),i),e.yLineOnOff=this.isOn(e.yLineOnOff),e.yLineMark=parseFloat(e.yLineMark),e.autoScale=n?!1:this.isOn(e.autoScale),e.windowingFunction=e.windowingFunction.toLowerCase(),e.windowingFunction=="mean+whiskers"&&(e.windowingFunction="mean",console.warn("FIXME: mean+whiskers --> mean"));if(t&&!t[e.windowingFunction])throw new Error("invalid windowingFunction `"+e.windowingFunction+"` at line "+e.lineNum);_.isNaN(e.yLineMark)&&(e.yLineMark=0)},applyOpts:function(){var e=this,t=e.opts;e.drawRange=t.autoScale||t.viewLimits.length<2?e.range:t.viewLimits,_.each({max:0,min:2,start:1},function(n,r){e.heights[r]=t.maxHeightPixels[n]}),e.scales={_all:[{limits:e.drawRange,top:0,bottom:0}]},t.yLineOnOff&&(e.scales._all[0].yLine=t.yLineMark);if(!t.altColor){var n=this.rgbToHsl.apply(this,t.color.split(/,\s*/g));n[0]=n[0]+.02,n[1]=n[1]*.7,n[2]=1-(1-n[2])*.7,e.altColor=_.map(this.hslToRgb.apply(this,n),i).join(",")}},parse:function(e){var t=this,n=this.browserOpts.genomeSize,r={all:[]},o,u,a,f;return t.range=t.isOn(this.opts.alwaysZero)?[0,0]:[Infinity,-Infinity],_.each(e,function(e,n){var l,c;f=e.match(/^(variable|fixed)Step\s+/i);if(f){o=f[1].toLowerCase(),u=s(e,/^(variable|fixed)Step\s+/i),u.start=i(u.start);if(o=="fixed"&&(_.isNaN(u.start)||!u.start))throw new Error("fixedStep at line "+(n+1+t.opts.lineNum)+" require non-zero start parameter");u.step=i(u.step);if(o=="fixed"&&(_.isNaN(u.step)||!u.step))throw new Error("fixedStep at line "+(n+1+t.opts.lineNum)+" require non-zero step parameter");u.span=i(u.span)||1,a=t.browserOpts.chrPos[u.chrom],_.isUndefined(a)&&t.warn("Invalid chromosome at line "+(n+1+t.opts.lineNum))}else{if(!o)throw new Error("Wiggle format at "+(n+1+t.opts.lineNum)+" has no preceding mode declaration");if(!_.isUndefined(a))if(o=="fixed")l=parseFloat(e),r.all.push({start:a+u.start,end:a+u.start+u.span,val:l}),u.start+=u.step;else{e=e.split(/\s+/);if(e.length<2)throw new Error("variableStep at line "+(n+1+t.opts.lineNum)+" requires two values per line");c=i(e[0]),l=parseFloat(e[1]),r.all.push({start:a+c,end:a+c+u.span,val:l})}}}),t.type().finishParse.call(t,r)},finishParse:function(e){var t=this,r=t.type()._binFunctions[t.opts.windowingFunction];return e.all.length>0&&(t.range[0]=_.min(e.all,function(e){return e.val}).val,t.range[1]=_.max(e.all,function(e){return e.val}).val),e.all=new o(e.all,{compare:function(e,t){if(e===null)return-1;if(t===null)return 1;var n=e.start-t.start;return n>0?1:n===0?0:-1}}),_.each(t.browserOpts.bppps,function(i){if(t.browserOpts.genomeSize/i>1e6)return;var s=Math.ceil(t.browserOpts.genomeSize/i),o=e[i]=n.Float32Array?new Float32Array(s):new Array(s),u=0,a=e.all.get(0),f,l;for(var c=0;c<s;c++){f=a&&a.start<=c*i&&a.end>c*i?[a.val]:[];while((l=e.all.get(u+1))&&l.start<(c+1)*i&&l.end>c*i)f.push(l.val),++u,a=l;o[c]=r(f)}e._binFunction=t.opts.windowingFunction}),t.data=e,t.stretchHeight=!0,t.type("wiggle_0").applyOpts.apply(t),!0},initDrawSpec:function(e){var t=this.drawRange[1]-this.drawRange[0],n={bars:[],vScale:t,yLine:this.isOn(this.opts.yLineOnOff)?Math.round((this.opts.yLineMark-this.drawRange[0])/t):null,zeroLine:-this.drawRange[0]/t};return n},prerender:function(e,t,n,r,i){var s=this,o=(t-e)/r.width,u=s.type().initDrawSpec.call(s,r),a=s.type()._binFunctions[s.opts.windowingFunction],f;if(s.data._binFunction==s.opts.windowingFunction&&(f=s.data[o]))u.bars=_.map(_.range((e-1)/o,(t-1)/o),function(e,t){return((f[e]||0)-s.drawRange[0])/u.vScale});else{var l=s.data.all.bsearch({start:e}),c=s.data.all.get(l),h,p;for(var d=0;d<r.width;d++){p=c&&c.end>=d*o+e?[c.val]:[];while((h=s.data.all.get(l+1))&&h.start<(d+1)*o+e&&h.end>=d*o+e)p.push(h.val),++l,c=h;u.bars.push((a(p)-s.drawRange[0])/u.vScale)}}return _.isFunction(i)?i(u):u},drawBars:function(e,t,n,r){var i=t.zeroLine*n,s="rgb("+this.opts.color+")",o="rgb("+(this.opts.altColor||this.altColor)+")",u=this.opts.graphType==="points";e.fillStyle=s,_.each(t.bars,function(t,r){var a=t*n;if(t===null)return;a>i?u?e.fillRect(r,n-a,1,1):e.fillRect(r,n-a,1,i>0?a-i:a):(e.fillStyle=o,u?e.fillRect(r,i-a-1,1,1):e.fillRect(r,n-i,1,i-a),e.fillStyle=s)}),t.yLine!==null&&(e.fillStyle="rgb(0,0,0)",e.fillRect(0,n-t.yLine,r,1))},render:function(e,t,n,r,i){var s=this,o=e.unscaledWidth(),u=e.getContext&&e.getContext("2d");if(!u)throw"Canvas not supported";s.prerender(t,n,r,{width:o},function(t){s.type().drawBars.call(s,u,t,e.unscaledHeight(),o),_.isFunction(i)&&i()})},loadOpts:function(e){var t=this.opts,n=e.find(".view-limits"),r=e.find(".max-height-pixels"),i=this.validateColor(t.altColor);e.find("[name=altColorOn]").attr("checked",i).change(),e.find("[name=altColor]").val(i?t.altColor:"128,128,128").change(),e.find("[name=autoScale]").attr("checked",!this.isOn(t.autoScale)).change(),n.slider("option","min",this.range[0]),n.slider("option","max",this.range[1]),e.find("[name=viewLimitsMin]").val(this.drawRange[0]).change(),e.find("[name=viewLimitsMax]").val(this.drawRange[1]).change(),e.find("[name=yLineOnOff]").attr("checked",this.isOn(t.yLineOnOff)).change(),e.find("[name=yLineMark]").val(t.yLineMark).change(),e.find("[name=graphType]").val(t.graphType).change(),e.find("[name=windowingFunction]").val(t.windowingFunction).change(),e.find("[name=maxHeightPixelsOn]").attr("checked",t.maxHeightPixels.length>=3),e.find("[name=maxHeightPixelsMin]").val(t.maxHeightPixels[2]).change(),e.find("[name=maxHeightPixelsMax]").val(t.maxHeightPixels[0]).change()},saveOpts:function(e){var t=this.opts,n=e.find("[name=altColorOn]").is(":checked"),r=e.find("[name=maxHeightPixelsOn]").is(":checked"),i=e.find("[name=maxHeightPixelsMax]").val();t.altColor=n?e.find("[name=altColor]").val():"",t.autoScale=!e.find("[name=autoScale]").is(":checked"),t.viewLimits=e.find("[name=viewLimitsMin]").val()+":"+e.find("[name=viewLimitsMax]").val(),t.yLineOnOff=e.find("[name=yLineOnOff]").is(":checked"),t.yLineMark=e.find("[name=yLineMark]").val(),t.graphType=e.find("[name=graphType]").val(),t.windowingFunction=e.find("[name=windowingFunction]").val(),t.maxHeightPixels=r?[i,i,e.find("[name=maxHeightPixelsMin]").val()].join(":"):"",this.type("wiggle_0").initOpts.call(this)}};t.exports=u}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./utils/SortedList.js":18,"./utils/utils.js":19}],22:[function(e,t,n){(function(){function e(e){function t(t,n,r,i,s,o){for(;s>=0&&o>s;s+=e){var u=i?i[s]:s;r=n(r,t[u],u,t)}return r}return function(n,r,i,s){r=E(r,s,4);var o=!L(n)&&w.keys(n),u=(o||n).length,a=e>0?0:u-1;return arguments.length<3&&(i=n[o?o[a]:a],a+=e),t(n,r,i,o,a,u)}}function r(e){return function(t,n,r){n=S(n,r);for(var i=k(t),s=e>0?0:i-1;s>=0&&i>s;s+=e)if(n(t[s],s,t))return s;return-1}}function i(e,t,n){return function(r,i,s){var o=0,u=k(r);if("number"==typeof s)e>0?o=s>=0?s:Math.max(s+u,o):u=s>=0?Math.min(s+1,u):s+u+1;else if(n&&s&&u)return s=n(r,i),r[s]===i?s:-1;if(i!==i)return s=t(h.call(r,o,u),w.isNaN),s>=0?s+o:-1;for(s=e>0?o:u-1;s>=0&&u>s;s+=e)if(r[s]===i)return s;return-1}}function s(e,t){var n=D.length,r=e.constructor,i=w.isFunction(r)&&r.prototype||f,s="constructor";for(w.has(e,s)&&!w.contains(t,s)&&t.push(s);n--;)s=D[n],s in e&&e[s]!==i[s]&&!w.contains(t,s)&&t.push(s)}var o=this,u=o._,a=Array.prototype,f=Object.prototype,l=Function.prototype,c=a.push,h=a.slice,p=f.toString,d=f.hasOwnProperty,v=Array.isArray,m=Object.keys,g=l.bind,y=Object.create,b=function(){},w=function(e){return e instanceof w?e:this instanceof w?void (this._wrapped=e):new w(e)};"undefined"!=typeof n?("undefined"!=typeof t&&t.exports&&(n=t.exports=w),n._=w):o._=w,w.VERSION="1.8.3";var E=function(e,t,n){if(t===void 0)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}},S=function(e,t,n){return null==e?w.identity:w.isFunction(e)?E(e,t,n):w.isObject(e)?w.matcher(e):w.property(e)};w.iteratee=function(e,t){return S(e,t,1/0)};var x=function(e,t){return function(n){var r=arguments.length;if(2>r||null==n)return n;for(var i=1;r>i;i++)for(var s=arguments[i],o=e(s),u=o.length,a=0;u>a;a++){var f=o[a];t&&n[f]!==void 0||(n[f]=s[f])}return n}},T=function(e){if(!w.isObject(e))return{};if(y)return y(e);b.prototype=e;var t=new b;return b.prototype=null,t},N=function(e){return function(t){return null==t?void 0:t[e]}},C=Math.pow(2,53)-1,k=N("length"),L=function(e){var t=k(e);return"number"==typeof t&&t>=0&&C>=t};w.each=w.forEach=function(e,t,n){t=E(t,n);var r,i;if(L(e))for(r=0,i=e.length;i>r;r++)t(e[r],r,e);else{var s=w.keys(e);for(r=0,i=s.length;i>r;r++)t(e[s[r]],s[r],e)}return e},w.map=w.collect=function(e,t,n){t=S(t,n);for(var r=!L(e)&&w.keys(e),i=(r||e).length,s=Array(i),o=0;i>o;o++){var u=r?r[o]:o;s[o]=t(e[u],u,e)}return s},w.reduce=w.foldl=w.inject=e(1),w.reduceRight=w.foldr=e(-1),w.find=w.detect=function(e,t,n){var r;return r=L(e)?w.findIndex(e,t,n):w.findKey(e,t,n),r!==void 0&&r!==-1?e[r]:void 0},w.filter=w.select=function(e,t,n){var r=[];return t=S(t,n),w.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},w.reject=function(e,t,n){return w.filter(e,w.negate(S(t)),n)},w.every=w.all=function(e,t,n){t=S(t,n);for(var r=!L(e)&&w.keys(e),i=(r||e).length,s=0;i>s;s++){var o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0},w.some=w.any=function(e,t,n){t=S(t,n);for(var r=!L(e)&&w.keys(e),i=(r||e).length,s=0;i>s;s++){var o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1},w.contains=w.includes=w.include=function(e,t,n,r){return L(e)||(e=w.values(e)),("number"!=typeof n||r)&&(n=0),w.indexOf(e,t,n)>=0},w.invoke=function(e,t){var n=h.call(arguments,2),r=w.isFunction(t);return w.map(e,function(e){var i=r?t:e[t];return null==i?i:i.apply(e,n)})},w.pluck=function(e,t){return w.map(e,w.property(t))},w.where=function(e,t){return w.filter(e,w.matcher(t))},w.findWhere=function(e,t){return w.find(e,w.matcher(t))},w.max=function(e,t,n){var r,i,s=-1/0,o=-1/0;if(null==t&&null!=e){e=L(e)?e:w.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],r>s&&(s=r)}else t=S(t,n),w.each(e,function(e,n,r){i=t(e,n,r),(i>o||i===-1/0&&s===-1/0)&&(s=e,o=i)});return s},w.min=function(e,t,n){var r,i,s=1/0,o=1/0;if(null==t&&null!=e){e=L(e)?e:w.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],s>r&&(s=r)}else t=S(t,n),w.each(e,function(e,n,r){i=t(e,n,r),(o>i||1/0===i&&1/0===s)&&(s=e,o=i)});return s},w.shuffle=function(e){for(var t,n=L(e)?e:w.values(e),r=n.length,i=Array(r),s=0;r>s;s++)t=w.random(0,s),t!==s&&(i[s]=i[t]),i[t]=n[s];return i},w.sample=function(e,t,n){return null==t||n?(L(e)||(e=w.values(e)),e[w.random(e.length-1)]):w.shuffle(e).slice(0,Math.max(0,t))},w.sortBy=function(e,t,n){return t=S(t,n),w.pluck(w.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index-t.index}),"value")};var A=function(e){return function(t,n,r){var i={};return n=S(n,r),w.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};w.groupBy=A(function(e,t,n){w.has(e,n)?e[n].push(t):e[n]=[t]}),w.indexBy=A(function(e,t,n){e[n]=t}),w.countBy=A(function(e,t,n){w.has(e,n)?e[n]++:e[n]=1}),w.toArray=function(e){return e?w.isArray(e)?h.call(e):L(e)?w.map(e,w.identity):w.values(e):[]},w.size=function(e){return null==e?0:L(e)?e.length:w.keys(e).length},w.partition=function(e,t,n){t=S(t,n);var r=[],i=[];return w.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},w.first=w.head=w.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:w.initial(e,e.length-t)},w.initial=function(e,t,n){return h.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},w.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:w.rest(e,Math.max(0,e.length-t))},w.rest=w.tail=w.drop=function(e,t,n){return h.call(e,null==t||n?1:t)},w.compact=function(e){return w.filter(e,w.identity)};var O=function(e,t,n,r){for(var i=[],s=0,o=r||0,u=k(e);u>o;o++){var a=e[o];if(L(a)&&(w.isArray(a)||w.isArguments(a))){t||(a=O(a,t,n));var f=0,l=a.length;for(i.length+=l;l>f;)i[s++]=a[f++]}else n||(i[s++]=a)}return i};w.flatten=function(e,t){return O(e,t,!1)},w.without=function(e){return w.difference(e,h.call(arguments,1))},w.uniq=w.unique=function(e,t,n,r){w.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=S(n,r));for(var i=[],s=[],o=0,u=k(e);u>o;o++){var a=e[o],f=n?n(a,o,e):a;t?(o&&s===f||i.push(a),s=f):n?w.contains(s,f)||(s.push(f),i.push(a)):w.contains(i,a)||i.push(a)}return i},w.union=function(){return w.uniq(O(arguments,!0,!0))},w.intersection=function(e){for(var t=[],n=arguments.length,r=0,i=k(e);i>r;r++){var s=e[r];if(!w.contains(t,s)){for(var o=1;n>o&&w.contains(arguments[o],s);o++);o===n&&t.push(s)}}return t},w.difference=function(e){var t=O(arguments,!0,!0,1);return w.filter(e,function(e){return!w.contains(t,e)})},w.zip=function(){return w.unzip(arguments)},w.unzip=function(e){for(var t=e&&w.max(e,k).length||0,n=Array(t),r=0;t>r;r++)n[r]=w.pluck(e,r);return n},w.object=function(e,t){for(var n={},r=0,i=k(e);i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},w.findIndex=r(1),w.findLastIndex=r(-1),w.sortedIndex=function(e,t,n,r){n=S(n,r,1);for(var i=n(t),s=0,o=k(e);o>s;){var u=Math.floor((s+o)/2);n(e[u])<i?s=u+1:o=u}return s},w.indexOf=i(1,w.findIndex,w.sortedIndex),w.lastIndexOf=i(-1,w.findLastIndex),w.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),s=0;r>s;s++,e+=n)i[s]=e;return i};var M=function(e,t,n,r,i){if(r instanceof t){var s=T(e.prototype),o=e.apply(s,i);return w.isObject(o)?o:s}return e.apply(n,i)};w.bind=function(e,t){if(g&&e.bind===g)return g.apply(e,h.call(arguments,1));if(!w.isFunction(e))throw new TypeError("Bind must be called on a function");var n=h.call(arguments,2),r=function(){return M(e,r,t,this,n.concat(h.call(arguments)))};return r},w.partial=function(e){var t=h.call(arguments,1),n=function(){for(var r=0,i=t.length,s=Array(i),o=0;i>o;o++)s[o]=t[o]===w?arguments[r++]:t[o];for(;r<arguments.length;)s.push(arguments[r++]);return M(e,n,this,this,s)};return n},w.bindAll=function(e){var t,n,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(t=1;r>t;t++)n=arguments[t],e[n]=w.bind(e[n],e);return e},w.memoize=function(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return w.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},w.delay=function(e,t){var n=h.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},w.defer=w.partial(w.delay,w,1),w.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:w.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=w.now();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l||l>t?(o&&(clearTimeout(o),o=null),u=f,s=e.apply(r,i),o||(r=i=null)):o||n.trailing===!1||(o=setTimeout(a,l)),s}},w.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=w.now()-o;t>f&&f>=0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=w.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},w.wrap=function(e,t){return w.partial(t,e)},w.negate=function(e){return function(){return!e.apply(this,arguments)}},w.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},w.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},w.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),1>=e&&(t=null),n}},w.once=w.partial(w.before,2);var _=!{toString:null}.propertyIsEnumerable("toString"),D=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];w.keys=function(e){if(!w.isObject(e))return[];if(m)return m(e);var t=[];for(var n in e)w.has(e,n)&&t.push(n);return _&&s(e,t),t},w.allKeys=function(e){if(!w.isObject(e))return[];var t=[];for(var n in e)t.push(n);return _&&s(e,t),t},w.values=function(e){for(var t=w.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},w.mapObject=function(e,t,n){t=S(t,n);for(var r,i=w.keys(e),s=i.length,o={},u=0;s>u;u++)r=i[u],o[r]=t(e[r],r,e);return o},w.pairs=function(e){for(var t=w.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},w.invert=function(e){for(var t={},n=w.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},w.functions=w.methods=function(e){var t=[];for(var n in e)w.isFunction(e[n])&&t.push(n);return t.sort()},w.extend=x(w.allKeys),w.extendOwn=w.assign=x(w.keys),w.findKey=function(e,t,n){t=S(t,n);for(var r,i=w.keys(e),s=0,o=i.length;o>s;s++)if(r=i[s],t(e[r],r,e))return r},w.pick=function(e,t,n){var r,i,s={},o=e;if(null==o)return s;w.isFunction(t)?(i=w.allKeys(o),r=E(t,n)):(i=O(arguments,!1,!1,1),r=function(e,t,n){return t in n},o=Object(o));for(var u=0,a=i.length;a>u;u++){var f=i[u],l=o[f];r(l,f,o)&&(s[f]=l)}return s},w.omit=function(e,t,n){if(w.isFunction(t))t=w.negate(t);else{var r=w.map(O(arguments,!1,!1,1),String);t=function(e,t){return!w.contains(r,t)}}return w.pick(e,t,n)},w.defaults=x(w.allKeys,!0),w.create=function(e,t){var n=T(e);return t&&w.extendOwn(n,t),n},w.clone=function(e){return w.isObject(e)?w.isArray(e)?e.slice():w.extend({},e):e},w.tap=function(e,t){return t(e),e},w.isMatch=function(e,t){var n=w.keys(t),r=n.length;if(null==e)return!r;for(var i=Object(e),s=0;r>s;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0};var P=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof w&&(e=e._wrapped),t instanceof w&&(t=t._wrapped);var i=p.call(e);if(i!==p.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var s="[object Array]"===i;if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,u=t.constructor;if(o!==u&&!(w.isFunction(o)&&o instanceof o&&w.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var a=n.length;a--;)if(n[a]===e)return r[a]===t;if(n.push(e),r.push(t),s){if(a=e.length,a!==t.length)return!1;for(;a--;)if(!P(e[a],t[a],n,r))return!1}else{var f,l=w.keys(e);if(a=l.length,w.keys(t).length!==a)return!1;for(;a--;)if(f=l[a],!w.has(t,f)||!P(e[f],t[f],n,r))return!1}return n.pop(),r.pop(),!0};w.isEqual=function(e,t){return P(e,t)},w.isEmpty=function(e){return null==e?!0:L(e)&&(w.isArray(e)||w.isString(e)||w.isArguments(e))?0===e.length:0===w.keys(e).length},w.isElement=function(e){return!!e&&1===e.nodeType},w.isArray=v||function(e){return"[object Array]"===p.call(e)},w.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},w.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){w["is"+e]=function(t){return p.call(t)==="[object "+e+"]"}}),w.isArguments(arguments)||(w.isArguments=function(e){return w.has(e,"callee")}),"function"!=typeof /./&&"object"!=typeof Int8Array&&(w.isFunction=function(e){return"function"==typeof e||!1}),w.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},w.isNaN=function(e){return w.isNumber(e)&&e!==+e},w.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===p.call(e)},w.isNull=function(e){return null===e},w.isUndefined=function(e){return e===void 0},w.has=function(e,t){return null!=e&&d.call(e,t)},w.noConflict=function(){return o._=u,this},w.identity=function(e){return e},w.constant=function(e){return function(){return e}},w.noop=function(){},w.property=N,w.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},w.matcher=w.matches=function(e){return e=w.extendOwn({},e),function(t){return w.isMatch(t,e)}},w.times=function(e,t,n){var r=Array(Math.max(0,e));t=E(t,n,1);for(var i=0;e>i;i++)r[i]=t(i);return r},w.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},w.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},B=w.invert(H),j=function(e){var t=function(t){return e[t]},n="(?:"+w.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};w.escape=j(H),w.unescape=j(B),w.result=function(e,t,n){var r=null==e?void 0:e[t];return r===void 0&&(r=n),w.isFunction(r)?r.call(e):r};var F=0;w.uniqueId=function(e){var t=++F+"";return e?e+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,q={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},R=/\\|'|\r|\n|\u2028|\u2029/g,U=function(e){return"\\"+q[e]};w.template=function(e,t,n){!t&&n&&(t=n),t=w.defaults({},t,w.templateSettings);var r=RegExp([(t.escape||I).source,(t.interpolate||I).source,(t.evaluate||I).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(R,U),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,w)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},w.chain=function(e){var t=w(e);return t._chain=!0,t};var z=function(e,t){return e._chain?w(t).chain():t};w.mixin=function(e){w.each(w.functions(e),function(t){var n=w[t]=e[t];w.prototype[t]=function(){var e=[this._wrapped];return c.apply(e,arguments),z(this,n.apply(w,e))}})},w.mixin(w),w.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=a[e];w.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],z(this,n)}}),w.each(["concat","join","slice"],function(e){var t=a[e];w.prototype[e]=function(){return z(this,t.apply(this._wrapped,arguments))}}),w.prototype.value=function(){return this._wrapped},w.prototype.valueOf=w.prototype.toJSON=w.prototype.value,w.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return w})}).call(this)},{}]},{},[2]);