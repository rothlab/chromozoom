(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/***************************************************/
//                                                 //
// Welcome to ChromoZoom!                          //
//                                                 //
// This is the JavaScript entry point which is     //
// built into the final application by browserify  //
//                                                 //
// For information on installing, see ../README.md //
// (c) 2016 Theodore Pak, AGPL, see ../LICENSE     //
//                                                 //
/***************************************************/

require('./jquery.min.js')(window);
var jQuery = window['$'] = window.jQuery;

require('./ui/jquery-ui.min.js')(jQuery);
require('./ui/jquery-ui.touch-punch.js')(jQuery);

window._ = require('./underscore.min.js');

require('./custom/CustomTracks.js')(window);
require('./custom/CustomGenomes.js')(window);

require('./ui/jquery-ui.genobrowser.js')(jQuery);
},{"./custom/CustomGenomes.js":3,"./custom/CustomTracks.js":5,"./jquery.min.js":24,"./ui/jquery-ui.genobrowser.js":25,"./ui/jquery-ui.min.js":28,"./ui/jquery-ui.touch-punch.js":29,"./underscore.min.js":34}],2:[function(require,module,exports){
// ================================================================================================
// = CustomGenome represents a genome specification that can produce options for $.ui.genobrowser =
// ================================================================================================

module.exports = function(global) {

var _ = require('../underscore.min.js');

var utils = require('./genome-formats/utils/utils.js'),
  deepClone = utils.deepClone,
  log10 = utils.log10,
  roundToPlaces = utils.roundToPlaces;

function CustomGenome(givenFormat, metadata) {    
  // givenFormat = false --> this is an empty CustomGenome that will be hydrated with values from a serialized object
  if (givenFormat === false) { return; } 
  
  this._parsed = false;
  this._format = (givenFormat && givenFormat.toLowerCase()) || "chromsizes";
  var format = this.format();
  if (format === null) { throw new Error("Unsupported genome format '"+format+"' encountered"); }
  
  // this.opts holds everything that $.ui.genobrowser will need to construct a view (see CustomGenome.defaults below)
  // it DOES NOT relate to "options" for parsing, or how the genome is being interpreted, or anything like that
  this.opts = _.extend({}, deepClone(this.constructor.defaults), deepClone(format.defaults || {}));
  
  // this.metadata holds information external to the parsed text passed in from the browser (e.g. filename, source)
  this.metadata = metadata;
  
  // this.data holds anything additionally parsed from the genome file (metadata, references, etc.)
  // typically this is arranged per contig, in the arrangement of this.data.contigs[i]. ...
  this.data = {
    sequence: "" // the full concatenated sequence for all contigs in this genome, if available
  };
  
  // can we call .getSequence on this CustomGenome?
  this.canGetSequence = false;
  
  if(format.init) { format.init.call(this); }
}

CustomGenome.defaults = {
  // The following keys should be overridden while parsing the genome file
  genome: '_blank',
  species: 'Blank Genome',
  assemblyDate: '',
  tileDir: null,
  overzoomBppps: [],
  ntsBelow: [1, 0.1],
  availTracks: [
    {
      fh: {},        // "fixed heights" above which a density is forced to display above a certain track height
                     //    formatted like {"1.00e+05":{"dense":15}}
      n: "ruler",    // short unique name for the track
      s: ["dense"],  // possible densities for tiles, e.g. ["dense", "squish", "pack"]
      h: 25          // starting height in px
    }
  ],
  genomeSize: 0,
  chrLengths: {},
  chrOrder: [],
  chrBands: null,
  tileWidth: 1000,
  subdirForBpppsUnder: 330,
  ideogramsAbove: 1000,
  maxNtRequest: 20000,
  tracks: [{n: "ruler"}],
  trackDesc: {
    ruler: {
      cat: "Mapping and Sequencing Tracks",
      sm: "Base Position"
    }
  },
  // These last three will be overridden using knowledge of the window's width
  bppps: [],
  bpppNumbersBelow: [],
  initZoom: null
};

CustomGenome.formats = {
  chromsizes: require('./genome-formats/chromsizes.js'),
  fasta: require('./genome-formats/fasta.js'),
  genbank: require('./genome-formats/genbank.js'),
  embl: null // TODO. Basically genbank with extra columns.
}

CustomGenome.prototype.parse = function() {
  this.format().parse.apply(this, _.toArray(arguments));
  this.setGenomeString();
  this._parsed = true;
};

CustomGenome.prototype.format = function(format) {
  var self = this;
  if (_.isUndefined(format)) { format = self._format; }
  var FormatWrapper = function() { _.extend(this, self.constructor.formats[format]); return this; };
  FormatWrapper.prototype = self;
  return new FormatWrapper();
};

CustomGenome.prototype.setGenomeString = function() {
  var self = this,
    o = self.opts,
    exceptions = ['file', 'igb', 'acc', 'url', 'ucsc'],
    exception = _.find(exceptions, function(v) { return !_.isUndefined(self.metadata[v]); }),
    pieces = [];
  if (exception) { o.genome = exception + ":" + self.metadata[exception]; }
  else {
    pieces = ['custom' + (self.metadata.name ? ':' + self.metadata.name : '')];
    _.each(o.chrOrder, function(chr) {
      pieces.push(chr + ':' + o.chrLengths[chr]);
    });
    o.genome = pieces.join('|');
  }
};

// Some of the options for $.ui.genobrowser (all r/t zoom levels) must be set based on the width of the window
//   They are .bppps, .bpppNumbersBelow, and .initZoom
//   They do not affect any of the other options set during parsing.
//
// windowOpts MUST include a property, .width, that is the window.innerWidth
CustomGenome.prototype.setBppps = function(windowOpts) {
  windowOpts = windowOpts || {};
  
  var o = this.opts,
    windowWidth = (windowOpts.width * 0.6) || 1000,
    bppp = Math.round(o.genomeSize / windowWidth),
    lowestBppp = windowOpts.lowestBppp || 0.1,
    maxBppps = 100,
    bppps = [], i = 0, log;
  
  // comparable to part of UCSCClient#make_config in lib/ucsc_stitch.rb
  while (bppp >= lowestBppp && i < maxBppps) {
    bppps.push(bppp);
    log = roundToPlaces(log10(bppp), 4);
    bppp = (Math.ceil(log) - log < 0.481) ? 3.3 * Math.pow(10, Math.ceil(log) - 1) : Math.pow(10, Math.floor(log));
    i++;
  }
  o.bppps = bppps;
  o.bpppNumbersBelow = bppps.slice(0, 2);
  o.initZoom = bppps[0];
};

// Construct a complete configuration for $.ui.genobrowser based on the information parsed from the genome file
// which should be mostly in this.opts, excepting those related to zoom levels, which can be set now.
// (see CustomGenome.defaults above for what a base configuration looks like)
//
// windowOpts MUST include include the property .width which is the window.innerWidth
CustomGenome.prototype.options = function(windowOpts) {
  if (!this._parsed) { throw "Cannot generate options before parsing the genome file"; }
  this.setBppps(windowOpts);
  this.opts.custom = this;   // same convention as custom tracks in self.availTracks in chromozoom.js
  return this.opts;
};

// Fetch the sequence, if available, between left and right, and optionally pass it to the callback.
CustomGenome.prototype.getSequence = function(left, right, callback) {
  var seq = this.data.sequence.substring(left - 1, right - 1);
  return _.isFunction(callback) ? callback(seq) : seq; 
};

CustomGenome.prototype.getSequenceAsync = function() {
  global.CustomGenomes.async(this, 'getSequence', arguments, [this.id]);
};

return CustomGenome;

};
},{"../underscore.min.js":34,"./genome-formats/chromsizes.js":6,"./genome-formats/fasta.js":7,"./genome-formats/genbank.js":8,"./genome-formats/utils/utils.js":9}],3:[function(require,module,exports){
module.exports = (function(global){
  
  var _ = require('../underscore.min.js');
  if (!global.CustomTracks) { require('./CustomTracks.js')(global); }
  
  // The class that represents a singular custom genome object
  var CustomGenome = require('./CustomGenome')(global);
  
  // ================================================================
  // = CustomGenomes, the module exported to the global environment =
  // ================================================================
  //
  // Broadly speaking this is a factory for CustomGenome objects that can delegate the
  // work of parsing to a Web Worker thread.
  
  var CustomGenomes = {
    parse: function(text, metadata) {
      metadata = metadata || {};
      if (!metadata.format) { metadata.format = this.guessFormat(text); }
      var genome = new CustomGenome(metadata.format, metadata);
      genome.parse(text);
      return genome;
    },
    
    blank: function() {
      var genome = new CustomGenome("chromsizes", {species: "Blank Genome"});
      genome.parse("blank\t50000");
      return genome;
    },
    
    guessFormat: function(text) {
      if (text.substring(0, 5) == 'LOCUS') { return "genbank"; }
      if (/^[A-Z]{2} {3}/.test(text)) { return "embl"; }
      if (/^[>;]/.test(text)) { return "fasta"; }
      // default is fasta
      return "fasta";
    },
    
    error: function(e) {
      // Can be overridden by a parent library to handle errors more gracefully.
      console.log(e);
    },
    
    _workerScript: 'build/CustomGenomeWorker.js',
    _disableWorkers: false,
    worker: global.CustomTracks.worker,
    
    async: global.CustomTracks.async,
    
    parseAsync: function() {
      this.async(this, 'parse', arguments, [], function(genome) {
        // This has been serialized, so it must be hydrated into a real CustomGenome object.
        // We replace .getSequence() with an asynchronous version.
        return _.extend(new CustomGenome(false), genome, {
          getSequence: function() { CustomGenome.prototype.getSequenceAsync.apply(this, arguments); }
        });
      });
    }
  };
  
  global.CustomGenomes = CustomGenomes;
  
});
},{"../underscore.min.js":34,"./CustomGenome":2,"./CustomTracks.js":5}],4:[function(require,module,exports){
// =============================================================================
// = CustomTrack, an object representing a custom track as understood by UCSC. =
// =============================================================================
//
// This class *does* depend on global objects and therefore must be required as a 
// function that is executed on the global object.

module.exports = function(global) {

var _ = require('../underscore.min.js');

var utils = require('./track-types/utils/utils.js'),
  parseInt10 = utils.parseInt10;

function CustomTrack(opts, browserOpts) {
  if (!opts) { return; } // This is an empty customTrack that will be hydrated with values from a serialized object
  this._type = (opts.type && opts.type.toLowerCase()) || "bed";
  var type = this.type();
  if (type === null) { throw new Error("Unsupported track type '"+opts.type+"' encountered on line " + opts.lineNum); }
  this.opts = _.extend({}, this.constructor.defaults, type.defaults || {}, opts);
  _.extend(this, {
    browserOpts: browserOpts,
    stretchHeight: false,
    heights: {},
    sizes: ['dense'],
    mapSizes: [],
    areas: {},
    noAreaLabels: false,
    expectsSequence: false
  });
  this.init();
}

CustomTrack.defaults = {
  name: 'User Track',
  description: 'User Supplied Track',
  color: '0,0,0'
};

CustomTrack.types = {
  bed: require('./track-types/bed.js'),
  featuretable: require('./track-types/featuretable.js'),
  bedgraph: require('./track-types/bedgraph.js'),
  wiggle_0: require('./track-types/wiggle_0.js'),
  vcftabix: require('./track-types/vcftabix.js'),
  bigbed: require('./track-types/bigbed.js'),
  bam: require('./track-types/bam.js'),
  bigwig: require('./track-types/bigwig.js')
};

// ==========================================================================
// = bedDetail format: https://genome.ucsc.edu/FAQ/FAQformat.html#format1.7 =
// ==========================================================================  

CustomTrack.types.beddetail = _.clone(CustomTrack.types.bed);
CustomTrack.types.beddetail.defaults = _.extend({}, CustomTrack.types.beddetail.defaults, {detail: true});

// These functions branch to different methods depending on the .type() of the track
_.each(['init', 'parse', 'render', 'renderSequence', 'prerender'], function(fn) {
  CustomTrack.prototype[fn] = function() {
    var args = _.toArray(arguments),
      type = this.type();
    if (!type[fn]) { return false; }
    return type[fn].apply(this, args);
  }
});

CustomTrack.prototype.loadOpts = function($dialog) {
  var type = this.type(),
    o = this.opts;
  $dialog.find('.custom-opts-form').hide();
  $dialog.find('.custom-opts-form.'+this._type).show();
  $dialog.find('.custom-name').text(o.name);
  $dialog.find('.custom-desc').text(o.description);
  $dialog.find('.custom-format').text(this._type);
  $dialog.find('[name=color]').val(o.color).change();
  if (type.loadOpts) { type.loadOpts.call(this, $dialog); }
  $dialog.find('.enabler').change();
};

CustomTrack.prototype.saveOpts = function($dialog) {
  var type = this.type(),
    o = this.opts;
  o.color = $dialog.find('[name=color]').val();
  if (!this.validateColor(o.color)) { o.color = '0,0,0'; }
  if (type.saveOpts) { type.saveOpts.call(this, $dialog); }
  this.applyOpts();
  global.CustomTracks.worker() && this.applyOptsAsync(); // Apply the changes to the worker too!
};

CustomTrack.prototype.applyOpts = function(opts) {
  var type = this.type();
  if (opts) { this.opts = opts; }
  if (type.applyOpts) { type.applyOpts.call(this); }
};

CustomTrack.prototype.erase = function(canvas) {
  var self = this,
    ctx = canvas.getContext && canvas.getContext('2d');
  if (ctx) { ctx.clearRect(0, 0, canvas.width, canvas.height); }
}

CustomTrack.prototype.type = function(type) {
  if (_.isUndefined(type)) { type = this._type; }
  return this.constructor.types[type] || null;
};

CustomTrack.prototype.warn = function(warning) {
  if (this.opts.strict) {
    throw new Error(warning);
  } else {
    if (!this.warnings) { this.warnings = []; }
    this.warnings.push(warning);
  }
};

CustomTrack.prototype.isOn = function(val) {
  return /^(on|yes|true|t|y|1)$/i.test(val.toString());
};

CustomTrack.prototype.chrList = function() {
  if (!this._chrList) {
    this._chrList = _.sortBy(_.map(this.browserOpts.chrPos, function(pos, chr) { return [pos, chr]; }), function(v) { return v[0]; });
  }
  return this._chrList;
}

CustomTrack.prototype.chrAt = function(pos) {
  var chrList = this.chrList(),
    chrIndex = _.sortedIndex(chrList, [pos], function(v) { return v[0]; }),
    chr = chrIndex > 0 ? chrList[chrIndex - 1][1] : null;
  return {i: chrIndex - 1, c: chr, p: pos - this.browserOpts.chrPos[chr]};
};

CustomTrack.prototype.chrRange = function(start, end) {
  var chrLengths = this.browserOpts.chrLengths,
    startChr = this.chrAt(start),
    endChr = this.chrAt(end),
    range;
  if (startChr.c && startChr.i === endChr.i) { return [startChr.c + ':' + startChr.p + '-' + endChr.p]; }
  else {
    range = _.map(this.chrList().slice(startChr.i + 1, endChr.i), function(v) {
      return v[1] + ':1-' + chrLengths[v[1]];
    });
    startChr.c && range.unshift(startChr.c + ':' + startChr.p + '-' + chrLengths[startChr.c]);
    endChr.c && range.push(endChr.c + ':1-' + endChr.p);
    return range;
  }
}

CustomTrack.prototype.prerenderAsync = function() {
  global.CustomTracks.async(this, 'prerender', arguments, [this.id]);
};

CustomTrack.prototype.applyOptsAsync = function() {
  global.CustomTracks.async(this, 'applyOpts', [this.opts, function(){}], [this.id]);
};

CustomTrack.prototype.ajaxDir = function() {
  // Web Workers fetch URLs relative to the JS file itself.
  return (global.HTMLDocument ? '' : '../') + this.browserOpts.ajaxDir;
};

CustomTrack.prototype.rgbToHsl = function(r, g, b) {
  r /= 255, g /= 255, b /= 255;
  var max = Math.max(r, g, b), min = Math.min(r, g, b);
  var h, s, l = (max + min) / 2;

  if (max == min) {
    h = s = 0; // achromatic
  } else {
    var d = max - min;
    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
    switch(max){
      case r: h = (g - b) / d + (g < b ? 6 : 0); break;
      case g: h = (b - r) / d + 2; break;
      case b: h = (r - g) / d + 4; break;
    }
    h /= 6;
  }

  return [h, s, l];
}

CustomTrack.prototype.hslToRgb = function(h, s, l) {
  var r, g, b;

  if (s == 0) {
    r = g = b = l; // achromatic
  } else {
    function hue2rgb(p, q, t) {
      if(t < 0) t += 1;
      if(t > 1) t -= 1;
      if(t < 1/6) return p + (q - p) * 6 * t;
      if(t < 1/2) return q;
      if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
      return p;
    }

    var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
    var p = 2 * l - q;
    r = hue2rgb(p, q, h + 1/3);
    g = hue2rgb(p, q, h);
    b = hue2rgb(p, q, h - 1/3);
  }

  return [r * 255, g * 255, b * 255];
}

CustomTrack.prototype.validateColor = function(color) {
  var m = color.match(/(\d+),(\d+),(\d+)/);
  if (!m) { return false; }
  m.shift();
  return _.all(_.map(m, parseInt10), function(v) { return v >=0 && v <= 255; });
}

return CustomTrack;

};
},{"../underscore.min.js":34,"./track-types/bam.js":10,"./track-types/bed.js":11,"./track-types/bedgraph.js":12,"./track-types/bigbed.js":13,"./track-types/bigwig.js":14,"./track-types/featuretable.js":15,"./track-types/utils/utils.js":21,"./track-types/vcftabix.js":22,"./track-types/wiggle_0.js":23}],5:[function(require,module,exports){
module.exports = (function(global){
  
  var _ = require('../underscore.min.js');
  
  // Some utility functions.
  var utils = require('./track-types/utils/utils.js'),
    parseDeclarationLine = utils.parseDeclarationLine;
  
  // The class that represents a singular custom track object
  var CustomTrack = require('./CustomTrack.js')(global);

  // ========================================================================
  // = CustomTracks, the module that is exported to the global environment. =
  // ========================================================================
  //
  // Broadly speaking this is a factory for parsing data into CustomTrack objects,
  // and it can delegate this work to a worker thread.

  var CustomTracks = {
    parse: function(chunks, browserOpts) {
      var customTracks = [],
        data = [],
        track, opts, m;
      
      if (typeof chunks == "string") { chunks = [chunks]; }
      
      function pushTrack() {
        if (track.parse(data)) { customTracks.push(track); }
      }
      
      customTracks.browser = {};
      _.each(chunks, function(text) {
        _.each(text.split("\n"), function(line, lineno) {
          if (/^#/.test(line)) {
            // comment line
          } else if (/^browser\s+/.test(line)) {
            // browser lines
            m = line.match(/^browser\s+(\w+)\s+(\S*)/);
            if (!m) { throw new Error("Could not parse browser line found at line " + (lineno + 1)); }
            customTracks.browser[m[1]] = m[2];
          } else if (/^track\s+/i.test(line)) {
            if (track) { pushTrack(); }
            opts = parseDeclarationLine(line, (/^track\s+/i));
            if (!opts) { throw new Error("Could not parse track line found at line " + (lineno + 1)); }
            opts.lineNum = lineno + 1;
            track = new CustomTrack(opts, browserOpts);
            data = [];
          } else if (/\S/.test(line)) {
            if (!track) { throw new Error("Found data on line "+(lineno+1)+" but no preceding track definition"); }
            data.push(line);
          }
        });
      });
      if (track) { pushTrack(); }
      return customTracks;
    },
    
    parseDeclarationLine: parseDeclarationLine,
    
    error: function(e) {
      // Can be overridden by a parent library to handle errors more gracefully.
      // Note: this is overridden by ui.genobrowser during UI setup.
      console.log(e);
    },
    
    _workerScript: 'build/CustomTrackWorker.js',
    // NOTE: To temporarily disable Web Worker usage, set this to true.
    _disableWorkers: false,
    
    worker: function() { 
      var self = this,
        callbacks = [];
      if (!self._worker && global.Worker) { 
        self._worker = new global.Worker(self._workerScript);
        self._worker.addEventListener('error', function(e) { self.error(e); }, false);
        self._worker.addEventListener('message', function(e) {
          if (e.data.log) { console.log(JSON.parse(e.data.log)); return; }
          if (e.data.error) {
            if (e.data.id) { callbacks[e.data.id] = null; }
            self.error(JSON.parse(e.data.error));
            return;
          }
          callbacks[e.data.id](JSON.parse(e.data.ret));
          callbacks[e.data.id] = null;
        });
        self._worker.call = function(op, args, callback) {
          var id = callbacks.push(callback) - 1;
          this.postMessage({op: op, id: id, args: args});
        };
        // To have the worker throw errors instead of passing them nicely back, call this with toggle=true
        self._worker.throwErrors = function(toggle) {
          this.postMessage({op: 'throwErrors', args: [toggle]});
        };
      }
      return self._disableWorkers ? null : self._worker;
    },
    
    async: function(self, fn, args, asyncExtraArgs, wrapper) {
      args = _.toArray(args);
      wrapper = wrapper || _.identity;
      var argsExceptLastOne = _.initial(args),
        callback = _.last(args),
        w = this.worker();
      // Fallback if web workers are not supported.
      // This could also be tweaked to not use web workers when there would be no performance gain;
      //   activating this branch disables web workers entirely and everything happens synchronously.
      if (!w) { return callback(self[fn].apply(self, argsExceptLastOne)); }
      Array.prototype.unshift.apply(argsExceptLastOne, asyncExtraArgs);
      w.call(fn, argsExceptLastOne, function(ret) { callback(wrapper(ret)); });
    },
    
    parseAsync: function() {
      this.async(this, 'parse', arguments, [], function(tracks) {
        // These have been serialized, so they must be hydrated into real CustomTrack objects.
        // We replace .prerender() with an asynchronous version.
        return _.map(tracks, function(t) {
          return _.extend(new CustomTrack(), t, {
            prerender: function() { CustomTrack.prototype.prerenderAsync.apply(this, arguments); }
          });
        });
      });
    }
  };

  global.CustomTracks = CustomTracks;

});
},{"../underscore.min.js":34,"./CustomTrack.js":4,"./track-types/utils/utils.js":21}],6:[function(require,module,exports){
(function (global){
// ====================================================================
// = chrom.sizes format: http://www.broadinstitute.org/igv/chromSizes =
// ====================================================================
// Note: we are extending the general use of this to include data loaded from the genome.txt and annots.xml
// files of an IGB quickload directory,

var utils = require('./utils/utils.js'),
  parseInt10 = utils.parseInt10,
  strip = utils.strip,
  optsAsTrackLine = utils.optsAsTrackLine;

var ChromSizesFormat = {
  init: function() {
    var self = this,
      m = self.metadata,
      o = self.opts;
    o.species = m.species || 'Custom Genome';
    o.assemblyDate = m.assemblyDate || '';
    
    // TODO: if metadata also contains custom track data, e.g. from annots.xml
    // must convert them into items for o.availTracks, o.tracks, and o.trackDesc
    // The o.availTracks items should contain {customData: tracklines} to be parsed
    if (m.tracks) { self.format().createTracks(m.tracks); }
  },
  
  createTracks: function(tracks) {
    var self = this,
      o = self.opts;
      
    _.each(tracks, function(t) {
      var trackOpts;
      t.lines = t.lines || [];
      trackOpts = /^track\s+/i.test(t.lines[0]) ? global.CustomTracks.parseDeclarationLine(t.lines.shift()) : {};
      t.lines.unshift('track ' + optsAsTrackLine(_.extend(trackOpts, t.opts, {name: t.name, type: t.type})) + '\n');
      o.availTracks.push({
        fh: {},
        n: t.name,
        s: ['dense', 'squish', 'pack'],
        h: 15,
        m: ['pack'],
        customData: t.lines
      });
      o.tracks.push({n: t.name});
      o.trackDesc[t.name] = {
        cat: "Feature Tracks",
        sm: t.name,
        lg: t.description || t.name
      };
    });
  },
  
  parse: function(text) {
    var lines = text.split("\n"),
      o = this.opts;
    _.each(lines, function(line, i) {
      var chrsize = strip(line).split(/\s+/, 2),
        chr = chrsize[0],
        size = parseInt10(chrsize[1]);
      if (_.isNaN(size)) { return; }
      o.chrOrder.push(chr);
      o.chrLengths[chr] = size;
      o.genomeSize += size;
    });
  }
};

module.exports = ChromSizesFormat;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./utils/utils.js":9}],7:[function(require,module,exports){
// ===========================================================
// = FASTA format: http://en.wikipedia.org/wiki/FASTA_format =
// ===========================================================

var utils = require('./utils/utils.js'),
  ensureUnique = utils.ensureUnique;

var FastaFormat = {
  init: function() {
    var self = this,
      m = self.metadata,
      o = self.opts;
      
    self.data = {};
  },
  
  parse: function(text) {
    var lines = text.split("\n"),
      self = this,
      o = self.opts,
      chr = null,
      unnamedCounter = 1,
      chrseq = [];
      
    self.data.sequence = [];
    
    _.each(lines, function(line, i) {
      var chrLine = line.match(/^[>;](.+)/),
        cleanedLine = line.replace(/\s+/g, '');
      if (chrLine) {
        chr = chrLine[1].replace(/^\s+|\s+$/g, '');
        if (!chr.length) { chr = "unnamedChr"; }
        chr = ensureUnique(chr, o.chrLengths);
        o.chrOrder.push(chr);
      } else {
        self.data.sequence.push(cleanedLine);
        o.chrLengths[chr] = (o.chrLengths[chr] || 0) + cleanedLine.length;
        o.genomeSize += cleanedLine.length;
      }
    });
    
    self.data.sequence = self.data.sequence.join('');
    self.canGetSequence = true;
  }
};

module.exports = FastaFormat;
},{"./utils/utils.js":9}],8:[function(require,module,exports){

// =========================================================================
// = GenBank format: http://www.ncbi.nlm.nih.gov/Sitemap/samplerecord.html =
// =========================================================================

var utils = require('./utils/utils.js'),
  parseInt10 = utils.parseInt10,
  strip = utils.strip,
  topTagsAsArray = utils.topTagsAsArray,
  subTagsAsArray = utils.subTagsAsArray,
  fetchField = utils.fetchField,
  getTag = utils.getTag,
  ensureUnique = utils.ensureUnique;

var GenBankFormat = {
  init: function() {
    // Note that we call GenBank field names like "LOCUS", "DEFINITION", etc. tags instead of keys.
    // We do this because: 1) certain field names can be repeated (e.g. REFERENCE) which is more 
    // evocative of "tags" as opposed to the behavior of keys in a hash.  Also, 2) this is the
    // nomenclature picked by BioRuby.
    
    this.tagSize = 12; // how wide the column for tags is in a GenBank file
    this.featureTagSize = 21; // how wide the column for tags is in the feature table section
                              // see section 4.1 of http://www.insdc.org/files/feature_table.html
    
    this.data = {
      contigs: [],
      trackLines: {
        source: [],
        genes: [],
        other: []
      }
    };
  },
  
  parseLocus: function(contig) {
    var locusLine = contig.orig.locus;
    if (locusLine) {
      if (locusLine.length > 75) { // after Rel 126.0
        contig.entryId  = strip(locusLine.substring(12, 28));
        contig.length   = parseInt10(locusLine.substring(29, 40));
        contig.strand   = strip(locusLine.substring(44, 47));
        contig.natype   = strip(locusLine.substring(47, 53));
        contig.circular = strip(locusLine.substring(55, 63));
        contig.division = strip(locusLine.substring(63, 67));
        contig.date     = strip(locusLine.substring(68, 79));
      } else {
        contig.entryId  = strip(locusLine.substring(12, 22));
        contig.length   = parseInt10(locusLine.substring(22, 30));
        contig.strand   = strip(locusLine.substring(33, 36));
        contig.natype   = strip(locusLine.substring(36, 40));
        contig.circular = strip(locusLine.substring(42, 52));
        contig.division = strip(locusLine.substring(52, 55));
        contig.date     = strip(locusLine.substring(62, 73));
      }
    }
  },
  
  parseHeaderFields: function(contig) {
    var tagSize = this.tagSize,
      headerFieldsToParse = {
        simple: ['definition', 'accession', 'version'],
        deep: ['source'] // could add references, but we don't care about those here
      };
    
    // Parse simple fields (tag --> content)
    _.each(headerFieldsToParse.simple, function(tag) {
      if (!contig.orig[tag]) { contig[tag] = null; return; }
      contig[tag] = fetchField(contig.orig[tag], tagSize);
    });
    
    // Parse tags that can repeat and have subtags
    _.each(headerFieldsToParse.deep, function(tag) {
      var data = [],
        items;
      if (!contig.orig[tag]) { contig[tag] = null; return; }
      
      items = contig.orig[tag].replace(/\n([A-Za-z\/\*])/g, "\n\001$1").split("\001");
      _.each(items, function(item) {
        var subTags = subTagsAsArray(item, tagSize),
          itemName = fetchField(subTags.shift(), tagSize), 
          itemData = {_name: itemName};
        _.each(subTags, function(subTagField) {
          var tag = getTag(subTagField, tagSize);
          itemData[tag] = fetchField(subTagField, tagSize);
        });
        data.push(itemData);
      });
      contig[tag] = data;
      
    });
  },
  
  parseFeatureTable: function(chr, contigData) {
    var self = this,
      tagSize = self.tagSize,
      featureTagSize = self.featureTagSize,
      tagsToSkip = ["features"],
      tagsRelatedToGenes = ["cds", "gene", "mrna", "exon", "intron"],
      contigLine = "ACCESSION   " + chr + "\n";
    if (contigData.orig.features) {
      var subTags = subTagsAsArray(contigData.orig.features, tagSize);
      self.data.trackLines.source.push(contigLine);
      self.data.trackLines.genes.push(contigLine);
      self.data.trackLines.other.push(contigLine);
      _.each(subTags, function(subTagField) {
        var tag = getTag(subTagField, featureTagSize);
        if (tagsToSkip.indexOf(tag) !== -1) { return; }
        else if (tag === "source") { self.data.trackLines.source.push(subTagField); }
        else if (tagsRelatedToGenes.indexOf(tag) !== -1) { self.data.trackLines.genes.push(subTagField);  }
        else { self.data.trackLines.other.push(subTagField); }
      });
    }
  },
  
  parseSequence: function(contigData) {
    if (contigData.orig.origin) {
      return contigData.orig.origin.replace(/^origin.*|\n[ 0-9]{10}| /ig, '');
    } else {
      return Array(contigData.length).join('n');
    }
  },
  
  createTracksFromFeatures: function() {
    var self = this,
      o = self.opts,
      categoryTuples = [
        ["source", "Sources", "Regions annotated by source organism or specimen"], 
        ["genes", "Gene annotations", "CDS and gene features"], 
        ["other", "Other annotations", "tRNAs and other features"]
      ];
    
    // For the categories of features, create appropriate entries in o.availTracks, o.tracks, and o.trackDesc
    // Leave the actual data as arrays of lines that are attached as .customData to o.availTracks
    // They will be parsed later via CustomTracks.parse.
    _.each(categoryTuples, function(categoryTuple) {
      var category = categoryTuple[0],
        label = categoryTuple[1],
        longLabel = categoryTuple[2],
        trackLines = [];
      if (self.data.trackLines[category].length > 0) {
        self.data.trackLines[category].unshift('track type="featureTable" name="' + label + 
          '" collapseByGene="' + (category=="genes" ? 'on' : 'off') + '"\n');
      }
      o.availTracks.push({
        fh: {},
        n: category,
        s: ['dense', 'squish', 'pack'],
        h: 15,
        m: ['pack'],
        customData: self.data.trackLines[category]
      });
      o.tracks.push({n: category});
      o.trackDesc[category] = {
        cat: "Feature Tracks",
        sm: label,
        lg: longLabel
      };
    });
  },
  
  parse: function(text) {
    var self = this,
      o = self.opts,
      contigDelimiter = "\n//\n",
      contigs = text.split(contigDelimiter),
      firstContig = null;
    
    self.data.sequence = [];
      
    _.each(contigs, function(contig) {
      if (!strip(contig).length) { return; }
                           
      var contigData = {orig: {}},
        chr, size, contigSequence;
      
      // Splits on any lines with a character in the first column
      _.each(topTagsAsArray(contig), function(field) {
        var tag = getTag(field, self.tagSize);
        if (_.isUndefined(contigData.orig[tag])) { contigData.orig[tag] = field; }
        else { contigData.orig[tag] += field; }
      });
      
      self.data.contigs.push(contigData);
      self.format().parseLocus(contigData);
      self.format().parseHeaderFields(contigData);
      contigSequence = self.format().parseSequence(contigData);
      
      chr = contigData.accession && contigData.accession != 'unknown' ? contigData.accession : contigData.entryId;
      chr = ensureUnique(chr, o.chrLengths);
      
      if (contigData.length) {
        size = contigData.length;
        if (size != contigSequence.length) {
          throw new Error("Sequence data for contig "+chr+" does not match length "+size+"bp from header");
        }
      } else {
        size = contigSequence.length;
      }
      
      o.chrOrder.push(chr);
      o.chrLengths[chr] = size;
      o.genomeSize += size;
      
      self.format().parseFeatureTable(chr, contigData);
      self.data.sequence.push(contigSequence);
      
      firstContig = firstContig || contigData;
    });
    
    self.data.sequence = self.data.sequence.join('');
    self.canGetSequence = true;
    self.format().createTracksFromFeatures();
    
    o.species = firstContig.source ? firstContig.source[0].organism.split("\n")[0] : 'Custom Genome';
    if (firstContig.date) { o.assemblyDate = firstContig.date; }
  }
  
};

module.exports = GenBankFormat;
},{"./utils/utils.js":9}],9:[function(require,module,exports){
var trackUtils = require('../../track-types/utils/utils.js');

module.exports.parseInt10 = trackUtils.parseInt10;

module.exports.deepClone = function(obj) { return JSON.parse(JSON.stringify(obj)); }

module.exports.log10 = function(val) { return Math.log(val) / Math.LN10; }

var strip = module.exports.strip = trackUtils.strip;

module.exports.roundToPlaces = function(num, dec) { return Math.round(num * Math.pow(10, dec)) / Math.pow(10, dec); }

/****
 * These functions are common subroutines for parsing GenBank and other formats based on column positions
 ****/

// Splits a multiline string before the lines that contain a character in the first column
// (a "top tag") in a GenBank-style text file
module.exports.topTagsAsArray = function(field) {
  return field.replace(/\n([A-Za-z\/\*])/g, "\n\001$1").split("\001");
}

// Splits a multiline string before the lines that contain a character not in the first column
// but within the next tagSize columns, which is a "sub tag" in a GenBank-style text file
module.exports.subTagsAsArray = function(field, tagSize) {
  if (!isFinite(tagSize) || tagSize < 2) { throw "invalid tagSize"; }
  var re = new RegExp("\\n(\\s{1," + (tagSize - 1) + "}\\S)", "g");
  return field.replace(re, "\n\001$1").split("\001");
}

// Returns a new string with the first tagSize columns from field removed
module.exports.fetchField = function(field, tagSize) {
  if (!isFinite(tagSize) || tagSize < 1) { throw "invalid tagSize"; }
  var re = new RegExp("(^|\\n).{0," + tagSize + "}", "g");
  return strip(field.replace(re, "$1"));
}

// Gets a tag from a field by trimming it out of the first tagSize characters of the field
module.exports.getTag = function(field, tagSize) { 
  if (!isFinite(tagSize) || tagSize < 1) { throw "invalid tagSize"; }
  return strip(field.substring(0, tagSize).toLowerCase());
}

/****
 * End GenBank and column-based format helpers
 ****/

// Given a hash and a presumptive new key, appends a counter to the key until it is actually an unused key
module.exports.ensureUnique = function(key, hash) {
  var i = 1, keyCheck = key;
  while (typeof hash[keyCheck] != 'undefined') { keyCheck = key + '_' + i++; }
  return keyCheck;
}

// Given a hash with option names and values, formats it in BED track line format (similar to HTML element attributes)
module.exports.optsAsTrackLine = function(opthash) {
  return _.map(opthash, function(v, k) { return k + '="' + v.toString().replace(/"/g, '') + '"'; }).join(' ');
}
},{"../../track-types/utils/utils.js":21}],10:[function(require,module,exports){
// ==============================================================
// = BAM format: https://samtools.github.io/hts-specs/SAMv1.pdf =
// ==============================================================

var utils = require('./utils/utils.js'),
  floorHack = utils.floorHack,
  parseInt10 = utils.parseInt10,
  deepClone = utils.deepClone;
var PairedIntervalTree = require('./utils/PairedIntervalTree.js').PairedIntervalTree;
var RemoteTrack = require('./utils/RemoteTrack.js').RemoteTrack;

var BamFormat = {
  defaults: {
    chromosomes: '',
    itemRgb: 'off',
    color: '188,188,188',
    colorByStrand: '',
    useScore: 0,
    group: 'user',
    priority: 'user',
    offset: 0,
    detail: false,
    url: '',
    htmlUrl: '',
    drawLimit: {squish: 2000, pack: 2000},
    // If a nucleotide differs from the reference sequence in greater than 20% of quality weighted reads, 
    // IGV colors the bar in proportion to the read count of each base; the following changes that threshold for chromozoom
    alleleFreqThreshold: 0.2,
    optimalFetchWindow: 0,
    maxFetchWindow: 0,
    // The following can be "ensembl_ucsc" or "ucsc_ensembl" to attempt auto-crossmapping of reference contig names
    // between the two schemes, which IGV does, but is a perennial issue: https://www.biostars.org/p/10062/
    // I hope not to need all the mappings in here https://github.com/dpryan79/ChromosomeMappings but it may be necessary
    convertChrScheme: "auto",
    // Draw paired ends within a range of expected insert sizes as a continuous feature?
    // See https://www.broadinstitute.org/igv/AlignmentData#paired for how this works
    viewAsPairs: false,
    expectedInsertSizePercentiles: [0.005, 0.995]
  },
  
  // The FLAG column for BAM/SAM is a combination of bitwise flags
  flags: {
    isReadPaired: 0x1,
    isReadProperlyAligned: 0x2,
    isReadUnmapped: 0x4,
    isMateUnmapped: 0x8,
    readStrandReverse: 0x10,
    mateStrandReverse: 0x20,
    isReadFirstOfPair: 0x40,
    isReadLastOfPair: 0x80,
    isSecondaryAlignment: 0x100,
    isReadFailingVendorQC: 0x200,
    isDuplicateRead: 0x400,
    isSupplementaryAlignment: 0x800
  },

  init: function() {
    var browserChrs = _.keys(this.browserOpts);
    if (!this.opts.bigDataUrl) {
      throw new Error("Required parameter bigDataUrl not found for BAM track at " +
          JSON.stringify(this.opts) + (this.opts.lineNum + 1));
    }
    this.browserChrScheme = this.type("bam").guessChrScheme(_.keys(this.browserOpts.chrPos));
  },
  
  // TODO: If the pairing interval changed, we should toss the entire cache and reset the RemoteTrack bins,
  //         *and* blow up the areaIndex.
  applyOpts: function() {
    var o = this.opts;
    // When we change opts.viewAsPairs, we *need* to throw out this.data.pileup.
    if (o.viewAsPairs != this.prevOpts.viewAsPairs) { this.data.pileup = {}; }
    this.prevOpts = deepClone(this.opts);
  },
  
  guessChrScheme: function(chrs) {
    limit = Math.min(chrs.length * 0.8, 20);
    if (_.filter(chrs, function(chr) { return (/^chr/).test(chr); }).length > limit) { return 'ucsc'; }
    if (_.filter(chrs, function(chr) { return (/^\d\d?$/).test(chr); }).length > limit) { return 'ensembl'; }
    return null;
  },
  
  parse: function(lines) {
    var self = this,
      o = self.opts,
      middleishPos = self.browserOpts.genomeSize / 2,
      cache = new PairedIntervalTree(floorHack(middleishPos), {startKey: 'start', endKey: 'end'}, 
          {startKey: 'templateStart', endKey: 'templateEnd', pairedLengthKey: 'tlen', pairingKey: 'qname'}),
      ajaxUrl = self.ajaxDir() + 'bam.php',
      infoChrRange = self.chrRange(Math.round(self.browserOpts.pos), Math.round(self.browserOpts.pos + 10000)),
      remote;
    
    remote = new RemoteTrack(cache, function(start, end, storeIntervals) {
      range = self.chrRange(start, end);
      // Convert automatically between Ensembl style 1, 2, 3, X <--> UCSC style chr1, chr2, chr3, chrX as configured/autodetected
      // Note that chrM is NOT equivalent to MT https://www.biostars.org/p/120042/#120058
      switch (o.convertChrScheme == "auto" ? self.data.info.convertChrScheme : o.convertChrScheme) {
        case 'ensembl_ucsc': range = _.map(range, function(r) { return r.replace(/^chr/, ''); }); break;
        case 'ucsc_ensembl': range = _.map(range, function(r) { return r.replace(/^(\d\d?|X):/, 'chr$1:'); }); break;
      }
      $.ajax(ajaxUrl, {
        data: {range: range, url: self.opts.bigDataUrl},
        success: function(data) {
          var lines = _.filter(data.split('\n'), function(l) { var m = l.match(/\t/g); return m && m.length >= 2; });
          
          // Parse the SAM format into intervals that can be inserted into the IntervalTree cache
          var intervals = _.map(lines, function(l) { return self.type('bam').parseLine.call(self, l); });
          storeIntervals(intervals);
        }
      });
    });
    
    self.data = {cache: cache, remote: remote, pileup: {}, info: {}};
    self.heights = {max: null, min: 24, start: 24};
    self.sizes = ['dense', 'squish', 'pack'];
    self.mapSizes = ['pack'];
    self.noAreaLabels = true;
    self.expectsSequence = true;
    self.renderSequenceCallbacks = {};
    self.prevOpts = deepClone(o);  // used to detect which drawing options have been changed by the user
    
    // Get general info on the bam (e.g. `samtools idxstats`, use mapped reads per reference sequence
    // to estimate maxFetchWindow and optimalFetchWindow, and setup binning on the RemoteTrack.
    $.ajax(ajaxUrl, {
      data: {range: infoChrRange, url: o.bigDataUrl, info: 1},
      success: function(data) {
        var mappedReads = 0,
          maxItemsToDraw = _.max(_.values(o.drawLimit)),
          bamChrs = [],
          infoParts = data.split("\n\n"),
          estimatedInsertSizes = [],
          pctiles = o.expectedInsertSizePercentiles,
          lowerBound = 10, 
          upperBound = 5000, 
          sampleIntervals, meanItemLength, hasAMatePair, chrScheme, meanItemsPerBp;
        
        _.each(infoParts[0].split("\n"), function(line) {
          var fields = line.split("\t"),
            readsMappedToContig = parseInt(fields[2], 10);
          if (fields.length == 1 && fields[0] == '') { return; } // blank line
          bamChrs.push(fields[0]);
          if (_.isNaN(readsMappedToContig)) { throw new Error("Invalid output for samtools idxstats on this BAM track."); }
          mappedReads += readsMappedToContig;
        });
        
        self.data.info.chrScheme = chrScheme = self.type("bam").guessChrScheme(bamChrs);
        if (chrScheme && self.browserChrScheme) {
          self.data.info.convertChrScheme = chrScheme != self.browserChrScheme ? chrScheme + '_' + self.browserChrScheme : null;
        }
        
        sampleIntervals = _.compact(_.map(infoParts[1].split("\n"), function(line) {
          return self.type('bam').parseLine.call(self, line);
        }));
        if (sampleIntervals.length) {
          meanItemLength = _.reduce(sampleIntervals, function(memo, next) { return memo + (next.end - next.start); }, 0);
          meanItemLength = Math.round(meanItemLength / sampleIntervals.length);
          hasAMatePair = _.some(sampleIntervals, function(itvl) { 
            return itvl.flags.isReadFirstOfPair || itvl.flags.isReadLastOfPair;
          });
          estimatedInsertSizes = _.compact(_.map(sampleIntervals, function(itvl) { 
            return itvl.tlen ? Math.abs(itvl.tlen) : 0; 
          }));
          estimatedInsertSizes.sort(function(a, b) { return a - b; });  // NOTE: JavaScript does string sorting by default -_-
        }
        
        self.data.info.meanItemsPerBp = meanItemsPerBp = mappedReads / self.browserOpts.genomeSize;
        self.data.info.meanItemLength = meanItemLength = _.isUndefined(meanItemLength) ? 100 : meanItemLength;
        o.maxFetchWindow = maxItemsToDraw / meanItemsPerBp / (Math.max(meanItemLength, 100) / 100);
        o.optimalFetchWindow = Math.floor(o.maxFetchWindow / 2);
        
        // If there is pairing, we need to tell the PairedIntervalTree what range of insert sizes should trigger pairing.
        if (hasAMatePair) {
          if (estimatedInsertSizes.length) {
            lowerBound = estimatedInsertSizes[Math.floor(estimatedInsertSizes.length * pctiles[0])];
            upperBound = estimatedInsertSizes[Math.floor(estimatedInsertSizes.length * pctiles[1])];
          }
          self.data.cache.setPairingInterval(lowerBound, upperBound);
        } else {
          // If we don't see any paired reads in this BAM, deactivate the pairing functionality of the PairedIntervalTree 
          self.data.cache.disablePairing();
        }
        remote.setupBins(self.browserOpts.genomeSize, o.optimalFetchWindow, o.maxFetchWindow);
      }
    });
    
    return true;
  },
  
  // Sets feature.flags[...] to a human interpretable version of feature.flag (expanding the bitwise flags)
  parseFlags: function(feature, lineno) {
    feature.flags = {};
    _.each(this.type('bam').flags, function(bit, flag) {
      feature.flags[flag] = !!(feature.flag & bit);
    });
  },
  
  // Sets feature.blocks and feature.end based on feature.cigar
  // See section 1.4 of https://samtools.github.io/hts-specs/SAMv1.pdf for an explanation of CIGAR 
  parseCigar: function(feature, lineno) {        
    var cigar = feature.cigar,
      seq = (!feature.seq || feature.seq == '*') ? "" : feature.seq,
      refLen = 0,
      seqPos = 0,
      operations, lengths;
    
    feature.blocks = [];
    feature.insertions = [];
    
    ops = cigar.split(/\d+/).slice(1);
    lengths = cigar.split(/[A-Z=]/).slice(0, -1);
    if (ops.length != lengths.length) { this.warn("Invalid CIGAR '" + cigar + "' for " + feature.desc); return; }
    lengths = _.map(lengths, parseInt10);
    
    _.each(ops, function(op, i) {
      var len = lengths[i],
        block, insertion;
      if (/^[MX=]$/.test(op)) {
        // Alignment match, sequence match, sequence mismatch
        block = {start: feature.start + refLen};
        block.end = block.start + len;
        block.type = op;
        block.seq = seq.slice(seqPos, seqPos + len);
        feature.blocks.push(block);
        refLen += len;
        seqPos += len;
      } else if (/^[ND]$/.test(op)) {
        // Skipped reference region, deletion from reference
        refLen += len;
      } else if (op == 'I') {
        // Insertion
        insertion = {start: feature.start + refLen, end: feature.start + refLen};
        insertion.seq = seq.slice(seqPos, seqPos + len);
        feature.insertions.push(insertion);
        seqPos += len;
      } else if (op == 'S') {
        // Soft clipping; simply skip these bases in SEQ, position on reference is unchanged.
        seqPos += len;
      }
      // The other two CIGAR ops, H and P, are not relevant to drawing alignments.
    });
    
    feature.end = feature.start + refLen;
  },
  
  parseLine: function(line, lineno) {
    var o = this.opts,
      cols = ['qname', 'flag', 'rname', 'pos', 'mapq', 'cigar', 'rnext', 'pnext', 'tlen', 'seq', 'qual'],
      feature = {},
      fields = line.split("\t"),
      availFlags = this.type('bam').flags,
      chrPos, blockSizes;
    
    _.each(_.first(fields, cols.length), function(v, i) { feature[cols[i]] = v; });
    // Convert automatically between Ensembl style 1, 2, 3, X <--> UCSC style chr1, chr2, chr3, chrX as configured/autodetected
    // Note that chrM is NOT equivalent to MT https://www.biostars.org/p/120042/#120058
    switch (o.convertChrScheme == "auto" ? this.data.info.convertChrScheme : o.convertChrScheme) {
      case 'ucsc_ensembl': feature.rname = feature.rname.replace(/^chr/, ''); break;
      case 'ensembl_ucsc': feature.rname = (/^(\d\d?|X)$/.test(feature.rname) ? 'chr' : '') + feature.rname; break;
    }
    feature.name = feature.qname;
    feature.flag = parseInt10(feature.flag);
    chrPos = this.browserOpts.chrPos[feature.rname];
    lineno = lineno || 0;
    
    if (_.isUndefined(chrPos)) {
      this.warn("Invalid RNAME '"+feature.rname+"' at line " + (lineno + 1 + this.opts.lineNum));
      return null;
    } else if (feature.pos === '0' || !feature.cigar || feature.cigar == '*' || feature.flag & availFlags.isReadUnmapped) {
      // Unmapped read. Since we can't draw these at all, we don't bother parsing them further.
      return null;
    } else {
      feature.score = _.isUndefined(feature.score) ? '?' : feature.score;
      feature.start = chrPos + parseInt10(feature.pos);        // POS is 1-based, hence no increment as for parsing BED
      feature.desc = feature.qname + ' at ' + feature.rname + ':' + feature.pos;
      feature.tlen = parseInt10(feature.tlen);
      this.type('bam').parseFlags.call(this, feature, lineno);
      feature.strand = feature.flags.readStrandReverse ? '-' : '+';
      this.type('bam').parseCigar.call(this, feature, lineno); // This also sets .end appropriately
    }
    // We have to come up with something that is a unique label for every line to dedupe rows.
    // The following is technically not guaranteed by a valid BAM (even at GATK standards), but it's the best I got.
    feature.id = [feature.qname, feature.flag, feature.rname, feature.pos, feature.cigar].join("\t");
    
    return feature;
  },
  
  pileup: function(intervals, start, end) {
    var pileup = this.data.pileup,
      positionsToCalculate = {},
      numPositionsToCalculate = 0,
      i;
    
    for (i = start; i < end; i++) {
      // No need to pileup again on already-piled-up nucleotide positions
      if (!pileup[i]) { positionsToCalculate[i] = true; numPositionsToCalculate++; }
    }
    if (numPositionsToCalculate === 0) { return; } // All positions already piled up!
    
    _.each(intervals, function(interval) {
      var blockSets = [interval.data.blocks];
      if (interval.data.drawAsMates && interval.data.mate) { blockSets.push(interval.data.mate.blocks); }
      _.each(blockSets, function(blocks) {
        _.each(blocks, function(block) {
          var nt, i;
          for (i = Math.max(block.start, start); i < Math.min(block.end, end); i++) {
            if (!positionsToCalculate[i]) { continue; }
            nt = (block.seq[i - block.start] || '').toUpperCase();
            pileup[i] = pileup[i] || {A: 0, C: 0, G: 0, T: 0, N: 0, cov: 0};
            pileup[i][(/[ACTG]/).test(nt) ? nt : 'N'] += 1;
            pileup[i].cov += 1;
          }
        });
      });
    });
  },
  
  coverage: function(start, width, bppp) {
    // Compare with binning on the fly in .type('wiggle_0').prerender(...)
    var j = start,
      vScale = this.data.info.meanItemsPerBp * this.data.info.meanItemLength * 2,
      curr = this.data.pileup[j],
      bars = [],
      next, bin, i;
    for (i = 0; i < width; i++) {
      bin = curr && (j + 1 >= i * bppp + start) ? [curr.cov] : [];
      next = this.data.pileup[j + 1];
      while (j + 1 < (i + 1) * bppp + start && j + 2 >= i * bppp + start) { 
        if (next) { bin.push(next.cov); }
        ++j;
        curr = next;
        next = this.data.pileup[j + 1];
      }
      bars.push(utils.wigBinFunctions.maximum(bin) / vScale);
    }
    return bars;
  },
  
  alleles: function(start, sequence, bppp) {
    var pileup = this.data.pileup,
      vScale = this.data.info.meanItemsPerBp * this.data.info.meanItemLength * 2,
      alleleFreqThreshold = this.opts.alleleFreqThreshold,
      alleleSplits = [],
      split, refNt, i, pile;
      
    for (i = 0; i < sequence.length; i++) {
      refNt = sequence[i].toUpperCase();
      pile = pileup[start + i];
      if (pile && pile.cov && pile[refNt] / (pile.cov - pile.N) < (1 - alleleFreqThreshold)) {
        split = {
          x: i / bppp,
          splits: []
        };
        _.each(['A', 'C', 'G', 'T'], function(nt) {
          if (pile[nt] > 0) { split.splits.push({nt: nt, h: pile[nt] / vScale}); }
        });
        alleleSplits.push(split);
      }
    }
    
    return alleleSplits;
  },
  
  mismatches: function(start, sequence, bppp, intervals, width, lineNum, viewAsPairs) {
    var mismatches = [],
      viewAsPairs = this.opts.viewAsPairs;
    sequence = sequence.toUpperCase();
    _.each(intervals, function(interval) {
      var blockSets = [interval.data.blocks];
      if (viewAsPairs && interval.data.drawAsMates && interval.data.mate) { 
        blockSets.push(interval.data.mate.blocks);
      }
      _.each(blockSets, function(blocks) {
        _.each(blocks, function(block) {
          var line = lineNum(interval.data),
            nt, i, x;
          for (i = Math.max(block.start, start); i < Math.min(block.end, start + width * bppp); i++) {
            x = (i - start) / bppp;
            nt = (block.seq[i - block.start] || '').toUpperCase();
            if (nt && nt != sequence[i - start] && line) { mismatches.push({x: x, nt: nt, line: line}); }
          }
        });
      });
    });
    return mismatches;
  },

  prerender: function(start, end, density, precalc, callback) {
    var self = this,
      width = precalc.width,
      sequence = precalc.sequence,
      data = self.data,
      viewAsPairs = self.opts.viewAsPairs,
      startKey = viewAsPairs ? 'templateStart' : 'start',
      endKey = viewAsPairs ? 'templateEnd' : 'end',
      bppp = (end - start) / width;
    
    function lineNum(d, setTo) {
      var key = bppp + '_' + density + '_' + (viewAsPairs ? 'p' : 'u');
      if (!_.isUndefined(setTo)) { 
        if (!d.line) { d.line = {}; }
        return (d.line[key] = setTo);
      }
      return d.line && d.line[key]; 
    }
    
    // Don't even attempt to fetch the data if we can reasonably estimate that we will fetch an insane amount of rows 
    // (>500 alignments), as this will only hold up other requests.
    if (self.opts.maxFetchWindow && (end - start) > self.opts.maxFetchWindow) {
      callback({tooMany: true});
    } else {
      // Fetch from the RemoteTrack and call the above when the data is available.
      self.data.remote.fetchAsync(start, end, viewAsPairs, function(intervals) {
        var drawSpec = {sequence: !!sequence, width: width},
          calcPixIntervalMated = new utils.pixIntervalCalculator(start, width, bppp, 4, false, startKey, endKey),
          calcPixInterval = new utils.pixIntervalCalculator(start, width, bppp, 4);
        
        if (intervals.tooMany) { return callback(intervals); }

        if (!sequence) {
          // First drawing pass, with features that don't depend on sequence.
          self.type('bam').pileup.call(self, intervals, start, end);
          drawSpec.layout = self.type('bed').stackedLayout.call(self, intervals, width, calcPixIntervalMated, lineNum);
          _.each(drawSpec.layout, function(lines) {
            _.each(lines, function(interval) {
              interval.insertionPts = _.map(interval.d.insertions, calcPixInterval);
              if (!viewAsPairs) { return; }
              if (interval.d.drawAsMates && interval.d.mate) {
                interval.mateInts = _.map([interval.d, interval.d.mate], calcPixInterval);
                interval.mateBlockInts = _.map(interval.d.mate.blocks, calcPixInterval);
                interval.mateInsertionPts = _.map(interval.d.mate.insertionPts, calcPixInterval);
              } else if (interval.d.mateExpected) {
                interval.mateInts = [calcPixInterval(interval)];
                interval.mateBlockInts = [];
                interval.mateInsertionPts = [];
              }
            });
          });
          drawSpec.coverage = self.type('bam').coverage.call(self, start, width, bppp);
        } else {
          // Second drawing pass, to draw things that are dependent on sequence, like mismatches (potential SNPs).
          drawSpec.bppp = bppp;  
          // Find allele splits within the coverage graph.
          drawSpec.alleles = self.type('bam').alleles.call(self, start, sequence, bppp);
          // Find mismatches within each aligned block.
          drawSpec.mismatches = self.type('bam').mismatches.call(self, start, sequence, bppp, intervals, width, lineNum);
        }
        
        callback(drawSpec);
      });
    }
  },
  
  // special formatter for content in tooltips for features
  tipTipData: function(data) {
    var o = this.opts,
      content = {},
      firstMate = data.d,
      secondMate = data.d.mate,
      mateHeaders = ["this alignment", "mate pair alignment"],
      leftMate, rightMate, pairOrientation;
    function yesNo(bool) { return bool ? "yes" : "no"; }
    function addAlignedSegmentInfo(content, seg, prefix) {
      var cigarAbbrev = seg.cigar && seg.cigar.length > 25 ? seg.cigar.substr(0, 24) + '...' : seg.cigar;
      prefix = prefix || "";
      
      _.each({
        "position": seg.rname + ':' + seg.pos,
        "cigar": cigarAbbrev,
        "read strand": seg.flags.readStrandReverse ? '(-)' : '(+)',
        "mapped": yesNo(!seg.flags.isReadUnmapped),
        "map quality": seg.mapq,
        "secondary": yesNo(seg.flags.isSecondaryAlignment),
        "supplementary": yesNo(seg.flags.isSupplementaryAlignment),
        "duplicate": yesNo(seg.flags.isDuplicateRead),
        "failed QC": yesNo(seg.flags.isReadFailingVendorQC)
      }, function(v, k) { content[prefix + k] = v; });
    }
    
    if (data.d.mate && data.d.mate.flags) {
      leftMate = data.d.start < data.d.mate.start ? data.d : data.d.mate;
      rightMate = data.d.start < data.d.mate.start ? data.d.mate : data.d;
      pairOrientation = (leftMate.flags.readStrandReverse ? "R" : "F") + (leftMate.flags.isReadFirstOfPair ? "1" : "2");
      pairOrientation += (rightMate.flags.readStrandReverse ? "R" : "F") + (rightMate.flags.isReadLastOfPair ? "2" : "1");
    }
    
    if (o.viewAsPairs && data.d.drawAsMates && data.d.mate) {
      firstMate = leftMate;
      secondMate = rightMate;
      mateHeaders = ["left alignment", "right alignment"];
    }
    if (secondMate) {
      if (!_.isUndefined(data.d.insertSize)) { content["insert size"] = data.d.insertSize; }
      if (!_.isUndefined(pairOrientation)) { content["pair orientation"] = pairOrientation; }
      content[mateHeaders[0]] = "---";
      addAlignedSegmentInfo(content, firstMate);
      content[mateHeaders[1]] = "---";
      addAlignedSegmentInfo(content, secondMate, " ");
    } else {
      addAlignedSegmentInfo(content, data.d);
    }
    
    return content;
  },
  
  // See https://www.broadinstitute.org/igv/AlignmentData#coverage for an idea of what we're imitating
  drawCoverage: function(ctx, coverage, height) {
    _.each(coverage, function(d, x) {
      if (d === null) { return; }
      ctx.fillRect(x, Math.max(height - (d * height), 0), 1, Math.min(d * height, height));
    });
  },
  
  drawStrandIndicator: function(ctx, x, blockY, blockHeight, xScale, bigStyle) {
    var prevFillStyle = ctx.fillStyle;
    if (bigStyle) {
      ctx.beginPath();
      ctx.moveTo(x - (2 * xScale), blockY);
      ctx.lineTo(x + (3 * xScale), blockY + blockHeight/2);
      ctx.lineTo(x - (2 * xScale), blockY + blockHeight);
      ctx.closePath();
      ctx.fill();
    } else {
      ctx.fillStyle = 'rgb(140,140,140)';
      ctx.fillRect(x + (xScale > 0 ? -2 : 1), blockY, 1, blockHeight);
      ctx.fillRect(x + (xScale > 0 ? -1 : 0), blockY + 1, 1, blockHeight - 2);
      ctx.fillStyle = prevFillStyle;
    }
  },
  
  drawAlignment: function(ctx, width, data, i, lineHeight) {
    var self = this,
      drawMates = data.mateInts,
      color = self.opts.color,
      lineGap = lineHeight > 6 ? 2 : 0,
      blockY = i * lineHeight + lineGap/2,
      blockHeight = lineHeight - lineGap,
      deletionLineWidth = 2,
      insertionCaretLineWidth = lineHeight > 6 ? 2 : 1,
      halfHeight = Math.round(0.5 * lineHeight) - deletionLineWidth * 0.5,
      blockSets = [{blockInts: data.blockInts, strand: data.d.strand}];
    
    // For mate pairs, the full pixel interval represents the line linking the mates
    if (drawMates) {
      ctx.fillStyle = ctx.strokeStyle = "rgb(" + color + ")";
      ctx.fillRect(data.pInt.x, i * lineHeight + halfHeight, data.pInt.w, deletionLineWidth);
    }
    
    // Draw the lines that show the full alignment for each segment, including deletions
    ctx.fillStyle = ctx.strokeStyle = 'rgb(0,0,0)';
    _.each(drawMates || [data.pInt], function(pInt) {
      if (pInt.w <= 0) { return; }
      // Note that the "- 1" below fixes rounding issues but gambles on there never being a deletion at the right edge
      ctx.fillRect(pInt.x, i * lineHeight + halfHeight, pInt.w - 1, deletionLineWidth);
    });
    
    // First, determine and set the color we will be using
    // Note that the default color was already set in drawSpec
    if (self.opts.altColor && data.d.strand == '-') { color = self.opts.altColor; }
    ctx.fillStyle = ctx.strokeStyle = "rgb(" + color + ")";
    
    // Draw the [mis]match (M/X/=) blocks
    if (drawMates && data.d.mate) { blockSets.push({blockInts: data.mateBlockInts, strand: data.d.mate.strand}); }
    _.each(blockSets, function(blockSet) {
      var strand = blockSet.strand;
      _.each(blockSet.blockInts, function(bInt, blockNum) {
      
        // Skip drawing blocks that aren't inside the canvas
        if (bInt.x + bInt.w < 0 || bInt.x > width) { return; }
      
        if (blockNum == 0 && blockSet.strand == '-' && !bInt.oPrev) {
          ctx.fillRect(bInt.x + 2, blockY, bInt.w - 2, blockHeight);
          self.type('bam').drawStrandIndicator.call(self, ctx, bInt.x, blockY, blockHeight, -1, lineHeight > 6);
        } else if (blockNum == blockSet.blockInts.length - 1 && blockSet.strand == '+' && !bInt.oNext) {
          ctx.fillRect(bInt.x, blockY, bInt.w - 2, blockHeight);
          self.type('bam').drawStrandIndicator.call(self, ctx, bInt.x + bInt.w, blockY, blockHeight, 1, lineHeight > 6);
        } else {
          ctx.fillRect(bInt.x, blockY, bInt.w, blockHeight);
        }
      });
    });
    
    // Draw insertions
    ctx.fillStyle = ctx.strokeStyle = "rgb(114,41,218)";
    _.each(drawMates ? [data.insertionPts, data.mateInsertionPts] : [data.insertionPts], function(insertionPts) {
      _.each(insertionPts, function(insert) {
        if (insert.x + insert.w < 0 || insert.x > width) { return; }
        ctx.fillRect(insert.x - 1, i * lineHeight, 2, lineHeight);
        ctx.fillRect(insert.x - 2, i * lineHeight, 4, insertionCaretLineWidth);
        ctx.fillRect(insert.x - 2, (i + 1) * lineHeight - insertionCaretLineWidth, 4, insertionCaretLineWidth);
      });
    });
  },
  
  drawAlleles: function(ctx, alleles, height, barWidth) {
    // Same colors as $.ui.genotrack._ntSequenceLoad(...) but could be configurable?
    var colors = {A: '255,0,0', T: '255,0,255', C: '0,0,255', G: '0,180,0'},
      yPos;
    _.each(alleles, function(allelesForPosition) {
      yPos = height;
      _.each(allelesForPosition.splits, function(split) {
        ctx.fillStyle = 'rgb('+colors[split.nt]+')';
        ctx.fillRect(allelesForPosition.x, yPos -= (split.h * height), Math.max(barWidth, 1), split.h * height);
      });
    });
  },
  
  drawMismatch: function(ctx, mismatch, lineOffset, lineHeight, ppbp) {
    // ppbp == pixels per base pair (inverse of bppp)
    // Same colors as $.ui.genotrack._ntSequenceLoad(...) but could be configurable?
    var colors = {A: '255,0,0', T: '255,0,255', C: '0,0,255', G: '0,180,0'},
      lineGap = lineHeight > 6 ? 2 : 0,
      yPos;
    ctx.fillStyle = 'rgb('+colors[mismatch.nt]+')';
    ctx.fillRect(mismatch.x, (mismatch.line + lineOffset) * lineHeight + lineGap / 2, Math.max(ppbp, 1), lineHeight - lineGap);
    // Do we have room to print a whole letter?
    if (ppbp > 7 && lineHeight > 10) {
      ctx.fillStyle = 'rgb(255,255,255)';
      ctx.fillText(mismatch.nt, mismatch.x + ppbp * 0.5, (mismatch.line + lineOffset + 1) * lineHeight - lineGap);
    }
  },
  
  drawSpec: function(canvas, drawSpec, density) {
    var self = this,
      ctx = canvas.getContext && canvas.getContext('2d'),
      urlTemplate = 'javascript:void("'+self.opts.name+':$$")',
      drawLimit = self.opts.drawLimit && self.opts.drawLimit[density],
      lineHeight = density == 'pack' ? 14 : 4,
      covHeight = density == 'dense' ? 24 : 38,
      covMargin = 7,
      lineOffset = ((covHeight + covMargin) / lineHeight), 
      color = self.opts.color,
      areas = null;
            
    if (!ctx) { throw "Canvas not supported"; }
    
    if (!drawSpec.sequence) {
      // First drawing pass, with features that don't depend on sequence.
      
      // If necessary, indicate there was too much data to load/draw and that the user needs to zoom to see more
      if (drawSpec.tooMany || (drawLimit && drawSpec.layout.length > drawLimit)) { 
        canvas.height = 0;
        canvas.className = canvas.className + ' too-many';
        return;
      }
      
      // Only store areas for the "pack" density.
      // We have to empty this for every render, because areas can change if BAM display options change.
      if (density == 'pack' && !self.areas[canvas.id]) { areas = self.areas[canvas.id] = []; }
      // Set the expected height for the canvas (this also erases it).
      canvas.height = covHeight + ((density == 'dense') ? 0 : covMargin + drawSpec.layout.length * lineHeight);
      
      // First draw the coverage graph
      ctx.fillStyle = "rgb(159,159,159)";
      self.type('bam').drawCoverage.call(self, ctx, drawSpec.coverage, covHeight);
                
      // Now, draw alignments below it
      if (density != 'dense') {
        // Border between coverage
        ctx.fillStyle = "rgb(109,109,109)";
        ctx.fillRect(0, covHeight + 1, drawSpec.width, 1); 
        ctx.fillStyle = ctx.strokeStyle = "rgb("+color+")";
        
        _.each(drawSpec.layout, function(l, i) {
          i += lineOffset; // hackish method for leaving space at the top for the coverage graph
          _.each(l, function(data) {
            self.type('bam').drawAlignment.call(self, ctx, drawSpec.width, data, i, lineHeight, drawSpec.viewAsPairs);
            self.type('bed').addArea.call(self, areas, data, i, lineHeight, urlTemplate);
          });
        });
      }
    } else {
      // Second drawing pass, to draw things that are dependent on sequence:
      // (1) allele splits over coverage
      self.type('bam').drawAlleles.call(self, ctx, drawSpec.alleles, covHeight, 1 / drawSpec.bppp);
      // (2) mismatches over the alignments
      ctx.font = "12px 'Menlo','Bitstream Vera Sans Mono','Consolas','Lucida Console',monospace";
      ctx.textAlign = 'center';
      ctx.textBaseline = 'baseline';
      _.each(drawSpec.mismatches, function(mismatch) {
        self.type('bam').drawMismatch.call(self, ctx, mismatch, lineOffset, lineHeight, 1 / drawSpec.bppp);
      });
    }

  },

  render: function(canvas, start, end, density, callback) {
    var self = this;
    self.prerender(start, end, density, {width: canvas.width}, function(drawSpec) {
      var callbackKey = start + '-' + end + '-' + density;
      self.type('bam').drawSpec.call(self, canvas, drawSpec, density);
      
      // Have we been waiting to draw sequence data too? If so, do that now, too.
      if (_.isFunction(self.renderSequenceCallbacks[callbackKey])) {
        self.renderSequenceCallbacks[callbackKey]();
        delete self.renderSequenceCallbacks[callbackKey];
      }
      
      if (_.isFunction(callback)) { callback(); }
    });
  },
  
  renderSequence: function(canvas, start, end, density, sequence, callback) {
    var self = this;
    
    // If we weren't able to fetch sequence for some reason, there is no reason to proceed.
    if (!sequence) { return false; }

    function renderSequenceCallback() {
      self.prerender(start, end, density, {width: canvas.width, sequence: sequence}, function(drawSpec) {
        self.type('bam').drawSpec.call(self, canvas, drawSpec, density);
        if (_.isFunction(callback)) { callback(); }
      });
    }
    
    // Check if the canvas was already rendered (by lack of the class 'unrendered').
    // If yes, go ahead and execute renderSequenceCallback(); if not, save it for later.
    if ((' ' + canvas.className + ' ').indexOf(' unrendered ') > -1) {
      self.renderSequenceCallbacks[start + '-' + end + '-' + density] = renderSequenceCallback;
    } else {
      renderSequenceCallback();
    }
  },
  
  loadOpts: function($dialog) {
    var o = this.opts;
    $dialog.find('[name=viewAsPairs]').attr('checked', !!o.viewAsPairs);
    $dialog.find('[name=convertChrScheme]').val(o.convertChrScheme).change();
  },

  saveOpts: function($dialog) {
    var o = this.opts;
    o.viewAsPairs = $dialog.find('[name=viewAsPairs]').is(':checked');
    o.convertChrScheme = $dialog.find('[name=convertChrScheme]').val();
    
    // If o.viewAsPairs was changed, we *need* to blow away the genobrowser's areaIndex 
    // and our locally cached areas, as all the areas will change.
    if (o.viewAsPairs != this.prevOpts.viewAsPairs) {
      this.areas = {};
      delete $dialog.data('genobrowser').genobrowser('areaIndex')[$dialog.data('track').n];
    }
  }
  
};

module.exports = BamFormat;
},{"./utils/PairedIntervalTree.js":18,"./utils/RemoteTrack.js":19,"./utils/utils.js":21}],11:[function(require,module,exports){
// =================================================================
// = BED format: http://genome.ucsc.edu/FAQ/FAQformat.html#format1 =
// =================================================================
//
// bedDetail is a trivial extension of BED that is defined separately,
// although a BED file with >12 columns is assumed to be bedDetail track regardless of type.

var utils = require('./utils/utils.js'),
  floorHack = utils.floorHack,
  parseInt10 = utils.parseInt10;
var IntervalTree = require('./utils/IntervalTree.js').IntervalTree;
var LineMask = require('./utils/LineMask.js').LineMask;

// Intended to be loaded into CustomTrack.types.bed
var BedFormat = {
  defaults: {
    itemRgb: 'off',
    colorByStrand: '',
    useScore: 0,
    group: 'user',
    priority: 'user',
    offset: 0,
    detail: false,
    url: '',
    htmlUrl: '',
    drawLimit: {squish: null, pack: null}
  },
  
  init: function() {
    this.type().initOpts.call(this);
  },
  
  initOpts: function() {
    var self = this,
      altColors = self.opts.colorByStrand.split(/\s+/),
      validColorByStrand = altColors.length > 1 && _.all(altColors, self.validateColor);
    self.opts.useScore = self.isOn(self.opts.useScore);
    self.opts.itemRgb = self.isOn(self.opts.itemRgb);
    if (!validColorByStrand) { self.opts.colorByStrand = ''; self.opts.altColor = null; }
    else { self.opts.altColor = altColors[1]; }
  },

  parseLine: function(line, lineno) {
    var cols = ['chrom', 'chromStart', 'chromEnd', 'name', 'score', 'strand', 'thickStart', 'thickEnd', 'itemRgb',
      'blockCount', 'blockSizes', 'blockStarts', 'id', 'description'],
      feature = {},
      fields = /\t/.test(line) ? line.split("\t") : line.split(/\s+/),
      chrPos, blockSizes;
    
    if (this.opts.detail) {
      cols[fields.length - 2] = 'id';
      cols[fields.length - 1] = 'description';
    }
    _.each(fields, function(v, i) { feature[cols[i]] = v; });
    chrPos = this.browserOpts.chrPos[feature.chrom];
    lineno = lineno || 0;
    
    if (_.isUndefined(chrPos)) { 
      this.warn("Invalid chromosome '"+feature.chrom+"' at line " + (lineno + 1 + this.opts.lineNum));
      return null;
    } else {
      feature.score = _.isUndefined(feature.score) ? '?' : feature.score;
      feature.start = chrPos + parseInt10(feature.chromStart) + 1;
      feature.end = chrPos + parseInt10(feature.chromEnd) + 1;
      feature.blocks = null;
      // fancier BED features to express coding regions and exons/introns
      if (/^\d+$/.test(feature.thickStart) && /^\d+$/.test(feature.thickEnd)) {
        feature.thickStart = chrPos + parseInt10(feature.thickStart) + 1;
        feature.thickEnd = chrPos + parseInt10(feature.thickEnd) + 1;
        if (/^\d+(,\d*)*$/.test(feature.blockSizes) && /^\d+(,\d*)*$/.test(feature.blockStarts)) {
          feature.blocks = [];
          blockSizes = feature.blockSizes.split(/,/);
          _.each(feature.blockStarts.split(/,/), function(start, i) {
            if (start === '') { return; }
            var block = {start: feature.start + parseInt10(start)};
            block.end = block.start + parseInt10(blockSizes[i]);
            feature.blocks.push(block);
          });
        }
      } else {
        feature.thickStart = feature.thickEnd = null;
      }
    }
    
    return feature;
  },

  parse: function(lines) {
    var self = this,
      middleishPos = self.browserOpts.genomeSize / 2,
      data = new IntervalTree(floorHack(middleishPos), {startKey: 'start', endKey: 'end'});
    _.each(lines, function(line, lineno) {
      var feature = self.type().parseLine.call(self, line, lineno);
      if (feature) { data.add(feature); }
    });
    self.data = data;
    self.heights = {max: null, min: 15, start: 15};
    self.sizes = ['dense', 'squish', 'pack'];
    self.mapSizes = ['pack'];
    return true;
  },
  
  stackedLayout: function(intervals, width, calcPixInterval, lineNum) {
    // A lineNum function can be provided which can set/retrieve the line of already rendered datapoints
    // so as to not break a ranged feature that extends over multiple tiles.
    lineNum = _.isFunction(lineNum) ? lineNum : function() { return; };
    var lines = [],
      maxExistingLine = _.max(_.map(intervals, function(v) { return lineNum(v.data) || 0; })) + 1,
      sortedIntervals = _.sortBy(intervals, function(v) { var ln = lineNum(v.data); return _.isUndefined(ln) ? 1 : -ln; });
    
    while (maxExistingLine-->0) { lines.push(new LineMask(width, 5)); }
    _.each(sortedIntervals, function(v) {
      var d = v.data,
        ln = lineNum(d),
        pInt = calcPixInterval(d),
        thickInt = d.thickStart !== null && calcPixInterval({start: d.thickStart, end: d.thickEnd}),
        blockInts = d.blocks !== null &&  _.map(d.blocks, calcPixInterval),
        i = 0,
        l = lines.length;
      if (!_.isUndefined(ln)) {
        if (lines[ln].conflict(pInt.tx, pInt.tw)) { console.log("Unresolvable LineMask conflict!"); }
        lines[ln].add(pInt.tx, pInt.tw, {pInt: pInt, thickInt: thickInt, blockInts: blockInts, d: d});
      } else {
        while (i < l && lines[i].conflict(pInt.tx, pInt.tw)) { ++i; }
        if (i == l) { lines.push(new LineMask(width, 5)); }
        lineNum(d, i);
        lines[i].add(pInt.tx, pInt.tw, {pInt: pInt, thickInt: thickInt, blockInts: blockInts, d: d});
      }
    });
    return _.map(lines, function(l) { return _.pluck(l.items, 'data'); });
  },
  
  prerender: function(start, end, density, precalc, callback) {
    var width = precalc.width,
      bppp = (end - start) / width,
      intervals = this.data.search(start, end),
      drawSpec = [],
      calcPixInterval = new utils.pixIntervalCalculator(start, width, bppp, density=='pack');
    
    function lineNum(d, set) {
      var key = bppp + '_' + density;
      if (!_.isUndefined(set)) { 
        if (!d.line) { d.line = {}; }
        return (d.line[key] = set);
      }
      return d.line && d.line[key]; 
    }
    
    if (density == 'dense') {
      _.each(intervals, function(v) {
        var pInt = calcPixInterval(v.data);
        pInt.v = v.data.score;
        drawSpec.push(pInt);
      });
    } else {
      drawSpec = {layout: this.type('bed').stackedLayout.call(this, intervals, width, calcPixInterval, lineNum)};
      drawSpec.width = width;
    }
    return _.isFunction(callback) ? callback(drawSpec) : drawSpec;
  },
  
  addArea: function(areas, data, i, lineHeight, urlTemplate) {
    var tipTipData = {},
      tipTipDataCallback = this.type().tipTipData;
    if (!areas) { return; }
    if (_.isFunction(tipTipDataCallback)) {
      tipTipData = tipTipDataCallback.call(this, data);
    } else {
      if (!_.isUndefined(data.d.description)) { tipTipData.description = data.d.description; }
      if (!_.isUndefined(data.d.score)) { tipTipData.score = data.d.score; }
      _.extend(tipTipData, {
        position: data.d.chrom + ':' + data.d.chromStart, 
        size: data.d.chromEnd - data.d.chromStart
      });
      // Display the ID column (from bedDetail), unless it contains a tab character, which means it was autogenerated
      if (!_.isUndefined(data.d.id) && !(/\t/).test(data.d.id)) { tipTipData.id = data.d.id; }
    }
    areas.push([
      data.pInt.x, i * lineHeight + 1, data.pInt.x + data.pInt.w, (i + 1) * lineHeight, // x1, x2, y1, y2
      data.d.name || data.d.id || '',                                                   // name
      urlTemplate.replace('$$', _.isUndefined(data.d.id) ? data.d.name : data.d.id),    // href
      data.pInt.oPrev,                                                                  // continuation from previous tile?
      null,
      null,
      tipTipData
    ]);
  },
  
  // Scales a score from 0-1000 into an alpha value between 0.2 and 1.0
  calcAlpha: function(value) { return Math.max(value, 166)/1000; },
  
  // Scales a score from 0-1000 into a color scaled between #cccccc and max Color
  calcGradient: function(maxColor, value) {
    var minColor = [230,230,230],
      valueColor = [];
    if (!_.isArray(maxColor)) { maxColor = _.map(maxColor.split(','), parseInt10); }
    _.each(minColor, function(v, i) { valueColor[i] = (v - maxColor[i]) * ((1000 - value) / 1000.0) + maxColor[i]; });
    return _.map(valueColor, parseInt10).join(',');
  },
  
  drawArrows: function(ctx, canvasWidth, lineY, halfHeight, startX, endX, direction) {
    var arrowHeight = Math.min(halfHeight, 3),
      X1, X2;
    startX = Math.max(startX, 0);
    endX = Math.min(endX, canvasWidth);
    if (endX - startX < 5) { return; } // can't draw arrows in that narrow of a space
    if (direction !== '+' && direction !== '-') { return; } // invalid direction
    ctx.beginPath();
    // All the 0.5's here are due to <canvas>'s somewhat silly coordinate system 
    // http://diveintohtml5.info/canvas.html#pixel-madness
    X1 = direction == '+' ? 0.5 : arrowHeight + 0.5;
    X2 = direction == '+' ? arrowHeight + 0.5 : 0.5;
    for (var i = Math.floor(startX) + 2; i < endX - arrowHeight; i += 7) {
      ctx.moveTo(i + X1, lineY + halfHeight - arrowHeight + 0.5);
      ctx.lineTo(i + X2, lineY + halfHeight + 0.5);
      ctx.lineTo(i + X1, lineY + halfHeight + arrowHeight + 0.5);
    }
    ctx.stroke();
  },
  
  drawFeature: function(ctx, width, data, i, lineHeight) {
    var self = this,
      color = self.opts.color,
      y = i * lineHeight,
      halfHeight = Math.round(0.5 * (lineHeight - 1)),
      quarterHeight = Math.ceil(0.25 * (lineHeight - 1)),
      lineGap = lineHeight > 6 ? 2 : 1,
      thickOverlap = null,
      prevBInt = null;
    
    // First, determine and set the color we will be using
    // Note that the default color was already set in drawSpec
    if (self.opts.altColor && data.d.strand == '-') { color = self.opts.altColor; }
    
    if (self.opts.itemRgb && data.d.itemRgb && this.validateColor(data.d.itemRgb)) { color = data.d.itemRgb; }
    
    if (self.opts.useScore) { color = self.type('bed').calcGradient(color, data.d.score); }
    
    if (self.opts.itemRgb || self.opts.altColor || self.opts.useScore) { ctx.fillStyle = ctx.strokeStyle = "rgb(" + color + ")"; }
    
    if (data.thickInt) {
      // The coding region is drawn as a thicker line within the gene
      if (data.blockInts) {
        // If there are exons and introns, draw the introns with a 1px line
        prevBInt = null;
        ctx.fillRect(data.pInt.x, y + halfHeight, data.pInt.w, 1);
        ctx.strokeStyle = color;
        _.each(data.blockInts, function(bInt) {
          if (bInt.x + bInt.w <= width && bInt.x >= 0) {
            ctx.fillRect(bInt.x, y + halfHeight - quarterHeight + 1, bInt.w, quarterHeight * 2 - 1);
          }
          thickOverlap = utils.pixIntervalOverlap(bInt, data.thickInt);
          if (thickOverlap) {
            ctx.fillRect(thickOverlap.x, y + 1, thickOverlap.w, lineHeight - lineGap);
          }
          // If there are introns, arrows are drawn on the introns, not the exons...
          if (data.d.strand && prevBInt) {
            ctx.strokeStyle = "rgb(" + color + ")";
            self.type('bed').drawArrows(ctx, width, y, halfHeight, prevBInt.x + prevBInt.w, bInt.x, data.d.strand);
          }
          prevBInt = bInt;
        });
        // ...unless there were no introns. Then it is drawn on the coding region.
        if (data.blockInts.length == 1) {
          ctx.strokeStyle = "white";
          self.type('bed').drawArrows(ctx, width, y, halfHeight, data.thickInt.x, data.thickInt.x + data.thickInt.w, data.d.strand);
        }
      } else {
        // We have a coding region but no introns/exons
        ctx.fillRect(data.pInt.x, y + halfHeight - quarterHeight + 1, data.pInt.w, quarterHeight * 2 - 1);
        ctx.fillRect(data.thickInt.x, y + 1, data.thickInt.w, lineHeight - lineGap);
        ctx.strokeStyle = "white";
        self.type('bed').drawArrows(ctx, width, y, halfHeight, data.thickInt.x, data.thickInt.x + data.thickInt.w, data.d.strand);
      }
    } else {
      // Nothing fancy.  It's a box.
      ctx.fillRect(data.pInt.x, y + 1, data.pInt.w, lineHeight - lineGap);
      ctx.strokeStyle = "white";
      self.type('bed').drawArrows(ctx, width, y, halfHeight, data.pInt.x, data.pInt.x + data.pInt.w, data.d.strand);
    }
  },
  
  drawSpec: function(canvas, drawSpec, density) {
    var self = this,
      ctx = canvas.getContext && canvas.getContext('2d'),
      urlTemplate = self.opts.url ? self.opts.url : 'javascript:void("'+self.opts.name+':$$")',
      drawLimit = self.opts.drawLimit && self.opts.drawLimit[density],
      lineHeight = density == 'pack' ? 15 : 6,
      color = self.opts.color,
      areas = null;
    
    if (!ctx) { throw "Canvas not supported"; }
    // TODO: I disabled regenerating areas here, which assumes that lineNum remains stable across re-renders. Should check on this.
    if (density == 'pack' && !self.areas[canvas.id]) { areas = self.areas[canvas.id] = []; }
    
    if (density == 'dense') {
      canvas.height = 15;
      ctx.fillStyle = "rgb("+color+")";
      _.each(drawSpec, function(pInt) {
        if (self.opts.useScore) { ctx.fillStyle = "rgba("+self.type('bed').calcGradient(color, pInt.v)+")"; }
        ctx.fillRect(pInt.x, 1, pInt.w, 13);
      });
    } else {
      if ((drawLimit && drawSpec.layout && drawSpec.layout.length > drawLimit) || drawSpec.tooMany) { 
        canvas.height = 0;
        // This applies styling that indicates there was too much data to load/draw and that the user needs to zoom to see more
        canvas.className = canvas.className + ' too-many';
        return;
      }
      canvas.height = drawSpec.layout.length * lineHeight;
      ctx.fillStyle = ctx.strokeStyle = "rgb("+color+")";
      _.each(drawSpec.layout, function(l, i) {
        _.each(l, function(data) {
          self.type('bed').drawFeature.call(self, ctx, drawSpec.width, data, i, lineHeight);              
          self.type('bed').addArea.call(self, areas, data, i, lineHeight, urlTemplate);
        });
      });
    }
  },

  render: function(canvas, start, end, density, callback) {
    var self = this;
    self.prerender(start, end, density, {width: canvas.width}, function(drawSpec) {
      self.type().drawSpec.call(self, canvas, drawSpec, density);
      if (_.isFunction(callback)) { callback(); }
    });
  },

  loadOpts: function($dialog) {
    var o = this.opts,
      colorByStrandOn = /\d+,\d+,\d+\s+\d+,\d+,\d+/.test(o.colorByStrand),
      colorByStrand = colorByStrandOn ? o.colorByStrand.split(/\s+/)[1] : '0,0,0';
    $dialog.find('[name=colorByStrandOn]').attr('checked', !!colorByStrandOn);
    $dialog.find('[name=colorByStrand]').val(colorByStrand).change();
    $dialog.find('[name=useScore]').attr('checked', this.isOn(o.useScore));    
    $dialog.find('[name=url]').val(o.url);
  },
  
  saveOpts: function($dialog) {
    var o = this.opts,
      colorByStrandOn = $dialog.find('[name=colorByStrandOn]').is(':checked'),
      colorByStrand = $dialog.find('[name=colorByStrand]').val(),
      validColorByStrand = this.validateColor(colorByStrand);
    o.colorByStrand = colorByStrandOn && validColorByStrand ? o.color + ' ' + colorByStrand : '';
    o.useScore = $dialog.find('[name=useScore]').is(':checked') ? 1 : 0;
    o.url = $dialog.find('[name=url]').val();
    this.type('bed').initOpts.call(this);
  }
};

module.exports = BedFormat;
},{"./utils/IntervalTree.js":16,"./utils/LineMask.js":17,"./utils/utils.js":21}],12:[function(require,module,exports){
// =========================================================================
// = bedGraph format: http://genome.ucsc.edu/goldenPath/help/bedgraph.html =
// =========================================================================

var utils = require('./utils/utils.js'),
  parseInt10 = utils.parseInt10;

// Intended to be loaded into CustomTrack.types.bedgraph
var BedGraphFormat = {
  defaults: {
    altColor: '',
    priority: 100,
    autoScale: 'on',
    alwaysZero: 'off',
    gridDefault: 'off',
    maxHeightPixels: '128:128:15',
    graphType: 'bar',
    viewLimits: '',
    yLineMark: 0.0,
    yLineOnOff: 'off',
    windowingFunction: 'maximum',
    smoothingWindow: 'off'
  },

  init: function() { return this.type('wiggle_0').init.call(this); },
  
  _binFunctions: utils.wigBinFunctions,
  
  initOpts: function() { return this.type('wiggle_0').initOpts.call(this); },
  
  applyOpts: function() { return this.type('wiggle_0').applyOpts.apply(this, arguments); },
  
  parse: function(lines) {
    var self = this,
      genomeSize = this.browserOpts.genomeSize,
      data = {all: []},
      mode, modeOpts, chrPos, m;
    self.range = self.isOn(this.opts.alwaysZero) ? [0, 0] : [Infinity, -Infinity];
  
    _.each(lines, function(line, lineno) {
      var cols = ['chrom', 'chromStart', 'chromEnd', 'dataValue'],
        datum = {},
        chrPos, start, end, val;
      _.each(line.split(/\s+/), function(v, i) { datum[cols[i]] = v; });
      chrPos = self.browserOpts.chrPos[datum.chrom];
      if (_.isUndefined(chrPos)) {
        self.warn("Invalid chromosome at line " + (lineno + 1 + self.opts.lineNum));
      }
      start = parseInt10(datum.chromStart);
      end = parseInt10(datum.chromEnd);
      val = parseFloat(datum.dataValue);
      data.all.push({start: chrPos + start, end: chrPos + end, val: val});
    });

    return self.type('wiggle_0').finishParse.call(self, data);
  },
  
  initDrawSpec: function() { return this.type('wiggle_0').initDrawSpec.apply(this, arguments); },
  
  drawBars: function() { return this.type('wiggle_0').drawBars.apply(this, arguments); },

  prerender: function(start, end, density, precalc, callback) {
    return this.type('wiggle_0').prerender.call(this, start, end, density, precalc, callback);
  },

  render: function(canvas, start, end, density, callback) {
    this.type('wiggle_0').render.call(this, canvas, start, end, density, callback);
  },
  
  loadOpts: function() { return this.type('wiggle_0').loadOpts.apply(this, arguments); },
  
  saveOpts: function() { return this.type('wiggle_0').saveOpts.apply(this, arguments); }
  
};

module.exports = BedGraphFormat;
},{"./utils/utils.js":21}],13:[function(require,module,exports){
// =====================================================================
// = bigBed format: http://genome.ucsc.edu/goldenPath/help/bigBed.html =
// =====================================================================

var utils = require('./utils/utils.js'),
  floorHack = utils.floorHack;
var IntervalTree = require('./utils/IntervalTree.js').IntervalTree;
var RemoteTrack = require('./utils/RemoteTrack.js').RemoteTrack;

// Intended to be loaded into CustomTrack.types.bigbed
var BigBedFormat = {
  defaults: {
    chromosomes: '',
    itemRgb: 'off',
    colorByStrand: '',
    useScore: 0,
    group: 'user',
    priority: 'user',
    offset: 0,
    detail: false,
    url: '',
    htmlUrl: '',
    drawLimit: {squish: 500, pack: 100},
    maxFetchWindow: 0
  },

  init: function() {
    if (!this.opts.bigDataUrl) {
      throw new Error("Required parameter bigDataUrl not found for bigBed track at " + JSON.stringify(this.opts) + (this.opts.lineNum + 1));
    }
  },
  
  parse: function(lines) {
    var self = this,
      middleishPos = self.browserOpts.genomeSize / 2,
      cache = new IntervalTree(floorHack(middleishPos), {startKey: 'start', endKey: 'end'}),
      ajaxUrl = self.ajaxDir() + 'bigbed.php',
      remote;
    
    remote = new RemoteTrack(cache, function(start, end, storeIntervals) {
      range = self.chrRange(start, end);
      $.ajax(ajaxUrl, {
        data: {range: range, url: self.opts.bigDataUrl, density: 'pack'},
        success: function(data) {
          var lines = _.filter(data.split('\n'), function(l) { var m = l.match(/\t/g); return m && m.length >= 2; });
          var intervals = _.map(lines, function(l) { 
            var itvl = self.type('bed').parseLine.call(self, l); 
            // Use BioPerl's Bio::DB:BigBed strategy for deduplicating re-fetched intervals:
            // "Because BED files don't actually use IDs, the ID is constructed from the feature's name (if any), chromosome coordinates, strand and block count."
            if (_.isUndefined(itvl.id)) {
              itvl.id = [itvl.name, itvl.chrom, itvl.chromStart, itvl.chromEnd, itvl.strand, itvl.blockCount].join("\t");
            }
            return itvl;
          });
          storeIntervals(intervals);
        }
      });
    });
    
    self.data = {cache: cache, remote: remote};
    self.heights = {max: null, min: 15, start: 15};
    self.sizes = ['dense', 'squish', 'pack'];
    self.mapSizes = ['pack'];
    
    // Get general info on the bigBed and setup the binning scheme for the RemoteTrack
    $.ajax(ajaxUrl, {
      data: { url: self.opts.bigDataUrl },
      success: function(data) {
        // Set maxFetchWindow to avoid overfetching data.
        if (!self.opts.maxFetchWindow) {
          var meanItemsPerBp = data.itemCount / self.browserOpts.genomeSize,
            maxItemsToDraw = _.max(_.values(self.opts.drawLimit));
          self.opts.maxFetchWindow = maxItemsToDraw / meanItemsPerBp;
          self.opts.optimalFetchWindow = Math.floor(self.opts.maxFetchWindow / 3);
        }
        remote.setupBins(self.browserOpts.genomeSize, self.opts.optimalFetchWindow, self.opts.maxFetchWindow);
      }
    });
    
    return true;
  },

  prerender: function(start, end, density, precalc, callback) {
    var self = this,
      width = precalc.width,
      data = self.data,
      bppp = (end - start) / width,
      range = this.chrRange(start, end);
    
    function lineNum(d, setTo) {
      var key = bppp + '_' + density;
      if (!_.isUndefined(setTo)) { 
        if (!d.line) { d.line = {}; }
        return (d.line[key] = setTo);
      }
      return d.line && d.line[key]; 
    }
    
    function parseDenseData(data) {
      var drawSpec = [], 
        lines;
      lines = data.split(/\s+/g);
      _.each(lines, function(line, x) { 
        if (line != 'n/a' && line.length) { drawSpec.push({x: x, w: 1, v: parseFloat(line) * 1000}); } 
      });
      callback(drawSpec);
    }
    
    // Don't even attempt to fetch the data if density is not 'dense' and we can reasonably
    // estimate that we will fetch too many rows (>500 features), as this will only delay other requests.
    if (density != 'dense' && (end - start) > self.opts.maxFetchWindow) {
      callback({tooMany: true});
    } else {
      if (density == 'dense') {
        $.ajax(self.ajaxDir() + 'bigbed.php', {
          data: {range: range, url: self.opts.bigDataUrl, width: width, density: density},
          success: parseDenseData
        });
      } else {
        self.data.remote.fetchAsync(start, end, function(intervals) {
          var calcPixInterval, drawSpec = {};
          if (intervals.tooMany) { return callback(intervals); }
          calcPixInterval = new utils.pixIntervalCalculator(start, width, bppp, density == 'pack');
          drawSpec.layout = self.type('bed').stackedLayout.call(self, intervals, width, calcPixInterval, lineNum);
          drawSpec.width = width;
          callback(drawSpec);
        });
      }
    }
  },

  render: function(canvas, start, end, density, callback) {
    var self = this;
    self.prerender(start, end, density, {width: canvas.width}, function(drawSpec) {
      self.type('bed').drawSpec.call(self, canvas, drawSpec, density);
      if (_.isFunction(callback)) { callback(); }
    });
  },
  
  loadOpts: function() { return this.type('bed').loadOpts.apply(this, arguments); },
  
  saveOpts: function() { return this.type('bed').saveOpts.apply(this, arguments); }
};

module.exports = BigBedFormat;
},{"./utils/IntervalTree.js":16,"./utils/RemoteTrack.js":19,"./utils/utils.js":21}],14:[function(require,module,exports){


// =====================================================================
// = bigWig format: http://genome.ucsc.edu/goldenPath/help/bigWig.html =
// =====================================================================

var BigWigFormat = {
  defaults: {
    altColor: '128,128,128',
    priority: 100,
    autoScale: 'on',
    alwaysZero: 'off',
    gridDefault: 'off',
    maxHeightPixels: '128:128:15',
    graphType: 'bar',
    viewLimits: '',
    yLineMark: 0.0,
    yLineOnOff: 'off',
    windowingFunction: 'maximum',
    smoothingWindow: 'off'
  },

  init: function() {
    if (!this.opts.bigDataUrl) {
      throw new Error("Required parameter bigDataUrl not found for bigWig track at " + JSON.stringify(this.opts) + (this.opts.lineNum + 1));
    }
    this.type('wiggle_0').initOpts.call(this);
  },
  
  _binFunctions: {'minimum':1, 'maximum':1, 'mean':1, 'min':1, 'max':1, 'std':1, 'coverage':1},
  
  applyOpts: function() { return this.type('wiggle_0').applyOpts.apply(this, arguments); },

  parse: function(lines) {
    var self = this;
    self.stretchHeight = true;
    self.range = self.isOn(self.opts.alwaysZero) ? [0, 0] : [Infinity, -Infinity];
    $.ajax(self.ajaxDir() + 'bigwig.php', {
      data: {info: 1, url: this.opts.bigDataUrl},
      async: false,  // This is cool since parsing normally happens in a Web Worker
      success: function(data) {
        var rows = data.split("\n");
        _.each(rows, function(r) {
          var keyval = r.split(': ');
          if (keyval[0]=='min') { self.range[0] = Math.min(parseFloat(keyval[1]), self.range[0]); }
          if (keyval[0]=='max') { self.range[1] = Math.max(parseFloat(keyval[1]), self.range[1]); }
        });
      }
    });
    self.type('wiggle_0').applyOpts.apply(self);
    return true;
  },

  prerender: function(start, end, density, precalc, callback) {
    var self = this,
      width = precalc.width,
      chrRange = self.chrRange(start, end);
  
    function success(data) {
      var drawSpec = self.type('wiggle_0').initDrawSpec.call(self, precalc),
        lines = data.split(/\s+/g);
      _.each(lines, function(line) {
        if (line == 'n/a') { drawSpec.bars.push(null); }
        else if (line.length) { drawSpec.bars.push((parseFloat(line) - self.drawRange[0]) / drawSpec.vScale); }
      });
      callback(drawSpec);
    }
  
    $.ajax(self.ajaxDir() + 'bigwig.php', {
      data: {range: chrRange, url: self.opts.bigDataUrl, width: width, winFunc: self.opts.windowingFunction},
      success: success
    });
  },

  render: function(canvas, start, end, density, callback) {
    var self = this,
      height = canvas.height,
      width = canvas.width,
      ctx = canvas.getContext && canvas.getContext('2d');
    if (!ctx) { throw "Canvas not supported"; }
    self.prerender(start, end, density, {width: width, height: height}, function(drawSpec) {
      self.type('wiggle_0').drawBars.call(self, ctx, drawSpec, height, width);
      _.isFunction(callback) && callback();
    });
  },

  loadOpts: function() { return this.type('wiggle_0').loadOpts.apply(this, arguments); },

  saveOpts: function() { return this.type('wiggle_0').saveOpts.apply(this, arguments); }
};

module.exports = BigWigFormat;
},{}],15:[function(require,module,exports){
// ======================================================================
// = featureTable format: http://www.insdc.org/files/feature_table.html =
// ======================================================================

var IntervalTree = require('./utils/IntervalTree.js').IntervalTree;
var utils = require('./utils/utils.js'),
  strip = utils.strip,
  floorHack = utils.floorHack,
  parseInt10 = utils.parseInt10;

// Intended to be loaded into CustomTrack.types.featuretable
var FeatureTableFormat = {
  defaults: {
    collapseByGene: 'off',
    keyColumnWidth: 21,
    itemRgb: 'off',
    colorByStrand: '',
    useScore: 0,
    group: 'user',
    priority: 'user',
    offset: 0,
    url: '',
    htmlUrl: '',
    drawLimit: {squish: null, pack: null}
  },
  
  init: function() {
    this.type('bed').initOpts.call(this);
    this.opts.collapseByGene = this.isOn(this.opts.collapseByGene);
    this.featureTypeCounts = {};
  },
  
  // parses one feature key + location/qualifiers row from the feature table
  parseEntry: function(chrom, lines, startLineNo) {
    var feature = {
        chrom: chrom,
        score: '?',
        blocks: null,
        qualifiers: {}
      },
      keyColumnWidth = this.opts.keyColumnWidth,
      qualifier = null,
      fullLocation = [],
      collapseKeyQualifiers = ['locus_tag', 'gene', 'db_xref'],
      qualifiersThatAreNames = ['gene', 'locus_tag', 'db_xref'],
      RNATypes = ['rrna', 'trna'],
      alsoTryForRNATypes = ['product'],
      locationPositions, chrPos, blockSizes;
    
    chrPos = this.browserOpts.chrPos[chrom];
    startLineNo = startLineNo || 0;
    if (_.isUndefined(chrPos)) {
      this.warn("Invalid chromosome at line " + (lineno + 1 + this.opts.lineNum));
      return null;
    }
    
    // fill out feature's keys with info from these lines
    _.each(lines, function(line, lineno) {
      var key = line.substr(0, keyColumnWidth),
        restOfLine = line.substr(keyColumnWidth),
        qualifierMatch = restOfLine.match(/^\/(\w+)(=?)(.*)/);
      if (key.match(/\w/)) {
        feature.type = strip(key);
        qualifier = null;
        fullLocation.push(restOfLine);
      } else {
        if (qualifierMatch) {
          qualifier = qualifierMatch[1];
          if (!feature.qualifiers[qualifier]) { feature.qualifiers[qualifier] = []; }
          feature.qualifiers[qualifier].push([qualifierMatch[2] ? qualifierMatch[3] : true]);
        } else {
          if (qualifier !== null) { 
            _.last(feature.qualifiers[qualifier]).push(restOfLine);
          } else {
            fullLocation.push(restOfLine);
          }
        }
      }
    });
    
    feature.fullLocation = fullLocation = fullLocation.join('');
    locationPositions = _.map(_.filter(fullLocation.split(/\D+/), _.identity), parseInt10);
    feature.chromStart =  _.min(locationPositions);
    feature.chromEnd = _.max(locationPositions) + 1; // Feature table ranges are *inclusive* of the end base
                                                     // chromEnd columns in BED format are *not*.
    feature.start = chrPos + feature.chromStart;
    feature.end = chrPos + feature.chromEnd; 
    feature.strand = /complement/.test(fullLocation) ? "-" : "+";
    
    // Until we merge by gene name, we don't care about these
    feature.thickStart = feature.thickEnd = null;
    feature.blocks = null;
    
    // Parse the qualifiers properly
    _.each(feature.qualifiers, function(v, k) {
      _.each(v, function(entryLines, i) {
        v[i] = strip(entryLines.join(' '));
        if (/^"[\s\S]*"$/.test(v[i])) {
          // Dequote free text
          v[i] = v[i].replace(/^"|"$/g, '').replace(/""/g, '"');
        }
      });
      //if (v.length == 1) { feature.qualifiers[k] = v[0]; }
    });
    
    // Find something that can serve as a name
    feature.name = feature.type;
    if (_.contains(RNATypes, feature.type.toLowerCase())) { 
      Array.prototype.push.apply(qualifiersThatAreNames, alsoTryForRNATypes); 
    }
    _.find(qualifiersThatAreNames, function(k) {
      if (feature.qualifiers[k] && feature.qualifiers[k][0]) { return (feature.name = feature.qualifiers[k][0]); }
    });
    // In the worst case, add a counter to disambiguate features named only by type
    if (feature.name == feature.type) {
      if (!this.featureTypeCounts[feature.type]) { this.featureTypeCounts[feature.type] = 1; }
      feature.name = feature.name + '_' + this.featureTypeCounts[feature.type]++;
    }
    
    // Find a key that is appropriate for collapsing
    if (this.opts.collapseByGene) {
      _.find(collapseKeyQualifiers, function(k) {
        if (feature.qualifiers[k] && feature.qualifiers[k][0]) { 
          return (feature._collapseKey = feature.qualifiers[k][0]);
        }
      });
    }
    
    return feature;
  },
  
  // collapses multiple features that are about the same gene into one drawable feature
  collapseFeatures: function(features) {
    var chrPos = this.browserOpts.chrPos,
      preferredTypeToMergeInto = ['mrna', 'gene', 'cds'],
      preferredTypeForExons = ['exon', 'cds'],
      mergeInto = features[0],
      blocks = [],
      foundType, cds, exons;
    foundType = _.find(preferredTypeToMergeInto, function(type) {
      var found = _.find(features, function(feat) { return feat.type.toLowerCase() == type; });
      if (found) { mergeInto = found; return true; }
    });
    
    // Look for exons (eukaryotic) or a CDS (prokaryotic)
    _.find(preferredTypeForExons, function(type) {
      exons = _.select(features, function(feat) { return feat.type.toLowerCase() == type; });
      if (exons.length) { return true; }
    });
    cds = _.find(features, function(feat) { return feat.type.toLowerCase() == "cds"; });
    
    _.each(exons, function(exonFeature) {
      exonFeature.fullLocation.replace(/(\d+)\.\.[><]?(\d+)/g, function(fullMatch, start, end) {
        blocks.push({
          start: chrPos[exonFeature.chrom] + Math.min(start, end), 
          // Feature table ranges are *inclusive* of the end base.
          end: chrPos[exonFeature.chrom] +  Math.max(start, end) + 1
        });
      });
    });
    
    // Convert exons and CDS into blocks, thickStart and thickEnd (in BED terminology)
    if (blocks.length) { 
      mergeInto.blocks = _.sortBy(blocks, function(b) { return b.start; });
      mergeInto.thickStart = cds ? cds.start : feature.start;
      mergeInto.thickEnd = cds ? cds.end : feature.end;
    }
    
    // finally, merge all the qualifiers
    _.each(features, function(feat) {
      if (feat === mergeInto) { return; }
      _.each(feat.qualifiers, function(values, k) {
        if (!mergeInto.qualifiers[k]) { mergeInto.qualifiers[k] = []; }
        _.each(values, function(v) {
          if (!_.contains(mergeInto.qualifiers[k], v)) { mergeInto.qualifiers[k].push(v); }
        });
      });
    });
    
    return mergeInto;
  },

  parse: function(lines) {
    var self = this,
      o = self.opts,
      middleishPos = this.browserOpts.genomeSize / 2,
      data = new IntervalTree(floorHack(middleishPos), {startKey: 'start', endKey: 'end'}),
      numLines = lines.length,
      chrom = null,
      lastEntryStart = null,
      featuresByCollapseKey = {},
      feature;
    
    function collectLastEntry(lineno) {
      if (lastEntryStart !== null) {
        feature = self.type().parseEntry.call(self, chrom, lines.slice(lastEntryStart, lineno), lastEntryStart);
        if (feature) { 
          if (o.collapseByGene) {
            featuresByCollapseKey[feature._collapseKey] = featuresByCollapseKey[feature._collapseKey] || [];
            featuresByCollapseKey[feature._collapseKey].push(feature);
          } else { data.add(feature); }
        }
      }
    }
    
    // Chunk the lines into entries and parse each of them
    _.each(lines, function(line, lineno) {
      if (line.substr(0, 12) == "ACCESSION   ") {
        collectLastEntry(lineno);
        chrom = line.substr(12);
        lastEntryStart = null;
      } else if (chrom !== null && line.substr(5, 1).match(/\w/)) {
        collectLastEntry(lineno);
        lastEntryStart = lineno;
      }
    });
    // parse the last entry
    if (chrom !== null) { collectLastEntry(lines.length); }
    
    if (o.collapseByGene) {
      _.each(featuresByCollapseKey, function(features, gene) {
        data.add(self.type().collapseFeatures.call(self, features));
      });
    }
    
    self.data = data;
    self.heights = {max: null, min: 15, start: 15};
    self.sizes = ['dense', 'squish', 'pack'];
    self.mapSizes = ['pack'];
    return true;
  },
  
  // special formatter for content in tooltips for features
  tipTipData: function(data) {
    var qualifiersToAbbreviate = {translation: 1},
      content = {
        type: data.d.type,
        position: data.d.chrom + ':' + data.d.chromStart, 
        size: data.d.chromEnd - data.d.chromStart
      };
    if (data.d.qualifiers.note && data.d.qualifiers.note[0]) {  }
    _.each(data.d.qualifiers, function(v, k) {
      if (k == 'note') { content.description = v.join('; '); return; }
      content[k] = v.join('; ');
      if (qualifiersToAbbreviate[k] && content[k].length > 25) { content[k] = content[k].substr(0, 25) + '...'; }
    });
    return content;
  },
  
  prerender: function(start, end, density, precalc, callback) {
    return this.type('bed').prerender.call(this, start, end, density, precalc, callback);
  },
  
  drawSpec: function() { return this.type('bed').drawSpec.apply(this, arguments); },
  
  render: function(canvas, start, end, density, callback) {
    this.type('bed').render.call(this, canvas, start, end, density, callback);
  },
  
  loadOpts: function() { return this.type('bed').loadOpts.apply(this, arguments); },
  
  saveOpts: function() { return this.type('bed').saveOpts.apply(this, arguments); }
};

module.exports = FeatureTableFormat;
},{"./utils/IntervalTree.js":16,"./utils/utils.js":21}],16:[function(require,module,exports){
(function(exports){
  
var SortedList = require('./SortedList.js').SortedList;  

// TODO: backport this code for JavaScript 1.5? using underscore.js
/**
 * By Shin Suzuki, MIT license
 * https://github.com/shinout/interval-tree
 * IntervalTree
 *
 * @param (object) data:
 * @param (number) center:
 * @param (object) options:
 *   center:
 *
 **/
function IntervalTree(center, options) {
  options || (options = {});

  this.startKey     = options.startKey || 0; // start key
  this.endKey       = options.endKey   || 1; // end key
  this.intervalHash = {};                    // id => interval object
  this.pointTree = new SortedList({          // b-tree of start, end points 
    compare: function(a, b) {
      if (a == null) return -1;
      if (b == null) return  1;
      var c = a[0]- b[0];
      return (c > 0) ? 1 : (c == 0)  ? 0 : -1;
    }
  });

  this._autoIncrement = 0;

  // index of the root node
  if (!center || typeof center != 'number') {
    throw new Error('you must specify center index as the 2nd argument.');
  }

  this.root = new Node(center, this);
}


/**
 * public methods
 **/


/**
 * add new range
 **/
IntervalTree.prototype.add = function(data, id) {
  if (this.contains(id)) {
    throw new DuplicateError('id ' + id + ' is already registered.');
  }

  if (id == undefined) {
    while (this.intervalHash[this._autoIncrement]) {
      this._autoIncrement++;
    }
    id = this._autoIncrement;
  }

  var itvl = new Interval(data, id, this.startKey, this.endKey);
  this.pointTree.insert([itvl.start, id]);
  this.pointTree.insert([itvl.end,   id]);
  this.intervalHash[id] = itvl;
  this._autoIncrement++;
  
  _insert.call(this, this.root, itvl);
};


/**
 * check if range is already present, based on its id
 **/
IntervalTree.prototype.contains = function(id) {
  return !!this.get(id);
}


/**
 * retrieve an interval by its id; returns null if it does not exist
 **/
IntervalTree.prototype.get = function(id) {
  return this.intervalHash[id] || null;
}


/**
 * add new range only if it is new, based on whether the id was already registered
 **/
IntervalTree.prototype.addIfNew = function(data, id) {
  try {
    this.add(data, id);
  } catch (e) {
    if (e instanceof DuplicateError) { return; }
    throw e;
  }
}


/**
 * search
 *
 * @param (integer) val:
 * @return (array)
 **/
IntervalTree.prototype.search = function(val1, val2) {
  var ret = [];
  if (typeof val1 != 'number') {
    throw new Error(val1 + ': invalid input');
  }

  if (val2 == undefined) {
    _pointSearch.call(this, this.root, val1, ret);
  }
  else if (typeof val2 == 'number') {
    _rangeSearch.call(this, val1, val2, ret);
  }
  else {
    throw new Error(val1 + ',' + val2 + ': invalid input');
  }
  return ret;
};


/**
 * remove: 
 **/
IntervalTree.prototype.remove = function(interval_id) {
  throw ".remove() is currently unimplemented";
};



/**
 * private methods
 **/

// the shift-right-and-fill operator, extended beyond the range of an int32
function _bitShiftRight(num) {
  if (num > 2147483647 || num < -2147483648) { return Math.floor(num / 2); }
  return num >>> 1;
}

/**
 * _insert
 **/
function _insert(node, itvl) {
  while (true) {
    if (itvl.end < node.idx) {
      if (!node.left) {
        node.left = new Node(_bitShiftRight(itvl.start + itvl.end), this);
      }
      node = node.left;
    } else if (node.idx < itvl.start) {
      if (!node.right) {
        node.right = new Node(_bitShiftRight(itvl.start + itvl.end), this);
      }
      node = node.right;
    } else {
      return node.insert(itvl);
    }
  }
}


/**
 * _pointSearch
 * @param (Node) node
 * @param (integer) idx 
 * @param (Array) arr
 **/
function _pointSearch(node, idx, arr) {
  while (true) {
    if (!node) break;
    if (idx < node.idx) {
      node.starts.arr.every(function(itvl) {
        var bool = (itvl.start <= idx);
        if (bool) arr.push(itvl.result());
        return bool;
      });
      node = node.left;
    } else if (idx > node.idx) {
      node.ends.arr.every(function(itvl) {
        var bool = (itvl.end >= idx);
        if (bool) arr.push(itvl.result());
        return bool;
      });
      node = node.right;
    } else {
      node.starts.arr.map(function(itvl) { arr.push(itvl.result()) });
      break;
    }
  }
}



/**
 * _rangeSearch
 * @param (integer) start
 * @param (integer) end
 * @param (Array) arr
 **/
function _rangeSearch(start, end, arr) {
  if (end - start <= 0) {
    throw new Error('end must be greater than start. start: ' + start + ', end: ' + end);
  }
  var resultHash = {};

  var wholeWraps = [];
  _pointSearch.call(this, this.root, _bitShiftRight(start + end), wholeWraps, true);

  wholeWraps.forEach(function(result) {
    resultHash[result.id] = true;
  });


  var idx1 = this.pointTree.bsearch([start, null]);
  while (idx1 >= 0 && this.pointTree.arr[idx1][0] == start) {
    idx1--;
  }

  var idx2 = this.pointTree.bsearch([end,   null]);
  var len = this.pointTree.arr.length - 1;
  while (idx2 == -1 || (idx2 <= len && this.pointTree.arr[idx2][0] <= end)) {
    idx2++;
  }

  this.pointTree.arr.slice(idx1 + 1, idx2).forEach(function(point) {
    var id = point[1];
    resultHash[id] = true;
  }, this);

  Object.keys(resultHash).forEach(function(id) {
    var itvl = this.intervalHash[id];
    arr.push(itvl.result(start, end));
  }, this);

}



/**
 * subclasses
 * 
 **/


/**
 * Node : prototype of each node in a interval tree
 * 
 **/
function Node(idx) {
  this.idx = idx;
  this.starts = new SortedList({
    compare: function(a, b) {
      if (a == null) return -1;
      if (b == null) return  1;
      var c = a.start - b.start;
      return (c > 0) ? 1 : (c == 0)  ? 0 : -1;
    }
  });

  this.ends = new SortedList({
    compare: function(a, b) {
      if (a == null) return -1;
      if (b == null) return  1;
      var c = a.end - b.end;
      return (c < 0) ? 1 : (c == 0)  ? 0 : -1;
    }
  });
};

/**
 * insert an Interval object to this node
 **/
Node.prototype.insert = function(interval) {
  this.starts.insert(interval);
  this.ends.insert(interval);
};



/**
 * Interval : prototype of interval info
 **/
function Interval(data, id, s, e) {
  this.id     = id;
  this.start  = data[s];
  this.end    = data[e];
  this.data   = data;

  if (typeof this.start != 'number' || typeof this.end != 'number') {
    throw new Error('start, end must be number. start: ' + this.start + ', end: ' + this.end);
  }

  if ( this.start >= this.end) {
    throw new Error('start must be smaller than end. start: ' + this.start + ', end: ' + this.end);
  }
}

/**
 * get result object
 **/
Interval.prototype.result = function(start, end) {
  var ret = {
    id   : this.id,
    data : this.data
  };
  if (typeof start == 'number' && typeof end == 'number') {
    /**
     * calc overlapping rate
     **/
    var left  = Math.max(this.start, start);
    var right = Math.min(this.end,   end);
    var lapLn = right - left;
    ret.rate1 = lapLn / (end - start);
    ret.rate2 = lapLn / (this.end - this.start);
  }
  return ret;
};

function DuplicateError(message) {
    this.name = 'DuplicateError';
    this.message = message;
    this.stack = (new Error()).stack;
}
DuplicateError.prototype = new Error;

exports.IntervalTree = IntervalTree;

})(module && module.exports || this);
},{"./SortedList.js":20}],17:[function(require,module,exports){
(function (global){
(function(exports){

// ==============================================================================================
// = LineMask: A (very cheap) alternative to IntervalTree: a small, 1D pixel buffer of objects. =
// ==============================================================================================
  
var utils = require('./utils.js'),
  floorHack = utils.floorHack;

function LineMask(width, fudge) {
  this.fudge = fudge = (fudge || 1);
  this.items = [];
  this.length = Math.ceil(width / fudge);
  this.mask = global.Uint8Array ? new Uint8Array(this.length) : new Array(this.length);
}

LineMask.prototype.add = function(x, w, data) {
  var upTo = Math.ceil((x + w) / this.fudge);
  this.items.push({x: x, w: w, data: data});
  for (var i = Math.max(floorHack(x / this.fudge), 0); i < Math.min(upTo, this.length); i++) { this.mask[i] = 1; }
};

LineMask.prototype.conflict = function(x, w) {
  var upTo = Math.ceil((x + w) / this.fudge);
  for (var i = Math.max(floorHack(x / this.fudge), 0); i < Math.min(upTo, this.length); i++) { if (this.mask[i]) return true; }
  return false;
};

exports.LineMask = LineMask;

})(module && module.exports || this);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./utils.js":21}],18:[function(require,module,exports){
(function(exports){
  
var IntervalTree = require('./IntervalTree.js').IntervalTree;  
var _ = require('../../../underscore.min.js');
var parseInt10 = require('./utils.js').parseInt10;

var PAIRING_CANNOT_MATE = 0,
  PAIRING_MATE_ONLY = 1,
  PAIRING_DRAW_AS_MATES = 2;

// TODO: backport this code for JavaScript 1.5? using underscore.js
/**
 * Wraps two of Shin Suzuki's IntervalTrees to store intervals that *may*
 * be paired.
 *
 * @see IntervalTree()
 **/
function PairedIntervalTree(center, unpairedOptions, pairedOptions) {
  var defaultOptions = {startKey: 0, endKey: 1};
  
  this.unpaired = new IntervalTree(center, unpairedOptions);
  this.unpairedOptions = _.extend({}, defaultOptions, unpairedOptions);
  
  this.paired = new IntervalTree(center, pairedOptions);
  this.pairedOptions = _.extend({pairingKey: 'qname', pairedLengthKey: 'tlen'}, defaultOptions, pairedOptions);
  if (this.pairedOptions.startKey === this.unpairedOptions.startKey) {
    throw new Error('startKey for unpairedOptions and pairedOptions must be different in a PairedIntervalTree');
  }
  if (this.pairedOptions.endKey === this.unpairedOptions.endKey) {
    throw new Error('endKey for unpairedOptions and pairedOptions must be different in a PairedIntervalTree');
  }
  
  this.pairingDisabled = false;
  this.pairingMinDistance = this.pairingMaxDistance = null;
}


/**
 * public methods
 **/


/**
 * Disables pairing. Effectively makes this equivalent, externally, to an IntervalTree.
 * This is useful if we discover that this data source doesn't contain paired reads.
 **/
PairedIntervalTree.prototype.disablePairing = function() {
  this.pairingDisabled = true;
  this.paired = this.unpaired;
};


/**
 * Set an interval within which paired mates will be saved as a continuous feature in .paired
 *
 * @param (number) min: Minimum distance, in bp
 * @param (number) max: Maximum distance, in bp
 **/
PairedIntervalTree.prototype.setPairingInterval = function(min, max) {
  if (typeof min != 'number') { throw new Error('you must specify min as the 1st argument.'); }
  if (typeof max != 'number') { throw new Error('you must specify max as the 2nd argument.'); }
  if (this.pairingMinDistance !== null) { throw new Error('Can only be called once. You can\'t change the pairing interval.'); }
  
  this.pairingMinDistance = min;
  this.pairingMaxDistance = max;
};


/**
 * add new range only if it is new, based on whether the id was already registered
 **/
PairedIntervalTree.prototype.addIfNew = function(data, id) {
  var mated = false,
    increment = 0,
    unpairedStart = this.unpairedOptions.startKey,
    unpairedEnd = this.unpairedOptions.endKey,
    pairedStart = this.pairedOptions.startKey,
    pairedEnd = this.pairedOptions.endKey,
    pairedLength = data[this.pairedOptions.pairedLengthKey],
    pairingState = PAIRING_CANNOT_MATE,
    newId, potentialMate;
  
  // .unpaired contains every alignment as a separate interval.
  // If it already contains this id, we've seen this read before and should disregard.
  if (this.unpaired.contains(id)) { return; }
  this.unpaired.add(data, id);
  
  // .paired contains alignments that may be mated into one interval if they are within the pairing range
  if (!this.pairingDisabled && _eligibleForPairing(this, data)) {
    if (this.pairingMinDistance === null) { 
      throw new Error('Can only add paired data after the pairing interval has been set!');
    }
    
    // instead of storing them with the given id, the pairingKey (for BAM, QNAME) is used as the id.
    // As intervals are added, we check if a read with the same pairingKey already exists in the .paired IntervalTree.
    newId = data[this.pairedOptions.pairingKey];
    potentialMate = this.paired.get(newId);
    
    if (potentialMate !== null) {
      potentialMate = potentialMate.data;
      pairingState = _pairingState(this, data, potentialMate);
      // Are the reads suitable for mating?
      if (pairingState === PAIRING_DRAW_AS_MATES || pairingState === PAIRING_MATE_ONLY) {
        // If yes: mate the reads
        potentialMate.mate = data;
        // In the other direction, has to be a selective shallow copy to avoid circular references.
        data.mate = _.extend({}, _.omit(potentialMate, function(v, k) { return _.isObject(v)}));
        data.mate.flags = _.clone(potentialMate.flags);
      }
    }
    
    // Are the mated reads within drawable range? If so, simply flag that they should be drawn together, and they will.
    // Alternatively, if the potentialMate expected a mate, we should mate them anyway.
    // The only reason we wouldn't get .drawAsMates is if the mate was on the threshold of the insert size range.
    if (pairingState === PAIRING_DRAW_AS_MATES || (pairingState === PAIRING_MATE_ONLY && potentialMate.mateExpected)) {
      data.drawAsMates = potentialMate.drawAsMates = true;
    } else {
      // Otherwise, need to insert this read into this.paired as a separate read.
      // Ensure the id is unique first.
      while (this.paired.contains(newId)) {
        newId = newId.replace(/\t.*/, '') + "\t" + (++increment);
      }
      
      data.mateExpected = _pairingState(this, data) === PAIRING_DRAW_AS_MATES;
      // FIXME: The following is perhaps a bit too specific to how TLEN for BAM files works; could generalize later
      // When inserting into .paired, the interval's .start and .end shouldn't be based on POS and the CIGAR string;
      // we must adjust them for TLEN, if it is nonzero, depending on its sign, and set new bounds for the interval.
      if (data.mateExpected && pairedLength > 0) {
        data[pairedStart] = data[unpairedStart];
        data[pairedEnd] = data[unpairedStart] + pairedLength;
      } else if (data.mateExpected && pairedLength < 0) {
        data[pairedEnd] = data[unpairedEnd];
        data[pairedStart] = data[unpairedEnd] + pairedLength;
      } else { // !data.mateExpected || pairedLength == 0
        data[pairedStart] = data[unpairedStart];
        data[pairedEnd] = data[unpairedEnd];
      }
      
      this.paired.add(data, newId);
    }
  }

};


/**
 * alias .add() to .addIfNew()
 **/
PairedIntervalTree.prototype.add = PairedIntervalTree.prototype.addIfNew;


/**
 * search
 *
 * @param (number) val:
 * @return (array)
 **/
PairedIntervalTree.prototype.search = function(val1, val2, paired) {
  if (paired && !this.pairingDisabled) {
    return this.paired.search(val1, val2);
  } else {
    return this.unpaired.search(val1, val2);
  }
};


/**
 * remove: unimplemented for now
 **/
PairedIntervalTree.prototype.remove = function(interval_id) {
  throw ".remove() is currently unimplemented";
};


/**
 * private methods
 **/

// Check if an itvl is eligible for pairing. 
// For now, this means that if any FLAG's 0x100 or higher are set, we totally discard this alignment and interval.
// FIXME: The following is entangled with bam.js internals; perhaps allow this to be generalized, overridden,
//        or set alongside .setPairingInterval()
//
// @return (boolean)
function _eligibleForPairing(pairedItvlTree, itvl) {
  var flags = itvl.flags;
  if (flags.isSecondaryAlignment || flags.isReadFailingVendorQC || flags.isDuplicateRead || flags.isSupplementaryAlignment) {
    return false;
  }
  return true;
}

// Check if an itvl and its potentialMate are within the right distance, and orientation, to be mated.
// If potentialMate isn't given, takes a best guess if a mate is expected, given the information in itvl alone.
// FIXME: The following is entangled with bam.js internals; perhaps allow this to be generalized, overridden,
//        or set alongside .setPairingInterval()
// 
// @return (number)
function _pairingState(pairedItvlTree, itvl, potentialMate) {
  var tlen = itvl[pairedItvlTree.pairedOptions.pairedLengthKey],
    itvlLength = itvl.end - itvl.start,
    itvlIsLater, inferredInsertSize;

  if (_.isUndefined(potentialMate)) {
    // Create the most receptive hypothetical mate, given the information in itvl.
    potentialMate = {
      _mocked: true,
      flags: {
        isReadPaired: true,
        isReadProperlyAligned: true,
        isReadFirstOfPair: itvl.flags.isReadLastOfPair,
        isReadLastOfPair: itvl.flags.isReadFirstOfPair
      }
    };
  }

  // First check a whole host of FLAG's. To make a long story short, we expect paired ends to be either
  // 99-147 or 163-83, depending on whether the rightmost or leftmost segment is primary.
  if (!itvl.flags.isReadPaired || !potentialMate.flags.isReadPaired) { return PAIRING_CANNOT_MATE; }
  if (!itvl.flags.isReadProperlyAligned || !potentialMate.flags.isReadProperlyAligned) { return PAIRING_CANNOT_MATE; }
  if (itvl.flags.isReadUnmapped || potentialMate.flags.isReadUnmapped) { return PAIRING_CANNOT_MATE; }
  if (itvl.flags.isMateUnmapped || potentialMate.flags.isMateUnmapped) { return PAIRING_CANNOT_MATE; }
  if (itvl.flags.isReadFirstOfPair && !potentialMate.flags.isReadLastOfPair) { return PAIRING_CANNOT_MATE; }
  if (itvl.flags.isReadLastOfPair && !potentialMate.flags.isReadFirstOfPair) { return PAIRING_CANNOT_MATE; }
    
  if (potentialMate._mocked) {
    _.extend(potentialMate, {
      rname: itvl.rnext == '=' ? itvl.rname : itvl.rnext,
      pos: itvl.pnext,
      start: itvl.rnext == '=' ? parseInt10(itvl.pnext) + (itvl.start - parseInt10(itvl.pos)) : 0,
      end: tlen > 0 ? itvl.start + tlen : (tlen < 0 ? itvl.end + tlen + itvlLength : 0),
      rnext: itvl.rnext == '=' ? '=' : itvl.rname,
      pnext: itvl.pos
    });
  }
  
  // Check that the alignments are on the same reference sequence
  if (itvl.rnext != '=' || potentialMate.rnext != '=') { 
    // and if not, do the coordinates match at all?
    if (itvl.rnext != potentialMate.rname || itvl.rnext != potentialMate.rname) { return PAIRING_CANNOT_MATE; }
    if (itvl.pnext != potentialMate.pos || itvl.pos != potentialMate.pnext) { return PAIRING_CANNOT_MATE; }
    return PAIRING_MATE_ONLY;
  }
  
  if (potentialMate._mocked) {
    _.extend(potentialMate.flags, {
      readStrandReverse: itvl.flags.mateStrandReverse,
      mateStrandReverse: itvl.flags.readStrandReverse
    });
  } 
  
  itvlIsLater = itvl.start > potentialMate.start;
  inferredInsertSize = Math.abs(tlen);
  
  // Check that the alignments are --> <--
  if (itvlIsLater) {
    if (!itvl.flags.readStrandReverse || itvl.flags.mateStrandReverse) { return PAIRING_MATE_ONLY; }
    if (potentialMate.flags.readStrandReverse || !potentialMate.flags.mateStrandReverse) { return PAIRING_MATE_ONLY; }
  } else {
    if (itvl.flags.readStrandReverse || !itvl.flags.mateStrandReverse) { return PAIRING_MATE_ONLY; }
    if (!potentialMate.flags.readStrandReverse || potentialMate.flags.mateStrandReverse) { return PAIRING_MATE_ONLY; }
  }
  
  // Check that the inferredInsertSize is within the acceptable range.
  itvl.insertSize = potentialMate.insertSize = inferredInsertSize;
  if (inferredInsertSize > this.pairingMaxDistance || inferredInsertSize < this.pairingMinDistance) { return PAIRING_MATE_ONLY; }
  
  return PAIRING_DRAW_AS_MATES;
}

exports.PairedIntervalTree = PairedIntervalTree;

})(module && module.exports || this);
},{"../../../underscore.min.js":34,"./IntervalTree.js":16,"./utils.js":21}],19:[function(require,module,exports){
(function(exports){

var _ = require('../../../underscore.min.js');

/**
  * RemoteTrack
  *
  * A helper class built for caching data fetched from a remote track (data aligned to a genome).
  * The genome is divided into bins of optimalFetchWindow nts, for each of which data will only be fetched once.
  * To setup the bins, call .setupBins(...) after initializing the class.
  *
  * There is one main public method for this class: .fetchAsync(start, end, callback)
  * (For consistency with CustomTracks.js, all `start` and `end` positions are 1-based, oriented to
  * the start of the genome, and intervals are right-open.)
  *
  * This method will request and cache data for the given interval that is not already cached, and call 
  * callback(intervals) as soon as data for all intervals is available. (If the data is already available, 
  * it will call the callback immediately.)
  **/

var BIN_LOADING = 1,
  BIN_LOADED = 2;

/**
  * RemoteTrack constructor.
  *
  * Note you still must call `.setupBins(...)` before the RemoteTrack is ready to fetch data.
  *
  * @param (IntervalTree) cache: An cache store that will receive intervals fetched for each bin.
  *                              Should be an IntervalTree or equivalent, that implements `.addIfNew(...)` and 
  *                              `.search(start, end)` methods. If it is an *extension* of an IntervalTree, note 
  *                              the `extraArgs` param permitted for `.fetchAsync()`, which are passed along as 
  *                              extra arguments to `.search()`.
  * @param (function) fetcher: A function that will be called to fetch data for each bin.
  *                            This function should take three arguments, `start`, `end`, and `storeIntervals`.
  *                            `start` and `end` are 1-based genomic coordinates forming a right-open interval.
  *                            `storeIntervals` is a callback that `fetcher` MUST call on the array of intervals
  *                            once they have been fetched from the remote data source and parsed.
  * @see _fetchBin for how `fetcher` is utilized.
  **/
function RemoteTrack(cache, fetcher) {
  if (typeof cache != 'object' || (!cache.addIfNew && (!_.keys(cache).length || cache[_.keys(cache)[0]].addIfNew))) { 
    throw new Error('you must specify an IntervalTree cache, or an object/array containing IntervalTrees, as the 1st argument.'); 
  }
  if (typeof fetcher != 'function') { throw new Error('you must specify a fetcher function as the 2nd argument.'); }
  
  this.cache = cache;
  this.fetcher = fetcher;
  
  this.callbacks = [];
  this.afterBinSetup = [];
  this.binsLoaded = null;
}

/**
 * public methods
 **/

// Setup the binning scheme for this RemoteTrack. This can occur anytime after initialization, and in fact,
// can occur after calls to `.fetchAsync()` have been made, in which case they will be waiting on this method
// to be called to proceed. But it MUST be called before data will be received by callbacks passed to 
// `.fetchAsync()`.
RemoteTrack.prototype.setupBins = function(genomeSize, optimalFetchWindow, maxFetchWindow) {
  var self = this;
  if (self.binsLoaded) { throw new Error('you cannot run setupBins more than once.'); }
  if (typeof genomeSize != 'number') { throw new Error('you must specify the genomeSize as the 1st argument.'); }
  if (typeof optimalFetchWindow != 'number') { throw new Error('you must specify optimalFetchWindow as the 2nd argument.'); }
  if (typeof maxFetchWindow != 'number') { throw new Error('you must specify maxFetchWindow as the 3rd argument.'); }
  
  self.genomeSize = genomeSize;
  self.optimalFetchWindow = optimalFetchWindow;
  self.maxFetchWindow = maxFetchWindow;
  
  self.numBins = Math.ceil(genomeSize / optimalFetchWindow);
  self.binsLoaded = {};
  
  // Fire off ranges saved to afterBinSetup
  _.each(this.afterBinSetup, function(range) {
    self.fetchAsync(range.start, range.end, range.extraArgs);
  });
  _clearCallbacksForTooBigIntervals(self);
}


// Fetches data (if necessary) for unfetched bins overlapping with the interval from `start` to `end`.
// Then, run `callback` on all stored subintervals that overlap with the interval from `start` to `end`.
// `extraArgs` is an *optional* parameter that can contain arguments passed to the `.search()` function of the cache.
//
// @param (number) start:       1-based genomic coordinate to start fetching from
// @param (number) end:         1-based genomic coordinate (right-open) to start fetching *until*
// @param (Array) [extraArgs]:  optional, passed along to the `.search()` calls on the .cache as arguments 3 and up; 
//                              perhaps useful if the .cache has overridden this method
// @param (function) callback:  A function that will be called once data is ready for this interval. Will be passed
//                              all interval features that have been fetched for this interval, or {tooMany: true}
//                              if more data was requested than could be reasonably fetched.
RemoteTrack.prototype.fetchAsync = function(start, end, extraArgs, callback) {
  var self = this;
  if (_.isFunction(extraArgs) && _.isUndefined(callback)) { callback = extraArgs; extraArgs = undefined; }
  if (!self.binsLoaded) {
    // If bins *aren't* setup yet:
    // Save the callback onto the queue
    if (_.isFunction(callback)) { 
      self.callbacks.push({start: start, end: end, extraArgs: extraArgs, callback: callback}); 
    }
    
    // Save this fetch for when the bins are loaded
    self.afterBinSetup.push({start: start, end: end, extraArgs: extraArgs});
  } else {
    // If bins *are* setup, first calculate which bins correspond to this interval, 
    // and what state those bins are in
    var bins = _binOverlap(self, start, end),
      loadedBins = _.filter(bins, function(i) { return self.binsLoaded[i] === BIN_LOADED; }),
      binsToFetch = _.filter(bins, function(i) { return !self.binsLoaded[i]; });
    
    if (loadedBins.length == bins.length) {
      // If we've already loaded data for all the bins in question, short-circuit and run the callback now
      extraArgs = _.isUndefined(extraArgs) ? [] : extraArgs;
      return _.isFunction(callback) && callback(self.cache.search.apply(self.cache, [start, end].concat(extraArgs)));
    } else if (end - start > self.maxFetchWindow) {
      // else, if this interval is too big (> maxFetchWindow), fire the callback right away with {tooMany: true}
      return _.isFunction(callback) && callback({tooMany: true});
    }
    
    // else, push the callback onto the queue
    if (_.isFunction(callback)) { 
      self.callbacks.push({start: start, end: end, extraArgs: extraArgs, callback: callback}); 
    }
    
    // then run fetches for the unfetched bins, which should call _fireCallbacks after they complete,
    // which will automatically fire callbacks from the above queue as they acquire all needed data.
    _.each(binsToFetch, function(binIndex) {
      _fetchBin(self, binIndex, function() { _fireCallbacks(self); });
    });
  }
}


/**
 * private methods
 **/

// Calculates which bins overlap with an interval given by `start` and `end`.
// `start` and `end` are 1-based coordinates forming a right-open interval.
function _binOverlap(remoteTrk, start, end) {
  if (!remoteTrk.binsLoaded) { throw new Error('you cannot calculate bin overlap before setupBins is called.'); }
  // Internally, for assigning coordinates to bins, we use 0-based coordinates for easier calculations.
  var startBin = Math.floor((start - 1) / remoteTrk.optimalFetchWindow),
    endBin = Math.floor((end - 1) / remoteTrk.optimalFetchWindow);
  return _.range(startBin, endBin + 1);
}

// Runs the fetcher function on a given bin.
// The fetcher function is obligated to run a callback function `storeIntervals`, 
//    passed as its third argument, on a set of intervals that will be inserted into the 
//    remoteTrk.cache IntervalTree.
// The `storeIntervals` function may accept a second argument called `cacheIndex`, in case
//    remoteTrk.cache is actually a container for multiple IntervalTrees, indicating which 
//    one to store it in.
// We then call the `callback` given here after that is complete.
function _fetchBin(remoteTrk, binIndex, callback) {
  var start = binIndex * remoteTrk.optimalFetchWindow + 1,
    end = (binIndex + 1) * remoteTrk.optimalFetchWindow + 1;
  remoteTrk.binsLoaded[binIndex] = BIN_LOADING;
  remoteTrk.fetcher(start, end, function storeIntervals(intervals) {
    _.each(intervals, function(interval) {
      if (!interval) { return; }
      remoteTrk.cache.addIfNew(interval, interval.id);
    });
    remoteTrk.binsLoaded[binIndex] = BIN_LOADED;
    _.isFunction(callback) && callback();
  });
}

// Runs through all saved callbacks and fires any callbacks where all the required data is ready
// Callbacks that are fired are removed from the queue.
function _fireCallbacks(remoteTrk) {
  remoteTrk.callbacks = _.filter(remoteTrk.callbacks, function(afterLoad) {
    var callback = afterLoad.callback,
      extraArgs = _.isUndefined(afterLoad.extraArgs) ? [] : afterLoad.extraArgs,
      bins, stillLoadingBins;
        
    if (afterLoad.end - afterLoad.start > remoteTrk.maxFetchWindow) {
      callback({tooMany: true});
      return false;
    }
    
    bins = _binOverlap(remoteTrk, afterLoad.start, afterLoad.end);
    stillLoadingBins = _.filter(bins, function(i) { return remoteTrk.binsLoaded[i] !== BIN_LOADED; }).length > 0;
    if (!stillLoadingBins) {
      callback(remoteTrk.cache.search.apply(remoteTrk.cache, [afterLoad.start, afterLoad.end].concat(extraArgs)));
      return false;
    }
    return true;
  });
}

// Runs through all saved callbacks and fires any callbacks for which we won't load data since the amount
// requested is too large. Callbacks that are fired are removed from the queue.
function _clearCallbacksForTooBigIntervals(remoteTrk) {
  remoteTrk.callbacks = _.filter(remoteTrk.callbacks, function(afterLoad) {
    var callback = afterLoad.callback;
    if (afterLoad.end - afterLoad.start > remoteTrk.maxFetchWindow) {
      callback({tooMany: true});
      return false;
    }
    return true;
  });
}


exports.RemoteTrack = RemoteTrack;

})(module && module.exports || this);
},{"../../../underscore.min.js":34}],20:[function(require,module,exports){
(function(exports){
// TODO: backport this code for JavaScript 1.5? using underscore.js
/**
 * By Shin Suzuki, MIT license
 * https://github.com/shinout/SortedList
 *
 * SortedList : constructor
 * 
 * @param arr : Array or null : an array to set
 *
 * @param options : object  or null
 *         (function) filter  : filter function called before inserting data.
 *                              This receives a value and returns true if the value is valid.
 *
 *         (function) compare : function to compare two values, 
 *                              which is used for sorting order.
 *                              the same signature as Array.prototype.sort(fn).
 *                              
 *         (string)   compare : if you'd like to set a common comparison function,
 *                              you can specify it by string:
 *                              "number" : compares number
 *                              "string" : compares string
 */
function SortedList() {
  var arr     = null,
      options = {},
      args    = arguments;

  ["0","1"].forEach(function(n) {
    var val = args[n];
    if (Array.isArray(val)) {
      arr = val;
    }
    else if (val && typeof val == "object") {
      options = val;
    }
  });
  this.arr = [];

  ["filter", "compare"].forEach(function(k) {
    if (typeof options[k] == "function") {
      this[k] = options[k];
    }
    else if (options[k] && SortedList[k][options[k]]) {
      this[k] = SortedList[k][options[k]];
    }
  }, this);
  if (arr) this.massInsert(arr);
};

// Binary search for the index of the item equal to `val`, or if no such item exists, the next lower item
// This can be -1 if `val` is lower than the lowest item in the SortedList
SortedList.prototype.bsearch = function(val) {
  var mpos,
      spos = 0,
      epos = this.arr.length;
  while (epos - spos > 1) {
    mpos = Math.floor((spos + epos)/2);
    mval = this.arr[mpos];
    switch (this.compare(val, mval)) {
    case 1  :
    default :
      spos = mpos;
      break;
    case -1 :
      epos = mpos;
      break;
    case 0  :
      return mpos;
    }
  }
  return (this.arr[0] == null || spos == 0 && this.arr[0] != null && this.compare(this.arr[0], val) == 1) ? -1 : spos;
};

SortedList.prototype.get = function(pos) {
  return this.arr[pos];
};

SortedList.prototype.toArray = function(pos) {
  return this.arr.slice();
};

SortedList.prototype.slice = function() {
  return this.arr.slice.apply(this.arr, arguments);
}

SortedList.prototype.size = function() {
  return this.arr.length;
};

SortedList.prototype.head = function() {
  return this.arr[0];
};

SortedList.prototype.tail = function() {
  return (this.arr.length == 0) ? null : this.arr[this.arr.length -1];
};

SortedList.prototype.massInsert = function(items) {
  // This loop avoids call stack overflow because of too many arguments
  for (var i = 0; i < items.length; i += 4096) {
    Array.prototype.push.apply(this.arr, Array.prototype.slice.call(items, i, i + 4096));
  }
  this.arr.sort(this.compare);
}

SortedList.prototype.insert = function() {
  if (arguments.length > 100) {
    // .bsearch + .splice is too expensive to repeat for so many elements.
    // Let's just append them all to this.arr and resort.
    this.massInsert(arguments);
  } else {
    Array.prototype.forEach.call(arguments, function(val) {
      var pos = this.bsearch(val);
      if (this.filter(val, pos)) {
        this.arr.splice(pos+1, 0, val);
      }
    }, this);
  }
};

SortedList.prototype.filter = function(val, pos) {
  return true;
};

SortedList.prototype.add = SortedList.prototype.insert;

SortedList.prototype["delete"] = function(pos) {
  this.arr.splice(pos, 1);
};

SortedList.prototype.remove = SortedList.prototype["delete"];

SortedList.prototype.massRemove = function(startPos, count) {
  this.arr.splice(startPos, count);
};

/**
 * default compare functions 
 **/
SortedList.compare = {
  "number": function(a, b) {
    var c = a - b;
    return (c > 0) ? 1 : (c == 0)  ? 0 : -1;
  },

  "string": function(a, b) {
    return (a > b) ? 1 : (a == b)  ? 0 : -1;
  }
};

SortedList.prototype.compare = SortedList.compare["number"];

exports.SortedList = SortedList;

})(module && module.exports || this);
},{}],21:[function(require,module,exports){
var _ = require('../../../underscore.min.js');

// Parse a track declaration line, which is in the format of:
// track name="blah" optname1="value1" optname2="value2" ...
// into a hash of options
module.exports.parseDeclarationLine = function(line, start) {
  var opts = {}, optname = '', value = '', state = 'optname';
  function pushValue(quoting) {
    state = 'optname';
    opts[optname.replace(/^\s+|\s+$/g, '')] = value;
    optname = value = '';
  }
  for (i = line.match(start)[0].length; i < line.length; i++) {
    c = line[i];
    if (state == 'optname') {
      if (c == '=') { state = 'startvalue'; }
      else { optname += c; }
    } else if (state == 'startvalue') {
      if (/'|"/.test(c)) { state = c; }
      else { value += c; state = 'value'; }
    } else if (state == 'value') {
      if (/\s/.test(c)) { pushValue(); }
      else { value += c; }
    } else if (/'|"/.test(state)) {
      if (c == state) { pushValue(state); }
      else { value += c; }
    }
  }
  if (state == 'value') { pushValue(); }
  if (state != 'optname') { return false; }
  return opts;
}

// Constructs a mapping function that converts bp intervals into pixel intervals, with optional calculations for text too
module.exports.pixIntervalCalculator = function(start, width, bppp, withText, nameFunc, startkey, endkey) {
  if (!_.isFunction(nameFunc)) { nameFunc = function(d) { return d.name || ''; }; }
  if (_.isUndefined(startkey)) { startkey = 'start'; }
  if (_.isUndefined(endkey)) { endkey = 'end'; }
  return function(d) {
    var itvlStart = _.isUndefined(d[startkey]) ? d.start : d[startkey],
      itvlEnd = _.isUndefined(d[endkey]) ? d.end : d[endkey];
    var pInt = {
      x: Math.round((itvlStart - start) / bppp),
      w: Math.round((itvlEnd - itvlStart) / bppp) + 1,
      t: 0,          // calculated width of text
      oPrev: false,  // overflows into previous tile?
      oNext: false   // overflows into next tile?
    };
    pInt.tx = pInt.x;
    pInt.tw = pInt.w;
    if (pInt.x < 0) { pInt.w += pInt.x; pInt.x = 0; pInt.oPrev = true; }
    else if (withText) {
      pInt.t = _.isNumber(withText) ? withText : Math.min(nameFunc(d).length * 10 + 2, pInt.x);
      pInt.tx -= pInt.t;
      pInt.tw += pInt.t;  
    }
    if (pInt.x + pInt.w > width) { pInt.w = width - pInt.x; pInt.oNext = true; }
    return pInt;
  };
};

// For two given objects of the form {x: 1, w: 2} (pixel intervals), describe the overlap.
// Returns null if there is no overlap.
module.exports.pixIntervalOverlap = function(pInt1, pInt2) {
  var overlap = {},
    tmp;
  if (pInt1.x > pInt2.x) { tmp = pInt2; pInt2 = pInt1; pInt1 = tmp; }       // swap so that pInt1 is always lower
  if (!pInt1.w || !pInt2.w || pInt1.x + pInt1.w < pInt2.x) { return null; } // detect no-overlap conditions
  overlap.x = pInt2.x;
  overlap.w = Math.min(pInt1.w - pInt2.x + pInt1.x, pInt2.w);
  return overlap;
};

// Common functions for summarizing data in bins while plotting wiggle tracks
module.exports.wigBinFunctions = {
  minimum: function(bin) { return bin.length ? Math.min.apply(Math, bin) : 0; },
  mean: function(bin) { return _.reduce(bin, function(a,b) { return a + b; }, 0) / bin.length; },
  maximum: function(bin) { return bin.length ? Math.max.apply(Math, bin) : 0; }
};

// Faster than Math.floor (http://webdood.com/?p=219)
module.exports.floorHack = function(num) { return (num << 0) - (num < 0 ? 1 : 0); }

// Other tiny functions that we need for odds and ends...
module.exports.strip = function(str) { return str.replace(/^\s+|\s+$/g, ''); }
module.exports.parseInt10 = function(val) { return parseInt(val, 10); }
module.exports.deepClone = function(obj) { return JSON.parse(JSON.stringify(obj)); }
},{"../../../underscore.min.js":34}],22:[function(require,module,exports){
// ====================================================================
// = vcfTabix format: http://genome.ucsc.edu/goldenPath/help/vcf.html =
// ====================================================================

var utils = require('./utils/utils.js'),
  parseInt10 = utils.parseInt10;

// Intended to be loaded into CustomTrack.types.vcftabix
var VcfTabixFormat = {
  defaults: {
    priority: 100,
    drawLimit: {squish: 500, pack: 100},
    maxFetchWindow: 100000,
    chromosomes: ''
  },

  init: function() {
    if (!this.opts.bigDataUrl) {
      throw new Error("Required parameter bigDataUrl not found for vcfTabix track at " + JSON.stringify(this.opts) + (this.opts.lineNum + 1));
    }
  },

  parse: function(lines) {
    var self = this;
    self.heights = {max: null, min: 15, start: 15};
    self.sizes = ['dense', 'squish', 'pack'];
    self.mapSizes = ['pack'];
    // TODO: Set maxFetchWindow using some heuristic based on how many items are in the tabix index
    return true;
  },

  prerender: function(start, end, density, precalc, callback) {
    var self = this,
      width = precalc.width,
      data = self.data,
      bppp = (end - start) / width,
      range = this.chrRange(start, end);
    
    function lineToInterval(line) {
      var fields = line.split('\t'), data = {}, info = {};
      if (fields[7]) {
        _.each(fields[7].split(';'), function(l) { l = l.split('='); if (l.length > 1) { info[l[0]] = l[1]; } });
      }
      data.start = self.browserOpts.chrPos[fields[0]] + parseInt10(fields[1]);
      data.id = fields[2]=='.' ? 'vcf-' + Math.floor(Math.random() * 100000000) : fields[2];
      data.end = data.start + 1;
      data.ref = fields[3];
      data.alt = fields[4];
      data.qual = parseFloat(fields[5]);
      data.info = info;
      return {data: data};
    }
    function nameFunc(fields) {
      var ref = fields.ref || '',
        alt = fields.alt || '';
      return (ref.length > alt.length ? ref : alt) || '';
    }
  
    function success(data) {
      var drawSpec = [],
        lines = _.filter(data.split('\n'), function(l) { var m = l.match(/\t/g); return m && m.length > 8; }),
        calcPixInterval = new utils.pixIntervalCalculator(start, width, bppp, density=='pack', nameFunc);
      if (density == 'dense') {
        _.each(lines, function(line) {
          drawSpec.push(calcPixInterval(lineToInterval(line).data));
        });
      } else {
        drawSpec = {layout: self.type('bed').stackedLayout(_.map(lines, lineToInterval), width, calcPixInterval)};
        drawSpec.width = width;
      }
      callback(drawSpec);
    }
  
    // Don't even attempt to fetch the data if we can reasonably estimate that we will fetch too much data, as this will only delay other requests.
    // TODO: cache results so we aren't refetching the same regions over and over again.
    if ((end - start) > self.opts.maxFetchWindow) {
      callback({tooMany: true});
    } else {
      $.ajax(this.ajaxDir() + 'tabix.php', {
        data: {range: range, url: this.opts.bigDataUrl},
        success: success
      });
    }
  },

  render: function(canvas, start, end, density, callback) {
    var ctx = canvas.getContext && canvas.getContext('2d'),
      urlTemplate = this.opts.url ? this.opts.url : 'javascript:void("'+this.opts.name+':$$")',
      lineHeight = density == 'pack' ? 27 : 6,
      colors = {a:'255,0,0', t:'255,0,255', c:'0,0,255', g:'0,255,0'},
      drawLimit = this.opts.drawLimit && this.opts.drawLimit[density],
      areas = null;
    if (!ctx) { throw "Canvas not supported"; }
    if (density == 'pack') { areas = this.areas[canvas.id] = []; }
    ctx.fillStyle = "rgb(0,0,0)";
    this.prerender(start, end, density, {width: canvas.width}, function(drawSpec) {
      if ((drawLimit && drawSpec.length > drawLimit) || drawSpec.tooMany) { 
        canvas.height = 0;
        // This applies styling that indicates there was too much data to load/draw and that the user needs to zoom to see more
        canvas.className = canvas.className + ' too-many';
      } else if (density == 'dense') {
        canvas.height = 15;
        _.each(drawSpec, function(pInt) {
          ctx.fillRect(pInt.x, 1, pInt.w, 13);
        });
      } else {
        canvas.height = drawSpec.layout.length * lineHeight;
        _.each(drawSpec.layout, function(l, i) {
          _.each(l, function(data) {
            var altColor, refColor;
            if (areas) {
              refColor = colors[data.d.ref.toLowerCase()] || '255,0,0';
              altColor = colors[data.d.alt.toLowerCase()] || '255,0,0';
              ctx.fillStyle = "rgb(" + altColor + ")"; 
            }
            ctx.fillRect(data.pInt.x, i * lineHeight + 1, data.pInt.w, lineHeight - 1);
            if (areas) {
              areas.push([
                data.pInt.x, i * lineHeight + 1, data.pInt.x + data.pInt.w, (i + 1) * lineHeight, //x1, x2, y1, y2
                data.d.ref + ' > ' + data.d.alt, // title
                urlTemplate.replace('$$', data.d.id), // href
                data.pInt.oPrev, // continuation from previous tile?
                altColor, // label color
                '<span style="color: rgb(' + refColor + ')">' + data.d.ref + '</span><br/>' + data.d.alt, // label
                data.d.info
              ]);
            }
          });
        });
      }
      if (_.isFunction(callback)) { callback(); }
    });
  }
};

module.exports = VcfTabixFormat;


},{"./utils/utils.js":21}],23:[function(require,module,exports){
(function (global){
// ==================================================================
// = WIG format: http://genome.ucsc.edu/goldenPath/help/wiggle.html =
// ==================================================================

var utils = require('./utils/utils.js'),
  parseInt10 = utils.parseInt10,
  parseDeclarationLine = utils.parseDeclarationLine;
var SortedList = require('./utils/SortedList.js').SortedList;

// Intended to be loaded into CustomTrack.types.wiggle_0
var WiggleFormat = {
  defaults: {
    altColor: '',
    priority: 100,
    autoScale: 'on',
    alwaysZero: 'off',
    gridDefault: 'off',
    maxHeightPixels: '128:128:15',
    graphType: 'bar',
    viewLimits: '',
    yLineMark: 0.0,
    yLineOnOff: 'off',
    windowingFunction: 'maximum',
    smoothingWindow: 'off'
  },

  init: function() {
    this.type().initOpts.call(this);
  },
  
  _binFunctions: utils.wigBinFunctions,
  
  initOpts: function() {
    var o = this.opts,
      _binFunctions = this.type()._binFunctions;
    if (!this.validateColor(o.altColor)) { o.altColor = ''; }
    o.viewLimits = _.map(o.viewLimits.split(':'), parseFloat);
    o.maxHeightPixels = _.map(o.maxHeightPixels.split(':'), parseInt10);
    o.yLineOnOff = this.isOn(o.yLineOnOff);
    o.yLineMark = parseFloat(o.yLineMark);
    o.autoScale = this.isOn(o.autoScale);
    if (_binFunctions && !_binFunctions[o.windowingFunction]) {
      throw new Error("invalid windowingFunction at line " + o.lineNum); 
    }
    if (_.isNaN(o.yLineMark)) { o.yLineMark = 0.0; }
  },
  
  applyOpts: function() {
    var self = this,
      o = self.opts;
    self.drawRange = o.autoScale || o.viewLimits.length < 2 ? self.range : o.viewLimits;
    _.each({max: 0, min: 2, start: 1}, function(v, k) { self.heights[k] = o.maxHeightPixels[v]; });
    if (!o.altColor) {
      var hsl = this.rgbToHsl.apply(this, o.color.split(/,\s*/g));
      hsl[0] = hsl[0] + 0.02 % 1;
      hsl[1] = hsl[1] * 0.7;
      hsl[2] = 1 - (1 - hsl[2]) * 0.7;
      self.altColor = _.map(this.hslToRgb.apply(this, hsl), parseInt10).join(',');
    }
  },

  parse: function(lines) {
    var self = this,
      genomeSize = this.browserOpts.genomeSize,
      data = {all: []},
      mode, modeOpts, chrPos, m;
    self.range = self.isOn(this.opts.alwaysZero) ? [0, 0] : [Infinity, -Infinity];
  
    _.each(lines, function(line, lineno) {
      var val, start;
      
      m = line.match(/^(variable|fixed)Step\s+/i);
      if (m) {
        mode = m[1].toLowerCase();
        modeOpts = parseDeclarationLine(line, /^(variable|fixed)Step\s+/i);
        modeOpts.start = parseInt10(modeOpts.start);
        if (mode == 'fixed' && (_.isNaN(modeOpts.start) || !modeOpts.start)) {
          throw new Error("fixedStep at line " + (lineno + 1 + self.opts.lineNum) + " require non-zero start parameter"); 
        }
        modeOpts.step = parseInt10(modeOpts.step);
        if (mode == 'fixed' && (_.isNaN(modeOpts.step) || !modeOpts.step)) {
          throw new Error("fixedStep at line " + (lineno + 1 + self.opts.lineNum) + " require non-zero step parameter"); 
        }
        modeOpts.span = parseInt10(modeOpts.span) || 1;
        chrPos = self.browserOpts.chrPos[modeOpts.chrom];
        if (_.isUndefined(chrPos)) {
          self.warn("Invalid chromosome at line " + (lineno + 1 + self.opts.lineNum));
        }
      } else {
        if (!mode) { 
          throw new Error("Wiggle format at " + (lineno + 1 + self.opts.lineNum) + " has no preceding mode declaration"); 
        } else if (_.isUndefined(chrPos)) {
          // invalid chromosome
        } else {
          if (mode == 'fixed') {
            val = parseFloat(line);
            data.all.push({start: chrPos + modeOpts.start, end: chrPos + modeOpts.start + modeOpts.span, val: val});
            modeOpts.start += modeOpts.step;
          } else {
            line = line.split(/\s+/);
            if (line.length < 2) {
              throw new Error("variableStep at line " + (lineno + 1 + self.opts.lineNum) + " requires two values per line"); 
            }
            start = parseInt10(line[0]);
            val = parseFloat(line[1]);
            data.all.push({start: chrPos + start, end: chrPos + start + modeOpts.span, val: val});
          }
        }
      }
    });
    
    return self.type().finishParse.call(self, data);
  },
  
  finishParse: function(data) {
    var self = this,
      binFunction = self.type()._binFunctions[self.opts.windowingFunction];
    if (data.all.length > 0) {
      self.range[0] = _.min(data.all, function(d) { return d.val; }).val;
      self.range[1] = _.max(data.all, function(d) { return d.val; }).val;
    }
    data.all = new SortedList(data.all, {
      compare: function(a, b) {
        if (a === null) return -1;
        if (b === null) return  1;
        var c = a.start - b.start;
        return (c > 0) ? 1 : (c === 0)  ? 0 : -1;
      }
    });
  
    // Pre-optimize data for high bppps by downsampling
    _.each(self.browserOpts.bppps, function(bppp) {
      if (self.browserOpts.genomeSize / bppp > 1000000) { return; }
      var pixLen = Math.ceil(self.browserOpts.genomeSize / bppp),
        downsampledData = (data[bppp] = (global.Float32Array ? new Float32Array(pixLen) : new Array(pixLen))),
        j = 0,
        curr = data.all.get(0),
        bin, next;
      for (var i = 0; i < pixLen; i++) {
        bin = curr && (curr.start <= i * bppp && curr.end > i * bppp) ? [curr.val] : [];
        while ((next = data.all.get(j + 1)) && next.start < (i + 1) * bppp && next.end > i * bppp) { 
          bin.push(next.val); ++j; curr = next; 
        }
        downsampledData[i] = binFunction(bin);
      }
      data._binFunction = self.opts.windowingFunction;
    });
    self.data = data;
    self.stretchHeight = true;
    self.type('wiggle_0').applyOpts.apply(self);
    return true; // success!
  },
  
  initDrawSpec: function(precalc) {
    var vScale = (this.drawRange[1] - this.drawRange[0]) / precalc.height,
      drawSpec = {
        bars: [],
        vScale: vScale,
        yLine: this.isOn(this.opts.yLineOnOff) ? Math.round((this.opts.yLineMark - this.drawRange[0]) / vScale) : null, 
        zeroLine: -this.drawRange[0] / vScale
      };
    return drawSpec;
  },

  prerender: function(start, end, density, precalc, callback) {
    var self = this,
      bppp = (end - start) / precalc.width,
      drawSpec = self.type().initDrawSpec.call(self, precalc),
      binFunction = self.type()._binFunctions[self.opts.windowingFunction],
      downsampledData;
    if (self.data._binFunction == self.opts.windowingFunction && (downsampledData = self.data[bppp])) {
      // We've already pre-optimized for this bppp
      drawSpec.bars = _.map(_.range((start - 1) / bppp, (end - 1) / bppp), function(xFromOrigin, x) {
        return ((downsampledData[xFromOrigin] || 0) - self.drawRange[0]) / drawSpec.vScale;
      });
    } else {
      // We have to do the binning on the fly
      var j = self.data.all.bsearch({start: start}),
        curr = self.data.all.get(j), next, bin;
      for (var i = 0; i < precalc.width; i++) {
        bin = curr && (curr.end >= i * bppp + start) ? [curr.val] : [];
        while ((next = self.data.all.get(j + 1)) && next.start < (i + 1) * bppp + start && next.end >= i * bppp + start) { 
          bin.push(next.val); ++j; curr = next; 
        }
        drawSpec.bars.push((binFunction(bin) - self.drawRange[0]) / drawSpec.vScale);
      }
    }
    return _.isFunction(callback) ? callback(drawSpec) : drawSpec;
  },
  
  drawBars: function(ctx, drawSpec, height, width) {
    var zeroLine = drawSpec.zeroLine, // pixel position of the data value 0
      color = "rgb("+this.opts.color+")",
      altColor = "rgb("+(this.opts.altColor || this.altColor)+")",
      pointGraph = this.opts.graphType==='points';
    
    ctx.fillStyle = color;
    _.each(drawSpec.bars, function(d, x) {
      if (d === null) { return; }
      else if (d > zeroLine) { 
        if (pointGraph) { ctx.fillRect(x, height - d, 1, 1); }
        else { ctx.fillRect(x, height - d, 1, zeroLine > 0 ? (d - zeroLine) : d); }
      } else {
        ctx.fillStyle = altColor;
        if (pointGraph) { ctx.fillRect(x, zeroLine - d - 1, 1, 1); } 
        else { ctx.fillRect(x, height - zeroLine, 1, zeroLine - d); }
        ctx.fillStyle = color;
      }
    });
    if (drawSpec.yLine !== null) {
      ctx.fillStyle = "rgb(0,0,0)";
      ctx.fillRect(0, height - drawSpec.yLine, width, 1);
    }
  },

  render: function(canvas, start, end, density, callback) {
    var self = this,
      height = canvas.height,
      width = canvas.width,
      ctx = canvas.getContext && canvas.getContext('2d');
    if (!ctx) { throw "Canvas not supported"; }
    self.prerender(start, end, density, {width: width, height: height}, function(drawSpec) {
      self.type().drawBars.call(self, ctx, drawSpec, height, width);
      if (_.isFunction(callback)) { callback(); }
    });
  },
  
  loadOpts: function($dialog) {
    var o = this.opts,
      $viewLimits = $dialog.find('.view-limits'),
      $maxHeightPixels = $dialog.find('.max-height-pixels'),
      altColorOn = this.validateColor(o.altColor);
    $dialog.find('[name=altColorOn]').attr('checked', altColorOn).change();
    $dialog.find('[name=altColor]').val(altColorOn ? o.altColor :'128,128,128').change();
    $dialog.find('[name=autoScale]').attr('checked', !this.isOn(o.autoScale)).change();
    $viewLimits.slider("option", "min", this.range[0]);
    $viewLimits.slider("option", "max", this.range[1]);
    $dialog.find('[name=viewLimitsMin]').val(this.drawRange[0]).change();
    $dialog.find('[name=viewLimitsMax]').val(this.drawRange[1]).change();
    $dialog.find('[name=yLineOnOff]').attr('checked', this.isOn(o.yLineOnOff)).change();
    $dialog.find('[name=yLineMark]').val(o.yLineMark).change();
    $dialog.find('[name=graphType]').val(o.graphType).change();
    $dialog.find('[name=windowingFunction]').val(o.windowingFunction).change();
    $dialog.find('[name=maxHeightPixelsOn]').attr('checked', o.maxHeightPixels.length >= 3);
    $dialog.find('[name=maxHeightPixelsMin]').val(o.maxHeightPixels[2]).change();
    $dialog.find('[name=maxHeightPixelsMax]').val(o.maxHeightPixels[0]).change();
  },
  
  saveOpts: function($dialog) {
    var o = this.opts,
      altColorOn = $dialog.find('[name=altColorOn]').is(':checked'),
      maxHeightPixelsOn = $dialog.find('[name=maxHeightPixelsOn]').is(':checked'),
      maxHeightPixelsMax = $dialog.find('[name=maxHeightPixelsMax]').val();
    o.altColor = altColorOn ? $dialog.find('[name=altColor]').val() : '';
    o.autoScale = !$dialog.find('[name=autoScale]').is(':checked');
    o.viewLimits = $dialog.find('[name=viewLimitsMin]').val() + ':' + $dialog.find('[name=viewLimitsMax]').val();
    o.yLineOnOff = $dialog.find('[name=yLineOnOff]').is(':checked');
    o.yLineMark = $dialog.find('[name=yLineMark]').val();
    o.graphType = $dialog.find('[name=graphType]').val();
    o.windowingFunction = $dialog.find('[name=windowingFunction]').val();
    o.maxHeightPixels = maxHeightPixelsOn ? 
      [maxHeightPixelsMax, maxHeightPixelsMax, $dialog.find('[name=maxHeightPixelsMin]').val()].join(':') : '';
    this.type('wiggle_0').initOpts.call(this);
  }
  
};

module.exports = WiggleFormat;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./utils/SortedList.js":20,"./utils/utils.js":21}],24:[function(require,module,exports){
/*! jQuery v1.7.1 jquery.com | jquery.org/license | modified to use browserify/npm style module.exports */
module.exports = function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cv(a){if(!ck[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){cl||(cl=c.createElement("iframe"),cl.frameBorder=cl.width=cl.height=0),b.appendChild(cl);if(!cm||!cl.createElement)cm=(cl.contentWindow||cl.contentDocument).document,cm.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),cm.close();d=cm.createElement(a),cm.body.appendChild(d),e=f.css(d,"display"),b.removeChild(cl)}ck[a]=e}return ck[a]}function cu(a,b){var c={};f.each(cq.concat.apply([],cq.slice(0,b)),function(){c[this]=a});return c}function ct(){cr=b}function cs(){setTimeout(ct,0);return cr=f.now()}function cj(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ci(){try{return new a.XMLHttpRequest}catch(b){}}function cc(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function cb(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function ca(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bE.test(a)?d(a,e):ca(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)ca(a+"["+e+"]",b[e],c,d);else d(a,b)}function b_(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function b$(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bT,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=b$(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=b$(a,c,d,e,"*",g));return l}function bZ(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bP),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bC(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bx:by,g=0,h=e.length;if(d>0){if(c!=="border")for(;g<h;g++)c||(d-=parseFloat(f.css(a,"padding"+e[g]))||0),c==="margin"?d+=parseFloat(f.css(a,c+e[g]))||0:d-=parseFloat(f.css(a,"border"+e[g]+"Width"))||0;return d+"px"}d=bz(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0;if(c)for(;g<h;g++)d+=parseFloat(f.css(a,"padding"+e[g]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+e[g]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+e[g]))||0);return d+"px"}function bp(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(f.expando)}}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i)for(d=0,e=i[c].length;d<e;d++)f.event.add(b,c+(i[c][d].namespace?".":"")+i[c][d].namespace,i[c][d],i[c][d].data)}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function T(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function K(){return!0}function J(){return!1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?parseFloat(d):j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else d=b}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H)return H.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)e.access(a,j,c[j],f,g,d);return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++)g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test("")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++)g=b[d],h=f.type(g),h==="array"?m(g):h==="function"&&(!a.unique||!o.has(g))&&c.push(g)},n=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,l=j||0,j=0,k=c.length;for(;c&&l<k;l++)if(c[l].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}i=!1,c&&(a.once?e===!0?o.disable():c=[]:d&&d.length&&(e=d.shift(),o.fireWith(e[0],e[1])))},o={add:function(){if(c){var a=c.length;m(arguments),i?k=c.length:e&&e!==!0&&(j=a,n(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var f=0;f<c.length;f++)if(b[d]===c[f]){i&&f<=k&&(k--,f<=l&&l--),c.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return!c},lock:function(){d=b,(!e||e===!0)&&o.disable();return this},locked:function(){return!d},fireWith:function(b,c){d&&(i?a.once||d.push([b,c]):(!a.once||!e)&&n(b,c));return this},fire:function(){o.fireWith(this,arguments);return this},fired:function(){return!!e}};return o};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({}),j;for(j in g)i[j]=g[j].fire,i[j+"With"]=g[j].fireWith;i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g;g||j.resolveWith(j,b)}else j!==a&&j.resolveWith(j,d?[a]:[]);return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p,q=c.createElement("div"),r=c.documentElement;q.setAttribute("className","t"),q.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=q.getElementsByTagName("*"),e=q.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=q.getElementsByTagName("input")[0],b={leadingWhitespace:q.firstChild.nodeType===3,tbody:!q.getElementsByTagName("tbody").length,htmlSerialize:!!q.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:q.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete q.test}catch(s){b.deleteExpando=!1}!q.addEventListener&&q.attachEvent&&q.fireEvent&&(q.attachEvent("onclick",function(){b.noCloneEvent=!1}),q.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),q.appendChild(i),k=c.createDocumentFragment(),k.appendChild(q.lastChild),b.checkClone=k.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,k.removeChild(i),k.appendChild(q),q.innerHTML="",a.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",q.style.width="2px",q.appendChild(j),b.reliableMarginRight=(parseInt((a.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0);if(q.attachEvent)for(o in{submit:1,change:1,focusin:1})n="on"+o,p=n in q,p||(q.setAttribute(n,"return;"),p=typeof q[n]=="function"),b[o+"Bubbles"]=p;k.removeChild(q),k=g=h=j=q=i=null,f(function(){var a,d,e,g,h,i,j,k,m,n,o,r=c.getElementsByTagName("body")[0];!r||(j=1,k="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",m="visibility:hidden;border:0;",n="style='"+k+"border:5px solid #000;padding:0;'",o="<div "+n+"><div></div></div>"+"<table "+n+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",a=c.createElement("div"),a.style.cssText=m+"width:0;height:0;position:static;top:0;margin-top:"+j+"px",r.insertBefore(a,r.firstChild),q=c.createElement("div"),a.appendChild(q),q.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",l=q.getElementsByTagName("td"),p=l[0].offsetHeight===0,l[0].style.display="",l[1].style.display="none",b.reliableHiddenOffsets=p&&l[0].offsetHeight===0,q.innerHTML="",q.style.width=q.style.paddingLeft="1px",f.boxModel=b.boxModel=q.offsetWidth===2,typeof q.style.zoom!="undefined"&&(q.style.display="inline",q.style.zoom=1,b.inlineBlockNeedsLayout=q.offsetWidth===2,q.style.display="",q.innerHTML="<div style='width:4px;'></div>",b.shrinkWrapBlocks=q.offsetWidth!==2),q.style.cssText=k+m,q.innerHTML=o,d=q.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,i={doesNotAddBorder:e.offsetTop!==5,doesAddBorderForTableAndCells:h.offsetTop===5},e.style.position="fixed",e.style.top="20px",i.fixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",i.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,i.doesNotIncludeMarginInBodyOffset=r.offsetTop!==j,r.removeChild(a),q=a=null,f.extend(b,i))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b)return;n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c);g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c])return g.events;k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k])return;if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++)delete d[b[e]];if(!(c?m:f.isEmptyObject)(d))return}}if(!c){delete j[k].data;if(!m(j[k]))return}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d,e,g,h=null;if(typeof a=="undefined"){if(this.length){h=f.data(this[0]);if(this[0].nodeType===1&&!f._data(this[0],"parsedAttrs")){e=this[0].attributes;for(var i=0,j=e.length;i<j;i++)g=e[i].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),l(this[0],g,h[g]));f._data(this[0],"parsedAttrs",!0)}}return h}if(typeof a=="object")return this.each(function(){f.data(this,a)});d=a.split("."),d[1]=d[1]?"."+d[1]:"";if(c===b){h=this.triggerHandler("getData"+d[1]+"!",[d[0]]),h===b&&this.length&&(h=f.data(this[0],a),h=l(this[0],a,h));return h===b&&d[1]?this.data(d[0]):h}return this.each(function(){var b=f(this),e=[d[0],c];b.triggerHandler("setData"+d[1]+"!",e),f.data(this,a,c),b.triggerHandler("changeData"+d[1]+"!",e)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b)return f.queue(this[0],a);return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0))h++,l.add(m);m();return d.promise()}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,g=this[0];{if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}if(g){c=f.valHooks[g.nodeName.toLowerCase()]||f.valHooks[g.type];if(c&&"get"in c&&(d=c.get(g,"value"))!==b)return d;d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0)return null;c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j)return b;h.push(b)}}if(j&&!h.length&&i.length)return f(i[g]).val();return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn)return f(a)[c](d);if(typeof a.getAttribute=="undefined")return f.prop(a,c,d);i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set"in h&&i&&(g=h.set(a,d,c))!==b)return g;a.setAttribute(c,""+d);return d}if(h&&"get"in h&&i&&(g=h.get(a,c))!==null)return g;g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;h<g;h++)e=d[h],e&&(c=f.propFix[e]||e,f.attr(a,e,""),a.removeAttribute(v?e:c),u.test(e)&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button"))return w.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button"))return w.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set"in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get"in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/\bhover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};
f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1)a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o)f.event.remove(a,j+b[h],c,d,!0);continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++)s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s));r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered))return;h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h])return;c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j)j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1)return;r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode)r.push([m,s]),n=m;n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++)m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault();c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=[],j,k,l,m,n,o,p,q,r,s,t;g[0]=c,c.delegateTarget=this;if(e&&!c.target.disabled&&(!c.button||c.type!=="click")){m=f(this),m.context=this.ownerDocument||this;for(l=c.target;l!=this;l=l.parentNode||this){o={},q=[],m[0]=l;for(j=0;j<e;j++)r=d[j],s=r.selector,o[s]===b&&(o[s]=r.quick?H(l,r.quick):m.is(s)),o[s]&&q.push(r);q.length&&i.push({elem:l,matches:q})}}d.length>e&&i.push({elem:this,matches:d.slice(e)});for(j=0;j<i.length&&!c.isPropagationStopped();j++){p=i[j],c.currentTarget=p.elem;for(k=0;k<p.matches.length&&!c.isImmediatePropagationStopped();k++){r=p.matches[k];if(h||!c.namespace&&!r.namespace||c.namespace_re&&c.namespace_re.test(r.namespace))c.data=r.data,c.handleObj=r,n=((f.event.special[r.origType]||{}).handle||r.handler).apply(p.elem,g),n!==b&&(c.result=n,n===!1&&(c.preventDefault(),c.stopPropagation()))}}return c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando])return a;var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;)e=i[--d],a[e]=g[e];a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event))return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d))a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b;return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form"))return!1;f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0)}),d._submit_attached=!0)})},teardown:function(){if(f.nodeName(this,"form"))return!1;f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))});return!1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=J;else if(!e)return this;g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.type+"."+e.namespace:e.type,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a)this.off(g,c,a[g]);return this}if(c===!1||typeof c=="function")d=c,c=b;d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return e;var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b))if(w.length===2&&o.relative[w[0]])j=y(w[0]+w[1],d,f);else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length)b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length)q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}else k=w=[]}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]")if(!u)e.push.apply(e,k);else if(d&&d.nodeType===1)for(t=0;k[t]!=null;t++)k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t]);else for(t=0;k[t]!=null;t++)k[t]&&k[t].nodeType===1&&e.push(j[t]);else s(k,e);l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=m(b[3],null,null,c);else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],e=b[3];if(c===1&&e===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return s(e.getElementsByTagName(b),f);if(h[2]&&o.find.CLASS&&e.getElementsByClassName)return s(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return s([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return s([],f);if(i.id===h[3])return s([i],f)}try{return s(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p)return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}catch(r){}finally{l||k.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)m[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.POS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++)f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h});g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var V="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))});if(typeof a!="object"&&a!==b)return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function()
{for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,bp)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||!bc.test("<"+a.nodeName)?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g)e[g]&&bk(d[g],e[g])}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g)bj(d[g],e[g])}}d=e=null;return h},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k)continue;if(typeof k=="string")if(!_.test(k))k=b.createTextNode(k);else{k=k.replace(Y,"<$1></$2>");var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=bg[l]||bg._default,n=m[0],o=b.createElement("div");b===c?bh.appendChild(o):U(b).appendChild(o),o.innerHTML=m[1]+k+m[2];while(n--)o=o.lastChild;if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i)f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes}var r;if(!f.support.appendChecked)if(k[0]&&typeof (r=k.length)=="number")for(i=0;i<r;i++)bn(k[i]);else bn(k);k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return!a.type||be.test(a.type)};for(j=0;h[j];j++)if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript"))e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()])continue;c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events)e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle);b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bq=/alpha\([^)]*\)/i,br=/opacity=([^)]*)/,bs=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,bu=/^-?\d/,bv=/^([\-+])=([\-+.\de]+)/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Left","Right"],by=["Top","Bottom"],bz,bA,bB;f.fn.css=function(a,c){if(arguments.length===2&&c===b)return this;return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bz(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=bv.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(bz)return bz(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0)return bC(a,b,d);f.swap(a,bw,function(){e=bC(a,b,d)});return e}},set:function(a,b){if(!bt.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return br.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bq,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bq.test(g)?g.replace(bq,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bz(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bA=function(a,b){var c,d,e;b=b.replace(bs,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b)));return c}),c.documentElement.currentStyle&&(bB=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f===null&&g&&(e=g[b])&&(f=e),!bt.test(f)&&bu.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),bz=bA||bB,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)});var bD=/%20/g,bE=/\[\]$/,bF=/\r?\n/g,bG=/#.*$/,bH=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bI=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bJ=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bK=/^(?:GET|HEAD)$/,bL=/^\/\//,bM=/\?/,bN=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bO=/^(?:select|textarea)/i,bP=/\s+/,bQ=/([?&])_=[^&]*/,bR=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bS=f.fn.load,bT={},bU={},bV,bW,bX=["*/"]+["*"];try{bV=e.href}catch(bY){bV=c.createElement("a"),bV.href="",bV=bV.href}bW=bR.exec(bV.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bS)return bS.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bN,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bO.test(this.nodeName)||bI.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bF,"\r\n")}}):{name:b.name,value:c.replace(bF,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b_(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b_(a,b);return a},ajaxSettings:{url:bV,isLocal:bJ.test(bW[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bX},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bZ(bT),ajaxTransport:bZ(bU),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?cb(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=cc(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bH.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bG,"").replace(bL,bW[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bP),d.crossDomain==null&&(r=bR.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bW[1]&&r[2]==bW[2]&&(r[3]||(r[1]==="http:"?80:443))==(bW[3]||(bW[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),b$(bT,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bK.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bM.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bQ,"$1_="+x);d.url=y+(y===d.url?(bM.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bX+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=b$(bU,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2)w(-1,z);else throw z}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)ca(g,a[g],c,e);return d.join("&").replace(bD,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cd=f.now(),ce=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cd++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ce.test(b.url)||e&&ce.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ce,l),b.url===j&&(e&&(k=k.replace(ce,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cf=a.ActiveXObject?function(){for(var a in ch)ch[a](0,1)}:!1,cg=0,ch;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ci()||cj()}:ci,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cf&&delete ch[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cg,cf&&(ch||(ch={},f(a).unload(cf)),ch[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var ck={},cl,cm,cn=/^(?:toggle|show|hide)$/,co=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cp,cq=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cr;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(cu("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cv(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(cu("hide",3),a,b,c);var d,e,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cu("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cv(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new f.fx(this,b,i),h=a[i],cn.test(h)?(o=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),o?(f._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=co.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(f.cssNumber[i]?"":"px"),n!=="px"&&(f.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,f.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""));return!0}var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null)for(b in g)g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b);else g[b=a+".run"]&&g[b].stop&&h(this,g,b);for(b=e.length;b--;)e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1));(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:cu("show",1),slideUp:cu("hide",1),slideToggle:cu("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cr||cs(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){e.options.hide&&f._data(e.elem,"fxshow"+e.prop)===b&&f._data(e.elem,"fxshow"+e.prop,e.start)},h()&&f.timers.push(h)&&!cp&&(cp=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cr||cs(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(g=!1);if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cp),cp=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(["width","height"],function(a,b){f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=e.body,i=cy(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.support.fixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;f.support.fixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e)return null;g=cy(e);return g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cy(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,d,"padding")):this[d]():null},f.fn["outer"+c]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,d,a?"margin":"border")):this[d]():null},f.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(f.isFunction(a))return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))});if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var i=f.css(e,d),j=parseFloat(i);return f.isNumeric(j)?j:i}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})};
},{}],25:[function(require,module,exports){
module.exports = (function($){

  require('./jquery.misc-plugins.js')($);
  require('./jquery.tiptip.js')($);  
  require('./jquery.farbtastic.js')($);
  
  var _ = require('../underscore.min.js');
  // Sum elements of an array
  _.sum = function(arr) { return _.reduce(arr, function(memo, next) { return memo + next; }, 0); }

  var utils = require('./utils.js')($),
    classFriendly = utils.classFriendly,
    fps = utils.fps,
    basename = utils.basename,
    floorHack = utils.floorHack,
    decodeSafeOctets = utils.decodeSafeOctets,
    regExpQuote = utils.regExpQuote;

  /****************************************************************************************/
  //
  // We have three widgets that are built on the jQuery UI $.widget framework
  //    1) $.ui.genobrowser
  //    2) $.ui.genoline
  //    3) $.ui.genotrack
  //
  /****************************************************************************************/

  require('./jquery-ui.genoline.js')($);
  require('./jquery-ui.genotrack.js')($);

  // =======================================================================================
  // = $.ui.genobrowser is the central widget that coordinates the front-end of chromozoom =
  // =======================================================================================

  $.widget('ui.genobrowser', {

    // Default options that are overridden by the genome JSON configuration when this widget is instantiated
    options: {
      disabled: false,
      betweenLines: 20,
      tileWidth: 1000,
      genome: 'hg18',
      genomeSize: 3080419480,
      sideBarWidth: 100,
      tracks: [
        {n:'ruler', h:50, s:['dense']}
      ],
      chrOrder: [],
      chrLengths: {},
      chrBands: [],
      availTracks: [],
      tileDir: 'o/',
      ajaxDir: 'php/',
      bppps: [2.9e5],
      overzoomBppps: [],
      initZoom: 2.9e5,
      ideogramsAbove: 3.3e4,
      bpppNumbersBelow: [3.3e4, 3.3e3],
      ntsBelow: [1, 0.1],
      navBar: '#navbar',
      footerBar: '#footerbar',
      zoomSlider: '#zoom',
      zoomBtns: ['#zoom-in', '#zoom-out'],
      trackPicker: ['#tracks', '#track-picker', '#custom-tracks', '#custom-picker'],
      jump: ['#loc', '#jump', '#loc-picker'],
      genomePicker: ['#genome', '#genome-picker'],
      lineMode: '#line-mode',
      linking: ['#linking', '#link-picker'],
      overlay: ['#overlay', '#overlay-message'],
      lineFixDuration: 500,
      reticOpacity: 0.8,
      verticalDragDeadZone: 12,
      maxNtRequest: 20000,
      bounceMargin: 0.2,
      dialogs: ['#custom-dialog', '#quickstart', '#about', '#old-msie', '#chrom-sizes-dialog', '#custom-genome-dialog', '#binaries-warning-dialog'],
      ucscURL: 'http://genome.ucsc.edu/cgi-bin/hgTracks',
      trackDescURL: 'http://genome.ucsc.edu/cgi-bin/hgTrackUi',
      bpppFormat: function(bppp) { return bppp.toExponential(2).replace(/(\+|-)(\d)$/, '$10$2'); },
      useCanvasTicks: true,
      savableParams: {session: ['position', 'tracks'], persistent: ['mode']}
      //,snapZoom: true
      //,snapZoomAfter: 200
    },

    // ====================================================================
    // = The following _init functions handle instantiation-related tasks =
    // ====================================================================

    // Called automatically when widget is instantiated
    _init: function() {
      var self = this,
        $elem = self.element, 
        o = self.options;
      
      // Setup internal variables
      self._initInstanceVars();
      
      // Initialize some of the navbar widgets
      self.$slider = self._initSlider();
      self.$trackPicker = self._initTrackPicker();
      self.$customTracks = self._initCustomTracks();
      self.$links = self._initLinking();
      
      // Debounce some of the handler functions; this prevents it from firing more than once per X milliseconds
      // This cuts down on the load of some of the more expensive actions
      self._finishZoomDebounced = _.debounce(self._finishZoomDebounced, o.snapZoomAfter || 500);
      self._updateReticleDebounced = _.debounce(self._updateReticle, o.snapZoomAfter || 500);
      self._normalizePosDebounced = _.debounce(self.normalizePos, 200);
      self._fixZoomedTrackDebounced = _.debounce(self._fixZoomedTrackDebounced, 500);
      self._fixClickAreasDebounced = _.debounce(self._fixClickAreasDebounced, 500);
      self._saveParamsDebounced = _.debounce(self._saveParamsDebounced, 500);
      
      // Bind event handlers for the window and main widgets
      $(window).resize(function(e, callback) { 
        if (this == e.target) {
          self._width = $elem.width();
          self._fixNumLines(null, {duration: 0, complete: callback});
          $(o.navBar).toggleClass('narrow', self._width < 950).find('.picker').trigger('remaxheight');
        }
      });
      $(document.body).bind('DOMMouseScroll mousewheel', _.bind(self._recvZoom, self));
      $(o.zoomBtns[0]).click(function() { delete self.centeredOn; self._animateZoom(true, 1000); });
      $(o.zoomBtns[1]).click(function() { delete self.centeredOn; self._animateZoom(false, 1000); });
      $elem.mouseenter(function() { self.showReticle('mouseArea', false); });
      $elem.mouseleave(function() { self.showReticle('mouseArea', true); });
      $(o.lineMode).buttonset().click(function() { self._fixNumLines(self.centralLine); });
      $(o.lineMode).find('input,a').focus(function() { var $t = $(this); _.defer(function() { $t.blur(); }); });
      $elem.bind('trackload', _.bind(self._recvTrackLoad, self));
      $(window).bind('popstate', function() { self._initFromParams(null, true); });
      
      // Initialize the footer, the search bar, hotkeys, the AJAX proxy, mobile interactions, IE fixes
      // Finally, apply params from either the URL or the session state
      self._initFooter();
      self._initJump();
      self._initHotkeys();
      self._initAjax();
      self._initMobileFeatures();
      if ($.browser.msie) { self._initIEFixes(); }
      $(window).trigger('resize', function() { self._initFromParams(null, true); });
    },
    
    // Called when a new options object is passed in, typically after a custom genome is loaded
    _setOptions: function(options) {
      var self = this,
        $elem = self.element,
        o = self.options,
        tracksToParse,
        finishSetupAfterParsing,
        $overlay = $(o.overlay[0]),
        $overlayMessage = $(o.overlay[1]),
        nextDirectives = _.extend({}, self._nextDirectives);
      self._resetCustomTracks();
      self._removeLines(self.$lines.length, {duration: 0});

      o = _.extend(self.options, options);
      
      self._initInstanceVars();
      
      tracksToParse = _.filter(o.availTracks, function(t) { return t.customData; });
      // a subset of options that CustomTracks needs to parse tracks
      function browserOpts() {
        var pos = nextDirectives.position && self.normalizePos(nextDirectives.position, true);
        pos = pos ? pos.pos : self.pos;
        return {
          bppps: o.bppps,
          chrPos: self.chrPos,
          pos: pos,
          chrLengths: o.chrLengths,
          genomeSize: o.genomeSize,
          ajaxDir: o.ajaxDir
        };
      }
      
      function finishSetup() {
        _.each(o.tracks, function(t){ 
          $.extend(t, self.availTracks[t.n]);
        });
        
        self.$slider = self._initSlider();
        self.$trackPicker = self._initTrackPicker();
        self._updateGenomes();
      
        $overlay.add($overlayMessage).hide();
        $(window).trigger('resize', function() { 
          self._nextDirectives = {};
          if (_.keys(nextDirectives).length) { self._initFromParams(nextDirectives); }
        });
      }
      
      if (tracksToParse.length > 0) {
        finishSetupAfterParsing = _.after(tracksToParse.length, finishSetup);
        _.each(tracksToParse, function(t) {
          CustomTracks.parseAsync(t.customData, browserOpts(), function(customTracks) {
            var customTrack = customTracks[0]; // t.customData should only contain data for one track
            _.each(o.bppps, function(bppp) { 
              self.availTracks[t.n].fh[o.bpppFormat(bppp)] = {dense: customTrack.heights.min}; 
            });
            self.availTracks[t.n].custom = t.custom = customTrack;
            finishSetupAfterParsing();
          });
        });
      } else { finishSetup(); }
    },
    
    _initInstanceVars: function() {
      var self = this,
        $elem = self.element,
        o = self.options,
        p = 0;
        
      // Setup internal variables related to chromosome bands, lengths, and available tracks
      self.chrPos = {};
      o.chrLabels = [];
      _.each(o.chrOrder, function(v, i){ 
        o.chrLabels.push({p: p, n: v, w: o.chrLengths[v]}); self.chrPos[v] = p; p += o.chrLengths[v];
      });
      o.chrLabels.push({p: p, n: '', end: true}); // one more label for the end of the last chromosome
      _.each(o.chrBands, function(v){ v[5] = v[1]; v[1] += self.chrPos[v[0]]; v[2] += self.chrPos[v[0]]; });
      o.chrBands = o.chrBands && _.sortBy(o.chrBands, function(v) { return _.indexOf(o.chrOrder, v[0]) * o.genomeSize + v[1]; });
      self.availTracks = {};
      self.defaultTracks = [];
      _.each(o.availTracks, function(v) { self.availTracks[v.n] = $.extend({}, v, {oh: v.h}); });
      _.each(o.tracks, function(t){ 
        $.extend(t, self.availTracks[t.n]);
        self.defaultTracks.push({n: t.n, h: t.h});
      });
      
      // Setup remaining internal variables
      self.$lines = $elem.children('.browser-line');
      self.pos = 1; // this is the bp position of the left side of the top line
      self.bppp = o.initZoom;
      self._densityOrder = {};
      self._densityOrderFor = {};
      self._areaIndex = {};
      self._areaHover = null;
      self._tileFixingEnabled = true;
      self._showReticle = {mouseArea: false, dragging: false, hotKeys: false};
      self._defaultLineMode = $(o.lineMode).find(':checked').val();
      self._dna = {};
    },
    
    _initSlider: function() {
      var self = this,
        o = this.options;
      if (!o.overzoomBppps) { o.overzoomBppps = []; }
      
      var $slider = $(o.zoomSlider),
        numBppps = o.bppps.length + o.overzoomBppps.length,
        sliderWidth = (numBppps - 1) * 10,
        sliderBppps = (self.sliderBppps = o.bppps.concat(o.overzoomBppps)),
        prevVals = [],
        $ticks;
      
      function start(e, ui) { delete self.centeredOn; };
      function slide(e, ui) {
        var idx = floorHack(ui.value),
          frac = ui.value - idx,
          zoom, k;
        // Using the arrow keys with the slider focused should animate between optimal levels
        if (e.originalEvent && e.originalEvent.type=="keydown" && (k = e.originalEvent.keyCode)) {
          if (k >= 37 && k <= 40) { self._animateZoom(k == 38 || k == 39, 1000); return; }
        }
        prevVals = prevVals.concat([ui.value]).slice(-2);
        if (frac === 0.0) { self._zoom(sliderBppps[idx]); }
        else { self._zoom((sliderBppps[idx + 1] - sliderBppps[idx]) * frac + sliderBppps[idx]); }
      };
      function stop(e, ui) {
        if (e.originalEvent && e.originalEvent.type=="keyup") { return; }
        var direction = prevVals[0] < ui.value;
        o.snapZoomAfter && _.defer(function() { self._animateZoom(direction); });
      };
      
      $slider.parent().children('.ticks').remove();
      $ticks = $('<div class="ticks"/>').appendTo($slider.parent());
      $ticks.html(new Array(numBppps + 1).join('<div class="tick"/>'));
      
      if ($slider.hasClass('ui-slider')) { $slider.slider('destroy'); }
      $slider.parent().width(sliderWidth);
      return $slider.width(sliderWidth).slider({
        min: 0,
        max: numBppps - 1,
        step: 0.02,
        value: _.indexOf(sliderBppps, o.initZoom),
        slide: slide,
        change: slide,
        start: start,
        stop: stop
      });
    },
    
    // Utility function to a bind a button to toggling visibility of a slide-out menu, called a "picker"
    // Safe to call multiple times.
    _createPicker: function($btn, $picker, $done) {
      var self = this,
        $elem = $(self.element),
        closePicker = function() { $picker.slideUp(100); };
      $picker.unbind('remaxheight.genobrowser').bind('remaxheight.genobrowser', function() {
        var $ul = $(this).children('ul'),
          visible = $(this).is(':visible'),
          formLineHeights;
        if (!visible) { $(this).show(); } // can't make measurements while hidden
        formLineHeights = _.map($ul.nextAll(), function(el) { 
          return Math.max($(el).outerHeight(), $(el).find('textarea').outerHeight()); 
        });
        $ul.css('max-height', $elem.outerHeight() - _.sum(formLineHeights));
        if (!visible) { $(this).hide(); }
      });
      $btn.unbind('click.genobrowser').bind('click.genobrowser', function() {
        if (!$picker.is(':visible')) {
          $('body').bind('mousedown.picker', function(e) { 
            if ($(e.target).closest($picker.add($btn)).length) { return; }
            closePicker();
            $('body').unbind('mousedown.picker');
          });
          if ($btn.is('a.ui-button')) { $btn.addClass('ui-state-active'); }
          $picker.trigger('remaxheight');
        }
        $picker.slideToggle(100);
      });
      if ($done) { $done.unbind('click.genobrowser').bind('click.genobrowser', closePicker); }
      return $picker.unbind('close.genobrowser').bind('close.genobrowser', closePicker);
    },
    
    _initFooter: function() {
      var self = this,
        $elem = self.element,
        o = self.options,
        $foot = $(o.footerBar),
        $genome = $(o.genomePicker[0]),
        $genomePicker = $(o.genomePicker[1]),
        $ul = $('<ul/>').appendTo($genomePicker),
        $title = $genome.find('.title'),
        $toggleBtn = $genome.children('input').eq(0),
        speciesParenthetical = o.species.match(/\((.+)\)/),
        $binaryWarningDialog = $(o.dialogs[6]),
        $a;
      
      $ul.append('<li class="divider"/>')
      $a = $('<a class="clickable"/>').attr('href', o.dialogs[4]).appendTo($('<li class="choice"/>').appendTo($ul));
      $('<span class="name"/>').text('More genomes\u2026').appendTo($a);
      $('<span class="long-desc"/>').text('Fetch or specify chrom sizes').appendTo($a);
      $ul.append('<li class="divider"/>')
      $a = $('<a class="clickable"/>').attr('href', o.dialogs[5]).appendTo($('<li class="choice"/>').appendTo($ul));
      $('<span class="name"/>').text('Load from file or URL\u2026').appendTo($a);
      $('<span class="long-desc"/>').text('in GenBank, FASTA, or EMBL format').appendTo($a);
      
      $genome.find('.clickable').hover(function() { $(this).addClass('hover'); }, function() { $(this).removeClass('hover'); });
      self._updateGenomes();

      self._createPicker($toggleBtn, $genomePicker);
      
      // Setup the dialogs that appear upon clicking footerbar links
      _.each(o.dialogs, function(id) {
        var $dialog = $(id).closest('.ui-dialog');
        function openDialog() { 
          $('.ui-dialog').hide();
          $dialog.addClass('visible').show();
          $dialog.find('a[href^="http://"],a[href^="https://"]').attr('target', '_blank');
          $dialog.css('top', Math.max(($elem.parent().innerHeight() - $dialog.outerHeight()) * 0.5, 30));
        };
        $dialog.bind('open.genobrowser', openDialog);
        $foot.find('a[href='+id+']').click(function() { $dialog.trigger('open.genobrowser'); });
        $dialog.find('.ui-dialog-buttonpane button').button().not('.dont-close').click(function() {
          $dialog.fadeOut();
        });
      });
      
      self._initCustomGenomeDialogs();
      
      // Show the quickstart screen if the user has never been here before and the viewport is big enough to show it
      if ($.cookie('db')===null && $(window).width() > 600 && $(window).height() > 420) { 
        $foot.find('a[href="'+o.dialogs[1]+'"]').click();
      }
      // Show the uninstalled binaries warning, if it was written into the page
      if ($binaryWarningDialog.length) { $binaryWarningDialog.trigger('open.genobrowser'); }
    },
        
    _initTrackPicker: function() {
      var self = this,
        o = self.options,
        d = o.trackDesc,
        $toggleBtn = $(o.trackPicker[0]),
        $trackPicker = $(o.trackPicker[1]).empty(),
        $ul = $('<ul/>').appendTo($trackPicker),
        $div = $('<div class="button-line"/>').appendTo($trackPicker),
        $reset = $('<input type="button" name="reset" value="reset"/>').appendTo($div),
        $b = $('<input type="button" name="done" value="done"/>').appendTo($div);
      _.each(self.availTracks, function(t, n) {
        // TODO: This needs to distinguish between traditional image tracks and custom tracks brought in
        //       by custom genomes. The latter should have an options dialog and download links instead of "more info".
        var $l = $('<label class="clickable"/>').appendTo($('<li class="choice"/>').appendTo($ul)),
          $c = $('<input type="checkbox"/>').attr('name', n).prependTo($l),
          $d = $('<div class="desc"></div>').appendTo($l),
          href = o.trackDescURL + '?db=' + o.genome + '&g=' + n + '#TRACK_HTML',
          $a = d[n].lg ? $('<a class="more" target="_blank">more info&hellip;</a>').attr('href', href) : '';
        $('<h3/>').addClass('name').text(d[n].sm).append($a).appendTo($d);
        if (d[n].lg) { $('<p/>').addClass('long-desc').text(d[n].lg).appendTo($d); }
        if (_.find(o.tracks, function(trk) { return trk.n==n; })) { $c.attr('checked', true); }
        $l.bind('click', function(e) { if ($(e.target).is('a')) { e.stopPropagation(); }});
        $l.attr('title', n);
        $l.hover(function() { $(this).addClass('hover'); }, function() { $(this).removeClass('hover'); });
        $c.bind('change', _.bind(self._fixTracks, self));
      });
      if (o.tracks.length === 1) { $ul.find('input[name='+o.tracks[0].n+']').attr('disabled', true); }
      $reset.click(function(e) { self._resetToDefaultTracks(); });
      return self._createPicker($toggleBtn, $trackPicker, $b).hide();
    },
    
    _initCustomTracks: function() {
      var self = this,
        $elem = self.element,
        o = self.options,
        fileInputHTML = '<input type="file" name="customFile"/>',
        urlInputHTML = '<input type="url" name="customUrl" class="url"/><input type="button" name="customUrlGet" value="go!"/>',
        $toggleBtn = $(o.trackPicker[2]),
        $picker = $(o.trackPicker[3]).hide(),
        $ul = $('<ul/>').prependTo($picker),
        $add = $picker.find('.form-line').first(),
        $overlay = $(o.overlay[0]),
        $overlayMessage = $(o.overlay[1]),
        $urlInput, $urlGet, $div, $b, $reset;
      
      function browserOpts() {
        var nextDirectives = _.extend({}, self._nextDirectives),
          pos = nextDirectives.position && self.normalizePos(nextDirectives.position, true);
        pos = pos ? pos.pos : self.pos;
        return {
          bppps: o.bppps,
          chrPos: self.chrPos,
          pos: pos,
          chrLengths: o.chrLengths,
          genomeSize: o.genomeSize,
          ajaxDir: o.ajaxDir
        };
      }
      
      self._customTrackUrls = {
        requested: [],
        processing: [],
        loaded: []
      };
      
      function customTrackError(e) {
        $picker.find('.spinner').hide();
        var msg = e.message.replace(/^Uncaught Error: /, '');
        alert('Sorry, an error occurred while adding this custom track file:\n\n' + msg);
        // TODO: replace this with something more friendly.
        replaceFileInput(); 
      }
      
      function closePicker() { $picker.slideUp(100); }
      
      function handleFileSelect(e) {
        var reader = new FileReader(),
          $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner').show();
        if (e.target.files.length) {
          reader.onload = (function(f) {
            return function(ev) {
              CustomTracks.parseAsync(ev.target.result, browserOpts(), function(tracks) {
                $spinner.hide();
                self._addCustomTracks(f.name, tracks);
              });
            };
          })(e.target.files[0]);
          reader.readAsText(e.target.files[0]);
        }
        replaceFileInput();
      }
      if (window.File && window.FileReader && window.FileList) {
        $add.find('label').html(fileInputHTML);
        $add.find('[name=customFile]').change(handleFileSelect);
        $add = $add.nextAll('.form-line').first();
      } else {
        $add.remove();
        $picker.find('.help-line').first().remove();
        $add = $picker.find('.form-line').first();
      }
      
      function replaceFileInput() {
        _.defer(function() {
          $picker.find('[name=customFile]').replaceWith(fileInputHTML);
          $picker.find('[name=customFile]').change(handleFileSelect);
        });
      }
      
      function handlePastedData(e) {
        var $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner').show();
        CustomTracks.parseAsync($add.find('textarea').val(), browserOpts(), function(tracks) {
          $spinner.hide();
          self._addCustomTracks(_.uniqueId('pasted_data_'), tracks);
          $add.find('textarea').val('');
        });
      }
      function pasteAreaFocus(e) {
        var $this = $(this), height = $this.height();
        if (!$this.data('origHeight')) { $this.data('origHeight', $this.height()); }
        $this.animate({height: 120}, 200, 'easeInOutQuart');
      }
      function pasteAreaBlur(e) { $(this).animate({height: $(this).data('origHeight')}, 200, 'easeInOutQuart'); }
      $add.find('[name=customPasteAdd]').click(handlePastedData);
      $add.find('textarea').focus(pasteAreaFocus).blur(pasteAreaBlur);
      $add = $add.nextAll('.form-line').first();
      
      function handleUrlSelect(e) {
        var $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner'),
          $url = $add.find('[name=customUrl]'),
          url = $.trim($url.val());
        if (!url.length) { return; }
        $spinner.show();
        self._customTrackUrls.requested = _.without(self._customTrackUrls.requested, url);
        self._customTrackUrls.processing = _.union(self._customTrackUrls.processing, [url]);
        $.ajax(url, {
          success: function(data) {
            CustomTracks.parseAsync(data, browserOpts(), function(tracks) {
              $spinner.hide();
              $url.val('');
              self._customTrackUrls.loaded = _.union(self._customTrackUrls.loaded, [url]);
              self._addCustomTracks(basename(url), tracks, url);
              $overlay.add($overlayMessage).fadeOut();
            });
          },
          progress: function(loaded, total) {
            var $progress = $overlayMessage.find('.ui-progressbar');
            if (!$progress.length) { $progress = $('<div/>').appendTo($overlayMessage).progressbar(); }
            $progress.progressbar('value', loaded/total * 100);
          },
          error: function() {
            $overlay.hide();
            $overlayMessage.hide();
            customTrackError({message: "No valid custom track data was found at this URL."}); 
          }
        });
      }
      $add.find('label').html(urlInputHTML);
      $add.find('[name=customUrlGet]').click(handleUrlSelect);
      $add.find('[name=customUrl]').bind('keydown', function(e) { if (e.which==13) { handleUrlSelect(e); } });
      
      // Redefine the CustomTracks error handler so the user can see parse errors for their custom track(s).
      CustomTracks.error = customTrackError;
      
      $div = $('<div class="button-line"/>').appendTo($picker);
      $reset = $('<input type="button" name="reset" value="reset"/>').appendTo($div);
      $b = $('<input type="button" name="done" value="done"/>').appendTo($div);
      $reset.click(function(e) { self._resetCustomTracks(); });

      return self._createPicker($toggleBtn, $picker, $b);
    },
    
    _initLinking: function() {
      var self = this,
        o = self.options,
        $linkBtn = $(o.linking[0]),
        $linkPicker = $(o.linking[1]),
        $url = $linkPicker.find('.url');
      $linkBtn.button().click(function(e) { _.defer(function () { $url.select().focus(); }); return false; });
      self._createPicker($linkBtn, $linkPicker);
    },
    
    _initJump: function() {
      var self = this,
        o = self.options,
        $loc =  $(o.jump[0]),
        $jump = $(o.jump[1]);
      self.$choices = $(o.jump[2]).hide();
      function jumpToSubmit() {
        var $suggest = self.$choices.find('.focus');
        if ($suggest.length) { $suggest.click(); }
        else { self.jumpTo($loc.val()); }
      }
      $jump.click(jumpToSubmit);
      $loc.keydown(function(e) {
        if (e.which == 13) { jumpToSubmit(); }
        else if (e.which == 40) { 
          self.$choices.find('.focus').nextAll('.choice').eq(0).trigger('fakefocus');
          return false;
        } else if (e.which == 38) { 
          self.$choices.find('.focus').prevAll('.choice').eq(0).trigger('fakefocus');
          return false;
        } else {
          self._normalizePosDebounced();
        }
      });
      $loc.keyup(function(e) { _.defer(function() { ($loc.val()==='') && self._searchFor(''); }); });
    },
    
    _initHotkeys: function() {
      var self = this,
        o = this.options,
        $elem = self.element,
        motionOpts = {dir: 0},
        l = 500,
        shiftEverything = 'shift+down shift+s shift+up shift+w shift+left shift+a shift+right shift+d',
        motionInterval;
      self._keyedOffset = 0;
      // quadratic motion with an upper bound on the velocity after l milliseconds
      function x(t) { return (t > l ? 2 * l * t - l * l : t * t) / 1500; }
      function motion() {
        var now = (new Date).getTime(),
          deltaY = motionOpts.dir * x(now - motionOpts.start) - motionOpts.prev;
        self._keyedOffset -= deltaY;
        self._pos(self.pos - deltaY * self.bppp); 
        motionOpts.prev += deltaY;
      };
      $(document).bind('keydown', 'up down left right w s a d '+shiftEverything, function() { 
        self.showReticle('hotKeys', true);
        $.tipTip.hide();
        $elem.one('mousemove', function() { self.showReticle('hotKeys', false); });
      });
      $(document).bind('keydown', 'down s up w', function(e) {
        var dir = e.which == 40 || e.which == 83 ? 1 : -1; // down=>40, s=>83
        if ($(o.lineMode).find('input:checked').val() == 'single') {
          delete self.centeredOn;
          self._animateZoom(dir == -1, 1000); return false;
        } else {
          self._keyedOffset += dir * self.lineWidth();
          self._pos(self.pos + dir * self.bpWidth());
          self.bounceCheck();
        }
      });
      $(document).bind('keydown', 'left a right d', function(e) {
        var dir = e.which == 37 || e.which == 65 ? 1 : -1, // left=>37, a=>65
          now = (new Date).getTime();
        if (motionOpts.dir == dir) { return; }
        clearInterval(motionInterval);
        motionOpts = {dir: dir, start: now, prev: 0};
        motionInterval = setInterval(motion, 13); // based off of jQuery's .animate interval
      });
      $(document).bind('keyup', 'left a right d', function(e) {
        var dir = e.which == 37 || e.which == 65 ? 1 : -1;
        if (motionOpts.dir == dir) { clearInterval(motionInterval); self.bounceCheck(); motionOpts.dir = 0; }
      });
      $(document).bind('keydown', shiftEverything, function(e) {
        delete self.centeredOn;
        self._animateZoom(_.include([38, 87, 39, 68], e.which), 1000); // up=>38, w=>87, right=>39, d=>68
      });
      $(document).bind('keydown', 'esc', function(e) {
        var $pickers = $(o.trackPicker[1] + ',' + o.trackPicker[3]);
        $pickers.each(function() { if ($(this).is(':visible')) $(this).find('input[name=done]').click(); });
      });
    },
    
    _initAjax: function() {
      var options = this.options;
      // proxy external URLs through our local AJAX proxy
      $.ajax = (function(_ajax){
        var protocol = location.protocol,
          hostname = location.hostname,
          exRegex = RegExp(protocol + '//' + hostname),
          proxyURL = options.ajaxDir + 'proxy.php';

        function isExternal(url) {
          return !exRegex.test(url) && (/:\/\//).test(url);
        }

        return function(url, o) {
          if ( typeof url === "object" ) {
            o = url;
            url = o.url;
          } else { o.url = url; }
          
          // capture and forward progress events from XHR's to o.progress callback
          o.xhr = (function(_xhr){
            return function() {
              var xhr = _.isFunction(_xhr) ? _xhr() : new window.XMLHttpRequest();
              xhr.addEventListener("progress", function(e) {
                var total = e.lengthComputable ? e.total : xhr.getResponseHeader('X-Content-Length');
                if (total && _.isFunction(o.progress)) {
                  o.progress.call(this, e.loaded, total);
                }
              }, false);
              return xhr;
            };
          })(o.xhr);

          if ( (/get/i.test(o.type) || !o.type) && !/json/i.test(o.dataType) && isExternal(url) ) {
            // Manipulate options so that AJAX request gets sent to our proxy
            o.url = proxyURL;
            o.dataType = 'text';
            o.data = {
              url: url + (o.data ? (/\?/.test(url) ? '&' : '?') + jQuery.param(o.data) : '')
            };

            // Since it's a JSONP request
            // complete === success
            if (!o.success && o.complete) {
              o.success = o.complete;
              delete o.complete;
            }
            o.success = (function(_success){
              return function(data) {
                if (_success) {
                  // Fake XHR callback.
                  _success.call(this, data, 'success');
                }
              };
            })(o.success);
          }
          return _ajax.call(this, o);
        };
      })($.ajax);
    },
    
    _initMobileFeatures: function() {
      var self = this,
        o = self.options,
        $elems = self.element.add(o.navBar).add(o.footerBar);
      
      $(window).bind('orientationchange', function() { $(window).resize(); });
      
      if (!$.support.touch) { return; }
      $elems.addClass('mobile');
      
      var cachedPageXs = {}, prevPinchWidth = null, touchTarget, center, pinchWidth;
      function getPageX(e, identifier) {
        var pageX, changed = _.find(e.changedTouches, function(t) { return t.identifier == identifier; });
        if (changed) { pageX = changed.pageX; }
        else {
          if (!_.isUndefined(cachedPageXs[identifier])) { pageX = cachedPageXs[identifier]; }
          else { pageX = _.find(e.touches, function(t) { return t.identifier == identifier; }).pageX; }
        }
        cachedPageXs[identifier] = pageX;
        return pageX;
      }
      $(document).bind('touchstart', function(e) {
        var dragContTouch = _.find(e.originalEvent.touches, function(t) { return $(t.target).closest('.drag-cont').length > 0; });
        if (dragContTouch) { touchTarget = $(dragContTouch.target).closest('.drag-cont'); }
      });
      $(document).bind('touchmove', function(e) {
        var oe = e.originalEvent;
        // If nothing started within a draggable track area, we don't care about this event
        if (!touchTarget) { return; }
        // We're only handling pinch events here
        if (oe.touches.length != 2) { return; }
        if (center === null) {
          center = (oe.touches[0].pageX + oe.touches[1].pageX) * 0.5;
        }
        pinchWidth = Math.abs(getPageX(oe, oe.touches[0].identifier) - getPageX(oe, oe.touches[1].identifier));
        if (prevPinchWidth) {
          var delta = (pinchWidth / prevPinchWidth - 1) * 50, 
            // TODO: delta could probably be tweaked to proviude perfect positional zooming
            fakeEvent = {target: touchTarget, originalEvent: {srcElement: touchTarget, pageX: center}};
          // Simulate the equivalent mousewheel event
          self._recvZoom(fakeEvent, delta);
        }
        prevPinchWidth = pinchWidth;
      });
      $(document).bind('touchend', function(e) { cachedPageXs = {}; prevPinchWidth = touchTarget = center = null; });

      $(o.lineMode).find('input[value=single]').attr('checked', true);
    },
    
    _initIEFixes: function() {
      var self = this,
        o = self.options,
        $elems = self.element.add(o.navBar);
      $elems.addClass('msie');
      $(o.zoomSlider).parent().find('.tick').last().addClass('last');
      $(o.trackPicker[3]).find('textarea.paste').css('white-space', 'pre-wrap').attr('wrap', 'off');
      
      if (parseFloat($.browser.version) >= 9.0) { return; }
      // Stuff for old MSIE's (< MSIE 9)
      // Show the warning dialog
      $(o.footerBar).find('a[href="#old-msie"]').click();
      // Disable multiline mode
      $(o.lineMode).find('input[value=single]').attr('checked', true);
      // Old IE's have issues with creating new tabs when clicking features
      self.element.click(function(e) {
        var $a = $(e.target);
        if (e.target.nodeName.toLowerCase() == 'a' && $a.hasClass('area')) {
          var href = $a.attr('href');
          if (href) { window.location.href = href; }
        }
      });
    },
    
    _initCustomTrackDialog: function() {
      var self = this,
        o = self.options,
        $dialog = $(o.dialogs[0]).closest('.ui-dialog');
      
      $dialog.data('genobrowser', self.element);
      $dialog.find('.hidden').hide();
      $dialog.find('.show').show();
      
      if ($dialog.hasClass('initialized')) { return; } // The following only needs to be initialized once
      
      $dialog.bind('open.genobrowser', function() { self.$customTracks.trigger('close.genobrowser'); });
      $dialog.find('.range-slider').each(function() {
        var $min = $(this).prev('input'),
          $max = $(this).next('input'),
          min = parseFloat($min.val()),
          max = parseFloat($max.val()),
          $slider = $(this);
        $slider.slider({
          range: true,
          min: min,
          max: max,
          values: [min, max],
          slide: function(event, ui) {
            $min.val(ui.values[0]);
            $max.val(ui.values[1]);
          }
        });
        $min.change(function() { $slider.slider('value', $(this).val()); });
        $max.change(function() { $slider.slider('values', [$slider.slider('values')[0], $(this).val()]); });
      });
      $dialog.find('.color').each(function() {
        var $input = $(this),
          $p = $('<div class="color-picker ui-widget-content ui-corner-bottom shadow"></div>').insertAfter($input);
        $p.farbtastic(this);
        $input.focus(function() { $p.show(200); });
        $input.blur(function() { $p.hide(200); });
        $p.hide();
        $('<input type="button" value="done">').appendTo($p).click(function() { $input.blur(); });
      });
      $dialog.find('.enabler').each(function() {
        var $input = $(this);
        $input.change(function() {
          var value = $input.is(':checked');
          $input.siblings('[type=text]').attr('disabled', !value).toggleClass('disabled', !value);
          $input.siblings('.range-slider').slider(value ? 'enable' : 'disable');
        });
      });
      $dialog.find('[name=save]').click(function() {
        var trk = $dialog.data('track');
        trk.custom.saveOpts($dialog);
        self.$lines.find('.browser-track-'+trk.n+' .tile-custom canvas').trigger('erase').trigger('render');
        $dialog.data('track', false);
      });
      $dialog.find('[name=delete]').click(function() {
        $(this).hide();
        $dialog.find('.delete-confirm').fadeIn();
      });
      $dialog.find('[name=really_delete]').click(function() {
        var tname = $dialog.data('track').n;
        self._removeCustomTrack(tname);
        $dialog.data('track', false);
      });
      $dialog.addClass('initialized');
    },
    
    _initChromSizesDialog: function() {
      var self = this,
        o = self.options,
        $chromSizesDialog = $(o.dialogs[4]).closest('.ui-dialog');
        
      self._igbQuickloadData = self._igbQuickloadData || {};
        
      function filterGenomeList(e) {
        var searchTerms = _.map($(this).val().split(/\s+/), function(t) { return t.toLowerCase(); }),
          $list = $(e.data.list);
        searchTerms = _.reject(searchTerms, function(t) { t == ''; });
        $list.children('option').each(function() {
          var v = $(this).text().toLowerCase(),
            termsFound = _.reduce(searchTerms, function(memo, t){ return memo + (v.indexOf(t) !== -1 ? 1 : 0); }, 0);
          if (searchTerms.length == 0 || termsFound == searchTerms.length) { $(this).removeClass('hidden'); }
          else { $(this).addClass('hidden'); }
        });
        $list.scrollTop(0).val($list.children('option:not(.hidden)').eq(0).val()).change();
      }
      
      function loadedChromSizes(data, $panel) {
        $chromSizesDialog.find('.contigs-loading').stop().fadeOut();
        if (data.error) {
          $panel.find('.skipped-num').text(data.skipped);
          $panel.find('.ui-state-error').fadeIn().children('.contig-load-error').show();
        } else {
          $chromSizesDialog.find('[name=chromsizes]').val(data.chromsizes);
          $chromSizesDialog.find('[name=name]').val(data.db);
          $chromSizesDialog.data('genomeMetadata', data);
          $chromSizesDialog.find('[name=save]').button('enable').addClass('glowing');
          if (data.skipped) {
            $panel.find('.skipped-num').text(data.skipped);
            $panel.find('.ui-state-error').fadeIn().children('.skipped-warning').show();
          }
        }
      }
      
      $chromSizesDialog.bind('open.genobrowser', function() {
        var $genomeList = $chromSizesDialog.find('[name=ucscGenome]'),
          $igbDirs = $chromSizesDialog.find('[name=igbDirs]'),
          $igbList = $chromSizesDialog.find('[name=igbGenome]'),
          $newIgbDir = $chromSizesDialog.find('[name=newIgbDir]')
          $loadIgbBtn = $chromSizesDialog.find('[name=loadIgbDir]'),
          $cancelLoadIgbBtn = $chromSizesDialog.find('[name=cancelLoadIgbDir]');
        $chromSizesDialog.find('[name=filterUcscGenome]').select();
        $(o.genomePicker[1]).trigger('close.genobrowser');
        if ($chromSizesDialog.hasClass('initialized')) { return; }
        
        // the following only runs once, to initialize this dialog's UI
        $chromSizesDialog.find('.accordion').accordion({heightStyle: 'content'});
        $chromSizesDialog.find('[name=save]').button('disable');
        
        // loads the initial lists of available genomes from UCSC & IGB Quickload directories
        $.ajax(o.ajaxDir+'chromsizes.php', {
          dataType: 'json',
          success: function(data) {
            $genomeList.empty().removeClass('loading');
            _.each(data, function(v) {
              var $option = $('<option/>').text(v.species + ' (' + v.name + ') ' + v.assemblyDate);
              $option.val(v.name).data('metadata', v).appendTo($genomeList);
            });
          }
        });
        $.ajax(o.ajaxDir+'igb.php', {
          dataType: 'json',
          success: function(data) {
            var firstDir;
            $igbDirs.children().eq(0).remove();
            _.each(data, function(v, k) {
              firstDir = firstDir || k;
              $('<option/>').text(k).val(k).insertBefore($igbDirs.children().last());
              self._igbQuickloadData[k] = v;
            });
            $igbDirs.val(firstDir).change();
          }
        });
        
        // implements filtering by keyword
        $chromSizesDialog.find('[name=filterUcscGenome]').bind('keyup change', {list: $genomeList}, filterGenomeList);
        $chromSizesDialog.find('[name=filterIgbGenome]').bind('keyup change', {list: $igbList}, filterGenomeList);
        
        // load the chrom sizes data when selecting a UCSC genome
        $genomeList.bind('change', function() {
          var db = $(this).val(),
            $ucscOptions = $chromSizesDialog.find('.ucsc-options');
          if (!db) { return; }
          $chromSizesDialog.find('[name=save]').button('disable').removeClass('glowing');
          $chromSizesDialog.find('.contigs-loading').show();
          $ucscOptions.find('.ui-state-error, .contig-load-error, .skipped-warning').hide();
          $.ajax(o.ajaxDir+'chromsizes.php', {
            data: { db: db, limit: $chromSizesDialog.find('[name=limit]').val() },
            dataType: 'json',
            success: function(data) { loadedChromSizes(data, $ucscOptions); }
          });
        });
        $chromSizesDialog.find('[name=limit]').change(function() { $genomeList.change(); });
        
        // load the contents.txt of an IGB Quickload directory when selecting its URL
        $igbDirs.bind('change', function() {
          var url = $(this).val();
          if ($chromSizesDialog.find('.igb-dirs').is(':hidden')) { $cancelLoadIgbBtn.click(); }
          
          // Show the add URL input box
          if (url == '') {
            $chromSizesDialog.find('.igb-dirs').slideUp(function() {
              $chromSizesDialog.find('.add-igb-dir').slideDown();
            });
            return;
          }
          
          function populateList(url) {
            $igbList.empty().removeClass('loading');
            _.each(self._igbQuickloadData[url], function(v, k) {
              $('<option/>').text(v).val(url + '/' + k).appendTo($igbList);
            });
          }
          
          if (self._igbQuickloadData[url]) { populateList(url); }
          else {
            $igbList.empty().append('<option>loading...</option>').addClass('loading');
            $.ajax(o.ajaxDir+'igb.php', {
              data: { url: url, limit: $chromSizesDialog.find('[name=igblimit]').val() },
              dataType: 'json',
              success: function(data) {
                _.extend(self._igbQuickloadData, data);
                populateList(url);
              }
            });
          }
        });
        
        // UI for adding IGB Quickload directories
        $loadIgbBtn.click(function() {
          var url = $newIgbDir.val().replace(/\/$/, '');
          $('<option/>').text(url).val(url).insertBefore($igbDirs.children().last());
          $igbDirs.val(url).change();
        });
        $cancelLoadIgbBtn.click(function() {
          $newIgbDir.val('');
          $chromSizesDialog.find('.add-igb-dir').slideUp(function() {
            $chromSizesDialog.find('.igb-dirs').slideDown();
          });
        });
        
        // TODO: load an IGB Quickload genome's data when selecting it from the list
        $igbList.bind('change', function() {
          var url = $(this).val(),
            $igbOptions = $chromSizesDialog.find('.igb-options');
          if (!url) { return; }
          $chromSizesDialog.find('[name=save]').button('disable').removeClass('glowing');
          $chromSizesDialog.find('.contigs-loading').show();
          $igbOptions.find('.ui-state-error, .contig-load-error, .skipped-warning').hide();
          $.ajax(o.ajaxDir+'igb.php', {
            data: { url: url, limit: $chromSizesDialog.find('[name=igblimit]').val() },
            dataType: 'json',
            success: function(data) { loadedChromSizes(data, $igbOptions); }
          });
        });
        
        $chromSizesDialog.addClass('initialized');
      });
      $chromSizesDialog.find('[name=chromsizes]').one('focus', function() { 
        var $this = $(this).removeClass('placeholder');
        $chromSizesDialog.find('[name=save]').button('enable');
        _.defer(function() { $this.select(); });
      });
      $chromSizesDialog.find('[name=save]').click(function(e, chose) { 
        var metadata = { format: 'chromsizes' },
          remoteMetadata = $chromSizesDialog.data('genomeMetadata'),
          activeAccordion = $chromSizesDialog.find('.ui-accordion').accordion('option', 'active'),
          choseWhatSource = ['ucsc', 'igb', 'chromsizes'],
          origMetadata, $origOption, genome;
        chose = chose || choseWhatSource[activeAccordion];
        if (chose == 'ucsc' || chose == 'igb') {
          // This is an unaltered set of chromosome sizes pulled from UCSC
          chromSizes = remoteMetadata.chromsizes;
          metadata.name = remoteMetadata.db;
          metadata.tracks = remoteMetadata.tracks;
          origMetadata = remoteMetadata;
          if (chose == 'ucsc') {
            $origOption = $chromSizesDialog.find('[name=ucscGenome] > option[value='+metadata.name+']');
            if (!remoteMetadata.species) { origMetadata = $origOption.data('metadata'); }
            metadata.ucsc = metadata.name + ':' + remoteMetadata.limit;
          } else {
            // TODO: find some way to get the other metadata/custom track data from annots.xml into metadata
            metadata.igb = remoteMetadata.limit + ':' + metadata.name;
          }
          metadata.species = origMetadata.species;
          metadata.assemblyDate = origMetadata.assemblyDate;
        } else {
          chromSizes = $chromSizesDialog.find('[name=chromsizes]').val();
          metadata.name = $chromSizesDialog.find('[name=name]').val();
        }
        CustomGenomes.parseAsync(chromSizes, metadata, function(genome) {
          self._setOptions(genome.options({ width: self.lineWidth() * self.$lines.length }));
        });
      });
    },
    
    _initCustomGenomeDialogs: function() {
      var self = this,
        o = self.options,
        $genomeDialog = $(o.dialogs[5]).closest('.ui-dialog'),
        $add = $genomeDialog.find('.form-line').first(),
        $overlay = $(o.overlay[0]),
        $overlayMessage = $(o.overlay[1]),
        fileInputHTML = '<input type="file" name="genomeFile"/>',
        urlInputHTML = '<input type="url" name="genomeUrl" class="url"/>' +
                       '<input type="button" name="genomeUrlGet" value="Load"/>';
      
      self._initChromSizesDialog();
      
      function customGenomeError(e) {
        $genomeDialog.find('.spinner').hide();
        var msg = e.message.replace(/^Uncaught Error: /, '');
        alert('Sorry, an error occurred while adding this custom genome file:\n\n' + msg);
        // TODO: replace this with something more friendly.
        replaceFileInput(); 
      }
      
      function handleFileSelect(e) {
        var reader = new FileReader(),
          $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner').show();
          
        $overlay.show();
        $overlayMessage.show().text('Loading custom genome...');
        
        if (e.target.files.length) {
          reader.onload = (function(f) {
            var metadata = { file: f.name },
              genome;
            return function(ev) {
              CustomGenomes.parseAsync(ev.target.result, metadata, function(genome) {
                self._setOptions(genome.options({ width: self.lineWidth() * self.$lines.length }));
                $spinner.hide();
                $genomeDialog.fadeOut();
              });
            };
          })(e.target.files[0]);
          reader.readAsText(e.target.files[0]);
        }
        replaceFileInput();
      }
      function replaceFileInput() {
        _.defer(function() {
          $genomeDialog.find('[name=genomeFile]').replaceWith(fileInputHTML);
          $genomeDialog.find('[name=genomeFile]').change(handleFileSelect);
        });
      }
      if (window.File && window.FileReader && window.FileList) {
        $add.find('label').html(fileInputHTML);
        $add.find('[name=genomeFile]').change(handleFileSelect);
        $add = $add.nextAll('.form-line').first();
      } else {
        $add.remove();
        $genomeDialog.find('.help-line').first().remove();
        $add = $picker.find('.form-line').first();
      }
      
      function handlePastedData(e) {
        var $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner').show();
        $overlay.show();
        $overlayMessage.show().text('Loading custom genome...');
        CustomGenomes.parseAsync($add.find('textarea').val(), { file: "_pasted_data" }, function(genome) {
          self._setOptions(genome.options({ width: self.lineWidth() * self.$lines.length }));
          $spinner.hide();
          $genomeDialog.fadeOut();
          $add.find('textarea').val('');
        });
      }
      $add.find('[name=customGenomePasteAdd]').click(handlePastedData);
      $add = $add.nextAll('.form-line').first();
      
      function handleUrlSelect(e) {
        var $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner'),
          $url = $add.find('[name=genomeUrl]'),
          url = $.trim($url.val());
        if (!url.length) { return; }
        $spinner.show();
        $overlay.show();
        $overlayMessage.show().text('Loading custom genome...');
        $.ajax(url, {
          dataType: "text",
          success: function(data) {
            CustomGenomes.parseAsync(data, {url: url}, function(genome) {
              self._setOptions(genome.options({ width: self.lineWidth() * self.$lines.length }));
              $spinner.hide();
              $url.val('');
              $genomeDialog.fadeOut();
            });
          },
          progress: function(loaded, total) {
            var $progress = $overlayMessage.find('.ui-progressbar');
            if (!$progress.length) { $progress = $('<div/>').appendTo($overlayMessage).progressbar(); }
            $progress.progressbar('value', loaded/total * 100);
          },
          error: function() {
            $overlay.hide();
            $overlayMessage.hide();
            customGenomeError({message: "No valid custom track data was found at this URL."}); 
          }
        });
      }
      $add.find('label').html(urlInputHTML);
      $add.find('[name=genomeUrlGet]').click(handleUrlSelect);
      $add.find('[name=genomeUrl]').bind('keydown', function(e) { if (e.which==13) { handleUrlSelect(e); } });
    },
    
    _initFromParams: function(params, suppressRepeat) {
      var self = this,
        o = self.options,
        $elem = self.element,
        $overlay = $(o.overlay[0]),
        $overlayMessage = $(o.overlay[1]),
        $customPicker = $(o.trackPicker[3]),
        $genomeDialog = $(o.dialogs[5]).closest('.ui-dialog'),
        $chromSizesDialog = $(o.dialogs[4]).closest('.ui-dialog'),
        $trackUrlInput = $customPicker.find('[name=customUrl]'),
        $trackUrlGet = $customPicker.find('[name=customUrlGet]'),
        $genomeUrlInput = $genomeDialog.find('[name=genomeUrl]'),
        $genomeUrlGet = $genomeDialog.find('[name=genomeUrlGet]'),
        remoteGenomeSettings = {
          ucsc: { url: 'chromsizes.php', messageText: 'from UCSC' },
          igb: { url: 'igb.php', messageText: 'via IGB Quickload' }
        },
        sessionVars = {},
        customTracksArray, customGenomePieces, customGenomeSource, customGenomeName, chromSizes, trackSpec, 
          remote, remoteParams;
      
      function persistentCookie(k, v) { $.cookie(k, v, {expires: 60}); }
      function removeCookie(k) { $.cookie(k, null); }
      persistentCookie('db', o.genome);
      self.storage = {
        session: window.sessionStorage || {setItem: $.cookie, getItem: $.cookie, removeItem: removeCookie},
        persistent: window.localStorage || {setItem: persistentCookie, getItem: $.cookie, removeItem: removeCookie}
      };
      _.each(o.savableParams, function(keys, dest) {
        _.each(keys, function(k) {
          var v = self.storage[dest].getItem((dest != 'persistent' ? o.genome + '.' : '') + k); 
          if (v !== null) { sessionVars[k] = v; }
        });
      });
      params = params || _.extend({}, sessionVars, $.urlParams());
            
      if (suppressRepeat && self._lastParams && _.isEqual(self._lastParams, params)) { return; }
      self._lastParams = _.clone(params);
      
      customTracksArray = _.compact([].concat(params.customTracks)),
      self._customTrackUrls.requested = _.union(self._customTrackUrls.requested, customTracksArray);
      var unprocessedUrls = _.difference(self._customTrackUrls.requested, self._customTrackUrls.processing);
      
      // We need to load a custom genome
      if (params.db != o.genome) {
        customGenomePieces = (params.db || '').split(':');
        customGenomeSource = customGenomePieces[0];
        remote = remoteGenomeSettings[customGenomeSource];
        if (customGenomeSource == 'url') {   // It's a URL to a full genome file
          $genomeUrlInput.val(customGenomePieces.slice(1).join(':'));
          $genomeUrlGet.click();
          self._nextDirectives = params;
          return;
        } else if (remote) {
          // It's a genome stored at UCSC or in an IGB Quickload directory
          $overlay.show();
          $overlayMessage.show().text('Loading genome ' + remote.messageText + '...');
          if (customGenomeSource == 'ucsc') {
            remoteParams = { db: customGenomePieces[1], limit: customGenomePieces[2], meta: 1 };
          } else { // customGenomeSource == 'igb'
            remoteParams = { url: customGenomePieces.slice(2).join(':'), limit: customGenomePieces[1] };
          }
          
          $.ajax(o.ajaxDir + remote.url, {
            data: remoteParams,
            dataType: 'json',
            success: function(data) {
              if (data.error) {
                $overlayMessage.text('Error loading genome data ' + remote.messageText);
              } else {
                $chromSizesDialog.data('genomeMetadata', data);
                $chromSizesDialog.find('[name=save]').trigger('click', [customGenomeSource]);
                self._nextDirectives = params;
              }
            }
          });
          return;
        } else if ((/^custom[:|]/).test(params.db)) {   // It's a custom chrom.sizes
          chromSizes = params.db.replace(/^[^|]+\|/, '').replace(/:/g, "\t").replace(/\|/g, "\n");
          $chromSizesDialog.find('[name=chromsizes]').val(chromSizes);
          customGenomeName = (params.db[6] == ':') ? params.db.substring(7).replace(/\|.*/, '') : '';
          $chromSizesDialog.find('[name=name]').val(customGenomeName);
          $chromSizesDialog.find('[name=save]').trigger('click', ['chromsizes']);
          self._nextDirectives = params;
          return;
        }
      }
      
      // If there are custom track URLs somewhere in the parameters that have not been processed yet
      // they need to be loaded before we can make sense of the rest of the params
      if (unprocessedUrls.length) {
        $overlay.show();
        $overlayMessage.show().text('Loading custom track...');
        $trackUrlInput.val(unprocessedUrls[0]); $trackUrlGet.click();
        // This should have added the URL to self._customTrackUrls.processing, so it will not be submitted again
        self._nextDirectives = params;
      } else {
        if (params.mode) { $(o.lineMode).find('[value="'+params.mode+'"]').click(); }
        if (params.tracks) {
          trackSpec = _.map(params.tracks.split('|'), function(v) { 
            var split = v.split(':'), trk = {n: split[0]};
            if (split.length > 1 && (/^\d+$/.test(split[1]))) { trk.h = parseInt(split[1], 10); }
            return trk; 
          });
          self._fixTracks({}, trackSpec);
        }
        if (params.position) { self.jumpTo(params.position); }
      }
    },
    
    // =====================================================================================
    // = The following functions coordinate the display of browser lines ($.ui.genoline's) =
    // =====================================================================================
    
    // Fix the number of lines displayed vertically, shifting and unshifting lines to fill the vertical space
    // You can specify the line index to holdSteady (keep in roughly the same place), and animOpts for the animation
    _fixNumLines: function(holdSteady, animOpts) {
      var self = this,
        $elem = self.element, 
        o = self.options,
        availHeight = $elem.innerHeight(),
        lineHeight = self._lineHeight(),
        numLines = self.$lines.length,
        forceOneLine = $(o.lineMode).find(':checked').val() == 'single',
        newNumLines = forceOneLine ? 1 : Math.max(floorHack(availHeight / lineHeight), 1),
        extraSpace = availHeight - (newNumLines * lineHeight),
        extraLineHeight = extraSpace > 0 ? lineHeight + extraSpace / newNumLines : lineHeight,
        extraTopMargin = newNumLines === 1 ? Math.max((availHeight - lineHeight) / 2.0, 0) : 0,
        unShiftLines = 0, pushLines = 0,
        destIndex, currTop;
      if (!_.isUndefined(holdSteady) && holdSteady !== null) {
        if (!_.isUndefined(holdSteady.shift)) {
          unShiftLines = -holdSteady.shift;
        } else {
          currTop = self.$lines.eq(holdSteady).position().top;
          // Special case the resizing of the central line: it must stay the central line
          if (holdSteady == this.centralLine) { destIndex = Math.ceil(newNumLines / 2) - 1; }
          else {
            destIndex = _.min(_.range(newNumLines), function(i) { 
              return Math.abs(i * extraLineHeight + extraTopMargin - currTop); 
            });
          }
          unShiftLines = destIndex - holdSteady;
        }
      }
      pushLines = newNumLines - numLines - unShiftLines;
      unShiftLines > 0 ? self._addLines(-unShiftLines) : self._removeLines(unShiftLines, animOpts);
      pushLines > 0 ? self._addLines(pushLines) : self._removeLines(-pushLines, animOpts);
      self.centralLine = Math.ceil(newNumLines / 2) - 1;
      self._pos(self.pos - unShiftLines * self.bpWidth());
      // Only fire a completion callback once for the whole browser
      if (animOpts && animOpts.complete) { animOpts.complete = _.after(self.$lines.length, animOpts.complete); }
      self.$lines.each(function(i) {
        var newTop = i * extraLineHeight + extraTopMargin;
        $(this).data('naturalTop', newTop);
        if (holdSteady && holdSteady.exceptFor == this) { return; }
        $(this).animate({top: newTop}, $.extend({
          duration: o.lineFixDuration,
          queue: false,
          easing: 'easeInOutQuart'
        }, animOpts));
      });
      self._updateReticle(null, animOpts);
    },
    
    // A shortcut that pushes the lines in the display up or down
    shiftLines: function(num, exceptFor, animOpts) { this._fixNumLines({shift: num, exceptFor: exceptFor}, animOpts); },
    
    // Add num lines to the browser; they begin offscreen and must be moved into view
    // positive num adds to the end; negative num adds to the beginning
    _addLines: function(num) {
      var o = this.options,
        bpWidth = this.bpWidth(),
        origin = this.pos + (num > 0 ? this.$lines.length * bpWidth : -bpWidth),
        bpStep = num > 0 ? bpWidth : -bpWidth,
        // Can't use normal .unshift() on a jQuery object, it only has splice.
        ops = num > 0 ? ['appendTo', function(x){this.push(x);}] : ['prependTo', function(x){this.splice(0,0,x);}],
        setTop = num > 0 ? $(window).innerHeight() + o.betweenLines : -this._lineHeight(),
        $line, newOpts;
      num = Math.abs(num);
      while (num-->0) {
        $line = $('<div class="browser-line"></div>')[ops[0]](this.element);
        newOpts = $.extend({}, o, {browser: this.element, origin: origin});
        ops[1].call(this.$lines, $line.get(0));
        $line.css('top', setTop).genoline(newOpts);
        origin += bpStep;
      }
    },
    
    // Remove num lines to the browser; they fade out and are deleted from the DOM
    // positive num removes from the end; negative num removes from the beginning
    _removeLines: function(num, animOpts) {
      var o = this.options,
        bpWidth = this.bpWidth(),
        duration = animOpts && !_.isUndefined(animOpts.duration) ? animOpts.duration : o.lineFixDuration,
        index = num > 0 ? -1 : 0,
        // We can't use normal .pop() and .shift() on a jQuery object, it only has splice.
        popOrShift = num > 0 ? 
          function($a){ $a.splice($a.length-1,1); } : function($a){ $a.splice(0,1); };
      num = Math.abs(num);
      while (num-->0) {
        if (duration > 0) {
          this.$lines.eq(index).fadeOut(duration, function() { $(this).remove(); });
        } else { this.$lines.eq(index).remove(); }
        popOrShift(this.$lines);
      }
    },
    
    // Returns the elements that contain each line of the display
    lines: function() { return this.$lines; },
    
    // Returns the expected width, in pixels, of each line
    lineWidth: function() { return this._width - this.options.sideBarWidth; },
    
    // Returns the expected height, in pixels, of each line
    _lineHeight: function() {
      var o = this.options;
      return o.betweenLines + _.reduce(o.tracks, function(t, u) { return {h:t.h + u.h}; }).h;
    },
    
    // ===============================================================================================
    // = The following functions coordinate the tracks ($.ui.genotrack's) displayed within each line =
    // ===============================================================================================
    
    // Returns the current array of tracks, with all associated options, that are supposed to be displayed
    tracks: function() { return this.options.tracks; },
    
    // Ensures all lines have the right tracks, as specified by the checkboxes in the track pickers or the trackSpec
    _fixTracks: function(animOpts, trackSpec) {
      var self = this,
        o = self.options,
        $elem = self.element,
        newTracks = [],
        prevTracks = [],
        prevPos = self.pos + self._reticDelta(),
        externalTrackSpec = !!trackSpec;
      
      // Sync the trackSpec with the checkboxes in the track pickers
      // If trackSpec was not provided, this simply retrieves one from the state of the checkboxes
      trackSpec = self._trackSpec(trackSpec);
      newTracks = _.pluck(trackSpec, 'n');
      
      // First remove any tracks that are not in the new set
      o.tracks = _.filter(o.tracks, function(t) {
        var i = _.indexOf(newTracks, t.n);
        if (i !== -1) { 
          prevTracks.push(t.n);
          // Resize existing tracks if a new height is specified
          if (trackSpec[i].h) { self._resizeTrack(t.n, trackSpec[i].h, false, false); }
          return true;
        }
      });
      // Now, add any tracks that are in the new set but aren't in the old set
      _.each(newTracks, function(name, i) {
        var spec = trackSpec[i];
        if (!_.include(prevTracks, name)) { o.tracks.splice(i, 0, $.extend({}, self.availTracks[name], spec.h ? {h: spec.h} : {})); } 
      });
      
      self.$lines.genoline('fixTracks');
      self._fixNumLines(0, animOpts);
      if (prevPos < o.genomeSize && prevPos > 0 && (!animOpts || !animOpts.complete)) { self.jumpTo(prevPos); }
      if (!externalTrackSpec) { this._saveParamsDebounced(); }
    },
    
    // Resize a track to a particular height, fixing the line layout afterward unless fixNumLinesHoldingSteady is false,
    // Set animCallback to true to animate with no callback, a function to provide a callback, or false for no animation.
    _resizeTrack: function(name, height, fixNumLinesHoldingSteady, animCallback) {
      var o = this.options,
        $elem = this.element,
        trk = _.find(o.tracks, function(t) { return t.n == name; }),
        $lines = this.$lines,
        $tracks = $lines.find('.browser-track-'+name);
      animCallback = _.isFunction(animCallback) ? _.after($tracks.length, animCallback) : animCallback;
      trk.h = height;
      $tracks.genotrack('resize', height, animCallback);
      if (fixNumLinesHoldingSteady !== false) { this._fixNumLines(fixNumLinesHoldingSteady); }
      $lines.genoline('fixFirstLabel', true);
    },
    
    // Syncs a list of tracks (with heights), the trackSpec, with the checkboxes in the track pickers
    _trackSpec: function(trackSpec) {
      var self = this,
        $checkboxes = self.$trackPicker.find(':checkbox').add(self.$customTracks.find(':checkbox'));
      if (!trackSpec || !_.isArray(trackSpec) || !trackSpec.length) {
        trackSpec = [];
        $checkboxes.filter(':checked').each(function() { trackSpec.push({n: $(this).attr('name')}); });
      } else {
        // Cleanup external trackSpecs: for now, disallow dupes, and make sure all tracks actually exist
        trackSpec = _.uniq(_.filter(trackSpec, function(t) { return self.availTracks[t.n]; }), function(t) { return t.n; });
        $checkboxes.attr('checked', false);
        _.each(trackSpec, function(t) { $checkboxes.filter('[name="'+t.n+'"]').attr('checked', true); });
      }
      // if there is only one newTrack, disable the checkbox so there are always 1 tracks
      if (trackSpec.length === 1) { $checkboxes.filter(':checked').attr('disabled', true); }
      else { $checkboxes.attr('disabled', false); }
      return trackSpec;
    },
    
    // Resets to the default set of tracks
    _resetToDefaultTracks: function() {
      this._fixTracks(false, this.defaultTracks);
      this._saveParamsDebounced();
    },
    
    // After a custom track file is parsed, this function is called to add them to the custom track picker and each
    // browser line; they are also inserted in self.availTracks just like "normal" tracks
    _addCustomTracks: function(fname, customTracks, url) {
      var self = this,
        o = self.options,
        $ul = $(o.trackPicker[3]).children('ul').eq(0),
        d = o.trackDesc,
        browserDirectives = _.extend({}, customTracks.browser, self._nextDirectives || {}),
        warnings = [],
        customTrackNames = _.map(customTracks, function(t, i) { return classFriendly('_'+fname+'_'+(t.opts.name || i)); }),
        newTracks = _.filter(customTrackNames, function(n) { return !self.availTracks[n] }),
        nextDirectivesIncludeOneNewTrack = self._nextDirectives && self._nextDirectives.tracks &&
          !!_.find(self._nextDirectives.tracks.split('|'), function(v) { return _.contains(newTracks, v.split(':')[0]); });
      
      _.each(customTracks, function(t, i) {
        var n = customTrackNames[i],
          newTrack = !self.availTracks[n],
          $li, $l, $c, $d, $o;
        if (newTrack) {
          $li = $('<li class="choice"/>').appendTo($ul);
          $l = $('<label class="clickable"/>').appendTo($li);
          $c = $('<input type="checkbox" checked="checked"/>').attr('name', n).prependTo($l);
          $d = $('<div class="desc"></div>').appendTo($l);
          $o = $('<button class="opts"><img src="css/gear.png" alt="gear" /></button>').appendTo($li),
          $l.hover(function() { $(this).addClass('hover'); }, function() { $(this).removeClass('hover'); });
          $l.attr('title', n);
          $c.bind('change', _.bind(self._fixTracks, self));
          $o.button().click(_.bind(self._editCustomTrack, self, n));
          $('<h3 class="name"/><p class="long-desc"/>').appendTo($d);
          // If track settings are to be applied, ensure any new custom tracks are added to them
          // This prevents new tracks from being added and then immediately hidden (confusing)
          // -- One exception! If self._nextDirectives contain at least one track name
          //    among the new tracks to be added, do not do this, we then assume they are overriding.
          if (browserDirectives.tracks && !nextDirectivesIncludeOneNewTrack) {
            if (!_.find(browserDirectives.tracks.split('|'), function(v) { return v.split(':')[0] == n; })) {
              browserDirectives.tracks += '|' + n;
            }
          }
        } else { $d = $ul.find('[name='+n+']').parent().children('.desc'); }
        if (url) { t.url = url; }
        // TODO: if the track is not new, inform that its data was replaced with the new track information
        self.availTracks[n] = {
          fh: {"0.1": {dense: t.heights.start}},
          n: n,
          h: t.heights.start,
          s: t.sizes,
          m: t.mapSizes,
          custom: t
        };
        _.each(o.bppps, function(bppp) { self.availTracks[n].fh[o.bpppFormat(bppp)] = {dense: t.heights.min}; });
        d[n] = {
          cat: fname,
          lg: t.opts.description || t.opts.name || n, 
          sm: t.opts.name || n
        };
        $d.children('h3.name').text(d[n].sm);
        $d.children('p.long-desc').text(d[n].lg && d[n].lg != d[n].sm ? d[n].lg : fname);
        if (t.warnings) { warnings.push.apply(warnings, t.warnings); }
      });
      if (warnings.length) {
        // TODO: Display warnings from custom track parsing to the user
        console.log(warnings);
      }
      self._fixTracks({complete: function() {
        // If browser directives were included, we need to obey them.
        self._nextDirectives = {};
        // Right now only position is supported.
        // TODO: other browser directives at http://genome.ucsc.edu/goldenPath/help/hgTracksHelp.html#lines
        if (_.keys(browserDirectives).length) { self._initFromParams(browserDirectives); }
      }}); 
    },
    
    // Opens a dialog to edit the options for a custom track.
    _editCustomTrack: function(n) {
      var self = this,
        o = self.options,
        $dialog = $(o.dialogs[0]).closest('.ui-dialog'),
        trk = self.availTracks[n];
        
      self._initCustomTrackDialog();
      trk.custom.loadOpts($dialog);
      $dialog.data('track', trk);
      $dialog.trigger('open');
    },
    
    // Removes a custom tracks.
    _removeCustomTrack: function(tname) {
      var self = this,
        $li = $(self.options.trackPicker[3]).find('input[name="'+tname+'"]').closest('li'),
        url = self.availTracks[tname].custom.url;
      delete self.availTracks[tname];
      $li.remove();
      // Remove url from list of loaded URLs if there are no other tracks that were loaded from it
      if (url && !_.find(self.availTracks, function(trk) { return trk.custom && trk.custom.url == url; })) {
        self._customTrackUrls.loaded = _.difference(self._customTrackUrls.loaded, [url]);
      }
      self._fixTracks();
    },
    
    // Removes all custom tracks.
    _resetCustomTracks: function() {
      var self = this,
        $lis = $(self.options.trackPicker[3]).children('ul').children();
      $lis.find(':checkbox').each(function() { delete self.availTracks[$(this).attr('name')]; });
      $lis.remove();
      self._customTrackUrls.loaded = [];
      self._fixTracks();
    },
    
    // Determine for a given track and height what density is optimal for display
    densityOrder: function(track, height, bppps, force) {
      if (_.isUndefined(height) || _.isUndefined(bppps)) { return this._densityOrder[track] || null; }
      // TODO: this needs tweaking... maybe on the debounced version, exclude off-screen tiles?
      var self = this, 
        o = self.options,
        $elem = self.element,
        t = this.availTracks[track],
        base = _.find(t.s, function(v) { return !_.isArray(v); }),
        fixedHeights = t.fh[bppps.topFormatted] || (_.keys(t.fh).length && t.fh[_.last(_.keys(t.fh))]) || {},
        baseHeight = fixedHeights[base] || 15,
        orderFor = height + "|" + bppps.topFormatted,
        prevOrder = self._densityOrder[t.n],
        prevOrderFor = self._densityOrderFor[t.n],
        $unrenderedCustom = $('.browser-track-'+t.n+' canvas.tdata.unrendered'),
        forceAt = {}, //{pack: [200, -2], full: [200, -3]},  // This is causing too much thrashing with heavy custom tracks
        order = {}, heights = [], i = 0, optimum;
      if (prevOrderFor && prevOrderFor == orderFor && !force) { return; }
      if ($unrenderedCustom.length) {
        // All custom tracks should be rendered before reordering the densities.  Defer this calculation until then.
        return $unrenderedCustom.trigger('render', _.after($unrenderedCustom.length, function() { 
          self.densityOrder(track, height, bppps); 
        }));
      }
      // Always show the base density when within 3px of the baseHeight (the initial height)
      if (height <= baseHeight + 3) {
        order[base] = 0;
        _.each(t.s, function(d) { if (_.isArray(d)) { order[d[0]] = ++i; } });
      } else {
        // Otherwise, order the densities by their tiles' max height's proximity to the track height
        // with a 3x bias toward showing the taller density
        _.each(t.s, function(d) {
          if (_.isArray(d)) { d = d[0]; }
          if (fixedHeights[d]) { return heights.push([d, fixedHeights[d]]); }
          var $imgs = $('.browser-track-'+t.n+'>.bppp-'+classFriendly(bppps.top)+'>.tdata.dens-'+d);
          if ($imgs.find('.loading').length > 0) { orderFor = null; }
          var h = Math.max.apply(Math, $imgs.map(function() { 
            return this.naturalHeight || this.height; 
          }).get());
          heights.push([d, h]);
        });
        heights = _.map(heights, function(v, i) {
          var deltaY;
          v[2] = v[1] == 0;
          v[1] = v[2] ? 1000000 : v[1];      // effectively, never show 0 height tiles
          deltaY = height - v[1];
                                             // this is where the 3x bias toward the taller density is inserted
          v[1] = (forceAt[v[0]] && height > forceAt[v[0]][0]) ? forceAt[v[0]][1] : (deltaY > 0 ? deltaY * 3 : -deltaY);
          v[1] -= i * 0.1;                   // marginally prioritize more detailed tracks in the event of ties
          return v; 
        });
        heights.sort(function(a, b){ return a[1] - b[1]; });
        _.each(heights, function(v) { order[v[0]] = ++i; });
        // Unless all of the other densities were 0 height tiles, make the base density last priority.
        if (heights.length - _.compact(_.pluck(heights, '2')).length > 1) { order[base] = ++i; }
      }
      self._densityOrder[t.n] = order;
      self._densityOrderFor[t.n] = orderFor;
      if (prevOrder && !_.isEqual(order, prevOrder)) { 
        $elem.find('.browser-track-'+t.n).genotrack('updateDensity');
      }
    },
    
    // ================================================================================================
    // = These are navigational functions; they handle movement, zooming, position calculations, etc. =
    // ================================================================================================

    // Returns the expected width, in base pairs, of each line
    bpWidth: function() { return this.lineWidth() * this.bppp; },
    
    // Returns the chromosome that contains the given absolute bp position
    chrAt: function(pos) {
      var o = this.options,
        chrIndex = _.sortedIndex(o.chrLabels, {p: pos}, function(v) { return v.p; });
      return chrIndex > 0 ? o.chrLabels[chrIndex - 1] : null;
    },
    
    // Turns a string like "chrX:12512" into an bp position from the start of the genome
    normalizePos: function(pos, forceful) {
      var o = this.options, 
        ret = {}, 
        matches, end;
        
      ret.pos = $.trim(_.isUndefined(pos) ? $(o.jump[0]).val() : pos);
      if (ret.pos === '') { this._searchFor(''); return null; }
      
      matches = ret.pos.match(/^([a-z]+[^:]*)(:(\d+)(([-@])(\d+(\.\d+)?))?)?/i);
      // Does the position string have a colon in it? If so, we try to parse it as a bp position
      if (matches && matches[1]) {
        var chr = _.find(o.chrLabels, function(v) { return v.n === matches[1]; });
        // If this didn't match a real chromosome name, use the first, by default.
        if (!chr) { chr = _.first(o.chrLabels); }
        this._searchFor('', forceful);
        ret.pos = chr.p + parseInt(matches[3] || '1', 10);
        if (matches[5] == '-') {
          // Allow ranges, e.g. chrX:12512-12630
          end = chr.p + parseInt(matches[6], 10);
          if (end > ret.pos) {
            ret.bppp = (end - ret.pos) / (this.lineWidth() - o.sideBarWidth);
            // Find the nearest optimal zoom level on the slider that fully encompasses the range.
            ret.bppp = _.find(this.sliderBppps.reverse(), function(v) { return v >= ret.bppp; }) || _.last(this.sliderBppps);
            this.sliderBppps.reverse(); // .reverse() is destructive in JS -_-
            ret.pos += floorHack((end - ret.pos) / 2);
          }
        } else if (matches[5] == '@') {
          // or specifying bppp directly, e.g. chrX:12512@100
          ret.bppp = parseFloat(matches[6]);
        }
      } else { 
        pos = parseInt(ret.pos, 10);
        if (_.isNaN(pos)) {
          this._searchFor(ret.pos, forceful);
          return null;
        }
        ret.pos = pos;
      }
      
      return ret;
    },
    
    // Displays the search dropdown where the user can select from features that match the query
    _searchFor: function(search, forceful) {
      var self = this,
        o = self.options,
        $elem = self.element;
      function hilite(text, searchFor) {
        return text.replace(new RegExp(regExpQuote(searchFor), "gi"), '<span class="hilite">'+searchFor+'</span>');
      }
      function createChoice(c, cat) {
        var $c = $('<div class="choice"/>');
        $('<h3 class="name"/>').html(hilite(c.name, search)).appendTo($c);
        $('<p class="long-desc"/>').html(hilite(c.desc, search)).appendTo($c);
        $c.bind('fakefocus', function() { $(this).addClass('focus'); $(this).siblings().removeClass('focus'); });
        $c.bind('fakeblur', function() { $(this).removeClass('focus'); });
        $c.mouseover(function() { $(this).trigger('fakefocus'); });
        $c.click(function() {
          var m, picked = (m = c.desc.match(/^\((.+)\)/)) ? m[1].toLowerCase() : c.name.toLowerCase();
          $('body').unbind('mousedown.search');
          self.$trackPicker.find('input[name='+cat.track+']').attr('checked', true);
          self.tileFixingEnabled(false);
          self._fixTracks({duration: 0, complete: function() {
            // This callback maximizes the track that contained the feature clicked, and flashes the feature.
            // Flashing the clicked feature is tricky because everything is loading at different times.
            var $maximizeTrack = self.$lines.eq(self.centralLine).find('.browser-track-'+cat.track).eq(0);
            $maximizeTrack.one('trackload', function(e, bppps) {
              var $imgs = self.$lines.find('.bppp-'+classFriendly(bppps.top)+' .tdata.dens-pack');
              maxHeight = 5 + Math.max.apply(Math, $imgs.map(function() { 
                return this.naturalHeight || this.height;
              }).get());
              // After the track is resized, flash all the features that were added to our todo-list
              self._resizeTrack(cat.track, maxHeight, self.centralLine, function() {
                var $stillLoading = self.$lines.find('.browser-track-'+cat.track).has('.areas-loading');
                $elem.find('.browser-track').genotrack('updateDensity');
                function flash() { self.areaHover([cat.track, bppps.top, "pack", "name", picked], "FLASHME"); };
                // FIXME: this is pretty rickety
                if (!$stillLoading.length) { flash(); }
                else { $stillLoading.one('areaload', _.after($stillLoading.length, flash)); }
              });
            });
            _.defer(function(){ self.tileFixingEnabled(true); $elem.find('.browser-track-'+cat.track).genotrack('fixClickAreas'); });
          }});
          self.jumpTo(c.pos);
          return false; 
        });
        return $c;
      }
      function hideChoices() { self.$choices.find('.choice').trigger('fakeblur'); self.$choices.hide(); }
      
      if (search==='') { return hideChoices(); }
      if (search===self.prevSearch && !forceful) { return; }
      self.$choices.empty().addClass('loading').removeClass('no-results').slideDown();
      $('body').bind('mousedown.search', function(e) { 
        if (!$(e.target).closest(self.$choices).length) { hideChoices(); }
        $('body').unbind('mousedown.search');
      });
      if (self.currentSearch) { self.currentSearch.abort(); }
      
      self.prevSearch = search;
      self.currentSearch = $.ajax(o.ajaxDir+'search.php', {
        data: {position: search, db: o.genome},
        dataType: 'json',
        success: function(data) {
          self.$choices.removeClass('loading');
          if (data['goto']) { self.jumpTo(data['goto']); return; }
          if (!data.categories || data.categories.length===0) { self.$choices.addClass('no-results'); return; }
          var numCategories = _.keys(data.categories).length,
            choicesPerCategory = Math.max(Math.ceil(12 / numCategories), 3);
          _.each(data.categories, function(cat, catname) {
            $('<div class="choice-category"/>').text(catname).appendTo(self.$choices);
            _.each(cat.choices.slice(0, choicesPerCategory), function(c) {
              var $c = createChoice(c, cat).appendTo(self.$choices);
            });
          });
          self.$choices.find('.choice').eq(0).trigger('fakefocus');
        }
      });
    },
        
    // public (indirect) setter for this.pos; centers the reticle on reticPos
    jumpTo: function(reticPos) {
      var dest = this.normalizePos(reticPos, true);
      if (dest !== null) {
        this.$choices.hide().empty();
        if (dest.bppp) {
          this.pos = dest.pos - this._reticDelta();
          this.zoom(dest.bppp); 
        } else {
          this._pos(dest.pos - this._reticDelta());
        }
        $(this.options.jump[0]).blur();
      }
    },
    
    // private setter for this.pos that updates the UI accordingly.
    // forceRepos usually means a zoom happened, which requires that the tiles are repositioned within the tracks.
    _pos: function(pos, exceptFor, forceRepos) {
      var o = this.options,
        bpWidth = this.bpWidth(),
        rd = this._reticDelta();
      exceptFor = $(exceptFor).get(0);
      pos = _.isUndefined(pos) ? this.pos : pos;
      this.pos = pos;
      this.$lines.each(function(i) {
        if (this == exceptFor) { return; }
        $(this).genoline('jumpTo', pos + i * bpWidth, forceRepos); 
      });
      if (forceRepos) { this._fixZoomedTrackDebounced(); }
      this._fixClickAreasDebounced();
      this._saveParamsDebounced();
    },
    
    // Returns the position (in basepairs) closest to the mouse cursor
    _posAtMouse: function(e) {
      var $line = $(e.srcElement || e.originalTarget).closest('.browser-line');
      if (!$line.length) { return null; }
      return (e.pageX - this.options.sideBarWidth) * this.bppp + $line.genoline('getPos');
    },
    
    // public getter/setter for this.bppp that updates the UI.  If duration is specified, animates the change in zoom.
    zoom: function(zoom, centeredOn, duration) {
      var self = this,
        o = self.options;
      
      function sliderValue(zoom) {
        var ret = 0;
        for (var i = 0; i < self.sliderBppps.length; i++) {
          var bppp = self.sliderBppps[i];
          if (zoom > bppp) {
            var frac = zoom - bppp;
            return ret + (1.0 - frac / (self.sliderBppps[ret] - self.sliderBppps[i]));
          }
          ret = i;
        }
        return ret;
      }
      
      if (!_.isUndefined(zoom)) {
        if (!_.isUndefined(centeredOn) && centeredOn !== null) { this.centeredOn = centeredOn; }
        else { delete this.centeredOn; }
        if (!_.isUndefined(duration)) {
          this._animateZoom(_.isBoolean(zoom) ? zoom : sliderValue(zoom), duration);
        } else {
          this.$slider.slider('value', sliderValue(zoom));
        }
      }
      return this.bppp; 
    },
    
    // private setter for this.bppp; does not update the slider--used internally by it.
    _zoom: function(zoom, centeredOn) {
      centeredOn = centeredOn || this.centeredOn || (this.pos + this._reticDelta());
      var pos = centeredOn - (centeredOn - this.pos) / (this.bppp / zoom);
      this.bppp = zoom;
      var now = (new Date).getTime();
      this._pos(pos, null, true);
      fps("ZOOM", (new Date).getTime() - now, this.bppp);
      this._updateReticle(centeredOn);
    },
    
    // If "to" is boolean, true will raise the slider one step and false will lower it one step.
    _animateZoom: function(to, duration) {
      var self = this,
        $slider = $(self.options.zoomSlider),
        from = $slider.slider('value');
      if (_.isBoolean(to)) { to = Math[to ? 'ceil' : 'floor'](from + (to ? 0.001 : -0.001)); }
      $slider.css('text-indent', 0).animate({textIndent: 1}, {
        queue: false,
        step: function(i) { $slider.slider('value', (to - from) * i + from); },
        complete: function() { self.bounceCheck(); },
        duration: duration || 150
      });
    },
    
    // Bounce off edges if we are toward the margins of the genome
    bounceCheck: function() {
      var self = this,
        o = self.options,
        $elem = self.element,
        bpWidth = this.bpWidth(),
        pos = self.pos,
        numLines = self.lines().length,
        margins = [(-numLines + o.bounceMargin) * bpWidth, o.genomeSize - o.bounceMargin * bpWidth],
        outsideGenomeRange = pos < margins[0] || pos > margins[1];
      
      if (outsideGenomeRange && !self._bouncing) {
        $elem.find('.drag-cont').stop(true); // Stop any current inertial scrolling
        self.bounceTo(_.min(margins, function(marg) { return Math.abs(marg - pos); }));
      }
    },
    
    // Animates a "bounce" from the current browser position to targetPos
    bounceTo: function(targetPos, callback) {
      var self = this,
        $elem = self.element,
        zoom = self.zoom(),
        pos = self.pos,
        naturalFreq = 0.03,
        vInit = $elem.data('velocity') || 0,
        deltaXInit = (targetPos - pos) / zoom;
        bounceStart = (new Date).getTime();
        
      $elem.css('text-indent', 1);
      self._bouncing = true;
      $elem.animate({textIndent: 0}, {
        queue: false,
        duration: 500, // TODO: some better way of approximating this based on dampened spring motion.
        step: function() {
          var newTime = (new Date).getTime(),
            deltaT = newTime - bounceStart,
            // see http://en.wikipedia.org/wiki/Damping#Critical_damping_.28.CE.B6_.3D_1.29
            newDeltaX = (deltaXInit + (vInit + naturalFreq * deltaXInit) * deltaT) * Math.exp(-naturalFreq * deltaT);
          self._pos(pos + (deltaXInit - newDeltaX) * zoom);
        },
        complete: function() { self._bouncing = false; _.isFunction(callback) && callback(); }
      });
    },
    
    // ===================================================================================================
    // = The following functions handle or assist events sent from sub-widgets, like the lines or tracks =
    // ===================================================================================================
    
    // Returns the distance left or right, in pixels, that the lines have been shifted by the last keypress
    keyedOffset: function() { return this._keyedOffset; },
    
    // Fixing tiles can be temporarily disabled and re-enabled with this function
    tileFixingEnabled: function(set) {
      this._tileFixingEnabled = (!_.isUndefined(set) ? !!set : this._tileFixingEnabled);
      if (set) { this.$lines.genoline('fixTrackTiles', true); }
      return this._tileFixingEnabled; 
    },
    
    // Handle a drag event on one of the lines, propagating its motion to the other lines
    recvDrag: function($src, linePos) {
      var lineIndex = this.$lines.index($src),
        pos = linePos - lineIndex * this.bpWidth();
      var now = (new Date).getTime();
      this._pos(pos, $src);
      fps("MOVE", (new Date).getTime() - now, this.bppp);
    },
    
    // Handle a track resize event on one of the lines, propagating its changes to the other lines and fixing the layout
    recvTrackResize: function($src, name, height, callback) {
      var holdSteady = $src && this.$lines.index($src);
      this._resizeTrack(name, height, holdSteady, _.isFunction(callback) ? callback : true);
    },
    
    // Handle a track reorder action on one of the lines, propagating its changes to the other lines
    // newOrder is an array mapping oldIndex => newIndex
    recvSort: function($src, newOrder) {
      var o = this.options;
      _.each(o.tracks, function(v, i) { v._i = i; });
      o.tracks.sort(function(a, b) { return newOrder[a._i] - newOrder[b._i]; });
      _.each(o.tracks, function(v, i) { delete v._i; });
      this.$lines.not($src).genoline('fixTracks').genoline('fixTrackTiles');
    },
    
    // Handle a mousewheel event on one of the lines, propagating its changes to all lines.
    _recvZoom: function(e, manualDelta) {
      var self = this,
        o = this.options,
        d = [manualDelta, e.originalEvent.wheelDeltaY, e.originalEvent.wheelDelta, 
          e.originalEvent.axis == 2 && -e.originalEvent.detail],
        userAgent = navigator && navigator.userAgent,
        adjust = [[(/chrome/i), 0.06], [(/safari/i), 0.03], [(/opera|msie/i), 0.01]];
        
      // You can scroll the track pickers, select boxes, and textareas
      if ($(e.target).closest('.picker,select,textarea').length) { return; }
      
      self.element.find('.drag-cont').stop();                           // Stop any current inertial scrolling
      if (_.isUndefined(self._wheelDelta)) { self._wheelDelta = 0; }
      $.tipTip.hide();                                                  // Hide any tipTips showing
      d = _.reject(d, _.isUndefined).shift();
      self.centeredOn = self._posAtMouse(e.originalEvent);
      
      // mousewheeling is more performant (esp in Safari) if it all the events fire on a single element
      // which is why we throw a "shield" element in front of all the browser lines during zooms to capture the events
      // FIXME: Is this still needed? Safari has possibly fixed this?
      // self.lines().genoline('toggleZoomShield', true);                
      
      if (d && self.centeredOn !== null) {
        var value = self.$slider.slider('value'),
          delta = (o.snapZoom ? (self._wheelDelta += d) : d) / 20;
        if (userAgent && _.isUndefined(manualDelta)) { 
          _.find(adjust, function(v) { return v[0].test(userAgent) && (delta *= v[1]); }); 
        } else if (e.originalEvent.wheelDeltaY) { delta *= 0.05; }
        if (o.snapZoom) {
          if (Math.abs(delta) > 1.2) { 
            self._animateZoom(delta > 0, 1000);
            self._wheelDelta = 0;
          }
        } else { self.$slider.slider('value', value + delta); }
        self._finishZoomDebounced(delta > 0);
      }
      
      return false; // disable scrolling of the document
    },
    
    // This is fired shortly after tracks believe that all images have loaded.
    // We recalculate the density order of tracks, and fix the orange clip indicators.
    _recvTrackLoad: function(e) {
      var self = this,
        $elem = self.element,
        $trk = $(e.target),
        t = $trk.genotrack('option', 'track');
      
      // This handler is manually debounced by 100ms, separately per track.
      self._trackLoadTimers = self._trackLoadTimers || {};
      if (!_.isUndefined(self._trackLoadTimers[t.n])) { clearTimeout(self._trackLoadTimers[t.n]); }
      self._trackLoadTimers[t.n] = setTimeout(_.bind(function($trk, t) {
        // we have new image data, so *force* recalculation of the densityOrder
        self.densityOrder(t.n, t.h, $trk.genotrack('bppps'), true);
        $elem.find('.browser-track-'+t.n).genotrack('fixClipped');
      }, self, $trk, t), 100);
    },
    
    // ===============================================
    // = These functions manipulate the tank reticle =
    // ===============================================
    
    // Returns the offset of the reticle, in basepairs, from the position of the browser
    // which is designated as the basepair at the left edge of the topmost line
    _reticDelta: function(line) {
      line = _.isUndefined(line) ? this.centralLine : line;
      var bpWidth = this.bpWidth();
      return (line + 0.5) * bpWidth - this.options.sideBarWidth * 0.5 * this.bppp;
    },

    // Change the position and width of the reticle
    _updateReticle: function(centeredOn, animOpts) {
      var $elem = this.element,
        o = this.options,
        bpWidth = this.bpWidth(),
        zoom = this.bppp,
        lineIndex = _.isNumber(centeredOn) ? floorHack((centeredOn - this.pos) / bpWidth) : this.centralLine,
        nextZooms = this.sliderBppps.slice(Math.ceil(this.$slider.slider('value') + 0.001)),
        $line = this.$lines.eq(lineIndex),
        duration = animOpts && !_.isUndefined(animOpts.duration) ? animOpts.duration : 200;
      function hide($retics, d) {
        d = d || duration;
        $retics.animate({opacity: 0}, { duration: d, complete: function() { $(this).addClass('hidden'); } });
      }
      if (!nextZooms.length) { nextZooms = this.sliderBppps.slice(-1); }
      if (_.isUndefined(centeredOn)) {
        if (!_.any(this._showReticle)) { return hide($elem.find('.retic:not(.hidden)')); }
        $line.find('.retic.hidden').animate({opacity: o.reticOpacity}, {
          duration: 200, 
          complete: function() { $(this).removeClass('hidden'); }
        });
      } else {
        $line.find('.retic').css('opacity', o.reticOpacity).removeClass('hidden');
        this._updateReticleDebounced();
      }
      $line.genoline('setReticle', nextZooms, centeredOn);
      hide(this.$lines.not($line.get(0)).find('.retic:not(.hidden)'), 0);
    },
    
    // Display the reticle for one of several possible reasons (set them as true or false)
    // The reticle will be shown if any of the reasons apply
    showReticle: function(why, val) {
      this._showReticle[why] = val;
      this._updateReticle();
    },
    
    // ===================================================================================================
    // = The following functions are debounced; they update the display after a repeated event concludes =
    // ===================================================================================================
    
    // After a short delay, a zoom action can be "snapped" to the nearest optimal level
    // NOTE: This is _.debounce'd in init()
    _finishZoomDebounced: function(direction) {
      this.bounceCheck();
      if (this.options.snapZoomAfter && !this.options.snapZoom) { this._animateZoom(direction); }
      if (this.options.snapZoom) { self._wheelDelta = 0; }
      this.lines().genoline('toggleZoomShield', false);
    },
    
    // Everytime we zoom in on a line, we have to recalculate the density order of tracks,
    // and redraw the tick marks on the ruler track.
    // NOTE: This is _.debounce'd in _init()
    _fixZoomedTrackDebounced: function() {
      var self = this,
        o = this.options,
        $elem = self.element;
      _.each(o.tracks, function(t) {
        self.densityOrder(t.n, t.h, $elem.find('.browser-track-'+t.n).genotrack('bppps'));
        $elem.find('.browser-track-'+t.n).genotrack('redrawCanvasTicks');
      });
    },
    
    // Remembers the general layout & position of the browser for the next time it is opened
    // NOTE: This is _.debounce'd in _init()
    _saveParamsDebounced: function() {
      var self = this,
        pos = self.pos,
        o = self.options,
        rd = self._reticDelta(),
        chr = self.chrAt(pos + rd) || o.chrLabels[0],
        zoomFormatted = self.bppp.toPrecision(Math.max(floorHack(self.bppp).toString().length, 6)),
        state = {position: chr.n + ':' + Math.round(pos + rd - chr.p) + '@' + zoomFormatted},
        lineMode = $(o.lineMode).find(':checked').val(),
        $linkPicker = $(o.linking[1]),
        $url = $linkPicker.find('.url'),
        $ucscLink = $linkPicker.find('a[name=ucsc]'),
        url, start, end, ucscParams;
      state.tracks = _.map(o.tracks, function(t) { return t.n + ':' + t.h; }).join('|');
      state.customTracks = self._customTrackUrls.loaded;
      if (lineMode != self._defaultLineMode) { state.mode = lineMode; }
      
      // $.param({...}, true) --> don't add [] to array params
      url = '?' + decodeSafeOctets($.param(_.extend({db: o.genome}, state), true));
      // If the HTML5 history API is implemented, save the state to the URL bar after the first change
      if (window.history && window.history.replaceState && self.state) {
        var now = (new Date).getTime(),
          historyFn = now - (self._histLastReplaced || 0) > 20000 ? 'pushState' : 'replaceState';
        window.history[historyFn]({}, window.document.title, url);
        self._histLastReplaced = (new Date).getTime();
      }
      $url.val(window.location.href.replace(/\?.*$/, '') + url);
      
      // Also make a URL to the equivalent view in UCSC
      if (!o.custom || (/^ucsc:/).test(o.genome)) {
        start = Math.max(Math.round(pos - chr.p), 1);
        end = Math.min(Math.round(pos - chr.p + self.bpWidth() * self.$lines.length), o.chrLengths[chr.n]);
        ucscParams = {db: o.genome.replace(/^ucsc:|:\d+$/g, ''), position: chr.n + ':' + start + '-' + end};
        _.each(o.tracks, function(t) { 
          var densityOrderAsArray = _.map(self.densityOrder(t.n), function(v,k) { return [k,v]; }),
            topDensity = _.min(densityOrderAsArray, function(p) { return p[1]; });
          if (topDensity) { ucscParams[t.n] = topDensity[0]; }
        });
        $ucscLink.closest('.form-line').show();
        $ucscLink.attr('href', o.ucscURL + '?' + $.param(ucscParams));
      } else {
        $ucscLink.closest('.form-line').hide();
      }
      
      // Save state in localStorage, sessionStorage, and $.cookie as appropriate
      self.state = state;
      self.storage && _.each(o.savableParams, function(keys, dest) {
        _.each(keys, function(k) {
          var fullKey = (dest != 'persistent' ? o.genome + '.' : '') + k;
          if (!_.isUndefined(state[k])) { 
            self.storage[dest].setItem(fullKey, state[k]); 
          } else {
            self.storage[dest].removeItem(fullKey);
          }
        });
      });
    },
    
    // ===========================================================================================
    // = The following functions coordinate the click areas that appear when hovering over tiles =
    // ===========================================================================================
    
    // Everytime we move the browser, we have to fetch new click area data.
    // NOTE: This is _.debounce'd in _init()
    _fixClickAreasDebounced: function() {
      var self = this, 
        o = this.options,
        $elem = self.element;
      _.each(o.tracks, function(t) {
        $elem.find('.browser-track-'+t.n).genotrack('fixClickAreas');
      });
    },
    
    // Areas are stored in a global index, so that mousing over an area in one tile can retrieve
    // areas with a similar name/hrefHash that must also be highlighted.  This function receives
    // information about a current hover event and creates the appropriate highlighted anchors
    // within the correct tiles. 
    areaHover: function(keys, target) {
      var $elem = this.element;
      if (_.isUndefined(keys)) { return this._areaHover; }
      $elem.find('.area.rect').remove();
      $elem.find('.area.label.hover').removeClass('hover');
      if (!keys) { $.tipTip.hide(); return (this._areaHover = false); }
      if (keys.length != 5) { throw 'not enough levels to traverse index'; }
      var areaIndices = this._areaIndex;
      // keys is used to traverse the first 5 levels of the areaIndex, which is organized as follows:
      // areaIndex[track][bppp][density]["hrefHash"|"name"][hrefHash|name][tileId][localAreaId] = true
      for (var i = 0; i < keys.length; i++) {
        var k = keys[i];
        if (!areaIndices[k]) { areaIndices = false; break; }
        areaIndices = areaIndices[k];
      }
      if (areaIndices) {
        _.each(areaIndices, function(localAreaIds, tileId) {
          var $t = $('#'+tileId),
            $tdata = $t.children('.tdata.dens-'+keys[2]),
            $track, areas;
          if (!$t.length || !(areas = $tdata.data('areas'))) { return; }
          $track = $t.parent();
          _.each(localAreaIds, function(dummy, id) {
            var area = areas[id],
              flags = {};
            if (target === "FLASHME") { flags.flashme = true; }
            else {
              flags.hover = true;
              if (target && target == tileId + '.' + id) { flags.tipTipActivated = true; }
            }
            $track.genotrack('makeAnchor', $t, area, $tdata.data('bppp'), $tdata.data('density'), flags);
          });
        });
        if (keys[3]=='hrefHash') {
          // Also highlight any existing .area's (e.g. labels on custom tracks)
          $elem.find('.browser-track-'+keys[0]+'>.bppp-'+classFriendly(keys[1])+'>.dens-'+keys[2]+'.href-hash-'+keys[4]).addClass('hover');
        }
      } else { throw 'something went wrong while running through the areaIndex'; }
      return (this._areaHover = keys[0] + '.' + keys[3] + '.' + keys[4]);
    },
    
    // Return the area index; other widgets can access it directly
    areaIndex: function() { return this._areaIndex; },
    
    // =====================================================
    // = Miscellaneous functions that didn't fit elsewhere =
    // =====================================================
    
    // Fetches DNA from the AJAX service for a particular bp range and sends it off to the callback function
    getDNA: function(left, right, callback, extraData) {
      var self = this,
        o = self.options,
        chunkSize = o.maxNtRequest;
      if (!this._dnaCallbacks) { this._dnaCallbacks = []; }
      
      function loadedFromAjax(data, statusCode, jqXHR) {
        self._dna[jqXHR._s] = data.seq;
        checkCallbacks();
      }
      function ajaxLoadDNA() {
        var slots = emptyCacheSlots(self.pos, self.pos + self.bpWidth() * self.$lines.length);
        _.each(slots, function(s) {
          var ajaxOptions = {
            data: {db: o.genome, left: s * chunkSize + 1, right: (s + 1) * chunkSize + 1},
            dataType: 'json',
            success: loadedFromAjax,
            beforeSend: function(jqXHR) { jqXHR._s = s; }
          };
          if (o.custom) {
            ajaxOptions.type = "POST";
            ajaxOptions.data.chr_order = JSON.stringify(o.chrOrder);
            ajaxOptions.data.chr_lengths = JSON.stringify(o.chrLengths);
          }
          $.ajax(o.ajaxDir + 'dna.php', ajaxOptions);
          self._dna[s] = false;
        });
      }
      function emptyCacheSlots(left, right) {
        // convert 1-based positions to 0-based
        left = Math.max(left - 1, 1);
        right = Math.min(right - 1, o.genomeSize);
        var i = Math.floor(left / chunkSize),
          end = Math.floor(right / chunkSize),
          slots = [];
        while (i <= end) { if (_.isUndefined(self._dna[i])) { slots.push(i); } i++; }
        return slots;
      }
      function getFromCache(left, right) {
        left--; right--; // convert 1-based positions to 0-based
        var i = Math.floor(left / chunkSize),
          end = Math.floor(right / chunkSize),
          segs = [], seg, start;
        while (i <= end) {
          seg = self._dna[i];
          start = Math.max(left - i * chunkSize, 0);
          if (!seg) { return null; }
          segs.push(seg.substr(start, i==end ? (right - end * chunkSize - start) : undefined));
          i++;
        }
        return segs.join('');
      }
      function checkCallbacks() {
        self._dnaCallbacks = _.filter(self._dnaCallbacks, function(c) {
          var dna = getFromCache(c.left, c.right);
          if (dna !== null) { c.fn(dna, c.extraData); return false; }
          else { return true; }
        });
      }
      
      var dna;
      if (o.custom && o.custom.canGetSequence) {
        o.custom.getSequence(left, right, function(dna) { callback(dna, extraData); });
        return;
      } else {
        dna = getFromCache(left, right);
      }
      if (dna !== null) { callback(dna, extraData); }
      else {
        this._dnaCallbacks.push({left: left, right: right, fn: callback, extraData: extraData});
        ajaxLoadDNA();
      }
    },
    
    // Updates the text for the genome species and description in the window title and footer
    _updateGenomes: function() {
      var self = this,
        o = self.options,
        $genome = $(o.genomePicker[0]),
        $title = $genome.find('.title'),
        speciesParenthetical = o.species.match(/\((.+)\)/),
        $li = $genome.find('li.divider').eq(0).show();
      
      self._defaultTitle = self._defaultTitle || window.document.title;
      window.document.title = o.species + ' - ' + self._defaultTitle;
      $title.text(o.species.replace(/\s+\(.*$/, '')).attr('title', o.species);
      if (speciesParenthetical) { $('<em class="parenth" />').text(', ' + speciesParenthetical[1]).appendTo($title); }
      $genome.find('.description').text(o.assemblyDate + ' (' + o.genome.replace(/\|.*$/, '') + ')');
      
      // Fill the genome picker with available configured genomes
      $genome.find('.choice.genome-choice').remove();
      _.each(o.genomes, function(v, k) {
        if (/^_/.test(k) || k == o.genome) { return; }
        var $a = $('<a class="clickable"/>').attr('href', './?db='+k);
        $a.appendTo($('<li class="choice genome-choice"/>').insertBefore($li));
        $('<span class="name"/>').text(v.species).appendTo($a);
        $('<span class="long-desc"/>').text(v.assemblyDate + ' (' + k + ')').appendTo($a);
        $a.hover(function() { $(this).addClass('hover'); }, function() { $(this).removeClass('hover'); });
      });
      if ($genome.find('.choice.genome-choice').length == 0) { $li.hide(); }
    }
    
  });

});

},{"../underscore.min.js":34,"./jquery-ui.genoline.js":26,"./jquery-ui.genotrack.js":27,"./jquery.farbtastic.js":30,"./jquery.misc-plugins.js":31,"./jquery.tiptip.js":32,"./utils.js":33}],26:[function(require,module,exports){
// ===================================================================
// = Each line of the $.ui.genobrowser is managed by a $.ui.genoline =
// ===================================================================

module.exports = function($) {

$.widget('ui.genoline', {

  // Default options that can be overridden
  options: {
    disabled: false
  },

  // Called automatically when widget is instantiated
  _init: function() {
    var $elem = this.element, 
      o = this.options,
      html;
    this.pos = parseInt(o.origin, 10) || 0;
    this.$side = $('<div class="side-cont"/>').appendTo($elem);
    this.$firstLabel = $('<div class="first-label"/>').appendTo($elem);
    this.$trackCont = $('<div class="track-cont"/>').appendTo($elem);
    this.$cont = $('<div class="drag-cont"/>').appendTo(this.$trackCont);
    this.$retic = $('<div class="retic hidden"/>').appendTo($elem);
    this.$indices = $('<div class="indices"/>').appendTo($elem);
    this.$zoomshield = $('<div class="zoom-shield hidden"/>').appendTo($elem);
    this.centeredOn = null; // for the reticle
    
    html = '<div class="c nw"/><div class="c ne"/><div class="c sw"/>'
      + '<div class="c se"/><div class="v n"/><div class="v s"/><div class="inner-retic">'
      + '<div class="c nw"/><div class="c ne"/><div class="c sw"/><div class="c se"/></div>';
    $(html).appendTo(this.$retic);
    html = '<div class="start"></div><div class="end"></div>';
    $(html).appendTo(this.$indices);
    
    this._initContDraggable();
    this._initSideSortable();
    this.$trackCont.bind('dblclick', {self: this}, this._recvDoubleClick);
    $elem.addClass('shadow');
    this.fixTracks();
    this.jumpTo(this.pos);
  },
  
  _initContDraggable: function() {
    var self = this, $elem = this.element, o = this.options, 
      dragEvents = [],
      initKeyedOffset = 0,
      snappingToAnimation = {},
      fudge,
      lineJump,
      topOffsets,
      snappingTo,
      snappingToInterval;
    function snappingToMotion() {
      var dt = (new Date).getTime() - snappingToAnimation.start,
        proportion = Math.min(dt / o.lineFixDuration, 1);
      snappingTo = (1 - Math.pow(1 - proportion, 4)) * (snappingToAnimation.to - snappingToAnimation.from) + snappingToAnimation.from;
      updateLineTop();
      if (proportion == 1) { clearInterval(snappingToInterval); }
    }
    function animateSnap() {
      snappingToAnimation = {from: snappingTo, to: $elem.data('naturalTop'), start: (new Date).getTime()};
      clearInterval(snappingToInterval);
      snappingToInterval = setInterval(snappingToMotion, 13);
    }
    function updateLineTop(top) {
      if (!_.isUndefined(top)) { snappingToAnimation.top = top; }
      var snapOffset = (snappingToAnimation.top - topOffsets.top - topOffsets.click - snappingTo),
        deadZone = o.verticalDragDeadZone / 2,
        snapOffsetSquashed = Math.abs(snapOffset) > deadZone ? snapOffset + (snapOffset > 0 ? -deadZone : deadZone) : 0,
      // First apply a flat dead zone around the zero point
        curved = 40 / (1 + Math.exp(0.1 * snapOffsetSquashed)) - 20 + snapOffsetSquashed;
      // Then use a logistic function transformed to asymptotically approach a slope of 1
      if (topOffsets.length > 1) { $elem.css('top', snappingTo + curved); }
    }
    function updatePos(left, top) {
      var newJump = lineJump, 
        zoom = o.browser.genobrowser('zoom');
      if (!_.isUndefined(top)) {
        _.each(topOffsets, function(v) {
          if (newJump == lineJump && v[1] > lineJump && top < v[0] + fudge) { newJump = v[1]; }
          if (v[1] < lineJump && top > v[0] - fudge) { newJump = v[1]; }
        });
        if (newJump != lineJump) {
          o.browser.genobrowser('shiftLines', newJump - lineJump, $elem.get(0));
          animateSnap();
          self.fixTrackTiles(); 
          lineJump = newJump;
        }
      }
      self.pos = o.origin - left * zoom;
      updateLineTop(top);
      self.fixFirstLabel();
      self.fixIndices();
      o.browser.genobrowser('recvDrag', $elem, self.pos);
    };
    
    self.$cont.mousedown(function() {
      o.browser.find('.drag-cont').stop(); // Stop any current inertial scrolling immediately on mousedown
    })
    self.$cont.draggable({
      axis: 'x',
      cursor: '',
      cancel: '.nts,:input,option',
      start: function(e) { 
        var width = o.browser.genobrowser('lineWidth'),
          $lines =  o.browser.genobrowser('lines').removeClass('last-resized'),
          lineIndex = $lines.index($elem.get(0));
        $('body').addClass('dragging');
        $elem.addClass('last-resized');
        lineJump = 0;
        topOffsets = [];
        fudge = (self.lineHeight() + o.betweenLines) * 0.3;
        snappingTo = $elem.data('naturalTop');
        snappingToAnimation = {};
        topOffsets.click = e.originalEvent.pageY - $elem.offset().top;
        _.each($lines, function(v, i) {
          var top = $(v).offset().top;
          if (i == 0) { topOffsets.top = top; }
          topOffsets.push([top + topOffsets.click, lineIndex - i]); 
        });
        o.browser.genobrowser('showReticle', 'dragging', true);
        $.tipTip.hide();
      },
      drag: function(e, ui) {
        var oe = e.originalEvent, now = (new Date).getTime();
        updatePos(ui.position.left, oe.pageY);
        dragEvents.push({t: now, x: oe.pageX});
        while (dragEvents[0].t < now - 250) { dragEvents.shift(); }
      },
      stop: function(e, ui) {
        var x = e.originalEvent.pageX, 
          now = (new Date).getTime(),
          // the second to last dragEvent seems to be the most informative for velocity.
          dragEvent = dragEvents.slice(-2,-1).pop(), 
          dt = dragEvent && (now - dragEvent.t),
          vInit = dragEvent && (x - dragEvent.x) / dt,
          perfectPageY = (_.isUndefined(snappingToAnimation.to) ? $elem.data('naturalTop') : snappingToAnimation.to) 
            + topOffsets.top + topOffsets.click;
        self.fixTrackTiles();
        $('body').removeClass('dragging');
        updateLineTop(perfectPageY);
        initKeyedOffset = o.browser.genobrowser('keyedOffset');
        o.browser.genobrowser('showReticle', 'dragging', false);
        if (Math.abs(vInit) > 0.1) {
          var xInit = ui.position.left, decel = vInit > 0 ? 0.001 : -0.001, lastRefresh = 0;            
          self.$cont.css('text-indent', 1);
          self.$cont.animate({textIndent: 0}, {
            queue: false,
            duration: Math.abs(vInit / decel),
            step: function() {
              var newTime = (new Date).getTime(),
                deltaT = newTime - now,
                // allow the keyboard to shift the position *during* inertial scrolls
                keyedOffset = o.browser.genobrowser('keyedOffset'),
                deltaL = (vInit*deltaT) - (0.5*decel*deltaT*deltaT) + initKeyedOffset - keyedOffset;
                left = xInit + deltaL;
              // store the velocity on the browser element so it can catch the throw if a bounce is needed
              o.browser.data('velocity', vInit - decel * deltaT);
              // for those looong inertial scrolls, keep the tiles coming
              if (Math.abs(deltaL - lastRefresh) > 1000) { lastRefresh = deltaL; self.fixTrackTiles(); }
              self.$cont.css('left', left);
              updatePos(left);
              o.browser.genobrowser('bounceCheck');
            },
            complete: function() { 
              self.fixTrackTiles(); 
              o.browser.data('velocity', 0);
              o.browser.genobrowser('bounceCheck');
            }
          });
        } else {
          self.fixTrackTiles();
          o.browser.genobrowser('bounceCheck');
        }
      }
    });
  },
  
  _initSideSortable: function() {
    var self = this,
      o = self.options,
      $elem = self.element;
    this.$side.sortable({
      axis: 'y',
      placeholder: 'side placeholder inset-shadow',
      forcePlaceholderSize: true,
      appendTo: '#' + o.browser.attr('id'),
      handle: '.subtrack-cont',
      helper: 'clone',
      start: function() { 
        $('body').addClass('dragging');
        self.$cont.children('.browser-track').each(function(i) { $(this).data('oldIndex', i); });
      },
      stop: function() { $('body').removeClass('dragging'); },
      change: function(e, ui) {
        self.$cont.children('.browser-track').sortElements(function(a, b) {
          a = $(a).genotrack('side');
          a = self.$side.children('.side').index(a.is(ui.item) ? ui.placeholder : a);
          b = $(b).genotrack('side');
          b = self.$side.children('.side').index(b.is(ui.item) ? ui.placeholder : b);
          return a - b;
        });
        self.fixFirstLabel(true);
      },
      update: function(e, ui) {
        var newOrder = [];
        self.$cont.children('.browser-track').each(function(i) { newOrder[$(this).data('oldIndex')] = i; });
        o.browser.genobrowser('recvSort', $elem, newOrder);
      }
    });
  },
  
  fixTracks: function() {
    var $elem = this.element, 
      o = this.options,
      $t = this.$cont.children('.browser-track').first(),
      tracks = o.browser.genobrowser('tracks'),
      $u;
    if (!$t.length) { $t = this._addTrack(tracks[0], 0); }
    for (var i = 0; i < tracks.length; i++) {
      var track = tracks[i];
      if ($t.hasClass('browser-track-' + track.n)) { $t = $t.next(); }
      else { this._addTrack(track, $t); }
    }
    do { $u = $t; $t = $t.next(); $u.genotrack('side').remove(); $u.remove(); } while ($t.length);
    this.$side.sortable('refresh');
    this.fixFirstLabel(true);
  },
  
  jumpTo: function(pos, forceRepos) {
    var o = this.options,
      zoom = o.browser.genobrowser('zoom'),
      left = (o.origin - pos) / zoom;
    // Mozilla gets aggravated by CSS lengths outside of 1.0e7; Opera gets aggravated somewhere outside of 1.0e6
    if (left > 1.0e+6 || left < -1.0e+6) { o.origin = pos; left = 0; forceRepos = true; }
    this.pos = pos;
    this.$cont.css('left', left);
    this.fixTrackTiles(forceRepos);
    this.fixFirstLabel();
    this.fixIndices();
  },
  
  fixTrackTiles: function(forceRepos) {
    this.$cont.children('.browser-track').genotrack('fixTiles', forceRepos);
  },
  
  getPos: function() {
    return this.pos;
  },
  
  _addTrack: function(track, pos) {
    var $elem = this.element,
      $trk = $('<div class="browser-track"></div>');
    if (!pos || !pos.length) { $trk[pos === 0 ? 'prependTo' : 'appendTo'](this.$cont); }
    else { 
      if (_.isNumber(pos)) { pos = this.$cont.children('.browser-track').eq(pos); }
      $trk.insertBefore(pos); 
    }
    pos = this.$cont.children('.browser-track').index($trk.get(0));
    var $side = $('<div class="side"/>'), $sides = this.$side.children('.side');
    if (pos && $sides.length) { $side.insertAfter($sides.eq(pos - 1)); }
    else { $side.prependTo(this.$side); }
    return $trk.genotrack($.extend({}, this.options, {track: track, line: $elem, side: $side}));
  },
  
  _lineHeight: function() {
    var o = this.options, tracks = o.browser.genobrowser('tracks');
    return _.reduce(tracks, function(t, u) { return {h:t.h + u.h}; }).h;
  },
  
  lineHeight: function() {
    return this._lineHeight();
  },
  
  fixFirstLabel: function(noHorizMotion) {
    var self = this, $elem = self.element, o = self.options;
    if (!self.$firstLabel) { return; }
    if ($elem.get(0) != o.browser.genobrowser('lines').get(0)) { 
      self.$firstLabel.addClass('occluded');
      $elem.find('.browser-track-ruler .label').removeClass('occluded');
      return;
    }
    if (noHorizMotion === true) {
      var $ruler = $elem.find('.browser-track-ruler');
      if (!$ruler.length) { this.$firstLabel.addClass('no-ruler'); }
      else { this.$firstLabel.removeClass('no-ruler').css('top', $ruler.position().top); }
      return;
    }
    // Horizontal motion means we may have to fix the content and occlusion of the label.
    var label = o.browser.genobrowser('chrAt', self.pos), offsetLeft, width;
    $elem.find('.browser-track-ruler .label').removeClass('occluded');
    if (label===null) { self.$firstLabel.addClass('occluded'); return; } // We are behind chr1.
    self.$firstLabel.text(label.n).removeClass('occluded');
    offsetLeft = self.$firstLabel.offset().left;
    width = self.$firstLabel.width();
    $elem.find('.browser-track-ruler .label').each(function() {
      var thisLeft = $(this).offset().left, thisWidth = $(this).width();
      if (thisLeft + thisWidth > offsetLeft && thisLeft < offsetLeft + width) { 
        self.$firstLabel.addClass('occluded');
        $(this).addClass('occluded');
      }
    });
  },
  
  fixIndices: function() {
    var o = this.options,
      pos = this.pos,
      bpWidth = o.browser.genobrowser('bpWidth'),
      zoom = o.browser.genobrowser('zoom'),
      elem = this.element.get(0),
      multipleLines = o.browser.genobrowser('lines').length > 1,
      reticPos = this.centeredOn === null ? this.pos + 0.5 * (bpWidth - o.sideBarWidth * zoom) : this.centeredOn,
      chrStart, chrEnd, chrRetic;
      
    if (elem == o.browser.genobrowser('lines').get(0)) {
      chrStart = o.browser.genobrowser('chrAt', pos) || o.chrLabels[0];
      this.$indices.children('.start').text((multipleLines ? chrStart.n + ':' : '') + Math.floor(pos - chrStart.p));
    } else { this.$indices.children('.start').empty(); }
    
    if (elem == o.browser.genobrowser('lines').last().get(0)) {
      chrEnd = o.browser.genobrowser('chrAt', pos + bpWidth) || o.chrLabels[0];
      this.$indices.children('.end').text((multipleLines ? chrEnd.n + ':' : '') + Math.ceil(pos + bpWidth - chrEnd.p));
    } else { this.$indices.children('.end').empty(); }
    
    chrRetic = o.browser.genobrowser('chrAt', reticPos) || o.chrLabels[0];
    this.$retic.children('.n').text((multipleLines ? chrRetic.n + ':' : '') + Math.floor(reticPos - chrRetic.p));
  },
  
  setReticle: function(nextZooms, centeredOn) {
    var o = this.options,
      zoom = o.browser.genobrowser('zoom'),
      lineWidth = o.browser.genobrowser('lineWidth'),
      bpWidth = lineWidth * zoom,
      width1 = nextZooms[0] / zoom * lineWidth,
      $innerRetic = this.$retic.children('.inner-retic'),
      opacity = nextZooms[1] ? Math.min(2 - 2 * width1 / lineWidth, 1) : 1,
      noCenteredOn = _.isUndefined(centeredOn) || centeredOn === null,
      left = noCenteredOn ? '50%' : (centeredOn - this.pos) / zoom + o.sideBarWidth;
    this.$retic.css('width', width1).css('margin-left', -width1 * 0.5);
    this.$retic.children('.c').css('opacity', opacity);
    if (nextZooms[1]) {
      var width2 = nextZooms[1] / zoom * lineWidth;
      $innerRetic.show().css('width', width2).css('margin-left', -width2 * 0.5);
      $innerRetic.css('opacity', 1 - opacity);
    } else {
      $innerRetic.hide();
    }
    this.$retic.css('left', left);
    this.centeredOn = noCenteredOn ? null : centeredOn;
  },
  
  _recvDoubleClick: function(e) {
    var self = e.data.self,
      $browser = self.options.browser,
      zoom = $browser.genobrowser('zoom'),
      offset = $(self.$trackCont).offset(),
      offsetLeft = (e.pageX + 8) - offset.left; // compensating for the center of the cursor?
    $browser.genobrowser('zoom', !e.shiftKey, self.pos + (offsetLeft * zoom), 1000);
  },
  
  toggleZoomShield: function(show) {
    this.$zoomshield.toggleClass('hidden', !show);
  }
  
});

};
},{}],27:[function(require,module,exports){
// ====================================================================
// = Each track within a $.ui.genoline is managed by a $.ui.genotrack =
// ====================================================================

module.exports = function($) {

var utils = require('./utils.js')($),
  pad = utils.pad,
  classFriendly = utils.classFriendly,
  shortHash = utils.shortHash,
  floorHack = utils.floorHack;

$.widget('ui.genotrack', {
  
  // Default options that can be overridden
  options: {
    disabled: false,
    line: null,       // must be specified on instantiation
    side: null        // must be specified on instantiation
  },
  
  // Called automatically when widget is instantiated
  _init: function() {
    var self = this,
      $elem = this.element, 
      o = this.options,
      bppps;
    if (!o.line) { throw "Cannot instantiate ui.genotrack without specifying 'line' option"; }
    if (!o.side) { throw "Cannot instantiate ui.genotrack without specifying 'side' option"; }
    self.ruler = o.track.n == 'ruler';
    self.sliderBppps = o.bppps.concat(o.overzoomBppps);
    self.tileLoadCounter = self.areaLoadCounter = 0;
    self.custom = !!o.track.custom;
    self.birth = (new Date).getTime();
    self.$side = $(o.side).append('<div class="subtrack-cont"/>');
    $elem.addClass('browser-track-'+o.track.n).toggleClass('no-ideograms', self.ruler && !o.chrBands);
    self._nearestBppps(o.browser.genobrowser('zoom'));
    // If the track has multiple densities, or its single density has multiple fixed heights,
    // make the sidebar resizable
    self._initSideResizable();
    self._availDensities();
    self.loadingCounter = 0;
    $elem.attr('id', self.uniqId = $.uniqId('trk'));
    self.resize(o.track.h);
    self.updateDensity();
  },
  
  _initSideResizable: function() {
    var self = this,
      $elem = this.element,
      o = self.options,
      bF = self._bpppFormat(o.bppps[0]),
      firstFixedHeight = _.uniq(_.pluck(o.track.fh, _.flatten(o.track.s)[0])),
      paddingBordersY = self.$side.outerHeight() - self.$side.height(),
      minHeight = (self.custom ? o.track.custom.heights.min : Math.min(_.min(o.track.fh[bF]), 32)) - paddingBordersY,
      $linesBelow, $h;
    var opts = {
      handles: 's', 
      minHeight: minHeight,
      start: function(e, ui) {
        var bppp = self.bppps().top,
          fixedHeights = o.track.fh[self._bpppFormat(bppp)],
          customHeights = o.track.custom && o.track.custom.heights;
        $('body').addClass('row-resizing');
        if (!self.ruler && !self.custom) {
          var $imgs = $('.browser-track-'+o.track.n+'>.bppp-'+classFriendly(bppp)+' img.tdata'),
            maxHeight = Math.max.apply(Math, $imgs.map(function() { 
              return this.naturalHeight || this.height; 
            }).get());
          $(this).resizable('option', 'maxHeight', Math.max(maxHeight * 1.2, ui.originalSize.height, 18));
        }
        if (self.custom) {
          if (customHeights.max) { $(this).resizable('option', 'maxHeight', customHeights.max - paddingBordersY); }
          if (customHeights.min) { $(this).resizable('option', 'minHeight', customHeights.min - paddingBordersY); }
        }
        if (!self.ruler) {
          self.snaps = fixedHeights && _.map(fixedHeights, function(v, k) { return k=='dense' ? v : v + 1; });
          if (self.snaps) { self.snaps.always = fixedHeights && !!(fixedHeights.pack || fixedHeights.full); }
        }
        o.browser.find('.browser-line').removeClass('last-resized');
        o.line.addClass('last-resized');
        $(this).addClass('resizing-side');
        $linesBelow = o.line.nextAll().each(function() { $(this).data('origTop', $(this).position().top); });
      },
      resize: function(e, ui) {
        var height = self.$side.outerHeight(); // for some reason ui.size.height is always behind by 1 frame
        if (self.snaps && (ui.size.height < _.max(self.snaps) || self.snaps.always)) {
          height = _.min(self.snaps, function(v) { return Math.abs(v - ui.size.height); });
          self.$side.outerHeight(height);
        }
        o.line.genoline('fixFirstLabel', true);
        self._resize(height);
        $linesBelow.each(function() {
          $(this).css('top', $(this).data('origTop') + height - ui.originalSize.height);
        });
      },
      stop: function(e, ui) {
        $('body').removeClass('row-resizing');
        $(this).removeClass('resizing-side');
        $(this).css('width', '');
        o.browser.genobrowser('recvTrackResize', o.line, o.track.n, self.$side.outerHeight()); 
      }
    };
    if (self.ruler) { opts.maxHeight = o.track.oh - paddingBordersY; }
    self.$side.resizable(opts);
    $h = self.$side.find('.ui-resizable-handle');
    $h.hover(function() { $(this).addClass('hover'); }, function() { $(this).removeClass('hover'); });
  },
  
  side: function() { return this.$side; },
  
  _fixSide: function(density, bppp) {
    var self = this,
      o = self.options,
      $elem = self.element,
      n = o.track.n,
      $cont = self.$side.children('.subtrack-cont'),
      trackDesc = o.browser.genobrowser('option', 'trackDesc'), // always use the latest values from the browser
      densBpppMemo = [density, bppp].join('|'),
      $tooManyDataWarning = self.$side.children('.too-many-warning'), 
      dens, text, h;
    if ($cont.data('densBppp') === densBpppMemo) { return; }
    $cont.empty();
    if (dens = trackDesc[n] && trackDesc[n].dens && trackDesc[n].dens[density]) {
      if (dens[0][0] === 0) {
        // Labels change for certain bppp levels
        dens = (dens[_.sortedIndex(dens, [bppp], function(v) { return v[0]; }) - 1] || dens[0]).slice(1);
      }
      // Apply the appropriate subtrack labels for certain bppp levels
      _.each(dens, function(v) {
        v = _.isArray(v) ? v : [v];
        h = v[1] || 15;
        $('<div class="subtrack"/>').css({height: h, lineHeight: h+'px'}).html(v[0]).appendTo($cont);
      });
    } else {
      text = (trackDesc[n] && trackDesc[n].sm) || o.track.n;
      h = o.track.h;
      $cont.append($('<div class="subtrack unsized"/>').text(text));
    }
    $cont.data('densBppp', densBpppMemo);
  },
  
  // public resize function that updates the entire UI accordingly.
  resize: function(height, animCallback) {
    var o = this.options,
      paddingBordersY = this.$side.outerHeight() - this.$side.height();
    // can pass callback==true to animate without a callback
    if (!_.isFunction(animCallback) && animCallback) { animCallback = function() {}; }
    this._resize(height, animCallback);
    if (animCallback) { this.$side.animate({height: height - paddingBordersY}, o.lineFixDuration); }
    else { this.$side.outerHeight(height); }
  },
  
  // internal resize handler, used by the resizable side handle, does not update the side height.
  _resize: function(height, callback) {
    var o = this.options,
      $elem = this.element,
      bppps = this.bppps();
    if (this.ruler) {
      if (height < this.$side.resizable('option', 'minHeight') + 3) { $elem.addClass('ruler-collapsed'); }
      else { $elem.removeClass('ruler-collapsed'); }
    }
    o.track.h = height;
    o.browser.genobrowser('densityOrder', o.track.n, height, bppps);
    this.fixTiles();
    this.fixClipped();
    if (_.isFunction(callback)) { 
      this.element.animate({height: height}, o.lineFixDuration, callback).css('overflow', 'visible'); 
    } else { this.element.height(height); }
  },
  
  _availDensities: function(bppp) {
    var self = this,
      o = self.options;
    self.availDensities = {};
    _.each(o.bppps, function(bppp) {
      var densities = [];
      for (var i = 0; i < o.track.s.length; i++) {
        var v = o.track.s[i];
        if (!_.isArray(v)) { v = [v]; }
        if (v[1] && bppp > v[1]) { continue; }
        if (v[2] && bppp <= v[2]) { continue; }
        densities.push(v[0]);
      }
      self.availDensities[bppp] = densities;
    });
    return self.availDensities;
  },
  
  _bestDensity: function(bppp) {
    var densities = this.availDensities[bppp],
      densityOrder = this.options.browser.genobrowser('densityOrder', this.options.track.n);
    return _.min(densities, function(d) { return densityOrder[d]; })
  },
  
  updateDensity: function() {
    var self = this,
      o = self.options,
      $elem = self.element,
      topBppp = self.bppps().top;
    var bestDensity = self._bestDensity(topBppp);
    // Fix side labels (e.g. for subtracks) for the best density
    self._fixSide(bestDensity, topBppp);
    // Set the best density and trigger events on these tiles
    $elem.find('.tile-full').children('.tdata,.area.label').each(function() {
      var $this = $(this),
        isBest = $this.hasClass('dens-'+bestDensity);
      $this.toggleClass('dens-best', isBest);
      if (isBest) { $this.trigger('bestDensity'); }
    });
    // If the too-many class was set on tiles, we couldn't draw/load some custom data because there's too much of it.
    // Add a class to this track to show warnings about this to the user.
    // Finally, fix clipping indicators
    self.fixClipped();
  },
  
  _nearestBppps: function(zoom) {
    var o = this.options, 
      bppps = { nearest: [o.bppps[0]], cache: [], top: o.bppps[0] },
      possibleBppps = this.ruler ? this.sliderBppps : o.bppps,
      l = possibleBppps.length,
      found = false,
      shrinkableWindow, getNext;
    for (var i = 0; i < l; i++) {
      var zoomDiff = zoom - possibleBppps[i];
      if (zoomDiff > 0) {
        shrinkableWindow = (possibleBppps[i + 1] || possibleBppps[i] / 3);
        getNext = 0 + (zoomDiff < shrinkableWindow);
        bppps.nearest = possibleBppps.slice(Math.max(i - 2 + getNext, 0), i + getNext);
        if (getNext) { bppps.cache = [false, zoomDiff > shrinkableWindow / 2]; }
        bppps.top = bppps.cache[1] ? bppps.nearest[0] : bppps.nearest.slice(-1)[0];
        found = true; break;
      }
    }
    if (!found) {
      bppps.nearest = possibleBppps.slice(-2);
      bppps.top = possibleBppps.slice(-1)[0];
    }
    if (this.ruler && zoom <= o.ideogramsAbove) {
      bppps.nearest = bppps.nearest.slice(-1);
    }
    bppps.topFormatted = this._bpppFormat(bppps.top);
    return (this._bppps = bppps);
  },
  
  bppps: function(forceRecalc) {
    var zoom = this.options.browser.genobrowser('zoom');
    return (forceRecalc || !this._bppps) ? this._nearestBppps(zoom) : this._bppps;
  },
  
  fixTiles: function(forceRepos) {
    var self = this,
      $elem = self.element, 
      o = self.options;
    if (!o.browser.genobrowser('tileFixingEnabled')) { return; }
    var pos = o.line.genoline('getPos'),
      zoom = o.browser.genobrowser('zoom'),
      availWidth = o.browser.genobrowser('lineWidth'),
      allTilesNeeded = [],
      prevTop = this._bppps && this._bppps.top,
      bppps = this.bppps(forceRepos),
      $notNeeded;
    _.each(bppps.nearest, function(bppp, i) {
      var bpPerTile = o.tileWidth * bppp,
        tileId = floorHack((pos - availWidth * bppp * (bppps.cache[i] ? 0 : 1)) / bpPerTile) * bpPerTile + 1,
        tilesNeeded = [tileId],
        rightMargin = pos + (bppps.cache[i] ? 1 : 2) * availWidth * bppp,
        bestDensity = self._bestDensity(bppp);
      while ((tileId += bpPerTile) < rightMargin) { tilesNeeded.push(tileId); }
      _.each(tilesNeeded, function(tileId) {
        var repos = false, $t = $('#' + self._tileId(tileId, bppp));
        if (!$t.length) { 
          $t = self._addTile(tileId, bppp, bestDensity, bppps.cache[i]); 
          repos = true; 
        }
        if (!bppps.cache[i]) { self._showTile($t); }
        if (repos || forceRepos) { self._reposTile($t, tileId, zoom, bppp); }
        allTilesNeeded.push($t.get(0));
      });
    });
    $notNeeded = $elem.children('.tile').not(allTilesNeeded);
    self.tileLoadCounter -= $notNeeded.children('.loading').length;
    $notNeeded.remove();
    if (prevTop && prevTop != bppps.top) { self.updateDensity(); }
    this._fixLabels(forceRepos);
    this._fixSideClipped();
  },
  
  _setImgDims: function(e) {
    // NOTE: this is only used as bound to a tile <img>'s onLoad! See _addTile
    var self = this,
      h = this.naturalHeight || this.height;
//      if (this.naturalHeight == 1) { _.defer(function() { console.log(self.naturalHeight); }) } // FIXME: this is sometimes erroneously 1px
    $(this).css('height', h).css('width', '100%');
  },
  
  _trackLoadFire: function(e) {
    // NOTE: this is only used as bound to a tile <img>'s onLoad! See _addTile
    var self = e.data.self,
      trackH = self.options.track.h,
      $t = e.data.tile,
      h = this.naturalHeight || this.height;
    $(this).removeClass('loading');
    if (e.data.isBest && e.type != 'error') { 
      $t.addClass('tile-loaded');
      if (h > trackH) { $t.addClass('clipped'); }
      if (!e.data.cached) { self._showTile($t); }
    }
    // e.data.self.availDensities[bppp] = _.without(densities, density); // FIXME, how to knock out tracks that don't load?
    if (--self.tileLoadCounter === 0) { self.element.trigger('trackload', self.bppps()); };
  },
  
  _addTile: function(tileId, bppp, bestDensity, cached) {
    var self = this,
      o = self.options,
      $elem = self.element,
      $d = $.mk('div').attr('class', 'tile'),
      bpPerTile = o.tileWidth * bppp,
      special = self._specialTile(tileId, bppp),
      densities = self.availDensities[bppp],
      $tileBefore = $('#' + self._tileId(tileId - bpPerTile, bppp));
    if ($tileBefore.length) { $d.insertAfter($tileBefore); }
    else { $d.prependTo(self.element) };
    $d.attr('id', self._tileId(tileId, bppp)).data({zIndex: _.indexOf(self.sliderBppps, bppp), tileId: tileId});
    if ($.support.touch) { self._tileTouchEvents($d); }
    else { $d.mousemove({self: self}, self._tileMouseMove).mouseout({self: self}, self._tileMouseOut); }
    if (special) {
      if (special.blank) { $d.addClass('tile-blank').addClass('tile-off-' + (special.left ? 'l' : 'r')); }
      else if (special.custom) { self._customTile($d, tileId, bppp, bestDensity); }
      else { self._rulerTile($d, tileId, bppp); } // special.ruler === true
      return $d;
    }
    $d.addClass('tile-full bppp-'+classFriendly(bppp));
    _.each(densities, function(density) {
      var tileSrc = self._tileSrc(tileId, bppp, density), 
        fixedHeight = o.track.fh[tileSrc.bpppFormat] && o.track.fh[tileSrc.bpppFormat][density],
        $i;
      if (fixedHeight) {
        $i = $.mk('img').addClass('tdata loading dens-'+density).css('width', '100%').css('height', fixedHeight);
        $d.append($i);
      } else {
        $i = $.mk('img').addClass('tdata loading dens-'+density).bind('load', self._setImgDims);
        $d.append($i);
      }
      self.tileLoadCounter++;
      $i.bind('load error', {self: self, tile: $d, isBest: density==bestDensity, cached: cached}, self._trackLoadFire);
      $i.toggleClass('dens-best', density == bestDensity);
      if (o.track.m && _.include(o.track.m, density)) { $i.addClass('no-areas'); }
      
      $i.attr('src', o.tileDir + tileSrc.full);
    });
    return $d;
  },
  
  // Shows orange clipping indicators if any of the best density tiles have data cut off at the bottom
  fixClipped: function() {
    var $elem = this.element,
      o = this.options,
      sideClipped = false;
    $elem.find('.tile-full').each(function() {
      var $t = $(this),
        best = $t.children('.tdata.dens-best:not(.loading):not(.stretch-height)').get(0),
        h = best && (best.naturalHeight || best.height) || 0,
        clipped = h > o.track.h;
      $t.toggleClass('clipped', clipped);
    });
    this._fixSideClipped();
  },
  
  _fixSideClipped: function() {
    var bppps = this.bppps(),
      o = this.options,
      pos = o.line.genoline('getPos'),
      zoom = o.browser.genobrowser('zoom'),
      bpWidth = o.browser.genobrowser('bpWidth'),
      tileBpWidth = bppps.top * o.tileWidth,
      clipped = false;
    this.element.children('.clipped.bppp-'+classFriendly(bppps.top)).each(function() {
      var tileId = $(this).data('tileId');
      if (tileId > pos - tileBpWidth && tileId < pos + bpWidth) { clipped = true; return false; }
    });
    this.$side.toggleClass('clipped', clipped);
  },
  
  _tileTouchEvents: function($tile) {
    var self = this;
    $tile.bind('touchstart', {self: self}, function(e) {
      if (e.originalEvent.touches.length > 1) { return; }
      e.pageX = e.originalEvent.touches[0].pageX;
      e.pageY = e.originalEvent.touches[0].pageY;
      self._tileMouseMove.call(this, e);
    });
  },
  
  _tileMouseMove: function(e) {
    var $targ = $(e.target),
      $tdata = $targ.closest('.tdata'),
      self = e.data.self,
      o = self.options,
      prev = o.browser.genobrowser('areaHover'),
      areas, ratio, bppp;
    if (!$tdata.length || !$tdata.hasClass('dens-best') || !(areas = $tdata.data('areas'))) {
      if (!$targ.is('.area')) { o.browser.genobrowser('areaHover', false); }
      return; 
    }
    bppp = $tdata.data('bppp');
    ratio = bppp / o.browser.genobrowser('zoom');
    var offset = $(this).offset(),
      x = e.pageX - offset.left,
      y = e.pageY - offset.top;
    for (var i = 0; i < areas.length; i++) {
      var v = areas[i], areaId;
      if (x > v[0] * ratio && x < v[2] * ratio && y > v[1] && y < v[3]) {
        if (o.track.n + '.hrefHash.' + v.hrefHash !== prev) {
          areaId = $(this).attr('id') + '.' + i;
          o.browser.genobrowser('areaHover', [o.track.n, bppp, $tdata.data('density'), 'hrefHash', v.hrefHash], areaId);
        }
        return;
      }
    }
    if (!$targ.is('.area')) { o.browser.genobrowser('areaHover', false); }
    return;
  },
  
  _tileMouseOut: function(e) {
    var $targ = $(e.target),
      $tdata = $targ.closest('.tdata'),
      self = e.data.self,
      $relTarget = $(e.relatedTarget);
    if (!$tdata.length) { return; }
    if (!$relTarget.is('.tile') && !$relTarget.closest('.tile').length) { self.options.browser.genobrowser('areaHover', false); }
  },
  
  _areaMouseOver: function(e) {
    var d = e.data,
      o = d.self.options;
    o.browser.genobrowser('areaHover', [o.track.n, d.bppp, d.density, 'hrefHash', d.hrefHash], d.areaId);
  },
  
  fixClickAreas: function() {
    var self = this,
      o = this.options,
      $elem = self.element,
      nearest = this.bppps().nearest,
      densityOrder = o.browser.genobrowser('densityOrder', o.track.n);
    if (!o.track.m || !o.track.m.length) { return; }
    _.each(o.track.m, function(density) {
      _.each(nearest, function(bppp) {
        var densities = self.availDensities[bppp],
          bestDensity = self._bestDensity(bppp);
        if (!_.include(densities, density)) { return; }
        $elem.find('.bppp-'+classFriendly(bppp)+' .tdata.dens-'+density+'.no-areas').each(function(){
          self._addClickableAreas(this, bppp, density, bestDensity);
        }).removeClass('no-areas');
      });
    });
  },
  
  _areaTipTipEnter: function(callback) {
    var self = $(this).data('genotrack'),
      href = $(this).attr('href'),
      tiptipData = $(this).data('tiptipData'),
      oldTitle = $(this).data('title');
    if ($('body').hasClass('dragging')) { return callback(false); }
    function createTipTipHtml(data) {
      var $tipTipDiv = $('<div/>'),
        $name = $('<div class="name"/>').appendTo($tipTipDiv),
        $table = $('<table/>').appendTo($tipTipDiv),
        $tbody = $('<tbody/>').appendTo($table),
        $prevDescTr;
      _.each(data, function(v, k) {
        var $tr;
        if (/^description$|^type$|refseq summary/i.test(k)) {
          $prevDescTr = $tbody.children('.desc');
          if ($prevDescTr.length) { $tr = $('<tr class="desc"/>').insertAfter($prevDescTr); }
          else { $tr = $('<tr class="desc"/>').prependTo($tbody); }
          if (v.length > 300) { v = v.substr(0, 300).replace(/\s+\S+$/, '') + '...'; }
          $('<td colspan="2"/>').text(v).appendTo($tr);
        } else {
          $tr = $('<tr/>').appendTo($tbody);
          if (v == '---') {
            $('<td colspan="2" class="fields-header"/>').text(k).appendTo($tr);
          } else {
            $('<td class="field" width="45%"/>').text(k).appendTo($tr);
            $('<td class="value" width="55%"/>').text(v).appendTo($tr);
          }
        }
      });
      if (oldTitle) { $name.text(oldTitle); }
      callback($tipTipDiv);
    }
    if (tiptipData) {
      createTipTipHtml(tiptipData);
    } else if (/^https?:\/\//.test(href)) {
      $.ajax(self.options.ajaxDir + 'tooltip.php', {
        data: {url: href},
        dataType: 'json',
        success: createTipTipHtml
      });
    }
  },
  
  makeAnchor: function($tile, area, bppp, density, flags) {
    var bestDensity = this._bestDensity(bppp),
      o = this.options,
      custom = o.track.custom,
      defaultColor = (custom && custom.opts.color) || '0,0,0',
      tipTipOptions = {
        async: true, delay: 400,
        enter: this._areaTipTipEnter
      },
      hash = shortHash(area[5]),
      scaleToPct = 100 / o.tileWidth,
      $a = $.mk('a').addClass('area dens-'+density+' href-hash-'+hash).attr('title', area[4]);
    $a.attr('href', (custom ? '' : this.baseURL) + area[5]).attr('target', '_blank');
    $a.css({top: area[1], height: area[3] - area[1] - 2});
    if (flags.label) { 
      $a.css({right: (100 - area[0] * scaleToPct) + '%', color: 'rgb(' + (area[7] || defaultColor) + ')'}).addClass('label');
      if (area[8]) { $a.html(area[8]) } else { $a.text(area[4]); }
      $a.mouseover({self: this, bppp: bppp, density: density, hrefHash: hash, areaId: $tile.attr('id') + '.' + flags.i}, this._areaMouseOver);
    } else { 
      $a.addClass('rect').css({left: (area[0] * scaleToPct) + '%', width: ((area[2] - area[0]) * scaleToPct) + '%'});
      if (flags.flashme) {
        $a.addClass('flashing').effect("pulsate", {times: 2}, 1000, function() {
          $(this).fadeOut(300, function() { $(this).removeClass('flashing'); });
        });
      }
      if (flags.hover) { $a.addClass('hover'); }
      if (flags.tipTipActivated) { tipTipOptions.startActivated = true; }
    }
    $a.data('genotrack', this).tipTip(tipTipOptions);
    if (area[9]) { $a.data('tiptipData', area[9]); }
    return $a.data('hrefHash', hash).toggleClass('dens-best', density == bestDensity).appendTo($tile);
  },
  
  _areaDataFetch: function(e) {
    $.ajax(e.data.src + '.json', {
      dataType: 'json',
      success: e.data.success,
      beforeSend: e.data.beforeSend
    });
  },
  
  _areaDataLoad: function(data, statusText, jqXHR) {
    // NOTE: this is used as an AJAX callback, so this/self must be reobtained from the jqXHR object
    var o = jqXHR._self.options,
      $tile = $(jqXHR._appendTo),
      tileId = $tile.attr('id'),
      $tdata = $tile.children('.tdata.dens-'+jqXHR._density);
    
    function createAreas(e) {
      _.each($tdata.data('areas'), function(v, i) {
        // We have to make the label <a>'s for custom tracks
        if (jqXHR._custom && !v[6]) {
          jqXHR._self.makeAnchor($tile, v, jqXHR._bppp, jqXHR._density, {label: !jqXHR._custom.noAreaLabels, i: i}); 
        }
      });
    };
    
    // Areas are stored in a global index, so that mousing over an area in one tile can retrieve
    // areas with a similar name/hrefHash that must also be highlighted. 
    // See $.ui.genobrowser's .areaHover() for how it is traversed during mouseover.
    // Add to global area index: areaIndex[track][bppp][density]["hrefHash"|"name"][hrefHash|name][tileId][i] = true
    // FIXME: the global area index can get very big over time; as of now, it is never pruned.
    _.each(data, function(v, i) {
      var index = jqXHR._areaIndex,
        keys = [o.track.n, jqXHR._bppp, jqXHR._density],
        indexBy = {hrefHash: shortHash(v[5] || ''), name: (v[4] || '').toLowerCase()};
      v.hrefHash = indexBy.hrefHash;
      _.each(keys, function(k) {
        if (!index[k]) { index[k] = {}; }
        index = index[k];
      });
      if (!index.hrefHash) { index.hrefHash = {}; index.name = {}; }
      _.each(['hrefHash', 'name'], function(by) {
        var key = indexBy[by];
        if (!index[by][key]) { index[by][key] = {}; }
        if (!index[by][key][tileId]) { index[by][key][tileId] = {}; }
        index[by][key][tileId][i] = true;
      });
    });
    $tdata.data('areas', data).data('bppp', jqXHR._bppp).data('density', jqXHR._density).removeClass('areas-loading');
    
    if (jqXHR._custom) {
      $tdata.one('bestDensity', createAreas);
      if (jqXHR._density == jqXHR._bestDensity) { $tdata.trigger('bestDensity'); }
    }
    if (--jqXHR._self.areaLoadCounter === 0) { $(jqXHR._self.element).trigger('areaload', jqXHR._bestDensity); };
  },
  
  _addClickableAreas: function(tdataElem, bppp, density, bestDensity) {
    var self = this,
      o = self.options,
      tagName = tdataElem.tagName.toLowerCase(),
      $tdata = $(tdataElem),
      areaData, edata;
    self.areaLoadCounter++;
    $tdata.addClass('areas-loading');
    self.baseURL = self.baseURL || o.ucscURL.replace(/[^\/]+$/, '');
    function beforeSend(jqXHR) { 
      $.extend(jqXHR, {
        _appendTo: tdataElem.parentNode,
        _self: self,
        _bppp: bppp,
        _bestDensity: bestDensity,
        _density: density,
        _areaIndex: o.browser.genobrowser('areaIndex')
      });
    }
    
    if (tagName == 'img') {
      // TODO: make this abortable, for when fixTiles(forceRepos=true) is called before it finishes!
      edata = {src: tdataElem.src, success: self._areaDataLoad, beforeSend: beforeSend};
      if (density==bestDensity) { self._areaDataFetch({data: edata}); }
      else { $tdata.one('bestDensity', edata, self._areaDataFetch); }
    } else if (tagName == 'canvas' && o.track.custom.areas && (areaData = o.track.custom.areas[tdataElem.id])) {
      // For <canvas> tiles on custom tracks, we should already have this info in o.track.custom.areas
      mockJqXHR = {_custom: o.track.custom};
      beforeSend(mockJqXHR);
      self._areaDataLoad(areaData, '', mockJqXHR);
    } else { 
      self.areaLoadCounter--;
      $(tdataElem).removeClass('areas-loading');
    }
  },
  
  _showTile: function($t) {
    $t.addClass('tile-show').css('z-index', $t.data('zIndex'));
  },
  
  _reposTile: function($tile, tileId, zoom, bppp) {
    var o = this.options;
    $tile.css('left', (tileId - o.line.genoline('option', 'origin')) / zoom);
    $tile.css('width', Math.ceil(o.tileWidth * bppp / zoom));
    
    if (this.ruler && bppp <= o.ntsBelow[0]) {
      $tile.find('svg').each(function() {
        var width = $tile.width() + 'px';
        this.setAttributeNS(null, "width", width);
        this.firstChild.setAttributeNS(null, "y", "11");
      });
    }
  },
  
  _specialTile: function(tileId, bppp) {
    var o = this.options;
    if (tileId < 0 || tileId > o.genomeSize) { return {blank: true, left: tileId < 0}; }
    if (o.track.custom) { return {custom: true}; }
    if (this.ruler && (bppp <= o.ideogramsAbove || !o.chrBands)) { return {ruler: true}; }
  },
  
  _tileSrc: function(tileId, bppp, density) {
    var o = this.options,
      bF = this._bpppFormat(bppp),
      imgName = pad(tileId, 10) + '.png';
    if (bppp < o.subdirForBpppsUnder) { imgName = imgName.substr(0, 4) + '/' + imgName.substr(4); }
    var ret = {
      full: this.ruler ? 'ideograms/'+bF+'/'+imgName : o.track.n+'/'+bF+'_'+density+'/'+imgName,
      bpppFormat: bF
    };
    return ret;
  },
  
  _bpppFormat: function(bppp) { return this.options.bpppFormat(bppp); },
  
  _tileId: function(tileId, bppp) { 
    return this.uniqId + '-tile-' + bppp.toString().replace('.', '-') + '-' + tileId;
  },
  
  _fixLabels: function(forceRepos) {
    if (!this.ruler) { return; }
    var self = this,
      o = self.options,
      $elem = self.element,
      availWidth = o.browser.genobrowser('lineWidth'),
      pos = o.line.genoline('getPos'),
      zoom = o.browser.genobrowser('zoom'),
      leftMarg = pos - availWidth * zoom * 0.5,
      rightMarg = pos + 1.5 * availWidth * zoom,
      bppps = this.bppps(),
      labelsNeeded = _.filter(o.chrLabels, function(v) { return v.p > leftMarg && v.p < rightMarg; }),
      labelElements = [];
    _.each(labelsNeeded, function(v) {
      var repos = false, $l = $elem.children('.label-' + v.p);
      if (!$l.length) { $l = self._addLabel(v, zoom); repos = true; }
      if (repos || forceRepos) { self._reposLabel($l, v, zoom); }
      labelElements.push($l.get(0));
    });
    $elem.children('.label').not(labelElements).remove();
    
    if (o.chrBands && zoom <= o.ideogramsAbove) {
      var firstBandIndex = _.sortedIndex(o.chrBands, [0, 0, leftMarg], function(v) { return v[2]; }),
        lastBandIndex = _.sortedIndex(o.chrBands, [0, rightMarg], function(v) { return v[1]; }),
        bandsNeeded = o.chrBands.slice(firstBandIndex, lastBandIndex),
        bandElements = [];
      _.each(bandsNeeded, function(v) {
        var repos = false, $b = $('#' + self._tileId(v[1], 'band'));
        if (!$b.length) { $b = self._addBand(v, zoom); repos = true; }
        if (repos || forceRepos) { self._reposBand($b, v, zoom); }
        bandElements.push($b.get(0));
      });
      $elem.children('.band').not(bandElements).remove();
    } else {
      $elem.children('.band').remove();
    }
  },
  
  _rulerTile: function($t, tileId, bppp) {
    var self = this,
      o = self.options,
      bpPerTile = bppp * o.tileWidth,
      zoom = o.browser.genobrowser('zoom');
    $t.addClass('tile-ruler bppp-'+classFriendly(bppp)).data('bppp', bppp);
    
    self._drawCanvasTicks($t, tileId, bppp, zoom);
    
    if (bppp <= o.ntsBelow[0]) {
      var showNtText = bppp <= o.ntsBelow[1],
        canvasHeight = (showNtText ? 12 : 3) + (o.chrBands ? 1 : 0), // with bands, we need an extra pixel
        canvasAttrs = {width: o.tileWidth, height: canvasHeight, "class": "ntdata"};
      $t.addClass('tile-ntdata tile-loaded');
      $t.toggleClass(o.chrBands ? 'tile-overlay-ntdata' : 'tile-big-ntdata', showNtText);
      if (o.chrBands && showNtText) { $t.data('zIndex', 101); } // if we have bands, draw it on top of the bands.
      o.browser.genobrowser('getDNA', tileId, tileId + bpPerTile, self._ntSequenceLoad, {
        _c: $.mk('canvas').attr(canvasAttrs).css('height', canvasHeight).appendTo($t),
        _d: showNtText && $.mk('div').addClass('nts').appendTo($t),
        _w: Math.ceil(o.tileWidth * bppp / zoom),
        _self: self
      });
    }
  },
  
  _drawCanvasTicks: function($t, tileId, bppp, zoom) {
    var self = this,
      o = self.options,
      chr = o.browser.genobrowser('chrAt', tileId),
      bpPerTile = bppp * o.tileWidth,
      scale = Math.round(Math.log(bpPerTile / 10)/Math.log(10)*2),
      tooLong = tileId.toString().length > 8 && scale < 6,
      step = scale % 2 ? (tooLong ? 5 : 2) * Math.pow(10, floorHack(scale/2)) : Math.pow(10, scale/2),
      majorStep = scale % 2 ? (tooLong ? [step * 2, step * 2] : [step * 5, step * 5]) : [step * 5, step * 10],
      start = floorHack((tileId - chr.p) / step) * step + step,
      newChr;
    
    if (bppp <= o.bpppNumbersBelow[0]) {
      $t.toggleClass('tile-halfway', bppp == o.bpppNumbersBelow[0]);
      $t.toggleClass('tile-loaded', bppp <= o.bpppNumbersBelow[1]);
      if (o.useCanvasTicks) {
        // This may alleviate some of the excessive element creation that occurs with the HTML method
        start -= step;
        var offsetForNtText = !o.chrBands && bppp <= o.ntsBelow[1],
          canvasHeight = o.chrBands ? 23 : (offsetForNtText ? 12 : 23),
          canvasWidth = bppp / zoom * o.tileWidth,
          $oldC = $t.children('canvas.ticks'),
          canvasAttrs = {width: canvasWidth, height: canvasHeight, "class": "ticks" + ($oldC.length ? ' hidden' : '')},
          $c = $.mk('canvas').css('height', canvasHeight).prependTo($t),
          ctx = $c.get(0).getContext && $c.get(0).getContext('2d'),
          textY = o.chrBands ? 16 : (offsetForNtText ? 10 : 16),
          defaultFont = "11px 'Lucida Grande',Tahoma,Arial,Liberation Sans,FreeSans,sans-serif";
        if ($.browser.opera) { defaultFont = "12px Arial,sans-serif"; } // Opera can only render Arial decently on canvas
        if (!ctx) { return; }
        $c.attr(canvasAttrs);
        ctx.font = defaultFont;
        for (var t = start; t + chr.p < tileId + bppp * o.tileWidth + step; t += step) {
          if (t > o.chrLengths[chr.n]) {
            newChr = o.browser.genobrowser('chrAt', chr.p + t);
            if (chr === newChr) { break; } // off the end of the last chromosome
            t = 0;
            chr = newChr;
            continue; // the label for 0 is never shown
          }
          var unit = _.find([[1000000, 'm'], [1000, 'k'], [1, '']], function(v) { return v[0] <= step; }),
            major = floorHack(t / majorStep[1]),
            minor = (t / unit[0]).toString().substr(major > 0 ? major.toString().length : 0),
            isMajor = !(t % majorStep[0]),
            x = ((t + chr.p - tileId + 0.5) / bpPerTile * canvasWidth);
          if (isMajor) {
            ctx.font = "bold " + defaultFont;
            if (major) {
              ctx.textAlign = 'end';
              ctx.fillText(major, x - 1, textY);
            }
            ctx.textAlign = 'start';
            ctx.fillRect(x, offsetForNtText ? 1 : 3, 1, 19); 
          } else {
            ctx.fillStyle = '#666666';
            ctx.fillRect(x, offsetForNtText ? 1 : 7, 1, 14);
            ctx.fillStyle = '#000000';
          }
          ctx.fillText(minor + (isMajor ? unit[1] : ''), x + 2, textY);
          if (isMajor) { ctx.font = defaultFont; }
        }
        if ($oldC.length) { 
          $oldC.addClass('hidden');
          $c.removeClass('hidden');
          setTimeout(function() { $oldC.remove(); }, 1000);
        }
      } else {
        function ghostify(text) {
          text = text.toString();
          return text;
        }
        
        for (var t = start; t + chr.p < tileId + bppp * o.tileWidth; t += step) {
          if (t > o.chrLengths[chr.n]) {
            newChr = o.browser.genobrowser('chrAt', chr.p + t);
            if (chr === newChr) { break; } // off the end of the last chromosome
            t = 0;
            chr = newChr;
            continue; // the label for 0 is never shown
          }
          var unit = _.find([[1000000, 'm'], [1000, 'k'], [1, '']], function(v) { return v[0] <= step; }),
            major = floorHack(t / majorStep[1]),
            minor = (t / unit[0]).toString().substr(major > 0 ? major.toString().length : 0),
            isMajor = !(t % majorStep[0]),
            tickHTML = '<div class="tick' + (isMajor ? ' major">' + ghostify(major ? major : '') : '">') + 
              '<span class="minor">' + ghostify(minor + (isMajor ? unit[1] : '')) + '</span></div>',
            $tick = $(tickHTML).appendTo($t);
          $tick.css('right', ((1 - (t + chr.p - tileId + 0.5) / bpPerTile) * 100)+'%'); // The 0.5 centers it over the base.
        }
      }
    }
  },
  
  redrawCanvasTicks: function() {
    var self = this,
      $elem = self.element, 
      o = self.options,
      zoom = o.browser.genobrowser('zoom');
    $elem.children('.tile-ruler').each(function() {
      var $t = $(this);
      self._drawCanvasTicks($t, $t.data('tileId'), $t.data('bppp'), zoom);
    });
  },
  
  _ntSequenceLoad: function(dna, extraData) {
    if (!dna) { return; }
    var o = extraData._self.options,
      $d = extraData._d,
      l = dna.length,
      ppbp = o.tileWidth / l, // pixels per bp
      colors = {a:'255,0,0', t:'255,0,255', c:'0,0,255', g:'0,180,0'},
      canvas, height, ctx, nt;
    if ($d) {
      var $svg = $.mk("http://www.w3.org/2000/svg", "svg").attr({
        version: "1.2",
        baseProfile: "tiny",
        height: '14px',
        width: ($d.closest('.tile').width() || extraData._w) + 'px'
      });
      $d.append($svg);
      $.mk("http://www.w3.org/2000/svg", "text").attr({
        x: _.map(_.range(l), function(x) { return x / l * 100; }).join('% ') + '%',
        y: 11,
        fill: '#FFFFFF'
      }).text(dna).appendTo($svg);
    }
    canvas = extraData._c && extraData._c.get(0);
    height = canvas.height;
    ctx = canvas.getContext && canvas.getContext('2d');
    if (!ctx) { return; }
    for (var i = 0; i < l; i++) {
      nt = dna.substr(i, 1);
      if (nt == '-') { continue; }
      ctx.fillStyle = "rgb(" + colors[nt.toLowerCase()] + ")";
      ctx.fillRect(i * ppbp, 0, ppbp, height);
    }
  },
  
  _addLabel: function(label, zoom) {
    var o = this.options,
      $l = $.mk('div').addClass('label label-'+label.p),
      $lt = $.mk('div').addClass('label-text').prependTo($l).text(label.n.replace(/^chr/,''));
    if (label.n.indexOf('chr') === 0) { $lt.prepend('<span class="chr">chr</span>'); }
    $l.prepend('<span class="start-line"></span>');
    if (label.end === true) { $l.addClass('label-end'); }
    //$l.css('z-index', 200 + label.i);
    return $l.appendTo(this.element);
  },
  
  _reposLabel: function($l, label, zoom) {  
    // constrain width of label so it doesn't run over into the next one
    // max-width doesn't include padding (5px)
    if (label.end !== true) { $l.children('.label-text').css('max-width', Math.max(label.w / zoom - 5, 0)); }
    // `+ 1` --> convert 0-based positioning
    // `- 1` --> label is offset 1px to left to compensate for the 2px width of the red indicator line
    $l.css('left', (label.p + 1 - this.options.line.genoline('option', 'origin')) / zoom - 1);
  },
  
  _addBand: function(band, zoom) {
    var o = this.options,
      $b = $('<div class="band band-'+band[4]+' band-'+band[3].substr(0,1)+'"/>');
    $b.attr('id', this._tileId(band[1], 'band'));
    if (band[5] === 0) { $b.prepend('<div class="chr-start"/>'); }
    $b.append($('<div class="band-name"/>').text(band[0].substr(3) + band[3]));
    return $b.appendTo(this.element);
  },
  
  _reposBand: function($b, band, zoom) { 
    var o = this.options, 
      prop = band[4] == 'acen' ? (/^p/.test(band[3]) ? 'border-left-width' : 'border-right-width'): 'width';
    $b.css('left', (band[1] - o.line.genoline('option', 'origin')) / zoom);
    $b.css(prop, (band[2] - band[1]) / zoom + 1); 
  },
  
  _customTileRender: function(e, callback) {
    var canvas = this,
      $canvas = $(this),
      d = e.data,
      browser = d.self.options.browser;
    function pushCallback() { _.isFunction(callback) && $canvas.data('renderingCallbacks').push(callback); }
    if ($canvas.data('rendering') === true) { pushCallback(); return; }
    $canvas.data('rendering', true);
    $canvas.data('renderingCallbacks', []);
    pushCallback();
    d.custom.render(canvas, d.start, d.end, d.density, function() {
      $canvas.css('width', '100%').css('height', d.custom.stretchHeight ? '100%' : canvas.height);
      $canvas.toggleClass('stretch-height', d.custom.stretchHeight);
      $canvas.removeClass('unrendered').addClass('no-areas');
      d.self.fixClickAreas();
      // If the too-many class was set, we couldn't draw/load the data at this density because there's too much of it
      // If this is at "squish" density, we also add the class to parent <div> to tell the user that she needs to zoom
      if ($canvas.hasClass('too-many')) { $canvas.parent().addClass('too-many'); }
      if ($canvas.hasClass('too-many') && d.density == 'dense') { $canvas.parent().addClass('too-many-for-dense'); }
      _.each($canvas.data('renderingCallbacks'), function(f) { f(); });
      $canvas.data('rendering', false);
    });
    if (d.custom.expectsSequence && (d.end - d.start) < browser.genobrowser('option', 'maxNtRequest')) {
      browser.genobrowser('getDNA', d.start, d.end, function(sequence) {
        d.custom.renderSequence(canvas, d.start, d.end, d.density, sequence, function() {
          // TODO: may need to d.self.fixClickAreas() again if .renderSequence added areas?
        });
      });
    }
  },
  
  _customTile: function($t, tileId, bppp, bestDensity) {
    var self = this,
      o = self.options,
      bpPerTile = bppp * o.tileWidth,
      end = tileId + bpPerTile;
    $t.addClass('tile-custom tile-full tile-loaded bppp-'+classFriendly(bppp));
    _.each(o.track.s, function(density) {
      var canvasHTML = '<canvas width="'+o.tileWidth+'" height="'+o.track.h+'" class="tdata unrendered dens-'+density+'" '
          + 'id="canvas-'+self._tileId(tileId, bppp)+'-'+density+'"></canvas>',
        $c = $(canvasHTML).appendTo($t);
      $c.bind('render', {start: tileId, end: end, density: density, self: self, custom: o.track.custom}, self._customTileRender);
      $c.bind('erase', function() { o.track.custom.erase($c.get(0)); $c.addClass('unrendered'); });
      if (density==bestDensity) { $c.addClass('dens-best').trigger('render'); }
    });
  }
  
});

};
},{"./utils.js":33}],28:[function(require,module,exports){
/*!
 * jQuery UI 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
module.exports = function(jQuery) {
(function(a,d){function c(h,g){var i=h.nodeName.toLowerCase();if("area"===i){g=h.parentNode;i=g.name;if(!h.href||!i||g.nodeName.toLowerCase()!=="map")return false;h=a("img[usemap=#"+i+"]")[0];return!!h&&e(h)}return(/input|select|textarea|button|object/.test(i)?!h.disabled:"a"==i?h.href||g:g)&&e(h)}function e(h){return!a(h).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}a.ui=a.ui||{};if(!a.ui.version){a.extend(a.ui,{version:"1.8.16",
keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(h,g){return typeof h==="number"?this.each(function(){var i=
this;setTimeout(function(){a(i).focus();g&&g.call(i)},h)}):this._focus.apply(this,arguments)},scrollParent:function(){var h;h=a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,
"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!h.length?a(document):h},zIndex:function(h){if(h!==d)return this.css("zIndex",h);if(this.length){h=a(this[0]);for(var g;h.length&&h[0]!==document;){g=h.css("position");if(g==="absolute"||g==="relative"||g==="fixed"){g=parseInt(h.css("zIndex"),10);if(!isNaN(g)&&g!==0)return g}h=h.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":
"mousedown")+".ui-disableSelection",function(h){h.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});a.each(["Width","Height"],function(h,g){function i(l,o,n,k){a.each(b,function(){o-=parseFloat(a.curCSS(l,"padding"+this,true))||0;if(n)o-=parseFloat(a.curCSS(l,"border"+this+"Width",true))||0;if(k)o-=parseFloat(a.curCSS(l,"margin"+this,true))||0});return o}var b=g==="Width"?["Left","Right"]:["Top","Bottom"],f=g.toLowerCase(),j={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,
outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+g]=function(l){if(l===d)return j["inner"+g].call(this);return this.each(function(){a(this).css(f,i(this,l)+"px")})};a.fn["outer"+g]=function(l,o){if(typeof l!=="number")return j["outer"+g].call(this,l);return this.each(function(){a(this).css(f,i(this,l,true,o)+"px")})}});a.extend(a.expr[":"],{data:function(h,g,i){return!!a.data(h,i[3])},focusable:function(h){return c(h,!isNaN(a.attr(h,"tabindex")))},tabbable:function(h){var g=a.attr(h,
"tabindex"),i=isNaN(g);return(i||g>=0)&&c(h,!i)}});a(function(){var h=document.body,g=h.appendChild(g=document.createElement("div"));a.extend(g.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});a.support.minHeight=g.offsetHeight===100;a.support.selectstart="onselectstart"in g;h.removeChild(g).style.display="none"});a.extend(a.ui,{plugin:{add:function(h,g,i){h=a.ui[h].prototype;for(var b in i){h.plugins[b]=h.plugins[b]||[];h.plugins[b].push([g,i[b]])}},call:function(h,g,i){if((g=h.plugins[g])&&
h.element[0].parentNode)for(var b=0;b<g.length;b++)h.options[g[b][0]]&&g[b][1].apply(h.element,i)}},contains:function(h,g){return document.compareDocumentPosition?h.compareDocumentPosition(g)&16:h!==g&&h.contains(g)},hasScroll:function(h,g){if(a(h).css("overflow")==="hidden")return false;g=g&&g==="left"?"scrollLeft":"scrollTop";var i=false;if(h[g]>0)return true;h[g]=1;i=h[g]>0;h[g]=0;return i},isOverAxis:function(h,g,i){return h>g&&h<g+i},isOver:function(h,g,i,b,f,j){return a.ui.isOverAxis(h,i,f)&&
a.ui.isOverAxis(g,b,j)}})}})(jQuery);
(function(a,d){if(a.cleanData){var c=a.cleanData;a.cleanData=function(h){for(var g=0,i;(i=h[g])!=null;g++)try{a(i).triggerHandler("remove")}catch(b){}c(h)}}else{var e=a.fn.remove;a.fn.remove=function(h,g){return this.each(function(){if(!g)if(!h||a.filter(h,[this]).length)a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(i){}});return e.call(a(this),h,g)})}}a.widget=function(h,g,i){var b=h.split(".")[0],f;h=h.split(".")[1];f=b+"-"+h;if(!i){i=g;g=a.Widget}a.expr[":"][f]=
function(j){return!!a.data(j,h)};a[b]=a[b]||{};a[b][h]=function(j,l){arguments.length&&this._createWidget(j,l)};g=new g;g.options=a.extend(true,{},g.options);a[b][h].prototype=a.extend(true,g,{namespace:b,widgetName:h,widgetEventPrefix:a[b][h].prototype.widgetEventPrefix||h,widgetBaseClass:f},i);a.widget.bridge(h,a[b][h])};a.widget.bridge=function(h,g){a.fn[h]=function(i){var b=typeof i==="string",f=Array.prototype.slice.call(arguments,1),j=this;i=!b&&f.length?a.extend.apply(null,[true,i].concat(f)):
i;if(b&&i.charAt(0)==="_")return j;b?this.each(function(){var l=a.data(this,h),o=l&&a.isFunction(l[i])?l[i].apply(l,f):l;if(o!==l&&o!==d){j=o;return false}}):this.each(function(){var l=a.data(this,h);l?l.option(i||{})._init():a.data(this,h,new g(i,this))});return j}};a.Widget=function(h,g){arguments.length&&this._createWidget(h,g)};a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(h,g){a.data(g,this.widgetName,this);this.element=a(g);this.options=
a.extend(true,{},this.options,this._getCreateOptions(),h);var i=this;this.element.bind("remove."+this.widgetName,function(){i.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+
"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(h,g){var i=h;if(arguments.length===0)return a.extend({},this.options);if(typeof h==="string"){if(g===d)return this.options[h];i={};i[h]=g}this._setOptions(i);return this},_setOptions:function(h){var g=this;a.each(h,function(i,b){g._setOption(i,b)});return this},_setOption:function(h,g){this.options[h]=g;if(h==="disabled")this.widget()[g?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",
g);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(h,g,i){var b=this.options[h];g=a.Event(g);g.type=(h===this.widgetEventPrefix?h:this.widgetEventPrefix+h).toLowerCase();i=i||{};if(g.originalEvent){h=a.event.props.length;for(var f;h;){f=a.event.props[--h];g[f]=g.originalEvent[f]}}this.element.trigger(g,i);return!(a.isFunction(b)&&b.call(this.element[0],g,i)===false||g.isDefaultPrevented())}}})(jQuery);
(function(a){var d=false;a(document).mouseup(function(){d=false});a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var c=this;this.element.bind("mousedown."+this.widgetName,function(e){return c._mouseDown(e)}).bind("click."+this.widgetName,function(e){if(true===a.data(e.target,c.widgetName+".preventClickEvent")){a.removeData(e.target,c.widgetName+".preventClickEvent");e.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+
this.widgetName)},_mouseDown:function(c){if(!d){this._mouseStarted&&this._mouseUp(c);this._mouseDownEvent=c;var e=this,h=c.which==1,g=typeof this.options.cancel=="string"&&c.target.nodeName?a(c.target).closest(this.options.cancel).length:false;if(!h||g||!this._mouseCapture(c))return true;this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet)this._mouseDelayTimer=setTimeout(function(){e.mouseDelayMet=true},this.options.delay);if(this._mouseDistanceMet(c)&&this._mouseDelayMet(c)){this._mouseStarted=
this._mouseStart(c)!==false;if(!this._mouseStarted){c.preventDefault();return true}}true===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(i){return e._mouseMove(i)};this._mouseUpDelegate=function(i){return e._mouseUp(i)};a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);c.preventDefault();return d=true}},_mouseMove:function(c){if(a.browser.msie&&
!(document.documentMode>=9)&&!c.button)return this._mouseUp(c);if(this._mouseStarted){this._mouseDrag(c);return c.preventDefault()}if(this._mouseDistanceMet(c)&&this._mouseDelayMet(c))(this._mouseStarted=this._mouseStart(this._mouseDownEvent,c)!==false)?this._mouseDrag(c):this._mouseUp(c);return!this._mouseStarted},_mouseUp:function(c){a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=
false;c.target==this._mouseDownEvent.target&&a.data(c.target,this.widgetName+".preventClickEvent",true);this._mouseStop(c)}return false},_mouseDistanceMet:function(c){return Math.max(Math.abs(this._mouseDownEvent.pageX-c.pageX),Math.abs(this._mouseDownEvent.pageY-c.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);
(function(a){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper==
"original"&&!/^(?:r|a|f)/.test(this.element.css("position")))this.element[0].style.position="relative";this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},destroy:function(){if(this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this}},_mouseCapture:function(d){var c=
this.options;if(this.helper||c.disabled||a(d.target).is(".ui-resizable-handle"))return false;this.handle=this._getHandle(d);if(!this.handle)return false;if(c.iframeFix)a(c.iframeFix===true?"iframe":c.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(a(this).offset()).appendTo("body")});return true},_mouseStart:function(d){var c=this.options;
this.helper=this._createHelper(d);this._cacheHelperProportions();if(a.ui.ddmanager)a.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:d.pageX-this.offset.left,top:d.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});
this.originalPosition=this.position=this._generatePosition(d);this.originalPageX=d.pageX;this.originalPageY=d.pageY;c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt);c.containment&&this._setContainment();if(this._trigger("start",d)===false){this._clear();return false}this._cacheHelperProportions();a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,d);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(d,true);a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,d);return true},
_mouseDrag:function(d,c){this.position=this._generatePosition(d);this.positionAbs=this._convertPositionTo("absolute");if(!c){c=this._uiHash();if(this._trigger("drag",d,c)===false){this._mouseUp({});return false}this.position=c.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";a.ui.ddmanager&&a.ui.ddmanager.drag(this,d);return false},_mouseStop:function(d){var c=
false;if(a.ui.ddmanager&&!this.options.dropBehaviour)c=a.ui.ddmanager.drop(this,d);if(this.dropped){c=this.dropped;this.dropped=false}if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")return false;if(this.options.revert=="invalid"&&!c||this.options.revert=="valid"&&c||this.options.revert===true||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,c)){var e=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,
10),function(){e._trigger("stop",d)!==false&&e._clear()})}else this._trigger("stop",d)!==false&&this._clear();return false},_mouseUp:function(d){this.options.iframeFix===true&&a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,d);return a.ui.mouse.prototype._mouseUp.call(this,d)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(d){var c=!this.options.handle||
!a(this.options.handle,this.element).length?true:false;a(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==d.target)c=true});return c},_createHelper:function(d){var c=this.options;d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[d])):c.helper=="clone"?this.element.clone().removeAttr("id"):this.element;d.parents("body").length||d.appendTo(c.appendTo=="parent"?this.element[0].parentNode:c.appendTo);d[0]!=this.element[0]&&!/(fixed|absolute)/.test(d.css("position"))&&
d.css("position","absolute");return d},_adjustOffsetFromHelper:function(d){if(typeof d=="string")d=d.split(" ");if(a.isArray(d))d={left:+d[0],top:+d[1]||0};if("left"in d)this.offset.click.left=d.left+this.margins.left;if("right"in d)this.offset.click.left=this.helperProportions.width-d.right+this.margins.left;if("top"in d)this.offset.click.top=d.top+this.margins.top;if("bottom"in d)this.offset.click.top=this.helperProportions.height-d.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=
this.helper.offsetParent();var d=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])){d.left+=this.scrollParent.scrollLeft();d.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)d={top:0,left:0};return{top:d.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:d.left+(parseInt(this.offsetParent.css("borderLeftWidth"),
10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var d=this.element.position();return{top:d.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:d.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),
10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var d=this.options;if(d.containment=="parent")d.containment=this.helper[0].parentNode;if(d.containment=="document"||d.containment=="window")this.containment=[d.containment=="document"?0:a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,d.containment=="document"?0:a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,
(d.containment=="document"?0:a(window).scrollLeft())+a(d.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(d.containment=="document"?0:a(window).scrollTop())+(a(d.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(d.containment)&&d.containment.constructor!=Array){d=a(d.containment);var c=d[0];if(c){d.offset();var e=a(c).css("overflow")!=
"hidden";this.containment=[(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0),(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0),(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),
10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=d}}else if(d.containment.constructor==Array)this.containment=d.containment},_convertPositionTo:function(d,c){if(!c)c=this.position;d=d=="absolute"?1:-1;var e=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(e[0].tagName);return{top:c.top+
this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:e.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:e.scrollLeft())*d)}},_generatePosition:function(d){var c=this.options,e=this.cssPosition=="absolute"&&
!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(e[0].tagName),g=d.pageX,i=d.pageY;if(this.originalPosition){var b;if(this.containment){if(this.relative_container){b=this.relative_container.offset();b=[this.containment[0]+b.left,this.containment[1]+b.top,this.containment[2]+b.left,this.containment[3]+b.top]}else b=this.containment;if(d.pageX-this.offset.click.left<b[0])g=b[0]+this.offset.click.left;
if(d.pageY-this.offset.click.top<b[1])i=b[1]+this.offset.click.top;if(d.pageX-this.offset.click.left>b[2])g=b[2]+this.offset.click.left;if(d.pageY-this.offset.click.top>b[3])i=b[3]+this.offset.click.top}if(c.grid){i=c.grid[1]?this.originalPageY+Math.round((i-this.originalPageY)/c.grid[1])*c.grid[1]:this.originalPageY;i=b?!(i-this.offset.click.top<b[1]||i-this.offset.click.top>b[3])?i:!(i-this.offset.click.top<b[1])?i-c.grid[1]:i+c.grid[1]:i;g=c.grid[0]?this.originalPageX+Math.round((g-this.originalPageX)/
c.grid[0])*c.grid[0]:this.originalPageX;g=b?!(g-this.offset.click.left<b[0]||g-this.offset.click.left>b[2])?g:!(g-this.offset.click.left<b[0])?g-c.grid[0]:g+c.grid[0]:g}}return{top:i-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:e.scrollTop()),left:g-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<
526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:e.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=false},_trigger:function(d,c,e){e=e||this._uiHash();a.ui.plugin.call(this,d,[c,e]);if(d=="drag")this.positionAbs=this._convertPositionTo("absolute");return a.Widget.prototype._trigger.call(this,d,c,
e)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});a.extend(a.ui.draggable,{version:"1.8.16"});a.ui.plugin.add("draggable","connectToSortable",{start:function(d,c){var e=a(this).data("draggable"),h=e.options,g=a.extend({},c,{item:e.element});e.sortables=[];a(h.connectToSortable).each(function(){var i=a.data(this,"sortable");if(i&&!i.options.disabled){e.sortables.push({instance:i,shouldRevert:i.options.revert});
i.refreshPositions();i._trigger("activate",d,g)}})},stop:function(d,c){var e=a(this).data("draggable"),h=a.extend({},c,{item:e.element});a.each(e.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;e.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(d);this.instance.options.helper=this.instance.options._helper;e.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=
false;this.instance._trigger("deactivate",d,h)}})},drag:function(d,c){var e=a(this).data("draggable"),h=this;a.each(e.sortables,function(){this.instance.positionAbs=e.positionAbs;this.instance.helperProportions=e.helperProportions;this.instance.offset.click=e.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=a(h).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",true);
this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return c.helper[0]};d.target=this.instance.currentItem[0];this.instance._mouseCapture(d,true);this.instance._mouseStart(d,true,true);this.instance.offset.click.top=e.offset.click.top;this.instance.offset.click.left=e.offset.click.left;this.instance.offset.parent.left-=e.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=e.offset.parent.top-this.instance.offset.parent.top;
e._trigger("toSortable",d);e.dropped=this.instance.element;e.currentItem=e.element;this.instance.fromOutside=e}this.instance.currentItem&&this.instance._mouseDrag(d)}else if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",d,this.instance._uiHash(this.instance));this.instance._mouseStop(d,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();this.instance.placeholder&&
this.instance.placeholder.remove();e._trigger("fromSortable",d);e.dropped=false}})}});a.ui.plugin.add("draggable","cursor",{start:function(){var d=a("body"),c=a(this).data("draggable").options;if(d.css("cursor"))c._cursor=d.css("cursor");d.css("cursor",c.cursor)},stop:function(){var d=a(this).data("draggable").options;d._cursor&&a("body").css("cursor",d._cursor)}});a.ui.plugin.add("draggable","opacity",{start:function(d,c){d=a(c.helper);c=a(this).data("draggable").options;if(d.css("opacity"))c._opacity=
d.css("opacity");d.css("opacity",c.opacity)},stop:function(d,c){d=a(this).data("draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}});a.ui.plugin.add("draggable","scroll",{start:function(){var d=a(this).data("draggable");if(d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML")d.overflowOffset=d.scrollParent.offset()},drag:function(d){var c=a(this).data("draggable"),e=c.options,h=false;if(c.scrollParent[0]!=document&&c.scrollParent[0].tagName!="HTML"){if(!e.axis||e.axis!=
"x")if(c.overflowOffset.top+c.scrollParent[0].offsetHeight-d.pageY<e.scrollSensitivity)c.scrollParent[0].scrollTop=h=c.scrollParent[0].scrollTop+e.scrollSpeed;else if(d.pageY-c.overflowOffset.top<e.scrollSensitivity)c.scrollParent[0].scrollTop=h=c.scrollParent[0].scrollTop-e.scrollSpeed;if(!e.axis||e.axis!="y")if(c.overflowOffset.left+c.scrollParent[0].offsetWidth-d.pageX<e.scrollSensitivity)c.scrollParent[0].scrollLeft=h=c.scrollParent[0].scrollLeft+e.scrollSpeed;else if(d.pageX-c.overflowOffset.left<
e.scrollSensitivity)c.scrollParent[0].scrollLeft=h=c.scrollParent[0].scrollLeft-e.scrollSpeed}else{if(!e.axis||e.axis!="x")if(d.pageY-a(document).scrollTop()<e.scrollSensitivity)h=a(document).scrollTop(a(document).scrollTop()-e.scrollSpeed);else if(a(window).height()-(d.pageY-a(document).scrollTop())<e.scrollSensitivity)h=a(document).scrollTop(a(document).scrollTop()+e.scrollSpeed);if(!e.axis||e.axis!="y")if(d.pageX-a(document).scrollLeft()<e.scrollSensitivity)h=a(document).scrollLeft(a(document).scrollLeft()-
e.scrollSpeed);else if(a(window).width()-(d.pageX-a(document).scrollLeft())<e.scrollSensitivity)h=a(document).scrollLeft(a(document).scrollLeft()+e.scrollSpeed)}h!==false&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(c,d)}});a.ui.plugin.add("draggable","snap",{start:function(){var d=a(this).data("draggable"),c=d.options;d.snapElements=[];a(c.snap.constructor!=String?c.snap.items||":data(draggable)":c.snap).each(function(){var e=a(this),h=e.offset();this!=d.element[0]&&d.snapElements.push({item:this,
width:e.outerWidth(),height:e.outerHeight(),top:h.top,left:h.left})})},drag:function(d,c){for(var e=a(this).data("draggable"),h=e.options,g=h.snapTolerance,i=c.offset.left,b=i+e.helperProportions.width,f=c.offset.top,j=f+e.helperProportions.height,l=e.snapElements.length-1;l>=0;l--){var o=e.snapElements[l].left,n=o+e.snapElements[l].width,k=e.snapElements[l].top,m=k+e.snapElements[l].height;if(o-g<i&&i<n+g&&k-g<f&&f<m+g||o-g<i&&i<n+g&&k-g<j&&j<m+g||o-g<b&&b<n+g&&k-g<f&&f<m+g||o-g<b&&b<n+g&&k-g<j&&
j<m+g){if(h.snapMode!="inner"){var p=Math.abs(k-j)<=g,q=Math.abs(m-f)<=g,s=Math.abs(o-b)<=g,r=Math.abs(n-i)<=g;if(p)c.position.top=e._convertPositionTo("relative",{top:k-e.helperProportions.height,left:0}).top-e.margins.top;if(q)c.position.top=e._convertPositionTo("relative",{top:m,left:0}).top-e.margins.top;if(s)c.position.left=e._convertPositionTo("relative",{top:0,left:o-e.helperProportions.width}).left-e.margins.left;if(r)c.position.left=e._convertPositionTo("relative",{top:0,left:n}).left-e.margins.left}var u=
p||q||s||r;if(h.snapMode!="outer"){p=Math.abs(k-f)<=g;q=Math.abs(m-j)<=g;s=Math.abs(o-i)<=g;r=Math.abs(n-b)<=g;if(p)c.position.top=e._convertPositionTo("relative",{top:k,left:0}).top-e.margins.top;if(q)c.position.top=e._convertPositionTo("relative",{top:m-e.helperProportions.height,left:0}).top-e.margins.top;if(s)c.position.left=e._convertPositionTo("relative",{top:0,left:o}).left-e.margins.left;if(r)c.position.left=e._convertPositionTo("relative",{top:0,left:n-e.helperProportions.width}).left-e.margins.left}if(!e.snapElements[l].snapping&&
(p||q||s||r||u))e.options.snap.snap&&e.options.snap.snap.call(e.element,d,a.extend(e._uiHash(),{snapItem:e.snapElements[l].item}));e.snapElements[l].snapping=p||q||s||r||u}else{e.snapElements[l].snapping&&e.options.snap.release&&e.options.snap.release.call(e.element,d,a.extend(e._uiHash(),{snapItem:e.snapElements[l].item}));e.snapElements[l].snapping=false}}}});a.ui.plugin.add("draggable","stack",{start:function(){var d=a(this).data("draggable").options;d=a.makeArray(a(d.stack)).sort(function(e,h){return(parseInt(a(e).css("zIndex"),
10)||0)-(parseInt(a(h).css("zIndex"),10)||0)});if(d.length){var c=parseInt(d[0].style.zIndex)||0;a(d).each(function(e){this.style.zIndex=c+e});this[0].style.zIndex=c+d.length}}});a.ui.plugin.add("draggable","zIndex",{start:function(d,c){d=a(c.helper);c=a(this).data("draggable").options;if(d.css("zIndex"))c._zIndex=d.css("zIndex");d.css("zIndex",c.zIndex)},stop:function(d,c){d=a(this).data("draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})})(jQuery);
(function(a){a.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect"},_create:function(){var d=this.options,c=d.accept;this.isover=0;this.isout=1;this.accept=a.isFunction(c)?c:function(e){return e.is(c)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};a.ui.ddmanager.droppables[d.scope]=a.ui.ddmanager.droppables[d.scope]||[];a.ui.ddmanager.droppables[d.scope].push(this);
d.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){for(var d=a.ui.ddmanager.droppables[this.options.scope],c=0;c<d.length;c++)d[c]==this&&d.splice(c,1);this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this},_setOption:function(d,c){if(d=="accept")this.accept=a.isFunction(c)?c:function(e){return e.is(c)};a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(d){var c=a.ui.ddmanager.current;this.options.activeClass&&
this.element.addClass(this.options.activeClass);c&&this._trigger("activate",d,this.ui(c))},_deactivate:function(d){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass);c&&this._trigger("deactivate",d,this.ui(c))},_over:function(d){var c=a.ui.ddmanager.current;if(!(!c||(c.currentItem||c.element)[0]==this.element[0]))if(this.accept.call(this.element[0],c.currentItem||c.element)){this.options.hoverClass&&this.element.addClass(this.options.hoverClass);
this._trigger("over",d,this.ui(c))}},_out:function(d){var c=a.ui.ddmanager.current;if(!(!c||(c.currentItem||c.element)[0]==this.element[0]))if(this.accept.call(this.element[0],c.currentItem||c.element)){this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("out",d,this.ui(c))}},_drop:function(d,c){var e=c||a.ui.ddmanager.current;if(!e||(e.currentItem||e.element)[0]==this.element[0])return false;var h=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var g=
a.data(this,"droppable");if(g.options.greedy&&!g.options.disabled&&g.options.scope==e.options.scope&&g.accept.call(g.element[0],e.currentItem||e.element)&&a.ui.intersect(e,a.extend(g,{offset:g.element.offset()}),g.options.tolerance)){h=true;return false}});if(h)return false;if(this.accept.call(this.element[0],e.currentItem||e.element)){this.options.activeClass&&this.element.removeClass(this.options.activeClass);this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("drop",
d,this.ui(e));return this.element}return false},ui:function(d){return{draggable:d.currentItem||d.element,helper:d.helper,position:d.position,offset:d.positionAbs}}});a.extend(a.ui.droppable,{version:"1.8.16"});a.ui.intersect=function(d,c,e){if(!c.offset)return false;var h=(d.positionAbs||d.position.absolute).left,g=h+d.helperProportions.width,i=(d.positionAbs||d.position.absolute).top,b=i+d.helperProportions.height,f=c.offset.left,j=f+c.proportions.width,l=c.offset.top,o=l+c.proportions.height;
switch(e){case "fit":return f<=h&&g<=j&&l<=i&&b<=o;case "intersect":return f<h+d.helperProportions.width/2&&g-d.helperProportions.width/2<j&&l<i+d.helperProportions.height/2&&b-d.helperProportions.height/2<o;case "pointer":return a.ui.isOver((d.positionAbs||d.position.absolute).top+(d.clickOffset||d.offset.click).top,(d.positionAbs||d.position.absolute).left+(d.clickOffset||d.offset.click).left,l,f,c.proportions.height,c.proportions.width);case "touch":return(i>=l&&i<=o||b>=l&&b<=o||i<l&&b>o)&&(h>=
f&&h<=j||g>=f&&g<=j||h<f&&g>j);default:return false}};a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(d,c){var e=a.ui.ddmanager.droppables[d.options.scope]||[],h=c?c.type:null,g=(d.currentItem||d.element).find(":data(droppable)").andSelf(),i=0;a:for(;i<e.length;i++)if(!(e[i].options.disabled||d&&!e[i].accept.call(e[i].element[0],d.currentItem||d.element))){for(var b=0;b<g.length;b++)if(g[b]==e[i].element[0]){e[i].proportions.height=0;continue a}e[i].visible=e[i].element.css("display")!=
"none";if(e[i].visible){h=="mousedown"&&e[i]._activate.call(e[i],c);e[i].offset=e[i].element.offset();e[i].proportions={width:e[i].element[0].offsetWidth,height:e[i].element[0].offsetHeight}}}},drop:function(d,c){var e=false;a.each(a.ui.ddmanager.droppables[d.options.scope]||[],function(){if(this.options){if(!this.options.disabled&&this.visible&&a.ui.intersect(d,this,this.options.tolerance))e=e||this._drop.call(this,c);if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],d.currentItem||
d.element)){this.isout=1;this.isover=0;this._deactivate.call(this,c)}}});return e},dragStart:function(d,c){d.element.parents(":not(body,html)").bind("scroll.droppable",function(){d.options.refreshPositions||a.ui.ddmanager.prepareOffsets(d,c)})},drag:function(d,c){d.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(d,c);a.each(a.ui.ddmanager.droppables[d.options.scope]||[],function(){if(!(this.options.disabled||this.greedyChild||!this.visible)){var e=a.ui.intersect(d,this,this.options.tolerance);
if(e=!e&&this.isover==1?"isout":e&&this.isover==0?"isover":null){var h;if(this.options.greedy){var g=this.element.parents(":data(droppable):eq(0)");if(g.length){h=a.data(g[0],"droppable");h.greedyChild=e=="isover"?1:0}}if(h&&e=="isover"){h.isover=0;h.isout=1;h._out.call(h,c)}this[e]=1;this[e=="isout"?"isover":"isout"]=0;this[e=="isover"?"_over":"_out"].call(this,c);if(h&&e=="isout"){h.isout=0;h.isover=1;h._over.call(h,c)}}}})},dragStop:function(d,c){d.element.parents(":not(body,html)").unbind("scroll.droppable");
d.options.refreshPositions||a.ui.ddmanager.prepareOffsets(d,c)}}})(jQuery);
(function(a){a.widget("ui.resizable",a.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1E3},_create:function(){var e=this,h=this.options;this.element.addClass("ui-resizable");a.extend(this,{_aspectRatio:!!h.aspectRatio,aspectRatio:h.aspectRatio,originalElement:this.element,
_proportionallyResizeElements:[],_helper:h.helper||h.ghost||h.animate?h.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){/relative/.test(this.element.css("position"))&&a.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"});this.element.wrap(a('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),
top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("resizable",this.element.data("resizable"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=
this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize()}this.handles=h.handles||(!a(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",
nw:".ui-resizable-nw"});if(this.handles.constructor==String){if(this.handles=="all")this.handles="n,e,s,w,se,sw,ne,nw";var g=this.handles.split(",");this.handles={};for(var i=0;i<g.length;i++){var b=a.trim(g[i]),f=a('<div class="ui-resizable-handle '+("ui-resizable-"+b)+'"></div>');/sw|se|ne|nw/.test(b)&&f.css({zIndex:++h.zIndex});"se"==b&&f.addClass("ui-icon ui-icon-gripsmall-diagonal-se");this.handles[b]=".ui-resizable-"+b;this.element.append(f)}}this._renderAxis=function(j){j=j||this.element;for(var l in this.handles){if(this.handles[l].constructor==
String)this.handles[l]=a(this.handles[l],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var o=a(this.handles[l],this.element),n=0;n=/sw|ne|nw|se|n|s/.test(l)?o.outerHeight():o.outerWidth();o=["padding",/ne|nw|n/.test(l)?"Top":/se|sw|s/.test(l)?"Bottom":/^e$/.test(l)?"Right":"Left"].join("");j.css(o,n);this._proportionallyResize()}a(this.handles[l])}};this._renderAxis(this.element);this._handles=a(".ui-resizable-handle",this.element).disableSelection();
this._handles.mouseover(function(){if(!e.resizing){if(this.className)var j=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);e.axis=j&&j[1]?j[1]:"se"}});if(h.autoHide){this._handles.hide();a(this.element).addClass("ui-resizable-autohide").hover(function(){if(!h.disabled){a(this).removeClass("ui-resizable-autohide");e._handles.show()}},function(){if(!h.disabled)if(!e.resizing){a(this).addClass("ui-resizable-autohide");e._handles.hide()}})}this._mouseInit()},destroy:function(){this._mouseDestroy();
var e=function(g){a(g).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){e(this.element);var h=this.element;h.after(this.originalElement.css({position:h.css("position"),width:h.outerWidth(),height:h.outerHeight(),top:h.css("top"),left:h.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle);e(this.originalElement);return this},_mouseCapture:function(e){var h=
false;for(var g in this.handles)if(a(this.handles[g])[0]==e.target)h=true;return!this.options.disabled&&h},_mouseStart:function(e){var h=this.options,g=this.element.position(),i=this.element;this.resizing=true;this.documentScroll={top:a(document).scrollTop(),left:a(document).scrollLeft()};if(i.is(".ui-draggable")||/absolute/.test(i.css("position")))i.css({position:"absolute",top:g.top,left:g.left});a.browser.opera&&/relative/.test(i.css("position"))&&i.css({position:"relative",top:"auto",left:"auto"});
this._renderProxy();g=d(this.helper.css("left"));var b=d(this.helper.css("top"));if(h.containment){g+=a(h.containment).scrollLeft()||0;b+=a(h.containment).scrollTop()||0}this.offset=this.helper.offset();this.position={left:g,top:b};this.size=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()};this.originalSize=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()};this.originalPosition={left:g,top:b};this.sizeDiff=
{width:i.outerWidth()-i.width(),height:i.outerHeight()-i.height()};this.originalMousePosition={left:e.pageX,top:e.pageY};this.aspectRatio=typeof h.aspectRatio=="number"?h.aspectRatio:this.originalSize.width/this.originalSize.height||1;h=a(".ui-resizable-"+this.axis).css("cursor");a("body").css("cursor",h=="auto"?this.axis+"-resize":h);i.addClass("ui-resizable-resizing");this._propagate("start",e);return true},_mouseDrag:function(e){var h=this.helper,g=this.originalMousePosition,i=this._change[this.axis];
if(!i)return false;g=i.apply(this,[e,e.pageX-g.left||0,e.pageY-g.top||0]);this._updateVirtualBoundaries(e.shiftKey);if(this._aspectRatio||e.shiftKey)g=this._updateRatio(g,e);g=this._respectSize(g,e);this._propagate("resize",e);h.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize();this._updateCache(g);this._trigger("resize",e,this.ui());return false},
_mouseStop:function(e){this.resizing=false;var h=this.options,g=this;if(this._helper){var i=this._proportionallyResizeElements,b=i.length&&/textarea/i.test(i[0].nodeName);i=b&&a.ui.hasScroll(i[0],"left")?0:g.sizeDiff.height;b=b?0:g.sizeDiff.width;b={width:g.helper.width()-b,height:g.helper.height()-i};i=parseInt(g.element.css("left"),10)+(g.position.left-g.originalPosition.left)||null;var f=parseInt(g.element.css("top"),10)+(g.position.top-g.originalPosition.top)||null;h.animate||this.element.css(a.extend(b,
{top:f,left:i}));g.helper.height(g.size.height);g.helper.width(g.size.width);this._helper&&!h.animate&&this._proportionallyResize()}a("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",e);this._helper&&this.helper.remove();return false},_updateVirtualBoundaries:function(e){var h=this.options,g,i,b;h={minWidth:c(h.minWidth)?h.minWidth:0,maxWidth:c(h.maxWidth)?h.maxWidth:Infinity,minHeight:c(h.minHeight)?h.minHeight:0,maxHeight:c(h.maxHeight)?h.maxHeight:
Infinity};if(this._aspectRatio||e){e=h.minHeight*this.aspectRatio;i=h.minWidth/this.aspectRatio;g=h.maxHeight*this.aspectRatio;b=h.maxWidth/this.aspectRatio;if(e>h.minWidth)h.minWidth=e;if(i>h.minHeight)h.minHeight=i;if(g<h.maxWidth)h.maxWidth=g;if(b<h.maxHeight)h.maxHeight=b}this._vBoundaries=h},_updateCache:function(e){this.offset=this.helper.offset();if(c(e.left))this.position.left=e.left;if(c(e.top))this.position.top=e.top;if(c(e.height))this.size.height=e.height;if(c(e.width))this.size.width=
e.width},_updateRatio:function(e){var h=this.position,g=this.size,i=this.axis;if(c(e.height))e.width=e.height*this.aspectRatio;else if(c(e.width))e.height=e.width/this.aspectRatio;if(i=="sw"){e.left=h.left+(g.width-e.width);e.top=null}if(i=="nw"){e.top=h.top+(g.height-e.height);e.left=h.left+(g.width-e.width)}return e},_respectSize:function(e){var h=this._vBoundaries,g=this.axis,i=c(e.width)&&h.maxWidth&&h.maxWidth<e.width,b=c(e.height)&&h.maxHeight&&h.maxHeight<e.height,f=c(e.width)&&h.minWidth&&
h.minWidth>e.width,j=c(e.height)&&h.minHeight&&h.minHeight>e.height;if(f)e.width=h.minWidth;if(j)e.height=h.minHeight;if(i)e.width=h.maxWidth;if(b)e.height=h.maxHeight;var l=this.originalPosition.left+this.originalSize.width,o=this.position.top+this.size.height,n=/sw|nw|w/.test(g);g=/nw|ne|n/.test(g);if(f&&n)e.left=l-h.minWidth;if(i&&n)e.left=l-h.maxWidth;if(j&&g)e.top=o-h.minHeight;if(b&&g)e.top=o-h.maxHeight;if((h=!e.width&&!e.height)&&!e.left&&e.top)e.top=null;else if(h&&!e.top&&e.left)e.left=
null;return e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e=this.helper||this.element,h=0;h<this._proportionallyResizeElements.length;h++){var g=this._proportionallyResizeElements[h];if(!this.borderDif){var i=[g.css("borderTopWidth"),g.css("borderRightWidth"),g.css("borderBottomWidth"),g.css("borderLeftWidth")],b=[g.css("paddingTop"),g.css("paddingRight"),g.css("paddingBottom"),g.css("paddingLeft")];this.borderDif=a.map(i,function(f,j){f=parseInt(f,10)||
0;j=parseInt(b[j],10)||0;return f+j})}a.browser.msie&&(a(e).is(":hidden")||a(e).parents(":hidden").length)||g.css({height:e.height()-this.borderDif[0]-this.borderDif[2]||0,width:e.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var e=this.options;this.elementOffset=this.element.offset();if(this._helper){this.helper=this.helper||a('<div style="overflow:hidden;"></div>');var h=a.browser.msie&&a.browser.version<7,g=h?1:0;h=h?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+
h,height:this.element.outerHeight()+h,position:"absolute",left:this.elementOffset.left-g+"px",top:this.elementOffset.top-g+"px",zIndex:++e.zIndex});this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,h){return{width:this.originalSize.width+h}},w:function(e,h){return{left:this.originalPosition.left+h,width:this.originalSize.width-h}},n:function(e,h,g){return{top:this.originalPosition.top+g,height:this.originalSize.height-g}},s:function(e,h,g){return{height:this.originalSize.height+
g}},se:function(e,h,g){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,h,g]))},sw:function(e,h,g){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,h,g]))},ne:function(e,h,g){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,h,g]))},nw:function(e,h,g){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,h,g]))}},_propagate:function(e,h){a.ui.plugin.call(this,e,[h,this.ui()]);
e!="resize"&&this._trigger(e,h,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});a.extend(a.ui.resizable,{version:"1.8.16"});a.ui.plugin.add("resizable","alsoResize",{start:function(){var e=a(this).data("resizable").options,h=function(g){a(g).each(function(){var i=a(this);i.data("resizable-alsoresize",{width:parseInt(i.width(),
10),height:parseInt(i.height(),10),left:parseInt(i.css("left"),10),top:parseInt(i.css("top"),10),position:i.css("position")})})};if(typeof e.alsoResize=="object"&&!e.alsoResize.parentNode)if(e.alsoResize.length){e.alsoResize=e.alsoResize[0];h(e.alsoResize)}else a.each(e.alsoResize,function(g){h(g)});else h(e.alsoResize)},resize:function(e,h){var g=a(this).data("resizable");e=g.options;var i=g.originalSize,b=g.originalPosition,f={height:g.size.height-i.height||0,width:g.size.width-i.width||0,top:g.position.top-
b.top||0,left:g.position.left-b.left||0},j=function(l,o){a(l).each(function(){var n=a(this),k=a(this).data("resizable-alsoresize"),m={},p=o&&o.length?o:n.parents(h.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(p,function(q,s){if((q=(k[s]||0)+(f[s]||0))&&q>=0)m[s]=q||null});if(a.browser.opera&&/relative/.test(n.css("position"))){g._revertToRelativePosition=true;n.css({position:"absolute",top:"auto",left:"auto"})}n.css(m)})};typeof e.alsoResize=="object"&&!e.alsoResize.nodeType?
a.each(e.alsoResize,function(l,o){j(l,o)}):j(e.alsoResize)},stop:function(){var e=a(this).data("resizable"),h=e.options,g=function(i){a(i).each(function(){var b=a(this);b.css({position:b.data("resizable-alsoresize").position})})};if(e._revertToRelativePosition){e._revertToRelativePosition=false;typeof h.alsoResize=="object"&&!h.alsoResize.nodeType?a.each(h.alsoResize,function(i){g(i)}):g(h.alsoResize)}a(this).removeData("resizable-alsoresize")}});a.ui.plugin.add("resizable","animate",{stop:function(e){var h=
a(this).data("resizable"),g=h.options,i=h._proportionallyResizeElements,b=i.length&&/textarea/i.test(i[0].nodeName),f=b&&a.ui.hasScroll(i[0],"left")?0:h.sizeDiff.height;b={width:h.size.width-(b?0:h.sizeDiff.width),height:h.size.height-f};f=parseInt(h.element.css("left"),10)+(h.position.left-h.originalPosition.left)||null;var j=parseInt(h.element.css("top"),10)+(h.position.top-h.originalPosition.top)||null;h.element.animate(a.extend(b,j&&f?{top:j,left:f}:{}),{duration:g.animateDuration,easing:g.animateEasing,
step:function(){var l={width:parseInt(h.element.css("width"),10),height:parseInt(h.element.css("height"),10),top:parseInt(h.element.css("top"),10),left:parseInt(h.element.css("left"),10)};i&&i.length&&a(i[0]).css({width:l.width,height:l.height});h._updateCache(l);h._propagate("resize",e)}})}});a.ui.plugin.add("resizable","containment",{start:function(){var e=a(this).data("resizable"),h=e.element,g=e.options.containment;if(h=g instanceof a?g.get(0):/parent/.test(g)?h.parent().get(0):g){e.containerElement=
a(h);if(/document/.test(g)||g==document){e.containerOffset={left:0,top:0};e.containerPosition={left:0,top:0};e.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight}}else{var i=a(h),b=[];a(["Top","Right","Left","Bottom"]).each(function(l,o){b[l]=d(i.css("padding"+o))});e.containerOffset=i.offset();e.containerPosition=i.position();e.containerSize={height:i.innerHeight()-b[3],width:i.innerWidth()-b[1]};g=e.containerOffset;
var f=e.containerSize.height,j=e.containerSize.width;j=a.ui.hasScroll(h,"left")?h.scrollWidth:j;f=a.ui.hasScroll(h)?h.scrollHeight:f;e.parentData={element:h,left:g.left,top:g.top,width:j,height:f}}}},resize:function(e){var h=a(this).data("resizable"),g=h.options,i=h.containerOffset,b=h.position;e=h._aspectRatio||e.shiftKey;var f={top:0,left:0},j=h.containerElement;if(j[0]!=document&&/static/.test(j.css("position")))f=i;if(b.left<(h._helper?i.left:0)){h.size.width+=h._helper?h.position.left-i.left:
h.position.left-f.left;if(e)h.size.height=h.size.width/g.aspectRatio;h.position.left=g.helper?i.left:0}if(b.top<(h._helper?i.top:0)){h.size.height+=h._helper?h.position.top-i.top:h.position.top;if(e)h.size.width=h.size.height*g.aspectRatio;h.position.top=h._helper?i.top:0}h.offset.left=h.parentData.left+h.position.left;h.offset.top=h.parentData.top+h.position.top;g=Math.abs((h._helper?h.offset.left-f.left:h.offset.left-f.left)+h.sizeDiff.width);i=Math.abs((h._helper?h.offset.top-f.top:h.offset.top-
i.top)+h.sizeDiff.height);b=h.containerElement.get(0)==h.element.parent().get(0);f=/relative|absolute/.test(h.containerElement.css("position"));if(b&&f)g-=h.parentData.left;if(g+h.size.width>=h.parentData.width){h.size.width=h.parentData.width-g;if(e)h.size.height=h.size.width/h.aspectRatio}if(i+h.size.height>=h.parentData.height){h.size.height=h.parentData.height-i;if(e)h.size.width=h.size.height*h.aspectRatio}},stop:function(){var e=a(this).data("resizable"),h=e.options,g=e.containerOffset,i=e.containerPosition,
b=e.containerElement,f=a(e.helper),j=f.offset(),l=f.outerWidth()-e.sizeDiff.width;f=f.outerHeight()-e.sizeDiff.height;e._helper&&!h.animate&&/relative/.test(b.css("position"))&&a(this).css({left:j.left-i.left-g.left,width:l,height:f});e._helper&&!h.animate&&/static/.test(b.css("position"))&&a(this).css({left:j.left-i.left-g.left,width:l,height:f})}});a.ui.plugin.add("resizable","ghost",{start:function(){var e=a(this).data("resizable"),h=e.options,g=e.size;e.ghost=e.originalElement.clone();e.ghost.css({opacity:0.25,
display:"block",position:"relative",height:g.height,width:g.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof h.ghost=="string"?h.ghost:"");e.ghost.appendTo(e.helper)},resize:function(){var e=a(this).data("resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=a(this).data("resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}});a.ui.plugin.add("resizable","grid",{resize:function(){var e=
a(this).data("resizable"),h=e.options,g=e.size,i=e.originalSize,b=e.originalPosition,f=e.axis;h.grid=typeof h.grid=="number"?[h.grid,h.grid]:h.grid;var j=Math.round((g.width-i.width)/(h.grid[0]||1))*(h.grid[0]||1);h=Math.round((g.height-i.height)/(h.grid[1]||1))*(h.grid[1]||1);if(/^(se|s|e)$/.test(f)){e.size.width=i.width+j;e.size.height=i.height+h}else if(/^(ne)$/.test(f)){e.size.width=i.width+j;e.size.height=i.height+h;e.position.top=b.top-h}else{if(/^(sw)$/.test(f)){e.size.width=i.width+j;e.size.height=
i.height+h}else{e.size.width=i.width+j;e.size.height=i.height+h;e.position.top=b.top-h}e.position.left=b.left-j}}});var d=function(e){return parseInt(e,10)||0},c=function(e){return!isNaN(parseInt(e,10))}})(jQuery);
(function(a){a.widget("ui.selectable",a.ui.mouse,{options:{appendTo:"body",autoRefresh:true,distance:0,filter:"*",tolerance:"touch"},_create:function(){var d=this;this.element.addClass("ui-selectable");this.dragged=false;var c;this.refresh=function(){c=a(d.options.filter,d.element[0]);c.each(function(){var e=a(this),h=e.offset();a.data(this,"selectable-item",{element:this,$element:e,left:h.left,top:h.top,right:h.left+e.outerWidth(),bottom:h.top+e.outerHeight(),startselected:false,selected:e.hasClass("ui-selected"),
selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})};this.refresh();this.selectees=c.addClass("ui-selectee");this._mouseInit();this.helper=a("<div class='ui-selectable-helper'></div>")},destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable");this._mouseDestroy();return this},_mouseStart:function(d){var c=this;this.opos=[d.pageX,
d.pageY];if(!this.options.disabled){var e=this.options;this.selectees=a(e.filter,this.element[0]);this._trigger("start",d);a(e.appendTo).append(this.helper);this.helper.css({left:d.clientX,top:d.clientY,width:0,height:0});e.autoRefresh&&this.refresh();this.selectees.filter(".ui-selected").each(function(){var h=a.data(this,"selectable-item");h.startselected=true;if(!d.metaKey){h.$element.removeClass("ui-selected");h.selected=false;h.$element.addClass("ui-unselecting");h.unselecting=true;c._trigger("unselecting",
d,{unselecting:h.element})}});a(d.target).parents().andSelf().each(function(){var h=a.data(this,"selectable-item");if(h){var g=!d.metaKey||!h.$element.hasClass("ui-selected");h.$element.removeClass(g?"ui-unselecting":"ui-selected").addClass(g?"ui-selecting":"ui-unselecting");h.unselecting=!g;h.selecting=g;(h.selected=g)?c._trigger("selecting",d,{selecting:h.element}):c._trigger("unselecting",d,{unselecting:h.element});return false}})}},_mouseDrag:function(d){var c=this;this.dragged=true;if(!this.options.disabled){var e=
this.options,h=this.opos[0],g=this.opos[1],i=d.pageX,b=d.pageY;if(h>i){var f=i;i=h;h=f}if(g>b){f=b;b=g;g=f}this.helper.css({left:h,top:g,width:i-h,height:b-g});this.selectees.each(function(){var j=a.data(this,"selectable-item");if(!(!j||j.element==c.element[0])){var l=false;if(e.tolerance=="touch")l=!(j.left>i||j.right<h||j.top>b||j.bottom<g);else if(e.tolerance=="fit")l=j.left>h&&j.right<i&&j.top>g&&j.bottom<b;if(l){if(j.selected){j.$element.removeClass("ui-selected");j.selected=false}if(j.unselecting){j.$element.removeClass("ui-unselecting");
j.unselecting=false}if(!j.selecting){j.$element.addClass("ui-selecting");j.selecting=true;c._trigger("selecting",d,{selecting:j.element})}}else{if(j.selecting)if(d.metaKey&&j.startselected){j.$element.removeClass("ui-selecting");j.selecting=false;j.$element.addClass("ui-selected");j.selected=true}else{j.$element.removeClass("ui-selecting");j.selecting=false;if(j.startselected){j.$element.addClass("ui-unselecting");j.unselecting=true}c._trigger("unselecting",d,{unselecting:j.element})}if(j.selected)if(!d.metaKey&&
!j.startselected){j.$element.removeClass("ui-selected");j.selected=false;j.$element.addClass("ui-unselecting");j.unselecting=true;c._trigger("unselecting",d,{unselecting:j.element})}}}});return false}},_mouseStop:function(d){var c=this;this.dragged=false;a(".ui-unselecting",this.element[0]).each(function(){var e=a.data(this,"selectable-item");e.$element.removeClass("ui-unselecting");e.unselecting=false;e.startselected=false;c._trigger("unselected",d,{unselected:e.element})});a(".ui-selecting",this.element[0]).each(function(){var e=
a.data(this,"selectable-item");e.$element.removeClass("ui-selecting").addClass("ui-selected");e.selecting=false;e.selected=true;e.startselected=true;c._trigger("selected",d,{selected:e.element})});this._trigger("stop",d);this.helper.remove();return false}});a.extend(a.ui.selectable,{version:"1.8.16"})})(jQuery);
(function(a){a.widget("ui.sortable",a.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1E3},_create:function(){var d=this.options;this.containerCache={};this.element.addClass("ui-sortable");
this.refresh();this.floating=this.items.length?d.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):false;this.offset=this.element.offset();this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable");this._mouseDestroy();for(var d=this.items.length-1;d>=0;d--)this.items[d].item.removeData("sortable-item");return this},_setOption:function(d,c){if(d===
"disabled"){this.options[d]=c;this.widget()[c?"addClass":"removeClass"]("ui-sortable-disabled")}else a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(d,c){if(this.reverting)return false;if(this.options.disabled||this.options.type=="static")return false;this._refreshItems(d);var e=null,h=this;a(d.target).parents().each(function(){if(a.data(this,"sortable-item")==h){e=a(this);return false}});if(a.data(d.target,"sortable-item")==h)e=a(d.target);if(!e)return false;if(this.options.handle&&
!c){var g=false;a(this.options.handle,e).find("*").andSelf().each(function(){if(this==d.target)g=true});if(!g)return false}this.currentItem=e;this._removeCurrentsFromItems();return true},_mouseStart:function(d,c,e){c=this.options;var h=this;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(d);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,
left:this.offset.left-this.margins.left};this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");a.extend(this.offset,{click:{left:d.pageX-this.offset.left,top:d.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this._generatePosition(d);this.originalPageX=d.pageX;this.originalPageY=d.pageY;c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};
this.helper[0]!=this.currentItem[0]&&this.currentItem.hide();this._createPlaceholder();c.containment&&this._setContainment();if(c.cursor){if(a("body").css("cursor"))this._storedCursor=a("body").css("cursor");a("body").css("cursor",c.cursor)}if(c.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",c.opacity)}if(c.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",c.zIndex)}if(this.scrollParent[0]!=
document&&this.scrollParent[0].tagName!="HTML")this.overflowOffset=this.scrollParent.offset();this._trigger("start",d,this._uiHash());this._preserveHelperProportions||this._cacheHelperProportions();if(!e)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",d,h._uiHash(this));if(a.ui.ddmanager)a.ui.ddmanager.current=this;a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,d);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(d);
return true},_mouseDrag:function(d){this.position=this._generatePosition(d);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs)this.lastPositionAbs=this.positionAbs;if(this.options.scroll){var c=this.options,e=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-d.pageY<c.scrollSensitivity)this.scrollParent[0].scrollTop=e=this.scrollParent[0].scrollTop+c.scrollSpeed;else if(d.pageY-this.overflowOffset.top<
c.scrollSensitivity)this.scrollParent[0].scrollTop=e=this.scrollParent[0].scrollTop-c.scrollSpeed;if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-d.pageX<c.scrollSensitivity)this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft+c.scrollSpeed;else if(d.pageX-this.overflowOffset.left<c.scrollSensitivity)this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft-c.scrollSpeed}else{if(d.pageY-a(document).scrollTop()<c.scrollSensitivity)e=a(document).scrollTop(a(document).scrollTop()-
c.scrollSpeed);else if(a(window).height()-(d.pageY-a(document).scrollTop())<c.scrollSensitivity)e=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed);if(d.pageX-a(document).scrollLeft()<c.scrollSensitivity)e=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed);else if(a(window).width()-(d.pageX-a(document).scrollLeft())<c.scrollSensitivity)e=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed)}e!==false&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,
d)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(c=this.items.length-1;c>=0;c--){e=this.items[c];var h=e.item[0],g=this._intersectsWithPointer(e);if(g)if(h!=this.currentItem[0]&&this.placeholder[g==1?"next":"prev"]()[0]!=h&&!a.ui.contains(this.placeholder[0],h)&&(this.options.type=="semi-dynamic"?!a.ui.contains(this.element[0],
h):true)){this.direction=g==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(e))this._rearrange(d,e);else break;this._trigger("change",d,this._uiHash());break}}this._contactContainers(d);a.ui.ddmanager&&a.ui.ddmanager.drag(this,d);this._trigger("sort",d,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(d,c){if(d){a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,d);if(this.options.revert){var e=this;c=e.placeholder.offset();
e.reverting=true;a(this.helper).animate({left:c.left-this.offset.parent.left-e.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:c.top-this.offset.parent.top-e.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){e._clear(d)})}else this._clear(d,c);return false}},cancel:function(){var d=this;if(this.dragging){this._mouseUp({target:null});this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):
this.currentItem.show();for(var c=this.containers.length-1;c>=0;c--){this.containers[c]._trigger("deactivate",null,d._uiHash(this));if(this.containers[c].containerCache.over){this.containers[c]._trigger("out",null,d._uiHash(this));this.containers[c].containerCache.over=0}}}if(this.placeholder){this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove();a.extend(this,{helper:null,
dragging:false,reverting:false,_noFinalSort:null});this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)}return this},serialize:function(d){var c=this._getItemsAsjQuery(d&&d.connected),e=[];d=d||{};a(c).each(function(){var h=(a(d.item||this).attr(d.attribute||"id")||"").match(d.expression||/(.+)[-=_](.+)/);if(h)e.push((d.key||h[1]+"[]")+"="+(d.key&&d.expression?h[1]:h[2]))});!e.length&&d.key&&e.push(d.key+"=");return e.join("&")},
toArray:function(d){var c=this._getItemsAsjQuery(d&&d.connected),e=[];d=d||{};c.each(function(){e.push(a(d.item||this).attr(d.attribute||"id")||"")});return e},_intersectsWith:function(d){var c=this.positionAbs.left,e=c+this.helperProportions.width,h=this.positionAbs.top,g=h+this.helperProportions.height,i=d.left,b=i+d.width,f=d.top,j=f+d.height,l=this.offset.click.top,o=this.offset.click.left;l=h+l>f&&h+l<j&&c+o>i&&c+o<b;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||
this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>d[this.floating?"width":"height"]?l:i<c+this.helperProportions.width/2&&e-this.helperProportions.width/2<b&&f<h+this.helperProportions.height/2&&g-this.helperProportions.height/2<j},_intersectsWithPointer:function(d){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,d.top,d.height);d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,d.left,d.width);c=c&&d;d=this._getDragVerticalDirection();
var e=this._getDragHorizontalDirection();if(!c)return false;return this.floating?e&&e=="right"||d=="down"?2:1:d&&(d=="down"?2:1)},_intersectsWithSides:function(d){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,d.top+d.height/2,d.height);d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,d.left+d.width/2,d.width);var e=this._getDragVerticalDirection(),h=this._getDragHorizontalDirection();return this.floating&&h?h=="right"&&d||h=="left"&&!d:e&&(e=="down"&&c||e=="up"&&!c)},
_getDragVerticalDirection:function(){var d=this.positionAbs.top-this.lastPositionAbs.top;return d!=0&&(d>0?"down":"up")},_getDragHorizontalDirection:function(){var d=this.positionAbs.left-this.lastPositionAbs.left;return d!=0&&(d>0?"right":"left")},refresh:function(d){this._refreshItems(d);this.refreshPositions();return this},_connectWith:function(){var d=this.options;return d.connectWith.constructor==String?[d.connectWith]:d.connectWith},_getItemsAsjQuery:function(d){var c=[],e=[],h=this._connectWith();
if(h&&d)for(d=h.length-1;d>=0;d--)for(var g=a(h[d]),i=g.length-1;i>=0;i--){var b=a.data(g[i],"sortable");if(b&&b!=this&&!b.options.disabled)e.push([a.isFunction(b.options.items)?b.options.items.call(b.element):a(b.options.items,b.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),b])}e.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),
this]);for(d=e.length-1;d>=0;d--)e[d][0].each(function(){c.push(this)});return a(c)},_removeCurrentsFromItems:function(){for(var d=this.currentItem.find(":data(sortable-item)"),c=0;c<this.items.length;c++)for(var e=0;e<d.length;e++)d[e]==this.items[c].item[0]&&this.items.splice(c,1)},_refreshItems:function(d){this.items=[];this.containers=[this];var c=this.items,e=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],d,{item:this.currentItem}):a(this.options.items,this.element),
this]],h=this._connectWith();if(h)for(var g=h.length-1;g>=0;g--)for(var i=a(h[g]),b=i.length-1;b>=0;b--){var f=a.data(i[b],"sortable");if(f&&f!=this&&!f.options.disabled){e.push([a.isFunction(f.options.items)?f.options.items.call(f.element[0],d,{item:this.currentItem}):a(f.options.items,f.element),f]);this.containers.push(f)}}for(g=e.length-1;g>=0;g--){d=e[g][1];h=e[g][0];b=0;for(i=h.length;b<i;b++){f=a(h[b]);f.data("sortable-item",d);c.push({item:f,instance:d,width:0,height:0,left:0,top:0})}}},refreshPositions:function(d){if(this.offsetParent&&
this.helper)this.offset.parent=this._getParentOffset();for(var c=this.items.length-1;c>=0;c--){var e=this.items[c];if(!(e.instance!=this.currentContainer&&this.currentContainer&&e.item[0]!=this.currentItem[0])){var h=this.options.toleranceElement?a(this.options.toleranceElement,e.item):e.item;if(!d){e.width=h.outerWidth();e.height=h.outerHeight()}h=h.offset();e.left=h.left;e.top=h.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=
this.containers.length-1;c>=0;c--){h=this.containers[c].element.offset();this.containers[c].containerCache.left=h.left;this.containers[c].containerCache.top=h.top;this.containers[c].containerCache.width=this.containers[c].element.outerWidth();this.containers[c].containerCache.height=this.containers[c].element.outerHeight()}return this},_createPlaceholder:function(d){var c=d||this,e=c.options;if(!e.placeholder||e.placeholder.constructor==String){var h=e.placeholder;e.placeholder={element:function(){var g=
a(document.createElement(c.currentItem[0].nodeName)).addClass(h||c.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!h)g.style.visibility="hidden";return g},update:function(g,i){if(!(h&&!e.forcePlaceholderSize)){i.height()||i.height(c.currentItem.innerHeight()-parseInt(c.currentItem.css("paddingTop")||0,10)-parseInt(c.currentItem.css("paddingBottom")||0,10));i.width()||i.width(c.currentItem.innerWidth()-parseInt(c.currentItem.css("paddingLeft")||0,10)-parseInt(c.currentItem.css("paddingRight")||
0,10))}}}}c.placeholder=a(e.placeholder.element.call(c.element,c.currentItem));c.currentItem.after(c.placeholder);e.placeholder.update(c,c.placeholder)},_contactContainers:function(d){for(var c=null,e=null,h=this.containers.length-1;h>=0;h--)if(!a.ui.contains(this.currentItem[0],this.containers[h].element[0]))if(this._intersectsWith(this.containers[h].containerCache)){if(!(c&&a.ui.contains(this.containers[h].element[0],c.element[0]))){c=this.containers[h];e=h}}else if(this.containers[h].containerCache.over){this.containers[h]._trigger("out",
d,this._uiHash(this));this.containers[h].containerCache.over=0}if(c)if(this.containers.length===1){this.containers[e]._trigger("over",d,this._uiHash(this));this.containers[e].containerCache.over=1}else if(this.currentContainer!=this.containers[e]){c=1E4;h=null;for(var g=this.positionAbs[this.containers[e].floating?"left":"top"],i=this.items.length-1;i>=0;i--)if(a.ui.contains(this.containers[e].element[0],this.items[i].item[0])){var b=this.items[i][this.containers[e].floating?"left":"top"];if(Math.abs(b-
g)<c){c=Math.abs(b-g);h=this.items[i]}}if(h||this.options.dropOnEmpty){this.currentContainer=this.containers[e];h?this._rearrange(d,h,null,true):this._rearrange(d,null,this.containers[e].element,true);this._trigger("change",d,this._uiHash());this.containers[e]._trigger("change",d,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[e]._trigger("over",d,this._uiHash(this));this.containers[e].containerCache.over=1}}},_createHelper:function(d){var c=
this.options;d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[d,this.currentItem])):c.helper=="clone"?this.currentItem.clone():this.currentItem;d.parents("body").length||a(c.appendTo!="parent"?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]);if(d[0]==this.currentItem[0])this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(d[0].style.width==
""||c.forceHelperSize)d.width(this.currentItem.width());if(d[0].style.height==""||c.forceHelperSize)d.height(this.currentItem.height());return d},_adjustOffsetFromHelper:function(d){if(typeof d=="string")d=d.split(" ");if(a.isArray(d))d={left:+d[0],top:+d[1]||0};if("left"in d)this.offset.click.left=d.left+this.margins.left;if("right"in d)this.offset.click.left=this.helperProportions.width-d.right+this.margins.left;if("top"in d)this.offset.click.top=d.top+this.margins.top;if("bottom"in d)this.offset.click.top=
this.helperProportions.height-d.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var d=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])){d.left+=this.scrollParent.scrollLeft();d.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)d=
{top:0,left:0};return{top:d.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:d.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var d=this.currentItem.position();return{top:d.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:d.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),
10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var d=this.options;if(d.containment=="parent")d.containment=this.helper[0].parentNode;if(d.containment=="document"||d.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(d.containment=="document"?
document:window).width()-this.helperProportions.width-this.margins.left,(a(d.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(d.containment)){var c=a(d.containment)[0];d=a(d.containment).offset();var e=a(c).css("overflow")!="hidden";this.containment=[d.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(c).css("borderTopWidth"),
10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,d.left+(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(d,c){if(!c)c=
this.position;d=d=="absolute"?1:-1;var e=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:e.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&
this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:e.scrollLeft())*d)}},_generatePosition:function(d){var c=this.options,e=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(e[0].tagName);if(this.cssPosition=="relative"&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]))this.offset.relative=this._getRelativeOffset();
var g=d.pageX,i=d.pageY;if(this.originalPosition){if(this.containment){if(d.pageX-this.offset.click.left<this.containment[0])g=this.containment[0]+this.offset.click.left;if(d.pageY-this.offset.click.top<this.containment[1])i=this.containment[1]+this.offset.click.top;if(d.pageX-this.offset.click.left>this.containment[2])g=this.containment[2]+this.offset.click.left;if(d.pageY-this.offset.click.top>this.containment[3])i=this.containment[3]+this.offset.click.top}if(c.grid){i=this.originalPageY+Math.round((i-
this.originalPageY)/c.grid[1])*c.grid[1];i=this.containment?!(i-this.offset.click.top<this.containment[1]||i-this.offset.click.top>this.containment[3])?i:!(i-this.offset.click.top<this.containment[1])?i-c.grid[1]:i+c.grid[1]:i;g=this.originalPageX+Math.round((g-this.originalPageX)/c.grid[0])*c.grid[0];g=this.containment?!(g-this.offset.click.left<this.containment[0]||g-this.offset.click.left>this.containment[2])?g:!(g-this.offset.click.left<this.containment[0])?g-c.grid[0]:g+c.grid[0]:g}}return{top:i-
this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:e.scrollTop()),left:g-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:e.scrollLeft())}},_rearrange:function(d,c,e,h){e?e[0].appendChild(this.placeholder[0]):c.item[0].parentNode.insertBefore(this.placeholder[0],
this.direction=="down"?c.item[0]:c.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var g=this,i=this.counter;window.setTimeout(function(){i==g.counter&&g.refreshPositions(!h)},0)},_clear:function(d,c){this.reverting=false;var e=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var h in this._storedCSS)if(this._storedCSS[h]=="auto"||this._storedCSS[h]=="static")this._storedCSS[h]=
"";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!c&&e.push(function(g){this._trigger("receive",g,this._uiHash(this.fromOutside))});if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!c)e.push(function(g){this._trigger("update",g,this._uiHash())});if(!a.ui.contains(this.element[0],this.currentItem[0])){c||e.push(function(g){this._trigger("remove",
g,this._uiHash())});for(h=this.containers.length-1;h>=0;h--)if(a.ui.contains(this.containers[h].element[0],this.currentItem[0])&&!c){e.push(function(g){return function(i){g._trigger("receive",i,this._uiHash(this))}}.call(this,this.containers[h]));e.push(function(g){return function(i){g._trigger("update",i,this._uiHash(this))}}.call(this,this.containers[h]))}}for(h=this.containers.length-1;h>=0;h--){c||e.push(function(g){return function(i){g._trigger("deactivate",i,this._uiHash(this))}}.call(this,
this.containers[h]));if(this.containers[h].containerCache.over){e.push(function(g){return function(i){g._trigger("out",i,this._uiHash(this))}}.call(this,this.containers[h]));this.containers[h].containerCache.over=0}}this._storedCursor&&a("body").css("cursor",this._storedCursor);this._storedOpacity&&this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!c){this._trigger("beforeStop",
d,this._uiHash());for(h=0;h<e.length;h++)e[h].call(this,d);this._trigger("stop",d,this._uiHash())}return false}c||this._trigger("beforeStop",d,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.helper[0]!=this.currentItem[0]&&this.helper.remove();this.helper=null;if(!c){for(h=0;h<e.length;h++)e[h].call(this,d);this._trigger("stop",d,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===false&&this.cancel()},
_uiHash:function(d){var c=d||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:d?d.element:null}}});a.extend(a.ui.sortable,{version:"1.8.16"})})(jQuery);
jQuery.effects||function(a,d){function c(n){var k;if(n&&n.constructor==Array&&n.length==3)return n;if(k=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(n))return[parseInt(k[1],10),parseInt(k[2],10),parseInt(k[3],10)];if(k=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(n))return[parseFloat(k[1])*2.55,parseFloat(k[2])*2.55,parseFloat(k[3])*2.55];if(k=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(n))return[parseInt(k[1],
16),parseInt(k[2],16),parseInt(k[3],16)];if(k=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(n))return[parseInt(k[1]+k[1],16),parseInt(k[2]+k[2],16),parseInt(k[3]+k[3],16)];if(/rgba\(0, 0, 0, 0\)/.exec(n))return j.transparent;return j[a.trim(n).toLowerCase()]}function e(n,k){var m;do{m=a.curCSS(n,k);if(m!=""&&m!="transparent"||a.nodeName(n,"body"))break;k="backgroundColor"}while(n=n.parentNode);return c(m)}function h(){var n=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,
k={},m,p;if(n&&n.length&&n[0]&&n[n[0]])for(var q=n.length;q--;){m=n[q];if(typeof n[m]=="string"){p=m.replace(/\-(\w)/g,function(s,r){return r.toUpperCase()});k[p]=n[m]}}else for(m in n)if(typeof n[m]==="string")k[m]=n[m];return k}function g(n){var k,m;for(k in n){m=n[k];if(m==null||a.isFunction(m)||k in o||/scrollbar/.test(k)||!/color/i.test(k)&&isNaN(parseFloat(m)))delete n[k]}return n}function i(n,k){var m={_:0},p;for(p in k)if(n[p]!=k[p])m[p]=k[p];return m}function b(n,k,m,p){if(typeof n=="object"){p=
k;m=null;k=n;n=k.effect}if(a.isFunction(k)){p=k;m=null;k={}}if(typeof k=="number"||a.fx.speeds[k]){p=m;m=k;k={}}if(a.isFunction(m)){p=m;m=null}k=k||{};m=m||k.duration;m=a.fx.off?0:typeof m=="number"?m:m in a.fx.speeds?a.fx.speeds[m]:a.fx.speeds._default;p=p||k.complete;return[n,k,m,p]}function f(n){if(!n||typeof n==="number"||a.fx.speeds[n])return true;if(typeof n==="string"&&!a.effects[n])return true;return false}a.effects={};a.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor",
"borderTopColor","borderColor","color","outlineColor"],function(n,k){a.fx.step[k]=function(m){if(!m.colorInit){m.start=e(m.elem,k);m.end=c(m.end);m.colorInit=true}m.elem.style[k]="rgb("+Math.max(Math.min(parseInt(m.pos*(m.end[0]-m.start[0])+m.start[0],10),255),0)+","+Math.max(Math.min(parseInt(m.pos*(m.end[1]-m.start[1])+m.start[1],10),255),0)+","+Math.max(Math.min(parseInt(m.pos*(m.end[2]-m.start[2])+m.start[2],10),255),0)+")"}});var j={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,
0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,
211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},l=["add","remove","toggle"],o={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};a.effects.animateClass=function(n,k,m,
p){if(a.isFunction(m)){p=m;m=null}return this.queue(function(){var q=a(this),s=q.attr("style")||" ",r=g(h.call(this)),u,v=q.attr("class");a.each(l,function(w,x){n[x]&&q[x+"Class"](n[x])});u=g(h.call(this));q.attr("class",v);q.animate(i(r,u),{queue:false,duration:k,easing:m,complete:function(){a.each(l,function(w,x){n[x]&&q[x+"Class"](n[x])});if(typeof q.attr("style")=="object"){q.attr("style").cssText="";q.attr("style").cssText=s}else q.attr("style",s);p&&p.apply(this,arguments);a.dequeue(this)}})})};
a.fn.extend({_addClass:a.fn.addClass,addClass:function(n,k,m,p){return k?a.effects.animateClass.apply(this,[{add:n},k,m,p]):this._addClass(n)},_removeClass:a.fn.removeClass,removeClass:function(n,k,m,p){return k?a.effects.animateClass.apply(this,[{remove:n},k,m,p]):this._removeClass(n)},_toggleClass:a.fn.toggleClass,toggleClass:function(n,k,m,p,q){return typeof k=="boolean"||k===d?m?a.effects.animateClass.apply(this,[k?{add:n}:{remove:n},m,p,q]):this._toggleClass(n,k):a.effects.animateClass.apply(this,
[{toggle:n},k,m,p])},switchClass:function(n,k,m,p,q){return a.effects.animateClass.apply(this,[{add:k,remove:n},m,p,q])}});a.extend(a.effects,{version:"1.8.16",save:function(n,k){for(var m=0;m<k.length;m++)k[m]!==null&&n.data("ec.storage."+k[m],n[0].style[k[m]])},restore:function(n,k){for(var m=0;m<k.length;m++)k[m]!==null&&n.css(k[m],n.data("ec.storage."+k[m]))},setMode:function(n,k){if(k=="toggle")k=n.is(":hidden")?"show":"hide";return k},getBaseline:function(n,k){var m;switch(n[0]){case "top":m=
0;break;case "middle":m=0.5;break;case "bottom":m=1;break;default:m=n[0]/k.height}switch(n[1]){case "left":n=0;break;case "center":n=0.5;break;case "right":n=1;break;default:n=n[1]/k.width}return{x:n,y:m}},createWrapper:function(n){if(n.parent().is(".ui-effects-wrapper"))return n.parent();var k={width:n.outerWidth(true),height:n.outerHeight(true),"float":n.css("float")},m=a("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),
p=document.activeElement;n.wrap(m);if(n[0]===p||a.contains(n[0],p))a(p).focus();m=n.parent();if(n.css("position")=="static"){m.css({position:"relative"});n.css({position:"relative"})}else{a.extend(k,{position:n.css("position"),zIndex:n.css("z-index")});a.each(["top","left","bottom","right"],function(q,s){k[s]=n.css(s);if(isNaN(parseInt(k[s],10)))k[s]="auto"});n.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})}return m.css(k).show()},removeWrapper:function(n){var k,m=document.activeElement;
if(n.parent().is(".ui-effects-wrapper")){k=n.parent().replaceWith(n);if(n[0]===m||a.contains(n[0],m))a(m).focus();return k}return n},setTransition:function(n,k,m,p){p=p||{};a.each(k,function(q,s){unit=n.cssUnit(s);if(unit[0]>0)p[s]=unit[0]*m+unit[1]});return p}});a.fn.extend({effect:function(n){var k=b.apply(this,arguments),m={options:k[1],duration:k[2],callback:k[3]};k=m.options.mode;var p=a.effects[n];if(a.fx.off||!p)return k?this[k](m.duration,m.callback):this.each(function(){m.callback&&m.callback.call(this)});
return p.call(this,m)},_show:a.fn.show,show:function(n){if(f(n))return this._show.apply(this,arguments);else{var k=b.apply(this,arguments);k[1].mode="show";return this.effect.apply(this,k)}},_hide:a.fn.hide,hide:function(n){if(f(n))return this._hide.apply(this,arguments);else{var k=b.apply(this,arguments);k[1].mode="hide";return this.effect.apply(this,k)}},__toggle:a.fn.toggle,toggle:function(n){if(f(n)||typeof n==="boolean"||a.isFunction(n))return this.__toggle.apply(this,arguments);else{var k=b.apply(this,
arguments);k[1].mode="toggle";return this.effect.apply(this,k)}},cssUnit:function(n){var k=this.css(n),m=[];a.each(["em","px","%","pt"],function(p,q){if(k.indexOf(q)>0)m=[parseFloat(k),q]});return m}});a.easing.jswing=a.easing.swing;a.extend(a.easing,{def:"easeOutQuad",swing:function(n,k,m,p,q){return a.easing[a.easing.def](n,k,m,p,q)},easeInQuad:function(n,k,m,p,q){return p*(k/=q)*k+m},easeOutQuad:function(n,k,m,p,q){return-p*(k/=q)*(k-2)+m},easeInOutQuad:function(n,k,m,p,q){if((k/=q/2)<1)return p/
2*k*k+m;return-p/2*(--k*(k-2)-1)+m},easeInCubic:function(n,k,m,p,q){return p*(k/=q)*k*k+m},easeOutCubic:function(n,k,m,p,q){return p*((k=k/q-1)*k*k+1)+m},easeInOutCubic:function(n,k,m,p,q){if((k/=q/2)<1)return p/2*k*k*k+m;return p/2*((k-=2)*k*k+2)+m},easeInQuart:function(n,k,m,p,q){return p*(k/=q)*k*k*k+m},easeOutQuart:function(n,k,m,p,q){return-p*((k=k/q-1)*k*k*k-1)+m},easeInOutQuart:function(n,k,m,p,q){if((k/=q/2)<1)return p/2*k*k*k*k+m;return-p/2*((k-=2)*k*k*k-2)+m},easeInQuint:function(n,k,m,
p,q){return p*(k/=q)*k*k*k*k+m},easeOutQuint:function(n,k,m,p,q){return p*((k=k/q-1)*k*k*k*k+1)+m},easeInOutQuint:function(n,k,m,p,q){if((k/=q/2)<1)return p/2*k*k*k*k*k+m;return p/2*((k-=2)*k*k*k*k+2)+m},easeInSine:function(n,k,m,p,q){return-p*Math.cos(k/q*(Math.PI/2))+p+m},easeOutSine:function(n,k,m,p,q){return p*Math.sin(k/q*(Math.PI/2))+m},easeInOutSine:function(n,k,m,p,q){return-p/2*(Math.cos(Math.PI*k/q)-1)+m},easeInExpo:function(n,k,m,p,q){return k==0?m:p*Math.pow(2,10*(k/q-1))+m},easeOutExpo:function(n,
k,m,p,q){return k==q?m+p:p*(-Math.pow(2,-10*k/q)+1)+m},easeInOutExpo:function(n,k,m,p,q){if(k==0)return m;if(k==q)return m+p;if((k/=q/2)<1)return p/2*Math.pow(2,10*(k-1))+m;return p/2*(-Math.pow(2,-10*--k)+2)+m},easeInCirc:function(n,k,m,p,q){return-p*(Math.sqrt(1-(k/=q)*k)-1)+m},easeOutCirc:function(n,k,m,p,q){return p*Math.sqrt(1-(k=k/q-1)*k)+m},easeInOutCirc:function(n,k,m,p,q){if((k/=q/2)<1)return-p/2*(Math.sqrt(1-k*k)-1)+m;return p/2*(Math.sqrt(1-(k-=2)*k)+1)+m},easeInElastic:function(n,k,m,
p,q){n=1.70158;var s=0,r=p;if(k==0)return m;if((k/=q)==1)return m+p;s||(s=q*0.3);if(r<Math.abs(p)){r=p;n=s/4}else n=s/(2*Math.PI)*Math.asin(p/r);return-(r*Math.pow(2,10*(k-=1))*Math.sin((k*q-n)*2*Math.PI/s))+m},easeOutElastic:function(n,k,m,p,q){n=1.70158;var s=0,r=p;if(k==0)return m;if((k/=q)==1)return m+p;s||(s=q*0.3);if(r<Math.abs(p)){r=p;n=s/4}else n=s/(2*Math.PI)*Math.asin(p/r);return r*Math.pow(2,-10*k)*Math.sin((k*q-n)*2*Math.PI/s)+p+m},easeInOutElastic:function(n,k,m,p,q){n=1.70158;var s=
0,r=p;if(k==0)return m;if((k/=q/2)==2)return m+p;s||(s=q*0.3*1.5);if(r<Math.abs(p)){r=p;n=s/4}else n=s/(2*Math.PI)*Math.asin(p/r);if(k<1)return-0.5*r*Math.pow(2,10*(k-=1))*Math.sin((k*q-n)*2*Math.PI/s)+m;return r*Math.pow(2,-10*(k-=1))*Math.sin((k*q-n)*2*Math.PI/s)*0.5+p+m},easeInBack:function(n,k,m,p,q,s){if(s==d)s=1.70158;return p*(k/=q)*k*((s+1)*k-s)+m},easeOutBack:function(n,k,m,p,q,s){if(s==d)s=1.70158;return p*((k=k/q-1)*k*((s+1)*k+s)+1)+m},easeInOutBack:function(n,k,m,p,q,s){if(s==d)s=1.70158;
if((k/=q/2)<1)return p/2*k*k*(((s*=1.525)+1)*k-s)+m;return p/2*((k-=2)*k*(((s*=1.525)+1)*k+s)+2)+m},easeInBounce:function(n,k,m,p,q){return p-a.easing.easeOutBounce(n,q-k,0,p,q)+m},easeOutBounce:function(n,k,m,p,q){return(k/=q)<1/2.75?p*7.5625*k*k+m:k<2/2.75?p*(7.5625*(k-=1.5/2.75)*k+0.75)+m:k<2.5/2.75?p*(7.5625*(k-=2.25/2.75)*k+0.9375)+m:p*(7.5625*(k-=2.625/2.75)*k+0.984375)+m},easeInOutBounce:function(n,k,m,p,q){if(k<q/2)return a.easing.easeInBounce(n,k*2,0,p,q)*0.5+m;return a.easing.easeOutBounce(n,
k*2-q,0,p,q)*0.5+p*0.5+m}})}(jQuery);
(function(a){a.effects.blind=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right"],h=a.effects.setMode(c,d.options.mode||"hide"),g=d.options.direction||"vertical";a.effects.save(c,e);c.show();var i=a.effects.createWrapper(c).css({overflow:"hidden"}),b=g=="vertical"?"height":"width";g=g=="vertical"?i.height():i.width();h=="show"&&i.css(b,0);var f={};f[b]=h=="show"?g:0;i.animate(f,d.duration,d.options.easing,function(){h=="hide"&&c.hide();a.effects.restore(c,
e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(c[0],arguments);c.dequeue()})})}})(jQuery);
(function(a){a.effects.bounce=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right"],h=a.effects.setMode(c,d.options.mode||"effect"),g=d.options.direction||"up",i=d.options.distance||20,b=d.options.times||5,f=d.duration||250;/show|hide/.test(h)&&e.push("opacity");a.effects.save(c,e);c.show();a.effects.createWrapper(c);var j=g=="up"||g=="down"?"top":"left";g=g=="up"||g=="left"?"pos":"neg";i=d.options.distance||(j=="top"?c.outerHeight({margin:true})/3:c.outerWidth({margin:true})/
3);if(h=="show")c.css("opacity",0).css(j,g=="pos"?-i:i);if(h=="hide")i/=b*2;h!="hide"&&b--;if(h=="show"){var l={opacity:1};l[j]=(g=="pos"?"+=":"-=")+i;c.animate(l,f/2,d.options.easing);i/=2;b--}for(l=0;l<b;l++){var o={},n={};o[j]=(g=="pos"?"-=":"+=")+i;n[j]=(g=="pos"?"+=":"-=")+i;c.animate(o,f/2,d.options.easing).animate(n,f/2,d.options.easing);i=h=="hide"?i*2:i/2}if(h=="hide"){l={opacity:0};l[j]=(g=="pos"?"-=":"+=")+i;c.animate(l,f/2,d.options.easing,function(){c.hide();a.effects.restore(c,e);a.effects.removeWrapper(c);
d.callback&&d.callback.apply(this,arguments)})}else{o={};n={};o[j]=(g=="pos"?"-=":"+=")+i;n[j]=(g=="pos"?"+=":"-=")+i;c.animate(o,f/2,d.options.easing).animate(n,f/2,d.options.easing,function(){a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(this,arguments)})}c.queue("fx",function(){c.dequeue()});c.dequeue()})}})(jQuery);
(function(a){a.effects.clip=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right","height","width"],h=a.effects.setMode(c,d.options.mode||"hide"),g=d.options.direction||"vertical";a.effects.save(c,e);c.show();var i=a.effects.createWrapper(c).css({overflow:"hidden"});i=c[0].tagName=="IMG"?i:c;var b={size:g=="vertical"?"height":"width",position:g=="vertical"?"top":"left"};g=g=="vertical"?i.height():i.width();if(h=="show"){i.css(b.size,0);i.css(b.position,
g/2)}var f={};f[b.size]=h=="show"?g:0;f[b.position]=h=="show"?0:g/2;i.animate(f,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){h=="hide"&&c.hide();a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(c[0],arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.drop=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right","opacity"],h=a.effects.setMode(c,d.options.mode||"hide"),g=d.options.direction||"left";a.effects.save(c,e);c.show();a.effects.createWrapper(c);var i=g=="up"||g=="down"?"top":"left";g=g=="up"||g=="left"?"pos":"neg";var b=d.options.distance||(i=="top"?c.outerHeight({margin:true})/2:c.outerWidth({margin:true})/2);if(h=="show")c.css("opacity",0).css(i,g=="pos"?-b:b);var f={opacity:h==
"show"?1:0};f[i]=(h=="show"?g=="pos"?"+=":"-=":g=="pos"?"-=":"+=")+b;c.animate(f,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){h=="hide"&&c.hide();a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.explode=function(d){return this.queue(function(){var c=d.options.pieces?Math.round(Math.sqrt(d.options.pieces)):3,e=d.options.pieces?Math.round(Math.sqrt(d.options.pieces)):3;d.options.mode=d.options.mode=="toggle"?a(this).is(":visible")?"hide":"show":d.options.mode;var h=a(this).show().css("visibility","hidden"),g=h.offset();g.top-=parseInt(h.css("marginTop"),10)||0;g.left-=parseInt(h.css("marginLeft"),10)||0;for(var i=h.outerWidth(true),b=h.outerHeight(true),f=0;f<c;f++)for(var j=
0;j<e;j++)h.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-j*(i/e),top:-f*(b/c)}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:i/e,height:b/c,left:g.left+j*(i/e)+(d.options.mode=="show"?(j-Math.floor(e/2))*(i/e):0),top:g.top+f*(b/c)+(d.options.mode=="show"?(f-Math.floor(c/2))*(b/c):0),opacity:d.options.mode=="show"?0:1}).animate({left:g.left+j*(i/e)+(d.options.mode=="show"?0:(j-Math.floor(e/2))*(i/e)),top:g.top+
f*(b/c)+(d.options.mode=="show"?0:(f-Math.floor(c/2))*(b/c)),opacity:d.options.mode=="show"?1:0},d.duration||500);setTimeout(function(){d.options.mode=="show"?h.css({visibility:"visible"}):h.css({visibility:"visible"}).hide();d.callback&&d.callback.apply(h[0]);h.dequeue();a("div.ui-effects-explode").remove()},d.duration||500)})}})(jQuery);
(function(a){a.effects.fade=function(d){return this.queue(function(){var c=a(this),e=a.effects.setMode(c,d.options.mode||"hide");c.animate({opacity:e},{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){d.callback&&d.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.fold=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right"],h=a.effects.setMode(c,d.options.mode||"hide"),g=d.options.size||15,i=!!d.options.horizFirst,b=d.duration?d.duration/2:a.fx.speeds._default/2;a.effects.save(c,e);c.show();var f=a.effects.createWrapper(c).css({overflow:"hidden"}),j=h=="show"!=i,l=j?["width","height"]:["height","width"];j=j?[f.width(),f.height()]:[f.height(),f.width()];var o=/([0-9]+)%/.exec(g);if(o)g=parseInt(o[1],
10)/100*j[h=="hide"?0:1];if(h=="show")f.css(i?{height:0,width:g}:{height:g,width:0});i={};o={};i[l[0]]=h=="show"?j[0]:g;o[l[1]]=h=="show"?j[1]:0;f.animate(i,b,d.options.easing).animate(o,b,d.options.easing,function(){h=="hide"&&c.hide();a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(c[0],arguments);c.dequeue()})})}})(jQuery);
(function(a){a.effects.highlight=function(d){return this.queue(function(){var c=a(this),e=["backgroundImage","backgroundColor","opacity"],h=a.effects.setMode(c,d.options.mode||"show"),g={backgroundColor:c.css("backgroundColor")};if(h=="hide")g.opacity=0;a.effects.save(c,e);c.show().css({backgroundImage:"none",backgroundColor:d.options.color||"#ffff99"}).animate(g,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){h=="hide"&&c.hide();a.effects.restore(c,e);h=="show"&&!a.support.opacity&&
this.style.removeAttribute("filter");d.callback&&d.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.pulsate=function(d){return this.queue(function(){var c=a(this),e=a.effects.setMode(c,d.options.mode||"show");times=(d.options.times||5)*2-1;duration=d.duration?d.duration/2:a.fx.speeds._default/2;isVisible=c.is(":visible");animateTo=0;if(!isVisible){c.css("opacity",0).show();animateTo=1}if(e=="hide"&&isVisible||e=="show"&&!isVisible)times--;for(e=0;e<times;e++){c.animate({opacity:animateTo},duration,d.options.easing);animateTo=(animateTo+1)%2}c.animate({opacity:animateTo},duration,
d.options.easing,function(){animateTo==0&&c.hide();d.callback&&d.callback.apply(this,arguments)});c.queue("fx",function(){c.dequeue()}).dequeue()})}})(jQuery);
(function(a){a.effects.puff=function(d){return this.queue(function(){var c=a(this),e=a.effects.setMode(c,d.options.mode||"hide"),h=parseInt(d.options.percent,10)||150,g=h/100,i={height:c.height(),width:c.width()};a.extend(d.options,{fade:true,mode:e,percent:e=="hide"?h:100,from:e=="hide"?i:{height:i.height*g,width:i.width*g}});c.effect("scale",d.options,d.duration,d.callback);c.dequeue()})};a.effects.scale=function(d){return this.queue(function(){var c=a(this),e=a.extend(true,{},d.options),h=a.effects.setMode(c,
d.options.mode||"effect"),g=parseInt(d.options.percent,10)||(parseInt(d.options.percent,10)==0?0:h=="hide"?0:100),i=d.options.direction||"both",b=d.options.origin;if(h!="effect"){e.origin=b||["middle","center"];e.restore=true}b={height:c.height(),width:c.width()};c.from=d.options.from||(h=="show"?{height:0,width:0}:b);g={y:i!="horizontal"?g/100:1,x:i!="vertical"?g/100:1};c.to={height:b.height*g.y,width:b.width*g.x};if(d.options.fade){if(h=="show"){c.from.opacity=0;c.to.opacity=1}if(h=="hide"){c.from.opacity=
1;c.to.opacity=0}}e.from=c.from;e.to=c.to;e.mode=h;c.effect("size",e,d.duration,d.callback);c.dequeue()})};a.effects.size=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right","width","height","overflow","opacity"],h=["position","top","bottom","left","right","overflow","opacity"],g=["width","height","overflow"],i=["fontSize"],b=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],f=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],
j=a.effects.setMode(c,d.options.mode||"effect"),l=d.options.restore||false,o=d.options.scale||"both",n=d.options.origin,k={height:c.height(),width:c.width()};c.from=d.options.from||k;c.to=d.options.to||k;if(n){n=a.effects.getBaseline(n,k);c.from.top=(k.height-c.from.height)*n.y;c.from.left=(k.width-c.from.width)*n.x;c.to.top=(k.height-c.to.height)*n.y;c.to.left=(k.width-c.to.width)*n.x}var m={from:{y:c.from.height/k.height,x:c.from.width/k.width},to:{y:c.to.height/k.height,x:c.to.width/k.width}};
if(o=="box"||o=="both"){if(m.from.y!=m.to.y){e=e.concat(b);c.from=a.effects.setTransition(c,b,m.from.y,c.from);c.to=a.effects.setTransition(c,b,m.to.y,c.to)}if(m.from.x!=m.to.x){e=e.concat(f);c.from=a.effects.setTransition(c,f,m.from.x,c.from);c.to=a.effects.setTransition(c,f,m.to.x,c.to)}}if(o=="content"||o=="both")if(m.from.y!=m.to.y){e=e.concat(i);c.from=a.effects.setTransition(c,i,m.from.y,c.from);c.to=a.effects.setTransition(c,i,m.to.y,c.to)}a.effects.save(c,l?e:h);c.show();a.effects.createWrapper(c);
c.css("overflow","hidden").css(c.from);if(o=="content"||o=="both"){b=b.concat(["marginTop","marginBottom"]).concat(i);f=f.concat(["marginLeft","marginRight"]);g=e.concat(b).concat(f);c.find("*[width]").each(function(){child=a(this);l&&a.effects.save(child,g);var p={height:child.height(),width:child.width()};child.from={height:p.height*m.from.y,width:p.width*m.from.x};child.to={height:p.height*m.to.y,width:p.width*m.to.x};if(m.from.y!=m.to.y){child.from=a.effects.setTransition(child,b,m.from.y,child.from);
child.to=a.effects.setTransition(child,b,m.to.y,child.to)}if(m.from.x!=m.to.x){child.from=a.effects.setTransition(child,f,m.from.x,child.from);child.to=a.effects.setTransition(child,f,m.to.x,child.to)}child.css(child.from);child.animate(child.to,d.duration,d.options.easing,function(){l&&a.effects.restore(child,g)})})}c.animate(c.to,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){c.to.opacity===0&&c.css("opacity",c.from.opacity);j=="hide"&&c.hide();a.effects.restore(c,
l?e:h);a.effects.removeWrapper(c);d.callback&&d.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.shake=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right"];a.effects.setMode(c,d.options.mode||"effect");var h=d.options.direction||"left",g=d.options.distance||20,i=d.options.times||3,b=d.duration||d.options.duration||140;a.effects.save(c,e);c.show();a.effects.createWrapper(c);var f=h=="up"||h=="down"?"top":"left",j=h=="up"||h=="left"?"pos":"neg";h={};var l={},o={};h[f]=(j=="pos"?"-=":"+=")+g;l[f]=(j=="pos"?"+=":"-=")+g*2;o[f]=
(j=="pos"?"-=":"+=")+g*2;c.animate(h,b,d.options.easing);for(g=1;g<i;g++)c.animate(l,b,d.options.easing).animate(o,b,d.options.easing);c.animate(l,b,d.options.easing).animate(h,b/2,d.options.easing,function(){a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(this,arguments)});c.queue("fx",function(){c.dequeue()});c.dequeue()})}})(jQuery);
(function(a){a.effects.slide=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right"],h=a.effects.setMode(c,d.options.mode||"show"),g=d.options.direction||"left";a.effects.save(c,e);c.show();a.effects.createWrapper(c).css({overflow:"hidden"});var i=g=="up"||g=="down"?"top":"left";g=g=="up"||g=="left"?"pos":"neg";var b=d.options.distance||(i=="top"?c.outerHeight({margin:true}):c.outerWidth({margin:true}));if(h=="show")c.css(i,g=="pos"?isNaN(b)?"-"+b:-b:b);
var f={};f[i]=(h=="show"?g=="pos"?"+=":"-=":g=="pos"?"-=":"+=")+b;c.animate(f,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){h=="hide"&&c.hide();a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.transfer=function(d){return this.queue(function(){var c=a(this),e=a(d.options.to),h=e.offset();e={top:h.top,left:h.left,height:e.innerHeight(),width:e.innerWidth()};h=c.offset();var g=a('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(d.options.className).css({top:h.top,left:h.left,height:c.innerHeight(),width:c.innerWidth(),position:"absolute"}).animate(e,d.duration,d.options.easing,function(){g.remove();d.callback&&d.callback.apply(c[0],arguments);
c.dequeue()})})}})(jQuery);
(function(a){a.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:true,clearStyle:false,collapsible:false,event:"click",fillSpace:false,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var d=this,c=d.options;d.running=0;d.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix");d.headers=
d.element.find(c.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){c.disabled||a(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){c.disabled||a(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){c.disabled||a(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){c.disabled||a(this).removeClass("ui-state-focus")});d.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");
if(c.navigation){var e=d.element.find("a").filter(c.navigationFilter).eq(0);if(e.length){var h=e.closest(".ui-accordion-header");d.active=h.length?h:e.closest(".ui-accordion-content").prev()}}d.active=d._findActive(d.active||c.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top");d.active.next().addClass("ui-accordion-content-active");d._createIcons();d.resize();d.element.attr("role","tablist");d.headers.attr("role","tab").bind("keydown.accordion",
function(g){return d._keydown(g)}).next().attr("role","tabpanel");d.headers.not(d.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide();d.active.length?d.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}):d.headers.eq(0).attr("tabIndex",0);a.browser.safari||d.headers.find("a").attr("tabIndex",-1);c.event&&d.headers.bind(c.event.split(" ").join(".accordion ")+".accordion",function(g){d._clickHandler.call(d,g,this);g.preventDefault()})},_createIcons:function(){var d=
this.options;if(d.icons){a("<span></span>").addClass("ui-icon "+d.icons.header).prependTo(this.headers);this.active.children(".ui-icon").toggleClass(d.icons.header).toggleClass(d.icons.headerSelected);this.element.addClass("ui-accordion-icons")}},_destroyIcons:function(){this.headers.children(".ui-icon").remove();this.element.removeClass("ui-accordion-icons")},destroy:function(){var d=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex");
this.headers.find("a").removeAttr("tabIndex");this._destroyIcons();var c=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");if(d.autoHeight||d.fillHeight)c.css("height","");return a.Widget.prototype.destroy.call(this)},_setOption:function(d,c){a.Widget.prototype._setOption.apply(this,arguments);d=="active"&&this.activate(c);if(d=="icons"){this._destroyIcons();
c&&this._createIcons()}if(d=="disabled")this.headers.add(this.headers.next())[c?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")},_keydown:function(d){if(!(this.options.disabled||d.altKey||d.ctrlKey)){var c=a.ui.keyCode,e=this.headers.length,h=this.headers.index(d.target),g=false;switch(d.keyCode){case c.RIGHT:case c.DOWN:g=this.headers[(h+1)%e];break;case c.LEFT:case c.UP:g=this.headers[(h-1+e)%e];break;case c.SPACE:case c.ENTER:this._clickHandler({target:d.target},d.target);
d.preventDefault()}if(g){a(d.target).attr("tabIndex",-1);a(g).attr("tabIndex",0);g.focus();return false}return true}},resize:function(){var d=this.options,c;if(d.fillSpace){if(a.browser.msie){var e=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}c=this.element.parent().height();a.browser.msie&&this.element.parent().css("overflow",e);this.headers.each(function(){c-=a(this).outerHeight(true)});this.headers.next().each(function(){a(this).height(Math.max(0,c-a(this).innerHeight()+
a(this).height()))}).css("overflow","auto")}else if(d.autoHeight){c=0;this.headers.next().each(function(){c=Math.max(c,a(this).height("").height())}).height(c)}return this},activate:function(d){this.options.active=d;d=this._findActive(d)[0];this._clickHandler({target:d},d);return this},_findActive:function(d){return d?typeof d==="number"?this.headers.filter(":eq("+d+")"):this.headers.not(this.headers.not(d)):d===false?a([]):this.headers.filter(":eq(0)")},_clickHandler:function(d,c){var e=this.options;
if(!e.disabled)if(d.target){d=a(d.currentTarget||c);c=d[0]===this.active[0];e.active=e.collapsible&&c?false:this.headers.index(d);if(!(this.running||!e.collapsible&&c)){var h=this.active;f=d.next();i=this.active.next();b={options:e,newHeader:c&&e.collapsible?a([]):d,oldHeader:this.active,newContent:c&&e.collapsible?a([]):f,oldContent:i};var g=this.headers.index(this.active[0])>this.headers.index(d[0]);this.active=c?a([]):d;this._toggle(f,i,b,c,g);h.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(e.icons.headerSelected).addClass(e.icons.header);
if(!c){d.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(e.icons.header).addClass(e.icons.headerSelected);d.next().addClass("ui-accordion-content-active")}}}else if(e.collapsible){this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(e.icons.headerSelected).addClass(e.icons.header);this.active.next().addClass("ui-accordion-content-active");var i=this.active.next(),
b={options:e,newHeader:a([]),oldHeader:e.active,newContent:a([]),oldContent:i},f=this.active=a([]);this._toggle(f,i,b)}},_toggle:function(d,c,e,h,g){var i=this,b=i.options;i.toShow=d;i.toHide=c;i.data=e;var f=function(){if(i)return i._completed.apply(i,arguments)};i._trigger("changestart",null,i.data);i.running=c.size()===0?d.size():c.size();if(b.animated){e={};e=b.collapsible&&h?{toShow:a([]),toHide:c,complete:f,down:g,autoHeight:b.autoHeight||b.fillSpace}:{toShow:d,toHide:c,complete:f,down:g,autoHeight:b.autoHeight||
b.fillSpace};if(!b.proxied)b.proxied=b.animated;if(!b.proxiedDuration)b.proxiedDuration=b.duration;b.animated=a.isFunction(b.proxied)?b.proxied(e):b.proxied;b.duration=a.isFunction(b.proxiedDuration)?b.proxiedDuration(e):b.proxiedDuration;h=a.ui.accordion.animations;var j=b.duration,l=b.animated;if(l&&!h[l]&&!a.easing[l])l="slide";h[l]||(h[l]=function(o){this.slide(o,{easing:l,duration:j||700})});h[l](e)}else{if(b.collapsible&&h)d.toggle();else{c.hide();d.show()}f(true)}c.prev().attr({"aria-expanded":"false",
"aria-selected":"false",tabIndex:-1}).blur();d.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus()},_completed:function(d){this.running=d?0:--this.running;if(!this.running){this.options.clearStyle&&this.toShow.add(this.toHide).css({height:"",overflow:""});this.toHide.removeClass("ui-accordion-content-active");if(this.toHide.length)this.toHide.parent()[0].className=this.toHide.parent()[0].className;this._trigger("change",null,this.data)}}});a.extend(a.ui.accordion,{version:"1.8.16",
animations:{slide:function(d,c){d=a.extend({easing:"swing",duration:300},d,c);if(d.toHide.size())if(d.toShow.size()){var e=d.toShow.css("overflow"),h=0,g={},i={},b;c=d.toShow;b=c[0].style.width;c.width(parseInt(c.parent().width(),10)-parseInt(c.css("paddingLeft"),10)-parseInt(c.css("paddingRight"),10)-(parseInt(c.css("borderLeftWidth"),10)||0)-(parseInt(c.css("borderRightWidth"),10)||0));a.each(["height","paddingTop","paddingBottom"],function(f,j){i[j]="hide";f=(""+a.css(d.toShow[0],j)).match(/^([\d+-.]+)(.*)$/);
g[j]={value:f[1],unit:f[2]||"px"}});d.toShow.css({height:0,overflow:"hidden"}).show();d.toHide.filter(":hidden").each(d.complete).end().filter(":visible").animate(i,{step:function(f,j){if(j.prop=="height")h=j.end-j.start===0?0:(j.now-j.start)/(j.end-j.start);d.toShow[0].style[j.prop]=h*g[j.prop].value+g[j.prop].unit},duration:d.duration,easing:d.easing,complete:function(){d.autoHeight||d.toShow.css("height","");d.toShow.css({width:b,overflow:e});d.complete()}})}else d.toHide.animate({height:"hide",
paddingTop:"hide",paddingBottom:"hide"},d);else d.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},d)},bounceslide:function(d){this.slide(d,{easing:d.down?"easeOutBounce":"swing",duration:d.down?1E3:200})}}})})(jQuery);
(function(a){var d=0;a.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var c=this,e=this.element[0].ownerDocument,h;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(g){if(!(c.options.disabled||c.element.propAttr("readOnly"))){h=
false;var i=a.ui.keyCode;switch(g.keyCode){case i.PAGE_UP:c._move("previousPage",g);break;case i.PAGE_DOWN:c._move("nextPage",g);break;case i.UP:c._move("previous",g);g.preventDefault();break;case i.DOWN:c._move("next",g);g.preventDefault();break;case i.ENTER:case i.NUMPAD_ENTER:if(c.menu.active){h=true;g.preventDefault()}case i.TAB:if(!c.menu.active)return;c.menu.select(g);break;case i.ESCAPE:c.element.val(c.term);c.close(g);break;default:clearTimeout(c.searching);c.searching=setTimeout(function(){if(c.term!=
c.element.val()){c.selectedItem=null;c.search(null,g)}},c.options.delay);break}}}).bind("keypress.autocomplete",function(g){if(h){h=false;g.preventDefault()}}).bind("focus.autocomplete",function(){if(!c.options.disabled){c.selectedItem=null;c.previous=c.element.val()}}).bind("blur.autocomplete",function(g){if(!c.options.disabled){clearTimeout(c.searching);c.closing=setTimeout(function(){c.close(g);c._change(g)},150)}});this._initSource();this.response=function(){return c._response.apply(c,arguments)};
this.menu=a("<ul></ul>").addClass("ui-autocomplete").appendTo(a(this.options.appendTo||"body",e)[0]).mousedown(function(g){var i=c.menu.element[0];a(g.target).closest(".ui-menu-item").length||setTimeout(function(){a(document).one("mousedown",function(b){b.target!==c.element[0]&&b.target!==i&&!a.ui.contains(i,b.target)&&c.close()})},1);setTimeout(function(){clearTimeout(c.closing)},13)}).menu({focus:function(g,i){i=i.item.data("item.autocomplete");false!==c._trigger("focus",g,{item:i})&&/^key/.test(g.originalEvent.type)&&
c.element.val(i.value)},selected:function(g,i){var b=i.item.data("item.autocomplete"),f=c.previous;if(c.element[0]!==e.activeElement){c.element.focus();c.previous=f;setTimeout(function(){c.previous=f;c.selectedItem=b},1)}false!==c._trigger("select",g,{item:b})&&c.element.val(b.value);c.term=c.element.val();c.close(g);c.selectedItem=b},blur:function(){c.menu.element.is(":visible")&&c.element.val()!==c.term&&c.element.val(c.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");
a.fn.bgiframe&&this.menu.element.bgiframe()},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");this.menu.element.remove();a.Widget.prototype.destroy.call(this)},_setOption:function(c,e){a.Widget.prototype._setOption.apply(this,arguments);c==="source"&&this._initSource();if(c==="appendTo")this.menu.element.appendTo(a(e||"body",this.element[0].ownerDocument)[0]);c==="disabled"&&
e&&this.xhr&&this.xhr.abort()},_initSource:function(){var c=this,e,h;if(a.isArray(this.options.source)){e=this.options.source;this.source=function(g,i){i(a.ui.autocomplete.filter(e,g.term))}}else if(typeof this.options.source==="string"){h=this.options.source;this.source=function(g,i){c.xhr&&c.xhr.abort();c.xhr=a.ajax({url:h,data:g,dataType:"json",autocompleteRequest:++d,success:function(b){this.autocompleteRequest===d&&i(b)},error:function(){this.autocompleteRequest===d&&i([])}})}}else this.source=
this.options.source},search:function(c,e){c=c!=null?c:this.element.val();this.term=this.element.val();if(c.length<this.options.minLength)return this.close(e);clearTimeout(this.closing);if(this._trigger("search",e)!==false)return this._search(c)},_search:function(c){this.pending++;this.element.addClass("ui-autocomplete-loading");this.source({term:c},this.response)},_response:function(c){if(!this.options.disabled&&c&&c.length){c=this._normalize(c);this._suggest(c);this._trigger("open")}else this.close();
this.pending--;this.pending||this.element.removeClass("ui-autocomplete-loading")},close:function(c){clearTimeout(this.closing);if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.deactivate();this._trigger("close",c)}},_change:function(c){this.previous!==this.element.val()&&this._trigger("change",c,{item:this.selectedItem})},_normalize:function(c){if(c.length&&c[0].label&&c[0].value)return c;return a.map(c,function(e){if(typeof e==="string")return{label:e,value:e};return a.extend({label:e.label||
e.value,value:e.value||e.label},e)})},_suggest:function(c){var e=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(e,c);this.menu.deactivate();this.menu.refresh();e.show();this._resizeMenu();e.position(a.extend({of:this.element},this.options.position));this.options.autoFocus&&this.menu.next(new a.Event("mouseover"))},_resizeMenu:function(){var c=this.menu.element;c.outerWidth(Math.max(c.width("").outerWidth(),this.element.outerWidth()))},_renderMenu:function(c,e){var h=this;
a.each(e,function(g,i){h._renderItem(c,i)})},_renderItem:function(c,e){return a("<li></li>").data("item.autocomplete",e).append(a("<a></a>").text(e.label)).appendTo(c)},_move:function(c,e){if(this.menu.element.is(":visible"))if(this.menu.first()&&/^previous/.test(c)||this.menu.last()&&/^next/.test(c)){this.element.val(this.term);this.menu.deactivate()}else this.menu[c](e);else this.search(null,e)},widget:function(){return this.menu.element}});a.extend(a.ui.autocomplete,{escapeRegex:function(c){return c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,
"\\$&")},filter:function(c,e){var h=new RegExp(a.ui.autocomplete.escapeRegex(e),"i");return a.grep(c,function(g){return h.test(g.label||g.value||g)})}})})(jQuery);
(function(a){a.widget("ui.menu",{_create:function(){var d=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(c){if(a(c.target).closest(".ui-menu-item a").length){c.preventDefault();d.select(c)}});this.refresh()},refresh:function(){var d=this;this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem").children("a").addClass("ui-corner-all").attr("tabindex",
-1).mouseenter(function(c){d.activate(c,a(this).parent())}).mouseleave(function(){d.deactivate()})},activate:function(d,c){this.deactivate();if(this.hasScroll()){var e=c.offset().top-this.element.offset().top,h=this.element.scrollTop(),g=this.element.height();if(e<0)this.element.scrollTop(h+e);else e>=g&&this.element.scrollTop(h+e-g+c.height())}this.active=c.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",d,{item:c})},deactivate:function(){if(this.active){this.active.children("a").removeClass("ui-state-hover").removeAttr("id");
this._trigger("blur");this.active=null}},next:function(d){this.move("next",".ui-menu-item:first",d)},previous:function(d){this.move("prev",".ui-menu-item:last",d)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(d,c,e){if(this.active){d=this.active[d+"All"](".ui-menu-item").eq(0);d.length?this.activate(e,d):this.activate(e,this.element.children(c))}else this.activate(e,
this.element.children(c))},nextPage:function(d){if(this.hasScroll())if(!this.active||this.last())this.activate(d,this.element.children(".ui-menu-item:first"));else{var c=this.active.offset().top,e=this.element.height(),h=this.element.children(".ui-menu-item").filter(function(){var g=a(this).offset().top-c-e+a(this).height();return g<10&&g>-10});h.length||(h=this.element.children(".ui-menu-item:last"));this.activate(d,h)}else this.activate(d,this.element.children(".ui-menu-item").filter(!this.active||
this.last()?":first":":last"))},previousPage:function(d){if(this.hasScroll())if(!this.active||this.first())this.activate(d,this.element.children(".ui-menu-item:last"));else{var c=this.active.offset().top,e=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var h=a(this).offset().top-c+e-a(this).height();return h<10&&h>-10});result.length||(result=this.element.children(".ui-menu-item:first"));this.activate(d,result)}else this.activate(d,this.element.children(".ui-menu-item").filter(!this.active||
this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[a.fn.prop?"prop":"attr"]("scrollHeight")},select:function(d){this._trigger("selected",d,{item:this.active})}})})(jQuery);
(function(a){var d,c,e,h,g=function(){var b=a(this).find(":ui-button");setTimeout(function(){b.button("refresh")},1)},i=function(b){var f=b.name,j=b.form,l=a([]);if(f)l=j?a(j).find("[name='"+f+"']"):a("[name='"+f+"']",b.ownerDocument).filter(function(){return!this.form});return l};a.widget("ui.button",{options:{disabled:null,text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",g);if(typeof this.options.disabled!==
"boolean")this.options.disabled=this.element.propAttr("disabled");this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var b=this,f=this.options,j=this.type==="checkbox"||this.type==="radio",l="ui-state-hover"+(!j?" ui-state-active":"");if(f.label===null)f.label=this.buttonElement.html();if(this.element.is(":disabled"))f.disabled=true;this.buttonElement.addClass("ui-button ui-widget ui-state-default ui-corner-all").attr("role","button").bind("mouseenter.button",function(){if(!f.disabled){a(this).addClass("ui-state-hover");
this===d&&a(this).addClass("ui-state-active")}}).bind("mouseleave.button",function(){f.disabled||a(this).removeClass(l)}).bind("click.button",function(o){if(f.disabled){o.preventDefault();o.stopImmediatePropagation()}});this.element.bind("focus.button",function(){b.buttonElement.addClass("ui-state-focus")}).bind("blur.button",function(){b.buttonElement.removeClass("ui-state-focus")});if(j){this.element.bind("change.button",function(){h||b.refresh()});this.buttonElement.bind("mousedown.button",function(o){if(!f.disabled){h=
false;c=o.pageX;e=o.pageY}}).bind("mouseup.button",function(o){if(!f.disabled)if(c!==o.pageX||e!==o.pageY)h=true})}if(this.type==="checkbox")this.buttonElement.bind("click.button",function(){if(f.disabled||h)return false;a(this).toggleClass("ui-state-active");b.buttonElement.attr("aria-pressed",b.element[0].checked)});else if(this.type==="radio")this.buttonElement.bind("click.button",function(){if(f.disabled||h)return false;a(this).addClass("ui-state-active");b.buttonElement.attr("aria-pressed","true");
var o=b.element[0];i(o).not(o).map(function(){return a(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")});else{this.buttonElement.bind("mousedown.button",function(){if(f.disabled)return false;a(this).addClass("ui-state-active");d=this;a(document).one("mouseup",function(){d=null})}).bind("mouseup.button",function(){if(f.disabled)return false;a(this).removeClass("ui-state-active")}).bind("keydown.button",function(o){if(f.disabled)return false;if(o.keyCode==a.ui.keyCode.SPACE||
o.keyCode==a.ui.keyCode.ENTER)a(this).addClass("ui-state-active")}).bind("keyup.button",function(){a(this).removeClass("ui-state-active")});this.buttonElement.is("a")&&this.buttonElement.keyup(function(o){o.keyCode===a.ui.keyCode.SPACE&&a(this).click()})}this._setOption("disabled",f.disabled);this._resetButton()},_determineButtonType:function(){this.type=this.element.is(":checkbox")?"checkbox":this.element.is(":radio")?"radio":this.element.is("input")?"input":"button";if(this.type==="checkbox"||this.type===
"radio"){var b=this.element.parents().filter(":last"),f="label[for='"+this.element.attr("id")+"']";this.buttonElement=b.find(f);if(!this.buttonElement.length){b=b.length?b.siblings():this.element.siblings();this.buttonElement=b.filter(f);if(!this.buttonElement.length)this.buttonElement=b.find(f)}this.element.addClass("ui-helper-hidden-accessible");(b=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active");this.buttonElement.attr("aria-pressed",b)}else this.buttonElement=this.element},
widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-state-hover ui-state-active  ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only").removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());this.hasTitle||this.buttonElement.removeAttr("title");
a.Widget.prototype.destroy.call(this)},_setOption:function(b,f){a.Widget.prototype._setOption.apply(this,arguments);if(b==="disabled")f?this.element.propAttr("disabled",true):this.element.propAttr("disabled",false);else this._resetButton()},refresh:function(){var b=this.element.is(":disabled");b!==this.options.disabled&&this._setOption("disabled",b);if(this.type==="radio")i(this.element[0]).each(function(){a(this).is(":checked")?a(this).button("widget").addClass("ui-state-active").attr("aria-pressed",
"true"):a(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")});else if(this.type==="checkbox")this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false")},_resetButton:function(){if(this.type==="input")this.options.label&&this.element.val(this.options.label);else{var b=this.buttonElement.removeClass("ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only"),
f=a("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(b.empty()).text(),j=this.options.icons,l=j.primary&&j.secondary,o=[];if(j.primary||j.secondary){if(this.options.text)o.push("ui-button-text-icon"+(l?"s":j.primary?"-primary":"-secondary"));j.primary&&b.prepend("<span class='ui-button-icon-primary ui-icon "+j.primary+"'></span>");j.secondary&&b.append("<span class='ui-button-icon-secondary ui-icon "+j.secondary+"'></span>");if(!this.options.text){o.push(l?"ui-button-icons-only":
"ui-button-icon-only");this.hasTitle||b.attr("title",f)}}else o.push("ui-button-text-only");b.addClass(o.join(" "))}}});a.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(b,f){b==="disabled"&&this.buttons.button("option",b,f);a.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){var b=this.element.css("direction")===
"ltr";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(b?"ui-corner-left":"ui-corner-right").end().filter(":last").addClass(b?"ui-corner-right":"ui-corner-left").end().end()},destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");
a.Widget.prototype.destroy.call(this)}})})(jQuery);
(function(a,d){function c(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._inDialog=this._datepickerShowing=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass=
"ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su",
"Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:"c-10:c+10",showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",
minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};a.extend(this._defaults,this.regional[""]);this.dpDiv=e(a('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function e(b){return b.bind("mouseout",
function(f){f=a(f.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");f.length&&f.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(f){f=a(f.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");if(!(a.datepicker._isDisabledDatepicker(i.inline?b.parent()[0]:i.input[0])||!f.length)){f.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");
f.addClass("ui-state-hover");f.hasClass("ui-datepicker-prev")&&f.addClass("ui-datepicker-prev-hover");f.hasClass("ui-datepicker-next")&&f.addClass("ui-datepicker-next-hover")}})}function h(b,f){a.extend(b,f);for(var j in f)if(f[j]==null||f[j]==d)b[j]=f[j];return b}a.extend(a.ui,{datepicker:{version:"1.8.16"}});var g=(new Date).getTime(),i;a.extend(c.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},
setDefaults:function(b){h(this._defaults,b||{});return this},_attachDatepicker:function(b,f){var j=null;for(var l in this._defaults){var o=b.getAttribute("date:"+l);if(o){j=j||{};try{j[l]=eval(o)}catch(n){j[l]=o}}}l=b.nodeName.toLowerCase();o=l=="div"||l=="span";if(!b.id){this.uuid+=1;b.id="dp"+this.uuid}var k=this._newInst(a(b),o);k.settings=a.extend({},f||{},j||{});if(l=="input")this._connectDatepicker(b,k);else o&&this._inlineDatepicker(b,k)},_newInst:function(b,f){return{id:b[0].id.replace(/([^A-Za-z0-9_-])/g,
"\\\\$1"),input:b,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:f,dpDiv:!f?this.dpDiv:e(a('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}},_connectDatepicker:function(b,f){var j=a(b);f.append=a([]);f.trigger=a([]);if(!j.hasClass(this.markerClassName)){this._attachments(j,f);j.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",
function(l,o,n){f.settings[o]=n}).bind("getData.datepicker",function(l,o){return this._get(f,o)});this._autoSize(f);a.data(b,"datepicker",f);f.settings.disabled&&this._disableDatepicker(b)}},_attachments:function(b,f){var j=this._get(f,"appendText"),l=this._get(f,"isRTL");f.append&&f.append.remove();if(j){f.append=a('<span class="'+this._appendClass+'">'+j+"</span>");b[l?"before":"after"](f.append)}b.unbind("focus",this._showDatepicker);f.trigger&&f.trigger.remove();j=this._get(f,"showOn");if(j==
"focus"||j=="both")b.focus(this._showDatepicker);if(j=="button"||j=="both"){j=this._get(f,"buttonText");var o=this._get(f,"buttonImage");f.trigger=a(this._get(f,"buttonImageOnly")?a("<img/>").addClass(this._triggerClass).attr({src:o,alt:j,title:j}):a('<button type="button"></button>').addClass(this._triggerClass).html(o==""?j:a("<img/>").attr({src:o,alt:j,title:j})));b[l?"before":"after"](f.trigger);f.trigger.click(function(){a.datepicker._datepickerShowing&&a.datepicker._lastInput==b[0]?a.datepicker._hideDatepicker():
a.datepicker._showDatepicker(b[0]);return false})}},_autoSize:function(b){if(this._get(b,"autoSize")&&!b.inline){var f=new Date(2009,11,20),j=this._get(b,"dateFormat");if(j.match(/[DM]/)){var l=function(o){for(var n=0,k=0,m=0;m<o.length;m++)if(o[m].length>n){n=o[m].length;k=m}return k};f.setMonth(l(this._get(b,j.match(/MM/)?"monthNames":"monthNamesShort")));f.setDate(l(this._get(b,j.match(/DD/)?"dayNames":"dayNamesShort"))+20-f.getDay())}b.input.attr("size",this._formatDate(b,f).length)}},_inlineDatepicker:function(b,
f){var j=a(b);if(!j.hasClass(this.markerClassName)){j.addClass(this.markerClassName).append(f.dpDiv).bind("setData.datepicker",function(l,o,n){f.settings[o]=n}).bind("getData.datepicker",function(l,o){return this._get(f,o)});a.data(b,"datepicker",f);this._setDate(f,this._getDefaultDate(f),true);this._updateDatepicker(f);this._updateAlternate(f);f.settings.disabled&&this._disableDatepicker(b);f.dpDiv.css("display","block")}},_dialogDatepicker:function(b,f,j,l,o){b=this._dialogInst;if(!b){this.uuid+=
1;this._dialogInput=a('<input type="text" id="'+("dp"+this.uuid)+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>');this._dialogInput.keydown(this._doKeyDown);a("body").append(this._dialogInput);b=this._dialogInst=this._newInst(this._dialogInput,false);b.settings={};a.data(this._dialogInput[0],"datepicker",b)}h(b.settings,l||{});f=f&&f.constructor==Date?this._formatDate(b,f):f;this._dialogInput.val(f);this._pos=o?o.length?o:[o.pageX,o.pageY]:null;if(!this._pos)this._pos=[document.documentElement.clientWidth/
2-100+(document.documentElement.scrollLeft||document.body.scrollLeft),document.documentElement.clientHeight/2-150+(document.documentElement.scrollTop||document.body.scrollTop)];this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px");b.settings.onSelect=j;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);a.blockUI&&a.blockUI(this.dpDiv);a.data(this._dialogInput[0],"datepicker",b);return this},_destroyDatepicker:function(b){var f=
a(b),j=a.data(b,"datepicker");if(f.hasClass(this.markerClassName)){var l=b.nodeName.toLowerCase();a.removeData(b,"datepicker");if(l=="input"){j.append.remove();j.trigger.remove();f.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)}else if(l=="div"||l=="span")f.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(b){var f=a(b),j=a.data(b,"datepicker");if(f.hasClass(this.markerClassName)){var l=
b.nodeName.toLowerCase();if(l=="input"){b.disabled=false;j.trigger.filter("button").each(function(){this.disabled=false}).end().filter("img").css({opacity:"1.0",cursor:""})}else if(l=="div"||l=="span"){f=f.children("."+this._inlineClass);f.children().removeClass("ui-state-disabled");f.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")}this._disabledInputs=a.map(this._disabledInputs,function(o){return o==b?null:o})}},_disableDatepicker:function(b){var f=a(b),j=a.data(b,
"datepicker");if(f.hasClass(this.markerClassName)){var l=b.nodeName.toLowerCase();if(l=="input"){b.disabled=true;j.trigger.filter("button").each(function(){this.disabled=true}).end().filter("img").css({opacity:"0.5",cursor:"default"})}else if(l=="div"||l=="span"){f=f.children("."+this._inlineClass);f.children().addClass("ui-state-disabled");f.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")}this._disabledInputs=a.map(this._disabledInputs,function(o){return o==
b?null:o});this._disabledInputs[this._disabledInputs.length]=b}},_isDisabledDatepicker:function(b){if(!b)return false;for(var f=0;f<this._disabledInputs.length;f++)if(this._disabledInputs[f]==b)return true;return false},_getInst:function(b){try{return a.data(b,"datepicker")}catch(f){throw"Missing instance data for this datepicker";}},_optionDatepicker:function(b,f,j){var l=this._getInst(b);if(arguments.length==2&&typeof f=="string")return f=="defaults"?a.extend({},a.datepicker._defaults):l?f=="all"?
a.extend({},l.settings):this._get(l,f):null;var o=f||{};if(typeof f=="string"){o={};o[f]=j}if(l){this._curInst==l&&this._hideDatepicker();var n=this._getDateDatepicker(b,true),k=this._getMinMaxDate(l,"min"),m=this._getMinMaxDate(l,"max");h(l.settings,o);if(k!==null&&o.dateFormat!==d&&o.minDate===d)l.settings.minDate=this._formatDate(l,k);if(m!==null&&o.dateFormat!==d&&o.maxDate===d)l.settings.maxDate=this._formatDate(l,m);this._attachments(a(b),l);this._autoSize(l);this._setDate(l,n);this._updateAlternate(l);
this._updateDatepicker(l)}},_changeDatepicker:function(b,f,j){this._optionDatepicker(b,f,j)},_refreshDatepicker:function(b){(b=this._getInst(b))&&this._updateDatepicker(b)},_setDateDatepicker:function(b,f){if(b=this._getInst(b)){this._setDate(b,f);this._updateDatepicker(b);this._updateAlternate(b)}},_getDateDatepicker:function(b,f){(b=this._getInst(b))&&!b.inline&&this._setDateFromField(b,f);return b?this._getDate(b):null},_doKeyDown:function(b){var f=a.datepicker._getInst(b.target),j=true,l=f.dpDiv.is(".ui-datepicker-rtl");
f._keyEvent=true;if(a.datepicker._datepickerShowing)switch(b.keyCode){case 9:a.datepicker._hideDatepicker();j=false;break;case 13:j=a("td."+a.datepicker._dayOverClass+":not(."+a.datepicker._currentClass+")",f.dpDiv);j[0]&&a.datepicker._selectDay(b.target,f.selectedMonth,f.selectedYear,j[0]);if(b=a.datepicker._get(f,"onSelect")){j=a.datepicker._formatDate(f);b.apply(f.input?f.input[0]:null,[j,f])}else a.datepicker._hideDatepicker();return false;case 27:a.datepicker._hideDatepicker();break;case 33:a.datepicker._adjustDate(b.target,
b.ctrlKey?-a.datepicker._get(f,"stepBigMonths"):-a.datepicker._get(f,"stepMonths"),"M");break;case 34:a.datepicker._adjustDate(b.target,b.ctrlKey?+a.datepicker._get(f,"stepBigMonths"):+a.datepicker._get(f,"stepMonths"),"M");break;case 35:if(b.ctrlKey||b.metaKey)a.datepicker._clearDate(b.target);j=b.ctrlKey||b.metaKey;break;case 36:if(b.ctrlKey||b.metaKey)a.datepicker._gotoToday(b.target);j=b.ctrlKey||b.metaKey;break;case 37:if(b.ctrlKey||b.metaKey)a.datepicker._adjustDate(b.target,l?+1:-1,"D");j=
b.ctrlKey||b.metaKey;if(b.originalEvent.altKey)a.datepicker._adjustDate(b.target,b.ctrlKey?-a.datepicker._get(f,"stepBigMonths"):-a.datepicker._get(f,"stepMonths"),"M");break;case 38:if(b.ctrlKey||b.metaKey)a.datepicker._adjustDate(b.target,-7,"D");j=b.ctrlKey||b.metaKey;break;case 39:if(b.ctrlKey||b.metaKey)a.datepicker._adjustDate(b.target,l?-1:+1,"D");j=b.ctrlKey||b.metaKey;if(b.originalEvent.altKey)a.datepicker._adjustDate(b.target,b.ctrlKey?+a.datepicker._get(f,"stepBigMonths"):+a.datepicker._get(f,
"stepMonths"),"M");break;case 40:if(b.ctrlKey||b.metaKey)a.datepicker._adjustDate(b.target,+7,"D");j=b.ctrlKey||b.metaKey;break;default:j=false}else if(b.keyCode==36&&b.ctrlKey)a.datepicker._showDatepicker(this);else j=false;if(j){b.preventDefault();b.stopPropagation()}},_doKeyPress:function(b){var f=a.datepicker._getInst(b.target);if(a.datepicker._get(f,"constrainInput")){f=a.datepicker._possibleChars(a.datepicker._get(f,"dateFormat"));var j=String.fromCharCode(b.charCode==d?b.keyCode:b.charCode);
return b.ctrlKey||b.metaKey||j<" "||!f||f.indexOf(j)>-1}},_doKeyUp:function(b){b=a.datepicker._getInst(b.target);if(b.input.val()!=b.lastVal)try{if(a.datepicker.parseDate(a.datepicker._get(b,"dateFormat"),b.input?b.input.val():null,a.datepicker._getFormatConfig(b))){a.datepicker._setDateFromField(b);a.datepicker._updateAlternate(b);a.datepicker._updateDatepicker(b)}}catch(f){a.datepicker.log(f)}return true},_showDatepicker:function(b){b=b.target||b;if(b.nodeName.toLowerCase()!="input")b=a("input",
b.parentNode)[0];if(!(a.datepicker._isDisabledDatepicker(b)||a.datepicker._lastInput==b)){var f=a.datepicker._getInst(b);if(a.datepicker._curInst&&a.datepicker._curInst!=f){a.datepicker._datepickerShowing&&a.datepicker._triggerOnClose(a.datepicker._curInst);a.datepicker._curInst.dpDiv.stop(true,true)}var j=a.datepicker._get(f,"beforeShow");j=j?j.apply(b,[b,f]):{};if(j!==false){h(f.settings,j);f.lastVal=null;a.datepicker._lastInput=b;a.datepicker._setDateFromField(f);if(a.datepicker._inDialog)b.value=
"";if(!a.datepicker._pos){a.datepicker._pos=a.datepicker._findPos(b);a.datepicker._pos[1]+=b.offsetHeight}var l=false;a(b).parents().each(function(){l|=a(this).css("position")=="fixed";return!l});if(l&&a.browser.opera){a.datepicker._pos[0]-=document.documentElement.scrollLeft;a.datepicker._pos[1]-=document.documentElement.scrollTop}j={left:a.datepicker._pos[0],top:a.datepicker._pos[1]};a.datepicker._pos=null;f.dpDiv.empty();f.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});a.datepicker._updateDatepicker(f);
j=a.datepicker._checkOffset(f,j,l);f.dpDiv.css({position:a.datepicker._inDialog&&a.blockUI?"static":l?"fixed":"absolute",display:"none",left:j.left+"px",top:j.top+"px"});if(!f.inline){j=a.datepicker._get(f,"showAnim");var o=a.datepicker._get(f,"duration"),n=function(){var k=f.dpDiv.find("iframe.ui-datepicker-cover");if(k.length){var m=a.datepicker._getBorders(f.dpDiv);k.css({left:-m[0],top:-m[1],width:f.dpDiv.outerWidth(),height:f.dpDiv.outerHeight()})}};f.dpDiv.zIndex(a(b).zIndex()+1);a.datepicker._datepickerShowing=
true;a.effects&&a.effects[j]?f.dpDiv.show(j,a.datepicker._get(f,"showOptions"),o,n):f.dpDiv[j||"show"](j?o:null,n);if(!j||!o)n();f.input.is(":visible")&&!f.input.is(":disabled")&&f.input.focus();a.datepicker._curInst=f}}}},_updateDatepicker:function(b){this.maxRows=4;var f=a.datepicker._getBorders(b.dpDiv);i=b;b.dpDiv.empty().append(this._generateHTML(b));var j=b.dpDiv.find("iframe.ui-datepicker-cover");j.length&&j.css({left:-f[0],top:-f[1],width:b.dpDiv.outerWidth(),height:b.dpDiv.outerHeight()});
b.dpDiv.find("."+this._dayOverClass+" a").mouseover();f=this._getNumberOfMonths(b);j=f[1];b.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");j>1&&b.dpDiv.addClass("ui-datepicker-multi-"+j).css("width",17*j+"em");b.dpDiv[(f[0]!=1||f[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi");b.dpDiv[(this._get(b,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");b==a.datepicker._curInst&&a.datepicker._datepickerShowing&&b.input&&b.input.is(":visible")&&
!b.input.is(":disabled")&&b.input[0]!=document.activeElement&&b.input.focus();if(b.yearshtml){var l=b.yearshtml;setTimeout(function(){l===b.yearshtml&&b.yearshtml&&b.dpDiv.find("select.ui-datepicker-year:first").replaceWith(b.yearshtml);l=b.yearshtml=null},0)}},_getBorders:function(b){var f=function(j){return{thin:1,medium:2,thick:3}[j]||j};return[parseFloat(f(b.css("border-left-width"))),parseFloat(f(b.css("border-top-width")))]},_checkOffset:function(b,f,j){var l=b.dpDiv.outerWidth(),o=b.dpDiv.outerHeight(),
n=b.input?b.input.outerWidth():0,k=b.input?b.input.outerHeight():0,m=document.documentElement.clientWidth+a(document).scrollLeft(),p=document.documentElement.clientHeight+a(document).scrollTop();f.left-=this._get(b,"isRTL")?l-n:0;f.left-=j&&f.left==b.input.offset().left?a(document).scrollLeft():0;f.top-=j&&f.top==b.input.offset().top+k?a(document).scrollTop():0;f.left-=Math.min(f.left,f.left+l>m&&m>l?Math.abs(f.left+l-m):0);f.top-=Math.min(f.top,f.top+o>p&&p>o?Math.abs(o+k):0);return f},_findPos:function(b){for(var f=
this._get(this._getInst(b),"isRTL");b&&(b.type=="hidden"||b.nodeType!=1||a.expr.filters.hidden(b));)b=b[f?"previousSibling":"nextSibling"];b=a(b).offset();return[b.left,b.top]},_triggerOnClose:function(b){var f=this._get(b,"onClose");if(f)f.apply(b.input?b.input[0]:null,[b.input?b.input.val():"",b])},_hideDatepicker:function(b){var f=this._curInst;if(!(!f||b&&f!=a.data(b,"datepicker")))if(this._datepickerShowing){b=this._get(f,"showAnim");var j=this._get(f,"duration"),l=function(){a.datepicker._tidyDialog(f);
this._curInst=null};a.effects&&a.effects[b]?f.dpDiv.hide(b,a.datepicker._get(f,"showOptions"),j,l):f.dpDiv[b=="slideDown"?"slideUp":b=="fadeIn"?"fadeOut":"hide"](b?j:null,l);b||l();a.datepicker._triggerOnClose(f);this._datepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if(a.blockUI){a.unblockUI();a("body").append(this.dpDiv)}}this._inDialog=false}},_tidyDialog:function(b){b.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},
_checkExternalClick:function(b){if(a.datepicker._curInst){b=a(b.target);b[0].id!=a.datepicker._mainDivId&&b.parents("#"+a.datepicker._mainDivId).length==0&&!b.hasClass(a.datepicker.markerClassName)&&!b.hasClass(a.datepicker._triggerClass)&&a.datepicker._datepickerShowing&&!(a.datepicker._inDialog&&a.blockUI)&&a.datepicker._hideDatepicker()}},_adjustDate:function(b,f,j){b=a(b);var l=this._getInst(b[0]);if(!this._isDisabledDatepicker(b[0])){this._adjustInstDate(l,f+(j=="M"?this._get(l,"showCurrentAtPos"):
0),j);this._updateDatepicker(l)}},_gotoToday:function(b){b=a(b);var f=this._getInst(b[0]);if(this._get(f,"gotoCurrent")&&f.currentDay){f.selectedDay=f.currentDay;f.drawMonth=f.selectedMonth=f.currentMonth;f.drawYear=f.selectedYear=f.currentYear}else{var j=new Date;f.selectedDay=j.getDate();f.drawMonth=f.selectedMonth=j.getMonth();f.drawYear=f.selectedYear=j.getFullYear()}this._notifyChange(f);this._adjustDate(b)},_selectMonthYear:function(b,f,j){b=a(b);var l=this._getInst(b[0]);l["selected"+(j=="M"?
"Month":"Year")]=l["draw"+(j=="M"?"Month":"Year")]=parseInt(f.options[f.selectedIndex].value,10);this._notifyChange(l);this._adjustDate(b)},_selectDay:function(b,f,j,l){var o=a(b);if(!(a(l).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0]))){o=this._getInst(o[0]);o.selectedDay=o.currentDay=a("a",l).html();o.selectedMonth=o.currentMonth=f;o.selectedYear=o.currentYear=j;this._selectDate(b,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear))}},_clearDate:function(b){b=a(b);
this._getInst(b[0]);this._selectDate(b,"")},_selectDate:function(b,f){b=this._getInst(a(b)[0]);f=f!=null?f:this._formatDate(b);b.input&&b.input.val(f);this._updateAlternate(b);var j=this._get(b,"onSelect");if(j)j.apply(b.input?b.input[0]:null,[f,b]);else b.input&&b.input.trigger("change");if(b.inline)this._updateDatepicker(b);else{this._hideDatepicker();this._lastInput=b.input[0];typeof b.input[0]!="object"&&b.input.focus();this._lastInput=null}},_updateAlternate:function(b){var f=this._get(b,"altField");
if(f){var j=this._get(b,"altFormat")||this._get(b,"dateFormat"),l=this._getDate(b),o=this.formatDate(j,l,this._getFormatConfig(b));a(f).each(function(){a(this).val(o)})}},noWeekends:function(b){b=b.getDay();return[b>0&&b<6,""]},iso8601Week:function(b){b=new Date(b.getTime());b.setDate(b.getDate()+4-(b.getDay()||7));var f=b.getTime();b.setMonth(0);b.setDate(1);return Math.floor(Math.round((f-b)/864E5)/7)+1},parseDate:function(b,f,j){if(b==null||f==null)throw"Invalid arguments";f=typeof f=="object"?
f.toString():f+"";if(f=="")return null;var l=(j?j.shortYearCutoff:null)||this._defaults.shortYearCutoff;l=typeof l!="string"?l:(new Date).getFullYear()%100+parseInt(l,10);for(var o=(j?j.dayNamesShort:null)||this._defaults.dayNamesShort,n=(j?j.dayNames:null)||this._defaults.dayNames,k=(j?j.monthNamesShort:null)||this._defaults.monthNamesShort,m=(j?j.monthNames:null)||this._defaults.monthNames,p=j=-1,q=-1,s=-1,r=false,u=function(z){(z=H+1<b.length&&b.charAt(H+1)==z)&&H++;return z},v=function(z){var I=
u(z);z=new RegExp("^\\d{1,"+(z=="@"?14:z=="!"?20:z=="y"&&I?4:z=="o"?3:2)+"}");z=f.substring(y).match(z);if(!z)throw"Missing number at position "+y;y+=z[0].length;return parseInt(z[0],10)},w=function(z,I,N){z=a.map(u(z)?N:I,function(D,E){return[[E,D]]}).sort(function(D,E){return-(D[1].length-E[1].length)});var J=-1;a.each(z,function(D,E){D=E[1];if(f.substr(y,D.length).toLowerCase()==D.toLowerCase()){J=E[0];y+=D.length;return false}});if(J!=-1)return J+1;else throw"Unknown name at position "+y;},x=
function(){if(f.charAt(y)!=b.charAt(H))throw"Unexpected literal at position "+y;y++},y=0,H=0;H<b.length;H++)if(r)if(b.charAt(H)=="'"&&!u("'"))r=false;else x();else switch(b.charAt(H)){case "d":q=v("d");break;case "D":w("D",o,n);break;case "o":s=v("o");break;case "m":p=v("m");break;case "M":p=w("M",k,m);break;case "y":j=v("y");break;case "@":var C=new Date(v("@"));j=C.getFullYear();p=C.getMonth()+1;q=C.getDate();break;case "!":C=new Date((v("!")-this._ticksTo1970)/1E4);j=C.getFullYear();p=C.getMonth()+
1;q=C.getDate();break;case "'":if(u("'"))x();else r=true;break;default:x()}if(y<f.length)throw"Extra/unparsed characters found in date: "+f.substring(y);if(j==-1)j=(new Date).getFullYear();else if(j<100)j+=(new Date).getFullYear()-(new Date).getFullYear()%100+(j<=l?0:-100);if(s>-1){p=1;q=s;do{l=this._getDaysInMonth(j,p-1);if(q<=l)break;p++;q-=l}while(1)}C=this._daylightSavingAdjust(new Date(j,p-1,q));if(C.getFullYear()!=j||C.getMonth()+1!=p||C.getDate()!=q)throw"Invalid date";return C},ATOM:"yy-mm-dd",
COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1E7,formatDate:function(b,f,j){if(!f)return"";var l=(j?j.dayNamesShort:null)||this._defaults.dayNamesShort,o=(j?j.dayNames:null)||this._defaults.dayNames,n=(j?j.monthNamesShort:null)||this._defaults.monthNamesShort;j=(j?j.monthNames:
null)||this._defaults.monthNames;var k=function(u){(u=r+1<b.length&&b.charAt(r+1)==u)&&r++;return u},m=function(u,v,w){v=""+v;if(k(u))for(;v.length<w;)v="0"+v;return v},p=function(u,v,w,x){return k(u)?x[v]:w[v]},q="",s=false;if(f)for(var r=0;r<b.length;r++)if(s)if(b.charAt(r)=="'"&&!k("'"))s=false;else q+=b.charAt(r);else switch(b.charAt(r)){case "d":q+=m("d",f.getDate(),2);break;case "D":q+=p("D",f.getDay(),l,o);break;case "o":q+=m("o",Math.round(((new Date(f.getFullYear(),f.getMonth(),f.getDate())).getTime()-
(new Date(f.getFullYear(),0,0)).getTime())/864E5),3);break;case "m":q+=m("m",f.getMonth()+1,2);break;case "M":q+=p("M",f.getMonth(),n,j);break;case "y":q+=k("y")?f.getFullYear():(f.getYear()%100<10?"0":"")+f.getYear()%100;break;case "@":q+=f.getTime();break;case "!":q+=f.getTime()*1E4+this._ticksTo1970;break;case "'":if(k("'"))q+="'";else s=true;break;default:q+=b.charAt(r)}return q},_possibleChars:function(b){for(var f="",j=false,l=function(n){(n=o+1<b.length&&b.charAt(o+1)==n)&&o++;return n},o=
0;o<b.length;o++)if(j)if(b.charAt(o)=="'"&&!l("'"))j=false;else f+=b.charAt(o);else switch(b.charAt(o)){case "d":case "m":case "y":case "@":f+="0123456789";break;case "D":case "M":return null;case "'":if(l("'"))f+="'";else j=true;break;default:f+=b.charAt(o)}return f},_get:function(b,f){return b.settings[f]!==d?b.settings[f]:this._defaults[f]},_setDateFromField:function(b,f){if(b.input.val()!=b.lastVal){var j=this._get(b,"dateFormat"),l=b.lastVal=b.input?b.input.val():null,o,n;o=n=this._getDefaultDate(b);
var k=this._getFormatConfig(b);try{o=this.parseDate(j,l,k)||n}catch(m){this.log(m);l=f?"":l}b.selectedDay=o.getDate();b.drawMonth=b.selectedMonth=o.getMonth();b.drawYear=b.selectedYear=o.getFullYear();b.currentDay=l?o.getDate():0;b.currentMonth=l?o.getMonth():0;b.currentYear=l?o.getFullYear():0;this._adjustInstDate(b)}},_getDefaultDate:function(b){return this._restrictMinMax(b,this._determineDate(b,this._get(b,"defaultDate"),new Date))},_determineDate:function(b,f,j){var l=function(n){var k=new Date;
k.setDate(k.getDate()+n);return k},o=function(n){try{return a.datepicker.parseDate(a.datepicker._get(b,"dateFormat"),n,a.datepicker._getFormatConfig(b))}catch(k){}var m=(n.toLowerCase().match(/^c/)?a.datepicker._getDate(b):null)||new Date,p=m.getFullYear(),q=m.getMonth();m=m.getDate();for(var s=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,r=s.exec(n);r;){switch(r[2]||"d"){case "d":case "D":m+=parseInt(r[1],10);break;case "w":case "W":m+=parseInt(r[1],10)*7;break;case "m":case "M":q+=parseInt(r[1],10);m=
Math.min(m,a.datepicker._getDaysInMonth(p,q));break;case "y":case "Y":p+=parseInt(r[1],10);m=Math.min(m,a.datepicker._getDaysInMonth(p,q));break}r=s.exec(n)}return new Date(p,q,m)};if(f=(f=f==null||f===""?j:typeof f=="string"?o(f):typeof f=="number"?isNaN(f)?j:l(f):new Date(f.getTime()))&&f.toString()=="Invalid Date"?j:f){f.setHours(0);f.setMinutes(0);f.setSeconds(0);f.setMilliseconds(0)}return this._daylightSavingAdjust(f)},_daylightSavingAdjust:function(b){if(!b)return null;b.setHours(b.getHours()>
12?b.getHours()+2:0);return b},_setDate:function(b,f,j){var l=!f,o=b.selectedMonth,n=b.selectedYear;f=this._restrictMinMax(b,this._determineDate(b,f,new Date));b.selectedDay=b.currentDay=f.getDate();b.drawMonth=b.selectedMonth=b.currentMonth=f.getMonth();b.drawYear=b.selectedYear=b.currentYear=f.getFullYear();if((o!=b.selectedMonth||n!=b.selectedYear)&&!j)this._notifyChange(b);this._adjustInstDate(b);if(b.input)b.input.val(l?"":this._formatDate(b))},_getDate:function(b){return!b.currentYear||b.input&&
b.input.val()==""?null:this._daylightSavingAdjust(new Date(b.currentYear,b.currentMonth,b.currentDay))},_generateHTML:function(b){var f=new Date;f=this._daylightSavingAdjust(new Date(f.getFullYear(),f.getMonth(),f.getDate()));var j=this._get(b,"isRTL"),l=this._get(b,"showButtonPanel"),o=this._get(b,"hideIfNoPrevNext"),n=this._get(b,"navigationAsDateFormat"),k=this._getNumberOfMonths(b),m=this._get(b,"showCurrentAtPos"),p=this._get(b,"stepMonths"),q=k[0]!=1||k[1]!=1,s=this._daylightSavingAdjust(!b.currentDay?
new Date(9999,9,9):new Date(b.currentYear,b.currentMonth,b.currentDay)),r=this._getMinMaxDate(b,"min"),u=this._getMinMaxDate(b,"max");m=b.drawMonth-m;var v=b.drawYear;if(m<0){m+=12;v--}if(u){var w=this._daylightSavingAdjust(new Date(u.getFullYear(),u.getMonth()-k[0]*k[1]+1,u.getDate()));for(w=r&&w<r?r:w;this._daylightSavingAdjust(new Date(v,m,1))>w;){m--;if(m<0){m=11;v--}}}b.drawMonth=m;b.drawYear=v;w=this._get(b,"prevText");w=!n?w:this.formatDate(w,this._daylightSavingAdjust(new Date(v,m-p,1)),this._getFormatConfig(b));
w=this._canAdjustMonth(b,-1,v,m)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+g+".datepicker._adjustDate('#"+b.id+"', -"+p+", 'M');\" title=\""+w+'"><span class="ui-icon ui-icon-circle-triangle-'+(j?"e":"w")+'">'+w+"</span></a>":o?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+w+'"><span class="ui-icon ui-icon-circle-triangle-'+(j?"e":"w")+'">'+w+"</span></a>";var x=this._get(b,"nextText");x=!n?x:this.formatDate(x,this._daylightSavingAdjust(new Date(v,
m+p,1)),this._getFormatConfig(b));o=this._canAdjustMonth(b,+1,v,m)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+g+".datepicker._adjustDate('#"+b.id+"', +"+p+", 'M');\" title=\""+x+'"><span class="ui-icon ui-icon-circle-triangle-'+(j?"w":"e")+'">'+x+"</span></a>":o?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+x+'"><span class="ui-icon ui-icon-circle-triangle-'+(j?"w":"e")+'">'+x+"</span></a>";p=this._get(b,"currentText");x=this._get(b,"gotoCurrent")&&
b.currentDay?s:f;p=!n?p:this.formatDate(p,x,this._getFormatConfig(b));n=!b.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+g+'.datepicker._hideDatepicker();">'+this._get(b,"closeText")+"</button>":"";l=l?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(j?n:"")+(this._isInRange(b,x)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+
g+".datepicker._gotoToday('#"+b.id+"');\">"+p+"</button>":"")+(j?"":n)+"</div>":"";n=parseInt(this._get(b,"firstDay"),10);n=isNaN(n)?0:n;p=this._get(b,"showWeek");x=this._get(b,"dayNames");this._get(b,"dayNamesShort");var y=this._get(b,"dayNamesMin"),H=this._get(b,"monthNames"),C=this._get(b,"monthNamesShort"),z=this._get(b,"beforeShowDay"),I=this._get(b,"showOtherMonths"),N=this._get(b,"selectOtherMonths");this._get(b,"calculateWeek");for(var J=this._getDefaultDate(b),D="",E=0;E<k[0];E++){var P=
"";this.maxRows=4;for(var L=0;L<k[1];L++){var Q=this._daylightSavingAdjust(new Date(v,m,b.selectedDay)),B=" ui-corner-all",F="";if(q){F+='<div class="ui-datepicker-group';if(k[1]>1)switch(L){case 0:F+=" ui-datepicker-group-first";B=" ui-corner-"+(j?"right":"left");break;case k[1]-1:F+=" ui-datepicker-group-last";B=" ui-corner-"+(j?"left":"right");break;default:F+=" ui-datepicker-group-middle";B="";break}F+='">'}F+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+B+'">'+(/all|left/.test(B)&&
E==0?j?o:w:"")+(/all|right/.test(B)&&E==0?j?w:o:"")+this._generateMonthYearHeader(b,m,v,r,u,E>0||L>0,H,C)+'</div><table class="ui-datepicker-calendar"><thead><tr>';var G=p?'<th class="ui-datepicker-week-col">'+this._get(b,"weekHeader")+"</th>":"";for(B=0;B<7;B++){var A=(B+n)%7;G+="<th"+((B+n+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+x[A]+'">'+y[A]+"</span></th>"}F+=G+"</tr></thead><tbody>";G=this._getDaysInMonth(v,m);if(v==b.selectedYear&&m==b.selectedMonth)b.selectedDay=Math.min(b.selectedDay,
G);B=(this._getFirstDayOfMonth(v,m)-n+7)%7;G=Math.ceil((B+G)/7);this.maxRows=G=q?this.maxRows>G?this.maxRows:G:G;A=this._daylightSavingAdjust(new Date(v,m,1-B));for(var R=0;R<G;R++){F+="<tr>";var S=!p?"":'<td class="ui-datepicker-week-col">'+this._get(b,"calculateWeek")(A)+"</td>";for(B=0;B<7;B++){var M=z?z.apply(b.input?b.input[0]:null,[A]):[true,""],K=A.getMonth()!=m,O=K&&!N||!M[0]||r&&A<r||u&&A>u;S+='<td class="'+((B+n+6)%7>=5?" ui-datepicker-week-end":"")+(K?" ui-datepicker-other-month":"")+(A.getTime()==
Q.getTime()&&m==b.selectedMonth&&b._keyEvent||J.getTime()==A.getTime()&&J.getTime()==Q.getTime()?" "+this._dayOverClass:"")+(O?" "+this._unselectableClass+" ui-state-disabled":"")+(K&&!I?"":" "+M[1]+(A.getTime()==s.getTime()?" "+this._currentClass:"")+(A.getTime()==f.getTime()?" ui-datepicker-today":""))+'"'+((!K||I)&&M[2]?' title="'+M[2]+'"':"")+(O?"":' onclick="DP_jQuery_'+g+".datepicker._selectDay('#"+b.id+"',"+A.getMonth()+","+A.getFullYear()+', this);return false;"')+">"+(K&&!I?"&#xa0;":O?'<span class="ui-state-default">'+
A.getDate()+"</span>":'<a class="ui-state-default'+(A.getTime()==f.getTime()?" ui-state-highlight":"")+(A.getTime()==s.getTime()?" ui-state-active":"")+(K?" ui-priority-secondary":"")+'" href="#">'+A.getDate()+"</a>")+"</td>";A.setDate(A.getDate()+1);A=this._daylightSavingAdjust(A)}F+=S+"</tr>"}m++;if(m>11){m=0;v++}F+="</tbody></table>"+(q?"</div>"+(k[0]>0&&L==k[1]-1?'<div class="ui-datepicker-row-break"></div>':""):"");P+=F}D+=P}D+=l+(a.browser.msie&&parseInt(a.browser.version,10)<7&&!b.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':
"");b._keyEvent=false;return D},_generateMonthYearHeader:function(b,f,j,l,o,n,k,m){var p=this._get(b,"changeMonth"),q=this._get(b,"changeYear"),s=this._get(b,"showMonthAfterYear"),r='<div class="ui-datepicker-title">',u="";if(n||!p)u+='<span class="ui-datepicker-month">'+k[f]+"</span>";else{k=l&&l.getFullYear()==j;var v=o&&o.getFullYear()==j;u+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+g+".datepicker._selectMonthYear('#"+b.id+"', this, 'M');\" >";for(var w=0;w<12;w++)if((!k||w>=l.getMonth())&&
(!v||w<=o.getMonth()))u+='<option value="'+w+'"'+(w==f?' selected="selected"':"")+">"+m[w]+"</option>";u+="</select>"}s||(r+=u+(n||!(p&&q)?"&#xa0;":""));if(!b.yearshtml){b.yearshtml="";if(n||!q)r+='<span class="ui-datepicker-year">'+j+"</span>";else{m=this._get(b,"yearRange").split(":");var x=(new Date).getFullYear();k=function(y){y=y.match(/c[+-].*/)?j+parseInt(y.substring(1),10):y.match(/[+-].*/)?x+parseInt(y,10):parseInt(y,10);return isNaN(y)?x:y};f=k(m[0]);m=Math.max(f,k(m[1]||""));f=l?Math.max(f,
l.getFullYear()):f;m=o?Math.min(m,o.getFullYear()):m;for(b.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+g+".datepicker._selectMonthYear('#"+b.id+"', this, 'Y');\" >";f<=m;f++)b.yearshtml+='<option value="'+f+'"'+(f==j?' selected="selected"':"")+">"+f+"</option>";b.yearshtml+="</select>";r+=b.yearshtml;b.yearshtml=null}}r+=this._get(b,"yearSuffix");if(s)r+=(n||!(p&&q)?"&#xa0;":"")+u;r+="</div>";return r},_adjustInstDate:function(b,f,j){var l=b.drawYear+(j=="Y"?f:0),o=b.drawMonth+
(j=="M"?f:0);f=Math.min(b.selectedDay,this._getDaysInMonth(l,o))+(j=="D"?f:0);l=this._restrictMinMax(b,this._daylightSavingAdjust(new Date(l,o,f)));b.selectedDay=l.getDate();b.drawMonth=b.selectedMonth=l.getMonth();b.drawYear=b.selectedYear=l.getFullYear();if(j=="M"||j=="Y")this._notifyChange(b)},_restrictMinMax:function(b,f){var j=this._getMinMaxDate(b,"min");b=this._getMinMaxDate(b,"max");f=j&&f<j?j:f;return f=b&&f>b?b:f},_notifyChange:function(b){var f=this._get(b,"onChangeMonthYear");if(f)f.apply(b.input?
b.input[0]:null,[b.selectedYear,b.selectedMonth+1,b])},_getNumberOfMonths:function(b){b=this._get(b,"numberOfMonths");return b==null?[1,1]:typeof b=="number"?[1,b]:b},_getMinMaxDate:function(b,f){return this._determineDate(b,this._get(b,f+"Date"),null)},_getDaysInMonth:function(b,f){return 32-this._daylightSavingAdjust(new Date(b,f,32)).getDate()},_getFirstDayOfMonth:function(b,f){return(new Date(b,f,1)).getDay()},_canAdjustMonth:function(b,f,j,l){var o=this._getNumberOfMonths(b);j=this._daylightSavingAdjust(new Date(j,
l+(f<0?f:o[0]*o[1]),1));f<0&&j.setDate(this._getDaysInMonth(j.getFullYear(),j.getMonth()));return this._isInRange(b,j)},_isInRange:function(b,f){var j=this._getMinMaxDate(b,"min");b=this._getMinMaxDate(b,"max");return(!j||f.getTime()>=j.getTime())&&(!b||f.getTime()<=b.getTime())},_getFormatConfig:function(b){var f=this._get(b,"shortYearCutoff");f=typeof f!="string"?f:(new Date).getFullYear()%100+parseInt(f,10);return{shortYearCutoff:f,dayNamesShort:this._get(b,"dayNamesShort"),dayNames:this._get(b,
"dayNames"),monthNamesShort:this._get(b,"monthNamesShort"),monthNames:this._get(b,"monthNames")}},_formatDate:function(b,f,j,l){if(!f){b.currentDay=b.selectedDay;b.currentMonth=b.selectedMonth;b.currentYear=b.selectedYear}f=f?typeof f=="object"?f:this._daylightSavingAdjust(new Date(l,j,f)):this._daylightSavingAdjust(new Date(b.currentYear,b.currentMonth,b.currentDay));return this.formatDate(this._get(b,"dateFormat"),f,this._getFormatConfig(b))}});a.fn.datepicker=function(b){if(!this.length)return this;
if(!a.datepicker.initialized){a(document).mousedown(a.datepicker._checkExternalClick).find("body").append(a.datepicker.dpDiv);a.datepicker.initialized=true}var f=Array.prototype.slice.call(arguments,1);if(typeof b=="string"&&(b=="isDisabled"||b=="getDate"||b=="widget"))return a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this[0]].concat(f));if(b=="option"&&arguments.length==2&&typeof arguments[1]=="string")return a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this[0]].concat(f));return this.each(function(){typeof b==
"string"?a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this].concat(f)):a.datepicker._attachDatepicker(this,b)})};a.datepicker=new c;a.datepicker.initialized=false;a.datepicker.uuid=(new Date).getTime();a.datepicker.version="1.8.16";window["DP_jQuery_"+g]=a})(jQuery);
(function(a,d){var c={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},e={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true},h=a.attrFn||{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true,click:true};a.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,
position:{my:"center",at:"center",collision:"fit",using:function(g){var i=a(this).css(g).offset().top;i<0&&a(this).css("top",g.top-i)}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1E3},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string")this.originalTitle="";this.options.title=this.options.title||this.originalTitle;var g=this,i=g.options,b=i.title||"&#160;",f=a.ui.dialog.getTitleId(g.element),j=(g.uiDialog=a("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+
i.dialogClass).css({zIndex:i.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(n){if(i.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===a.ui.keyCode.ESCAPE){g.close(n);n.preventDefault()}}).attr({role:"dialog","aria-labelledby":f}).mousedown(function(n){g.moveToTop(false,n)});g.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(j);var l=(g.uiDialogTitlebar=a("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(j),
o=a('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){o.addClass("ui-state-hover")},function(){o.removeClass("ui-state-hover")}).focus(function(){o.addClass("ui-state-focus")}).blur(function(){o.removeClass("ui-state-focus")}).click(function(n){g.close(n);return false}).appendTo(l);(g.uiDialogTitlebarCloseText=a("<span></span>")).addClass("ui-icon ui-icon-closethick").text(i.closeText).appendTo(o);a("<span></span>").addClass("ui-dialog-title").attr("id",
f).html(b).prependTo(l);if(a.isFunction(i.beforeclose)&&!a.isFunction(i.beforeClose))i.beforeClose=i.beforeclose;l.find("*").add(l).disableSelection();i.draggable&&a.fn.draggable&&g._makeDraggable();i.resizable&&a.fn.resizable&&g._makeResizable();g._createButtons(i.buttons);g._isOpen=false;a.fn.bgiframe&&j.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var g=this;g.overlay&&g.overlay.destroy();g.uiDialog.hide();g.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");
g.uiDialog.remove();g.originalTitle&&g.element.attr("title",g.originalTitle);return g},widget:function(){return this.uiDialog},close:function(g){var i=this,b,f;if(false!==i._trigger("beforeClose",g)){i.overlay&&i.overlay.destroy();i.uiDialog.unbind("keypress.ui-dialog");i._isOpen=false;if(i.options.hide)i.uiDialog.hide(i.options.hide,function(){i._trigger("close",g)});else{i.uiDialog.hide();i._trigger("close",g)}a.ui.dialog.overlay.resize();if(i.options.modal){b=0;a(".ui-dialog").each(function(){if(this!==
i.uiDialog[0]){f=a(this).css("z-index");isNaN(f)||(b=Math.max(b,f))}});a.ui.dialog.maxZ=b}return i}},isOpen:function(){return this._isOpen},moveToTop:function(g,i){var b=this,f=b.options;if(f.modal&&!g||!f.stack&&!f.modal)return b._trigger("focus",i);if(f.zIndex>a.ui.dialog.maxZ)a.ui.dialog.maxZ=f.zIndex;if(b.overlay){a.ui.dialog.maxZ+=1;b.overlay.$el.css("z-index",a.ui.dialog.overlay.maxZ=a.ui.dialog.maxZ)}g={scrollTop:b.element.scrollTop(),scrollLeft:b.element.scrollLeft()};a.ui.dialog.maxZ+=1;
b.uiDialog.css("z-index",a.ui.dialog.maxZ);b.element.attr(g);b._trigger("focus",i);return b},open:function(){if(!this._isOpen){var g=this,i=g.options,b=g.uiDialog;g.overlay=i.modal?new a.ui.dialog.overlay(g):null;g._size();g._position(i.position);b.show(i.show);g.moveToTop(true);i.modal&&b.bind("keypress.ui-dialog",function(f){if(f.keyCode===a.ui.keyCode.TAB){var j=a(":tabbable",this),l=j.filter(":first");j=j.filter(":last");if(f.target===j[0]&&!f.shiftKey){l.focus(1);return false}else if(f.target===
l[0]&&f.shiftKey){j.focus(1);return false}}});a(g.element.find(":tabbable").get().concat(b.find(".ui-dialog-buttonpane :tabbable").get().concat(b.get()))).eq(0).focus();g._isOpen=true;g._trigger("open");return g}},_createButtons:function(g){var i=this,b=false,f=a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),j=a("<div></div>").addClass("ui-dialog-buttonset").appendTo(f);i.uiDialog.find(".ui-dialog-buttonpane").remove();typeof g==="object"&&g!==null&&a.each(g,
function(){return!(b=true)});if(b){a.each(g,function(l,o){o=a.isFunction(o)?{click:o,text:l}:o;var n=a('<button type="button"></button>').click(function(){o.click.apply(i.element[0],arguments)}).appendTo(j);a.each(o,function(k,m){if(k!=="click")k in h?n[k](m):n.attr(k,m)});a.fn.button&&n.button()});f.appendTo(i.uiDialog)}},_makeDraggable:function(){function g(l){return{position:l.position,offset:l.offset}}var i=this,b=i.options,f=a(document),j;i.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",
handle:".ui-dialog-titlebar",containment:"document",start:function(l,o){j=b.height==="auto"?"auto":a(this).height();a(this).height(a(this).height()).addClass("ui-dialog-dragging");i._trigger("dragStart",l,g(o))},drag:function(l,o){i._trigger("drag",l,g(o))},stop:function(l,o){b.position=[o.position.left-f.scrollLeft(),o.position.top-f.scrollTop()];a(this).removeClass("ui-dialog-dragging").height(j);i._trigger("dragStop",l,g(o));a.ui.dialog.overlay.resize()}})},_makeResizable:function(g){function i(l){return{originalPosition:l.originalPosition,
originalSize:l.originalSize,position:l.position,size:l.size}}g=g===d?this.options.resizable:g;var b=this,f=b.options,j=b.uiDialog.css("position");g=typeof g==="string"?g:"n,e,s,w,se,sw,ne,nw";b.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:b.element,maxWidth:f.maxWidth,maxHeight:f.maxHeight,minWidth:f.minWidth,minHeight:b._minHeight(),handles:g,start:function(l,o){a(this).addClass("ui-dialog-resizing");b._trigger("resizeStart",l,i(o))},resize:function(l,o){b._trigger("resize",
l,i(o))},stop:function(l,o){a(this).removeClass("ui-dialog-resizing");f.height=a(this).height();f.width=a(this).width();b._trigger("resizeStop",l,i(o));a.ui.dialog.overlay.resize()}}).css("position",j).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var g=this.options;return g.height==="auto"?g.minHeight:Math.min(g.minHeight,g.height)},_position:function(g){var i=[],b=[0,0],f;if(g){if(typeof g==="string"||typeof g==="object"&&"0"in g){i=g.split?g.split(" "):
[g[0],g[1]];if(i.length===1)i[1]=i[0];a.each(["left","top"],function(j,l){if(+i[j]===i[j]){b[j]=i[j];i[j]=l}});g={my:i.join(" "),at:i.join(" "),offset:b.join(" ")}}g=a.extend({},a.ui.dialog.prototype.options.position,g)}else g=a.ui.dialog.prototype.options.position;(f=this.uiDialog.is(":visible"))||this.uiDialog.show();this.uiDialog.css({top:0,left:0}).position(a.extend({of:window},g));f||this.uiDialog.hide()},_setOptions:function(g){var i=this,b={},f=false;a.each(g,function(j,l){i._setOption(j,l);
if(j in c)f=true;if(j in e)b[j]=l});f&&this._size();this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",b)},_setOption:function(g,i){var b=this,f=b.uiDialog;switch(g){case "beforeclose":g="beforeClose";break;case "buttons":b._createButtons(i);break;case "closeText":b.uiDialogTitlebarCloseText.text(""+i);break;case "dialogClass":f.removeClass(b.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+i);break;case "disabled":i?f.addClass("ui-dialog-disabled"):
f.removeClass("ui-dialog-disabled");break;case "draggable":var j=f.is(":data(draggable)");j&&!i&&f.draggable("destroy");!j&&i&&b._makeDraggable();break;case "position":b._position(i);break;case "resizable":(j=f.is(":data(resizable)"))&&!i&&f.resizable("destroy");j&&typeof i==="string"&&f.resizable("option","handles",i);!j&&i!==false&&b._makeResizable(i);break;case "title":a(".ui-dialog-title",b.uiDialogTitlebar).html(""+(i||"&#160;"));break}a.Widget.prototype._setOption.apply(b,arguments)},_size:function(){var g=
this.options,i,b,f=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});if(g.minWidth>g.width)g.width=g.minWidth;i=this.uiDialog.css({height:"auto",width:g.width}).height();b=Math.max(0,g.minHeight-i);if(g.height==="auto")if(a.support.minHeight)this.element.css({minHeight:b,height:"auto"});else{this.uiDialog.show();g=this.element.css("height","auto").height();f||this.uiDialog.hide();this.element.height(Math.max(g,b))}else this.element.height(Math.max(g.height-
i,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}});a.extend(a.ui.dialog,{version:"1.8.16",uuid:0,maxZ:0,getTitleId:function(g){g=g.attr("id");if(!g){this.uuid+=1;g=this.uuid}return"ui-dialog-title-"+g},overlay:function(g){this.$el=a.ui.dialog.overlay.create(g)}});a.extend(a.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:a.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(g){return g+".dialog-overlay"}).join(" "),
create:function(g){if(this.instances.length===0){setTimeout(function(){a.ui.dialog.overlay.instances.length&&a(document).bind(a.ui.dialog.overlay.events,function(b){if(a(b.target).zIndex()<a.ui.dialog.overlay.maxZ)return false})},1);a(document).bind("keydown.dialog-overlay",function(b){if(g.options.closeOnEscape&&!b.isDefaultPrevented()&&b.keyCode&&b.keyCode===a.ui.keyCode.ESCAPE){g.close(b);b.preventDefault()}});a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize)}var i=(this.oldInstances.pop()||
a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});a.fn.bgiframe&&i.bgiframe();this.instances.push(i);return i},destroy:function(g){var i=a.inArray(g,this.instances);i!=-1&&this.oldInstances.push(this.instances.splice(i,1)[0]);this.instances.length===0&&a([document,window]).unbind(".dialog-overlay");g.remove();var b=0;a.each(this.instances,function(){b=Math.max(b,this.css("z-index"))});this.maxZ=b},height:function(){var g,i;if(a.browser.msie&&
a.browser.version<7){g=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);i=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return g<i?a(window).height()+"px":g+"px"}else return a(document).height()+"px"},width:function(){var g,i;if(a.browser.msie){g=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);i=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);return g<i?a(window).width()+"px":g+"px"}else return a(document).width()+
"px"},resize:function(){var g=a([]);a.each(a.ui.dialog.overlay.instances,function(){g=g.add(this)});g.css({width:0,height:0}).css({width:a.ui.dialog.overlay.width(),height:a.ui.dialog.overlay.height()})}});a.extend(a.ui.dialog.overlay.prototype,{destroy:function(){a.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);
(function(a){a.ui=a.ui||{};var d=/left|center|right/,c=/top|center|bottom/,e=a.fn.position,h=a.fn.offset;a.fn.position=function(g){if(!g||!g.of)return e.apply(this,arguments);g=a.extend({},g);var i=a(g.of),b=i[0],f=(g.collision||"flip").split(" "),j=g.offset?g.offset.split(" "):[0,0],l,o,n;if(b.nodeType===9){l=i.width();o=i.height();n={top:0,left:0}}else if(b.setTimeout){l=i.width();o=i.height();n={top:i.scrollTop(),left:i.scrollLeft()}}else if(b.preventDefault){g.at="left top";l=o=0;n={top:g.of.pageY,
left:g.of.pageX}}else{l=i.outerWidth();o=i.outerHeight();n=i.offset()}a.each(["my","at"],function(){var k=(g[this]||"").split(" ");if(k.length===1)k=d.test(k[0])?k.concat(["center"]):c.test(k[0])?["center"].concat(k):["center","center"];k[0]=d.test(k[0])?k[0]:"center";k[1]=c.test(k[1])?k[1]:"center";g[this]=k});if(f.length===1)f[1]=f[0];j[0]=parseInt(j[0],10)||0;if(j.length===1)j[1]=j[0];j[1]=parseInt(j[1],10)||0;if(g.at[0]==="right")n.left+=l;else if(g.at[0]==="center")n.left+=l/2;if(g.at[1]==="bottom")n.top+=
o;else if(g.at[1]==="center")n.top+=o/2;n.left+=j[0];n.top+=j[1];return this.each(function(){var k=a(this),m=k.outerWidth(),p=k.outerHeight(),q=parseInt(a.curCSS(this,"marginLeft",true))||0,s=parseInt(a.curCSS(this,"marginTop",true))||0,r=m+q+(parseInt(a.curCSS(this,"marginRight",true))||0),u=p+s+(parseInt(a.curCSS(this,"marginBottom",true))||0),v=a.extend({},n),w;if(g.my[0]==="right")v.left-=m;else if(g.my[0]==="center")v.left-=m/2;if(g.my[1]==="bottom")v.top-=p;else if(g.my[1]==="center")v.top-=
p/2;v.left=Math.round(v.left);v.top=Math.round(v.top);w={left:v.left-q,top:v.top-s};a.each(["left","top"],function(x,y){a.ui.position[f[x]]&&a.ui.position[f[x]][y](v,{targetWidth:l,targetHeight:o,elemWidth:m,elemHeight:p,collisionPosition:w,collisionWidth:r,collisionHeight:u,offset:j,my:g.my,at:g.at})});a.fn.bgiframe&&k.bgiframe();k.offset(a.extend(v,{using:g.using}))})};a.ui.position={fit:{left:function(g,i){var b=a(window);b=i.collisionPosition.left+i.collisionWidth-b.width()-b.scrollLeft();g.left=
b>0?g.left-b:Math.max(g.left-i.collisionPosition.left,g.left)},top:function(g,i){var b=a(window);b=i.collisionPosition.top+i.collisionHeight-b.height()-b.scrollTop();g.top=b>0?g.top-b:Math.max(g.top-i.collisionPosition.top,g.top)}},flip:{left:function(g,i){if(i.at[0]!=="center"){var b=a(window);b=i.collisionPosition.left+i.collisionWidth-b.width()-b.scrollLeft();var f=i.my[0]==="left"?-i.elemWidth:i.my[0]==="right"?i.elemWidth:0,j=i.at[0]==="left"?i.targetWidth:-i.targetWidth,l=-2*i.offset[0];g.left+=
i.collisionPosition.left<0?f+j+l:b>0?f+j+l:0}},top:function(g,i){if(i.at[1]!=="center"){var b=a(window);b=i.collisionPosition.top+i.collisionHeight-b.height()-b.scrollTop();var f=i.my[1]==="top"?-i.elemHeight:i.my[1]==="bottom"?i.elemHeight:0,j=i.at[1]==="top"?i.targetHeight:-i.targetHeight,l=-2*i.offset[1];g.top+=i.collisionPosition.top<0?f+j+l:b>0?f+j+l:0}}}};if(!a.offset.setOffset){a.offset.setOffset=function(g,i){if(/static/.test(a.curCSS(g,"position")))g.style.position="relative";var b=a(g),
f=b.offset(),j=parseInt(a.curCSS(g,"top",true),10)||0,l=parseInt(a.curCSS(g,"left",true),10)||0;f={top:i.top-f.top+j,left:i.left-f.left+l};"using"in i?i.using.call(g,f):b.css(f)};a.fn.offset=function(g){var i=this[0];if(!i||!i.ownerDocument)return null;if(g)return this.each(function(){a.offset.setOffset(this,g)});return h.call(this)}}})(jQuery);
(function(a,d){a.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=a("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue()},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");
this.valueDiv.remove();a.Widget.prototype.destroy.apply(this,arguments)},value:function(c){if(c===d)return this._value();this._setOption("value",c);return this},_setOption:function(c,e){if(c==="value"){this.options.value=e;this._refreshValue();this._value()===this.options.max&&this._trigger("complete")}a.Widget.prototype._setOption.apply(this,arguments)},_value:function(){var c=this.options.value;if(typeof c!=="number")c=0;return Math.min(this.options.max,Math.max(this.min,c))},_percentage:function(){return 100*
this._value()/this.options.max},_refreshValue:function(){var c=this.value(),e=this._percentage();if(this.oldValue!==c){this.oldValue=c;this._trigger("change")}this.valueDiv.toggle(c>this.min).toggleClass("ui-corner-right",c===this.options.max).width(e.toFixed(0)+"%");this.element.attr("aria-valuenow",c)}});a.extend(a.ui.progressbar,{version:"1.8.16"})})(jQuery);
(function(a){a.widget("ui.slider",a.ui.mouse,{widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var d=this,c=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),h=c.values&&c.values.length||1,g=[];this._mouseSliding=this._keySliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+
this.orientation+" ui-widget ui-widget-content ui-corner-all"+(c.disabled?" ui-slider-disabled ui-disabled":""));this.range=a([]);if(c.range){if(c.range===true){if(!c.values)c.values=[this._valueMin(),this._valueMin()];if(c.values.length&&c.values.length!==2)c.values=[c.values[0],c.values[0]]}this.range=a("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(c.range==="min"||c.range==="max"?" ui-slider-range-"+c.range:""))}for(var i=e.length;i<h;i+=1)g.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");
this.handles=e.add(a(g.join("")).appendTo(d.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(b){b.preventDefault()}).hover(function(){c.disabled||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).focus(function(){if(c.disabled)a(this).blur();else{a(".ui-slider .ui-state-focus").removeClass("ui-state-focus");a(this).addClass("ui-state-focus")}}).blur(function(){a(this).removeClass("ui-state-focus")});this.handles.each(function(b){a(this).data("index.ui-slider-handle",
b)});this.handles.keydown(function(b){var f=true,j=a(this).data("index.ui-slider-handle"),l,o,n;if(!d.options.disabled){switch(b.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:f=false;if(!d._keySliding){d._keySliding=true;a(this).addClass("ui-state-active");l=d._start(b,j);if(l===false)return}break}n=d.options.step;l=d.options.values&&d.options.values.length?
(o=d.values(j)):(o=d.value());switch(b.keyCode){case a.ui.keyCode.HOME:o=d._valueMin();break;case a.ui.keyCode.END:o=d._valueMax();break;case a.ui.keyCode.PAGE_UP:o=d._trimAlignValue(l+(d._valueMax()-d._valueMin())/5);break;case a.ui.keyCode.PAGE_DOWN:o=d._trimAlignValue(l-(d._valueMax()-d._valueMin())/5);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(l===d._valueMax())return;o=d._trimAlignValue(l+n);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(l===d._valueMin())return;o=d._trimAlignValue(l-
n);break}d._slide(b,j,o);return f}}).keyup(function(b){var f=a(this).data("index.ui-slider-handle");if(d._keySliding){d._keySliding=false;d._stop(b,f);d._change(b,f);a(this).removeClass("ui-state-active")}});this._refreshValue();this._animateOff=false},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();
return this},_mouseCapture:function(d){var c=this.options,e,h,g,i,b;if(c.disabled)return false;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();e=this._normValueFromMouse({x:d.pageX,y:d.pageY});h=this._valueMax()-this._valueMin()+1;i=this;this.handles.each(function(f){var j=Math.abs(e-i.values(f));if(h>j){h=j;g=a(this);b=f}});if(c.range===true&&this.values(1)===c.min){b+=1;g=a(this.handles[b])}if(this._start(d,b)===false)return false;
this._mouseSliding=true;i._handleIndex=b;g.addClass("ui-state-active").focus();c=g.offset();this._clickOffset=!a(d.target).parents().andSelf().is(".ui-slider-handle")?{left:0,top:0}:{left:d.pageX-c.left-g.width()/2,top:d.pageY-c.top-g.height()/2-(parseInt(g.css("borderTopWidth"),10)||0)-(parseInt(g.css("borderBottomWidth"),10)||0)+(parseInt(g.css("marginTop"),10)||0)};this.handles.hasClass("ui-state-hover")||this._slide(d,b,e);return this._animateOff=true},_mouseStart:function(){return true},_mouseDrag:function(d){var c=
this._normValueFromMouse({x:d.pageX,y:d.pageY});this._slide(d,this._handleIndex,c);return false},_mouseStop:function(d){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(d,this._handleIndex);this._change(d,this._handleIndex);this._clickOffset=this._handleIndex=null;return this._animateOff=false},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(d){var c;if(this.orientation==="horizontal"){c=
this.elementSize.width;d=d.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{c=this.elementSize.height;d=d.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}c=d/c;if(c>1)c=1;if(c<0)c=0;if(this.orientation==="vertical")c=1-c;d=this._valueMax()-this._valueMin();return this._trimAlignValue(this._valueMin()+c*d)},_start:function(d,c){var e={handle:this.handles[c],value:this.value()};if(this.options.values&&this.options.values.length){e.value=this.values(c);
e.values=this.values()}return this._trigger("start",d,e)},_slide:function(d,c,e){var h;if(this.options.values&&this.options.values.length){h=this.values(c?0:1);if(this.options.values.length===2&&this.options.range===true&&(c===0&&e>h||c===1&&e<h))e=h;if(e!==this.values(c)){h=this.values();h[c]=e;d=this._trigger("slide",d,{handle:this.handles[c],value:e,values:h});this.values(c?0:1);d!==false&&this.values(c,e,true)}}else if(e!==this.value()){d=this._trigger("slide",d,{handle:this.handles[c],value:e});
d!==false&&this.value(e)}},_stop:function(d,c){var e={handle:this.handles[c],value:this.value()};if(this.options.values&&this.options.values.length){e.value=this.values(c);e.values=this.values()}this._trigger("stop",d,e)},_change:function(d,c){if(!this._keySliding&&!this._mouseSliding){var e={handle:this.handles[c],value:this.value()};if(this.options.values&&this.options.values.length){e.value=this.values(c);e.values=this.values()}this._trigger("change",d,e)}},value:function(d){if(arguments.length){this.options.value=
this._trimAlignValue(d);this._refreshValue();this._change(null,0)}else return this._value()},values:function(d,c){var e,h,g;if(arguments.length>1){this.options.values[d]=this._trimAlignValue(c);this._refreshValue();this._change(null,d)}else if(arguments.length)if(a.isArray(arguments[0])){e=this.options.values;h=arguments[0];for(g=0;g<e.length;g+=1){e[g]=this._trimAlignValue(h[g]);this._change(null,g)}this._refreshValue()}else return this.options.values&&this.options.values.length?this._values(d):
this.value();else return this._values()},_setOption:function(d,c){var e,h=0;if(a.isArray(this.options.values))h=this.options.values.length;a.Widget.prototype._setOption.apply(this,arguments);switch(d){case "disabled":if(c){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.propAttr("disabled",true);this.element.addClass("ui-disabled")}else{this.handles.propAttr("disabled",false);this.element.removeClass("ui-disabled")}break;case "orientation":this._detectOrientation();
this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case "value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case "values":this._animateOff=true;this._refreshValue();for(e=0;e<h;e+=1)this._change(null,e);this._animateOff=false;break}},_value:function(){var d=this.options.value;return d=this._trimAlignValue(d)},_values:function(d){var c,e;if(arguments.length){c=this.options.values[d];
return c=this._trimAlignValue(c)}else{c=this.options.values.slice();for(e=0;e<c.length;e+=1)c[e]=this._trimAlignValue(c[e]);return c}},_trimAlignValue:function(d){if(d<=this._valueMin())return this._valueMin();if(d>=this._valueMax())return this._valueMax();var c=this.options.step>0?this.options.step:1,e=(d-this._valueMin())%c;d=d-e;if(Math.abs(e)*2>=c)d+=e>0?c:-c;return parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var d=
this.options.range,c=this.options,e=this,h=!this._animateOff?c.animate:false,g,i={},b,f,j,l;if(this.options.values&&this.options.values.length)this.handles.each(function(o){g=(e.values(o)-e._valueMin())/(e._valueMax()-e._valueMin())*100;i[e.orientation==="horizontal"?"left":"bottom"]=g+"%";a(this).stop(1,1)[h?"animate":"css"](i,c.animate);if(e.options.range===true)if(e.orientation==="horizontal"){if(o===0)e.range.stop(1,1)[h?"animate":"css"]({left:g+"%"},c.animate);if(o===1)e.range[h?"animate":"css"]({width:g-
b+"%"},{queue:false,duration:c.animate})}else{if(o===0)e.range.stop(1,1)[h?"animate":"css"]({bottom:g+"%"},c.animate);if(o===1)e.range[h?"animate":"css"]({height:g-b+"%"},{queue:false,duration:c.animate})}b=g});else{f=this.value();j=this._valueMin();l=this._valueMax();g=l!==j?(f-j)/(l-j)*100:0;i[e.orientation==="horizontal"?"left":"bottom"]=g+"%";this.handle.stop(1,1)[h?"animate":"css"](i,c.animate);if(d==="min"&&this.orientation==="horizontal")this.range.stop(1,1)[h?"animate":"css"]({width:g+"%"},
c.animate);if(d==="max"&&this.orientation==="horizontal")this.range[h?"animate":"css"]({width:100-g+"%"},{queue:false,duration:c.animate});if(d==="min"&&this.orientation==="vertical")this.range.stop(1,1)[h?"animate":"css"]({height:g+"%"},c.animate);if(d==="max"&&this.orientation==="vertical")this.range[h?"animate":"css"]({height:100-g+"%"},{queue:false,duration:c.animate})}}});a.extend(a.ui.slider,{version:"1.8.16"})})(jQuery);
(function(a,d){function c(){return++h}function e(){return++g}var h=0,g=0;a.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:false,cookie:null,collapsible:false,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(true)},_setOption:function(i,b){if(i=="selected")this.options.collapsible&&
b==this.options.selected||this.select(b);else{this.options[i]=b;this._tabify()}},_tabId:function(i){return i.title&&i.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+c()},_sanitizeSelector:function(i){return i.replace(/:/g,"\\:")},_cookie:function(){var i=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+e());return a.cookie.apply(null,[i].concat(a.makeArray(arguments)))},_ui:function(i,b){return{tab:i,panel:b,index:this.anchors.index(i)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var i=
a(this);i.html(i.data("label.tabs")).removeData("label.tabs")})},_tabify:function(i){function b(r,u){r.css("display","");!a.support.opacity&&u.opacity&&r[0].style.removeAttribute("filter")}var f=this,j=this.options,l=/^#.+/;this.list=this.element.find("ol,ul").eq(0);this.lis=a(" > li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return a("a",this)[0]});this.panels=a([]);this.anchors.each(function(r,u){var v=a(u).attr("href"),w=v.split("#")[0],x;if(w&&(w===location.toString().split("#")[0]||
(x=a("base")[0])&&w===x.href)){v=u.hash;u.href=v}if(l.test(v))f.panels=f.panels.add(f.element.find(f._sanitizeSelector(v)));else if(v&&v!=="#"){a.data(u,"href.tabs",v);a.data(u,"load.tabs",v.replace(/#.*$/,""));v=f._tabId(u);u.href="#"+v;u=f.element.find("#"+v);if(!u.length){u=a(j.panelTemplate).attr("id",v).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(f.panels[r-1]||f.list);u.data("destroy.tabs",true)}f.panels=f.panels.add(u)}else j.disabled.push(r)});if(i){this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");
this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.lis.addClass("ui-state-default ui-corner-top");this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");if(j.selected===d){location.hash&&this.anchors.each(function(r,u){if(u.hash==location.hash){j.selected=r;return false}});if(typeof j.selected!=="number"&&j.cookie)j.selected=parseInt(f._cookie(),10);if(typeof j.selected!=="number"&&this.lis.filter(".ui-tabs-selected").length)j.selected=
this.lis.index(this.lis.filter(".ui-tabs-selected"));j.selected=j.selected||(this.lis.length?0:-1)}else if(j.selected===null)j.selected=-1;j.selected=j.selected>=0&&this.anchors[j.selected]||j.selected<0?j.selected:0;j.disabled=a.unique(j.disabled.concat(a.map(this.lis.filter(".ui-state-disabled"),function(r){return f.lis.index(r)}))).sort();a.inArray(j.selected,j.disabled)!=-1&&j.disabled.splice(a.inArray(j.selected,j.disabled),1);this.panels.addClass("ui-tabs-hide");this.lis.removeClass("ui-tabs-selected ui-state-active");
if(j.selected>=0&&this.anchors.length){f.element.find(f._sanitizeSelector(f.anchors[j.selected].hash)).removeClass("ui-tabs-hide");this.lis.eq(j.selected).addClass("ui-tabs-selected ui-state-active");f.element.queue("tabs",function(){f._trigger("show",null,f._ui(f.anchors[j.selected],f.element.find(f._sanitizeSelector(f.anchors[j.selected].hash))[0]))});this.load(j.selected)}a(window).bind("unload",function(){f.lis.add(f.anchors).unbind(".tabs");f.lis=f.anchors=f.panels=null})}else j.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));
this.element[j.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible");j.cookie&&this._cookie(j.selected,j.cookie);i=0;for(var o;o=this.lis[i];i++)a(o)[a.inArray(i,j.disabled)!=-1&&!a(o).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");j.cache===false&&this.anchors.removeData("cache.tabs");this.lis.add(this.anchors).unbind(".tabs");if(j.event!=="mouseover"){var n=function(r,u){u.is(":not(.ui-state-disabled)")&&u.addClass("ui-state-"+r)},k=function(r,u){u.removeClass("ui-state-"+
r)};this.lis.bind("mouseover.tabs",function(){n("hover",a(this))});this.lis.bind("mouseout.tabs",function(){k("hover",a(this))});this.anchors.bind("focus.tabs",function(){n("focus",a(this).closest("li"))});this.anchors.bind("blur.tabs",function(){k("focus",a(this).closest("li"))})}var m,p;if(j.fx)if(a.isArray(j.fx)){m=j.fx[0];p=j.fx[1]}else m=p=j.fx;var q=p?function(r,u){a(r).closest("li").addClass("ui-tabs-selected ui-state-active");u.hide().removeClass("ui-tabs-hide").animate(p,p.duration||"normal",
function(){b(u,p);f._trigger("show",null,f._ui(r,u[0]))})}:function(r,u){a(r).closest("li").addClass("ui-tabs-selected ui-state-active");u.removeClass("ui-tabs-hide");f._trigger("show",null,f._ui(r,u[0]))},s=m?function(r,u){u.animate(m,m.duration||"normal",function(){f.lis.removeClass("ui-tabs-selected ui-state-active");u.addClass("ui-tabs-hide");b(u,m);f.element.dequeue("tabs")})}:function(r,u){f.lis.removeClass("ui-tabs-selected ui-state-active");u.addClass("ui-tabs-hide");f.element.dequeue("tabs")};
this.anchors.bind(j.event+".tabs",function(){var r=this,u=a(r).closest("li"),v=f.panels.filter(":not(.ui-tabs-hide)"),w=f.element.find(f._sanitizeSelector(r.hash));if(u.hasClass("ui-tabs-selected")&&!j.collapsible||u.hasClass("ui-state-disabled")||u.hasClass("ui-state-processing")||f.panels.filter(":animated").length||f._trigger("select",null,f._ui(this,w[0]))===false){this.blur();return false}j.selected=f.anchors.index(this);f.abort();if(j.collapsible)if(u.hasClass("ui-tabs-selected")){j.selected=
-1;j.cookie&&f._cookie(j.selected,j.cookie);f.element.queue("tabs",function(){s(r,v)}).dequeue("tabs");this.blur();return false}else if(!v.length){j.cookie&&f._cookie(j.selected,j.cookie);f.element.queue("tabs",function(){q(r,w)});f.load(f.anchors.index(this));this.blur();return false}j.cookie&&f._cookie(j.selected,j.cookie);if(w.length){v.length&&f.element.queue("tabs",function(){s(r,v)});f.element.queue("tabs",function(){q(r,w)});f.load(f.anchors.index(this))}else throw"jQuery UI Tabs: Mismatching fragment identifier.";
a.browser.msie&&this.blur()});this.anchors.bind("click.tabs",function(){return false})},_getIndex:function(i){if(typeof i=="string")i=this.anchors.index(this.anchors.filter("[href$="+i+"]"));return i},destroy:function(){var i=this.options;this.abort();this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var b=
a.data(this,"href.tabs");if(b)this.href=b;var f=a(this).unbind(".tabs");a.each(["href","load","cache"],function(j,l){f.removeData(l+".tabs")})});this.lis.unbind(".tabs").add(this.panels).each(function(){a.data(this,"destroy.tabs")?a(this).remove():a(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide")});i.cookie&&this._cookie(null,i.cookie);return this},add:function(i,
b,f){if(f===d)f=this.anchors.length;var j=this,l=this.options;b=a(l.tabTemplate.replace(/#\{href\}/g,i).replace(/#\{label\}/g,b));i=!i.indexOf("#")?i.replace("#",""):this._tabId(a("a",b)[0]);b.addClass("ui-state-default ui-corner-top").data("destroy.tabs",true);var o=j.element.find("#"+i);o.length||(o=a(l.panelTemplate).attr("id",i).data("destroy.tabs",true));o.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");if(f>=this.lis.length){b.appendTo(this.list);o.appendTo(this.list[0].parentNode)}else{b.insertBefore(this.lis[f]);
o.insertBefore(this.panels[f])}l.disabled=a.map(l.disabled,function(n){return n>=f?++n:n});this._tabify();if(this.anchors.length==1){l.selected=0;b.addClass("ui-tabs-selected ui-state-active");o.removeClass("ui-tabs-hide");this.element.queue("tabs",function(){j._trigger("show",null,j._ui(j.anchors[0],j.panels[0]))});this.load(0)}this._trigger("add",null,this._ui(this.anchors[f],this.panels[f]));return this},remove:function(i){i=this._getIndex(i);var b=this.options,f=this.lis.eq(i).remove(),j=this.panels.eq(i).remove();
if(f.hasClass("ui-tabs-selected")&&this.anchors.length>1)this.select(i+(i+1<this.anchors.length?1:-1));b.disabled=a.map(a.grep(b.disabled,function(l){return l!=i}),function(l){return l>=i?--l:l});this._tabify();this._trigger("remove",null,this._ui(f.find("a")[0],j[0]));return this},enable:function(i){i=this._getIndex(i);var b=this.options;if(a.inArray(i,b.disabled)!=-1){this.lis.eq(i).removeClass("ui-state-disabled");b.disabled=a.grep(b.disabled,function(f){return f!=i});this._trigger("enable",null,
this._ui(this.anchors[i],this.panels[i]));return this}},disable:function(i){i=this._getIndex(i);var b=this.options;if(i!=b.selected){this.lis.eq(i).addClass("ui-state-disabled");b.disabled.push(i);b.disabled.sort();this._trigger("disable",null,this._ui(this.anchors[i],this.panels[i]))}return this},select:function(i){i=this._getIndex(i);if(i==-1)if(this.options.collapsible&&this.options.selected!=-1)i=this.options.selected;else return this;this.anchors.eq(i).trigger(this.options.event+".tabs");return this},
load:function(i){i=this._getIndex(i);var b=this,f=this.options,j=this.anchors.eq(i)[0],l=a.data(j,"load.tabs");this.abort();if(!l||this.element.queue("tabs").length!==0&&a.data(j,"cache.tabs"))this.element.dequeue("tabs");else{this.lis.eq(i).addClass("ui-state-processing");if(f.spinner){var o=a("span",j);o.data("label.tabs",o.html()).html(f.spinner)}this.xhr=a.ajax(a.extend({},f.ajaxOptions,{url:l,success:function(n,k){b.element.find(b._sanitizeSelector(j.hash)).html(n);b._cleanup();f.cache&&a.data(j,
"cache.tabs",true);b._trigger("load",null,b._ui(b.anchors[i],b.panels[i]));try{f.ajaxOptions.success(n,k)}catch(m){}},error:function(n,k){b._cleanup();b._trigger("load",null,b._ui(b.anchors[i],b.panels[i]));try{f.ajaxOptions.error(n,k,i,j)}catch(m){}}}));b.element.dequeue("tabs");return this}},abort:function(){this.element.queue([]);this.panels.stop(false,true);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));if(this.xhr){this.xhr.abort();delete this.xhr}this._cleanup();return this},
url:function(i,b){this.anchors.eq(i).removeData("cache.tabs").data("load.tabs",b);return this},length:function(){return this.anchors.length}});a.extend(a.ui.tabs,{version:"1.8.16"});a.extend(a.ui.tabs.prototype,{rotation:null,rotate:function(i,b){var f=this,j=this.options,l=f._rotate||(f._rotate=function(o){clearTimeout(f.rotation);f.rotation=setTimeout(function(){var n=j.selected;f.select(++n<f.anchors.length?n:0)},i);o&&o.stopPropagation()});b=f._unrotate||(f._unrotate=!b?function(o){o.clientX&&
f.rotate(null)}:function(){t=j.selected;l()});if(i){this.element.bind("tabsshow",l);this.anchors.bind(j.event+".tabs",b);l()}else{clearTimeout(f.rotation);this.element.unbind("tabsshow",l);this.anchors.unbind(j.event+".tabs",b);delete this._rotate;delete this._unrotate}return this}})})(jQuery);
};

},{}],29:[function(require,module,exports){
/*!
 * jQuery UI Touch Punch 0.2.2
 *
 * Copyright 2011, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
module.exports = function ($) {

  // Detect touch support
  $.support.touch = 'ontouchend' in document;

  // Ignore browsers without touch support
  if (!$.support.touch) {
    return;
  }

  var mouseProto = $.ui.mouse.prototype,
      _mouseInit = mouseProto._mouseInit,
      touchHandled;

  /**
   * Simulate a mouse event based on a corresponding touch event
   * @param {Object} event A touch event
   * @param {String} simulatedType The corresponding mouse event
   */
  function simulateMouseEvent (event, simulatedType) {

    // Ignore multi-touch events
    if (event.originalEvent.touches.length > 1) {
      return;
    }

    event.preventDefault();

    var touch = event.originalEvent.changedTouches[0],
        simulatedEvent = document.createEvent('MouseEvents');
    
    // Initialize the simulated mouse event using the touch event's coordinates
    simulatedEvent.initMouseEvent(
      simulatedType,    // type
      true,             // bubbles                    
      true,             // cancelable                 
      window,           // view                       
      1,                // detail                     
      touch.screenX,    // screenX                    
      touch.screenY,    // screenY                    
      touch.clientX,    // clientX                    
      touch.clientY,    // clientY                    
      false,            // ctrlKey                    
      false,            // altKey                     
      false,            // shiftKey                   
      false,            // metaKey                    
      0,                // button                     
      null              // relatedTarget              
    );

    // Dispatch the simulated event to the target element
    event.target.dispatchEvent(simulatedEvent);
  }

  /**
   * Handle the jQuery UI widget's touchstart events
   * @param {Object} event The widget element's touchstart event
   */
  mouseProto._touchStart = function (event) {

    var self = this;

    // Ignore the event if another widget is already being handled
    if (touchHandled || !self._mouseCapture(event.originalEvent.changedTouches[0])) {
      return;
    }
    
    // Set the flag to prevent other widgets from inheriting the touch event
    touchHandled = true;

    // Track movement to determine if interaction was a click
    self._touchMoved = false;

    // Simulate the mouseover event
    simulateMouseEvent(event, 'mouseover');

    // Simulate the mousemove event
    simulateMouseEvent(event, 'mousemove');

    // Simulate the mousedown event
    simulateMouseEvent(event, 'mousedown');
    
  };

  /**
   * Handle the jQuery UI widget's touchmove events
   * @param {Object} event The document's touchmove event
   */
  mouseProto._touchMove = function (event) {

    // Ignore event if not handled
    if (!touchHandled) {
      return;
    }

    // Interaction was not a click
    this._touchMoved = true;

    // Simulate the mousemove event
    simulateMouseEvent(event, 'mousemove');
  };

  /**
   * Handle the jQuery UI widget's touchend events
   * @param {Object} event The document's touchend event
   */
  mouseProto._touchEnd = function (event) {

    // Ignore event if not handled
    if (!touchHandled) {
      return;
    }

    // Simulate the mouseup event
    simulateMouseEvent(event, 'mouseup');

    // Simulate the mouseout event
    simulateMouseEvent(event, 'mouseout');

    // If the touch interaction did not move, it should trigger a click
    if (!this._touchMoved) {

      // Simulate the click event
      simulateMouseEvent(event, 'click');
    }

    // Unset the flag to allow other widgets to inherit the touch event
    touchHandled = false;
  };

  /**
   * A duck punch of the $.ui.mouse _mouseInit method to support touch events.
   * This method extends the widget with bound touch event handlers that
   * translate touch events to mouse events and pass them to the widget's
   * original mouse event handling methods.
   */
  mouseProto._mouseInit = function () {
    
    var self = this;

    // Delegate the touch handlers to the widget's element
    self.element
      .bind('touchstart', $.proxy(self, '_touchStart'))
      .bind('touchmove', $.proxy(self, '_touchMove'))
      .bind('touchend', $.proxy(self, '_touchEnd'));

    // Call the original $.ui.mouse init method
    _mouseInit.call(self);
  };

};
},{}],30:[function(require,module,exports){
/**
 * Farbtastic Color Picker 1.2
 *  2008 Steven Wittens
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 */

module.exports = function(jQuery) {

jQuery.fn.farbtastic = function (callback) {
  $.farbtastic(this, callback);
  return this;
};

jQuery.farbtastic = function (container, callback) {
  var container = $(container).get(0);
  return container.farbtastic || (container.farbtastic = new jQuery._farbtastic(container, callback));
}

jQuery._farbtastic = function (container, callback) {
  // Store farbtastic object
  var fb = this;

  // Insert markup
  $(container).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');
  var e = $('.farbtastic', container);
  fb.wheel = $('.wheel', container).get(0);
  // Dimensions
  fb.radius = 84;
  fb.square = 100;
  fb.width = 194;

  // Fix background PNGs in IE6
  if (navigator.appVersion.match(/MSIE [0-6]\./)) {
    $('*', e).each(function () {
      if (this.currentStyle.backgroundImage != 'none') {
        var image = this.currentStyle.backgroundImage;
        image = this.currentStyle.backgroundImage.substring(5, image.length - 2);
        $(this).css({
          'backgroundImage': 'none',
          'filter': "progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='" + image + "')"
        });
      }
    });
  }

  /**
   * Link to the given element(s) or callback.
   */
  fb.linkTo = function (callback) {
    // Unbind previous nodes
    if (typeof fb.callback == 'object') {
      $(fb.callback).unbind('keyup', fb.updateValue);
    }

    // Reset color
    fb.color = null;

    // Bind callback or elements
    if (typeof callback == 'function') {
      fb.callback = callback;
    }
    else if (typeof callback == 'object' || typeof callback == 'string') {
      fb.callback = $(callback);
      fb.callback.bind('keyup change blur', fb.updateValue);
      if (fb.callback.get(0).value) {
        fb.setColor(fb.callback.get(0).value);
      }
    }
    return this;
  }
  fb.updateValue = function (event) {
    if (this.value && this.value != fb.color) {
      fb.setColor(this.value);
    }
  }

  /**
   * Change color with HTML syntax #123456
   */
  fb.setColor = function (color) {
    var unpack = fb.unpack(color);
    if (fb.color != color && unpack) {
      fb.color = color;
      fb.rgb = unpack;
      fb.hsl = fb.RGBToHSL(fb.rgb);
      fb.updateDisplay();
    }
    return this;
  }

  /**
   * Change color with HSL triplet [0..1, 0..1, 0..1]
   */
  fb.setHSL = function (hsl) {
    fb.hsl = hsl;
    fb.rgb = fb.HSLToRGB(hsl);
    fb.color = fb.pack(fb.rgb);
    fb.updateDisplay();
    return this;
  }

  /////////////////////////////////////////////////////

  /**
   * Retrieve the coordinates of the given event relative to the center
   * of the widget.
   */
  fb.widgetCoords = function (event) {
    var x, y;
    var el = event.target || event.srcElement;
    var reference = fb.wheel;

    if (typeof event.offsetX != 'undefined') {
      // Use offset coordinates and find common offsetParent
      var pos = { x: event.offsetX, y: event.offsetY };

      // Send the coordinates upwards through the offsetParent chain.
      var e = el;
      while (e) {
        e.mouseX = pos.x;
        e.mouseY = pos.y;
        pos.x += e.offsetLeft;
        pos.y += e.offsetTop;
        e = e.offsetParent;
      }

      // Look for the coordinates starting from the wheel widget.
      var e = reference;
      var offset = { x: 0, y: 0 }
      while (e) {
        if (typeof e.mouseX != 'undefined') {
          x = e.mouseX - offset.x;
          y = e.mouseY - offset.y;
          break;
        }
        offset.x += e.offsetLeft;
        offset.y += e.offsetTop;
        e = e.offsetParent;
      }

      // Reset stored coordinates
      e = el;
      while (e) {
        e.mouseX = undefined;
        e.mouseY = undefined;
        e = e.offsetParent;
      }
    }
    else {
      // Use absolute coordinates
      var pos = fb.absolutePosition(reference);
      x = (event.pageX || 0*(event.clientX + $('html').get(0).scrollLeft)) - pos.x;
      y = (event.pageY || 0*(event.clientY + $('html').get(0).scrollTop)) - pos.y;
    }
    // Subtract distance to middle
    return { x: x - fb.width / 2, y: y - fb.width / 2 };
  }

  /**
   * Mousedown handler
   */
  fb.mousedown = function (event) {
    // Capture mouse
    if (!document.dragging) {
      $(document).bind('mousemove', fb.mousemove).bind('mouseup', fb.mouseup);
      document.dragging = true;
    }

    // Check which area is being dragged
    var pos = fb.widgetCoords(event);
    fb.circleDrag = Math.max(Math.abs(pos.x), Math.abs(pos.y)) * 2 > fb.square;

    // Process
    fb.mousemove(event);
    return false;
  }

  /**
   * Mousemove handler
   */
  fb.mousemove = function (event) {
    // Get coordinates relative to color picker center
    var pos = fb.widgetCoords(event);

    // Set new HSL parameters
    if (fb.circleDrag) {
      var hue = Math.atan2(pos.x, -pos.y) / 6.28;
      if (hue < 0) hue += 1;
      fb.setHSL([hue, fb.hsl[1], fb.hsl[2]]);
    }
    else {
      var sat = Math.max(0, Math.min(1, -(pos.x / fb.square) + .5));
      var lum = Math.max(0, Math.min(1, -(pos.y / fb.square) + .5));
      fb.setHSL([fb.hsl[0], sat, lum]);
    }
    return false;
  }

  /**
   * Mouseup handler
   */
  fb.mouseup = function () {
    // Uncapture mouse
    $(document).unbind('mousemove', fb.mousemove);
    $(document).unbind('mouseup', fb.mouseup);
    document.dragging = false;
  }

  /**
   * Update the markers and styles
   */
  fb.updateDisplay = function () {
    // Markers
    var angle = fb.hsl[0] * 6.28;
    $('.h-marker', e).css({
      left: Math.round(Math.sin(angle) * fb.radius + fb.width / 2) + 'px',
      top: Math.round(-Math.cos(angle) * fb.radius + fb.width / 2) + 'px'
    });

    $('.sl-marker', e).css({
      left: Math.round(fb.square * (.5 - fb.hsl[1]) + fb.width / 2) + 'px',
      top: Math.round(fb.square * (.5 - fb.hsl[2]) + fb.width / 2) + 'px'
    });

    // Saturation/Luminance gradient
    $('.color', e).css('backgroundColor', 'rgb(' + fb.pack(fb.HSLToRGB([fb.hsl[0], 1, 0.5])) + ')');

    // Linked elements or callback
    if (typeof fb.callback == 'object') {
      // Set background/foreground color
      $(fb.callback).css({
        backgroundColor: 'rgb(' + fb.color + ')',
        color: fb.hsl[2] > 0.5 ? '#000' : '#fff'
      });

      // Change linked value
      $(fb.callback).each(function() {
        if (this.value != fb.color) {
          this.value = fb.color;
        }
      });
    }
    else if (typeof fb.callback == 'function') {
      fb.callback.call(fb, fb.color);
    }
  }

  /**
   * Get absolute position of element
   */
  fb.absolutePosition = function (el) {
    var r = { x: el.offsetLeft, y: el.offsetTop };
    // Resolve relative to offsetParent
    if (el.offsetParent) {
      var tmp = fb.absolutePosition(el.offsetParent);
      r.x += tmp.x;
      r.y += tmp.y;
    }
    return r;
  };

  /* Various color utility functions */
  fb.pack = function (rgb, hex) {
    var r = Math.round(rgb[0] * 255);
    var g = Math.round(rgb[1] * 255);
    var b = Math.round(rgb[2] * 255);
    if (hex) {
      return '#' + (r < 16 ? '0' : '') + r.toString(16) +
             (g < 16 ? '0' : '') + g.toString(16) +
             (b < 16 ? '0' : '') + b.toString(16);
    } else {
      return r.toString() + ',' + g.toString() + ',' + b.toString();
    }
  }

  fb.unpack = function (color) {
    if ((/\d+,\d+,\d/).test(color)) {
      var nums = color.split(/,/);
      return [parseInt(nums[0], 10) / 255,
        parseInt(nums[1], 10) / 255,
        parseInt(nums[2], 10) / 255];
    }
    else if (color.length == 7) {
      return [parseInt('0x' + color.substring(1, 3)) / 255,
        parseInt('0x' + color.substring(3, 5)) / 255,
        parseInt('0x' + color.substring(5, 7)) / 255];
    }
    else if (color.length == 4) {
      return [parseInt('0x' + color.substring(1, 2)) / 15,
        parseInt('0x' + color.substring(2, 3)) / 15,
        parseInt('0x' + color.substring(3, 4)) / 15];
    }
  }

  fb.HSLToRGB = function (hsl) {
    var m1, m2, r, g, b;
    var h = hsl[0], s = hsl[1], l = hsl[2];
    m2 = (l <= 0.5) ? l * (s + 1) : l + s - l*s;
    m1 = l * 2 - m2;
    return [this.hueToRGB(m1, m2, h+0.33333),
        this.hueToRGB(m1, m2, h),
        this.hueToRGB(m1, m2, h-0.33333)];
  }

  fb.hueToRGB = function (m1, m2, h) {
    h = (h < 0) ? h + 1 : ((h > 1) ? h - 1 : h);
    if (h * 6 < 1) return m1 + (m2 - m1) * h * 6;
    if (h * 2 < 1) return m2;
    if (h * 3 < 2) return m1 + (m2 - m1) * (0.66666 - h) * 6;
    return m1;
  }

  fb.RGBToHSL = function (rgb) {
    var min, max, delta, h, s, l;
    var r = rgb[0], g = rgb[1], b = rgb[2];
    min = Math.min(r, Math.min(g, b));
    max = Math.max(r, Math.max(g, b));
    delta = max - min;
    l = (min + max) / 2;
    s = 0;
    if (l > 0 && l < 1) {
      s = delta / (l < 0.5 ? (2 * l) : (2 - 2 * l));
    }
    h = 0;
    if (delta > 0) {
      if (max == r && max != g) h += (g - b) / delta;
      if (max == g && max != b) h += (2 + (b - r) / delta);
      if (max == b && max != r) h += (4 + (r - g) / delta);
      h /= 6;
    }
    return [h, s, l];
  }

  // Install mousedown handler (the others are set on the document on-demand)
  $('*', e).mousedown(fb.mousedown);

    // Init color
  fb.setColor('#000000');

  // Set linked elements/callback
  if (callback) {
    fb.linkTo(callback);
  }
}

};
},{}],31:[function(require,module,exports){
// ================================================================
// = The following are short jQuery extensions used by chromozoom =
// ================================================================

module.exports = function($) {
  
var utils = require('./utils.js')($),
  floorHack = utils.floorHack;

// Make a unique ID for an arbitary element, using the given prefix string
$.uniqId = function(prefix, alsoDisallow) {
  var rand = function() { return floorHack(Math.random()*1000000); };
  var num = rand();
  while ((alsoDisallow && alsoDisallow[num]) || $('#'+prefix+'-'+num).length) { num = rand(); }
  return prefix+'-'+num;
};

// Make a new element (faster than $("<elem/>"))
$.mk = function(NS, elem) { 
  return (elem && document.createElementNS) ? $(document.createElementNS(NS, elem)) 
    : $(document.createElement(elem = NS)); 
}

// jQuery Hotkeys Plugin, copyright 2010, John Resig
// Dual licensed under the MIT or GPL Version 2 licenses
// https://github.com/jeresig/jquery.hotkeys
$.hotkeys = {
  version: "0.8",

  specialKeys: {
    8: "backspace", 9: "tab", 13: "return", 16: "shift", 17: "ctrl", 18: "alt", 19: "pause",
    20: "capslock", 27: "esc", 32: "space", 33: "pageup", 34: "pagedown", 35: "end", 36: "home",
    37: "left", 38: "up", 39: "right", 40: "down", 45: "insert", 46: "del", 
    96: "0", 97: "1", 98: "2", 99: "3", 100: "4", 101: "5", 102: "6", 103: "7",
    104: "8", 105: "9", 106: "*", 107: "+", 109: "-", 110: ".", 111 : "/", 
    112: "f1", 113: "f2", 114: "f3", 115: "f4", 116: "f5", 117: "f6", 118: "f7", 119: "f8", 
    120: "f9", 121: "f10", 122: "f11", 123: "f12", 144: "numlock", 145: "scroll", 191: "/", 224: "meta"
  },

  shiftNums: {
    "`": "~", "1": "!", "2": "@", "3": "#", "4": "$", "5": "%", "6": "^", "7": "&", 
    "8": "*", "9": "(", "0": ")", "-": "_", "=": "+", ";": ": ", "'": "\"", ",": "<", 
    ".": ">",  "/": "?",  "\\": "|"
  }
};

function keyHandler( handleObj ) {
  // Only care when a possible input has been specified
  if ( typeof handleObj.data !== "string" ) {
    return;
  }

  var origHandler = handleObj.handler,
    keys = handleObj.data.toLowerCase().split(" ");

  handleObj.handler = function( event ) {
    // Don't fire in text-accepting inputs that we didn't directly bind to
    if ( this !== event.target && (/textarea|select/i.test( event.target.nodeName ) ||
      event.target.type === "text" || event.target.type == "search" || event.target.type === "url") ) {
      return;
    }

    // Keypress represents characters, not special keys
    var special = event.type !== "keypress" && $.hotkeys.specialKeys[ event.which ],
      character = String.fromCharCode( event.which ).toLowerCase(),
      key, modif = "", possible = {};

    // check combinations (alt|ctrl|shift+anything)
    if ( event.altKey && special !== "alt" ) {
      modif += "alt+";
    }

    if ( event.ctrlKey && special !== "ctrl" ) {
      modif += "ctrl+";
    }

    // TODO: Need to make sure this works consistently across platforms
    if ( event.metaKey && !event.ctrlKey && special !== "meta" ) {
      modif += "meta+";
    }

    if ( event.shiftKey && special !== "shift" ) {
      modif += "shift+";
    }

    if ( special ) {
      possible[ modif + special ] = true;

    } else {
      possible[ modif + character ] = true;
      possible[ modif + $.hotkeys.shiftNums[ character ] ] = true;

      // "$" can be triggered as "Shift+4" or "Shift+$" or just "$"
      if ( modif === "shift+" ) {
        possible[ $.hotkeys.shiftNums[ character ] ] = true;
      }
    }

    for ( var i = 0, l = keys.length; i < l; i++ ) {
      if ( possible[ keys[i] ] ) {
        return origHandler.apply( this, arguments );
      }
    }
  };
}

$.each([ "keydown", "keyup", "keypress" ], function() {
  $.event.special[ this ] = { add: keyHandler };
});

// jQuery sortElements by James Padolsey, dual licensed MIT/GPL
// Found at https://github.com/padolsey/jQuery-Plugins/tree/master/sortElements/
$.fn.sortElements = (function(){
  var sort = [].sort;
  return function(comparator, getSortable) {
    getSortable = getSortable || function(){return this;};
    var placements = this.map(function(){
      var sortElement = getSortable.call(this),
        parentNode = sortElement.parentNode,
        // Since the element itself will change position, we have
        // to have some way of storing its original position in
        // the DOM. The easiest way is to have a 'flag' node:
        nextSibling = parentNode.insertBefore(
          document.createTextNode(''),
          sortElement.nextSibling
        );
      return function() {
        if (parentNode === this) {
          throw "You can't sort elements if any one is a descendant of another.";
        }
        // Insert before flag:
        parentNode.insertBefore(this, nextSibling);
        // Remove flag:
        parentNode.removeChild(nextSibling);
      };
    });

    return sort.call(this, comparator).each(function(i){
      placements[i].call(getSortable.call(this));
    });
  };
})();

// jQuery Cookie Plugin, found at https://github.com/carhartl/jquery-cookie
// Copyright 2011, Klaus Hartl
// Dual licensed under the MIT or GPL Version 2 licenses.
(function($) {
  $.cookie = function(key, value, options) {
    // key and at least value given, set cookie...
    if (arguments.length > 1 && (!/Object/.test(Object.prototype.toString.call(value)) || value === null || value === undefined)) {
      options = $.extend({}, options);

      if (value === null || value === undefined) {
        options.expires = -1;
      }

      if (typeof options.expires === 'number') {
        var days = options.expires, t = options.expires = new Date();
        t.setDate(t.getDate() + days);
      }

      value = String(value);

      return (document.cookie = [
        encodeURIComponent(key), '=', options.raw ? value : encodeURIComponent(value),
        // use expires attribute, max-age is not supported by IE
        options.expires ? '; expires=' + options.expires.toUTCString() : '',
        options.path    ? '; path=' + options.path : '',
        options.domain  ? '; domain=' + options.domain : '',
        options.secure  ? '; secure' : ''
      ].join(''));
    }

    // key and possibly options given, get cookie...
    options = value || {};
    var decode = options.raw ? function(s) { return s; } : decodeURIComponent;

    var pairs = document.cookie.split('; ');
    for (var i = 0, pair; pair = pairs[i] && pairs[i].split('='); i++) {
      // IE saves cookies with empty string as "c; ", e.g. without "=" as opposed to EOMB, thus pair[1] may be undefined
      if (decode(pair[0]) === key) return decode(pair[1] || '');
    }
    return null;
  };
})($);

// http://stackoverflow.com/questions/901115/get-query-string-values-in-javascript
$.urlParams = function() {
  var p = {},
    e,
    a = /\+/g,  // Regex for replacing addition symbol with a space
    r = /([^&=]+)=?([^&]*)/g,
    d = function (s) { return decodeURIComponent(s.replace(a, " ")); },
    q = window.location.search.substring(1);

  while (e = r.exec(q)) { 
    var k = d(e[1]), v = d(e[2]); 
    p[k] = p[k] ? (_.isArray(p[k]) ? p[k].push(v) : [p[k], v]) : v; 
  }
  return p;
};

};
},{"./utils.js":33}],32:[function(require,module,exports){
 /*
 * TipTip
 * Copyright 2010 Drew Wilson
 * www.drewwilson.com
 * code.drewwilson.com/entry/tiptip-jquery-plugin
 *
 * Version 1.3   -   Updated: Mar. 23, 2010
 *
 * This Plug-In will create a custom tooltip to replace the default
 * browser tooltip. It is extremely lightweight and very smart in
 * that it detects the edges of the browser window and will make sure
 * the tooltip stays within the current window size. As a result the
 * tooltip will adjust itself to be displayed above, below, to the left 
 * or to the right depending on what is necessary to stay within the
 * browser window. It is completely customizable as well via CSS.
 *
 * This TipTip jQuery plug-in is dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */

var _ = require('../underscore.min.js');

module.exports = function($){
    
  var defaults = { 
    activation: "hover",
    keepAlive: false,
    edgeOffset: 3,
    defaultPosition: "bottom",
    delay: 400,
    fadeIn: 200,
    fadeOut: 200,
    attribute: "title",
    content: false, // HTML or String to fill TipTIp with
    enter: function(){},
    async: false,
    startActivated: false
  };
  var $tiptip_holder, $tiptip_content, $tiptip_arrow, activating_elem;
  
  function show_tiptip(opts) { 
    $tiptip_holder.stop(true, true).fadeIn(opts.fadeIn);
    if (opts.async && !$(this).data('tiptipActive')) { return; }
    
  };
  
  function fill_show_tiptip(d, self, content) {
    var opts = d.opts,
      $org_elem = d.org_elem,
      org_title = content ? content : d.org_title,
      timeout = $(self).data('tiptipTimeout'),
      active = $(self).data('tiptipActive'),
      firedAfter = (new Date).getTime() - active;
      
    if (opts.async) {
      if (!active) { return; }
      if (content === false) { $(this).data('tiptipActive', false); return; }
    }
    
    if (_.isString(org_title)) { $tiptip_content.html(org_title); }
    else { $tiptip_content.empty().append(org_title); }
    $tiptip_holder.removeAttr("class").css("margin", 0);
    $tiptip_arrow.removeAttr("style");

    var offset = $org_elem.offset(),
      top = offset.top,
      left = offset.left,
      scroll_top = $(window).scrollTop(),
      scroll_left = $(window).scrollLeft(),
      win_width = $(window).width(),
      win_height = $(window).height(),
      org_width = $org_elem.outerWidth(),
      org_height = $org_elem.outerHeight();

    if (left - scroll_left >= 0) { org_width = Math.min(org_width, win_width - (left - scroll_left)); }
    else { org_width += (left - scroll_left); left = scroll_left; }
    
    var tip_w = $tiptip_holder.outerWidth(),
      tip_h = $tiptip_holder.outerHeight(),
      w_compare = Math.round((org_width - tip_w) / 2),
      h_compare = Math.round((org_height - tip_h) / 2),
      marg_left = Math.round(left + w_compare),
      marg_top = Math.round(top + org_height + opts.edgeOffset),
      t_class = "",
      arrow_top = "",
      arrow_left = Math.round(tip_w - 12) / 2;

    t_class = "_" + opts.defaultPosition;

    var right_compare = (w_compare + left) < scroll_left,
      left_compare = (tip_w + left) > win_width;

    if ((right_compare && w_compare < 0) || (t_class == "_right" && !left_compare) 
        || (t_class == "_left" && left < (tip_w + opts.edgeOffset + 5))) {
      t_class = "_right";
      arrow_top = Math.round(tip_h - 13) / 2;
      arrow_left = -12;
      marg_left = Math.round(left + org_width + opts.edgeOffset);
      marg_top = Math.round(top + h_compare);
    } else if((left_compare && w_compare < 0) || (t_class == "_left" && !right_compare)){
      t_class = "_left";
      arrow_top = Math.round(tip_h - 13) / 2;
      arrow_left =  Math.round(tip_w);
      marg_left = Math.round(left - (tip_w + opts.edgeOffset + 5));
      marg_top = Math.round(top + h_compare);
    }

    var top_compare = (top + org_height + opts.edgeOffset + tip_h + 8) > win_height + scroll_top,
      bottom_compare = ((top + org_height) - (opts.edgeOffset + tip_h + 8)) < 0;

    if(top_compare || (t_class == "_bottom" && top_compare) || (t_class == "_top" && !bottom_compare)){
      if(t_class == "_top" || t_class == "_bottom"){
        t_class = "_top";
      } else {
        t_class = t_class+"_top";
      }
      arrow_top = tip_h;
      marg_top = Math.round(top - (tip_h + 5 + opts.edgeOffset));
    } else if(bottom_compare | (t_class == "_top" && bottom_compare) || (t_class == "_bottom" && !top_compare)){
      if(t_class == "_top" || t_class == "_bottom"){
        t_class = "_bottom";
      } else {
        t_class = t_class+"_bottom";
      }
      arrow_top = -12;            
      marg_top = Math.round(top + org_height + opts.edgeOffset);
    }

    if(t_class == "_right_top" || t_class == "_left_top"){
      marg_top = marg_top + 5;
    } else if(t_class == "_right_bottom" || t_class == "_left_bottom"){   
      marg_top = marg_top - 5;
    }
    if(t_class == "_left_top" || t_class == "_left_bottom"){  
      marg_left = marg_left + 5;
    }
    $tiptip_arrow.css({"margin-left": arrow_left+"px", "margin-top": arrow_top+"px"});
    $tiptip_holder.css({"margin-left": marg_left+"px", "margin-top": marg_top+"px"}).attr("class", "tip"+t_class);

    if (timeout) { clearTimeout(timeout); }
    if (firedAfter > opts.delay) { show_tiptip(opts); } 
    else { $(self).data('tiptipTimeout', setTimeout(_.bind(show_tiptip, self, opts), opts.delay - firedAfter)); }
  }

  function active_tiptip(e) {
    var self = this,
      d = e.data,
      content;
    $(this).data('tiptipActive', (new Date).getTime());
    if (activating_elem && activating_elem != self) { $.tipTip.hide(); }
    activating_elem = self;
    if (d.opts.async) { d.opts.enter.call(this, function(newContent) { fill_show_tiptip(d, self, newContent); }); }
    else {
      content = d.opts.enter.call(this);
      fill_show_tiptip(d, this, content); 
    }
    return d.retFalse ? false : null;
  }
  
  function deactive_tiptip(e, now) {
    var d = e.data,
      timeout = $(this).data('tiptipTimeout');
    $(this).data('tiptipActive', false);
    if (timeout){ clearTimeout(timeout); }
    activating_elem = null;
    $tiptip_holder.fadeOut(now ? d.opts.fadeOut : 0);
  }
  
  $.tipTip = {
    hide: function() {
      var $active = $(activating_elem);
      if ($active.parent().length > 0) { $active.trigger('hideTipTip'); } 
      else { $tiptip_holder && $tiptip_holder.hide(); }
      activating_elem = null;
    }
  };
  
  $.fn.tipTip = function(options) {
    var opts = $.extend({}, defaults, options);
    
    // Setup tip tip elements and render them to the DOM, if this wasn't already done previously
    if(typeof $tiptip_holder == 'undefined'){
      $tiptip_holder = $('<div id="tiptip_holder"></div>');
      $tiptip_content = $('<div id="tiptip_content"></div>');
      $tiptip_arrow = $('<div id="tiptip_arrow"></div>');
      $("body").append($tiptip_holder.html($tiptip_content).prepend($tiptip_arrow.html('<div id="tiptip_arrow_inner"></div>')));
    }
    
    return this.each(function(){
      var $org_elem = $(this);
      
      if (opts.content) {
        var org_title = opts.content;
      } else {
        var org_title = $org_elem.attr(opts.attribute);
      }
      
      if (org_title != "" || opts.async) {
        $org_elem.data('title', org_title);
        $org_elem.removeAttr(opts.attribute); //remove original Attribute
        var edata = {org_elem: $org_elem, org_title: org_title, opts: opts};
        
        if (opts.activation == "hover") {
          $org_elem.bind('mouseenter showTipTip', edata, active_tiptip);
          if (opts.keepAlive) { $tiptip_holder.bind('mouseleave hideTipTip', edata, deactive_tiptip); }
          else { $org_elem.bind('mouseleave hideTipTip', edata, deactive_tiptip); }
        } else if (opts.activation == "focus") {
          $org_elem.bind('focus showTipTip', edata, active_tiptip).bind('blur hideTipTip', edata, deactive_tiptip);
        } else if (opts.activation == "click") {
          $org_elem.bind('click showTipTip', $.extend({retFalse: true}, edata), active_tiptip);
          if(opts.keepAlive){ $tiptip_holder.bind('mouseleave hideTipTip', edata, deactive_tiptip); } 
          else { $org_elem.bind('mouseleave hideTipTip', edata, deactive_tiptip); }
        }
        if (opts.startActivated) { $org_elem.trigger('showTipTip'); }
      }
    });
  }
};
},{"../underscore.min.js":34}],33:[function(require,module,exports){
module.exports = function($) {
  // ==================================================================================
  // = The following are helper functions used widely throughout the rest of the code =
  // ==================================================================================
  
  utils = {};
  
  // Faster than Math.floor (http://webdood.com/?p=219)
  utils.floorHack = function(num) { return (num << 0) - (num < 0 ? 1 : 0); }
  
  // Pads a number with front-leading 0's to given length
  utils.pad = function(number, length) {
    var str = '' + number;
    while (str.length < length) { str = '0' + str; }
    return str;
  }

  // Turns an arbitrary string into something that can be used as an element's class
  utils.classFriendly = function(val) { return val.toString().replace(/[^_a-zA-Z0-9-]/g, '-'); }
  
  // Mostly for debugging; show the fps in the bottom-right corner of the browser
  utils.fps = function(a, b, c) {
    $('#fps').text(a + ' ' + utils.floorHack(1000/b) + ' ' + utils.floorHack(c*10)/10 + ' ' + $('#browser *').length);
  }
  
  // A simplistic hash function for quickly turning strings into numbers
  // Note that since the hash space is 2^32, collisions are practically guaranteed after 80k strings, 
  // and there's a 5% chance at 20k: http://betterexplained.com/articles/understanding-the-birthday-paradox/
  utils.shortHash = function(str) {
    var hash = 0;
    if (str.length == 0) return hash;
    for (i = 0; i < str.length; i++) {
      chr = str.charCodeAt(i);
      hash = ((hash<<5)-hash)+chr;
      hash = hash & hash;
    }
    return hash;
  }
  
  // Get the last name in a path-like string (after the last slash/backslash)
  utils.basename = function(path) { return path.replace(/^.*[\/\\]/g, ''); };
  
  // Decode characters that are safe within our query strings, for increased readability
  utils.decodeSafeOctets = function(query) {
    var safe = {'3A': ':', '40': '@', '7C': '|', '2F': '/'};
    return query.replace(/%([0-9A-F]{2})/gi, function(m, oct) { return safe[oct] || m; });
  }
  
  // Escape something so it can be inserted into a regular expression
  utils.regExpQuote = function(str) { return str.replace(/([.?*+^$[\]\\(){}-])/g, "\\$1"); };
  
  return utils;
  
};
},{}],34:[function(require,module,exports){
//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.
(function(){function n(n){function t(t,r,e,u,i,o){for(;i>=0&&o>i;i+=n){var a=u?u[i]:i;e=r(e,t[a],a,t)}return e}return function(r,e,u,i){e=b(e,i,4);var o=!k(r)&&m.keys(r),a=(o||r).length,c=n>0?0:a-1;return arguments.length<3&&(u=r[o?o[c]:c],c+=n),t(r,e,u,o,c,a)}}function t(n){return function(t,r,e){r=x(r,e);for(var u=O(t),i=n>0?0:u-1;i>=0&&u>i;i+=n)if(r(t[i],i,t))return i;return-1}}function r(n,t,r){return function(e,u,i){var o=0,a=O(e);if("number"==typeof i)n>0?o=i>=0?i:Math.max(i+a,o):a=i>=0?Math.min(i+1,a):i+a+1;else if(r&&i&&a)return i=r(e,u),e[i]===u?i:-1;if(u!==u)return i=t(l.call(e,o,a),m.isNaN),i>=0?i+o:-1;for(i=n>0?o:a-1;i>=0&&a>i;i+=n)if(e[i]===u)return i;return-1}}function e(n,t){var r=I.length,e=n.constructor,u=m.isFunction(e)&&e.prototype||a,i="constructor";for(m.has(n,i)&&!m.contains(t,i)&&t.push(i);r--;)i=I[r],i in n&&n[i]!==u[i]&&!m.contains(t,i)&&t.push(i)}var u=this,i=u._,o=Array.prototype,a=Object.prototype,c=Function.prototype,f=o.push,l=o.slice,s=a.toString,p=a.hasOwnProperty,h=Array.isArray,v=Object.keys,g=c.bind,y=Object.create,d=function(){},m=function(n){return n instanceof m?n:this instanceof m?void(this._wrapped=n):new m(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=m),exports._=m):u._=m,m.VERSION="1.8.3";var b=function(n,t,r){if(t===void 0)return n;switch(null==r?3:r){case 1:return function(r){return n.call(t,r)};case 2:return function(r,e){return n.call(t,r,e)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,i){return n.call(t,r,e,u,i)}}return function(){return n.apply(t,arguments)}},x=function(n,t,r){return null==n?m.identity:m.isFunction(n)?b(n,t,r):m.isObject(n)?m.matcher(n):m.property(n)};m.iteratee=function(n,t){return x(n,t,1/0)};var _=function(n,t){return function(r){var e=arguments.length;if(2>e||null==r)return r;for(var u=1;e>u;u++)for(var i=arguments[u],o=n(i),a=o.length,c=0;a>c;c++){var f=o[c];t&&r[f]!==void 0||(r[f]=i[f])}return r}},j=function(n){if(!m.isObject(n))return{};if(y)return y(n);d.prototype=n;var t=new d;return d.prototype=null,t},w=function(n){return function(t){return null==t?void 0:t[n]}},A=Math.pow(2,53)-1,O=w("length"),k=function(n){var t=O(n);return"number"==typeof t&&t>=0&&A>=t};m.each=m.forEach=function(n,t,r){t=b(t,r);var e,u;if(k(n))for(e=0,u=n.length;u>e;e++)t(n[e],e,n);else{var i=m.keys(n);for(e=0,u=i.length;u>e;e++)t(n[i[e]],i[e],n)}return n},m.map=m.collect=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=Array(u),o=0;u>o;o++){var a=e?e[o]:o;i[o]=t(n[a],a,n)}return i},m.reduce=m.foldl=m.inject=n(1),m.reduceRight=m.foldr=n(-1),m.find=m.detect=function(n,t,r){var e;return e=k(n)?m.findIndex(n,t,r):m.findKey(n,t,r),e!==void 0&&e!==-1?n[e]:void 0},m.filter=m.select=function(n,t,r){var e=[];return t=x(t,r),m.each(n,function(n,r,u){t(n,r,u)&&e.push(n)}),e},m.reject=function(n,t,r){return m.filter(n,m.negate(x(t)),r)},m.every=m.all=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=0;u>i;i++){var o=e?e[i]:i;if(!t(n[o],o,n))return!1}return!0},m.some=m.any=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=0;u>i;i++){var o=e?e[i]:i;if(t(n[o],o,n))return!0}return!1},m.contains=m.includes=m.include=function(n,t,r,e){return k(n)||(n=m.values(n)),("number"!=typeof r||e)&&(r=0),m.indexOf(n,t,r)>=0},m.invoke=function(n,t){var r=l.call(arguments,2),e=m.isFunction(t);return m.map(n,function(n){var u=e?t:n[t];return null==u?u:u.apply(n,r)})},m.pluck=function(n,t){return m.map(n,m.property(t))},m.where=function(n,t){return m.filter(n,m.matcher(t))},m.findWhere=function(n,t){return m.find(n,m.matcher(t))},m.max=function(n,t,r){var e,u,i=-1/0,o=-1/0;if(null==t&&null!=n){n=k(n)?n:m.values(n);for(var a=0,c=n.length;c>a;a++)e=n[a],e>i&&(i=e)}else t=x(t,r),m.each(n,function(n,r,e){u=t(n,r,e),(u>o||u===-1/0&&i===-1/0)&&(i=n,o=u)});return i},m.min=function(n,t,r){var e,u,i=1/0,o=1/0;if(null==t&&null!=n){n=k(n)?n:m.values(n);for(var a=0,c=n.length;c>a;a++)e=n[a],i>e&&(i=e)}else t=x(t,r),m.each(n,function(n,r,e){u=t(n,r,e),(o>u||1/0===u&&1/0===i)&&(i=n,o=u)});return i},m.shuffle=function(n){for(var t,r=k(n)?n:m.values(n),e=r.length,u=Array(e),i=0;e>i;i++)t=m.random(0,i),t!==i&&(u[i]=u[t]),u[t]=r[i];return u},m.sample=function(n,t,r){return null==t||r?(k(n)||(n=m.values(n)),n[m.random(n.length-1)]):m.shuffle(n).slice(0,Math.max(0,t))},m.sortBy=function(n,t,r){return t=x(t,r),m.pluck(m.map(n,function(n,r,e){return{value:n,index:r,criteria:t(n,r,e)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index-t.index}),"value")};var F=function(n){return function(t,r,e){var u={};return r=x(r,e),m.each(t,function(e,i){var o=r(e,i,t);n(u,e,o)}),u}};m.groupBy=F(function(n,t,r){m.has(n,r)?n[r].push(t):n[r]=[t]}),m.indexBy=F(function(n,t,r){n[r]=t}),m.countBy=F(function(n,t,r){m.has(n,r)?n[r]++:n[r]=1}),m.toArray=function(n){return n?m.isArray(n)?l.call(n):k(n)?m.map(n,m.identity):m.values(n):[]},m.size=function(n){return null==n?0:k(n)?n.length:m.keys(n).length},m.partition=function(n,t,r){t=x(t,r);var e=[],u=[];return m.each(n,function(n,r,i){(t(n,r,i)?e:u).push(n)}),[e,u]},m.first=m.head=m.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:m.initial(n,n.length-t)},m.initial=function(n,t,r){return l.call(n,0,Math.max(0,n.length-(null==t||r?1:t)))},m.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:m.rest(n,Math.max(0,n.length-t))},m.rest=m.tail=m.drop=function(n,t,r){return l.call(n,null==t||r?1:t)},m.compact=function(n){return m.filter(n,m.identity)};var S=function(n,t,r,e){for(var u=[],i=0,o=e||0,a=O(n);a>o;o++){var c=n[o];if(k(c)&&(m.isArray(c)||m.isArguments(c))){t||(c=S(c,t,r));var f=0,l=c.length;for(u.length+=l;l>f;)u[i++]=c[f++]}else r||(u[i++]=c)}return u};m.flatten=function(n,t){return S(n,t,!1)},m.without=function(n){return m.difference(n,l.call(arguments,1))},m.uniq=m.unique=function(n,t,r,e){m.isBoolean(t)||(e=r,r=t,t=!1),null!=r&&(r=x(r,e));for(var u=[],i=[],o=0,a=O(n);a>o;o++){var c=n[o],f=r?r(c,o,n):c;t?(o&&i===f||u.push(c),i=f):r?m.contains(i,f)||(i.push(f),u.push(c)):m.contains(u,c)||u.push(c)}return u},m.union=function(){return m.uniq(S(arguments,!0,!0))},m.intersection=function(n){for(var t=[],r=arguments.length,e=0,u=O(n);u>e;e++){var i=n[e];if(!m.contains(t,i)){for(var o=1;r>o&&m.contains(arguments[o],i);o++);o===r&&t.push(i)}}return t},m.difference=function(n){var t=S(arguments,!0,!0,1);return m.filter(n,function(n){return!m.contains(t,n)})},m.zip=function(){return m.unzip(arguments)},m.unzip=function(n){for(var t=n&&m.max(n,O).length||0,r=Array(t),e=0;t>e;e++)r[e]=m.pluck(n,e);return r},m.object=function(n,t){for(var r={},e=0,u=O(n);u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},m.findIndex=t(1),m.findLastIndex=t(-1),m.sortedIndex=function(n,t,r,e){r=x(r,e,1);for(var u=r(t),i=0,o=O(n);o>i;){var a=Math.floor((i+o)/2);r(n[a])<u?i=a+1:o=a}return i},m.indexOf=r(1,m.findIndex,m.sortedIndex),m.lastIndexOf=r(-1,m.findLastIndex),m.range=function(n,t,r){null==t&&(t=n||0,n=0),r=r||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=Array(e),i=0;e>i;i++,n+=r)u[i]=n;return u};var E=function(n,t,r,e,u){if(!(e instanceof t))return n.apply(r,u);var i=j(n.prototype),o=n.apply(i,u);return m.isObject(o)?o:i};m.bind=function(n,t){if(g&&n.bind===g)return g.apply(n,l.call(arguments,1));if(!m.isFunction(n))throw new TypeError("Bind must be called on a function");var r=l.call(arguments,2),e=function(){return E(n,e,t,this,r.concat(l.call(arguments)))};return e},m.partial=function(n){var t=l.call(arguments,1),r=function(){for(var e=0,u=t.length,i=Array(u),o=0;u>o;o++)i[o]=t[o]===m?arguments[e++]:t[o];for(;e<arguments.length;)i.push(arguments[e++]);return E(n,r,this,this,i)};return r},m.bindAll=function(n){var t,r,e=arguments.length;if(1>=e)throw new Error("bindAll must be passed function names");for(t=1;e>t;t++)r=arguments[t],n[r]=m.bind(n[r],n);return n},m.memoize=function(n,t){var r=function(e){var u=r.cache,i=""+(t?t.apply(this,arguments):e);return m.has(u,i)||(u[i]=n.apply(this,arguments)),u[i]};return r.cache={},r},m.delay=function(n,t){var r=l.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},m.defer=m.partial(m.delay,m,1),m.throttle=function(n,t,r){var e,u,i,o=null,a=0;r||(r={});var c=function(){a=r.leading===!1?0:m.now(),o=null,i=n.apply(e,u),o||(e=u=null)};return function(){var f=m.now();a||r.leading!==!1||(a=f);var l=t-(f-a);return e=this,u=arguments,0>=l||l>t?(o&&(clearTimeout(o),o=null),a=f,i=n.apply(e,u),o||(e=u=null)):o||r.trailing===!1||(o=setTimeout(c,l)),i}},m.debounce=function(n,t,r){var e,u,i,o,a,c=function(){var f=m.now()-o;t>f&&f>=0?e=setTimeout(c,t-f):(e=null,r||(a=n.apply(i,u),e||(i=u=null)))};return function(){i=this,u=arguments,o=m.now();var f=r&&!e;return e||(e=setTimeout(c,t)),f&&(a=n.apply(i,u),i=u=null),a}},m.wrap=function(n,t){return m.partial(t,n)},m.negate=function(n){return function(){return!n.apply(this,arguments)}},m.compose=function(){var n=arguments,t=n.length-1;return function(){for(var r=t,e=n[t].apply(this,arguments);r--;)e=n[r].call(this,e);return e}},m.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},m.before=function(n,t){var r;return function(){return--n>0&&(r=t.apply(this,arguments)),1>=n&&(t=null),r}},m.once=m.partial(m.before,2);var M=!{toString:null}.propertyIsEnumerable("toString"),I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];m.keys=function(n){if(!m.isObject(n))return[];if(v)return v(n);var t=[];for(var r in n)m.has(n,r)&&t.push(r);return M&&e(n,t),t},m.allKeys=function(n){if(!m.isObject(n))return[];var t=[];for(var r in n)t.push(r);return M&&e(n,t),t},m.values=function(n){for(var t=m.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},m.mapObject=function(n,t,r){t=x(t,r);for(var e,u=m.keys(n),i=u.length,o={},a=0;i>a;a++)e=u[a],o[e]=t(n[e],e,n);return o},m.pairs=function(n){for(var t=m.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];return e},m.invert=function(n){for(var t={},r=m.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},m.functions=m.methods=function(n){var t=[];for(var r in n)m.isFunction(n[r])&&t.push(r);return t.sort()},m.extend=_(m.allKeys),m.extendOwn=m.assign=_(m.keys),m.findKey=function(n,t,r){t=x(t,r);for(var e,u=m.keys(n),i=0,o=u.length;o>i;i++)if(e=u[i],t(n[e],e,n))return e},m.pick=function(n,t,r){var e,u,i={},o=n;if(null==o)return i;m.isFunction(t)?(u=m.allKeys(o),e=b(t,r)):(u=S(arguments,!1,!1,1),e=function(n,t,r){return t in r},o=Object(o));for(var a=0,c=u.length;c>a;a++){var f=u[a],l=o[f];e(l,f,o)&&(i[f]=l)}return i},m.omit=function(n,t,r){if(m.isFunction(t))t=m.negate(t);else{var e=m.map(S(arguments,!1,!1,1),String);t=function(n,t){return!m.contains(e,t)}}return m.pick(n,t,r)},m.defaults=_(m.allKeys,!0),m.create=function(n,t){var r=j(n);return t&&m.extendOwn(r,t),r},m.clone=function(n){return m.isObject(n)?m.isArray(n)?n.slice():m.extend({},n):n},m.tap=function(n,t){return t(n),n},m.isMatch=function(n,t){var r=m.keys(t),e=r.length;if(null==n)return!e;for(var u=Object(n),i=0;e>i;i++){var o=r[i];if(t[o]!==u[o]||!(o in u))return!1}return!0};var N=function(n,t,r,e){if(n===t)return 0!==n||1/n===1/t;if(null==n||null==t)return n===t;n instanceof m&&(n=n._wrapped),t instanceof m&&(t=t._wrapped);var u=s.call(n);if(u!==s.call(t))return!1;switch(u){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!==+n?+t!==+t:0===+n?1/+n===1/t:+n===+t;case"[object Date]":case"[object Boolean]":return+n===+t}var i="[object Array]"===u;if(!i){if("object"!=typeof n||"object"!=typeof t)return!1;var o=n.constructor,a=t.constructor;if(o!==a&&!(m.isFunction(o)&&o instanceof o&&m.isFunction(a)&&a instanceof a)&&"constructor"in n&&"constructor"in t)return!1}r=r||[],e=e||[];for(var c=r.length;c--;)if(r[c]===n)return e[c]===t;if(r.push(n),e.push(t),i){if(c=n.length,c!==t.length)return!1;for(;c--;)if(!N(n[c],t[c],r,e))return!1}else{var f,l=m.keys(n);if(c=l.length,m.keys(t).length!==c)return!1;for(;c--;)if(f=l[c],!m.has(t,f)||!N(n[f],t[f],r,e))return!1}return r.pop(),e.pop(),!0};m.isEqual=function(n,t){return N(n,t)},m.isEmpty=function(n){return null==n?!0:k(n)&&(m.isArray(n)||m.isString(n)||m.isArguments(n))?0===n.length:0===m.keys(n).length},m.isElement=function(n){return!(!n||1!==n.nodeType)},m.isArray=h||function(n){return"[object Array]"===s.call(n)},m.isObject=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n},m.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(n){m["is"+n]=function(t){return s.call(t)==="[object "+n+"]"}}),m.isArguments(arguments)||(m.isArguments=function(n){return m.has(n,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(m.isFunction=function(n){return"function"==typeof n||!1}),m.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},m.isNaN=function(n){return m.isNumber(n)&&n!==+n},m.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"===s.call(n)},m.isNull=function(n){return null===n},m.isUndefined=function(n){return n===void 0},m.has=function(n,t){return null!=n&&p.call(n,t)},m.noConflict=function(){return u._=i,this},m.identity=function(n){return n},m.constant=function(n){return function(){return n}},m.noop=function(){},m.property=w,m.propertyOf=function(n){return null==n?function(){}:function(t){return n[t]}},m.matcher=m.matches=function(n){return n=m.extendOwn({},n),function(t){return m.isMatch(t,n)}},m.times=function(n,t,r){var e=Array(Math.max(0,n));t=b(t,r,1);for(var u=0;n>u;u++)e[u]=t(u);return e},m.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},m.now=Date.now||function(){return(new Date).getTime()};var B={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},T=m.invert(B),R=function(n){var t=function(t){return n[t]},r="(?:"+m.keys(n).join("|")+")",e=RegExp(r),u=RegExp(r,"g");return function(n){return n=null==n?"":""+n,e.test(n)?n.replace(u,t):n}};m.escape=R(B),m.unescape=R(T),m.result=function(n,t,r){var e=null==n?void 0:n[t];return e===void 0&&(e=r),m.isFunction(e)?e.call(n):e};var q=0;m.uniqueId=function(n){var t=++q+"";return n?n+t:t},m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\u2028|\u2029/g,L=function(n){return"\\"+z[n]};m.template=function(n,t,r){!t&&r&&(t=r),t=m.defaults({},t,m.templateSettings);var e=RegExp([(t.escape||K).source,(t.interpolate||K).source,(t.evaluate||K).source].join("|")+"|$","g"),u=0,i="__p+='";n.replace(e,function(t,r,e,o,a){return i+=n.slice(u,a).replace(D,L),u=a+t.length,r?i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":e?i+="'+\n((__t=("+e+"))==null?'':__t)+\n'":o&&(i+="';\n"+o+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var o=new Function(t.variable||"obj","_",i)}catch(a){throw a.source=i,a}var c=function(n){return o.call(this,n,m)},f=t.variable||"obj";return c.source="function("+f+"){\n"+i+"}",c},m.chain=function(n){var t=m(n);return t._chain=!0,t};var P=function(n,t){return n._chain?m(t).chain():t};m.mixin=function(n){m.each(m.functions(n),function(t){var r=m[t]=n[t];m.prototype[t]=function(){var n=[this._wrapped];return f.apply(n,arguments),P(this,r.apply(m,n))}})},m.mixin(m),m.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=o[n];m.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==n&&"splice"!==n||0!==r.length||delete r[0],P(this,r)}}),m.each(["concat","join","slice"],function(n){var t=o[n];m.prototype[n]=function(){return P(this,t.apply(this._wrapped,arguments))}}),m.prototype.value=function(){return this._wrapped},m.prototype.valueOf=m.prototype.toJSON=m.prototype.value,m.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return m})}).call(this);
},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL3dhdGNoaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9jaHJvbW96b29tLmpzIiwianMvY3VzdG9tL0N1c3RvbUdlbm9tZS5qcyIsImpzL2N1c3RvbS9DdXN0b21HZW5vbWVzLmpzIiwianMvY3VzdG9tL0N1c3RvbVRyYWNrLmpzIiwianMvY3VzdG9tL0N1c3RvbVRyYWNrcy5qcyIsImpzL2N1c3RvbS9nZW5vbWUtZm9ybWF0cy9jaHJvbXNpemVzLmpzIiwianMvY3VzdG9tL2dlbm9tZS1mb3JtYXRzL2Zhc3RhLmpzIiwianMvY3VzdG9tL2dlbm9tZS1mb3JtYXRzL2dlbmJhbmsuanMiLCJqcy9jdXN0b20vZ2Vub21lLWZvcm1hdHMvdXRpbHMvdXRpbHMuanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvYmFtLmpzIiwianMvY3VzdG9tL3RyYWNrLXR5cGVzL2JlZC5qcyIsImpzL2N1c3RvbS90cmFjay10eXBlcy9iZWRncmFwaC5qcyIsImpzL2N1c3RvbS90cmFjay10eXBlcy9iaWdiZWQuanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvYmlnd2lnLmpzIiwianMvY3VzdG9tL3RyYWNrLXR5cGVzL2ZlYXR1cmV0YWJsZS5qcyIsImpzL2N1c3RvbS90cmFjay10eXBlcy91dGlscy9JbnRlcnZhbFRyZWUuanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvdXRpbHMvTGluZU1hc2suanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvdXRpbHMvUGFpcmVkSW50ZXJ2YWxUcmVlLmpzIiwianMvY3VzdG9tL3RyYWNrLXR5cGVzL3V0aWxzL1JlbW90ZVRyYWNrLmpzIiwianMvY3VzdG9tL3RyYWNrLXR5cGVzL3V0aWxzL1NvcnRlZExpc3QuanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvdXRpbHMvdXRpbHMuanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvdmNmdGFiaXguanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvd2lnZ2xlXzAuanMiLCJqcy9qcXVlcnkubWluLmpzIiwianMvdWkvanF1ZXJ5LXVpLmdlbm9icm93c2VyLmpzIiwianMvdWkvanF1ZXJ5LXVpLmdlbm9saW5lLmpzIiwianMvdWkvanF1ZXJ5LXVpLmdlbm90cmFjay5qcyIsImpzL3VpL2pxdWVyeS11aS5taW4uanMiLCJqcy91aS9qcXVlcnktdWkudG91Y2gtcHVuY2guanMiLCJqcy91aS9qcXVlcnkuZmFyYnRhc3RpYy5qcyIsImpzL3VpL2pxdWVyeS5taXNjLXBsdWdpbnMuanMiLCJqcy91aS9qcXVlcnkudGlwdGlwLmpzIiwianMvdWkvdXRpbHMuanMiLCJqcy91bmRlcnNjb3JlLm1pbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzlIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3Z1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDN1VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN6SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUMzUUE7QUFDQTtBQUNBO0FBQ0E7O0FDSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdHdFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9XQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0V0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4vLyBXZWxjb21lIHRvIENocm9tb1pvb20hICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbi8vIFRoaXMgaXMgdGhlIEphdmFTY3JpcHQgZW50cnkgcG9pbnQgd2hpY2ggaXMgICAgIC8vXG4vLyBidWlsdCBpbnRvIHRoZSBmaW5hbCBhcHBsaWNhdGlvbiBieSBicm93c2VyaWZ5ICAvL1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbi8vIEZvciBpbmZvcm1hdGlvbiBvbiBpbnN0YWxsaW5nLCBzZWUgLi4vUkVBRE1FLm1kIC8vXG4vLyAoYykgMjAxNiBUaGVvZG9yZSBQYWssIEFHUEwsIHNlZSAuLi9MSUNFTlNFICAgICAvL1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbnJlcXVpcmUoJy4vanF1ZXJ5Lm1pbi5qcycpKHdpbmRvdyk7XG52YXIgalF1ZXJ5ID0gd2luZG93WyckJ10gPSB3aW5kb3cualF1ZXJ5O1xuXG5yZXF1aXJlKCcuL3VpL2pxdWVyeS11aS5taW4uanMnKShqUXVlcnkpO1xucmVxdWlyZSgnLi91aS9qcXVlcnktdWkudG91Y2gtcHVuY2guanMnKShqUXVlcnkpO1xuXG53aW5kb3cuXyA9IHJlcXVpcmUoJy4vdW5kZXJzY29yZS5taW4uanMnKTtcblxucmVxdWlyZSgnLi9jdXN0b20vQ3VzdG9tVHJhY2tzLmpzJykod2luZG93KTtcbnJlcXVpcmUoJy4vY3VzdG9tL0N1c3RvbUdlbm9tZXMuanMnKSh3aW5kb3cpO1xuXG5yZXF1aXJlKCcuL3VpL2pxdWVyeS11aS5nZW5vYnJvd3Nlci5qcycpKGpRdWVyeSk7IiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9IEN1c3RvbUdlbm9tZSByZXByZXNlbnRzIGEgZ2Vub21lIHNwZWNpZmljYXRpb24gdGhhdCBjYW4gcHJvZHVjZSBvcHRpb25zIGZvciAkLnVpLmdlbm9icm93c2VyID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGdsb2JhbCkge1xuXG52YXIgXyA9IHJlcXVpcmUoJy4uL3VuZGVyc2NvcmUubWluLmpzJyk7XG5cbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vZ2Vub21lLWZvcm1hdHMvdXRpbHMvdXRpbHMuanMnKSxcbiAgZGVlcENsb25lID0gdXRpbHMuZGVlcENsb25lLFxuICBsb2cxMCA9IHV0aWxzLmxvZzEwLFxuICByb3VuZFRvUGxhY2VzID0gdXRpbHMucm91bmRUb1BsYWNlcztcblxuZnVuY3Rpb24gQ3VzdG9tR2Vub21lKGdpdmVuRm9ybWF0LCBtZXRhZGF0YSkgeyAgICBcbiAgLy8gZ2l2ZW5Gb3JtYXQgPSBmYWxzZSAtLT4gdGhpcyBpcyBhbiBlbXB0eSBDdXN0b21HZW5vbWUgdGhhdCB3aWxsIGJlIGh5ZHJhdGVkIHdpdGggdmFsdWVzIGZyb20gYSBzZXJpYWxpemVkIG9iamVjdFxuICBpZiAoZ2l2ZW5Gb3JtYXQgPT09IGZhbHNlKSB7IHJldHVybjsgfSBcbiAgXG4gIHRoaXMuX3BhcnNlZCA9IGZhbHNlO1xuICB0aGlzLl9mb3JtYXQgPSAoZ2l2ZW5Gb3JtYXQgJiYgZ2l2ZW5Gb3JtYXQudG9Mb3dlckNhc2UoKSkgfHwgXCJjaHJvbXNpemVzXCI7XG4gIHZhciBmb3JtYXQgPSB0aGlzLmZvcm1hdCgpO1xuICBpZiAoZm9ybWF0ID09PSBudWxsKSB7IHRocm93IG5ldyBFcnJvcihcIlVuc3VwcG9ydGVkIGdlbm9tZSBmb3JtYXQgJ1wiK2Zvcm1hdCtcIicgZW5jb3VudGVyZWRcIik7IH1cbiAgXG4gIC8vIHRoaXMub3B0cyBob2xkcyBldmVyeXRoaW5nIHRoYXQgJC51aS5nZW5vYnJvd3NlciB3aWxsIG5lZWQgdG8gY29uc3RydWN0IGEgdmlldyAoc2VlIEN1c3RvbUdlbm9tZS5kZWZhdWx0cyBiZWxvdylcbiAgLy8gaXQgRE9FUyBOT1QgcmVsYXRlIHRvIFwib3B0aW9uc1wiIGZvciBwYXJzaW5nLCBvciBob3cgdGhlIGdlbm9tZSBpcyBiZWluZyBpbnRlcnByZXRlZCwgb3IgYW55dGhpbmcgbGlrZSB0aGF0XG4gIHRoaXMub3B0cyA9IF8uZXh0ZW5kKHt9LCBkZWVwQ2xvbmUodGhpcy5jb25zdHJ1Y3Rvci5kZWZhdWx0cyksIGRlZXBDbG9uZShmb3JtYXQuZGVmYXVsdHMgfHwge30pKTtcbiAgXG4gIC8vIHRoaXMubWV0YWRhdGEgaG9sZHMgaW5mb3JtYXRpb24gZXh0ZXJuYWwgdG8gdGhlIHBhcnNlZCB0ZXh0IHBhc3NlZCBpbiBmcm9tIHRoZSBicm93c2VyIChlLmcuIGZpbGVuYW1lLCBzb3VyY2UpXG4gIHRoaXMubWV0YWRhdGEgPSBtZXRhZGF0YTtcbiAgXG4gIC8vIHRoaXMuZGF0YSBob2xkcyBhbnl0aGluZyBhZGRpdGlvbmFsbHkgcGFyc2VkIGZyb20gdGhlIGdlbm9tZSBmaWxlIChtZXRhZGF0YSwgcmVmZXJlbmNlcywgZXRjLilcbiAgLy8gdHlwaWNhbGx5IHRoaXMgaXMgYXJyYW5nZWQgcGVyIGNvbnRpZywgaW4gdGhlIGFycmFuZ2VtZW50IG9mIHRoaXMuZGF0YS5jb250aWdzW2ldLiAuLi5cbiAgdGhpcy5kYXRhID0ge1xuICAgIHNlcXVlbmNlOiBcIlwiIC8vIHRoZSBmdWxsIGNvbmNhdGVuYXRlZCBzZXF1ZW5jZSBmb3IgYWxsIGNvbnRpZ3MgaW4gdGhpcyBnZW5vbWUsIGlmIGF2YWlsYWJsZVxuICB9O1xuICBcbiAgLy8gY2FuIHdlIGNhbGwgLmdldFNlcXVlbmNlIG9uIHRoaXMgQ3VzdG9tR2Vub21lP1xuICB0aGlzLmNhbkdldFNlcXVlbmNlID0gZmFsc2U7XG4gIFxuICBpZihmb3JtYXQuaW5pdCkgeyBmb3JtYXQuaW5pdC5jYWxsKHRoaXMpOyB9XG59XG5cbkN1c3RvbUdlbm9tZS5kZWZhdWx0cyA9IHtcbiAgLy8gVGhlIGZvbGxvd2luZyBrZXlzIHNob3VsZCBiZSBvdmVycmlkZGVuIHdoaWxlIHBhcnNpbmcgdGhlIGdlbm9tZSBmaWxlXG4gIGdlbm9tZTogJ19ibGFuaycsXG4gIHNwZWNpZXM6ICdCbGFuayBHZW5vbWUnLFxuICBhc3NlbWJseURhdGU6ICcnLFxuICB0aWxlRGlyOiBudWxsLFxuICBvdmVyem9vbUJwcHBzOiBbXSxcbiAgbnRzQmVsb3c6IFsxLCAwLjFdLFxuICBhdmFpbFRyYWNrczogW1xuICAgIHtcbiAgICAgIGZoOiB7fSwgICAgICAgIC8vIFwiZml4ZWQgaGVpZ2h0c1wiIGFib3ZlIHdoaWNoIGEgZGVuc2l0eSBpcyBmb3JjZWQgdG8gZGlzcGxheSBhYm92ZSBhIGNlcnRhaW4gdHJhY2sgaGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgICAvLyAgICBmb3JtYXR0ZWQgbGlrZSB7XCIxLjAwZSswNVwiOntcImRlbnNlXCI6MTV9fVxuICAgICAgbjogXCJydWxlclwiLCAgICAvLyBzaG9ydCB1bmlxdWUgbmFtZSBmb3IgdGhlIHRyYWNrXG4gICAgICBzOiBbXCJkZW5zZVwiXSwgIC8vIHBvc3NpYmxlIGRlbnNpdGllcyBmb3IgdGlsZXMsIGUuZy4gW1wiZGVuc2VcIiwgXCJzcXVpc2hcIiwgXCJwYWNrXCJdXG4gICAgICBoOiAyNSAgICAgICAgICAvLyBzdGFydGluZyBoZWlnaHQgaW4gcHhcbiAgICB9XG4gIF0sXG4gIGdlbm9tZVNpemU6IDAsXG4gIGNockxlbmd0aHM6IHt9LFxuICBjaHJPcmRlcjogW10sXG4gIGNockJhbmRzOiBudWxsLFxuICB0aWxlV2lkdGg6IDEwMDAsXG4gIHN1YmRpckZvckJwcHBzVW5kZXI6IDMzMCxcbiAgaWRlb2dyYW1zQWJvdmU6IDEwMDAsXG4gIG1heE50UmVxdWVzdDogMjAwMDAsXG4gIHRyYWNrczogW3tuOiBcInJ1bGVyXCJ9XSxcbiAgdHJhY2tEZXNjOiB7XG4gICAgcnVsZXI6IHtcbiAgICAgIGNhdDogXCJNYXBwaW5nIGFuZCBTZXF1ZW5jaW5nIFRyYWNrc1wiLFxuICAgICAgc206IFwiQmFzZSBQb3NpdGlvblwiXG4gICAgfVxuICB9LFxuICAvLyBUaGVzZSBsYXN0IHRocmVlIHdpbGwgYmUgb3ZlcnJpZGRlbiB1c2luZyBrbm93bGVkZ2Ugb2YgdGhlIHdpbmRvdydzIHdpZHRoXG4gIGJwcHBzOiBbXSxcbiAgYnBwcE51bWJlcnNCZWxvdzogW10sXG4gIGluaXRab29tOiBudWxsXG59O1xuXG5DdXN0b21HZW5vbWUuZm9ybWF0cyA9IHtcbiAgY2hyb21zaXplczogcmVxdWlyZSgnLi9nZW5vbWUtZm9ybWF0cy9jaHJvbXNpemVzLmpzJyksXG4gIGZhc3RhOiByZXF1aXJlKCcuL2dlbm9tZS1mb3JtYXRzL2Zhc3RhLmpzJyksXG4gIGdlbmJhbms6IHJlcXVpcmUoJy4vZ2Vub21lLWZvcm1hdHMvZ2VuYmFuay5qcycpLFxuICBlbWJsOiBudWxsIC8vIFRPRE8uIEJhc2ljYWxseSBnZW5iYW5rIHdpdGggZXh0cmEgY29sdW1ucy5cbn1cblxuQ3VzdG9tR2Vub21lLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmZvcm1hdCgpLnBhcnNlLmFwcGx5KHRoaXMsIF8udG9BcnJheShhcmd1bWVudHMpKTtcbiAgdGhpcy5zZXRHZW5vbWVTdHJpbmcoKTtcbiAgdGhpcy5fcGFyc2VkID0gdHJ1ZTtcbn07XG5cbkN1c3RvbUdlbm9tZS5wcm90b3R5cGUuZm9ybWF0ID0gZnVuY3Rpb24oZm9ybWF0KSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgaWYgKF8uaXNVbmRlZmluZWQoZm9ybWF0KSkgeyBmb3JtYXQgPSBzZWxmLl9mb3JtYXQ7IH1cbiAgdmFyIEZvcm1hdFdyYXBwZXIgPSBmdW5jdGlvbigpIHsgXy5leHRlbmQodGhpcywgc2VsZi5jb25zdHJ1Y3Rvci5mb3JtYXRzW2Zvcm1hdF0pOyByZXR1cm4gdGhpczsgfTtcbiAgRm9ybWF0V3JhcHBlci5wcm90b3R5cGUgPSBzZWxmO1xuICByZXR1cm4gbmV3IEZvcm1hdFdyYXBwZXIoKTtcbn07XG5cbkN1c3RvbUdlbm9tZS5wcm90b3R5cGUuc2V0R2Vub21lU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzZWxmID0gdGhpcyxcbiAgICBvID0gc2VsZi5vcHRzLFxuICAgIGV4Y2VwdGlvbnMgPSBbJ2ZpbGUnLCAnaWdiJywgJ2FjYycsICd1cmwnLCAndWNzYyddLFxuICAgIGV4Y2VwdGlvbiA9IF8uZmluZChleGNlcHRpb25zLCBmdW5jdGlvbih2KSB7IHJldHVybiAhXy5pc1VuZGVmaW5lZChzZWxmLm1ldGFkYXRhW3ZdKTsgfSksXG4gICAgcGllY2VzID0gW107XG4gIGlmIChleGNlcHRpb24pIHsgby5nZW5vbWUgPSBleGNlcHRpb24gKyBcIjpcIiArIHNlbGYubWV0YWRhdGFbZXhjZXB0aW9uXTsgfVxuICBlbHNlIHtcbiAgICBwaWVjZXMgPSBbJ2N1c3RvbScgKyAoc2VsZi5tZXRhZGF0YS5uYW1lID8gJzonICsgc2VsZi5tZXRhZGF0YS5uYW1lIDogJycpXTtcbiAgICBfLmVhY2goby5jaHJPcmRlciwgZnVuY3Rpb24oY2hyKSB7XG4gICAgICBwaWVjZXMucHVzaChjaHIgKyAnOicgKyBvLmNockxlbmd0aHNbY2hyXSk7XG4gICAgfSk7XG4gICAgby5nZW5vbWUgPSBwaWVjZXMuam9pbignfCcpO1xuICB9XG59O1xuXG4vLyBTb21lIG9mIHRoZSBvcHRpb25zIGZvciAkLnVpLmdlbm9icm93c2VyIChhbGwgci90IHpvb20gbGV2ZWxzKSBtdXN0IGJlIHNldCBiYXNlZCBvbiB0aGUgd2lkdGggb2YgdGhlIHdpbmRvd1xuLy8gICBUaGV5IGFyZSAuYnBwcHMsIC5icHBwTnVtYmVyc0JlbG93LCBhbmQgLmluaXRab29tXG4vLyAgIFRoZXkgZG8gbm90IGFmZmVjdCBhbnkgb2YgdGhlIG90aGVyIG9wdGlvbnMgc2V0IGR1cmluZyBwYXJzaW5nLlxuLy9cbi8vIHdpbmRvd09wdHMgTVVTVCBpbmNsdWRlIGEgcHJvcGVydHksIC53aWR0aCwgdGhhdCBpcyB0aGUgd2luZG93LmlubmVyV2lkdGhcbkN1c3RvbUdlbm9tZS5wcm90b3R5cGUuc2V0QnBwcHMgPSBmdW5jdGlvbih3aW5kb3dPcHRzKSB7XG4gIHdpbmRvd09wdHMgPSB3aW5kb3dPcHRzIHx8IHt9O1xuICBcbiAgdmFyIG8gPSB0aGlzLm9wdHMsXG4gICAgd2luZG93V2lkdGggPSAod2luZG93T3B0cy53aWR0aCAqIDAuNikgfHwgMTAwMCxcbiAgICBicHBwID0gTWF0aC5yb3VuZChvLmdlbm9tZVNpemUgLyB3aW5kb3dXaWR0aCksXG4gICAgbG93ZXN0QnBwcCA9IHdpbmRvd09wdHMubG93ZXN0QnBwcCB8fCAwLjEsXG4gICAgbWF4QnBwcHMgPSAxMDAsXG4gICAgYnBwcHMgPSBbXSwgaSA9IDAsIGxvZztcbiAgXG4gIC8vIGNvbXBhcmFibGUgdG8gcGFydCBvZiBVQ1NDQ2xpZW50I21ha2VfY29uZmlnIGluIGxpYi91Y3NjX3N0aXRjaC5yYlxuICB3aGlsZSAoYnBwcCA+PSBsb3dlc3RCcHBwICYmIGkgPCBtYXhCcHBwcykge1xuICAgIGJwcHBzLnB1c2goYnBwcCk7XG4gICAgbG9nID0gcm91bmRUb1BsYWNlcyhsb2cxMChicHBwKSwgNCk7XG4gICAgYnBwcCA9IChNYXRoLmNlaWwobG9nKSAtIGxvZyA8IDAuNDgxKSA/IDMuMyAqIE1hdGgucG93KDEwLCBNYXRoLmNlaWwobG9nKSAtIDEpIDogTWF0aC5wb3coMTAsIE1hdGguZmxvb3IobG9nKSk7XG4gICAgaSsrO1xuICB9XG4gIG8uYnBwcHMgPSBicHBwcztcbiAgby5icHBwTnVtYmVyc0JlbG93ID0gYnBwcHMuc2xpY2UoMCwgMik7XG4gIG8uaW5pdFpvb20gPSBicHBwc1swXTtcbn07XG5cbi8vIENvbnN0cnVjdCBhIGNvbXBsZXRlIGNvbmZpZ3VyYXRpb24gZm9yICQudWkuZ2Vub2Jyb3dzZXIgYmFzZWQgb24gdGhlIGluZm9ybWF0aW9uIHBhcnNlZCBmcm9tIHRoZSBnZW5vbWUgZmlsZVxuLy8gd2hpY2ggc2hvdWxkIGJlIG1vc3RseSBpbiB0aGlzLm9wdHMsIGV4Y2VwdGluZyB0aG9zZSByZWxhdGVkIHRvIHpvb20gbGV2ZWxzLCB3aGljaCBjYW4gYmUgc2V0IG5vdy5cbi8vIChzZWUgQ3VzdG9tR2Vub21lLmRlZmF1bHRzIGFib3ZlIGZvciB3aGF0IGEgYmFzZSBjb25maWd1cmF0aW9uIGxvb2tzIGxpa2UpXG4vL1xuLy8gd2luZG93T3B0cyBNVVNUIGluY2x1ZGUgaW5jbHVkZSB0aGUgcHJvcGVydHkgLndpZHRoIHdoaWNoIGlzIHRoZSB3aW5kb3cuaW5uZXJXaWR0aFxuQ3VzdG9tR2Vub21lLnByb3RvdHlwZS5vcHRpb25zID0gZnVuY3Rpb24od2luZG93T3B0cykge1xuICBpZiAoIXRoaXMuX3BhcnNlZCkgeyB0aHJvdyBcIkNhbm5vdCBnZW5lcmF0ZSBvcHRpb25zIGJlZm9yZSBwYXJzaW5nIHRoZSBnZW5vbWUgZmlsZVwiOyB9XG4gIHRoaXMuc2V0QnBwcHMod2luZG93T3B0cyk7XG4gIHRoaXMub3B0cy5jdXN0b20gPSB0aGlzOyAgIC8vIHNhbWUgY29udmVudGlvbiBhcyBjdXN0b20gdHJhY2tzIGluIHNlbGYuYXZhaWxUcmFja3MgaW4gY2hyb21vem9vbS5qc1xuICByZXR1cm4gdGhpcy5vcHRzO1xufTtcblxuLy8gRmV0Y2ggdGhlIHNlcXVlbmNlLCBpZiBhdmFpbGFibGUsIGJldHdlZW4gbGVmdCBhbmQgcmlnaHQsIGFuZCBvcHRpb25hbGx5IHBhc3MgaXQgdG8gdGhlIGNhbGxiYWNrLlxuQ3VzdG9tR2Vub21lLnByb3RvdHlwZS5nZXRTZXF1ZW5jZSA9IGZ1bmN0aW9uKGxlZnQsIHJpZ2h0LCBjYWxsYmFjaykge1xuICB2YXIgc2VxID0gdGhpcy5kYXRhLnNlcXVlbmNlLnN1YnN0cmluZyhsZWZ0IC0gMSwgcmlnaHQgLSAxKTtcbiAgcmV0dXJuIF8uaXNGdW5jdGlvbihjYWxsYmFjaykgPyBjYWxsYmFjayhzZXEpIDogc2VxOyBcbn07XG5cbkN1c3RvbUdlbm9tZS5wcm90b3R5cGUuZ2V0U2VxdWVuY2VBc3luYyA9IGZ1bmN0aW9uKCkge1xuICBnbG9iYWwuQ3VzdG9tR2Vub21lcy5hc3luYyh0aGlzLCAnZ2V0U2VxdWVuY2UnLCBhcmd1bWVudHMsIFt0aGlzLmlkXSk7XG59O1xuXG5yZXR1cm4gQ3VzdG9tR2Vub21lO1xuXG59OyIsIm1vZHVsZS5leHBvcnRzID0gKGZ1bmN0aW9uKGdsb2JhbCl7XG4gIFxuICB2YXIgXyA9IHJlcXVpcmUoJy4uL3VuZGVyc2NvcmUubWluLmpzJyk7XG4gIGlmICghZ2xvYmFsLkN1c3RvbVRyYWNrcykgeyByZXF1aXJlKCcuL0N1c3RvbVRyYWNrcy5qcycpKGdsb2JhbCk7IH1cbiAgXG4gIC8vIFRoZSBjbGFzcyB0aGF0IHJlcHJlc2VudHMgYSBzaW5ndWxhciBjdXN0b20gZ2Vub21lIG9iamVjdFxuICB2YXIgQ3VzdG9tR2Vub21lID0gcmVxdWlyZSgnLi9DdXN0b21HZW5vbWUnKShnbG9iYWwpO1xuICBcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyA9IEN1c3RvbUdlbm9tZXMsIHRoZSBtb2R1bGUgZXhwb3J0ZWQgdG8gdGhlIGdsb2JhbCBlbnZpcm9ubWVudCA9XG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy9cbiAgLy8gQnJvYWRseSBzcGVha2luZyB0aGlzIGlzIGEgZmFjdG9yeSBmb3IgQ3VzdG9tR2Vub21lIG9iamVjdHMgdGhhdCBjYW4gZGVsZWdhdGUgdGhlXG4gIC8vIHdvcmsgb2YgcGFyc2luZyB0byBhIFdlYiBXb3JrZXIgdGhyZWFkLlxuICBcbiAgdmFyIEN1c3RvbUdlbm9tZXMgPSB7XG4gICAgcGFyc2U6IGZ1bmN0aW9uKHRleHQsIG1ldGFkYXRhKSB7XG4gICAgICBtZXRhZGF0YSA9IG1ldGFkYXRhIHx8IHt9O1xuICAgICAgaWYgKCFtZXRhZGF0YS5mb3JtYXQpIHsgbWV0YWRhdGEuZm9ybWF0ID0gdGhpcy5ndWVzc0Zvcm1hdCh0ZXh0KTsgfVxuICAgICAgdmFyIGdlbm9tZSA9IG5ldyBDdXN0b21HZW5vbWUobWV0YWRhdGEuZm9ybWF0LCBtZXRhZGF0YSk7XG4gICAgICBnZW5vbWUucGFyc2UodGV4dCk7XG4gICAgICByZXR1cm4gZ2Vub21lO1xuICAgIH0sXG4gICAgXG4gICAgYmxhbms6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGdlbm9tZSA9IG5ldyBDdXN0b21HZW5vbWUoXCJjaHJvbXNpemVzXCIsIHtzcGVjaWVzOiBcIkJsYW5rIEdlbm9tZVwifSk7XG4gICAgICBnZW5vbWUucGFyc2UoXCJibGFua1xcdDUwMDAwXCIpO1xuICAgICAgcmV0dXJuIGdlbm9tZTtcbiAgICB9LFxuICAgIFxuICAgIGd1ZXNzRm9ybWF0OiBmdW5jdGlvbih0ZXh0KSB7XG4gICAgICBpZiAodGV4dC5zdWJzdHJpbmcoMCwgNSkgPT0gJ0xPQ1VTJykgeyByZXR1cm4gXCJnZW5iYW5rXCI7IH1cbiAgICAgIGlmICgvXltBLVpdezJ9IHszfS8udGVzdCh0ZXh0KSkgeyByZXR1cm4gXCJlbWJsXCI7IH1cbiAgICAgIGlmICgvXls+O10vLnRlc3QodGV4dCkpIHsgcmV0dXJuIFwiZmFzdGFcIjsgfVxuICAgICAgLy8gZGVmYXVsdCBpcyBmYXN0YVxuICAgICAgcmV0dXJuIFwiZmFzdGFcIjtcbiAgICB9LFxuICAgIFxuICAgIGVycm9yOiBmdW5jdGlvbihlKSB7XG4gICAgICAvLyBDYW4gYmUgb3ZlcnJpZGRlbiBieSBhIHBhcmVudCBsaWJyYXJ5IHRvIGhhbmRsZSBlcnJvcnMgbW9yZSBncmFjZWZ1bGx5LlxuICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgfSxcbiAgICBcbiAgICBfd29ya2VyU2NyaXB0OiAnYnVpbGQvQ3VzdG9tR2Vub21lV29ya2VyLmpzJyxcbiAgICBfZGlzYWJsZVdvcmtlcnM6IGZhbHNlLFxuICAgIHdvcmtlcjogZ2xvYmFsLkN1c3RvbVRyYWNrcy53b3JrZXIsXG4gICAgXG4gICAgYXN5bmM6IGdsb2JhbC5DdXN0b21UcmFja3MuYXN5bmMsXG4gICAgXG4gICAgcGFyc2VBc3luYzogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmFzeW5jKHRoaXMsICdwYXJzZScsIGFyZ3VtZW50cywgW10sIGZ1bmN0aW9uKGdlbm9tZSkge1xuICAgICAgICAvLyBUaGlzIGhhcyBiZWVuIHNlcmlhbGl6ZWQsIHNvIGl0IG11c3QgYmUgaHlkcmF0ZWQgaW50byBhIHJlYWwgQ3VzdG9tR2Vub21lIG9iamVjdC5cbiAgICAgICAgLy8gV2UgcmVwbGFjZSAuZ2V0U2VxdWVuY2UoKSB3aXRoIGFuIGFzeW5jaHJvbm91cyB2ZXJzaW9uLlxuICAgICAgICByZXR1cm4gXy5leHRlbmQobmV3IEN1c3RvbUdlbm9tZShmYWxzZSksIGdlbm9tZSwge1xuICAgICAgICAgIGdldFNlcXVlbmNlOiBmdW5jdGlvbigpIHsgQ3VzdG9tR2Vub21lLnByb3RvdHlwZS5nZXRTZXF1ZW5jZUFzeW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG4gIFxuICBnbG9iYWwuQ3VzdG9tR2Vub21lcyA9IEN1c3RvbUdlbm9tZXM7XG4gIFxufSk7IiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gQ3VzdG9tVHJhY2ssIGFuIG9iamVjdCByZXByZXNlbnRpbmcgYSBjdXN0b20gdHJhY2sgYXMgdW5kZXJzdG9vZCBieSBVQ1NDLiA9XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy9cbi8vIFRoaXMgY2xhc3MgKmRvZXMqIGRlcGVuZCBvbiBnbG9iYWwgb2JqZWN0cyBhbmQgdGhlcmVmb3JlIG11c3QgYmUgcmVxdWlyZWQgYXMgYSBcbi8vIGZ1bmN0aW9uIHRoYXQgaXMgZXhlY3V0ZWQgb24gdGhlIGdsb2JhbCBvYmplY3QuXG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZ2xvYmFsKSB7XG5cbnZhciBfID0gcmVxdWlyZSgnLi4vdW5kZXJzY29yZS5taW4uanMnKTtcblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi90cmFjay10eXBlcy91dGlscy91dGlscy5qcycpLFxuICBwYXJzZUludDEwID0gdXRpbHMucGFyc2VJbnQxMDtcblxuZnVuY3Rpb24gQ3VzdG9tVHJhY2sob3B0cywgYnJvd3Nlck9wdHMpIHtcbiAgaWYgKCFvcHRzKSB7IHJldHVybjsgfSAvLyBUaGlzIGlzIGFuIGVtcHR5IGN1c3RvbVRyYWNrIHRoYXQgd2lsbCBiZSBoeWRyYXRlZCB3aXRoIHZhbHVlcyBmcm9tIGEgc2VyaWFsaXplZCBvYmplY3RcbiAgdGhpcy5fdHlwZSA9IChvcHRzLnR5cGUgJiYgb3B0cy50eXBlLnRvTG93ZXJDYXNlKCkpIHx8IFwiYmVkXCI7XG4gIHZhciB0eXBlID0gdGhpcy50eXBlKCk7XG4gIGlmICh0eXBlID09PSBudWxsKSB7IHRocm93IG5ldyBFcnJvcihcIlVuc3VwcG9ydGVkIHRyYWNrIHR5cGUgJ1wiK29wdHMudHlwZStcIicgZW5jb3VudGVyZWQgb24gbGluZSBcIiArIG9wdHMubGluZU51bSk7IH1cbiAgdGhpcy5vcHRzID0gXy5leHRlbmQoe30sIHRoaXMuY29uc3RydWN0b3IuZGVmYXVsdHMsIHR5cGUuZGVmYXVsdHMgfHwge30sIG9wdHMpO1xuICBfLmV4dGVuZCh0aGlzLCB7XG4gICAgYnJvd3Nlck9wdHM6IGJyb3dzZXJPcHRzLFxuICAgIHN0cmV0Y2hIZWlnaHQ6IGZhbHNlLFxuICAgIGhlaWdodHM6IHt9LFxuICAgIHNpemVzOiBbJ2RlbnNlJ10sXG4gICAgbWFwU2l6ZXM6IFtdLFxuICAgIGFyZWFzOiB7fSxcbiAgICBub0FyZWFMYWJlbHM6IGZhbHNlLFxuICAgIGV4cGVjdHNTZXF1ZW5jZTogZmFsc2VcbiAgfSk7XG4gIHRoaXMuaW5pdCgpO1xufVxuXG5DdXN0b21UcmFjay5kZWZhdWx0cyA9IHtcbiAgbmFtZTogJ1VzZXIgVHJhY2snLFxuICBkZXNjcmlwdGlvbjogJ1VzZXIgU3VwcGxpZWQgVHJhY2snLFxuICBjb2xvcjogJzAsMCwwJ1xufTtcblxuQ3VzdG9tVHJhY2sudHlwZXMgPSB7XG4gIGJlZDogcmVxdWlyZSgnLi90cmFjay10eXBlcy9iZWQuanMnKSxcbiAgZmVhdHVyZXRhYmxlOiByZXF1aXJlKCcuL3RyYWNrLXR5cGVzL2ZlYXR1cmV0YWJsZS5qcycpLFxuICBiZWRncmFwaDogcmVxdWlyZSgnLi90cmFjay10eXBlcy9iZWRncmFwaC5qcycpLFxuICB3aWdnbGVfMDogcmVxdWlyZSgnLi90cmFjay10eXBlcy93aWdnbGVfMC5qcycpLFxuICB2Y2Z0YWJpeDogcmVxdWlyZSgnLi90cmFjay10eXBlcy92Y2Z0YWJpeC5qcycpLFxuICBiaWdiZWQ6IHJlcXVpcmUoJy4vdHJhY2stdHlwZXMvYmlnYmVkLmpzJyksXG4gIGJhbTogcmVxdWlyZSgnLi90cmFjay10eXBlcy9iYW0uanMnKSxcbiAgYmlnd2lnOiByZXF1aXJlKCcuL3RyYWNrLXR5cGVzL2JpZ3dpZy5qcycpXG59O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSBiZWREZXRhaWwgZm9ybWF0OiBodHRwczovL2dlbm9tZS51Y3NjLmVkdS9GQVEvRkFRZm9ybWF0Lmh0bWwjZm9ybWF0MS43ID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICBcblxuQ3VzdG9tVHJhY2sudHlwZXMuYmVkZGV0YWlsID0gXy5jbG9uZShDdXN0b21UcmFjay50eXBlcy5iZWQpO1xuQ3VzdG9tVHJhY2sudHlwZXMuYmVkZGV0YWlsLmRlZmF1bHRzID0gXy5leHRlbmQoe30sIEN1c3RvbVRyYWNrLnR5cGVzLmJlZGRldGFpbC5kZWZhdWx0cywge2RldGFpbDogdHJ1ZX0pO1xuXG4vLyBUaGVzZSBmdW5jdGlvbnMgYnJhbmNoIHRvIGRpZmZlcmVudCBtZXRob2RzIGRlcGVuZGluZyBvbiB0aGUgLnR5cGUoKSBvZiB0aGUgdHJhY2tcbl8uZWFjaChbJ2luaXQnLCAncGFyc2UnLCAncmVuZGVyJywgJ3JlbmRlclNlcXVlbmNlJywgJ3ByZXJlbmRlciddLCBmdW5jdGlvbihmbikge1xuICBDdXN0b21UcmFjay5wcm90b3R5cGVbZm5dID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGFyZ3MgPSBfLnRvQXJyYXkoYXJndW1lbnRzKSxcbiAgICAgIHR5cGUgPSB0aGlzLnR5cGUoKTtcbiAgICBpZiAoIXR5cGVbZm5dKSB7IHJldHVybiBmYWxzZTsgfVxuICAgIHJldHVybiB0eXBlW2ZuXS5hcHBseSh0aGlzLCBhcmdzKTtcbiAgfVxufSk7XG5cbkN1c3RvbVRyYWNrLnByb3RvdHlwZS5sb2FkT3B0cyA9IGZ1bmN0aW9uKCRkaWFsb2cpIHtcbiAgdmFyIHR5cGUgPSB0aGlzLnR5cGUoKSxcbiAgICBvID0gdGhpcy5vcHRzO1xuICAkZGlhbG9nLmZpbmQoJy5jdXN0b20tb3B0cy1mb3JtJykuaGlkZSgpO1xuICAkZGlhbG9nLmZpbmQoJy5jdXN0b20tb3B0cy1mb3JtLicrdGhpcy5fdHlwZSkuc2hvdygpO1xuICAkZGlhbG9nLmZpbmQoJy5jdXN0b20tbmFtZScpLnRleHQoby5uYW1lKTtcbiAgJGRpYWxvZy5maW5kKCcuY3VzdG9tLWRlc2MnKS50ZXh0KG8uZGVzY3JpcHRpb24pO1xuICAkZGlhbG9nLmZpbmQoJy5jdXN0b20tZm9ybWF0JykudGV4dCh0aGlzLl90eXBlKTtcbiAgJGRpYWxvZy5maW5kKCdbbmFtZT1jb2xvcl0nKS52YWwoby5jb2xvcikuY2hhbmdlKCk7XG4gIGlmICh0eXBlLmxvYWRPcHRzKSB7IHR5cGUubG9hZE9wdHMuY2FsbCh0aGlzLCAkZGlhbG9nKTsgfVxuICAkZGlhbG9nLmZpbmQoJy5lbmFibGVyJykuY2hhbmdlKCk7XG59O1xuXG5DdXN0b21UcmFjay5wcm90b3R5cGUuc2F2ZU9wdHMgPSBmdW5jdGlvbigkZGlhbG9nKSB7XG4gIHZhciB0eXBlID0gdGhpcy50eXBlKCksXG4gICAgbyA9IHRoaXMub3B0cztcbiAgby5jb2xvciA9ICRkaWFsb2cuZmluZCgnW25hbWU9Y29sb3JdJykudmFsKCk7XG4gIGlmICghdGhpcy52YWxpZGF0ZUNvbG9yKG8uY29sb3IpKSB7IG8uY29sb3IgPSAnMCwwLDAnOyB9XG4gIGlmICh0eXBlLnNhdmVPcHRzKSB7IHR5cGUuc2F2ZU9wdHMuY2FsbCh0aGlzLCAkZGlhbG9nKTsgfVxuICB0aGlzLmFwcGx5T3B0cygpO1xuICBnbG9iYWwuQ3VzdG9tVHJhY2tzLndvcmtlcigpICYmIHRoaXMuYXBwbHlPcHRzQXN5bmMoKTsgLy8gQXBwbHkgdGhlIGNoYW5nZXMgdG8gdGhlIHdvcmtlciB0b28hXG59O1xuXG5DdXN0b21UcmFjay5wcm90b3R5cGUuYXBwbHlPcHRzID0gZnVuY3Rpb24ob3B0cykge1xuICB2YXIgdHlwZSA9IHRoaXMudHlwZSgpO1xuICBpZiAob3B0cykgeyB0aGlzLm9wdHMgPSBvcHRzOyB9XG4gIGlmICh0eXBlLmFwcGx5T3B0cykgeyB0eXBlLmFwcGx5T3B0cy5jYWxsKHRoaXMpOyB9XG59O1xuXG5DdXN0b21UcmFjay5wcm90b3R5cGUuZXJhc2UgPSBmdW5jdGlvbihjYW52YXMpIHtcbiAgdmFyIHNlbGYgPSB0aGlzLFxuICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0ICYmIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICBpZiAoY3R4KSB7IGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsgfVxufVxuXG5DdXN0b21UcmFjay5wcm90b3R5cGUudHlwZSA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgaWYgKF8uaXNVbmRlZmluZWQodHlwZSkpIHsgdHlwZSA9IHRoaXMuX3R5cGU7IH1cbiAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IudHlwZXNbdHlwZV0gfHwgbnVsbDtcbn07XG5cbkN1c3RvbVRyYWNrLnByb3RvdHlwZS53YXJuID0gZnVuY3Rpb24od2FybmluZykge1xuICBpZiAodGhpcy5vcHRzLnN0cmljdCkge1xuICAgIHRocm93IG5ldyBFcnJvcih3YXJuaW5nKTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoIXRoaXMud2FybmluZ3MpIHsgdGhpcy53YXJuaW5ncyA9IFtdOyB9XG4gICAgdGhpcy53YXJuaW5ncy5wdXNoKHdhcm5pbmcpO1xuICB9XG59O1xuXG5DdXN0b21UcmFjay5wcm90b3R5cGUuaXNPbiA9IGZ1bmN0aW9uKHZhbCkge1xuICByZXR1cm4gL14ob258eWVzfHRydWV8dHx5fDEpJC9pLnRlc3QodmFsLnRvU3RyaW5nKCkpO1xufTtcblxuQ3VzdG9tVHJhY2sucHJvdG90eXBlLmNockxpc3QgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF0aGlzLl9jaHJMaXN0KSB7XG4gICAgdGhpcy5fY2hyTGlzdCA9IF8uc29ydEJ5KF8ubWFwKHRoaXMuYnJvd3Nlck9wdHMuY2hyUG9zLCBmdW5jdGlvbihwb3MsIGNocikgeyByZXR1cm4gW3BvcywgY2hyXTsgfSksIGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHZbMF07IH0pO1xuICB9XG4gIHJldHVybiB0aGlzLl9jaHJMaXN0O1xufVxuXG5DdXN0b21UcmFjay5wcm90b3R5cGUuY2hyQXQgPSBmdW5jdGlvbihwb3MpIHtcbiAgdmFyIGNockxpc3QgPSB0aGlzLmNockxpc3QoKSxcbiAgICBjaHJJbmRleCA9IF8uc29ydGVkSW5kZXgoY2hyTGlzdCwgW3Bvc10sIGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHZbMF07IH0pLFxuICAgIGNociA9IGNockluZGV4ID4gMCA/IGNockxpc3RbY2hySW5kZXggLSAxXVsxXSA6IG51bGw7XG4gIHJldHVybiB7aTogY2hySW5kZXggLSAxLCBjOiBjaHIsIHA6IHBvcyAtIHRoaXMuYnJvd3Nlck9wdHMuY2hyUG9zW2Nocl19O1xufTtcblxuQ3VzdG9tVHJhY2sucHJvdG90eXBlLmNoclJhbmdlID0gZnVuY3Rpb24oc3RhcnQsIGVuZCkge1xuICB2YXIgY2hyTGVuZ3RocyA9IHRoaXMuYnJvd3Nlck9wdHMuY2hyTGVuZ3RocyxcbiAgICBzdGFydENociA9IHRoaXMuY2hyQXQoc3RhcnQpLFxuICAgIGVuZENociA9IHRoaXMuY2hyQXQoZW5kKSxcbiAgICByYW5nZTtcbiAgaWYgKHN0YXJ0Q2hyLmMgJiYgc3RhcnRDaHIuaSA9PT0gZW5kQ2hyLmkpIHsgcmV0dXJuIFtzdGFydENoci5jICsgJzonICsgc3RhcnRDaHIucCArICctJyArIGVuZENoci5wXTsgfVxuICBlbHNlIHtcbiAgICByYW5nZSA9IF8ubWFwKHRoaXMuY2hyTGlzdCgpLnNsaWNlKHN0YXJ0Q2hyLmkgKyAxLCBlbmRDaHIuaSksIGZ1bmN0aW9uKHYpIHtcbiAgICAgIHJldHVybiB2WzFdICsgJzoxLScgKyBjaHJMZW5ndGhzW3ZbMV1dO1xuICAgIH0pO1xuICAgIHN0YXJ0Q2hyLmMgJiYgcmFuZ2UudW5zaGlmdChzdGFydENoci5jICsgJzonICsgc3RhcnRDaHIucCArICctJyArIGNockxlbmd0aHNbc3RhcnRDaHIuY10pO1xuICAgIGVuZENoci5jICYmIHJhbmdlLnB1c2goZW5kQ2hyLmMgKyAnOjEtJyArIGVuZENoci5wKTtcbiAgICByZXR1cm4gcmFuZ2U7XG4gIH1cbn1cblxuQ3VzdG9tVHJhY2sucHJvdG90eXBlLnByZXJlbmRlckFzeW5jID0gZnVuY3Rpb24oKSB7XG4gIGdsb2JhbC5DdXN0b21UcmFja3MuYXN5bmModGhpcywgJ3ByZXJlbmRlcicsIGFyZ3VtZW50cywgW3RoaXMuaWRdKTtcbn07XG5cbkN1c3RvbVRyYWNrLnByb3RvdHlwZS5hcHBseU9wdHNBc3luYyA9IGZ1bmN0aW9uKCkge1xuICBnbG9iYWwuQ3VzdG9tVHJhY2tzLmFzeW5jKHRoaXMsICdhcHBseU9wdHMnLCBbdGhpcy5vcHRzLCBmdW5jdGlvbigpe31dLCBbdGhpcy5pZF0pO1xufTtcblxuQ3VzdG9tVHJhY2sucHJvdG90eXBlLmFqYXhEaXIgPSBmdW5jdGlvbigpIHtcbiAgLy8gV2ViIFdvcmtlcnMgZmV0Y2ggVVJMcyByZWxhdGl2ZSB0byB0aGUgSlMgZmlsZSBpdHNlbGYuXG4gIHJldHVybiAoZ2xvYmFsLkhUTUxEb2N1bWVudCA/ICcnIDogJy4uLycpICsgdGhpcy5icm93c2VyT3B0cy5hamF4RGlyO1xufTtcblxuQ3VzdG9tVHJhY2sucHJvdG90eXBlLnJnYlRvSHNsID0gZnVuY3Rpb24ociwgZywgYikge1xuICByIC89IDI1NSwgZyAvPSAyNTUsIGIgLz0gMjU1O1xuICB2YXIgbWF4ID0gTWF0aC5tYXgociwgZywgYiksIG1pbiA9IE1hdGgubWluKHIsIGcsIGIpO1xuICB2YXIgaCwgcywgbCA9IChtYXggKyBtaW4pIC8gMjtcblxuICBpZiAobWF4ID09IG1pbikge1xuICAgIGggPSBzID0gMDsgLy8gYWNocm9tYXRpY1xuICB9IGVsc2Uge1xuICAgIHZhciBkID0gbWF4IC0gbWluO1xuICAgIHMgPSBsID4gMC41ID8gZCAvICgyIC0gbWF4IC0gbWluKSA6IGQgLyAobWF4ICsgbWluKTtcbiAgICBzd2l0Y2gobWF4KXtcbiAgICAgIGNhc2UgcjogaCA9IChnIC0gYikgLyBkICsgKGcgPCBiID8gNiA6IDApOyBicmVhaztcbiAgICAgIGNhc2UgZzogaCA9IChiIC0gcikgLyBkICsgMjsgYnJlYWs7XG4gICAgICBjYXNlIGI6IGggPSAociAtIGcpIC8gZCArIDQ7IGJyZWFrO1xuICAgIH1cbiAgICBoIC89IDY7XG4gIH1cblxuICByZXR1cm4gW2gsIHMsIGxdO1xufVxuXG5DdXN0b21UcmFjay5wcm90b3R5cGUuaHNsVG9SZ2IgPSBmdW5jdGlvbihoLCBzLCBsKSB7XG4gIHZhciByLCBnLCBiO1xuXG4gIGlmIChzID09IDApIHtcbiAgICByID0gZyA9IGIgPSBsOyAvLyBhY2hyb21hdGljXG4gIH0gZWxzZSB7XG4gICAgZnVuY3Rpb24gaHVlMnJnYihwLCBxLCB0KSB7XG4gICAgICBpZih0IDwgMCkgdCArPSAxO1xuICAgICAgaWYodCA+IDEpIHQgLT0gMTtcbiAgICAgIGlmKHQgPCAxLzYpIHJldHVybiBwICsgKHEgLSBwKSAqIDYgKiB0O1xuICAgICAgaWYodCA8IDEvMikgcmV0dXJuIHE7XG4gICAgICBpZih0IDwgMi8zKSByZXR1cm4gcCArIChxIC0gcCkgKiAoMi8zIC0gdCkgKiA2O1xuICAgICAgcmV0dXJuIHA7XG4gICAgfVxuXG4gICAgdmFyIHEgPSBsIDwgMC41ID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzO1xuICAgIHZhciBwID0gMiAqIGwgLSBxO1xuICAgIHIgPSBodWUycmdiKHAsIHEsIGggKyAxLzMpO1xuICAgIGcgPSBodWUycmdiKHAsIHEsIGgpO1xuICAgIGIgPSBodWUycmdiKHAsIHEsIGggLSAxLzMpO1xuICB9XG5cbiAgcmV0dXJuIFtyICogMjU1LCBnICogMjU1LCBiICogMjU1XTtcbn1cblxuQ3VzdG9tVHJhY2sucHJvdG90eXBlLnZhbGlkYXRlQ29sb3IgPSBmdW5jdGlvbihjb2xvcikge1xuICB2YXIgbSA9IGNvbG9yLm1hdGNoKC8oXFxkKyksKFxcZCspLChcXGQrKS8pO1xuICBpZiAoIW0pIHsgcmV0dXJuIGZhbHNlOyB9XG4gIG0uc2hpZnQoKTtcbiAgcmV0dXJuIF8uYWxsKF8ubWFwKG0sIHBhcnNlSW50MTApLCBmdW5jdGlvbih2KSB7IHJldHVybiB2ID49MCAmJiB2IDw9IDI1NTsgfSk7XG59XG5cbnJldHVybiBDdXN0b21UcmFjaztcblxufTsiLCJtb2R1bGUuZXhwb3J0cyA9IChmdW5jdGlvbihnbG9iYWwpe1xuICBcbiAgdmFyIF8gPSByZXF1aXJlKCcuLi91bmRlcnNjb3JlLm1pbi5qcycpO1xuICBcbiAgLy8gU29tZSB1dGlsaXR5IGZ1bmN0aW9ucy5cbiAgdmFyIHV0aWxzID0gcmVxdWlyZSgnLi90cmFjay10eXBlcy91dGlscy91dGlscy5qcycpLFxuICAgIHBhcnNlRGVjbGFyYXRpb25MaW5lID0gdXRpbHMucGFyc2VEZWNsYXJhdGlvbkxpbmU7XG4gIFxuICAvLyBUaGUgY2xhc3MgdGhhdCByZXByZXNlbnRzIGEgc2luZ3VsYXIgY3VzdG9tIHRyYWNrIG9iamVjdFxuICB2YXIgQ3VzdG9tVHJhY2sgPSByZXF1aXJlKCcuL0N1c3RvbVRyYWNrLmpzJykoZ2xvYmFsKTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gPSBDdXN0b21UcmFja3MsIHRoZSBtb2R1bGUgdGhhdCBpcyBleHBvcnRlZCB0byB0aGUgZ2xvYmFsIGVudmlyb25tZW50LiA9XG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvL1xuICAvLyBCcm9hZGx5IHNwZWFraW5nIHRoaXMgaXMgYSBmYWN0b3J5IGZvciBwYXJzaW5nIGRhdGEgaW50byBDdXN0b21UcmFjayBvYmplY3RzLFxuICAvLyBhbmQgaXQgY2FuIGRlbGVnYXRlIHRoaXMgd29yayB0byBhIHdvcmtlciB0aHJlYWQuXG5cbiAgdmFyIEN1c3RvbVRyYWNrcyA9IHtcbiAgICBwYXJzZTogZnVuY3Rpb24oY2h1bmtzLCBicm93c2VyT3B0cykge1xuICAgICAgdmFyIGN1c3RvbVRyYWNrcyA9IFtdLFxuICAgICAgICBkYXRhID0gW10sXG4gICAgICAgIHRyYWNrLCBvcHRzLCBtO1xuICAgICAgXG4gICAgICBpZiAodHlwZW9mIGNodW5rcyA9PSBcInN0cmluZ1wiKSB7IGNodW5rcyA9IFtjaHVua3NdOyB9XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIHB1c2hUcmFjaygpIHtcbiAgICAgICAgaWYgKHRyYWNrLnBhcnNlKGRhdGEpKSB7IGN1c3RvbVRyYWNrcy5wdXNoKHRyYWNrKTsgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBjdXN0b21UcmFja3MuYnJvd3NlciA9IHt9O1xuICAgICAgXy5lYWNoKGNodW5rcywgZnVuY3Rpb24odGV4dCkge1xuICAgICAgICBfLmVhY2godGV4dC5zcGxpdChcIlxcblwiKSwgZnVuY3Rpb24obGluZSwgbGluZW5vKSB7XG4gICAgICAgICAgaWYgKC9eIy8udGVzdChsaW5lKSkge1xuICAgICAgICAgICAgLy8gY29tbWVudCBsaW5lXG4gICAgICAgICAgfSBlbHNlIGlmICgvXmJyb3dzZXJcXHMrLy50ZXN0KGxpbmUpKSB7XG4gICAgICAgICAgICAvLyBicm93c2VyIGxpbmVzXG4gICAgICAgICAgICBtID0gbGluZS5tYXRjaCgvXmJyb3dzZXJcXHMrKFxcdyspXFxzKyhcXFMqKS8pO1xuICAgICAgICAgICAgaWYgKCFtKSB7IHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBwYXJzZSBicm93c2VyIGxpbmUgZm91bmQgYXQgbGluZSBcIiArIChsaW5lbm8gKyAxKSk7IH1cbiAgICAgICAgICAgIGN1c3RvbVRyYWNrcy5icm93c2VyW21bMV1dID0gbVsyXTtcbiAgICAgICAgICB9IGVsc2UgaWYgKC9edHJhY2tcXHMrL2kudGVzdChsaW5lKSkge1xuICAgICAgICAgICAgaWYgKHRyYWNrKSB7IHB1c2hUcmFjaygpOyB9XG4gICAgICAgICAgICBvcHRzID0gcGFyc2VEZWNsYXJhdGlvbkxpbmUobGluZSwgKC9edHJhY2tcXHMrL2kpKTtcbiAgICAgICAgICAgIGlmICghb3B0cykgeyB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgcGFyc2UgdHJhY2sgbGluZSBmb3VuZCBhdCBsaW5lIFwiICsgKGxpbmVubyArIDEpKTsgfVxuICAgICAgICAgICAgb3B0cy5saW5lTnVtID0gbGluZW5vICsgMTtcbiAgICAgICAgICAgIHRyYWNrID0gbmV3IEN1c3RvbVRyYWNrKG9wdHMsIGJyb3dzZXJPcHRzKTtcbiAgICAgICAgICAgIGRhdGEgPSBbXTtcbiAgICAgICAgICB9IGVsc2UgaWYgKC9cXFMvLnRlc3QobGluZSkpIHtcbiAgICAgICAgICAgIGlmICghdHJhY2spIHsgdGhyb3cgbmV3IEVycm9yKFwiRm91bmQgZGF0YSBvbiBsaW5lIFwiKyhsaW5lbm8rMSkrXCIgYnV0IG5vIHByZWNlZGluZyB0cmFjayBkZWZpbml0aW9uXCIpOyB9XG4gICAgICAgICAgICBkYXRhLnB1c2gobGluZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgaWYgKHRyYWNrKSB7IHB1c2hUcmFjaygpOyB9XG4gICAgICByZXR1cm4gY3VzdG9tVHJhY2tzO1xuICAgIH0sXG4gICAgXG4gICAgcGFyc2VEZWNsYXJhdGlvbkxpbmU6IHBhcnNlRGVjbGFyYXRpb25MaW5lLFxuICAgIFxuICAgIGVycm9yOiBmdW5jdGlvbihlKSB7XG4gICAgICAvLyBDYW4gYmUgb3ZlcnJpZGRlbiBieSBhIHBhcmVudCBsaWJyYXJ5IHRvIGhhbmRsZSBlcnJvcnMgbW9yZSBncmFjZWZ1bGx5LlxuICAgICAgLy8gTm90ZTogdGhpcyBpcyBvdmVycmlkZGVuIGJ5IHVpLmdlbm9icm93c2VyIGR1cmluZyBVSSBzZXR1cC5cbiAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgIH0sXG4gICAgXG4gICAgX3dvcmtlclNjcmlwdDogJ2J1aWxkL0N1c3RvbVRyYWNrV29ya2VyLmpzJyxcbiAgICAvLyBOT1RFOiBUbyB0ZW1wb3JhcmlseSBkaXNhYmxlIFdlYiBXb3JrZXIgdXNhZ2UsIHNldCB0aGlzIHRvIHRydWUuXG4gICAgX2Rpc2FibGVXb3JrZXJzOiBmYWxzZSxcbiAgICBcbiAgICB3b3JrZXI6IGZ1bmN0aW9uKCkgeyBcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgY2FsbGJhY2tzID0gW107XG4gICAgICBpZiAoIXNlbGYuX3dvcmtlciAmJiBnbG9iYWwuV29ya2VyKSB7IFxuICAgICAgICBzZWxmLl93b3JrZXIgPSBuZXcgZ2xvYmFsLldvcmtlcihzZWxmLl93b3JrZXJTY3JpcHQpO1xuICAgICAgICBzZWxmLl93b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBmdW5jdGlvbihlKSB7IHNlbGYuZXJyb3IoZSk7IH0sIGZhbHNlKTtcbiAgICAgICAgc2VsZi5fd29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgaWYgKGUuZGF0YS5sb2cpIHsgY29uc29sZS5sb2coSlNPTi5wYXJzZShlLmRhdGEubG9nKSk7IHJldHVybjsgfVxuICAgICAgICAgIGlmIChlLmRhdGEuZXJyb3IpIHtcbiAgICAgICAgICAgIGlmIChlLmRhdGEuaWQpIHsgY2FsbGJhY2tzW2UuZGF0YS5pZF0gPSBudWxsOyB9XG4gICAgICAgICAgICBzZWxmLmVycm9yKEpTT04ucGFyc2UoZS5kYXRhLmVycm9yKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhbGxiYWNrc1tlLmRhdGEuaWRdKEpTT04ucGFyc2UoZS5kYXRhLnJldCkpO1xuICAgICAgICAgIGNhbGxiYWNrc1tlLmRhdGEuaWRdID0gbnVsbDtcbiAgICAgICAgfSk7XG4gICAgICAgIHNlbGYuX3dvcmtlci5jYWxsID0gZnVuY3Rpb24ob3AsIGFyZ3MsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyIGlkID0gY2FsbGJhY2tzLnB1c2goY2FsbGJhY2spIC0gMTtcbiAgICAgICAgICB0aGlzLnBvc3RNZXNzYWdlKHtvcDogb3AsIGlkOiBpZCwgYXJnczogYXJnc30pO1xuICAgICAgICB9O1xuICAgICAgICAvLyBUbyBoYXZlIHRoZSB3b3JrZXIgdGhyb3cgZXJyb3JzIGluc3RlYWQgb2YgcGFzc2luZyB0aGVtIG5pY2VseSBiYWNrLCBjYWxsIHRoaXMgd2l0aCB0b2dnbGU9dHJ1ZVxuICAgICAgICBzZWxmLl93b3JrZXIudGhyb3dFcnJvcnMgPSBmdW5jdGlvbih0b2dnbGUpIHtcbiAgICAgICAgICB0aGlzLnBvc3RNZXNzYWdlKHtvcDogJ3Rocm93RXJyb3JzJywgYXJnczogW3RvZ2dsZV19KTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzZWxmLl9kaXNhYmxlV29ya2VycyA/IG51bGwgOiBzZWxmLl93b3JrZXI7XG4gICAgfSxcbiAgICBcbiAgICBhc3luYzogZnVuY3Rpb24oc2VsZiwgZm4sIGFyZ3MsIGFzeW5jRXh0cmFBcmdzLCB3cmFwcGVyKSB7XG4gICAgICBhcmdzID0gXy50b0FycmF5KGFyZ3MpO1xuICAgICAgd3JhcHBlciA9IHdyYXBwZXIgfHwgXy5pZGVudGl0eTtcbiAgICAgIHZhciBhcmdzRXhjZXB0TGFzdE9uZSA9IF8uaW5pdGlhbChhcmdzKSxcbiAgICAgICAgY2FsbGJhY2sgPSBfLmxhc3QoYXJncyksXG4gICAgICAgIHcgPSB0aGlzLndvcmtlcigpO1xuICAgICAgLy8gRmFsbGJhY2sgaWYgd2ViIHdvcmtlcnMgYXJlIG5vdCBzdXBwb3J0ZWQuXG4gICAgICAvLyBUaGlzIGNvdWxkIGFsc28gYmUgdHdlYWtlZCB0byBub3QgdXNlIHdlYiB3b3JrZXJzIHdoZW4gdGhlcmUgd291bGQgYmUgbm8gcGVyZm9ybWFuY2UgZ2FpbjtcbiAgICAgIC8vICAgYWN0aXZhdGluZyB0aGlzIGJyYW5jaCBkaXNhYmxlcyB3ZWIgd29ya2VycyBlbnRpcmVseSBhbmQgZXZlcnl0aGluZyBoYXBwZW5zIHN5bmNocm9ub3VzbHkuXG4gICAgICBpZiAoIXcpIHsgcmV0dXJuIGNhbGxiYWNrKHNlbGZbZm5dLmFwcGx5KHNlbGYsIGFyZ3NFeGNlcHRMYXN0T25lKSk7IH1cbiAgICAgIEFycmF5LnByb3RvdHlwZS51bnNoaWZ0LmFwcGx5KGFyZ3NFeGNlcHRMYXN0T25lLCBhc3luY0V4dHJhQXJncyk7XG4gICAgICB3LmNhbGwoZm4sIGFyZ3NFeGNlcHRMYXN0T25lLCBmdW5jdGlvbihyZXQpIHsgY2FsbGJhY2sod3JhcHBlcihyZXQpKTsgfSk7XG4gICAgfSxcbiAgICBcbiAgICBwYXJzZUFzeW5jOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuYXN5bmModGhpcywgJ3BhcnNlJywgYXJndW1lbnRzLCBbXSwgZnVuY3Rpb24odHJhY2tzKSB7XG4gICAgICAgIC8vIFRoZXNlIGhhdmUgYmVlbiBzZXJpYWxpemVkLCBzbyB0aGV5IG11c3QgYmUgaHlkcmF0ZWQgaW50byByZWFsIEN1c3RvbVRyYWNrIG9iamVjdHMuXG4gICAgICAgIC8vIFdlIHJlcGxhY2UgLnByZXJlbmRlcigpIHdpdGggYW4gYXN5bmNocm9ub3VzIHZlcnNpb24uXG4gICAgICAgIHJldHVybiBfLm1hcCh0cmFja3MsIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICByZXR1cm4gXy5leHRlbmQobmV3IEN1c3RvbVRyYWNrKCksIHQsIHtcbiAgICAgICAgICAgIHByZXJlbmRlcjogZnVuY3Rpb24oKSB7IEN1c3RvbVRyYWNrLnByb3RvdHlwZS5wcmVyZW5kZXJBc3luYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGdsb2JhbC5DdXN0b21UcmFja3MgPSBDdXN0b21UcmFja3M7XG5cbn0pOyIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9IGNocm9tLnNpemVzIGZvcm1hdDogaHR0cDovL3d3dy5icm9hZGluc3RpdHV0ZS5vcmcvaWd2L2Nocm9tU2l6ZXMgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE5vdGU6IHdlIGFyZSBleHRlbmRpbmcgdGhlIGdlbmVyYWwgdXNlIG9mIHRoaXMgdG8gaW5jbHVkZSBkYXRhIGxvYWRlZCBmcm9tIHRoZSBnZW5vbWUudHh0IGFuZCBhbm5vdHMueG1sXG4vLyBmaWxlcyBvZiBhbiBJR0IgcXVpY2tsb2FkIGRpcmVjdG9yeSxcblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy91dGlscy5qcycpLFxuICBwYXJzZUludDEwID0gdXRpbHMucGFyc2VJbnQxMCxcbiAgc3RyaXAgPSB1dGlscy5zdHJpcCxcbiAgb3B0c0FzVHJhY2tMaW5lID0gdXRpbHMub3B0c0FzVHJhY2tMaW5lO1xuXG52YXIgQ2hyb21TaXplc0Zvcm1hdCA9IHtcbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgbSA9IHNlbGYubWV0YWRhdGEsXG4gICAgICBvID0gc2VsZi5vcHRzO1xuICAgIG8uc3BlY2llcyA9IG0uc3BlY2llcyB8fCAnQ3VzdG9tIEdlbm9tZSc7XG4gICAgby5hc3NlbWJseURhdGUgPSBtLmFzc2VtYmx5RGF0ZSB8fCAnJztcbiAgICBcbiAgICAvLyBUT0RPOiBpZiBtZXRhZGF0YSBhbHNvIGNvbnRhaW5zIGN1c3RvbSB0cmFjayBkYXRhLCBlLmcuIGZyb20gYW5ub3RzLnhtbFxuICAgIC8vIG11c3QgY29udmVydCB0aGVtIGludG8gaXRlbXMgZm9yIG8uYXZhaWxUcmFja3MsIG8udHJhY2tzLCBhbmQgby50cmFja0Rlc2NcbiAgICAvLyBUaGUgby5hdmFpbFRyYWNrcyBpdGVtcyBzaG91bGQgY29udGFpbiB7Y3VzdG9tRGF0YTogdHJhY2tsaW5lc30gdG8gYmUgcGFyc2VkXG4gICAgaWYgKG0udHJhY2tzKSB7IHNlbGYuZm9ybWF0KCkuY3JlYXRlVHJhY2tzKG0udHJhY2tzKTsgfVxuICB9LFxuICBcbiAgY3JlYXRlVHJhY2tzOiBmdW5jdGlvbih0cmFja3MpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gc2VsZi5vcHRzO1xuICAgICAgXG4gICAgXy5lYWNoKHRyYWNrcywgZnVuY3Rpb24odCkge1xuICAgICAgdmFyIHRyYWNrT3B0cztcbiAgICAgIHQubGluZXMgPSB0LmxpbmVzIHx8IFtdO1xuICAgICAgdHJhY2tPcHRzID0gL150cmFja1xccysvaS50ZXN0KHQubGluZXNbMF0pID8gZ2xvYmFsLkN1c3RvbVRyYWNrcy5wYXJzZURlY2xhcmF0aW9uTGluZSh0LmxpbmVzLnNoaWZ0KCkpIDoge307XG4gICAgICB0LmxpbmVzLnVuc2hpZnQoJ3RyYWNrICcgKyBvcHRzQXNUcmFja0xpbmUoXy5leHRlbmQodHJhY2tPcHRzLCB0Lm9wdHMsIHtuYW1lOiB0Lm5hbWUsIHR5cGU6IHQudHlwZX0pKSArICdcXG4nKTtcbiAgICAgIG8uYXZhaWxUcmFja3MucHVzaCh7XG4gICAgICAgIGZoOiB7fSxcbiAgICAgICAgbjogdC5uYW1lLFxuICAgICAgICBzOiBbJ2RlbnNlJywgJ3NxdWlzaCcsICdwYWNrJ10sXG4gICAgICAgIGg6IDE1LFxuICAgICAgICBtOiBbJ3BhY2snXSxcbiAgICAgICAgY3VzdG9tRGF0YTogdC5saW5lc1xuICAgICAgfSk7XG4gICAgICBvLnRyYWNrcy5wdXNoKHtuOiB0Lm5hbWV9KTtcbiAgICAgIG8udHJhY2tEZXNjW3QubmFtZV0gPSB7XG4gICAgICAgIGNhdDogXCJGZWF0dXJlIFRyYWNrc1wiLFxuICAgICAgICBzbTogdC5uYW1lLFxuICAgICAgICBsZzogdC5kZXNjcmlwdGlvbiB8fCB0Lm5hbWVcbiAgICAgIH07XG4gICAgfSk7XG4gIH0sXG4gIFxuICBwYXJzZTogZnVuY3Rpb24odGV4dCkge1xuICAgIHZhciBsaW5lcyA9IHRleHQuc3BsaXQoXCJcXG5cIiksXG4gICAgICBvID0gdGhpcy5vcHRzO1xuICAgIF8uZWFjaChsaW5lcywgZnVuY3Rpb24obGluZSwgaSkge1xuICAgICAgdmFyIGNocnNpemUgPSBzdHJpcChsaW5lKS5zcGxpdCgvXFxzKy8sIDIpLFxuICAgICAgICBjaHIgPSBjaHJzaXplWzBdLFxuICAgICAgICBzaXplID0gcGFyc2VJbnQxMChjaHJzaXplWzFdKTtcbiAgICAgIGlmIChfLmlzTmFOKHNpemUpKSB7IHJldHVybjsgfVxuICAgICAgby5jaHJPcmRlci5wdXNoKGNocik7XG4gICAgICBvLmNockxlbmd0aHNbY2hyXSA9IHNpemU7XG4gICAgICBvLmdlbm9tZVNpemUgKz0gc2l6ZTtcbiAgICB9KTtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDaHJvbVNpemVzRm9ybWF0OyIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9IEZBU1RBIGZvcm1hdDogaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9GQVNUQV9mb3JtYXQgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy91dGlscy5qcycpLFxuICBlbnN1cmVVbmlxdWUgPSB1dGlscy5lbnN1cmVVbmlxdWU7XG5cbnZhciBGYXN0YUZvcm1hdCA9IHtcbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgbSA9IHNlbGYubWV0YWRhdGEsXG4gICAgICBvID0gc2VsZi5vcHRzO1xuICAgICAgXG4gICAgc2VsZi5kYXRhID0ge307XG4gIH0sXG4gIFxuICBwYXJzZTogZnVuY3Rpb24odGV4dCkge1xuICAgIHZhciBsaW5lcyA9IHRleHQuc3BsaXQoXCJcXG5cIiksXG4gICAgICBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdHMsXG4gICAgICBjaHIgPSBudWxsLFxuICAgICAgdW5uYW1lZENvdW50ZXIgPSAxLFxuICAgICAgY2hyc2VxID0gW107XG4gICAgICBcbiAgICBzZWxmLmRhdGEuc2VxdWVuY2UgPSBbXTtcbiAgICBcbiAgICBfLmVhY2gobGluZXMsIGZ1bmN0aW9uKGxpbmUsIGkpIHtcbiAgICAgIHZhciBjaHJMaW5lID0gbGluZS5tYXRjaCgvXls+O10oLispLyksXG4gICAgICAgIGNsZWFuZWRMaW5lID0gbGluZS5yZXBsYWNlKC9cXHMrL2csICcnKTtcbiAgICAgIGlmIChjaHJMaW5lKSB7XG4gICAgICAgIGNociA9IGNockxpbmVbMV0ucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpO1xuICAgICAgICBpZiAoIWNoci5sZW5ndGgpIHsgY2hyID0gXCJ1bm5hbWVkQ2hyXCI7IH1cbiAgICAgICAgY2hyID0gZW5zdXJlVW5pcXVlKGNociwgby5jaHJMZW5ndGhzKTtcbiAgICAgICAgby5jaHJPcmRlci5wdXNoKGNocik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLmRhdGEuc2VxdWVuY2UucHVzaChjbGVhbmVkTGluZSk7XG4gICAgICAgIG8uY2hyTGVuZ3Roc1tjaHJdID0gKG8uY2hyTGVuZ3Roc1tjaHJdIHx8IDApICsgY2xlYW5lZExpbmUubGVuZ3RoO1xuICAgICAgICBvLmdlbm9tZVNpemUgKz0gY2xlYW5lZExpbmUubGVuZ3RoO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZGF0YS5zZXF1ZW5jZSA9IHNlbGYuZGF0YS5zZXF1ZW5jZS5qb2luKCcnKTtcbiAgICBzZWxmLmNhbkdldFNlcXVlbmNlID0gdHJ1ZTtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBGYXN0YUZvcm1hdDsiLCJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gR2VuQmFuayBmb3JtYXQ6IGh0dHA6Ly93d3cubmNiaS5ubG0ubmloLmdvdi9TaXRlbWFwL3NhbXBsZXJlY29yZC5odG1sID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy91dGlscy5qcycpLFxuICBwYXJzZUludDEwID0gdXRpbHMucGFyc2VJbnQxMCxcbiAgc3RyaXAgPSB1dGlscy5zdHJpcCxcbiAgdG9wVGFnc0FzQXJyYXkgPSB1dGlscy50b3BUYWdzQXNBcnJheSxcbiAgc3ViVGFnc0FzQXJyYXkgPSB1dGlscy5zdWJUYWdzQXNBcnJheSxcbiAgZmV0Y2hGaWVsZCA9IHV0aWxzLmZldGNoRmllbGQsXG4gIGdldFRhZyA9IHV0aWxzLmdldFRhZyxcbiAgZW5zdXJlVW5pcXVlID0gdXRpbHMuZW5zdXJlVW5pcXVlO1xuXG52YXIgR2VuQmFua0Zvcm1hdCA9IHtcbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgLy8gTm90ZSB0aGF0IHdlIGNhbGwgR2VuQmFuayBmaWVsZCBuYW1lcyBsaWtlIFwiTE9DVVNcIiwgXCJERUZJTklUSU9OXCIsIGV0Yy4gdGFncyBpbnN0ZWFkIG9mIGtleXMuXG4gICAgLy8gV2UgZG8gdGhpcyBiZWNhdXNlOiAxKSBjZXJ0YWluIGZpZWxkIG5hbWVzIGNhbiBiZSByZXBlYXRlZCAoZS5nLiBSRUZFUkVOQ0UpIHdoaWNoIGlzIG1vcmUgXG4gICAgLy8gZXZvY2F0aXZlIG9mIFwidGFnc1wiIGFzIG9wcG9zZWQgdG8gdGhlIGJlaGF2aW9yIG9mIGtleXMgaW4gYSBoYXNoLiAgQWxzbywgMikgdGhpcyBpcyB0aGVcbiAgICAvLyBub21lbmNsYXR1cmUgcGlja2VkIGJ5IEJpb1J1YnkuXG4gICAgXG4gICAgdGhpcy50YWdTaXplID0gMTI7IC8vIGhvdyB3aWRlIHRoZSBjb2x1bW4gZm9yIHRhZ3MgaXMgaW4gYSBHZW5CYW5rIGZpbGVcbiAgICB0aGlzLmZlYXR1cmVUYWdTaXplID0gMjE7IC8vIGhvdyB3aWRlIHRoZSBjb2x1bW4gZm9yIHRhZ3MgaXMgaW4gdGhlIGZlYXR1cmUgdGFibGUgc2VjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VlIHNlY3Rpb24gNC4xIG9mIGh0dHA6Ly93d3cuaW5zZGMub3JnL2ZpbGVzL2ZlYXR1cmVfdGFibGUuaHRtbFxuICAgIFxuICAgIHRoaXMuZGF0YSA9IHtcbiAgICAgIGNvbnRpZ3M6IFtdLFxuICAgICAgdHJhY2tMaW5lczoge1xuICAgICAgICBzb3VyY2U6IFtdLFxuICAgICAgICBnZW5lczogW10sXG4gICAgICAgIG90aGVyOiBbXVxuICAgICAgfVxuICAgIH07XG4gIH0sXG4gIFxuICBwYXJzZUxvY3VzOiBmdW5jdGlvbihjb250aWcpIHtcbiAgICB2YXIgbG9jdXNMaW5lID0gY29udGlnLm9yaWcubG9jdXM7XG4gICAgaWYgKGxvY3VzTGluZSkge1xuICAgICAgaWYgKGxvY3VzTGluZS5sZW5ndGggPiA3NSkgeyAvLyBhZnRlciBSZWwgMTI2LjBcbiAgICAgICAgY29udGlnLmVudHJ5SWQgID0gc3RyaXAobG9jdXNMaW5lLnN1YnN0cmluZygxMiwgMjgpKTtcbiAgICAgICAgY29udGlnLmxlbmd0aCAgID0gcGFyc2VJbnQxMChsb2N1c0xpbmUuc3Vic3RyaW5nKDI5LCA0MCkpO1xuICAgICAgICBjb250aWcuc3RyYW5kICAgPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDQ0LCA0NykpO1xuICAgICAgICBjb250aWcubmF0eXBlICAgPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDQ3LCA1MykpO1xuICAgICAgICBjb250aWcuY2lyY3VsYXIgPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDU1LCA2MykpO1xuICAgICAgICBjb250aWcuZGl2aXNpb24gPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDYzLCA2NykpO1xuICAgICAgICBjb250aWcuZGF0ZSAgICAgPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDY4LCA3OSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGlnLmVudHJ5SWQgID0gc3RyaXAobG9jdXNMaW5lLnN1YnN0cmluZygxMiwgMjIpKTtcbiAgICAgICAgY29udGlnLmxlbmd0aCAgID0gcGFyc2VJbnQxMChsb2N1c0xpbmUuc3Vic3RyaW5nKDIyLCAzMCkpO1xuICAgICAgICBjb250aWcuc3RyYW5kICAgPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDMzLCAzNikpO1xuICAgICAgICBjb250aWcubmF0eXBlICAgPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDM2LCA0MCkpO1xuICAgICAgICBjb250aWcuY2lyY3VsYXIgPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDQyLCA1MikpO1xuICAgICAgICBjb250aWcuZGl2aXNpb24gPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDUyLCA1NSkpO1xuICAgICAgICBjb250aWcuZGF0ZSAgICAgPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDYyLCA3MykpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgXG4gIHBhcnNlSGVhZGVyRmllbGRzOiBmdW5jdGlvbihjb250aWcpIHtcbiAgICB2YXIgdGFnU2l6ZSA9IHRoaXMudGFnU2l6ZSxcbiAgICAgIGhlYWRlckZpZWxkc1RvUGFyc2UgPSB7XG4gICAgICAgIHNpbXBsZTogWydkZWZpbml0aW9uJywgJ2FjY2Vzc2lvbicsICd2ZXJzaW9uJ10sXG4gICAgICAgIGRlZXA6IFsnc291cmNlJ10gLy8gY291bGQgYWRkIHJlZmVyZW5jZXMsIGJ1dCB3ZSBkb24ndCBjYXJlIGFib3V0IHRob3NlIGhlcmVcbiAgICAgIH07XG4gICAgXG4gICAgLy8gUGFyc2Ugc2ltcGxlIGZpZWxkcyAodGFnIC0tPiBjb250ZW50KVxuICAgIF8uZWFjaChoZWFkZXJGaWVsZHNUb1BhcnNlLnNpbXBsZSwgZnVuY3Rpb24odGFnKSB7XG4gICAgICBpZiAoIWNvbnRpZy5vcmlnW3RhZ10pIHsgY29udGlnW3RhZ10gPSBudWxsOyByZXR1cm47IH1cbiAgICAgIGNvbnRpZ1t0YWddID0gZmV0Y2hGaWVsZChjb250aWcub3JpZ1t0YWddLCB0YWdTaXplKTtcbiAgICB9KTtcbiAgICBcbiAgICAvLyBQYXJzZSB0YWdzIHRoYXQgY2FuIHJlcGVhdCBhbmQgaGF2ZSBzdWJ0YWdzXG4gICAgXy5lYWNoKGhlYWRlckZpZWxkc1RvUGFyc2UuZGVlcCwgZnVuY3Rpb24odGFnKSB7XG4gICAgICB2YXIgZGF0YSA9IFtdLFxuICAgICAgICBpdGVtcztcbiAgICAgIGlmICghY29udGlnLm9yaWdbdGFnXSkgeyBjb250aWdbdGFnXSA9IG51bGw7IHJldHVybjsgfVxuICAgICAgXG4gICAgICBpdGVtcyA9IGNvbnRpZy5vcmlnW3RhZ10ucmVwbGFjZSgvXFxuKFtBLVphLXpcXC9cXCpdKS9nLCBcIlxcblxcMDAxJDFcIikuc3BsaXQoXCJcXDAwMVwiKTtcbiAgICAgIF8uZWFjaChpdGVtcywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICB2YXIgc3ViVGFncyA9IHN1YlRhZ3NBc0FycmF5KGl0ZW0sIHRhZ1NpemUpLFxuICAgICAgICAgIGl0ZW1OYW1lID0gZmV0Y2hGaWVsZChzdWJUYWdzLnNoaWZ0KCksIHRhZ1NpemUpLCBcbiAgICAgICAgICBpdGVtRGF0YSA9IHtfbmFtZTogaXRlbU5hbWV9O1xuICAgICAgICBfLmVhY2goc3ViVGFncywgZnVuY3Rpb24oc3ViVGFnRmllbGQpIHtcbiAgICAgICAgICB2YXIgdGFnID0gZ2V0VGFnKHN1YlRhZ0ZpZWxkLCB0YWdTaXplKTtcbiAgICAgICAgICBpdGVtRGF0YVt0YWddID0gZmV0Y2hGaWVsZChzdWJUYWdGaWVsZCwgdGFnU2l6ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBkYXRhLnB1c2goaXRlbURhdGEpO1xuICAgICAgfSk7XG4gICAgICBjb250aWdbdGFnXSA9IGRhdGE7XG4gICAgICBcbiAgICB9KTtcbiAgfSxcbiAgXG4gIHBhcnNlRmVhdHVyZVRhYmxlOiBmdW5jdGlvbihjaHIsIGNvbnRpZ0RhdGEpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICB0YWdTaXplID0gc2VsZi50YWdTaXplLFxuICAgICAgZmVhdHVyZVRhZ1NpemUgPSBzZWxmLmZlYXR1cmVUYWdTaXplLFxuICAgICAgdGFnc1RvU2tpcCA9IFtcImZlYXR1cmVzXCJdLFxuICAgICAgdGFnc1JlbGF0ZWRUb0dlbmVzID0gW1wiY2RzXCIsIFwiZ2VuZVwiLCBcIm1ybmFcIiwgXCJleG9uXCIsIFwiaW50cm9uXCJdLFxuICAgICAgY29udGlnTGluZSA9IFwiQUNDRVNTSU9OICAgXCIgKyBjaHIgKyBcIlxcblwiO1xuICAgIGlmIChjb250aWdEYXRhLm9yaWcuZmVhdHVyZXMpIHtcbiAgICAgIHZhciBzdWJUYWdzID0gc3ViVGFnc0FzQXJyYXkoY29udGlnRGF0YS5vcmlnLmZlYXR1cmVzLCB0YWdTaXplKTtcbiAgICAgIHNlbGYuZGF0YS50cmFja0xpbmVzLnNvdXJjZS5wdXNoKGNvbnRpZ0xpbmUpO1xuICAgICAgc2VsZi5kYXRhLnRyYWNrTGluZXMuZ2VuZXMucHVzaChjb250aWdMaW5lKTtcbiAgICAgIHNlbGYuZGF0YS50cmFja0xpbmVzLm90aGVyLnB1c2goY29udGlnTGluZSk7XG4gICAgICBfLmVhY2goc3ViVGFncywgZnVuY3Rpb24oc3ViVGFnRmllbGQpIHtcbiAgICAgICAgdmFyIHRhZyA9IGdldFRhZyhzdWJUYWdGaWVsZCwgZmVhdHVyZVRhZ1NpemUpO1xuICAgICAgICBpZiAodGFnc1RvU2tpcC5pbmRleE9mKHRhZykgIT09IC0xKSB7IHJldHVybjsgfVxuICAgICAgICBlbHNlIGlmICh0YWcgPT09IFwic291cmNlXCIpIHsgc2VsZi5kYXRhLnRyYWNrTGluZXMuc291cmNlLnB1c2goc3ViVGFnRmllbGQpOyB9XG4gICAgICAgIGVsc2UgaWYgKHRhZ3NSZWxhdGVkVG9HZW5lcy5pbmRleE9mKHRhZykgIT09IC0xKSB7IHNlbGYuZGF0YS50cmFja0xpbmVzLmdlbmVzLnB1c2goc3ViVGFnRmllbGQpOyAgfVxuICAgICAgICBlbHNlIHsgc2VsZi5kYXRhLnRyYWNrTGluZXMub3RoZXIucHVzaChzdWJUYWdGaWVsZCk7IH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgXG4gIHBhcnNlU2VxdWVuY2U6IGZ1bmN0aW9uKGNvbnRpZ0RhdGEpIHtcbiAgICBpZiAoY29udGlnRGF0YS5vcmlnLm9yaWdpbikge1xuICAgICAgcmV0dXJuIGNvbnRpZ0RhdGEub3JpZy5vcmlnaW4ucmVwbGFjZSgvXm9yaWdpbi4qfFxcblsgMC05XXsxMH18IC9pZywgJycpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gQXJyYXkoY29udGlnRGF0YS5sZW5ndGgpLmpvaW4oJ24nKTtcbiAgICB9XG4gIH0sXG4gIFxuICBjcmVhdGVUcmFja3NGcm9tRmVhdHVyZXM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdHMsXG4gICAgICBjYXRlZ29yeVR1cGxlcyA9IFtcbiAgICAgICAgW1wic291cmNlXCIsIFwiU291cmNlc1wiLCBcIlJlZ2lvbnMgYW5ub3RhdGVkIGJ5IHNvdXJjZSBvcmdhbmlzbSBvciBzcGVjaW1lblwiXSwgXG4gICAgICAgIFtcImdlbmVzXCIsIFwiR2VuZSBhbm5vdGF0aW9uc1wiLCBcIkNEUyBhbmQgZ2VuZSBmZWF0dXJlc1wiXSwgXG4gICAgICAgIFtcIm90aGVyXCIsIFwiT3RoZXIgYW5ub3RhdGlvbnNcIiwgXCJ0Uk5BcyBhbmQgb3RoZXIgZmVhdHVyZXNcIl1cbiAgICAgIF07XG4gICAgXG4gICAgLy8gRm9yIHRoZSBjYXRlZ29yaWVzIG9mIGZlYXR1cmVzLCBjcmVhdGUgYXBwcm9wcmlhdGUgZW50cmllcyBpbiBvLmF2YWlsVHJhY2tzLCBvLnRyYWNrcywgYW5kIG8udHJhY2tEZXNjXG4gICAgLy8gTGVhdmUgdGhlIGFjdHVhbCBkYXRhIGFzIGFycmF5cyBvZiBsaW5lcyB0aGF0IGFyZSBhdHRhY2hlZCBhcyAuY3VzdG9tRGF0YSB0byBvLmF2YWlsVHJhY2tzXG4gICAgLy8gVGhleSB3aWxsIGJlIHBhcnNlZCBsYXRlciB2aWEgQ3VzdG9tVHJhY2tzLnBhcnNlLlxuICAgIF8uZWFjaChjYXRlZ29yeVR1cGxlcywgZnVuY3Rpb24oY2F0ZWdvcnlUdXBsZSkge1xuICAgICAgdmFyIGNhdGVnb3J5ID0gY2F0ZWdvcnlUdXBsZVswXSxcbiAgICAgICAgbGFiZWwgPSBjYXRlZ29yeVR1cGxlWzFdLFxuICAgICAgICBsb25nTGFiZWwgPSBjYXRlZ29yeVR1cGxlWzJdLFxuICAgICAgICB0cmFja0xpbmVzID0gW107XG4gICAgICBpZiAoc2VsZi5kYXRhLnRyYWNrTGluZXNbY2F0ZWdvcnldLmxlbmd0aCA+IDApIHtcbiAgICAgICAgc2VsZi5kYXRhLnRyYWNrTGluZXNbY2F0ZWdvcnldLnVuc2hpZnQoJ3RyYWNrIHR5cGU9XCJmZWF0dXJlVGFibGVcIiBuYW1lPVwiJyArIGxhYmVsICsgXG4gICAgICAgICAgJ1wiIGNvbGxhcHNlQnlHZW5lPVwiJyArIChjYXRlZ29yeT09XCJnZW5lc1wiID8gJ29uJyA6ICdvZmYnKSArICdcIlxcbicpO1xuICAgICAgfVxuICAgICAgby5hdmFpbFRyYWNrcy5wdXNoKHtcbiAgICAgICAgZmg6IHt9LFxuICAgICAgICBuOiBjYXRlZ29yeSxcbiAgICAgICAgczogWydkZW5zZScsICdzcXVpc2gnLCAncGFjayddLFxuICAgICAgICBoOiAxNSxcbiAgICAgICAgbTogWydwYWNrJ10sXG4gICAgICAgIGN1c3RvbURhdGE6IHNlbGYuZGF0YS50cmFja0xpbmVzW2NhdGVnb3J5XVxuICAgICAgfSk7XG4gICAgICBvLnRyYWNrcy5wdXNoKHtuOiBjYXRlZ29yeX0pO1xuICAgICAgby50cmFja0Rlc2NbY2F0ZWdvcnldID0ge1xuICAgICAgICBjYXQ6IFwiRmVhdHVyZSBUcmFja3NcIixcbiAgICAgICAgc206IGxhYmVsLFxuICAgICAgICBsZzogbG9uZ0xhYmVsXG4gICAgICB9O1xuICAgIH0pO1xuICB9LFxuICBcbiAgcGFyc2U6IGZ1bmN0aW9uKHRleHQpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gc2VsZi5vcHRzLFxuICAgICAgY29udGlnRGVsaW1pdGVyID0gXCJcXG4vL1xcblwiLFxuICAgICAgY29udGlncyA9IHRleHQuc3BsaXQoY29udGlnRGVsaW1pdGVyKSxcbiAgICAgIGZpcnN0Q29udGlnID0gbnVsbDtcbiAgICBcbiAgICBzZWxmLmRhdGEuc2VxdWVuY2UgPSBbXTtcbiAgICAgIFxuICAgIF8uZWFjaChjb250aWdzLCBmdW5jdGlvbihjb250aWcpIHtcbiAgICAgIGlmICghc3RyaXAoY29udGlnKS5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgIHZhciBjb250aWdEYXRhID0ge29yaWc6IHt9fSxcbiAgICAgICAgY2hyLCBzaXplLCBjb250aWdTZXF1ZW5jZTtcbiAgICAgIFxuICAgICAgLy8gU3BsaXRzIG9uIGFueSBsaW5lcyB3aXRoIGEgY2hhcmFjdGVyIGluIHRoZSBmaXJzdCBjb2x1bW5cbiAgICAgIF8uZWFjaCh0b3BUYWdzQXNBcnJheShjb250aWcpLCBmdW5jdGlvbihmaWVsZCkge1xuICAgICAgICB2YXIgdGFnID0gZ2V0VGFnKGZpZWxkLCBzZWxmLnRhZ1NpemUpO1xuICAgICAgICBpZiAoXy5pc1VuZGVmaW5lZChjb250aWdEYXRhLm9yaWdbdGFnXSkpIHsgY29udGlnRGF0YS5vcmlnW3RhZ10gPSBmaWVsZDsgfVxuICAgICAgICBlbHNlIHsgY29udGlnRGF0YS5vcmlnW3RhZ10gKz0gZmllbGQ7IH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBzZWxmLmRhdGEuY29udGlncy5wdXNoKGNvbnRpZ0RhdGEpO1xuICAgICAgc2VsZi5mb3JtYXQoKS5wYXJzZUxvY3VzKGNvbnRpZ0RhdGEpO1xuICAgICAgc2VsZi5mb3JtYXQoKS5wYXJzZUhlYWRlckZpZWxkcyhjb250aWdEYXRhKTtcbiAgICAgIGNvbnRpZ1NlcXVlbmNlID0gc2VsZi5mb3JtYXQoKS5wYXJzZVNlcXVlbmNlKGNvbnRpZ0RhdGEpO1xuICAgICAgXG4gICAgICBjaHIgPSBjb250aWdEYXRhLmFjY2Vzc2lvbiAmJiBjb250aWdEYXRhLmFjY2Vzc2lvbiAhPSAndW5rbm93bicgPyBjb250aWdEYXRhLmFjY2Vzc2lvbiA6IGNvbnRpZ0RhdGEuZW50cnlJZDtcbiAgICAgIGNociA9IGVuc3VyZVVuaXF1ZShjaHIsIG8uY2hyTGVuZ3Rocyk7XG4gICAgICBcbiAgICAgIGlmIChjb250aWdEYXRhLmxlbmd0aCkge1xuICAgICAgICBzaXplID0gY29udGlnRGF0YS5sZW5ndGg7XG4gICAgICAgIGlmIChzaXplICE9IGNvbnRpZ1NlcXVlbmNlLmxlbmd0aCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNlcXVlbmNlIGRhdGEgZm9yIGNvbnRpZyBcIitjaHIrXCIgZG9lcyBub3QgbWF0Y2ggbGVuZ3RoIFwiK3NpemUrXCJicCBmcm9tIGhlYWRlclwiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2l6ZSA9IGNvbnRpZ1NlcXVlbmNlLmxlbmd0aDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgby5jaHJPcmRlci5wdXNoKGNocik7XG4gICAgICBvLmNockxlbmd0aHNbY2hyXSA9IHNpemU7XG4gICAgICBvLmdlbm9tZVNpemUgKz0gc2l6ZTtcbiAgICAgIFxuICAgICAgc2VsZi5mb3JtYXQoKS5wYXJzZUZlYXR1cmVUYWJsZShjaHIsIGNvbnRpZ0RhdGEpO1xuICAgICAgc2VsZi5kYXRhLnNlcXVlbmNlLnB1c2goY29udGlnU2VxdWVuY2UpO1xuICAgICAgXG4gICAgICBmaXJzdENvbnRpZyA9IGZpcnN0Q29udGlnIHx8IGNvbnRpZ0RhdGE7XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5kYXRhLnNlcXVlbmNlID0gc2VsZi5kYXRhLnNlcXVlbmNlLmpvaW4oJycpO1xuICAgIHNlbGYuY2FuR2V0U2VxdWVuY2UgPSB0cnVlO1xuICAgIHNlbGYuZm9ybWF0KCkuY3JlYXRlVHJhY2tzRnJvbUZlYXR1cmVzKCk7XG4gICAgXG4gICAgby5zcGVjaWVzID0gZmlyc3RDb250aWcuc291cmNlID8gZmlyc3RDb250aWcuc291cmNlWzBdLm9yZ2FuaXNtLnNwbGl0KFwiXFxuXCIpWzBdIDogJ0N1c3RvbSBHZW5vbWUnO1xuICAgIGlmIChmaXJzdENvbnRpZy5kYXRlKSB7IG8uYXNzZW1ibHlEYXRlID0gZmlyc3RDb250aWcuZGF0ZTsgfVxuICB9XG4gIFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHZW5CYW5rRm9ybWF0OyIsInZhciB0cmFja1V0aWxzID0gcmVxdWlyZSgnLi4vLi4vdHJhY2stdHlwZXMvdXRpbHMvdXRpbHMuanMnKTtcblxubW9kdWxlLmV4cG9ydHMucGFyc2VJbnQxMCA9IHRyYWNrVXRpbHMucGFyc2VJbnQxMDtcblxubW9kdWxlLmV4cG9ydHMuZGVlcENsb25lID0gZnVuY3Rpb24ob2JqKSB7IHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpOyB9XG5cbm1vZHVsZS5leHBvcnRzLmxvZzEwID0gZnVuY3Rpb24odmFsKSB7IHJldHVybiBNYXRoLmxvZyh2YWwpIC8gTWF0aC5MTjEwOyB9XG5cbnZhciBzdHJpcCA9IG1vZHVsZS5leHBvcnRzLnN0cmlwID0gdHJhY2tVdGlscy5zdHJpcDtcblxubW9kdWxlLmV4cG9ydHMucm91bmRUb1BsYWNlcyA9IGZ1bmN0aW9uKG51bSwgZGVjKSB7IHJldHVybiBNYXRoLnJvdW5kKG51bSAqIE1hdGgucG93KDEwLCBkZWMpKSAvIE1hdGgucG93KDEwLCBkZWMpOyB9XG5cbi8qKioqXG4gKiBUaGVzZSBmdW5jdGlvbnMgYXJlIGNvbW1vbiBzdWJyb3V0aW5lcyBmb3IgcGFyc2luZyBHZW5CYW5rIGFuZCBvdGhlciBmb3JtYXRzIGJhc2VkIG9uIGNvbHVtbiBwb3NpdGlvbnNcbiAqKioqL1xuXG4vLyBTcGxpdHMgYSBtdWx0aWxpbmUgc3RyaW5nIGJlZm9yZSB0aGUgbGluZXMgdGhhdCBjb250YWluIGEgY2hhcmFjdGVyIGluIHRoZSBmaXJzdCBjb2x1bW5cbi8vIChhIFwidG9wIHRhZ1wiKSBpbiBhIEdlbkJhbmstc3R5bGUgdGV4dCBmaWxlXG5tb2R1bGUuZXhwb3J0cy50b3BUYWdzQXNBcnJheSA9IGZ1bmN0aW9uKGZpZWxkKSB7XG4gIHJldHVybiBmaWVsZC5yZXBsYWNlKC9cXG4oW0EtWmEtelxcL1xcKl0pL2csIFwiXFxuXFwwMDEkMVwiKS5zcGxpdChcIlxcMDAxXCIpO1xufVxuXG4vLyBTcGxpdHMgYSBtdWx0aWxpbmUgc3RyaW5nIGJlZm9yZSB0aGUgbGluZXMgdGhhdCBjb250YWluIGEgY2hhcmFjdGVyIG5vdCBpbiB0aGUgZmlyc3QgY29sdW1uXG4vLyBidXQgd2l0aGluIHRoZSBuZXh0IHRhZ1NpemUgY29sdW1ucywgd2hpY2ggaXMgYSBcInN1YiB0YWdcIiBpbiBhIEdlbkJhbmstc3R5bGUgdGV4dCBmaWxlXG5tb2R1bGUuZXhwb3J0cy5zdWJUYWdzQXNBcnJheSA9IGZ1bmN0aW9uKGZpZWxkLCB0YWdTaXplKSB7XG4gIGlmICghaXNGaW5pdGUodGFnU2l6ZSkgfHwgdGFnU2l6ZSA8IDIpIHsgdGhyb3cgXCJpbnZhbGlkIHRhZ1NpemVcIjsgfVxuICB2YXIgcmUgPSBuZXcgUmVnRXhwKFwiXFxcXG4oXFxcXHN7MSxcIiArICh0YWdTaXplIC0gMSkgKyBcIn1cXFxcUylcIiwgXCJnXCIpO1xuICByZXR1cm4gZmllbGQucmVwbGFjZShyZSwgXCJcXG5cXDAwMSQxXCIpLnNwbGl0KFwiXFwwMDFcIik7XG59XG5cbi8vIFJldHVybnMgYSBuZXcgc3RyaW5nIHdpdGggdGhlIGZpcnN0IHRhZ1NpemUgY29sdW1ucyBmcm9tIGZpZWxkIHJlbW92ZWRcbm1vZHVsZS5leHBvcnRzLmZldGNoRmllbGQgPSBmdW5jdGlvbihmaWVsZCwgdGFnU2l6ZSkge1xuICBpZiAoIWlzRmluaXRlKHRhZ1NpemUpIHx8IHRhZ1NpemUgPCAxKSB7IHRocm93IFwiaW52YWxpZCB0YWdTaXplXCI7IH1cbiAgdmFyIHJlID0gbmV3IFJlZ0V4cChcIihefFxcXFxuKS57MCxcIiArIHRhZ1NpemUgKyBcIn1cIiwgXCJnXCIpO1xuICByZXR1cm4gc3RyaXAoZmllbGQucmVwbGFjZShyZSwgXCIkMVwiKSk7XG59XG5cbi8vIEdldHMgYSB0YWcgZnJvbSBhIGZpZWxkIGJ5IHRyaW1taW5nIGl0IG91dCBvZiB0aGUgZmlyc3QgdGFnU2l6ZSBjaGFyYWN0ZXJzIG9mIHRoZSBmaWVsZFxubW9kdWxlLmV4cG9ydHMuZ2V0VGFnID0gZnVuY3Rpb24oZmllbGQsIHRhZ1NpemUpIHsgXG4gIGlmICghaXNGaW5pdGUodGFnU2l6ZSkgfHwgdGFnU2l6ZSA8IDEpIHsgdGhyb3cgXCJpbnZhbGlkIHRhZ1NpemVcIjsgfVxuICByZXR1cm4gc3RyaXAoZmllbGQuc3Vic3RyaW5nKDAsIHRhZ1NpemUpLnRvTG93ZXJDYXNlKCkpO1xufVxuXG4vKioqKlxuICogRW5kIEdlbkJhbmsgYW5kIGNvbHVtbi1iYXNlZCBmb3JtYXQgaGVscGVyc1xuICoqKiovXG5cbi8vIEdpdmVuIGEgaGFzaCBhbmQgYSBwcmVzdW1wdGl2ZSBuZXcga2V5LCBhcHBlbmRzIGEgY291bnRlciB0byB0aGUga2V5IHVudGlsIGl0IGlzIGFjdHVhbGx5IGFuIHVudXNlZCBrZXlcbm1vZHVsZS5leHBvcnRzLmVuc3VyZVVuaXF1ZSA9IGZ1bmN0aW9uKGtleSwgaGFzaCkge1xuICB2YXIgaSA9IDEsIGtleUNoZWNrID0ga2V5O1xuICB3aGlsZSAodHlwZW9mIGhhc2hba2V5Q2hlY2tdICE9ICd1bmRlZmluZWQnKSB7IGtleUNoZWNrID0ga2V5ICsgJ18nICsgaSsrOyB9XG4gIHJldHVybiBrZXlDaGVjaztcbn1cblxuLy8gR2l2ZW4gYSBoYXNoIHdpdGggb3B0aW9uIG5hbWVzIGFuZCB2YWx1ZXMsIGZvcm1hdHMgaXQgaW4gQkVEIHRyYWNrIGxpbmUgZm9ybWF0IChzaW1pbGFyIHRvIEhUTUwgZWxlbWVudCBhdHRyaWJ1dGVzKVxubW9kdWxlLmV4cG9ydHMub3B0c0FzVHJhY2tMaW5lID0gZnVuY3Rpb24ob3B0aGFzaCkge1xuICByZXR1cm4gXy5tYXAob3B0aGFzaCwgZnVuY3Rpb24odiwgaykgeyByZXR1cm4gayArICc9XCInICsgdi50b1N0cmluZygpLnJlcGxhY2UoL1wiL2csICcnKSArICdcIic7IH0pLmpvaW4oJyAnKTtcbn0iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSBCQU0gZm9ybWF0OiBodHRwczovL3NhbXRvb2xzLmdpdGh1Yi5pby9odHMtc3BlY3MvU0FNdjEucGRmID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMvdXRpbHMuanMnKSxcbiAgZmxvb3JIYWNrID0gdXRpbHMuZmxvb3JIYWNrLFxuICBwYXJzZUludDEwID0gdXRpbHMucGFyc2VJbnQxMCxcbiAgZGVlcENsb25lID0gdXRpbHMuZGVlcENsb25lO1xudmFyIFBhaXJlZEludGVydmFsVHJlZSA9IHJlcXVpcmUoJy4vdXRpbHMvUGFpcmVkSW50ZXJ2YWxUcmVlLmpzJykuUGFpcmVkSW50ZXJ2YWxUcmVlO1xudmFyIFJlbW90ZVRyYWNrID0gcmVxdWlyZSgnLi91dGlscy9SZW1vdGVUcmFjay5qcycpLlJlbW90ZVRyYWNrO1xuXG52YXIgQmFtRm9ybWF0ID0ge1xuICBkZWZhdWx0czoge1xuICAgIGNocm9tb3NvbWVzOiAnJyxcbiAgICBpdGVtUmdiOiAnb2ZmJyxcbiAgICBjb2xvcjogJzE4OCwxODgsMTg4JyxcbiAgICBjb2xvckJ5U3RyYW5kOiAnJyxcbiAgICB1c2VTY29yZTogMCxcbiAgICBncm91cDogJ3VzZXInLFxuICAgIHByaW9yaXR5OiAndXNlcicsXG4gICAgb2Zmc2V0OiAwLFxuICAgIGRldGFpbDogZmFsc2UsXG4gICAgdXJsOiAnJyxcbiAgICBodG1sVXJsOiAnJyxcbiAgICBkcmF3TGltaXQ6IHtzcXVpc2g6IDIwMDAsIHBhY2s6IDIwMDB9LFxuICAgIC8vIElmIGEgbnVjbGVvdGlkZSBkaWZmZXJzIGZyb20gdGhlIHJlZmVyZW5jZSBzZXF1ZW5jZSBpbiBncmVhdGVyIHRoYW4gMjAlIG9mIHF1YWxpdHkgd2VpZ2h0ZWQgcmVhZHMsIFxuICAgIC8vIElHViBjb2xvcnMgdGhlIGJhciBpbiBwcm9wb3J0aW9uIHRvIHRoZSByZWFkIGNvdW50IG9mIGVhY2ggYmFzZTsgdGhlIGZvbGxvd2luZyBjaGFuZ2VzIHRoYXQgdGhyZXNob2xkIGZvciBjaHJvbW96b29tXG4gICAgYWxsZWxlRnJlcVRocmVzaG9sZDogMC4yLFxuICAgIG9wdGltYWxGZXRjaFdpbmRvdzogMCxcbiAgICBtYXhGZXRjaFdpbmRvdzogMCxcbiAgICAvLyBUaGUgZm9sbG93aW5nIGNhbiBiZSBcImVuc2VtYmxfdWNzY1wiIG9yIFwidWNzY19lbnNlbWJsXCIgdG8gYXR0ZW1wdCBhdXRvLWNyb3NzbWFwcGluZyBvZiByZWZlcmVuY2UgY29udGlnIG5hbWVzXG4gICAgLy8gYmV0d2VlbiB0aGUgdHdvIHNjaGVtZXMsIHdoaWNoIElHViBkb2VzLCBidXQgaXMgYSBwZXJlbm5pYWwgaXNzdWU6IGh0dHBzOi8vd3d3LmJpb3N0YXJzLm9yZy9wLzEwMDYyL1xuICAgIC8vIEkgaG9wZSBub3QgdG8gbmVlZCBhbGwgdGhlIG1hcHBpbmdzIGluIGhlcmUgaHR0cHM6Ly9naXRodWIuY29tL2Rwcnlhbjc5L0Nocm9tb3NvbWVNYXBwaW5ncyBidXQgaXQgbWF5IGJlIG5lY2Vzc2FyeVxuICAgIGNvbnZlcnRDaHJTY2hlbWU6IFwiYXV0b1wiLFxuICAgIC8vIERyYXcgcGFpcmVkIGVuZHMgd2l0aGluIGEgcmFuZ2Ugb2YgZXhwZWN0ZWQgaW5zZXJ0IHNpemVzIGFzIGEgY29udGludW91cyBmZWF0dXJlP1xuICAgIC8vIFNlZSBodHRwczovL3d3dy5icm9hZGluc3RpdHV0ZS5vcmcvaWd2L0FsaWdubWVudERhdGEjcGFpcmVkIGZvciBob3cgdGhpcyB3b3Jrc1xuICAgIHZpZXdBc1BhaXJzOiBmYWxzZSxcbiAgICBleHBlY3RlZEluc2VydFNpemVQZXJjZW50aWxlczogWzAuMDA1LCAwLjk5NV1cbiAgfSxcbiAgXG4gIC8vIFRoZSBGTEFHIGNvbHVtbiBmb3IgQkFNL1NBTSBpcyBhIGNvbWJpbmF0aW9uIG9mIGJpdHdpc2UgZmxhZ3NcbiAgZmxhZ3M6IHtcbiAgICBpc1JlYWRQYWlyZWQ6IDB4MSxcbiAgICBpc1JlYWRQcm9wZXJseUFsaWduZWQ6IDB4MixcbiAgICBpc1JlYWRVbm1hcHBlZDogMHg0LFxuICAgIGlzTWF0ZVVubWFwcGVkOiAweDgsXG4gICAgcmVhZFN0cmFuZFJldmVyc2U6IDB4MTAsXG4gICAgbWF0ZVN0cmFuZFJldmVyc2U6IDB4MjAsXG4gICAgaXNSZWFkRmlyc3RPZlBhaXI6IDB4NDAsXG4gICAgaXNSZWFkTGFzdE9mUGFpcjogMHg4MCxcbiAgICBpc1NlY29uZGFyeUFsaWdubWVudDogMHgxMDAsXG4gICAgaXNSZWFkRmFpbGluZ1ZlbmRvclFDOiAweDIwMCxcbiAgICBpc0R1cGxpY2F0ZVJlYWQ6IDB4NDAwLFxuICAgIGlzU3VwcGxlbWVudGFyeUFsaWdubWVudDogMHg4MDBcbiAgfSxcblxuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgYnJvd3NlckNocnMgPSBfLmtleXModGhpcy5icm93c2VyT3B0cyk7XG4gICAgaWYgKCF0aGlzLm9wdHMuYmlnRGF0YVVybCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUmVxdWlyZWQgcGFyYW1ldGVyIGJpZ0RhdGFVcmwgbm90IGZvdW5kIGZvciBCQU0gdHJhY2sgYXQgXCIgK1xuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMub3B0cykgKyAodGhpcy5vcHRzLmxpbmVOdW0gKyAxKSk7XG4gICAgfVxuICAgIHRoaXMuYnJvd3NlckNoclNjaGVtZSA9IHRoaXMudHlwZShcImJhbVwiKS5ndWVzc0NoclNjaGVtZShfLmtleXModGhpcy5icm93c2VyT3B0cy5jaHJQb3MpKTtcbiAgfSxcbiAgXG4gIC8vIFRPRE86IElmIHRoZSBwYWlyaW5nIGludGVydmFsIGNoYW5nZWQsIHdlIHNob3VsZCB0b3NzIHRoZSBlbnRpcmUgY2FjaGUgYW5kIHJlc2V0IHRoZSBSZW1vdGVUcmFjayBiaW5zLFxuICAvLyAgICAgICAgICphbmQqIGJsb3cgdXAgdGhlIGFyZWFJbmRleC5cbiAgYXBwbHlPcHRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0cztcbiAgICAvLyBXaGVuIHdlIGNoYW5nZSBvcHRzLnZpZXdBc1BhaXJzLCB3ZSAqbmVlZCogdG8gdGhyb3cgb3V0IHRoaXMuZGF0YS5waWxldXAuXG4gICAgaWYgKG8udmlld0FzUGFpcnMgIT0gdGhpcy5wcmV2T3B0cy52aWV3QXNQYWlycykgeyB0aGlzLmRhdGEucGlsZXVwID0ge307IH1cbiAgICB0aGlzLnByZXZPcHRzID0gZGVlcENsb25lKHRoaXMub3B0cyk7XG4gIH0sXG4gIFxuICBndWVzc0NoclNjaGVtZTogZnVuY3Rpb24oY2hycykge1xuICAgIGxpbWl0ID0gTWF0aC5taW4oY2hycy5sZW5ndGggKiAwLjgsIDIwKTtcbiAgICBpZiAoXy5maWx0ZXIoY2hycywgZnVuY3Rpb24oY2hyKSB7IHJldHVybiAoL15jaHIvKS50ZXN0KGNocik7IH0pLmxlbmd0aCA+IGxpbWl0KSB7IHJldHVybiAndWNzYyc7IH1cbiAgICBpZiAoXy5maWx0ZXIoY2hycywgZnVuY3Rpb24oY2hyKSB7IHJldHVybiAoL15cXGRcXGQ/JC8pLnRlc3QoY2hyKTsgfSkubGVuZ3RoID4gbGltaXQpIHsgcmV0dXJuICdlbnNlbWJsJzsgfVxuICAgIHJldHVybiBudWxsO1xuICB9LFxuICBcbiAgcGFyc2U6IGZ1bmN0aW9uKGxpbmVzKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgbyA9IHNlbGYub3B0cyxcbiAgICAgIG1pZGRsZWlzaFBvcyA9IHNlbGYuYnJvd3Nlck9wdHMuZ2Vub21lU2l6ZSAvIDIsXG4gICAgICBjYWNoZSA9IG5ldyBQYWlyZWRJbnRlcnZhbFRyZWUoZmxvb3JIYWNrKG1pZGRsZWlzaFBvcyksIHtzdGFydEtleTogJ3N0YXJ0JywgZW5kS2V5OiAnZW5kJ30sIFxuICAgICAgICAgIHtzdGFydEtleTogJ3RlbXBsYXRlU3RhcnQnLCBlbmRLZXk6ICd0ZW1wbGF0ZUVuZCcsIHBhaXJlZExlbmd0aEtleTogJ3RsZW4nLCBwYWlyaW5nS2V5OiAncW5hbWUnfSksXG4gICAgICBhamF4VXJsID0gc2VsZi5hamF4RGlyKCkgKyAnYmFtLnBocCcsXG4gICAgICBpbmZvQ2hyUmFuZ2UgPSBzZWxmLmNoclJhbmdlKE1hdGgucm91bmQoc2VsZi5icm93c2VyT3B0cy5wb3MpLCBNYXRoLnJvdW5kKHNlbGYuYnJvd3Nlck9wdHMucG9zICsgMTAwMDApKSxcbiAgICAgIHJlbW90ZTtcbiAgICBcbiAgICByZW1vdGUgPSBuZXcgUmVtb3RlVHJhY2soY2FjaGUsIGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIHN0b3JlSW50ZXJ2YWxzKSB7XG4gICAgICByYW5nZSA9IHNlbGYuY2hyUmFuZ2Uoc3RhcnQsIGVuZCk7XG4gICAgICAvLyBDb252ZXJ0IGF1dG9tYXRpY2FsbHkgYmV0d2VlbiBFbnNlbWJsIHN0eWxlIDEsIDIsIDMsIFggPC0tPiBVQ1NDIHN0eWxlIGNocjEsIGNocjIsIGNocjMsIGNoclggYXMgY29uZmlndXJlZC9hdXRvZGV0ZWN0ZWRcbiAgICAgIC8vIE5vdGUgdGhhdCBjaHJNIGlzIE5PVCBlcXVpdmFsZW50IHRvIE1UIGh0dHBzOi8vd3d3LmJpb3N0YXJzLm9yZy9wLzEyMDA0Mi8jMTIwMDU4XG4gICAgICBzd2l0Y2ggKG8uY29udmVydENoclNjaGVtZSA9PSBcImF1dG9cIiA/IHNlbGYuZGF0YS5pbmZvLmNvbnZlcnRDaHJTY2hlbWUgOiBvLmNvbnZlcnRDaHJTY2hlbWUpIHtcbiAgICAgICAgY2FzZSAnZW5zZW1ibF91Y3NjJzogcmFuZ2UgPSBfLm1hcChyYW5nZSwgZnVuY3Rpb24ocikgeyByZXR1cm4gci5yZXBsYWNlKC9eY2hyLywgJycpOyB9KTsgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3Vjc2NfZW5zZW1ibCc6IHJhbmdlID0gXy5tYXAocmFuZ2UsIGZ1bmN0aW9uKHIpIHsgcmV0dXJuIHIucmVwbGFjZSgvXihcXGRcXGQ/fFgpOi8sICdjaHIkMTonKTsgfSk7IGJyZWFrO1xuICAgICAgfVxuICAgICAgJC5hamF4KGFqYXhVcmwsIHtcbiAgICAgICAgZGF0YToge3JhbmdlOiByYW5nZSwgdXJsOiBzZWxmLm9wdHMuYmlnRGF0YVVybH0sXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICB2YXIgbGluZXMgPSBfLmZpbHRlcihkYXRhLnNwbGl0KCdcXG4nKSwgZnVuY3Rpb24obCkgeyB2YXIgbSA9IGwubWF0Y2goL1xcdC9nKTsgcmV0dXJuIG0gJiYgbS5sZW5ndGggPj0gMjsgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gUGFyc2UgdGhlIFNBTSBmb3JtYXQgaW50byBpbnRlcnZhbHMgdGhhdCBjYW4gYmUgaW5zZXJ0ZWQgaW50byB0aGUgSW50ZXJ2YWxUcmVlIGNhY2hlXG4gICAgICAgICAgdmFyIGludGVydmFscyA9IF8ubWFwKGxpbmVzLCBmdW5jdGlvbihsKSB7IHJldHVybiBzZWxmLnR5cGUoJ2JhbScpLnBhcnNlTGluZS5jYWxsKHNlbGYsIGwpOyB9KTtcbiAgICAgICAgICBzdG9yZUludGVydmFscyhpbnRlcnZhbHMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmRhdGEgPSB7Y2FjaGU6IGNhY2hlLCByZW1vdGU6IHJlbW90ZSwgcGlsZXVwOiB7fSwgaW5mbzoge319O1xuICAgIHNlbGYuaGVpZ2h0cyA9IHttYXg6IG51bGwsIG1pbjogMjQsIHN0YXJ0OiAyNH07XG4gICAgc2VsZi5zaXplcyA9IFsnZGVuc2UnLCAnc3F1aXNoJywgJ3BhY2snXTtcbiAgICBzZWxmLm1hcFNpemVzID0gWydwYWNrJ107XG4gICAgc2VsZi5ub0FyZWFMYWJlbHMgPSB0cnVlO1xuICAgIHNlbGYuZXhwZWN0c1NlcXVlbmNlID0gdHJ1ZTtcbiAgICBzZWxmLnJlbmRlclNlcXVlbmNlQ2FsbGJhY2tzID0ge307XG4gICAgc2VsZi5wcmV2T3B0cyA9IGRlZXBDbG9uZShvKTsgIC8vIHVzZWQgdG8gZGV0ZWN0IHdoaWNoIGRyYXdpbmcgb3B0aW9ucyBoYXZlIGJlZW4gY2hhbmdlZCBieSB0aGUgdXNlclxuICAgIFxuICAgIC8vIEdldCBnZW5lcmFsIGluZm8gb24gdGhlIGJhbSAoZS5nLiBgc2FtdG9vbHMgaWR4c3RhdHNgLCB1c2UgbWFwcGVkIHJlYWRzIHBlciByZWZlcmVuY2Ugc2VxdWVuY2VcbiAgICAvLyB0byBlc3RpbWF0ZSBtYXhGZXRjaFdpbmRvdyBhbmQgb3B0aW1hbEZldGNoV2luZG93LCBhbmQgc2V0dXAgYmlubmluZyBvbiB0aGUgUmVtb3RlVHJhY2suXG4gICAgJC5hamF4KGFqYXhVcmwsIHtcbiAgICAgIGRhdGE6IHtyYW5nZTogaW5mb0NoclJhbmdlLCB1cmw6IG8uYmlnRGF0YVVybCwgaW5mbzogMX0sXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIHZhciBtYXBwZWRSZWFkcyA9IDAsXG4gICAgICAgICAgbWF4SXRlbXNUb0RyYXcgPSBfLm1heChfLnZhbHVlcyhvLmRyYXdMaW1pdCkpLFxuICAgICAgICAgIGJhbUNocnMgPSBbXSxcbiAgICAgICAgICBpbmZvUGFydHMgPSBkYXRhLnNwbGl0KFwiXFxuXFxuXCIpLFxuICAgICAgICAgIGVzdGltYXRlZEluc2VydFNpemVzID0gW10sXG4gICAgICAgICAgcGN0aWxlcyA9IG8uZXhwZWN0ZWRJbnNlcnRTaXplUGVyY2VudGlsZXMsXG4gICAgICAgICAgbG93ZXJCb3VuZCA9IDEwLCBcbiAgICAgICAgICB1cHBlckJvdW5kID0gNTAwMCwgXG4gICAgICAgICAgc2FtcGxlSW50ZXJ2YWxzLCBtZWFuSXRlbUxlbmd0aCwgaGFzQU1hdGVQYWlyLCBjaHJTY2hlbWUsIG1lYW5JdGVtc1BlckJwO1xuICAgICAgICBcbiAgICAgICAgXy5lYWNoKGluZm9QYXJ0c1swXS5zcGxpdChcIlxcblwiKSwgZnVuY3Rpb24obGluZSkge1xuICAgICAgICAgIHZhciBmaWVsZHMgPSBsaW5lLnNwbGl0KFwiXFx0XCIpLFxuICAgICAgICAgICAgcmVhZHNNYXBwZWRUb0NvbnRpZyA9IHBhcnNlSW50KGZpZWxkc1syXSwgMTApO1xuICAgICAgICAgIGlmIChmaWVsZHMubGVuZ3RoID09IDEgJiYgZmllbGRzWzBdID09ICcnKSB7IHJldHVybjsgfSAvLyBibGFuayBsaW5lXG4gICAgICAgICAgYmFtQ2hycy5wdXNoKGZpZWxkc1swXSk7XG4gICAgICAgICAgaWYgKF8uaXNOYU4ocmVhZHNNYXBwZWRUb0NvbnRpZykpIHsgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBvdXRwdXQgZm9yIHNhbXRvb2xzIGlkeHN0YXRzIG9uIHRoaXMgQkFNIHRyYWNrLlwiKTsgfVxuICAgICAgICAgIG1hcHBlZFJlYWRzICs9IHJlYWRzTWFwcGVkVG9Db250aWc7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgc2VsZi5kYXRhLmluZm8uY2hyU2NoZW1lID0gY2hyU2NoZW1lID0gc2VsZi50eXBlKFwiYmFtXCIpLmd1ZXNzQ2hyU2NoZW1lKGJhbUNocnMpO1xuICAgICAgICBpZiAoY2hyU2NoZW1lICYmIHNlbGYuYnJvd3NlckNoclNjaGVtZSkge1xuICAgICAgICAgIHNlbGYuZGF0YS5pbmZvLmNvbnZlcnRDaHJTY2hlbWUgPSBjaHJTY2hlbWUgIT0gc2VsZi5icm93c2VyQ2hyU2NoZW1lID8gY2hyU2NoZW1lICsgJ18nICsgc2VsZi5icm93c2VyQ2hyU2NoZW1lIDogbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2FtcGxlSW50ZXJ2YWxzID0gXy5jb21wYWN0KF8ubWFwKGluZm9QYXJ0c1sxXS5zcGxpdChcIlxcblwiKSwgZnVuY3Rpb24obGluZSkge1xuICAgICAgICAgIHJldHVybiBzZWxmLnR5cGUoJ2JhbScpLnBhcnNlTGluZS5jYWxsKHNlbGYsIGxpbmUpO1xuICAgICAgICB9KSk7XG4gICAgICAgIGlmIChzYW1wbGVJbnRlcnZhbHMubGVuZ3RoKSB7XG4gICAgICAgICAgbWVhbkl0ZW1MZW5ndGggPSBfLnJlZHVjZShzYW1wbGVJbnRlcnZhbHMsIGZ1bmN0aW9uKG1lbW8sIG5leHQpIHsgcmV0dXJuIG1lbW8gKyAobmV4dC5lbmQgLSBuZXh0LnN0YXJ0KTsgfSwgMCk7XG4gICAgICAgICAgbWVhbkl0ZW1MZW5ndGggPSBNYXRoLnJvdW5kKG1lYW5JdGVtTGVuZ3RoIC8gc2FtcGxlSW50ZXJ2YWxzLmxlbmd0aCk7XG4gICAgICAgICAgaGFzQU1hdGVQYWlyID0gXy5zb21lKHNhbXBsZUludGVydmFscywgZnVuY3Rpb24oaXR2bCkgeyBcbiAgICAgICAgICAgIHJldHVybiBpdHZsLmZsYWdzLmlzUmVhZEZpcnN0T2ZQYWlyIHx8IGl0dmwuZmxhZ3MuaXNSZWFkTGFzdE9mUGFpcjtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBlc3RpbWF0ZWRJbnNlcnRTaXplcyA9IF8uY29tcGFjdChfLm1hcChzYW1wbGVJbnRlcnZhbHMsIGZ1bmN0aW9uKGl0dmwpIHsgXG4gICAgICAgICAgICByZXR1cm4gaXR2bC50bGVuID8gTWF0aC5hYnMoaXR2bC50bGVuKSA6IDA7IFxuICAgICAgICAgIH0pKTtcbiAgICAgICAgICBlc3RpbWF0ZWRJbnNlcnRTaXplcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIGEgLSBiOyB9KTsgIC8vIE5PVEU6IEphdmFTY3JpcHQgZG9lcyBzdHJpbmcgc29ydGluZyBieSBkZWZhdWx0IC1fLVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZWxmLmRhdGEuaW5mby5tZWFuSXRlbXNQZXJCcCA9IG1lYW5JdGVtc1BlckJwID0gbWFwcGVkUmVhZHMgLyBzZWxmLmJyb3dzZXJPcHRzLmdlbm9tZVNpemU7XG4gICAgICAgIHNlbGYuZGF0YS5pbmZvLm1lYW5JdGVtTGVuZ3RoID0gbWVhbkl0ZW1MZW5ndGggPSBfLmlzVW5kZWZpbmVkKG1lYW5JdGVtTGVuZ3RoKSA/IDEwMCA6IG1lYW5JdGVtTGVuZ3RoO1xuICAgICAgICBvLm1heEZldGNoV2luZG93ID0gbWF4SXRlbXNUb0RyYXcgLyBtZWFuSXRlbXNQZXJCcCAvIChNYXRoLm1heChtZWFuSXRlbUxlbmd0aCwgMTAwKSAvIDEwMCk7XG4gICAgICAgIG8ub3B0aW1hbEZldGNoV2luZG93ID0gTWF0aC5mbG9vcihvLm1heEZldGNoV2luZG93IC8gMik7XG4gICAgICAgIFxuICAgICAgICAvLyBJZiB0aGVyZSBpcyBwYWlyaW5nLCB3ZSBuZWVkIHRvIHRlbGwgdGhlIFBhaXJlZEludGVydmFsVHJlZSB3aGF0IHJhbmdlIG9mIGluc2VydCBzaXplcyBzaG91bGQgdHJpZ2dlciBwYWlyaW5nLlxuICAgICAgICBpZiAoaGFzQU1hdGVQYWlyKSB7XG4gICAgICAgICAgaWYgKGVzdGltYXRlZEluc2VydFNpemVzLmxlbmd0aCkge1xuICAgICAgICAgICAgbG93ZXJCb3VuZCA9IGVzdGltYXRlZEluc2VydFNpemVzW01hdGguZmxvb3IoZXN0aW1hdGVkSW5zZXJ0U2l6ZXMubGVuZ3RoICogcGN0aWxlc1swXSldO1xuICAgICAgICAgICAgdXBwZXJCb3VuZCA9IGVzdGltYXRlZEluc2VydFNpemVzW01hdGguZmxvb3IoZXN0aW1hdGVkSW5zZXJ0U2l6ZXMubGVuZ3RoICogcGN0aWxlc1sxXSldO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWxmLmRhdGEuY2FjaGUuc2V0UGFpcmluZ0ludGVydmFsKGxvd2VyQm91bmQsIHVwcGVyQm91bmQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIElmIHdlIGRvbid0IHNlZSBhbnkgcGFpcmVkIHJlYWRzIGluIHRoaXMgQkFNLCBkZWFjdGl2YXRlIHRoZSBwYWlyaW5nIGZ1bmN0aW9uYWxpdHkgb2YgdGhlIFBhaXJlZEludGVydmFsVHJlZSBcbiAgICAgICAgICBzZWxmLmRhdGEuY2FjaGUuZGlzYWJsZVBhaXJpbmcoKTtcbiAgICAgICAgfVxuICAgICAgICByZW1vdGUuc2V0dXBCaW5zKHNlbGYuYnJvd3Nlck9wdHMuZ2Vub21lU2l6ZSwgby5vcHRpbWFsRmV0Y2hXaW5kb3csIG8ubWF4RmV0Y2hXaW5kb3cpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuICBcbiAgLy8gU2V0cyBmZWF0dXJlLmZsYWdzWy4uLl0gdG8gYSBodW1hbiBpbnRlcnByZXRhYmxlIHZlcnNpb24gb2YgZmVhdHVyZS5mbGFnIChleHBhbmRpbmcgdGhlIGJpdHdpc2UgZmxhZ3MpXG4gIHBhcnNlRmxhZ3M6IGZ1bmN0aW9uKGZlYXR1cmUsIGxpbmVubykge1xuICAgIGZlYXR1cmUuZmxhZ3MgPSB7fTtcbiAgICBfLmVhY2godGhpcy50eXBlKCdiYW0nKS5mbGFncywgZnVuY3Rpb24oYml0LCBmbGFnKSB7XG4gICAgICBmZWF0dXJlLmZsYWdzW2ZsYWddID0gISEoZmVhdHVyZS5mbGFnICYgYml0KTtcbiAgICB9KTtcbiAgfSxcbiAgXG4gIC8vIFNldHMgZmVhdHVyZS5ibG9ja3MgYW5kIGZlYXR1cmUuZW5kIGJhc2VkIG9uIGZlYXR1cmUuY2lnYXJcbiAgLy8gU2VlIHNlY3Rpb24gMS40IG9mIGh0dHBzOi8vc2FtdG9vbHMuZ2l0aHViLmlvL2h0cy1zcGVjcy9TQU12MS5wZGYgZm9yIGFuIGV4cGxhbmF0aW9uIG9mIENJR0FSIFxuICBwYXJzZUNpZ2FyOiBmdW5jdGlvbihmZWF0dXJlLCBsaW5lbm8pIHsgICAgICAgIFxuICAgIHZhciBjaWdhciA9IGZlYXR1cmUuY2lnYXIsXG4gICAgICBzZXEgPSAoIWZlYXR1cmUuc2VxIHx8IGZlYXR1cmUuc2VxID09ICcqJykgPyBcIlwiIDogZmVhdHVyZS5zZXEsXG4gICAgICByZWZMZW4gPSAwLFxuICAgICAgc2VxUG9zID0gMCxcbiAgICAgIG9wZXJhdGlvbnMsIGxlbmd0aHM7XG4gICAgXG4gICAgZmVhdHVyZS5ibG9ja3MgPSBbXTtcbiAgICBmZWF0dXJlLmluc2VydGlvbnMgPSBbXTtcbiAgICBcbiAgICBvcHMgPSBjaWdhci5zcGxpdCgvXFxkKy8pLnNsaWNlKDEpO1xuICAgIGxlbmd0aHMgPSBjaWdhci5zcGxpdCgvW0EtWj1dLykuc2xpY2UoMCwgLTEpO1xuICAgIGlmIChvcHMubGVuZ3RoICE9IGxlbmd0aHMubGVuZ3RoKSB7IHRoaXMud2FybihcIkludmFsaWQgQ0lHQVIgJ1wiICsgY2lnYXIgKyBcIicgZm9yIFwiICsgZmVhdHVyZS5kZXNjKTsgcmV0dXJuOyB9XG4gICAgbGVuZ3RocyA9IF8ubWFwKGxlbmd0aHMsIHBhcnNlSW50MTApO1xuICAgIFxuICAgIF8uZWFjaChvcHMsIGZ1bmN0aW9uKG9wLCBpKSB7XG4gICAgICB2YXIgbGVuID0gbGVuZ3Roc1tpXSxcbiAgICAgICAgYmxvY2ssIGluc2VydGlvbjtcbiAgICAgIGlmICgvXltNWD1dJC8udGVzdChvcCkpIHtcbiAgICAgICAgLy8gQWxpZ25tZW50IG1hdGNoLCBzZXF1ZW5jZSBtYXRjaCwgc2VxdWVuY2UgbWlzbWF0Y2hcbiAgICAgICAgYmxvY2sgPSB7c3RhcnQ6IGZlYXR1cmUuc3RhcnQgKyByZWZMZW59O1xuICAgICAgICBibG9jay5lbmQgPSBibG9jay5zdGFydCArIGxlbjtcbiAgICAgICAgYmxvY2sudHlwZSA9IG9wO1xuICAgICAgICBibG9jay5zZXEgPSBzZXEuc2xpY2Uoc2VxUG9zLCBzZXFQb3MgKyBsZW4pO1xuICAgICAgICBmZWF0dXJlLmJsb2Nrcy5wdXNoKGJsb2NrKTtcbiAgICAgICAgcmVmTGVuICs9IGxlbjtcbiAgICAgICAgc2VxUG9zICs9IGxlbjtcbiAgICAgIH0gZWxzZSBpZiAoL15bTkRdJC8udGVzdChvcCkpIHtcbiAgICAgICAgLy8gU2tpcHBlZCByZWZlcmVuY2UgcmVnaW9uLCBkZWxldGlvbiBmcm9tIHJlZmVyZW5jZVxuICAgICAgICByZWZMZW4gKz0gbGVuO1xuICAgICAgfSBlbHNlIGlmIChvcCA9PSAnSScpIHtcbiAgICAgICAgLy8gSW5zZXJ0aW9uXG4gICAgICAgIGluc2VydGlvbiA9IHtzdGFydDogZmVhdHVyZS5zdGFydCArIHJlZkxlbiwgZW5kOiBmZWF0dXJlLnN0YXJ0ICsgcmVmTGVufTtcbiAgICAgICAgaW5zZXJ0aW9uLnNlcSA9IHNlcS5zbGljZShzZXFQb3MsIHNlcVBvcyArIGxlbik7XG4gICAgICAgIGZlYXR1cmUuaW5zZXJ0aW9ucy5wdXNoKGluc2VydGlvbik7XG4gICAgICAgIHNlcVBvcyArPSBsZW47XG4gICAgICB9IGVsc2UgaWYgKG9wID09ICdTJykge1xuICAgICAgICAvLyBTb2Z0IGNsaXBwaW5nOyBzaW1wbHkgc2tpcCB0aGVzZSBiYXNlcyBpbiBTRVEsIHBvc2l0aW9uIG9uIHJlZmVyZW5jZSBpcyB1bmNoYW5nZWQuXG4gICAgICAgIHNlcVBvcyArPSBsZW47XG4gICAgICB9XG4gICAgICAvLyBUaGUgb3RoZXIgdHdvIENJR0FSIG9wcywgSCBhbmQgUCwgYXJlIG5vdCByZWxldmFudCB0byBkcmF3aW5nIGFsaWdubWVudHMuXG4gICAgfSk7XG4gICAgXG4gICAgZmVhdHVyZS5lbmQgPSBmZWF0dXJlLnN0YXJ0ICsgcmVmTGVuO1xuICB9LFxuICBcbiAgcGFyc2VMaW5lOiBmdW5jdGlvbihsaW5lLCBsaW5lbm8pIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0cyxcbiAgICAgIGNvbHMgPSBbJ3FuYW1lJywgJ2ZsYWcnLCAncm5hbWUnLCAncG9zJywgJ21hcHEnLCAnY2lnYXInLCAncm5leHQnLCAncG5leHQnLCAndGxlbicsICdzZXEnLCAncXVhbCddLFxuICAgICAgZmVhdHVyZSA9IHt9LFxuICAgICAgZmllbGRzID0gbGluZS5zcGxpdChcIlxcdFwiKSxcbiAgICAgIGF2YWlsRmxhZ3MgPSB0aGlzLnR5cGUoJ2JhbScpLmZsYWdzLFxuICAgICAgY2hyUG9zLCBibG9ja1NpemVzO1xuICAgIFxuICAgIF8uZWFjaChfLmZpcnN0KGZpZWxkcywgY29scy5sZW5ndGgpLCBmdW5jdGlvbih2LCBpKSB7IGZlYXR1cmVbY29sc1tpXV0gPSB2OyB9KTtcbiAgICAvLyBDb252ZXJ0IGF1dG9tYXRpY2FsbHkgYmV0d2VlbiBFbnNlbWJsIHN0eWxlIDEsIDIsIDMsIFggPC0tPiBVQ1NDIHN0eWxlIGNocjEsIGNocjIsIGNocjMsIGNoclggYXMgY29uZmlndXJlZC9hdXRvZGV0ZWN0ZWRcbiAgICAvLyBOb3RlIHRoYXQgY2hyTSBpcyBOT1QgZXF1aXZhbGVudCB0byBNVCBodHRwczovL3d3dy5iaW9zdGFycy5vcmcvcC8xMjAwNDIvIzEyMDA1OFxuICAgIHN3aXRjaCAoby5jb252ZXJ0Q2hyU2NoZW1lID09IFwiYXV0b1wiID8gdGhpcy5kYXRhLmluZm8uY29udmVydENoclNjaGVtZSA6IG8uY29udmVydENoclNjaGVtZSkge1xuICAgICAgY2FzZSAndWNzY19lbnNlbWJsJzogZmVhdHVyZS5ybmFtZSA9IGZlYXR1cmUucm5hbWUucmVwbGFjZSgvXmNoci8sICcnKTsgYnJlYWs7XG4gICAgICBjYXNlICdlbnNlbWJsX3Vjc2MnOiBmZWF0dXJlLnJuYW1lID0gKC9eKFxcZFxcZD98WCkkLy50ZXN0KGZlYXR1cmUucm5hbWUpID8gJ2NocicgOiAnJykgKyBmZWF0dXJlLnJuYW1lOyBicmVhaztcbiAgICB9XG4gICAgZmVhdHVyZS5uYW1lID0gZmVhdHVyZS5xbmFtZTtcbiAgICBmZWF0dXJlLmZsYWcgPSBwYXJzZUludDEwKGZlYXR1cmUuZmxhZyk7XG4gICAgY2hyUG9zID0gdGhpcy5icm93c2VyT3B0cy5jaHJQb3NbZmVhdHVyZS5ybmFtZV07XG4gICAgbGluZW5vID0gbGluZW5vIHx8IDA7XG4gICAgXG4gICAgaWYgKF8uaXNVbmRlZmluZWQoY2hyUG9zKSkge1xuICAgICAgdGhpcy53YXJuKFwiSW52YWxpZCBSTkFNRSAnXCIrZmVhdHVyZS5ybmFtZStcIicgYXQgbGluZSBcIiArIChsaW5lbm8gKyAxICsgdGhpcy5vcHRzLmxpbmVOdW0pKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gZWxzZSBpZiAoZmVhdHVyZS5wb3MgPT09ICcwJyB8fCAhZmVhdHVyZS5jaWdhciB8fCBmZWF0dXJlLmNpZ2FyID09ICcqJyB8fCBmZWF0dXJlLmZsYWcgJiBhdmFpbEZsYWdzLmlzUmVhZFVubWFwcGVkKSB7XG4gICAgICAvLyBVbm1hcHBlZCByZWFkLiBTaW5jZSB3ZSBjYW4ndCBkcmF3IHRoZXNlIGF0IGFsbCwgd2UgZG9uJ3QgYm90aGVyIHBhcnNpbmcgdGhlbSBmdXJ0aGVyLlxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZlYXR1cmUuc2NvcmUgPSBfLmlzVW5kZWZpbmVkKGZlYXR1cmUuc2NvcmUpID8gJz8nIDogZmVhdHVyZS5zY29yZTtcbiAgICAgIGZlYXR1cmUuc3RhcnQgPSBjaHJQb3MgKyBwYXJzZUludDEwKGZlYXR1cmUucG9zKTsgICAgICAgIC8vIFBPUyBpcyAxLWJhc2VkLCBoZW5jZSBubyBpbmNyZW1lbnQgYXMgZm9yIHBhcnNpbmcgQkVEXG4gICAgICBmZWF0dXJlLmRlc2MgPSBmZWF0dXJlLnFuYW1lICsgJyBhdCAnICsgZmVhdHVyZS5ybmFtZSArICc6JyArIGZlYXR1cmUucG9zO1xuICAgICAgZmVhdHVyZS50bGVuID0gcGFyc2VJbnQxMChmZWF0dXJlLnRsZW4pO1xuICAgICAgdGhpcy50eXBlKCdiYW0nKS5wYXJzZUZsYWdzLmNhbGwodGhpcywgZmVhdHVyZSwgbGluZW5vKTtcbiAgICAgIGZlYXR1cmUuc3RyYW5kID0gZmVhdHVyZS5mbGFncy5yZWFkU3RyYW5kUmV2ZXJzZSA/ICctJyA6ICcrJztcbiAgICAgIHRoaXMudHlwZSgnYmFtJykucGFyc2VDaWdhci5jYWxsKHRoaXMsIGZlYXR1cmUsIGxpbmVubyk7IC8vIFRoaXMgYWxzbyBzZXRzIC5lbmQgYXBwcm9wcmlhdGVseVxuICAgIH1cbiAgICAvLyBXZSBoYXZlIHRvIGNvbWUgdXAgd2l0aCBzb21ldGhpbmcgdGhhdCBpcyBhIHVuaXF1ZSBsYWJlbCBmb3IgZXZlcnkgbGluZSB0byBkZWR1cGUgcm93cy5cbiAgICAvLyBUaGUgZm9sbG93aW5nIGlzIHRlY2huaWNhbGx5IG5vdCBndWFyYW50ZWVkIGJ5IGEgdmFsaWQgQkFNIChldmVuIGF0IEdBVEsgc3RhbmRhcmRzKSwgYnV0IGl0J3MgdGhlIGJlc3QgSSBnb3QuXG4gICAgZmVhdHVyZS5pZCA9IFtmZWF0dXJlLnFuYW1lLCBmZWF0dXJlLmZsYWcsIGZlYXR1cmUucm5hbWUsIGZlYXR1cmUucG9zLCBmZWF0dXJlLmNpZ2FyXS5qb2luKFwiXFx0XCIpO1xuICAgIFxuICAgIHJldHVybiBmZWF0dXJlO1xuICB9LFxuICBcbiAgcGlsZXVwOiBmdW5jdGlvbihpbnRlcnZhbHMsIHN0YXJ0LCBlbmQpIHtcbiAgICB2YXIgcGlsZXVwID0gdGhpcy5kYXRhLnBpbGV1cCxcbiAgICAgIHBvc2l0aW9uc1RvQ2FsY3VsYXRlID0ge30sXG4gICAgICBudW1Qb3NpdGlvbnNUb0NhbGN1bGF0ZSA9IDAsXG4gICAgICBpO1xuICAgIFxuICAgIGZvciAoaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHtcbiAgICAgIC8vIE5vIG5lZWQgdG8gcGlsZXVwIGFnYWluIG9uIGFscmVhZHktcGlsZWQtdXAgbnVjbGVvdGlkZSBwb3NpdGlvbnNcbiAgICAgIGlmICghcGlsZXVwW2ldKSB7IHBvc2l0aW9uc1RvQ2FsY3VsYXRlW2ldID0gdHJ1ZTsgbnVtUG9zaXRpb25zVG9DYWxjdWxhdGUrKzsgfVxuICAgIH1cbiAgICBpZiAobnVtUG9zaXRpb25zVG9DYWxjdWxhdGUgPT09IDApIHsgcmV0dXJuOyB9IC8vIEFsbCBwb3NpdGlvbnMgYWxyZWFkeSBwaWxlZCB1cCFcbiAgICBcbiAgICBfLmVhY2goaW50ZXJ2YWxzLCBmdW5jdGlvbihpbnRlcnZhbCkge1xuICAgICAgdmFyIGJsb2NrU2V0cyA9IFtpbnRlcnZhbC5kYXRhLmJsb2Nrc107XG4gICAgICBpZiAoaW50ZXJ2YWwuZGF0YS5kcmF3QXNNYXRlcyAmJiBpbnRlcnZhbC5kYXRhLm1hdGUpIHsgYmxvY2tTZXRzLnB1c2goaW50ZXJ2YWwuZGF0YS5tYXRlLmJsb2Nrcyk7IH1cbiAgICAgIF8uZWFjaChibG9ja1NldHMsIGZ1bmN0aW9uKGJsb2Nrcykge1xuICAgICAgICBfLmVhY2goYmxvY2tzLCBmdW5jdGlvbihibG9jaykge1xuICAgICAgICAgIHZhciBudCwgaTtcbiAgICAgICAgICBmb3IgKGkgPSBNYXRoLm1heChibG9jay5zdGFydCwgc3RhcnQpOyBpIDwgTWF0aC5taW4oYmxvY2suZW5kLCBlbmQpOyBpKyspIHtcbiAgICAgICAgICAgIGlmICghcG9zaXRpb25zVG9DYWxjdWxhdGVbaV0pIHsgY29udGludWU7IH1cbiAgICAgICAgICAgIG50ID0gKGJsb2NrLnNlcVtpIC0gYmxvY2suc3RhcnRdIHx8ICcnKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgcGlsZXVwW2ldID0gcGlsZXVwW2ldIHx8IHtBOiAwLCBDOiAwLCBHOiAwLCBUOiAwLCBOOiAwLCBjb3Y6IDB9O1xuICAgICAgICAgICAgcGlsZXVwW2ldWygvW0FDVEddLykudGVzdChudCkgPyBudCA6ICdOJ10gKz0gMTtcbiAgICAgICAgICAgIHBpbGV1cFtpXS5jb3YgKz0gMTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG4gIFxuICBjb3ZlcmFnZTogZnVuY3Rpb24oc3RhcnQsIHdpZHRoLCBicHBwKSB7XG4gICAgLy8gQ29tcGFyZSB3aXRoIGJpbm5pbmcgb24gdGhlIGZseSBpbiAudHlwZSgnd2lnZ2xlXzAnKS5wcmVyZW5kZXIoLi4uKVxuICAgIHZhciBqID0gc3RhcnQsXG4gICAgICB2U2NhbGUgPSB0aGlzLmRhdGEuaW5mby5tZWFuSXRlbXNQZXJCcCAqIHRoaXMuZGF0YS5pbmZvLm1lYW5JdGVtTGVuZ3RoICogMixcbiAgICAgIGN1cnIgPSB0aGlzLmRhdGEucGlsZXVwW2pdLFxuICAgICAgYmFycyA9IFtdLFxuICAgICAgbmV4dCwgYmluLCBpO1xuICAgIGZvciAoaSA9IDA7IGkgPCB3aWR0aDsgaSsrKSB7XG4gICAgICBiaW4gPSBjdXJyICYmIChqICsgMSA+PSBpICogYnBwcCArIHN0YXJ0KSA/IFtjdXJyLmNvdl0gOiBbXTtcbiAgICAgIG5leHQgPSB0aGlzLmRhdGEucGlsZXVwW2ogKyAxXTtcbiAgICAgIHdoaWxlIChqICsgMSA8IChpICsgMSkgKiBicHBwICsgc3RhcnQgJiYgaiArIDIgPj0gaSAqIGJwcHAgKyBzdGFydCkgeyBcbiAgICAgICAgaWYgKG5leHQpIHsgYmluLnB1c2gobmV4dC5jb3YpOyB9XG4gICAgICAgICsrajtcbiAgICAgICAgY3VyciA9IG5leHQ7XG4gICAgICAgIG5leHQgPSB0aGlzLmRhdGEucGlsZXVwW2ogKyAxXTtcbiAgICAgIH1cbiAgICAgIGJhcnMucHVzaCh1dGlscy53aWdCaW5GdW5jdGlvbnMubWF4aW11bShiaW4pIC8gdlNjYWxlKTtcbiAgICB9XG4gICAgcmV0dXJuIGJhcnM7XG4gIH0sXG4gIFxuICBhbGxlbGVzOiBmdW5jdGlvbihzdGFydCwgc2VxdWVuY2UsIGJwcHApIHtcbiAgICB2YXIgcGlsZXVwID0gdGhpcy5kYXRhLnBpbGV1cCxcbiAgICAgIHZTY2FsZSA9IHRoaXMuZGF0YS5pbmZvLm1lYW5JdGVtc1BlckJwICogdGhpcy5kYXRhLmluZm8ubWVhbkl0ZW1MZW5ndGggKiAyLFxuICAgICAgYWxsZWxlRnJlcVRocmVzaG9sZCA9IHRoaXMub3B0cy5hbGxlbGVGcmVxVGhyZXNob2xkLFxuICAgICAgYWxsZWxlU3BsaXRzID0gW10sXG4gICAgICBzcGxpdCwgcmVmTnQsIGksIHBpbGU7XG4gICAgICBcbiAgICBmb3IgKGkgPSAwOyBpIDwgc2VxdWVuY2UubGVuZ3RoOyBpKyspIHtcbiAgICAgIHJlZk50ID0gc2VxdWVuY2VbaV0udG9VcHBlckNhc2UoKTtcbiAgICAgIHBpbGUgPSBwaWxldXBbc3RhcnQgKyBpXTtcbiAgICAgIGlmIChwaWxlICYmIHBpbGUuY292ICYmIHBpbGVbcmVmTnRdIC8gKHBpbGUuY292IC0gcGlsZS5OKSA8ICgxIC0gYWxsZWxlRnJlcVRocmVzaG9sZCkpIHtcbiAgICAgICAgc3BsaXQgPSB7XG4gICAgICAgICAgeDogaSAvIGJwcHAsXG4gICAgICAgICAgc3BsaXRzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBfLmVhY2goWydBJywgJ0MnLCAnRycsICdUJ10sIGZ1bmN0aW9uKG50KSB7XG4gICAgICAgICAgaWYgKHBpbGVbbnRdID4gMCkgeyBzcGxpdC5zcGxpdHMucHVzaCh7bnQ6IG50LCBoOiBwaWxlW250XSAvIHZTY2FsZX0pOyB9XG4gICAgICAgIH0pO1xuICAgICAgICBhbGxlbGVTcGxpdHMucHVzaChzcGxpdCk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBhbGxlbGVTcGxpdHM7XG4gIH0sXG4gIFxuICBtaXNtYXRjaGVzOiBmdW5jdGlvbihzdGFydCwgc2VxdWVuY2UsIGJwcHAsIGludGVydmFscywgd2lkdGgsIGxpbmVOdW0sIHZpZXdBc1BhaXJzKSB7XG4gICAgdmFyIG1pc21hdGNoZXMgPSBbXSxcbiAgICAgIHZpZXdBc1BhaXJzID0gdGhpcy5vcHRzLnZpZXdBc1BhaXJzO1xuICAgIHNlcXVlbmNlID0gc2VxdWVuY2UudG9VcHBlckNhc2UoKTtcbiAgICBfLmVhY2goaW50ZXJ2YWxzLCBmdW5jdGlvbihpbnRlcnZhbCkge1xuICAgICAgdmFyIGJsb2NrU2V0cyA9IFtpbnRlcnZhbC5kYXRhLmJsb2Nrc107XG4gICAgICBpZiAodmlld0FzUGFpcnMgJiYgaW50ZXJ2YWwuZGF0YS5kcmF3QXNNYXRlcyAmJiBpbnRlcnZhbC5kYXRhLm1hdGUpIHsgXG4gICAgICAgIGJsb2NrU2V0cy5wdXNoKGludGVydmFsLmRhdGEubWF0ZS5ibG9ja3MpO1xuICAgICAgfVxuICAgICAgXy5lYWNoKGJsb2NrU2V0cywgZnVuY3Rpb24oYmxvY2tzKSB7XG4gICAgICAgIF8uZWFjaChibG9ja3MsIGZ1bmN0aW9uKGJsb2NrKSB7XG4gICAgICAgICAgdmFyIGxpbmUgPSBsaW5lTnVtKGludGVydmFsLmRhdGEpLFxuICAgICAgICAgICAgbnQsIGksIHg7XG4gICAgICAgICAgZm9yIChpID0gTWF0aC5tYXgoYmxvY2suc3RhcnQsIHN0YXJ0KTsgaSA8IE1hdGgubWluKGJsb2NrLmVuZCwgc3RhcnQgKyB3aWR0aCAqIGJwcHApOyBpKyspIHtcbiAgICAgICAgICAgIHggPSAoaSAtIHN0YXJ0KSAvIGJwcHA7XG4gICAgICAgICAgICBudCA9IChibG9jay5zZXFbaSAtIGJsb2NrLnN0YXJ0XSB8fCAnJykudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIGlmIChudCAmJiBudCAhPSBzZXF1ZW5jZVtpIC0gc3RhcnRdICYmIGxpbmUpIHsgbWlzbWF0Y2hlcy5wdXNoKHt4OiB4LCBudDogbnQsIGxpbmU6IGxpbmV9KTsgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gbWlzbWF0Y2hlcztcbiAgfSxcblxuICBwcmVyZW5kZXI6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHByZWNhbGMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgd2lkdGggPSBwcmVjYWxjLndpZHRoLFxuICAgICAgc2VxdWVuY2UgPSBwcmVjYWxjLnNlcXVlbmNlLFxuICAgICAgZGF0YSA9IHNlbGYuZGF0YSxcbiAgICAgIHZpZXdBc1BhaXJzID0gc2VsZi5vcHRzLnZpZXdBc1BhaXJzLFxuICAgICAgc3RhcnRLZXkgPSB2aWV3QXNQYWlycyA/ICd0ZW1wbGF0ZVN0YXJ0JyA6ICdzdGFydCcsXG4gICAgICBlbmRLZXkgPSB2aWV3QXNQYWlycyA/ICd0ZW1wbGF0ZUVuZCcgOiAnZW5kJyxcbiAgICAgIGJwcHAgPSAoZW5kIC0gc3RhcnQpIC8gd2lkdGg7XG4gICAgXG4gICAgZnVuY3Rpb24gbGluZU51bShkLCBzZXRUbykge1xuICAgICAgdmFyIGtleSA9IGJwcHAgKyAnXycgKyBkZW5zaXR5ICsgJ18nICsgKHZpZXdBc1BhaXJzID8gJ3AnIDogJ3UnKTtcbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZChzZXRUbykpIHsgXG4gICAgICAgIGlmICghZC5saW5lKSB7IGQubGluZSA9IHt9OyB9XG4gICAgICAgIHJldHVybiAoZC5saW5lW2tleV0gPSBzZXRUbyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZC5saW5lICYmIGQubGluZVtrZXldOyBcbiAgICB9XG4gICAgXG4gICAgLy8gRG9uJ3QgZXZlbiBhdHRlbXB0IHRvIGZldGNoIHRoZSBkYXRhIGlmIHdlIGNhbiByZWFzb25hYmx5IGVzdGltYXRlIHRoYXQgd2Ugd2lsbCBmZXRjaCBhbiBpbnNhbmUgYW1vdW50IG9mIHJvd3MgXG4gICAgLy8gKD41MDAgYWxpZ25tZW50cyksIGFzIHRoaXMgd2lsbCBvbmx5IGhvbGQgdXAgb3RoZXIgcmVxdWVzdHMuXG4gICAgaWYgKHNlbGYub3B0cy5tYXhGZXRjaFdpbmRvdyAmJiAoZW5kIC0gc3RhcnQpID4gc2VsZi5vcHRzLm1heEZldGNoV2luZG93KSB7XG4gICAgICBjYWxsYmFjayh7dG9vTWFueTogdHJ1ZX0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGZXRjaCBmcm9tIHRoZSBSZW1vdGVUcmFjayBhbmQgY2FsbCB0aGUgYWJvdmUgd2hlbiB0aGUgZGF0YSBpcyBhdmFpbGFibGUuXG4gICAgICBzZWxmLmRhdGEucmVtb3RlLmZldGNoQXN5bmMoc3RhcnQsIGVuZCwgdmlld0FzUGFpcnMsIGZ1bmN0aW9uKGludGVydmFscykge1xuICAgICAgICB2YXIgZHJhd1NwZWMgPSB7c2VxdWVuY2U6ICEhc2VxdWVuY2UsIHdpZHRoOiB3aWR0aH0sXG4gICAgICAgICAgY2FsY1BpeEludGVydmFsTWF0ZWQgPSBuZXcgdXRpbHMucGl4SW50ZXJ2YWxDYWxjdWxhdG9yKHN0YXJ0LCB3aWR0aCwgYnBwcCwgNCwgZmFsc2UsIHN0YXJ0S2V5LCBlbmRLZXkpLFxuICAgICAgICAgIGNhbGNQaXhJbnRlcnZhbCA9IG5ldyB1dGlscy5waXhJbnRlcnZhbENhbGN1bGF0b3Ioc3RhcnQsIHdpZHRoLCBicHBwLCA0KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChpbnRlcnZhbHMudG9vTWFueSkgeyByZXR1cm4gY2FsbGJhY2soaW50ZXJ2YWxzKTsgfVxuXG4gICAgICAgIGlmICghc2VxdWVuY2UpIHtcbiAgICAgICAgICAvLyBGaXJzdCBkcmF3aW5nIHBhc3MsIHdpdGggZmVhdHVyZXMgdGhhdCBkb24ndCBkZXBlbmQgb24gc2VxdWVuY2UuXG4gICAgICAgICAgc2VsZi50eXBlKCdiYW0nKS5waWxldXAuY2FsbChzZWxmLCBpbnRlcnZhbHMsIHN0YXJ0LCBlbmQpO1xuICAgICAgICAgIGRyYXdTcGVjLmxheW91dCA9IHNlbGYudHlwZSgnYmVkJykuc3RhY2tlZExheW91dC5jYWxsKHNlbGYsIGludGVydmFscywgd2lkdGgsIGNhbGNQaXhJbnRlcnZhbE1hdGVkLCBsaW5lTnVtKTtcbiAgICAgICAgICBfLmVhY2goZHJhd1NwZWMubGF5b3V0LCBmdW5jdGlvbihsaW5lcykge1xuICAgICAgICAgICAgXy5lYWNoKGxpbmVzLCBmdW5jdGlvbihpbnRlcnZhbCkge1xuICAgICAgICAgICAgICBpbnRlcnZhbC5pbnNlcnRpb25QdHMgPSBfLm1hcChpbnRlcnZhbC5kLmluc2VydGlvbnMsIGNhbGNQaXhJbnRlcnZhbCk7XG4gICAgICAgICAgICAgIGlmICghdmlld0FzUGFpcnMpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgIGlmIChpbnRlcnZhbC5kLmRyYXdBc01hdGVzICYmIGludGVydmFsLmQubWF0ZSkge1xuICAgICAgICAgICAgICAgIGludGVydmFsLm1hdGVJbnRzID0gXy5tYXAoW2ludGVydmFsLmQsIGludGVydmFsLmQubWF0ZV0sIGNhbGNQaXhJbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgaW50ZXJ2YWwubWF0ZUJsb2NrSW50cyA9IF8ubWFwKGludGVydmFsLmQubWF0ZS5ibG9ja3MsIGNhbGNQaXhJbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgaW50ZXJ2YWwubWF0ZUluc2VydGlvblB0cyA9IF8ubWFwKGludGVydmFsLmQubWF0ZS5pbnNlcnRpb25QdHMsIGNhbGNQaXhJbnRlcnZhbCk7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW50ZXJ2YWwuZC5tYXRlRXhwZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBpbnRlcnZhbC5tYXRlSW50cyA9IFtjYWxjUGl4SW50ZXJ2YWwoaW50ZXJ2YWwpXTtcbiAgICAgICAgICAgICAgICBpbnRlcnZhbC5tYXRlQmxvY2tJbnRzID0gW107XG4gICAgICAgICAgICAgICAgaW50ZXJ2YWwubWF0ZUluc2VydGlvblB0cyA9IFtdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBkcmF3U3BlYy5jb3ZlcmFnZSA9IHNlbGYudHlwZSgnYmFtJykuY292ZXJhZ2UuY2FsbChzZWxmLCBzdGFydCwgd2lkdGgsIGJwcHApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFNlY29uZCBkcmF3aW5nIHBhc3MsIHRvIGRyYXcgdGhpbmdzIHRoYXQgYXJlIGRlcGVuZGVudCBvbiBzZXF1ZW5jZSwgbGlrZSBtaXNtYXRjaGVzIChwb3RlbnRpYWwgU05QcykuXG4gICAgICAgICAgZHJhd1NwZWMuYnBwcCA9IGJwcHA7ICBcbiAgICAgICAgICAvLyBGaW5kIGFsbGVsZSBzcGxpdHMgd2l0aGluIHRoZSBjb3ZlcmFnZSBncmFwaC5cbiAgICAgICAgICBkcmF3U3BlYy5hbGxlbGVzID0gc2VsZi50eXBlKCdiYW0nKS5hbGxlbGVzLmNhbGwoc2VsZiwgc3RhcnQsIHNlcXVlbmNlLCBicHBwKTtcbiAgICAgICAgICAvLyBGaW5kIG1pc21hdGNoZXMgd2l0aGluIGVhY2ggYWxpZ25lZCBibG9jay5cbiAgICAgICAgICBkcmF3U3BlYy5taXNtYXRjaGVzID0gc2VsZi50eXBlKCdiYW0nKS5taXNtYXRjaGVzLmNhbGwoc2VsZiwgc3RhcnQsIHNlcXVlbmNlLCBicHBwLCBpbnRlcnZhbHMsIHdpZHRoLCBsaW5lTnVtKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY2FsbGJhY2soZHJhd1NwZWMpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICBcbiAgLy8gc3BlY2lhbCBmb3JtYXR0ZXIgZm9yIGNvbnRlbnQgaW4gdG9vbHRpcHMgZm9yIGZlYXR1cmVzXG4gIHRpcFRpcERhdGE6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0cyxcbiAgICAgIGNvbnRlbnQgPSB7fSxcbiAgICAgIGZpcnN0TWF0ZSA9IGRhdGEuZCxcbiAgICAgIHNlY29uZE1hdGUgPSBkYXRhLmQubWF0ZSxcbiAgICAgIG1hdGVIZWFkZXJzID0gW1widGhpcyBhbGlnbm1lbnRcIiwgXCJtYXRlIHBhaXIgYWxpZ25tZW50XCJdLFxuICAgICAgbGVmdE1hdGUsIHJpZ2h0TWF0ZSwgcGFpck9yaWVudGF0aW9uO1xuICAgIGZ1bmN0aW9uIHllc05vKGJvb2wpIHsgcmV0dXJuIGJvb2wgPyBcInllc1wiIDogXCJub1wiOyB9XG4gICAgZnVuY3Rpb24gYWRkQWxpZ25lZFNlZ21lbnRJbmZvKGNvbnRlbnQsIHNlZywgcHJlZml4KSB7XG4gICAgICB2YXIgY2lnYXJBYmJyZXYgPSBzZWcuY2lnYXIgJiYgc2VnLmNpZ2FyLmxlbmd0aCA+IDI1ID8gc2VnLmNpZ2FyLnN1YnN0cigwLCAyNCkgKyAnLi4uJyA6IHNlZy5jaWdhcjtcbiAgICAgIHByZWZpeCA9IHByZWZpeCB8fCBcIlwiO1xuICAgICAgXG4gICAgICBfLmVhY2goe1xuICAgICAgICBcInBvc2l0aW9uXCI6IHNlZy5ybmFtZSArICc6JyArIHNlZy5wb3MsXG4gICAgICAgIFwiY2lnYXJcIjogY2lnYXJBYmJyZXYsXG4gICAgICAgIFwicmVhZCBzdHJhbmRcIjogc2VnLmZsYWdzLnJlYWRTdHJhbmRSZXZlcnNlID8gJygtKScgOiAnKCspJyxcbiAgICAgICAgXCJtYXBwZWRcIjogeWVzTm8oIXNlZy5mbGFncy5pc1JlYWRVbm1hcHBlZCksXG4gICAgICAgIFwibWFwIHF1YWxpdHlcIjogc2VnLm1hcHEsXG4gICAgICAgIFwic2Vjb25kYXJ5XCI6IHllc05vKHNlZy5mbGFncy5pc1NlY29uZGFyeUFsaWdubWVudCksXG4gICAgICAgIFwic3VwcGxlbWVudGFyeVwiOiB5ZXNObyhzZWcuZmxhZ3MuaXNTdXBwbGVtZW50YXJ5QWxpZ25tZW50KSxcbiAgICAgICAgXCJkdXBsaWNhdGVcIjogeWVzTm8oc2VnLmZsYWdzLmlzRHVwbGljYXRlUmVhZCksXG4gICAgICAgIFwiZmFpbGVkIFFDXCI6IHllc05vKHNlZy5mbGFncy5pc1JlYWRGYWlsaW5nVmVuZG9yUUMpXG4gICAgICB9LCBmdW5jdGlvbih2LCBrKSB7IGNvbnRlbnRbcHJlZml4ICsga10gPSB2OyB9KTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGRhdGEuZC5tYXRlICYmIGRhdGEuZC5tYXRlLmZsYWdzKSB7XG4gICAgICBsZWZ0TWF0ZSA9IGRhdGEuZC5zdGFydCA8IGRhdGEuZC5tYXRlLnN0YXJ0ID8gZGF0YS5kIDogZGF0YS5kLm1hdGU7XG4gICAgICByaWdodE1hdGUgPSBkYXRhLmQuc3RhcnQgPCBkYXRhLmQubWF0ZS5zdGFydCA/IGRhdGEuZC5tYXRlIDogZGF0YS5kO1xuICAgICAgcGFpck9yaWVudGF0aW9uID0gKGxlZnRNYXRlLmZsYWdzLnJlYWRTdHJhbmRSZXZlcnNlID8gXCJSXCIgOiBcIkZcIikgKyAobGVmdE1hdGUuZmxhZ3MuaXNSZWFkRmlyc3RPZlBhaXIgPyBcIjFcIiA6IFwiMlwiKTtcbiAgICAgIHBhaXJPcmllbnRhdGlvbiArPSAocmlnaHRNYXRlLmZsYWdzLnJlYWRTdHJhbmRSZXZlcnNlID8gXCJSXCIgOiBcIkZcIikgKyAocmlnaHRNYXRlLmZsYWdzLmlzUmVhZExhc3RPZlBhaXIgPyBcIjJcIiA6IFwiMVwiKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKG8udmlld0FzUGFpcnMgJiYgZGF0YS5kLmRyYXdBc01hdGVzICYmIGRhdGEuZC5tYXRlKSB7XG4gICAgICBmaXJzdE1hdGUgPSBsZWZ0TWF0ZTtcbiAgICAgIHNlY29uZE1hdGUgPSByaWdodE1hdGU7XG4gICAgICBtYXRlSGVhZGVycyA9IFtcImxlZnQgYWxpZ25tZW50XCIsIFwicmlnaHQgYWxpZ25tZW50XCJdO1xuICAgIH1cbiAgICBpZiAoc2Vjb25kTWF0ZSkge1xuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKGRhdGEuZC5pbnNlcnRTaXplKSkgeyBjb250ZW50W1wiaW5zZXJ0IHNpemVcIl0gPSBkYXRhLmQuaW5zZXJ0U2l6ZTsgfVxuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHBhaXJPcmllbnRhdGlvbikpIHsgY29udGVudFtcInBhaXIgb3JpZW50YXRpb25cIl0gPSBwYWlyT3JpZW50YXRpb247IH1cbiAgICAgIGNvbnRlbnRbbWF0ZUhlYWRlcnNbMF1dID0gXCItLS1cIjtcbiAgICAgIGFkZEFsaWduZWRTZWdtZW50SW5mbyhjb250ZW50LCBmaXJzdE1hdGUpO1xuICAgICAgY29udGVudFttYXRlSGVhZGVyc1sxXV0gPSBcIi0tLVwiO1xuICAgICAgYWRkQWxpZ25lZFNlZ21lbnRJbmZvKGNvbnRlbnQsIHNlY29uZE1hdGUsIFwiIFwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWRkQWxpZ25lZFNlZ21lbnRJbmZvKGNvbnRlbnQsIGRhdGEuZCk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBjb250ZW50O1xuICB9LFxuICBcbiAgLy8gU2VlIGh0dHBzOi8vd3d3LmJyb2FkaW5zdGl0dXRlLm9yZy9pZ3YvQWxpZ25tZW50RGF0YSNjb3ZlcmFnZSBmb3IgYW4gaWRlYSBvZiB3aGF0IHdlJ3JlIGltaXRhdGluZ1xuICBkcmF3Q292ZXJhZ2U6IGZ1bmN0aW9uKGN0eCwgY292ZXJhZ2UsIGhlaWdodCkge1xuICAgIF8uZWFjaChjb3ZlcmFnZSwgZnVuY3Rpb24oZCwgeCkge1xuICAgICAgaWYgKGQgPT09IG51bGwpIHsgcmV0dXJuOyB9XG4gICAgICBjdHguZmlsbFJlY3QoeCwgTWF0aC5tYXgoaGVpZ2h0IC0gKGQgKiBoZWlnaHQpLCAwKSwgMSwgTWF0aC5taW4oZCAqIGhlaWdodCwgaGVpZ2h0KSk7XG4gICAgfSk7XG4gIH0sXG4gIFxuICBkcmF3U3RyYW5kSW5kaWNhdG9yOiBmdW5jdGlvbihjdHgsIHgsIGJsb2NrWSwgYmxvY2tIZWlnaHQsIHhTY2FsZSwgYmlnU3R5bGUpIHtcbiAgICB2YXIgcHJldkZpbGxTdHlsZSA9IGN0eC5maWxsU3R5bGU7XG4gICAgaWYgKGJpZ1N0eWxlKSB7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHgubW92ZVRvKHggLSAoMiAqIHhTY2FsZSksIGJsb2NrWSk7XG4gICAgICBjdHgubGluZVRvKHggKyAoMyAqIHhTY2FsZSksIGJsb2NrWSArIGJsb2NrSGVpZ2h0LzIpO1xuICAgICAgY3R4LmxpbmVUbyh4IC0gKDIgKiB4U2NhbGUpLCBibG9ja1kgKyBibG9ja0hlaWdodCk7XG4gICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICBjdHguZmlsbCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYigxNDAsMTQwLDE0MCknO1xuICAgICAgY3R4LmZpbGxSZWN0KHggKyAoeFNjYWxlID4gMCA/IC0yIDogMSksIGJsb2NrWSwgMSwgYmxvY2tIZWlnaHQpO1xuICAgICAgY3R4LmZpbGxSZWN0KHggKyAoeFNjYWxlID4gMCA/IC0xIDogMCksIGJsb2NrWSArIDEsIDEsIGJsb2NrSGVpZ2h0IC0gMik7XG4gICAgICBjdHguZmlsbFN0eWxlID0gcHJldkZpbGxTdHlsZTtcbiAgICB9XG4gIH0sXG4gIFxuICBkcmF3QWxpZ25tZW50OiBmdW5jdGlvbihjdHgsIHdpZHRoLCBkYXRhLCBpLCBsaW5lSGVpZ2h0KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgZHJhd01hdGVzID0gZGF0YS5tYXRlSW50cyxcbiAgICAgIGNvbG9yID0gc2VsZi5vcHRzLmNvbG9yLFxuICAgICAgbGluZUdhcCA9IGxpbmVIZWlnaHQgPiA2ID8gMiA6IDAsXG4gICAgICBibG9ja1kgPSBpICogbGluZUhlaWdodCArIGxpbmVHYXAvMixcbiAgICAgIGJsb2NrSGVpZ2h0ID0gbGluZUhlaWdodCAtIGxpbmVHYXAsXG4gICAgICBkZWxldGlvbkxpbmVXaWR0aCA9IDIsXG4gICAgICBpbnNlcnRpb25DYXJldExpbmVXaWR0aCA9IGxpbmVIZWlnaHQgPiA2ID8gMiA6IDEsXG4gICAgICBoYWxmSGVpZ2h0ID0gTWF0aC5yb3VuZCgwLjUgKiBsaW5lSGVpZ2h0KSAtIGRlbGV0aW9uTGluZVdpZHRoICogMC41LFxuICAgICAgYmxvY2tTZXRzID0gW3tibG9ja0ludHM6IGRhdGEuYmxvY2tJbnRzLCBzdHJhbmQ6IGRhdGEuZC5zdHJhbmR9XTtcbiAgICBcbiAgICAvLyBGb3IgbWF0ZSBwYWlycywgdGhlIGZ1bGwgcGl4ZWwgaW50ZXJ2YWwgcmVwcmVzZW50cyB0aGUgbGluZSBsaW5raW5nIHRoZSBtYXRlc1xuICAgIGlmIChkcmF3TWF0ZXMpIHtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBjdHguc3Ryb2tlU3R5bGUgPSBcInJnYihcIiArIGNvbG9yICsgXCIpXCI7XG4gICAgICBjdHguZmlsbFJlY3QoZGF0YS5wSW50LngsIGkgKiBsaW5lSGVpZ2h0ICsgaGFsZkhlaWdodCwgZGF0YS5wSW50LncsIGRlbGV0aW9uTGluZVdpZHRoKTtcbiAgICB9XG4gICAgXG4gICAgLy8gRHJhdyB0aGUgbGluZXMgdGhhdCBzaG93IHRoZSBmdWxsIGFsaWdubWVudCBmb3IgZWFjaCBzZWdtZW50LCBpbmNsdWRpbmcgZGVsZXRpb25zXG4gICAgY3R4LmZpbGxTdHlsZSA9IGN0eC5zdHJva2VTdHlsZSA9ICdyZ2IoMCwwLDApJztcbiAgICBfLmVhY2goZHJhd01hdGVzIHx8IFtkYXRhLnBJbnRdLCBmdW5jdGlvbihwSW50KSB7XG4gICAgICBpZiAocEludC53IDw9IDApIHsgcmV0dXJuOyB9XG4gICAgICAvLyBOb3RlIHRoYXQgdGhlIFwiLSAxXCIgYmVsb3cgZml4ZXMgcm91bmRpbmcgaXNzdWVzIGJ1dCBnYW1ibGVzIG9uIHRoZXJlIG5ldmVyIGJlaW5nIGEgZGVsZXRpb24gYXQgdGhlIHJpZ2h0IGVkZ2VcbiAgICAgIGN0eC5maWxsUmVjdChwSW50LngsIGkgKiBsaW5lSGVpZ2h0ICsgaGFsZkhlaWdodCwgcEludC53IC0gMSwgZGVsZXRpb25MaW5lV2lkdGgpO1xuICAgIH0pO1xuICAgIFxuICAgIC8vIEZpcnN0LCBkZXRlcm1pbmUgYW5kIHNldCB0aGUgY29sb3Igd2Ugd2lsbCBiZSB1c2luZ1xuICAgIC8vIE5vdGUgdGhhdCB0aGUgZGVmYXVsdCBjb2xvciB3YXMgYWxyZWFkeSBzZXQgaW4gZHJhd1NwZWNcbiAgICBpZiAoc2VsZi5vcHRzLmFsdENvbG9yICYmIGRhdGEuZC5zdHJhbmQgPT0gJy0nKSB7IGNvbG9yID0gc2VsZi5vcHRzLmFsdENvbG9yOyB9XG4gICAgY3R4LmZpbGxTdHlsZSA9IGN0eC5zdHJva2VTdHlsZSA9IFwicmdiKFwiICsgY29sb3IgKyBcIilcIjtcbiAgICBcbiAgICAvLyBEcmF3IHRoZSBbbWlzXW1hdGNoIChNL1gvPSkgYmxvY2tzXG4gICAgaWYgKGRyYXdNYXRlcyAmJiBkYXRhLmQubWF0ZSkgeyBibG9ja1NldHMucHVzaCh7YmxvY2tJbnRzOiBkYXRhLm1hdGVCbG9ja0ludHMsIHN0cmFuZDogZGF0YS5kLm1hdGUuc3RyYW5kfSk7IH1cbiAgICBfLmVhY2goYmxvY2tTZXRzLCBmdW5jdGlvbihibG9ja1NldCkge1xuICAgICAgdmFyIHN0cmFuZCA9IGJsb2NrU2V0LnN0cmFuZDtcbiAgICAgIF8uZWFjaChibG9ja1NldC5ibG9ja0ludHMsIGZ1bmN0aW9uKGJJbnQsIGJsb2NrTnVtKSB7XG4gICAgICBcbiAgICAgICAgLy8gU2tpcCBkcmF3aW5nIGJsb2NrcyB0aGF0IGFyZW4ndCBpbnNpZGUgdGhlIGNhbnZhc1xuICAgICAgICBpZiAoYkludC54ICsgYkludC53IDwgMCB8fCBiSW50LnggPiB3aWR0aCkgeyByZXR1cm47IH1cbiAgICAgIFxuICAgICAgICBpZiAoYmxvY2tOdW0gPT0gMCAmJiBibG9ja1NldC5zdHJhbmQgPT0gJy0nICYmICFiSW50Lm9QcmV2KSB7XG4gICAgICAgICAgY3R4LmZpbGxSZWN0KGJJbnQueCArIDIsIGJsb2NrWSwgYkludC53IC0gMiwgYmxvY2tIZWlnaHQpO1xuICAgICAgICAgIHNlbGYudHlwZSgnYmFtJykuZHJhd1N0cmFuZEluZGljYXRvci5jYWxsKHNlbGYsIGN0eCwgYkludC54LCBibG9ja1ksIGJsb2NrSGVpZ2h0LCAtMSwgbGluZUhlaWdodCA+IDYpO1xuICAgICAgICB9IGVsc2UgaWYgKGJsb2NrTnVtID09IGJsb2NrU2V0LmJsb2NrSW50cy5sZW5ndGggLSAxICYmIGJsb2NrU2V0LnN0cmFuZCA9PSAnKycgJiYgIWJJbnQub05leHQpIHtcbiAgICAgICAgICBjdHguZmlsbFJlY3QoYkludC54LCBibG9ja1ksIGJJbnQudyAtIDIsIGJsb2NrSGVpZ2h0KTtcbiAgICAgICAgICBzZWxmLnR5cGUoJ2JhbScpLmRyYXdTdHJhbmRJbmRpY2F0b3IuY2FsbChzZWxmLCBjdHgsIGJJbnQueCArIGJJbnQudywgYmxvY2tZLCBibG9ja0hlaWdodCwgMSwgbGluZUhlaWdodCA+IDYpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGN0eC5maWxsUmVjdChiSW50LngsIGJsb2NrWSwgYkludC53LCBibG9ja0hlaWdodCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIFxuICAgIC8vIERyYXcgaW5zZXJ0aW9uc1xuICAgIGN0eC5maWxsU3R5bGUgPSBjdHguc3Ryb2tlU3R5bGUgPSBcInJnYigxMTQsNDEsMjE4KVwiO1xuICAgIF8uZWFjaChkcmF3TWF0ZXMgPyBbZGF0YS5pbnNlcnRpb25QdHMsIGRhdGEubWF0ZUluc2VydGlvblB0c10gOiBbZGF0YS5pbnNlcnRpb25QdHNdLCBmdW5jdGlvbihpbnNlcnRpb25QdHMpIHtcbiAgICAgIF8uZWFjaChpbnNlcnRpb25QdHMsIGZ1bmN0aW9uKGluc2VydCkge1xuICAgICAgICBpZiAoaW5zZXJ0LnggKyBpbnNlcnQudyA8IDAgfHwgaW5zZXJ0LnggPiB3aWR0aCkgeyByZXR1cm47IH1cbiAgICAgICAgY3R4LmZpbGxSZWN0KGluc2VydC54IC0gMSwgaSAqIGxpbmVIZWlnaHQsIDIsIGxpbmVIZWlnaHQpO1xuICAgICAgICBjdHguZmlsbFJlY3QoaW5zZXJ0LnggLSAyLCBpICogbGluZUhlaWdodCwgNCwgaW5zZXJ0aW9uQ2FyZXRMaW5lV2lkdGgpO1xuICAgICAgICBjdHguZmlsbFJlY3QoaW5zZXJ0LnggLSAyLCAoaSArIDEpICogbGluZUhlaWdodCAtIGluc2VydGlvbkNhcmV0TGluZVdpZHRoLCA0LCBpbnNlcnRpb25DYXJldExpbmVXaWR0aCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcbiAgXG4gIGRyYXdBbGxlbGVzOiBmdW5jdGlvbihjdHgsIGFsbGVsZXMsIGhlaWdodCwgYmFyV2lkdGgpIHtcbiAgICAvLyBTYW1lIGNvbG9ycyBhcyAkLnVpLmdlbm90cmFjay5fbnRTZXF1ZW5jZUxvYWQoLi4uKSBidXQgY291bGQgYmUgY29uZmlndXJhYmxlP1xuICAgIHZhciBjb2xvcnMgPSB7QTogJzI1NSwwLDAnLCBUOiAnMjU1LDAsMjU1JywgQzogJzAsMCwyNTUnLCBHOiAnMCwxODAsMCd9LFxuICAgICAgeVBvcztcbiAgICBfLmVhY2goYWxsZWxlcywgZnVuY3Rpb24oYWxsZWxlc0ZvclBvc2l0aW9uKSB7XG4gICAgICB5UG9zID0gaGVpZ2h0O1xuICAgICAgXy5lYWNoKGFsbGVsZXNGb3JQb3NpdGlvbi5zcGxpdHMsIGZ1bmN0aW9uKHNwbGl0KSB7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiKCcrY29sb3JzW3NwbGl0Lm50XSsnKSc7XG4gICAgICAgIGN0eC5maWxsUmVjdChhbGxlbGVzRm9yUG9zaXRpb24ueCwgeVBvcyAtPSAoc3BsaXQuaCAqIGhlaWdodCksIE1hdGgubWF4KGJhcldpZHRoLCAxKSwgc3BsaXQuaCAqIGhlaWdodCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcbiAgXG4gIGRyYXdNaXNtYXRjaDogZnVuY3Rpb24oY3R4LCBtaXNtYXRjaCwgbGluZU9mZnNldCwgbGluZUhlaWdodCwgcHBicCkge1xuICAgIC8vIHBwYnAgPT0gcGl4ZWxzIHBlciBiYXNlIHBhaXIgKGludmVyc2Ugb2YgYnBwcClcbiAgICAvLyBTYW1lIGNvbG9ycyBhcyAkLnVpLmdlbm90cmFjay5fbnRTZXF1ZW5jZUxvYWQoLi4uKSBidXQgY291bGQgYmUgY29uZmlndXJhYmxlP1xuICAgIHZhciBjb2xvcnMgPSB7QTogJzI1NSwwLDAnLCBUOiAnMjU1LDAsMjU1JywgQzogJzAsMCwyNTUnLCBHOiAnMCwxODAsMCd9LFxuICAgICAgbGluZUdhcCA9IGxpbmVIZWlnaHQgPiA2ID8gMiA6IDAsXG4gICAgICB5UG9zO1xuICAgIGN0eC5maWxsU3R5bGUgPSAncmdiKCcrY29sb3JzW21pc21hdGNoLm50XSsnKSc7XG4gICAgY3R4LmZpbGxSZWN0KG1pc21hdGNoLngsIChtaXNtYXRjaC5saW5lICsgbGluZU9mZnNldCkgKiBsaW5lSGVpZ2h0ICsgbGluZUdhcCAvIDIsIE1hdGgubWF4KHBwYnAsIDEpLCBsaW5lSGVpZ2h0IC0gbGluZUdhcCk7XG4gICAgLy8gRG8gd2UgaGF2ZSByb29tIHRvIHByaW50IGEgd2hvbGUgbGV0dGVyP1xuICAgIGlmIChwcGJwID4gNyAmJiBsaW5lSGVpZ2h0ID4gMTApIHtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiKDI1NSwyNTUsMjU1KSc7XG4gICAgICBjdHguZmlsbFRleHQobWlzbWF0Y2gubnQsIG1pc21hdGNoLnggKyBwcGJwICogMC41LCAobWlzbWF0Y2gubGluZSArIGxpbmVPZmZzZXQgKyAxKSAqIGxpbmVIZWlnaHQgLSBsaW5lR2FwKTtcbiAgICB9XG4gIH0sXG4gIFxuICBkcmF3U3BlYzogZnVuY3Rpb24oY2FudmFzLCBkcmF3U3BlYywgZGVuc2l0eSkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0ICYmIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLFxuICAgICAgdXJsVGVtcGxhdGUgPSAnamF2YXNjcmlwdDp2b2lkKFwiJytzZWxmLm9wdHMubmFtZSsnOiQkXCIpJyxcbiAgICAgIGRyYXdMaW1pdCA9IHNlbGYub3B0cy5kcmF3TGltaXQgJiYgc2VsZi5vcHRzLmRyYXdMaW1pdFtkZW5zaXR5XSxcbiAgICAgIGxpbmVIZWlnaHQgPSBkZW5zaXR5ID09ICdwYWNrJyA/IDE0IDogNCxcbiAgICAgIGNvdkhlaWdodCA9IGRlbnNpdHkgPT0gJ2RlbnNlJyA/IDI0IDogMzgsXG4gICAgICBjb3ZNYXJnaW4gPSA3LFxuICAgICAgbGluZU9mZnNldCA9ICgoY292SGVpZ2h0ICsgY292TWFyZ2luKSAvIGxpbmVIZWlnaHQpLCBcbiAgICAgIGNvbG9yID0gc2VsZi5vcHRzLmNvbG9yLFxuICAgICAgYXJlYXMgPSBudWxsO1xuICAgICAgICAgICAgXG4gICAgaWYgKCFjdHgpIHsgdGhyb3cgXCJDYW52YXMgbm90IHN1cHBvcnRlZFwiOyB9XG4gICAgXG4gICAgaWYgKCFkcmF3U3BlYy5zZXF1ZW5jZSkge1xuICAgICAgLy8gRmlyc3QgZHJhd2luZyBwYXNzLCB3aXRoIGZlYXR1cmVzIHRoYXQgZG9uJ3QgZGVwZW5kIG9uIHNlcXVlbmNlLlxuICAgICAgXG4gICAgICAvLyBJZiBuZWNlc3NhcnksIGluZGljYXRlIHRoZXJlIHdhcyB0b28gbXVjaCBkYXRhIHRvIGxvYWQvZHJhdyBhbmQgdGhhdCB0aGUgdXNlciBuZWVkcyB0byB6b29tIHRvIHNlZSBtb3JlXG4gICAgICBpZiAoZHJhd1NwZWMudG9vTWFueSB8fCAoZHJhd0xpbWl0ICYmIGRyYXdTcGVjLmxheW91dC5sZW5ndGggPiBkcmF3TGltaXQpKSB7IFxuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gMDtcbiAgICAgICAgY2FudmFzLmNsYXNzTmFtZSA9IGNhbnZhcy5jbGFzc05hbWUgKyAnIHRvby1tYW55JztcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBPbmx5IHN0b3JlIGFyZWFzIGZvciB0aGUgXCJwYWNrXCIgZGVuc2l0eS5cbiAgICAgIC8vIFdlIGhhdmUgdG8gZW1wdHkgdGhpcyBmb3IgZXZlcnkgcmVuZGVyLCBiZWNhdXNlIGFyZWFzIGNhbiBjaGFuZ2UgaWYgQkFNIGRpc3BsYXkgb3B0aW9ucyBjaGFuZ2UuXG4gICAgICBpZiAoZGVuc2l0eSA9PSAncGFjaycgJiYgIXNlbGYuYXJlYXNbY2FudmFzLmlkXSkgeyBhcmVhcyA9IHNlbGYuYXJlYXNbY2FudmFzLmlkXSA9IFtdOyB9XG4gICAgICAvLyBTZXQgdGhlIGV4cGVjdGVkIGhlaWdodCBmb3IgdGhlIGNhbnZhcyAodGhpcyBhbHNvIGVyYXNlcyBpdCkuXG4gICAgICBjYW52YXMuaGVpZ2h0ID0gY292SGVpZ2h0ICsgKChkZW5zaXR5ID09ICdkZW5zZScpID8gMCA6IGNvdk1hcmdpbiArIGRyYXdTcGVjLmxheW91dC5sZW5ndGggKiBsaW5lSGVpZ2h0KTtcbiAgICAgIFxuICAgICAgLy8gRmlyc3QgZHJhdyB0aGUgY292ZXJhZ2UgZ3JhcGhcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBcInJnYigxNTksMTU5LDE1OSlcIjtcbiAgICAgIHNlbGYudHlwZSgnYmFtJykuZHJhd0NvdmVyYWdlLmNhbGwoc2VsZiwgY3R4LCBkcmF3U3BlYy5jb3ZlcmFnZSwgY292SGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgIC8vIE5vdywgZHJhdyBhbGlnbm1lbnRzIGJlbG93IGl0XG4gICAgICBpZiAoZGVuc2l0eSAhPSAnZGVuc2UnKSB7XG4gICAgICAgIC8vIEJvcmRlciBiZXR3ZWVuIGNvdmVyYWdlXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBcInJnYigxMDksMTA5LDEwOSlcIjtcbiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIGNvdkhlaWdodCArIDEsIGRyYXdTcGVjLndpZHRoLCAxKTsgXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBjdHguc3Ryb2tlU3R5bGUgPSBcInJnYihcIitjb2xvcitcIilcIjtcbiAgICAgICAgXG4gICAgICAgIF8uZWFjaChkcmF3U3BlYy5sYXlvdXQsIGZ1bmN0aW9uKGwsIGkpIHtcbiAgICAgICAgICBpICs9IGxpbmVPZmZzZXQ7IC8vIGhhY2tpc2ggbWV0aG9kIGZvciBsZWF2aW5nIHNwYWNlIGF0IHRoZSB0b3AgZm9yIHRoZSBjb3ZlcmFnZSBncmFwaFxuICAgICAgICAgIF8uZWFjaChsLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBzZWxmLnR5cGUoJ2JhbScpLmRyYXdBbGlnbm1lbnQuY2FsbChzZWxmLCBjdHgsIGRyYXdTcGVjLndpZHRoLCBkYXRhLCBpLCBsaW5lSGVpZ2h0LCBkcmF3U3BlYy52aWV3QXNQYWlycyk7XG4gICAgICAgICAgICBzZWxmLnR5cGUoJ2JlZCcpLmFkZEFyZWEuY2FsbChzZWxmLCBhcmVhcywgZGF0YSwgaSwgbGluZUhlaWdodCwgdXJsVGVtcGxhdGUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gU2Vjb25kIGRyYXdpbmcgcGFzcywgdG8gZHJhdyB0aGluZ3MgdGhhdCBhcmUgZGVwZW5kZW50IG9uIHNlcXVlbmNlOlxuICAgICAgLy8gKDEpIGFsbGVsZSBzcGxpdHMgb3ZlciBjb3ZlcmFnZVxuICAgICAgc2VsZi50eXBlKCdiYW0nKS5kcmF3QWxsZWxlcy5jYWxsKHNlbGYsIGN0eCwgZHJhd1NwZWMuYWxsZWxlcywgY292SGVpZ2h0LCAxIC8gZHJhd1NwZWMuYnBwcCk7XG4gICAgICAvLyAoMikgbWlzbWF0Y2hlcyBvdmVyIHRoZSBhbGlnbm1lbnRzXG4gICAgICBjdHguZm9udCA9IFwiMTJweCAnTWVubG8nLCdCaXRzdHJlYW0gVmVyYSBTYW5zIE1vbm8nLCdDb25zb2xhcycsJ0x1Y2lkYSBDb25zb2xlJyxtb25vc3BhY2VcIjtcbiAgICAgIGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJztcbiAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAnYmFzZWxpbmUnO1xuICAgICAgXy5lYWNoKGRyYXdTcGVjLm1pc21hdGNoZXMsIGZ1bmN0aW9uKG1pc21hdGNoKSB7XG4gICAgICAgIHNlbGYudHlwZSgnYmFtJykuZHJhd01pc21hdGNoLmNhbGwoc2VsZiwgY3R4LCBtaXNtYXRjaCwgbGluZU9mZnNldCwgbGluZUhlaWdodCwgMSAvIGRyYXdTcGVjLmJwcHApO1xuICAgICAgfSk7XG4gICAgfVxuXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbihjYW52YXMsIHN0YXJ0LCBlbmQsIGRlbnNpdHksIGNhbGxiYWNrKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHNlbGYucHJlcmVuZGVyKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHt3aWR0aDogY2FudmFzLndpZHRofSwgZnVuY3Rpb24oZHJhd1NwZWMpIHtcbiAgICAgIHZhciBjYWxsYmFja0tleSA9IHN0YXJ0ICsgJy0nICsgZW5kICsgJy0nICsgZGVuc2l0eTtcbiAgICAgIHNlbGYudHlwZSgnYmFtJykuZHJhd1NwZWMuY2FsbChzZWxmLCBjYW52YXMsIGRyYXdTcGVjLCBkZW5zaXR5KTtcbiAgICAgIFxuICAgICAgLy8gSGF2ZSB3ZSBiZWVuIHdhaXRpbmcgdG8gZHJhdyBzZXF1ZW5jZSBkYXRhIHRvbz8gSWYgc28sIGRvIHRoYXQgbm93LCB0b28uXG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKHNlbGYucmVuZGVyU2VxdWVuY2VDYWxsYmFja3NbY2FsbGJhY2tLZXldKSkge1xuICAgICAgICBzZWxmLnJlbmRlclNlcXVlbmNlQ2FsbGJhY2tzW2NhbGxiYWNrS2V5XSgpO1xuICAgICAgICBkZWxldGUgc2VsZi5yZW5kZXJTZXF1ZW5jZUNhbGxiYWNrc1tjYWxsYmFja0tleV07XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChfLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7IGNhbGxiYWNrKCk7IH1cbiAgICB9KTtcbiAgfSxcbiAgXG4gIHJlbmRlclNlcXVlbmNlOiBmdW5jdGlvbihjYW52YXMsIHN0YXJ0LCBlbmQsIGRlbnNpdHksIHNlcXVlbmNlLCBjYWxsYmFjaykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBcbiAgICAvLyBJZiB3ZSB3ZXJlbid0IGFibGUgdG8gZmV0Y2ggc2VxdWVuY2UgZm9yIHNvbWUgcmVhc29uLCB0aGVyZSBpcyBubyByZWFzb24gdG8gcHJvY2VlZC5cbiAgICBpZiAoIXNlcXVlbmNlKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgZnVuY3Rpb24gcmVuZGVyU2VxdWVuY2VDYWxsYmFjaygpIHtcbiAgICAgIHNlbGYucHJlcmVuZGVyKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHt3aWR0aDogY2FudmFzLndpZHRoLCBzZXF1ZW5jZTogc2VxdWVuY2V9LCBmdW5jdGlvbihkcmF3U3BlYykge1xuICAgICAgICBzZWxmLnR5cGUoJ2JhbScpLmRyYXdTcGVjLmNhbGwoc2VsZiwgY2FudmFzLCBkcmF3U3BlYywgZGVuc2l0eSk7XG4gICAgICAgIGlmIChfLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7IGNhbGxiYWNrKCk7IH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiB0aGUgY2FudmFzIHdhcyBhbHJlYWR5IHJlbmRlcmVkIChieSBsYWNrIG9mIHRoZSBjbGFzcyAndW5yZW5kZXJlZCcpLlxuICAgIC8vIElmIHllcywgZ28gYWhlYWQgYW5kIGV4ZWN1dGUgcmVuZGVyU2VxdWVuY2VDYWxsYmFjaygpOyBpZiBub3QsIHNhdmUgaXQgZm9yIGxhdGVyLlxuICAgIGlmICgoJyAnICsgY2FudmFzLmNsYXNzTmFtZSArICcgJykuaW5kZXhPZignIHVucmVuZGVyZWQgJykgPiAtMSkge1xuICAgICAgc2VsZi5yZW5kZXJTZXF1ZW5jZUNhbGxiYWNrc1tzdGFydCArICctJyArIGVuZCArICctJyArIGRlbnNpdHldID0gcmVuZGVyU2VxdWVuY2VDYWxsYmFjaztcbiAgICB9IGVsc2Uge1xuICAgICAgcmVuZGVyU2VxdWVuY2VDYWxsYmFjaygpO1xuICAgIH1cbiAgfSxcbiAgXG4gIGxvYWRPcHRzOiBmdW5jdGlvbigkZGlhbG9nKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdHM7XG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT12aWV3QXNQYWlyc10nKS5hdHRyKCdjaGVja2VkJywgISFvLnZpZXdBc1BhaXJzKTtcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPWNvbnZlcnRDaHJTY2hlbWVdJykudmFsKG8uY29udmVydENoclNjaGVtZSkuY2hhbmdlKCk7XG4gIH0sXG5cbiAgc2F2ZU9wdHM6IGZ1bmN0aW9uKCRkaWFsb2cpIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0cztcbiAgICBvLnZpZXdBc1BhaXJzID0gJGRpYWxvZy5maW5kKCdbbmFtZT12aWV3QXNQYWlyc10nKS5pcygnOmNoZWNrZWQnKTtcbiAgICBvLmNvbnZlcnRDaHJTY2hlbWUgPSAkZGlhbG9nLmZpbmQoJ1tuYW1lPWNvbnZlcnRDaHJTY2hlbWVdJykudmFsKCk7XG4gICAgXG4gICAgLy8gSWYgby52aWV3QXNQYWlycyB3YXMgY2hhbmdlZCwgd2UgKm5lZWQqIHRvIGJsb3cgYXdheSB0aGUgZ2Vub2Jyb3dzZXIncyBhcmVhSW5kZXggXG4gICAgLy8gYW5kIG91ciBsb2NhbGx5IGNhY2hlZCBhcmVhcywgYXMgYWxsIHRoZSBhcmVhcyB3aWxsIGNoYW5nZS5cbiAgICBpZiAoby52aWV3QXNQYWlycyAhPSB0aGlzLnByZXZPcHRzLnZpZXdBc1BhaXJzKSB7XG4gICAgICB0aGlzLmFyZWFzID0ge307XG4gICAgICBkZWxldGUgJGRpYWxvZy5kYXRhKCdnZW5vYnJvd3NlcicpLmdlbm9icm93c2VyKCdhcmVhSW5kZXgnKVskZGlhbG9nLmRhdGEoJ3RyYWNrJykubl07XG4gICAgfVxuICB9XG4gIFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCYW1Gb3JtYXQ7IiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gQkVEIGZvcm1hdDogaHR0cDovL2dlbm9tZS51Y3NjLmVkdS9GQVEvRkFRZm9ybWF0Lmh0bWwjZm9ybWF0MSA9XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy9cbi8vIGJlZERldGFpbCBpcyBhIHRyaXZpYWwgZXh0ZW5zaW9uIG9mIEJFRCB0aGF0IGlzIGRlZmluZWQgc2VwYXJhdGVseSxcbi8vIGFsdGhvdWdoIGEgQkVEIGZpbGUgd2l0aCA+MTIgY29sdW1ucyBpcyBhc3N1bWVkIHRvIGJlIGJlZERldGFpbCB0cmFjayByZWdhcmRsZXNzIG9mIHR5cGUuXG5cbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMvdXRpbHMuanMnKSxcbiAgZmxvb3JIYWNrID0gdXRpbHMuZmxvb3JIYWNrLFxuICBwYXJzZUludDEwID0gdXRpbHMucGFyc2VJbnQxMDtcbnZhciBJbnRlcnZhbFRyZWUgPSByZXF1aXJlKCcuL3V0aWxzL0ludGVydmFsVHJlZS5qcycpLkludGVydmFsVHJlZTtcbnZhciBMaW5lTWFzayA9IHJlcXVpcmUoJy4vdXRpbHMvTGluZU1hc2suanMnKS5MaW5lTWFzaztcblxuLy8gSW50ZW5kZWQgdG8gYmUgbG9hZGVkIGludG8gQ3VzdG9tVHJhY2sudHlwZXMuYmVkXG52YXIgQmVkRm9ybWF0ID0ge1xuICBkZWZhdWx0czoge1xuICAgIGl0ZW1SZ2I6ICdvZmYnLFxuICAgIGNvbG9yQnlTdHJhbmQ6ICcnLFxuICAgIHVzZVNjb3JlOiAwLFxuICAgIGdyb3VwOiAndXNlcicsXG4gICAgcHJpb3JpdHk6ICd1c2VyJyxcbiAgICBvZmZzZXQ6IDAsXG4gICAgZGV0YWlsOiBmYWxzZSxcbiAgICB1cmw6ICcnLFxuICAgIGh0bWxVcmw6ICcnLFxuICAgIGRyYXdMaW1pdDoge3NxdWlzaDogbnVsbCwgcGFjazogbnVsbH1cbiAgfSxcbiAgXG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudHlwZSgpLmluaXRPcHRzLmNhbGwodGhpcyk7XG4gIH0sXG4gIFxuICBpbml0T3B0czogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgYWx0Q29sb3JzID0gc2VsZi5vcHRzLmNvbG9yQnlTdHJhbmQuc3BsaXQoL1xccysvKSxcbiAgICAgIHZhbGlkQ29sb3JCeVN0cmFuZCA9IGFsdENvbG9ycy5sZW5ndGggPiAxICYmIF8uYWxsKGFsdENvbG9ycywgc2VsZi52YWxpZGF0ZUNvbG9yKTtcbiAgICBzZWxmLm9wdHMudXNlU2NvcmUgPSBzZWxmLmlzT24oc2VsZi5vcHRzLnVzZVNjb3JlKTtcbiAgICBzZWxmLm9wdHMuaXRlbVJnYiA9IHNlbGYuaXNPbihzZWxmLm9wdHMuaXRlbVJnYik7XG4gICAgaWYgKCF2YWxpZENvbG9yQnlTdHJhbmQpIHsgc2VsZi5vcHRzLmNvbG9yQnlTdHJhbmQgPSAnJzsgc2VsZi5vcHRzLmFsdENvbG9yID0gbnVsbDsgfVxuICAgIGVsc2UgeyBzZWxmLm9wdHMuYWx0Q29sb3IgPSBhbHRDb2xvcnNbMV07IH1cbiAgfSxcblxuICBwYXJzZUxpbmU6IGZ1bmN0aW9uKGxpbmUsIGxpbmVubykge1xuICAgIHZhciBjb2xzID0gWydjaHJvbScsICdjaHJvbVN0YXJ0JywgJ2Nocm9tRW5kJywgJ25hbWUnLCAnc2NvcmUnLCAnc3RyYW5kJywgJ3RoaWNrU3RhcnQnLCAndGhpY2tFbmQnLCAnaXRlbVJnYicsXG4gICAgICAnYmxvY2tDb3VudCcsICdibG9ja1NpemVzJywgJ2Jsb2NrU3RhcnRzJywgJ2lkJywgJ2Rlc2NyaXB0aW9uJ10sXG4gICAgICBmZWF0dXJlID0ge30sXG4gICAgICBmaWVsZHMgPSAvXFx0Ly50ZXN0KGxpbmUpID8gbGluZS5zcGxpdChcIlxcdFwiKSA6IGxpbmUuc3BsaXQoL1xccysvKSxcbiAgICAgIGNoclBvcywgYmxvY2tTaXplcztcbiAgICBcbiAgICBpZiAodGhpcy5vcHRzLmRldGFpbCkge1xuICAgICAgY29sc1tmaWVsZHMubGVuZ3RoIC0gMl0gPSAnaWQnO1xuICAgICAgY29sc1tmaWVsZHMubGVuZ3RoIC0gMV0gPSAnZGVzY3JpcHRpb24nO1xuICAgIH1cbiAgICBfLmVhY2goZmllbGRzLCBmdW5jdGlvbih2LCBpKSB7IGZlYXR1cmVbY29sc1tpXV0gPSB2OyB9KTtcbiAgICBjaHJQb3MgPSB0aGlzLmJyb3dzZXJPcHRzLmNoclBvc1tmZWF0dXJlLmNocm9tXTtcbiAgICBsaW5lbm8gPSBsaW5lbm8gfHwgMDtcbiAgICBcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChjaHJQb3MpKSB7IFxuICAgICAgdGhpcy53YXJuKFwiSW52YWxpZCBjaHJvbW9zb21lICdcIitmZWF0dXJlLmNocm9tK1wiJyBhdCBsaW5lIFwiICsgKGxpbmVubyArIDEgKyB0aGlzLm9wdHMubGluZU51bSkpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZlYXR1cmUuc2NvcmUgPSBfLmlzVW5kZWZpbmVkKGZlYXR1cmUuc2NvcmUpID8gJz8nIDogZmVhdHVyZS5zY29yZTtcbiAgICAgIGZlYXR1cmUuc3RhcnQgPSBjaHJQb3MgKyBwYXJzZUludDEwKGZlYXR1cmUuY2hyb21TdGFydCkgKyAxO1xuICAgICAgZmVhdHVyZS5lbmQgPSBjaHJQb3MgKyBwYXJzZUludDEwKGZlYXR1cmUuY2hyb21FbmQpICsgMTtcbiAgICAgIGZlYXR1cmUuYmxvY2tzID0gbnVsbDtcbiAgICAgIC8vIGZhbmNpZXIgQkVEIGZlYXR1cmVzIHRvIGV4cHJlc3MgY29kaW5nIHJlZ2lvbnMgYW5kIGV4b25zL2ludHJvbnNcbiAgICAgIGlmICgvXlxcZCskLy50ZXN0KGZlYXR1cmUudGhpY2tTdGFydCkgJiYgL15cXGQrJC8udGVzdChmZWF0dXJlLnRoaWNrRW5kKSkge1xuICAgICAgICBmZWF0dXJlLnRoaWNrU3RhcnQgPSBjaHJQb3MgKyBwYXJzZUludDEwKGZlYXR1cmUudGhpY2tTdGFydCkgKyAxO1xuICAgICAgICBmZWF0dXJlLnRoaWNrRW5kID0gY2hyUG9zICsgcGFyc2VJbnQxMChmZWF0dXJlLnRoaWNrRW5kKSArIDE7XG4gICAgICAgIGlmICgvXlxcZCsoLFxcZCopKiQvLnRlc3QoZmVhdHVyZS5ibG9ja1NpemVzKSAmJiAvXlxcZCsoLFxcZCopKiQvLnRlc3QoZmVhdHVyZS5ibG9ja1N0YXJ0cykpIHtcbiAgICAgICAgICBmZWF0dXJlLmJsb2NrcyA9IFtdO1xuICAgICAgICAgIGJsb2NrU2l6ZXMgPSBmZWF0dXJlLmJsb2NrU2l6ZXMuc3BsaXQoLywvKTtcbiAgICAgICAgICBfLmVhY2goZmVhdHVyZS5ibG9ja1N0YXJ0cy5zcGxpdCgvLC8pLCBmdW5jdGlvbihzdGFydCwgaSkge1xuICAgICAgICAgICAgaWYgKHN0YXJ0ID09PSAnJykgeyByZXR1cm47IH1cbiAgICAgICAgICAgIHZhciBibG9jayA9IHtzdGFydDogZmVhdHVyZS5zdGFydCArIHBhcnNlSW50MTAoc3RhcnQpfTtcbiAgICAgICAgICAgIGJsb2NrLmVuZCA9IGJsb2NrLnN0YXJ0ICsgcGFyc2VJbnQxMChibG9ja1NpemVzW2ldKTtcbiAgICAgICAgICAgIGZlYXR1cmUuYmxvY2tzLnB1c2goYmxvY2spO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmZWF0dXJlLnRoaWNrU3RhcnQgPSBmZWF0dXJlLnRoaWNrRW5kID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZlYXR1cmU7XG4gIH0sXG5cbiAgcGFyc2U6IGZ1bmN0aW9uKGxpbmVzKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgbWlkZGxlaXNoUG9zID0gc2VsZi5icm93c2VyT3B0cy5nZW5vbWVTaXplIC8gMixcbiAgICAgIGRhdGEgPSBuZXcgSW50ZXJ2YWxUcmVlKGZsb29ySGFjayhtaWRkbGVpc2hQb3MpLCB7c3RhcnRLZXk6ICdzdGFydCcsIGVuZEtleTogJ2VuZCd9KTtcbiAgICBfLmVhY2gobGluZXMsIGZ1bmN0aW9uKGxpbmUsIGxpbmVubykge1xuICAgICAgdmFyIGZlYXR1cmUgPSBzZWxmLnR5cGUoKS5wYXJzZUxpbmUuY2FsbChzZWxmLCBsaW5lLCBsaW5lbm8pO1xuICAgICAgaWYgKGZlYXR1cmUpIHsgZGF0YS5hZGQoZmVhdHVyZSk7IH1cbiAgICB9KTtcbiAgICBzZWxmLmRhdGEgPSBkYXRhO1xuICAgIHNlbGYuaGVpZ2h0cyA9IHttYXg6IG51bGwsIG1pbjogMTUsIHN0YXJ0OiAxNX07XG4gICAgc2VsZi5zaXplcyA9IFsnZGVuc2UnLCAnc3F1aXNoJywgJ3BhY2snXTtcbiAgICBzZWxmLm1hcFNpemVzID0gWydwYWNrJ107XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG4gIFxuICBzdGFja2VkTGF5b3V0OiBmdW5jdGlvbihpbnRlcnZhbHMsIHdpZHRoLCBjYWxjUGl4SW50ZXJ2YWwsIGxpbmVOdW0pIHtcbiAgICAvLyBBIGxpbmVOdW0gZnVuY3Rpb24gY2FuIGJlIHByb3ZpZGVkIHdoaWNoIGNhbiBzZXQvcmV0cmlldmUgdGhlIGxpbmUgb2YgYWxyZWFkeSByZW5kZXJlZCBkYXRhcG9pbnRzXG4gICAgLy8gc28gYXMgdG8gbm90IGJyZWFrIGEgcmFuZ2VkIGZlYXR1cmUgdGhhdCBleHRlbmRzIG92ZXIgbXVsdGlwbGUgdGlsZXMuXG4gICAgbGluZU51bSA9IF8uaXNGdW5jdGlvbihsaW5lTnVtKSA/IGxpbmVOdW0gOiBmdW5jdGlvbigpIHsgcmV0dXJuOyB9O1xuICAgIHZhciBsaW5lcyA9IFtdLFxuICAgICAgbWF4RXhpc3RpbmdMaW5lID0gXy5tYXgoXy5tYXAoaW50ZXJ2YWxzLCBmdW5jdGlvbih2KSB7IHJldHVybiBsaW5lTnVtKHYuZGF0YSkgfHwgMDsgfSkpICsgMSxcbiAgICAgIHNvcnRlZEludGVydmFscyA9IF8uc29ydEJ5KGludGVydmFscywgZnVuY3Rpb24odikgeyB2YXIgbG4gPSBsaW5lTnVtKHYuZGF0YSk7IHJldHVybiBfLmlzVW5kZWZpbmVkKGxuKSA/IDEgOiAtbG47IH0pO1xuICAgIFxuICAgIHdoaWxlIChtYXhFeGlzdGluZ0xpbmUtLT4wKSB7IGxpbmVzLnB1c2gobmV3IExpbmVNYXNrKHdpZHRoLCA1KSk7IH1cbiAgICBfLmVhY2goc29ydGVkSW50ZXJ2YWxzLCBmdW5jdGlvbih2KSB7XG4gICAgICB2YXIgZCA9IHYuZGF0YSxcbiAgICAgICAgbG4gPSBsaW5lTnVtKGQpLFxuICAgICAgICBwSW50ID0gY2FsY1BpeEludGVydmFsKGQpLFxuICAgICAgICB0aGlja0ludCA9IGQudGhpY2tTdGFydCAhPT0gbnVsbCAmJiBjYWxjUGl4SW50ZXJ2YWwoe3N0YXJ0OiBkLnRoaWNrU3RhcnQsIGVuZDogZC50aGlja0VuZH0pLFxuICAgICAgICBibG9ja0ludHMgPSBkLmJsb2NrcyAhPT0gbnVsbCAmJiAgXy5tYXAoZC5ibG9ja3MsIGNhbGNQaXhJbnRlcnZhbCksXG4gICAgICAgIGkgPSAwLFxuICAgICAgICBsID0gbGluZXMubGVuZ3RoO1xuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKGxuKSkge1xuICAgICAgICBpZiAobGluZXNbbG5dLmNvbmZsaWN0KHBJbnQudHgsIHBJbnQudHcpKSB7IGNvbnNvbGUubG9nKFwiVW5yZXNvbHZhYmxlIExpbmVNYXNrIGNvbmZsaWN0IVwiKTsgfVxuICAgICAgICBsaW5lc1tsbl0uYWRkKHBJbnQudHgsIHBJbnQudHcsIHtwSW50OiBwSW50LCB0aGlja0ludDogdGhpY2tJbnQsIGJsb2NrSW50czogYmxvY2tJbnRzLCBkOiBkfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3aGlsZSAoaSA8IGwgJiYgbGluZXNbaV0uY29uZmxpY3QocEludC50eCwgcEludC50dykpIHsgKytpOyB9XG4gICAgICAgIGlmIChpID09IGwpIHsgbGluZXMucHVzaChuZXcgTGluZU1hc2sod2lkdGgsIDUpKTsgfVxuICAgICAgICBsaW5lTnVtKGQsIGkpO1xuICAgICAgICBsaW5lc1tpXS5hZGQocEludC50eCwgcEludC50dywge3BJbnQ6IHBJbnQsIHRoaWNrSW50OiB0aGlja0ludCwgYmxvY2tJbnRzOiBibG9ja0ludHMsIGQ6IGR9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gXy5tYXAobGluZXMsIGZ1bmN0aW9uKGwpIHsgcmV0dXJuIF8ucGx1Y2sobC5pdGVtcywgJ2RhdGEnKTsgfSk7XG4gIH0sXG4gIFxuICBwcmVyZW5kZXI6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHByZWNhbGMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHdpZHRoID0gcHJlY2FsYy53aWR0aCxcbiAgICAgIGJwcHAgPSAoZW5kIC0gc3RhcnQpIC8gd2lkdGgsXG4gICAgICBpbnRlcnZhbHMgPSB0aGlzLmRhdGEuc2VhcmNoKHN0YXJ0LCBlbmQpLFxuICAgICAgZHJhd1NwZWMgPSBbXSxcbiAgICAgIGNhbGNQaXhJbnRlcnZhbCA9IG5ldyB1dGlscy5waXhJbnRlcnZhbENhbGN1bGF0b3Ioc3RhcnQsIHdpZHRoLCBicHBwLCBkZW5zaXR5PT0ncGFjaycpO1xuICAgIFxuICAgIGZ1bmN0aW9uIGxpbmVOdW0oZCwgc2V0KSB7XG4gICAgICB2YXIga2V5ID0gYnBwcCArICdfJyArIGRlbnNpdHk7XG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc2V0KSkgeyBcbiAgICAgICAgaWYgKCFkLmxpbmUpIHsgZC5saW5lID0ge307IH1cbiAgICAgICAgcmV0dXJuIChkLmxpbmVba2V5XSA9IHNldCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZC5saW5lICYmIGQubGluZVtrZXldOyBcbiAgICB9XG4gICAgXG4gICAgaWYgKGRlbnNpdHkgPT0gJ2RlbnNlJykge1xuICAgICAgXy5lYWNoKGludGVydmFscywgZnVuY3Rpb24odikge1xuICAgICAgICB2YXIgcEludCA9IGNhbGNQaXhJbnRlcnZhbCh2LmRhdGEpO1xuICAgICAgICBwSW50LnYgPSB2LmRhdGEuc2NvcmU7XG4gICAgICAgIGRyYXdTcGVjLnB1c2gocEludCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgZHJhd1NwZWMgPSB7bGF5b3V0OiB0aGlzLnR5cGUoJ2JlZCcpLnN0YWNrZWRMYXlvdXQuY2FsbCh0aGlzLCBpbnRlcnZhbHMsIHdpZHRoLCBjYWxjUGl4SW50ZXJ2YWwsIGxpbmVOdW0pfTtcbiAgICAgIGRyYXdTcGVjLndpZHRoID0gd2lkdGg7XG4gICAgfVxuICAgIHJldHVybiBfLmlzRnVuY3Rpb24oY2FsbGJhY2spID8gY2FsbGJhY2soZHJhd1NwZWMpIDogZHJhd1NwZWM7XG4gIH0sXG4gIFxuICBhZGRBcmVhOiBmdW5jdGlvbihhcmVhcywgZGF0YSwgaSwgbGluZUhlaWdodCwgdXJsVGVtcGxhdGUpIHtcbiAgICB2YXIgdGlwVGlwRGF0YSA9IHt9LFxuICAgICAgdGlwVGlwRGF0YUNhbGxiYWNrID0gdGhpcy50eXBlKCkudGlwVGlwRGF0YTtcbiAgICBpZiAoIWFyZWFzKSB7IHJldHVybjsgfVxuICAgIGlmIChfLmlzRnVuY3Rpb24odGlwVGlwRGF0YUNhbGxiYWNrKSkge1xuICAgICAgdGlwVGlwRGF0YSA9IHRpcFRpcERhdGFDYWxsYmFjay5jYWxsKHRoaXMsIGRhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQoZGF0YS5kLmRlc2NyaXB0aW9uKSkgeyB0aXBUaXBEYXRhLmRlc2NyaXB0aW9uID0gZGF0YS5kLmRlc2NyaXB0aW9uOyB9XG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQoZGF0YS5kLnNjb3JlKSkgeyB0aXBUaXBEYXRhLnNjb3JlID0gZGF0YS5kLnNjb3JlOyB9XG4gICAgICBfLmV4dGVuZCh0aXBUaXBEYXRhLCB7XG4gICAgICAgIHBvc2l0aW9uOiBkYXRhLmQuY2hyb20gKyAnOicgKyBkYXRhLmQuY2hyb21TdGFydCwgXG4gICAgICAgIHNpemU6IGRhdGEuZC5jaHJvbUVuZCAtIGRhdGEuZC5jaHJvbVN0YXJ0XG4gICAgICB9KTtcbiAgICAgIC8vIERpc3BsYXkgdGhlIElEIGNvbHVtbiAoZnJvbSBiZWREZXRhaWwpLCB1bmxlc3MgaXQgY29udGFpbnMgYSB0YWIgY2hhcmFjdGVyLCB3aGljaCBtZWFucyBpdCB3YXMgYXV0b2dlbmVyYXRlZFxuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKGRhdGEuZC5pZCkgJiYgISgvXFx0LykudGVzdChkYXRhLmQuaWQpKSB7IHRpcFRpcERhdGEuaWQgPSBkYXRhLmQuaWQ7IH1cbiAgICB9XG4gICAgYXJlYXMucHVzaChbXG4gICAgICBkYXRhLnBJbnQueCwgaSAqIGxpbmVIZWlnaHQgKyAxLCBkYXRhLnBJbnQueCArIGRhdGEucEludC53LCAoaSArIDEpICogbGluZUhlaWdodCwgLy8geDEsIHgyLCB5MSwgeTJcbiAgICAgIGRhdGEuZC5uYW1lIHx8IGRhdGEuZC5pZCB8fCAnJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBuYW1lXG4gICAgICB1cmxUZW1wbGF0ZS5yZXBsYWNlKCckJCcsIF8uaXNVbmRlZmluZWQoZGF0YS5kLmlkKSA/IGRhdGEuZC5uYW1lIDogZGF0YS5kLmlkKSwgICAgLy8gaHJlZlxuICAgICAgZGF0YS5wSW50Lm9QcmV2LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnRpbnVhdGlvbiBmcm9tIHByZXZpb3VzIHRpbGU/XG4gICAgICBudWxsLFxuICAgICAgbnVsbCxcbiAgICAgIHRpcFRpcERhdGFcbiAgICBdKTtcbiAgfSxcbiAgXG4gIC8vIFNjYWxlcyBhIHNjb3JlIGZyb20gMC0xMDAwIGludG8gYW4gYWxwaGEgdmFsdWUgYmV0d2VlbiAwLjIgYW5kIDEuMFxuICBjYWxjQWxwaGE6IGZ1bmN0aW9uKHZhbHVlKSB7IHJldHVybiBNYXRoLm1heCh2YWx1ZSwgMTY2KS8xMDAwOyB9LFxuICBcbiAgLy8gU2NhbGVzIGEgc2NvcmUgZnJvbSAwLTEwMDAgaW50byBhIGNvbG9yIHNjYWxlZCBiZXR3ZWVuICNjY2NjY2MgYW5kIG1heCBDb2xvclxuICBjYWxjR3JhZGllbnQ6IGZ1bmN0aW9uKG1heENvbG9yLCB2YWx1ZSkge1xuICAgIHZhciBtaW5Db2xvciA9IFsyMzAsMjMwLDIzMF0sXG4gICAgICB2YWx1ZUNvbG9yID0gW107XG4gICAgaWYgKCFfLmlzQXJyYXkobWF4Q29sb3IpKSB7IG1heENvbG9yID0gXy5tYXAobWF4Q29sb3Iuc3BsaXQoJywnKSwgcGFyc2VJbnQxMCk7IH1cbiAgICBfLmVhY2gobWluQ29sb3IsIGZ1bmN0aW9uKHYsIGkpIHsgdmFsdWVDb2xvcltpXSA9ICh2IC0gbWF4Q29sb3JbaV0pICogKCgxMDAwIC0gdmFsdWUpIC8gMTAwMC4wKSArIG1heENvbG9yW2ldOyB9KTtcbiAgICByZXR1cm4gXy5tYXAodmFsdWVDb2xvciwgcGFyc2VJbnQxMCkuam9pbignLCcpO1xuICB9LFxuICBcbiAgZHJhd0Fycm93czogZnVuY3Rpb24oY3R4LCBjYW52YXNXaWR0aCwgbGluZVksIGhhbGZIZWlnaHQsIHN0YXJ0WCwgZW5kWCwgZGlyZWN0aW9uKSB7XG4gICAgdmFyIGFycm93SGVpZ2h0ID0gTWF0aC5taW4oaGFsZkhlaWdodCwgMyksXG4gICAgICBYMSwgWDI7XG4gICAgc3RhcnRYID0gTWF0aC5tYXgoc3RhcnRYLCAwKTtcbiAgICBlbmRYID0gTWF0aC5taW4oZW5kWCwgY2FudmFzV2lkdGgpO1xuICAgIGlmIChlbmRYIC0gc3RhcnRYIDwgNSkgeyByZXR1cm47IH0gLy8gY2FuJ3QgZHJhdyBhcnJvd3MgaW4gdGhhdCBuYXJyb3cgb2YgYSBzcGFjZVxuICAgIGlmIChkaXJlY3Rpb24gIT09ICcrJyAmJiBkaXJlY3Rpb24gIT09ICctJykgeyByZXR1cm47IH0gLy8gaW52YWxpZCBkaXJlY3Rpb25cbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgLy8gQWxsIHRoZSAwLjUncyBoZXJlIGFyZSBkdWUgdG8gPGNhbnZhcz4ncyBzb21ld2hhdCBzaWxseSBjb29yZGluYXRlIHN5c3RlbSBcbiAgICAvLyBodHRwOi8vZGl2ZWludG9odG1sNS5pbmZvL2NhbnZhcy5odG1sI3BpeGVsLW1hZG5lc3NcbiAgICBYMSA9IGRpcmVjdGlvbiA9PSAnKycgPyAwLjUgOiBhcnJvd0hlaWdodCArIDAuNTtcbiAgICBYMiA9IGRpcmVjdGlvbiA9PSAnKycgPyBhcnJvd0hlaWdodCArIDAuNSA6IDAuNTtcbiAgICBmb3IgKHZhciBpID0gTWF0aC5mbG9vcihzdGFydFgpICsgMjsgaSA8IGVuZFggLSBhcnJvd0hlaWdodDsgaSArPSA3KSB7XG4gICAgICBjdHgubW92ZVRvKGkgKyBYMSwgbGluZVkgKyBoYWxmSGVpZ2h0IC0gYXJyb3dIZWlnaHQgKyAwLjUpO1xuICAgICAgY3R4LmxpbmVUbyhpICsgWDIsIGxpbmVZICsgaGFsZkhlaWdodCArIDAuNSk7XG4gICAgICBjdHgubGluZVRvKGkgKyBYMSwgbGluZVkgKyBoYWxmSGVpZ2h0ICsgYXJyb3dIZWlnaHQgKyAwLjUpO1xuICAgIH1cbiAgICBjdHguc3Ryb2tlKCk7XG4gIH0sXG4gIFxuICBkcmF3RmVhdHVyZTogZnVuY3Rpb24oY3R4LCB3aWR0aCwgZGF0YSwgaSwgbGluZUhlaWdodCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIGNvbG9yID0gc2VsZi5vcHRzLmNvbG9yLFxuICAgICAgeSA9IGkgKiBsaW5lSGVpZ2h0LFxuICAgICAgaGFsZkhlaWdodCA9IE1hdGgucm91bmQoMC41ICogKGxpbmVIZWlnaHQgLSAxKSksXG4gICAgICBxdWFydGVySGVpZ2h0ID0gTWF0aC5jZWlsKDAuMjUgKiAobGluZUhlaWdodCAtIDEpKSxcbiAgICAgIGxpbmVHYXAgPSBsaW5lSGVpZ2h0ID4gNiA/IDIgOiAxLFxuICAgICAgdGhpY2tPdmVybGFwID0gbnVsbCxcbiAgICAgIHByZXZCSW50ID0gbnVsbDtcbiAgICBcbiAgICAvLyBGaXJzdCwgZGV0ZXJtaW5lIGFuZCBzZXQgdGhlIGNvbG9yIHdlIHdpbGwgYmUgdXNpbmdcbiAgICAvLyBOb3RlIHRoYXQgdGhlIGRlZmF1bHQgY29sb3Igd2FzIGFscmVhZHkgc2V0IGluIGRyYXdTcGVjXG4gICAgaWYgKHNlbGYub3B0cy5hbHRDb2xvciAmJiBkYXRhLmQuc3RyYW5kID09ICctJykgeyBjb2xvciA9IHNlbGYub3B0cy5hbHRDb2xvcjsgfVxuICAgIFxuICAgIGlmIChzZWxmLm9wdHMuaXRlbVJnYiAmJiBkYXRhLmQuaXRlbVJnYiAmJiB0aGlzLnZhbGlkYXRlQ29sb3IoZGF0YS5kLml0ZW1SZ2IpKSB7IGNvbG9yID0gZGF0YS5kLml0ZW1SZ2I7IH1cbiAgICBcbiAgICBpZiAoc2VsZi5vcHRzLnVzZVNjb3JlKSB7IGNvbG9yID0gc2VsZi50eXBlKCdiZWQnKS5jYWxjR3JhZGllbnQoY29sb3IsIGRhdGEuZC5zY29yZSk7IH1cbiAgICBcbiAgICBpZiAoc2VsZi5vcHRzLml0ZW1SZ2IgfHwgc2VsZi5vcHRzLmFsdENvbG9yIHx8IHNlbGYub3B0cy51c2VTY29yZSkgeyBjdHguZmlsbFN0eWxlID0gY3R4LnN0cm9rZVN0eWxlID0gXCJyZ2IoXCIgKyBjb2xvciArIFwiKVwiOyB9XG4gICAgXG4gICAgaWYgKGRhdGEudGhpY2tJbnQpIHtcbiAgICAgIC8vIFRoZSBjb2RpbmcgcmVnaW9uIGlzIGRyYXduIGFzIGEgdGhpY2tlciBsaW5lIHdpdGhpbiB0aGUgZ2VuZVxuICAgICAgaWYgKGRhdGEuYmxvY2tJbnRzKSB7XG4gICAgICAgIC8vIElmIHRoZXJlIGFyZSBleG9ucyBhbmQgaW50cm9ucywgZHJhdyB0aGUgaW50cm9ucyB3aXRoIGEgMXB4IGxpbmVcbiAgICAgICAgcHJldkJJbnQgPSBudWxsO1xuICAgICAgICBjdHguZmlsbFJlY3QoZGF0YS5wSW50LngsIHkgKyBoYWxmSGVpZ2h0LCBkYXRhLnBJbnQudywgMSk7XG4gICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IGNvbG9yO1xuICAgICAgICBfLmVhY2goZGF0YS5ibG9ja0ludHMsIGZ1bmN0aW9uKGJJbnQpIHtcbiAgICAgICAgICBpZiAoYkludC54ICsgYkludC53IDw9IHdpZHRoICYmIGJJbnQueCA+PSAwKSB7XG4gICAgICAgICAgICBjdHguZmlsbFJlY3QoYkludC54LCB5ICsgaGFsZkhlaWdodCAtIHF1YXJ0ZXJIZWlnaHQgKyAxLCBiSW50LncsIHF1YXJ0ZXJIZWlnaHQgKiAyIC0gMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaWNrT3ZlcmxhcCA9IHV0aWxzLnBpeEludGVydmFsT3ZlcmxhcChiSW50LCBkYXRhLnRoaWNrSW50KTtcbiAgICAgICAgICBpZiAodGhpY2tPdmVybGFwKSB7XG4gICAgICAgICAgICBjdHguZmlsbFJlY3QodGhpY2tPdmVybGFwLngsIHkgKyAxLCB0aGlja092ZXJsYXAudywgbGluZUhlaWdodCAtIGxpbmVHYXApO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBJZiB0aGVyZSBhcmUgaW50cm9ucywgYXJyb3dzIGFyZSBkcmF3biBvbiB0aGUgaW50cm9ucywgbm90IHRoZSBleG9ucy4uLlxuICAgICAgICAgIGlmIChkYXRhLmQuc3RyYW5kICYmIHByZXZCSW50KSB7XG4gICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBcInJnYihcIiArIGNvbG9yICsgXCIpXCI7XG4gICAgICAgICAgICBzZWxmLnR5cGUoJ2JlZCcpLmRyYXdBcnJvd3MoY3R4LCB3aWR0aCwgeSwgaGFsZkhlaWdodCwgcHJldkJJbnQueCArIHByZXZCSW50LncsIGJJbnQueCwgZGF0YS5kLnN0cmFuZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHByZXZCSW50ID0gYkludDtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIC4uLnVubGVzcyB0aGVyZSB3ZXJlIG5vIGludHJvbnMuIFRoZW4gaXQgaXMgZHJhd24gb24gdGhlIGNvZGluZyByZWdpb24uXG4gICAgICAgIGlmIChkYXRhLmJsb2NrSW50cy5sZW5ndGggPT0gMSkge1xuICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IFwid2hpdGVcIjtcbiAgICAgICAgICBzZWxmLnR5cGUoJ2JlZCcpLmRyYXdBcnJvd3MoY3R4LCB3aWR0aCwgeSwgaGFsZkhlaWdodCwgZGF0YS50aGlja0ludC54LCBkYXRhLnRoaWNrSW50LnggKyBkYXRhLnRoaWNrSW50LncsIGRhdGEuZC5zdHJhbmQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBXZSBoYXZlIGEgY29kaW5nIHJlZ2lvbiBidXQgbm8gaW50cm9ucy9leG9uc1xuICAgICAgICBjdHguZmlsbFJlY3QoZGF0YS5wSW50LngsIHkgKyBoYWxmSGVpZ2h0IC0gcXVhcnRlckhlaWdodCArIDEsIGRhdGEucEludC53LCBxdWFydGVySGVpZ2h0ICogMiAtIDEpO1xuICAgICAgICBjdHguZmlsbFJlY3QoZGF0YS50aGlja0ludC54LCB5ICsgMSwgZGF0YS50aGlja0ludC53LCBsaW5lSGVpZ2h0IC0gbGluZUdhcCk7XG4gICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IFwid2hpdGVcIjtcbiAgICAgICAgc2VsZi50eXBlKCdiZWQnKS5kcmF3QXJyb3dzKGN0eCwgd2lkdGgsIHksIGhhbGZIZWlnaHQsIGRhdGEudGhpY2tJbnQueCwgZGF0YS50aGlja0ludC54ICsgZGF0YS50aGlja0ludC53LCBkYXRhLmQuc3RyYW5kKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gTm90aGluZyBmYW5jeS4gIEl0J3MgYSBib3guXG4gICAgICBjdHguZmlsbFJlY3QoZGF0YS5wSW50LngsIHkgKyAxLCBkYXRhLnBJbnQudywgbGluZUhlaWdodCAtIGxpbmVHYXApO1xuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gXCJ3aGl0ZVwiO1xuICAgICAgc2VsZi50eXBlKCdiZWQnKS5kcmF3QXJyb3dzKGN0eCwgd2lkdGgsIHksIGhhbGZIZWlnaHQsIGRhdGEucEludC54LCBkYXRhLnBJbnQueCArIGRhdGEucEludC53LCBkYXRhLmQuc3RyYW5kKTtcbiAgICB9XG4gIH0sXG4gIFxuICBkcmF3U3BlYzogZnVuY3Rpb24oY2FudmFzLCBkcmF3U3BlYywgZGVuc2l0eSkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0ICYmIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLFxuICAgICAgdXJsVGVtcGxhdGUgPSBzZWxmLm9wdHMudXJsID8gc2VsZi5vcHRzLnVybCA6ICdqYXZhc2NyaXB0OnZvaWQoXCInK3NlbGYub3B0cy5uYW1lKyc6JCRcIiknLFxuICAgICAgZHJhd0xpbWl0ID0gc2VsZi5vcHRzLmRyYXdMaW1pdCAmJiBzZWxmLm9wdHMuZHJhd0xpbWl0W2RlbnNpdHldLFxuICAgICAgbGluZUhlaWdodCA9IGRlbnNpdHkgPT0gJ3BhY2snID8gMTUgOiA2LFxuICAgICAgY29sb3IgPSBzZWxmLm9wdHMuY29sb3IsXG4gICAgICBhcmVhcyA9IG51bGw7XG4gICAgXG4gICAgaWYgKCFjdHgpIHsgdGhyb3cgXCJDYW52YXMgbm90IHN1cHBvcnRlZFwiOyB9XG4gICAgLy8gVE9ETzogSSBkaXNhYmxlZCByZWdlbmVyYXRpbmcgYXJlYXMgaGVyZSwgd2hpY2ggYXNzdW1lcyB0aGF0IGxpbmVOdW0gcmVtYWlucyBzdGFibGUgYWNyb3NzIHJlLXJlbmRlcnMuIFNob3VsZCBjaGVjayBvbiB0aGlzLlxuICAgIGlmIChkZW5zaXR5ID09ICdwYWNrJyAmJiAhc2VsZi5hcmVhc1tjYW52YXMuaWRdKSB7IGFyZWFzID0gc2VsZi5hcmVhc1tjYW52YXMuaWRdID0gW107IH1cbiAgICBcbiAgICBpZiAoZGVuc2l0eSA9PSAnZGVuc2UnKSB7XG4gICAgICBjYW52YXMuaGVpZ2h0ID0gMTU7XG4gICAgICBjdHguZmlsbFN0eWxlID0gXCJyZ2IoXCIrY29sb3IrXCIpXCI7XG4gICAgICBfLmVhY2goZHJhd1NwZWMsIGZ1bmN0aW9uKHBJbnQpIHtcbiAgICAgICAgaWYgKHNlbGYub3B0cy51c2VTY29yZSkgeyBjdHguZmlsbFN0eWxlID0gXCJyZ2JhKFwiK3NlbGYudHlwZSgnYmVkJykuY2FsY0dyYWRpZW50KGNvbG9yLCBwSW50LnYpK1wiKVwiOyB9XG4gICAgICAgIGN0eC5maWxsUmVjdChwSW50LngsIDEsIHBJbnQudywgMTMpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICgoZHJhd0xpbWl0ICYmIGRyYXdTcGVjLmxheW91dCAmJiBkcmF3U3BlYy5sYXlvdXQubGVuZ3RoID4gZHJhd0xpbWl0KSB8fCBkcmF3U3BlYy50b29NYW55KSB7IFxuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gMDtcbiAgICAgICAgLy8gVGhpcyBhcHBsaWVzIHN0eWxpbmcgdGhhdCBpbmRpY2F0ZXMgdGhlcmUgd2FzIHRvbyBtdWNoIGRhdGEgdG8gbG9hZC9kcmF3IGFuZCB0aGF0IHRoZSB1c2VyIG5lZWRzIHRvIHpvb20gdG8gc2VlIG1vcmVcbiAgICAgICAgY2FudmFzLmNsYXNzTmFtZSA9IGNhbnZhcy5jbGFzc05hbWUgKyAnIHRvby1tYW55JztcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FudmFzLmhlaWdodCA9IGRyYXdTcGVjLmxheW91dC5sZW5ndGggKiBsaW5lSGVpZ2h0O1xuICAgICAgY3R4LmZpbGxTdHlsZSA9IGN0eC5zdHJva2VTdHlsZSA9IFwicmdiKFwiK2NvbG9yK1wiKVwiO1xuICAgICAgXy5lYWNoKGRyYXdTcGVjLmxheW91dCwgZnVuY3Rpb24obCwgaSkge1xuICAgICAgICBfLmVhY2gobCwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIHNlbGYudHlwZSgnYmVkJykuZHJhd0ZlYXR1cmUuY2FsbChzZWxmLCBjdHgsIGRyYXdTcGVjLndpZHRoLCBkYXRhLCBpLCBsaW5lSGVpZ2h0KTsgICAgICAgICAgICAgIFxuICAgICAgICAgIHNlbGYudHlwZSgnYmVkJykuYWRkQXJlYS5jYWxsKHNlbGYsIGFyZWFzLCBkYXRhLCBpLCBsaW5lSGVpZ2h0LCB1cmxUZW1wbGF0ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oY2FudmFzLCBzdGFydCwgZW5kLCBkZW5zaXR5LCBjYWxsYmFjaykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZWxmLnByZXJlbmRlcihzdGFydCwgZW5kLCBkZW5zaXR5LCB7d2lkdGg6IGNhbnZhcy53aWR0aH0sIGZ1bmN0aW9uKGRyYXdTcGVjKSB7XG4gICAgICBzZWxmLnR5cGUoKS5kcmF3U3BlYy5jYWxsKHNlbGYsIGNhbnZhcywgZHJhd1NwZWMsIGRlbnNpdHkpO1xuICAgICAgaWYgKF8uaXNGdW5jdGlvbihjYWxsYmFjaykpIHsgY2FsbGJhY2soKTsgfVxuICAgIH0pO1xuICB9LFxuXG4gIGxvYWRPcHRzOiBmdW5jdGlvbigkZGlhbG9nKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdHMsXG4gICAgICBjb2xvckJ5U3RyYW5kT24gPSAvXFxkKyxcXGQrLFxcZCtcXHMrXFxkKyxcXGQrLFxcZCsvLnRlc3Qoby5jb2xvckJ5U3RyYW5kKSxcbiAgICAgIGNvbG9yQnlTdHJhbmQgPSBjb2xvckJ5U3RyYW5kT24gPyBvLmNvbG9yQnlTdHJhbmQuc3BsaXQoL1xccysvKVsxXSA6ICcwLDAsMCc7XG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT1jb2xvckJ5U3RyYW5kT25dJykuYXR0cignY2hlY2tlZCcsICEhY29sb3JCeVN0cmFuZE9uKTtcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPWNvbG9yQnlTdHJhbmRdJykudmFsKGNvbG9yQnlTdHJhbmQpLmNoYW5nZSgpO1xuICAgICRkaWFsb2cuZmluZCgnW25hbWU9dXNlU2NvcmVdJykuYXR0cignY2hlY2tlZCcsIHRoaXMuaXNPbihvLnVzZVNjb3JlKSk7ICAgIFxuICAgICRkaWFsb2cuZmluZCgnW25hbWU9dXJsXScpLnZhbChvLnVybCk7XG4gIH0sXG4gIFxuICBzYXZlT3B0czogZnVuY3Rpb24oJGRpYWxvZykge1xuICAgIHZhciBvID0gdGhpcy5vcHRzLFxuICAgICAgY29sb3JCeVN0cmFuZE9uID0gJGRpYWxvZy5maW5kKCdbbmFtZT1jb2xvckJ5U3RyYW5kT25dJykuaXMoJzpjaGVja2VkJyksXG4gICAgICBjb2xvckJ5U3RyYW5kID0gJGRpYWxvZy5maW5kKCdbbmFtZT1jb2xvckJ5U3RyYW5kXScpLnZhbCgpLFxuICAgICAgdmFsaWRDb2xvckJ5U3RyYW5kID0gdGhpcy52YWxpZGF0ZUNvbG9yKGNvbG9yQnlTdHJhbmQpO1xuICAgIG8uY29sb3JCeVN0cmFuZCA9IGNvbG9yQnlTdHJhbmRPbiAmJiB2YWxpZENvbG9yQnlTdHJhbmQgPyBvLmNvbG9yICsgJyAnICsgY29sb3JCeVN0cmFuZCA6ICcnO1xuICAgIG8udXNlU2NvcmUgPSAkZGlhbG9nLmZpbmQoJ1tuYW1lPXVzZVNjb3JlXScpLmlzKCc6Y2hlY2tlZCcpID8gMSA6IDA7XG4gICAgby51cmwgPSAkZGlhbG9nLmZpbmQoJ1tuYW1lPXVybF0nKS52YWwoKTtcbiAgICB0aGlzLnR5cGUoJ2JlZCcpLmluaXRPcHRzLmNhbGwodGhpcyk7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQmVkRm9ybWF0OyIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gYmVkR3JhcGggZm9ybWF0OiBodHRwOi8vZ2Vub21lLnVjc2MuZWR1L2dvbGRlblBhdGgvaGVscC9iZWRncmFwaC5odG1sID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy91dGlscy5qcycpLFxuICBwYXJzZUludDEwID0gdXRpbHMucGFyc2VJbnQxMDtcblxuLy8gSW50ZW5kZWQgdG8gYmUgbG9hZGVkIGludG8gQ3VzdG9tVHJhY2sudHlwZXMuYmVkZ3JhcGhcbnZhciBCZWRHcmFwaEZvcm1hdCA9IHtcbiAgZGVmYXVsdHM6IHtcbiAgICBhbHRDb2xvcjogJycsXG4gICAgcHJpb3JpdHk6IDEwMCxcbiAgICBhdXRvU2NhbGU6ICdvbicsXG4gICAgYWx3YXlzWmVybzogJ29mZicsXG4gICAgZ3JpZERlZmF1bHQ6ICdvZmYnLFxuICAgIG1heEhlaWdodFBpeGVsczogJzEyODoxMjg6MTUnLFxuICAgIGdyYXBoVHlwZTogJ2JhcicsXG4gICAgdmlld0xpbWl0czogJycsXG4gICAgeUxpbmVNYXJrOiAwLjAsXG4gICAgeUxpbmVPbk9mZjogJ29mZicsXG4gICAgd2luZG93aW5nRnVuY3Rpb246ICdtYXhpbXVtJyxcbiAgICBzbW9vdGhpbmdXaW5kb3c6ICdvZmYnXG4gIH0sXG5cbiAgaW5pdDogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykuaW5pdC5jYWxsKHRoaXMpOyB9LFxuICBcbiAgX2JpbkZ1bmN0aW9uczogdXRpbHMud2lnQmluRnVuY3Rpb25zLFxuICBcbiAgaW5pdE9wdHM6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy50eXBlKCd3aWdnbGVfMCcpLmluaXRPcHRzLmNhbGwodGhpcyk7IH0sXG4gIFxuICBhcHBseU9wdHM6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy50eXBlKCd3aWdnbGVfMCcpLmFwcGx5T3B0cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9LFxuICBcbiAgcGFyc2U6IGZ1bmN0aW9uKGxpbmVzKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgZ2Vub21lU2l6ZSA9IHRoaXMuYnJvd3Nlck9wdHMuZ2Vub21lU2l6ZSxcbiAgICAgIGRhdGEgPSB7YWxsOiBbXX0sXG4gICAgICBtb2RlLCBtb2RlT3B0cywgY2hyUG9zLCBtO1xuICAgIHNlbGYucmFuZ2UgPSBzZWxmLmlzT24odGhpcy5vcHRzLmFsd2F5c1plcm8pID8gWzAsIDBdIDogW0luZmluaXR5LCAtSW5maW5pdHldO1xuICBcbiAgICBfLmVhY2gobGluZXMsIGZ1bmN0aW9uKGxpbmUsIGxpbmVubykge1xuICAgICAgdmFyIGNvbHMgPSBbJ2Nocm9tJywgJ2Nocm9tU3RhcnQnLCAnY2hyb21FbmQnLCAnZGF0YVZhbHVlJ10sXG4gICAgICAgIGRhdHVtID0ge30sXG4gICAgICAgIGNoclBvcywgc3RhcnQsIGVuZCwgdmFsO1xuICAgICAgXy5lYWNoKGxpbmUuc3BsaXQoL1xccysvKSwgZnVuY3Rpb24odiwgaSkgeyBkYXR1bVtjb2xzW2ldXSA9IHY7IH0pO1xuICAgICAgY2hyUG9zID0gc2VsZi5icm93c2VyT3B0cy5jaHJQb3NbZGF0dW0uY2hyb21dO1xuICAgICAgaWYgKF8uaXNVbmRlZmluZWQoY2hyUG9zKSkge1xuICAgICAgICBzZWxmLndhcm4oXCJJbnZhbGlkIGNocm9tb3NvbWUgYXQgbGluZSBcIiArIChsaW5lbm8gKyAxICsgc2VsZi5vcHRzLmxpbmVOdW0pKTtcbiAgICAgIH1cbiAgICAgIHN0YXJ0ID0gcGFyc2VJbnQxMChkYXR1bS5jaHJvbVN0YXJ0KTtcbiAgICAgIGVuZCA9IHBhcnNlSW50MTAoZGF0dW0uY2hyb21FbmQpO1xuICAgICAgdmFsID0gcGFyc2VGbG9hdChkYXR1bS5kYXRhVmFsdWUpO1xuICAgICAgZGF0YS5hbGwucHVzaCh7c3RhcnQ6IGNoclBvcyArIHN0YXJ0LCBlbmQ6IGNoclBvcyArIGVuZCwgdmFsOiB2YWx9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBzZWxmLnR5cGUoJ3dpZ2dsZV8wJykuZmluaXNoUGFyc2UuY2FsbChzZWxmLCBkYXRhKTtcbiAgfSxcbiAgXG4gIGluaXREcmF3U3BlYzogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykuaW5pdERyYXdTcGVjLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sXG4gIFxuICBkcmF3QmFyczogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykuZHJhd0JhcnMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSxcblxuICBwcmVyZW5kZXI6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHByZWNhbGMsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHRoaXMudHlwZSgnd2lnZ2xlXzAnKS5wcmVyZW5kZXIuY2FsbCh0aGlzLCBzdGFydCwgZW5kLCBkZW5zaXR5LCBwcmVjYWxjLCBjYWxsYmFjayk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbihjYW52YXMsIHN0YXJ0LCBlbmQsIGRlbnNpdHksIGNhbGxiYWNrKSB7XG4gICAgdGhpcy50eXBlKCd3aWdnbGVfMCcpLnJlbmRlci5jYWxsKHRoaXMsIGNhbnZhcywgc3RhcnQsIGVuZCwgZGVuc2l0eSwgY2FsbGJhY2spO1xuICB9LFxuICBcbiAgbG9hZE9wdHM6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy50eXBlKCd3aWdnbGVfMCcpLmxvYWRPcHRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sXG4gIFxuICBzYXZlT3B0czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykuc2F2ZU9wdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfVxuICBcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQmVkR3JhcGhGb3JtYXQ7IiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9IGJpZ0JlZCBmb3JtYXQ6IGh0dHA6Ly9nZW5vbWUudWNzYy5lZHUvZ29sZGVuUGF0aC9oZWxwL2JpZ0JlZC5odG1sID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzL3V0aWxzLmpzJyksXG4gIGZsb29ySGFjayA9IHV0aWxzLmZsb29ySGFjaztcbnZhciBJbnRlcnZhbFRyZWUgPSByZXF1aXJlKCcuL3V0aWxzL0ludGVydmFsVHJlZS5qcycpLkludGVydmFsVHJlZTtcbnZhciBSZW1vdGVUcmFjayA9IHJlcXVpcmUoJy4vdXRpbHMvUmVtb3RlVHJhY2suanMnKS5SZW1vdGVUcmFjaztcblxuLy8gSW50ZW5kZWQgdG8gYmUgbG9hZGVkIGludG8gQ3VzdG9tVHJhY2sudHlwZXMuYmlnYmVkXG52YXIgQmlnQmVkRm9ybWF0ID0ge1xuICBkZWZhdWx0czoge1xuICAgIGNocm9tb3NvbWVzOiAnJyxcbiAgICBpdGVtUmdiOiAnb2ZmJyxcbiAgICBjb2xvckJ5U3RyYW5kOiAnJyxcbiAgICB1c2VTY29yZTogMCxcbiAgICBncm91cDogJ3VzZXInLFxuICAgIHByaW9yaXR5OiAndXNlcicsXG4gICAgb2Zmc2V0OiAwLFxuICAgIGRldGFpbDogZmFsc2UsXG4gICAgdXJsOiAnJyxcbiAgICBodG1sVXJsOiAnJyxcbiAgICBkcmF3TGltaXQ6IHtzcXVpc2g6IDUwMCwgcGFjazogMTAwfSxcbiAgICBtYXhGZXRjaFdpbmRvdzogMFxuICB9LFxuXG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5vcHRzLmJpZ0RhdGFVcmwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlJlcXVpcmVkIHBhcmFtZXRlciBiaWdEYXRhVXJsIG5vdCBmb3VuZCBmb3IgYmlnQmVkIHRyYWNrIGF0IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5vcHRzKSArICh0aGlzLm9wdHMubGluZU51bSArIDEpKTtcbiAgICB9XG4gIH0sXG4gIFxuICBwYXJzZTogZnVuY3Rpb24obGluZXMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBtaWRkbGVpc2hQb3MgPSBzZWxmLmJyb3dzZXJPcHRzLmdlbm9tZVNpemUgLyAyLFxuICAgICAgY2FjaGUgPSBuZXcgSW50ZXJ2YWxUcmVlKGZsb29ySGFjayhtaWRkbGVpc2hQb3MpLCB7c3RhcnRLZXk6ICdzdGFydCcsIGVuZEtleTogJ2VuZCd9KSxcbiAgICAgIGFqYXhVcmwgPSBzZWxmLmFqYXhEaXIoKSArICdiaWdiZWQucGhwJyxcbiAgICAgIHJlbW90ZTtcbiAgICBcbiAgICByZW1vdGUgPSBuZXcgUmVtb3RlVHJhY2soY2FjaGUsIGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIHN0b3JlSW50ZXJ2YWxzKSB7XG4gICAgICByYW5nZSA9IHNlbGYuY2hyUmFuZ2Uoc3RhcnQsIGVuZCk7XG4gICAgICAkLmFqYXgoYWpheFVybCwge1xuICAgICAgICBkYXRhOiB7cmFuZ2U6IHJhbmdlLCB1cmw6IHNlbGYub3B0cy5iaWdEYXRhVXJsLCBkZW5zaXR5OiAncGFjayd9LFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgdmFyIGxpbmVzID0gXy5maWx0ZXIoZGF0YS5zcGxpdCgnXFxuJyksIGZ1bmN0aW9uKGwpIHsgdmFyIG0gPSBsLm1hdGNoKC9cXHQvZyk7IHJldHVybiBtICYmIG0ubGVuZ3RoID49IDI7IH0pO1xuICAgICAgICAgIHZhciBpbnRlcnZhbHMgPSBfLm1hcChsaW5lcywgZnVuY3Rpb24obCkgeyBcbiAgICAgICAgICAgIHZhciBpdHZsID0gc2VsZi50eXBlKCdiZWQnKS5wYXJzZUxpbmUuY2FsbChzZWxmLCBsKTsgXG4gICAgICAgICAgICAvLyBVc2UgQmlvUGVybCdzIEJpbzo6REI6QmlnQmVkIHN0cmF0ZWd5IGZvciBkZWR1cGxpY2F0aW5nIHJlLWZldGNoZWQgaW50ZXJ2YWxzOlxuICAgICAgICAgICAgLy8gXCJCZWNhdXNlIEJFRCBmaWxlcyBkb24ndCBhY3R1YWxseSB1c2UgSURzLCB0aGUgSUQgaXMgY29uc3RydWN0ZWQgZnJvbSB0aGUgZmVhdHVyZSdzIG5hbWUgKGlmIGFueSksIGNocm9tb3NvbWUgY29vcmRpbmF0ZXMsIHN0cmFuZCBhbmQgYmxvY2sgY291bnQuXCJcbiAgICAgICAgICAgIGlmIChfLmlzVW5kZWZpbmVkKGl0dmwuaWQpKSB7XG4gICAgICAgICAgICAgIGl0dmwuaWQgPSBbaXR2bC5uYW1lLCBpdHZsLmNocm9tLCBpdHZsLmNocm9tU3RhcnQsIGl0dmwuY2hyb21FbmQsIGl0dmwuc3RyYW5kLCBpdHZsLmJsb2NrQ291bnRdLmpvaW4oXCJcXHRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaXR2bDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzdG9yZUludGVydmFscyhpbnRlcnZhbHMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmRhdGEgPSB7Y2FjaGU6IGNhY2hlLCByZW1vdGU6IHJlbW90ZX07XG4gICAgc2VsZi5oZWlnaHRzID0ge21heDogbnVsbCwgbWluOiAxNSwgc3RhcnQ6IDE1fTtcbiAgICBzZWxmLnNpemVzID0gWydkZW5zZScsICdzcXVpc2gnLCAncGFjayddO1xuICAgIHNlbGYubWFwU2l6ZXMgPSBbJ3BhY2snXTtcbiAgICBcbiAgICAvLyBHZXQgZ2VuZXJhbCBpbmZvIG9uIHRoZSBiaWdCZWQgYW5kIHNldHVwIHRoZSBiaW5uaW5nIHNjaGVtZSBmb3IgdGhlIFJlbW90ZVRyYWNrXG4gICAgJC5hamF4KGFqYXhVcmwsIHtcbiAgICAgIGRhdGE6IHsgdXJsOiBzZWxmLm9wdHMuYmlnRGF0YVVybCB9LFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAvLyBTZXQgbWF4RmV0Y2hXaW5kb3cgdG8gYXZvaWQgb3ZlcmZldGNoaW5nIGRhdGEuXG4gICAgICAgIGlmICghc2VsZi5vcHRzLm1heEZldGNoV2luZG93KSB7XG4gICAgICAgICAgdmFyIG1lYW5JdGVtc1BlckJwID0gZGF0YS5pdGVtQ291bnQgLyBzZWxmLmJyb3dzZXJPcHRzLmdlbm9tZVNpemUsXG4gICAgICAgICAgICBtYXhJdGVtc1RvRHJhdyA9IF8ubWF4KF8udmFsdWVzKHNlbGYub3B0cy5kcmF3TGltaXQpKTtcbiAgICAgICAgICBzZWxmLm9wdHMubWF4RmV0Y2hXaW5kb3cgPSBtYXhJdGVtc1RvRHJhdyAvIG1lYW5JdGVtc1BlckJwO1xuICAgICAgICAgIHNlbGYub3B0cy5vcHRpbWFsRmV0Y2hXaW5kb3cgPSBNYXRoLmZsb29yKHNlbGYub3B0cy5tYXhGZXRjaFdpbmRvdyAvIDMpO1xuICAgICAgICB9XG4gICAgICAgIHJlbW90ZS5zZXR1cEJpbnMoc2VsZi5icm93c2VyT3B0cy5nZW5vbWVTaXplLCBzZWxmLm9wdHMub3B0aW1hbEZldGNoV2luZG93LCBzZWxmLm9wdHMubWF4RmV0Y2hXaW5kb3cpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIHByZXJlbmRlcjogZnVuY3Rpb24oc3RhcnQsIGVuZCwgZGVuc2l0eSwgcHJlY2FsYywgY2FsbGJhY2spIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICB3aWR0aCA9IHByZWNhbGMud2lkdGgsXG4gICAgICBkYXRhID0gc2VsZi5kYXRhLFxuICAgICAgYnBwcCA9IChlbmQgLSBzdGFydCkgLyB3aWR0aCxcbiAgICAgIHJhbmdlID0gdGhpcy5jaHJSYW5nZShzdGFydCwgZW5kKTtcbiAgICBcbiAgICBmdW5jdGlvbiBsaW5lTnVtKGQsIHNldFRvKSB7XG4gICAgICB2YXIga2V5ID0gYnBwcCArICdfJyArIGRlbnNpdHk7XG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc2V0VG8pKSB7IFxuICAgICAgICBpZiAoIWQubGluZSkgeyBkLmxpbmUgPSB7fTsgfVxuICAgICAgICByZXR1cm4gKGQubGluZVtrZXldID0gc2V0VG8pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGQubGluZSAmJiBkLmxpbmVba2V5XTsgXG4gICAgfVxuICAgIFxuICAgIGZ1bmN0aW9uIHBhcnNlRGVuc2VEYXRhKGRhdGEpIHtcbiAgICAgIHZhciBkcmF3U3BlYyA9IFtdLCBcbiAgICAgICAgbGluZXM7XG4gICAgICBsaW5lcyA9IGRhdGEuc3BsaXQoL1xccysvZyk7XG4gICAgICBfLmVhY2gobGluZXMsIGZ1bmN0aW9uKGxpbmUsIHgpIHsgXG4gICAgICAgIGlmIChsaW5lICE9ICduL2EnICYmIGxpbmUubGVuZ3RoKSB7IGRyYXdTcGVjLnB1c2goe3g6IHgsIHc6IDEsIHY6IHBhcnNlRmxvYXQobGluZSkgKiAxMDAwfSk7IH0gXG4gICAgICB9KTtcbiAgICAgIGNhbGxiYWNrKGRyYXdTcGVjKTtcbiAgICB9XG4gICAgXG4gICAgLy8gRG9uJ3QgZXZlbiBhdHRlbXB0IHRvIGZldGNoIHRoZSBkYXRhIGlmIGRlbnNpdHkgaXMgbm90ICdkZW5zZScgYW5kIHdlIGNhbiByZWFzb25hYmx5XG4gICAgLy8gZXN0aW1hdGUgdGhhdCB3ZSB3aWxsIGZldGNoIHRvbyBtYW55IHJvd3MgKD41MDAgZmVhdHVyZXMpLCBhcyB0aGlzIHdpbGwgb25seSBkZWxheSBvdGhlciByZXF1ZXN0cy5cbiAgICBpZiAoZGVuc2l0eSAhPSAnZGVuc2UnICYmIChlbmQgLSBzdGFydCkgPiBzZWxmLm9wdHMubWF4RmV0Y2hXaW5kb3cpIHtcbiAgICAgIGNhbGxiYWNrKHt0b29NYW55OiB0cnVlfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChkZW5zaXR5ID09ICdkZW5zZScpIHtcbiAgICAgICAgJC5hamF4KHNlbGYuYWpheERpcigpICsgJ2JpZ2JlZC5waHAnLCB7XG4gICAgICAgICAgZGF0YToge3JhbmdlOiByYW5nZSwgdXJsOiBzZWxmLm9wdHMuYmlnRGF0YVVybCwgd2lkdGg6IHdpZHRoLCBkZW5zaXR5OiBkZW5zaXR5fSxcbiAgICAgICAgICBzdWNjZXNzOiBwYXJzZURlbnNlRGF0YVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGYuZGF0YS5yZW1vdGUuZmV0Y2hBc3luYyhzdGFydCwgZW5kLCBmdW5jdGlvbihpbnRlcnZhbHMpIHtcbiAgICAgICAgICB2YXIgY2FsY1BpeEludGVydmFsLCBkcmF3U3BlYyA9IHt9O1xuICAgICAgICAgIGlmIChpbnRlcnZhbHMudG9vTWFueSkgeyByZXR1cm4gY2FsbGJhY2soaW50ZXJ2YWxzKTsgfVxuICAgICAgICAgIGNhbGNQaXhJbnRlcnZhbCA9IG5ldyB1dGlscy5waXhJbnRlcnZhbENhbGN1bGF0b3Ioc3RhcnQsIHdpZHRoLCBicHBwLCBkZW5zaXR5ID09ICdwYWNrJyk7XG4gICAgICAgICAgZHJhd1NwZWMubGF5b3V0ID0gc2VsZi50eXBlKCdiZWQnKS5zdGFja2VkTGF5b3V0LmNhbGwoc2VsZiwgaW50ZXJ2YWxzLCB3aWR0aCwgY2FsY1BpeEludGVydmFsLCBsaW5lTnVtKTtcbiAgICAgICAgICBkcmF3U3BlYy53aWR0aCA9IHdpZHRoO1xuICAgICAgICAgIGNhbGxiYWNrKGRyYXdTcGVjKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oY2FudmFzLCBzdGFydCwgZW5kLCBkZW5zaXR5LCBjYWxsYmFjaykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZWxmLnByZXJlbmRlcihzdGFydCwgZW5kLCBkZW5zaXR5LCB7d2lkdGg6IGNhbnZhcy53aWR0aH0sIGZ1bmN0aW9uKGRyYXdTcGVjKSB7XG4gICAgICBzZWxmLnR5cGUoJ2JlZCcpLmRyYXdTcGVjLmNhbGwoc2VsZiwgY2FudmFzLCBkcmF3U3BlYywgZGVuc2l0eSk7XG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkgeyBjYWxsYmFjaygpOyB9XG4gICAgfSk7XG4gIH0sXG4gIFxuICBsb2FkT3B0czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ2JlZCcpLmxvYWRPcHRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sXG4gIFxuICBzYXZlT3B0czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ2JlZCcpLnNhdmVPcHRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQmlnQmVkRm9ybWF0OyIsIlxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gYmlnV2lnIGZvcm1hdDogaHR0cDovL2dlbm9tZS51Y3NjLmVkdS9nb2xkZW5QYXRoL2hlbHAvYmlnV2lnLmh0bWwgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbnZhciBCaWdXaWdGb3JtYXQgPSB7XG4gIGRlZmF1bHRzOiB7XG4gICAgYWx0Q29sb3I6ICcxMjgsMTI4LDEyOCcsXG4gICAgcHJpb3JpdHk6IDEwMCxcbiAgICBhdXRvU2NhbGU6ICdvbicsXG4gICAgYWx3YXlzWmVybzogJ29mZicsXG4gICAgZ3JpZERlZmF1bHQ6ICdvZmYnLFxuICAgIG1heEhlaWdodFBpeGVsczogJzEyODoxMjg6MTUnLFxuICAgIGdyYXBoVHlwZTogJ2JhcicsXG4gICAgdmlld0xpbWl0czogJycsXG4gICAgeUxpbmVNYXJrOiAwLjAsXG4gICAgeUxpbmVPbk9mZjogJ29mZicsXG4gICAgd2luZG93aW5nRnVuY3Rpb246ICdtYXhpbXVtJyxcbiAgICBzbW9vdGhpbmdXaW5kb3c6ICdvZmYnXG4gIH0sXG5cbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLm9wdHMuYmlnRGF0YVVybCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUmVxdWlyZWQgcGFyYW1ldGVyIGJpZ0RhdGFVcmwgbm90IGZvdW5kIGZvciBiaWdXaWcgdHJhY2sgYXQgXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm9wdHMpICsgKHRoaXMub3B0cy5saW5lTnVtICsgMSkpO1xuICAgIH1cbiAgICB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykuaW5pdE9wdHMuY2FsbCh0aGlzKTtcbiAgfSxcbiAgXG4gIF9iaW5GdW5jdGlvbnM6IHsnbWluaW11bSc6MSwgJ21heGltdW0nOjEsICdtZWFuJzoxLCAnbWluJzoxLCAnbWF4JzoxLCAnc3RkJzoxLCAnY292ZXJhZ2UnOjF9LFxuICBcbiAgYXBwbHlPcHRzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnd2lnZ2xlXzAnKS5hcHBseU9wdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSxcblxuICBwYXJzZTogZnVuY3Rpb24obGluZXMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5zdHJldGNoSGVpZ2h0ID0gdHJ1ZTtcbiAgICBzZWxmLnJhbmdlID0gc2VsZi5pc09uKHNlbGYub3B0cy5hbHdheXNaZXJvKSA/IFswLCAwXSA6IFtJbmZpbml0eSwgLUluZmluaXR5XTtcbiAgICAkLmFqYXgoc2VsZi5hamF4RGlyKCkgKyAnYmlnd2lnLnBocCcsIHtcbiAgICAgIGRhdGE6IHtpbmZvOiAxLCB1cmw6IHRoaXMub3B0cy5iaWdEYXRhVXJsfSxcbiAgICAgIGFzeW5jOiBmYWxzZSwgIC8vIFRoaXMgaXMgY29vbCBzaW5jZSBwYXJzaW5nIG5vcm1hbGx5IGhhcHBlbnMgaW4gYSBXZWIgV29ya2VyXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIHZhciByb3dzID0gZGF0YS5zcGxpdChcIlxcblwiKTtcbiAgICAgICAgXy5lYWNoKHJvd3MsIGZ1bmN0aW9uKHIpIHtcbiAgICAgICAgICB2YXIga2V5dmFsID0gci5zcGxpdCgnOiAnKTtcbiAgICAgICAgICBpZiAoa2V5dmFsWzBdPT0nbWluJykgeyBzZWxmLnJhbmdlWzBdID0gTWF0aC5taW4ocGFyc2VGbG9hdChrZXl2YWxbMV0pLCBzZWxmLnJhbmdlWzBdKTsgfVxuICAgICAgICAgIGlmIChrZXl2YWxbMF09PSdtYXgnKSB7IHNlbGYucmFuZ2VbMV0gPSBNYXRoLm1heChwYXJzZUZsb2F0KGtleXZhbFsxXSksIHNlbGYucmFuZ2VbMV0pOyB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHNlbGYudHlwZSgnd2lnZ2xlXzAnKS5hcHBseU9wdHMuYXBwbHkoc2VsZik7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgcHJlcmVuZGVyOiBmdW5jdGlvbihzdGFydCwgZW5kLCBkZW5zaXR5LCBwcmVjYWxjLCBjYWxsYmFjaykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIHdpZHRoID0gcHJlY2FsYy53aWR0aCxcbiAgICAgIGNoclJhbmdlID0gc2VsZi5jaHJSYW5nZShzdGFydCwgZW5kKTtcbiAgXG4gICAgZnVuY3Rpb24gc3VjY2VzcyhkYXRhKSB7XG4gICAgICB2YXIgZHJhd1NwZWMgPSBzZWxmLnR5cGUoJ3dpZ2dsZV8wJykuaW5pdERyYXdTcGVjLmNhbGwoc2VsZiwgcHJlY2FsYyksXG4gICAgICAgIGxpbmVzID0gZGF0YS5zcGxpdCgvXFxzKy9nKTtcbiAgICAgIF8uZWFjaChsaW5lcywgZnVuY3Rpb24obGluZSkge1xuICAgICAgICBpZiAobGluZSA9PSAnbi9hJykgeyBkcmF3U3BlYy5iYXJzLnB1c2gobnVsbCk7IH1cbiAgICAgICAgZWxzZSBpZiAobGluZS5sZW5ndGgpIHsgZHJhd1NwZWMuYmFycy5wdXNoKChwYXJzZUZsb2F0KGxpbmUpIC0gc2VsZi5kcmF3UmFuZ2VbMF0pIC8gZHJhd1NwZWMudlNjYWxlKTsgfVxuICAgICAgfSk7XG4gICAgICBjYWxsYmFjayhkcmF3U3BlYyk7XG4gICAgfVxuICBcbiAgICAkLmFqYXgoc2VsZi5hamF4RGlyKCkgKyAnYmlnd2lnLnBocCcsIHtcbiAgICAgIGRhdGE6IHtyYW5nZTogY2hyUmFuZ2UsIHVybDogc2VsZi5vcHRzLmJpZ0RhdGFVcmwsIHdpZHRoOiB3aWR0aCwgd2luRnVuYzogc2VsZi5vcHRzLndpbmRvd2luZ0Z1bmN0aW9ufSxcbiAgICAgIHN1Y2Nlc3M6IHN1Y2Nlc3NcbiAgICB9KTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKGNhbnZhcywgc3RhcnQsIGVuZCwgZGVuc2l0eSwgY2FsbGJhY2spIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBoZWlnaHQgPSBjYW52YXMuaGVpZ2h0LFxuICAgICAgd2lkdGggPSBjYW52YXMud2lkdGgsXG4gICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCAmJiBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBpZiAoIWN0eCkgeyB0aHJvdyBcIkNhbnZhcyBub3Qgc3VwcG9ydGVkXCI7IH1cbiAgICBzZWxmLnByZXJlbmRlcihzdGFydCwgZW5kLCBkZW5zaXR5LCB7d2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodH0sIGZ1bmN0aW9uKGRyYXdTcGVjKSB7XG4gICAgICBzZWxmLnR5cGUoJ3dpZ2dsZV8wJykuZHJhd0JhcnMuY2FsbChzZWxmLCBjdHgsIGRyYXdTcGVjLCBoZWlnaHQsIHdpZHRoKTtcbiAgICAgIF8uaXNGdW5jdGlvbihjYWxsYmFjaykgJiYgY2FsbGJhY2soKTtcbiAgICB9KTtcbiAgfSxcblxuICBsb2FkT3B0czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykubG9hZE9wdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSxcblxuICBzYXZlT3B0czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykuc2F2ZU9wdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCaWdXaWdGb3JtYXQ7IiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSBmZWF0dXJlVGFibGUgZm9ybWF0OiBodHRwOi8vd3d3Lmluc2RjLm9yZy9maWxlcy9mZWF0dXJlX3RhYmxlLmh0bWwgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG52YXIgSW50ZXJ2YWxUcmVlID0gcmVxdWlyZSgnLi91dGlscy9JbnRlcnZhbFRyZWUuanMnKS5JbnRlcnZhbFRyZWU7XG52YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzL3V0aWxzLmpzJyksXG4gIHN0cmlwID0gdXRpbHMuc3RyaXAsXG4gIGZsb29ySGFjayA9IHV0aWxzLmZsb29ySGFjayxcbiAgcGFyc2VJbnQxMCA9IHV0aWxzLnBhcnNlSW50MTA7XG5cbi8vIEludGVuZGVkIHRvIGJlIGxvYWRlZCBpbnRvIEN1c3RvbVRyYWNrLnR5cGVzLmZlYXR1cmV0YWJsZVxudmFyIEZlYXR1cmVUYWJsZUZvcm1hdCA9IHtcbiAgZGVmYXVsdHM6IHtcbiAgICBjb2xsYXBzZUJ5R2VuZTogJ29mZicsXG4gICAga2V5Q29sdW1uV2lkdGg6IDIxLFxuICAgIGl0ZW1SZ2I6ICdvZmYnLFxuICAgIGNvbG9yQnlTdHJhbmQ6ICcnLFxuICAgIHVzZVNjb3JlOiAwLFxuICAgIGdyb3VwOiAndXNlcicsXG4gICAgcHJpb3JpdHk6ICd1c2VyJyxcbiAgICBvZmZzZXQ6IDAsXG4gICAgdXJsOiAnJyxcbiAgICBodG1sVXJsOiAnJyxcbiAgICBkcmF3TGltaXQ6IHtzcXVpc2g6IG51bGwsIHBhY2s6IG51bGx9XG4gIH0sXG4gIFxuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnR5cGUoJ2JlZCcpLmluaXRPcHRzLmNhbGwodGhpcyk7XG4gICAgdGhpcy5vcHRzLmNvbGxhcHNlQnlHZW5lID0gdGhpcy5pc09uKHRoaXMub3B0cy5jb2xsYXBzZUJ5R2VuZSk7XG4gICAgdGhpcy5mZWF0dXJlVHlwZUNvdW50cyA9IHt9O1xuICB9LFxuICBcbiAgLy8gcGFyc2VzIG9uZSBmZWF0dXJlIGtleSArIGxvY2F0aW9uL3F1YWxpZmllcnMgcm93IGZyb20gdGhlIGZlYXR1cmUgdGFibGVcbiAgcGFyc2VFbnRyeTogZnVuY3Rpb24oY2hyb20sIGxpbmVzLCBzdGFydExpbmVObykge1xuICAgIHZhciBmZWF0dXJlID0ge1xuICAgICAgICBjaHJvbTogY2hyb20sXG4gICAgICAgIHNjb3JlOiAnPycsXG4gICAgICAgIGJsb2NrczogbnVsbCxcbiAgICAgICAgcXVhbGlmaWVyczoge31cbiAgICAgIH0sXG4gICAgICBrZXlDb2x1bW5XaWR0aCA9IHRoaXMub3B0cy5rZXlDb2x1bW5XaWR0aCxcbiAgICAgIHF1YWxpZmllciA9IG51bGwsXG4gICAgICBmdWxsTG9jYXRpb24gPSBbXSxcbiAgICAgIGNvbGxhcHNlS2V5UXVhbGlmaWVycyA9IFsnbG9jdXNfdGFnJywgJ2dlbmUnLCAnZGJfeHJlZiddLFxuICAgICAgcXVhbGlmaWVyc1RoYXRBcmVOYW1lcyA9IFsnZ2VuZScsICdsb2N1c190YWcnLCAnZGJfeHJlZiddLFxuICAgICAgUk5BVHlwZXMgPSBbJ3JybmEnLCAndHJuYSddLFxuICAgICAgYWxzb1RyeUZvclJOQVR5cGVzID0gWydwcm9kdWN0J10sXG4gICAgICBsb2NhdGlvblBvc2l0aW9ucywgY2hyUG9zLCBibG9ja1NpemVzO1xuICAgIFxuICAgIGNoclBvcyA9IHRoaXMuYnJvd3Nlck9wdHMuY2hyUG9zW2Nocm9tXTtcbiAgICBzdGFydExpbmVObyA9IHN0YXJ0TGluZU5vIHx8IDA7XG4gICAgaWYgKF8uaXNVbmRlZmluZWQoY2hyUG9zKSkge1xuICAgICAgdGhpcy53YXJuKFwiSW52YWxpZCBjaHJvbW9zb21lIGF0IGxpbmUgXCIgKyAobGluZW5vICsgMSArIHRoaXMub3B0cy5saW5lTnVtKSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgLy8gZmlsbCBvdXQgZmVhdHVyZSdzIGtleXMgd2l0aCBpbmZvIGZyb20gdGhlc2UgbGluZXNcbiAgICBfLmVhY2gobGluZXMsIGZ1bmN0aW9uKGxpbmUsIGxpbmVubykge1xuICAgICAgdmFyIGtleSA9IGxpbmUuc3Vic3RyKDAsIGtleUNvbHVtbldpZHRoKSxcbiAgICAgICAgcmVzdE9mTGluZSA9IGxpbmUuc3Vic3RyKGtleUNvbHVtbldpZHRoKSxcbiAgICAgICAgcXVhbGlmaWVyTWF0Y2ggPSByZXN0T2ZMaW5lLm1hdGNoKC9eXFwvKFxcdyspKD0/KSguKikvKTtcbiAgICAgIGlmIChrZXkubWF0Y2goL1xcdy8pKSB7XG4gICAgICAgIGZlYXR1cmUudHlwZSA9IHN0cmlwKGtleSk7XG4gICAgICAgIHF1YWxpZmllciA9IG51bGw7XG4gICAgICAgIGZ1bGxMb2NhdGlvbi5wdXNoKHJlc3RPZkxpbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHF1YWxpZmllck1hdGNoKSB7XG4gICAgICAgICAgcXVhbGlmaWVyID0gcXVhbGlmaWVyTWF0Y2hbMV07XG4gICAgICAgICAgaWYgKCFmZWF0dXJlLnF1YWxpZmllcnNbcXVhbGlmaWVyXSkgeyBmZWF0dXJlLnF1YWxpZmllcnNbcXVhbGlmaWVyXSA9IFtdOyB9XG4gICAgICAgICAgZmVhdHVyZS5xdWFsaWZpZXJzW3F1YWxpZmllcl0ucHVzaChbcXVhbGlmaWVyTWF0Y2hbMl0gPyBxdWFsaWZpZXJNYXRjaFszXSA6IHRydWVdKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAocXVhbGlmaWVyICE9PSBudWxsKSB7IFxuICAgICAgICAgICAgXy5sYXN0KGZlYXR1cmUucXVhbGlmaWVyc1txdWFsaWZpZXJdKS5wdXNoKHJlc3RPZkxpbmUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmdWxsTG9jYXRpb24ucHVzaChyZXN0T2ZMaW5lKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICBmZWF0dXJlLmZ1bGxMb2NhdGlvbiA9IGZ1bGxMb2NhdGlvbiA9IGZ1bGxMb2NhdGlvbi5qb2luKCcnKTtcbiAgICBsb2NhdGlvblBvc2l0aW9ucyA9IF8ubWFwKF8uZmlsdGVyKGZ1bGxMb2NhdGlvbi5zcGxpdCgvXFxEKy8pLCBfLmlkZW50aXR5KSwgcGFyc2VJbnQxMCk7XG4gICAgZmVhdHVyZS5jaHJvbVN0YXJ0ID0gIF8ubWluKGxvY2F0aW9uUG9zaXRpb25zKTtcbiAgICBmZWF0dXJlLmNocm9tRW5kID0gXy5tYXgobG9jYXRpb25Qb3NpdGlvbnMpICsgMTsgLy8gRmVhdHVyZSB0YWJsZSByYW5nZXMgYXJlICppbmNsdXNpdmUqIG9mIHRoZSBlbmQgYmFzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjaHJvbUVuZCBjb2x1bW5zIGluIEJFRCBmb3JtYXQgYXJlICpub3QqLlxuICAgIGZlYXR1cmUuc3RhcnQgPSBjaHJQb3MgKyBmZWF0dXJlLmNocm9tU3RhcnQ7XG4gICAgZmVhdHVyZS5lbmQgPSBjaHJQb3MgKyBmZWF0dXJlLmNocm9tRW5kOyBcbiAgICBmZWF0dXJlLnN0cmFuZCA9IC9jb21wbGVtZW50Ly50ZXN0KGZ1bGxMb2NhdGlvbikgPyBcIi1cIiA6IFwiK1wiO1xuICAgIFxuICAgIC8vIFVudGlsIHdlIG1lcmdlIGJ5IGdlbmUgbmFtZSwgd2UgZG9uJ3QgY2FyZSBhYm91dCB0aGVzZVxuICAgIGZlYXR1cmUudGhpY2tTdGFydCA9IGZlYXR1cmUudGhpY2tFbmQgPSBudWxsO1xuICAgIGZlYXR1cmUuYmxvY2tzID0gbnVsbDtcbiAgICBcbiAgICAvLyBQYXJzZSB0aGUgcXVhbGlmaWVycyBwcm9wZXJseVxuICAgIF8uZWFjaChmZWF0dXJlLnF1YWxpZmllcnMsIGZ1bmN0aW9uKHYsIGspIHtcbiAgICAgIF8uZWFjaCh2LCBmdW5jdGlvbihlbnRyeUxpbmVzLCBpKSB7XG4gICAgICAgIHZbaV0gPSBzdHJpcChlbnRyeUxpbmVzLmpvaW4oJyAnKSk7XG4gICAgICAgIGlmICgvXlwiW1xcc1xcU10qXCIkLy50ZXN0KHZbaV0pKSB7XG4gICAgICAgICAgLy8gRGVxdW90ZSBmcmVlIHRleHRcbiAgICAgICAgICB2W2ldID0gdltpXS5yZXBsYWNlKC9eXCJ8XCIkL2csICcnKS5yZXBsYWNlKC9cIlwiL2csICdcIicpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIC8vaWYgKHYubGVuZ3RoID09IDEpIHsgZmVhdHVyZS5xdWFsaWZpZXJzW2tdID0gdlswXTsgfVxuICAgIH0pO1xuICAgIFxuICAgIC8vIEZpbmQgc29tZXRoaW5nIHRoYXQgY2FuIHNlcnZlIGFzIGEgbmFtZVxuICAgIGZlYXR1cmUubmFtZSA9IGZlYXR1cmUudHlwZTtcbiAgICBpZiAoXy5jb250YWlucyhSTkFUeXBlcywgZmVhdHVyZS50eXBlLnRvTG93ZXJDYXNlKCkpKSB7IFxuICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocXVhbGlmaWVyc1RoYXRBcmVOYW1lcywgYWxzb1RyeUZvclJOQVR5cGVzKTsgXG4gICAgfVxuICAgIF8uZmluZChxdWFsaWZpZXJzVGhhdEFyZU5hbWVzLCBmdW5jdGlvbihrKSB7XG4gICAgICBpZiAoZmVhdHVyZS5xdWFsaWZpZXJzW2tdICYmIGZlYXR1cmUucXVhbGlmaWVyc1trXVswXSkgeyByZXR1cm4gKGZlYXR1cmUubmFtZSA9IGZlYXR1cmUucXVhbGlmaWVyc1trXVswXSk7IH1cbiAgICB9KTtcbiAgICAvLyBJbiB0aGUgd29yc3QgY2FzZSwgYWRkIGEgY291bnRlciB0byBkaXNhbWJpZ3VhdGUgZmVhdHVyZXMgbmFtZWQgb25seSBieSB0eXBlXG4gICAgaWYgKGZlYXR1cmUubmFtZSA9PSBmZWF0dXJlLnR5cGUpIHtcbiAgICAgIGlmICghdGhpcy5mZWF0dXJlVHlwZUNvdW50c1tmZWF0dXJlLnR5cGVdKSB7IHRoaXMuZmVhdHVyZVR5cGVDb3VudHNbZmVhdHVyZS50eXBlXSA9IDE7IH1cbiAgICAgIGZlYXR1cmUubmFtZSA9IGZlYXR1cmUubmFtZSArICdfJyArIHRoaXMuZmVhdHVyZVR5cGVDb3VudHNbZmVhdHVyZS50eXBlXSsrO1xuICAgIH1cbiAgICBcbiAgICAvLyBGaW5kIGEga2V5IHRoYXQgaXMgYXBwcm9wcmlhdGUgZm9yIGNvbGxhcHNpbmdcbiAgICBpZiAodGhpcy5vcHRzLmNvbGxhcHNlQnlHZW5lKSB7XG4gICAgICBfLmZpbmQoY29sbGFwc2VLZXlRdWFsaWZpZXJzLCBmdW5jdGlvbihrKSB7XG4gICAgICAgIGlmIChmZWF0dXJlLnF1YWxpZmllcnNba10gJiYgZmVhdHVyZS5xdWFsaWZpZXJzW2tdWzBdKSB7IFxuICAgICAgICAgIHJldHVybiAoZmVhdHVyZS5fY29sbGFwc2VLZXkgPSBmZWF0dXJlLnF1YWxpZmllcnNba11bMF0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZlYXR1cmU7XG4gIH0sXG4gIFxuICAvLyBjb2xsYXBzZXMgbXVsdGlwbGUgZmVhdHVyZXMgdGhhdCBhcmUgYWJvdXQgdGhlIHNhbWUgZ2VuZSBpbnRvIG9uZSBkcmF3YWJsZSBmZWF0dXJlXG4gIGNvbGxhcHNlRmVhdHVyZXM6IGZ1bmN0aW9uKGZlYXR1cmVzKSB7XG4gICAgdmFyIGNoclBvcyA9IHRoaXMuYnJvd3Nlck9wdHMuY2hyUG9zLFxuICAgICAgcHJlZmVycmVkVHlwZVRvTWVyZ2VJbnRvID0gWydtcm5hJywgJ2dlbmUnLCAnY2RzJ10sXG4gICAgICBwcmVmZXJyZWRUeXBlRm9yRXhvbnMgPSBbJ2V4b24nLCAnY2RzJ10sXG4gICAgICBtZXJnZUludG8gPSBmZWF0dXJlc1swXSxcbiAgICAgIGJsb2NrcyA9IFtdLFxuICAgICAgZm91bmRUeXBlLCBjZHMsIGV4b25zO1xuICAgIGZvdW5kVHlwZSA9IF8uZmluZChwcmVmZXJyZWRUeXBlVG9NZXJnZUludG8sIGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgIHZhciBmb3VuZCA9IF8uZmluZChmZWF0dXJlcywgZnVuY3Rpb24oZmVhdCkgeyByZXR1cm4gZmVhdC50eXBlLnRvTG93ZXJDYXNlKCkgPT0gdHlwZTsgfSk7XG4gICAgICBpZiAoZm91bmQpIHsgbWVyZ2VJbnRvID0gZm91bmQ7IHJldHVybiB0cnVlOyB9XG4gICAgfSk7XG4gICAgXG4gICAgLy8gTG9vayBmb3IgZXhvbnMgKGV1a2FyeW90aWMpIG9yIGEgQ0RTIChwcm9rYXJ5b3RpYylcbiAgICBfLmZpbmQocHJlZmVycmVkVHlwZUZvckV4b25zLCBmdW5jdGlvbih0eXBlKSB7XG4gICAgICBleG9ucyA9IF8uc2VsZWN0KGZlYXR1cmVzLCBmdW5jdGlvbihmZWF0KSB7IHJldHVybiBmZWF0LnR5cGUudG9Mb3dlckNhc2UoKSA9PSB0eXBlOyB9KTtcbiAgICAgIGlmIChleG9ucy5sZW5ndGgpIHsgcmV0dXJuIHRydWU7IH1cbiAgICB9KTtcbiAgICBjZHMgPSBfLmZpbmQoZmVhdHVyZXMsIGZ1bmN0aW9uKGZlYXQpIHsgcmV0dXJuIGZlYXQudHlwZS50b0xvd2VyQ2FzZSgpID09IFwiY2RzXCI7IH0pO1xuICAgIFxuICAgIF8uZWFjaChleG9ucywgZnVuY3Rpb24oZXhvbkZlYXR1cmUpIHtcbiAgICAgIGV4b25GZWF0dXJlLmZ1bGxMb2NhdGlvbi5yZXBsYWNlKC8oXFxkKylcXC5cXC5bPjxdPyhcXGQrKS9nLCBmdW5jdGlvbihmdWxsTWF0Y2gsIHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgYmxvY2tzLnB1c2goe1xuICAgICAgICAgIHN0YXJ0OiBjaHJQb3NbZXhvbkZlYXR1cmUuY2hyb21dICsgTWF0aC5taW4oc3RhcnQsIGVuZCksIFxuICAgICAgICAgIC8vIEZlYXR1cmUgdGFibGUgcmFuZ2VzIGFyZSAqaW5jbHVzaXZlKiBvZiB0aGUgZW5kIGJhc2UuXG4gICAgICAgICAgZW5kOiBjaHJQb3NbZXhvbkZlYXR1cmUuY2hyb21dICsgIE1hdGgubWF4KHN0YXJ0LCBlbmQpICsgMVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIFxuICAgIC8vIENvbnZlcnQgZXhvbnMgYW5kIENEUyBpbnRvIGJsb2NrcywgdGhpY2tTdGFydCBhbmQgdGhpY2tFbmQgKGluIEJFRCB0ZXJtaW5vbG9neSlcbiAgICBpZiAoYmxvY2tzLmxlbmd0aCkgeyBcbiAgICAgIG1lcmdlSW50by5ibG9ja3MgPSBfLnNvcnRCeShibG9ja3MsIGZ1bmN0aW9uKGIpIHsgcmV0dXJuIGIuc3RhcnQ7IH0pO1xuICAgICAgbWVyZ2VJbnRvLnRoaWNrU3RhcnQgPSBjZHMgPyBjZHMuc3RhcnQgOiBmZWF0dXJlLnN0YXJ0O1xuICAgICAgbWVyZ2VJbnRvLnRoaWNrRW5kID0gY2RzID8gY2RzLmVuZCA6IGZlYXR1cmUuZW5kO1xuICAgIH1cbiAgICBcbiAgICAvLyBmaW5hbGx5LCBtZXJnZSBhbGwgdGhlIHF1YWxpZmllcnNcbiAgICBfLmVhY2goZmVhdHVyZXMsIGZ1bmN0aW9uKGZlYXQpIHtcbiAgICAgIGlmIChmZWF0ID09PSBtZXJnZUludG8pIHsgcmV0dXJuOyB9XG4gICAgICBfLmVhY2goZmVhdC5xdWFsaWZpZXJzLCBmdW5jdGlvbih2YWx1ZXMsIGspIHtcbiAgICAgICAgaWYgKCFtZXJnZUludG8ucXVhbGlmaWVyc1trXSkgeyBtZXJnZUludG8ucXVhbGlmaWVyc1trXSA9IFtdOyB9XG4gICAgICAgIF8uZWFjaCh2YWx1ZXMsIGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICBpZiAoIV8uY29udGFpbnMobWVyZ2VJbnRvLnF1YWxpZmllcnNba10sIHYpKSB7IG1lcmdlSW50by5xdWFsaWZpZXJzW2tdLnB1c2godik7IH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gbWVyZ2VJbnRvO1xuICB9LFxuXG4gIHBhcnNlOiBmdW5jdGlvbihsaW5lcykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdHMsXG4gICAgICBtaWRkbGVpc2hQb3MgPSB0aGlzLmJyb3dzZXJPcHRzLmdlbm9tZVNpemUgLyAyLFxuICAgICAgZGF0YSA9IG5ldyBJbnRlcnZhbFRyZWUoZmxvb3JIYWNrKG1pZGRsZWlzaFBvcyksIHtzdGFydEtleTogJ3N0YXJ0JywgZW5kS2V5OiAnZW5kJ30pLFxuICAgICAgbnVtTGluZXMgPSBsaW5lcy5sZW5ndGgsXG4gICAgICBjaHJvbSA9IG51bGwsXG4gICAgICBsYXN0RW50cnlTdGFydCA9IG51bGwsXG4gICAgICBmZWF0dXJlc0J5Q29sbGFwc2VLZXkgPSB7fSxcbiAgICAgIGZlYXR1cmU7XG4gICAgXG4gICAgZnVuY3Rpb24gY29sbGVjdExhc3RFbnRyeShsaW5lbm8pIHtcbiAgICAgIGlmIChsYXN0RW50cnlTdGFydCAhPT0gbnVsbCkge1xuICAgICAgICBmZWF0dXJlID0gc2VsZi50eXBlKCkucGFyc2VFbnRyeS5jYWxsKHNlbGYsIGNocm9tLCBsaW5lcy5zbGljZShsYXN0RW50cnlTdGFydCwgbGluZW5vKSwgbGFzdEVudHJ5U3RhcnQpO1xuICAgICAgICBpZiAoZmVhdHVyZSkgeyBcbiAgICAgICAgICBpZiAoby5jb2xsYXBzZUJ5R2VuZSkge1xuICAgICAgICAgICAgZmVhdHVyZXNCeUNvbGxhcHNlS2V5W2ZlYXR1cmUuX2NvbGxhcHNlS2V5XSA9IGZlYXR1cmVzQnlDb2xsYXBzZUtleVtmZWF0dXJlLl9jb2xsYXBzZUtleV0gfHwgW107XG4gICAgICAgICAgICBmZWF0dXJlc0J5Q29sbGFwc2VLZXlbZmVhdHVyZS5fY29sbGFwc2VLZXldLnB1c2goZmVhdHVyZSk7XG4gICAgICAgICAgfSBlbHNlIHsgZGF0YS5hZGQoZmVhdHVyZSk7IH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBDaHVuayB0aGUgbGluZXMgaW50byBlbnRyaWVzIGFuZCBwYXJzZSBlYWNoIG9mIHRoZW1cbiAgICBfLmVhY2gobGluZXMsIGZ1bmN0aW9uKGxpbmUsIGxpbmVubykge1xuICAgICAgaWYgKGxpbmUuc3Vic3RyKDAsIDEyKSA9PSBcIkFDQ0VTU0lPTiAgIFwiKSB7XG4gICAgICAgIGNvbGxlY3RMYXN0RW50cnkobGluZW5vKTtcbiAgICAgICAgY2hyb20gPSBsaW5lLnN1YnN0cigxMik7XG4gICAgICAgIGxhc3RFbnRyeVN0YXJ0ID0gbnVsbDtcbiAgICAgIH0gZWxzZSBpZiAoY2hyb20gIT09IG51bGwgJiYgbGluZS5zdWJzdHIoNSwgMSkubWF0Y2goL1xcdy8pKSB7XG4gICAgICAgIGNvbGxlY3RMYXN0RW50cnkobGluZW5vKTtcbiAgICAgICAgbGFzdEVudHJ5U3RhcnQgPSBsaW5lbm87XG4gICAgICB9XG4gICAgfSk7XG4gICAgLy8gcGFyc2UgdGhlIGxhc3QgZW50cnlcbiAgICBpZiAoY2hyb20gIT09IG51bGwpIHsgY29sbGVjdExhc3RFbnRyeShsaW5lcy5sZW5ndGgpOyB9XG4gICAgXG4gICAgaWYgKG8uY29sbGFwc2VCeUdlbmUpIHtcbiAgICAgIF8uZWFjaChmZWF0dXJlc0J5Q29sbGFwc2VLZXksIGZ1bmN0aW9uKGZlYXR1cmVzLCBnZW5lKSB7XG4gICAgICAgIGRhdGEuYWRkKHNlbGYudHlwZSgpLmNvbGxhcHNlRmVhdHVyZXMuY2FsbChzZWxmLCBmZWF0dXJlcykpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIHNlbGYuZGF0YSA9IGRhdGE7XG4gICAgc2VsZi5oZWlnaHRzID0ge21heDogbnVsbCwgbWluOiAxNSwgc3RhcnQ6IDE1fTtcbiAgICBzZWxmLnNpemVzID0gWydkZW5zZScsICdzcXVpc2gnLCAncGFjayddO1xuICAgIHNlbGYubWFwU2l6ZXMgPSBbJ3BhY2snXTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcbiAgXG4gIC8vIHNwZWNpYWwgZm9ybWF0dGVyIGZvciBjb250ZW50IGluIHRvb2x0aXBzIGZvciBmZWF0dXJlc1xuICB0aXBUaXBEYXRhOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgdmFyIHF1YWxpZmllcnNUb0FiYnJldmlhdGUgPSB7dHJhbnNsYXRpb246IDF9LFxuICAgICAgY29udGVudCA9IHtcbiAgICAgICAgdHlwZTogZGF0YS5kLnR5cGUsXG4gICAgICAgIHBvc2l0aW9uOiBkYXRhLmQuY2hyb20gKyAnOicgKyBkYXRhLmQuY2hyb21TdGFydCwgXG4gICAgICAgIHNpemU6IGRhdGEuZC5jaHJvbUVuZCAtIGRhdGEuZC5jaHJvbVN0YXJ0XG4gICAgICB9O1xuICAgIGlmIChkYXRhLmQucXVhbGlmaWVycy5ub3RlICYmIGRhdGEuZC5xdWFsaWZpZXJzLm5vdGVbMF0pIHsgIH1cbiAgICBfLmVhY2goZGF0YS5kLnF1YWxpZmllcnMsIGZ1bmN0aW9uKHYsIGspIHtcbiAgICAgIGlmIChrID09ICdub3RlJykgeyBjb250ZW50LmRlc2NyaXB0aW9uID0gdi5qb2luKCc7ICcpOyByZXR1cm47IH1cbiAgICAgIGNvbnRlbnRba10gPSB2LmpvaW4oJzsgJyk7XG4gICAgICBpZiAocXVhbGlmaWVyc1RvQWJicmV2aWF0ZVtrXSAmJiBjb250ZW50W2tdLmxlbmd0aCA+IDI1KSB7IGNvbnRlbnRba10gPSBjb250ZW50W2tdLnN1YnN0cigwLCAyNSkgKyAnLi4uJzsgfVxuICAgIH0pO1xuICAgIHJldHVybiBjb250ZW50O1xuICB9LFxuICBcbiAgcHJlcmVuZGVyOiBmdW5jdGlvbihzdGFydCwgZW5kLCBkZW5zaXR5LCBwcmVjYWxjLCBjYWxsYmFjaykge1xuICAgIHJldHVybiB0aGlzLnR5cGUoJ2JlZCcpLnByZXJlbmRlci5jYWxsKHRoaXMsIHN0YXJ0LCBlbmQsIGRlbnNpdHksIHByZWNhbGMsIGNhbGxiYWNrKTtcbiAgfSxcbiAgXG4gIGRyYXdTcGVjOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnYmVkJykuZHJhd1NwZWMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSxcbiAgXG4gIHJlbmRlcjogZnVuY3Rpb24oY2FudmFzLCBzdGFydCwgZW5kLCBkZW5zaXR5LCBjYWxsYmFjaykge1xuICAgIHRoaXMudHlwZSgnYmVkJykucmVuZGVyLmNhbGwodGhpcywgY2FudmFzLCBzdGFydCwgZW5kLCBkZW5zaXR5LCBjYWxsYmFjayk7XG4gIH0sXG4gIFxuICBsb2FkT3B0czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ2JlZCcpLmxvYWRPcHRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sXG4gIFxuICBzYXZlT3B0czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ2JlZCcpLnNhdmVPcHRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRmVhdHVyZVRhYmxlRm9ybWF0OyIsIihmdW5jdGlvbihleHBvcnRzKXtcbiAgXG52YXIgU29ydGVkTGlzdCA9IHJlcXVpcmUoJy4vU29ydGVkTGlzdC5qcycpLlNvcnRlZExpc3Q7ICBcblxuLy8gVE9ETzogYmFja3BvcnQgdGhpcyBjb2RlIGZvciBKYXZhU2NyaXB0IDEuNT8gdXNpbmcgdW5kZXJzY29yZS5qc1xuLyoqXG4gKiBCeSBTaGluIFN1enVraSwgTUlUIGxpY2Vuc2VcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9zaGlub3V0L2ludGVydmFsLXRyZWVcbiAqIEludGVydmFsVHJlZVxuICpcbiAqIEBwYXJhbSAob2JqZWN0KSBkYXRhOlxuICogQHBhcmFtIChudW1iZXIpIGNlbnRlcjpcbiAqIEBwYXJhbSAob2JqZWN0KSBvcHRpb25zOlxuICogICBjZW50ZXI6XG4gKlxuICoqL1xuZnVuY3Rpb24gSW50ZXJ2YWxUcmVlKGNlbnRlciwgb3B0aW9ucykge1xuICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pO1xuXG4gIHRoaXMuc3RhcnRLZXkgICAgID0gb3B0aW9ucy5zdGFydEtleSB8fCAwOyAvLyBzdGFydCBrZXlcbiAgdGhpcy5lbmRLZXkgICAgICAgPSBvcHRpb25zLmVuZEtleSAgIHx8IDE7IC8vIGVuZCBrZXlcbiAgdGhpcy5pbnRlcnZhbEhhc2ggPSB7fTsgICAgICAgICAgICAgICAgICAgIC8vIGlkID0+IGludGVydmFsIG9iamVjdFxuICB0aGlzLnBvaW50VHJlZSA9IG5ldyBTb3J0ZWRMaXN0KHsgICAgICAgICAgLy8gYi10cmVlIG9mIHN0YXJ0LCBlbmQgcG9pbnRzIFxuICAgIGNvbXBhcmU6IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgIGlmIChhID09IG51bGwpIHJldHVybiAtMTtcbiAgICAgIGlmIChiID09IG51bGwpIHJldHVybiAgMTtcbiAgICAgIHZhciBjID0gYVswXS0gYlswXTtcbiAgICAgIHJldHVybiAoYyA+IDApID8gMSA6IChjID09IDApICA/IDAgOiAtMTtcbiAgICB9XG4gIH0pO1xuXG4gIHRoaXMuX2F1dG9JbmNyZW1lbnQgPSAwO1xuXG4gIC8vIGluZGV4IG9mIHRoZSByb290IG5vZGVcbiAgaWYgKCFjZW50ZXIgfHwgdHlwZW9mIGNlbnRlciAhPSAnbnVtYmVyJykge1xuICAgIHRocm93IG5ldyBFcnJvcigneW91IG11c3Qgc3BlY2lmeSBjZW50ZXIgaW5kZXggYXMgdGhlIDJuZCBhcmd1bWVudC4nKTtcbiAgfVxuXG4gIHRoaXMucm9vdCA9IG5ldyBOb2RlKGNlbnRlciwgdGhpcyk7XG59XG5cblxuLyoqXG4gKiBwdWJsaWMgbWV0aG9kc1xuICoqL1xuXG5cbi8qKlxuICogYWRkIG5ldyByYW5nZVxuICoqL1xuSW50ZXJ2YWxUcmVlLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihkYXRhLCBpZCkge1xuICBpZiAodGhpcy5jb250YWlucyhpZCkpIHtcbiAgICB0aHJvdyBuZXcgRHVwbGljYXRlRXJyb3IoJ2lkICcgKyBpZCArICcgaXMgYWxyZWFkeSByZWdpc3RlcmVkLicpO1xuICB9XG5cbiAgaWYgKGlkID09IHVuZGVmaW5lZCkge1xuICAgIHdoaWxlICh0aGlzLmludGVydmFsSGFzaFt0aGlzLl9hdXRvSW5jcmVtZW50XSkge1xuICAgICAgdGhpcy5fYXV0b0luY3JlbWVudCsrO1xuICAgIH1cbiAgICBpZCA9IHRoaXMuX2F1dG9JbmNyZW1lbnQ7XG4gIH1cblxuICB2YXIgaXR2bCA9IG5ldyBJbnRlcnZhbChkYXRhLCBpZCwgdGhpcy5zdGFydEtleSwgdGhpcy5lbmRLZXkpO1xuICB0aGlzLnBvaW50VHJlZS5pbnNlcnQoW2l0dmwuc3RhcnQsIGlkXSk7XG4gIHRoaXMucG9pbnRUcmVlLmluc2VydChbaXR2bC5lbmQsICAgaWRdKTtcbiAgdGhpcy5pbnRlcnZhbEhhc2hbaWRdID0gaXR2bDtcbiAgdGhpcy5fYXV0b0luY3JlbWVudCsrO1xuICBcbiAgX2luc2VydC5jYWxsKHRoaXMsIHRoaXMucm9vdCwgaXR2bCk7XG59O1xuXG5cbi8qKlxuICogY2hlY2sgaWYgcmFuZ2UgaXMgYWxyZWFkeSBwcmVzZW50LCBiYXNlZCBvbiBpdHMgaWRcbiAqKi9cbkludGVydmFsVHJlZS5wcm90b3R5cGUuY29udGFpbnMgPSBmdW5jdGlvbihpZCkge1xuICByZXR1cm4gISF0aGlzLmdldChpZCk7XG59XG5cblxuLyoqXG4gKiByZXRyaWV2ZSBhbiBpbnRlcnZhbCBieSBpdHMgaWQ7IHJldHVybnMgbnVsbCBpZiBpdCBkb2VzIG5vdCBleGlzdFxuICoqL1xuSW50ZXJ2YWxUcmVlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihpZCkge1xuICByZXR1cm4gdGhpcy5pbnRlcnZhbEhhc2hbaWRdIHx8IG51bGw7XG59XG5cblxuLyoqXG4gKiBhZGQgbmV3IHJhbmdlIG9ubHkgaWYgaXQgaXMgbmV3LCBiYXNlZCBvbiB3aGV0aGVyIHRoZSBpZCB3YXMgYWxyZWFkeSByZWdpc3RlcmVkXG4gKiovXG5JbnRlcnZhbFRyZWUucHJvdG90eXBlLmFkZElmTmV3ID0gZnVuY3Rpb24oZGF0YSwgaWQpIHtcbiAgdHJ5IHtcbiAgICB0aGlzLmFkZChkYXRhLCBpZCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZSBpbnN0YW5jZW9mIER1cGxpY2F0ZUVycm9yKSB7IHJldHVybjsgfVxuICAgIHRocm93IGU7XG4gIH1cbn1cblxuXG4vKipcbiAqIHNlYXJjaFxuICpcbiAqIEBwYXJhbSAoaW50ZWdlcikgdmFsOlxuICogQHJldHVybiAoYXJyYXkpXG4gKiovXG5JbnRlcnZhbFRyZWUucHJvdG90eXBlLnNlYXJjaCA9IGZ1bmN0aW9uKHZhbDEsIHZhbDIpIHtcbiAgdmFyIHJldCA9IFtdO1xuICBpZiAodHlwZW9mIHZhbDEgIT0gJ251bWJlcicpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IodmFsMSArICc6IGludmFsaWQgaW5wdXQnKTtcbiAgfVxuXG4gIGlmICh2YWwyID09IHVuZGVmaW5lZCkge1xuICAgIF9wb2ludFNlYXJjaC5jYWxsKHRoaXMsIHRoaXMucm9vdCwgdmFsMSwgcmV0KTtcbiAgfVxuICBlbHNlIGlmICh0eXBlb2YgdmFsMiA9PSAnbnVtYmVyJykge1xuICAgIF9yYW5nZVNlYXJjaC5jYWxsKHRoaXMsIHZhbDEsIHZhbDIsIHJldCk7XG4gIH1cbiAgZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKHZhbDEgKyAnLCcgKyB2YWwyICsgJzogaW52YWxpZCBpbnB1dCcpO1xuICB9XG4gIHJldHVybiByZXQ7XG59O1xuXG5cbi8qKlxuICogcmVtb3ZlOiBcbiAqKi9cbkludGVydmFsVHJlZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oaW50ZXJ2YWxfaWQpIHtcbiAgdGhyb3cgXCIucmVtb3ZlKCkgaXMgY3VycmVudGx5IHVuaW1wbGVtZW50ZWRcIjtcbn07XG5cblxuXG4vKipcbiAqIHByaXZhdGUgbWV0aG9kc1xuICoqL1xuXG4vLyB0aGUgc2hpZnQtcmlnaHQtYW5kLWZpbGwgb3BlcmF0b3IsIGV4dGVuZGVkIGJleW9uZCB0aGUgcmFuZ2Ugb2YgYW4gaW50MzJcbmZ1bmN0aW9uIF9iaXRTaGlmdFJpZ2h0KG51bSkge1xuICBpZiAobnVtID4gMjE0NzQ4MzY0NyB8fCBudW0gPCAtMjE0NzQ4MzY0OCkgeyByZXR1cm4gTWF0aC5mbG9vcihudW0gLyAyKTsgfVxuICByZXR1cm4gbnVtID4+PiAxO1xufVxuXG4vKipcbiAqIF9pbnNlcnRcbiAqKi9cbmZ1bmN0aW9uIF9pbnNlcnQobm9kZSwgaXR2bCkge1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIGlmIChpdHZsLmVuZCA8IG5vZGUuaWR4KSB7XG4gICAgICBpZiAoIW5vZGUubGVmdCkge1xuICAgICAgICBub2RlLmxlZnQgPSBuZXcgTm9kZShfYml0U2hpZnRSaWdodChpdHZsLnN0YXJ0ICsgaXR2bC5lbmQpLCB0aGlzKTtcbiAgICAgIH1cbiAgICAgIG5vZGUgPSBub2RlLmxlZnQ7XG4gICAgfSBlbHNlIGlmIChub2RlLmlkeCA8IGl0dmwuc3RhcnQpIHtcbiAgICAgIGlmICghbm9kZS5yaWdodCkge1xuICAgICAgICBub2RlLnJpZ2h0ID0gbmV3IE5vZGUoX2JpdFNoaWZ0UmlnaHQoaXR2bC5zdGFydCArIGl0dmwuZW5kKSwgdGhpcyk7XG4gICAgICB9XG4gICAgICBub2RlID0gbm9kZS5yaWdodDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG5vZGUuaW5zZXJ0KGl0dmwpO1xuICAgIH1cbiAgfVxufVxuXG5cbi8qKlxuICogX3BvaW50U2VhcmNoXG4gKiBAcGFyYW0gKE5vZGUpIG5vZGVcbiAqIEBwYXJhbSAoaW50ZWdlcikgaWR4IFxuICogQHBhcmFtIChBcnJheSkgYXJyXG4gKiovXG5mdW5jdGlvbiBfcG9pbnRTZWFyY2gobm9kZSwgaWR4LCBhcnIpIHtcbiAgd2hpbGUgKHRydWUpIHtcbiAgICBpZiAoIW5vZGUpIGJyZWFrO1xuICAgIGlmIChpZHggPCBub2RlLmlkeCkge1xuICAgICAgbm9kZS5zdGFydHMuYXJyLmV2ZXJ5KGZ1bmN0aW9uKGl0dmwpIHtcbiAgICAgICAgdmFyIGJvb2wgPSAoaXR2bC5zdGFydCA8PSBpZHgpO1xuICAgICAgICBpZiAoYm9vbCkgYXJyLnB1c2goaXR2bC5yZXN1bHQoKSk7XG4gICAgICAgIHJldHVybiBib29sO1xuICAgICAgfSk7XG4gICAgICBub2RlID0gbm9kZS5sZWZ0O1xuICAgIH0gZWxzZSBpZiAoaWR4ID4gbm9kZS5pZHgpIHtcbiAgICAgIG5vZGUuZW5kcy5hcnIuZXZlcnkoZnVuY3Rpb24oaXR2bCkge1xuICAgICAgICB2YXIgYm9vbCA9IChpdHZsLmVuZCA+PSBpZHgpO1xuICAgICAgICBpZiAoYm9vbCkgYXJyLnB1c2goaXR2bC5yZXN1bHQoKSk7XG4gICAgICAgIHJldHVybiBib29sO1xuICAgICAgfSk7XG4gICAgICBub2RlID0gbm9kZS5yaWdodDtcbiAgICB9IGVsc2Uge1xuICAgICAgbm9kZS5zdGFydHMuYXJyLm1hcChmdW5jdGlvbihpdHZsKSB7IGFyci5wdXNoKGl0dmwucmVzdWx0KCkpIH0pO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG59XG5cblxuXG4vKipcbiAqIF9yYW5nZVNlYXJjaFxuICogQHBhcmFtIChpbnRlZ2VyKSBzdGFydFxuICogQHBhcmFtIChpbnRlZ2VyKSBlbmRcbiAqIEBwYXJhbSAoQXJyYXkpIGFyclxuICoqL1xuZnVuY3Rpb24gX3JhbmdlU2VhcmNoKHN0YXJ0LCBlbmQsIGFycikge1xuICBpZiAoZW5kIC0gc3RhcnQgPD0gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcignZW5kIG11c3QgYmUgZ3JlYXRlciB0aGFuIHN0YXJ0LiBzdGFydDogJyArIHN0YXJ0ICsgJywgZW5kOiAnICsgZW5kKTtcbiAgfVxuICB2YXIgcmVzdWx0SGFzaCA9IHt9O1xuXG4gIHZhciB3aG9sZVdyYXBzID0gW107XG4gIF9wb2ludFNlYXJjaC5jYWxsKHRoaXMsIHRoaXMucm9vdCwgX2JpdFNoaWZ0UmlnaHQoc3RhcnQgKyBlbmQpLCB3aG9sZVdyYXBzLCB0cnVlKTtcblxuICB3aG9sZVdyYXBzLmZvckVhY2goZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgcmVzdWx0SGFzaFtyZXN1bHQuaWRdID0gdHJ1ZTtcbiAgfSk7XG5cblxuICB2YXIgaWR4MSA9IHRoaXMucG9pbnRUcmVlLmJzZWFyY2goW3N0YXJ0LCBudWxsXSk7XG4gIHdoaWxlIChpZHgxID49IDAgJiYgdGhpcy5wb2ludFRyZWUuYXJyW2lkeDFdWzBdID09IHN0YXJ0KSB7XG4gICAgaWR4MS0tO1xuICB9XG5cbiAgdmFyIGlkeDIgPSB0aGlzLnBvaW50VHJlZS5ic2VhcmNoKFtlbmQsICAgbnVsbF0pO1xuICB2YXIgbGVuID0gdGhpcy5wb2ludFRyZWUuYXJyLmxlbmd0aCAtIDE7XG4gIHdoaWxlIChpZHgyID09IC0xIHx8IChpZHgyIDw9IGxlbiAmJiB0aGlzLnBvaW50VHJlZS5hcnJbaWR4Ml1bMF0gPD0gZW5kKSkge1xuICAgIGlkeDIrKztcbiAgfVxuXG4gIHRoaXMucG9pbnRUcmVlLmFyci5zbGljZShpZHgxICsgMSwgaWR4MikuZm9yRWFjaChmdW5jdGlvbihwb2ludCkge1xuICAgIHZhciBpZCA9IHBvaW50WzFdO1xuICAgIHJlc3VsdEhhc2hbaWRdID0gdHJ1ZTtcbiAgfSwgdGhpcyk7XG5cbiAgT2JqZWN0LmtleXMocmVzdWx0SGFzaCkuZm9yRWFjaChmdW5jdGlvbihpZCkge1xuICAgIHZhciBpdHZsID0gdGhpcy5pbnRlcnZhbEhhc2hbaWRdO1xuICAgIGFyci5wdXNoKGl0dmwucmVzdWx0KHN0YXJ0LCBlbmQpKTtcbiAgfSwgdGhpcyk7XG5cbn1cblxuXG5cbi8qKlxuICogc3ViY2xhc3Nlc1xuICogXG4gKiovXG5cblxuLyoqXG4gKiBOb2RlIDogcHJvdG90eXBlIG9mIGVhY2ggbm9kZSBpbiBhIGludGVydmFsIHRyZWVcbiAqIFxuICoqL1xuZnVuY3Rpb24gTm9kZShpZHgpIHtcbiAgdGhpcy5pZHggPSBpZHg7XG4gIHRoaXMuc3RhcnRzID0gbmV3IFNvcnRlZExpc3Qoe1xuICAgIGNvbXBhcmU6IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgIGlmIChhID09IG51bGwpIHJldHVybiAtMTtcbiAgICAgIGlmIChiID09IG51bGwpIHJldHVybiAgMTtcbiAgICAgIHZhciBjID0gYS5zdGFydCAtIGIuc3RhcnQ7XG4gICAgICByZXR1cm4gKGMgPiAwKSA/IDEgOiAoYyA9PSAwKSAgPyAwIDogLTE7XG4gICAgfVxuICB9KTtcblxuICB0aGlzLmVuZHMgPSBuZXcgU29ydGVkTGlzdCh7XG4gICAgY29tcGFyZTogZnVuY3Rpb24oYSwgYikge1xuICAgICAgaWYgKGEgPT0gbnVsbCkgcmV0dXJuIC0xO1xuICAgICAgaWYgKGIgPT0gbnVsbCkgcmV0dXJuICAxO1xuICAgICAgdmFyIGMgPSBhLmVuZCAtIGIuZW5kO1xuICAgICAgcmV0dXJuIChjIDwgMCkgPyAxIDogKGMgPT0gMCkgID8gMCA6IC0xO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIGluc2VydCBhbiBJbnRlcnZhbCBvYmplY3QgdG8gdGhpcyBub2RlXG4gKiovXG5Ob2RlLnByb3RvdHlwZS5pbnNlcnQgPSBmdW5jdGlvbihpbnRlcnZhbCkge1xuICB0aGlzLnN0YXJ0cy5pbnNlcnQoaW50ZXJ2YWwpO1xuICB0aGlzLmVuZHMuaW5zZXJ0KGludGVydmFsKTtcbn07XG5cblxuXG4vKipcbiAqIEludGVydmFsIDogcHJvdG90eXBlIG9mIGludGVydmFsIGluZm9cbiAqKi9cbmZ1bmN0aW9uIEludGVydmFsKGRhdGEsIGlkLCBzLCBlKSB7XG4gIHRoaXMuaWQgICAgID0gaWQ7XG4gIHRoaXMuc3RhcnQgID0gZGF0YVtzXTtcbiAgdGhpcy5lbmQgICAgPSBkYXRhW2VdO1xuICB0aGlzLmRhdGEgICA9IGRhdGE7XG5cbiAgaWYgKHR5cGVvZiB0aGlzLnN0YXJ0ICE9ICdudW1iZXInIHx8IHR5cGVvZiB0aGlzLmVuZCAhPSAnbnVtYmVyJykge1xuICAgIHRocm93IG5ldyBFcnJvcignc3RhcnQsIGVuZCBtdXN0IGJlIG51bWJlci4gc3RhcnQ6ICcgKyB0aGlzLnN0YXJ0ICsgJywgZW5kOiAnICsgdGhpcy5lbmQpO1xuICB9XG5cbiAgaWYgKCB0aGlzLnN0YXJ0ID49IHRoaXMuZW5kKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzdGFydCBtdXN0IGJlIHNtYWxsZXIgdGhhbiBlbmQuIHN0YXJ0OiAnICsgdGhpcy5zdGFydCArICcsIGVuZDogJyArIHRoaXMuZW5kKTtcbiAgfVxufVxuXG4vKipcbiAqIGdldCByZXN1bHQgb2JqZWN0XG4gKiovXG5JbnRlcnZhbC5wcm90b3R5cGUucmVzdWx0ID0gZnVuY3Rpb24oc3RhcnQsIGVuZCkge1xuICB2YXIgcmV0ID0ge1xuICAgIGlkICAgOiB0aGlzLmlkLFxuICAgIGRhdGEgOiB0aGlzLmRhdGFcbiAgfTtcbiAgaWYgKHR5cGVvZiBzdGFydCA9PSAnbnVtYmVyJyAmJiB0eXBlb2YgZW5kID09ICdudW1iZXInKSB7XG4gICAgLyoqXG4gICAgICogY2FsYyBvdmVybGFwcGluZyByYXRlXG4gICAgICoqL1xuICAgIHZhciBsZWZ0ICA9IE1hdGgubWF4KHRoaXMuc3RhcnQsIHN0YXJ0KTtcbiAgICB2YXIgcmlnaHQgPSBNYXRoLm1pbih0aGlzLmVuZCwgICBlbmQpO1xuICAgIHZhciBsYXBMbiA9IHJpZ2h0IC0gbGVmdDtcbiAgICByZXQucmF0ZTEgPSBsYXBMbiAvIChlbmQgLSBzdGFydCk7XG4gICAgcmV0LnJhdGUyID0gbGFwTG4gLyAodGhpcy5lbmQgLSB0aGlzLnN0YXJ0KTtcbiAgfVxuICByZXR1cm4gcmV0O1xufTtcblxuZnVuY3Rpb24gRHVwbGljYXRlRXJyb3IobWVzc2FnZSkge1xuICAgIHRoaXMubmFtZSA9ICdEdXBsaWNhdGVFcnJvcic7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICB0aGlzLnN0YWNrID0gKG5ldyBFcnJvcigpKS5zdGFjaztcbn1cbkR1cGxpY2F0ZUVycm9yLnByb3RvdHlwZSA9IG5ldyBFcnJvcjtcblxuZXhwb3J0cy5JbnRlcnZhbFRyZWUgPSBJbnRlcnZhbFRyZWU7XG5cbn0pKG1vZHVsZSAmJiBtb2R1bGUuZXhwb3J0cyB8fCB0aGlzKTsiLCIoZnVuY3Rpb24oZXhwb3J0cyl7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gTGluZU1hc2s6IEEgKHZlcnkgY2hlYXApIGFsdGVybmF0aXZlIHRvIEludGVydmFsVHJlZTogYSBzbWFsbCwgMUQgcGl4ZWwgYnVmZmVyIG9mIG9iamVjdHMuID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzLmpzJyksXG4gIGZsb29ySGFjayA9IHV0aWxzLmZsb29ySGFjaztcblxuZnVuY3Rpb24gTGluZU1hc2sod2lkdGgsIGZ1ZGdlKSB7XG4gIHRoaXMuZnVkZ2UgPSBmdWRnZSA9IChmdWRnZSB8fCAxKTtcbiAgdGhpcy5pdGVtcyA9IFtdO1xuICB0aGlzLmxlbmd0aCA9IE1hdGguY2VpbCh3aWR0aCAvIGZ1ZGdlKTtcbiAgdGhpcy5tYXNrID0gZ2xvYmFsLlVpbnQ4QXJyYXkgPyBuZXcgVWludDhBcnJheSh0aGlzLmxlbmd0aCkgOiBuZXcgQXJyYXkodGhpcy5sZW5ndGgpO1xufVxuXG5MaW5lTWFzay5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24oeCwgdywgZGF0YSkge1xuICB2YXIgdXBUbyA9IE1hdGguY2VpbCgoeCArIHcpIC8gdGhpcy5mdWRnZSk7XG4gIHRoaXMuaXRlbXMucHVzaCh7eDogeCwgdzogdywgZGF0YTogZGF0YX0pO1xuICBmb3IgKHZhciBpID0gTWF0aC5tYXgoZmxvb3JIYWNrKHggLyB0aGlzLmZ1ZGdlKSwgMCk7IGkgPCBNYXRoLm1pbih1cFRvLCB0aGlzLmxlbmd0aCk7IGkrKykgeyB0aGlzLm1hc2tbaV0gPSAxOyB9XG59O1xuXG5MaW5lTWFzay5wcm90b3R5cGUuY29uZmxpY3QgPSBmdW5jdGlvbih4LCB3KSB7XG4gIHZhciB1cFRvID0gTWF0aC5jZWlsKCh4ICsgdykgLyB0aGlzLmZ1ZGdlKTtcbiAgZm9yICh2YXIgaSA9IE1hdGgubWF4KGZsb29ySGFjayh4IC8gdGhpcy5mdWRnZSksIDApOyBpIDwgTWF0aC5taW4odXBUbywgdGhpcy5sZW5ndGgpOyBpKyspIHsgaWYgKHRoaXMubWFza1tpXSkgcmV0dXJuIHRydWU7IH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuZXhwb3J0cy5MaW5lTWFzayA9IExpbmVNYXNrO1xuXG59KShtb2R1bGUgJiYgbW9kdWxlLmV4cG9ydHMgfHwgdGhpcyk7IiwiKGZ1bmN0aW9uKGV4cG9ydHMpe1xuICBcbnZhciBJbnRlcnZhbFRyZWUgPSByZXF1aXJlKCcuL0ludGVydmFsVHJlZS5qcycpLkludGVydmFsVHJlZTsgIFxudmFyIF8gPSByZXF1aXJlKCcuLi8uLi8uLi91bmRlcnNjb3JlLm1pbi5qcycpO1xudmFyIHBhcnNlSW50MTAgPSByZXF1aXJlKCcuL3V0aWxzLmpzJykucGFyc2VJbnQxMDtcblxudmFyIFBBSVJJTkdfQ0FOTk9UX01BVEUgPSAwLFxuICBQQUlSSU5HX01BVEVfT05MWSA9IDEsXG4gIFBBSVJJTkdfRFJBV19BU19NQVRFUyA9IDI7XG5cbi8vIFRPRE86IGJhY2twb3J0IHRoaXMgY29kZSBmb3IgSmF2YVNjcmlwdCAxLjU/IHVzaW5nIHVuZGVyc2NvcmUuanNcbi8qKlxuICogV3JhcHMgdHdvIG9mIFNoaW4gU3V6dWtpJ3MgSW50ZXJ2YWxUcmVlcyB0byBzdG9yZSBpbnRlcnZhbHMgdGhhdCAqbWF5KlxuICogYmUgcGFpcmVkLlxuICpcbiAqIEBzZWUgSW50ZXJ2YWxUcmVlKClcbiAqKi9cbmZ1bmN0aW9uIFBhaXJlZEludGVydmFsVHJlZShjZW50ZXIsIHVucGFpcmVkT3B0aW9ucywgcGFpcmVkT3B0aW9ucykge1xuICB2YXIgZGVmYXVsdE9wdGlvbnMgPSB7c3RhcnRLZXk6IDAsIGVuZEtleTogMX07XG4gIFxuICB0aGlzLnVucGFpcmVkID0gbmV3IEludGVydmFsVHJlZShjZW50ZXIsIHVucGFpcmVkT3B0aW9ucyk7XG4gIHRoaXMudW5wYWlyZWRPcHRpb25zID0gXy5leHRlbmQoe30sIGRlZmF1bHRPcHRpb25zLCB1bnBhaXJlZE9wdGlvbnMpO1xuICBcbiAgdGhpcy5wYWlyZWQgPSBuZXcgSW50ZXJ2YWxUcmVlKGNlbnRlciwgcGFpcmVkT3B0aW9ucyk7XG4gIHRoaXMucGFpcmVkT3B0aW9ucyA9IF8uZXh0ZW5kKHtwYWlyaW5nS2V5OiAncW5hbWUnLCBwYWlyZWRMZW5ndGhLZXk6ICd0bGVuJ30sIGRlZmF1bHRPcHRpb25zLCBwYWlyZWRPcHRpb25zKTtcbiAgaWYgKHRoaXMucGFpcmVkT3B0aW9ucy5zdGFydEtleSA9PT0gdGhpcy51bnBhaXJlZE9wdGlvbnMuc3RhcnRLZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3N0YXJ0S2V5IGZvciB1bnBhaXJlZE9wdGlvbnMgYW5kIHBhaXJlZE9wdGlvbnMgbXVzdCBiZSBkaWZmZXJlbnQgaW4gYSBQYWlyZWRJbnRlcnZhbFRyZWUnKTtcbiAgfVxuICBpZiAodGhpcy5wYWlyZWRPcHRpb25zLmVuZEtleSA9PT0gdGhpcy51bnBhaXJlZE9wdGlvbnMuZW5kS2V5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdlbmRLZXkgZm9yIHVucGFpcmVkT3B0aW9ucyBhbmQgcGFpcmVkT3B0aW9ucyBtdXN0IGJlIGRpZmZlcmVudCBpbiBhIFBhaXJlZEludGVydmFsVHJlZScpO1xuICB9XG4gIFxuICB0aGlzLnBhaXJpbmdEaXNhYmxlZCA9IGZhbHNlO1xuICB0aGlzLnBhaXJpbmdNaW5EaXN0YW5jZSA9IHRoaXMucGFpcmluZ01heERpc3RhbmNlID0gbnVsbDtcbn1cblxuXG4vKipcbiAqIHB1YmxpYyBtZXRob2RzXG4gKiovXG5cblxuLyoqXG4gKiBEaXNhYmxlcyBwYWlyaW5nLiBFZmZlY3RpdmVseSBtYWtlcyB0aGlzIGVxdWl2YWxlbnQsIGV4dGVybmFsbHksIHRvIGFuIEludGVydmFsVHJlZS5cbiAqIFRoaXMgaXMgdXNlZnVsIGlmIHdlIGRpc2NvdmVyIHRoYXQgdGhpcyBkYXRhIHNvdXJjZSBkb2Vzbid0IGNvbnRhaW4gcGFpcmVkIHJlYWRzLlxuICoqL1xuUGFpcmVkSW50ZXJ2YWxUcmVlLnByb3RvdHlwZS5kaXNhYmxlUGFpcmluZyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnBhaXJpbmdEaXNhYmxlZCA9IHRydWU7XG4gIHRoaXMucGFpcmVkID0gdGhpcy51bnBhaXJlZDtcbn07XG5cblxuLyoqXG4gKiBTZXQgYW4gaW50ZXJ2YWwgd2l0aGluIHdoaWNoIHBhaXJlZCBtYXRlcyB3aWxsIGJlIHNhdmVkIGFzIGEgY29udGludW91cyBmZWF0dXJlIGluIC5wYWlyZWRcbiAqXG4gKiBAcGFyYW0gKG51bWJlcikgbWluOiBNaW5pbXVtIGRpc3RhbmNlLCBpbiBicFxuICogQHBhcmFtIChudW1iZXIpIG1heDogTWF4aW11bSBkaXN0YW5jZSwgaW4gYnBcbiAqKi9cblBhaXJlZEludGVydmFsVHJlZS5wcm90b3R5cGUuc2V0UGFpcmluZ0ludGVydmFsID0gZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgaWYgKHR5cGVvZiBtaW4gIT0gJ251bWJlcicpIHsgdGhyb3cgbmV3IEVycm9yKCd5b3UgbXVzdCBzcGVjaWZ5IG1pbiBhcyB0aGUgMXN0IGFyZ3VtZW50LicpOyB9XG4gIGlmICh0eXBlb2YgbWF4ICE9ICdudW1iZXInKSB7IHRocm93IG5ldyBFcnJvcigneW91IG11c3Qgc3BlY2lmeSBtYXggYXMgdGhlIDJuZCBhcmd1bWVudC4nKTsgfVxuICBpZiAodGhpcy5wYWlyaW5nTWluRGlzdGFuY2UgIT09IG51bGwpIHsgdGhyb3cgbmV3IEVycm9yKCdDYW4gb25seSBiZSBjYWxsZWQgb25jZS4gWW91IGNhblxcJ3QgY2hhbmdlIHRoZSBwYWlyaW5nIGludGVydmFsLicpOyB9XG4gIFxuICB0aGlzLnBhaXJpbmdNaW5EaXN0YW5jZSA9IG1pbjtcbiAgdGhpcy5wYWlyaW5nTWF4RGlzdGFuY2UgPSBtYXg7XG59O1xuXG5cbi8qKlxuICogYWRkIG5ldyByYW5nZSBvbmx5IGlmIGl0IGlzIG5ldywgYmFzZWQgb24gd2hldGhlciB0aGUgaWQgd2FzIGFscmVhZHkgcmVnaXN0ZXJlZFxuICoqL1xuUGFpcmVkSW50ZXJ2YWxUcmVlLnByb3RvdHlwZS5hZGRJZk5ldyA9IGZ1bmN0aW9uKGRhdGEsIGlkKSB7XG4gIHZhciBtYXRlZCA9IGZhbHNlLFxuICAgIGluY3JlbWVudCA9IDAsXG4gICAgdW5wYWlyZWRTdGFydCA9IHRoaXMudW5wYWlyZWRPcHRpb25zLnN0YXJ0S2V5LFxuICAgIHVucGFpcmVkRW5kID0gdGhpcy51bnBhaXJlZE9wdGlvbnMuZW5kS2V5LFxuICAgIHBhaXJlZFN0YXJ0ID0gdGhpcy5wYWlyZWRPcHRpb25zLnN0YXJ0S2V5LFxuICAgIHBhaXJlZEVuZCA9IHRoaXMucGFpcmVkT3B0aW9ucy5lbmRLZXksXG4gICAgcGFpcmVkTGVuZ3RoID0gZGF0YVt0aGlzLnBhaXJlZE9wdGlvbnMucGFpcmVkTGVuZ3RoS2V5XSxcbiAgICBwYWlyaW5nU3RhdGUgPSBQQUlSSU5HX0NBTk5PVF9NQVRFLFxuICAgIG5ld0lkLCBwb3RlbnRpYWxNYXRlO1xuICBcbiAgLy8gLnVucGFpcmVkIGNvbnRhaW5zIGV2ZXJ5IGFsaWdubWVudCBhcyBhIHNlcGFyYXRlIGludGVydmFsLlxuICAvLyBJZiBpdCBhbHJlYWR5IGNvbnRhaW5zIHRoaXMgaWQsIHdlJ3ZlIHNlZW4gdGhpcyByZWFkIGJlZm9yZSBhbmQgc2hvdWxkIGRpc3JlZ2FyZC5cbiAgaWYgKHRoaXMudW5wYWlyZWQuY29udGFpbnMoaWQpKSB7IHJldHVybjsgfVxuICB0aGlzLnVucGFpcmVkLmFkZChkYXRhLCBpZCk7XG4gIFxuICAvLyAucGFpcmVkIGNvbnRhaW5zIGFsaWdubWVudHMgdGhhdCBtYXkgYmUgbWF0ZWQgaW50byBvbmUgaW50ZXJ2YWwgaWYgdGhleSBhcmUgd2l0aGluIHRoZSBwYWlyaW5nIHJhbmdlXG4gIGlmICghdGhpcy5wYWlyaW5nRGlzYWJsZWQgJiYgX2VsaWdpYmxlRm9yUGFpcmluZyh0aGlzLCBkYXRhKSkge1xuICAgIGlmICh0aGlzLnBhaXJpbmdNaW5EaXN0YW5jZSA9PT0gbnVsbCkgeyBcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2FuIG9ubHkgYWRkIHBhaXJlZCBkYXRhIGFmdGVyIHRoZSBwYWlyaW5nIGludGVydmFsIGhhcyBiZWVuIHNldCEnKTtcbiAgICB9XG4gICAgXG4gICAgLy8gaW5zdGVhZCBvZiBzdG9yaW5nIHRoZW0gd2l0aCB0aGUgZ2l2ZW4gaWQsIHRoZSBwYWlyaW5nS2V5IChmb3IgQkFNLCBRTkFNRSkgaXMgdXNlZCBhcyB0aGUgaWQuXG4gICAgLy8gQXMgaW50ZXJ2YWxzIGFyZSBhZGRlZCwgd2UgY2hlY2sgaWYgYSByZWFkIHdpdGggdGhlIHNhbWUgcGFpcmluZ0tleSBhbHJlYWR5IGV4aXN0cyBpbiB0aGUgLnBhaXJlZCBJbnRlcnZhbFRyZWUuXG4gICAgbmV3SWQgPSBkYXRhW3RoaXMucGFpcmVkT3B0aW9ucy5wYWlyaW5nS2V5XTtcbiAgICBwb3RlbnRpYWxNYXRlID0gdGhpcy5wYWlyZWQuZ2V0KG5ld0lkKTtcbiAgICBcbiAgICBpZiAocG90ZW50aWFsTWF0ZSAhPT0gbnVsbCkge1xuICAgICAgcG90ZW50aWFsTWF0ZSA9IHBvdGVudGlhbE1hdGUuZGF0YTtcbiAgICAgIHBhaXJpbmdTdGF0ZSA9IF9wYWlyaW5nU3RhdGUodGhpcywgZGF0YSwgcG90ZW50aWFsTWF0ZSk7XG4gICAgICAvLyBBcmUgdGhlIHJlYWRzIHN1aXRhYmxlIGZvciBtYXRpbmc/XG4gICAgICBpZiAocGFpcmluZ1N0YXRlID09PSBQQUlSSU5HX0RSQVdfQVNfTUFURVMgfHwgcGFpcmluZ1N0YXRlID09PSBQQUlSSU5HX01BVEVfT05MWSkge1xuICAgICAgICAvLyBJZiB5ZXM6IG1hdGUgdGhlIHJlYWRzXG4gICAgICAgIHBvdGVudGlhbE1hdGUubWF0ZSA9IGRhdGE7XG4gICAgICAgIC8vIEluIHRoZSBvdGhlciBkaXJlY3Rpb24sIGhhcyB0byBiZSBhIHNlbGVjdGl2ZSBzaGFsbG93IGNvcHkgdG8gYXZvaWQgY2lyY3VsYXIgcmVmZXJlbmNlcy5cbiAgICAgICAgZGF0YS5tYXRlID0gXy5leHRlbmQoe30sIF8ub21pdChwb3RlbnRpYWxNYXRlLCBmdW5jdGlvbih2LCBrKSB7IHJldHVybiBfLmlzT2JqZWN0KHYpfSkpO1xuICAgICAgICBkYXRhLm1hdGUuZmxhZ3MgPSBfLmNsb25lKHBvdGVudGlhbE1hdGUuZmxhZ3MpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBBcmUgdGhlIG1hdGVkIHJlYWRzIHdpdGhpbiBkcmF3YWJsZSByYW5nZT8gSWYgc28sIHNpbXBseSBmbGFnIHRoYXQgdGhleSBzaG91bGQgYmUgZHJhd24gdG9nZXRoZXIsIGFuZCB0aGV5IHdpbGwuXG4gICAgLy8gQWx0ZXJuYXRpdmVseSwgaWYgdGhlIHBvdGVudGlhbE1hdGUgZXhwZWN0ZWQgYSBtYXRlLCB3ZSBzaG91bGQgbWF0ZSB0aGVtIGFueXdheS5cbiAgICAvLyBUaGUgb25seSByZWFzb24gd2Ugd291bGRuJ3QgZ2V0IC5kcmF3QXNNYXRlcyBpcyBpZiB0aGUgbWF0ZSB3YXMgb24gdGhlIHRocmVzaG9sZCBvZiB0aGUgaW5zZXJ0IHNpemUgcmFuZ2UuXG4gICAgaWYgKHBhaXJpbmdTdGF0ZSA9PT0gUEFJUklOR19EUkFXX0FTX01BVEVTIHx8IChwYWlyaW5nU3RhdGUgPT09IFBBSVJJTkdfTUFURV9PTkxZICYmIHBvdGVudGlhbE1hdGUubWF0ZUV4cGVjdGVkKSkge1xuICAgICAgZGF0YS5kcmF3QXNNYXRlcyA9IHBvdGVudGlhbE1hdGUuZHJhd0FzTWF0ZXMgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBPdGhlcndpc2UsIG5lZWQgdG8gaW5zZXJ0IHRoaXMgcmVhZCBpbnRvIHRoaXMucGFpcmVkIGFzIGEgc2VwYXJhdGUgcmVhZC5cbiAgICAgIC8vIEVuc3VyZSB0aGUgaWQgaXMgdW5pcXVlIGZpcnN0LlxuICAgICAgd2hpbGUgKHRoaXMucGFpcmVkLmNvbnRhaW5zKG5ld0lkKSkge1xuICAgICAgICBuZXdJZCA9IG5ld0lkLnJlcGxhY2UoL1xcdC4qLywgJycpICsgXCJcXHRcIiArICgrK2luY3JlbWVudCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGRhdGEubWF0ZUV4cGVjdGVkID0gX3BhaXJpbmdTdGF0ZSh0aGlzLCBkYXRhKSA9PT0gUEFJUklOR19EUkFXX0FTX01BVEVTO1xuICAgICAgLy8gRklYTUU6IFRoZSBmb2xsb3dpbmcgaXMgcGVyaGFwcyBhIGJpdCB0b28gc3BlY2lmaWMgdG8gaG93IFRMRU4gZm9yIEJBTSBmaWxlcyB3b3JrczsgY291bGQgZ2VuZXJhbGl6ZSBsYXRlclxuICAgICAgLy8gV2hlbiBpbnNlcnRpbmcgaW50byAucGFpcmVkLCB0aGUgaW50ZXJ2YWwncyAuc3RhcnQgYW5kIC5lbmQgc2hvdWxkbid0IGJlIGJhc2VkIG9uIFBPUyBhbmQgdGhlIENJR0FSIHN0cmluZztcbiAgICAgIC8vIHdlIG11c3QgYWRqdXN0IHRoZW0gZm9yIFRMRU4sIGlmIGl0IGlzIG5vbnplcm8sIGRlcGVuZGluZyBvbiBpdHMgc2lnbiwgYW5kIHNldCBuZXcgYm91bmRzIGZvciB0aGUgaW50ZXJ2YWwuXG4gICAgICBpZiAoZGF0YS5tYXRlRXhwZWN0ZWQgJiYgcGFpcmVkTGVuZ3RoID4gMCkge1xuICAgICAgICBkYXRhW3BhaXJlZFN0YXJ0XSA9IGRhdGFbdW5wYWlyZWRTdGFydF07XG4gICAgICAgIGRhdGFbcGFpcmVkRW5kXSA9IGRhdGFbdW5wYWlyZWRTdGFydF0gKyBwYWlyZWRMZW5ndGg7XG4gICAgICB9IGVsc2UgaWYgKGRhdGEubWF0ZUV4cGVjdGVkICYmIHBhaXJlZExlbmd0aCA8IDApIHtcbiAgICAgICAgZGF0YVtwYWlyZWRFbmRdID0gZGF0YVt1bnBhaXJlZEVuZF07XG4gICAgICAgIGRhdGFbcGFpcmVkU3RhcnRdID0gZGF0YVt1bnBhaXJlZEVuZF0gKyBwYWlyZWRMZW5ndGg7XG4gICAgICB9IGVsc2UgeyAvLyAhZGF0YS5tYXRlRXhwZWN0ZWQgfHwgcGFpcmVkTGVuZ3RoID09IDBcbiAgICAgICAgZGF0YVtwYWlyZWRTdGFydF0gPSBkYXRhW3VucGFpcmVkU3RhcnRdO1xuICAgICAgICBkYXRhW3BhaXJlZEVuZF0gPSBkYXRhW3VucGFpcmVkRW5kXTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhpcy5wYWlyZWQuYWRkKGRhdGEsIG5ld0lkKTtcbiAgICB9XG4gIH1cblxufTtcblxuXG4vKipcbiAqIGFsaWFzIC5hZGQoKSB0byAuYWRkSWZOZXcoKVxuICoqL1xuUGFpcmVkSW50ZXJ2YWxUcmVlLnByb3RvdHlwZS5hZGQgPSBQYWlyZWRJbnRlcnZhbFRyZWUucHJvdG90eXBlLmFkZElmTmV3O1xuXG5cbi8qKlxuICogc2VhcmNoXG4gKlxuICogQHBhcmFtIChudW1iZXIpIHZhbDpcbiAqIEByZXR1cm4gKGFycmF5KVxuICoqL1xuUGFpcmVkSW50ZXJ2YWxUcmVlLnByb3RvdHlwZS5zZWFyY2ggPSBmdW5jdGlvbih2YWwxLCB2YWwyLCBwYWlyZWQpIHtcbiAgaWYgKHBhaXJlZCAmJiAhdGhpcy5wYWlyaW5nRGlzYWJsZWQpIHtcbiAgICByZXR1cm4gdGhpcy5wYWlyZWQuc2VhcmNoKHZhbDEsIHZhbDIpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB0aGlzLnVucGFpcmVkLnNlYXJjaCh2YWwxLCB2YWwyKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIHJlbW92ZTogdW5pbXBsZW1lbnRlZCBmb3Igbm93XG4gKiovXG5QYWlyZWRJbnRlcnZhbFRyZWUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKGludGVydmFsX2lkKSB7XG4gIHRocm93IFwiLnJlbW92ZSgpIGlzIGN1cnJlbnRseSB1bmltcGxlbWVudGVkXCI7XG59O1xuXG5cbi8qKlxuICogcHJpdmF0ZSBtZXRob2RzXG4gKiovXG5cbi8vIENoZWNrIGlmIGFuIGl0dmwgaXMgZWxpZ2libGUgZm9yIHBhaXJpbmcuIFxuLy8gRm9yIG5vdywgdGhpcyBtZWFucyB0aGF0IGlmIGFueSBGTEFHJ3MgMHgxMDAgb3IgaGlnaGVyIGFyZSBzZXQsIHdlIHRvdGFsbHkgZGlzY2FyZCB0aGlzIGFsaWdubWVudCBhbmQgaW50ZXJ2YWwuXG4vLyBGSVhNRTogVGhlIGZvbGxvd2luZyBpcyBlbnRhbmdsZWQgd2l0aCBiYW0uanMgaW50ZXJuYWxzOyBwZXJoYXBzIGFsbG93IHRoaXMgdG8gYmUgZ2VuZXJhbGl6ZWQsIG92ZXJyaWRkZW4sXG4vLyAgICAgICAgb3Igc2V0IGFsb25nc2lkZSAuc2V0UGFpcmluZ0ludGVydmFsKClcbi8vXG4vLyBAcmV0dXJuIChib29sZWFuKVxuZnVuY3Rpb24gX2VsaWdpYmxlRm9yUGFpcmluZyhwYWlyZWRJdHZsVHJlZSwgaXR2bCkge1xuICB2YXIgZmxhZ3MgPSBpdHZsLmZsYWdzO1xuICBpZiAoZmxhZ3MuaXNTZWNvbmRhcnlBbGlnbm1lbnQgfHwgZmxhZ3MuaXNSZWFkRmFpbGluZ1ZlbmRvclFDIHx8IGZsYWdzLmlzRHVwbGljYXRlUmVhZCB8fCBmbGFncy5pc1N1cHBsZW1lbnRhcnlBbGlnbm1lbnQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbi8vIENoZWNrIGlmIGFuIGl0dmwgYW5kIGl0cyBwb3RlbnRpYWxNYXRlIGFyZSB3aXRoaW4gdGhlIHJpZ2h0IGRpc3RhbmNlLCBhbmQgb3JpZW50YXRpb24sIHRvIGJlIG1hdGVkLlxuLy8gSWYgcG90ZW50aWFsTWF0ZSBpc24ndCBnaXZlbiwgdGFrZXMgYSBiZXN0IGd1ZXNzIGlmIGEgbWF0ZSBpcyBleHBlY3RlZCwgZ2l2ZW4gdGhlIGluZm9ybWF0aW9uIGluIGl0dmwgYWxvbmUuXG4vLyBGSVhNRTogVGhlIGZvbGxvd2luZyBpcyBlbnRhbmdsZWQgd2l0aCBiYW0uanMgaW50ZXJuYWxzOyBwZXJoYXBzIGFsbG93IHRoaXMgdG8gYmUgZ2VuZXJhbGl6ZWQsIG92ZXJyaWRkZW4sXG4vLyAgICAgICAgb3Igc2V0IGFsb25nc2lkZSAuc2V0UGFpcmluZ0ludGVydmFsKClcbi8vIFxuLy8gQHJldHVybiAobnVtYmVyKVxuZnVuY3Rpb24gX3BhaXJpbmdTdGF0ZShwYWlyZWRJdHZsVHJlZSwgaXR2bCwgcG90ZW50aWFsTWF0ZSkge1xuICB2YXIgdGxlbiA9IGl0dmxbcGFpcmVkSXR2bFRyZWUucGFpcmVkT3B0aW9ucy5wYWlyZWRMZW5ndGhLZXldLFxuICAgIGl0dmxMZW5ndGggPSBpdHZsLmVuZCAtIGl0dmwuc3RhcnQsXG4gICAgaXR2bElzTGF0ZXIsIGluZmVycmVkSW5zZXJ0U2l6ZTtcblxuICBpZiAoXy5pc1VuZGVmaW5lZChwb3RlbnRpYWxNYXRlKSkge1xuICAgIC8vIENyZWF0ZSB0aGUgbW9zdCByZWNlcHRpdmUgaHlwb3RoZXRpY2FsIG1hdGUsIGdpdmVuIHRoZSBpbmZvcm1hdGlvbiBpbiBpdHZsLlxuICAgIHBvdGVudGlhbE1hdGUgPSB7XG4gICAgICBfbW9ja2VkOiB0cnVlLFxuICAgICAgZmxhZ3M6IHtcbiAgICAgICAgaXNSZWFkUGFpcmVkOiB0cnVlLFxuICAgICAgICBpc1JlYWRQcm9wZXJseUFsaWduZWQ6IHRydWUsXG4gICAgICAgIGlzUmVhZEZpcnN0T2ZQYWlyOiBpdHZsLmZsYWdzLmlzUmVhZExhc3RPZlBhaXIsXG4gICAgICAgIGlzUmVhZExhc3RPZlBhaXI6IGl0dmwuZmxhZ3MuaXNSZWFkRmlyc3RPZlBhaXJcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gRmlyc3QgY2hlY2sgYSB3aG9sZSBob3N0IG9mIEZMQUcncy4gVG8gbWFrZSBhIGxvbmcgc3Rvcnkgc2hvcnQsIHdlIGV4cGVjdCBwYWlyZWQgZW5kcyB0byBiZSBlaXRoZXJcbiAgLy8gOTktMTQ3IG9yIDE2My04MywgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIHJpZ2h0bW9zdCBvciBsZWZ0bW9zdCBzZWdtZW50IGlzIHByaW1hcnkuXG4gIGlmICghaXR2bC5mbGFncy5pc1JlYWRQYWlyZWQgfHwgIXBvdGVudGlhbE1hdGUuZmxhZ3MuaXNSZWFkUGFpcmVkKSB7IHJldHVybiBQQUlSSU5HX0NBTk5PVF9NQVRFOyB9XG4gIGlmICghaXR2bC5mbGFncy5pc1JlYWRQcm9wZXJseUFsaWduZWQgfHwgIXBvdGVudGlhbE1hdGUuZmxhZ3MuaXNSZWFkUHJvcGVybHlBbGlnbmVkKSB7IHJldHVybiBQQUlSSU5HX0NBTk5PVF9NQVRFOyB9XG4gIGlmIChpdHZsLmZsYWdzLmlzUmVhZFVubWFwcGVkIHx8IHBvdGVudGlhbE1hdGUuZmxhZ3MuaXNSZWFkVW5tYXBwZWQpIHsgcmV0dXJuIFBBSVJJTkdfQ0FOTk9UX01BVEU7IH1cbiAgaWYgKGl0dmwuZmxhZ3MuaXNNYXRlVW5tYXBwZWQgfHwgcG90ZW50aWFsTWF0ZS5mbGFncy5pc01hdGVVbm1hcHBlZCkgeyByZXR1cm4gUEFJUklOR19DQU5OT1RfTUFURTsgfVxuICBpZiAoaXR2bC5mbGFncy5pc1JlYWRGaXJzdE9mUGFpciAmJiAhcG90ZW50aWFsTWF0ZS5mbGFncy5pc1JlYWRMYXN0T2ZQYWlyKSB7IHJldHVybiBQQUlSSU5HX0NBTk5PVF9NQVRFOyB9XG4gIGlmIChpdHZsLmZsYWdzLmlzUmVhZExhc3RPZlBhaXIgJiYgIXBvdGVudGlhbE1hdGUuZmxhZ3MuaXNSZWFkRmlyc3RPZlBhaXIpIHsgcmV0dXJuIFBBSVJJTkdfQ0FOTk9UX01BVEU7IH1cbiAgICBcbiAgaWYgKHBvdGVudGlhbE1hdGUuX21vY2tlZCkge1xuICAgIF8uZXh0ZW5kKHBvdGVudGlhbE1hdGUsIHtcbiAgICAgIHJuYW1lOiBpdHZsLnJuZXh0ID09ICc9JyA/IGl0dmwucm5hbWUgOiBpdHZsLnJuZXh0LFxuICAgICAgcG9zOiBpdHZsLnBuZXh0LFxuICAgICAgc3RhcnQ6IGl0dmwucm5leHQgPT0gJz0nID8gcGFyc2VJbnQxMChpdHZsLnBuZXh0KSArIChpdHZsLnN0YXJ0IC0gcGFyc2VJbnQxMChpdHZsLnBvcykpIDogMCxcbiAgICAgIGVuZDogdGxlbiA+IDAgPyBpdHZsLnN0YXJ0ICsgdGxlbiA6ICh0bGVuIDwgMCA/IGl0dmwuZW5kICsgdGxlbiArIGl0dmxMZW5ndGggOiAwKSxcbiAgICAgIHJuZXh0OiBpdHZsLnJuZXh0ID09ICc9JyA/ICc9JyA6IGl0dmwucm5hbWUsXG4gICAgICBwbmV4dDogaXR2bC5wb3NcbiAgICB9KTtcbiAgfVxuICBcbiAgLy8gQ2hlY2sgdGhhdCB0aGUgYWxpZ25tZW50cyBhcmUgb24gdGhlIHNhbWUgcmVmZXJlbmNlIHNlcXVlbmNlXG4gIGlmIChpdHZsLnJuZXh0ICE9ICc9JyB8fCBwb3RlbnRpYWxNYXRlLnJuZXh0ICE9ICc9JykgeyBcbiAgICAvLyBhbmQgaWYgbm90LCBkbyB0aGUgY29vcmRpbmF0ZXMgbWF0Y2ggYXQgYWxsP1xuICAgIGlmIChpdHZsLnJuZXh0ICE9IHBvdGVudGlhbE1hdGUucm5hbWUgfHwgaXR2bC5ybmV4dCAhPSBwb3RlbnRpYWxNYXRlLnJuYW1lKSB7IHJldHVybiBQQUlSSU5HX0NBTk5PVF9NQVRFOyB9XG4gICAgaWYgKGl0dmwucG5leHQgIT0gcG90ZW50aWFsTWF0ZS5wb3MgfHwgaXR2bC5wb3MgIT0gcG90ZW50aWFsTWF0ZS5wbmV4dCkgeyByZXR1cm4gUEFJUklOR19DQU5OT1RfTUFURTsgfVxuICAgIHJldHVybiBQQUlSSU5HX01BVEVfT05MWTtcbiAgfVxuICBcbiAgaWYgKHBvdGVudGlhbE1hdGUuX21vY2tlZCkge1xuICAgIF8uZXh0ZW5kKHBvdGVudGlhbE1hdGUuZmxhZ3MsIHtcbiAgICAgIHJlYWRTdHJhbmRSZXZlcnNlOiBpdHZsLmZsYWdzLm1hdGVTdHJhbmRSZXZlcnNlLFxuICAgICAgbWF0ZVN0cmFuZFJldmVyc2U6IGl0dmwuZmxhZ3MucmVhZFN0cmFuZFJldmVyc2VcbiAgICB9KTtcbiAgfSBcbiAgXG4gIGl0dmxJc0xhdGVyID0gaXR2bC5zdGFydCA+IHBvdGVudGlhbE1hdGUuc3RhcnQ7XG4gIGluZmVycmVkSW5zZXJ0U2l6ZSA9IE1hdGguYWJzKHRsZW4pO1xuICBcbiAgLy8gQ2hlY2sgdGhhdCB0aGUgYWxpZ25tZW50cyBhcmUgLS0+IDwtLVxuICBpZiAoaXR2bElzTGF0ZXIpIHtcbiAgICBpZiAoIWl0dmwuZmxhZ3MucmVhZFN0cmFuZFJldmVyc2UgfHwgaXR2bC5mbGFncy5tYXRlU3RyYW5kUmV2ZXJzZSkgeyByZXR1cm4gUEFJUklOR19NQVRFX09OTFk7IH1cbiAgICBpZiAocG90ZW50aWFsTWF0ZS5mbGFncy5yZWFkU3RyYW5kUmV2ZXJzZSB8fCAhcG90ZW50aWFsTWF0ZS5mbGFncy5tYXRlU3RyYW5kUmV2ZXJzZSkgeyByZXR1cm4gUEFJUklOR19NQVRFX09OTFk7IH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoaXR2bC5mbGFncy5yZWFkU3RyYW5kUmV2ZXJzZSB8fCAhaXR2bC5mbGFncy5tYXRlU3RyYW5kUmV2ZXJzZSkgeyByZXR1cm4gUEFJUklOR19NQVRFX09OTFk7IH1cbiAgICBpZiAoIXBvdGVudGlhbE1hdGUuZmxhZ3MucmVhZFN0cmFuZFJldmVyc2UgfHwgcG90ZW50aWFsTWF0ZS5mbGFncy5tYXRlU3RyYW5kUmV2ZXJzZSkgeyByZXR1cm4gUEFJUklOR19NQVRFX09OTFk7IH1cbiAgfVxuICBcbiAgLy8gQ2hlY2sgdGhhdCB0aGUgaW5mZXJyZWRJbnNlcnRTaXplIGlzIHdpdGhpbiB0aGUgYWNjZXB0YWJsZSByYW5nZS5cbiAgaXR2bC5pbnNlcnRTaXplID0gcG90ZW50aWFsTWF0ZS5pbnNlcnRTaXplID0gaW5mZXJyZWRJbnNlcnRTaXplO1xuICBpZiAoaW5mZXJyZWRJbnNlcnRTaXplID4gdGhpcy5wYWlyaW5nTWF4RGlzdGFuY2UgfHwgaW5mZXJyZWRJbnNlcnRTaXplIDwgdGhpcy5wYWlyaW5nTWluRGlzdGFuY2UpIHsgcmV0dXJuIFBBSVJJTkdfTUFURV9PTkxZOyB9XG4gIFxuICByZXR1cm4gUEFJUklOR19EUkFXX0FTX01BVEVTO1xufVxuXG5leHBvcnRzLlBhaXJlZEludGVydmFsVHJlZSA9IFBhaXJlZEludGVydmFsVHJlZTtcblxufSkobW9kdWxlICYmIG1vZHVsZS5leHBvcnRzIHx8IHRoaXMpOyIsIihmdW5jdGlvbihleHBvcnRzKXtcblxudmFyIF8gPSByZXF1aXJlKCcuLi8uLi8uLi91bmRlcnNjb3JlLm1pbi5qcycpO1xuXG4vKipcbiAgKiBSZW1vdGVUcmFja1xuICAqXG4gICogQSBoZWxwZXIgY2xhc3MgYnVpbHQgZm9yIGNhY2hpbmcgZGF0YSBmZXRjaGVkIGZyb20gYSByZW1vdGUgdHJhY2sgKGRhdGEgYWxpZ25lZCB0byBhIGdlbm9tZSkuXG4gICogVGhlIGdlbm9tZSBpcyBkaXZpZGVkIGludG8gYmlucyBvZiBvcHRpbWFsRmV0Y2hXaW5kb3cgbnRzLCBmb3IgZWFjaCBvZiB3aGljaCBkYXRhIHdpbGwgb25seSBiZSBmZXRjaGVkIG9uY2UuXG4gICogVG8gc2V0dXAgdGhlIGJpbnMsIGNhbGwgLnNldHVwQmlucyguLi4pIGFmdGVyIGluaXRpYWxpemluZyB0aGUgY2xhc3MuXG4gICpcbiAgKiBUaGVyZSBpcyBvbmUgbWFpbiBwdWJsaWMgbWV0aG9kIGZvciB0aGlzIGNsYXNzOiAuZmV0Y2hBc3luYyhzdGFydCwgZW5kLCBjYWxsYmFjaylcbiAgKiAoRm9yIGNvbnNpc3RlbmN5IHdpdGggQ3VzdG9tVHJhY2tzLmpzLCBhbGwgYHN0YXJ0YCBhbmQgYGVuZGAgcG9zaXRpb25zIGFyZSAxLWJhc2VkLCBvcmllbnRlZCB0b1xuICAqIHRoZSBzdGFydCBvZiB0aGUgZ2Vub21lLCBhbmQgaW50ZXJ2YWxzIGFyZSByaWdodC1vcGVuLilcbiAgKlxuICAqIFRoaXMgbWV0aG9kIHdpbGwgcmVxdWVzdCBhbmQgY2FjaGUgZGF0YSBmb3IgdGhlIGdpdmVuIGludGVydmFsIHRoYXQgaXMgbm90IGFscmVhZHkgY2FjaGVkLCBhbmQgY2FsbCBcbiAgKiBjYWxsYmFjayhpbnRlcnZhbHMpIGFzIHNvb24gYXMgZGF0YSBmb3IgYWxsIGludGVydmFscyBpcyBhdmFpbGFibGUuIChJZiB0aGUgZGF0YSBpcyBhbHJlYWR5IGF2YWlsYWJsZSwgXG4gICogaXQgd2lsbCBjYWxsIHRoZSBjYWxsYmFjayBpbW1lZGlhdGVseS4pXG4gICoqL1xuXG52YXIgQklOX0xPQURJTkcgPSAxLFxuICBCSU5fTE9BREVEID0gMjtcblxuLyoqXG4gICogUmVtb3RlVHJhY2sgY29uc3RydWN0b3IuXG4gICpcbiAgKiBOb3RlIHlvdSBzdGlsbCBtdXN0IGNhbGwgYC5zZXR1cEJpbnMoLi4uKWAgYmVmb3JlIHRoZSBSZW1vdGVUcmFjayBpcyByZWFkeSB0byBmZXRjaCBkYXRhLlxuICAqXG4gICogQHBhcmFtIChJbnRlcnZhbFRyZWUpIGNhY2hlOiBBbiBjYWNoZSBzdG9yZSB0aGF0IHdpbGwgcmVjZWl2ZSBpbnRlcnZhbHMgZmV0Y2hlZCBmb3IgZWFjaCBiaW4uXG4gICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG91bGQgYmUgYW4gSW50ZXJ2YWxUcmVlIG9yIGVxdWl2YWxlbnQsIHRoYXQgaW1wbGVtZW50cyBgLmFkZElmTmV3KC4uLilgIGFuZCBcbiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAuc2VhcmNoKHN0YXJ0LCBlbmQpYCBtZXRob2RzLiBJZiBpdCBpcyBhbiAqZXh0ZW5zaW9uKiBvZiBhbiBJbnRlcnZhbFRyZWUsIG5vdGUgXG4gICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgYGV4dHJhQXJnc2AgcGFyYW0gcGVybWl0dGVkIGZvciBgLmZldGNoQXN5bmMoKWAsIHdoaWNoIGFyZSBwYXNzZWQgYWxvbmcgYXMgXG4gICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYSBhcmd1bWVudHMgdG8gYC5zZWFyY2goKWAuXG4gICogQHBhcmFtIChmdW5jdGlvbikgZmV0Y2hlcjogQSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIHRvIGZldGNoIGRhdGEgZm9yIGVhY2ggYmluLlxuICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoaXMgZnVuY3Rpb24gc2hvdWxkIHRha2UgdGhyZWUgYXJndW1lbnRzLCBgc3RhcnRgLCBgZW5kYCwgYW5kIGBzdG9yZUludGVydmFsc2AuXG4gICogICAgICAgICAgICAgICAgICAgICAgICAgICAgYHN0YXJ0YCBhbmQgYGVuZGAgYXJlIDEtYmFzZWQgZ2Vub21pYyBjb29yZGluYXRlcyBmb3JtaW5nIGEgcmlnaHQtb3BlbiBpbnRlcnZhbC5cbiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgc3RvcmVJbnRlcnZhbHNgIGlzIGEgY2FsbGJhY2sgdGhhdCBgZmV0Y2hlcmAgTVVTVCBjYWxsIG9uIHRoZSBhcnJheSBvZiBpbnRlcnZhbHNcbiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNlIHRoZXkgaGF2ZSBiZWVuIGZldGNoZWQgZnJvbSB0aGUgcmVtb3RlIGRhdGEgc291cmNlIGFuZCBwYXJzZWQuXG4gICogQHNlZSBfZmV0Y2hCaW4gZm9yIGhvdyBgZmV0Y2hlcmAgaXMgdXRpbGl6ZWQuXG4gICoqL1xuZnVuY3Rpb24gUmVtb3RlVHJhY2soY2FjaGUsIGZldGNoZXIpIHtcbiAgaWYgKHR5cGVvZiBjYWNoZSAhPSAnb2JqZWN0JyB8fCAoIWNhY2hlLmFkZElmTmV3ICYmICghXy5rZXlzKGNhY2hlKS5sZW5ndGggfHwgY2FjaGVbXy5rZXlzKGNhY2hlKVswXV0uYWRkSWZOZXcpKSkgeyBcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3lvdSBtdXN0IHNwZWNpZnkgYW4gSW50ZXJ2YWxUcmVlIGNhY2hlLCBvciBhbiBvYmplY3QvYXJyYXkgY29udGFpbmluZyBJbnRlcnZhbFRyZWVzLCBhcyB0aGUgMXN0IGFyZ3VtZW50LicpOyBcbiAgfVxuICBpZiAodHlwZW9mIGZldGNoZXIgIT0gJ2Z1bmN0aW9uJykgeyB0aHJvdyBuZXcgRXJyb3IoJ3lvdSBtdXN0IHNwZWNpZnkgYSBmZXRjaGVyIGZ1bmN0aW9uIGFzIHRoZSAybmQgYXJndW1lbnQuJyk7IH1cbiAgXG4gIHRoaXMuY2FjaGUgPSBjYWNoZTtcbiAgdGhpcy5mZXRjaGVyID0gZmV0Y2hlcjtcbiAgXG4gIHRoaXMuY2FsbGJhY2tzID0gW107XG4gIHRoaXMuYWZ0ZXJCaW5TZXR1cCA9IFtdO1xuICB0aGlzLmJpbnNMb2FkZWQgPSBudWxsO1xufVxuXG4vKipcbiAqIHB1YmxpYyBtZXRob2RzXG4gKiovXG5cbi8vIFNldHVwIHRoZSBiaW5uaW5nIHNjaGVtZSBmb3IgdGhpcyBSZW1vdGVUcmFjay4gVGhpcyBjYW4gb2NjdXIgYW55dGltZSBhZnRlciBpbml0aWFsaXphdGlvbiwgYW5kIGluIGZhY3QsXG4vLyBjYW4gb2NjdXIgYWZ0ZXIgY2FsbHMgdG8gYC5mZXRjaEFzeW5jKClgIGhhdmUgYmVlbiBtYWRlLCBpbiB3aGljaCBjYXNlIHRoZXkgd2lsbCBiZSB3YWl0aW5nIG9uIHRoaXMgbWV0aG9kXG4vLyB0byBiZSBjYWxsZWQgdG8gcHJvY2VlZC4gQnV0IGl0IE1VU1QgYmUgY2FsbGVkIGJlZm9yZSBkYXRhIHdpbGwgYmUgcmVjZWl2ZWQgYnkgY2FsbGJhY2tzIHBhc3NlZCB0byBcbi8vIGAuZmV0Y2hBc3luYygpYC5cblJlbW90ZVRyYWNrLnByb3RvdHlwZS5zZXR1cEJpbnMgPSBmdW5jdGlvbihnZW5vbWVTaXplLCBvcHRpbWFsRmV0Y2hXaW5kb3csIG1heEZldGNoV2luZG93KSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgaWYgKHNlbGYuYmluc0xvYWRlZCkgeyB0aHJvdyBuZXcgRXJyb3IoJ3lvdSBjYW5ub3QgcnVuIHNldHVwQmlucyBtb3JlIHRoYW4gb25jZS4nKTsgfVxuICBpZiAodHlwZW9mIGdlbm9tZVNpemUgIT0gJ251bWJlcicpIHsgdGhyb3cgbmV3IEVycm9yKCd5b3UgbXVzdCBzcGVjaWZ5IHRoZSBnZW5vbWVTaXplIGFzIHRoZSAxc3QgYXJndW1lbnQuJyk7IH1cbiAgaWYgKHR5cGVvZiBvcHRpbWFsRmV0Y2hXaW5kb3cgIT0gJ251bWJlcicpIHsgdGhyb3cgbmV3IEVycm9yKCd5b3UgbXVzdCBzcGVjaWZ5IG9wdGltYWxGZXRjaFdpbmRvdyBhcyB0aGUgMm5kIGFyZ3VtZW50LicpOyB9XG4gIGlmICh0eXBlb2YgbWF4RmV0Y2hXaW5kb3cgIT0gJ251bWJlcicpIHsgdGhyb3cgbmV3IEVycm9yKCd5b3UgbXVzdCBzcGVjaWZ5IG1heEZldGNoV2luZG93IGFzIHRoZSAzcmQgYXJndW1lbnQuJyk7IH1cbiAgXG4gIHNlbGYuZ2Vub21lU2l6ZSA9IGdlbm9tZVNpemU7XG4gIHNlbGYub3B0aW1hbEZldGNoV2luZG93ID0gb3B0aW1hbEZldGNoV2luZG93O1xuICBzZWxmLm1heEZldGNoV2luZG93ID0gbWF4RmV0Y2hXaW5kb3c7XG4gIFxuICBzZWxmLm51bUJpbnMgPSBNYXRoLmNlaWwoZ2Vub21lU2l6ZSAvIG9wdGltYWxGZXRjaFdpbmRvdyk7XG4gIHNlbGYuYmluc0xvYWRlZCA9IHt9O1xuICBcbiAgLy8gRmlyZSBvZmYgcmFuZ2VzIHNhdmVkIHRvIGFmdGVyQmluU2V0dXBcbiAgXy5lYWNoKHRoaXMuYWZ0ZXJCaW5TZXR1cCwgZnVuY3Rpb24ocmFuZ2UpIHtcbiAgICBzZWxmLmZldGNoQXN5bmMocmFuZ2Uuc3RhcnQsIHJhbmdlLmVuZCwgcmFuZ2UuZXh0cmFBcmdzKTtcbiAgfSk7XG4gIF9jbGVhckNhbGxiYWNrc0ZvclRvb0JpZ0ludGVydmFscyhzZWxmKTtcbn1cblxuXG4vLyBGZXRjaGVzIGRhdGEgKGlmIG5lY2Vzc2FyeSkgZm9yIHVuZmV0Y2hlZCBiaW5zIG92ZXJsYXBwaW5nIHdpdGggdGhlIGludGVydmFsIGZyb20gYHN0YXJ0YCB0byBgZW5kYC5cbi8vIFRoZW4sIHJ1biBgY2FsbGJhY2tgIG9uIGFsbCBzdG9yZWQgc3ViaW50ZXJ2YWxzIHRoYXQgb3ZlcmxhcCB3aXRoIHRoZSBpbnRlcnZhbCBmcm9tIGBzdGFydGAgdG8gYGVuZGAuXG4vLyBgZXh0cmFBcmdzYCBpcyBhbiAqb3B0aW9uYWwqIHBhcmFtZXRlciB0aGF0IGNhbiBjb250YWluIGFyZ3VtZW50cyBwYXNzZWQgdG8gdGhlIGAuc2VhcmNoKClgIGZ1bmN0aW9uIG9mIHRoZSBjYWNoZS5cbi8vXG4vLyBAcGFyYW0gKG51bWJlcikgc3RhcnQ6ICAgICAgIDEtYmFzZWQgZ2Vub21pYyBjb29yZGluYXRlIHRvIHN0YXJ0IGZldGNoaW5nIGZyb21cbi8vIEBwYXJhbSAobnVtYmVyKSBlbmQ6ICAgICAgICAgMS1iYXNlZCBnZW5vbWljIGNvb3JkaW5hdGUgKHJpZ2h0LW9wZW4pIHRvIHN0YXJ0IGZldGNoaW5nICp1bnRpbCpcbi8vIEBwYXJhbSAoQXJyYXkpIFtleHRyYUFyZ3NdOiAgb3B0aW9uYWwsIHBhc3NlZCBhbG9uZyB0byB0aGUgYC5zZWFyY2goKWAgY2FsbHMgb24gdGhlIC5jYWNoZSBhcyBhcmd1bWVudHMgMyBhbmQgdXA7IFxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJoYXBzIHVzZWZ1bCBpZiB0aGUgLmNhY2hlIGhhcyBvdmVycmlkZGVuIHRoaXMgbWV0aG9kXG4vLyBAcGFyYW0gKGZ1bmN0aW9uKSBjYWxsYmFjazogIEEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCBvbmNlIGRhdGEgaXMgcmVhZHkgZm9yIHRoaXMgaW50ZXJ2YWwuIFdpbGwgYmUgcGFzc2VkXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbCBpbnRlcnZhbCBmZWF0dXJlcyB0aGF0IGhhdmUgYmVlbiBmZXRjaGVkIGZvciB0aGlzIGludGVydmFsLCBvciB7dG9vTWFueTogdHJ1ZX1cbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbW9yZSBkYXRhIHdhcyByZXF1ZXN0ZWQgdGhhbiBjb3VsZCBiZSByZWFzb25hYmx5IGZldGNoZWQuXG5SZW1vdGVUcmFjay5wcm90b3R5cGUuZmV0Y2hBc3luYyA9IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGV4dHJhQXJncywgY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBpZiAoXy5pc0Z1bmN0aW9uKGV4dHJhQXJncykgJiYgXy5pc1VuZGVmaW5lZChjYWxsYmFjaykpIHsgY2FsbGJhY2sgPSBleHRyYUFyZ3M7IGV4dHJhQXJncyA9IHVuZGVmaW5lZDsgfVxuICBpZiAoIXNlbGYuYmluc0xvYWRlZCkge1xuICAgIC8vIElmIGJpbnMgKmFyZW4ndCogc2V0dXAgeWV0OlxuICAgIC8vIFNhdmUgdGhlIGNhbGxiYWNrIG9udG8gdGhlIHF1ZXVlXG4gICAgaWYgKF8uaXNGdW5jdGlvbihjYWxsYmFjaykpIHsgXG4gICAgICBzZWxmLmNhbGxiYWNrcy5wdXNoKHtzdGFydDogc3RhcnQsIGVuZDogZW5kLCBleHRyYUFyZ3M6IGV4dHJhQXJncywgY2FsbGJhY2s6IGNhbGxiYWNrfSk7IFxuICAgIH1cbiAgICBcbiAgICAvLyBTYXZlIHRoaXMgZmV0Y2ggZm9yIHdoZW4gdGhlIGJpbnMgYXJlIGxvYWRlZFxuICAgIHNlbGYuYWZ0ZXJCaW5TZXR1cC5wdXNoKHtzdGFydDogc3RhcnQsIGVuZDogZW5kLCBleHRyYUFyZ3M6IGV4dHJhQXJnc30pO1xuICB9IGVsc2Uge1xuICAgIC8vIElmIGJpbnMgKmFyZSogc2V0dXAsIGZpcnN0IGNhbGN1bGF0ZSB3aGljaCBiaW5zIGNvcnJlc3BvbmQgdG8gdGhpcyBpbnRlcnZhbCwgXG4gICAgLy8gYW5kIHdoYXQgc3RhdGUgdGhvc2UgYmlucyBhcmUgaW5cbiAgICB2YXIgYmlucyA9IF9iaW5PdmVybGFwKHNlbGYsIHN0YXJ0LCBlbmQpLFxuICAgICAgbG9hZGVkQmlucyA9IF8uZmlsdGVyKGJpbnMsIGZ1bmN0aW9uKGkpIHsgcmV0dXJuIHNlbGYuYmluc0xvYWRlZFtpXSA9PT0gQklOX0xPQURFRDsgfSksXG4gICAgICBiaW5zVG9GZXRjaCA9IF8uZmlsdGVyKGJpbnMsIGZ1bmN0aW9uKGkpIHsgcmV0dXJuICFzZWxmLmJpbnNMb2FkZWRbaV07IH0pO1xuICAgIFxuICAgIGlmIChsb2FkZWRCaW5zLmxlbmd0aCA9PSBiaW5zLmxlbmd0aCkge1xuICAgICAgLy8gSWYgd2UndmUgYWxyZWFkeSBsb2FkZWQgZGF0YSBmb3IgYWxsIHRoZSBiaW5zIGluIHF1ZXN0aW9uLCBzaG9ydC1jaXJjdWl0IGFuZCBydW4gdGhlIGNhbGxiYWNrIG5vd1xuICAgICAgZXh0cmFBcmdzID0gXy5pc1VuZGVmaW5lZChleHRyYUFyZ3MpID8gW10gOiBleHRyYUFyZ3M7XG4gICAgICByZXR1cm4gXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSAmJiBjYWxsYmFjayhzZWxmLmNhY2hlLnNlYXJjaC5hcHBseShzZWxmLmNhY2hlLCBbc3RhcnQsIGVuZF0uY29uY2F0KGV4dHJhQXJncykpKTtcbiAgICB9IGVsc2UgaWYgKGVuZCAtIHN0YXJ0ID4gc2VsZi5tYXhGZXRjaFdpbmRvdykge1xuICAgICAgLy8gZWxzZSwgaWYgdGhpcyBpbnRlcnZhbCBpcyB0b28gYmlnICg+IG1heEZldGNoV2luZG93KSwgZmlyZSB0aGUgY2FsbGJhY2sgcmlnaHQgYXdheSB3aXRoIHt0b29NYW55OiB0cnVlfVxuICAgICAgcmV0dXJuIF8uaXNGdW5jdGlvbihjYWxsYmFjaykgJiYgY2FsbGJhY2soe3Rvb01hbnk6IHRydWV9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gZWxzZSwgcHVzaCB0aGUgY2FsbGJhY2sgb250byB0aGUgcXVldWVcbiAgICBpZiAoXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkgeyBcbiAgICAgIHNlbGYuY2FsbGJhY2tzLnB1c2goe3N0YXJ0OiBzdGFydCwgZW5kOiBlbmQsIGV4dHJhQXJnczogZXh0cmFBcmdzLCBjYWxsYmFjazogY2FsbGJhY2t9KTsgXG4gICAgfVxuICAgIFxuICAgIC8vIHRoZW4gcnVuIGZldGNoZXMgZm9yIHRoZSB1bmZldGNoZWQgYmlucywgd2hpY2ggc2hvdWxkIGNhbGwgX2ZpcmVDYWxsYmFja3MgYWZ0ZXIgdGhleSBjb21wbGV0ZSxcbiAgICAvLyB3aGljaCB3aWxsIGF1dG9tYXRpY2FsbHkgZmlyZSBjYWxsYmFja3MgZnJvbSB0aGUgYWJvdmUgcXVldWUgYXMgdGhleSBhY3F1aXJlIGFsbCBuZWVkZWQgZGF0YS5cbiAgICBfLmVhY2goYmluc1RvRmV0Y2gsIGZ1bmN0aW9uKGJpbkluZGV4KSB7XG4gICAgICBfZmV0Y2hCaW4oc2VsZiwgYmluSW5kZXgsIGZ1bmN0aW9uKCkgeyBfZmlyZUNhbGxiYWNrcyhzZWxmKTsgfSk7XG4gICAgfSk7XG4gIH1cbn1cblxuXG4vKipcbiAqIHByaXZhdGUgbWV0aG9kc1xuICoqL1xuXG4vLyBDYWxjdWxhdGVzIHdoaWNoIGJpbnMgb3ZlcmxhcCB3aXRoIGFuIGludGVydmFsIGdpdmVuIGJ5IGBzdGFydGAgYW5kIGBlbmRgLlxuLy8gYHN0YXJ0YCBhbmQgYGVuZGAgYXJlIDEtYmFzZWQgY29vcmRpbmF0ZXMgZm9ybWluZyBhIHJpZ2h0LW9wZW4gaW50ZXJ2YWwuXG5mdW5jdGlvbiBfYmluT3ZlcmxhcChyZW1vdGVUcmssIHN0YXJ0LCBlbmQpIHtcbiAgaWYgKCFyZW1vdGVUcmsuYmluc0xvYWRlZCkgeyB0aHJvdyBuZXcgRXJyb3IoJ3lvdSBjYW5ub3QgY2FsY3VsYXRlIGJpbiBvdmVybGFwIGJlZm9yZSBzZXR1cEJpbnMgaXMgY2FsbGVkLicpOyB9XG4gIC8vIEludGVybmFsbHksIGZvciBhc3NpZ25pbmcgY29vcmRpbmF0ZXMgdG8gYmlucywgd2UgdXNlIDAtYmFzZWQgY29vcmRpbmF0ZXMgZm9yIGVhc2llciBjYWxjdWxhdGlvbnMuXG4gIHZhciBzdGFydEJpbiA9IE1hdGguZmxvb3IoKHN0YXJ0IC0gMSkgLyByZW1vdGVUcmsub3B0aW1hbEZldGNoV2luZG93KSxcbiAgICBlbmRCaW4gPSBNYXRoLmZsb29yKChlbmQgLSAxKSAvIHJlbW90ZVRyay5vcHRpbWFsRmV0Y2hXaW5kb3cpO1xuICByZXR1cm4gXy5yYW5nZShzdGFydEJpbiwgZW5kQmluICsgMSk7XG59XG5cbi8vIFJ1bnMgdGhlIGZldGNoZXIgZnVuY3Rpb24gb24gYSBnaXZlbiBiaW4uXG4vLyBUaGUgZmV0Y2hlciBmdW5jdGlvbiBpcyBvYmxpZ2F0ZWQgdG8gcnVuIGEgY2FsbGJhY2sgZnVuY3Rpb24gYHN0b3JlSW50ZXJ2YWxzYCwgXG4vLyAgICBwYXNzZWQgYXMgaXRzIHRoaXJkIGFyZ3VtZW50LCBvbiBhIHNldCBvZiBpbnRlcnZhbHMgdGhhdCB3aWxsIGJlIGluc2VydGVkIGludG8gdGhlIFxuLy8gICAgcmVtb3RlVHJrLmNhY2hlIEludGVydmFsVHJlZS5cbi8vIFRoZSBgc3RvcmVJbnRlcnZhbHNgIGZ1bmN0aW9uIG1heSBhY2NlcHQgYSBzZWNvbmQgYXJndW1lbnQgY2FsbGVkIGBjYWNoZUluZGV4YCwgaW4gY2FzZVxuLy8gICAgcmVtb3RlVHJrLmNhY2hlIGlzIGFjdHVhbGx5IGEgY29udGFpbmVyIGZvciBtdWx0aXBsZSBJbnRlcnZhbFRyZWVzLCBpbmRpY2F0aW5nIHdoaWNoIFxuLy8gICAgb25lIHRvIHN0b3JlIGl0IGluLlxuLy8gV2UgdGhlbiBjYWxsIHRoZSBgY2FsbGJhY2tgIGdpdmVuIGhlcmUgYWZ0ZXIgdGhhdCBpcyBjb21wbGV0ZS5cbmZ1bmN0aW9uIF9mZXRjaEJpbihyZW1vdGVUcmssIGJpbkluZGV4LCBjYWxsYmFjaykge1xuICB2YXIgc3RhcnQgPSBiaW5JbmRleCAqIHJlbW90ZVRyay5vcHRpbWFsRmV0Y2hXaW5kb3cgKyAxLFxuICAgIGVuZCA9IChiaW5JbmRleCArIDEpICogcmVtb3RlVHJrLm9wdGltYWxGZXRjaFdpbmRvdyArIDE7XG4gIHJlbW90ZVRyay5iaW5zTG9hZGVkW2JpbkluZGV4XSA9IEJJTl9MT0FESU5HO1xuICByZW1vdGVUcmsuZmV0Y2hlcihzdGFydCwgZW5kLCBmdW5jdGlvbiBzdG9yZUludGVydmFscyhpbnRlcnZhbHMpIHtcbiAgICBfLmVhY2goaW50ZXJ2YWxzLCBmdW5jdGlvbihpbnRlcnZhbCkge1xuICAgICAgaWYgKCFpbnRlcnZhbCkgeyByZXR1cm47IH1cbiAgICAgIHJlbW90ZVRyay5jYWNoZS5hZGRJZk5ldyhpbnRlcnZhbCwgaW50ZXJ2YWwuaWQpO1xuICAgIH0pO1xuICAgIHJlbW90ZVRyay5iaW5zTG9hZGVkW2JpbkluZGV4XSA9IEJJTl9MT0FERUQ7XG4gICAgXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSAmJiBjYWxsYmFjaygpO1xuICB9KTtcbn1cblxuLy8gUnVucyB0aHJvdWdoIGFsbCBzYXZlZCBjYWxsYmFja3MgYW5kIGZpcmVzIGFueSBjYWxsYmFja3Mgd2hlcmUgYWxsIHRoZSByZXF1aXJlZCBkYXRhIGlzIHJlYWR5XG4vLyBDYWxsYmFja3MgdGhhdCBhcmUgZmlyZWQgYXJlIHJlbW92ZWQgZnJvbSB0aGUgcXVldWUuXG5mdW5jdGlvbiBfZmlyZUNhbGxiYWNrcyhyZW1vdGVUcmspIHtcbiAgcmVtb3RlVHJrLmNhbGxiYWNrcyA9IF8uZmlsdGVyKHJlbW90ZVRyay5jYWxsYmFja3MsIGZ1bmN0aW9uKGFmdGVyTG9hZCkge1xuICAgIHZhciBjYWxsYmFjayA9IGFmdGVyTG9hZC5jYWxsYmFjayxcbiAgICAgIGV4dHJhQXJncyA9IF8uaXNVbmRlZmluZWQoYWZ0ZXJMb2FkLmV4dHJhQXJncykgPyBbXSA6IGFmdGVyTG9hZC5leHRyYUFyZ3MsXG4gICAgICBiaW5zLCBzdGlsbExvYWRpbmdCaW5zO1xuICAgICAgICBcbiAgICBpZiAoYWZ0ZXJMb2FkLmVuZCAtIGFmdGVyTG9hZC5zdGFydCA+IHJlbW90ZVRyay5tYXhGZXRjaFdpbmRvdykge1xuICAgICAgY2FsbGJhY2soe3Rvb01hbnk6IHRydWV9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgYmlucyA9IF9iaW5PdmVybGFwKHJlbW90ZVRyaywgYWZ0ZXJMb2FkLnN0YXJ0LCBhZnRlckxvYWQuZW5kKTtcbiAgICBzdGlsbExvYWRpbmdCaW5zID0gXy5maWx0ZXIoYmlucywgZnVuY3Rpb24oaSkgeyByZXR1cm4gcmVtb3RlVHJrLmJpbnNMb2FkZWRbaV0gIT09IEJJTl9MT0FERUQ7IH0pLmxlbmd0aCA+IDA7XG4gICAgaWYgKCFzdGlsbExvYWRpbmdCaW5zKSB7XG4gICAgICBjYWxsYmFjayhyZW1vdGVUcmsuY2FjaGUuc2VhcmNoLmFwcGx5KHJlbW90ZVRyay5jYWNoZSwgW2FmdGVyTG9hZC5zdGFydCwgYWZ0ZXJMb2FkLmVuZF0uY29uY2F0KGV4dHJhQXJncykpKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH0pO1xufVxuXG4vLyBSdW5zIHRocm91Z2ggYWxsIHNhdmVkIGNhbGxiYWNrcyBhbmQgZmlyZXMgYW55IGNhbGxiYWNrcyBmb3Igd2hpY2ggd2Ugd29uJ3QgbG9hZCBkYXRhIHNpbmNlIHRoZSBhbW91bnRcbi8vIHJlcXVlc3RlZCBpcyB0b28gbGFyZ2UuIENhbGxiYWNrcyB0aGF0IGFyZSBmaXJlZCBhcmUgcmVtb3ZlZCBmcm9tIHRoZSBxdWV1ZS5cbmZ1bmN0aW9uIF9jbGVhckNhbGxiYWNrc0ZvclRvb0JpZ0ludGVydmFscyhyZW1vdGVUcmspIHtcbiAgcmVtb3RlVHJrLmNhbGxiYWNrcyA9IF8uZmlsdGVyKHJlbW90ZVRyay5jYWxsYmFja3MsIGZ1bmN0aW9uKGFmdGVyTG9hZCkge1xuICAgIHZhciBjYWxsYmFjayA9IGFmdGVyTG9hZC5jYWxsYmFjaztcbiAgICBpZiAoYWZ0ZXJMb2FkLmVuZCAtIGFmdGVyTG9hZC5zdGFydCA+IHJlbW90ZVRyay5tYXhGZXRjaFdpbmRvdykge1xuICAgICAgY2FsbGJhY2soe3Rvb01hbnk6IHRydWV9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH0pO1xufVxuXG5cbmV4cG9ydHMuUmVtb3RlVHJhY2sgPSBSZW1vdGVUcmFjaztcblxufSkobW9kdWxlICYmIG1vZHVsZS5leHBvcnRzIHx8IHRoaXMpOyIsIihmdW5jdGlvbihleHBvcnRzKXtcbi8vIFRPRE86IGJhY2twb3J0IHRoaXMgY29kZSBmb3IgSmF2YVNjcmlwdCAxLjU/IHVzaW5nIHVuZGVyc2NvcmUuanNcbi8qKlxuICogQnkgU2hpbiBTdXp1a2ksIE1JVCBsaWNlbnNlXG4gKiBodHRwczovL2dpdGh1Yi5jb20vc2hpbm91dC9Tb3J0ZWRMaXN0XG4gKlxuICogU29ydGVkTGlzdCA6IGNvbnN0cnVjdG9yXG4gKiBcbiAqIEBwYXJhbSBhcnIgOiBBcnJheSBvciBudWxsIDogYW4gYXJyYXkgdG8gc2V0XG4gKlxuICogQHBhcmFtIG9wdGlvbnMgOiBvYmplY3QgIG9yIG51bGxcbiAqICAgICAgICAgKGZ1bmN0aW9uKSBmaWx0ZXIgIDogZmlsdGVyIGZ1bmN0aW9uIGNhbGxlZCBiZWZvcmUgaW5zZXJ0aW5nIGRhdGEuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoaXMgcmVjZWl2ZXMgYSB2YWx1ZSBhbmQgcmV0dXJucyB0cnVlIGlmIHRoZSB2YWx1ZSBpcyB2YWxpZC5cbiAqXG4gKiAgICAgICAgIChmdW5jdGlvbikgY29tcGFyZSA6IGZ1bmN0aW9uIHRvIGNvbXBhcmUgdHdvIHZhbHVlcywgXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWNoIGlzIHVzZWQgZm9yIHNvcnRpbmcgb3JkZXIuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBzYW1lIHNpZ25hdHVyZSBhcyBBcnJheS5wcm90b3R5cGUuc29ydChmbikuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICogICAgICAgICAoc3RyaW5nKSAgIGNvbXBhcmUgOiBpZiB5b3UnZCBsaWtlIHRvIHNldCBhIGNvbW1vbiBjb21wYXJpc29uIGZ1bmN0aW9uLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5b3UgY2FuIHNwZWNpZnkgaXQgYnkgc3RyaW5nOlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm51bWJlclwiIDogY29tcGFyZXMgbnVtYmVyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RyaW5nXCIgOiBjb21wYXJlcyBzdHJpbmdcbiAqL1xuZnVuY3Rpb24gU29ydGVkTGlzdCgpIHtcbiAgdmFyIGFyciAgICAgPSBudWxsLFxuICAgICAgb3B0aW9ucyA9IHt9LFxuICAgICAgYXJncyAgICA9IGFyZ3VtZW50cztcblxuICBbXCIwXCIsXCIxXCJdLmZvckVhY2goZnVuY3Rpb24obikge1xuICAgIHZhciB2YWwgPSBhcmdzW25dO1xuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbCkpIHtcbiAgICAgIGFyciA9IHZhbDtcbiAgICB9XG4gICAgZWxzZSBpZiAodmFsICYmIHR5cGVvZiB2YWwgPT0gXCJvYmplY3RcIikge1xuICAgICAgb3B0aW9ucyA9IHZhbDtcbiAgICB9XG4gIH0pO1xuICB0aGlzLmFyciA9IFtdO1xuXG4gIFtcImZpbHRlclwiLCBcImNvbXBhcmVcIl0uZm9yRWFjaChmdW5jdGlvbihrKSB7XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zW2tdID09IFwiZnVuY3Rpb25cIikge1xuICAgICAgdGhpc1trXSA9IG9wdGlvbnNba107XG4gICAgfVxuICAgIGVsc2UgaWYgKG9wdGlvbnNba10gJiYgU29ydGVkTGlzdFtrXVtvcHRpb25zW2tdXSkge1xuICAgICAgdGhpc1trXSA9IFNvcnRlZExpc3Rba11bb3B0aW9uc1trXV07XG4gICAgfVxuICB9LCB0aGlzKTtcbiAgaWYgKGFycikgdGhpcy5tYXNzSW5zZXJ0KGFycik7XG59O1xuXG4vLyBCaW5hcnkgc2VhcmNoIGZvciB0aGUgaW5kZXggb2YgdGhlIGl0ZW0gZXF1YWwgdG8gYHZhbGAsIG9yIGlmIG5vIHN1Y2ggaXRlbSBleGlzdHMsIHRoZSBuZXh0IGxvd2VyIGl0ZW1cbi8vIFRoaXMgY2FuIGJlIC0xIGlmIGB2YWxgIGlzIGxvd2VyIHRoYW4gdGhlIGxvd2VzdCBpdGVtIGluIHRoZSBTb3J0ZWRMaXN0XG5Tb3J0ZWRMaXN0LnByb3RvdHlwZS5ic2VhcmNoID0gZnVuY3Rpb24odmFsKSB7XG4gIHZhciBtcG9zLFxuICAgICAgc3BvcyA9IDAsXG4gICAgICBlcG9zID0gdGhpcy5hcnIubGVuZ3RoO1xuICB3aGlsZSAoZXBvcyAtIHNwb3MgPiAxKSB7XG4gICAgbXBvcyA9IE1hdGguZmxvb3IoKHNwb3MgKyBlcG9zKS8yKTtcbiAgICBtdmFsID0gdGhpcy5hcnJbbXBvc107XG4gICAgc3dpdGNoICh0aGlzLmNvbXBhcmUodmFsLCBtdmFsKSkge1xuICAgIGNhc2UgMSAgOlxuICAgIGRlZmF1bHQgOlxuICAgICAgc3BvcyA9IG1wb3M7XG4gICAgICBicmVhaztcbiAgICBjYXNlIC0xIDpcbiAgICAgIGVwb3MgPSBtcG9zO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAwICA6XG4gICAgICByZXR1cm4gbXBvcztcbiAgICB9XG4gIH1cbiAgcmV0dXJuICh0aGlzLmFyclswXSA9PSBudWxsIHx8IHNwb3MgPT0gMCAmJiB0aGlzLmFyclswXSAhPSBudWxsICYmIHRoaXMuY29tcGFyZSh0aGlzLmFyclswXSwgdmFsKSA9PSAxKSA/IC0xIDogc3Bvcztcbn07XG5cblNvcnRlZExpc3QucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKHBvcykge1xuICByZXR1cm4gdGhpcy5hcnJbcG9zXTtcbn07XG5cblNvcnRlZExpc3QucHJvdG90eXBlLnRvQXJyYXkgPSBmdW5jdGlvbihwb3MpIHtcbiAgcmV0dXJuIHRoaXMuYXJyLnNsaWNlKCk7XG59O1xuXG5Tb3J0ZWRMaXN0LnByb3RvdHlwZS5zbGljZSA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5hcnIuc2xpY2UuYXBwbHkodGhpcy5hcnIsIGFyZ3VtZW50cyk7XG59XG5cblNvcnRlZExpc3QucHJvdG90eXBlLnNpemUgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMuYXJyLmxlbmd0aDtcbn07XG5cblNvcnRlZExpc3QucHJvdG90eXBlLmhlYWQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMuYXJyWzBdO1xufTtcblxuU29ydGVkTGlzdC5wcm90b3R5cGUudGFpbCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gKHRoaXMuYXJyLmxlbmd0aCA9PSAwKSA/IG51bGwgOiB0aGlzLmFyclt0aGlzLmFyci5sZW5ndGggLTFdO1xufTtcblxuU29ydGVkTGlzdC5wcm90b3R5cGUubWFzc0luc2VydCA9IGZ1bmN0aW9uKGl0ZW1zKSB7XG4gIC8vIFRoaXMgbG9vcCBhdm9pZHMgY2FsbCBzdGFjayBvdmVyZmxvdyBiZWNhdXNlIG9mIHRvbyBtYW55IGFyZ3VtZW50c1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSArPSA0MDk2KSB7XG4gICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkodGhpcy5hcnIsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGl0ZW1zLCBpLCBpICsgNDA5NikpO1xuICB9XG4gIHRoaXMuYXJyLnNvcnQodGhpcy5jb21wYXJlKTtcbn1cblxuU29ydGVkTGlzdC5wcm90b3R5cGUuaW5zZXJ0ID0gZnVuY3Rpb24oKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMTAwKSB7XG4gICAgLy8gLmJzZWFyY2ggKyAuc3BsaWNlIGlzIHRvbyBleHBlbnNpdmUgdG8gcmVwZWF0IGZvciBzbyBtYW55IGVsZW1lbnRzLlxuICAgIC8vIExldCdzIGp1c3QgYXBwZW5kIHRoZW0gYWxsIHRvIHRoaXMuYXJyIGFuZCByZXNvcnQuXG4gICAgdGhpcy5tYXNzSW5zZXJ0KGFyZ3VtZW50cyk7XG4gIH0gZWxzZSB7XG4gICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChhcmd1bWVudHMsIGZ1bmN0aW9uKHZhbCkge1xuICAgICAgdmFyIHBvcyA9IHRoaXMuYnNlYXJjaCh2YWwpO1xuICAgICAgaWYgKHRoaXMuZmlsdGVyKHZhbCwgcG9zKSkge1xuICAgICAgICB0aGlzLmFyci5zcGxpY2UocG9zKzEsIDAsIHZhbCk7XG4gICAgICB9XG4gICAgfSwgdGhpcyk7XG4gIH1cbn07XG5cblNvcnRlZExpc3QucHJvdG90eXBlLmZpbHRlciA9IGZ1bmN0aW9uKHZhbCwgcG9zKSB7XG4gIHJldHVybiB0cnVlO1xufTtcblxuU29ydGVkTGlzdC5wcm90b3R5cGUuYWRkID0gU29ydGVkTGlzdC5wcm90b3R5cGUuaW5zZXJ0O1xuXG5Tb3J0ZWRMaXN0LnByb3RvdHlwZVtcImRlbGV0ZVwiXSA9IGZ1bmN0aW9uKHBvcykge1xuICB0aGlzLmFyci5zcGxpY2UocG9zLCAxKTtcbn07XG5cblNvcnRlZExpc3QucHJvdG90eXBlLnJlbW92ZSA9IFNvcnRlZExpc3QucHJvdG90eXBlW1wiZGVsZXRlXCJdO1xuXG5Tb3J0ZWRMaXN0LnByb3RvdHlwZS5tYXNzUmVtb3ZlID0gZnVuY3Rpb24oc3RhcnRQb3MsIGNvdW50KSB7XG4gIHRoaXMuYXJyLnNwbGljZShzdGFydFBvcywgY291bnQpO1xufTtcblxuLyoqXG4gKiBkZWZhdWx0IGNvbXBhcmUgZnVuY3Rpb25zIFxuICoqL1xuU29ydGVkTGlzdC5jb21wYXJlID0ge1xuICBcIm51bWJlclwiOiBmdW5jdGlvbihhLCBiKSB7XG4gICAgdmFyIGMgPSBhIC0gYjtcbiAgICByZXR1cm4gKGMgPiAwKSA/IDEgOiAoYyA9PSAwKSAgPyAwIDogLTE7XG4gIH0sXG5cbiAgXCJzdHJpbmdcIjogZnVuY3Rpb24oYSwgYikge1xuICAgIHJldHVybiAoYSA+IGIpID8gMSA6IChhID09IGIpICA/IDAgOiAtMTtcbiAgfVxufTtcblxuU29ydGVkTGlzdC5wcm90b3R5cGUuY29tcGFyZSA9IFNvcnRlZExpc3QuY29tcGFyZVtcIm51bWJlclwiXTtcblxuZXhwb3J0cy5Tb3J0ZWRMaXN0ID0gU29ydGVkTGlzdDtcblxufSkobW9kdWxlICYmIG1vZHVsZS5leHBvcnRzIHx8IHRoaXMpOyIsInZhciBfID0gcmVxdWlyZSgnLi4vLi4vLi4vdW5kZXJzY29yZS5taW4uanMnKTtcblxuLy8gUGFyc2UgYSB0cmFjayBkZWNsYXJhdGlvbiBsaW5lLCB3aGljaCBpcyBpbiB0aGUgZm9ybWF0IG9mOlxuLy8gdHJhY2sgbmFtZT1cImJsYWhcIiBvcHRuYW1lMT1cInZhbHVlMVwiIG9wdG5hbWUyPVwidmFsdWUyXCIgLi4uXG4vLyBpbnRvIGEgaGFzaCBvZiBvcHRpb25zXG5tb2R1bGUuZXhwb3J0cy5wYXJzZURlY2xhcmF0aW9uTGluZSA9IGZ1bmN0aW9uKGxpbmUsIHN0YXJ0KSB7XG4gIHZhciBvcHRzID0ge30sIG9wdG5hbWUgPSAnJywgdmFsdWUgPSAnJywgc3RhdGUgPSAnb3B0bmFtZSc7XG4gIGZ1bmN0aW9uIHB1c2hWYWx1ZShxdW90aW5nKSB7XG4gICAgc3RhdGUgPSAnb3B0bmFtZSc7XG4gICAgb3B0c1tvcHRuYW1lLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKV0gPSB2YWx1ZTtcbiAgICBvcHRuYW1lID0gdmFsdWUgPSAnJztcbiAgfVxuICBmb3IgKGkgPSBsaW5lLm1hdGNoKHN0YXJ0KVswXS5sZW5ndGg7IGkgPCBsaW5lLmxlbmd0aDsgaSsrKSB7XG4gICAgYyA9IGxpbmVbaV07XG4gICAgaWYgKHN0YXRlID09ICdvcHRuYW1lJykge1xuICAgICAgaWYgKGMgPT0gJz0nKSB7IHN0YXRlID0gJ3N0YXJ0dmFsdWUnOyB9XG4gICAgICBlbHNlIHsgb3B0bmFtZSArPSBjOyB9XG4gICAgfSBlbHNlIGlmIChzdGF0ZSA9PSAnc3RhcnR2YWx1ZScpIHtcbiAgICAgIGlmICgvJ3xcIi8udGVzdChjKSkgeyBzdGF0ZSA9IGM7IH1cbiAgICAgIGVsc2UgeyB2YWx1ZSArPSBjOyBzdGF0ZSA9ICd2YWx1ZSc7IH1cbiAgICB9IGVsc2UgaWYgKHN0YXRlID09ICd2YWx1ZScpIHtcbiAgICAgIGlmICgvXFxzLy50ZXN0KGMpKSB7IHB1c2hWYWx1ZSgpOyB9XG4gICAgICBlbHNlIHsgdmFsdWUgKz0gYzsgfVxuICAgIH0gZWxzZSBpZiAoLyd8XCIvLnRlc3Qoc3RhdGUpKSB7XG4gICAgICBpZiAoYyA9PSBzdGF0ZSkgeyBwdXNoVmFsdWUoc3RhdGUpOyB9XG4gICAgICBlbHNlIHsgdmFsdWUgKz0gYzsgfVxuICAgIH1cbiAgfVxuICBpZiAoc3RhdGUgPT0gJ3ZhbHVlJykgeyBwdXNoVmFsdWUoKTsgfVxuICBpZiAoc3RhdGUgIT0gJ29wdG5hbWUnKSB7IHJldHVybiBmYWxzZTsgfVxuICByZXR1cm4gb3B0cztcbn1cblxuLy8gQ29uc3RydWN0cyBhIG1hcHBpbmcgZnVuY3Rpb24gdGhhdCBjb252ZXJ0cyBicCBpbnRlcnZhbHMgaW50byBwaXhlbCBpbnRlcnZhbHMsIHdpdGggb3B0aW9uYWwgY2FsY3VsYXRpb25zIGZvciB0ZXh0IHRvb1xubW9kdWxlLmV4cG9ydHMucGl4SW50ZXJ2YWxDYWxjdWxhdG9yID0gZnVuY3Rpb24oc3RhcnQsIHdpZHRoLCBicHBwLCB3aXRoVGV4dCwgbmFtZUZ1bmMsIHN0YXJ0a2V5LCBlbmRrZXkpIHtcbiAgaWYgKCFfLmlzRnVuY3Rpb24obmFtZUZ1bmMpKSB7IG5hbWVGdW5jID0gZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5uYW1lIHx8ICcnOyB9OyB9XG4gIGlmIChfLmlzVW5kZWZpbmVkKHN0YXJ0a2V5KSkgeyBzdGFydGtleSA9ICdzdGFydCc7IH1cbiAgaWYgKF8uaXNVbmRlZmluZWQoZW5ka2V5KSkgeyBlbmRrZXkgPSAnZW5kJzsgfVxuICByZXR1cm4gZnVuY3Rpb24oZCkge1xuICAgIHZhciBpdHZsU3RhcnQgPSBfLmlzVW5kZWZpbmVkKGRbc3RhcnRrZXldKSA/IGQuc3RhcnQgOiBkW3N0YXJ0a2V5XSxcbiAgICAgIGl0dmxFbmQgPSBfLmlzVW5kZWZpbmVkKGRbZW5ka2V5XSkgPyBkLmVuZCA6IGRbZW5ka2V5XTtcbiAgICB2YXIgcEludCA9IHtcbiAgICAgIHg6IE1hdGgucm91bmQoKGl0dmxTdGFydCAtIHN0YXJ0KSAvIGJwcHApLFxuICAgICAgdzogTWF0aC5yb3VuZCgoaXR2bEVuZCAtIGl0dmxTdGFydCkgLyBicHBwKSArIDEsXG4gICAgICB0OiAwLCAgICAgICAgICAvLyBjYWxjdWxhdGVkIHdpZHRoIG9mIHRleHRcbiAgICAgIG9QcmV2OiBmYWxzZSwgIC8vIG92ZXJmbG93cyBpbnRvIHByZXZpb3VzIHRpbGU/XG4gICAgICBvTmV4dDogZmFsc2UgICAvLyBvdmVyZmxvd3MgaW50byBuZXh0IHRpbGU/XG4gICAgfTtcbiAgICBwSW50LnR4ID0gcEludC54O1xuICAgIHBJbnQudHcgPSBwSW50Lnc7XG4gICAgaWYgKHBJbnQueCA8IDApIHsgcEludC53ICs9IHBJbnQueDsgcEludC54ID0gMDsgcEludC5vUHJldiA9IHRydWU7IH1cbiAgICBlbHNlIGlmICh3aXRoVGV4dCkge1xuICAgICAgcEludC50ID0gXy5pc051bWJlcih3aXRoVGV4dCkgPyB3aXRoVGV4dCA6IE1hdGgubWluKG5hbWVGdW5jKGQpLmxlbmd0aCAqIDEwICsgMiwgcEludC54KTtcbiAgICAgIHBJbnQudHggLT0gcEludC50O1xuICAgICAgcEludC50dyArPSBwSW50LnQ7ICBcbiAgICB9XG4gICAgaWYgKHBJbnQueCArIHBJbnQudyA+IHdpZHRoKSB7IHBJbnQudyA9IHdpZHRoIC0gcEludC54OyBwSW50Lm9OZXh0ID0gdHJ1ZTsgfVxuICAgIHJldHVybiBwSW50O1xuICB9O1xufTtcblxuLy8gRm9yIHR3byBnaXZlbiBvYmplY3RzIG9mIHRoZSBmb3JtIHt4OiAxLCB3OiAyfSAocGl4ZWwgaW50ZXJ2YWxzKSwgZGVzY3JpYmUgdGhlIG92ZXJsYXAuXG4vLyBSZXR1cm5zIG51bGwgaWYgdGhlcmUgaXMgbm8gb3ZlcmxhcC5cbm1vZHVsZS5leHBvcnRzLnBpeEludGVydmFsT3ZlcmxhcCA9IGZ1bmN0aW9uKHBJbnQxLCBwSW50Mikge1xuICB2YXIgb3ZlcmxhcCA9IHt9LFxuICAgIHRtcDtcbiAgaWYgKHBJbnQxLnggPiBwSW50Mi54KSB7IHRtcCA9IHBJbnQyOyBwSW50MiA9IHBJbnQxOyBwSW50MSA9IHRtcDsgfSAgICAgICAvLyBzd2FwIHNvIHRoYXQgcEludDEgaXMgYWx3YXlzIGxvd2VyXG4gIGlmICghcEludDEudyB8fCAhcEludDIudyB8fCBwSW50MS54ICsgcEludDEudyA8IHBJbnQyLngpIHsgcmV0dXJuIG51bGw7IH0gLy8gZGV0ZWN0IG5vLW92ZXJsYXAgY29uZGl0aW9uc1xuICBvdmVybGFwLnggPSBwSW50Mi54O1xuICBvdmVybGFwLncgPSBNYXRoLm1pbihwSW50MS53IC0gcEludDIueCArIHBJbnQxLngsIHBJbnQyLncpO1xuICByZXR1cm4gb3ZlcmxhcDtcbn07XG5cbi8vIENvbW1vbiBmdW5jdGlvbnMgZm9yIHN1bW1hcml6aW5nIGRhdGEgaW4gYmlucyB3aGlsZSBwbG90dGluZyB3aWdnbGUgdHJhY2tzXG5tb2R1bGUuZXhwb3J0cy53aWdCaW5GdW5jdGlvbnMgPSB7XG4gIG1pbmltdW06IGZ1bmN0aW9uKGJpbikgeyByZXR1cm4gYmluLmxlbmd0aCA/IE1hdGgubWluLmFwcGx5KE1hdGgsIGJpbikgOiAwOyB9LFxuICBtZWFuOiBmdW5jdGlvbihiaW4pIHsgcmV0dXJuIF8ucmVkdWNlKGJpbiwgZnVuY3Rpb24oYSxiKSB7IHJldHVybiBhICsgYjsgfSwgMCkgLyBiaW4ubGVuZ3RoOyB9LFxuICBtYXhpbXVtOiBmdW5jdGlvbihiaW4pIHsgcmV0dXJuIGJpbi5sZW5ndGggPyBNYXRoLm1heC5hcHBseShNYXRoLCBiaW4pIDogMDsgfVxufTtcblxuLy8gRmFzdGVyIHRoYW4gTWF0aC5mbG9vciAoaHR0cDovL3dlYmRvb2QuY29tLz9wPTIxOSlcbm1vZHVsZS5leHBvcnRzLmZsb29ySGFjayA9IGZ1bmN0aW9uKG51bSkgeyByZXR1cm4gKG51bSA8PCAwKSAtIChudW0gPCAwID8gMSA6IDApOyB9XG5cbi8vIE90aGVyIHRpbnkgZnVuY3Rpb25zIHRoYXQgd2UgbmVlZCBmb3Igb2RkcyBhbmQgZW5kcy4uLlxubW9kdWxlLmV4cG9ydHMuc3RyaXAgPSBmdW5jdGlvbihzdHIpIHsgcmV0dXJuIHN0ci5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJyk7IH1cbm1vZHVsZS5leHBvcnRzLnBhcnNlSW50MTAgPSBmdW5jdGlvbih2YWwpIHsgcmV0dXJuIHBhcnNlSW50KHZhbCwgMTApOyB9XG5tb2R1bGUuZXhwb3J0cy5kZWVwQ2xvbmUgPSBmdW5jdGlvbihvYmopIHsgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7IH0iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSB2Y2ZUYWJpeCBmb3JtYXQ6IGh0dHA6Ly9nZW5vbWUudWNzYy5lZHUvZ29sZGVuUGF0aC9oZWxwL3ZjZi5odG1sID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMvdXRpbHMuanMnKSxcbiAgcGFyc2VJbnQxMCA9IHV0aWxzLnBhcnNlSW50MTA7XG5cbi8vIEludGVuZGVkIHRvIGJlIGxvYWRlZCBpbnRvIEN1c3RvbVRyYWNrLnR5cGVzLnZjZnRhYml4XG52YXIgVmNmVGFiaXhGb3JtYXQgPSB7XG4gIGRlZmF1bHRzOiB7XG4gICAgcHJpb3JpdHk6IDEwMCxcbiAgICBkcmF3TGltaXQ6IHtzcXVpc2g6IDUwMCwgcGFjazogMTAwfSxcbiAgICBtYXhGZXRjaFdpbmRvdzogMTAwMDAwLFxuICAgIGNocm9tb3NvbWVzOiAnJ1xuICB9LFxuXG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5vcHRzLmJpZ0RhdGFVcmwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlJlcXVpcmVkIHBhcmFtZXRlciBiaWdEYXRhVXJsIG5vdCBmb3VuZCBmb3IgdmNmVGFiaXggdHJhY2sgYXQgXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm9wdHMpICsgKHRoaXMub3B0cy5saW5lTnVtICsgMSkpO1xuICAgIH1cbiAgfSxcblxuICBwYXJzZTogZnVuY3Rpb24obGluZXMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5oZWlnaHRzID0ge21heDogbnVsbCwgbWluOiAxNSwgc3RhcnQ6IDE1fTtcbiAgICBzZWxmLnNpemVzID0gWydkZW5zZScsICdzcXVpc2gnLCAncGFjayddO1xuICAgIHNlbGYubWFwU2l6ZXMgPSBbJ3BhY2snXTtcbiAgICAvLyBUT0RPOiBTZXQgbWF4RmV0Y2hXaW5kb3cgdXNpbmcgc29tZSBoZXVyaXN0aWMgYmFzZWQgb24gaG93IG1hbnkgaXRlbXMgYXJlIGluIHRoZSB0YWJpeCBpbmRleFxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIHByZXJlbmRlcjogZnVuY3Rpb24oc3RhcnQsIGVuZCwgZGVuc2l0eSwgcHJlY2FsYywgY2FsbGJhY2spIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICB3aWR0aCA9IHByZWNhbGMud2lkdGgsXG4gICAgICBkYXRhID0gc2VsZi5kYXRhLFxuICAgICAgYnBwcCA9IChlbmQgLSBzdGFydCkgLyB3aWR0aCxcbiAgICAgIHJhbmdlID0gdGhpcy5jaHJSYW5nZShzdGFydCwgZW5kKTtcbiAgICBcbiAgICBmdW5jdGlvbiBsaW5lVG9JbnRlcnZhbChsaW5lKSB7XG4gICAgICB2YXIgZmllbGRzID0gbGluZS5zcGxpdCgnXFx0JyksIGRhdGEgPSB7fSwgaW5mbyA9IHt9O1xuICAgICAgaWYgKGZpZWxkc1s3XSkge1xuICAgICAgICBfLmVhY2goZmllbGRzWzddLnNwbGl0KCc7JyksIGZ1bmN0aW9uKGwpIHsgbCA9IGwuc3BsaXQoJz0nKTsgaWYgKGwubGVuZ3RoID4gMSkgeyBpbmZvW2xbMF1dID0gbFsxXTsgfSB9KTtcbiAgICAgIH1cbiAgICAgIGRhdGEuc3RhcnQgPSBzZWxmLmJyb3dzZXJPcHRzLmNoclBvc1tmaWVsZHNbMF1dICsgcGFyc2VJbnQxMChmaWVsZHNbMV0pO1xuICAgICAgZGF0YS5pZCA9IGZpZWxkc1syXT09Jy4nID8gJ3ZjZi0nICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMDAwKSA6IGZpZWxkc1syXTtcbiAgICAgIGRhdGEuZW5kID0gZGF0YS5zdGFydCArIDE7XG4gICAgICBkYXRhLnJlZiA9IGZpZWxkc1szXTtcbiAgICAgIGRhdGEuYWx0ID0gZmllbGRzWzRdO1xuICAgICAgZGF0YS5xdWFsID0gcGFyc2VGbG9hdChmaWVsZHNbNV0pO1xuICAgICAgZGF0YS5pbmZvID0gaW5mbztcbiAgICAgIHJldHVybiB7ZGF0YTogZGF0YX07XG4gICAgfVxuICAgIGZ1bmN0aW9uIG5hbWVGdW5jKGZpZWxkcykge1xuICAgICAgdmFyIHJlZiA9IGZpZWxkcy5yZWYgfHwgJycsXG4gICAgICAgIGFsdCA9IGZpZWxkcy5hbHQgfHwgJyc7XG4gICAgICByZXR1cm4gKHJlZi5sZW5ndGggPiBhbHQubGVuZ3RoID8gcmVmIDogYWx0KSB8fCAnJztcbiAgICB9XG4gIFxuICAgIGZ1bmN0aW9uIHN1Y2Nlc3MoZGF0YSkge1xuICAgICAgdmFyIGRyYXdTcGVjID0gW10sXG4gICAgICAgIGxpbmVzID0gXy5maWx0ZXIoZGF0YS5zcGxpdCgnXFxuJyksIGZ1bmN0aW9uKGwpIHsgdmFyIG0gPSBsLm1hdGNoKC9cXHQvZyk7IHJldHVybiBtICYmIG0ubGVuZ3RoID4gODsgfSksXG4gICAgICAgIGNhbGNQaXhJbnRlcnZhbCA9IG5ldyB1dGlscy5waXhJbnRlcnZhbENhbGN1bGF0b3Ioc3RhcnQsIHdpZHRoLCBicHBwLCBkZW5zaXR5PT0ncGFjaycsIG5hbWVGdW5jKTtcbiAgICAgIGlmIChkZW5zaXR5ID09ICdkZW5zZScpIHtcbiAgICAgICAgXy5lYWNoKGxpbmVzLCBmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgICAgZHJhd1NwZWMucHVzaChjYWxjUGl4SW50ZXJ2YWwobGluZVRvSW50ZXJ2YWwobGluZSkuZGF0YSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRyYXdTcGVjID0ge2xheW91dDogc2VsZi50eXBlKCdiZWQnKS5zdGFja2VkTGF5b3V0KF8ubWFwKGxpbmVzLCBsaW5lVG9JbnRlcnZhbCksIHdpZHRoLCBjYWxjUGl4SW50ZXJ2YWwpfTtcbiAgICAgICAgZHJhd1NwZWMud2lkdGggPSB3aWR0aDtcbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrKGRyYXdTcGVjKTtcbiAgICB9XG4gIFxuICAgIC8vIERvbid0IGV2ZW4gYXR0ZW1wdCB0byBmZXRjaCB0aGUgZGF0YSBpZiB3ZSBjYW4gcmVhc29uYWJseSBlc3RpbWF0ZSB0aGF0IHdlIHdpbGwgZmV0Y2ggdG9vIG11Y2ggZGF0YSwgYXMgdGhpcyB3aWxsIG9ubHkgZGVsYXkgb3RoZXIgcmVxdWVzdHMuXG4gICAgLy8gVE9ETzogY2FjaGUgcmVzdWx0cyBzbyB3ZSBhcmVuJ3QgcmVmZXRjaGluZyB0aGUgc2FtZSByZWdpb25zIG92ZXIgYW5kIG92ZXIgYWdhaW4uXG4gICAgaWYgKChlbmQgLSBzdGFydCkgPiBzZWxmLm9wdHMubWF4RmV0Y2hXaW5kb3cpIHtcbiAgICAgIGNhbGxiYWNrKHt0b29NYW55OiB0cnVlfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQuYWpheCh0aGlzLmFqYXhEaXIoKSArICd0YWJpeC5waHAnLCB7XG4gICAgICAgIGRhdGE6IHtyYW5nZTogcmFuZ2UsIHVybDogdGhpcy5vcHRzLmJpZ0RhdGFVcmx9LFxuICAgICAgICBzdWNjZXNzOiBzdWNjZXNzXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbihjYW52YXMsIHN0YXJ0LCBlbmQsIGRlbnNpdHksIGNhbGxiYWNrKSB7XG4gICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0ICYmIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLFxuICAgICAgdXJsVGVtcGxhdGUgPSB0aGlzLm9wdHMudXJsID8gdGhpcy5vcHRzLnVybCA6ICdqYXZhc2NyaXB0OnZvaWQoXCInK3RoaXMub3B0cy5uYW1lKyc6JCRcIiknLFxuICAgICAgbGluZUhlaWdodCA9IGRlbnNpdHkgPT0gJ3BhY2snID8gMjcgOiA2LFxuICAgICAgY29sb3JzID0ge2E6JzI1NSwwLDAnLCB0OicyNTUsMCwyNTUnLCBjOicwLDAsMjU1JywgZzonMCwyNTUsMCd9LFxuICAgICAgZHJhd0xpbWl0ID0gdGhpcy5vcHRzLmRyYXdMaW1pdCAmJiB0aGlzLm9wdHMuZHJhd0xpbWl0W2RlbnNpdHldLFxuICAgICAgYXJlYXMgPSBudWxsO1xuICAgIGlmICghY3R4KSB7IHRocm93IFwiQ2FudmFzIG5vdCBzdXBwb3J0ZWRcIjsgfVxuICAgIGlmIChkZW5zaXR5ID09ICdwYWNrJykgeyBhcmVhcyA9IHRoaXMuYXJlYXNbY2FudmFzLmlkXSA9IFtdOyB9XG4gICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiKDAsMCwwKVwiO1xuICAgIHRoaXMucHJlcmVuZGVyKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHt3aWR0aDogY2FudmFzLndpZHRofSwgZnVuY3Rpb24oZHJhd1NwZWMpIHtcbiAgICAgIGlmICgoZHJhd0xpbWl0ICYmIGRyYXdTcGVjLmxlbmd0aCA+IGRyYXdMaW1pdCkgfHwgZHJhd1NwZWMudG9vTWFueSkgeyBcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IDA7XG4gICAgICAgIC8vIFRoaXMgYXBwbGllcyBzdHlsaW5nIHRoYXQgaW5kaWNhdGVzIHRoZXJlIHdhcyB0b28gbXVjaCBkYXRhIHRvIGxvYWQvZHJhdyBhbmQgdGhhdCB0aGUgdXNlciBuZWVkcyB0byB6b29tIHRvIHNlZSBtb3JlXG4gICAgICAgIGNhbnZhcy5jbGFzc05hbWUgPSBjYW52YXMuY2xhc3NOYW1lICsgJyB0b28tbWFueSc7XG4gICAgICB9IGVsc2UgaWYgKGRlbnNpdHkgPT0gJ2RlbnNlJykge1xuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gMTU7XG4gICAgICAgIF8uZWFjaChkcmF3U3BlYywgZnVuY3Rpb24ocEludCkge1xuICAgICAgICAgIGN0eC5maWxsUmVjdChwSW50LngsIDEsIHBJbnQudywgMTMpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBkcmF3U3BlYy5sYXlvdXQubGVuZ3RoICogbGluZUhlaWdodDtcbiAgICAgICAgXy5lYWNoKGRyYXdTcGVjLmxheW91dCwgZnVuY3Rpb24obCwgaSkge1xuICAgICAgICAgIF8uZWFjaChsLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICB2YXIgYWx0Q29sb3IsIHJlZkNvbG9yO1xuICAgICAgICAgICAgaWYgKGFyZWFzKSB7XG4gICAgICAgICAgICAgIHJlZkNvbG9yID0gY29sb3JzW2RhdGEuZC5yZWYudG9Mb3dlckNhc2UoKV0gfHwgJzI1NSwwLDAnO1xuICAgICAgICAgICAgICBhbHRDb2xvciA9IGNvbG9yc1tkYXRhLmQuYWx0LnRvTG93ZXJDYXNlKCldIHx8ICcyNTUsMCwwJztcbiAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiKFwiICsgYWx0Q29sb3IgKyBcIilcIjsgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdHguZmlsbFJlY3QoZGF0YS5wSW50LngsIGkgKiBsaW5lSGVpZ2h0ICsgMSwgZGF0YS5wSW50LncsIGxpbmVIZWlnaHQgLSAxKTtcbiAgICAgICAgICAgIGlmIChhcmVhcykge1xuICAgICAgICAgICAgICBhcmVhcy5wdXNoKFtcbiAgICAgICAgICAgICAgICBkYXRhLnBJbnQueCwgaSAqIGxpbmVIZWlnaHQgKyAxLCBkYXRhLnBJbnQueCArIGRhdGEucEludC53LCAoaSArIDEpICogbGluZUhlaWdodCwgLy94MSwgeDIsIHkxLCB5MlxuICAgICAgICAgICAgICAgIGRhdGEuZC5yZWYgKyAnID4gJyArIGRhdGEuZC5hbHQsIC8vIHRpdGxlXG4gICAgICAgICAgICAgICAgdXJsVGVtcGxhdGUucmVwbGFjZSgnJCQnLCBkYXRhLmQuaWQpLCAvLyBocmVmXG4gICAgICAgICAgICAgICAgZGF0YS5wSW50Lm9QcmV2LCAvLyBjb250aW51YXRpb24gZnJvbSBwcmV2aW91cyB0aWxlP1xuICAgICAgICAgICAgICAgIGFsdENvbG9yLCAvLyBsYWJlbCBjb2xvclxuICAgICAgICAgICAgICAgICc8c3BhbiBzdHlsZT1cImNvbG9yOiByZ2IoJyArIHJlZkNvbG9yICsgJylcIj4nICsgZGF0YS5kLnJlZiArICc8L3NwYW4+PGJyLz4nICsgZGF0YS5kLmFsdCwgLy8gbGFiZWxcbiAgICAgICAgICAgICAgICBkYXRhLmQuaW5mb1xuICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkgeyBjYWxsYmFjaygpOyB9XG4gICAgfSk7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVmNmVGFiaXhGb3JtYXQ7XG5cbiIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSBXSUcgZm9ybWF0OiBodHRwOi8vZ2Vub21lLnVjc2MuZWR1L2dvbGRlblBhdGgvaGVscC93aWdnbGUuaHRtbCA9XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy91dGlscy5qcycpLFxuICBwYXJzZUludDEwID0gdXRpbHMucGFyc2VJbnQxMCxcbiAgcGFyc2VEZWNsYXJhdGlvbkxpbmUgPSB1dGlscy5wYXJzZURlY2xhcmF0aW9uTGluZTtcbnZhciBTb3J0ZWRMaXN0ID0gcmVxdWlyZSgnLi91dGlscy9Tb3J0ZWRMaXN0LmpzJykuU29ydGVkTGlzdDtcblxuLy8gSW50ZW5kZWQgdG8gYmUgbG9hZGVkIGludG8gQ3VzdG9tVHJhY2sudHlwZXMud2lnZ2xlXzBcbnZhciBXaWdnbGVGb3JtYXQgPSB7XG4gIGRlZmF1bHRzOiB7XG4gICAgYWx0Q29sb3I6ICcnLFxuICAgIHByaW9yaXR5OiAxMDAsXG4gICAgYXV0b1NjYWxlOiAnb24nLFxuICAgIGFsd2F5c1plcm86ICdvZmYnLFxuICAgIGdyaWREZWZhdWx0OiAnb2ZmJyxcbiAgICBtYXhIZWlnaHRQaXhlbHM6ICcxMjg6MTI4OjE1JyxcbiAgICBncmFwaFR5cGU6ICdiYXInLFxuICAgIHZpZXdMaW1pdHM6ICcnLFxuICAgIHlMaW5lTWFyazogMC4wLFxuICAgIHlMaW5lT25PZmY6ICdvZmYnLFxuICAgIHdpbmRvd2luZ0Z1bmN0aW9uOiAnbWF4aW11bScsXG4gICAgc21vb3RoaW5nV2luZG93OiAnb2ZmJ1xuICB9LFxuXG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudHlwZSgpLmluaXRPcHRzLmNhbGwodGhpcyk7XG4gIH0sXG4gIFxuICBfYmluRnVuY3Rpb25zOiB1dGlscy53aWdCaW5GdW5jdGlvbnMsXG4gIFxuICBpbml0T3B0czogZnVuY3Rpb24oKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdHMsXG4gICAgICBfYmluRnVuY3Rpb25zID0gdGhpcy50eXBlKCkuX2JpbkZ1bmN0aW9ucztcbiAgICBpZiAoIXRoaXMudmFsaWRhdGVDb2xvcihvLmFsdENvbG9yKSkgeyBvLmFsdENvbG9yID0gJyc7IH1cbiAgICBvLnZpZXdMaW1pdHMgPSBfLm1hcChvLnZpZXdMaW1pdHMuc3BsaXQoJzonKSwgcGFyc2VGbG9hdCk7XG4gICAgby5tYXhIZWlnaHRQaXhlbHMgPSBfLm1hcChvLm1heEhlaWdodFBpeGVscy5zcGxpdCgnOicpLCBwYXJzZUludDEwKTtcbiAgICBvLnlMaW5lT25PZmYgPSB0aGlzLmlzT24oby55TGluZU9uT2ZmKTtcbiAgICBvLnlMaW5lTWFyayA9IHBhcnNlRmxvYXQoby55TGluZU1hcmspO1xuICAgIG8uYXV0b1NjYWxlID0gdGhpcy5pc09uKG8uYXV0b1NjYWxlKTtcbiAgICBpZiAoX2JpbkZ1bmN0aW9ucyAmJiAhX2JpbkZ1bmN0aW9uc1tvLndpbmRvd2luZ0Z1bmN0aW9uXSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaW52YWxpZCB3aW5kb3dpbmdGdW5jdGlvbiBhdCBsaW5lIFwiICsgby5saW5lTnVtKTsgXG4gICAgfVxuICAgIGlmIChfLmlzTmFOKG8ueUxpbmVNYXJrKSkgeyBvLnlMaW5lTWFyayA9IDAuMDsgfVxuICB9LFxuICBcbiAgYXBwbHlPcHRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gc2VsZi5vcHRzO1xuICAgIHNlbGYuZHJhd1JhbmdlID0gby5hdXRvU2NhbGUgfHwgby52aWV3TGltaXRzLmxlbmd0aCA8IDIgPyBzZWxmLnJhbmdlIDogby52aWV3TGltaXRzO1xuICAgIF8uZWFjaCh7bWF4OiAwLCBtaW46IDIsIHN0YXJ0OiAxfSwgZnVuY3Rpb24odiwgaykgeyBzZWxmLmhlaWdodHNba10gPSBvLm1heEhlaWdodFBpeGVsc1t2XTsgfSk7XG4gICAgaWYgKCFvLmFsdENvbG9yKSB7XG4gICAgICB2YXIgaHNsID0gdGhpcy5yZ2JUb0hzbC5hcHBseSh0aGlzLCBvLmNvbG9yLnNwbGl0KC8sXFxzKi9nKSk7XG4gICAgICBoc2xbMF0gPSBoc2xbMF0gKyAwLjAyICUgMTtcbiAgICAgIGhzbFsxXSA9IGhzbFsxXSAqIDAuNztcbiAgICAgIGhzbFsyXSA9IDEgLSAoMSAtIGhzbFsyXSkgKiAwLjc7XG4gICAgICBzZWxmLmFsdENvbG9yID0gXy5tYXAodGhpcy5oc2xUb1JnYi5hcHBseSh0aGlzLCBoc2wpLCBwYXJzZUludDEwKS5qb2luKCcsJyk7XG4gICAgfVxuICB9LFxuXG4gIHBhcnNlOiBmdW5jdGlvbihsaW5lcykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIGdlbm9tZVNpemUgPSB0aGlzLmJyb3dzZXJPcHRzLmdlbm9tZVNpemUsXG4gICAgICBkYXRhID0ge2FsbDogW119LFxuICAgICAgbW9kZSwgbW9kZU9wdHMsIGNoclBvcywgbTtcbiAgICBzZWxmLnJhbmdlID0gc2VsZi5pc09uKHRoaXMub3B0cy5hbHdheXNaZXJvKSA/IFswLCAwXSA6IFtJbmZpbml0eSwgLUluZmluaXR5XTtcbiAgXG4gICAgXy5lYWNoKGxpbmVzLCBmdW5jdGlvbihsaW5lLCBsaW5lbm8pIHtcbiAgICAgIHZhciB2YWwsIHN0YXJ0O1xuICAgICAgXG4gICAgICBtID0gbGluZS5tYXRjaCgvXih2YXJpYWJsZXxmaXhlZClTdGVwXFxzKy9pKTtcbiAgICAgIGlmIChtKSB7XG4gICAgICAgIG1vZGUgPSBtWzFdLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIG1vZGVPcHRzID0gcGFyc2VEZWNsYXJhdGlvbkxpbmUobGluZSwgL14odmFyaWFibGV8Zml4ZWQpU3RlcFxccysvaSk7XG4gICAgICAgIG1vZGVPcHRzLnN0YXJ0ID0gcGFyc2VJbnQxMChtb2RlT3B0cy5zdGFydCk7XG4gICAgICAgIGlmIChtb2RlID09ICdmaXhlZCcgJiYgKF8uaXNOYU4obW9kZU9wdHMuc3RhcnQpIHx8ICFtb2RlT3B0cy5zdGFydCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJmaXhlZFN0ZXAgYXQgbGluZSBcIiArIChsaW5lbm8gKyAxICsgc2VsZi5vcHRzLmxpbmVOdW0pICsgXCIgcmVxdWlyZSBub24temVybyBzdGFydCBwYXJhbWV0ZXJcIik7IFxuICAgICAgICB9XG4gICAgICAgIG1vZGVPcHRzLnN0ZXAgPSBwYXJzZUludDEwKG1vZGVPcHRzLnN0ZXApO1xuICAgICAgICBpZiAobW9kZSA9PSAnZml4ZWQnICYmIChfLmlzTmFOKG1vZGVPcHRzLnN0ZXApIHx8ICFtb2RlT3B0cy5zdGVwKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImZpeGVkU3RlcCBhdCBsaW5lIFwiICsgKGxpbmVubyArIDEgKyBzZWxmLm9wdHMubGluZU51bSkgKyBcIiByZXF1aXJlIG5vbi16ZXJvIHN0ZXAgcGFyYW1ldGVyXCIpOyBcbiAgICAgICAgfVxuICAgICAgICBtb2RlT3B0cy5zcGFuID0gcGFyc2VJbnQxMChtb2RlT3B0cy5zcGFuKSB8fCAxO1xuICAgICAgICBjaHJQb3MgPSBzZWxmLmJyb3dzZXJPcHRzLmNoclBvc1ttb2RlT3B0cy5jaHJvbV07XG4gICAgICAgIGlmIChfLmlzVW5kZWZpbmVkKGNoclBvcykpIHtcbiAgICAgICAgICBzZWxmLndhcm4oXCJJbnZhbGlkIGNocm9tb3NvbWUgYXQgbGluZSBcIiArIChsaW5lbm8gKyAxICsgc2VsZi5vcHRzLmxpbmVOdW0pKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFtb2RlKSB7IFxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIldpZ2dsZSBmb3JtYXQgYXQgXCIgKyAobGluZW5vICsgMSArIHNlbGYub3B0cy5saW5lTnVtKSArIFwiIGhhcyBubyBwcmVjZWRpbmcgbW9kZSBkZWNsYXJhdGlvblwiKTsgXG4gICAgICAgIH0gZWxzZSBpZiAoXy5pc1VuZGVmaW5lZChjaHJQb3MpKSB7XG4gICAgICAgICAgLy8gaW52YWxpZCBjaHJvbW9zb21lXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKG1vZGUgPT0gJ2ZpeGVkJykge1xuICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChsaW5lKTtcbiAgICAgICAgICAgIGRhdGEuYWxsLnB1c2goe3N0YXJ0OiBjaHJQb3MgKyBtb2RlT3B0cy5zdGFydCwgZW5kOiBjaHJQb3MgKyBtb2RlT3B0cy5zdGFydCArIG1vZGVPcHRzLnNwYW4sIHZhbDogdmFsfSk7XG4gICAgICAgICAgICBtb2RlT3B0cy5zdGFydCArPSBtb2RlT3B0cy5zdGVwO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsaW5lID0gbGluZS5zcGxpdCgvXFxzKy8pO1xuICAgICAgICAgICAgaWYgKGxpbmUubGVuZ3RoIDwgMikge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ2YXJpYWJsZVN0ZXAgYXQgbGluZSBcIiArIChsaW5lbm8gKyAxICsgc2VsZi5vcHRzLmxpbmVOdW0pICsgXCIgcmVxdWlyZXMgdHdvIHZhbHVlcyBwZXIgbGluZVwiKTsgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdGFydCA9IHBhcnNlSW50MTAobGluZVswXSk7XG4gICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGxpbmVbMV0pO1xuICAgICAgICAgICAgZGF0YS5hbGwucHVzaCh7c3RhcnQ6IGNoclBvcyArIHN0YXJ0LCBlbmQ6IGNoclBvcyArIHN0YXJ0ICsgbW9kZU9wdHMuc3BhbiwgdmFsOiB2YWx9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gc2VsZi50eXBlKCkuZmluaXNoUGFyc2UuY2FsbChzZWxmLCBkYXRhKTtcbiAgfSxcbiAgXG4gIGZpbmlzaFBhcnNlOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgYmluRnVuY3Rpb24gPSBzZWxmLnR5cGUoKS5fYmluRnVuY3Rpb25zW3NlbGYub3B0cy53aW5kb3dpbmdGdW5jdGlvbl07XG4gICAgaWYgKGRhdGEuYWxsLmxlbmd0aCA+IDApIHtcbiAgICAgIHNlbGYucmFuZ2VbMF0gPSBfLm1pbihkYXRhLmFsbCwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC52YWw7IH0pLnZhbDtcbiAgICAgIHNlbGYucmFuZ2VbMV0gPSBfLm1heChkYXRhLmFsbCwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC52YWw7IH0pLnZhbDtcbiAgICB9XG4gICAgZGF0YS5hbGwgPSBuZXcgU29ydGVkTGlzdChkYXRhLmFsbCwge1xuICAgICAgY29tcGFyZTogZnVuY3Rpb24oYSwgYikge1xuICAgICAgICBpZiAoYSA9PT0gbnVsbCkgcmV0dXJuIC0xO1xuICAgICAgICBpZiAoYiA9PT0gbnVsbCkgcmV0dXJuICAxO1xuICAgICAgICB2YXIgYyA9IGEuc3RhcnQgLSBiLnN0YXJ0O1xuICAgICAgICByZXR1cm4gKGMgPiAwKSA/IDEgOiAoYyA9PT0gMCkgID8gMCA6IC0xO1xuICAgICAgfVxuICAgIH0pO1xuICBcbiAgICAvLyBQcmUtb3B0aW1pemUgZGF0YSBmb3IgaGlnaCBicHBwcyBieSBkb3duc2FtcGxpbmdcbiAgICBfLmVhY2goc2VsZi5icm93c2VyT3B0cy5icHBwcywgZnVuY3Rpb24oYnBwcCkge1xuICAgICAgaWYgKHNlbGYuYnJvd3Nlck9wdHMuZ2Vub21lU2l6ZSAvIGJwcHAgPiAxMDAwMDAwKSB7IHJldHVybjsgfVxuICAgICAgdmFyIHBpeExlbiA9IE1hdGguY2VpbChzZWxmLmJyb3dzZXJPcHRzLmdlbm9tZVNpemUgLyBicHBwKSxcbiAgICAgICAgZG93bnNhbXBsZWREYXRhID0gKGRhdGFbYnBwcF0gPSAoZ2xvYmFsLkZsb2F0MzJBcnJheSA/IG5ldyBGbG9hdDMyQXJyYXkocGl4TGVuKSA6IG5ldyBBcnJheShwaXhMZW4pKSksXG4gICAgICAgIGogPSAwLFxuICAgICAgICBjdXJyID0gZGF0YS5hbGwuZ2V0KDApLFxuICAgICAgICBiaW4sIG5leHQ7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBpeExlbjsgaSsrKSB7XG4gICAgICAgIGJpbiA9IGN1cnIgJiYgKGN1cnIuc3RhcnQgPD0gaSAqIGJwcHAgJiYgY3Vyci5lbmQgPiBpICogYnBwcCkgPyBbY3Vyci52YWxdIDogW107XG4gICAgICAgIHdoaWxlICgobmV4dCA9IGRhdGEuYWxsLmdldChqICsgMSkpICYmIG5leHQuc3RhcnQgPCAoaSArIDEpICogYnBwcCAmJiBuZXh0LmVuZCA+IGkgKiBicHBwKSB7IFxuICAgICAgICAgIGJpbi5wdXNoKG5leHQudmFsKTsgKytqOyBjdXJyID0gbmV4dDsgXG4gICAgICAgIH1cbiAgICAgICAgZG93bnNhbXBsZWREYXRhW2ldID0gYmluRnVuY3Rpb24oYmluKTtcbiAgICAgIH1cbiAgICAgIGRhdGEuX2JpbkZ1bmN0aW9uID0gc2VsZi5vcHRzLndpbmRvd2luZ0Z1bmN0aW9uO1xuICAgIH0pO1xuICAgIHNlbGYuZGF0YSA9IGRhdGE7XG4gICAgc2VsZi5zdHJldGNoSGVpZ2h0ID0gdHJ1ZTtcbiAgICBzZWxmLnR5cGUoJ3dpZ2dsZV8wJykuYXBwbHlPcHRzLmFwcGx5KHNlbGYpO1xuICAgIHJldHVybiB0cnVlOyAvLyBzdWNjZXNzIVxuICB9LFxuICBcbiAgaW5pdERyYXdTcGVjOiBmdW5jdGlvbihwcmVjYWxjKSB7XG4gICAgdmFyIHZTY2FsZSA9ICh0aGlzLmRyYXdSYW5nZVsxXSAtIHRoaXMuZHJhd1JhbmdlWzBdKSAvIHByZWNhbGMuaGVpZ2h0LFxuICAgICAgZHJhd1NwZWMgPSB7XG4gICAgICAgIGJhcnM6IFtdLFxuICAgICAgICB2U2NhbGU6IHZTY2FsZSxcbiAgICAgICAgeUxpbmU6IHRoaXMuaXNPbih0aGlzLm9wdHMueUxpbmVPbk9mZikgPyBNYXRoLnJvdW5kKCh0aGlzLm9wdHMueUxpbmVNYXJrIC0gdGhpcy5kcmF3UmFuZ2VbMF0pIC8gdlNjYWxlKSA6IG51bGwsIFxuICAgICAgICB6ZXJvTGluZTogLXRoaXMuZHJhd1JhbmdlWzBdIC8gdlNjYWxlXG4gICAgICB9O1xuICAgIHJldHVybiBkcmF3U3BlYztcbiAgfSxcblxuICBwcmVyZW5kZXI6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHByZWNhbGMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgYnBwcCA9IChlbmQgLSBzdGFydCkgLyBwcmVjYWxjLndpZHRoLFxuICAgICAgZHJhd1NwZWMgPSBzZWxmLnR5cGUoKS5pbml0RHJhd1NwZWMuY2FsbChzZWxmLCBwcmVjYWxjKSxcbiAgICAgIGJpbkZ1bmN0aW9uID0gc2VsZi50eXBlKCkuX2JpbkZ1bmN0aW9uc1tzZWxmLm9wdHMud2luZG93aW5nRnVuY3Rpb25dLFxuICAgICAgZG93bnNhbXBsZWREYXRhO1xuICAgIGlmIChzZWxmLmRhdGEuX2JpbkZ1bmN0aW9uID09IHNlbGYub3B0cy53aW5kb3dpbmdGdW5jdGlvbiAmJiAoZG93bnNhbXBsZWREYXRhID0gc2VsZi5kYXRhW2JwcHBdKSkge1xuICAgICAgLy8gV2UndmUgYWxyZWFkeSBwcmUtb3B0aW1pemVkIGZvciB0aGlzIGJwcHBcbiAgICAgIGRyYXdTcGVjLmJhcnMgPSBfLm1hcChfLnJhbmdlKChzdGFydCAtIDEpIC8gYnBwcCwgKGVuZCAtIDEpIC8gYnBwcCksIGZ1bmN0aW9uKHhGcm9tT3JpZ2luLCB4KSB7XG4gICAgICAgIHJldHVybiAoKGRvd25zYW1wbGVkRGF0YVt4RnJvbU9yaWdpbl0gfHwgMCkgLSBzZWxmLmRyYXdSYW5nZVswXSkgLyBkcmF3U3BlYy52U2NhbGU7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gV2UgaGF2ZSB0byBkbyB0aGUgYmlubmluZyBvbiB0aGUgZmx5XG4gICAgICB2YXIgaiA9IHNlbGYuZGF0YS5hbGwuYnNlYXJjaCh7c3RhcnQ6IHN0YXJ0fSksXG4gICAgICAgIGN1cnIgPSBzZWxmLmRhdGEuYWxsLmdldChqKSwgbmV4dCwgYmluO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcmVjYWxjLndpZHRoOyBpKyspIHtcbiAgICAgICAgYmluID0gY3VyciAmJiAoY3Vyci5lbmQgPj0gaSAqIGJwcHAgKyBzdGFydCkgPyBbY3Vyci52YWxdIDogW107XG4gICAgICAgIHdoaWxlICgobmV4dCA9IHNlbGYuZGF0YS5hbGwuZ2V0KGogKyAxKSkgJiYgbmV4dC5zdGFydCA8IChpICsgMSkgKiBicHBwICsgc3RhcnQgJiYgbmV4dC5lbmQgPj0gaSAqIGJwcHAgKyBzdGFydCkgeyBcbiAgICAgICAgICBiaW4ucHVzaChuZXh0LnZhbCk7ICsrajsgY3VyciA9IG5leHQ7IFxuICAgICAgICB9XG4gICAgICAgIGRyYXdTcGVjLmJhcnMucHVzaCgoYmluRnVuY3Rpb24oYmluKSAtIHNlbGYuZHJhd1JhbmdlWzBdKSAvIGRyYXdTcGVjLnZTY2FsZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBfLmlzRnVuY3Rpb24oY2FsbGJhY2spID8gY2FsbGJhY2soZHJhd1NwZWMpIDogZHJhd1NwZWM7XG4gIH0sXG4gIFxuICBkcmF3QmFyczogZnVuY3Rpb24oY3R4LCBkcmF3U3BlYywgaGVpZ2h0LCB3aWR0aCkge1xuICAgIHZhciB6ZXJvTGluZSA9IGRyYXdTcGVjLnplcm9MaW5lLCAvLyBwaXhlbCBwb3NpdGlvbiBvZiB0aGUgZGF0YSB2YWx1ZSAwXG4gICAgICBjb2xvciA9IFwicmdiKFwiK3RoaXMub3B0cy5jb2xvcitcIilcIixcbiAgICAgIGFsdENvbG9yID0gXCJyZ2IoXCIrKHRoaXMub3B0cy5hbHRDb2xvciB8fCB0aGlzLmFsdENvbG9yKStcIilcIixcbiAgICAgIHBvaW50R3JhcGggPSB0aGlzLm9wdHMuZ3JhcGhUeXBlPT09J3BvaW50cyc7XG4gICAgXG4gICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xuICAgIF8uZWFjaChkcmF3U3BlYy5iYXJzLCBmdW5jdGlvbihkLCB4KSB7XG4gICAgICBpZiAoZCA9PT0gbnVsbCkgeyByZXR1cm47IH1cbiAgICAgIGVsc2UgaWYgKGQgPiB6ZXJvTGluZSkgeyBcbiAgICAgICAgaWYgKHBvaW50R3JhcGgpIHsgY3R4LmZpbGxSZWN0KHgsIGhlaWdodCAtIGQsIDEsIDEpOyB9XG4gICAgICAgIGVsc2UgeyBjdHguZmlsbFJlY3QoeCwgaGVpZ2h0IC0gZCwgMSwgemVyb0xpbmUgPiAwID8gKGQgLSB6ZXJvTGluZSkgOiBkKTsgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGFsdENvbG9yO1xuICAgICAgICBpZiAocG9pbnRHcmFwaCkgeyBjdHguZmlsbFJlY3QoeCwgemVyb0xpbmUgLSBkIC0gMSwgMSwgMSk7IH0gXG4gICAgICAgIGVsc2UgeyBjdHguZmlsbFJlY3QoeCwgaGVpZ2h0IC0gemVyb0xpbmUsIDEsIHplcm9MaW5lIC0gZCk7IH1cbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChkcmF3U3BlYy55TGluZSAhPT0gbnVsbCkge1xuICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiKDAsMCwwKVwiO1xuICAgICAgY3R4LmZpbGxSZWN0KDAsIGhlaWdodCAtIGRyYXdTcGVjLnlMaW5lLCB3aWR0aCwgMSk7XG4gICAgfVxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oY2FudmFzLCBzdGFydCwgZW5kLCBkZW5zaXR5LCBjYWxsYmFjaykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIGhlaWdodCA9IGNhbnZhcy5oZWlnaHQsXG4gICAgICB3aWR0aCA9IGNhbnZhcy53aWR0aCxcbiAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0ICYmIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIGlmICghY3R4KSB7IHRocm93IFwiQ2FudmFzIG5vdCBzdXBwb3J0ZWRcIjsgfVxuICAgIHNlbGYucHJlcmVuZGVyKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHt3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0fSwgZnVuY3Rpb24oZHJhd1NwZWMpIHtcbiAgICAgIHNlbGYudHlwZSgpLmRyYXdCYXJzLmNhbGwoc2VsZiwgY3R4LCBkcmF3U3BlYywgaGVpZ2h0LCB3aWR0aCk7XG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkgeyBjYWxsYmFjaygpOyB9XG4gICAgfSk7XG4gIH0sXG4gIFxuICBsb2FkT3B0czogZnVuY3Rpb24oJGRpYWxvZykge1xuICAgIHZhciBvID0gdGhpcy5vcHRzLFxuICAgICAgJHZpZXdMaW1pdHMgPSAkZGlhbG9nLmZpbmQoJy52aWV3LWxpbWl0cycpLFxuICAgICAgJG1heEhlaWdodFBpeGVscyA9ICRkaWFsb2cuZmluZCgnLm1heC1oZWlnaHQtcGl4ZWxzJyksXG4gICAgICBhbHRDb2xvck9uID0gdGhpcy52YWxpZGF0ZUNvbG9yKG8uYWx0Q29sb3IpO1xuICAgICRkaWFsb2cuZmluZCgnW25hbWU9YWx0Q29sb3JPbl0nKS5hdHRyKCdjaGVja2VkJywgYWx0Q29sb3JPbikuY2hhbmdlKCk7XG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT1hbHRDb2xvcl0nKS52YWwoYWx0Q29sb3JPbiA/IG8uYWx0Q29sb3IgOicxMjgsMTI4LDEyOCcpLmNoYW5nZSgpO1xuICAgICRkaWFsb2cuZmluZCgnW25hbWU9YXV0b1NjYWxlXScpLmF0dHIoJ2NoZWNrZWQnLCAhdGhpcy5pc09uKG8uYXV0b1NjYWxlKSkuY2hhbmdlKCk7XG4gICAgJHZpZXdMaW1pdHMuc2xpZGVyKFwib3B0aW9uXCIsIFwibWluXCIsIHRoaXMucmFuZ2VbMF0pO1xuICAgICR2aWV3TGltaXRzLnNsaWRlcihcIm9wdGlvblwiLCBcIm1heFwiLCB0aGlzLnJhbmdlWzFdKTtcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPXZpZXdMaW1pdHNNaW5dJykudmFsKHRoaXMuZHJhd1JhbmdlWzBdKS5jaGFuZ2UoKTtcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPXZpZXdMaW1pdHNNYXhdJykudmFsKHRoaXMuZHJhd1JhbmdlWzFdKS5jaGFuZ2UoKTtcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPXlMaW5lT25PZmZdJykuYXR0cignY2hlY2tlZCcsIHRoaXMuaXNPbihvLnlMaW5lT25PZmYpKS5jaGFuZ2UoKTtcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPXlMaW5lTWFya10nKS52YWwoby55TGluZU1hcmspLmNoYW5nZSgpO1xuICAgICRkaWFsb2cuZmluZCgnW25hbWU9Z3JhcGhUeXBlXScpLnZhbChvLmdyYXBoVHlwZSkuY2hhbmdlKCk7XG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT13aW5kb3dpbmdGdW5jdGlvbl0nKS52YWwoby53aW5kb3dpbmdGdW5jdGlvbikuY2hhbmdlKCk7XG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT1tYXhIZWlnaHRQaXhlbHNPbl0nKS5hdHRyKCdjaGVja2VkJywgby5tYXhIZWlnaHRQaXhlbHMubGVuZ3RoID49IDMpO1xuICAgICRkaWFsb2cuZmluZCgnW25hbWU9bWF4SGVpZ2h0UGl4ZWxzTWluXScpLnZhbChvLm1heEhlaWdodFBpeGVsc1syXSkuY2hhbmdlKCk7XG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT1tYXhIZWlnaHRQaXhlbHNNYXhdJykudmFsKG8ubWF4SGVpZ2h0UGl4ZWxzWzBdKS5jaGFuZ2UoKTtcbiAgfSxcbiAgXG4gIHNhdmVPcHRzOiBmdW5jdGlvbigkZGlhbG9nKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdHMsXG4gICAgICBhbHRDb2xvck9uID0gJGRpYWxvZy5maW5kKCdbbmFtZT1hbHRDb2xvck9uXScpLmlzKCc6Y2hlY2tlZCcpLFxuICAgICAgbWF4SGVpZ2h0UGl4ZWxzT24gPSAkZGlhbG9nLmZpbmQoJ1tuYW1lPW1heEhlaWdodFBpeGVsc09uXScpLmlzKCc6Y2hlY2tlZCcpLFxuICAgICAgbWF4SGVpZ2h0UGl4ZWxzTWF4ID0gJGRpYWxvZy5maW5kKCdbbmFtZT1tYXhIZWlnaHRQaXhlbHNNYXhdJykudmFsKCk7XG4gICAgby5hbHRDb2xvciA9IGFsdENvbG9yT24gPyAkZGlhbG9nLmZpbmQoJ1tuYW1lPWFsdENvbG9yXScpLnZhbCgpIDogJyc7XG4gICAgby5hdXRvU2NhbGUgPSAhJGRpYWxvZy5maW5kKCdbbmFtZT1hdXRvU2NhbGVdJykuaXMoJzpjaGVja2VkJyk7XG4gICAgby52aWV3TGltaXRzID0gJGRpYWxvZy5maW5kKCdbbmFtZT12aWV3TGltaXRzTWluXScpLnZhbCgpICsgJzonICsgJGRpYWxvZy5maW5kKCdbbmFtZT12aWV3TGltaXRzTWF4XScpLnZhbCgpO1xuICAgIG8ueUxpbmVPbk9mZiA9ICRkaWFsb2cuZmluZCgnW25hbWU9eUxpbmVPbk9mZl0nKS5pcygnOmNoZWNrZWQnKTtcbiAgICBvLnlMaW5lTWFyayA9ICRkaWFsb2cuZmluZCgnW25hbWU9eUxpbmVNYXJrXScpLnZhbCgpO1xuICAgIG8uZ3JhcGhUeXBlID0gJGRpYWxvZy5maW5kKCdbbmFtZT1ncmFwaFR5cGVdJykudmFsKCk7XG4gICAgby53aW5kb3dpbmdGdW5jdGlvbiA9ICRkaWFsb2cuZmluZCgnW25hbWU9d2luZG93aW5nRnVuY3Rpb25dJykudmFsKCk7XG4gICAgby5tYXhIZWlnaHRQaXhlbHMgPSBtYXhIZWlnaHRQaXhlbHNPbiA/IFxuICAgICAgW21heEhlaWdodFBpeGVsc01heCwgbWF4SGVpZ2h0UGl4ZWxzTWF4LCAkZGlhbG9nLmZpbmQoJ1tuYW1lPW1heEhlaWdodFBpeGVsc01pbl0nKS52YWwoKV0uam9pbignOicpIDogJyc7XG4gICAgdGhpcy50eXBlKCd3aWdnbGVfMCcpLmluaXRPcHRzLmNhbGwodGhpcyk7XG4gIH1cbiAgXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFdpZ2dsZUZvcm1hdDsiLCIvKiEgalF1ZXJ5IHYxLjcuMSBqcXVlcnkuY29tIHwganF1ZXJ5Lm9yZy9saWNlbnNlIHwgbW9kaWZpZWQgdG8gdXNlIGJyb3dzZXJpZnkvbnBtIHN0eWxlIG1vZHVsZS5leHBvcnRzICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gY3koYSl7cmV0dXJuIGYuaXNXaW5kb3coYSk/YTphLm5vZGVUeXBlPT09OT9hLmRlZmF1bHRWaWV3fHxhLnBhcmVudFdpbmRvdzohMX1mdW5jdGlvbiBjdihhKXtpZighY2tbYV0pe3ZhciBiPWMuYm9keSxkPWYoXCI8XCIrYStcIj5cIikuYXBwZW5kVG8oYiksZT1kLmNzcyhcImRpc3BsYXlcIik7ZC5yZW1vdmUoKTtpZihlPT09XCJub25lXCJ8fGU9PT1cIlwiKXtjbHx8KGNsPWMuY3JlYXRlRWxlbWVudChcImlmcmFtZVwiKSxjbC5mcmFtZUJvcmRlcj1jbC53aWR0aD1jbC5oZWlnaHQ9MCksYi5hcHBlbmRDaGlsZChjbCk7aWYoIWNtfHwhY2wuY3JlYXRlRWxlbWVudCljbT0oY2wuY29udGVudFdpbmRvd3x8Y2wuY29udGVudERvY3VtZW50KS5kb2N1bWVudCxjbS53cml0ZSgoYy5jb21wYXRNb2RlPT09XCJDU1MxQ29tcGF0XCI/XCI8IWRvY3R5cGUgaHRtbD5cIjpcIlwiKStcIjxodG1sPjxib2R5PlwiKSxjbS5jbG9zZSgpO2Q9Y20uY3JlYXRlRWxlbWVudChhKSxjbS5ib2R5LmFwcGVuZENoaWxkKGQpLGU9Zi5jc3MoZCxcImRpc3BsYXlcIiksYi5yZW1vdmVDaGlsZChjbCl9Y2tbYV09ZX1yZXR1cm4gY2tbYV19ZnVuY3Rpb24gY3UoYSxiKXt2YXIgYz17fTtmLmVhY2goY3EuY29uY2F0LmFwcGx5KFtdLGNxLnNsaWNlKDAsYikpLGZ1bmN0aW9uKCl7Y1t0aGlzXT1hfSk7cmV0dXJuIGN9ZnVuY3Rpb24gY3QoKXtjcj1ifWZ1bmN0aW9uIGNzKCl7c2V0VGltZW91dChjdCwwKTtyZXR1cm4gY3I9Zi5ub3coKX1mdW5jdGlvbiBjaigpe3RyeXtyZXR1cm4gbmV3IGEuQWN0aXZlWE9iamVjdChcIk1pY3Jvc29mdC5YTUxIVFRQXCIpfWNhdGNoKGIpe319ZnVuY3Rpb24gY2koKXt0cnl7cmV0dXJuIG5ldyBhLlhNTEh0dHBSZXF1ZXN0fWNhdGNoKGIpe319ZnVuY3Rpb24gY2MoYSxjKXthLmRhdGFGaWx0ZXImJihjPWEuZGF0YUZpbHRlcihjLGEuZGF0YVR5cGUpKTt2YXIgZD1hLmRhdGFUeXBlcyxlPXt9LGcsaCxpPWQubGVuZ3RoLGosaz1kWzBdLGwsbSxuLG8scDtmb3IoZz0xO2c8aTtnKyspe2lmKGc9PT0xKWZvcihoIGluIGEuY29udmVydGVycyl0eXBlb2YgaD09XCJzdHJpbmdcIiYmKGVbaC50b0xvd2VyQ2FzZSgpXT1hLmNvbnZlcnRlcnNbaF0pO2w9ayxrPWRbZ107aWYoaz09PVwiKlwiKWs9bDtlbHNlIGlmKGwhPT1cIipcIiYmbCE9PWspe209bCtcIiBcIitrLG49ZVttXXx8ZVtcIiogXCIra107aWYoIW4pe3A9Yjtmb3IobyBpbiBlKXtqPW8uc3BsaXQoXCIgXCIpO2lmKGpbMF09PT1sfHxqWzBdPT09XCIqXCIpe3A9ZVtqWzFdK1wiIFwiK2tdO2lmKHApe289ZVtvXSxvPT09ITA/bj1wOnA9PT0hMCYmKG49byk7YnJlYWt9fX19IW4mJiFwJiZmLmVycm9yKFwiTm8gY29udmVyc2lvbiBmcm9tIFwiK20ucmVwbGFjZShcIiBcIixcIiB0byBcIikpLG4hPT0hMCYmKGM9bj9uKGMpOnAobyhjKSkpfX1yZXR1cm4gY31mdW5jdGlvbiBjYihhLGMsZCl7dmFyIGU9YS5jb250ZW50cyxmPWEuZGF0YVR5cGVzLGc9YS5yZXNwb25zZUZpZWxkcyxoLGksaixrO2ZvcihpIGluIGcpaSBpbiBkJiYoY1tnW2ldXT1kW2ldKTt3aGlsZShmWzBdPT09XCIqXCIpZi5zaGlmdCgpLGg9PT1iJiYoaD1hLm1pbWVUeXBlfHxjLmdldFJlc3BvbnNlSGVhZGVyKFwiY29udGVudC10eXBlXCIpKTtpZihoKWZvcihpIGluIGUpaWYoZVtpXSYmZVtpXS50ZXN0KGgpKXtmLnVuc2hpZnQoaSk7YnJlYWt9aWYoZlswXWluIGQpaj1mWzBdO2Vsc2V7Zm9yKGkgaW4gZCl7aWYoIWZbMF18fGEuY29udmVydGVyc1tpK1wiIFwiK2ZbMF1dKXtqPWk7YnJlYWt9a3x8KGs9aSl9aj1qfHxrfWlmKGope2ohPT1mWzBdJiZmLnVuc2hpZnQoaik7cmV0dXJuIGRbal19fWZ1bmN0aW9uIGNhKGEsYixjLGQpe2lmKGYuaXNBcnJheShiKSlmLmVhY2goYixmdW5jdGlvbihiLGUpe2N8fGJFLnRlc3QoYSk/ZChhLGUpOmNhKGErXCJbXCIrKHR5cGVvZiBlPT1cIm9iamVjdFwifHxmLmlzQXJyYXkoZSk/YjpcIlwiKStcIl1cIixlLGMsZCl9KTtlbHNlIGlmKCFjJiZiIT1udWxsJiZ0eXBlb2YgYj09XCJvYmplY3RcIilmb3IodmFyIGUgaW4gYiljYShhK1wiW1wiK2UrXCJdXCIsYltlXSxjLGQpO2Vsc2UgZChhLGIpfWZ1bmN0aW9uIGJfKGEsYyl7dmFyIGQsZSxnPWYuYWpheFNldHRpbmdzLmZsYXRPcHRpb25zfHx7fTtmb3IoZCBpbiBjKWNbZF0hPT1iJiYoKGdbZF0/YTplfHwoZT17fSkpW2RdPWNbZF0pO2UmJmYuZXh0ZW5kKCEwLGEsZSl9ZnVuY3Rpb24gYiQoYSxjLGQsZSxmLGcpe2Y9Znx8Yy5kYXRhVHlwZXNbMF0sZz1nfHx7fSxnW2ZdPSEwO3ZhciBoPWFbZl0saT0wLGo9aD9oLmxlbmd0aDowLGs9YT09PWJULGw7Zm9yKDtpPGomJihrfHwhbCk7aSsrKWw9aFtpXShjLGQsZSksdHlwZW9mIGw9PVwic3RyaW5nXCImJigha3x8Z1tsXT9sPWI6KGMuZGF0YVR5cGVzLnVuc2hpZnQobCksbD1iJChhLGMsZCxlLGwsZykpKTsoa3x8IWwpJiYhZ1tcIipcIl0mJihsPWIkKGEsYyxkLGUsXCIqXCIsZykpO3JldHVybiBsfWZ1bmN0aW9uIGJaKGEpe3JldHVybiBmdW5jdGlvbihiLGMpe3R5cGVvZiBiIT1cInN0cmluZ1wiJiYoYz1iLGI9XCIqXCIpO2lmKGYuaXNGdW5jdGlvbihjKSl7dmFyIGQ9Yi50b0xvd2VyQ2FzZSgpLnNwbGl0KGJQKSxlPTAsZz1kLmxlbmd0aCxoLGksajtmb3IoO2U8ZztlKyspaD1kW2VdLGo9L15cXCsvLnRlc3QoaCksaiYmKGg9aC5zdWJzdHIoMSl8fFwiKlwiKSxpPWFbaF09YVtoXXx8W10saVtqP1widW5zaGlmdFwiOlwicHVzaFwiXShjKX19fWZ1bmN0aW9uIGJDKGEsYixjKXt2YXIgZD1iPT09XCJ3aWR0aFwiP2Eub2Zmc2V0V2lkdGg6YS5vZmZzZXRIZWlnaHQsZT1iPT09XCJ3aWR0aFwiP2J4OmJ5LGc9MCxoPWUubGVuZ3RoO2lmKGQ+MCl7aWYoYyE9PVwiYm9yZGVyXCIpZm9yKDtnPGg7ZysrKWN8fChkLT1wYXJzZUZsb2F0KGYuY3NzKGEsXCJwYWRkaW5nXCIrZVtnXSkpfHwwKSxjPT09XCJtYXJnaW5cIj9kKz1wYXJzZUZsb2F0KGYuY3NzKGEsYytlW2ddKSl8fDA6ZC09cGFyc2VGbG9hdChmLmNzcyhhLFwiYm9yZGVyXCIrZVtnXStcIldpZHRoXCIpKXx8MDtyZXR1cm4gZCtcInB4XCJ9ZD1ieihhLGIsYik7aWYoZDwwfHxkPT1udWxsKWQ9YS5zdHlsZVtiXXx8MDtkPXBhcnNlRmxvYXQoZCl8fDA7aWYoYylmb3IoO2c8aDtnKyspZCs9cGFyc2VGbG9hdChmLmNzcyhhLFwicGFkZGluZ1wiK2VbZ10pKXx8MCxjIT09XCJwYWRkaW5nXCImJihkKz1wYXJzZUZsb2F0KGYuY3NzKGEsXCJib3JkZXJcIitlW2ddK1wiV2lkdGhcIikpfHwwKSxjPT09XCJtYXJnaW5cIiYmKGQrPXBhcnNlRmxvYXQoZi5jc3MoYSxjK2VbZ10pKXx8MCk7cmV0dXJuIGQrXCJweFwifWZ1bmN0aW9uIGJwKGEsYil7Yi5zcmM/Zi5hamF4KHt1cmw6Yi5zcmMsYXN5bmM6ITEsZGF0YVR5cGU6XCJzY3JpcHRcIn0pOmYuZ2xvYmFsRXZhbCgoYi50ZXh0fHxiLnRleHRDb250ZW50fHxiLmlubmVySFRNTHx8XCJcIikucmVwbGFjZShiZixcIi8qJDAqL1wiKSksYi5wYXJlbnROb2RlJiZiLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYil9ZnVuY3Rpb24gYm8oYSl7dmFyIGI9Yy5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO2JoLmFwcGVuZENoaWxkKGIpLGIuaW5uZXJIVE1MPWEub3V0ZXJIVE1MO3JldHVybiBiLmZpcnN0Q2hpbGR9ZnVuY3Rpb24gYm4oYSl7dmFyIGI9KGEubm9kZU5hbWV8fFwiXCIpLnRvTG93ZXJDYXNlKCk7Yj09PVwiaW5wdXRcIj9ibShhKTpiIT09XCJzY3JpcHRcIiYmdHlwZW9mIGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPVwidW5kZWZpbmVkXCImJmYuZ3JlcChhLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaW5wdXRcIiksYm0pfWZ1bmN0aW9uIGJtKGEpe2lmKGEudHlwZT09PVwiY2hlY2tib3hcInx8YS50eXBlPT09XCJyYWRpb1wiKWEuZGVmYXVsdENoZWNrZWQ9YS5jaGVja2VkfWZ1bmN0aW9uIGJsKGEpe3JldHVybiB0eXBlb2YgYS5nZXRFbGVtZW50c0J5VGFnTmFtZSE9XCJ1bmRlZmluZWRcIj9hLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKTp0eXBlb2YgYS5xdWVyeVNlbGVjdG9yQWxsIT1cInVuZGVmaW5lZFwiP2EucXVlcnlTZWxlY3RvckFsbChcIipcIik6W119ZnVuY3Rpb24gYmsoYSxiKXt2YXIgYztpZihiLm5vZGVUeXBlPT09MSl7Yi5jbGVhckF0dHJpYnV0ZXMmJmIuY2xlYXJBdHRyaWJ1dGVzKCksYi5tZXJnZUF0dHJpYnV0ZXMmJmIubWVyZ2VBdHRyaWJ1dGVzKGEpLGM9Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmKGM9PT1cIm9iamVjdFwiKWIub3V0ZXJIVE1MPWEub3V0ZXJIVE1MO2Vsc2UgaWYoYyE9PVwiaW5wdXRcInx8YS50eXBlIT09XCJjaGVja2JveFwiJiZhLnR5cGUhPT1cInJhZGlvXCIpe2lmKGM9PT1cIm9wdGlvblwiKWIuc2VsZWN0ZWQ9YS5kZWZhdWx0U2VsZWN0ZWQ7ZWxzZSBpZihjPT09XCJpbnB1dFwifHxjPT09XCJ0ZXh0YXJlYVwiKWIuZGVmYXVsdFZhbHVlPWEuZGVmYXVsdFZhbHVlfWVsc2UgYS5jaGVja2VkJiYoYi5kZWZhdWx0Q2hlY2tlZD1iLmNoZWNrZWQ9YS5jaGVja2VkKSxiLnZhbHVlIT09YS52YWx1ZSYmKGIudmFsdWU9YS52YWx1ZSk7Yi5yZW1vdmVBdHRyaWJ1dGUoZi5leHBhbmRvKX19ZnVuY3Rpb24gYmooYSxiKXtpZihiLm5vZGVUeXBlPT09MSYmISFmLmhhc0RhdGEoYSkpe3ZhciBjLGQsZSxnPWYuX2RhdGEoYSksaD1mLl9kYXRhKGIsZyksaT1nLmV2ZW50cztpZihpKXtkZWxldGUgaC5oYW5kbGUsaC5ldmVudHM9e307Zm9yKGMgaW4gaSlmb3IoZD0wLGU9aVtjXS5sZW5ndGg7ZDxlO2QrKylmLmV2ZW50LmFkZChiLGMrKGlbY11bZF0ubmFtZXNwYWNlP1wiLlwiOlwiXCIpK2lbY11bZF0ubmFtZXNwYWNlLGlbY11bZF0saVtjXVtkXS5kYXRhKX1oLmRhdGEmJihoLmRhdGE9Zi5leHRlbmQoe30saC5kYXRhKSl9fWZ1bmN0aW9uIGJpKGEsYil7cmV0dXJuIGYubm9kZU5hbWUoYSxcInRhYmxlXCIpP2EuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0Ym9keVwiKVswXXx8YS5hcHBlbmRDaGlsZChhLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRib2R5XCIpKTphfWZ1bmN0aW9uIFUoYSl7dmFyIGI9Vi5zcGxpdChcInxcIiksYz1hLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtpZihjLmNyZWF0ZUVsZW1lbnQpd2hpbGUoYi5sZW5ndGgpYy5jcmVhdGVFbGVtZW50KGIucG9wKCkpO3JldHVybiBjfWZ1bmN0aW9uIFQoYSxiLGMpe2I9Ynx8MDtpZihmLmlzRnVuY3Rpb24oYikpcmV0dXJuIGYuZ3JlcChhLGZ1bmN0aW9uKGEsZCl7dmFyIGU9ISFiLmNhbGwoYSxkLGEpO3JldHVybiBlPT09Y30pO2lmKGIubm9kZVR5cGUpcmV0dXJuIGYuZ3JlcChhLGZ1bmN0aW9uKGEsZCl7cmV0dXJuIGE9PT1iPT09Y30pO2lmKHR5cGVvZiBiPT1cInN0cmluZ1wiKXt2YXIgZD1mLmdyZXAoYSxmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlVHlwZT09PTF9KTtpZihPLnRlc3QoYikpcmV0dXJuIGYuZmlsdGVyKGIsZCwhYyk7Yj1mLmZpbHRlcihiLGQpfXJldHVybiBmLmdyZXAoYSxmdW5jdGlvbihhLGQpe3JldHVybiBmLmluQXJyYXkoYSxiKT49MD09PWN9KX1mdW5jdGlvbiBTKGEpe3JldHVybiFhfHwhYS5wYXJlbnROb2RlfHxhLnBhcmVudE5vZGUubm9kZVR5cGU9PT0xMX1mdW5jdGlvbiBLKCl7cmV0dXJuITB9ZnVuY3Rpb24gSigpe3JldHVybiExfWZ1bmN0aW9uIG4oYSxiLGMpe3ZhciBkPWIrXCJkZWZlclwiLGU9YitcInF1ZXVlXCIsZz1iK1wibWFya1wiLGg9Zi5fZGF0YShhLGQpO2gmJihjPT09XCJxdWV1ZVwifHwhZi5fZGF0YShhLGUpKSYmKGM9PT1cIm1hcmtcInx8IWYuX2RhdGEoYSxnKSkmJnNldFRpbWVvdXQoZnVuY3Rpb24oKXshZi5fZGF0YShhLGUpJiYhZi5fZGF0YShhLGcpJiYoZi5yZW1vdmVEYXRhKGEsZCwhMCksaC5maXJlKCkpfSwwKX1mdW5jdGlvbiBtKGEpe2Zvcih2YXIgYiBpbiBhKXtpZihiPT09XCJkYXRhXCImJmYuaXNFbXB0eU9iamVjdChhW2JdKSljb250aW51ZTtpZihiIT09XCJ0b0pTT05cIilyZXR1cm4hMX1yZXR1cm4hMH1mdW5jdGlvbiBsKGEsYyxkKXtpZihkPT09YiYmYS5ub2RlVHlwZT09PTEpe3ZhciBlPVwiZGF0YS1cIitjLnJlcGxhY2UoayxcIi0kMVwiKS50b0xvd2VyQ2FzZSgpO2Q9YS5nZXRBdHRyaWJ1dGUoZSk7aWYodHlwZW9mIGQ9PVwic3RyaW5nXCIpe3RyeXtkPWQ9PT1cInRydWVcIj8hMDpkPT09XCJmYWxzZVwiPyExOmQ9PT1cIm51bGxcIj9udWxsOmYuaXNOdW1lcmljKGQpP3BhcnNlRmxvYXQoZCk6ai50ZXN0KGQpP2YucGFyc2VKU09OKGQpOmR9Y2F0Y2goZyl7fWYuZGF0YShhLGMsZCl9ZWxzZSBkPWJ9cmV0dXJuIGR9ZnVuY3Rpb24gaChhKXt2YXIgYj1nW2FdPXt9LGMsZDthPWEuc3BsaXQoL1xccysvKTtmb3IoYz0wLGQ9YS5sZW5ndGg7YzxkO2MrKyliW2FbY11dPSEwO3JldHVybiBifXZhciBjPWEuZG9jdW1lbnQsZD1hLm5hdmlnYXRvcixlPWEubG9jYXRpb24sZj1mdW5jdGlvbigpe2Z1bmN0aW9uIEooKXtpZighZS5pc1JlYWR5KXt0cnl7Yy5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwoXCJsZWZ0XCIpfWNhdGNoKGEpe3NldFRpbWVvdXQoSiwxKTtyZXR1cm59ZS5yZWFkeSgpfX12YXIgZT1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgZS5mbi5pbml0KGEsYixoKX0sZj1hLmpRdWVyeSxnPWEuJCxoLGk9L14oPzpbXiM8XSooPFtcXHdcXFddKz4pW14+XSokfCMoW1xcd1xcLV0qKSQpLyxqPS9cXFMvLGs9L15cXHMrLyxsPS9cXHMrJC8sbT0vXjwoXFx3KylcXHMqXFwvPz4oPzo8XFwvXFwxPik/JC8sbj0vXltcXF0sOnt9XFxzXSokLyxvPS9cXFxcKD86W1wiXFxcXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2cscD0vXCJbXlwiXFxcXFxcblxccl0qXCJ8dHJ1ZXxmYWxzZXxudWxsfC0/XFxkKyg/OlxcLlxcZCopPyg/OltlRV1bK1xcLV0/XFxkKyk/L2cscT0vKD86Xnw6fCwpKD86XFxzKlxcWykrL2cscj0vKHdlYmtpdClbIFxcL10oW1xcdy5dKykvLHM9LyhvcGVyYSkoPzouKnZlcnNpb24pP1sgXFwvXShbXFx3Ll0rKS8sdD0vKG1zaWUpIChbXFx3Ll0rKS8sdT0vKG1vemlsbGEpKD86Lio/IHJ2OihbXFx3Ll0rKSk/Lyx2PS8tKFthLXpdfFswLTldKS9pZyx3PS9eLW1zLS8seD1mdW5jdGlvbihhLGIpe3JldHVybihiK1wiXCIpLnRvVXBwZXJDYXNlKCl9LHk9ZC51c2VyQWdlbnQseixBLEIsQz1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLEQ9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxFPUFycmF5LnByb3RvdHlwZS5wdXNoLEY9QXJyYXkucHJvdG90eXBlLnNsaWNlLEc9U3RyaW5nLnByb3RvdHlwZS50cmltLEg9QXJyYXkucHJvdG90eXBlLmluZGV4T2YsST17fTtlLmZuPWUucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjplLGluaXQ6ZnVuY3Rpb24oYSxkLGYpe3ZhciBnLGgsaixrO2lmKCFhKXJldHVybiB0aGlzO2lmKGEubm9kZVR5cGUpe3RoaXMuY29udGV4dD10aGlzWzBdPWEsdGhpcy5sZW5ndGg9MTtyZXR1cm4gdGhpc31pZihhPT09XCJib2R5XCImJiFkJiZjLmJvZHkpe3RoaXMuY29udGV4dD1jLHRoaXNbMF09Yy5ib2R5LHRoaXMuc2VsZWN0b3I9YSx0aGlzLmxlbmd0aD0xO3JldHVybiB0aGlzfWlmKHR5cGVvZiBhPT1cInN0cmluZ1wiKXthLmNoYXJBdCgwKSE9PVwiPFwifHxhLmNoYXJBdChhLmxlbmd0aC0xKSE9PVwiPlwifHxhLmxlbmd0aDwzP2c9aS5leGVjKGEpOmc9W251bGwsYSxudWxsXTtpZihnJiYoZ1sxXXx8IWQpKXtpZihnWzFdKXtkPWQgaW5zdGFuY2VvZiBlP2RbMF06ZCxrPWQ/ZC5vd25lckRvY3VtZW50fHxkOmMsaj1tLmV4ZWMoYSksaj9lLmlzUGxhaW5PYmplY3QoZCk/KGE9W2MuY3JlYXRlRWxlbWVudChqWzFdKV0sZS5mbi5hdHRyLmNhbGwoYSxkLCEwKSk6YT1bay5jcmVhdGVFbGVtZW50KGpbMV0pXTooaj1lLmJ1aWxkRnJhZ21lbnQoW2dbMV1dLFtrXSksYT0oai5jYWNoZWFibGU/ZS5jbG9uZShqLmZyYWdtZW50KTpqLmZyYWdtZW50KS5jaGlsZE5vZGVzKTtyZXR1cm4gZS5tZXJnZSh0aGlzLGEpfWg9Yy5nZXRFbGVtZW50QnlJZChnWzJdKTtpZihoJiZoLnBhcmVudE5vZGUpe2lmKGguaWQhPT1nWzJdKXJldHVybiBmLmZpbmQoYSk7dGhpcy5sZW5ndGg9MSx0aGlzWzBdPWh9dGhpcy5jb250ZXh0PWMsdGhpcy5zZWxlY3Rvcj1hO3JldHVybiB0aGlzfXJldHVybiFkfHxkLmpxdWVyeT8oZHx8ZikuZmluZChhKTp0aGlzLmNvbnN0cnVjdG9yKGQpLmZpbmQoYSl9aWYoZS5pc0Z1bmN0aW9uKGEpKXJldHVybiBmLnJlYWR5KGEpO2Euc2VsZWN0b3IhPT1iJiYodGhpcy5zZWxlY3Rvcj1hLnNlbGVjdG9yLHRoaXMuY29udGV4dD1hLmNvbnRleHQpO3JldHVybiBlLm1ha2VBcnJheShhLHRoaXMpfSxzZWxlY3RvcjpcIlwiLGpxdWVyeTpcIjEuNy4xXCIsbGVuZ3RoOjAsc2l6ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxlbmd0aH0sdG9BcnJheTpmdW5jdGlvbigpe3JldHVybiBGLmNhbGwodGhpcywwKX0sZ2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsP3RoaXMudG9BcnJheSgpOmE8MD90aGlzW3RoaXMubGVuZ3RoK2FdOnRoaXNbYV19LHB1c2hTdGFjazpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5jb25zdHJ1Y3RvcigpO2UuaXNBcnJheShhKT9FLmFwcGx5KGQsYSk6ZS5tZXJnZShkLGEpLGQucHJldk9iamVjdD10aGlzLGQuY29udGV4dD10aGlzLmNvbnRleHQsYj09PVwiZmluZFwiP2Quc2VsZWN0b3I9dGhpcy5zZWxlY3RvcisodGhpcy5zZWxlY3Rvcj9cIiBcIjpcIlwiKStjOmImJihkLnNlbGVjdG9yPXRoaXMuc2VsZWN0b3IrXCIuXCIrYitcIihcIitjK1wiKVwiKTtyZXR1cm4gZH0sZWFjaDpmdW5jdGlvbihhLGIpe3JldHVybiBlLmVhY2godGhpcyxhLGIpfSxyZWFkeTpmdW5jdGlvbihhKXtlLmJpbmRSZWFkeSgpLEEuYWRkKGEpO3JldHVybiB0aGlzfSxlcTpmdW5jdGlvbihhKXthPSthO3JldHVybiBhPT09LTE/dGhpcy5zbGljZShhKTp0aGlzLnNsaWNlKGEsYSsxKX0sZmlyc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lcSgwKX0sbGFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKC0xKX0sc2xpY2U6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2soRi5hcHBseSh0aGlzLGFyZ3VtZW50cyksXCJzbGljZVwiLEYuY2FsbChhcmd1bWVudHMpLmpvaW4oXCIsXCIpKX0sbWFwOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayhlLm1hcCh0aGlzLGZ1bmN0aW9uKGIsYyl7cmV0dXJuIGEuY2FsbChiLGMsYil9KSl9LGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnByZXZPYmplY3R8fHRoaXMuY29uc3RydWN0b3IobnVsbCl9LHB1c2g6RSxzb3J0OltdLnNvcnQsc3BsaWNlOltdLnNwbGljZX0sZS5mbi5pbml0LnByb3RvdHlwZT1lLmZuLGUuZXh0ZW5kPWUuZm4uZXh0ZW5kPWZ1bmN0aW9uKCl7dmFyIGEsYyxkLGYsZyxoLGk9YXJndW1lbnRzWzBdfHx7fSxqPTEsaz1hcmd1bWVudHMubGVuZ3RoLGw9ITE7dHlwZW9mIGk9PVwiYm9vbGVhblwiJiYobD1pLGk9YXJndW1lbnRzWzFdfHx7fSxqPTIpLHR5cGVvZiBpIT1cIm9iamVjdFwiJiYhZS5pc0Z1bmN0aW9uKGkpJiYoaT17fSksaz09PWomJihpPXRoaXMsLS1qKTtmb3IoO2o8aztqKyspaWYoKGE9YXJndW1lbnRzW2pdKSE9bnVsbClmb3IoYyBpbiBhKXtkPWlbY10sZj1hW2NdO2lmKGk9PT1mKWNvbnRpbnVlO2wmJmYmJihlLmlzUGxhaW5PYmplY3QoZil8fChnPWUuaXNBcnJheShmKSkpPyhnPyhnPSExLGg9ZCYmZS5pc0FycmF5KGQpP2Q6W10pOmg9ZCYmZS5pc1BsYWluT2JqZWN0KGQpP2Q6e30saVtjXT1lLmV4dGVuZChsLGgsZikpOmYhPT1iJiYoaVtjXT1mKX1yZXR1cm4gaX0sZS5leHRlbmQoe25vQ29uZmxpY3Q6ZnVuY3Rpb24oYil7YS4kPT09ZSYmKGEuJD1nKSxiJiZhLmpRdWVyeT09PWUmJihhLmpRdWVyeT1mKTtyZXR1cm4gZX0saXNSZWFkeTohMSxyZWFkeVdhaXQ6MSxob2xkUmVhZHk6ZnVuY3Rpb24oYSl7YT9lLnJlYWR5V2FpdCsrOmUucmVhZHkoITApfSxyZWFkeTpmdW5jdGlvbihhKXtpZihhPT09ITAmJiEtLWUucmVhZHlXYWl0fHxhIT09ITAmJiFlLmlzUmVhZHkpe2lmKCFjLmJvZHkpcmV0dXJuIHNldFRpbWVvdXQoZS5yZWFkeSwxKTtlLmlzUmVhZHk9ITA7aWYoYSE9PSEwJiYtLWUucmVhZHlXYWl0PjApcmV0dXJuO0EuZmlyZVdpdGgoYyxbZV0pLGUuZm4udHJpZ2dlciYmZShjKS50cmlnZ2VyKFwicmVhZHlcIikub2ZmKFwicmVhZHlcIil9fSxiaW5kUmVhZHk6ZnVuY3Rpb24oKXtpZighQSl7QT1lLkNhbGxiYWNrcyhcIm9uY2UgbWVtb3J5XCIpO2lmKGMucmVhZHlTdGF0ZT09PVwiY29tcGxldGVcIilyZXR1cm4gc2V0VGltZW91dChlLnJlYWR5LDEpO2lmKGMuYWRkRXZlbnRMaXN0ZW5lciljLmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsQiwhMSksYS5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLGUucmVhZHksITEpO2Vsc2UgaWYoYy5hdHRhY2hFdmVudCl7Yy5hdHRhY2hFdmVudChcIm9ucmVhZHlzdGF0ZWNoYW5nZVwiLEIpLGEuYXR0YWNoRXZlbnQoXCJvbmxvYWRcIixlLnJlYWR5KTt2YXIgYj0hMTt0cnl7Yj1hLmZyYW1lRWxlbWVudD09bnVsbH1jYXRjaChkKXt9Yy5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwmJmImJkooKX19fSxpc0Z1bmN0aW9uOmZ1bmN0aW9uKGEpe3JldHVybiBlLnR5cGUoYSk9PT1cImZ1bmN0aW9uXCJ9LGlzQXJyYXk6QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oYSl7cmV0dXJuIGUudHlwZShhKT09PVwiYXJyYXlcIn0saXNXaW5kb3c6ZnVuY3Rpb24oYSl7cmV0dXJuIGEmJnR5cGVvZiBhPT1cIm9iamVjdFwiJiZcInNldEludGVydmFsXCJpbiBhfSxpc051bWVyaWM6ZnVuY3Rpb24oYSl7cmV0dXJuIWlzTmFOKHBhcnNlRmxvYXQoYSkpJiZpc0Zpbml0ZShhKX0sdHlwZTpmdW5jdGlvbihhKXtyZXR1cm4gYT09bnVsbD9TdHJpbmcoYSk6SVtDLmNhbGwoYSldfHxcIm9iamVjdFwifSxpc1BsYWluT2JqZWN0OmZ1bmN0aW9uKGEpe2lmKCFhfHxlLnR5cGUoYSkhPT1cIm9iamVjdFwifHxhLm5vZGVUeXBlfHxlLmlzV2luZG93KGEpKXJldHVybiExO3RyeXtpZihhLmNvbnN0cnVjdG9yJiYhRC5jYWxsKGEsXCJjb25zdHJ1Y3RvclwiKSYmIUQuY2FsbChhLmNvbnN0cnVjdG9yLnByb3RvdHlwZSxcImlzUHJvdG90eXBlT2ZcIikpcmV0dXJuITF9Y2F0Y2goYyl7cmV0dXJuITF9dmFyIGQ7Zm9yKGQgaW4gYSk7cmV0dXJuIGQ9PT1ifHxELmNhbGwoYSxkKX0saXNFbXB0eU9iamVjdDpmdW5jdGlvbihhKXtmb3IodmFyIGIgaW4gYSlyZXR1cm4hMTtyZXR1cm4hMH0sZXJyb3I6ZnVuY3Rpb24oYSl7dGhyb3cgbmV3IEVycm9yKGEpfSxwYXJzZUpTT046ZnVuY3Rpb24oYil7aWYodHlwZW9mIGIhPVwic3RyaW5nXCJ8fCFiKXJldHVybiBudWxsO2I9ZS50cmltKGIpO2lmKGEuSlNPTiYmYS5KU09OLnBhcnNlKXJldHVybiBhLkpTT04ucGFyc2UoYik7aWYobi50ZXN0KGIucmVwbGFjZShvLFwiQFwiKS5yZXBsYWNlKHAsXCJdXCIpLnJlcGxhY2UocSxcIlwiKSkpcmV0dXJuKG5ldyBGdW5jdGlvbihcInJldHVybiBcIitiKSkoKTtlLmVycm9yKFwiSW52YWxpZCBKU09OOiBcIitiKX0scGFyc2VYTUw6ZnVuY3Rpb24oYyl7dmFyIGQsZjt0cnl7YS5ET01QYXJzZXI/KGY9bmV3IERPTVBhcnNlcixkPWYucGFyc2VGcm9tU3RyaW5nKGMsXCJ0ZXh0L3htbFwiKSk6KGQ9bmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MRE9NXCIpLGQuYXN5bmM9XCJmYWxzZVwiLGQubG9hZFhNTChjKSl9Y2F0Y2goZyl7ZD1ifSghZHx8IWQuZG9jdW1lbnRFbGVtZW50fHxkLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwicGFyc2VyZXJyb3JcIikubGVuZ3RoKSYmZS5lcnJvcihcIkludmFsaWQgWE1MOiBcIitjKTtyZXR1cm4gZH0sbm9vcDpmdW5jdGlvbigpe30sZ2xvYmFsRXZhbDpmdW5jdGlvbihiKXtiJiZqLnRlc3QoYikmJihhLmV4ZWNTY3JpcHR8fGZ1bmN0aW9uKGIpe2EuZXZhbC5jYWxsKGEsYil9KShiKX0sY2FtZWxDYXNlOmZ1bmN0aW9uKGEpe3JldHVybiBhLnJlcGxhY2UodyxcIm1zLVwiKS5yZXBsYWNlKHYseCl9LG5vZGVOYW1lOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEubm9kZU5hbWUmJmEubm9kZU5hbWUudG9VcHBlckNhc2UoKT09PWIudG9VcHBlckNhc2UoKX0sZWFjaDpmdW5jdGlvbihhLGMsZCl7dmFyIGYsZz0wLGg9YS5sZW5ndGgsaT1oPT09Ynx8ZS5pc0Z1bmN0aW9uKGEpO2lmKGQpe2lmKGkpe2ZvcihmIGluIGEpaWYoYy5hcHBseShhW2ZdLGQpPT09ITEpYnJlYWt9ZWxzZSBmb3IoO2c8aDspaWYoYy5hcHBseShhW2crK10sZCk9PT0hMSlicmVha31lbHNlIGlmKGkpe2ZvcihmIGluIGEpaWYoYy5jYWxsKGFbZl0sZixhW2ZdKT09PSExKWJyZWFrfWVsc2UgZm9yKDtnPGg7KWlmKGMuY2FsbChhW2ddLGcsYVtnKytdKT09PSExKWJyZWFrO3JldHVybiBhfSx0cmltOkc/ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/XCJcIjpHLmNhbGwoYSl9OmZ1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsP1wiXCI6KGErXCJcIikucmVwbGFjZShrLFwiXCIpLnJlcGxhY2UobCxcIlwiKX0sbWFrZUFycmF5OmZ1bmN0aW9uKGEsYil7dmFyIGM9Ynx8W107aWYoYSE9bnVsbCl7dmFyIGQ9ZS50eXBlKGEpO2EubGVuZ3RoPT1udWxsfHxkPT09XCJzdHJpbmdcInx8ZD09PVwiZnVuY3Rpb25cInx8ZD09PVwicmVnZXhwXCJ8fGUuaXNXaW5kb3coYSk/RS5jYWxsKGMsYSk6ZS5tZXJnZShjLGEpfXJldHVybiBjfSxpbkFycmF5OmZ1bmN0aW9uKGEsYixjKXt2YXIgZDtpZihiKXtpZihIKXJldHVybiBILmNhbGwoYixhLGMpO2Q9Yi5sZW5ndGgsYz1jP2M8MD9NYXRoLm1heCgwLGQrYyk6YzowO2Zvcig7YzxkO2MrKylpZihjIGluIGImJmJbY109PT1hKXJldHVybiBjfXJldHVybi0xfSxtZXJnZTpmdW5jdGlvbihhLGMpe3ZhciBkPWEubGVuZ3RoLGU9MDtpZih0eXBlb2YgYy5sZW5ndGg9PVwibnVtYmVyXCIpZm9yKHZhciBmPWMubGVuZ3RoO2U8ZjtlKyspYVtkKytdPWNbZV07ZWxzZSB3aGlsZShjW2VdIT09YilhW2QrK109Y1tlKytdO2EubGVuZ3RoPWQ7cmV0dXJuIGF9LGdyZXA6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPVtdLGU7Yz0hIWM7Zm9yKHZhciBmPTAsZz1hLmxlbmd0aDtmPGc7ZisrKWU9ISFiKGFbZl0sZiksYyE9PWUmJmQucHVzaChhW2ZdKTtyZXR1cm4gZH0sbWFwOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZixnLGg9W10saT0wLGo9YS5sZW5ndGgsaz1hIGluc3RhbmNlb2YgZXx8aiE9PWImJnR5cGVvZiBqPT1cIm51bWJlclwiJiYoaj4wJiZhWzBdJiZhW2otMV18fGo9PT0wfHxlLmlzQXJyYXkoYSkpO2lmKGspZm9yKDtpPGo7aSsrKWY9YyhhW2ldLGksZCksZiE9bnVsbCYmKGhbaC5sZW5ndGhdPWYpO2Vsc2UgZm9yKGcgaW4gYSlmPWMoYVtnXSxnLGQpLGYhPW51bGwmJihoW2gubGVuZ3RoXT1mKTtyZXR1cm4gaC5jb25jYXQuYXBwbHkoW10saCl9LGd1aWQ6MSxwcm94eTpmdW5jdGlvbihhLGMpe2lmKHR5cGVvZiBjPT1cInN0cmluZ1wiKXt2YXIgZD1hW2NdO2M9YSxhPWR9aWYoIWUuaXNGdW5jdGlvbihhKSlyZXR1cm4gYjt2YXIgZj1GLmNhbGwoYXJndW1lbnRzLDIpLGc9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShjLGYuY29uY2F0KEYuY2FsbChhcmd1bWVudHMpKSl9O2cuZ3VpZD1hLmd1aWQ9YS5ndWlkfHxnLmd1aWR8fGUuZ3VpZCsrO3JldHVybiBnfSxhY2Nlc3M6ZnVuY3Rpb24oYSxjLGQsZixnLGgpe3ZhciBpPWEubGVuZ3RoO2lmKHR5cGVvZiBjPT1cIm9iamVjdFwiKXtmb3IodmFyIGogaW4gYyllLmFjY2VzcyhhLGosY1tqXSxmLGcsZCk7cmV0dXJuIGF9aWYoZCE9PWIpe2Y9IWgmJmYmJmUuaXNGdW5jdGlvbihkKTtmb3IodmFyIGs9MDtrPGk7aysrKWcoYVtrXSxjLGY/ZC5jYWxsKGFba10sayxnKGFba10sYykpOmQsaCk7cmV0dXJuIGF9cmV0dXJuIGk/ZyhhWzBdLGMpOmJ9LG5vdzpmdW5jdGlvbigpe3JldHVybihuZXcgRGF0ZSkuZ2V0VGltZSgpfSx1YU1hdGNoOmZ1bmN0aW9uKGEpe2E9YS50b0xvd2VyQ2FzZSgpO3ZhciBiPXIuZXhlYyhhKXx8cy5leGVjKGEpfHx0LmV4ZWMoYSl8fGEuaW5kZXhPZihcImNvbXBhdGlibGVcIik8MCYmdS5leGVjKGEpfHxbXTtyZXR1cm57YnJvd3NlcjpiWzFdfHxcIlwiLHZlcnNpb246YlsyXXx8XCIwXCJ9fSxzdWI6ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGIsYyl7cmV0dXJuIG5ldyBhLmZuLmluaXQoYixjKX1lLmV4dGVuZCghMCxhLHRoaXMpLGEuc3VwZXJjbGFzcz10aGlzLGEuZm49YS5wcm90b3R5cGU9dGhpcygpLGEuZm4uY29uc3RydWN0b3I9YSxhLnN1Yj10aGlzLnN1YixhLmZuLmluaXQ9ZnVuY3Rpb24oZCxmKXtmJiZmIGluc3RhbmNlb2YgZSYmIShmIGluc3RhbmNlb2YgYSkmJihmPWEoZikpO3JldHVybiBlLmZuLmluaXQuY2FsbCh0aGlzLGQsZixiKX0sYS5mbi5pbml0LnByb3RvdHlwZT1hLmZuO3ZhciBiPWEoYyk7cmV0dXJuIGF9LGJyb3dzZXI6e319KSxlLmVhY2goXCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0XCIuc3BsaXQoXCIgXCIpLGZ1bmN0aW9uKGEsYil7SVtcIltvYmplY3QgXCIrYitcIl1cIl09Yi50b0xvd2VyQ2FzZSgpfSksej1lLnVhTWF0Y2goeSksei5icm93c2VyJiYoZS5icm93c2VyW3ouYnJvd3Nlcl09ITAsZS5icm93c2VyLnZlcnNpb249ei52ZXJzaW9uKSxlLmJyb3dzZXIud2Via2l0JiYoZS5icm93c2VyLnNhZmFyaT0hMCksai50ZXN0KFwiwqBcIikmJihrPS9eW1xcc1xceEEwXSsvLGw9L1tcXHNcXHhBMF0rJC8pLGg9ZShjKSxjLmFkZEV2ZW50TGlzdGVuZXI/Qj1mdW5jdGlvbigpe2MucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIixCLCExKSxlLnJlYWR5KCl9OmMuYXR0YWNoRXZlbnQmJihCPWZ1bmN0aW9uKCl7Yy5yZWFkeVN0YXRlPT09XCJjb21wbGV0ZVwiJiYoYy5kZXRhY2hFdmVudChcIm9ucmVhZHlzdGF0ZWNoYW5nZVwiLEIpLGUucmVhZHkoKSl9KTtyZXR1cm4gZX0oKSxnPXt9O2YuQ2FsbGJhY2tzPWZ1bmN0aW9uKGEpe2E9YT9nW2FdfHxoKGEpOnt9O3ZhciBjPVtdLGQ9W10sZSxpLGosayxsLG09ZnVuY3Rpb24oYil7dmFyIGQsZSxnLGgsaTtmb3IoZD0wLGU9Yi5sZW5ndGg7ZDxlO2QrKylnPWJbZF0saD1mLnR5cGUoZyksaD09PVwiYXJyYXlcIj9tKGcpOmg9PT1cImZ1bmN0aW9uXCImJighYS51bmlxdWV8fCFvLmhhcyhnKSkmJmMucHVzaChnKX0sbj1mdW5jdGlvbihiLGYpe2Y9Znx8W10sZT0hYS5tZW1vcnl8fFtiLGZdLGk9ITAsbD1qfHwwLGo9MCxrPWMubGVuZ3RoO2Zvcig7YyYmbDxrO2wrKylpZihjW2xdLmFwcGx5KGIsZik9PT0hMSYmYS5zdG9wT25GYWxzZSl7ZT0hMDticmVha31pPSExLGMmJihhLm9uY2U/ZT09PSEwP28uZGlzYWJsZSgpOmM9W106ZCYmZC5sZW5ndGgmJihlPWQuc2hpZnQoKSxvLmZpcmVXaXRoKGVbMF0sZVsxXSkpKX0sbz17YWRkOmZ1bmN0aW9uKCl7aWYoYyl7dmFyIGE9Yy5sZW5ndGg7bShhcmd1bWVudHMpLGk/az1jLmxlbmd0aDplJiZlIT09ITAmJihqPWEsbihlWzBdLGVbMV0pKX1yZXR1cm4gdGhpc30scmVtb3ZlOmZ1bmN0aW9uKCl7aWYoYyl7dmFyIGI9YXJndW1lbnRzLGQ9MCxlPWIubGVuZ3RoO2Zvcig7ZDxlO2QrKylmb3IodmFyIGY9MDtmPGMubGVuZ3RoO2YrKylpZihiW2RdPT09Y1tmXSl7aSYmZjw9ayYmKGstLSxmPD1sJiZsLS0pLGMuc3BsaWNlKGYtLSwxKTtpZihhLnVuaXF1ZSlicmVha319cmV0dXJuIHRoaXN9LGhhczpmdW5jdGlvbihhKXtpZihjKXt2YXIgYj0wLGQ9Yy5sZW5ndGg7Zm9yKDtiPGQ7YisrKWlmKGE9PT1jW2JdKXJldHVybiEwfXJldHVybiExfSxlbXB0eTpmdW5jdGlvbigpe2M9W107cmV0dXJuIHRoaXN9LGRpc2FibGU6ZnVuY3Rpb24oKXtjPWQ9ZT1iO3JldHVybiB0aGlzfSxkaXNhYmxlZDpmdW5jdGlvbigpe3JldHVybiFjfSxsb2NrOmZ1bmN0aW9uKCl7ZD1iLCghZXx8ZT09PSEwKSYmby5kaXNhYmxlKCk7cmV0dXJuIHRoaXN9LGxvY2tlZDpmdW5jdGlvbigpe3JldHVybiFkfSxmaXJlV2l0aDpmdW5jdGlvbihiLGMpe2QmJihpP2Eub25jZXx8ZC5wdXNoKFtiLGNdKTooIWEub25jZXx8IWUpJiZuKGIsYykpO3JldHVybiB0aGlzfSxmaXJlOmZ1bmN0aW9uKCl7by5maXJlV2l0aCh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIHRoaXN9LGZpcmVkOmZ1bmN0aW9uKCl7cmV0dXJuISFlfX07cmV0dXJuIG99O3ZhciBpPVtdLnNsaWNlO2YuZXh0ZW5kKHtEZWZlcnJlZDpmdW5jdGlvbihhKXt2YXIgYj1mLkNhbGxiYWNrcyhcIm9uY2UgbWVtb3J5XCIpLGM9Zi5DYWxsYmFja3MoXCJvbmNlIG1lbW9yeVwiKSxkPWYuQ2FsbGJhY2tzKFwibWVtb3J5XCIpLGU9XCJwZW5kaW5nXCIsZz17cmVzb2x2ZTpiLHJlamVjdDpjLG5vdGlmeTpkfSxoPXtkb25lOmIuYWRkLGZhaWw6Yy5hZGQscHJvZ3Jlc3M6ZC5hZGQsc3RhdGU6ZnVuY3Rpb24oKXtyZXR1cm4gZX0saXNSZXNvbHZlZDpiLmZpcmVkLGlzUmVqZWN0ZWQ6Yy5maXJlZCx0aGVuOmZ1bmN0aW9uKGEsYixjKXtpLmRvbmUoYSkuZmFpbChiKS5wcm9ncmVzcyhjKTtyZXR1cm4gdGhpc30sYWx3YXlzOmZ1bmN0aW9uKCl7aS5kb25lLmFwcGx5KGksYXJndW1lbnRzKS5mYWlsLmFwcGx5KGksYXJndW1lbnRzKTtyZXR1cm4gdGhpc30scGlwZTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuRGVmZXJyZWQoZnVuY3Rpb24oZCl7Zi5lYWNoKHtkb25lOlthLFwicmVzb2x2ZVwiXSxmYWlsOltiLFwicmVqZWN0XCJdLHByb2dyZXNzOltjLFwibm90aWZ5XCJdfSxmdW5jdGlvbihhLGIpe3ZhciBjPWJbMF0sZT1iWzFdLGc7Zi5pc0Z1bmN0aW9uKGMpP2lbYV0oZnVuY3Rpb24oKXtnPWMuYXBwbHkodGhpcyxhcmd1bWVudHMpLGcmJmYuaXNGdW5jdGlvbihnLnByb21pc2UpP2cucHJvbWlzZSgpLnRoZW4oZC5yZXNvbHZlLGQucmVqZWN0LGQubm90aWZ5KTpkW2UrXCJXaXRoXCJdKHRoaXM9PT1pP2Q6dGhpcyxbZ10pfSk6aVthXShkW2VdKX0pfSkucHJvbWlzZSgpfSxwcm9taXNlOmZ1bmN0aW9uKGEpe2lmKGE9PW51bGwpYT1oO2Vsc2UgZm9yKHZhciBiIGluIGgpYVtiXT1oW2JdO3JldHVybiBhfX0saT1oLnByb21pc2Uoe30pLGo7Zm9yKGogaW4gZylpW2pdPWdbal0uZmlyZSxpW2orXCJXaXRoXCJdPWdbal0uZmlyZVdpdGg7aS5kb25lKGZ1bmN0aW9uKCl7ZT1cInJlc29sdmVkXCJ9LGMuZGlzYWJsZSxkLmxvY2spLmZhaWwoZnVuY3Rpb24oKXtlPVwicmVqZWN0ZWRcIn0sYi5kaXNhYmxlLGQubG9jayksYSYmYS5jYWxsKGksaSk7cmV0dXJuIGl9LHdoZW46ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gbShhKXtyZXR1cm4gZnVuY3Rpb24oYil7ZVthXT1hcmd1bWVudHMubGVuZ3RoPjE/aS5jYWxsKGFyZ3VtZW50cywwKTpiLGoubm90aWZ5V2l0aChrLGUpfX1mdW5jdGlvbiBsKGEpe3JldHVybiBmdW5jdGlvbihjKXtiW2FdPWFyZ3VtZW50cy5sZW5ndGg+MT9pLmNhbGwoYXJndW1lbnRzLDApOmMsLS1nfHxqLnJlc29sdmVXaXRoKGosYil9fXZhciBiPWkuY2FsbChhcmd1bWVudHMsMCksYz0wLGQ9Yi5sZW5ndGgsZT1BcnJheShkKSxnPWQsaD1kLGo9ZDw9MSYmYSYmZi5pc0Z1bmN0aW9uKGEucHJvbWlzZSk/YTpmLkRlZmVycmVkKCksaz1qLnByb21pc2UoKTtpZihkPjEpe2Zvcig7YzxkO2MrKyliW2NdJiZiW2NdLnByb21pc2UmJmYuaXNGdW5jdGlvbihiW2NdLnByb21pc2UpP2JbY10ucHJvbWlzZSgpLnRoZW4obChjKSxqLnJlamVjdCxtKGMpKTotLWc7Z3x8ai5yZXNvbHZlV2l0aChqLGIpfWVsc2UgaiE9PWEmJmoucmVzb2x2ZVdpdGgoaixkP1thXTpbXSk7cmV0dXJuIGt9fSksZi5zdXBwb3J0PWZ1bmN0aW9uKCl7dmFyIGIsZCxlLGcsaCxpLGosayxsLG0sbixvLHAscT1jLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIikscj1jLmRvY3VtZW50RWxlbWVudDtxLnNldEF0dHJpYnV0ZShcImNsYXNzTmFtZVwiLFwidFwiKSxxLmlubmVySFRNTD1cIiAgIDxsaW5rLz48dGFibGU+PC90YWJsZT48YSBocmVmPScvYScgc3R5bGU9J3RvcDoxcHg7ZmxvYXQ6bGVmdDtvcGFjaXR5Oi41NTsnPmE8L2E+PGlucHV0IHR5cGU9J2NoZWNrYm94Jy8+XCIsZD1xLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKSxlPXEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJhXCIpWzBdO2lmKCFkfHwhZC5sZW5ndGh8fCFlKXJldHVybnt9O2c9Yy5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpLGg9Zy5hcHBlbmRDaGlsZChjLmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIikpLGk9cS5nZXRFbGVtZW50c0J5VGFnTmFtZShcImlucHV0XCIpWzBdLGI9e2xlYWRpbmdXaGl0ZXNwYWNlOnEuZmlyc3RDaGlsZC5ub2RlVHlwZT09PTMsdGJvZHk6IXEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0Ym9keVwiKS5sZW5ndGgsaHRtbFNlcmlhbGl6ZTohIXEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJsaW5rXCIpLmxlbmd0aCxzdHlsZTovdG9wLy50ZXN0KGUuZ2V0QXR0cmlidXRlKFwic3R5bGVcIikpLGhyZWZOb3JtYWxpemVkOmUuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKT09PVwiL2FcIixvcGFjaXR5Oi9eMC41NS8udGVzdChlLnN0eWxlLm9wYWNpdHkpLGNzc0Zsb2F0OiEhZS5zdHlsZS5jc3NGbG9hdCxjaGVja09uOmkudmFsdWU9PT1cIm9uXCIsb3B0U2VsZWN0ZWQ6aC5zZWxlY3RlZCxnZXRTZXRBdHRyaWJ1dGU6cS5jbGFzc05hbWUhPT1cInRcIixlbmN0eXBlOiEhYy5jcmVhdGVFbGVtZW50KFwiZm9ybVwiKS5lbmN0eXBlLGh0bWw1Q2xvbmU6Yy5jcmVhdGVFbGVtZW50KFwibmF2XCIpLmNsb25lTm9kZSghMCkub3V0ZXJIVE1MIT09XCI8Om5hdj48LzpuYXY+XCIsc3VibWl0QnViYmxlczohMCxjaGFuZ2VCdWJibGVzOiEwLGZvY3VzaW5CdWJibGVzOiExLGRlbGV0ZUV4cGFuZG86ITAsbm9DbG9uZUV2ZW50OiEwLGlubGluZUJsb2NrTmVlZHNMYXlvdXQ6ITEsc2hyaW5rV3JhcEJsb2NrczohMSxyZWxpYWJsZU1hcmdpblJpZ2h0OiEwfSxpLmNoZWNrZWQ9ITAsYi5ub0Nsb25lQ2hlY2tlZD1pLmNsb25lTm9kZSghMCkuY2hlY2tlZCxnLmRpc2FibGVkPSEwLGIub3B0RGlzYWJsZWQ9IWguZGlzYWJsZWQ7dHJ5e2RlbGV0ZSBxLnRlc3R9Y2F0Y2gocyl7Yi5kZWxldGVFeHBhbmRvPSExfSFxLmFkZEV2ZW50TGlzdGVuZXImJnEuYXR0YWNoRXZlbnQmJnEuZmlyZUV2ZW50JiYocS5hdHRhY2hFdmVudChcIm9uY2xpY2tcIixmdW5jdGlvbigpe2Iubm9DbG9uZUV2ZW50PSExfSkscS5jbG9uZU5vZGUoITApLmZpcmVFdmVudChcIm9uY2xpY2tcIikpLGk9Yy5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiksaS52YWx1ZT1cInRcIixpLnNldEF0dHJpYnV0ZShcInR5cGVcIixcInJhZGlvXCIpLGIucmFkaW9WYWx1ZT1pLnZhbHVlPT09XCJ0XCIsaS5zZXRBdHRyaWJ1dGUoXCJjaGVja2VkXCIsXCJjaGVja2VkXCIpLHEuYXBwZW5kQ2hpbGQoaSksaz1jLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSxrLmFwcGVuZENoaWxkKHEubGFzdENoaWxkKSxiLmNoZWNrQ2xvbmU9ay5jbG9uZU5vZGUoITApLmNsb25lTm9kZSghMCkubGFzdENoaWxkLmNoZWNrZWQsYi5hcHBlbmRDaGVja2VkPWkuY2hlY2tlZCxrLnJlbW92ZUNoaWxkKGkpLGsuYXBwZW5kQ2hpbGQocSkscS5pbm5lckhUTUw9XCJcIixhLmdldENvbXB1dGVkU3R5bGUmJihqPWMuY3JlYXRlRWxlbWVudChcImRpdlwiKSxqLnN0eWxlLndpZHRoPVwiMFwiLGouc3R5bGUubWFyZ2luUmlnaHQ9XCIwXCIscS5zdHlsZS53aWR0aD1cIjJweFwiLHEuYXBwZW5kQ2hpbGQoaiksYi5yZWxpYWJsZU1hcmdpblJpZ2h0PShwYXJzZUludCgoYS5nZXRDb21wdXRlZFN0eWxlKGosbnVsbCl8fHttYXJnaW5SaWdodDowfSkubWFyZ2luUmlnaHQsMTApfHwwKT09PTApO2lmKHEuYXR0YWNoRXZlbnQpZm9yKG8gaW57c3VibWl0OjEsY2hhbmdlOjEsZm9jdXNpbjoxfSluPVwib25cIitvLHA9biBpbiBxLHB8fChxLnNldEF0dHJpYnV0ZShuLFwicmV0dXJuO1wiKSxwPXR5cGVvZiBxW25dPT1cImZ1bmN0aW9uXCIpLGJbbytcIkJ1YmJsZXNcIl09cDtrLnJlbW92ZUNoaWxkKHEpLGs9Zz1oPWo9cT1pPW51bGwsZihmdW5jdGlvbigpe3ZhciBhLGQsZSxnLGgsaSxqLGssbSxuLG8scj1jLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiYm9keVwiKVswXTshcnx8KGo9MSxrPVwicG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO3dpZHRoOjFweDtoZWlnaHQ6MXB4O21hcmdpbjowO1wiLG09XCJ2aXNpYmlsaXR5OmhpZGRlbjtib3JkZXI6MDtcIixuPVwic3R5bGU9J1wiK2srXCJib3JkZXI6NXB4IHNvbGlkICMwMDA7cGFkZGluZzowOydcIixvPVwiPGRpdiBcIituK1wiPjxkaXY+PC9kaXY+PC9kaXY+XCIrXCI8dGFibGUgXCIrbitcIiBjZWxscGFkZGluZz0nMCcgY2VsbHNwYWNpbmc9JzAnPlwiK1wiPHRyPjx0ZD48L3RkPjwvdHI+PC90YWJsZT5cIixhPWMuY3JlYXRlRWxlbWVudChcImRpdlwiKSxhLnN0eWxlLmNzc1RleHQ9bStcIndpZHRoOjA7aGVpZ2h0OjA7cG9zaXRpb246c3RhdGljO3RvcDowO21hcmdpbi10b3A6XCIraitcInB4XCIsci5pbnNlcnRCZWZvcmUoYSxyLmZpcnN0Q2hpbGQpLHE9Yy5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGEuYXBwZW5kQ2hpbGQocSkscS5pbm5lckhUTUw9XCI8dGFibGU+PHRyPjx0ZCBzdHlsZT0ncGFkZGluZzowO2JvcmRlcjowO2Rpc3BsYXk6bm9uZSc+PC90ZD48dGQ+dDwvdGQ+PC90cj48L3RhYmxlPlwiLGw9cS5nZXRFbGVtZW50c0J5VGFnTmFtZShcInRkXCIpLHA9bFswXS5vZmZzZXRIZWlnaHQ9PT0wLGxbMF0uc3R5bGUuZGlzcGxheT1cIlwiLGxbMV0uc3R5bGUuZGlzcGxheT1cIm5vbmVcIixiLnJlbGlhYmxlSGlkZGVuT2Zmc2V0cz1wJiZsWzBdLm9mZnNldEhlaWdodD09PTAscS5pbm5lckhUTUw9XCJcIixxLnN0eWxlLndpZHRoPXEuc3R5bGUucGFkZGluZ0xlZnQ9XCIxcHhcIixmLmJveE1vZGVsPWIuYm94TW9kZWw9cS5vZmZzZXRXaWR0aD09PTIsdHlwZW9mIHEuc3R5bGUuem9vbSE9XCJ1bmRlZmluZWRcIiYmKHEuc3R5bGUuZGlzcGxheT1cImlubGluZVwiLHEuc3R5bGUuem9vbT0xLGIuaW5saW5lQmxvY2tOZWVkc0xheW91dD1xLm9mZnNldFdpZHRoPT09MixxLnN0eWxlLmRpc3BsYXk9XCJcIixxLmlubmVySFRNTD1cIjxkaXYgc3R5bGU9J3dpZHRoOjRweDsnPjwvZGl2PlwiLGIuc2hyaW5rV3JhcEJsb2Nrcz1xLm9mZnNldFdpZHRoIT09MikscS5zdHlsZS5jc3NUZXh0PWsrbSxxLmlubmVySFRNTD1vLGQ9cS5maXJzdENoaWxkLGU9ZC5maXJzdENoaWxkLGg9ZC5uZXh0U2libGluZy5maXJzdENoaWxkLmZpcnN0Q2hpbGQsaT17ZG9lc05vdEFkZEJvcmRlcjplLm9mZnNldFRvcCE9PTUsZG9lc0FkZEJvcmRlckZvclRhYmxlQW5kQ2VsbHM6aC5vZmZzZXRUb3A9PT01fSxlLnN0eWxlLnBvc2l0aW9uPVwiZml4ZWRcIixlLnN0eWxlLnRvcD1cIjIwcHhcIixpLmZpeGVkUG9zaXRpb249ZS5vZmZzZXRUb3A9PT0yMHx8ZS5vZmZzZXRUb3A9PT0xNSxlLnN0eWxlLnBvc2l0aW9uPWUuc3R5bGUudG9wPVwiXCIsZC5zdHlsZS5vdmVyZmxvdz1cImhpZGRlblwiLGQuc3R5bGUucG9zaXRpb249XCJyZWxhdGl2ZVwiLGkuc3VidHJhY3RzQm9yZGVyRm9yT3ZlcmZsb3dOb3RWaXNpYmxlPWUub2Zmc2V0VG9wPT09LTUsaS5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldD1yLm9mZnNldFRvcCE9PWosci5yZW1vdmVDaGlsZChhKSxxPWE9bnVsbCxmLmV4dGVuZChiLGkpKX0pO3JldHVybiBifSgpO3ZhciBqPS9eKD86XFx7LipcXH18XFxbLipcXF0pJC8saz0vKFtBLVpdKS9nO2YuZXh0ZW5kKHtjYWNoZTp7fSx1dWlkOjAsZXhwYW5kbzpcImpRdWVyeVwiKyhmLmZuLmpxdWVyeStNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cXEQvZyxcIlwiKSxub0RhdGE6e2VtYmVkOiEwLG9iamVjdDpcImNsc2lkOkQyN0NEQjZFLUFFNkQtMTFjZi05NkI4LTQ0NDU1MzU0MDAwMFwiLGFwcGxldDohMH0saGFzRGF0YTpmdW5jdGlvbihhKXthPWEubm9kZVR5cGU/Zi5jYWNoZVthW2YuZXhwYW5kb11dOmFbZi5leHBhbmRvXTtyZXR1cm4hIWEmJiFtKGEpfSxkYXRhOmZ1bmN0aW9uKGEsYyxkLGUpe2lmKCEhZi5hY2NlcHREYXRhKGEpKXt2YXIgZyxoLGksaj1mLmV4cGFuZG8saz10eXBlb2YgYz09XCJzdHJpbmdcIixsPWEubm9kZVR5cGUsbT1sP2YuY2FjaGU6YSxuPWw/YVtqXTphW2pdJiZqLG89Yz09PVwiZXZlbnRzXCI7aWYoKCFufHwhbVtuXXx8IW8mJiFlJiYhbVtuXS5kYXRhKSYmayYmZD09PWIpcmV0dXJuO258fChsP2Fbal09bj0rK2YudXVpZDpuPWopLG1bbl18fChtW25dPXt9LGx8fChtW25dLnRvSlNPTj1mLm5vb3ApKTtpZih0eXBlb2YgYz09XCJvYmplY3RcInx8dHlwZW9mIGM9PVwiZnVuY3Rpb25cIillP21bbl09Zi5leHRlbmQobVtuXSxjKTptW25dLmRhdGE9Zi5leHRlbmQobVtuXS5kYXRhLGMpO2c9aD1tW25dLGV8fChoLmRhdGF8fChoLmRhdGE9e30pLGg9aC5kYXRhKSxkIT09YiYmKGhbZi5jYW1lbENhc2UoYyldPWQpO2lmKG8mJiFoW2NdKXJldHVybiBnLmV2ZW50cztrPyhpPWhbY10saT09bnVsbCYmKGk9aFtmLmNhbWVsQ2FzZShjKV0pKTppPWg7cmV0dXJuIGl9fSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGEsYixjKXtpZighIWYuYWNjZXB0RGF0YShhKSl7dmFyIGQsZSxnLGg9Zi5leHBhbmRvLGk9YS5ub2RlVHlwZSxqPWk/Zi5jYWNoZTphLGs9aT9hW2hdOmg7aWYoIWpba10pcmV0dXJuO2lmKGIpe2Q9Yz9qW2tdOmpba10uZGF0YTtpZihkKXtmLmlzQXJyYXkoYil8fChiIGluIGQ/Yj1bYl06KGI9Zi5jYW1lbENhc2UoYiksYiBpbiBkP2I9W2JdOmI9Yi5zcGxpdChcIiBcIikpKTtmb3IoZT0wLGc9Yi5sZW5ndGg7ZTxnO2UrKylkZWxldGUgZFtiW2VdXTtpZighKGM/bTpmLmlzRW1wdHlPYmplY3QpKGQpKXJldHVybn19aWYoIWMpe2RlbGV0ZSBqW2tdLmRhdGE7aWYoIW0oaltrXSkpcmV0dXJufWYuc3VwcG9ydC5kZWxldGVFeHBhbmRvfHwhai5zZXRJbnRlcnZhbD9kZWxldGUgaltrXTpqW2tdPW51bGwsaSYmKGYuc3VwcG9ydC5kZWxldGVFeHBhbmRvP2RlbGV0ZSBhW2hdOmEucmVtb3ZlQXR0cmlidXRlP2EucmVtb3ZlQXR0cmlidXRlKGgpOmFbaF09bnVsbCl9fSxfZGF0YTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZGF0YShhLGIsYywhMCl9LGFjY2VwdERhdGE6ZnVuY3Rpb24oYSl7aWYoYS5ub2RlTmFtZSl7dmFyIGI9Zi5ub0RhdGFbYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXTtpZihiKXJldHVybiBiIT09ITAmJmEuZ2V0QXR0cmlidXRlKFwiY2xhc3NpZFwiKT09PWJ9cmV0dXJuITB9fSksZi5mbi5leHRlbmQoe2RhdGE6ZnVuY3Rpb24oYSxjKXt2YXIgZCxlLGcsaD1udWxsO2lmKHR5cGVvZiBhPT1cInVuZGVmaW5lZFwiKXtpZih0aGlzLmxlbmd0aCl7aD1mLmRhdGEodGhpc1swXSk7aWYodGhpc1swXS5ub2RlVHlwZT09PTEmJiFmLl9kYXRhKHRoaXNbMF0sXCJwYXJzZWRBdHRyc1wiKSl7ZT10aGlzWzBdLmF0dHJpYnV0ZXM7Zm9yKHZhciBpPTAsaj1lLmxlbmd0aDtpPGo7aSsrKWc9ZVtpXS5uYW1lLGcuaW5kZXhPZihcImRhdGEtXCIpPT09MCYmKGc9Zi5jYW1lbENhc2UoZy5zdWJzdHJpbmcoNSkpLGwodGhpc1swXSxnLGhbZ10pKTtmLl9kYXRhKHRoaXNbMF0sXCJwYXJzZWRBdHRyc1wiLCEwKX19cmV0dXJuIGh9aWYodHlwZW9mIGE9PVwib2JqZWN0XCIpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YuZGF0YSh0aGlzLGEpfSk7ZD1hLnNwbGl0KFwiLlwiKSxkWzFdPWRbMV0/XCIuXCIrZFsxXTpcIlwiO2lmKGM9PT1iKXtoPXRoaXMudHJpZ2dlckhhbmRsZXIoXCJnZXREYXRhXCIrZFsxXStcIiFcIixbZFswXV0pLGg9PT1iJiZ0aGlzLmxlbmd0aCYmKGg9Zi5kYXRhKHRoaXNbMF0sYSksaD1sKHRoaXNbMF0sYSxoKSk7cmV0dXJuIGg9PT1iJiZkWzFdP3RoaXMuZGF0YShkWzBdKTpofXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1mKHRoaXMpLGU9W2RbMF0sY107Yi50cmlnZ2VySGFuZGxlcihcInNldERhdGFcIitkWzFdK1wiIVwiLGUpLGYuZGF0YSh0aGlzLGEsYyksYi50cmlnZ2VySGFuZGxlcihcImNoYW5nZURhdGFcIitkWzFdK1wiIVwiLGUpfSl9LHJlbW92ZURhdGE6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YucmVtb3ZlRGF0YSh0aGlzLGEpfSl9fSksZi5leHRlbmQoe19tYXJrOmZ1bmN0aW9uKGEsYil7YSYmKGI9KGJ8fFwiZnhcIikrXCJtYXJrXCIsZi5fZGF0YShhLGIsKGYuX2RhdGEoYSxiKXx8MCkrMSkpfSxfdW5tYXJrOmZ1bmN0aW9uKGEsYixjKXthIT09ITAmJihjPWIsYj1hLGE9ITEpO2lmKGIpe2M9Y3x8XCJmeFwiO3ZhciBkPWMrXCJtYXJrXCIsZT1hPzA6KGYuX2RhdGEoYixkKXx8MSktMTtlP2YuX2RhdGEoYixkLGUpOihmLnJlbW92ZURhdGEoYixkLCEwKSxuKGIsYyxcIm1hcmtcIikpfX0scXVldWU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkO2lmKGEpe2I9KGJ8fFwiZnhcIikrXCJxdWV1ZVwiLGQ9Zi5fZGF0YShhLGIpLGMmJighZHx8Zi5pc0FycmF5KGMpP2Q9Zi5fZGF0YShhLGIsZi5tYWtlQXJyYXkoYykpOmQucHVzaChjKSk7cmV0dXJuIGR8fFtdfX0sZGVxdWV1ZTpmdW5jdGlvbihhLGIpe2I9Ynx8XCJmeFwiO3ZhciBjPWYucXVldWUoYSxiKSxkPWMuc2hpZnQoKSxlPXt9O2Q9PT1cImlucHJvZ3Jlc3NcIiYmKGQ9Yy5zaGlmdCgpKSxkJiYoYj09PVwiZnhcIiYmYy51bnNoaWZ0KFwiaW5wcm9ncmVzc1wiKSxmLl9kYXRhKGEsYitcIi5ydW5cIixlKSxkLmNhbGwoYSxmdW5jdGlvbigpe2YuZGVxdWV1ZShhLGIpfSxlKSksYy5sZW5ndGh8fChmLnJlbW92ZURhdGEoYSxiK1wicXVldWUgXCIrYitcIi5ydW5cIiwhMCksbihhLGIsXCJxdWV1ZVwiKSl9fSksZi5mbi5leHRlbmQoe3F1ZXVlOmZ1bmN0aW9uKGEsYyl7dHlwZW9mIGEhPVwic3RyaW5nXCImJihjPWEsYT1cImZ4XCIpO2lmKGM9PT1iKXJldHVybiBmLnF1ZXVlKHRoaXNbMF0sYSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWYucXVldWUodGhpcyxhLGMpO2E9PT1cImZ4XCImJmJbMF0hPT1cImlucHJvZ3Jlc3NcIiYmZi5kZXF1ZXVlKHRoaXMsYSl9KX0sZGVxdWV1ZTpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5kZXF1ZXVlKHRoaXMsYSl9KX0sZGVsYXk6ZnVuY3Rpb24oYSxiKXthPWYuZng/Zi5meC5zcGVlZHNbYV18fGE6YSxiPWJ8fFwiZnhcIjtyZXR1cm4gdGhpcy5xdWV1ZShiLGZ1bmN0aW9uKGIsYyl7dmFyIGQ9c2V0VGltZW91dChiLGEpO2Muc3RvcD1mdW5jdGlvbigpe2NsZWFyVGltZW91dChkKX19KX0sY2xlYXJRdWV1ZTpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5xdWV1ZShhfHxcImZ4XCIsW10pfSxwcm9taXNlOmZ1bmN0aW9uKGEsYyl7ZnVuY3Rpb24gbSgpey0taHx8ZC5yZXNvbHZlV2l0aChlLFtlXSl9dHlwZW9mIGEhPVwic3RyaW5nXCImJihjPWEsYT1iKSxhPWF8fFwiZnhcIjt2YXIgZD1mLkRlZmVycmVkKCksZT10aGlzLGc9ZS5sZW5ndGgsaD0xLGk9YStcImRlZmVyXCIsaj1hK1wicXVldWVcIixrPWErXCJtYXJrXCIsbDt3aGlsZShnLS0paWYobD1mLmRhdGEoZVtnXSxpLGIsITApfHwoZi5kYXRhKGVbZ10saixiLCEwKXx8Zi5kYXRhKGVbZ10sayxiLCEwKSkmJmYuZGF0YShlW2ddLGksZi5DYWxsYmFja3MoXCJvbmNlIG1lbW9yeVwiKSwhMCkpaCsrLGwuYWRkKG0pO20oKTtyZXR1cm4gZC5wcm9taXNlKCl9fSk7dmFyIG89L1tcXG5cXHRcXHJdL2cscD0vXFxzKy8scT0vXFxyL2cscj0vXig/OmJ1dHRvbnxpbnB1dCkkL2kscz0vXig/OmJ1dHRvbnxpbnB1dHxvYmplY3R8c2VsZWN0fHRleHRhcmVhKSQvaSx0PS9eYSg/OnJlYSk/JC9pLHU9L14oPzphdXRvZm9jdXN8YXV0b3BsYXl8YXN5bmN8Y2hlY2tlZHxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZHxzZWxlY3RlZCkkL2ksdj1mLnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlLHcseCx5O2YuZm4uZXh0ZW5kKHthdHRyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGYuYWNjZXNzKHRoaXMsYSxiLCEwLGYuYXR0cil9LHJlbW92ZUF0dHI6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YucmVtb3ZlQXR0cih0aGlzLGEpfSl9LHByb3A6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZi5hY2Nlc3ModGhpcyxhLGIsITAsZi5wcm9wKX0scmVtb3ZlUHJvcDpmdW5jdGlvbihhKXthPWYucHJvcEZpeFthXXx8YTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dHJ5e3RoaXNbYV09YixkZWxldGUgdGhpc1thXX1jYXRjaChjKXt9fSl9LGFkZENsYXNzOmZ1bmN0aW9uKGEpe3ZhciBiLGMsZCxlLGcsaCxpO2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe2YodGhpcykuYWRkQ2xhc3MoYS5jYWxsKHRoaXMsYix0aGlzLmNsYXNzTmFtZSkpfSk7aWYoYSYmdHlwZW9mIGE9PVwic3RyaW5nXCIpe2I9YS5zcGxpdChwKTtmb3IoYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKyl7ZT10aGlzW2NdO2lmKGUubm9kZVR5cGU9PT0xKWlmKCFlLmNsYXNzTmFtZSYmYi5sZW5ndGg9PT0xKWUuY2xhc3NOYW1lPWE7ZWxzZXtnPVwiIFwiK2UuY2xhc3NOYW1lK1wiIFwiO2ZvcihoPTAsaT1iLmxlbmd0aDtoPGk7aCsrKX5nLmluZGV4T2YoXCIgXCIrYltoXStcIiBcIil8fChnKz1iW2hdK1wiIFwiKTtlLmNsYXNzTmFtZT1mLnRyaW0oZyl9fX1yZXR1cm4gdGhpc30scmVtb3ZlQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGMsZCxlLGcsaCxpLGo7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS5yZW1vdmVDbGFzcyhhLmNhbGwodGhpcyxiLHRoaXMuY2xhc3NOYW1lKSl9KTtpZihhJiZ0eXBlb2YgYT09XCJzdHJpbmdcInx8YT09PWIpe2M9KGF8fFwiXCIpLnNwbGl0KHApO2ZvcihkPTAsZT10aGlzLmxlbmd0aDtkPGU7ZCsrKXtnPXRoaXNbZF07aWYoZy5ub2RlVHlwZT09PTEmJmcuY2xhc3NOYW1lKWlmKGEpe2g9KFwiIFwiK2cuY2xhc3NOYW1lK1wiIFwiKS5yZXBsYWNlKG8sXCIgXCIpO2ZvcihpPTAsaj1jLmxlbmd0aDtpPGo7aSsrKWg9aC5yZXBsYWNlKFwiIFwiK2NbaV0rXCIgXCIsXCIgXCIpO2cuY2xhc3NOYW1lPWYudHJpbShoKX1lbHNlIGcuY2xhc3NOYW1lPVwiXCJ9fXJldHVybiB0aGlzfSx0b2dnbGVDbGFzczpmdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBhLGQ9dHlwZW9mIGI9PVwiYm9vbGVhblwiO2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGMpe2YodGhpcykudG9nZ2xlQ2xhc3MoYS5jYWxsKHRoaXMsYyx0aGlzLmNsYXNzTmFtZSxiKSxiKX0pO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZihjPT09XCJzdHJpbmdcIil7dmFyIGUsZz0wLGg9Zih0aGlzKSxpPWIsaj1hLnNwbGl0KHApO3doaWxlKGU9altnKytdKWk9ZD9pOiFoLmhhc0NsYXNzKGUpLGhbaT9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShlKX1lbHNlIGlmKGM9PT1cInVuZGVmaW5lZFwifHxjPT09XCJib29sZWFuXCIpdGhpcy5jbGFzc05hbWUmJmYuX2RhdGEodGhpcyxcIl9fY2xhc3NOYW1lX19cIix0aGlzLmNsYXNzTmFtZSksdGhpcy5jbGFzc05hbWU9dGhpcy5jbGFzc05hbWV8fGE9PT0hMT9cIlwiOmYuX2RhdGEodGhpcyxcIl9fY2xhc3NOYW1lX19cIil8fFwiXCJ9KX0saGFzQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGI9XCIgXCIrYStcIiBcIixjPTAsZD10aGlzLmxlbmd0aDtmb3IoO2M8ZDtjKyspaWYodGhpc1tjXS5ub2RlVHlwZT09PTEmJihcIiBcIit0aGlzW2NdLmNsYXNzTmFtZStcIiBcIikucmVwbGFjZShvLFwiIFwiKS5pbmRleE9mKGIpPi0xKXJldHVybiEwO3JldHVybiExfSx2YWw6ZnVuY3Rpb24oYSl7dmFyIGMsZCxlLGc9dGhpc1swXTt7aWYoISFhcmd1bWVudHMubGVuZ3RoKXtlPWYuaXNGdW5jdGlvbihhKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGQpe3ZhciBnPWYodGhpcyksaDtpZih0aGlzLm5vZGVUeXBlPT09MSl7ZT9oPWEuY2FsbCh0aGlzLGQsZy52YWwoKSk6aD1hLGg9PW51bGw/aD1cIlwiOnR5cGVvZiBoPT1cIm51bWJlclwiP2grPVwiXCI6Zi5pc0FycmF5KGgpJiYoaD1mLm1hcChoLGZ1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsP1wiXCI6YStcIlwifSkpLGM9Zi52YWxIb29rc1t0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldfHxmLnZhbEhvb2tzW3RoaXMudHlwZV07aWYoIWN8fCEoXCJzZXRcImluIGMpfHxjLnNldCh0aGlzLGgsXCJ2YWx1ZVwiKT09PWIpdGhpcy52YWx1ZT1ofX0pfWlmKGcpe2M9Zi52YWxIb29rc1tnLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldfHxmLnZhbEhvb2tzW2cudHlwZV07aWYoYyYmXCJnZXRcImluIGMmJihkPWMuZ2V0KGcsXCJ2YWx1ZVwiKSkhPT1iKXJldHVybiBkO2Q9Zy52YWx1ZTtyZXR1cm4gdHlwZW9mIGQ9PVwic3RyaW5nXCI/ZC5yZXBsYWNlKHEsXCJcIik6ZD09bnVsbD9cIlwiOmR9fX19KSxmLmV4dGVuZCh7dmFsSG9va3M6e29wdGlvbjp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiPWEuYXR0cmlidXRlcy52YWx1ZTtyZXR1cm4hYnx8Yi5zcGVjaWZpZWQ/YS52YWx1ZTphLnRleHR9fSxzZWxlY3Q6e2dldDpmdW5jdGlvbihhKXt2YXIgYixjLGQsZSxnPWEuc2VsZWN0ZWRJbmRleCxoPVtdLGk9YS5vcHRpb25zLGo9YS50eXBlPT09XCJzZWxlY3Qtb25lXCI7aWYoZzwwKXJldHVybiBudWxsO2M9aj9nOjAsZD1qP2crMTppLmxlbmd0aDtmb3IoO2M8ZDtjKyspe2U9aVtjXTtpZihlLnNlbGVjdGVkJiYoZi5zdXBwb3J0Lm9wdERpc2FibGVkPyFlLmRpc2FibGVkOmUuZ2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIik9PT1udWxsKSYmKCFlLnBhcmVudE5vZGUuZGlzYWJsZWR8fCFmLm5vZGVOYW1lKGUucGFyZW50Tm9kZSxcIm9wdGdyb3VwXCIpKSl7Yj1mKGUpLnZhbCgpO2lmKGopcmV0dXJuIGI7aC5wdXNoKGIpfX1pZihqJiYhaC5sZW5ndGgmJmkubGVuZ3RoKXJldHVybiBmKGlbZ10pLnZhbCgpO3JldHVybiBofSxzZXQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1mLm1ha2VBcnJheShiKTtmKGEpLmZpbmQoXCJvcHRpb25cIikuZWFjaChmdW5jdGlvbigpe3RoaXMuc2VsZWN0ZWQ9Zi5pbkFycmF5KGYodGhpcykudmFsKCksYyk+PTB9KSxjLmxlbmd0aHx8KGEuc2VsZWN0ZWRJbmRleD0tMSk7cmV0dXJuIGN9fX0sYXR0ckZuOnt2YWw6ITAsY3NzOiEwLGh0bWw6ITAsdGV4dDohMCxkYXRhOiEwLHdpZHRoOiEwLGhlaWdodDohMCxvZmZzZXQ6ITB9LGF0dHI6ZnVuY3Rpb24oYSxjLGQsZSl7dmFyIGcsaCxpLGo9YS5ub2RlVHlwZTtpZighIWEmJmohPT0zJiZqIT09OCYmaiE9PTIpe2lmKGUmJmMgaW4gZi5hdHRyRm4pcmV0dXJuIGYoYSlbY10oZCk7aWYodHlwZW9mIGEuZ2V0QXR0cmlidXRlPT1cInVuZGVmaW5lZFwiKXJldHVybiBmLnByb3AoYSxjLGQpO2k9aiE9PTF8fCFmLmlzWE1MRG9jKGEpLGkmJihjPWMudG9Mb3dlckNhc2UoKSxoPWYuYXR0ckhvb2tzW2NdfHwodS50ZXN0KGMpP3g6dykpO2lmKGQhPT1iKXtpZihkPT09bnVsbCl7Zi5yZW1vdmVBdHRyKGEsYyk7cmV0dXJufWlmKGgmJlwic2V0XCJpbiBoJiZpJiYoZz1oLnNldChhLGQsYykpIT09YilyZXR1cm4gZzthLnNldEF0dHJpYnV0ZShjLFwiXCIrZCk7cmV0dXJuIGR9aWYoaCYmXCJnZXRcImluIGgmJmkmJihnPWguZ2V0KGEsYykpIT09bnVsbClyZXR1cm4gZztnPWEuZ2V0QXR0cmlidXRlKGMpO3JldHVybiBnPT09bnVsbD9iOmd9fSxyZW1vdmVBdHRyOmZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlLGcsaD0wO2lmKGImJmEubm9kZVR5cGU9PT0xKXtkPWIudG9Mb3dlckNhc2UoKS5zcGxpdChwKSxnPWQubGVuZ3RoO2Zvcig7aDxnO2grKyllPWRbaF0sZSYmKGM9Zi5wcm9wRml4W2VdfHxlLGYuYXR0cihhLGUsXCJcIiksYS5yZW1vdmVBdHRyaWJ1dGUodj9lOmMpLHUudGVzdChlKSYmYyBpbiBhJiYoYVtjXT0hMSkpfX0sYXR0ckhvb2tzOnt0eXBlOntzZXQ6ZnVuY3Rpb24oYSxiKXtpZihyLnRlc3QoYS5ub2RlTmFtZSkmJmEucGFyZW50Tm9kZSlmLmVycm9yKFwidHlwZSBwcm9wZXJ0eSBjYW4ndCBiZSBjaGFuZ2VkXCIpO2Vsc2UgaWYoIWYuc3VwcG9ydC5yYWRpb1ZhbHVlJiZiPT09XCJyYWRpb1wiJiZmLm5vZGVOYW1lKGEsXCJpbnB1dFwiKSl7dmFyIGM9YS52YWx1ZTthLnNldEF0dHJpYnV0ZShcInR5cGVcIixiKSxjJiYoYS52YWx1ZT1jKTtyZXR1cm4gYn19fSx2YWx1ZTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYodyYmZi5ub2RlTmFtZShhLFwiYnV0dG9uXCIpKXJldHVybiB3LmdldChhLGIpO3JldHVybiBiIGluIGE/YS52YWx1ZTpudWxsfSxzZXQ6ZnVuY3Rpb24oYSxiLGMpe2lmKHcmJmYubm9kZU5hbWUoYSxcImJ1dHRvblwiKSlyZXR1cm4gdy5zZXQoYSxiLGMpO2EudmFsdWU9Yn19fSxwcm9wRml4Ont0YWJpbmRleDpcInRhYkluZGV4XCIscmVhZG9ubHk6XCJyZWFkT25seVwiLFwiZm9yXCI6XCJodG1sRm9yXCIsXCJjbGFzc1wiOlwiY2xhc3NOYW1lXCIsbWF4bGVuZ3RoOlwibWF4TGVuZ3RoXCIsY2VsbHNwYWNpbmc6XCJjZWxsU3BhY2luZ1wiLGNlbGxwYWRkaW5nOlwiY2VsbFBhZGRpbmdcIixyb3dzcGFuOlwicm93U3BhblwiLGNvbHNwYW46XCJjb2xTcGFuXCIsdXNlbWFwOlwidXNlTWFwXCIsZnJhbWVib3JkZXI6XCJmcmFtZUJvcmRlclwiLGNvbnRlbnRlZGl0YWJsZTpcImNvbnRlbnRFZGl0YWJsZVwifSxwcm9wOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZSxnLGgsaT1hLm5vZGVUeXBlO2lmKCEhYSYmaSE9PTMmJmkhPT04JiZpIT09Mil7aD1pIT09MXx8IWYuaXNYTUxEb2MoYSksaCYmKGM9Zi5wcm9wRml4W2NdfHxjLGc9Zi5wcm9wSG9va3NbY10pO3JldHVybiBkIT09Yj9nJiZcInNldFwiaW4gZyYmKGU9Zy5zZXQoYSxkLGMpKSE9PWI/ZTphW2NdPWQ6ZyYmXCJnZXRcImluIGcmJihlPWcuZ2V0KGEsYykpIT09bnVsbD9lOmFbY119fSxwcm9wSG9va3M6e3RhYkluZGV4OntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGM9YS5nZXRBdHRyaWJ1dGVOb2RlKFwidGFiaW5kZXhcIik7cmV0dXJuIGMmJmMuc3BlY2lmaWVkP3BhcnNlSW50KGMudmFsdWUsMTApOnMudGVzdChhLm5vZGVOYW1lKXx8dC50ZXN0KGEubm9kZU5hbWUpJiZhLmhyZWY/MDpifX19fSksZi5hdHRySG9va3MudGFiaW5kZXg9Zi5wcm9wSG9va3MudGFiSW5kZXgseD17Z2V0OmZ1bmN0aW9uKGEsYyl7dmFyIGQsZT1mLnByb3AoYSxjKTtyZXR1cm4gZT09PSEwfHx0eXBlb2YgZSE9XCJib29sZWFuXCImJihkPWEuZ2V0QXR0cmlidXRlTm9kZShjKSkmJmQubm9kZVZhbHVlIT09ITE/Yy50b0xvd2VyQ2FzZSgpOmJ9LHNldDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ7Yj09PSExP2YucmVtb3ZlQXR0cihhLGMpOihkPWYucHJvcEZpeFtjXXx8YyxkIGluIGEmJihhW2RdPSEwKSxhLnNldEF0dHJpYnV0ZShjLGMudG9Mb3dlckNhc2UoKSkpO3JldHVybiBjfX0sdnx8KHk9e25hbWU6ITAsaWQ6ITB9LHc9Zi52YWxIb29rcy5idXR0b249e2dldDpmdW5jdGlvbihhLGMpe3ZhciBkO2Q9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO3JldHVybiBkJiYoeVtjXT9kLm5vZGVWYWx1ZSE9PVwiXCI6ZC5zcGVjaWZpZWQpP2Qubm9kZVZhbHVlOmJ9LHNldDpmdW5jdGlvbihhLGIsZCl7dmFyIGU9YS5nZXRBdHRyaWJ1dGVOb2RlKGQpO2V8fChlPWMuY3JlYXRlQXR0cmlidXRlKGQpLGEuc2V0QXR0cmlidXRlTm9kZShlKSk7cmV0dXJuIGUubm9kZVZhbHVlPWIrXCJcIn19LGYuYXR0ckhvb2tzLnRhYmluZGV4LnNldD13LnNldCxmLmVhY2goW1wid2lkdGhcIixcImhlaWdodFwiXSxmdW5jdGlvbihhLGIpe2YuYXR0ckhvb2tzW2JdPWYuZXh0ZW5kKGYuYXR0ckhvb2tzW2JdLHtzZXQ6ZnVuY3Rpb24oYSxjKXtpZihjPT09XCJcIil7YS5zZXRBdHRyaWJ1dGUoYixcImF1dG9cIik7cmV0dXJuIGN9fX0pfSksZi5hdHRySG9va3MuY29udGVudGVkaXRhYmxlPXtnZXQ6dy5nZXQsc2V0OmZ1bmN0aW9uKGEsYixjKXtiPT09XCJcIiYmKGI9XCJmYWxzZVwiKSx3LnNldChhLGIsYyl9fSksZi5zdXBwb3J0LmhyZWZOb3JtYWxpemVkfHxmLmVhY2goW1wiaHJlZlwiLFwic3JjXCIsXCJ3aWR0aFwiLFwiaGVpZ2h0XCJdLGZ1bmN0aW9uKGEsYyl7Zi5hdHRySG9va3NbY109Zi5leHRlbmQoZi5hdHRySG9va3NbY10se2dldDpmdW5jdGlvbihhKXt2YXIgZD1hLmdldEF0dHJpYnV0ZShjLDIpO3JldHVybiBkPT09bnVsbD9iOmR9fSl9KSxmLnN1cHBvcnQuc3R5bGV8fChmLmF0dHJIb29rcy5zdHlsZT17Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhLnN0eWxlLmNzc1RleHQudG9Mb3dlckNhc2UoKXx8Yn0sc2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuc3R5bGUuY3NzVGV4dD1cIlwiK2J9fSksZi5zdXBwb3J0Lm9wdFNlbGVjdGVkfHwoZi5wcm9wSG9va3Muc2VsZWN0ZWQ9Zi5leHRlbmQoZi5wcm9wSG9va3Muc2VsZWN0ZWQse2dldDpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7YiYmKGIuc2VsZWN0ZWRJbmRleCxiLnBhcmVudE5vZGUmJmIucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4KTtyZXR1cm4gbnVsbH19KSksZi5zdXBwb3J0LmVuY3R5cGV8fChmLnByb3BGaXguZW5jdHlwZT1cImVuY29kaW5nXCIpLGYuc3VwcG9ydC5jaGVja09ufHxmLmVhY2goW1wicmFkaW9cIixcImNoZWNrYm94XCJdLGZ1bmN0aW9uKCl7Zi52YWxIb29rc1t0aGlzXT17Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZShcInZhbHVlXCIpPT09bnVsbD9cIm9uXCI6YS52YWx1ZX19fSksZi5lYWNoKFtcInJhZGlvXCIsXCJjaGVja2JveFwiXSxmdW5jdGlvbigpe2YudmFsSG9va3NbdGhpc109Zi5leHRlbmQoZi52YWxIb29rc1t0aGlzXSx7c2V0OmZ1bmN0aW9uKGEsYil7aWYoZi5pc0FycmF5KGIpKXJldHVybiBhLmNoZWNrZWQ9Zi5pbkFycmF5KGYoYSkudmFsKCksYik+PTB9fSl9KTt2YXIgej0vXig/OnRleHRhcmVhfGlucHV0fHNlbGVjdCkkL2ksQT0vXihbXlxcLl0qKT8oPzpcXC4oLispKT8kLyxCPS9cXGJob3ZlcihcXC5cXFMrKT9cXGIvLEM9L15rZXkvLEQ9L14oPzptb3VzZXxjb250ZXh0bWVudSl8Y2xpY2svLEU9L14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLEY9L14oXFx3KikoPzojKFtcXHdcXC1dKykpPyg/OlxcLihbXFx3XFwtXSspKT8kLyxHPWZ1bmN0aW9uKGEpe3ZhciBiPUYuZXhlYyhhKTtiJiYoYlsxXT0oYlsxXXx8XCJcIikudG9Mb3dlckNhc2UoKSxiWzNdPWJbM10mJm5ldyBSZWdFeHAoXCIoPzpefFxcXFxzKVwiK2JbM10rXCIoPzpcXFxcc3wkKVwiKSk7cmV0dXJuIGJ9LEg9ZnVuY3Rpb24oYSxiKXt2YXIgYz1hLmF0dHJpYnV0ZXN8fHt9O3JldHVybighYlsxXXx8YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09YlsxXSkmJighYlsyXXx8KGMuaWR8fHt9KS52YWx1ZT09PWJbMl0pJiYoIWJbM118fGJbM10udGVzdCgoY1tcImNsYXNzXCJdfHx7fSkudmFsdWUpKX0sST1mdW5jdGlvbihhKXtyZXR1cm4gZi5ldmVudC5zcGVjaWFsLmhvdmVyP2E6YS5yZXBsYWNlKEIsXCJtb3VzZWVudGVyJDEgbW91c2VsZWF2ZSQxXCIpfTtcbmYuZXZlbnQ9e2FkZDpmdW5jdGlvbihhLGMsZCxlLGcpe3ZhciBoLGksaixrLGwsbSxuLG8scCxxLHIscztpZighKGEubm9kZVR5cGU9PT0zfHxhLm5vZGVUeXBlPT09OHx8IWN8fCFkfHwhKGg9Zi5fZGF0YShhKSkpKXtkLmhhbmRsZXImJihwPWQsZD1wLmhhbmRsZXIpLGQuZ3VpZHx8KGQuZ3VpZD1mLmd1aWQrKyksaj1oLmV2ZW50cyxqfHwoaC5ldmVudHM9aj17fSksaT1oLmhhbmRsZSxpfHwoaC5oYW5kbGU9aT1mdW5jdGlvbihhKXtyZXR1cm4gdHlwZW9mIGYhPVwidW5kZWZpbmVkXCImJighYXx8Zi5ldmVudC50cmlnZ2VyZWQhPT1hLnR5cGUpP2YuZXZlbnQuZGlzcGF0Y2guYXBwbHkoaS5lbGVtLGFyZ3VtZW50cyk6Yn0saS5lbGVtPWEpLGM9Zi50cmltKEkoYykpLnNwbGl0KFwiIFwiKTtmb3Ioaz0wO2s8Yy5sZW5ndGg7aysrKXtsPUEuZXhlYyhjW2tdKXx8W10sbT1sWzFdLG49KGxbMl18fFwiXCIpLnNwbGl0KFwiLlwiKS5zb3J0KCkscz1mLmV2ZW50LnNwZWNpYWxbbV18fHt9LG09KGc/cy5kZWxlZ2F0ZVR5cGU6cy5iaW5kVHlwZSl8fG0scz1mLmV2ZW50LnNwZWNpYWxbbV18fHt9LG89Zi5leHRlbmQoe3R5cGU6bSxvcmlnVHlwZTpsWzFdLGRhdGE6ZSxoYW5kbGVyOmQsZ3VpZDpkLmd1aWQsc2VsZWN0b3I6ZyxxdWljazpHKGcpLG5hbWVzcGFjZTpuLmpvaW4oXCIuXCIpfSxwKSxyPWpbbV07aWYoIXIpe3I9alttXT1bXSxyLmRlbGVnYXRlQ291bnQ9MDtpZighcy5zZXR1cHx8cy5zZXR1cC5jYWxsKGEsZSxuLGkpPT09ITEpYS5hZGRFdmVudExpc3RlbmVyP2EuYWRkRXZlbnRMaXN0ZW5lcihtLGksITEpOmEuYXR0YWNoRXZlbnQmJmEuYXR0YWNoRXZlbnQoXCJvblwiK20saSl9cy5hZGQmJihzLmFkZC5jYWxsKGEsbyksby5oYW5kbGVyLmd1aWR8fChvLmhhbmRsZXIuZ3VpZD1kLmd1aWQpKSxnP3Iuc3BsaWNlKHIuZGVsZWdhdGVDb3VudCsrLDAsbyk6ci5wdXNoKG8pLGYuZXZlbnQuZ2xvYmFsW21dPSEwfWE9bnVsbH19LGdsb2JhbDp7fSxyZW1vdmU6ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgZz1mLmhhc0RhdGEoYSkmJmYuX2RhdGEoYSksaCxpLGosayxsLG0sbixvLHAscSxyLHM7aWYoISFnJiYhIShvPWcuZXZlbnRzKSl7Yj1mLnRyaW0oSShifHxcIlwiKSkuc3BsaXQoXCIgXCIpO2ZvcihoPTA7aDxiLmxlbmd0aDtoKyspe2k9QS5leGVjKGJbaF0pfHxbXSxqPWs9aVsxXSxsPWlbMl07aWYoIWope2ZvcihqIGluIG8pZi5ldmVudC5yZW1vdmUoYSxqK2JbaF0sYyxkLCEwKTtjb250aW51ZX1wPWYuZXZlbnQuc3BlY2lhbFtqXXx8e30saj0oZD9wLmRlbGVnYXRlVHlwZTpwLmJpbmRUeXBlKXx8aixyPW9bal18fFtdLG09ci5sZW5ndGgsbD1sP25ldyBSZWdFeHAoXCIoXnxcXFxcLilcIitsLnNwbGl0KFwiLlwiKS5zb3J0KCkuam9pbihcIlxcXFwuKD86LipcXFxcLik/XCIpK1wiKFxcXFwufCQpXCIpOm51bGw7Zm9yKG49MDtuPHIubGVuZ3RoO24rKylzPXJbbl0sKGV8fGs9PT1zLm9yaWdUeXBlKSYmKCFjfHxjLmd1aWQ9PT1zLmd1aWQpJiYoIWx8fGwudGVzdChzLm5hbWVzcGFjZSkpJiYoIWR8fGQ9PT1zLnNlbGVjdG9yfHxkPT09XCIqKlwiJiZzLnNlbGVjdG9yKSYmKHIuc3BsaWNlKG4tLSwxKSxzLnNlbGVjdG9yJiZyLmRlbGVnYXRlQ291bnQtLSxwLnJlbW92ZSYmcC5yZW1vdmUuY2FsbChhLHMpKTtyLmxlbmd0aD09PTAmJm0hPT1yLmxlbmd0aCYmKCghcC50ZWFyZG93bnx8cC50ZWFyZG93bi5jYWxsKGEsbCk9PT0hMSkmJmYucmVtb3ZlRXZlbnQoYSxqLGcuaGFuZGxlKSxkZWxldGUgb1tqXSl9Zi5pc0VtcHR5T2JqZWN0KG8pJiYocT1nLmhhbmRsZSxxJiYocS5lbGVtPW51bGwpLGYucmVtb3ZlRGF0YShhLFtcImV2ZW50c1wiLFwiaGFuZGxlXCJdLCEwKSl9fSxjdXN0b21FdmVudDp7Z2V0RGF0YTohMCxzZXREYXRhOiEwLGNoYW5nZURhdGE6ITB9LHRyaWdnZXI6ZnVuY3Rpb24oYyxkLGUsZyl7aWYoIWV8fGUubm9kZVR5cGUhPT0zJiZlLm5vZGVUeXBlIT09OCl7dmFyIGg9Yy50eXBlfHxjLGk9W10saixrLGwsbSxuLG8scCxxLHIscztpZihFLnRlc3QoaCtmLmV2ZW50LnRyaWdnZXJlZCkpcmV0dXJuO2guaW5kZXhPZihcIiFcIik+PTAmJihoPWguc2xpY2UoMCwtMSksaz0hMCksaC5pbmRleE9mKFwiLlwiKT49MCYmKGk9aC5zcGxpdChcIi5cIiksaD1pLnNoaWZ0KCksaS5zb3J0KCkpO2lmKCghZXx8Zi5ldmVudC5jdXN0b21FdmVudFtoXSkmJiFmLmV2ZW50Lmdsb2JhbFtoXSlyZXR1cm47Yz10eXBlb2YgYz09XCJvYmplY3RcIj9jW2YuZXhwYW5kb10/YzpuZXcgZi5FdmVudChoLGMpOm5ldyBmLkV2ZW50KGgpLGMudHlwZT1oLGMuaXNUcmlnZ2VyPSEwLGMuZXhjbHVzaXZlPWssYy5uYW1lc3BhY2U9aS5qb2luKFwiLlwiKSxjLm5hbWVzcGFjZV9yZT1jLm5hbWVzcGFjZT9uZXcgUmVnRXhwKFwiKF58XFxcXC4pXCIraS5qb2luKFwiXFxcXC4oPzouKlxcXFwuKT9cIikrXCIoXFxcXC58JClcIik6bnVsbCxvPWguaW5kZXhPZihcIjpcIik8MD9cIm9uXCIraDpcIlwiO2lmKCFlKXtqPWYuY2FjaGU7Zm9yKGwgaW4gailqW2xdLmV2ZW50cyYmaltsXS5ldmVudHNbaF0mJmYuZXZlbnQudHJpZ2dlcihjLGQsaltsXS5oYW5kbGUuZWxlbSwhMCk7cmV0dXJufWMucmVzdWx0PWIsYy50YXJnZXR8fChjLnRhcmdldD1lKSxkPWQhPW51bGw/Zi5tYWtlQXJyYXkoZCk6W10sZC51bnNoaWZ0KGMpLHA9Zi5ldmVudC5zcGVjaWFsW2hdfHx7fTtpZihwLnRyaWdnZXImJnAudHJpZ2dlci5hcHBseShlLGQpPT09ITEpcmV0dXJuO3I9W1tlLHAuYmluZFR5cGV8fGhdXTtpZighZyYmIXAubm9CdWJibGUmJiFmLmlzV2luZG93KGUpKXtzPXAuZGVsZWdhdGVUeXBlfHxoLG09RS50ZXN0KHMraCk/ZTplLnBhcmVudE5vZGUsbj1udWxsO2Zvcig7bTttPW0ucGFyZW50Tm9kZSlyLnB1c2goW20sc10pLG49bTtuJiZuPT09ZS5vd25lckRvY3VtZW50JiZyLnB1c2goW24uZGVmYXVsdFZpZXd8fG4ucGFyZW50V2luZG93fHxhLHNdKX1mb3IobD0wO2w8ci5sZW5ndGgmJiFjLmlzUHJvcGFnYXRpb25TdG9wcGVkKCk7bCsrKW09cltsXVswXSxjLnR5cGU9cltsXVsxXSxxPShmLl9kYXRhKG0sXCJldmVudHNcIil8fHt9KVtjLnR5cGVdJiZmLl9kYXRhKG0sXCJoYW5kbGVcIikscSYmcS5hcHBseShtLGQpLHE9byYmbVtvXSxxJiZmLmFjY2VwdERhdGEobSkmJnEuYXBwbHkobSxkKT09PSExJiZjLnByZXZlbnREZWZhdWx0KCk7Yy50eXBlPWgsIWcmJiFjLmlzRGVmYXVsdFByZXZlbnRlZCgpJiYoIXAuX2RlZmF1bHR8fHAuX2RlZmF1bHQuYXBwbHkoZS5vd25lckRvY3VtZW50LGQpPT09ITEpJiYoaCE9PVwiY2xpY2tcInx8IWYubm9kZU5hbWUoZSxcImFcIikpJiZmLmFjY2VwdERhdGEoZSkmJm8mJmVbaF0mJihoIT09XCJmb2N1c1wiJiZoIT09XCJibHVyXCJ8fGMudGFyZ2V0Lm9mZnNldFdpZHRoIT09MCkmJiFmLmlzV2luZG93KGUpJiYobj1lW29dLG4mJihlW29dPW51bGwpLGYuZXZlbnQudHJpZ2dlcmVkPWgsZVtoXSgpLGYuZXZlbnQudHJpZ2dlcmVkPWIsbiYmKGVbb109bikpO3JldHVybiBjLnJlc3VsdH19LGRpc3BhdGNoOmZ1bmN0aW9uKGMpe2M9Zi5ldmVudC5maXgoY3x8YS5ldmVudCk7dmFyIGQ9KGYuX2RhdGEodGhpcyxcImV2ZW50c1wiKXx8e30pW2MudHlwZV18fFtdLGU9ZC5kZWxlZ2F0ZUNvdW50LGc9W10uc2xpY2UuY2FsbChhcmd1bWVudHMsMCksaD0hYy5leGNsdXNpdmUmJiFjLm5hbWVzcGFjZSxpPVtdLGosayxsLG0sbixvLHAscSxyLHMsdDtnWzBdPWMsYy5kZWxlZ2F0ZVRhcmdldD10aGlzO2lmKGUmJiFjLnRhcmdldC5kaXNhYmxlZCYmKCFjLmJ1dHRvbnx8Yy50eXBlIT09XCJjbGlja1wiKSl7bT1mKHRoaXMpLG0uY29udGV4dD10aGlzLm93bmVyRG9jdW1lbnR8fHRoaXM7Zm9yKGw9Yy50YXJnZXQ7bCE9dGhpcztsPWwucGFyZW50Tm9kZXx8dGhpcyl7bz17fSxxPVtdLG1bMF09bDtmb3Ioaj0wO2o8ZTtqKyspcj1kW2pdLHM9ci5zZWxlY3RvcixvW3NdPT09YiYmKG9bc109ci5xdWljaz9IKGwsci5xdWljayk6bS5pcyhzKSksb1tzXSYmcS5wdXNoKHIpO3EubGVuZ3RoJiZpLnB1c2goe2VsZW06bCxtYXRjaGVzOnF9KX19ZC5sZW5ndGg+ZSYmaS5wdXNoKHtlbGVtOnRoaXMsbWF0Y2hlczpkLnNsaWNlKGUpfSk7Zm9yKGo9MDtqPGkubGVuZ3RoJiYhYy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpO2orKyl7cD1pW2pdLGMuY3VycmVudFRhcmdldD1wLmVsZW07Zm9yKGs9MDtrPHAubWF0Y2hlcy5sZW5ndGgmJiFjLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKCk7aysrKXtyPXAubWF0Y2hlc1trXTtpZihofHwhYy5uYW1lc3BhY2UmJiFyLm5hbWVzcGFjZXx8Yy5uYW1lc3BhY2VfcmUmJmMubmFtZXNwYWNlX3JlLnRlc3Qoci5uYW1lc3BhY2UpKWMuZGF0YT1yLmRhdGEsYy5oYW5kbGVPYmo9cixuPSgoZi5ldmVudC5zcGVjaWFsW3Iub3JpZ1R5cGVdfHx7fSkuaGFuZGxlfHxyLmhhbmRsZXIpLmFwcGx5KHAuZWxlbSxnKSxuIT09YiYmKGMucmVzdWx0PW4sbj09PSExJiYoYy5wcmV2ZW50RGVmYXVsdCgpLGMuc3RvcFByb3BhZ2F0aW9uKCkpKX19cmV0dXJuIGMucmVzdWx0fSxwcm9wczpcImF0dHJDaGFuZ2UgYXR0ck5hbWUgcmVsYXRlZE5vZGUgc3JjRWxlbWVudCBhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2hcIi5zcGxpdChcIiBcIiksZml4SG9va3M6e30sa2V5SG9va3M6e3Byb3BzOlwiY2hhciBjaGFyQ29kZSBrZXkga2V5Q29kZVwiLnNwbGl0KFwiIFwiKSxmaWx0ZXI6ZnVuY3Rpb24oYSxiKXthLndoaWNoPT1udWxsJiYoYS53aGljaD1iLmNoYXJDb2RlIT1udWxsP2IuY2hhckNvZGU6Yi5rZXlDb2RlKTtyZXR1cm4gYX19LG1vdXNlSG9va3M6e3Byb3BzOlwiYnV0dG9uIGJ1dHRvbnMgY2xpZW50WCBjbGllbnRZIGZyb21FbGVtZW50IG9mZnNldFggb2Zmc2V0WSBwYWdlWCBwYWdlWSBzY3JlZW5YIHNjcmVlblkgdG9FbGVtZW50XCIuc3BsaXQoXCIgXCIpLGZpbHRlcjpmdW5jdGlvbihhLGQpe3ZhciBlLGYsZyxoPWQuYnV0dG9uLGk9ZC5mcm9tRWxlbWVudDthLnBhZ2VYPT1udWxsJiZkLmNsaWVudFghPW51bGwmJihlPWEudGFyZ2V0Lm93bmVyRG9jdW1lbnR8fGMsZj1lLmRvY3VtZW50RWxlbWVudCxnPWUuYm9keSxhLnBhZ2VYPWQuY2xpZW50WCsoZiYmZi5zY3JvbGxMZWZ0fHxnJiZnLnNjcm9sbExlZnR8fDApLShmJiZmLmNsaWVudExlZnR8fGcmJmcuY2xpZW50TGVmdHx8MCksYS5wYWdlWT1kLmNsaWVudFkrKGYmJmYuc2Nyb2xsVG9wfHxnJiZnLnNjcm9sbFRvcHx8MCktKGYmJmYuY2xpZW50VG9wfHxnJiZnLmNsaWVudFRvcHx8MCkpLCFhLnJlbGF0ZWRUYXJnZXQmJmkmJihhLnJlbGF0ZWRUYXJnZXQ9aT09PWEudGFyZ2V0P2QudG9FbGVtZW50OmkpLCFhLndoaWNoJiZoIT09YiYmKGEud2hpY2g9aCYxPzE6aCYyPzM6aCY0PzI6MCk7cmV0dXJuIGF9fSxmaXg6ZnVuY3Rpb24oYSl7aWYoYVtmLmV4cGFuZG9dKXJldHVybiBhO3ZhciBkLGUsZz1hLGg9Zi5ldmVudC5maXhIb29rc1thLnR5cGVdfHx7fSxpPWgucHJvcHM/dGhpcy5wcm9wcy5jb25jYXQoaC5wcm9wcyk6dGhpcy5wcm9wczthPWYuRXZlbnQoZyk7Zm9yKGQ9aS5sZW5ndGg7ZDspZT1pWy0tZF0sYVtlXT1nW2VdO2EudGFyZ2V0fHwoYS50YXJnZXQ9Zy5zcmNFbGVtZW50fHxjKSxhLnRhcmdldC5ub2RlVHlwZT09PTMmJihhLnRhcmdldD1hLnRhcmdldC5wYXJlbnROb2RlKSxhLm1ldGFLZXk9PT1iJiYoYS5tZXRhS2V5PWEuY3RybEtleSk7cmV0dXJuIGguZmlsdGVyP2guZmlsdGVyKGEsZyk6YX0sc3BlY2lhbDp7cmVhZHk6e3NldHVwOmYuYmluZFJlYWR5fSxsb2FkOntub0J1YmJsZTohMH0sZm9jdXM6e2RlbGVnYXRlVHlwZTpcImZvY3VzaW5cIn0sYmx1cjp7ZGVsZWdhdGVUeXBlOlwiZm9jdXNvdXRcIn0sYmVmb3JldW5sb2FkOntzZXR1cDpmdW5jdGlvbihhLGIsYyl7Zi5pc1dpbmRvdyh0aGlzKSYmKHRoaXMub25iZWZvcmV1bmxvYWQ9Yyl9LHRlYXJkb3duOmZ1bmN0aW9uKGEsYil7dGhpcy5vbmJlZm9yZXVubG9hZD09PWImJih0aGlzLm9uYmVmb3JldW5sb2FkPW51bGwpfX19LHNpbXVsYXRlOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPWYuZXh0ZW5kKG5ldyBmLkV2ZW50LGMse3R5cGU6YSxpc1NpbXVsYXRlZDohMCxvcmlnaW5hbEV2ZW50Ont9fSk7ZD9mLmV2ZW50LnRyaWdnZXIoZSxudWxsLGIpOmYuZXZlbnQuZGlzcGF0Y2guY2FsbChiLGUpLGUuaXNEZWZhdWx0UHJldmVudGVkKCkmJmMucHJldmVudERlZmF1bHQoKX19LGYuZXZlbnQuaGFuZGxlPWYuZXZlbnQuZGlzcGF0Y2gsZi5yZW1vdmVFdmVudD1jLnJlbW92ZUV2ZW50TGlzdGVuZXI/ZnVuY3Rpb24oYSxiLGMpe2EucmVtb3ZlRXZlbnRMaXN0ZW5lciYmYS5yZW1vdmVFdmVudExpc3RlbmVyKGIsYywhMSl9OmZ1bmN0aW9uKGEsYixjKXthLmRldGFjaEV2ZW50JiZhLmRldGFjaEV2ZW50KFwib25cIitiLGMpfSxmLkV2ZW50PWZ1bmN0aW9uKGEsYil7aWYoISh0aGlzIGluc3RhbmNlb2YgZi5FdmVudCkpcmV0dXJuIG5ldyBmLkV2ZW50KGEsYik7YSYmYS50eXBlPyh0aGlzLm9yaWdpbmFsRXZlbnQ9YSx0aGlzLnR5cGU9YS50eXBlLHRoaXMuaXNEZWZhdWx0UHJldmVudGVkPWEuZGVmYXVsdFByZXZlbnRlZHx8YS5yZXR1cm5WYWx1ZT09PSExfHxhLmdldFByZXZlbnREZWZhdWx0JiZhLmdldFByZXZlbnREZWZhdWx0KCk/SzpKKTp0aGlzLnR5cGU9YSxiJiZmLmV4dGVuZCh0aGlzLGIpLHRoaXMudGltZVN0YW1wPWEmJmEudGltZVN0YW1wfHxmLm5vdygpLHRoaXNbZi5leHBhbmRvXT0hMH0sZi5FdmVudC5wcm90b3R5cGU9e3ByZXZlbnREZWZhdWx0OmZ1bmN0aW9uKCl7dGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9Szt2YXIgYT10aGlzLm9yaWdpbmFsRXZlbnQ7IWF8fChhLnByZXZlbnREZWZhdWx0P2EucHJldmVudERlZmF1bHQoKTphLnJldHVyblZhbHVlPSExKX0sc3RvcFByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZD1LO3ZhciBhPXRoaXMub3JpZ2luYWxFdmVudDshYXx8KGEuc3RvcFByb3BhZ2F0aW9uJiZhLnN0b3BQcm9wYWdhdGlvbigpLGEuY2FuY2VsQnViYmxlPSEwKX0sc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZD1LLHRoaXMuc3RvcFByb3BhZ2F0aW9uKCl9LGlzRGVmYXVsdFByZXZlbnRlZDpKLGlzUHJvcGFnYXRpb25TdG9wcGVkOkosaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ6Sn0sZi5lYWNoKHttb3VzZWVudGVyOlwibW91c2VvdmVyXCIsbW91c2VsZWF2ZTpcIm1vdXNlb3V0XCJ9LGZ1bmN0aW9uKGEsYil7Zi5ldmVudC5zcGVjaWFsW2FdPXtkZWxlZ2F0ZVR5cGU6YixiaW5kVHlwZTpiLGhhbmRsZTpmdW5jdGlvbihhKXt2YXIgYz10aGlzLGQ9YS5yZWxhdGVkVGFyZ2V0LGU9YS5oYW5kbGVPYmosZz1lLnNlbGVjdG9yLGg7aWYoIWR8fGQhPT1jJiYhZi5jb250YWlucyhjLGQpKWEudHlwZT1lLm9yaWdUeXBlLGg9ZS5oYW5kbGVyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxhLnR5cGU9YjtyZXR1cm4gaH19fSksZi5zdXBwb3J0LnN1Ym1pdEJ1YmJsZXN8fChmLmV2ZW50LnNwZWNpYWwuc3VibWl0PXtzZXR1cDpmdW5jdGlvbigpe2lmKGYubm9kZU5hbWUodGhpcyxcImZvcm1cIikpcmV0dXJuITE7Zi5ldmVudC5hZGQodGhpcyxcImNsaWNrLl9zdWJtaXQga2V5cHJlc3MuX3N1Ym1pdFwiLGZ1bmN0aW9uKGEpe3ZhciBjPWEudGFyZ2V0LGQ9Zi5ub2RlTmFtZShjLFwiaW5wdXRcIil8fGYubm9kZU5hbWUoYyxcImJ1dHRvblwiKT9jLmZvcm06YjtkJiYhZC5fc3VibWl0X2F0dGFjaGVkJiYoZi5ldmVudC5hZGQoZCxcInN1Ym1pdC5fc3VibWl0XCIsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlJiYhYS5pc1RyaWdnZXImJmYuZXZlbnQuc2ltdWxhdGUoXCJzdWJtaXRcIix0aGlzLnBhcmVudE5vZGUsYSwhMCl9KSxkLl9zdWJtaXRfYXR0YWNoZWQ9ITApfSl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7aWYoZi5ub2RlTmFtZSh0aGlzLFwiZm9ybVwiKSlyZXR1cm4hMTtmLmV2ZW50LnJlbW92ZSh0aGlzLFwiLl9zdWJtaXRcIil9fSksZi5zdXBwb3J0LmNoYW5nZUJ1YmJsZXN8fChmLmV2ZW50LnNwZWNpYWwuY2hhbmdlPXtzZXR1cDpmdW5jdGlvbigpe2lmKHoudGVzdCh0aGlzLm5vZGVOYW1lKSl7aWYodGhpcy50eXBlPT09XCJjaGVja2JveFwifHx0aGlzLnR5cGU9PT1cInJhZGlvXCIpZi5ldmVudC5hZGQodGhpcyxcInByb3BlcnR5Y2hhbmdlLl9jaGFuZ2VcIixmdW5jdGlvbihhKXthLm9yaWdpbmFsRXZlbnQucHJvcGVydHlOYW1lPT09XCJjaGVja2VkXCImJih0aGlzLl9qdXN0X2NoYW5nZWQ9ITApfSksZi5ldmVudC5hZGQodGhpcyxcImNsaWNrLl9jaGFuZ2VcIixmdW5jdGlvbihhKXt0aGlzLl9qdXN0X2NoYW5nZWQmJiFhLmlzVHJpZ2dlciYmKHRoaXMuX2p1c3RfY2hhbmdlZD0hMSxmLmV2ZW50LnNpbXVsYXRlKFwiY2hhbmdlXCIsdGhpcyxhLCEwKSl9KTtyZXR1cm4hMX1mLmV2ZW50LmFkZCh0aGlzLFwiYmVmb3JlYWN0aXZhdGUuX2NoYW5nZVwiLGZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0O3oudGVzdChiLm5vZGVOYW1lKSYmIWIuX2NoYW5nZV9hdHRhY2hlZCYmKGYuZXZlbnQuYWRkKGIsXCJjaGFuZ2UuX2NoYW5nZVwiLGZ1bmN0aW9uKGEpe3RoaXMucGFyZW50Tm9kZSYmIWEuaXNTaW11bGF0ZWQmJiFhLmlzVHJpZ2dlciYmZi5ldmVudC5zaW11bGF0ZShcImNoYW5nZVwiLHRoaXMucGFyZW50Tm9kZSxhLCEwKX0pLGIuX2NoYW5nZV9hdHRhY2hlZD0hMCl9KX0saGFuZGxlOmZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0O2lmKHRoaXMhPT1ifHxhLmlzU2ltdWxhdGVkfHxhLmlzVHJpZ2dlcnx8Yi50eXBlIT09XCJyYWRpb1wiJiZiLnR5cGUhPT1cImNoZWNrYm94XCIpcmV0dXJuIGEuaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpfSx0ZWFyZG93bjpmdW5jdGlvbigpe2YuZXZlbnQucmVtb3ZlKHRoaXMsXCIuX2NoYW5nZVwiKTtyZXR1cm4gei50ZXN0KHRoaXMubm9kZU5hbWUpfX0pLGYuc3VwcG9ydC5mb2N1c2luQnViYmxlc3x8Zi5lYWNoKHtmb2N1czpcImZvY3VzaW5cIixibHVyOlwiZm9jdXNvdXRcIn0sZnVuY3Rpb24oYSxiKXt2YXIgZD0wLGU9ZnVuY3Rpb24oYSl7Zi5ldmVudC5zaW11bGF0ZShiLGEudGFyZ2V0LGYuZXZlbnQuZml4KGEpLCEwKX07Zi5ldmVudC5zcGVjaWFsW2JdPXtzZXR1cDpmdW5jdGlvbigpe2QrKz09PTAmJmMuYWRkRXZlbnRMaXN0ZW5lcihhLGUsITApfSx0ZWFyZG93bjpmdW5jdGlvbigpey0tZD09PTAmJmMucmVtb3ZlRXZlbnRMaXN0ZW5lcihhLGUsITApfX19KSxmLmZuLmV4dGVuZCh7b246ZnVuY3Rpb24oYSxjLGQsZSxnKXt2YXIgaCxpO2lmKHR5cGVvZiBhPT1cIm9iamVjdFwiKXt0eXBlb2YgYyE9XCJzdHJpbmdcIiYmKGQ9YyxjPWIpO2ZvcihpIGluIGEpdGhpcy5vbihpLGMsZCxhW2ldLGcpO3JldHVybiB0aGlzfWQ9PW51bGwmJmU9PW51bGw/KGU9YyxkPWM9Yik6ZT09bnVsbCYmKHR5cGVvZiBjPT1cInN0cmluZ1wiPyhlPWQsZD1iKTooZT1kLGQ9YyxjPWIpKTtpZihlPT09ITEpZT1KO2Vsc2UgaWYoIWUpcmV0dXJuIHRoaXM7Zz09PTEmJihoPWUsZT1mdW5jdGlvbihhKXtmKCkub2ZmKGEpO3JldHVybiBoLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sZS5ndWlkPWguZ3VpZHx8KGguZ3VpZD1mLmd1aWQrKykpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmV2ZW50LmFkZCh0aGlzLGEsZSxkLGMpfSl9LG9uZTpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5vbi5jYWxsKHRoaXMsYSxiLGMsZCwxKX0sb2ZmOmZ1bmN0aW9uKGEsYyxkKXtpZihhJiZhLnByZXZlbnREZWZhdWx0JiZhLmhhbmRsZU9iail7dmFyIGU9YS5oYW5kbGVPYmo7ZihhLmRlbGVnYXRlVGFyZ2V0KS5vZmYoZS5uYW1lc3BhY2U/ZS50eXBlK1wiLlwiK2UubmFtZXNwYWNlOmUudHlwZSxlLnNlbGVjdG9yLGUuaGFuZGxlcik7cmV0dXJuIHRoaXN9aWYodHlwZW9mIGE9PVwib2JqZWN0XCIpe2Zvcih2YXIgZyBpbiBhKXRoaXMub2ZmKGcsYyxhW2ddKTtyZXR1cm4gdGhpc31pZihjPT09ITF8fHR5cGVvZiBjPT1cImZ1bmN0aW9uXCIpZD1jLGM9YjtkPT09ITEmJihkPUopO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmV2ZW50LnJlbW92ZSh0aGlzLGEsZCxjKX0pfSxiaW5kOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gdGhpcy5vbihhLG51bGwsYixjKX0sdW5iaW5kOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMub2ZmKGEsbnVsbCxiKX0sbGl2ZTpmdW5jdGlvbihhLGIsYyl7Zih0aGlzLmNvbnRleHQpLm9uKGEsdGhpcy5zZWxlY3RvcixiLGMpO3JldHVybiB0aGlzfSxkaWU6ZnVuY3Rpb24oYSxiKXtmKHRoaXMuY29udGV4dCkub2ZmKGEsdGhpcy5zZWxlY3Rvcnx8XCIqKlwiLGIpO3JldHVybiB0aGlzfSxkZWxlZ2F0ZTpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5vbihiLGEsYyxkKX0sdW5kZWxlZ2F0ZTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg9PTE/dGhpcy5vZmYoYSxcIioqXCIpOnRoaXMub2ZmKGIsYSxjKX0sdHJpZ2dlcjpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmV2ZW50LnRyaWdnZXIoYSxiLHRoaXMpfSl9LHRyaWdnZXJIYW5kbGVyOmZ1bmN0aW9uKGEsYil7aWYodGhpc1swXSlyZXR1cm4gZi5ldmVudC50cmlnZ2VyKGEsYix0aGlzWzBdLCEwKX0sdG9nZ2xlOmZ1bmN0aW9uKGEpe3ZhciBiPWFyZ3VtZW50cyxjPWEuZ3VpZHx8Zi5ndWlkKyssZD0wLGU9ZnVuY3Rpb24oYyl7dmFyIGU9KGYuX2RhdGEodGhpcyxcImxhc3RUb2dnbGVcIithLmd1aWQpfHwwKSVkO2YuX2RhdGEodGhpcyxcImxhc3RUb2dnbGVcIithLmd1aWQsZSsxKSxjLnByZXZlbnREZWZhdWx0KCk7cmV0dXJuIGJbZV0uYXBwbHkodGhpcyxhcmd1bWVudHMpfHwhMX07ZS5ndWlkPWM7d2hpbGUoZDxiLmxlbmd0aCliW2QrK10uZ3VpZD1jO3JldHVybiB0aGlzLmNsaWNrKGUpfSxob3ZlcjpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLm1vdXNlZW50ZXIoYSkubW91c2VsZWF2ZShifHxhKX19KSxmLmVhY2goXCJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgbG9hZCByZXNpemUgc2Nyb2xsIHVubG9hZCBjbGljayBkYmxjbGljayBtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZSBjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGVycm9yIGNvbnRleHRtZW51XCIuc3BsaXQoXCIgXCIpLGZ1bmN0aW9uKGEsYil7Zi5mbltiXT1mdW5jdGlvbihhLGMpe2M9PW51bGwmJihjPWEsYT1udWxsKTtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD4wP3RoaXMub24oYixudWxsLGEsYyk6dGhpcy50cmlnZ2VyKGIpfSxmLmF0dHJGbiYmKGYuYXR0ckZuW2JdPSEwKSxDLnRlc3QoYikmJihmLmV2ZW50LmZpeEhvb2tzW2JdPWYuZXZlbnQua2V5SG9va3MpLEQudGVzdChiKSYmKGYuZXZlbnQuZml4SG9va3NbYl09Zi5ldmVudC5tb3VzZUhvb2tzKX0pLGZ1bmN0aW9uKCl7ZnVuY3Rpb24geChhLGIsYyxlLGYsZyl7Zm9yKHZhciBoPTAsaT1lLmxlbmd0aDtoPGk7aCsrKXt2YXIgaj1lW2hdO2lmKGope3ZhciBrPSExO2o9althXTt3aGlsZShqKXtpZihqW2RdPT09Yyl7az1lW2ouc2l6c2V0XTticmVha31pZihqLm5vZGVUeXBlPT09MSl7Z3x8KGpbZF09YyxqLnNpenNldD1oKTtpZih0eXBlb2YgYiE9XCJzdHJpbmdcIil7aWYoaj09PWIpe2s9ITA7YnJlYWt9fWVsc2UgaWYobS5maWx0ZXIoYixbal0pLmxlbmd0aD4wKXtrPWo7YnJlYWt9fWo9althXX1lW2hdPWt9fX1mdW5jdGlvbiB3KGEsYixjLGUsZixnKXtmb3IodmFyIGg9MCxpPWUubGVuZ3RoO2g8aTtoKyspe3ZhciBqPWVbaF07aWYoail7dmFyIGs9ITE7aj1qW2FdO3doaWxlKGope2lmKGpbZF09PT1jKXtrPWVbai5zaXpzZXRdO2JyZWFrfWoubm9kZVR5cGU9PT0xJiYhZyYmKGpbZF09YyxqLnNpenNldD1oKTtpZihqLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iKXtrPWo7YnJlYWt9aj1qW2FdfWVbaF09a319fXZhciBhPS8oKD86XFwoKD86XFwoW14oKV0rXFwpfFteKCldKykrXFwpfFxcWyg/OlxcW1teXFxbXFxdXSpcXF18WydcIl1bXidcIl0qWydcIl18W15cXFtcXF0nXCJdKykrXFxdfFxcXFwufFteID4rfiwoXFxbXFxcXF0rKSt8Wz4rfl0pKFxccyosXFxzKik/KCg/Oi58XFxyfFxcbikqKS9nLGQ9XCJzaXpjYWNoZVwiKyhNYXRoLnJhbmRvbSgpK1wiXCIpLnJlcGxhY2UoXCIuXCIsXCJcIiksZT0wLGc9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyxoPSExLGk9ITAsaj0vXFxcXC9nLGs9L1xcclxcbi9nLGw9L1xcVy87WzAsMF0uc29ydChmdW5jdGlvbigpe2k9ITE7cmV0dXJuIDB9KTt2YXIgbT1mdW5jdGlvbihiLGQsZSxmKXtlPWV8fFtdLGQ9ZHx8Yzt2YXIgaD1kO2lmKGQubm9kZVR5cGUhPT0xJiZkLm5vZGVUeXBlIT09OSlyZXR1cm5bXTtpZighYnx8dHlwZW9mIGIhPVwic3RyaW5nXCIpcmV0dXJuIGU7dmFyIGksaixrLGwsbixxLHIsdCx1PSEwLHY9bS5pc1hNTChkKSx3PVtdLHg9Yjtkb3thLmV4ZWMoXCJcIiksaT1hLmV4ZWMoeCk7aWYoaSl7eD1pWzNdLHcucHVzaChpWzFdKTtpZihpWzJdKXtsPWlbM107YnJlYWt9fX13aGlsZShpKTtpZih3Lmxlbmd0aD4xJiZwLmV4ZWMoYikpaWYody5sZW5ndGg9PT0yJiZvLnJlbGF0aXZlW3dbMF1dKWo9eSh3WzBdK3dbMV0sZCxmKTtlbHNle2o9by5yZWxhdGl2ZVt3WzBdXT9bZF06bSh3LnNoaWZ0KCksZCk7d2hpbGUody5sZW5ndGgpYj13LnNoaWZ0KCksby5yZWxhdGl2ZVtiXSYmKGIrPXcuc2hpZnQoKSksaj15KGIsaixmKX1lbHNleyFmJiZ3Lmxlbmd0aD4xJiZkLm5vZGVUeXBlPT09OSYmIXYmJm8ubWF0Y2guSUQudGVzdCh3WzBdKSYmIW8ubWF0Y2guSUQudGVzdCh3W3cubGVuZ3RoLTFdKSYmKG49bS5maW5kKHcuc2hpZnQoKSxkLHYpLGQ9bi5leHByP20uZmlsdGVyKG4uZXhwcixuLnNldClbMF06bi5zZXRbMF0pO2lmKGQpe249Zj97ZXhwcjp3LnBvcCgpLHNldDpzKGYpfTptLmZpbmQody5wb3AoKSx3Lmxlbmd0aD09PTEmJih3WzBdPT09XCJ+XCJ8fHdbMF09PT1cIitcIikmJmQucGFyZW50Tm9kZT9kLnBhcmVudE5vZGU6ZCx2KSxqPW4uZXhwcj9tLmZpbHRlcihuLmV4cHIsbi5zZXQpOm4uc2V0LHcubGVuZ3RoPjA/az1zKGopOnU9ITE7d2hpbGUody5sZW5ndGgpcT13LnBvcCgpLHI9cSxvLnJlbGF0aXZlW3FdP3I9dy5wb3AoKTpxPVwiXCIscj09bnVsbCYmKHI9ZCksby5yZWxhdGl2ZVtxXShrLHIsdil9ZWxzZSBrPXc9W119a3x8KGs9aiksa3x8bS5lcnJvcihxfHxiKTtpZihnLmNhbGwoayk9PT1cIltvYmplY3QgQXJyYXldXCIpaWYoIXUpZS5wdXNoLmFwcGx5KGUsayk7ZWxzZSBpZihkJiZkLm5vZGVUeXBlPT09MSlmb3IodD0wO2tbdF0hPW51bGw7dCsrKWtbdF0mJihrW3RdPT09ITB8fGtbdF0ubm9kZVR5cGU9PT0xJiZtLmNvbnRhaW5zKGQsa1t0XSkpJiZlLnB1c2goalt0XSk7ZWxzZSBmb3IodD0wO2tbdF0hPW51bGw7dCsrKWtbdF0mJmtbdF0ubm9kZVR5cGU9PT0xJiZlLnB1c2goalt0XSk7ZWxzZSBzKGssZSk7bCYmKG0obCxoLGUsZiksbS51bmlxdWVTb3J0KGUpKTtyZXR1cm4gZX07bS51bmlxdWVTb3J0PWZ1bmN0aW9uKGEpe2lmKHUpe2g9aSxhLnNvcnQodSk7aWYoaClmb3IodmFyIGI9MTtiPGEubGVuZ3RoO2IrKylhW2JdPT09YVtiLTFdJiZhLnNwbGljZShiLS0sMSl9cmV0dXJuIGF9LG0ubWF0Y2hlcz1mdW5jdGlvbihhLGIpe3JldHVybiBtKGEsbnVsbCxudWxsLGIpfSxtLm1hdGNoZXNTZWxlY3Rvcj1mdW5jdGlvbihhLGIpe3JldHVybiBtKGIsbnVsbCxudWxsLFthXSkubGVuZ3RoPjB9LG0uZmluZD1mdW5jdGlvbihhLGIsYyl7dmFyIGQsZSxmLGcsaCxpO2lmKCFhKXJldHVybltdO2ZvcihlPTAsZj1vLm9yZGVyLmxlbmd0aDtlPGY7ZSsrKXtoPW8ub3JkZXJbZV07aWYoZz1vLmxlZnRNYXRjaFtoXS5leGVjKGEpKXtpPWdbMV0sZy5zcGxpY2UoMSwxKTtpZihpLnN1YnN0cihpLmxlbmd0aC0xKSE9PVwiXFxcXFwiKXtnWzFdPShnWzFdfHxcIlwiKS5yZXBsYWNlKGosXCJcIiksZD1vLmZpbmRbaF0oZyxiLGMpO2lmKGQhPW51bGwpe2E9YS5yZXBsYWNlKG8ubWF0Y2hbaF0sXCJcIik7YnJlYWt9fX19ZHx8KGQ9dHlwZW9mIGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPVwidW5kZWZpbmVkXCI/Yi5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIik6W10pO3JldHVybntzZXQ6ZCxleHByOmF9fSxtLmZpbHRlcj1mdW5jdGlvbihhLGMsZCxlKXt2YXIgZixnLGgsaSxqLGssbCxuLHAscT1hLHI9W10scz1jLHQ9YyYmY1swXSYmbS5pc1hNTChjWzBdKTt3aGlsZShhJiZjLmxlbmd0aCl7Zm9yKGggaW4gby5maWx0ZXIpaWYoKGY9by5sZWZ0TWF0Y2hbaF0uZXhlYyhhKSkhPW51bGwmJmZbMl0pe2s9by5maWx0ZXJbaF0sbD1mWzFdLGc9ITEsZi5zcGxpY2UoMSwxKTtpZihsLnN1YnN0cihsLmxlbmd0aC0xKT09PVwiXFxcXFwiKWNvbnRpbnVlO3M9PT1yJiYocj1bXSk7aWYoby5wcmVGaWx0ZXJbaF0pe2Y9by5wcmVGaWx0ZXJbaF0oZixzLGQscixlLHQpO2lmKCFmKWc9aT0hMDtlbHNlIGlmKGY9PT0hMCljb250aW51ZX1pZihmKWZvcihuPTA7KGo9c1tuXSkhPW51bGw7bisrKWomJihpPWsoaixmLG4scykscD1lXmksZCYmaSE9bnVsbD9wP2c9ITA6c1tuXT0hMTpwJiYoci5wdXNoKGopLGc9ITApKTtpZihpIT09Yil7ZHx8KHM9ciksYT1hLnJlcGxhY2Uoby5tYXRjaFtoXSxcIlwiKTtpZighZylyZXR1cm5bXTticmVha319aWYoYT09PXEpaWYoZz09bnVsbCltLmVycm9yKGEpO2Vsc2UgYnJlYWs7cT1hfXJldHVybiBzfSxtLmVycm9yPWZ1bmN0aW9uKGEpe3Rocm93IG5ldyBFcnJvcihcIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246IFwiK2EpfTt2YXIgbj1tLmdldFRleHQ9ZnVuY3Rpb24oYSl7dmFyIGIsYyxkPWEubm9kZVR5cGUsZT1cIlwiO2lmKGQpe2lmKGQ9PT0xfHxkPT09OSl7aWYodHlwZW9mIGEudGV4dENvbnRlbnQ9PVwic3RyaW5nXCIpcmV0dXJuIGEudGV4dENvbnRlbnQ7aWYodHlwZW9mIGEuaW5uZXJUZXh0PT1cInN0cmluZ1wiKXJldHVybiBhLmlubmVyVGV4dC5yZXBsYWNlKGssXCJcIik7Zm9yKGE9YS5maXJzdENoaWxkO2E7YT1hLm5leHRTaWJsaW5nKWUrPW4oYSl9ZWxzZSBpZihkPT09M3x8ZD09PTQpcmV0dXJuIGEubm9kZVZhbHVlfWVsc2UgZm9yKGI9MDtjPWFbYl07YisrKWMubm9kZVR5cGUhPT04JiYoZSs9bihjKSk7cmV0dXJuIGV9LG89bS5zZWxlY3RvcnM9e29yZGVyOltcIklEXCIsXCJOQU1FXCIsXCJUQUdcIl0sbWF0Y2g6e0lEOi8jKCg/OltcXHdcXHUwMGMwLVxcdUZGRkZcXC1dfFxcXFwuKSspLyxDTEFTUzovXFwuKCg/OltcXHdcXHUwMGMwLVxcdUZGRkZcXC1dfFxcXFwuKSspLyxOQU1FOi9cXFtuYW1lPVsnXCJdKigoPzpbXFx3XFx1MDBjMC1cXHVGRkZGXFwtXXxcXFxcLikrKVsnXCJdKlxcXS8sQVRUUjovXFxbXFxzKigoPzpbXFx3XFx1MDBjMC1cXHVGRkZGXFwtXXxcXFxcLikrKVxccyooPzooXFxTPz0pXFxzKig/OihbJ1wiXSkoLio/KVxcM3woIz8oPzpbXFx3XFx1MDBjMC1cXHVGRkZGXFwtXXxcXFxcLikqKXwpfClcXHMqXFxdLyxUQUc6L14oKD86W1xcd1xcdTAwYzAtXFx1RkZGRlxcKlxcLV18XFxcXC4pKykvLENISUxEOi86KG9ubHl8bnRofGxhc3R8Zmlyc3QpLWNoaWxkKD86XFwoXFxzKihldmVufG9kZHwoPzpbK1xcLV0/XFxkK3woPzpbK1xcLV0/XFxkKik/blxccyooPzpbK1xcLV1cXHMqXFxkKyk/KSlcXHMqXFwpKT8vLFBPUzovOihudGh8ZXF8Z3R8bHR8Zmlyc3R8bGFzdHxldmVufG9kZCkoPzpcXCgoXFxkKilcXCkpPyg/PVteXFwtXXwkKS8sUFNFVURPOi86KCg/OltcXHdcXHUwMGMwLVxcdUZGRkZcXC1dfFxcXFwuKSspKD86XFwoKFsnXCJdPykoKD86XFwoW15cXCldK1xcKXxbXlxcKFxcKV0qKSspXFwyXFwpKT8vfSxsZWZ0TWF0Y2g6e30sYXR0ck1hcDp7XCJjbGFzc1wiOlwiY2xhc3NOYW1lXCIsXCJmb3JcIjpcImh0bWxGb3JcIn0sYXR0ckhhbmRsZTp7aHJlZjpmdW5jdGlvbihhKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpfSx0eXBlOmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZShcInR5cGVcIil9fSxyZWxhdGl2ZTp7XCIrXCI6ZnVuY3Rpb24oYSxiKXt2YXIgYz10eXBlb2YgYj09XCJzdHJpbmdcIixkPWMmJiFsLnRlc3QoYiksZT1jJiYhZDtkJiYoYj1iLnRvTG93ZXJDYXNlKCkpO2Zvcih2YXIgZj0wLGc9YS5sZW5ndGgsaDtmPGc7ZisrKWlmKGg9YVtmXSl7d2hpbGUoKGg9aC5wcmV2aW91c1NpYmxpbmcpJiZoLm5vZGVUeXBlIT09MSk7YVtmXT1lfHxoJiZoLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iP2h8fCExOmg9PT1ifWUmJm0uZmlsdGVyKGIsYSwhMCl9LFwiPlwiOmZ1bmN0aW9uKGEsYil7dmFyIGMsZD10eXBlb2YgYj09XCJzdHJpbmdcIixlPTAsZj1hLmxlbmd0aDtpZihkJiYhbC50ZXN0KGIpKXtiPWIudG9Mb3dlckNhc2UoKTtmb3IoO2U8ZjtlKyspe2M9YVtlXTtpZihjKXt2YXIgZz1jLnBhcmVudE5vZGU7YVtlXT1nLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iP2c6ITF9fX1lbHNle2Zvcig7ZTxmO2UrKyljPWFbZV0sYyYmKGFbZV09ZD9jLnBhcmVudE5vZGU6Yy5wYXJlbnROb2RlPT09Yik7ZCYmbS5maWx0ZXIoYixhLCEwKX19LFwiXCI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGY9ZSsrLGc9eDt0eXBlb2YgYj09XCJzdHJpbmdcIiYmIWwudGVzdChiKSYmKGI9Yi50b0xvd2VyQ2FzZSgpLGQ9YixnPXcpLGcoXCJwYXJlbnROb2RlXCIsYixmLGEsZCxjKX0sXCJ+XCI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGY9ZSsrLGc9eDt0eXBlb2YgYj09XCJzdHJpbmdcIiYmIWwudGVzdChiKSYmKGI9Yi50b0xvd2VyQ2FzZSgpLGQ9YixnPXcpLGcoXCJwcmV2aW91c1NpYmxpbmdcIixiLGYsYSxkLGMpfX0sZmluZDp7SUQ6ZnVuY3Rpb24oYSxiLGMpe2lmKHR5cGVvZiBiLmdldEVsZW1lbnRCeUlkIT1cInVuZGVmaW5lZFwiJiYhYyl7dmFyIGQ9Yi5nZXRFbGVtZW50QnlJZChhWzFdKTtyZXR1cm4gZCYmZC5wYXJlbnROb2RlP1tkXTpbXX19LE5BTUU6ZnVuY3Rpb24oYSxiKXtpZih0eXBlb2YgYi5nZXRFbGVtZW50c0J5TmFtZSE9XCJ1bmRlZmluZWRcIil7dmFyIGM9W10sZD1iLmdldEVsZW1lbnRzQnlOYW1lKGFbMV0pO2Zvcih2YXIgZT0wLGY9ZC5sZW5ndGg7ZTxmO2UrKylkW2VdLmdldEF0dHJpYnV0ZShcIm5hbWVcIik9PT1hWzFdJiZjLnB1c2goZFtlXSk7cmV0dXJuIGMubGVuZ3RoPT09MD9udWxsOmN9fSxUQUc6ZnVuY3Rpb24oYSxiKXtpZih0eXBlb2YgYi5nZXRFbGVtZW50c0J5VGFnTmFtZSE9XCJ1bmRlZmluZWRcIilyZXR1cm4gYi5nZXRFbGVtZW50c0J5VGFnTmFtZShhWzFdKX19LHByZUZpbHRlcjp7Q0xBU1M6ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe2E9XCIgXCIrYVsxXS5yZXBsYWNlKGosXCJcIikrXCIgXCI7aWYoZilyZXR1cm4gYTtmb3IodmFyIGc9MCxoOyhoPWJbZ10pIT1udWxsO2crKyloJiYoZV4oaC5jbGFzc05hbWUmJihcIiBcIitoLmNsYXNzTmFtZStcIiBcIikucmVwbGFjZSgvW1xcdFxcblxccl0vZyxcIiBcIikuaW5kZXhPZihhKT49MCk/Y3x8ZC5wdXNoKGgpOmMmJihiW2ddPSExKSk7cmV0dXJuITF9LElEOmZ1bmN0aW9uKGEpe3JldHVybiBhWzFdLnJlcGxhY2UoaixcIlwiKX0sVEFHOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGFbMV0ucmVwbGFjZShqLFwiXCIpLnRvTG93ZXJDYXNlKCl9LENISUxEOmZ1bmN0aW9uKGEpe2lmKGFbMV09PT1cIm50aFwiKXthWzJdfHxtLmVycm9yKGFbMF0pLGFbMl09YVsyXS5yZXBsYWNlKC9eXFwrfFxccyovZyxcIlwiKTt2YXIgYj0vKC0/KShcXGQqKSg/Om4oWytcXC1dP1xcZCopKT8vLmV4ZWMoYVsyXT09PVwiZXZlblwiJiZcIjJuXCJ8fGFbMl09PT1cIm9kZFwiJiZcIjJuKzFcInx8IS9cXEQvLnRlc3QoYVsyXSkmJlwiMG4rXCIrYVsyXXx8YVsyXSk7YVsyXT1iWzFdKyhiWzJdfHwxKS0wLGFbM109YlszXS0wfWVsc2UgYVsyXSYmbS5lcnJvcihhWzBdKTthWzBdPWUrKztyZXR1cm4gYX0sQVRUUjpmdW5jdGlvbihhLGIsYyxkLGUsZil7dmFyIGc9YVsxXT1hWzFdLnJlcGxhY2UoaixcIlwiKTshZiYmby5hdHRyTWFwW2ddJiYoYVsxXT1vLmF0dHJNYXBbZ10pLGFbNF09KGFbNF18fGFbNV18fFwiXCIpLnJlcGxhY2UoaixcIlwiKSxhWzJdPT09XCJ+PVwiJiYoYVs0XT1cIiBcIithWzRdK1wiIFwiKTtyZXR1cm4gYX0sUFNFVURPOmZ1bmN0aW9uKGIsYyxkLGUsZil7aWYoYlsxXT09PVwibm90XCIpaWYoKGEuZXhlYyhiWzNdKXx8XCJcIikubGVuZ3RoPjF8fC9eXFx3Ly50ZXN0KGJbM10pKWJbM109bShiWzNdLG51bGwsbnVsbCxjKTtlbHNle3ZhciBnPW0uZmlsdGVyKGJbM10sYyxkLCEwXmYpO2R8fGUucHVzaC5hcHBseShlLGcpO3JldHVybiExfWVsc2UgaWYoby5tYXRjaC5QT1MudGVzdChiWzBdKXx8by5tYXRjaC5DSElMRC50ZXN0KGJbMF0pKXJldHVybiEwO3JldHVybiBifSxQT1M6ZnVuY3Rpb24oYSl7YS51bnNoaWZ0KCEwKTtyZXR1cm4gYX19LGZpbHRlcnM6e2VuYWJsZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZGlzYWJsZWQ9PT0hMSYmYS50eXBlIT09XCJoaWRkZW5cIn0sZGlzYWJsZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZGlzYWJsZWQ9PT0hMH0sY2hlY2tlZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5jaGVja2VkPT09ITB9LHNlbGVjdGVkOmZ1bmN0aW9uKGEpe2EucGFyZW50Tm9kZSYmYS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7cmV0dXJuIGEuc2VsZWN0ZWQ9PT0hMH0scGFyZW50OmZ1bmN0aW9uKGEpe3JldHVybiEhYS5maXJzdENoaWxkfSxlbXB0eTpmdW5jdGlvbihhKXtyZXR1cm4hYS5maXJzdENoaWxkfSxoYXM6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiEhbShjWzNdLGEpLmxlbmd0aH0saGVhZGVyOmZ1bmN0aW9uKGEpe3JldHVybi9oXFxkL2kudGVzdChhLm5vZGVOYW1lKX0sdGV4dDpmdW5jdGlvbihhKXt2YXIgYj1hLmdldEF0dHJpYnV0ZShcInR5cGVcIiksYz1hLnR5cGU7cmV0dXJuIGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PVwiaW5wdXRcIiYmXCJ0ZXh0XCI9PT1jJiYoYj09PWN8fGI9PT1udWxsKX0scmFkaW86ZnVuY3Rpb24oYSl7cmV0dXJuIGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PVwiaW5wdXRcIiYmXCJyYWRpb1wiPT09YS50eXBlfSxjaGVja2JveDpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09XCJpbnB1dFwiJiZcImNoZWNrYm94XCI9PT1hLnR5cGV9LGZpbGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PVwiaW5wdXRcIiYmXCJmaWxlXCI9PT1hLnR5cGV9LHBhc3N3b3JkOmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1cImlucHV0XCImJlwicGFzc3dvcmRcIj09PWEudHlwZX0sc3VibWl0OmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4oYj09PVwiaW5wdXRcInx8Yj09PVwiYnV0dG9uXCIpJiZcInN1Ym1pdFwiPT09YS50eXBlfSxpbWFnZTpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09XCJpbnB1dFwiJiZcImltYWdlXCI9PT1hLnR5cGV9LHJlc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4oYj09PVwiaW5wdXRcInx8Yj09PVwiYnV0dG9uXCIpJiZcInJlc2V0XCI9PT1hLnR5cGV9LGJ1dHRvbjpmdW5jdGlvbihhKXt2YXIgYj1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuIGI9PT1cImlucHV0XCImJlwiYnV0dG9uXCI9PT1hLnR5cGV8fGI9PT1cImJ1dHRvblwifSxpbnB1dDpmdW5jdGlvbihhKXtyZXR1cm4vaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbi9pLnRlc3QoYS5ub2RlTmFtZSl9LGZvY3VzOmZ1bmN0aW9uKGEpe3JldHVybiBhPT09YS5vd25lckRvY3VtZW50LmFjdGl2ZUVsZW1lbnR9fSxzZXRGaWx0ZXJzOntmaXJzdDpmdW5jdGlvbihhLGIpe3JldHVybiBiPT09MH0sbGFzdDpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gYj09PWQubGVuZ3RoLTF9LGV2ZW46ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYiUyPT09MH0sb2RkOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGIlMj09PTF9LGx0OmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gYjxjWzNdLTB9LGd0OmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gYj5jWzNdLTB9LG50aDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGNbM10tMD09PWJ9LGVxOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gY1szXS0wPT09Yn19LGZpbHRlcjp7UFNFVURPOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPWJbMV0sZj1vLmZpbHRlcnNbZV07aWYoZilyZXR1cm4gZihhLGMsYixkKTtpZihlPT09XCJjb250YWluc1wiKXJldHVybihhLnRleHRDb250ZW50fHxhLmlubmVyVGV4dHx8bihbYV0pfHxcIlwiKS5pbmRleE9mKGJbM10pPj0wO2lmKGU9PT1cIm5vdFwiKXt2YXIgZz1iWzNdO2Zvcih2YXIgaD0wLGk9Zy5sZW5ndGg7aDxpO2grKylpZihnW2hdPT09YSlyZXR1cm4hMTtyZXR1cm4hMH1tLmVycm9yKGUpfSxDSElMRDpmdW5jdGlvbihhLGIpe3ZhciBjLGUsZixnLGgsaSxqLGs9YlsxXSxsPWE7c3dpdGNoKGspe2Nhc2VcIm9ubHlcIjpjYXNlXCJmaXJzdFwiOndoaWxlKGw9bC5wcmV2aW91c1NpYmxpbmcpaWYobC5ub2RlVHlwZT09PTEpcmV0dXJuITE7aWYoaz09PVwiZmlyc3RcIilyZXR1cm4hMDtsPWE7Y2FzZVwibGFzdFwiOndoaWxlKGw9bC5uZXh0U2libGluZylpZihsLm5vZGVUeXBlPT09MSlyZXR1cm4hMTtyZXR1cm4hMDtjYXNlXCJudGhcIjpjPWJbMl0sZT1iWzNdO2lmKGM9PT0xJiZlPT09MClyZXR1cm4hMDtmPWJbMF0sZz1hLnBhcmVudE5vZGU7aWYoZyYmKGdbZF0hPT1mfHwhYS5ub2RlSW5kZXgpKXtpPTA7Zm9yKGw9Zy5maXJzdENoaWxkO2w7bD1sLm5leHRTaWJsaW5nKWwubm9kZVR5cGU9PT0xJiYobC5ub2RlSW5kZXg9KytpKTtnW2RdPWZ9aj1hLm5vZGVJbmRleC1lO3JldHVybiBjPT09MD9qPT09MDpqJWM9PT0wJiZqL2M+PTB9fSxJRDpmdW5jdGlvbihhLGIpe3JldHVybiBhLm5vZGVUeXBlPT09MSYmYS5nZXRBdHRyaWJ1dGUoXCJpZFwiKT09PWJ9LFRBRzpmdW5jdGlvbihhLGIpe3JldHVybiBiPT09XCIqXCImJmEubm9kZVR5cGU9PT0xfHwhIWEubm9kZU5hbWUmJmEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWJ9LENMQVNTOmZ1bmN0aW9uKGEsYil7cmV0dXJuKFwiIFwiKyhhLmNsYXNzTmFtZXx8YS5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKSkrXCIgXCIpLmluZGV4T2YoYik+LTF9LEFUVFI6ZnVuY3Rpb24oYSxiKXt2YXIgYz1iWzFdLGQ9bS5hdHRyP20uYXR0cihhLGMpOm8uYXR0ckhhbmRsZVtjXT9vLmF0dHJIYW5kbGVbY10oYSk6YVtjXSE9bnVsbD9hW2NdOmEuZ2V0QXR0cmlidXRlKGMpLGU9ZCtcIlwiLGY9YlsyXSxnPWJbNF07cmV0dXJuIGQ9PW51bGw/Zj09PVwiIT1cIjohZiYmbS5hdHRyP2QhPW51bGw6Zj09PVwiPVwiP2U9PT1nOmY9PT1cIio9XCI/ZS5pbmRleE9mKGcpPj0wOmY9PT1cIn49XCI/KFwiIFwiK2UrXCIgXCIpLmluZGV4T2YoZyk+PTA6Zz9mPT09XCIhPVwiP2UhPT1nOmY9PT1cIl49XCI/ZS5pbmRleE9mKGcpPT09MDpmPT09XCIkPVwiP2Uuc3Vic3RyKGUubGVuZ3RoLWcubGVuZ3RoKT09PWc6Zj09PVwifD1cIj9lPT09Z3x8ZS5zdWJzdHIoMCxnLmxlbmd0aCsxKT09PWcrXCItXCI6ITE6ZSYmZCE9PSExfSxQT1M6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9YlsyXSxmPW8uc2V0RmlsdGVyc1tlXTtpZihmKXJldHVybiBmKGEsYyxiLGQpfX19LHA9by5tYXRjaC5QT1MscT1mdW5jdGlvbihhLGIpe3JldHVyblwiXFxcXFwiKyhiLTArMSl9O2Zvcih2YXIgciBpbiBvLm1hdGNoKW8ubWF0Y2hbcl09bmV3IFJlZ0V4cChvLm1hdGNoW3JdLnNvdXJjZSsvKD8hW15cXFtdKlxcXSkoPyFbXlxcKF0qXFwpKS8uc291cmNlKSxvLmxlZnRNYXRjaFtyXT1uZXcgUmVnRXhwKC8oXig/Oi58XFxyfFxcbikqPykvLnNvdXJjZStvLm1hdGNoW3JdLnNvdXJjZS5yZXBsYWNlKC9cXFxcKFxcZCspL2cscSkpO3ZhciBzPWZ1bmN0aW9uKGEsYil7YT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhLDApO2lmKGIpe2IucHVzaC5hcHBseShiLGEpO3JldHVybiBifXJldHVybiBhfTt0cnl7QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYy5kb2N1bWVudEVsZW1lbnQuY2hpbGROb2RlcywwKVswXS5ub2RlVHlwZX1jYXRjaCh0KXtzPWZ1bmN0aW9uKGEsYil7dmFyIGM9MCxkPWJ8fFtdO2lmKGcuY2FsbChhKT09PVwiW29iamVjdCBBcnJheV1cIilBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShkLGEpO2Vsc2UgaWYodHlwZW9mIGEubGVuZ3RoPT1cIm51bWJlclwiKWZvcih2YXIgZT1hLmxlbmd0aDtjPGU7YysrKWQucHVzaChhW2NdKTtlbHNlIGZvcig7YVtjXTtjKyspZC5wdXNoKGFbY10pO3JldHVybiBkfX12YXIgdSx2O2MuZG9jdW1lbnRFbGVtZW50LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uP3U9ZnVuY3Rpb24oYSxiKXtpZihhPT09Yil7aD0hMDtyZXR1cm4gMH1pZighYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbnx8IWIuY29tcGFyZURvY3VtZW50UG9zaXRpb24pcmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24/LTE6MTtyZXR1cm4gYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSY0Py0xOjF9Oih1PWZ1bmN0aW9uKGEsYil7aWYoYT09PWIpe2g9ITA7cmV0dXJuIDB9aWYoYS5zb3VyY2VJbmRleCYmYi5zb3VyY2VJbmRleClyZXR1cm4gYS5zb3VyY2VJbmRleC1iLnNvdXJjZUluZGV4O3ZhciBjLGQsZT1bXSxmPVtdLGc9YS5wYXJlbnROb2RlLGk9Yi5wYXJlbnROb2RlLGo9ZztpZihnPT09aSlyZXR1cm4gdihhLGIpO2lmKCFnKXJldHVybi0xO2lmKCFpKXJldHVybiAxO3doaWxlKGopZS51bnNoaWZ0KGopLGo9ai5wYXJlbnROb2RlO2o9aTt3aGlsZShqKWYudW5zaGlmdChqKSxqPWoucGFyZW50Tm9kZTtjPWUubGVuZ3RoLGQ9Zi5sZW5ndGg7Zm9yKHZhciBrPTA7azxjJiZrPGQ7aysrKWlmKGVba10hPT1mW2tdKXJldHVybiB2KGVba10sZltrXSk7cmV0dXJuIGs9PT1jP3YoYSxmW2tdLC0xKTp2KGVba10sYiwxKX0sdj1mdW5jdGlvbihhLGIsYyl7aWYoYT09PWIpcmV0dXJuIGM7dmFyIGQ9YS5uZXh0U2libGluZzt3aGlsZShkKXtpZihkPT09YilyZXR1cm4tMTtkPWQubmV4dFNpYmxpbmd9cmV0dXJuIDF9KSxmdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudChcImRpdlwiKSxkPVwic2NyaXB0XCIrKG5ldyBEYXRlKS5nZXRUaW1lKCksZT1jLmRvY3VtZW50RWxlbWVudDthLmlubmVySFRNTD1cIjxhIG5hbWU9J1wiK2QrXCInLz5cIixlLmluc2VydEJlZm9yZShhLGUuZmlyc3RDaGlsZCksYy5nZXRFbGVtZW50QnlJZChkKSYmKG8uZmluZC5JRD1mdW5jdGlvbihhLGMsZCl7aWYodHlwZW9mIGMuZ2V0RWxlbWVudEJ5SWQhPVwidW5kZWZpbmVkXCImJiFkKXt2YXIgZT1jLmdldEVsZW1lbnRCeUlkKGFbMV0pO3JldHVybiBlP2UuaWQ9PT1hWzFdfHx0eXBlb2YgZS5nZXRBdHRyaWJ1dGVOb2RlIT1cInVuZGVmaW5lZFwiJiZlLmdldEF0dHJpYnV0ZU5vZGUoXCJpZFwiKS5ub2RlVmFsdWU9PT1hWzFdP1tlXTpiOltdfX0sby5maWx0ZXIuSUQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz10eXBlb2YgYS5nZXRBdHRyaWJ1dGVOb2RlIT1cInVuZGVmaW5lZFwiJiZhLmdldEF0dHJpYnV0ZU5vZGUoXCJpZFwiKTtyZXR1cm4gYS5ub2RlVHlwZT09PTEmJmMmJmMubm9kZVZhbHVlPT09Yn0pLGUucmVtb3ZlQ2hpbGQoYSksZT1hPW51bGx9KCksZnVuY3Rpb24oKXt2YXIgYT1jLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7YS5hcHBlbmRDaGlsZChjLmNyZWF0ZUNvbW1lbnQoXCJcIikpLGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpLmxlbmd0aD4wJiYoby5maW5kLlRBRz1mdW5jdGlvbihhLGIpe3ZhciBjPWIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYVsxXSk7aWYoYVsxXT09PVwiKlwiKXt2YXIgZD1bXTtmb3IodmFyIGU9MDtjW2VdO2UrKyljW2VdLm5vZGVUeXBlPT09MSYmZC5wdXNoKGNbZV0pO2M9ZH1yZXR1cm4gY30pLGEuaW5uZXJIVE1MPVwiPGEgaHJlZj0nIyc+PC9hPlwiLGEuZmlyc3RDaGlsZCYmdHlwZW9mIGEuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUhPVwidW5kZWZpbmVkXCImJmEuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpIT09XCIjXCImJihvLmF0dHJIYW5kbGUuaHJlZj1mdW5jdGlvbihhKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoXCJocmVmXCIsMil9KSxhPW51bGx9KCksYy5xdWVyeVNlbGVjdG9yQWxsJiZmdW5jdGlvbigpe3ZhciBhPW0sYj1jLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksZD1cIl9fc2l6emxlX19cIjtiLmlubmVySFRNTD1cIjxwIGNsYXNzPSdURVNUJz48L3A+XCI7aWYoIWIucXVlcnlTZWxlY3RvckFsbHx8Yi5xdWVyeVNlbGVjdG9yQWxsKFwiLlRFU1RcIikubGVuZ3RoIT09MCl7bT1mdW5jdGlvbihiLGUsZixnKXtlPWV8fGM7aWYoIWcmJiFtLmlzWE1MKGUpKXt2YXIgaD0vXihcXHcrJCl8XlxcLihbXFx3XFwtXSskKXxeIyhbXFx3XFwtXSskKS8uZXhlYyhiKTtpZihoJiYoZS5ub2RlVHlwZT09PTF8fGUubm9kZVR5cGU9PT05KSl7aWYoaFsxXSlyZXR1cm4gcyhlLmdldEVsZW1lbnRzQnlUYWdOYW1lKGIpLGYpO2lmKGhbMl0mJm8uZmluZC5DTEFTUyYmZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKXJldHVybiBzKGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShoWzJdKSxmKX1pZihlLm5vZGVUeXBlPT09OSl7aWYoYj09PVwiYm9keVwiJiZlLmJvZHkpcmV0dXJuIHMoW2UuYm9keV0sZik7aWYoaCYmaFszXSl7dmFyIGk9ZS5nZXRFbGVtZW50QnlJZChoWzNdKTtpZighaXx8IWkucGFyZW50Tm9kZSlyZXR1cm4gcyhbXSxmKTtpZihpLmlkPT09aFszXSlyZXR1cm4gcyhbaV0sZil9dHJ5e3JldHVybiBzKGUucXVlcnlTZWxlY3RvckFsbChiKSxmKX1jYXRjaChqKXt9fWVsc2UgaWYoZS5ub2RlVHlwZT09PTEmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSE9PVwib2JqZWN0XCIpe3ZhciBrPWUsbD1lLmdldEF0dHJpYnV0ZShcImlkXCIpLG49bHx8ZCxwPWUucGFyZW50Tm9kZSxxPS9eXFxzKlsrfl0vLnRlc3QoYik7bD9uPW4ucmVwbGFjZSgvJy9nLFwiXFxcXCQmXCIpOmUuc2V0QXR0cmlidXRlKFwiaWRcIixuKSxxJiZwJiYoZT1lLnBhcmVudE5vZGUpO3RyeXtpZighcXx8cClyZXR1cm4gcyhlLnF1ZXJ5U2VsZWN0b3JBbGwoXCJbaWQ9J1wiK24rXCInXSBcIitiKSxmKX1jYXRjaChyKXt9ZmluYWxseXtsfHxrLnJlbW92ZUF0dHJpYnV0ZShcImlkXCIpfX19cmV0dXJuIGEoYixlLGYsZyl9O2Zvcih2YXIgZSBpbiBhKW1bZV09YVtlXTtiPW51bGx9fSgpLGZ1bmN0aW9uKCl7dmFyIGE9Yy5kb2N1bWVudEVsZW1lbnQsYj1hLm1hdGNoZXNTZWxlY3Rvcnx8YS5tb3pNYXRjaGVzU2VsZWN0b3J8fGEud2Via2l0TWF0Y2hlc1NlbGVjdG9yfHxhLm1zTWF0Y2hlc1NlbGVjdG9yO2lmKGIpe3ZhciBkPSFiLmNhbGwoYy5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFwiZGl2XCIpLGU9ITE7dHJ5e2IuY2FsbChjLmRvY3VtZW50RWxlbWVudCxcIlt0ZXN0IT0nJ106c2l6emxlXCIpfWNhdGNoKGYpe2U9ITB9bS5tYXRjaGVzU2VsZWN0b3I9ZnVuY3Rpb24oYSxjKXtjPWMucmVwbGFjZSgvXFw9XFxzKihbXidcIlxcXV0qKVxccypcXF0vZyxcIj0nJDEnXVwiKTtpZighbS5pc1hNTChhKSl0cnl7aWYoZXx8IW8ubWF0Y2guUFNFVURPLnRlc3QoYykmJiEvIT0vLnRlc3QoYykpe3ZhciBmPWIuY2FsbChhLGMpO2lmKGZ8fCFkfHxhLmRvY3VtZW50JiZhLmRvY3VtZW50Lm5vZGVUeXBlIT09MTEpcmV0dXJuIGZ9fWNhdGNoKGcpe31yZXR1cm4gbShjLG51bGwsbnVsbCxbYV0pLmxlbmd0aD4wfX19KCksZnVuY3Rpb24oKXt2YXIgYT1jLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7YS5pbm5lckhUTUw9XCI8ZGl2IGNsYXNzPSd0ZXN0IGUnPjwvZGl2PjxkaXYgY2xhc3M9J3Rlc3QnPjwvZGl2PlwiO2lmKCEhYS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lJiZhLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJlXCIpLmxlbmd0aCE9PTApe2EubGFzdENoaWxkLmNsYXNzTmFtZT1cImVcIjtpZihhLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJlXCIpLmxlbmd0aD09PTEpcmV0dXJuO28ub3JkZXIuc3BsaWNlKDEsMCxcIkNMQVNTXCIpLG8uZmluZC5DTEFTUz1mdW5jdGlvbihhLGIsYyl7aWYodHlwZW9mIGIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSE9XCJ1bmRlZmluZWRcIiYmIWMpcmV0dXJuIGIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShhWzFdKX0sYT1udWxsfX0oKSxjLmRvY3VtZW50RWxlbWVudC5jb250YWlucz9tLmNvbnRhaW5zPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGEhPT1iJiYoYS5jb250YWlucz9hLmNvbnRhaW5zKGIpOiEwKX06Yy5kb2N1bWVudEVsZW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24/bS5jb250YWlucz1mdW5jdGlvbihhLGIpe3JldHVybiEhKGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmMTYpfTptLmNvbnRhaW5zPWZ1bmN0aW9uKCl7cmV0dXJuITF9LG0uaXNYTUw9ZnVuY3Rpb24oYSl7dmFyIGI9KGE/YS5vd25lckRvY3VtZW50fHxhOjApLmRvY3VtZW50RWxlbWVudDtyZXR1cm4gYj9iLm5vZGVOYW1lIT09XCJIVE1MXCI6ITF9O3ZhciB5PWZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlPVtdLGY9XCJcIixnPWIubm9kZVR5cGU/W2JdOmI7d2hpbGUoZD1vLm1hdGNoLlBTRVVETy5leGVjKGEpKWYrPWRbMF0sYT1hLnJlcGxhY2Uoby5tYXRjaC5QU0VVRE8sXCJcIik7YT1vLnJlbGF0aXZlW2FdP2ErXCIqXCI6YTtmb3IodmFyIGg9MCxpPWcubGVuZ3RoO2g8aTtoKyspbShhLGdbaF0sZSxjKTtyZXR1cm4gbS5maWx0ZXIoZixlKX07bS5hdHRyPWYuYXR0cixtLnNlbGVjdG9ycy5hdHRyTWFwPXt9LGYuZmluZD1tLGYuZXhwcj1tLnNlbGVjdG9ycyxmLmV4cHJbXCI6XCJdPWYuZXhwci5maWx0ZXJzLGYudW5pcXVlPW0udW5pcXVlU29ydCxmLnRleHQ9bS5nZXRUZXh0LGYuaXNYTUxEb2M9bS5pc1hNTCxmLmNvbnRhaW5zPW0uY29udGFpbnN9KCk7dmFyIEw9L1VudGlsJC8sTT0vXig/OnBhcmVudHN8cHJldlVudGlsfHByZXZBbGwpLyxOPS8sLyxPPS9eLlteOiNcXFtcXC4sXSokLyxQPUFycmF5LnByb3RvdHlwZS5zbGljZSxRPWYuZXhwci5tYXRjaC5QT1MsUj17Y2hpbGRyZW46ITAsY29udGVudHM6ITAsbmV4dDohMCxwcmV2OiEwfTtmLmZuLmV4dGVuZCh7ZmluZDpmdW5jdGlvbihhKXt2YXIgYj10aGlzLGMsZDtpZih0eXBlb2YgYSE9XCJzdHJpbmdcIilyZXR1cm4gZihhKS5maWx0ZXIoZnVuY3Rpb24oKXtmb3IoYz0wLGQ9Yi5sZW5ndGg7YzxkO2MrKylpZihmLmNvbnRhaW5zKGJbY10sdGhpcykpcmV0dXJuITB9KTt2YXIgZT10aGlzLnB1c2hTdGFjayhcIlwiLFwiZmluZFwiLGEpLGcsaCxpO2ZvcihjPTAsZD10aGlzLmxlbmd0aDtjPGQ7YysrKXtnPWUubGVuZ3RoLGYuZmluZChhLHRoaXNbY10sZSk7aWYoYz4wKWZvcihoPWc7aDxlLmxlbmd0aDtoKyspZm9yKGk9MDtpPGc7aSsrKWlmKGVbaV09PT1lW2hdKXtlLnNwbGljZShoLS0sMSk7YnJlYWt9fXJldHVybiBlfSxoYXM6ZnVuY3Rpb24oYSl7dmFyIGI9ZihhKTtyZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24oKXtmb3IodmFyIGE9MCxjPWIubGVuZ3RoO2E8YzthKyspaWYoZi5jb250YWlucyh0aGlzLGJbYV0pKXJldHVybiEwfSl9LG5vdDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2soVCh0aGlzLGEsITEpLFwibm90XCIsYSl9LGZpbHRlcjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2soVCh0aGlzLGEsITApLFwiZmlsdGVyXCIsYSl9LGlzOmZ1bmN0aW9uKGEpe3JldHVybiEhYSYmKHR5cGVvZiBhPT1cInN0cmluZ1wiP1EudGVzdChhKT9mKGEsdGhpcy5jb250ZXh0KS5pbmRleCh0aGlzWzBdKT49MDpmLmZpbHRlcihhLHRoaXMpLmxlbmd0aD4wOnRoaXMuZmlsdGVyKGEpLmxlbmd0aD4wKX0sY2xvc2VzdDpmdW5jdGlvbihhLGIpe3ZhciBjPVtdLGQsZSxnPXRoaXNbMF07aWYoZi5pc0FycmF5KGEpKXt2YXIgaD0xO3doaWxlKGcmJmcub3duZXJEb2N1bWVudCYmZyE9PWIpe2ZvcihkPTA7ZDxhLmxlbmd0aDtkKyspZihnKS5pcyhhW2RdKSYmYy5wdXNoKHtzZWxlY3RvcjphW2RdLGVsZW06ZyxsZXZlbDpofSk7Zz1nLnBhcmVudE5vZGUsaCsrfXJldHVybiBjfXZhciBpPVEudGVzdChhKXx8dHlwZW9mIGEhPVwic3RyaW5nXCI/ZihhLGJ8fHRoaXMuY29udGV4dCk6MDtmb3IoZD0wLGU9dGhpcy5sZW5ndGg7ZDxlO2QrKyl7Zz10aGlzW2RdO3doaWxlKGcpe2lmKGk/aS5pbmRleChnKT4tMTpmLmZpbmQubWF0Y2hlc1NlbGVjdG9yKGcsYSkpe2MucHVzaChnKTticmVha31nPWcucGFyZW50Tm9kZTtpZighZ3x8IWcub3duZXJEb2N1bWVudHx8Zz09PWJ8fGcubm9kZVR5cGU9PT0xMSlicmVha319Yz1jLmxlbmd0aD4xP2YudW5pcXVlKGMpOmM7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGMsXCJjbG9zZXN0XCIsYSl9LGluZGV4OmZ1bmN0aW9uKGEpe2lmKCFhKXJldHVybiB0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGU/dGhpcy5wcmV2QWxsKCkubGVuZ3RoOi0xO2lmKHR5cGVvZiBhPT1cInN0cmluZ1wiKXJldHVybiBmLmluQXJyYXkodGhpc1swXSxmKGEpKTtyZXR1cm4gZi5pbkFycmF5KGEuanF1ZXJ5P2FbMF06YSx0aGlzKX0sYWRkOmZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGE9PVwic3RyaW5nXCI/ZihhLGIpOmYubWFrZUFycmF5KGEmJmEubm9kZVR5cGU/W2FdOmEpLGQ9Zi5tZXJnZSh0aGlzLmdldCgpLGMpO3JldHVybiB0aGlzLnB1c2hTdGFjayhTKGNbMF0pfHxTKGRbMF0pP2Q6Zi51bmlxdWUoZCkpfSxhbmRTZWxmOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYWRkKHRoaXMucHJldk9iamVjdCl9fSksZi5lYWNoKHtwYXJlbnQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5wYXJlbnROb2RlO3JldHVybiBiJiZiLm5vZGVUeXBlIT09MTE/YjpudWxsfSxwYXJlbnRzOmZ1bmN0aW9uKGEpe3JldHVybiBmLmRpcihhLFwicGFyZW50Tm9kZVwiKX0scGFyZW50c1VudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5kaXIoYSxcInBhcmVudE5vZGVcIixjKX0sbmV4dDpmdW5jdGlvbihhKXtyZXR1cm4gZi5udGgoYSwyLFwibmV4dFNpYmxpbmdcIil9LHByZXY6ZnVuY3Rpb24oYSl7cmV0dXJuIGYubnRoKGEsMixcInByZXZpb3VzU2libGluZ1wiKX0sbmV4dEFsbDpmdW5jdGlvbihhKXtyZXR1cm4gZi5kaXIoYSxcIm5leHRTaWJsaW5nXCIpfSxwcmV2QWxsOmZ1bmN0aW9uKGEpe3JldHVybiBmLmRpcihhLFwicHJldmlvdXNTaWJsaW5nXCIpfSxuZXh0VW50aWw6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmLmRpcihhLFwibmV4dFNpYmxpbmdcIixjKX0scHJldlVudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5kaXIoYSxcInByZXZpb3VzU2libGluZ1wiLGMpfSxzaWJsaW5nczpmdW5jdGlvbihhKXtyZXR1cm4gZi5zaWJsaW5nKGEucGFyZW50Tm9kZS5maXJzdENoaWxkLGEpfSxjaGlsZHJlbjpmdW5jdGlvbihhKXtyZXR1cm4gZi5zaWJsaW5nKGEuZmlyc3RDaGlsZCl9LGNvbnRlbnRzOmZ1bmN0aW9uKGEpe3JldHVybiBmLm5vZGVOYW1lKGEsXCJpZnJhbWVcIik/YS5jb250ZW50RG9jdW1lbnR8fGEuY29udGVudFdpbmRvdy5kb2N1bWVudDpmLm1ha2VBcnJheShhLmNoaWxkTm9kZXMpfX0sZnVuY3Rpb24oYSxiKXtmLmZuW2FdPWZ1bmN0aW9uKGMsZCl7dmFyIGU9Zi5tYXAodGhpcyxiLGMpO0wudGVzdChhKXx8KGQ9YyksZCYmdHlwZW9mIGQ9PVwic3RyaW5nXCImJihlPWYuZmlsdGVyKGQsZSkpLGU9dGhpcy5sZW5ndGg+MSYmIVJbYV0/Zi51bmlxdWUoZSk6ZSwodGhpcy5sZW5ndGg+MXx8Ti50ZXN0KGQpKSYmTS50ZXN0KGEpJiYoZT1lLnJldmVyc2UoKSk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGUsYSxQLmNhbGwoYXJndW1lbnRzKS5qb2luKFwiLFwiKSl9fSksZi5leHRlbmQoe2ZpbHRlcjpmdW5jdGlvbihhLGIsYyl7YyYmKGE9XCI6bm90KFwiK2ErXCIpXCIpO3JldHVybiBiLmxlbmd0aD09PTE/Zi5maW5kLm1hdGNoZXNTZWxlY3RvcihiWzBdLGEpP1tiWzBdXTpbXTpmLmZpbmQubWF0Y2hlcyhhLGIpfSxkaXI6ZnVuY3Rpb24oYSxjLGQpe3ZhciBlPVtdLGc9YVtjXTt3aGlsZShnJiZnLm5vZGVUeXBlIT09OSYmKGQ9PT1ifHxnLm5vZGVUeXBlIT09MXx8IWYoZykuaXMoZCkpKWcubm9kZVR5cGU9PT0xJiZlLnB1c2goZyksZz1nW2NdO3JldHVybiBlfSxudGg6ZnVuY3Rpb24oYSxiLGMsZCl7Yj1ifHwxO3ZhciBlPTA7Zm9yKDthO2E9YVtjXSlpZihhLm5vZGVUeXBlPT09MSYmKytlPT09YilicmVhaztyZXR1cm4gYX0sc2libGluZzpmdW5jdGlvbihhLGIpe3ZhciBjPVtdO2Zvcig7YTthPWEubmV4dFNpYmxpbmcpYS5ub2RlVHlwZT09PTEmJmEhPT1iJiZjLnB1c2goYSk7cmV0dXJuIGN9fSk7dmFyIFY9XCJhYmJyfGFydGljbGV8YXNpZGV8YXVkaW98Y2FudmFzfGRhdGFsaXN0fGRldGFpbHN8ZmlnY2FwdGlvbnxmaWd1cmV8Zm9vdGVyfGhlYWRlcnxoZ3JvdXB8bWFya3xtZXRlcnxuYXZ8b3V0cHV0fHByb2dyZXNzfHNlY3Rpb258c3VtbWFyeXx0aW1lfHZpZGVvXCIsVz0vIGpRdWVyeVxcZCs9XCIoPzpcXGQrfG51bGwpXCIvZyxYPS9eXFxzKy8sWT0vPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbXFx3Ol0rKVtePl0qKVxcLz4vaWcsWj0vPChbXFx3Ol0rKS8sJD0vPHRib2R5L2ksXz0vPHwmIz9cXHcrOy8sYmE9LzwoPzpzY3JpcHR8c3R5bGUpL2ksYmI9LzwoPzpzY3JpcHR8b2JqZWN0fGVtYmVkfG9wdGlvbnxzdHlsZSkvaSxiYz1uZXcgUmVnRXhwKFwiPCg/OlwiK1YrXCIpXCIsXCJpXCIpLGJkPS9jaGVja2VkXFxzKig/OltePV18PVxccyouY2hlY2tlZC4pL2ksYmU9L1xcLyhqYXZhfGVjbWEpc2NyaXB0L2ksYmY9L15cXHMqPCEoPzpcXFtDREFUQVxcW3xcXC1cXC0pLyxiZz17b3B0aW9uOlsxLFwiPHNlbGVjdCBtdWx0aXBsZT0nbXVsdGlwbGUnPlwiLFwiPC9zZWxlY3Q+XCJdLGxlZ2VuZDpbMSxcIjxmaWVsZHNldD5cIixcIjwvZmllbGRzZXQ+XCJdLHRoZWFkOlsxLFwiPHRhYmxlPlwiLFwiPC90YWJsZT5cIl0sdHI6WzIsXCI8dGFibGU+PHRib2R5PlwiLFwiPC90Ym9keT48L3RhYmxlPlwiXSx0ZDpbMyxcIjx0YWJsZT48dGJvZHk+PHRyPlwiLFwiPC90cj48L3Rib2R5PjwvdGFibGU+XCJdLGNvbDpbMixcIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+XCIsXCI8L2NvbGdyb3VwPjwvdGFibGU+XCJdLGFyZWE6WzEsXCI8bWFwPlwiLFwiPC9tYXA+XCJdLF9kZWZhdWx0OlswLFwiXCIsXCJcIl19LGJoPVUoYyk7Ymcub3B0Z3JvdXA9Ymcub3B0aW9uLGJnLnRib2R5PWJnLnRmb290PWJnLmNvbGdyb3VwPWJnLmNhcHRpb249YmcudGhlYWQsYmcudGg9YmcudGQsZi5zdXBwb3J0Lmh0bWxTZXJpYWxpemV8fChiZy5fZGVmYXVsdD1bMSxcImRpdjxkaXY+XCIsXCI8L2Rpdj5cIl0pLGYuZm4uZXh0ZW5kKHt0ZXh0OmZ1bmN0aW9uKGEpe2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWYodGhpcyk7Yy50ZXh0KGEuY2FsbCh0aGlzLGIsYy50ZXh0KCkpKX0pO2lmKHR5cGVvZiBhIT1cIm9iamVjdFwiJiZhIT09YilyZXR1cm4gdGhpcy5lbXB0eSgpLmFwcGVuZCgodGhpc1swXSYmdGhpc1swXS5vd25lckRvY3VtZW50fHxjKS5jcmVhdGVUZXh0Tm9kZShhKSk7cmV0dXJuIGYudGV4dCh0aGlzKX0sd3JhcEFsbDpmdW5jdGlvbihhKXtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLndyYXBBbGwoYS5jYWxsKHRoaXMsYikpfSk7aWYodGhpc1swXSl7dmFyIGI9ZihhLHRoaXNbMF0ub3duZXJEb2N1bWVudCkuZXEoMCkuY2xvbmUoITApO3RoaXNbMF0ucGFyZW50Tm9kZSYmYi5pbnNlcnRCZWZvcmUodGhpc1swXSksYi5tYXAoZnVuY3Rpb24oKXt2YXIgYT10aGlzO3doaWxlKGEuZmlyc3RDaGlsZCYmYS5maXJzdENoaWxkLm5vZGVUeXBlPT09MSlhPWEuZmlyc3RDaGlsZDtyZXR1cm4gYX0pLmFwcGVuZCh0aGlzKX1yZXR1cm4gdGhpc30sd3JhcElubmVyOmZ1bmN0aW9uKGEpe2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe2YodGhpcykud3JhcElubmVyKGEuY2FsbCh0aGlzLGIpKX0pO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1mKHRoaXMpLGM9Yi5jb250ZW50cygpO2MubGVuZ3RoP2Mud3JhcEFsbChhKTpiLmFwcGVuZChhKX0pfSx3cmFwOmZ1bmN0aW9uKGEpe3ZhciBiPWYuaXNGdW5jdGlvbihhKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGMpe2YodGhpcykud3JhcEFsbChiP2EuY2FsbCh0aGlzLGMpOmEpfSl9LHVud3JhcDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnBhcmVudCgpLmVhY2goZnVuY3Rpb24oKXtmLm5vZGVOYW1lKHRoaXMsXCJib2R5XCIpfHxmKHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2Rlcyl9KS5lbmQoKX0sYXBwZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCEwLGZ1bmN0aW9uKGEpe3RoaXMubm9kZVR5cGU9PT0xJiZ0aGlzLmFwcGVuZENoaWxkKGEpfSl9LHByZXBlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITAsZnVuY3Rpb24oYSl7dGhpcy5ub2RlVHlwZT09PTEmJnRoaXMuaW5zZXJ0QmVmb3JlKGEsdGhpcy5maXJzdENoaWxkKX0pfSxiZWZvcmU6ZnVuY3Rpb24oKXtpZih0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGUpcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCExLGZ1bmN0aW9uKGEpe3RoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSx0aGlzKX0pO2lmKGFyZ3VtZW50cy5sZW5ndGgpe3ZhciBhPWYuY2xlYW4oYXJndW1lbnRzKTthLnB1c2guYXBwbHkoYSx0aGlzLnRvQXJyYXkoKSk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGEsXCJiZWZvcmVcIixhcmd1bWVudHMpfX0sYWZ0ZXI6ZnVuY3Rpb24oKXtpZih0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGUpcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCExLGZ1bmN0aW9uKGEpe3RoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSx0aGlzLm5leHRTaWJsaW5nKX0pO2lmKGFyZ3VtZW50cy5sZW5ndGgpe3ZhciBhPXRoaXMucHVzaFN0YWNrKHRoaXMsXCJhZnRlclwiLGFyZ3VtZW50cyk7YS5wdXNoLmFwcGx5KGEsZi5jbGVhbihhcmd1bWVudHMpKTtyZXR1cm4gYX19LHJlbW92ZTpmdW5jdGlvbihhLGIpe2Zvcih2YXIgYz0wLGQ7KGQ9dGhpc1tjXSkhPW51bGw7YysrKWlmKCFhfHxmLmZpbHRlcihhLFtkXSkubGVuZ3RoKSFiJiZkLm5vZGVUeXBlPT09MSYmKGYuY2xlYW5EYXRhKGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpKSxmLmNsZWFuRGF0YShbZF0pKSxkLnBhcmVudE5vZGUmJmQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkKTtyZXR1cm4gdGhpc30sZW1wdHk6ZnVuY3Rpb24oKVxue2Zvcih2YXIgYT0wLGI7KGI9dGhpc1thXSkhPW51bGw7YSsrKXtiLm5vZGVUeXBlPT09MSYmZi5jbGVhbkRhdGEoYi5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIikpO3doaWxlKGIuZmlyc3RDaGlsZCliLnJlbW92ZUNoaWxkKGIuZmlyc3RDaGlsZCl9cmV0dXJuIHRoaXN9LGNsb25lOmZ1bmN0aW9uKGEsYil7YT1hPT1udWxsPyExOmEsYj1iPT1udWxsP2E6YjtyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gZi5jbG9uZSh0aGlzLGEsYil9KX0saHRtbDpmdW5jdGlvbihhKXtpZihhPT09YilyZXR1cm4gdGhpc1swXSYmdGhpc1swXS5ub2RlVHlwZT09PTE/dGhpc1swXS5pbm5lckhUTUwucmVwbGFjZShXLFwiXCIpOm51bGw7aWYodHlwZW9mIGE9PVwic3RyaW5nXCImJiFiYS50ZXN0KGEpJiYoZi5zdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlfHwhWC50ZXN0KGEpKSYmIWJnWyhaLmV4ZWMoYSl8fFtcIlwiLFwiXCJdKVsxXS50b0xvd2VyQ2FzZSgpXSl7YT1hLnJlcGxhY2UoWSxcIjwkMT48LyQyPlwiKTt0cnl7Zm9yKHZhciBjPTAsZD10aGlzLmxlbmd0aDtjPGQ7YysrKXRoaXNbY10ubm9kZVR5cGU9PT0xJiYoZi5jbGVhbkRhdGEodGhpc1tjXS5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIikpLHRoaXNbY10uaW5uZXJIVE1MPWEpfWNhdGNoKGUpe3RoaXMuZW1wdHkoKS5hcHBlbmQoYSl9fWVsc2UgZi5pc0Z1bmN0aW9uKGEpP3RoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgYz1mKHRoaXMpO2MuaHRtbChhLmNhbGwodGhpcyxiLGMuaHRtbCgpKSl9KTp0aGlzLmVtcHR5KCkuYXBwZW5kKGEpO3JldHVybiB0aGlzfSxyZXBsYWNlV2l0aDpmdW5jdGlvbihhKXtpZih0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGUpe2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWYodGhpcyksZD1jLmh0bWwoKTtjLnJlcGxhY2VXaXRoKGEuY2FsbCh0aGlzLGIsZCkpfSk7dHlwZW9mIGEhPVwic3RyaW5nXCImJihhPWYoYSkuZGV0YWNoKCkpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj10aGlzLm5leHRTaWJsaW5nLGM9dGhpcy5wYXJlbnROb2RlO2YodGhpcykucmVtb3ZlKCksYj9mKGIpLmJlZm9yZShhKTpmKGMpLmFwcGVuZChhKX0pfXJldHVybiB0aGlzLmxlbmd0aD90aGlzLnB1c2hTdGFjayhmKGYuaXNGdW5jdGlvbihhKT9hKCk6YSksXCJyZXBsYWNlV2l0aFwiLGEpOnRoaXN9LGRldGFjaDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5yZW1vdmUoYSwhMCl9LGRvbU1hbmlwOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZSxnLGgsaSxqPWFbMF0saz1bXTtpZighZi5zdXBwb3J0LmNoZWNrQ2xvbmUmJmFyZ3VtZW50cy5sZW5ndGg9PT0zJiZ0eXBlb2Ygaj09XCJzdHJpbmdcIiYmYmQudGVzdChqKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zih0aGlzKS5kb21NYW5pcChhLGMsZCwhMCl9KTtpZihmLmlzRnVuY3Rpb24oaikpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihlKXt2YXIgZz1mKHRoaXMpO2FbMF09ai5jYWxsKHRoaXMsZSxjP2cuaHRtbCgpOmIpLGcuZG9tTWFuaXAoYSxjLGQpfSk7aWYodGhpc1swXSl7aT1qJiZqLnBhcmVudE5vZGUsZi5zdXBwb3J0LnBhcmVudE5vZGUmJmkmJmkubm9kZVR5cGU9PT0xMSYmaS5jaGlsZE5vZGVzLmxlbmd0aD09PXRoaXMubGVuZ3RoP2U9e2ZyYWdtZW50Oml9OmU9Zi5idWlsZEZyYWdtZW50KGEsdGhpcyxrKSxoPWUuZnJhZ21lbnQsaC5jaGlsZE5vZGVzLmxlbmd0aD09PTE/Zz1oPWguZmlyc3RDaGlsZDpnPWguZmlyc3RDaGlsZDtpZihnKXtjPWMmJmYubm9kZU5hbWUoZyxcInRyXCIpO2Zvcih2YXIgbD0wLG09dGhpcy5sZW5ndGgsbj1tLTE7bDxtO2wrKylkLmNhbGwoYz9iaSh0aGlzW2xdLGcpOnRoaXNbbF0sZS5jYWNoZWFibGV8fG0+MSYmbDxuP2YuY2xvbmUoaCwhMCwhMCk6aCl9ay5sZW5ndGgmJmYuZWFjaChrLGJwKX1yZXR1cm4gdGhpc319KSxmLmJ1aWxkRnJhZ21lbnQ9ZnVuY3Rpb24oYSxiLGQpe3ZhciBlLGcsaCxpLGo9YVswXTtiJiZiWzBdJiYoaT1iWzBdLm93bmVyRG9jdW1lbnR8fGJbMF0pLGkuY3JlYXRlRG9jdW1lbnRGcmFnbWVudHx8KGk9YyksYS5sZW5ndGg9PT0xJiZ0eXBlb2Ygaj09XCJzdHJpbmdcIiYmai5sZW5ndGg8NTEyJiZpPT09YyYmai5jaGFyQXQoMCk9PT1cIjxcIiYmIWJiLnRlc3QoaikmJihmLnN1cHBvcnQuY2hlY2tDbG9uZXx8IWJkLnRlc3QoaikpJiYoZi5zdXBwb3J0Lmh0bWw1Q2xvbmV8fCFiYy50ZXN0KGopKSYmKGc9ITAsaD1mLmZyYWdtZW50c1tqXSxoJiZoIT09MSYmKGU9aCkpLGV8fChlPWkuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLGYuY2xlYW4oYSxpLGUsZCkpLGcmJihmLmZyYWdtZW50c1tqXT1oP2U6MSk7cmV0dXJue2ZyYWdtZW50OmUsY2FjaGVhYmxlOmd9fSxmLmZyYWdtZW50cz17fSxmLmVhY2goe2FwcGVuZFRvOlwiYXBwZW5kXCIscHJlcGVuZFRvOlwicHJlcGVuZFwiLGluc2VydEJlZm9yZTpcImJlZm9yZVwiLGluc2VydEFmdGVyOlwiYWZ0ZXJcIixyZXBsYWNlQWxsOlwicmVwbGFjZVdpdGhcIn0sZnVuY3Rpb24oYSxiKXtmLmZuW2FdPWZ1bmN0aW9uKGMpe3ZhciBkPVtdLGU9ZihjKSxnPXRoaXMubGVuZ3RoPT09MSYmdGhpc1swXS5wYXJlbnROb2RlO2lmKGcmJmcubm9kZVR5cGU9PT0xMSYmZy5jaGlsZE5vZGVzLmxlbmd0aD09PTEmJmUubGVuZ3RoPT09MSl7ZVtiXSh0aGlzWzBdKTtyZXR1cm4gdGhpc31mb3IodmFyIGg9MCxpPWUubGVuZ3RoO2g8aTtoKyspe3ZhciBqPShoPjA/dGhpcy5jbG9uZSghMCk6dGhpcykuZ2V0KCk7ZihlW2hdKVtiXShqKSxkPWQuY29uY2F0KGopfXJldHVybiB0aGlzLnB1c2hTdGFjayhkLGEsZS5zZWxlY3Rvcil9fSksZi5leHRlbmQoe2Nsb25lOmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlLGcsaD1mLnN1cHBvcnQuaHRtbDVDbG9uZXx8IWJjLnRlc3QoXCI8XCIrYS5ub2RlTmFtZSk/YS5jbG9uZU5vZGUoITApOmJvKGEpO2lmKCghZi5zdXBwb3J0Lm5vQ2xvbmVFdmVudHx8IWYuc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCkmJihhLm5vZGVUeXBlPT09MXx8YS5ub2RlVHlwZT09PTExKSYmIWYuaXNYTUxEb2MoYSkpe2JrKGEsaCksZD1ibChhKSxlPWJsKGgpO2ZvcihnPTA7ZFtnXTsrK2cpZVtnXSYmYmsoZFtnXSxlW2ddKX1pZihiKXtiaihhLGgpO2lmKGMpe2Q9YmwoYSksZT1ibChoKTtmb3IoZz0wO2RbZ107KytnKWJqKGRbZ10sZVtnXSl9fWQ9ZT1udWxsO3JldHVybiBofSxjbGVhbjpmdW5jdGlvbihhLGIsZCxlKXt2YXIgZztiPWJ8fGMsdHlwZW9mIGIuY3JlYXRlRWxlbWVudD09XCJ1bmRlZmluZWRcIiYmKGI9Yi5vd25lckRvY3VtZW50fHxiWzBdJiZiWzBdLm93bmVyRG9jdW1lbnR8fGMpO3ZhciBoPVtdLGk7Zm9yKHZhciBqPTAsazsoaz1hW2pdKSE9bnVsbDtqKyspe3R5cGVvZiBrPT1cIm51bWJlclwiJiYoays9XCJcIik7aWYoIWspY29udGludWU7aWYodHlwZW9mIGs9PVwic3RyaW5nXCIpaWYoIV8udGVzdChrKSlrPWIuY3JlYXRlVGV4dE5vZGUoayk7ZWxzZXtrPWsucmVwbGFjZShZLFwiPCQxPjwvJDI+XCIpO3ZhciBsPShaLmV4ZWMoayl8fFtcIlwiLFwiXCJdKVsxXS50b0xvd2VyQ2FzZSgpLG09YmdbbF18fGJnLl9kZWZhdWx0LG49bVswXSxvPWIuY3JlYXRlRWxlbWVudChcImRpdlwiKTtiPT09Yz9iaC5hcHBlbmRDaGlsZChvKTpVKGIpLmFwcGVuZENoaWxkKG8pLG8uaW5uZXJIVE1MPW1bMV0rayttWzJdO3doaWxlKG4tLSlvPW8ubGFzdENoaWxkO2lmKCFmLnN1cHBvcnQudGJvZHkpe3ZhciBwPSQudGVzdChrKSxxPWw9PT1cInRhYmxlXCImJiFwP28uZmlyc3RDaGlsZCYmby5maXJzdENoaWxkLmNoaWxkTm9kZXM6bVsxXT09PVwiPHRhYmxlPlwiJiYhcD9vLmNoaWxkTm9kZXM6W107Zm9yKGk9cS5sZW5ndGgtMTtpPj0wOy0taSlmLm5vZGVOYW1lKHFbaV0sXCJ0Ym9keVwiKSYmIXFbaV0uY2hpbGROb2Rlcy5sZW5ndGgmJnFbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChxW2ldKX0hZi5zdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlJiZYLnRlc3QoaykmJm8uaW5zZXJ0QmVmb3JlKGIuY3JlYXRlVGV4dE5vZGUoWC5leGVjKGspWzBdKSxvLmZpcnN0Q2hpbGQpLGs9by5jaGlsZE5vZGVzfXZhciByO2lmKCFmLnN1cHBvcnQuYXBwZW5kQ2hlY2tlZClpZihrWzBdJiZ0eXBlb2YgKHI9ay5sZW5ndGgpPT1cIm51bWJlclwiKWZvcihpPTA7aTxyO2krKylibihrW2ldKTtlbHNlIGJuKGspO2subm9kZVR5cGU/aC5wdXNoKGspOmg9Zi5tZXJnZShoLGspfWlmKGQpe2c9ZnVuY3Rpb24oYSl7cmV0dXJuIWEudHlwZXx8YmUudGVzdChhLnR5cGUpfTtmb3Ioaj0wO2hbal07aisrKWlmKGUmJmYubm9kZU5hbWUoaFtqXSxcInNjcmlwdFwiKSYmKCFoW2pdLnR5cGV8fGhbal0udHlwZS50b0xvd2VyQ2FzZSgpPT09XCJ0ZXh0L2phdmFzY3JpcHRcIikpZS5wdXNoKGhbal0ucGFyZW50Tm9kZT9oW2pdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaFtqXSk6aFtqXSk7ZWxzZXtpZihoW2pdLm5vZGVUeXBlPT09MSl7dmFyIHM9Zi5ncmVwKGhbal0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIiksZyk7aC5zcGxpY2UuYXBwbHkoaCxbaisxLDBdLmNvbmNhdChzKSl9ZC5hcHBlbmRDaGlsZChoW2pdKX19cmV0dXJuIGh9LGNsZWFuRGF0YTpmdW5jdGlvbihhKXt2YXIgYixjLGQ9Zi5jYWNoZSxlPWYuZXZlbnQuc3BlY2lhbCxnPWYuc3VwcG9ydC5kZWxldGVFeHBhbmRvO2Zvcih2YXIgaD0wLGk7KGk9YVtoXSkhPW51bGw7aCsrKXtpZihpLm5vZGVOYW1lJiZmLm5vRGF0YVtpLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKWNvbnRpbnVlO2M9aVtmLmV4cGFuZG9dO2lmKGMpe2I9ZFtjXTtpZihiJiZiLmV2ZW50cyl7Zm9yKHZhciBqIGluIGIuZXZlbnRzKWVbal0/Zi5ldmVudC5yZW1vdmUoaSxqKTpmLnJlbW92ZUV2ZW50KGksaixiLmhhbmRsZSk7Yi5oYW5kbGUmJihiLmhhbmRsZS5lbGVtPW51bGwpfWc/ZGVsZXRlIGlbZi5leHBhbmRvXTppLnJlbW92ZUF0dHJpYnV0ZSYmaS5yZW1vdmVBdHRyaWJ1dGUoZi5leHBhbmRvKSxkZWxldGUgZFtjXX19fX0pO3ZhciBicT0vYWxwaGFcXChbXildKlxcKS9pLGJyPS9vcGFjaXR5PShbXildKikvLGJzPS8oW0EtWl18Xm1zKS9nLGJ0PS9eLT9cXGQrKD86cHgpPyQvaSxidT0vXi0/XFxkLyxidj0vXihbXFwtK10pPShbXFwtKy5cXGRlXSspLyxidz17cG9zaXRpb246XCJhYnNvbHV0ZVwiLHZpc2liaWxpdHk6XCJoaWRkZW5cIixkaXNwbGF5OlwiYmxvY2tcIn0sYng9W1wiTGVmdFwiLFwiUmlnaHRcIl0sYnk9W1wiVG9wXCIsXCJCb3R0b21cIl0sYnosYkEsYkI7Zi5mbi5jc3M9ZnVuY3Rpb24oYSxjKXtpZihhcmd1bWVudHMubGVuZ3RoPT09MiYmYz09PWIpcmV0dXJuIHRoaXM7cmV0dXJuIGYuYWNjZXNzKHRoaXMsYSxjLCEwLGZ1bmN0aW9uKGEsYyxkKXtyZXR1cm4gZCE9PWI/Zi5zdHlsZShhLGMsZCk6Zi5jc3MoYSxjKX0pfSxmLmV4dGVuZCh7Y3NzSG9va3M6e29wYWNpdHk6e2dldDpmdW5jdGlvbihhLGIpe2lmKGIpe3ZhciBjPWJ6KGEsXCJvcGFjaXR5XCIsXCJvcGFjaXR5XCIpO3JldHVybiBjPT09XCJcIj9cIjFcIjpjfXJldHVybiBhLnN0eWxlLm9wYWNpdHl9fX0sY3NzTnVtYmVyOntmaWxsT3BhY2l0eTohMCxmb250V2VpZ2h0OiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcnBoYW5zOiEwLHdpZG93czohMCx6SW5kZXg6ITAsem9vbTohMH0sY3NzUHJvcHM6e1wiZmxvYXRcIjpmLnN1cHBvcnQuY3NzRmxvYXQ/XCJjc3NGbG9hdFwiOlwic3R5bGVGbG9hdFwifSxzdHlsZTpmdW5jdGlvbihhLGMsZCxlKXtpZighIWEmJmEubm9kZVR5cGUhPT0zJiZhLm5vZGVUeXBlIT09OCYmISFhLnN0eWxlKXt2YXIgZyxoLGk9Zi5jYW1lbENhc2UoYyksaj1hLnN0eWxlLGs9Zi5jc3NIb29rc1tpXTtjPWYuY3NzUHJvcHNbaV18fGk7aWYoZD09PWIpe2lmKGsmJlwiZ2V0XCJpbiBrJiYoZz1rLmdldChhLCExLGUpKSE9PWIpcmV0dXJuIGc7cmV0dXJuIGpbY119aD10eXBlb2YgZCxoPT09XCJzdHJpbmdcIiYmKGc9YnYuZXhlYyhkKSkmJihkPSsoZ1sxXSsxKSorZ1syXStwYXJzZUZsb2F0KGYuY3NzKGEsYykpLGg9XCJudW1iZXJcIik7aWYoZD09bnVsbHx8aD09PVwibnVtYmVyXCImJmlzTmFOKGQpKXJldHVybjtoPT09XCJudW1iZXJcIiYmIWYuY3NzTnVtYmVyW2ldJiYoZCs9XCJweFwiKTtpZigha3x8IShcInNldFwiaW4gayl8fChkPWsuc2V0KGEsZCkpIT09Yil0cnl7altjXT1kfWNhdGNoKGwpe319fSxjc3M6ZnVuY3Rpb24oYSxjLGQpe3ZhciBlLGc7Yz1mLmNhbWVsQ2FzZShjKSxnPWYuY3NzSG9va3NbY10sYz1mLmNzc1Byb3BzW2NdfHxjLGM9PT1cImNzc0Zsb2F0XCImJihjPVwiZmxvYXRcIik7aWYoZyYmXCJnZXRcImluIGcmJihlPWcuZ2V0KGEsITAsZCkpIT09YilyZXR1cm4gZTtpZihieilyZXR1cm4gYnooYSxjKX0sc3dhcDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9e307Zm9yKHZhciBlIGluIGIpZFtlXT1hLnN0eWxlW2VdLGEuc3R5bGVbZV09YltlXTtjLmNhbGwoYSk7Zm9yKGUgaW4gYilhLnN0eWxlW2VdPWRbZV19fSksZi5jdXJDU1M9Zi5jc3MsZi5lYWNoKFtcImhlaWdodFwiLFwid2lkdGhcIl0sZnVuY3Rpb24oYSxiKXtmLmNzc0hvb2tzW2JdPXtnZXQ6ZnVuY3Rpb24oYSxjLGQpe3ZhciBlO2lmKGMpe2lmKGEub2Zmc2V0V2lkdGghPT0wKXJldHVybiBiQyhhLGIsZCk7Zi5zd2FwKGEsYncsZnVuY3Rpb24oKXtlPWJDKGEsYixkKX0pO3JldHVybiBlfX0sc2V0OmZ1bmN0aW9uKGEsYil7aWYoIWJ0LnRlc3QoYikpcmV0dXJuIGI7Yj1wYXJzZUZsb2F0KGIpO2lmKGI+PTApcmV0dXJuIGIrXCJweFwifX19KSxmLnN1cHBvcnQub3BhY2l0eXx8KGYuY3NzSG9va3Mub3BhY2l0eT17Z2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGJyLnRlc3QoKGImJmEuY3VycmVudFN0eWxlP2EuY3VycmVudFN0eWxlLmZpbHRlcjphLnN0eWxlLmZpbHRlcil8fFwiXCIpP3BhcnNlRmxvYXQoUmVnRXhwLiQxKS8xMDArXCJcIjpiP1wiMVwiOlwiXCJ9LHNldDpmdW5jdGlvbihhLGIpe3ZhciBjPWEuc3R5bGUsZD1hLmN1cnJlbnRTdHlsZSxlPWYuaXNOdW1lcmljKGIpP1wiYWxwaGEob3BhY2l0eT1cIitiKjEwMCtcIilcIjpcIlwiLGc9ZCYmZC5maWx0ZXJ8fGMuZmlsdGVyfHxcIlwiO2Muem9vbT0xO2lmKGI+PTEmJmYudHJpbShnLnJlcGxhY2UoYnEsXCJcIikpPT09XCJcIil7Yy5yZW1vdmVBdHRyaWJ1dGUoXCJmaWx0ZXJcIik7aWYoZCYmIWQuZmlsdGVyKXJldHVybn1jLmZpbHRlcj1icS50ZXN0KGcpP2cucmVwbGFjZShicSxlKTpnK1wiIFwiK2V9fSksZihmdW5jdGlvbigpe2Yuc3VwcG9ydC5yZWxpYWJsZU1hcmdpblJpZ2h0fHwoZi5jc3NIb29rcy5tYXJnaW5SaWdodD17Z2V0OmZ1bmN0aW9uKGEsYil7dmFyIGM7Zi5zd2FwKGEse2Rpc3BsYXk6XCJpbmxpbmUtYmxvY2tcIn0sZnVuY3Rpb24oKXtiP2M9YnooYSxcIm1hcmdpbi1yaWdodFwiLFwibWFyZ2luUmlnaHRcIik6Yz1hLnN0eWxlLm1hcmdpblJpZ2h0fSk7cmV0dXJuIGN9fSl9KSxjLmRlZmF1bHRWaWV3JiZjLmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUmJihiQT1mdW5jdGlvbihhLGIpe3ZhciBjLGQsZTtiPWIucmVwbGFjZShicyxcIi0kMVwiKS50b0xvd2VyQ2FzZSgpLChkPWEub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldykmJihlPWQuZ2V0Q29tcHV0ZWRTdHlsZShhLG51bGwpKSYmKGM9ZS5nZXRQcm9wZXJ0eVZhbHVlKGIpLGM9PT1cIlwiJiYhZi5jb250YWlucyhhLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LGEpJiYoYz1mLnN0eWxlKGEsYikpKTtyZXR1cm4gY30pLGMuZG9jdW1lbnRFbGVtZW50LmN1cnJlbnRTdHlsZSYmKGJCPWZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlLGY9YS5jdXJyZW50U3R5bGUmJmEuY3VycmVudFN0eWxlW2JdLGc9YS5zdHlsZTtmPT09bnVsbCYmZyYmKGU9Z1tiXSkmJihmPWUpLCFidC50ZXN0KGYpJiZidS50ZXN0KGYpJiYoYz1nLmxlZnQsZD1hLnJ1bnRpbWVTdHlsZSYmYS5ydW50aW1lU3R5bGUubGVmdCxkJiYoYS5ydW50aW1lU3R5bGUubGVmdD1hLmN1cnJlbnRTdHlsZS5sZWZ0KSxnLmxlZnQ9Yj09PVwiZm9udFNpemVcIj9cIjFlbVwiOmZ8fDAsZj1nLnBpeGVsTGVmdCtcInB4XCIsZy5sZWZ0PWMsZCYmKGEucnVudGltZVN0eWxlLmxlZnQ9ZCkpO3JldHVybiBmPT09XCJcIj9cImF1dG9cIjpmfSksYno9YkF8fGJCLGYuZXhwciYmZi5leHByLmZpbHRlcnMmJihmLmV4cHIuZmlsdGVycy5oaWRkZW49ZnVuY3Rpb24oYSl7dmFyIGI9YS5vZmZzZXRXaWR0aCxjPWEub2Zmc2V0SGVpZ2h0O3JldHVybiBiPT09MCYmYz09PTB8fCFmLnN1cHBvcnQucmVsaWFibGVIaWRkZW5PZmZzZXRzJiYoYS5zdHlsZSYmYS5zdHlsZS5kaXNwbGF5fHxmLmNzcyhhLFwiZGlzcGxheVwiKSk9PT1cIm5vbmVcIn0sZi5leHByLmZpbHRlcnMudmlzaWJsZT1mdW5jdGlvbihhKXtyZXR1cm4hZi5leHByLmZpbHRlcnMuaGlkZGVuKGEpfSk7dmFyIGJEPS8lMjAvZyxiRT0vXFxbXFxdJC8sYkY9L1xccj9cXG4vZyxiRz0vIy4qJC8sYkg9L14oLio/KTpbIFxcdF0qKFteXFxyXFxuXSopXFxyPyQvbWcsYkk9L14oPzpjb2xvcnxkYXRlfGRhdGV0aW1lfGRhdGV0aW1lLWxvY2FsfGVtYWlsfGhpZGRlbnxtb250aHxudW1iZXJ8cGFzc3dvcmR8cmFuZ2V8c2VhcmNofHRlbHx0ZXh0fHRpbWV8dXJsfHdlZWspJC9pLGJKPS9eKD86YWJvdXR8YXBwfGFwcFxcLXN0b3JhZ2V8LitcXC1leHRlbnNpb258ZmlsZXxyZXN8d2lkZ2V0KTokLyxiSz0vXig/OkdFVHxIRUFEKSQvLGJMPS9eXFwvXFwvLyxiTT0vXFw/LyxiTj0vPHNjcmlwdFxcYltePF0qKD86KD8hPFxcL3NjcmlwdD4pPFtePF0qKSo8XFwvc2NyaXB0Pi9naSxiTz0vXig/OnNlbGVjdHx0ZXh0YXJlYSkvaSxiUD0vXFxzKy8sYlE9LyhbPyZdKV89W14mXSovLGJSPS9eKFtcXHdcXCtcXC5cXC1dKzopKD86XFwvXFwvKFteXFwvPyM6XSopKD86OihcXGQrKSk/KT8vLGJTPWYuZm4ubG9hZCxiVD17fSxiVT17fSxiVixiVyxiWD1bXCIqL1wiXStbXCIqXCJdO3RyeXtiVj1lLmhyZWZ9Y2F0Y2goYlkpe2JWPWMuY3JlYXRlRWxlbWVudChcImFcIiksYlYuaHJlZj1cIlwiLGJWPWJWLmhyZWZ9Ylc9YlIuZXhlYyhiVi50b0xvd2VyQ2FzZSgpKXx8W10sZi5mbi5leHRlbmQoe2xvYWQ6ZnVuY3Rpb24oYSxjLGQpe2lmKHR5cGVvZiBhIT1cInN0cmluZ1wiJiZiUylyZXR1cm4gYlMuYXBwbHkodGhpcyxhcmd1bWVudHMpO2lmKCF0aGlzLmxlbmd0aClyZXR1cm4gdGhpczt2YXIgZT1hLmluZGV4T2YoXCIgXCIpO2lmKGU+PTApe3ZhciBnPWEuc2xpY2UoZSxhLmxlbmd0aCk7YT1hLnNsaWNlKDAsZSl9dmFyIGg9XCJHRVRcIjtjJiYoZi5pc0Z1bmN0aW9uKGMpPyhkPWMsYz1iKTp0eXBlb2YgYz09XCJvYmplY3RcIiYmKGM9Zi5wYXJhbShjLGYuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsKSxoPVwiUE9TVFwiKSk7dmFyIGk9dGhpcztmLmFqYXgoe3VybDphLHR5cGU6aCxkYXRhVHlwZTpcImh0bWxcIixkYXRhOmMsY29tcGxldGU6ZnVuY3Rpb24oYSxiLGMpe2M9YS5yZXNwb25zZVRleHQsYS5pc1Jlc29sdmVkKCkmJihhLmRvbmUoZnVuY3Rpb24oYSl7Yz1hfSksaS5odG1sKGc/ZihcIjxkaXY+XCIpLmFwcGVuZChjLnJlcGxhY2UoYk4sXCJcIikpLmZpbmQoZyk6YykpLGQmJmkuZWFjaChkLFtjLGIsYV0pfX0pO3JldHVybiB0aGlzfSxzZXJpYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gZi5wYXJhbSh0aGlzLnNlcmlhbGl6ZUFycmF5KCkpfSxzZXJpYWxpemVBcnJheTpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnRzP2YubWFrZUFycmF5KHRoaXMuZWxlbWVudHMpOnRoaXN9KS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5uYW1lJiYhdGhpcy5kaXNhYmxlZCYmKHRoaXMuY2hlY2tlZHx8Yk8udGVzdCh0aGlzLm5vZGVOYW1lKXx8YkkudGVzdCh0aGlzLnR5cGUpKX0pLm1hcChmdW5jdGlvbihhLGIpe3ZhciBjPWYodGhpcykudmFsKCk7cmV0dXJuIGM9PW51bGw/bnVsbDpmLmlzQXJyYXkoYyk/Zi5tYXAoYyxmdW5jdGlvbihhLGMpe3JldHVybntuYW1lOmIubmFtZSx2YWx1ZTphLnJlcGxhY2UoYkYsXCJcXHJcXG5cIil9fSk6e25hbWU6Yi5uYW1lLHZhbHVlOmMucmVwbGFjZShiRixcIlxcclxcblwiKX19KS5nZXQoKX19KSxmLmVhY2goXCJhamF4U3RhcnQgYWpheFN0b3AgYWpheENvbXBsZXRlIGFqYXhFcnJvciBhamF4U3VjY2VzcyBhamF4U2VuZFwiLnNwbGl0KFwiIFwiKSxmdW5jdGlvbihhLGIpe2YuZm5bYl09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMub24oYixhKX19KSxmLmVhY2goW1wiZ2V0XCIsXCJwb3N0XCJdLGZ1bmN0aW9uKGEsYyl7ZltjXT1mdW5jdGlvbihhLGQsZSxnKXtmLmlzRnVuY3Rpb24oZCkmJihnPWd8fGUsZT1kLGQ9Yik7cmV0dXJuIGYuYWpheCh7dHlwZTpjLHVybDphLGRhdGE6ZCxzdWNjZXNzOmUsZGF0YVR5cGU6Z30pfX0pLGYuZXh0ZW5kKHtnZXRTY3JpcHQ6ZnVuY3Rpb24oYSxjKXtyZXR1cm4gZi5nZXQoYSxiLGMsXCJzY3JpcHRcIil9LGdldEpTT046ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmLmdldChhLGIsYyxcImpzb25cIil9LGFqYXhTZXR1cDpmdW5jdGlvbihhLGIpe2I/Yl8oYSxmLmFqYXhTZXR0aW5ncyk6KGI9YSxhPWYuYWpheFNldHRpbmdzKSxiXyhhLGIpO3JldHVybiBhfSxhamF4U2V0dGluZ3M6e3VybDpiVixpc0xvY2FsOmJKLnRlc3QoYldbMV0pLGdsb2JhbDohMCx0eXBlOlwiR0VUXCIsY29udGVudFR5cGU6XCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIixwcm9jZXNzRGF0YTohMCxhc3luYzohMCxhY2NlcHRzOnt4bWw6XCJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sXCIsaHRtbDpcInRleHQvaHRtbFwiLHRleHQ6XCJ0ZXh0L3BsYWluXCIsanNvbjpcImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdFwiLFwiKlwiOmJYfSxjb250ZW50czp7eG1sOi94bWwvLGh0bWw6L2h0bWwvLGpzb246L2pzb24vfSxyZXNwb25zZUZpZWxkczp7eG1sOlwicmVzcG9uc2VYTUxcIix0ZXh0OlwicmVzcG9uc2VUZXh0XCJ9LGNvbnZlcnRlcnM6e1wiKiB0ZXh0XCI6YS5TdHJpbmcsXCJ0ZXh0IGh0bWxcIjohMCxcInRleHQganNvblwiOmYucGFyc2VKU09OLFwidGV4dCB4bWxcIjpmLnBhcnNlWE1MfSxmbGF0T3B0aW9uczp7Y29udGV4dDohMCx1cmw6ITB9fSxhamF4UHJlZmlsdGVyOmJaKGJUKSxhamF4VHJhbnNwb3J0OmJaKGJVKSxhamF4OmZ1bmN0aW9uKGEsYyl7ZnVuY3Rpb24gdyhhLGMsbCxtKXtpZihzIT09Mil7cz0yLHEmJmNsZWFyVGltZW91dChxKSxwPWIsbj1tfHxcIlwiLHYucmVhZHlTdGF0ZT1hPjA/NDowO3ZhciBvLHIsdSx3PWMseD1sP2NiKGQsdixsKTpiLHksejtpZihhPj0yMDAmJmE8MzAwfHxhPT09MzA0KXtpZihkLmlmTW9kaWZpZWQpe2lmKHk9di5nZXRSZXNwb25zZUhlYWRlcihcIkxhc3QtTW9kaWZpZWRcIikpZi5sYXN0TW9kaWZpZWRba109eTtpZih6PXYuZ2V0UmVzcG9uc2VIZWFkZXIoXCJFdGFnXCIpKWYuZXRhZ1trXT16fWlmKGE9PT0zMDQpdz1cIm5vdG1vZGlmaWVkXCIsbz0hMDtlbHNlIHRyeXtyPWNjKGQseCksdz1cInN1Y2Nlc3NcIixvPSEwfWNhdGNoKEEpe3c9XCJwYXJzZXJlcnJvclwiLHU9QX19ZWxzZXt1PXc7aWYoIXd8fGEpdz1cImVycm9yXCIsYTwwJiYoYT0wKX12LnN0YXR1cz1hLHYuc3RhdHVzVGV4dD1cIlwiKyhjfHx3KSxvP2gucmVzb2x2ZVdpdGgoZSxbcix3LHZdKTpoLnJlamVjdFdpdGgoZSxbdix3LHVdKSx2LnN0YXR1c0NvZGUoaiksaj1iLHQmJmcudHJpZ2dlcihcImFqYXhcIisobz9cIlN1Y2Nlc3NcIjpcIkVycm9yXCIpLFt2LGQsbz9yOnVdKSxpLmZpcmVXaXRoKGUsW3Ysd10pLHQmJihnLnRyaWdnZXIoXCJhamF4Q29tcGxldGVcIixbdixkXSksLS1mLmFjdGl2ZXx8Zi5ldmVudC50cmlnZ2VyKFwiYWpheFN0b3BcIikpfX10eXBlb2YgYT09XCJvYmplY3RcIiYmKGM9YSxhPWIpLGM9Y3x8e307dmFyIGQ9Zi5hamF4U2V0dXAoe30sYyksZT1kLmNvbnRleHR8fGQsZz1lIT09ZCYmKGUubm9kZVR5cGV8fGUgaW5zdGFuY2VvZiBmKT9mKGUpOmYuZXZlbnQsaD1mLkRlZmVycmVkKCksaT1mLkNhbGxiYWNrcyhcIm9uY2UgbWVtb3J5XCIpLGo9ZC5zdGF0dXNDb2RlfHx7fSxrLGw9e30sbT17fSxuLG8scCxxLHIscz0wLHQsdSx2PXtyZWFkeVN0YXRlOjAsc2V0UmVxdWVzdEhlYWRlcjpmdW5jdGlvbihhLGIpe2lmKCFzKXt2YXIgYz1hLnRvTG93ZXJDYXNlKCk7YT1tW2NdPW1bY118fGEsbFthXT1ifXJldHVybiB0aGlzfSxnZXRBbGxSZXNwb25zZUhlYWRlcnM6ZnVuY3Rpb24oKXtyZXR1cm4gcz09PTI/bjpudWxsfSxnZXRSZXNwb25zZUhlYWRlcjpmdW5jdGlvbihhKXt2YXIgYztpZihzPT09Mil7aWYoIW8pe289e307d2hpbGUoYz1iSC5leGVjKG4pKW9bY1sxXS50b0xvd2VyQ2FzZSgpXT1jWzJdfWM9b1thLnRvTG93ZXJDYXNlKCldfXJldHVybiBjPT09Yj9udWxsOmN9LG92ZXJyaWRlTWltZVR5cGU6ZnVuY3Rpb24oYSl7c3x8KGQubWltZVR5cGU9YSk7cmV0dXJuIHRoaXN9LGFib3J0OmZ1bmN0aW9uKGEpe2E9YXx8XCJhYm9ydFwiLHAmJnAuYWJvcnQoYSksdygwLGEpO3JldHVybiB0aGlzfX07aC5wcm9taXNlKHYpLHYuc3VjY2Vzcz12LmRvbmUsdi5lcnJvcj12LmZhaWwsdi5jb21wbGV0ZT1pLmFkZCx2LnN0YXR1c0NvZGU9ZnVuY3Rpb24oYSl7aWYoYSl7dmFyIGI7aWYoczwyKWZvcihiIGluIGEpaltiXT1baltiXSxhW2JdXTtlbHNlIGI9YVt2LnN0YXR1c10sdi50aGVuKGIsYil9cmV0dXJuIHRoaXN9LGQudXJsPSgoYXx8ZC51cmwpK1wiXCIpLnJlcGxhY2UoYkcsXCJcIikucmVwbGFjZShiTCxiV1sxXStcIi8vXCIpLGQuZGF0YVR5cGVzPWYudHJpbShkLmRhdGFUeXBlfHxcIipcIikudG9Mb3dlckNhc2UoKS5zcGxpdChiUCksZC5jcm9zc0RvbWFpbj09bnVsbCYmKHI9YlIuZXhlYyhkLnVybC50b0xvd2VyQ2FzZSgpKSxkLmNyb3NzRG9tYWluPSEoIXJ8fHJbMV09PWJXWzFdJiZyWzJdPT1iV1syXSYmKHJbM118fChyWzFdPT09XCJodHRwOlwiPzgwOjQ0MykpPT0oYldbM118fChiV1sxXT09PVwiaHR0cDpcIj84MDo0NDMpKSkpLGQuZGF0YSYmZC5wcm9jZXNzRGF0YSYmdHlwZW9mIGQuZGF0YSE9XCJzdHJpbmdcIiYmKGQuZGF0YT1mLnBhcmFtKGQuZGF0YSxkLnRyYWRpdGlvbmFsKSksYiQoYlQsZCxjLHYpO2lmKHM9PT0yKXJldHVybiExO3Q9ZC5nbG9iYWwsZC50eXBlPWQudHlwZS50b1VwcGVyQ2FzZSgpLGQuaGFzQ29udGVudD0hYksudGVzdChkLnR5cGUpLHQmJmYuYWN0aXZlKys9PT0wJiZmLmV2ZW50LnRyaWdnZXIoXCJhamF4U3RhcnRcIik7aWYoIWQuaGFzQ29udGVudCl7ZC5kYXRhJiYoZC51cmwrPShiTS50ZXN0KGQudXJsKT9cIiZcIjpcIj9cIikrZC5kYXRhLGRlbGV0ZSBkLmRhdGEpLGs9ZC51cmw7aWYoZC5jYWNoZT09PSExKXt2YXIgeD1mLm5vdygpLHk9ZC51cmwucmVwbGFjZShiUSxcIiQxXz1cIit4KTtkLnVybD15Kyh5PT09ZC51cmw/KGJNLnRlc3QoZC51cmwpP1wiJlwiOlwiP1wiKStcIl89XCIreDpcIlwiKX19KGQuZGF0YSYmZC5oYXNDb250ZW50JiZkLmNvbnRlbnRUeXBlIT09ITF8fGMuY29udGVudFR5cGUpJiZ2LnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LVR5cGVcIixkLmNvbnRlbnRUeXBlKSxkLmlmTW9kaWZpZWQmJihrPWt8fGQudXJsLGYubGFzdE1vZGlmaWVkW2tdJiZ2LnNldFJlcXVlc3RIZWFkZXIoXCJJZi1Nb2RpZmllZC1TaW5jZVwiLGYubGFzdE1vZGlmaWVkW2tdKSxmLmV0YWdba10mJnYuc2V0UmVxdWVzdEhlYWRlcihcIklmLU5vbmUtTWF0Y2hcIixmLmV0YWdba10pKSx2LnNldFJlcXVlc3RIZWFkZXIoXCJBY2NlcHRcIixkLmRhdGFUeXBlc1swXSYmZC5hY2NlcHRzW2QuZGF0YVR5cGVzWzBdXT9kLmFjY2VwdHNbZC5kYXRhVHlwZXNbMF1dKyhkLmRhdGFUeXBlc1swXSE9PVwiKlwiP1wiLCBcIitiWCtcIjsgcT0wLjAxXCI6XCJcIik6ZC5hY2NlcHRzW1wiKlwiXSk7Zm9yKHUgaW4gZC5oZWFkZXJzKXYuc2V0UmVxdWVzdEhlYWRlcih1LGQuaGVhZGVyc1t1XSk7aWYoZC5iZWZvcmVTZW5kJiYoZC5iZWZvcmVTZW5kLmNhbGwoZSx2LGQpPT09ITF8fHM9PT0yKSl7di5hYm9ydCgpO3JldHVybiExfWZvcih1IGlue3N1Y2Nlc3M6MSxlcnJvcjoxLGNvbXBsZXRlOjF9KXZbdV0oZFt1XSk7cD1iJChiVSxkLGMsdik7aWYoIXApdygtMSxcIk5vIFRyYW5zcG9ydFwiKTtlbHNle3YucmVhZHlTdGF0ZT0xLHQmJmcudHJpZ2dlcihcImFqYXhTZW5kXCIsW3YsZF0pLGQuYXN5bmMmJmQudGltZW91dD4wJiYocT1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7di5hYm9ydChcInRpbWVvdXRcIil9LGQudGltZW91dCkpO3RyeXtzPTEscC5zZW5kKGwsdyl9Y2F0Y2goeil7aWYoczwyKXcoLTEseik7ZWxzZSB0aHJvdyB6fX1yZXR1cm4gdn0scGFyYW06ZnVuY3Rpb24oYSxjKXt2YXIgZD1bXSxlPWZ1bmN0aW9uKGEsYil7Yj1mLmlzRnVuY3Rpb24oYik/YigpOmIsZFtkLmxlbmd0aF09ZW5jb2RlVVJJQ29tcG9uZW50KGEpK1wiPVwiK2VuY29kZVVSSUNvbXBvbmVudChiKX07Yz09PWImJihjPWYuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsKTtpZihmLmlzQXJyYXkoYSl8fGEuanF1ZXJ5JiYhZi5pc1BsYWluT2JqZWN0KGEpKWYuZWFjaChhLGZ1bmN0aW9uKCl7ZSh0aGlzLm5hbWUsdGhpcy52YWx1ZSl9KTtlbHNlIGZvcih2YXIgZyBpbiBhKWNhKGcsYVtnXSxjLGUpO3JldHVybiBkLmpvaW4oXCImXCIpLnJlcGxhY2UoYkQsXCIrXCIpfX0pLGYuZXh0ZW5kKHthY3RpdmU6MCxsYXN0TW9kaWZpZWQ6e30sZXRhZzp7fX0pO3ZhciBjZD1mLm5vdygpLGNlPS8oXFw9KVxcPygmfCQpfFxcP1xcPy9pO2YuYWpheFNldHVwKHtqc29ucDpcImNhbGxiYWNrXCIsanNvbnBDYWxsYmFjazpmdW5jdGlvbigpe3JldHVybiBmLmV4cGFuZG8rXCJfXCIrY2QrK319KSxmLmFqYXhQcmVmaWx0ZXIoXCJqc29uIGpzb25wXCIsZnVuY3Rpb24oYixjLGQpe3ZhciBlPWIuY29udGVudFR5cGU9PT1cImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiJiZ0eXBlb2YgYi5kYXRhPT1cInN0cmluZ1wiO2lmKGIuZGF0YVR5cGVzWzBdPT09XCJqc29ucFwifHxiLmpzb25wIT09ITEmJihjZS50ZXN0KGIudXJsKXx8ZSYmY2UudGVzdChiLmRhdGEpKSl7dmFyIGcsaD1iLmpzb25wQ2FsbGJhY2s9Zi5pc0Z1bmN0aW9uKGIuanNvbnBDYWxsYmFjayk/Yi5qc29ucENhbGxiYWNrKCk6Yi5qc29ucENhbGxiYWNrLGk9YVtoXSxqPWIudXJsLGs9Yi5kYXRhLGw9XCIkMVwiK2grXCIkMlwiO2IuanNvbnAhPT0hMSYmKGo9ai5yZXBsYWNlKGNlLGwpLGIudXJsPT09aiYmKGUmJihrPWsucmVwbGFjZShjZSxsKSksYi5kYXRhPT09ayYmKGorPSgvXFw/Ly50ZXN0KGopP1wiJlwiOlwiP1wiKStiLmpzb25wK1wiPVwiK2gpKSksYi51cmw9aixiLmRhdGE9ayxhW2hdPWZ1bmN0aW9uKGEpe2c9W2FdfSxkLmFsd2F5cyhmdW5jdGlvbigpe2FbaF09aSxnJiZmLmlzRnVuY3Rpb24oaSkmJmFbaF0oZ1swXSl9KSxiLmNvbnZlcnRlcnNbXCJzY3JpcHQganNvblwiXT1mdW5jdGlvbigpe2d8fGYuZXJyb3IoaCtcIiB3YXMgbm90IGNhbGxlZFwiKTtyZXR1cm4gZ1swXX0sYi5kYXRhVHlwZXNbMF09XCJqc29uXCI7cmV0dXJuXCJzY3JpcHRcIn19KSxmLmFqYXhTZXR1cCh7YWNjZXB0czp7c2NyaXB0OlwidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9lY21hc2NyaXB0LCBhcHBsaWNhdGlvbi94LWVjbWFzY3JpcHRcIn0sY29udGVudHM6e3NjcmlwdDovamF2YXNjcmlwdHxlY21hc2NyaXB0L30sY29udmVydGVyczp7XCJ0ZXh0IHNjcmlwdFwiOmZ1bmN0aW9uKGEpe2YuZ2xvYmFsRXZhbChhKTtyZXR1cm4gYX19fSksZi5hamF4UHJlZmlsdGVyKFwic2NyaXB0XCIsZnVuY3Rpb24oYSl7YS5jYWNoZT09PWImJihhLmNhY2hlPSExKSxhLmNyb3NzRG9tYWluJiYoYS50eXBlPVwiR0VUXCIsYS5nbG9iYWw9ITEpfSksZi5hamF4VHJhbnNwb3J0KFwic2NyaXB0XCIsZnVuY3Rpb24oYSl7aWYoYS5jcm9zc0RvbWFpbil7dmFyIGQsZT1jLmhlYWR8fGMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdfHxjLmRvY3VtZW50RWxlbWVudDtyZXR1cm57c2VuZDpmdW5jdGlvbihmLGcpe2Q9Yy5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpLGQuYXN5bmM9XCJhc3luY1wiLGEuc2NyaXB0Q2hhcnNldCYmKGQuY2hhcnNldD1hLnNjcmlwdENoYXJzZXQpLGQuc3JjPWEudXJsLGQub25sb2FkPWQub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKGEsYyl7aWYoY3x8IWQucmVhZHlTdGF0ZXx8L2xvYWRlZHxjb21wbGV0ZS8udGVzdChkLnJlYWR5U3RhdGUpKWQub25sb2FkPWQub25yZWFkeXN0YXRlY2hhbmdlPW51bGwsZSYmZC5wYXJlbnROb2RlJiZlLnJlbW92ZUNoaWxkKGQpLGQ9YixjfHxnKDIwMCxcInN1Y2Nlc3NcIil9LGUuaW5zZXJ0QmVmb3JlKGQsZS5maXJzdENoaWxkKX0sYWJvcnQ6ZnVuY3Rpb24oKXtkJiZkLm9ubG9hZCgwLDEpfX19fSk7dmFyIGNmPWEuQWN0aXZlWE9iamVjdD9mdW5jdGlvbigpe2Zvcih2YXIgYSBpbiBjaCljaFthXSgwLDEpfTohMSxjZz0wLGNoO2YuYWpheFNldHRpbmdzLnhocj1hLkFjdGl2ZVhPYmplY3Q/ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5pc0xvY2FsJiZjaSgpfHxjaigpfTpjaSxmdW5jdGlvbihhKXtmLmV4dGVuZChmLnN1cHBvcnQse2FqYXg6ISFhLGNvcnM6ISFhJiZcIndpdGhDcmVkZW50aWFsc1wiaW4gYX0pfShmLmFqYXhTZXR0aW5ncy54aHIoKSksZi5zdXBwb3J0LmFqYXgmJmYuYWpheFRyYW5zcG9ydChmdW5jdGlvbihjKXtpZighYy5jcm9zc0RvbWFpbnx8Zi5zdXBwb3J0LmNvcnMpe3ZhciBkO3JldHVybntzZW5kOmZ1bmN0aW9uKGUsZyl7dmFyIGg9Yy54aHIoKSxpLGo7Yy51c2VybmFtZT9oLm9wZW4oYy50eXBlLGMudXJsLGMuYXN5bmMsYy51c2VybmFtZSxjLnBhc3N3b3JkKTpoLm9wZW4oYy50eXBlLGMudXJsLGMuYXN5bmMpO2lmKGMueGhyRmllbGRzKWZvcihqIGluIGMueGhyRmllbGRzKWhbal09Yy54aHJGaWVsZHNbal07Yy5taW1lVHlwZSYmaC5vdmVycmlkZU1pbWVUeXBlJiZoLm92ZXJyaWRlTWltZVR5cGUoYy5taW1lVHlwZSksIWMuY3Jvc3NEb21haW4mJiFlW1wiWC1SZXF1ZXN0ZWQtV2l0aFwiXSYmKGVbXCJYLVJlcXVlc3RlZC1XaXRoXCJdPVwiWE1MSHR0cFJlcXVlc3RcIik7dHJ5e2ZvcihqIGluIGUpaC5zZXRSZXF1ZXN0SGVhZGVyKGosZVtqXSl9Y2F0Y2goayl7fWguc2VuZChjLmhhc0NvbnRlbnQmJmMuZGF0YXx8bnVsbCksZD1mdW5jdGlvbihhLGUpe3ZhciBqLGssbCxtLG47dHJ5e2lmKGQmJihlfHxoLnJlYWR5U3RhdGU9PT00KSl7ZD1iLGkmJihoLm9ucmVhZHlzdGF0ZWNoYW5nZT1mLm5vb3AsY2YmJmRlbGV0ZSBjaFtpXSk7aWYoZSloLnJlYWR5U3RhdGUhPT00JiZoLmFib3J0KCk7ZWxzZXtqPWguc3RhdHVzLGw9aC5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSxtPXt9LG49aC5yZXNwb25zZVhNTCxuJiZuLmRvY3VtZW50RWxlbWVudCYmKG0ueG1sPW4pLG0udGV4dD1oLnJlc3BvbnNlVGV4dDt0cnl7az1oLnN0YXR1c1RleHR9Y2F0Y2gobyl7az1cIlwifSFqJiZjLmlzTG9jYWwmJiFjLmNyb3NzRG9tYWluP2o9bS50ZXh0PzIwMDo0MDQ6aj09PTEyMjMmJihqPTIwNCl9fX1jYXRjaChwKXtlfHxnKC0xLHApfW0mJmcoaixrLG0sbCl9LCFjLmFzeW5jfHxoLnJlYWR5U3RhdGU9PT00P2QoKTooaT0rK2NnLGNmJiYoY2h8fChjaD17fSxmKGEpLnVubG9hZChjZikpLGNoW2ldPWQpLGgub25yZWFkeXN0YXRlY2hhbmdlPWQpfSxhYm9ydDpmdW5jdGlvbigpe2QmJmQoMCwxKX19fX0pO3ZhciBjaz17fSxjbCxjbSxjbj0vXig/OnRvZ2dsZXxzaG93fGhpZGUpJC8sY289L14oWytcXC1dPSk/KFtcXGQrLlxcLV0rKShbYS16JV0qKSQvaSxjcCxjcT1bW1wiaGVpZ2h0XCIsXCJtYXJnaW5Ub3BcIixcIm1hcmdpbkJvdHRvbVwiLFwicGFkZGluZ1RvcFwiLFwicGFkZGluZ0JvdHRvbVwiXSxbXCJ3aWR0aFwiLFwibWFyZ2luTGVmdFwiLFwibWFyZ2luUmlnaHRcIixcInBhZGRpbmdMZWZ0XCIsXCJwYWRkaW5nUmlnaHRcIl0sW1wib3BhY2l0eVwiXV0sY3I7Zi5mbi5leHRlbmQoe3Nob3c6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGU7aWYoYXx8YT09PTApcmV0dXJuIHRoaXMuYW5pbWF0ZShjdShcInNob3dcIiwzKSxhLGIsYyk7Zm9yKHZhciBnPTAsaD10aGlzLmxlbmd0aDtnPGg7ZysrKWQ9dGhpc1tnXSxkLnN0eWxlJiYoZT1kLnN0eWxlLmRpc3BsYXksIWYuX2RhdGEoZCxcIm9sZGRpc3BsYXlcIikmJmU9PT1cIm5vbmVcIiYmKGU9ZC5zdHlsZS5kaXNwbGF5PVwiXCIpLGU9PT1cIlwiJiZmLmNzcyhkLFwiZGlzcGxheVwiKT09PVwibm9uZVwiJiZmLl9kYXRhKGQsXCJvbGRkaXNwbGF5XCIsY3YoZC5ub2RlTmFtZSkpKTtmb3IoZz0wO2c8aDtnKyspe2Q9dGhpc1tnXTtpZihkLnN0eWxlKXtlPWQuc3R5bGUuZGlzcGxheTtpZihlPT09XCJcInx8ZT09PVwibm9uZVwiKWQuc3R5bGUuZGlzcGxheT1mLl9kYXRhKGQsXCJvbGRkaXNwbGF5XCIpfHxcIlwifX1yZXR1cm4gdGhpc30saGlkZTpmdW5jdGlvbihhLGIsYyl7aWYoYXx8YT09PTApcmV0dXJuIHRoaXMuYW5pbWF0ZShjdShcImhpZGVcIiwzKSxhLGIsYyk7dmFyIGQsZSxnPTAsaD10aGlzLmxlbmd0aDtmb3IoO2c8aDtnKyspZD10aGlzW2ddLGQuc3R5bGUmJihlPWYuY3NzKGQsXCJkaXNwbGF5XCIpLGUhPT1cIm5vbmVcIiYmIWYuX2RhdGEoZCxcIm9sZGRpc3BsYXlcIikmJmYuX2RhdGEoZCxcIm9sZGRpc3BsYXlcIixlKSk7Zm9yKGc9MDtnPGg7ZysrKXRoaXNbZ10uc3R5bGUmJih0aGlzW2ddLnN0eWxlLmRpc3BsYXk9XCJub25lXCIpO3JldHVybiB0aGlzfSxfdG9nZ2xlOmYuZm4udG9nZ2xlLHRvZ2dsZTpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dHlwZW9mIGE9PVwiYm9vbGVhblwiO2YuaXNGdW5jdGlvbihhKSYmZi5pc0Z1bmN0aW9uKGIpP3RoaXMuX3RvZ2dsZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6YT09bnVsbHx8ZD90aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1kP2E6Zih0aGlzKS5pcyhcIjpoaWRkZW5cIik7Zih0aGlzKVtiP1wic2hvd1wiOlwiaGlkZVwiXSgpfSk6dGhpcy5hbmltYXRlKGN1KFwidG9nZ2xlXCIsMyksYSxiLGMpO3JldHVybiB0aGlzfSxmYWRlVG86ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIHRoaXMuZmlsdGVyKFwiOmhpZGRlblwiKS5jc3MoXCJvcGFjaXR5XCIsMCkuc2hvdygpLmVuZCgpLmFuaW1hdGUoe29wYWNpdHk6Yn0sYSxjLGQpfSxhbmltYXRlOmZ1bmN0aW9uKGEsYixjLGQpe2Z1bmN0aW9uIGcoKXtlLnF1ZXVlPT09ITEmJmYuX21hcmsodGhpcyk7dmFyIGI9Zi5leHRlbmQoe30sZSksYz10aGlzLm5vZGVUeXBlPT09MSxkPWMmJmYodGhpcykuaXMoXCI6aGlkZGVuXCIpLGcsaCxpLGosayxsLG0sbixvO2IuYW5pbWF0ZWRQcm9wZXJ0aWVzPXt9O2ZvcihpIGluIGEpe2c9Zi5jYW1lbENhc2UoaSksaSE9PWcmJihhW2ddPWFbaV0sZGVsZXRlIGFbaV0pLGg9YVtnXSxmLmlzQXJyYXkoaCk/KGIuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddPWhbMV0saD1hW2ddPWhbMF0pOmIuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddPWIuc3BlY2lhbEVhc2luZyYmYi5zcGVjaWFsRWFzaW5nW2ddfHxiLmVhc2luZ3x8XCJzd2luZ1wiO2lmKGg9PT1cImhpZGVcIiYmZHx8aD09PVwic2hvd1wiJiYhZClyZXR1cm4gYi5jb21wbGV0ZS5jYWxsKHRoaXMpO2MmJihnPT09XCJoZWlnaHRcInx8Zz09PVwid2lkdGhcIikmJihiLm92ZXJmbG93PVt0aGlzLnN0eWxlLm92ZXJmbG93LHRoaXMuc3R5bGUub3ZlcmZsb3dYLHRoaXMuc3R5bGUub3ZlcmZsb3dZXSxmLmNzcyh0aGlzLFwiZGlzcGxheVwiKT09PVwiaW5saW5lXCImJmYuY3NzKHRoaXMsXCJmbG9hdFwiKT09PVwibm9uZVwiJiYoIWYuc3VwcG9ydC5pbmxpbmVCbG9ja05lZWRzTGF5b3V0fHxjdih0aGlzLm5vZGVOYW1lKT09PVwiaW5saW5lXCI/dGhpcy5zdHlsZS5kaXNwbGF5PVwiaW5saW5lLWJsb2NrXCI6dGhpcy5zdHlsZS56b29tPTEpKX1iLm92ZXJmbG93IT1udWxsJiYodGhpcy5zdHlsZS5vdmVyZmxvdz1cImhpZGRlblwiKTtmb3IoaSBpbiBhKWo9bmV3IGYuZngodGhpcyxiLGkpLGg9YVtpXSxjbi50ZXN0KGgpPyhvPWYuX2RhdGEodGhpcyxcInRvZ2dsZVwiK2kpfHwoaD09PVwidG9nZ2xlXCI/ZD9cInNob3dcIjpcImhpZGVcIjowKSxvPyhmLl9kYXRhKHRoaXMsXCJ0b2dnbGVcIitpLG89PT1cInNob3dcIj9cImhpZGVcIjpcInNob3dcIiksaltvXSgpKTpqW2hdKCkpOihrPWNvLmV4ZWMoaCksbD1qLmN1cigpLGs/KG09cGFyc2VGbG9hdChrWzJdKSxuPWtbM118fChmLmNzc051bWJlcltpXT9cIlwiOlwicHhcIiksbiE9PVwicHhcIiYmKGYuc3R5bGUodGhpcyxpLChtfHwxKStuKSxsPShtfHwxKS9qLmN1cigpKmwsZi5zdHlsZSh0aGlzLGksbCtuKSksa1sxXSYmKG09KGtbMV09PT1cIi09XCI/LTE6MSkqbStsKSxqLmN1c3RvbShsLG0sbikpOmouY3VzdG9tKGwsaCxcIlwiKSk7cmV0dXJuITB9dmFyIGU9Zi5zcGVlZChiLGMsZCk7aWYoZi5pc0VtcHR5T2JqZWN0KGEpKXJldHVybiB0aGlzLmVhY2goZS5jb21wbGV0ZSxbITFdKTthPWYuZXh0ZW5kKHt9LGEpO3JldHVybiBlLnF1ZXVlPT09ITE/dGhpcy5lYWNoKGcpOnRoaXMucXVldWUoZS5xdWV1ZSxnKX0sc3RvcDpmdW5jdGlvbihhLGMsZCl7dHlwZW9mIGEhPVwic3RyaW5nXCImJihkPWMsYz1hLGE9YiksYyYmYSE9PSExJiZ0aGlzLnF1ZXVlKGF8fFwiZnhcIixbXSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2Z1bmN0aW9uIGgoYSxiLGMpe3ZhciBlPWJbY107Zi5yZW1vdmVEYXRhKGEsYywhMCksZS5zdG9wKGQpfXZhciBiLGM9ITEsZT1mLnRpbWVycyxnPWYuX2RhdGEodGhpcyk7ZHx8Zi5fdW5tYXJrKCEwLHRoaXMpO2lmKGE9PW51bGwpZm9yKGIgaW4gZylnW2JdJiZnW2JdLnN0b3AmJmIuaW5kZXhPZihcIi5ydW5cIik9PT1iLmxlbmd0aC00JiZoKHRoaXMsZyxiKTtlbHNlIGdbYj1hK1wiLnJ1blwiXSYmZ1tiXS5zdG9wJiZoKHRoaXMsZyxiKTtmb3IoYj1lLmxlbmd0aDtiLS07KWVbYl0uZWxlbT09PXRoaXMmJihhPT1udWxsfHxlW2JdLnF1ZXVlPT09YSkmJihkP2VbYl0oITApOmVbYl0uc2F2ZVN0YXRlKCksYz0hMCxlLnNwbGljZShiLDEpKTsoIWR8fCFjKSYmZi5kZXF1ZXVlKHRoaXMsYSl9KX19KSxmLmVhY2goe3NsaWRlRG93bjpjdShcInNob3dcIiwxKSxzbGlkZVVwOmN1KFwiaGlkZVwiLDEpLHNsaWRlVG9nZ2xlOmN1KFwidG9nZ2xlXCIsMSksZmFkZUluOntvcGFjaXR5Olwic2hvd1wifSxmYWRlT3V0OntvcGFjaXR5OlwiaGlkZVwifSxmYWRlVG9nZ2xlOntvcGFjaXR5OlwidG9nZ2xlXCJ9fSxmdW5jdGlvbihhLGIpe2YuZm5bYV09ZnVuY3Rpb24oYSxjLGQpe3JldHVybiB0aGlzLmFuaW1hdGUoYixhLGMsZCl9fSksZi5leHRlbmQoe3NwZWVkOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD1hJiZ0eXBlb2YgYT09XCJvYmplY3RcIj9mLmV4dGVuZCh7fSxhKTp7Y29tcGxldGU6Y3x8IWMmJmJ8fGYuaXNGdW5jdGlvbihhKSYmYSxkdXJhdGlvbjphLGVhc2luZzpjJiZifHxiJiYhZi5pc0Z1bmN0aW9uKGIpJiZifTtkLmR1cmF0aW9uPWYuZngub2ZmPzA6dHlwZW9mIGQuZHVyYXRpb249PVwibnVtYmVyXCI/ZC5kdXJhdGlvbjpkLmR1cmF0aW9uIGluIGYuZnguc3BlZWRzP2YuZnguc3BlZWRzW2QuZHVyYXRpb25dOmYuZnguc3BlZWRzLl9kZWZhdWx0O2lmKGQucXVldWU9PW51bGx8fGQucXVldWU9PT0hMClkLnF1ZXVlPVwiZnhcIjtkLm9sZD1kLmNvbXBsZXRlLGQuY29tcGxldGU9ZnVuY3Rpb24oYSl7Zi5pc0Z1bmN0aW9uKGQub2xkKSYmZC5vbGQuY2FsbCh0aGlzKSxkLnF1ZXVlP2YuZGVxdWV1ZSh0aGlzLGQucXVldWUpOmEhPT0hMSYmZi5fdW5tYXJrKHRoaXMpfTtyZXR1cm4gZH0sZWFzaW5nOntsaW5lYXI6ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIGMrZCphfSxzd2luZzpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4oLU1hdGguY29zKGEqTWF0aC5QSSkvMisuNSkqZCtjfX0sdGltZXJzOltdLGZ4OmZ1bmN0aW9uKGEsYixjKXt0aGlzLm9wdGlvbnM9Yix0aGlzLmVsZW09YSx0aGlzLnByb3A9YyxiLm9yaWc9Yi5vcmlnfHx7fX19KSxmLmZ4LnByb3RvdHlwZT17dXBkYXRlOmZ1bmN0aW9uKCl7dGhpcy5vcHRpb25zLnN0ZXAmJnRoaXMub3B0aW9ucy5zdGVwLmNhbGwodGhpcy5lbGVtLHRoaXMubm93LHRoaXMpLChmLmZ4LnN0ZXBbdGhpcy5wcm9wXXx8Zi5meC5zdGVwLl9kZWZhdWx0KSh0aGlzKX0sY3VyOmZ1bmN0aW9uKCl7aWYodGhpcy5lbGVtW3RoaXMucHJvcF0hPW51bGwmJighdGhpcy5lbGVtLnN0eWxlfHx0aGlzLmVsZW0uc3R5bGVbdGhpcy5wcm9wXT09bnVsbCkpcmV0dXJuIHRoaXMuZWxlbVt0aGlzLnByb3BdO3ZhciBhLGI9Zi5jc3ModGhpcy5lbGVtLHRoaXMucHJvcCk7cmV0dXJuIGlzTmFOKGE9cGFyc2VGbG9hdChiKSk/IWJ8fGI9PT1cImF1dG9cIj8wOmI6YX0sY3VzdG9tOmZ1bmN0aW9uKGEsYyxkKXtmdW5jdGlvbiBoKGEpe3JldHVybiBlLnN0ZXAoYSl9dmFyIGU9dGhpcyxnPWYuZng7dGhpcy5zdGFydFRpbWU9Y3J8fGNzKCksdGhpcy5lbmQ9Yyx0aGlzLm5vdz10aGlzLnN0YXJ0PWEsdGhpcy5wb3M9dGhpcy5zdGF0ZT0wLHRoaXMudW5pdD1kfHx0aGlzLnVuaXR8fChmLmNzc051bWJlclt0aGlzLnByb3BdP1wiXCI6XCJweFwiKSxoLnF1ZXVlPXRoaXMub3B0aW9ucy5xdWV1ZSxoLmVsZW09dGhpcy5lbGVtLGguc2F2ZVN0YXRlPWZ1bmN0aW9uKCl7ZS5vcHRpb25zLmhpZGUmJmYuX2RhdGEoZS5lbGVtLFwiZnhzaG93XCIrZS5wcm9wKT09PWImJmYuX2RhdGEoZS5lbGVtLFwiZnhzaG93XCIrZS5wcm9wLGUuc3RhcnQpfSxoKCkmJmYudGltZXJzLnB1c2goaCkmJiFjcCYmKGNwPXNldEludGVydmFsKGcudGljayxnLmludGVydmFsKSl9LHNob3c6ZnVuY3Rpb24oKXt2YXIgYT1mLl9kYXRhKHRoaXMuZWxlbSxcImZ4c2hvd1wiK3RoaXMucHJvcCk7dGhpcy5vcHRpb25zLm9yaWdbdGhpcy5wcm9wXT1hfHxmLnN0eWxlKHRoaXMuZWxlbSx0aGlzLnByb3ApLHRoaXMub3B0aW9ucy5zaG93PSEwLGEhPT1iP3RoaXMuY3VzdG9tKHRoaXMuY3VyKCksYSk6dGhpcy5jdXN0b20odGhpcy5wcm9wPT09XCJ3aWR0aFwifHx0aGlzLnByb3A9PT1cImhlaWdodFwiPzE6MCx0aGlzLmN1cigpKSxmKHRoaXMuZWxlbSkuc2hvdygpfSxoaWRlOmZ1bmN0aW9uKCl7dGhpcy5vcHRpb25zLm9yaWdbdGhpcy5wcm9wXT1mLl9kYXRhKHRoaXMuZWxlbSxcImZ4c2hvd1wiK3RoaXMucHJvcCl8fGYuc3R5bGUodGhpcy5lbGVtLHRoaXMucHJvcCksdGhpcy5vcHRpb25zLmhpZGU9ITAsdGhpcy5jdXN0b20odGhpcy5jdXIoKSwwKX0sc3RlcDpmdW5jdGlvbihhKXt2YXIgYixjLGQsZT1jcnx8Y3MoKSxnPSEwLGg9dGhpcy5lbGVtLGk9dGhpcy5vcHRpb25zO2lmKGF8fGU+PWkuZHVyYXRpb24rdGhpcy5zdGFydFRpbWUpe3RoaXMubm93PXRoaXMuZW5kLHRoaXMucG9zPXRoaXMuc3RhdGU9MSx0aGlzLnVwZGF0ZSgpLGkuYW5pbWF0ZWRQcm9wZXJ0aWVzW3RoaXMucHJvcF09ITA7Zm9yKGIgaW4gaS5hbmltYXRlZFByb3BlcnRpZXMpaS5hbmltYXRlZFByb3BlcnRpZXNbYl0hPT0hMCYmKGc9ITEpO2lmKGcpe2kub3ZlcmZsb3chPW51bGwmJiFmLnN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyYmZi5lYWNoKFtcIlwiLFwiWFwiLFwiWVwiXSxmdW5jdGlvbihhLGIpe2guc3R5bGVbXCJvdmVyZmxvd1wiK2JdPWkub3ZlcmZsb3dbYV19KSxpLmhpZGUmJmYoaCkuaGlkZSgpO2lmKGkuaGlkZXx8aS5zaG93KWZvcihiIGluIGkuYW5pbWF0ZWRQcm9wZXJ0aWVzKWYuc3R5bGUoaCxiLGkub3JpZ1tiXSksZi5yZW1vdmVEYXRhKGgsXCJmeHNob3dcIitiLCEwKSxmLnJlbW92ZURhdGEoaCxcInRvZ2dsZVwiK2IsITApO2Q9aS5jb21wbGV0ZSxkJiYoaS5jb21wbGV0ZT0hMSxkLmNhbGwoaCkpfXJldHVybiExfWkuZHVyYXRpb249PUluZmluaXR5P3RoaXMubm93PWU6KGM9ZS10aGlzLnN0YXJ0VGltZSx0aGlzLnN0YXRlPWMvaS5kdXJhdGlvbix0aGlzLnBvcz1mLmVhc2luZ1tpLmFuaW1hdGVkUHJvcGVydGllc1t0aGlzLnByb3BdXSh0aGlzLnN0YXRlLGMsMCwxLGkuZHVyYXRpb24pLHRoaXMubm93PXRoaXMuc3RhcnQrKHRoaXMuZW5kLXRoaXMuc3RhcnQpKnRoaXMucG9zKSx0aGlzLnVwZGF0ZSgpO3JldHVybiEwfX0sZi5leHRlbmQoZi5meCx7dGljazpmdW5jdGlvbigpe3ZhciBhLGI9Zi50aW1lcnMsYz0wO2Zvcig7YzxiLmxlbmd0aDtjKyspYT1iW2NdLCFhKCkmJmJbY109PT1hJiZiLnNwbGljZShjLS0sMSk7Yi5sZW5ndGh8fGYuZnguc3RvcCgpfSxpbnRlcnZhbDoxMyxzdG9wOmZ1bmN0aW9uKCl7Y2xlYXJJbnRlcnZhbChjcCksY3A9bnVsbH0sc3BlZWRzOntzbG93OjYwMCxmYXN0OjIwMCxfZGVmYXVsdDo0MDB9LHN0ZXA6e29wYWNpdHk6ZnVuY3Rpb24oYSl7Zi5zdHlsZShhLmVsZW0sXCJvcGFjaXR5XCIsYS5ub3cpfSxfZGVmYXVsdDpmdW5jdGlvbihhKXthLmVsZW0uc3R5bGUmJmEuZWxlbS5zdHlsZVthLnByb3BdIT1udWxsP2EuZWxlbS5zdHlsZVthLnByb3BdPWEubm93K2EudW5pdDphLmVsZW1bYS5wcm9wXT1hLm5vd319fSksZi5lYWNoKFtcIndpZHRoXCIsXCJoZWlnaHRcIl0sZnVuY3Rpb24oYSxiKXtmLmZ4LnN0ZXBbYl09ZnVuY3Rpb24oYSl7Zi5zdHlsZShhLmVsZW0sYixNYXRoLm1heCgwLGEubm93KSthLnVuaXQpfX0pLGYuZXhwciYmZi5leHByLmZpbHRlcnMmJihmLmV4cHIuZmlsdGVycy5hbmltYXRlZD1mdW5jdGlvbihhKXtyZXR1cm4gZi5ncmVwKGYudGltZXJzLGZ1bmN0aW9uKGIpe3JldHVybiBhPT09Yi5lbGVtfSkubGVuZ3RofSk7dmFyIGN3PS9edCg/OmFibGV8ZHxoKSQvaSxjeD0vXig/OmJvZHl8aHRtbCkkL2k7XCJnZXRCb3VuZGluZ0NsaWVudFJlY3RcImluIGMuZG9jdW1lbnRFbGVtZW50P2YuZm4ub2Zmc2V0PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXNbMF0sYztpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zi5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZi5vZmZzZXQuYm9keU9mZnNldChiKTt0cnl7Yz1iLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpfWNhdGNoKGQpe312YXIgZT1iLm93bmVyRG9jdW1lbnQsZz1lLmRvY3VtZW50RWxlbWVudDtpZighY3x8IWYuY29udGFpbnMoZyxiKSlyZXR1cm4gYz97dG9wOmMudG9wLGxlZnQ6Yy5sZWZ0fTp7dG9wOjAsbGVmdDowfTt2YXIgaD1lLmJvZHksaT1jeShlKSxqPWcuY2xpZW50VG9wfHxoLmNsaWVudFRvcHx8MCxrPWcuY2xpZW50TGVmdHx8aC5jbGllbnRMZWZ0fHwwLGw9aS5wYWdlWU9mZnNldHx8Zi5zdXBwb3J0LmJveE1vZGVsJiZnLnNjcm9sbFRvcHx8aC5zY3JvbGxUb3AsbT1pLnBhZ2VYT2Zmc2V0fHxmLnN1cHBvcnQuYm94TW9kZWwmJmcuc2Nyb2xsTGVmdHx8aC5zY3JvbGxMZWZ0LG49Yy50b3ArbC1qLG89Yy5sZWZ0K20taztyZXR1cm57dG9wOm4sbGVmdDpvfX06Zi5mbi5vZmZzZXQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXTtpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zi5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZi5vZmZzZXQuYm9keU9mZnNldChiKTt2YXIgYyxkPWIub2Zmc2V0UGFyZW50LGU9YixnPWIub3duZXJEb2N1bWVudCxoPWcuZG9jdW1lbnRFbGVtZW50LGk9Zy5ib2R5LGo9Zy5kZWZhdWx0VmlldyxrPWo/ai5nZXRDb21wdXRlZFN0eWxlKGIsbnVsbCk6Yi5jdXJyZW50U3R5bGUsbD1iLm9mZnNldFRvcCxtPWIub2Zmc2V0TGVmdDt3aGlsZSgoYj1iLnBhcmVudE5vZGUpJiZiIT09aSYmYiE9PWgpe2lmKGYuc3VwcG9ydC5maXhlZFBvc2l0aW9uJiZrLnBvc2l0aW9uPT09XCJmaXhlZFwiKWJyZWFrO2M9aj9qLmdldENvbXB1dGVkU3R5bGUoYixudWxsKTpiLmN1cnJlbnRTdHlsZSxsLT1iLnNjcm9sbFRvcCxtLT1iLnNjcm9sbExlZnQsYj09PWQmJihsKz1iLm9mZnNldFRvcCxtKz1iLm9mZnNldExlZnQsZi5zdXBwb3J0LmRvZXNOb3RBZGRCb3JkZXImJighZi5zdXBwb3J0LmRvZXNBZGRCb3JkZXJGb3JUYWJsZUFuZENlbGxzfHwhY3cudGVzdChiLm5vZGVOYW1lKSkmJihsKz1wYXJzZUZsb2F0KGMuYm9yZGVyVG9wV2lkdGgpfHwwLG0rPXBhcnNlRmxvYXQoYy5ib3JkZXJMZWZ0V2lkdGgpfHwwKSxlPWQsZD1iLm9mZnNldFBhcmVudCksZi5zdXBwb3J0LnN1YnRyYWN0c0JvcmRlckZvck92ZXJmbG93Tm90VmlzaWJsZSYmYy5vdmVyZmxvdyE9PVwidmlzaWJsZVwiJiYobCs9cGFyc2VGbG9hdChjLmJvcmRlclRvcFdpZHRoKXx8MCxtKz1wYXJzZUZsb2F0KGMuYm9yZGVyTGVmdFdpZHRoKXx8MCksaz1jfWlmKGsucG9zaXRpb249PT1cInJlbGF0aXZlXCJ8fGsucG9zaXRpb249PT1cInN0YXRpY1wiKWwrPWkub2Zmc2V0VG9wLG0rPWkub2Zmc2V0TGVmdDtmLnN1cHBvcnQuZml4ZWRQb3NpdGlvbiYmay5wb3NpdGlvbj09PVwiZml4ZWRcIiYmKGwrPU1hdGgubWF4KGguc2Nyb2xsVG9wLGkuc2Nyb2xsVG9wKSxtKz1NYXRoLm1heChoLnNjcm9sbExlZnQsaS5zY3JvbGxMZWZ0KSk7cmV0dXJue3RvcDpsLGxlZnQ6bX19LGYub2Zmc2V0PXtib2R5T2Zmc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPWEub2Zmc2V0VG9wLGM9YS5vZmZzZXRMZWZ0O2Yuc3VwcG9ydC5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldCYmKGIrPXBhcnNlRmxvYXQoZi5jc3MoYSxcIm1hcmdpblRvcFwiKSl8fDAsYys9cGFyc2VGbG9hdChmLmNzcyhhLFwibWFyZ2luTGVmdFwiKSl8fDApO3JldHVybnt0b3A6YixsZWZ0OmN9fSxzZXRPZmZzZXQ6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWYuY3NzKGEsXCJwb3NpdGlvblwiKTtkPT09XCJzdGF0aWNcIiYmKGEuc3R5bGUucG9zaXRpb249XCJyZWxhdGl2ZVwiKTt2YXIgZT1mKGEpLGc9ZS5vZmZzZXQoKSxoPWYuY3NzKGEsXCJ0b3BcIiksaT1mLmNzcyhhLFwibGVmdFwiKSxqPShkPT09XCJhYnNvbHV0ZVwifHxkPT09XCJmaXhlZFwiKSYmZi5pbkFycmF5KFwiYXV0b1wiLFtoLGldKT4tMSxrPXt9LGw9e30sbSxuO2o/KGw9ZS5wb3NpdGlvbigpLG09bC50b3Asbj1sLmxlZnQpOihtPXBhcnNlRmxvYXQoaCl8fDAsbj1wYXJzZUZsb2F0KGkpfHwwKSxmLmlzRnVuY3Rpb24oYikmJihiPWIuY2FsbChhLGMsZykpLGIudG9wIT1udWxsJiYoay50b3A9Yi50b3AtZy50b3ArbSksYi5sZWZ0IT1udWxsJiYoay5sZWZ0PWIubGVmdC1nLmxlZnQrbiksXCJ1c2luZ1wiaW4gYj9iLnVzaW5nLmNhbGwoYSxrKTplLmNzcyhrKX19LGYuZm4uZXh0ZW5kKHtwb3NpdGlvbjpmdW5jdGlvbigpe2lmKCF0aGlzWzBdKXJldHVybiBudWxsO3ZhciBhPXRoaXNbMF0sYj10aGlzLm9mZnNldFBhcmVudCgpLGM9dGhpcy5vZmZzZXQoKSxkPWN4LnRlc3QoYlswXS5ub2RlTmFtZSk/e3RvcDowLGxlZnQ6MH06Yi5vZmZzZXQoKTtjLnRvcC09cGFyc2VGbG9hdChmLmNzcyhhLFwibWFyZ2luVG9wXCIpKXx8MCxjLmxlZnQtPXBhcnNlRmxvYXQoZi5jc3MoYSxcIm1hcmdpbkxlZnRcIikpfHwwLGQudG9wKz1wYXJzZUZsb2F0KGYuY3NzKGJbMF0sXCJib3JkZXJUb3BXaWR0aFwiKSl8fDAsZC5sZWZ0Kz1wYXJzZUZsb2F0KGYuY3NzKGJbMF0sXCJib3JkZXJMZWZ0V2lkdGhcIikpfHwwO3JldHVybnt0b3A6Yy50b3AtZC50b3AsbGVmdDpjLmxlZnQtZC5sZWZ0fX0sb2Zmc2V0UGFyZW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vZmZzZXRQYXJlbnR8fGMuYm9keTt3aGlsZShhJiYhY3gudGVzdChhLm5vZGVOYW1lKSYmZi5jc3MoYSxcInBvc2l0aW9uXCIpPT09XCJzdGF0aWNcIilhPWEub2Zmc2V0UGFyZW50O3JldHVybiBhfSl9fSksZi5lYWNoKFtcIkxlZnRcIixcIlRvcFwiXSxmdW5jdGlvbihhLGMpe3ZhciBkPVwic2Nyb2xsXCIrYztmLmZuW2RdPWZ1bmN0aW9uKGMpe3ZhciBlLGc7aWYoYz09PWIpe2U9dGhpc1swXTtpZighZSlyZXR1cm4gbnVsbDtnPWN5KGUpO3JldHVybiBnP1wicGFnZVhPZmZzZXRcImluIGc/Z1thP1wicGFnZVlPZmZzZXRcIjpcInBhZ2VYT2Zmc2V0XCJdOmYuc3VwcG9ydC5ib3hNb2RlbCYmZy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbZF18fGcuZG9jdW1lbnQuYm9keVtkXTplW2RdfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtnPWN5KHRoaXMpLGc/Zy5zY3JvbGxUbyhhP2YoZykuc2Nyb2xsTGVmdCgpOmMsYT9jOmYoZykuc2Nyb2xsVG9wKCkpOnRoaXNbZF09Y30pfX0pLGYuZWFjaChbXCJIZWlnaHRcIixcIldpZHRoXCJdLGZ1bmN0aW9uKGEsYyl7dmFyIGQ9Yy50b0xvd2VyQ2FzZSgpO2YuZm5bXCJpbm5lclwiK2NdPWZ1bmN0aW9uKCl7dmFyIGE9dGhpc1swXTtyZXR1cm4gYT9hLnN0eWxlP3BhcnNlRmxvYXQoZi5jc3MoYSxkLFwicGFkZGluZ1wiKSk6dGhpc1tkXSgpOm51bGx9LGYuZm5bXCJvdXRlclwiK2NdPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXNbMF07cmV0dXJuIGI/Yi5zdHlsZT9wYXJzZUZsb2F0KGYuY3NzKGIsZCxhP1wibWFyZ2luXCI6XCJib3JkZXJcIikpOnRoaXNbZF0oKTpudWxsfSxmLmZuW2RdPWZ1bmN0aW9uKGEpe3ZhciBlPXRoaXNbMF07aWYoIWUpcmV0dXJuIGE9PW51bGw/bnVsbDp0aGlzO2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWYodGhpcyk7Y1tkXShhLmNhbGwodGhpcyxiLGNbZF0oKSkpfSk7aWYoZi5pc1dpbmRvdyhlKSl7dmFyIGc9ZS5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbXCJjbGllbnRcIitjXSxoPWUuZG9jdW1lbnQuYm9keTtyZXR1cm4gZS5kb2N1bWVudC5jb21wYXRNb2RlPT09XCJDU1MxQ29tcGF0XCImJmd8fGgmJmhbXCJjbGllbnRcIitjXXx8Z31pZihlLm5vZGVUeXBlPT09OSlyZXR1cm4gTWF0aC5tYXgoZS5kb2N1bWVudEVsZW1lbnRbXCJjbGllbnRcIitjXSxlLmJvZHlbXCJzY3JvbGxcIitjXSxlLmRvY3VtZW50RWxlbWVudFtcInNjcm9sbFwiK2NdLGUuYm9keVtcIm9mZnNldFwiK2NdLGUuZG9jdW1lbnRFbGVtZW50W1wib2Zmc2V0XCIrY10pO2lmKGE9PT1iKXt2YXIgaT1mLmNzcyhlLGQpLGo9cGFyc2VGbG9hdChpKTtyZXR1cm4gZi5pc051bWVyaWMoaik/ajppfXJldHVybiB0aGlzLmNzcyhkLHR5cGVvZiBhPT1cInN0cmluZ1wiP2E6YStcInB4XCIpfX0pLGEualF1ZXJ5PWEuJD1mLHR5cGVvZiBkZWZpbmU9PVwiZnVuY3Rpb25cIiYmZGVmaW5lLmFtZCYmZGVmaW5lLmFtZC5qUXVlcnkmJmRlZmluZShcImpxdWVyeVwiLFtdLGZ1bmN0aW9uKCl7cmV0dXJuIGZ9KX07IiwibW9kdWxlLmV4cG9ydHMgPSAoZnVuY3Rpb24oJCl7XG5cbiAgcmVxdWlyZSgnLi9qcXVlcnkubWlzYy1wbHVnaW5zLmpzJykoJCk7XG4gIHJlcXVpcmUoJy4vanF1ZXJ5LnRpcHRpcC5qcycpKCQpOyAgXG4gIHJlcXVpcmUoJy4vanF1ZXJ5LmZhcmJ0YXN0aWMuanMnKSgkKTtcbiAgXG4gIHZhciBfID0gcmVxdWlyZSgnLi4vdW5kZXJzY29yZS5taW4uanMnKTtcbiAgLy8gU3VtIGVsZW1lbnRzIG9mIGFuIGFycmF5XG4gIF8uc3VtID0gZnVuY3Rpb24oYXJyKSB7IHJldHVybiBfLnJlZHVjZShhcnIsIGZ1bmN0aW9uKG1lbW8sIG5leHQpIHsgcmV0dXJuIG1lbW8gKyBuZXh0OyB9LCAwKTsgfVxuXG4gIHZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMuanMnKSgkKSxcbiAgICBjbGFzc0ZyaWVuZGx5ID0gdXRpbHMuY2xhc3NGcmllbmRseSxcbiAgICBmcHMgPSB1dGlscy5mcHMsXG4gICAgYmFzZW5hbWUgPSB1dGlscy5iYXNlbmFtZSxcbiAgICBmbG9vckhhY2sgPSB1dGlscy5mbG9vckhhY2ssXG4gICAgZGVjb2RlU2FmZU9jdGV0cyA9IHV0aWxzLmRlY29kZVNhZmVPY3RldHMsXG4gICAgcmVnRXhwUXVvdGUgPSB1dGlscy5yZWdFeHBRdW90ZTtcblxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbiAgLy9cbiAgLy8gV2UgaGF2ZSB0aHJlZSB3aWRnZXRzIHRoYXQgYXJlIGJ1aWx0IG9uIHRoZSBqUXVlcnkgVUkgJC53aWRnZXQgZnJhbWV3b3JrXG4gIC8vICAgIDEpICQudWkuZ2Vub2Jyb3dzZXJcbiAgLy8gICAgMikgJC51aS5nZW5vbGluZVxuICAvLyAgICAzKSAkLnVpLmdlbm90cmFja1xuICAvL1xuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuICByZXF1aXJlKCcuL2pxdWVyeS11aS5nZW5vbGluZS5qcycpKCQpO1xuICByZXF1aXJlKCcuL2pxdWVyeS11aS5nZW5vdHJhY2suanMnKSgkKTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gPSAkLnVpLmdlbm9icm93c2VyIGlzIHRoZSBjZW50cmFsIHdpZGdldCB0aGF0IGNvb3JkaW5hdGVzIHRoZSBmcm9udC1lbmQgb2YgY2hyb21vem9vbSA9XG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICQud2lkZ2V0KCd1aS5nZW5vYnJvd3NlcicsIHtcblxuICAgIC8vIERlZmF1bHQgb3B0aW9ucyB0aGF0IGFyZSBvdmVycmlkZGVuIGJ5IHRoZSBnZW5vbWUgSlNPTiBjb25maWd1cmF0aW9uIHdoZW4gdGhpcyB3aWRnZXQgaXMgaW5zdGFudGlhdGVkXG4gICAgb3B0aW9uczoge1xuICAgICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgICAgYmV0d2VlbkxpbmVzOiAyMCxcbiAgICAgIHRpbGVXaWR0aDogMTAwMCxcbiAgICAgIGdlbm9tZTogJ2hnMTgnLFxuICAgICAgZ2Vub21lU2l6ZTogMzA4MDQxOTQ4MCxcbiAgICAgIHNpZGVCYXJXaWR0aDogMTAwLFxuICAgICAgdHJhY2tzOiBbXG4gICAgICAgIHtuOidydWxlcicsIGg6NTAsIHM6WydkZW5zZSddfVxuICAgICAgXSxcbiAgICAgIGNock9yZGVyOiBbXSxcbiAgICAgIGNockxlbmd0aHM6IHt9LFxuICAgICAgY2hyQmFuZHM6IFtdLFxuICAgICAgYXZhaWxUcmFja3M6IFtdLFxuICAgICAgdGlsZURpcjogJ28vJyxcbiAgICAgIGFqYXhEaXI6ICdwaHAvJyxcbiAgICAgIGJwcHBzOiBbMi45ZTVdLFxuICAgICAgb3Zlcnpvb21CcHBwczogW10sXG4gICAgICBpbml0Wm9vbTogMi45ZTUsXG4gICAgICBpZGVvZ3JhbXNBYm92ZTogMy4zZTQsXG4gICAgICBicHBwTnVtYmVyc0JlbG93OiBbMy4zZTQsIDMuM2UzXSxcbiAgICAgIG50c0JlbG93OiBbMSwgMC4xXSxcbiAgICAgIG5hdkJhcjogJyNuYXZiYXInLFxuICAgICAgZm9vdGVyQmFyOiAnI2Zvb3RlcmJhcicsXG4gICAgICB6b29tU2xpZGVyOiAnI3pvb20nLFxuICAgICAgem9vbUJ0bnM6IFsnI3pvb20taW4nLCAnI3pvb20tb3V0J10sXG4gICAgICB0cmFja1BpY2tlcjogWycjdHJhY2tzJywgJyN0cmFjay1waWNrZXInLCAnI2N1c3RvbS10cmFja3MnLCAnI2N1c3RvbS1waWNrZXInXSxcbiAgICAgIGp1bXA6IFsnI2xvYycsICcjanVtcCcsICcjbG9jLXBpY2tlciddLFxuICAgICAgZ2Vub21lUGlja2VyOiBbJyNnZW5vbWUnLCAnI2dlbm9tZS1waWNrZXInXSxcbiAgICAgIGxpbmVNb2RlOiAnI2xpbmUtbW9kZScsXG4gICAgICBsaW5raW5nOiBbJyNsaW5raW5nJywgJyNsaW5rLXBpY2tlciddLFxuICAgICAgb3ZlcmxheTogWycjb3ZlcmxheScsICcjb3ZlcmxheS1tZXNzYWdlJ10sXG4gICAgICBsaW5lRml4RHVyYXRpb246IDUwMCxcbiAgICAgIHJldGljT3BhY2l0eTogMC44LFxuICAgICAgdmVydGljYWxEcmFnRGVhZFpvbmU6IDEyLFxuICAgICAgbWF4TnRSZXF1ZXN0OiAyMDAwMCxcbiAgICAgIGJvdW5jZU1hcmdpbjogMC4yLFxuICAgICAgZGlhbG9nczogWycjY3VzdG9tLWRpYWxvZycsICcjcXVpY2tzdGFydCcsICcjYWJvdXQnLCAnI29sZC1tc2llJywgJyNjaHJvbS1zaXplcy1kaWFsb2cnLCAnI2N1c3RvbS1nZW5vbWUtZGlhbG9nJywgJyNiaW5hcmllcy13YXJuaW5nLWRpYWxvZyddLFxuICAgICAgdWNzY1VSTDogJ2h0dHA6Ly9nZW5vbWUudWNzYy5lZHUvY2dpLWJpbi9oZ1RyYWNrcycsXG4gICAgICB0cmFja0Rlc2NVUkw6ICdodHRwOi8vZ2Vub21lLnVjc2MuZWR1L2NnaS1iaW4vaGdUcmFja1VpJyxcbiAgICAgIGJwcHBGb3JtYXQ6IGZ1bmN0aW9uKGJwcHApIHsgcmV0dXJuIGJwcHAudG9FeHBvbmVudGlhbCgyKS5yZXBsYWNlKC8oXFwrfC0pKFxcZCkkLywgJyQxMCQyJyk7IH0sXG4gICAgICB1c2VDYW52YXNUaWNrczogdHJ1ZSxcbiAgICAgIHNhdmFibGVQYXJhbXM6IHtzZXNzaW9uOiBbJ3Bvc2l0aW9uJywgJ3RyYWNrcyddLCBwZXJzaXN0ZW50OiBbJ21vZGUnXX1cbiAgICAgIC8vLHNuYXBab29tOiB0cnVlXG4gICAgICAvLyxzbmFwWm9vbUFmdGVyOiAyMDBcbiAgICB9LFxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyA9IFRoZSBmb2xsb3dpbmcgX2luaXQgZnVuY3Rpb25zIGhhbmRsZSBpbnN0YW50aWF0aW9uLXJlbGF0ZWQgdGFza3MgPVxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAvLyBDYWxsZWQgYXV0b21hdGljYWxseSB3aGVuIHdpZGdldCBpcyBpbnN0YW50aWF0ZWRcbiAgICBfaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgICRlbGVtID0gc2VsZi5lbGVtZW50LCBcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucztcbiAgICAgIFxuICAgICAgLy8gU2V0dXAgaW50ZXJuYWwgdmFyaWFibGVzXG4gICAgICBzZWxmLl9pbml0SW5zdGFuY2VWYXJzKCk7XG4gICAgICBcbiAgICAgIC8vIEluaXRpYWxpemUgc29tZSBvZiB0aGUgbmF2YmFyIHdpZGdldHNcbiAgICAgIHNlbGYuJHNsaWRlciA9IHNlbGYuX2luaXRTbGlkZXIoKTtcbiAgICAgIHNlbGYuJHRyYWNrUGlja2VyID0gc2VsZi5faW5pdFRyYWNrUGlja2VyKCk7XG4gICAgICBzZWxmLiRjdXN0b21UcmFja3MgPSBzZWxmLl9pbml0Q3VzdG9tVHJhY2tzKCk7XG4gICAgICBzZWxmLiRsaW5rcyA9IHNlbGYuX2luaXRMaW5raW5nKCk7XG4gICAgICBcbiAgICAgIC8vIERlYm91bmNlIHNvbWUgb2YgdGhlIGhhbmRsZXIgZnVuY3Rpb25zOyB0aGlzIHByZXZlbnRzIGl0IGZyb20gZmlyaW5nIG1vcmUgdGhhbiBvbmNlIHBlciBYIG1pbGxpc2Vjb25kc1xuICAgICAgLy8gVGhpcyBjdXRzIGRvd24gb24gdGhlIGxvYWQgb2Ygc29tZSBvZiB0aGUgbW9yZSBleHBlbnNpdmUgYWN0aW9uc1xuICAgICAgc2VsZi5fZmluaXNoWm9vbURlYm91bmNlZCA9IF8uZGVib3VuY2Uoc2VsZi5fZmluaXNoWm9vbURlYm91bmNlZCwgby5zbmFwWm9vbUFmdGVyIHx8IDUwMCk7XG4gICAgICBzZWxmLl91cGRhdGVSZXRpY2xlRGVib3VuY2VkID0gXy5kZWJvdW5jZShzZWxmLl91cGRhdGVSZXRpY2xlLCBvLnNuYXBab29tQWZ0ZXIgfHwgNTAwKTtcbiAgICAgIHNlbGYuX25vcm1hbGl6ZVBvc0RlYm91bmNlZCA9IF8uZGVib3VuY2Uoc2VsZi5ub3JtYWxpemVQb3MsIDIwMCk7XG4gICAgICBzZWxmLl9maXhab29tZWRUcmFja0RlYm91bmNlZCA9IF8uZGVib3VuY2Uoc2VsZi5fZml4Wm9vbWVkVHJhY2tEZWJvdW5jZWQsIDUwMCk7XG4gICAgICBzZWxmLl9maXhDbGlja0FyZWFzRGVib3VuY2VkID0gXy5kZWJvdW5jZShzZWxmLl9maXhDbGlja0FyZWFzRGVib3VuY2VkLCA1MDApO1xuICAgICAgc2VsZi5fc2F2ZVBhcmFtc0RlYm91bmNlZCA9IF8uZGVib3VuY2Uoc2VsZi5fc2F2ZVBhcmFtc0RlYm91bmNlZCwgNTAwKTtcbiAgICAgIFxuICAgICAgLy8gQmluZCBldmVudCBoYW5kbGVycyBmb3IgdGhlIHdpbmRvdyBhbmQgbWFpbiB3aWRnZXRzXG4gICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKGUsIGNhbGxiYWNrKSB7IFxuICAgICAgICBpZiAodGhpcyA9PSBlLnRhcmdldCkge1xuICAgICAgICAgIHNlbGYuX3dpZHRoID0gJGVsZW0ud2lkdGgoKTtcbiAgICAgICAgICBzZWxmLl9maXhOdW1MaW5lcyhudWxsLCB7ZHVyYXRpb246IDAsIGNvbXBsZXRlOiBjYWxsYmFja30pO1xuICAgICAgICAgICQoby5uYXZCYXIpLnRvZ2dsZUNsYXNzKCduYXJyb3cnLCBzZWxmLl93aWR0aCA8IDk1MCkuZmluZCgnLnBpY2tlcicpLnRyaWdnZXIoJ3JlbWF4aGVpZ2h0Jyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgJChkb2N1bWVudC5ib2R5KS5iaW5kKCdET01Nb3VzZVNjcm9sbCBtb3VzZXdoZWVsJywgXy5iaW5kKHNlbGYuX3JlY3Zab29tLCBzZWxmKSk7XG4gICAgICAkKG8uem9vbUJ0bnNbMF0pLmNsaWNrKGZ1bmN0aW9uKCkgeyBkZWxldGUgc2VsZi5jZW50ZXJlZE9uOyBzZWxmLl9hbmltYXRlWm9vbSh0cnVlLCAxMDAwKTsgfSk7XG4gICAgICAkKG8uem9vbUJ0bnNbMV0pLmNsaWNrKGZ1bmN0aW9uKCkgeyBkZWxldGUgc2VsZi5jZW50ZXJlZE9uOyBzZWxmLl9hbmltYXRlWm9vbShmYWxzZSwgMTAwMCk7IH0pO1xuICAgICAgJGVsZW0ubW91c2VlbnRlcihmdW5jdGlvbigpIHsgc2VsZi5zaG93UmV0aWNsZSgnbW91c2VBcmVhJywgZmFsc2UpOyB9KTtcbiAgICAgICRlbGVtLm1vdXNlbGVhdmUoZnVuY3Rpb24oKSB7IHNlbGYuc2hvd1JldGljbGUoJ21vdXNlQXJlYScsIHRydWUpOyB9KTtcbiAgICAgICQoby5saW5lTW9kZSkuYnV0dG9uc2V0KCkuY2xpY2soZnVuY3Rpb24oKSB7IHNlbGYuX2ZpeE51bUxpbmVzKHNlbGYuY2VudHJhbExpbmUpOyB9KTtcbiAgICAgICQoby5saW5lTW9kZSkuZmluZCgnaW5wdXQsYScpLmZvY3VzKGZ1bmN0aW9uKCkgeyB2YXIgJHQgPSAkKHRoaXMpOyBfLmRlZmVyKGZ1bmN0aW9uKCkgeyAkdC5ibHVyKCk7IH0pOyB9KTtcbiAgICAgICRlbGVtLmJpbmQoJ3RyYWNrbG9hZCcsIF8uYmluZChzZWxmLl9yZWN2VHJhY2tMb2FkLCBzZWxmKSk7XG4gICAgICAkKHdpbmRvdykuYmluZCgncG9wc3RhdGUnLCBmdW5jdGlvbigpIHsgc2VsZi5faW5pdEZyb21QYXJhbXMobnVsbCwgdHJ1ZSk7IH0pO1xuICAgICAgXG4gICAgICAvLyBJbml0aWFsaXplIHRoZSBmb290ZXIsIHRoZSBzZWFyY2ggYmFyLCBob3RrZXlzLCB0aGUgQUpBWCBwcm94eSwgbW9iaWxlIGludGVyYWN0aW9ucywgSUUgZml4ZXNcbiAgICAgIC8vIEZpbmFsbHksIGFwcGx5IHBhcmFtcyBmcm9tIGVpdGhlciB0aGUgVVJMIG9yIHRoZSBzZXNzaW9uIHN0YXRlXG4gICAgICBzZWxmLl9pbml0Rm9vdGVyKCk7XG4gICAgICBzZWxmLl9pbml0SnVtcCgpO1xuICAgICAgc2VsZi5faW5pdEhvdGtleXMoKTtcbiAgICAgIHNlbGYuX2luaXRBamF4KCk7XG4gICAgICBzZWxmLl9pbml0TW9iaWxlRmVhdHVyZXMoKTtcbiAgICAgIGlmICgkLmJyb3dzZXIubXNpZSkgeyBzZWxmLl9pbml0SUVGaXhlcygpOyB9XG4gICAgICAkKHdpbmRvdykudHJpZ2dlcigncmVzaXplJywgZnVuY3Rpb24oKSB7IHNlbGYuX2luaXRGcm9tUGFyYW1zKG51bGwsIHRydWUpOyB9KTtcbiAgICB9LFxuICAgIFxuICAgIC8vIENhbGxlZCB3aGVuIGEgbmV3IG9wdGlvbnMgb2JqZWN0IGlzIHBhc3NlZCBpbiwgdHlwaWNhbGx5IGFmdGVyIGEgY3VzdG9tIGdlbm9tZSBpcyBsb2FkZWRcbiAgICBfc2V0T3B0aW9uczogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgdHJhY2tzVG9QYXJzZSxcbiAgICAgICAgZmluaXNoU2V0dXBBZnRlclBhcnNpbmcsXG4gICAgICAgICRvdmVybGF5ID0gJChvLm92ZXJsYXlbMF0pLFxuICAgICAgICAkb3ZlcmxheU1lc3NhZ2UgPSAkKG8ub3ZlcmxheVsxXSksXG4gICAgICAgIG5leHREaXJlY3RpdmVzID0gXy5leHRlbmQoe30sIHNlbGYuX25leHREaXJlY3RpdmVzKTtcbiAgICAgIHNlbGYuX3Jlc2V0Q3VzdG9tVHJhY2tzKCk7XG4gICAgICBzZWxmLl9yZW1vdmVMaW5lcyhzZWxmLiRsaW5lcy5sZW5ndGgsIHtkdXJhdGlvbjogMH0pO1xuXG4gICAgICBvID0gXy5leHRlbmQoc2VsZi5vcHRpb25zLCBvcHRpb25zKTtcbiAgICAgIFxuICAgICAgc2VsZi5faW5pdEluc3RhbmNlVmFycygpO1xuICAgICAgXG4gICAgICB0cmFja3NUb1BhcnNlID0gXy5maWx0ZXIoby5hdmFpbFRyYWNrcywgZnVuY3Rpb24odCkgeyByZXR1cm4gdC5jdXN0b21EYXRhOyB9KTtcbiAgICAgIC8vIGEgc3Vic2V0IG9mIG9wdGlvbnMgdGhhdCBDdXN0b21UcmFja3MgbmVlZHMgdG8gcGFyc2UgdHJhY2tzXG4gICAgICBmdW5jdGlvbiBicm93c2VyT3B0cygpIHtcbiAgICAgICAgdmFyIHBvcyA9IG5leHREaXJlY3RpdmVzLnBvc2l0aW9uICYmIHNlbGYubm9ybWFsaXplUG9zKG5leHREaXJlY3RpdmVzLnBvc2l0aW9uLCB0cnVlKTtcbiAgICAgICAgcG9zID0gcG9zID8gcG9zLnBvcyA6IHNlbGYucG9zO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGJwcHBzOiBvLmJwcHBzLFxuICAgICAgICAgIGNoclBvczogc2VsZi5jaHJQb3MsXG4gICAgICAgICAgcG9zOiBwb3MsXG4gICAgICAgICAgY2hyTGVuZ3Roczogby5jaHJMZW5ndGhzLFxuICAgICAgICAgIGdlbm9tZVNpemU6IG8uZ2Vub21lU2l6ZSxcbiAgICAgICAgICBhamF4RGlyOiBvLmFqYXhEaXJcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gZmluaXNoU2V0dXAoKSB7XG4gICAgICAgIF8uZWFjaChvLnRyYWNrcywgZnVuY3Rpb24odCl7IFxuICAgICAgICAgICQuZXh0ZW5kKHQsIHNlbGYuYXZhaWxUcmFja3NbdC5uXSk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgc2VsZi4kc2xpZGVyID0gc2VsZi5faW5pdFNsaWRlcigpO1xuICAgICAgICBzZWxmLiR0cmFja1BpY2tlciA9IHNlbGYuX2luaXRUcmFja1BpY2tlcigpO1xuICAgICAgICBzZWxmLl91cGRhdGVHZW5vbWVzKCk7XG4gICAgICBcbiAgICAgICAgJG92ZXJsYXkuYWRkKCRvdmVybGF5TWVzc2FnZSkuaGlkZSgpO1xuICAgICAgICAkKHdpbmRvdykudHJpZ2dlcigncmVzaXplJywgZnVuY3Rpb24oKSB7IFxuICAgICAgICAgIHNlbGYuX25leHREaXJlY3RpdmVzID0ge307XG4gICAgICAgICAgaWYgKF8ua2V5cyhuZXh0RGlyZWN0aXZlcykubGVuZ3RoKSB7IHNlbGYuX2luaXRGcm9tUGFyYW1zKG5leHREaXJlY3RpdmVzKTsgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKHRyYWNrc1RvUGFyc2UubGVuZ3RoID4gMCkge1xuICAgICAgICBmaW5pc2hTZXR1cEFmdGVyUGFyc2luZyA9IF8uYWZ0ZXIodHJhY2tzVG9QYXJzZS5sZW5ndGgsIGZpbmlzaFNldHVwKTtcbiAgICAgICAgXy5lYWNoKHRyYWNrc1RvUGFyc2UsIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICBDdXN0b21UcmFja3MucGFyc2VBc3luYyh0LmN1c3RvbURhdGEsIGJyb3dzZXJPcHRzKCksIGZ1bmN0aW9uKGN1c3RvbVRyYWNrcykge1xuICAgICAgICAgICAgdmFyIGN1c3RvbVRyYWNrID0gY3VzdG9tVHJhY2tzWzBdOyAvLyB0LmN1c3RvbURhdGEgc2hvdWxkIG9ubHkgY29udGFpbiBkYXRhIGZvciBvbmUgdHJhY2tcbiAgICAgICAgICAgIF8uZWFjaChvLmJwcHBzLCBmdW5jdGlvbihicHBwKSB7IFxuICAgICAgICAgICAgICBzZWxmLmF2YWlsVHJhY2tzW3Qubl0uZmhbby5icHBwRm9ybWF0KGJwcHApXSA9IHtkZW5zZTogY3VzdG9tVHJhY2suaGVpZ2h0cy5taW59OyBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2VsZi5hdmFpbFRyYWNrc1t0Lm5dLmN1c3RvbSA9IHQuY3VzdG9tID0gY3VzdG9tVHJhY2s7XG4gICAgICAgICAgICBmaW5pc2hTZXR1cEFmdGVyUGFyc2luZygpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7IGZpbmlzaFNldHVwKCk7IH1cbiAgICB9LFxuICAgIFxuICAgIF9pbml0SW5zdGFuY2VWYXJzOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgIHAgPSAwO1xuICAgICAgICBcbiAgICAgIC8vIFNldHVwIGludGVybmFsIHZhcmlhYmxlcyByZWxhdGVkIHRvIGNocm9tb3NvbWUgYmFuZHMsIGxlbmd0aHMsIGFuZCBhdmFpbGFibGUgdHJhY2tzXG4gICAgICBzZWxmLmNoclBvcyA9IHt9O1xuICAgICAgby5jaHJMYWJlbHMgPSBbXTtcbiAgICAgIF8uZWFjaChvLmNock9yZGVyLCBmdW5jdGlvbih2LCBpKXsgXG4gICAgICAgIG8uY2hyTGFiZWxzLnB1c2goe3A6IHAsIG46IHYsIHc6IG8uY2hyTGVuZ3Roc1t2XX0pOyBzZWxmLmNoclBvc1t2XSA9IHA7IHAgKz0gby5jaHJMZW5ndGhzW3ZdO1xuICAgICAgfSk7XG4gICAgICBvLmNockxhYmVscy5wdXNoKHtwOiBwLCBuOiAnJywgZW5kOiB0cnVlfSk7IC8vIG9uZSBtb3JlIGxhYmVsIGZvciB0aGUgZW5kIG9mIHRoZSBsYXN0IGNocm9tb3NvbWVcbiAgICAgIF8uZWFjaChvLmNockJhbmRzLCBmdW5jdGlvbih2KXsgdls1XSA9IHZbMV07IHZbMV0gKz0gc2VsZi5jaHJQb3NbdlswXV07IHZbMl0gKz0gc2VsZi5jaHJQb3NbdlswXV07IH0pO1xuICAgICAgby5jaHJCYW5kcyA9IG8uY2hyQmFuZHMgJiYgXy5zb3J0Qnkoby5jaHJCYW5kcywgZnVuY3Rpb24odikgeyByZXR1cm4gXy5pbmRleE9mKG8uY2hyT3JkZXIsIHZbMF0pICogby5nZW5vbWVTaXplICsgdlsxXTsgfSk7XG4gICAgICBzZWxmLmF2YWlsVHJhY2tzID0ge307XG4gICAgICBzZWxmLmRlZmF1bHRUcmFja3MgPSBbXTtcbiAgICAgIF8uZWFjaChvLmF2YWlsVHJhY2tzLCBmdW5jdGlvbih2KSB7IHNlbGYuYXZhaWxUcmFja3Nbdi5uXSA9ICQuZXh0ZW5kKHt9LCB2LCB7b2g6IHYuaH0pOyB9KTtcbiAgICAgIF8uZWFjaChvLnRyYWNrcywgZnVuY3Rpb24odCl7IFxuICAgICAgICAkLmV4dGVuZCh0LCBzZWxmLmF2YWlsVHJhY2tzW3Qubl0pO1xuICAgICAgICBzZWxmLmRlZmF1bHRUcmFja3MucHVzaCh7bjogdC5uLCBoOiB0Lmh9KTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBTZXR1cCByZW1haW5pbmcgaW50ZXJuYWwgdmFyaWFibGVzXG4gICAgICBzZWxmLiRsaW5lcyA9ICRlbGVtLmNoaWxkcmVuKCcuYnJvd3Nlci1saW5lJyk7XG4gICAgICBzZWxmLnBvcyA9IDE7IC8vIHRoaXMgaXMgdGhlIGJwIHBvc2l0aW9uIG9mIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIHRvcCBsaW5lXG4gICAgICBzZWxmLmJwcHAgPSBvLmluaXRab29tO1xuICAgICAgc2VsZi5fZGVuc2l0eU9yZGVyID0ge307XG4gICAgICBzZWxmLl9kZW5zaXR5T3JkZXJGb3IgPSB7fTtcbiAgICAgIHNlbGYuX2FyZWFJbmRleCA9IHt9O1xuICAgICAgc2VsZi5fYXJlYUhvdmVyID0gbnVsbDtcbiAgICAgIHNlbGYuX3RpbGVGaXhpbmdFbmFibGVkID0gdHJ1ZTtcbiAgICAgIHNlbGYuX3Nob3dSZXRpY2xlID0ge21vdXNlQXJlYTogZmFsc2UsIGRyYWdnaW5nOiBmYWxzZSwgaG90S2V5czogZmFsc2V9O1xuICAgICAgc2VsZi5fZGVmYXVsdExpbmVNb2RlID0gJChvLmxpbmVNb2RlKS5maW5kKCc6Y2hlY2tlZCcpLnZhbCgpO1xuICAgICAgc2VsZi5fZG5hID0ge307XG4gICAgfSxcbiAgICBcbiAgICBfaW5pdFNsaWRlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICBpZiAoIW8ub3Zlcnpvb21CcHBwcykgeyBvLm92ZXJ6b29tQnBwcHMgPSBbXTsgfVxuICAgICAgXG4gICAgICB2YXIgJHNsaWRlciA9ICQoby56b29tU2xpZGVyKSxcbiAgICAgICAgbnVtQnBwcHMgPSBvLmJwcHBzLmxlbmd0aCArIG8ub3Zlcnpvb21CcHBwcy5sZW5ndGgsXG4gICAgICAgIHNsaWRlcldpZHRoID0gKG51bUJwcHBzIC0gMSkgKiAxMCxcbiAgICAgICAgc2xpZGVyQnBwcHMgPSAoc2VsZi5zbGlkZXJCcHBwcyA9IG8uYnBwcHMuY29uY2F0KG8ub3Zlcnpvb21CcHBwcykpLFxuICAgICAgICBwcmV2VmFscyA9IFtdLFxuICAgICAgICAkdGlja3M7XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIHN0YXJ0KGUsIHVpKSB7IGRlbGV0ZSBzZWxmLmNlbnRlcmVkT247IH07XG4gICAgICBmdW5jdGlvbiBzbGlkZShlLCB1aSkge1xuICAgICAgICB2YXIgaWR4ID0gZmxvb3JIYWNrKHVpLnZhbHVlKSxcbiAgICAgICAgICBmcmFjID0gdWkudmFsdWUgLSBpZHgsXG4gICAgICAgICAgem9vbSwgaztcbiAgICAgICAgLy8gVXNpbmcgdGhlIGFycm93IGtleXMgd2l0aCB0aGUgc2xpZGVyIGZvY3VzZWQgc2hvdWxkIGFuaW1hdGUgYmV0d2VlbiBvcHRpbWFsIGxldmVsc1xuICAgICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50ICYmIGUub3JpZ2luYWxFdmVudC50eXBlPT1cImtleWRvd25cIiAmJiAoayA9IGUub3JpZ2luYWxFdmVudC5rZXlDb2RlKSkge1xuICAgICAgICAgIGlmIChrID49IDM3ICYmIGsgPD0gNDApIHsgc2VsZi5fYW5pbWF0ZVpvb20oayA9PSAzOCB8fCBrID09IDM5LCAxMDAwKTsgcmV0dXJuOyB9XG4gICAgICAgIH1cbiAgICAgICAgcHJldlZhbHMgPSBwcmV2VmFscy5jb25jYXQoW3VpLnZhbHVlXSkuc2xpY2UoLTIpO1xuICAgICAgICBpZiAoZnJhYyA9PT0gMC4wKSB7IHNlbGYuX3pvb20oc2xpZGVyQnBwcHNbaWR4XSk7IH1cbiAgICAgICAgZWxzZSB7IHNlbGYuX3pvb20oKHNsaWRlckJwcHBzW2lkeCArIDFdIC0gc2xpZGVyQnBwcHNbaWR4XSkgKiBmcmFjICsgc2xpZGVyQnBwcHNbaWR4XSk7IH1cbiAgICAgIH07XG4gICAgICBmdW5jdGlvbiBzdG9wKGUsIHVpKSB7XG4gICAgICAgIGlmIChlLm9yaWdpbmFsRXZlbnQgJiYgZS5vcmlnaW5hbEV2ZW50LnR5cGU9PVwia2V5dXBcIikgeyByZXR1cm47IH1cbiAgICAgICAgdmFyIGRpcmVjdGlvbiA9IHByZXZWYWxzWzBdIDwgdWkudmFsdWU7XG4gICAgICAgIG8uc25hcFpvb21BZnRlciAmJiBfLmRlZmVyKGZ1bmN0aW9uKCkgeyBzZWxmLl9hbmltYXRlWm9vbShkaXJlY3Rpb24pOyB9KTtcbiAgICAgIH07XG4gICAgICBcbiAgICAgICRzbGlkZXIucGFyZW50KCkuY2hpbGRyZW4oJy50aWNrcycpLnJlbW92ZSgpO1xuICAgICAgJHRpY2tzID0gJCgnPGRpdiBjbGFzcz1cInRpY2tzXCIvPicpLmFwcGVuZFRvKCRzbGlkZXIucGFyZW50KCkpO1xuICAgICAgJHRpY2tzLmh0bWwobmV3IEFycmF5KG51bUJwcHBzICsgMSkuam9pbignPGRpdiBjbGFzcz1cInRpY2tcIi8+JykpO1xuICAgICAgXG4gICAgICBpZiAoJHNsaWRlci5oYXNDbGFzcygndWktc2xpZGVyJykpIHsgJHNsaWRlci5zbGlkZXIoJ2Rlc3Ryb3knKTsgfVxuICAgICAgJHNsaWRlci5wYXJlbnQoKS53aWR0aChzbGlkZXJXaWR0aCk7XG4gICAgICByZXR1cm4gJHNsaWRlci53aWR0aChzbGlkZXJXaWR0aCkuc2xpZGVyKHtcbiAgICAgICAgbWluOiAwLFxuICAgICAgICBtYXg6IG51bUJwcHBzIC0gMSxcbiAgICAgICAgc3RlcDogMC4wMixcbiAgICAgICAgdmFsdWU6IF8uaW5kZXhPZihzbGlkZXJCcHBwcywgby5pbml0Wm9vbSksXG4gICAgICAgIHNsaWRlOiBzbGlkZSxcbiAgICAgICAgY2hhbmdlOiBzbGlkZSxcbiAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICBzdG9wOiBzdG9wXG4gICAgICB9KTtcbiAgICB9LFxuICAgIFxuICAgIC8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gYSBiaW5kIGEgYnV0dG9uIHRvIHRvZ2dsaW5nIHZpc2liaWxpdHkgb2YgYSBzbGlkZS1vdXQgbWVudSwgY2FsbGVkIGEgXCJwaWNrZXJcIlxuICAgIC8vIFNhZmUgdG8gY2FsbCBtdWx0aXBsZSB0aW1lcy5cbiAgICBfY3JlYXRlUGlja2VyOiBmdW5jdGlvbigkYnRuLCAkcGlja2VyLCAkZG9uZSkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAkZWxlbSA9ICQoc2VsZi5lbGVtZW50KSxcbiAgICAgICAgY2xvc2VQaWNrZXIgPSBmdW5jdGlvbigpIHsgJHBpY2tlci5zbGlkZVVwKDEwMCk7IH07XG4gICAgICAkcGlja2VyLnVuYmluZCgncmVtYXhoZWlnaHQuZ2Vub2Jyb3dzZXInKS5iaW5kKCdyZW1heGhlaWdodC5nZW5vYnJvd3NlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJHVsID0gJCh0aGlzKS5jaGlsZHJlbigndWwnKSxcbiAgICAgICAgICB2aXNpYmxlID0gJCh0aGlzKS5pcygnOnZpc2libGUnKSxcbiAgICAgICAgICBmb3JtTGluZUhlaWdodHM7XG4gICAgICAgIGlmICghdmlzaWJsZSkgeyAkKHRoaXMpLnNob3coKTsgfSAvLyBjYW4ndCBtYWtlIG1lYXN1cmVtZW50cyB3aGlsZSBoaWRkZW5cbiAgICAgICAgZm9ybUxpbmVIZWlnaHRzID0gXy5tYXAoJHVsLm5leHRBbGwoKSwgZnVuY3Rpb24oZWwpIHsgXG4gICAgICAgICAgcmV0dXJuIE1hdGgubWF4KCQoZWwpLm91dGVySGVpZ2h0KCksICQoZWwpLmZpbmQoJ3RleHRhcmVhJykub3V0ZXJIZWlnaHQoKSk7IFxuICAgICAgICB9KTtcbiAgICAgICAgJHVsLmNzcygnbWF4LWhlaWdodCcsICRlbGVtLm91dGVySGVpZ2h0KCkgLSBfLnN1bShmb3JtTGluZUhlaWdodHMpKTtcbiAgICAgICAgaWYgKCF2aXNpYmxlKSB7ICQodGhpcykuaGlkZSgpOyB9XG4gICAgICB9KTtcbiAgICAgICRidG4udW5iaW5kKCdjbGljay5nZW5vYnJvd3NlcicpLmJpbmQoJ2NsaWNrLmdlbm9icm93c2VyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghJHBpY2tlci5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICQoJ2JvZHknKS5iaW5kKCdtb3VzZWRvd24ucGlja2VyJywgZnVuY3Rpb24oZSkgeyBcbiAgICAgICAgICAgIGlmICgkKGUudGFyZ2V0KS5jbG9zZXN0KCRwaWNrZXIuYWRkKCRidG4pKS5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICBjbG9zZVBpY2tlcigpO1xuICAgICAgICAgICAgJCgnYm9keScpLnVuYmluZCgnbW91c2Vkb3duLnBpY2tlcicpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmICgkYnRuLmlzKCdhLnVpLWJ1dHRvbicpKSB7ICRidG4uYWRkQ2xhc3MoJ3VpLXN0YXRlLWFjdGl2ZScpOyB9XG4gICAgICAgICAgJHBpY2tlci50cmlnZ2VyKCdyZW1heGhlaWdodCcpO1xuICAgICAgICB9XG4gICAgICAgICRwaWNrZXIuc2xpZGVUb2dnbGUoMTAwKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKCRkb25lKSB7ICRkb25lLnVuYmluZCgnY2xpY2suZ2Vub2Jyb3dzZXInKS5iaW5kKCdjbGljay5nZW5vYnJvd3NlcicsIGNsb3NlUGlja2VyKTsgfVxuICAgICAgcmV0dXJuICRwaWNrZXIudW5iaW5kKCdjbG9zZS5nZW5vYnJvd3NlcicpLmJpbmQoJ2Nsb3NlLmdlbm9icm93c2VyJywgY2xvc2VQaWNrZXIpO1xuICAgIH0sXG4gICAgXG4gICAgX2luaXRGb290ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGZvb3QgPSAkKG8uZm9vdGVyQmFyKSxcbiAgICAgICAgJGdlbm9tZSA9ICQoby5nZW5vbWVQaWNrZXJbMF0pLFxuICAgICAgICAkZ2Vub21lUGlja2VyID0gJChvLmdlbm9tZVBpY2tlclsxXSksXG4gICAgICAgICR1bCA9ICQoJzx1bC8+JykuYXBwZW5kVG8oJGdlbm9tZVBpY2tlciksXG4gICAgICAgICR0aXRsZSA9ICRnZW5vbWUuZmluZCgnLnRpdGxlJyksXG4gICAgICAgICR0b2dnbGVCdG4gPSAkZ2Vub21lLmNoaWxkcmVuKCdpbnB1dCcpLmVxKDApLFxuICAgICAgICBzcGVjaWVzUGFyZW50aGV0aWNhbCA9IG8uc3BlY2llcy5tYXRjaCgvXFwoKC4rKVxcKS8pLFxuICAgICAgICAkYmluYXJ5V2FybmluZ0RpYWxvZyA9ICQoby5kaWFsb2dzWzZdKSxcbiAgICAgICAgJGE7XG4gICAgICBcbiAgICAgICR1bC5hcHBlbmQoJzxsaSBjbGFzcz1cImRpdmlkZXJcIi8+JylcbiAgICAgICRhID0gJCgnPGEgY2xhc3M9XCJjbGlja2FibGVcIi8+JykuYXR0cignaHJlZicsIG8uZGlhbG9nc1s0XSkuYXBwZW5kVG8oJCgnPGxpIGNsYXNzPVwiY2hvaWNlXCIvPicpLmFwcGVuZFRvKCR1bCkpO1xuICAgICAgJCgnPHNwYW4gY2xhc3M9XCJuYW1lXCIvPicpLnRleHQoJ01vcmUgZ2Vub21lc1xcdTIwMjYnKS5hcHBlbmRUbygkYSk7XG4gICAgICAkKCc8c3BhbiBjbGFzcz1cImxvbmctZGVzY1wiLz4nKS50ZXh0KCdGZXRjaCBvciBzcGVjaWZ5IGNocm9tIHNpemVzJykuYXBwZW5kVG8oJGEpO1xuICAgICAgJHVsLmFwcGVuZCgnPGxpIGNsYXNzPVwiZGl2aWRlclwiLz4nKVxuICAgICAgJGEgPSAkKCc8YSBjbGFzcz1cImNsaWNrYWJsZVwiLz4nKS5hdHRyKCdocmVmJywgby5kaWFsb2dzWzVdKS5hcHBlbmRUbygkKCc8bGkgY2xhc3M9XCJjaG9pY2VcIi8+JykuYXBwZW5kVG8oJHVsKSk7XG4gICAgICAkKCc8c3BhbiBjbGFzcz1cIm5hbWVcIi8+JykudGV4dCgnTG9hZCBmcm9tIGZpbGUgb3IgVVJMXFx1MjAyNicpLmFwcGVuZFRvKCRhKTtcbiAgICAgICQoJzxzcGFuIGNsYXNzPVwibG9uZy1kZXNjXCIvPicpLnRleHQoJ2luIEdlbkJhbmssIEZBU1RBLCBvciBFTUJMIGZvcm1hdCcpLmFwcGVuZFRvKCRhKTtcbiAgICAgIFxuICAgICAgJGdlbm9tZS5maW5kKCcuY2xpY2thYmxlJykuaG92ZXIoZnVuY3Rpb24oKSB7ICQodGhpcykuYWRkQ2xhc3MoJ2hvdmVyJyk7IH0sIGZ1bmN0aW9uKCkgeyAkKHRoaXMpLnJlbW92ZUNsYXNzKCdob3ZlcicpOyB9KTtcbiAgICAgIHNlbGYuX3VwZGF0ZUdlbm9tZXMoKTtcblxuICAgICAgc2VsZi5fY3JlYXRlUGlja2VyKCR0b2dnbGVCdG4sICRnZW5vbWVQaWNrZXIpO1xuICAgICAgXG4gICAgICAvLyBTZXR1cCB0aGUgZGlhbG9ncyB0aGF0IGFwcGVhciB1cG9uIGNsaWNraW5nIGZvb3RlcmJhciBsaW5rc1xuICAgICAgXy5lYWNoKG8uZGlhbG9ncywgZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgdmFyICRkaWFsb2cgPSAkKGlkKS5jbG9zZXN0KCcudWktZGlhbG9nJyk7XG4gICAgICAgIGZ1bmN0aW9uIG9wZW5EaWFsb2coKSB7IFxuICAgICAgICAgICQoJy51aS1kaWFsb2cnKS5oaWRlKCk7XG4gICAgICAgICAgJGRpYWxvZy5hZGRDbGFzcygndmlzaWJsZScpLnNob3coKTtcbiAgICAgICAgICAkZGlhbG9nLmZpbmQoJ2FbaHJlZl49XCJodHRwOi8vXCJdLGFbaHJlZl49XCJodHRwczovL1wiXScpLmF0dHIoJ3RhcmdldCcsICdfYmxhbmsnKTtcbiAgICAgICAgICAkZGlhbG9nLmNzcygndG9wJywgTWF0aC5tYXgoKCRlbGVtLnBhcmVudCgpLmlubmVySGVpZ2h0KCkgLSAkZGlhbG9nLm91dGVySGVpZ2h0KCkpICogMC41LCAzMCkpO1xuICAgICAgICB9O1xuICAgICAgICAkZGlhbG9nLmJpbmQoJ29wZW4uZ2Vub2Jyb3dzZXInLCBvcGVuRGlhbG9nKTtcbiAgICAgICAgJGZvb3QuZmluZCgnYVtocmVmPScraWQrJ10nKS5jbGljayhmdW5jdGlvbigpIHsgJGRpYWxvZy50cmlnZ2VyKCdvcGVuLmdlbm9icm93c2VyJyk7IH0pO1xuICAgICAgICAkZGlhbG9nLmZpbmQoJy51aS1kaWFsb2ctYnV0dG9ucGFuZSBidXR0b24nKS5idXR0b24oKS5ub3QoJy5kb250LWNsb3NlJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJGRpYWxvZy5mYWRlT3V0KCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHNlbGYuX2luaXRDdXN0b21HZW5vbWVEaWFsb2dzKCk7XG4gICAgICBcbiAgICAgIC8vIFNob3cgdGhlIHF1aWNrc3RhcnQgc2NyZWVuIGlmIHRoZSB1c2VyIGhhcyBuZXZlciBiZWVuIGhlcmUgYmVmb3JlIGFuZCB0aGUgdmlld3BvcnQgaXMgYmlnIGVub3VnaCB0byBzaG93IGl0XG4gICAgICBpZiAoJC5jb29raWUoJ2RiJyk9PT1udWxsICYmICQod2luZG93KS53aWR0aCgpID4gNjAwICYmICQod2luZG93KS5oZWlnaHQoKSA+IDQyMCkgeyBcbiAgICAgICAgJGZvb3QuZmluZCgnYVtocmVmPVwiJytvLmRpYWxvZ3NbMV0rJ1wiXScpLmNsaWNrKCk7XG4gICAgICB9XG4gICAgICAvLyBTaG93IHRoZSB1bmluc3RhbGxlZCBiaW5hcmllcyB3YXJuaW5nLCBpZiBpdCB3YXMgd3JpdHRlbiBpbnRvIHRoZSBwYWdlXG4gICAgICBpZiAoJGJpbmFyeVdhcm5pbmdEaWFsb2cubGVuZ3RoKSB7ICRiaW5hcnlXYXJuaW5nRGlhbG9nLnRyaWdnZXIoJ29wZW4uZ2Vub2Jyb3dzZXInKTsgfVxuICAgIH0sXG4gICAgICAgIFxuICAgIF9pbml0VHJhY2tQaWNrZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICBkID0gby50cmFja0Rlc2MsXG4gICAgICAgICR0b2dnbGVCdG4gPSAkKG8udHJhY2tQaWNrZXJbMF0pLFxuICAgICAgICAkdHJhY2tQaWNrZXIgPSAkKG8udHJhY2tQaWNrZXJbMV0pLmVtcHR5KCksXG4gICAgICAgICR1bCA9ICQoJzx1bC8+JykuYXBwZW5kVG8oJHRyYWNrUGlja2VyKSxcbiAgICAgICAgJGRpdiA9ICQoJzxkaXYgY2xhc3M9XCJidXR0b24tbGluZVwiLz4nKS5hcHBlbmRUbygkdHJhY2tQaWNrZXIpLFxuICAgICAgICAkcmVzZXQgPSAkKCc8aW5wdXQgdHlwZT1cImJ1dHRvblwiIG5hbWU9XCJyZXNldFwiIHZhbHVlPVwicmVzZXRcIi8+JykuYXBwZW5kVG8oJGRpdiksXG4gICAgICAgICRiID0gJCgnPGlucHV0IHR5cGU9XCJidXR0b25cIiBuYW1lPVwiZG9uZVwiIHZhbHVlPVwiZG9uZVwiLz4nKS5hcHBlbmRUbygkZGl2KTtcbiAgICAgIF8uZWFjaChzZWxmLmF2YWlsVHJhY2tzLCBmdW5jdGlvbih0LCBuKSB7XG4gICAgICAgIC8vIFRPRE86IFRoaXMgbmVlZHMgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiB0cmFkaXRpb25hbCBpbWFnZSB0cmFja3MgYW5kIGN1c3RvbSB0cmFja3MgYnJvdWdodCBpblxuICAgICAgICAvLyAgICAgICBieSBjdXN0b20gZ2Vub21lcy4gVGhlIGxhdHRlciBzaG91bGQgaGF2ZSBhbiBvcHRpb25zIGRpYWxvZyBhbmQgZG93bmxvYWQgbGlua3MgaW5zdGVhZCBvZiBcIm1vcmUgaW5mb1wiLlxuICAgICAgICB2YXIgJGwgPSAkKCc8bGFiZWwgY2xhc3M9XCJjbGlja2FibGVcIi8+JykuYXBwZW5kVG8oJCgnPGxpIGNsYXNzPVwiY2hvaWNlXCIvPicpLmFwcGVuZFRvKCR1bCkpLFxuICAgICAgICAgICRjID0gJCgnPGlucHV0IHR5cGU9XCJjaGVja2JveFwiLz4nKS5hdHRyKCduYW1lJywgbikucHJlcGVuZFRvKCRsKSxcbiAgICAgICAgICAkZCA9ICQoJzxkaXYgY2xhc3M9XCJkZXNjXCI+PC9kaXY+JykuYXBwZW5kVG8oJGwpLFxuICAgICAgICAgIGhyZWYgPSBvLnRyYWNrRGVzY1VSTCArICc/ZGI9JyArIG8uZ2Vub21lICsgJyZnPScgKyBuICsgJyNUUkFDS19IVE1MJyxcbiAgICAgICAgICAkYSA9IGRbbl0ubGcgPyAkKCc8YSBjbGFzcz1cIm1vcmVcIiB0YXJnZXQ9XCJfYmxhbmtcIj5tb3JlIGluZm8maGVsbGlwOzwvYT4nKS5hdHRyKCdocmVmJywgaHJlZikgOiAnJztcbiAgICAgICAgJCgnPGgzLz4nKS5hZGRDbGFzcygnbmFtZScpLnRleHQoZFtuXS5zbSkuYXBwZW5kKCRhKS5hcHBlbmRUbygkZCk7XG4gICAgICAgIGlmIChkW25dLmxnKSB7ICQoJzxwLz4nKS5hZGRDbGFzcygnbG9uZy1kZXNjJykudGV4dChkW25dLmxnKS5hcHBlbmRUbygkZCk7IH1cbiAgICAgICAgaWYgKF8uZmluZChvLnRyYWNrcywgZnVuY3Rpb24odHJrKSB7IHJldHVybiB0cmsubj09bjsgfSkpIHsgJGMuYXR0cignY2hlY2tlZCcsIHRydWUpOyB9XG4gICAgICAgICRsLmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24oZSkgeyBpZiAoJChlLnRhcmdldCkuaXMoJ2EnKSkgeyBlLnN0b3BQcm9wYWdhdGlvbigpOyB9fSk7XG4gICAgICAgICRsLmF0dHIoJ3RpdGxlJywgbik7XG4gICAgICAgICRsLmhvdmVyKGZ1bmN0aW9uKCkgeyAkKHRoaXMpLmFkZENsYXNzKCdob3ZlcicpOyB9LCBmdW5jdGlvbigpIHsgJCh0aGlzKS5yZW1vdmVDbGFzcygnaG92ZXInKTsgfSk7XG4gICAgICAgICRjLmJpbmQoJ2NoYW5nZScsIF8uYmluZChzZWxmLl9maXhUcmFja3MsIHNlbGYpKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKG8udHJhY2tzLmxlbmd0aCA9PT0gMSkgeyAkdWwuZmluZCgnaW5wdXRbbmFtZT0nK28udHJhY2tzWzBdLm4rJ10nKS5hdHRyKCdkaXNhYmxlZCcsIHRydWUpOyB9XG4gICAgICAkcmVzZXQuY2xpY2soZnVuY3Rpb24oZSkgeyBzZWxmLl9yZXNldFRvRGVmYXVsdFRyYWNrcygpOyB9KTtcbiAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVQaWNrZXIoJHRvZ2dsZUJ0biwgJHRyYWNrUGlja2VyLCAkYikuaGlkZSgpO1xuICAgIH0sXG4gICAgXG4gICAgX2luaXRDdXN0b21UcmFja3M6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgZmlsZUlucHV0SFRNTCA9ICc8aW5wdXQgdHlwZT1cImZpbGVcIiBuYW1lPVwiY3VzdG9tRmlsZVwiLz4nLFxuICAgICAgICB1cmxJbnB1dEhUTUwgPSAnPGlucHV0IHR5cGU9XCJ1cmxcIiBuYW1lPVwiY3VzdG9tVXJsXCIgY2xhc3M9XCJ1cmxcIi8+PGlucHV0IHR5cGU9XCJidXR0b25cIiBuYW1lPVwiY3VzdG9tVXJsR2V0XCIgdmFsdWU9XCJnbyFcIi8+JyxcbiAgICAgICAgJHRvZ2dsZUJ0biA9ICQoby50cmFja1BpY2tlclsyXSksXG4gICAgICAgICRwaWNrZXIgPSAkKG8udHJhY2tQaWNrZXJbM10pLmhpZGUoKSxcbiAgICAgICAgJHVsID0gJCgnPHVsLz4nKS5wcmVwZW5kVG8oJHBpY2tlciksXG4gICAgICAgICRhZGQgPSAkcGlja2VyLmZpbmQoJy5mb3JtLWxpbmUnKS5maXJzdCgpLFxuICAgICAgICAkb3ZlcmxheSA9ICQoby5vdmVybGF5WzBdKSxcbiAgICAgICAgJG92ZXJsYXlNZXNzYWdlID0gJChvLm92ZXJsYXlbMV0pLFxuICAgICAgICAkdXJsSW5wdXQsICR1cmxHZXQsICRkaXYsICRiLCAkcmVzZXQ7XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIGJyb3dzZXJPcHRzKCkge1xuICAgICAgICB2YXIgbmV4dERpcmVjdGl2ZXMgPSBfLmV4dGVuZCh7fSwgc2VsZi5fbmV4dERpcmVjdGl2ZXMpLFxuICAgICAgICAgIHBvcyA9IG5leHREaXJlY3RpdmVzLnBvc2l0aW9uICYmIHNlbGYubm9ybWFsaXplUG9zKG5leHREaXJlY3RpdmVzLnBvc2l0aW9uLCB0cnVlKTtcbiAgICAgICAgcG9zID0gcG9zID8gcG9zLnBvcyA6IHNlbGYucG9zO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGJwcHBzOiBvLmJwcHBzLFxuICAgICAgICAgIGNoclBvczogc2VsZi5jaHJQb3MsXG4gICAgICAgICAgcG9zOiBwb3MsXG4gICAgICAgICAgY2hyTGVuZ3Roczogby5jaHJMZW5ndGhzLFxuICAgICAgICAgIGdlbm9tZVNpemU6IG8uZ2Vub21lU2l6ZSxcbiAgICAgICAgICBhamF4RGlyOiBvLmFqYXhEaXJcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgc2VsZi5fY3VzdG9tVHJhY2tVcmxzID0ge1xuICAgICAgICByZXF1ZXN0ZWQ6IFtdLFxuICAgICAgICBwcm9jZXNzaW5nOiBbXSxcbiAgICAgICAgbG9hZGVkOiBbXVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgZnVuY3Rpb24gY3VzdG9tVHJhY2tFcnJvcihlKSB7XG4gICAgICAgICRwaWNrZXIuZmluZCgnLnNwaW5uZXInKS5oaWRlKCk7XG4gICAgICAgIHZhciBtc2cgPSBlLm1lc3NhZ2UucmVwbGFjZSgvXlVuY2F1Z2h0IEVycm9yOiAvLCAnJyk7XG4gICAgICAgIGFsZXJ0KCdTb3JyeSwgYW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgYWRkaW5nIHRoaXMgY3VzdG9tIHRyYWNrIGZpbGU6XFxuXFxuJyArIG1zZyk7XG4gICAgICAgIC8vIFRPRE86IHJlcGxhY2UgdGhpcyB3aXRoIHNvbWV0aGluZyBtb3JlIGZyaWVuZGx5LlxuICAgICAgICByZXBsYWNlRmlsZUlucHV0KCk7IFxuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBjbG9zZVBpY2tlcigpIHsgJHBpY2tlci5zbGlkZVVwKDEwMCk7IH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gaGFuZGxlRmlsZVNlbGVjdChlKSB7XG4gICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpLFxuICAgICAgICAgICRhZGQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcuZm9ybS1saW5lJyksXG4gICAgICAgICAgJHNwaW5uZXIgPSAkYWRkLmZpbmQoJy5zcGlubmVyJykuc2hvdygpO1xuICAgICAgICBpZiAoZS50YXJnZXQuZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChmdW5jdGlvbihmKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICAgICAgQ3VzdG9tVHJhY2tzLnBhcnNlQXN5bmMoZXYudGFyZ2V0LnJlc3VsdCwgYnJvd3Nlck9wdHMoKSwgZnVuY3Rpb24odHJhY2tzKSB7XG4gICAgICAgICAgICAgICAgJHNwaW5uZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAgIHNlbGYuX2FkZEN1c3RvbVRyYWNrcyhmLm5hbWUsIHRyYWNrcyk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KShlLnRhcmdldC5maWxlc1swXSk7XG4gICAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZS50YXJnZXQuZmlsZXNbMF0pO1xuICAgICAgICB9XG4gICAgICAgIHJlcGxhY2VGaWxlSW5wdXQoKTtcbiAgICAgIH1cbiAgICAgIGlmICh3aW5kb3cuRmlsZSAmJiB3aW5kb3cuRmlsZVJlYWRlciAmJiB3aW5kb3cuRmlsZUxpc3QpIHtcbiAgICAgICAgJGFkZC5maW5kKCdsYWJlbCcpLmh0bWwoZmlsZUlucHV0SFRNTCk7XG4gICAgICAgICRhZGQuZmluZCgnW25hbWU9Y3VzdG9tRmlsZV0nKS5jaGFuZ2UoaGFuZGxlRmlsZVNlbGVjdCk7XG4gICAgICAgICRhZGQgPSAkYWRkLm5leHRBbGwoJy5mb3JtLWxpbmUnKS5maXJzdCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGFkZC5yZW1vdmUoKTtcbiAgICAgICAgJHBpY2tlci5maW5kKCcuaGVscC1saW5lJykuZmlyc3QoKS5yZW1vdmUoKTtcbiAgICAgICAgJGFkZCA9ICRwaWNrZXIuZmluZCgnLmZvcm0tbGluZScpLmZpcnN0KCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIHJlcGxhY2VGaWxlSW5wdXQoKSB7XG4gICAgICAgIF8uZGVmZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJHBpY2tlci5maW5kKCdbbmFtZT1jdXN0b21GaWxlXScpLnJlcGxhY2VXaXRoKGZpbGVJbnB1dEhUTUwpO1xuICAgICAgICAgICRwaWNrZXIuZmluZCgnW25hbWU9Y3VzdG9tRmlsZV0nKS5jaGFuZ2UoaGFuZGxlRmlsZVNlbGVjdCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBoYW5kbGVQYXN0ZWREYXRhKGUpIHtcbiAgICAgICAgdmFyICRhZGQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcuZm9ybS1saW5lJyksXG4gICAgICAgICAgJHNwaW5uZXIgPSAkYWRkLmZpbmQoJy5zcGlubmVyJykuc2hvdygpO1xuICAgICAgICBDdXN0b21UcmFja3MucGFyc2VBc3luYygkYWRkLmZpbmQoJ3RleHRhcmVhJykudmFsKCksIGJyb3dzZXJPcHRzKCksIGZ1bmN0aW9uKHRyYWNrcykge1xuICAgICAgICAgICRzcGlubmVyLmhpZGUoKTtcbiAgICAgICAgICBzZWxmLl9hZGRDdXN0b21UcmFja3MoXy51bmlxdWVJZCgncGFzdGVkX2RhdGFfJyksIHRyYWNrcyk7XG4gICAgICAgICAgJGFkZC5maW5kKCd0ZXh0YXJlYScpLnZhbCgnJyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gcGFzdGVBcmVhRm9jdXMoZSkge1xuICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLCBoZWlnaHQgPSAkdGhpcy5oZWlnaHQoKTtcbiAgICAgICAgaWYgKCEkdGhpcy5kYXRhKCdvcmlnSGVpZ2h0JykpIHsgJHRoaXMuZGF0YSgnb3JpZ0hlaWdodCcsICR0aGlzLmhlaWdodCgpKTsgfVxuICAgICAgICAkdGhpcy5hbmltYXRlKHtoZWlnaHQ6IDEyMH0sIDIwMCwgJ2Vhc2VJbk91dFF1YXJ0Jyk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBwYXN0ZUFyZWFCbHVyKGUpIHsgJCh0aGlzKS5hbmltYXRlKHtoZWlnaHQ6ICQodGhpcykuZGF0YSgnb3JpZ0hlaWdodCcpfSwgMjAwLCAnZWFzZUluT3V0UXVhcnQnKTsgfVxuICAgICAgJGFkZC5maW5kKCdbbmFtZT1jdXN0b21QYXN0ZUFkZF0nKS5jbGljayhoYW5kbGVQYXN0ZWREYXRhKTtcbiAgICAgICRhZGQuZmluZCgndGV4dGFyZWEnKS5mb2N1cyhwYXN0ZUFyZWFGb2N1cykuYmx1cihwYXN0ZUFyZWFCbHVyKTtcbiAgICAgICRhZGQgPSAkYWRkLm5leHRBbGwoJy5mb3JtLWxpbmUnKS5maXJzdCgpO1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBoYW5kbGVVcmxTZWxlY3QoZSkge1xuICAgICAgICB2YXIgJGFkZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5mb3JtLWxpbmUnKSxcbiAgICAgICAgICAkc3Bpbm5lciA9ICRhZGQuZmluZCgnLnNwaW5uZXInKSxcbiAgICAgICAgICAkdXJsID0gJGFkZC5maW5kKCdbbmFtZT1jdXN0b21VcmxdJyksXG4gICAgICAgICAgdXJsID0gJC50cmltKCR1cmwudmFsKCkpO1xuICAgICAgICBpZiAoIXVybC5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgICAgICRzcGlubmVyLnNob3coKTtcbiAgICAgICAgc2VsZi5fY3VzdG9tVHJhY2tVcmxzLnJlcXVlc3RlZCA9IF8ud2l0aG91dChzZWxmLl9jdXN0b21UcmFja1VybHMucmVxdWVzdGVkLCB1cmwpO1xuICAgICAgICBzZWxmLl9jdXN0b21UcmFja1VybHMucHJvY2Vzc2luZyA9IF8udW5pb24oc2VsZi5fY3VzdG9tVHJhY2tVcmxzLnByb2Nlc3NpbmcsIFt1cmxdKTtcbiAgICAgICAgJC5hamF4KHVybCwge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIEN1c3RvbVRyYWNrcy5wYXJzZUFzeW5jKGRhdGEsIGJyb3dzZXJPcHRzKCksIGZ1bmN0aW9uKHRyYWNrcykge1xuICAgICAgICAgICAgICAkc3Bpbm5lci5oaWRlKCk7XG4gICAgICAgICAgICAgICR1cmwudmFsKCcnKTtcbiAgICAgICAgICAgICAgc2VsZi5fY3VzdG9tVHJhY2tVcmxzLmxvYWRlZCA9IF8udW5pb24oc2VsZi5fY3VzdG9tVHJhY2tVcmxzLmxvYWRlZCwgW3VybF0pO1xuICAgICAgICAgICAgICBzZWxmLl9hZGRDdXN0b21UcmFja3MoYmFzZW5hbWUodXJsKSwgdHJhY2tzLCB1cmwpO1xuICAgICAgICAgICAgICAkb3ZlcmxheS5hZGQoJG92ZXJsYXlNZXNzYWdlKS5mYWRlT3V0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHByb2dyZXNzOiBmdW5jdGlvbihsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICB2YXIgJHByb2dyZXNzID0gJG92ZXJsYXlNZXNzYWdlLmZpbmQoJy51aS1wcm9ncmVzc2JhcicpO1xuICAgICAgICAgICAgaWYgKCEkcHJvZ3Jlc3MubGVuZ3RoKSB7ICRwcm9ncmVzcyA9ICQoJzxkaXYvPicpLmFwcGVuZFRvKCRvdmVybGF5TWVzc2FnZSkucHJvZ3Jlc3NiYXIoKTsgfVxuICAgICAgICAgICAgJHByb2dyZXNzLnByb2dyZXNzYmFyKCd2YWx1ZScsIGxvYWRlZC90b3RhbCAqIDEwMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkb3ZlcmxheS5oaWRlKCk7XG4gICAgICAgICAgICAkb3ZlcmxheU1lc3NhZ2UuaGlkZSgpO1xuICAgICAgICAgICAgY3VzdG9tVHJhY2tFcnJvcih7bWVzc2FnZTogXCJObyB2YWxpZCBjdXN0b20gdHJhY2sgZGF0YSB3YXMgZm91bmQgYXQgdGhpcyBVUkwuXCJ9KTsgXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgICRhZGQuZmluZCgnbGFiZWwnKS5odG1sKHVybElucHV0SFRNTCk7XG4gICAgICAkYWRkLmZpbmQoJ1tuYW1lPWN1c3RvbVVybEdldF0nKS5jbGljayhoYW5kbGVVcmxTZWxlY3QpO1xuICAgICAgJGFkZC5maW5kKCdbbmFtZT1jdXN0b21VcmxdJykuYmluZCgna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHsgaWYgKGUud2hpY2g9PTEzKSB7IGhhbmRsZVVybFNlbGVjdChlKTsgfSB9KTtcbiAgICAgIFxuICAgICAgLy8gUmVkZWZpbmUgdGhlIEN1c3RvbVRyYWNrcyBlcnJvciBoYW5kbGVyIHNvIHRoZSB1c2VyIGNhbiBzZWUgcGFyc2UgZXJyb3JzIGZvciB0aGVpciBjdXN0b20gdHJhY2socykuXG4gICAgICBDdXN0b21UcmFja3MuZXJyb3IgPSBjdXN0b21UcmFja0Vycm9yO1xuICAgICAgXG4gICAgICAkZGl2ID0gJCgnPGRpdiBjbGFzcz1cImJ1dHRvbi1saW5lXCIvPicpLmFwcGVuZFRvKCRwaWNrZXIpO1xuICAgICAgJHJlc2V0ID0gJCgnPGlucHV0IHR5cGU9XCJidXR0b25cIiBuYW1lPVwicmVzZXRcIiB2YWx1ZT1cInJlc2V0XCIvPicpLmFwcGVuZFRvKCRkaXYpO1xuICAgICAgJGIgPSAkKCc8aW5wdXQgdHlwZT1cImJ1dHRvblwiIG5hbWU9XCJkb25lXCIgdmFsdWU9XCJkb25lXCIvPicpLmFwcGVuZFRvKCRkaXYpO1xuICAgICAgJHJlc2V0LmNsaWNrKGZ1bmN0aW9uKGUpIHsgc2VsZi5fcmVzZXRDdXN0b21UcmFja3MoKTsgfSk7XG5cbiAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVQaWNrZXIoJHRvZ2dsZUJ0biwgJHBpY2tlciwgJGIpO1xuICAgIH0sXG4gICAgXG4gICAgX2luaXRMaW5raW5nOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGxpbmtCdG4gPSAkKG8ubGlua2luZ1swXSksXG4gICAgICAgICRsaW5rUGlja2VyID0gJChvLmxpbmtpbmdbMV0pLFxuICAgICAgICAkdXJsID0gJGxpbmtQaWNrZXIuZmluZCgnLnVybCcpO1xuICAgICAgJGxpbmtCdG4uYnV0dG9uKCkuY2xpY2soZnVuY3Rpb24oZSkgeyBfLmRlZmVyKGZ1bmN0aW9uICgpIHsgJHVybC5zZWxlY3QoKS5mb2N1cygpOyB9KTsgcmV0dXJuIGZhbHNlOyB9KTtcbiAgICAgIHNlbGYuX2NyZWF0ZVBpY2tlcigkbGlua0J0biwgJGxpbmtQaWNrZXIpO1xuICAgIH0sXG4gICAgXG4gICAgX2luaXRKdW1wOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGxvYyA9ICAkKG8uanVtcFswXSksXG4gICAgICAgICRqdW1wID0gJChvLmp1bXBbMV0pO1xuICAgICAgc2VsZi4kY2hvaWNlcyA9ICQoby5qdW1wWzJdKS5oaWRlKCk7XG4gICAgICBmdW5jdGlvbiBqdW1wVG9TdWJtaXQoKSB7XG4gICAgICAgIHZhciAkc3VnZ2VzdCA9IHNlbGYuJGNob2ljZXMuZmluZCgnLmZvY3VzJyk7XG4gICAgICAgIGlmICgkc3VnZ2VzdC5sZW5ndGgpIHsgJHN1Z2dlc3QuY2xpY2soKTsgfVxuICAgICAgICBlbHNlIHsgc2VsZi5qdW1wVG8oJGxvYy52YWwoKSk7IH1cbiAgICAgIH1cbiAgICAgICRqdW1wLmNsaWNrKGp1bXBUb1N1Ym1pdCk7XG4gICAgICAkbG9jLmtleWRvd24oZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAoZS53aGljaCA9PSAxMykgeyBqdW1wVG9TdWJtaXQoKTsgfVxuICAgICAgICBlbHNlIGlmIChlLndoaWNoID09IDQwKSB7IFxuICAgICAgICAgIHNlbGYuJGNob2ljZXMuZmluZCgnLmZvY3VzJykubmV4dEFsbCgnLmNob2ljZScpLmVxKDApLnRyaWdnZXIoJ2Zha2Vmb2N1cycpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDM4KSB7IFxuICAgICAgICAgIHNlbGYuJGNob2ljZXMuZmluZCgnLmZvY3VzJykucHJldkFsbCgnLmNob2ljZScpLmVxKDApLnRyaWdnZXIoJ2Zha2Vmb2N1cycpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWxmLl9ub3JtYWxpemVQb3NEZWJvdW5jZWQoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAkbG9jLmtleXVwKGZ1bmN0aW9uKGUpIHsgXy5kZWZlcihmdW5jdGlvbigpIHsgKCRsb2MudmFsKCk9PT0nJykgJiYgc2VsZi5fc2VhcmNoRm9yKCcnKTsgfSk7IH0pO1xuICAgIH0sXG4gICAgXG4gICAgX2luaXRIb3RrZXlzOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsXG4gICAgICAgIG1vdGlvbk9wdHMgPSB7ZGlyOiAwfSxcbiAgICAgICAgbCA9IDUwMCxcbiAgICAgICAgc2hpZnRFdmVyeXRoaW5nID0gJ3NoaWZ0K2Rvd24gc2hpZnQrcyBzaGlmdCt1cCBzaGlmdCt3IHNoaWZ0K2xlZnQgc2hpZnQrYSBzaGlmdCtyaWdodCBzaGlmdCtkJyxcbiAgICAgICAgbW90aW9uSW50ZXJ2YWw7XG4gICAgICBzZWxmLl9rZXllZE9mZnNldCA9IDA7XG4gICAgICAvLyBxdWFkcmF0aWMgbW90aW9uIHdpdGggYW4gdXBwZXIgYm91bmQgb24gdGhlIHZlbG9jaXR5IGFmdGVyIGwgbWlsbGlzZWNvbmRzXG4gICAgICBmdW5jdGlvbiB4KHQpIHsgcmV0dXJuICh0ID4gbCA/IDIgKiBsICogdCAtIGwgKiBsIDogdCAqIHQpIC8gMTUwMDsgfVxuICAgICAgZnVuY3Rpb24gbW90aW9uKCkge1xuICAgICAgICB2YXIgbm93ID0gKG5ldyBEYXRlKS5nZXRUaW1lKCksXG4gICAgICAgICAgZGVsdGFZID0gbW90aW9uT3B0cy5kaXIgKiB4KG5vdyAtIG1vdGlvbk9wdHMuc3RhcnQpIC0gbW90aW9uT3B0cy5wcmV2O1xuICAgICAgICBzZWxmLl9rZXllZE9mZnNldCAtPSBkZWx0YVk7XG4gICAgICAgIHNlbGYuX3BvcyhzZWxmLnBvcyAtIGRlbHRhWSAqIHNlbGYuYnBwcCk7IFxuICAgICAgICBtb3Rpb25PcHRzLnByZXYgKz0gZGVsdGFZO1xuICAgICAgfTtcbiAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ2tleWRvd24nLCAndXAgZG93biBsZWZ0IHJpZ2h0IHcgcyBhIGQgJytzaGlmdEV2ZXJ5dGhpbmcsIGZ1bmN0aW9uKCkgeyBcbiAgICAgICAgc2VsZi5zaG93UmV0aWNsZSgnaG90S2V5cycsIHRydWUpO1xuICAgICAgICAkLnRpcFRpcC5oaWRlKCk7XG4gICAgICAgICRlbGVtLm9uZSgnbW91c2Vtb3ZlJywgZnVuY3Rpb24oKSB7IHNlbGYuc2hvd1JldGljbGUoJ2hvdEtleXMnLCBmYWxzZSk7IH0pO1xuICAgICAgfSk7XG4gICAgICAkKGRvY3VtZW50KS5iaW5kKCdrZXlkb3duJywgJ2Rvd24gcyB1cCB3JywgZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgZGlyID0gZS53aGljaCA9PSA0MCB8fCBlLndoaWNoID09IDgzID8gMSA6IC0xOyAvLyBkb3duPT40MCwgcz0+ODNcbiAgICAgICAgaWYgKCQoby5saW5lTW9kZSkuZmluZCgnaW5wdXQ6Y2hlY2tlZCcpLnZhbCgpID09ICdzaW5nbGUnKSB7XG4gICAgICAgICAgZGVsZXRlIHNlbGYuY2VudGVyZWRPbjtcbiAgICAgICAgICBzZWxmLl9hbmltYXRlWm9vbShkaXIgPT0gLTEsIDEwMDApOyByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2VsZi5fa2V5ZWRPZmZzZXQgKz0gZGlyICogc2VsZi5saW5lV2lkdGgoKTtcbiAgICAgICAgICBzZWxmLl9wb3Moc2VsZi5wb3MgKyBkaXIgKiBzZWxmLmJwV2lkdGgoKSk7XG4gICAgICAgICAgc2VsZi5ib3VuY2VDaGVjaygpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ2tleWRvd24nLCAnbGVmdCBhIHJpZ2h0IGQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciBkaXIgPSBlLndoaWNoID09IDM3IHx8IGUud2hpY2ggPT0gNjUgPyAxIDogLTEsIC8vIGxlZnQ9PjM3LCBhPT42NVxuICAgICAgICAgIG5vdyA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpO1xuICAgICAgICBpZiAobW90aW9uT3B0cy5kaXIgPT0gZGlyKSB7IHJldHVybjsgfVxuICAgICAgICBjbGVhckludGVydmFsKG1vdGlvbkludGVydmFsKTtcbiAgICAgICAgbW90aW9uT3B0cyA9IHtkaXI6IGRpciwgc3RhcnQ6IG5vdywgcHJldjogMH07XG4gICAgICAgIG1vdGlvbkludGVydmFsID0gc2V0SW50ZXJ2YWwobW90aW9uLCAxMyk7IC8vIGJhc2VkIG9mZiBvZiBqUXVlcnkncyAuYW5pbWF0ZSBpbnRlcnZhbFxuICAgICAgfSk7XG4gICAgICAkKGRvY3VtZW50KS5iaW5kKCdrZXl1cCcsICdsZWZ0IGEgcmlnaHQgZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdmFyIGRpciA9IGUud2hpY2ggPT0gMzcgfHwgZS53aGljaCA9PSA2NSA/IDEgOiAtMTtcbiAgICAgICAgaWYgKG1vdGlvbk9wdHMuZGlyID09IGRpcikgeyBjbGVhckludGVydmFsKG1vdGlvbkludGVydmFsKTsgc2VsZi5ib3VuY2VDaGVjaygpOyBtb3Rpb25PcHRzLmRpciA9IDA7IH1cbiAgICAgIH0pO1xuICAgICAgJChkb2N1bWVudCkuYmluZCgna2V5ZG93bicsIHNoaWZ0RXZlcnl0aGluZywgZnVuY3Rpb24oZSkge1xuICAgICAgICBkZWxldGUgc2VsZi5jZW50ZXJlZE9uO1xuICAgICAgICBzZWxmLl9hbmltYXRlWm9vbShfLmluY2x1ZGUoWzM4LCA4NywgMzksIDY4XSwgZS53aGljaCksIDEwMDApOyAvLyB1cD0+MzgsIHc9Pjg3LCByaWdodD0+MzksIGQ9PjY4XG4gICAgICB9KTtcbiAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ2tleWRvd24nLCAnZXNjJywgZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgJHBpY2tlcnMgPSAkKG8udHJhY2tQaWNrZXJbMV0gKyAnLCcgKyBvLnRyYWNrUGlja2VyWzNdKTtcbiAgICAgICAgJHBpY2tlcnMuZWFjaChmdW5jdGlvbigpIHsgaWYgKCQodGhpcykuaXMoJzp2aXNpYmxlJykpICQodGhpcykuZmluZCgnaW5wdXRbbmFtZT1kb25lXScpLmNsaWNrKCk7IH0pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBcbiAgICBfaW5pdEFqYXg6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAvLyBwcm94eSBleHRlcm5hbCBVUkxzIHRocm91Z2ggb3VyIGxvY2FsIEFKQVggcHJveHlcbiAgICAgICQuYWpheCA9IChmdW5jdGlvbihfYWpheCl7XG4gICAgICAgIHZhciBwcm90b2NvbCA9IGxvY2F0aW9uLnByb3RvY29sLFxuICAgICAgICAgIGhvc3RuYW1lID0gbG9jYXRpb24uaG9zdG5hbWUsXG4gICAgICAgICAgZXhSZWdleCA9IFJlZ0V4cChwcm90b2NvbCArICcvLycgKyBob3N0bmFtZSksXG4gICAgICAgICAgcHJveHlVUkwgPSBvcHRpb25zLmFqYXhEaXIgKyAncHJveHkucGhwJztcblxuICAgICAgICBmdW5jdGlvbiBpc0V4dGVybmFsKHVybCkge1xuICAgICAgICAgIHJldHVybiAhZXhSZWdleC50ZXN0KHVybCkgJiYgKC86XFwvXFwvLykudGVzdCh1cmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHVybCwgbykge1xuICAgICAgICAgIGlmICggdHlwZW9mIHVybCA9PT0gXCJvYmplY3RcIiApIHtcbiAgICAgICAgICAgIG8gPSB1cmw7XG4gICAgICAgICAgICB1cmwgPSBvLnVybDtcbiAgICAgICAgICB9IGVsc2UgeyBvLnVybCA9IHVybDsgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIGNhcHR1cmUgYW5kIGZvcndhcmQgcHJvZ3Jlc3MgZXZlbnRzIGZyb20gWEhSJ3MgdG8gby5wcm9ncmVzcyBjYWxsYmFja1xuICAgICAgICAgIG8ueGhyID0gKGZ1bmN0aW9uKF94aHIpe1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICB2YXIgeGhyID0gXy5pc0Z1bmN0aW9uKF94aHIpID8gX3hocigpIDogbmV3IHdpbmRvdy5YTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcihcInByb2dyZXNzXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgdG90YWwgPSBlLmxlbmd0aENvbXB1dGFibGUgPyBlLnRvdGFsIDogeGhyLmdldFJlc3BvbnNlSGVhZGVyKCdYLUNvbnRlbnQtTGVuZ3RoJyk7XG4gICAgICAgICAgICAgICAgaWYgKHRvdGFsICYmIF8uaXNGdW5jdGlvbihvLnByb2dyZXNzKSkge1xuICAgICAgICAgICAgICAgICAgby5wcm9ncmVzcy5jYWxsKHRoaXMsIGUubG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgICAgICAgIHJldHVybiB4aHI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pKG8ueGhyKTtcblxuICAgICAgICAgIGlmICggKC9nZXQvaS50ZXN0KG8udHlwZSkgfHwgIW8udHlwZSkgJiYgIS9qc29uL2kudGVzdChvLmRhdGFUeXBlKSAmJiBpc0V4dGVybmFsKHVybCkgKSB7XG4gICAgICAgICAgICAvLyBNYW5pcHVsYXRlIG9wdGlvbnMgc28gdGhhdCBBSkFYIHJlcXVlc3QgZ2V0cyBzZW50IHRvIG91ciBwcm94eVxuICAgICAgICAgICAgby51cmwgPSBwcm94eVVSTDtcbiAgICAgICAgICAgIG8uZGF0YVR5cGUgPSAndGV4dCc7XG4gICAgICAgICAgICBvLmRhdGEgPSB7XG4gICAgICAgICAgICAgIHVybDogdXJsICsgKG8uZGF0YSA/ICgvXFw/Ly50ZXN0KHVybCkgPyAnJicgOiAnPycpICsgalF1ZXJ5LnBhcmFtKG8uZGF0YSkgOiAnJylcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIFNpbmNlIGl0J3MgYSBKU09OUCByZXF1ZXN0XG4gICAgICAgICAgICAvLyBjb21wbGV0ZSA9PT0gc3VjY2Vzc1xuICAgICAgICAgICAgaWYgKCFvLnN1Y2Nlc3MgJiYgby5jb21wbGV0ZSkge1xuICAgICAgICAgICAgICBvLnN1Y2Nlc3MgPSBvLmNvbXBsZXRlO1xuICAgICAgICAgICAgICBkZWxldGUgby5jb21wbGV0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG8uc3VjY2VzcyA9IChmdW5jdGlvbihfc3VjY2Vzcyl7XG4gICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKF9zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAvLyBGYWtlIFhIUiBjYWxsYmFjay5cbiAgICAgICAgICAgICAgICAgIF9zdWNjZXNzLmNhbGwodGhpcywgZGF0YSwgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KShvLnN1Y2Nlc3MpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gX2FqYXguY2FsbCh0aGlzLCBvKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKCQuYWpheCk7XG4gICAgfSxcbiAgICBcbiAgICBfaW5pdE1vYmlsZUZlYXR1cmVzOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGVsZW1zID0gc2VsZi5lbGVtZW50LmFkZChvLm5hdkJhcikuYWRkKG8uZm9vdGVyQmFyKTtcbiAgICAgIFxuICAgICAgJCh3aW5kb3cpLmJpbmQoJ29yaWVudGF0aW9uY2hhbmdlJywgZnVuY3Rpb24oKSB7ICQod2luZG93KS5yZXNpemUoKTsgfSk7XG4gICAgICBcbiAgICAgIGlmICghJC5zdXBwb3J0LnRvdWNoKSB7IHJldHVybjsgfVxuICAgICAgJGVsZW1zLmFkZENsYXNzKCdtb2JpbGUnKTtcbiAgICAgIFxuICAgICAgdmFyIGNhY2hlZFBhZ2VYcyA9IHt9LCBwcmV2UGluY2hXaWR0aCA9IG51bGwsIHRvdWNoVGFyZ2V0LCBjZW50ZXIsIHBpbmNoV2lkdGg7XG4gICAgICBmdW5jdGlvbiBnZXRQYWdlWChlLCBpZGVudGlmaWVyKSB7XG4gICAgICAgIHZhciBwYWdlWCwgY2hhbmdlZCA9IF8uZmluZChlLmNoYW5nZWRUb3VjaGVzLCBmdW5jdGlvbih0KSB7IHJldHVybiB0LmlkZW50aWZpZXIgPT0gaWRlbnRpZmllcjsgfSk7XG4gICAgICAgIGlmIChjaGFuZ2VkKSB7IHBhZ2VYID0gY2hhbmdlZC5wYWdlWDsgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoY2FjaGVkUGFnZVhzW2lkZW50aWZpZXJdKSkgeyBwYWdlWCA9IGNhY2hlZFBhZ2VYc1tpZGVudGlmaWVyXTsgfVxuICAgICAgICAgIGVsc2UgeyBwYWdlWCA9IF8uZmluZChlLnRvdWNoZXMsIGZ1bmN0aW9uKHQpIHsgcmV0dXJuIHQuaWRlbnRpZmllciA9PSBpZGVudGlmaWVyOyB9KS5wYWdlWDsgfVxuICAgICAgICB9XG4gICAgICAgIGNhY2hlZFBhZ2VYc1tpZGVudGlmaWVyXSA9IHBhZ2VYO1xuICAgICAgICByZXR1cm4gcGFnZVg7XG4gICAgICB9XG4gICAgICAkKGRvY3VtZW50KS5iaW5kKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgZHJhZ0NvbnRUb3VjaCA9IF8uZmluZChlLm9yaWdpbmFsRXZlbnQudG91Y2hlcywgZnVuY3Rpb24odCkgeyByZXR1cm4gJCh0LnRhcmdldCkuY2xvc2VzdCgnLmRyYWctY29udCcpLmxlbmd0aCA+IDA7IH0pO1xuICAgICAgICBpZiAoZHJhZ0NvbnRUb3VjaCkgeyB0b3VjaFRhcmdldCA9ICQoZHJhZ0NvbnRUb3VjaC50YXJnZXQpLmNsb3Nlc3QoJy5kcmFnLWNvbnQnKTsgfVxuICAgICAgfSk7XG4gICAgICAkKGRvY3VtZW50KS5iaW5kKCd0b3VjaG1vdmUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciBvZSA9IGUub3JpZ2luYWxFdmVudDtcbiAgICAgICAgLy8gSWYgbm90aGluZyBzdGFydGVkIHdpdGhpbiBhIGRyYWdnYWJsZSB0cmFjayBhcmVhLCB3ZSBkb24ndCBjYXJlIGFib3V0IHRoaXMgZXZlbnRcbiAgICAgICAgaWYgKCF0b3VjaFRhcmdldCkgeyByZXR1cm47IH1cbiAgICAgICAgLy8gV2UncmUgb25seSBoYW5kbGluZyBwaW5jaCBldmVudHMgaGVyZVxuICAgICAgICBpZiAob2UudG91Y2hlcy5sZW5ndGggIT0gMikgeyByZXR1cm47IH1cbiAgICAgICAgaWYgKGNlbnRlciA9PT0gbnVsbCkge1xuICAgICAgICAgIGNlbnRlciA9IChvZS50b3VjaGVzWzBdLnBhZ2VYICsgb2UudG91Y2hlc1sxXS5wYWdlWCkgKiAwLjU7XG4gICAgICAgIH1cbiAgICAgICAgcGluY2hXaWR0aCA9IE1hdGguYWJzKGdldFBhZ2VYKG9lLCBvZS50b3VjaGVzWzBdLmlkZW50aWZpZXIpIC0gZ2V0UGFnZVgob2UsIG9lLnRvdWNoZXNbMV0uaWRlbnRpZmllcikpO1xuICAgICAgICBpZiAocHJldlBpbmNoV2lkdGgpIHtcbiAgICAgICAgICB2YXIgZGVsdGEgPSAocGluY2hXaWR0aCAvIHByZXZQaW5jaFdpZHRoIC0gMSkgKiA1MCwgXG4gICAgICAgICAgICAvLyBUT0RPOiBkZWx0YSBjb3VsZCBwcm9iYWJseSBiZSB0d2Vha2VkIHRvIHByb3ZpdWRlIHBlcmZlY3QgcG9zaXRpb25hbCB6b29taW5nXG4gICAgICAgICAgICBmYWtlRXZlbnQgPSB7dGFyZ2V0OiB0b3VjaFRhcmdldCwgb3JpZ2luYWxFdmVudDoge3NyY0VsZW1lbnQ6IHRvdWNoVGFyZ2V0LCBwYWdlWDogY2VudGVyfX07XG4gICAgICAgICAgLy8gU2ltdWxhdGUgdGhlIGVxdWl2YWxlbnQgbW91c2V3aGVlbCBldmVudFxuICAgICAgICAgIHNlbGYuX3JlY3Zab29tKGZha2VFdmVudCwgZGVsdGEpO1xuICAgICAgICB9XG4gICAgICAgIHByZXZQaW5jaFdpZHRoID0gcGluY2hXaWR0aDtcbiAgICAgIH0pO1xuICAgICAgJChkb2N1bWVudCkuYmluZCgndG91Y2hlbmQnLCBmdW5jdGlvbihlKSB7IGNhY2hlZFBhZ2VYcyA9IHt9OyBwcmV2UGluY2hXaWR0aCA9IHRvdWNoVGFyZ2V0ID0gY2VudGVyID0gbnVsbDsgfSk7XG5cbiAgICAgICQoby5saW5lTW9kZSkuZmluZCgnaW5wdXRbdmFsdWU9c2luZ2xlXScpLmF0dHIoJ2NoZWNrZWQnLCB0cnVlKTtcbiAgICB9LFxuICAgIFxuICAgIF9pbml0SUVGaXhlczogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgICRlbGVtcyA9IHNlbGYuZWxlbWVudC5hZGQoby5uYXZCYXIpO1xuICAgICAgJGVsZW1zLmFkZENsYXNzKCdtc2llJyk7XG4gICAgICAkKG8uem9vbVNsaWRlcikucGFyZW50KCkuZmluZCgnLnRpY2snKS5sYXN0KCkuYWRkQ2xhc3MoJ2xhc3QnKTtcbiAgICAgICQoby50cmFja1BpY2tlclszXSkuZmluZCgndGV4dGFyZWEucGFzdGUnKS5jc3MoJ3doaXRlLXNwYWNlJywgJ3ByZS13cmFwJykuYXR0cignd3JhcCcsICdvZmYnKTtcbiAgICAgIFxuICAgICAgaWYgKHBhcnNlRmxvYXQoJC5icm93c2VyLnZlcnNpb24pID49IDkuMCkgeyByZXR1cm47IH1cbiAgICAgIC8vIFN0dWZmIGZvciBvbGQgTVNJRSdzICg8IE1TSUUgOSlcbiAgICAgIC8vIFNob3cgdGhlIHdhcm5pbmcgZGlhbG9nXG4gICAgICAkKG8uZm9vdGVyQmFyKS5maW5kKCdhW2hyZWY9XCIjb2xkLW1zaWVcIl0nKS5jbGljaygpO1xuICAgICAgLy8gRGlzYWJsZSBtdWx0aWxpbmUgbW9kZVxuICAgICAgJChvLmxpbmVNb2RlKS5maW5kKCdpbnB1dFt2YWx1ZT1zaW5nbGVdJykuYXR0cignY2hlY2tlZCcsIHRydWUpO1xuICAgICAgLy8gT2xkIElFJ3MgaGF2ZSBpc3N1ZXMgd2l0aCBjcmVhdGluZyBuZXcgdGFicyB3aGVuIGNsaWNraW5nIGZlYXR1cmVzXG4gICAgICBzZWxmLmVsZW1lbnQuY2xpY2soZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgJGEgPSAkKGUudGFyZ2V0KTtcbiAgICAgICAgaWYgKGUudGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT0gJ2EnICYmICRhLmhhc0NsYXNzKCdhcmVhJykpIHtcbiAgICAgICAgICB2YXIgaHJlZiA9ICRhLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICBpZiAoaHJlZikgeyB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGhyZWY7IH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBcbiAgICBfaW5pdEN1c3RvbVRyYWNrRGlhbG9nOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGRpYWxvZyA9ICQoby5kaWFsb2dzWzBdKS5jbG9zZXN0KCcudWktZGlhbG9nJyk7XG4gICAgICBcbiAgICAgICRkaWFsb2cuZGF0YSgnZ2Vub2Jyb3dzZXInLCBzZWxmLmVsZW1lbnQpO1xuICAgICAgJGRpYWxvZy5maW5kKCcuaGlkZGVuJykuaGlkZSgpO1xuICAgICAgJGRpYWxvZy5maW5kKCcuc2hvdycpLnNob3coKTtcbiAgICAgIFxuICAgICAgaWYgKCRkaWFsb2cuaGFzQ2xhc3MoJ2luaXRpYWxpemVkJykpIHsgcmV0dXJuOyB9IC8vIFRoZSBmb2xsb3dpbmcgb25seSBuZWVkcyB0byBiZSBpbml0aWFsaXplZCBvbmNlXG4gICAgICBcbiAgICAgICRkaWFsb2cuYmluZCgnb3Blbi5nZW5vYnJvd3NlcicsIGZ1bmN0aW9uKCkgeyBzZWxmLiRjdXN0b21UcmFja3MudHJpZ2dlcignY2xvc2UuZ2Vub2Jyb3dzZXInKTsgfSk7XG4gICAgICAkZGlhbG9nLmZpbmQoJy5yYW5nZS1zbGlkZXInKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJG1pbiA9ICQodGhpcykucHJldignaW5wdXQnKSxcbiAgICAgICAgICAkbWF4ID0gJCh0aGlzKS5uZXh0KCdpbnB1dCcpLFxuICAgICAgICAgIG1pbiA9IHBhcnNlRmxvYXQoJG1pbi52YWwoKSksXG4gICAgICAgICAgbWF4ID0gcGFyc2VGbG9hdCgkbWF4LnZhbCgpKSxcbiAgICAgICAgICAkc2xpZGVyID0gJCh0aGlzKTtcbiAgICAgICAgJHNsaWRlci5zbGlkZXIoe1xuICAgICAgICAgIHJhbmdlOiB0cnVlLFxuICAgICAgICAgIG1pbjogbWluLFxuICAgICAgICAgIG1heDogbWF4LFxuICAgICAgICAgIHZhbHVlczogW21pbiwgbWF4XSxcbiAgICAgICAgICBzbGlkZTogZnVuY3Rpb24oZXZlbnQsIHVpKSB7XG4gICAgICAgICAgICAkbWluLnZhbCh1aS52YWx1ZXNbMF0pO1xuICAgICAgICAgICAgJG1heC52YWwodWkudmFsdWVzWzFdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAkbWluLmNoYW5nZShmdW5jdGlvbigpIHsgJHNsaWRlci5zbGlkZXIoJ3ZhbHVlJywgJCh0aGlzKS52YWwoKSk7IH0pO1xuICAgICAgICAkbWF4LmNoYW5nZShmdW5jdGlvbigpIHsgJHNsaWRlci5zbGlkZXIoJ3ZhbHVlcycsIFskc2xpZGVyLnNsaWRlcigndmFsdWVzJylbMF0sICQodGhpcykudmFsKCldKTsgfSk7XG4gICAgICB9KTtcbiAgICAgICRkaWFsb2cuZmluZCgnLmNvbG9yJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksXG4gICAgICAgICAgJHAgPSAkKCc8ZGl2IGNsYXNzPVwiY29sb3ItcGlja2VyIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20gc2hhZG93XCI+PC9kaXY+JykuaW5zZXJ0QWZ0ZXIoJGlucHV0KTtcbiAgICAgICAgJHAuZmFyYnRhc3RpYyh0aGlzKTtcbiAgICAgICAgJGlucHV0LmZvY3VzKGZ1bmN0aW9uKCkgeyAkcC5zaG93KDIwMCk7IH0pO1xuICAgICAgICAkaW5wdXQuYmx1cihmdW5jdGlvbigpIHsgJHAuaGlkZSgyMDApOyB9KTtcbiAgICAgICAgJHAuaGlkZSgpO1xuICAgICAgICAkKCc8aW5wdXQgdHlwZT1cImJ1dHRvblwiIHZhbHVlPVwiZG9uZVwiPicpLmFwcGVuZFRvKCRwKS5jbGljayhmdW5jdGlvbigpIHsgJGlucHV0LmJsdXIoKTsgfSk7XG4gICAgICB9KTtcbiAgICAgICRkaWFsb2cuZmluZCgnLmVuYWJsZXInKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKTtcbiAgICAgICAgJGlucHV0LmNoYW5nZShmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgdmFsdWUgPSAkaW5wdXQuaXMoJzpjaGVja2VkJyk7XG4gICAgICAgICAgJGlucHV0LnNpYmxpbmdzKCdbdHlwZT10ZXh0XScpLmF0dHIoJ2Rpc2FibGVkJywgIXZhbHVlKS50b2dnbGVDbGFzcygnZGlzYWJsZWQnLCAhdmFsdWUpO1xuICAgICAgICAgICRpbnB1dC5zaWJsaW5ncygnLnJhbmdlLXNsaWRlcicpLnNsaWRlcih2YWx1ZSA/ICdlbmFibGUnIDogJ2Rpc2FibGUnKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgICRkaWFsb2cuZmluZCgnW25hbWU9c2F2ZV0nKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRyayA9ICRkaWFsb2cuZGF0YSgndHJhY2snKTtcbiAgICAgICAgdHJrLmN1c3RvbS5zYXZlT3B0cygkZGlhbG9nKTtcbiAgICAgICAgc2VsZi4kbGluZXMuZmluZCgnLmJyb3dzZXItdHJhY2stJyt0cmsubisnIC50aWxlLWN1c3RvbSBjYW52YXMnKS50cmlnZ2VyKCdlcmFzZScpLnRyaWdnZXIoJ3JlbmRlcicpO1xuICAgICAgICAkZGlhbG9nLmRhdGEoJ3RyYWNrJywgZmFsc2UpO1xuICAgICAgfSk7XG4gICAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPWRlbGV0ZV0nKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgJCh0aGlzKS5oaWRlKCk7XG4gICAgICAgICRkaWFsb2cuZmluZCgnLmRlbGV0ZS1jb25maXJtJykuZmFkZUluKCk7XG4gICAgICB9KTtcbiAgICAgICRkaWFsb2cuZmluZCgnW25hbWU9cmVhbGx5X2RlbGV0ZV0nKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRuYW1lID0gJGRpYWxvZy5kYXRhKCd0cmFjaycpLm47XG4gICAgICAgIHNlbGYuX3JlbW92ZUN1c3RvbVRyYWNrKHRuYW1lKTtcbiAgICAgICAgJGRpYWxvZy5kYXRhKCd0cmFjaycsIGZhbHNlKTtcbiAgICAgIH0pO1xuICAgICAgJGRpYWxvZy5hZGRDbGFzcygnaW5pdGlhbGl6ZWQnKTtcbiAgICB9LFxuICAgIFxuICAgIF9pbml0Q2hyb21TaXplc0RpYWxvZzogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgICRjaHJvbVNpemVzRGlhbG9nID0gJChvLmRpYWxvZ3NbNF0pLmNsb3Nlc3QoJy51aS1kaWFsb2cnKTtcbiAgICAgICAgXG4gICAgICBzZWxmLl9pZ2JRdWlja2xvYWREYXRhID0gc2VsZi5faWdiUXVpY2tsb2FkRGF0YSB8fCB7fTtcbiAgICAgICAgXG4gICAgICBmdW5jdGlvbiBmaWx0ZXJHZW5vbWVMaXN0KGUpIHtcbiAgICAgICAgdmFyIHNlYXJjaFRlcm1zID0gXy5tYXAoJCh0aGlzKS52YWwoKS5zcGxpdCgvXFxzKy8pLCBmdW5jdGlvbih0KSB7IHJldHVybiB0LnRvTG93ZXJDYXNlKCk7IH0pLFxuICAgICAgICAgICRsaXN0ID0gJChlLmRhdGEubGlzdCk7XG4gICAgICAgIHNlYXJjaFRlcm1zID0gXy5yZWplY3Qoc2VhcmNoVGVybXMsIGZ1bmN0aW9uKHQpIHsgdCA9PSAnJzsgfSk7XG4gICAgICAgICRsaXN0LmNoaWxkcmVuKCdvcHRpb24nKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciB2ID0gJCh0aGlzKS50ZXh0KCkudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHRlcm1zRm91bmQgPSBfLnJlZHVjZShzZWFyY2hUZXJtcywgZnVuY3Rpb24obWVtbywgdCl7IHJldHVybiBtZW1vICsgKHYuaW5kZXhPZih0KSAhPT0gLTEgPyAxIDogMCk7IH0sIDApO1xuICAgICAgICAgIGlmIChzZWFyY2hUZXJtcy5sZW5ndGggPT0gMCB8fCB0ZXJtc0ZvdW5kID09IHNlYXJjaFRlcm1zLmxlbmd0aCkgeyAkKHRoaXMpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsgfVxuICAgICAgICAgIGVsc2UgeyAkKHRoaXMpLmFkZENsYXNzKCdoaWRkZW4nKTsgfVxuICAgICAgICB9KTtcbiAgICAgICAgJGxpc3Quc2Nyb2xsVG9wKDApLnZhbCgkbGlzdC5jaGlsZHJlbignb3B0aW9uOm5vdCguaGlkZGVuKScpLmVxKDApLnZhbCgpKS5jaGFuZ2UoKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gbG9hZGVkQ2hyb21TaXplcyhkYXRhLCAkcGFuZWwpIHtcbiAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnLmNvbnRpZ3MtbG9hZGluZycpLnN0b3AoKS5mYWRlT3V0KCk7XG4gICAgICAgIGlmIChkYXRhLmVycm9yKSB7XG4gICAgICAgICAgJHBhbmVsLmZpbmQoJy5za2lwcGVkLW51bScpLnRleHQoZGF0YS5za2lwcGVkKTtcbiAgICAgICAgICAkcGFuZWwuZmluZCgnLnVpLXN0YXRlLWVycm9yJykuZmFkZUluKCkuY2hpbGRyZW4oJy5jb250aWctbG9hZC1lcnJvcicpLnNob3coKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1jaHJvbXNpemVzXScpLnZhbChkYXRhLmNocm9tc2l6ZXMpO1xuICAgICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPW5hbWVdJykudmFsKGRhdGEuZGIpO1xuICAgICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmRhdGEoJ2dlbm9tZU1ldGFkYXRhJywgZGF0YSk7XG4gICAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9c2F2ZV0nKS5idXR0b24oJ2VuYWJsZScpLmFkZENsYXNzKCdnbG93aW5nJyk7XG4gICAgICAgICAgaWYgKGRhdGEuc2tpcHBlZCkge1xuICAgICAgICAgICAgJHBhbmVsLmZpbmQoJy5za2lwcGVkLW51bScpLnRleHQoZGF0YS5za2lwcGVkKTtcbiAgICAgICAgICAgICRwYW5lbC5maW5kKCcudWktc3RhdGUtZXJyb3InKS5mYWRlSW4oKS5jaGlsZHJlbignLnNraXBwZWQtd2FybmluZycpLnNob3coKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuYmluZCgnb3Blbi5nZW5vYnJvd3NlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJGdlbm9tZUxpc3QgPSAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT11Y3NjR2Vub21lXScpLFxuICAgICAgICAgICRpZ2JEaXJzID0gJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9aWdiRGlyc10nKSxcbiAgICAgICAgICAkaWdiTGlzdCA9ICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPWlnYkdlbm9tZV0nKSxcbiAgICAgICAgICAkbmV3SWdiRGlyID0gJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9bmV3SWdiRGlyXScpXG4gICAgICAgICAgJGxvYWRJZ2JCdG4gPSAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1sb2FkSWdiRGlyXScpLFxuICAgICAgICAgICRjYW5jZWxMb2FkSWdiQnRuID0gJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9Y2FuY2VsTG9hZElnYkRpcl0nKTtcbiAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9ZmlsdGVyVWNzY0dlbm9tZV0nKS5zZWxlY3QoKTtcbiAgICAgICAgJChvLmdlbm9tZVBpY2tlclsxXSkudHJpZ2dlcignY2xvc2UuZ2Vub2Jyb3dzZXInKTtcbiAgICAgICAgaWYgKCRjaHJvbVNpemVzRGlhbG9nLmhhc0NsYXNzKCdpbml0aWFsaXplZCcpKSB7IHJldHVybjsgfVxuICAgICAgICBcbiAgICAgICAgLy8gdGhlIGZvbGxvd2luZyBvbmx5IHJ1bnMgb25jZSwgdG8gaW5pdGlhbGl6ZSB0aGlzIGRpYWxvZydzIFVJXG4gICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJy5hY2NvcmRpb24nKS5hY2NvcmRpb24oe2hlaWdodFN0eWxlOiAnY29udGVudCd9KTtcbiAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9c2F2ZV0nKS5idXR0b24oJ2Rpc2FibGUnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIGxvYWRzIHRoZSBpbml0aWFsIGxpc3RzIG9mIGF2YWlsYWJsZSBnZW5vbWVzIGZyb20gVUNTQyAmIElHQiBRdWlja2xvYWQgZGlyZWN0b3JpZXNcbiAgICAgICAgJC5hamF4KG8uYWpheERpcisnY2hyb21zaXplcy5waHAnLCB7XG4gICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAkZ2Vub21lTGlzdC5lbXB0eSgpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgICAgICBfLmVhY2goZGF0YSwgZnVuY3Rpb24odikge1xuICAgICAgICAgICAgICB2YXIgJG9wdGlvbiA9ICQoJzxvcHRpb24vPicpLnRleHQodi5zcGVjaWVzICsgJyAoJyArIHYubmFtZSArICcpICcgKyB2LmFzc2VtYmx5RGF0ZSk7XG4gICAgICAgICAgICAgICRvcHRpb24udmFsKHYubmFtZSkuZGF0YSgnbWV0YWRhdGEnLCB2KS5hcHBlbmRUbygkZ2Vub21lTGlzdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAkLmFqYXgoby5hamF4RGlyKydpZ2IucGhwJywge1xuICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgdmFyIGZpcnN0RGlyO1xuICAgICAgICAgICAgJGlnYkRpcnMuY2hpbGRyZW4oKS5lcSgwKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIF8uZWFjaChkYXRhLCBmdW5jdGlvbih2LCBrKSB7XG4gICAgICAgICAgICAgIGZpcnN0RGlyID0gZmlyc3REaXIgfHwgaztcbiAgICAgICAgICAgICAgJCgnPG9wdGlvbi8+JykudGV4dChrKS52YWwoaykuaW5zZXJ0QmVmb3JlKCRpZ2JEaXJzLmNoaWxkcmVuKCkubGFzdCgpKTtcbiAgICAgICAgICAgICAgc2VsZi5faWdiUXVpY2tsb2FkRGF0YVtrXSA9IHY7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRpZ2JEaXJzLnZhbChmaXJzdERpcikuY2hhbmdlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIGltcGxlbWVudHMgZmlsdGVyaW5nIGJ5IGtleXdvcmRcbiAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9ZmlsdGVyVWNzY0dlbm9tZV0nKS5iaW5kKCdrZXl1cCBjaGFuZ2UnLCB7bGlzdDogJGdlbm9tZUxpc3R9LCBmaWx0ZXJHZW5vbWVMaXN0KTtcbiAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9ZmlsdGVySWdiR2Vub21lXScpLmJpbmQoJ2tleXVwIGNoYW5nZScsIHtsaXN0OiAkaWdiTGlzdH0sIGZpbHRlckdlbm9tZUxpc3QpO1xuICAgICAgICBcbiAgICAgICAgLy8gbG9hZCB0aGUgY2hyb20gc2l6ZXMgZGF0YSB3aGVuIHNlbGVjdGluZyBhIFVDU0MgZ2Vub21lXG4gICAgICAgICRnZW5vbWVMaXN0LmJpbmQoJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBkYiA9ICQodGhpcykudmFsKCksXG4gICAgICAgICAgICAkdWNzY09wdGlvbnMgPSAkY2hyb21TaXplc0RpYWxvZy5maW5kKCcudWNzYy1vcHRpb25zJyk7XG4gICAgICAgICAgaWYgKCFkYikgeyByZXR1cm47IH1cbiAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1zYXZlXScpLmJ1dHRvbignZGlzYWJsZScpLnJlbW92ZUNsYXNzKCdnbG93aW5nJyk7XG4gICAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnLmNvbnRpZ3MtbG9hZGluZycpLnNob3coKTtcbiAgICAgICAgICAkdWNzY09wdGlvbnMuZmluZCgnLnVpLXN0YXRlLWVycm9yLCAuY29udGlnLWxvYWQtZXJyb3IsIC5za2lwcGVkLXdhcm5pbmcnKS5oaWRlKCk7XG4gICAgICAgICAgJC5hamF4KG8uYWpheERpcisnY2hyb21zaXplcy5waHAnLCB7XG4gICAgICAgICAgICBkYXRhOiB7IGRiOiBkYiwgbGltaXQ6ICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPWxpbWl0XScpLnZhbCgpIH0sXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkgeyBsb2FkZWRDaHJvbVNpemVzKGRhdGEsICR1Y3NjT3B0aW9ucyk7IH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPWxpbWl0XScpLmNoYW5nZShmdW5jdGlvbigpIHsgJGdlbm9tZUxpc3QuY2hhbmdlKCk7IH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gbG9hZCB0aGUgY29udGVudHMudHh0IG9mIGFuIElHQiBRdWlja2xvYWQgZGlyZWN0b3J5IHdoZW4gc2VsZWN0aW5nIGl0cyBVUkxcbiAgICAgICAgJGlnYkRpcnMuYmluZCgnY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIHVybCA9ICQodGhpcykudmFsKCk7XG4gICAgICAgICAgaWYgKCRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJy5pZ2ItZGlycycpLmlzKCc6aGlkZGVuJykpIHsgJGNhbmNlbExvYWRJZ2JCdG4uY2xpY2soKTsgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFNob3cgdGhlIGFkZCBVUkwgaW5wdXQgYm94XG4gICAgICAgICAgaWYgKHVybCA9PSAnJykge1xuICAgICAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnLmlnYi1kaXJzJykuc2xpZGVVcChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnLmFkZC1pZ2ItZGlyJykuc2xpZGVEb3duKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVMaXN0KHVybCkge1xuICAgICAgICAgICAgJGlnYkxpc3QuZW1wdHkoKS5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xuICAgICAgICAgICAgXy5lYWNoKHNlbGYuX2lnYlF1aWNrbG9hZERhdGFbdXJsXSwgZnVuY3Rpb24odiwgaykge1xuICAgICAgICAgICAgICAkKCc8b3B0aW9uLz4nKS50ZXh0KHYpLnZhbCh1cmwgKyAnLycgKyBrKS5hcHBlbmRUbygkaWdiTGlzdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKHNlbGYuX2lnYlF1aWNrbG9hZERhdGFbdXJsXSkgeyBwb3B1bGF0ZUxpc3QodXJsKTsgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJGlnYkxpc3QuZW1wdHkoKS5hcHBlbmQoJzxvcHRpb24+bG9hZGluZy4uLjwvb3B0aW9uPicpLmFkZENsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgICAgICAkLmFqYXgoby5hamF4RGlyKydpZ2IucGhwJywge1xuICAgICAgICAgICAgICBkYXRhOiB7IHVybDogdXJsLCBsaW1pdDogJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9aWdibGltaXRdJykudmFsKCkgfSxcbiAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIF8uZXh0ZW5kKHNlbGYuX2lnYlF1aWNrbG9hZERhdGEsIGRhdGEpO1xuICAgICAgICAgICAgICAgIHBvcHVsYXRlTGlzdCh1cmwpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gVUkgZm9yIGFkZGluZyBJR0IgUXVpY2tsb2FkIGRpcmVjdG9yaWVzXG4gICAgICAgICRsb2FkSWdiQnRuLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciB1cmwgPSAkbmV3SWdiRGlyLnZhbCgpLnJlcGxhY2UoL1xcLyQvLCAnJyk7XG4gICAgICAgICAgJCgnPG9wdGlvbi8+JykudGV4dCh1cmwpLnZhbCh1cmwpLmluc2VydEJlZm9yZSgkaWdiRGlycy5jaGlsZHJlbigpLmxhc3QoKSk7XG4gICAgICAgICAgJGlnYkRpcnMudmFsKHVybCkuY2hhbmdlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICAkY2FuY2VsTG9hZElnYkJ0bi5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgICAkbmV3SWdiRGlyLnZhbCgnJyk7XG4gICAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnLmFkZC1pZ2ItZGlyJykuc2xpZGVVcChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJy5pZ2ItZGlycycpLnNsaWRlRG93bigpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRPRE86IGxvYWQgYW4gSUdCIFF1aWNrbG9hZCBnZW5vbWUncyBkYXRhIHdoZW4gc2VsZWN0aW5nIGl0IGZyb20gdGhlIGxpc3RcbiAgICAgICAgJGlnYkxpc3QuYmluZCgnY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIHVybCA9ICQodGhpcykudmFsKCksXG4gICAgICAgICAgICAkaWdiT3B0aW9ucyA9ICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJy5pZ2Itb3B0aW9ucycpO1xuICAgICAgICAgIGlmICghdXJsKSB7IHJldHVybjsgfVxuICAgICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPXNhdmVdJykuYnV0dG9uKCdkaXNhYmxlJykucmVtb3ZlQ2xhc3MoJ2dsb3dpbmcnKTtcbiAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCcuY29udGlncy1sb2FkaW5nJykuc2hvdygpO1xuICAgICAgICAgICRpZ2JPcHRpb25zLmZpbmQoJy51aS1zdGF0ZS1lcnJvciwgLmNvbnRpZy1sb2FkLWVycm9yLCAuc2tpcHBlZC13YXJuaW5nJykuaGlkZSgpO1xuICAgICAgICAgICQuYWpheChvLmFqYXhEaXIrJ2lnYi5waHAnLCB7XG4gICAgICAgICAgICBkYXRhOiB7IHVybDogdXJsLCBsaW1pdDogJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9aWdibGltaXRdJykudmFsKCkgfSxcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7IGxvYWRlZENocm9tU2l6ZXMoZGF0YSwgJGlnYk9wdGlvbnMpOyB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuYWRkQ2xhc3MoJ2luaXRpYWxpemVkJyk7XG4gICAgICB9KTtcbiAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPWNocm9tc2l6ZXNdJykub25lKCdmb2N1cycsIGZ1bmN0aW9uKCkgeyBcbiAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKS5yZW1vdmVDbGFzcygncGxhY2Vob2xkZXInKTtcbiAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9c2F2ZV0nKS5idXR0b24oJ2VuYWJsZScpO1xuICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uKCkgeyAkdGhpcy5zZWxlY3QoKTsgfSk7XG4gICAgICB9KTtcbiAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPXNhdmVdJykuY2xpY2soZnVuY3Rpb24oZSwgY2hvc2UpIHsgXG4gICAgICAgIHZhciBtZXRhZGF0YSA9IHsgZm9ybWF0OiAnY2hyb21zaXplcycgfSxcbiAgICAgICAgICByZW1vdGVNZXRhZGF0YSA9ICRjaHJvbVNpemVzRGlhbG9nLmRhdGEoJ2dlbm9tZU1ldGFkYXRhJyksXG4gICAgICAgICAgYWN0aXZlQWNjb3JkaW9uID0gJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnLnVpLWFjY29yZGlvbicpLmFjY29yZGlvbignb3B0aW9uJywgJ2FjdGl2ZScpLFxuICAgICAgICAgIGNob3NlV2hhdFNvdXJjZSA9IFsndWNzYycsICdpZ2InLCAnY2hyb21zaXplcyddLFxuICAgICAgICAgIG9yaWdNZXRhZGF0YSwgJG9yaWdPcHRpb24sIGdlbm9tZTtcbiAgICAgICAgY2hvc2UgPSBjaG9zZSB8fCBjaG9zZVdoYXRTb3VyY2VbYWN0aXZlQWNjb3JkaW9uXTtcbiAgICAgICAgaWYgKGNob3NlID09ICd1Y3NjJyB8fCBjaG9zZSA9PSAnaWdiJykge1xuICAgICAgICAgIC8vIFRoaXMgaXMgYW4gdW5hbHRlcmVkIHNldCBvZiBjaHJvbW9zb21lIHNpemVzIHB1bGxlZCBmcm9tIFVDU0NcbiAgICAgICAgICBjaHJvbVNpemVzID0gcmVtb3RlTWV0YWRhdGEuY2hyb21zaXplcztcbiAgICAgICAgICBtZXRhZGF0YS5uYW1lID0gcmVtb3RlTWV0YWRhdGEuZGI7XG4gICAgICAgICAgbWV0YWRhdGEudHJhY2tzID0gcmVtb3RlTWV0YWRhdGEudHJhY2tzO1xuICAgICAgICAgIG9yaWdNZXRhZGF0YSA9IHJlbW90ZU1ldGFkYXRhO1xuICAgICAgICAgIGlmIChjaG9zZSA9PSAndWNzYycpIHtcbiAgICAgICAgICAgICRvcmlnT3B0aW9uID0gJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9dWNzY0dlbm9tZV0gPiBvcHRpb25bdmFsdWU9JyttZXRhZGF0YS5uYW1lKyddJyk7XG4gICAgICAgICAgICBpZiAoIXJlbW90ZU1ldGFkYXRhLnNwZWNpZXMpIHsgb3JpZ01ldGFkYXRhID0gJG9yaWdPcHRpb24uZGF0YSgnbWV0YWRhdGEnKTsgfVxuICAgICAgICAgICAgbWV0YWRhdGEudWNzYyA9IG1ldGFkYXRhLm5hbWUgKyAnOicgKyByZW1vdGVNZXRhZGF0YS5saW1pdDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gVE9ETzogZmluZCBzb21lIHdheSB0byBnZXQgdGhlIG90aGVyIG1ldGFkYXRhL2N1c3RvbSB0cmFjayBkYXRhIGZyb20gYW5ub3RzLnhtbCBpbnRvIG1ldGFkYXRhXG4gICAgICAgICAgICBtZXRhZGF0YS5pZ2IgPSByZW1vdGVNZXRhZGF0YS5saW1pdCArICc6JyArIG1ldGFkYXRhLm5hbWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIG1ldGFkYXRhLnNwZWNpZXMgPSBvcmlnTWV0YWRhdGEuc3BlY2llcztcbiAgICAgICAgICBtZXRhZGF0YS5hc3NlbWJseURhdGUgPSBvcmlnTWV0YWRhdGEuYXNzZW1ibHlEYXRlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNocm9tU2l6ZXMgPSAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1jaHJvbXNpemVzXScpLnZhbCgpO1xuICAgICAgICAgIG1ldGFkYXRhLm5hbWUgPSAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1uYW1lXScpLnZhbCgpO1xuICAgICAgICB9XG4gICAgICAgIEN1c3RvbUdlbm9tZXMucGFyc2VBc3luYyhjaHJvbVNpemVzLCBtZXRhZGF0YSwgZnVuY3Rpb24oZ2Vub21lKSB7XG4gICAgICAgICAgc2VsZi5fc2V0T3B0aW9ucyhnZW5vbWUub3B0aW9ucyh7IHdpZHRoOiBzZWxmLmxpbmVXaWR0aCgpICogc2VsZi4kbGluZXMubGVuZ3RoIH0pKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIFxuICAgIF9pbml0Q3VzdG9tR2Vub21lRGlhbG9nczogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgICRnZW5vbWVEaWFsb2cgPSAkKG8uZGlhbG9nc1s1XSkuY2xvc2VzdCgnLnVpLWRpYWxvZycpLFxuICAgICAgICAkYWRkID0gJGdlbm9tZURpYWxvZy5maW5kKCcuZm9ybS1saW5lJykuZmlyc3QoKSxcbiAgICAgICAgJG92ZXJsYXkgPSAkKG8ub3ZlcmxheVswXSksXG4gICAgICAgICRvdmVybGF5TWVzc2FnZSA9ICQoby5vdmVybGF5WzFdKSxcbiAgICAgICAgZmlsZUlucHV0SFRNTCA9ICc8aW5wdXQgdHlwZT1cImZpbGVcIiBuYW1lPVwiZ2Vub21lRmlsZVwiLz4nLFxuICAgICAgICB1cmxJbnB1dEhUTUwgPSAnPGlucHV0IHR5cGU9XCJ1cmxcIiBuYW1lPVwiZ2Vub21lVXJsXCIgY2xhc3M9XCJ1cmxcIi8+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICc8aW5wdXQgdHlwZT1cImJ1dHRvblwiIG5hbWU9XCJnZW5vbWVVcmxHZXRcIiB2YWx1ZT1cIkxvYWRcIi8+JztcbiAgICAgIFxuICAgICAgc2VsZi5faW5pdENocm9tU2l6ZXNEaWFsb2coKTtcbiAgICAgIFxuICAgICAgZnVuY3Rpb24gY3VzdG9tR2Vub21lRXJyb3IoZSkge1xuICAgICAgICAkZ2Vub21lRGlhbG9nLmZpbmQoJy5zcGlubmVyJykuaGlkZSgpO1xuICAgICAgICB2YXIgbXNnID0gZS5tZXNzYWdlLnJlcGxhY2UoL15VbmNhdWdodCBFcnJvcjogLywgJycpO1xuICAgICAgICBhbGVydCgnU29ycnksIGFuIGVycm9yIG9jY3VycmVkIHdoaWxlIGFkZGluZyB0aGlzIGN1c3RvbSBnZW5vbWUgZmlsZTpcXG5cXG4nICsgbXNnKTtcbiAgICAgICAgLy8gVE9ETzogcmVwbGFjZSB0aGlzIHdpdGggc29tZXRoaW5nIG1vcmUgZnJpZW5kbHkuXG4gICAgICAgIHJlcGxhY2VGaWxlSW5wdXQoKTsgXG4gICAgICB9XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIGhhbmRsZUZpbGVTZWxlY3QoZSkge1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKSxcbiAgICAgICAgICAkYWRkID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLmZvcm0tbGluZScpLFxuICAgICAgICAgICRzcGlubmVyID0gJGFkZC5maW5kKCcuc3Bpbm5lcicpLnNob3coKTtcbiAgICAgICAgICBcbiAgICAgICAgJG92ZXJsYXkuc2hvdygpO1xuICAgICAgICAkb3ZlcmxheU1lc3NhZ2Uuc2hvdygpLnRleHQoJ0xvYWRpbmcgY3VzdG9tIGdlbm9tZS4uLicpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGUudGFyZ2V0LmZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoZnVuY3Rpb24oZikge1xuICAgICAgICAgICAgdmFyIG1ldGFkYXRhID0geyBmaWxlOiBmLm5hbWUgfSxcbiAgICAgICAgICAgICAgZ2Vub21lO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgICAgICAgIEN1c3RvbUdlbm9tZXMucGFyc2VBc3luYyhldi50YXJnZXQucmVzdWx0LCBtZXRhZGF0YSwgZnVuY3Rpb24oZ2Vub21lKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5fc2V0T3B0aW9ucyhnZW5vbWUub3B0aW9ucyh7IHdpZHRoOiBzZWxmLmxpbmVXaWR0aCgpICogc2VsZi4kbGluZXMubGVuZ3RoIH0pKTtcbiAgICAgICAgICAgICAgICAkc3Bpbm5lci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgJGdlbm9tZURpYWxvZy5mYWRlT3V0KCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KShlLnRhcmdldC5maWxlc1swXSk7XG4gICAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZS50YXJnZXQuZmlsZXNbMF0pO1xuICAgICAgICB9XG4gICAgICAgIHJlcGxhY2VGaWxlSW5wdXQoKTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIHJlcGxhY2VGaWxlSW5wdXQoKSB7XG4gICAgICAgIF8uZGVmZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJGdlbm9tZURpYWxvZy5maW5kKCdbbmFtZT1nZW5vbWVGaWxlXScpLnJlcGxhY2VXaXRoKGZpbGVJbnB1dEhUTUwpO1xuICAgICAgICAgICRnZW5vbWVEaWFsb2cuZmluZCgnW25hbWU9Z2Vub21lRmlsZV0nKS5jaGFuZ2UoaGFuZGxlRmlsZVNlbGVjdCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKHdpbmRvdy5GaWxlICYmIHdpbmRvdy5GaWxlUmVhZGVyICYmIHdpbmRvdy5GaWxlTGlzdCkge1xuICAgICAgICAkYWRkLmZpbmQoJ2xhYmVsJykuaHRtbChmaWxlSW5wdXRIVE1MKTtcbiAgICAgICAgJGFkZC5maW5kKCdbbmFtZT1nZW5vbWVGaWxlXScpLmNoYW5nZShoYW5kbGVGaWxlU2VsZWN0KTtcbiAgICAgICAgJGFkZCA9ICRhZGQubmV4dEFsbCgnLmZvcm0tbGluZScpLmZpcnN0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkYWRkLnJlbW92ZSgpO1xuICAgICAgICAkZ2Vub21lRGlhbG9nLmZpbmQoJy5oZWxwLWxpbmUnKS5maXJzdCgpLnJlbW92ZSgpO1xuICAgICAgICAkYWRkID0gJHBpY2tlci5maW5kKCcuZm9ybS1saW5lJykuZmlyc3QoKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gaGFuZGxlUGFzdGVkRGF0YShlKSB7XG4gICAgICAgIHZhciAkYWRkID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLmZvcm0tbGluZScpLFxuICAgICAgICAgICRzcGlubmVyID0gJGFkZC5maW5kKCcuc3Bpbm5lcicpLnNob3coKTtcbiAgICAgICAgJG92ZXJsYXkuc2hvdygpO1xuICAgICAgICAkb3ZlcmxheU1lc3NhZ2Uuc2hvdygpLnRleHQoJ0xvYWRpbmcgY3VzdG9tIGdlbm9tZS4uLicpO1xuICAgICAgICBDdXN0b21HZW5vbWVzLnBhcnNlQXN5bmMoJGFkZC5maW5kKCd0ZXh0YXJlYScpLnZhbCgpLCB7IGZpbGU6IFwiX3Bhc3RlZF9kYXRhXCIgfSwgZnVuY3Rpb24oZ2Vub21lKSB7XG4gICAgICAgICAgc2VsZi5fc2V0T3B0aW9ucyhnZW5vbWUub3B0aW9ucyh7IHdpZHRoOiBzZWxmLmxpbmVXaWR0aCgpICogc2VsZi4kbGluZXMubGVuZ3RoIH0pKTtcbiAgICAgICAgICAkc3Bpbm5lci5oaWRlKCk7XG4gICAgICAgICAgJGdlbm9tZURpYWxvZy5mYWRlT3V0KCk7XG4gICAgICAgICAgJGFkZC5maW5kKCd0ZXh0YXJlYScpLnZhbCgnJyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgJGFkZC5maW5kKCdbbmFtZT1jdXN0b21HZW5vbWVQYXN0ZUFkZF0nKS5jbGljayhoYW5kbGVQYXN0ZWREYXRhKTtcbiAgICAgICRhZGQgPSAkYWRkLm5leHRBbGwoJy5mb3JtLWxpbmUnKS5maXJzdCgpO1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBoYW5kbGVVcmxTZWxlY3QoZSkge1xuICAgICAgICB2YXIgJGFkZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5mb3JtLWxpbmUnKSxcbiAgICAgICAgICAkc3Bpbm5lciA9ICRhZGQuZmluZCgnLnNwaW5uZXInKSxcbiAgICAgICAgICAkdXJsID0gJGFkZC5maW5kKCdbbmFtZT1nZW5vbWVVcmxdJyksXG4gICAgICAgICAgdXJsID0gJC50cmltKCR1cmwudmFsKCkpO1xuICAgICAgICBpZiAoIXVybC5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgICAgICRzcGlubmVyLnNob3coKTtcbiAgICAgICAgJG92ZXJsYXkuc2hvdygpO1xuICAgICAgICAkb3ZlcmxheU1lc3NhZ2Uuc2hvdygpLnRleHQoJ0xvYWRpbmcgY3VzdG9tIGdlbm9tZS4uLicpO1xuICAgICAgICAkLmFqYXgodXJsLCB7XG4gICAgICAgICAgZGF0YVR5cGU6IFwidGV4dFwiLFxuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIEN1c3RvbUdlbm9tZXMucGFyc2VBc3luYyhkYXRhLCB7dXJsOiB1cmx9LCBmdW5jdGlvbihnZW5vbWUpIHtcbiAgICAgICAgICAgICAgc2VsZi5fc2V0T3B0aW9ucyhnZW5vbWUub3B0aW9ucyh7IHdpZHRoOiBzZWxmLmxpbmVXaWR0aCgpICogc2VsZi4kbGluZXMubGVuZ3RoIH0pKTtcbiAgICAgICAgICAgICAgJHNwaW5uZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAkdXJsLnZhbCgnJyk7XG4gICAgICAgICAgICAgICRnZW5vbWVEaWFsb2cuZmFkZU91dCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwcm9ncmVzczogZnVuY3Rpb24obG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgdmFyICRwcm9ncmVzcyA9ICRvdmVybGF5TWVzc2FnZS5maW5kKCcudWktcHJvZ3Jlc3NiYXInKTtcbiAgICAgICAgICAgIGlmICghJHByb2dyZXNzLmxlbmd0aCkgeyAkcHJvZ3Jlc3MgPSAkKCc8ZGl2Lz4nKS5hcHBlbmRUbygkb3ZlcmxheU1lc3NhZ2UpLnByb2dyZXNzYmFyKCk7IH1cbiAgICAgICAgICAgICRwcm9ncmVzcy5wcm9ncmVzc2JhcigndmFsdWUnLCBsb2FkZWQvdG90YWwgKiAxMDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG92ZXJsYXkuaGlkZSgpO1xuICAgICAgICAgICAgJG92ZXJsYXlNZXNzYWdlLmhpZGUoKTtcbiAgICAgICAgICAgIGN1c3RvbUdlbm9tZUVycm9yKHttZXNzYWdlOiBcIk5vIHZhbGlkIGN1c3RvbSB0cmFjayBkYXRhIHdhcyBmb3VuZCBhdCB0aGlzIFVSTC5cIn0pOyBcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgJGFkZC5maW5kKCdsYWJlbCcpLmh0bWwodXJsSW5wdXRIVE1MKTtcbiAgICAgICRhZGQuZmluZCgnW25hbWU9Z2Vub21lVXJsR2V0XScpLmNsaWNrKGhhbmRsZVVybFNlbGVjdCk7XG4gICAgICAkYWRkLmZpbmQoJ1tuYW1lPWdlbm9tZVVybF0nKS5iaW5kKCdrZXlkb3duJywgZnVuY3Rpb24oZSkgeyBpZiAoZS53aGljaD09MTMpIHsgaGFuZGxlVXJsU2VsZWN0KGUpOyB9IH0pO1xuICAgIH0sXG4gICAgXG4gICAgX2luaXRGcm9tUGFyYW1zOiBmdW5jdGlvbihwYXJhbXMsIHN1cHByZXNzUmVwZWF0KSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgICRlbGVtID0gc2VsZi5lbGVtZW50LFxuICAgICAgICAkb3ZlcmxheSA9ICQoby5vdmVybGF5WzBdKSxcbiAgICAgICAgJG92ZXJsYXlNZXNzYWdlID0gJChvLm92ZXJsYXlbMV0pLFxuICAgICAgICAkY3VzdG9tUGlja2VyID0gJChvLnRyYWNrUGlja2VyWzNdKSxcbiAgICAgICAgJGdlbm9tZURpYWxvZyA9ICQoby5kaWFsb2dzWzVdKS5jbG9zZXN0KCcudWktZGlhbG9nJyksXG4gICAgICAgICRjaHJvbVNpemVzRGlhbG9nID0gJChvLmRpYWxvZ3NbNF0pLmNsb3Nlc3QoJy51aS1kaWFsb2cnKSxcbiAgICAgICAgJHRyYWNrVXJsSW5wdXQgPSAkY3VzdG9tUGlja2VyLmZpbmQoJ1tuYW1lPWN1c3RvbVVybF0nKSxcbiAgICAgICAgJHRyYWNrVXJsR2V0ID0gJGN1c3RvbVBpY2tlci5maW5kKCdbbmFtZT1jdXN0b21VcmxHZXRdJyksXG4gICAgICAgICRnZW5vbWVVcmxJbnB1dCA9ICRnZW5vbWVEaWFsb2cuZmluZCgnW25hbWU9Z2Vub21lVXJsXScpLFxuICAgICAgICAkZ2Vub21lVXJsR2V0ID0gJGdlbm9tZURpYWxvZy5maW5kKCdbbmFtZT1nZW5vbWVVcmxHZXRdJyksXG4gICAgICAgIHJlbW90ZUdlbm9tZVNldHRpbmdzID0ge1xuICAgICAgICAgIHVjc2M6IHsgdXJsOiAnY2hyb21zaXplcy5waHAnLCBtZXNzYWdlVGV4dDogJ2Zyb20gVUNTQycgfSxcbiAgICAgICAgICBpZ2I6IHsgdXJsOiAnaWdiLnBocCcsIG1lc3NhZ2VUZXh0OiAndmlhIElHQiBRdWlja2xvYWQnIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2Vzc2lvblZhcnMgPSB7fSxcbiAgICAgICAgY3VzdG9tVHJhY2tzQXJyYXksIGN1c3RvbUdlbm9tZVBpZWNlcywgY3VzdG9tR2Vub21lU291cmNlLCBjdXN0b21HZW5vbWVOYW1lLCBjaHJvbVNpemVzLCB0cmFja1NwZWMsIFxuICAgICAgICAgIHJlbW90ZSwgcmVtb3RlUGFyYW1zO1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBwZXJzaXN0ZW50Q29va2llKGssIHYpIHsgJC5jb29raWUoaywgdiwge2V4cGlyZXM6IDYwfSk7IH1cbiAgICAgIGZ1bmN0aW9uIHJlbW92ZUNvb2tpZShrKSB7ICQuY29va2llKGssIG51bGwpOyB9XG4gICAgICBwZXJzaXN0ZW50Q29va2llKCdkYicsIG8uZ2Vub21lKTtcbiAgICAgIHNlbGYuc3RvcmFnZSA9IHtcbiAgICAgICAgc2Vzc2lvbjogd2luZG93LnNlc3Npb25TdG9yYWdlIHx8IHtzZXRJdGVtOiAkLmNvb2tpZSwgZ2V0SXRlbTogJC5jb29raWUsIHJlbW92ZUl0ZW06IHJlbW92ZUNvb2tpZX0sXG4gICAgICAgIHBlcnNpc3RlbnQ6IHdpbmRvdy5sb2NhbFN0b3JhZ2UgfHwge3NldEl0ZW06IHBlcnNpc3RlbnRDb29raWUsIGdldEl0ZW06ICQuY29va2llLCByZW1vdmVJdGVtOiByZW1vdmVDb29raWV9XG4gICAgICB9O1xuICAgICAgXy5lYWNoKG8uc2F2YWJsZVBhcmFtcywgZnVuY3Rpb24oa2V5cywgZGVzdCkge1xuICAgICAgICBfLmVhY2goa2V5cywgZnVuY3Rpb24oaykge1xuICAgICAgICAgIHZhciB2ID0gc2VsZi5zdG9yYWdlW2Rlc3RdLmdldEl0ZW0oKGRlc3QgIT0gJ3BlcnNpc3RlbnQnID8gby5nZW5vbWUgKyAnLicgOiAnJykgKyBrKTsgXG4gICAgICAgICAgaWYgKHYgIT09IG51bGwpIHsgc2Vzc2lvblZhcnNba10gPSB2OyB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMgfHwgXy5leHRlbmQoe30sIHNlc3Npb25WYXJzLCAkLnVybFBhcmFtcygpKTtcbiAgICAgICAgICAgIFxuICAgICAgaWYgKHN1cHByZXNzUmVwZWF0ICYmIHNlbGYuX2xhc3RQYXJhbXMgJiYgXy5pc0VxdWFsKHNlbGYuX2xhc3RQYXJhbXMsIHBhcmFtcykpIHsgcmV0dXJuOyB9XG4gICAgICBzZWxmLl9sYXN0UGFyYW1zID0gXy5jbG9uZShwYXJhbXMpO1xuICAgICAgXG4gICAgICBjdXN0b21UcmFja3NBcnJheSA9IF8uY29tcGFjdChbXS5jb25jYXQocGFyYW1zLmN1c3RvbVRyYWNrcykpLFxuICAgICAgc2VsZi5fY3VzdG9tVHJhY2tVcmxzLnJlcXVlc3RlZCA9IF8udW5pb24oc2VsZi5fY3VzdG9tVHJhY2tVcmxzLnJlcXVlc3RlZCwgY3VzdG9tVHJhY2tzQXJyYXkpO1xuICAgICAgdmFyIHVucHJvY2Vzc2VkVXJscyA9IF8uZGlmZmVyZW5jZShzZWxmLl9jdXN0b21UcmFja1VybHMucmVxdWVzdGVkLCBzZWxmLl9jdXN0b21UcmFja1VybHMucHJvY2Vzc2luZyk7XG4gICAgICBcbiAgICAgIC8vIFdlIG5lZWQgdG8gbG9hZCBhIGN1c3RvbSBnZW5vbWVcbiAgICAgIGlmIChwYXJhbXMuZGIgIT0gby5nZW5vbWUpIHtcbiAgICAgICAgY3VzdG9tR2Vub21lUGllY2VzID0gKHBhcmFtcy5kYiB8fCAnJykuc3BsaXQoJzonKTtcbiAgICAgICAgY3VzdG9tR2Vub21lU291cmNlID0gY3VzdG9tR2Vub21lUGllY2VzWzBdO1xuICAgICAgICByZW1vdGUgPSByZW1vdGVHZW5vbWVTZXR0aW5nc1tjdXN0b21HZW5vbWVTb3VyY2VdO1xuICAgICAgICBpZiAoY3VzdG9tR2Vub21lU291cmNlID09ICd1cmwnKSB7ICAgLy8gSXQncyBhIFVSTCB0byBhIGZ1bGwgZ2Vub21lIGZpbGVcbiAgICAgICAgICAkZ2Vub21lVXJsSW5wdXQudmFsKGN1c3RvbUdlbm9tZVBpZWNlcy5zbGljZSgxKS5qb2luKCc6JykpO1xuICAgICAgICAgICRnZW5vbWVVcmxHZXQuY2xpY2soKTtcbiAgICAgICAgICBzZWxmLl9uZXh0RGlyZWN0aXZlcyA9IHBhcmFtcztcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSBpZiAocmVtb3RlKSB7XG4gICAgICAgICAgLy8gSXQncyBhIGdlbm9tZSBzdG9yZWQgYXQgVUNTQyBvciBpbiBhbiBJR0IgUXVpY2tsb2FkIGRpcmVjdG9yeVxuICAgICAgICAgICRvdmVybGF5LnNob3coKTtcbiAgICAgICAgICAkb3ZlcmxheU1lc3NhZ2Uuc2hvdygpLnRleHQoJ0xvYWRpbmcgZ2Vub21lICcgKyByZW1vdGUubWVzc2FnZVRleHQgKyAnLi4uJyk7XG4gICAgICAgICAgaWYgKGN1c3RvbUdlbm9tZVNvdXJjZSA9PSAndWNzYycpIHtcbiAgICAgICAgICAgIHJlbW90ZVBhcmFtcyA9IHsgZGI6IGN1c3RvbUdlbm9tZVBpZWNlc1sxXSwgbGltaXQ6IGN1c3RvbUdlbm9tZVBpZWNlc1syXSwgbWV0YTogMSB9O1xuICAgICAgICAgIH0gZWxzZSB7IC8vIGN1c3RvbUdlbm9tZVNvdXJjZSA9PSAnaWdiJ1xuICAgICAgICAgICAgcmVtb3RlUGFyYW1zID0geyB1cmw6IGN1c3RvbUdlbm9tZVBpZWNlcy5zbGljZSgyKS5qb2luKCc6JyksIGxpbWl0OiBjdXN0b21HZW5vbWVQaWVjZXNbMV0gfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgJC5hamF4KG8uYWpheERpciArIHJlbW90ZS51cmwsIHtcbiAgICAgICAgICAgIGRhdGE6IHJlbW90ZVBhcmFtcyxcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgIGlmIChkYXRhLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgJG92ZXJsYXlNZXNzYWdlLnRleHQoJ0Vycm9yIGxvYWRpbmcgZ2Vub21lIGRhdGEgJyArIHJlbW90ZS5tZXNzYWdlVGV4dCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZGF0YSgnZ2Vub21lTWV0YWRhdGEnLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1zYXZlXScpLnRyaWdnZXIoJ2NsaWNrJywgW2N1c3RvbUdlbm9tZVNvdXJjZV0pO1xuICAgICAgICAgICAgICAgIHNlbGYuX25leHREaXJlY3RpdmVzID0gcGFyYW1zO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2UgaWYgKCgvXmN1c3RvbVs6fF0vKS50ZXN0KHBhcmFtcy5kYikpIHsgICAvLyBJdCdzIGEgY3VzdG9tIGNocm9tLnNpemVzXG4gICAgICAgICAgY2hyb21TaXplcyA9IHBhcmFtcy5kYi5yZXBsYWNlKC9eW158XStcXHwvLCAnJykucmVwbGFjZSgvOi9nLCBcIlxcdFwiKS5yZXBsYWNlKC9cXHwvZywgXCJcXG5cIik7XG4gICAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9Y2hyb21zaXplc10nKS52YWwoY2hyb21TaXplcyk7XG4gICAgICAgICAgY3VzdG9tR2Vub21lTmFtZSA9IChwYXJhbXMuZGJbNl0gPT0gJzonKSA/IHBhcmFtcy5kYi5zdWJzdHJpbmcoNykucmVwbGFjZSgvXFx8LiovLCAnJykgOiAnJztcbiAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1uYW1lXScpLnZhbChjdXN0b21HZW5vbWVOYW1lKTtcbiAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1zYXZlXScpLnRyaWdnZXIoJ2NsaWNrJywgWydjaHJvbXNpemVzJ10pO1xuICAgICAgICAgIHNlbGYuX25leHREaXJlY3RpdmVzID0gcGFyYW1zO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBJZiB0aGVyZSBhcmUgY3VzdG9tIHRyYWNrIFVSTHMgc29tZXdoZXJlIGluIHRoZSBwYXJhbWV0ZXJzIHRoYXQgaGF2ZSBub3QgYmVlbiBwcm9jZXNzZWQgeWV0XG4gICAgICAvLyB0aGV5IG5lZWQgdG8gYmUgbG9hZGVkIGJlZm9yZSB3ZSBjYW4gbWFrZSBzZW5zZSBvZiB0aGUgcmVzdCBvZiB0aGUgcGFyYW1zXG4gICAgICBpZiAodW5wcm9jZXNzZWRVcmxzLmxlbmd0aCkge1xuICAgICAgICAkb3ZlcmxheS5zaG93KCk7XG4gICAgICAgICRvdmVybGF5TWVzc2FnZS5zaG93KCkudGV4dCgnTG9hZGluZyBjdXN0b20gdHJhY2suLi4nKTtcbiAgICAgICAgJHRyYWNrVXJsSW5wdXQudmFsKHVucHJvY2Vzc2VkVXJsc1swXSk7ICR0cmFja1VybEdldC5jbGljaygpO1xuICAgICAgICAvLyBUaGlzIHNob3VsZCBoYXZlIGFkZGVkIHRoZSBVUkwgdG8gc2VsZi5fY3VzdG9tVHJhY2tVcmxzLnByb2Nlc3NpbmcsIHNvIGl0IHdpbGwgbm90IGJlIHN1Ym1pdHRlZCBhZ2FpblxuICAgICAgICBzZWxmLl9uZXh0RGlyZWN0aXZlcyA9IHBhcmFtcztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChwYXJhbXMubW9kZSkgeyAkKG8ubGluZU1vZGUpLmZpbmQoJ1t2YWx1ZT1cIicrcGFyYW1zLm1vZGUrJ1wiXScpLmNsaWNrKCk7IH1cbiAgICAgICAgaWYgKHBhcmFtcy50cmFja3MpIHtcbiAgICAgICAgICB0cmFja1NwZWMgPSBfLm1hcChwYXJhbXMudHJhY2tzLnNwbGl0KCd8JyksIGZ1bmN0aW9uKHYpIHsgXG4gICAgICAgICAgICB2YXIgc3BsaXQgPSB2LnNwbGl0KCc6JyksIHRyayA9IHtuOiBzcGxpdFswXX07XG4gICAgICAgICAgICBpZiAoc3BsaXQubGVuZ3RoID4gMSAmJiAoL15cXGQrJC8udGVzdChzcGxpdFsxXSkpKSB7IHRyay5oID0gcGFyc2VJbnQoc3BsaXRbMV0sIDEwKTsgfVxuICAgICAgICAgICAgcmV0dXJuIHRyazsgXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc2VsZi5fZml4VHJhY2tzKHt9LCB0cmFja1NwZWMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJhbXMucG9zaXRpb24pIHsgc2VsZi5qdW1wVG8ocGFyYW1zLnBvc2l0aW9uKTsgfVxuICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vID0gVGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgY29vcmRpbmF0ZSB0aGUgZGlzcGxheSBvZiBicm93c2VyIGxpbmVzICgkLnVpLmdlbm9saW5lJ3MpID1cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgXG4gICAgLy8gRml4IHRoZSBudW1iZXIgb2YgbGluZXMgZGlzcGxheWVkIHZlcnRpY2FsbHksIHNoaWZ0aW5nIGFuZCB1bnNoaWZ0aW5nIGxpbmVzIHRvIGZpbGwgdGhlIHZlcnRpY2FsIHNwYWNlXG4gICAgLy8gWW91IGNhbiBzcGVjaWZ5IHRoZSBsaW5lIGluZGV4IHRvIGhvbGRTdGVhZHkgKGtlZXAgaW4gcm91Z2hseSB0aGUgc2FtZSBwbGFjZSksIGFuZCBhbmltT3B0cyBmb3IgdGhlIGFuaW1hdGlvblxuICAgIF9maXhOdW1MaW5lczogZnVuY3Rpb24oaG9sZFN0ZWFkeSwgYW5pbU9wdHMpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsIFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICBhdmFpbEhlaWdodCA9ICRlbGVtLmlubmVySGVpZ2h0KCksXG4gICAgICAgIGxpbmVIZWlnaHQgPSBzZWxmLl9saW5lSGVpZ2h0KCksXG4gICAgICAgIG51bUxpbmVzID0gc2VsZi4kbGluZXMubGVuZ3RoLFxuICAgICAgICBmb3JjZU9uZUxpbmUgPSAkKG8ubGluZU1vZGUpLmZpbmQoJzpjaGVja2VkJykudmFsKCkgPT0gJ3NpbmdsZScsXG4gICAgICAgIG5ld051bUxpbmVzID0gZm9yY2VPbmVMaW5lID8gMSA6IE1hdGgubWF4KGZsb29ySGFjayhhdmFpbEhlaWdodCAvIGxpbmVIZWlnaHQpLCAxKSxcbiAgICAgICAgZXh0cmFTcGFjZSA9IGF2YWlsSGVpZ2h0IC0gKG5ld051bUxpbmVzICogbGluZUhlaWdodCksXG4gICAgICAgIGV4dHJhTGluZUhlaWdodCA9IGV4dHJhU3BhY2UgPiAwID8gbGluZUhlaWdodCArIGV4dHJhU3BhY2UgLyBuZXdOdW1MaW5lcyA6IGxpbmVIZWlnaHQsXG4gICAgICAgIGV4dHJhVG9wTWFyZ2luID0gbmV3TnVtTGluZXMgPT09IDEgPyBNYXRoLm1heCgoYXZhaWxIZWlnaHQgLSBsaW5lSGVpZ2h0KSAvIDIuMCwgMCkgOiAwLFxuICAgICAgICB1blNoaWZ0TGluZXMgPSAwLCBwdXNoTGluZXMgPSAwLFxuICAgICAgICBkZXN0SW5kZXgsIGN1cnJUb3A7XG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQoaG9sZFN0ZWFkeSkgJiYgaG9sZFN0ZWFkeSAhPT0gbnVsbCkge1xuICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoaG9sZFN0ZWFkeS5zaGlmdCkpIHtcbiAgICAgICAgICB1blNoaWZ0TGluZXMgPSAtaG9sZFN0ZWFkeS5zaGlmdDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjdXJyVG9wID0gc2VsZi4kbGluZXMuZXEoaG9sZFN0ZWFkeSkucG9zaXRpb24oKS50b3A7XG4gICAgICAgICAgLy8gU3BlY2lhbCBjYXNlIHRoZSByZXNpemluZyBvZiB0aGUgY2VudHJhbCBsaW5lOiBpdCBtdXN0IHN0YXkgdGhlIGNlbnRyYWwgbGluZVxuICAgICAgICAgIGlmIChob2xkU3RlYWR5ID09IHRoaXMuY2VudHJhbExpbmUpIHsgZGVzdEluZGV4ID0gTWF0aC5jZWlsKG5ld051bUxpbmVzIC8gMikgLSAxOyB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkZXN0SW5kZXggPSBfLm1pbihfLnJhbmdlKG5ld051bUxpbmVzKSwgZnVuY3Rpb24oaSkgeyBcbiAgICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKGkgKiBleHRyYUxpbmVIZWlnaHQgKyBleHRyYVRvcE1hcmdpbiAtIGN1cnJUb3ApOyBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICB1blNoaWZ0TGluZXMgPSBkZXN0SW5kZXggLSBob2xkU3RlYWR5O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBwdXNoTGluZXMgPSBuZXdOdW1MaW5lcyAtIG51bUxpbmVzIC0gdW5TaGlmdExpbmVzO1xuICAgICAgdW5TaGlmdExpbmVzID4gMCA/IHNlbGYuX2FkZExpbmVzKC11blNoaWZ0TGluZXMpIDogc2VsZi5fcmVtb3ZlTGluZXModW5TaGlmdExpbmVzLCBhbmltT3B0cyk7XG4gICAgICBwdXNoTGluZXMgPiAwID8gc2VsZi5fYWRkTGluZXMocHVzaExpbmVzKSA6IHNlbGYuX3JlbW92ZUxpbmVzKC1wdXNoTGluZXMsIGFuaW1PcHRzKTtcbiAgICAgIHNlbGYuY2VudHJhbExpbmUgPSBNYXRoLmNlaWwobmV3TnVtTGluZXMgLyAyKSAtIDE7XG4gICAgICBzZWxmLl9wb3Moc2VsZi5wb3MgLSB1blNoaWZ0TGluZXMgKiBzZWxmLmJwV2lkdGgoKSk7XG4gICAgICAvLyBPbmx5IGZpcmUgYSBjb21wbGV0aW9uIGNhbGxiYWNrIG9uY2UgZm9yIHRoZSB3aG9sZSBicm93c2VyXG4gICAgICBpZiAoYW5pbU9wdHMgJiYgYW5pbU9wdHMuY29tcGxldGUpIHsgYW5pbU9wdHMuY29tcGxldGUgPSBfLmFmdGVyKHNlbGYuJGxpbmVzLmxlbmd0aCwgYW5pbU9wdHMuY29tcGxldGUpOyB9XG4gICAgICBzZWxmLiRsaW5lcy5lYWNoKGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgdmFyIG5ld1RvcCA9IGkgKiBleHRyYUxpbmVIZWlnaHQgKyBleHRyYVRvcE1hcmdpbjtcbiAgICAgICAgJCh0aGlzKS5kYXRhKCduYXR1cmFsVG9wJywgbmV3VG9wKTtcbiAgICAgICAgaWYgKGhvbGRTdGVhZHkgJiYgaG9sZFN0ZWFkeS5leGNlcHRGb3IgPT0gdGhpcykgeyByZXR1cm47IH1cbiAgICAgICAgJCh0aGlzKS5hbmltYXRlKHt0b3A6IG5ld1RvcH0sICQuZXh0ZW5kKHtcbiAgICAgICAgICBkdXJhdGlvbjogby5saW5lRml4RHVyYXRpb24sXG4gICAgICAgICAgcXVldWU6IGZhbHNlLFxuICAgICAgICAgIGVhc2luZzogJ2Vhc2VJbk91dFF1YXJ0J1xuICAgICAgICB9LCBhbmltT3B0cykpO1xuICAgICAgfSk7XG4gICAgICBzZWxmLl91cGRhdGVSZXRpY2xlKG51bGwsIGFuaW1PcHRzKTtcbiAgICB9LFxuICAgIFxuICAgIC8vIEEgc2hvcnRjdXQgdGhhdCBwdXNoZXMgdGhlIGxpbmVzIGluIHRoZSBkaXNwbGF5IHVwIG9yIGRvd25cbiAgICBzaGlmdExpbmVzOiBmdW5jdGlvbihudW0sIGV4Y2VwdEZvciwgYW5pbU9wdHMpIHsgdGhpcy5fZml4TnVtTGluZXMoe3NoaWZ0OiBudW0sIGV4Y2VwdEZvcjogZXhjZXB0Rm9yfSwgYW5pbU9wdHMpOyB9LFxuICAgIFxuICAgIC8vIEFkZCBudW0gbGluZXMgdG8gdGhlIGJyb3dzZXI7IHRoZXkgYmVnaW4gb2Zmc2NyZWVuIGFuZCBtdXN0IGJlIG1vdmVkIGludG8gdmlld1xuICAgIC8vIHBvc2l0aXZlIG51bSBhZGRzIHRvIHRoZSBlbmQ7IG5lZ2F0aXZlIG51bSBhZGRzIHRvIHRoZSBiZWdpbm5pbmdcbiAgICBfYWRkTGluZXM6IGZ1bmN0aW9uKG51bSkge1xuICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgIGJwV2lkdGggPSB0aGlzLmJwV2lkdGgoKSxcbiAgICAgICAgb3JpZ2luID0gdGhpcy5wb3MgKyAobnVtID4gMCA/IHRoaXMuJGxpbmVzLmxlbmd0aCAqIGJwV2lkdGggOiAtYnBXaWR0aCksXG4gICAgICAgIGJwU3RlcCA9IG51bSA+IDAgPyBicFdpZHRoIDogLWJwV2lkdGgsXG4gICAgICAgIC8vIENhbid0IHVzZSBub3JtYWwgLnVuc2hpZnQoKSBvbiBhIGpRdWVyeSBvYmplY3QsIGl0IG9ubHkgaGFzIHNwbGljZS5cbiAgICAgICAgb3BzID0gbnVtID4gMCA/IFsnYXBwZW5kVG8nLCBmdW5jdGlvbih4KXt0aGlzLnB1c2goeCk7fV0gOiBbJ3ByZXBlbmRUbycsIGZ1bmN0aW9uKHgpe3RoaXMuc3BsaWNlKDAsMCx4KTt9XSxcbiAgICAgICAgc2V0VG9wID0gbnVtID4gMCA/ICQod2luZG93KS5pbm5lckhlaWdodCgpICsgby5iZXR3ZWVuTGluZXMgOiAtdGhpcy5fbGluZUhlaWdodCgpLFxuICAgICAgICAkbGluZSwgbmV3T3B0cztcbiAgICAgIG51bSA9IE1hdGguYWJzKG51bSk7XG4gICAgICB3aGlsZSAobnVtLS0+MCkge1xuICAgICAgICAkbGluZSA9ICQoJzxkaXYgY2xhc3M9XCJicm93c2VyLWxpbmVcIj48L2Rpdj4nKVtvcHNbMF1dKHRoaXMuZWxlbWVudCk7XG4gICAgICAgIG5ld09wdHMgPSAkLmV4dGVuZCh7fSwgbywge2Jyb3dzZXI6IHRoaXMuZWxlbWVudCwgb3JpZ2luOiBvcmlnaW59KTtcbiAgICAgICAgb3BzWzFdLmNhbGwodGhpcy4kbGluZXMsICRsaW5lLmdldCgwKSk7XG4gICAgICAgICRsaW5lLmNzcygndG9wJywgc2V0VG9wKS5nZW5vbGluZShuZXdPcHRzKTtcbiAgICAgICAgb3JpZ2luICs9IGJwU3RlcDtcbiAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIC8vIFJlbW92ZSBudW0gbGluZXMgdG8gdGhlIGJyb3dzZXI7IHRoZXkgZmFkZSBvdXQgYW5kIGFyZSBkZWxldGVkIGZyb20gdGhlIERPTVxuICAgIC8vIHBvc2l0aXZlIG51bSByZW1vdmVzIGZyb20gdGhlIGVuZDsgbmVnYXRpdmUgbnVtIHJlbW92ZXMgZnJvbSB0aGUgYmVnaW5uaW5nXG4gICAgX3JlbW92ZUxpbmVzOiBmdW5jdGlvbihudW0sIGFuaW1PcHRzKSB7XG4gICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgYnBXaWR0aCA9IHRoaXMuYnBXaWR0aCgpLFxuICAgICAgICBkdXJhdGlvbiA9IGFuaW1PcHRzICYmICFfLmlzVW5kZWZpbmVkKGFuaW1PcHRzLmR1cmF0aW9uKSA/IGFuaW1PcHRzLmR1cmF0aW9uIDogby5saW5lRml4RHVyYXRpb24sXG4gICAgICAgIGluZGV4ID0gbnVtID4gMCA/IC0xIDogMCxcbiAgICAgICAgLy8gV2UgY2FuJ3QgdXNlIG5vcm1hbCAucG9wKCkgYW5kIC5zaGlmdCgpIG9uIGEgalF1ZXJ5IG9iamVjdCwgaXQgb25seSBoYXMgc3BsaWNlLlxuICAgICAgICBwb3BPclNoaWZ0ID0gbnVtID4gMCA/IFxuICAgICAgICAgIGZ1bmN0aW9uKCRhKXsgJGEuc3BsaWNlKCRhLmxlbmd0aC0xLDEpOyB9IDogZnVuY3Rpb24oJGEpeyAkYS5zcGxpY2UoMCwxKTsgfTtcbiAgICAgIG51bSA9IE1hdGguYWJzKG51bSk7XG4gICAgICB3aGlsZSAobnVtLS0+MCkge1xuICAgICAgICBpZiAoZHVyYXRpb24gPiAwKSB7XG4gICAgICAgICAgdGhpcy4kbGluZXMuZXEoaW5kZXgpLmZhZGVPdXQoZHVyYXRpb24sIGZ1bmN0aW9uKCkgeyAkKHRoaXMpLnJlbW92ZSgpOyB9KTtcbiAgICAgICAgfSBlbHNlIHsgdGhpcy4kbGluZXMuZXEoaW5kZXgpLnJlbW92ZSgpOyB9XG4gICAgICAgIHBvcE9yU2hpZnQodGhpcy4kbGluZXMpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLy8gUmV0dXJucyB0aGUgZWxlbWVudHMgdGhhdCBjb250YWluIGVhY2ggbGluZSBvZiB0aGUgZGlzcGxheVxuICAgIGxpbmVzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuJGxpbmVzOyB9LFxuICAgIFxuICAgIC8vIFJldHVybnMgdGhlIGV4cGVjdGVkIHdpZHRoLCBpbiBwaXhlbHMsIG9mIGVhY2ggbGluZVxuICAgIGxpbmVXaWR0aDogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLl93aWR0aCAtIHRoaXMub3B0aW9ucy5zaWRlQmFyV2lkdGg7IH0sXG4gICAgXG4gICAgLy8gUmV0dXJucyB0aGUgZXhwZWN0ZWQgaGVpZ2h0LCBpbiBwaXhlbHMsIG9mIGVhY2ggbGluZVxuICAgIF9saW5lSGVpZ2h0OiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgcmV0dXJuIG8uYmV0d2VlbkxpbmVzICsgXy5yZWR1Y2Uoby50cmFja3MsIGZ1bmN0aW9uKHQsIHUpIHsgcmV0dXJuIHtoOnQuaCArIHUuaH07IH0pLmg7XG4gICAgfSxcbiAgICBcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vID0gVGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgY29vcmRpbmF0ZSB0aGUgdHJhY2tzICgkLnVpLmdlbm90cmFjaydzKSBkaXNwbGF5ZWQgd2l0aGluIGVhY2ggbGluZSA9XG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBcbiAgICAvLyBSZXR1cm5zIHRoZSBjdXJyZW50IGFycmF5IG9mIHRyYWNrcywgd2l0aCBhbGwgYXNzb2NpYXRlZCBvcHRpb25zLCB0aGF0IGFyZSBzdXBwb3NlZCB0byBiZSBkaXNwbGF5ZWRcbiAgICB0cmFja3M6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5vcHRpb25zLnRyYWNrczsgfSxcbiAgICBcbiAgICAvLyBFbnN1cmVzIGFsbCBsaW5lcyBoYXZlIHRoZSByaWdodCB0cmFja3MsIGFzIHNwZWNpZmllZCBieSB0aGUgY2hlY2tib3hlcyBpbiB0aGUgdHJhY2sgcGlja2VycyBvciB0aGUgdHJhY2tTcGVjXG4gICAgX2ZpeFRyYWNrczogZnVuY3Rpb24oYW5pbU9wdHMsIHRyYWNrU3BlYykge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgICAgbmV3VHJhY2tzID0gW10sXG4gICAgICAgIHByZXZUcmFja3MgPSBbXSxcbiAgICAgICAgcHJldlBvcyA9IHNlbGYucG9zICsgc2VsZi5fcmV0aWNEZWx0YSgpLFxuICAgICAgICBleHRlcm5hbFRyYWNrU3BlYyA9ICEhdHJhY2tTcGVjO1xuICAgICAgXG4gICAgICAvLyBTeW5jIHRoZSB0cmFja1NwZWMgd2l0aCB0aGUgY2hlY2tib3hlcyBpbiB0aGUgdHJhY2sgcGlja2Vyc1xuICAgICAgLy8gSWYgdHJhY2tTcGVjIHdhcyBub3QgcHJvdmlkZWQsIHRoaXMgc2ltcGx5IHJldHJpZXZlcyBvbmUgZnJvbSB0aGUgc3RhdGUgb2YgdGhlIGNoZWNrYm94ZXNcbiAgICAgIHRyYWNrU3BlYyA9IHNlbGYuX3RyYWNrU3BlYyh0cmFja1NwZWMpO1xuICAgICAgbmV3VHJhY2tzID0gXy5wbHVjayh0cmFja1NwZWMsICduJyk7XG4gICAgICBcbiAgICAgIC8vIEZpcnN0IHJlbW92ZSBhbnkgdHJhY2tzIHRoYXQgYXJlIG5vdCBpbiB0aGUgbmV3IHNldFxuICAgICAgby50cmFja3MgPSBfLmZpbHRlcihvLnRyYWNrcywgZnVuY3Rpb24odCkge1xuICAgICAgICB2YXIgaSA9IF8uaW5kZXhPZihuZXdUcmFja3MsIHQubik7XG4gICAgICAgIGlmIChpICE9PSAtMSkgeyBcbiAgICAgICAgICBwcmV2VHJhY2tzLnB1c2godC5uKTtcbiAgICAgICAgICAvLyBSZXNpemUgZXhpc3RpbmcgdHJhY2tzIGlmIGEgbmV3IGhlaWdodCBpcyBzcGVjaWZpZWRcbiAgICAgICAgICBpZiAodHJhY2tTcGVjW2ldLmgpIHsgc2VsZi5fcmVzaXplVHJhY2sodC5uLCB0cmFja1NwZWNbaV0uaCwgZmFsc2UsIGZhbHNlKTsgfVxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIC8vIE5vdywgYWRkIGFueSB0cmFja3MgdGhhdCBhcmUgaW4gdGhlIG5ldyBzZXQgYnV0IGFyZW4ndCBpbiB0aGUgb2xkIHNldFxuICAgICAgXy5lYWNoKG5ld1RyYWNrcywgZnVuY3Rpb24obmFtZSwgaSkge1xuICAgICAgICB2YXIgc3BlYyA9IHRyYWNrU3BlY1tpXTtcbiAgICAgICAgaWYgKCFfLmluY2x1ZGUocHJldlRyYWNrcywgbmFtZSkpIHsgby50cmFja3Muc3BsaWNlKGksIDAsICQuZXh0ZW5kKHt9LCBzZWxmLmF2YWlsVHJhY2tzW25hbWVdLCBzcGVjLmggPyB7aDogc3BlYy5ofSA6IHt9KSk7IH0gXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgc2VsZi4kbGluZXMuZ2Vub2xpbmUoJ2ZpeFRyYWNrcycpO1xuICAgICAgc2VsZi5fZml4TnVtTGluZXMoMCwgYW5pbU9wdHMpO1xuICAgICAgaWYgKHByZXZQb3MgPCBvLmdlbm9tZVNpemUgJiYgcHJldlBvcyA+IDAgJiYgKCFhbmltT3B0cyB8fCAhYW5pbU9wdHMuY29tcGxldGUpKSB7IHNlbGYuanVtcFRvKHByZXZQb3MpOyB9XG4gICAgICBpZiAoIWV4dGVybmFsVHJhY2tTcGVjKSB7IHRoaXMuX3NhdmVQYXJhbXNEZWJvdW5jZWQoKTsgfVxuICAgIH0sXG4gICAgXG4gICAgLy8gUmVzaXplIGEgdHJhY2sgdG8gYSBwYXJ0aWN1bGFyIGhlaWdodCwgZml4aW5nIHRoZSBsaW5lIGxheW91dCBhZnRlcndhcmQgdW5sZXNzIGZpeE51bUxpbmVzSG9sZGluZ1N0ZWFkeSBpcyBmYWxzZSxcbiAgICAvLyBTZXQgYW5pbUNhbGxiYWNrIHRvIHRydWUgdG8gYW5pbWF0ZSB3aXRoIG5vIGNhbGxiYWNrLCBhIGZ1bmN0aW9uIHRvIHByb3ZpZGUgYSBjYWxsYmFjaywgb3IgZmFsc2UgZm9yIG5vIGFuaW1hdGlvbi5cbiAgICBfcmVzaXplVHJhY2s6IGZ1bmN0aW9uKG5hbWUsIGhlaWdodCwgZml4TnVtTGluZXNIb2xkaW5nU3RlYWR5LCBhbmltQ2FsbGJhY2spIHtcbiAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAkZWxlbSA9IHRoaXMuZWxlbWVudCxcbiAgICAgICAgdHJrID0gXy5maW5kKG8udHJhY2tzLCBmdW5jdGlvbih0KSB7IHJldHVybiB0Lm4gPT0gbmFtZTsgfSksXG4gICAgICAgICRsaW5lcyA9IHRoaXMuJGxpbmVzLFxuICAgICAgICAkdHJhY2tzID0gJGxpbmVzLmZpbmQoJy5icm93c2VyLXRyYWNrLScrbmFtZSk7XG4gICAgICBhbmltQ2FsbGJhY2sgPSBfLmlzRnVuY3Rpb24oYW5pbUNhbGxiYWNrKSA/IF8uYWZ0ZXIoJHRyYWNrcy5sZW5ndGgsIGFuaW1DYWxsYmFjaykgOiBhbmltQ2FsbGJhY2s7XG4gICAgICB0cmsuaCA9IGhlaWdodDtcbiAgICAgICR0cmFja3MuZ2Vub3RyYWNrKCdyZXNpemUnLCBoZWlnaHQsIGFuaW1DYWxsYmFjayk7XG4gICAgICBpZiAoZml4TnVtTGluZXNIb2xkaW5nU3RlYWR5ICE9PSBmYWxzZSkgeyB0aGlzLl9maXhOdW1MaW5lcyhmaXhOdW1MaW5lc0hvbGRpbmdTdGVhZHkpOyB9XG4gICAgICAkbGluZXMuZ2Vub2xpbmUoJ2ZpeEZpcnN0TGFiZWwnLCB0cnVlKTtcbiAgICB9LFxuICAgIFxuICAgIC8vIFN5bmNzIGEgbGlzdCBvZiB0cmFja3MgKHdpdGggaGVpZ2h0cyksIHRoZSB0cmFja1NwZWMsIHdpdGggdGhlIGNoZWNrYm94ZXMgaW4gdGhlIHRyYWNrIHBpY2tlcnNcbiAgICBfdHJhY2tTcGVjOiBmdW5jdGlvbih0cmFja1NwZWMpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgJGNoZWNrYm94ZXMgPSBzZWxmLiR0cmFja1BpY2tlci5maW5kKCc6Y2hlY2tib3gnKS5hZGQoc2VsZi4kY3VzdG9tVHJhY2tzLmZpbmQoJzpjaGVja2JveCcpKTtcbiAgICAgIGlmICghdHJhY2tTcGVjIHx8ICFfLmlzQXJyYXkodHJhY2tTcGVjKSB8fCAhdHJhY2tTcGVjLmxlbmd0aCkge1xuICAgICAgICB0cmFja1NwZWMgPSBbXTtcbiAgICAgICAgJGNoZWNrYm94ZXMuZmlsdGVyKCc6Y2hlY2tlZCcpLmVhY2goZnVuY3Rpb24oKSB7IHRyYWNrU3BlYy5wdXNoKHtuOiAkKHRoaXMpLmF0dHIoJ25hbWUnKX0pOyB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENsZWFudXAgZXh0ZXJuYWwgdHJhY2tTcGVjczogZm9yIG5vdywgZGlzYWxsb3cgZHVwZXMsIGFuZCBtYWtlIHN1cmUgYWxsIHRyYWNrcyBhY3R1YWxseSBleGlzdFxuICAgICAgICB0cmFja1NwZWMgPSBfLnVuaXEoXy5maWx0ZXIodHJhY2tTcGVjLCBmdW5jdGlvbih0KSB7IHJldHVybiBzZWxmLmF2YWlsVHJhY2tzW3Qubl07IH0pLCBmdW5jdGlvbih0KSB7IHJldHVybiB0Lm47IH0pO1xuICAgICAgICAkY2hlY2tib3hlcy5hdHRyKCdjaGVja2VkJywgZmFsc2UpO1xuICAgICAgICBfLmVhY2godHJhY2tTcGVjLCBmdW5jdGlvbih0KSB7ICRjaGVja2JveGVzLmZpbHRlcignW25hbWU9XCInK3QubisnXCJdJykuYXR0cignY2hlY2tlZCcsIHRydWUpOyB9KTtcbiAgICAgIH1cbiAgICAgIC8vIGlmIHRoZXJlIGlzIG9ubHkgb25lIG5ld1RyYWNrLCBkaXNhYmxlIHRoZSBjaGVja2JveCBzbyB0aGVyZSBhcmUgYWx3YXlzIOKJpTEgdHJhY2tzXG4gICAgICBpZiAodHJhY2tTcGVjLmxlbmd0aCA9PT0gMSkgeyAkY2hlY2tib3hlcy5maWx0ZXIoJzpjaGVja2VkJykuYXR0cignZGlzYWJsZWQnLCB0cnVlKTsgfVxuICAgICAgZWxzZSB7ICRjaGVja2JveGVzLmF0dHIoJ2Rpc2FibGVkJywgZmFsc2UpOyB9XG4gICAgICByZXR1cm4gdHJhY2tTcGVjO1xuICAgIH0sXG4gICAgXG4gICAgLy8gUmVzZXRzIHRvIHRoZSBkZWZhdWx0IHNldCBvZiB0cmFja3NcbiAgICBfcmVzZXRUb0RlZmF1bHRUcmFja3M6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fZml4VHJhY2tzKGZhbHNlLCB0aGlzLmRlZmF1bHRUcmFja3MpO1xuICAgICAgdGhpcy5fc2F2ZVBhcmFtc0RlYm91bmNlZCgpO1xuICAgIH0sXG4gICAgXG4gICAgLy8gQWZ0ZXIgYSBjdXN0b20gdHJhY2sgZmlsZSBpcyBwYXJzZWQsIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHRvIGFkZCB0aGVtIHRvIHRoZSBjdXN0b20gdHJhY2sgcGlja2VyIGFuZCBlYWNoXG4gICAgLy8gYnJvd3NlciBsaW5lOyB0aGV5IGFyZSBhbHNvIGluc2VydGVkIGluIHNlbGYuYXZhaWxUcmFja3MganVzdCBsaWtlIFwibm9ybWFsXCIgdHJhY2tzXG4gICAgX2FkZEN1c3RvbVRyYWNrczogZnVuY3Rpb24oZm5hbWUsIGN1c3RvbVRyYWNrcywgdXJsKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgICR1bCA9ICQoby50cmFja1BpY2tlclszXSkuY2hpbGRyZW4oJ3VsJykuZXEoMCksXG4gICAgICAgIGQgPSBvLnRyYWNrRGVzYyxcbiAgICAgICAgYnJvd3NlckRpcmVjdGl2ZXMgPSBfLmV4dGVuZCh7fSwgY3VzdG9tVHJhY2tzLmJyb3dzZXIsIHNlbGYuX25leHREaXJlY3RpdmVzIHx8IHt9KSxcbiAgICAgICAgd2FybmluZ3MgPSBbXSxcbiAgICAgICAgY3VzdG9tVHJhY2tOYW1lcyA9IF8ubWFwKGN1c3RvbVRyYWNrcywgZnVuY3Rpb24odCwgaSkgeyByZXR1cm4gY2xhc3NGcmllbmRseSgnXycrZm5hbWUrJ18nKyh0Lm9wdHMubmFtZSB8fCBpKSk7IH0pLFxuICAgICAgICBuZXdUcmFja3MgPSBfLmZpbHRlcihjdXN0b21UcmFja05hbWVzLCBmdW5jdGlvbihuKSB7IHJldHVybiAhc2VsZi5hdmFpbFRyYWNrc1tuXSB9KSxcbiAgICAgICAgbmV4dERpcmVjdGl2ZXNJbmNsdWRlT25lTmV3VHJhY2sgPSBzZWxmLl9uZXh0RGlyZWN0aXZlcyAmJiBzZWxmLl9uZXh0RGlyZWN0aXZlcy50cmFja3MgJiZcbiAgICAgICAgICAhIV8uZmluZChzZWxmLl9uZXh0RGlyZWN0aXZlcy50cmFja3Muc3BsaXQoJ3wnKSwgZnVuY3Rpb24odikgeyByZXR1cm4gXy5jb250YWlucyhuZXdUcmFja3MsIHYuc3BsaXQoJzonKVswXSk7IH0pO1xuICAgICAgXG4gICAgICBfLmVhY2goY3VzdG9tVHJhY2tzLCBmdW5jdGlvbih0LCBpKSB7XG4gICAgICAgIHZhciBuID0gY3VzdG9tVHJhY2tOYW1lc1tpXSxcbiAgICAgICAgICBuZXdUcmFjayA9ICFzZWxmLmF2YWlsVHJhY2tzW25dLFxuICAgICAgICAgICRsaSwgJGwsICRjLCAkZCwgJG87XG4gICAgICAgIGlmIChuZXdUcmFjaykge1xuICAgICAgICAgICRsaSA9ICQoJzxsaSBjbGFzcz1cImNob2ljZVwiLz4nKS5hcHBlbmRUbygkdWwpO1xuICAgICAgICAgICRsID0gJCgnPGxhYmVsIGNsYXNzPVwiY2xpY2thYmxlXCIvPicpLmFwcGVuZFRvKCRsaSk7XG4gICAgICAgICAgJGMgPSAkKCc8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgY2hlY2tlZD1cImNoZWNrZWRcIi8+JykuYXR0cignbmFtZScsIG4pLnByZXBlbmRUbygkbCk7XG4gICAgICAgICAgJGQgPSAkKCc8ZGl2IGNsYXNzPVwiZGVzY1wiPjwvZGl2PicpLmFwcGVuZFRvKCRsKTtcbiAgICAgICAgICAkbyA9ICQoJzxidXR0b24gY2xhc3M9XCJvcHRzXCI+PGltZyBzcmM9XCJjc3MvZ2Vhci5wbmdcIiBhbHQ9XCJnZWFyXCIgLz48L2J1dHRvbj4nKS5hcHBlbmRUbygkbGkpLFxuICAgICAgICAgICRsLmhvdmVyKGZ1bmN0aW9uKCkgeyAkKHRoaXMpLmFkZENsYXNzKCdob3ZlcicpOyB9LCBmdW5jdGlvbigpIHsgJCh0aGlzKS5yZW1vdmVDbGFzcygnaG92ZXInKTsgfSk7XG4gICAgICAgICAgJGwuYXR0cigndGl0bGUnLCBuKTtcbiAgICAgICAgICAkYy5iaW5kKCdjaGFuZ2UnLCBfLmJpbmQoc2VsZi5fZml4VHJhY2tzLCBzZWxmKSk7XG4gICAgICAgICAgJG8uYnV0dG9uKCkuY2xpY2soXy5iaW5kKHNlbGYuX2VkaXRDdXN0b21UcmFjaywgc2VsZiwgbikpO1xuICAgICAgICAgICQoJzxoMyBjbGFzcz1cIm5hbWVcIi8+PHAgY2xhc3M9XCJsb25nLWRlc2NcIi8+JykuYXBwZW5kVG8oJGQpO1xuICAgICAgICAgIC8vIElmIHRyYWNrIHNldHRpbmdzIGFyZSB0byBiZSBhcHBsaWVkLCBlbnN1cmUgYW55IG5ldyBjdXN0b20gdHJhY2tzIGFyZSBhZGRlZCB0byB0aGVtXG4gICAgICAgICAgLy8gVGhpcyBwcmV2ZW50cyBuZXcgdHJhY2tzIGZyb20gYmVpbmcgYWRkZWQgYW5kIHRoZW4gaW1tZWRpYXRlbHkgaGlkZGVuIChjb25mdXNpbmcpXG4gICAgICAgICAgLy8gLS0gT25lIGV4Y2VwdGlvbiEgSWYgc2VsZi5fbmV4dERpcmVjdGl2ZXMgY29udGFpbiBhdCBsZWFzdCBvbmUgdHJhY2sgbmFtZVxuICAgICAgICAgIC8vICAgIGFtb25nIHRoZSBuZXcgdHJhY2tzIHRvIGJlIGFkZGVkLCBkbyBub3QgZG8gdGhpcywgd2UgdGhlbiBhc3N1bWUgdGhleSBhcmUgb3ZlcnJpZGluZy5cbiAgICAgICAgICBpZiAoYnJvd3NlckRpcmVjdGl2ZXMudHJhY2tzICYmICFuZXh0RGlyZWN0aXZlc0luY2x1ZGVPbmVOZXdUcmFjaykge1xuICAgICAgICAgICAgaWYgKCFfLmZpbmQoYnJvd3NlckRpcmVjdGl2ZXMudHJhY2tzLnNwbGl0KCd8JyksIGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHYuc3BsaXQoJzonKVswXSA9PSBuOyB9KSkge1xuICAgICAgICAgICAgICBicm93c2VyRGlyZWN0aXZlcy50cmFja3MgKz0gJ3wnICsgbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7ICRkID0gJHVsLmZpbmQoJ1tuYW1lPScrbisnXScpLnBhcmVudCgpLmNoaWxkcmVuKCcuZGVzYycpOyB9XG4gICAgICAgIGlmICh1cmwpIHsgdC51cmwgPSB1cmw7IH1cbiAgICAgICAgLy8gVE9ETzogaWYgdGhlIHRyYWNrIGlzIG5vdCBuZXcsIGluZm9ybSB0aGF0IGl0cyBkYXRhIHdhcyByZXBsYWNlZCB3aXRoIHRoZSBuZXcgdHJhY2sgaW5mb3JtYXRpb25cbiAgICAgICAgc2VsZi5hdmFpbFRyYWNrc1tuXSA9IHtcbiAgICAgICAgICBmaDoge1wiMC4xXCI6IHtkZW5zZTogdC5oZWlnaHRzLnN0YXJ0fX0sXG4gICAgICAgICAgbjogbixcbiAgICAgICAgICBoOiB0LmhlaWdodHMuc3RhcnQsXG4gICAgICAgICAgczogdC5zaXplcyxcbiAgICAgICAgICBtOiB0Lm1hcFNpemVzLFxuICAgICAgICAgIGN1c3RvbTogdFxuICAgICAgICB9O1xuICAgICAgICBfLmVhY2goby5icHBwcywgZnVuY3Rpb24oYnBwcCkgeyBzZWxmLmF2YWlsVHJhY2tzW25dLmZoW28uYnBwcEZvcm1hdChicHBwKV0gPSB7ZGVuc2U6IHQuaGVpZ2h0cy5taW59OyB9KTtcbiAgICAgICAgZFtuXSA9IHtcbiAgICAgICAgICBjYXQ6IGZuYW1lLFxuICAgICAgICAgIGxnOiB0Lm9wdHMuZGVzY3JpcHRpb24gfHwgdC5vcHRzLm5hbWUgfHwgbiwgXG4gICAgICAgICAgc206IHQub3B0cy5uYW1lIHx8IG5cbiAgICAgICAgfTtcbiAgICAgICAgJGQuY2hpbGRyZW4oJ2gzLm5hbWUnKS50ZXh0KGRbbl0uc20pO1xuICAgICAgICAkZC5jaGlsZHJlbigncC5sb25nLWRlc2MnKS50ZXh0KGRbbl0ubGcgJiYgZFtuXS5sZyAhPSBkW25dLnNtID8gZFtuXS5sZyA6IGZuYW1lKTtcbiAgICAgICAgaWYgKHQud2FybmluZ3MpIHsgd2FybmluZ3MucHVzaC5hcHBseSh3YXJuaW5ncywgdC53YXJuaW5ncyk7IH1cbiAgICAgIH0pO1xuICAgICAgaWYgKHdhcm5pbmdzLmxlbmd0aCkge1xuICAgICAgICAvLyBUT0RPOiBEaXNwbGF5IHdhcm5pbmdzIGZyb20gY3VzdG9tIHRyYWNrIHBhcnNpbmcgdG8gdGhlIHVzZXJcbiAgICAgICAgY29uc29sZS5sb2cod2FybmluZ3MpO1xuICAgICAgfVxuICAgICAgc2VsZi5fZml4VHJhY2tzKHtjb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIElmIGJyb3dzZXIgZGlyZWN0aXZlcyB3ZXJlIGluY2x1ZGVkLCB3ZSBuZWVkIHRvIG9iZXkgdGhlbS5cbiAgICAgICAgc2VsZi5fbmV4dERpcmVjdGl2ZXMgPSB7fTtcbiAgICAgICAgLy8gUmlnaHQgbm93IG9ubHkgcG9zaXRpb24gaXMgc3VwcG9ydGVkLlxuICAgICAgICAvLyBUT0RPOiBvdGhlciBicm93c2VyIGRpcmVjdGl2ZXMgYXQgaHR0cDovL2dlbm9tZS51Y3NjLmVkdS9nb2xkZW5QYXRoL2hlbHAvaGdUcmFja3NIZWxwLmh0bWwjbGluZXNcbiAgICAgICAgaWYgKF8ua2V5cyhicm93c2VyRGlyZWN0aXZlcykubGVuZ3RoKSB7IHNlbGYuX2luaXRGcm9tUGFyYW1zKGJyb3dzZXJEaXJlY3RpdmVzKTsgfVxuICAgICAgfX0pOyBcbiAgICB9LFxuICAgIFxuICAgIC8vIE9wZW5zIGEgZGlhbG9nIHRvIGVkaXQgdGhlIG9wdGlvbnMgZm9yIGEgY3VzdG9tIHRyYWNrLlxuICAgIF9lZGl0Q3VzdG9tVHJhY2s6IGZ1bmN0aW9uKG4pIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGRpYWxvZyA9ICQoby5kaWFsb2dzWzBdKS5jbG9zZXN0KCcudWktZGlhbG9nJyksXG4gICAgICAgIHRyayA9IHNlbGYuYXZhaWxUcmFja3Nbbl07XG4gICAgICAgIFxuICAgICAgc2VsZi5faW5pdEN1c3RvbVRyYWNrRGlhbG9nKCk7XG4gICAgICB0cmsuY3VzdG9tLmxvYWRPcHRzKCRkaWFsb2cpO1xuICAgICAgJGRpYWxvZy5kYXRhKCd0cmFjaycsIHRyayk7XG4gICAgICAkZGlhbG9nLnRyaWdnZXIoJ29wZW4nKTtcbiAgICB9LFxuICAgIFxuICAgIC8vIFJlbW92ZXMgYSBjdXN0b20gdHJhY2tzLlxuICAgIF9yZW1vdmVDdXN0b21UcmFjazogZnVuY3Rpb24odG5hbWUpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgJGxpID0gJChzZWxmLm9wdGlvbnMudHJhY2tQaWNrZXJbM10pLmZpbmQoJ2lucHV0W25hbWU9XCInK3RuYW1lKydcIl0nKS5jbG9zZXN0KCdsaScpLFxuICAgICAgICB1cmwgPSBzZWxmLmF2YWlsVHJhY2tzW3RuYW1lXS5jdXN0b20udXJsO1xuICAgICAgZGVsZXRlIHNlbGYuYXZhaWxUcmFja3NbdG5hbWVdO1xuICAgICAgJGxpLnJlbW92ZSgpO1xuICAgICAgLy8gUmVtb3ZlIHVybCBmcm9tIGxpc3Qgb2YgbG9hZGVkIFVSTHMgaWYgdGhlcmUgYXJlIG5vIG90aGVyIHRyYWNrcyB0aGF0IHdlcmUgbG9hZGVkIGZyb20gaXRcbiAgICAgIGlmICh1cmwgJiYgIV8uZmluZChzZWxmLmF2YWlsVHJhY2tzLCBmdW5jdGlvbih0cmspIHsgcmV0dXJuIHRyay5jdXN0b20gJiYgdHJrLmN1c3RvbS51cmwgPT0gdXJsOyB9KSkge1xuICAgICAgICBzZWxmLl9jdXN0b21UcmFja1VybHMubG9hZGVkID0gXy5kaWZmZXJlbmNlKHNlbGYuX2N1c3RvbVRyYWNrVXJscy5sb2FkZWQsIFt1cmxdKTtcbiAgICAgIH1cbiAgICAgIHNlbGYuX2ZpeFRyYWNrcygpO1xuICAgIH0sXG4gICAgXG4gICAgLy8gUmVtb3ZlcyBhbGwgY3VzdG9tIHRyYWNrcy5cbiAgICBfcmVzZXRDdXN0b21UcmFja3M6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAkbGlzID0gJChzZWxmLm9wdGlvbnMudHJhY2tQaWNrZXJbM10pLmNoaWxkcmVuKCd1bCcpLmNoaWxkcmVuKCk7XG4gICAgICAkbGlzLmZpbmQoJzpjaGVja2JveCcpLmVhY2goZnVuY3Rpb24oKSB7IGRlbGV0ZSBzZWxmLmF2YWlsVHJhY2tzWyQodGhpcykuYXR0cignbmFtZScpXTsgfSk7XG4gICAgICAkbGlzLnJlbW92ZSgpO1xuICAgICAgc2VsZi5fY3VzdG9tVHJhY2tVcmxzLmxvYWRlZCA9IFtdO1xuICAgICAgc2VsZi5fZml4VHJhY2tzKCk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBEZXRlcm1pbmUgZm9yIGEgZ2l2ZW4gdHJhY2sgYW5kIGhlaWdodCB3aGF0IGRlbnNpdHkgaXMgb3B0aW1hbCBmb3IgZGlzcGxheVxuICAgIGRlbnNpdHlPcmRlcjogZnVuY3Rpb24odHJhY2ssIGhlaWdodCwgYnBwcHMsIGZvcmNlKSB7XG4gICAgICBpZiAoXy5pc1VuZGVmaW5lZChoZWlnaHQpIHx8IF8uaXNVbmRlZmluZWQoYnBwcHMpKSB7IHJldHVybiB0aGlzLl9kZW5zaXR5T3JkZXJbdHJhY2tdIHx8IG51bGw7IH1cbiAgICAgIC8vIFRPRE86IHRoaXMgbmVlZHMgdHdlYWtpbmcuLi4gbWF5YmUgb24gdGhlIGRlYm91bmNlZCB2ZXJzaW9uLCBleGNsdWRlIG9mZi1zY3JlZW4gdGlsZXM/XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsIFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgICAgdCA9IHRoaXMuYXZhaWxUcmFja3NbdHJhY2tdLFxuICAgICAgICBiYXNlID0gXy5maW5kKHQucywgZnVuY3Rpb24odikgeyByZXR1cm4gIV8uaXNBcnJheSh2KTsgfSksXG4gICAgICAgIGZpeGVkSGVpZ2h0cyA9IHQuZmhbYnBwcHMudG9wRm9ybWF0dGVkXSB8fCAoXy5rZXlzKHQuZmgpLmxlbmd0aCAmJiB0LmZoW18ubGFzdChfLmtleXModC5maCkpXSkgfHwge30sXG4gICAgICAgIGJhc2VIZWlnaHQgPSBmaXhlZEhlaWdodHNbYmFzZV0gfHwgMTUsXG4gICAgICAgIG9yZGVyRm9yID0gaGVpZ2h0ICsgXCJ8XCIgKyBicHBwcy50b3BGb3JtYXR0ZWQsXG4gICAgICAgIHByZXZPcmRlciA9IHNlbGYuX2RlbnNpdHlPcmRlclt0Lm5dLFxuICAgICAgICBwcmV2T3JkZXJGb3IgPSBzZWxmLl9kZW5zaXR5T3JkZXJGb3JbdC5uXSxcbiAgICAgICAgJHVucmVuZGVyZWRDdXN0b20gPSAkKCcuYnJvd3Nlci10cmFjay0nK3QubisnIGNhbnZhcy50ZGF0YS51bnJlbmRlcmVkJyksXG4gICAgICAgIGZvcmNlQXQgPSB7fSwgLy97cGFjazogWzIwMCwgLTJdLCBmdWxsOiBbMjAwLCAtM119LCAgLy8gVGhpcyBpcyBjYXVzaW5nIHRvbyBtdWNoIHRocmFzaGluZyB3aXRoIGhlYXZ5IGN1c3RvbSB0cmFja3NcbiAgICAgICAgb3JkZXIgPSB7fSwgaGVpZ2h0cyA9IFtdLCBpID0gMCwgb3B0aW11bTtcbiAgICAgIGlmIChwcmV2T3JkZXJGb3IgJiYgcHJldk9yZGVyRm9yID09IG9yZGVyRm9yICYmICFmb3JjZSkgeyByZXR1cm47IH1cbiAgICAgIGlmICgkdW5yZW5kZXJlZEN1c3RvbS5sZW5ndGgpIHtcbiAgICAgICAgLy8gQWxsIGN1c3RvbSB0cmFja3Mgc2hvdWxkIGJlIHJlbmRlcmVkIGJlZm9yZSByZW9yZGVyaW5nIHRoZSBkZW5zaXRpZXMuICBEZWZlciB0aGlzIGNhbGN1bGF0aW9uIHVudGlsIHRoZW4uXG4gICAgICAgIHJldHVybiAkdW5yZW5kZXJlZEN1c3RvbS50cmlnZ2VyKCdyZW5kZXInLCBfLmFmdGVyKCR1bnJlbmRlcmVkQ3VzdG9tLmxlbmd0aCwgZnVuY3Rpb24oKSB7IFxuICAgICAgICAgIHNlbGYuZGVuc2l0eU9yZGVyKHRyYWNrLCBoZWlnaHQsIGJwcHBzKTsgXG4gICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICAgIC8vIEFsd2F5cyBzaG93IHRoZSBiYXNlIGRlbnNpdHkgd2hlbiB3aXRoaW4gM3B4IG9mIHRoZSBiYXNlSGVpZ2h0ICh0aGUgaW5pdGlhbCBoZWlnaHQpXG4gICAgICBpZiAoaGVpZ2h0IDw9IGJhc2VIZWlnaHQgKyAzKSB7XG4gICAgICAgIG9yZGVyW2Jhc2VdID0gMDtcbiAgICAgICAgXy5lYWNoKHQucywgZnVuY3Rpb24oZCkgeyBpZiAoXy5pc0FycmF5KGQpKSB7IG9yZGVyW2RbMF1dID0gKytpOyB9IH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gT3RoZXJ3aXNlLCBvcmRlciB0aGUgZGVuc2l0aWVzIGJ5IHRoZWlyIHRpbGVzJyBtYXggaGVpZ2h0J3MgcHJveGltaXR5IHRvIHRoZSB0cmFjayBoZWlnaHRcbiAgICAgICAgLy8gd2l0aCBhIDN4IGJpYXMgdG93YXJkIHNob3dpbmcgdGhlIHRhbGxlciBkZW5zaXR5XG4gICAgICAgIF8uZWFjaCh0LnMsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICBpZiAoXy5pc0FycmF5KGQpKSB7IGQgPSBkWzBdOyB9XG4gICAgICAgICAgaWYgKGZpeGVkSGVpZ2h0c1tkXSkgeyByZXR1cm4gaGVpZ2h0cy5wdXNoKFtkLCBmaXhlZEhlaWdodHNbZF1dKTsgfVxuICAgICAgICAgIHZhciAkaW1ncyA9ICQoJy5icm93c2VyLXRyYWNrLScrdC5uKyc+LmJwcHAtJytjbGFzc0ZyaWVuZGx5KGJwcHBzLnRvcCkrJz4udGRhdGEuZGVucy0nK2QpO1xuICAgICAgICAgIGlmICgkaW1ncy5maW5kKCcubG9hZGluZycpLmxlbmd0aCA+IDApIHsgb3JkZXJGb3IgPSBudWxsOyB9XG4gICAgICAgICAgdmFyIGggPSBNYXRoLm1heC5hcHBseShNYXRoLCAkaW1ncy5tYXAoZnVuY3Rpb24oKSB7IFxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubmF0dXJhbEhlaWdodCB8fCB0aGlzLmhlaWdodDsgXG4gICAgICAgICAgfSkuZ2V0KCkpO1xuICAgICAgICAgIGhlaWdodHMucHVzaChbZCwgaF0pO1xuICAgICAgICB9KTtcbiAgICAgICAgaGVpZ2h0cyA9IF8ubWFwKGhlaWdodHMsIGZ1bmN0aW9uKHYsIGkpIHtcbiAgICAgICAgICB2YXIgZGVsdGFZO1xuICAgICAgICAgIHZbMl0gPSB2WzFdID09IDA7XG4gICAgICAgICAgdlsxXSA9IHZbMl0gPyAxMDAwMDAwIDogdlsxXTsgICAgICAvLyBlZmZlY3RpdmVseSwgbmV2ZXIgc2hvdyAwIGhlaWdodCB0aWxlc1xuICAgICAgICAgIGRlbHRhWSA9IGhlaWdodCAtIHZbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIHdoZXJlIHRoZSAzeCBiaWFzIHRvd2FyZCB0aGUgdGFsbGVyIGRlbnNpdHkgaXMgaW5zZXJ0ZWRcbiAgICAgICAgICB2WzFdID0gKGZvcmNlQXRbdlswXV0gJiYgaGVpZ2h0ID4gZm9yY2VBdFt2WzBdXVswXSkgPyBmb3JjZUF0W3ZbMF1dWzFdIDogKGRlbHRhWSA+IDAgPyBkZWx0YVkgKiAzIDogLWRlbHRhWSk7XG4gICAgICAgICAgdlsxXSAtPSBpICogMC4xOyAgICAgICAgICAgICAgICAgICAvLyBtYXJnaW5hbGx5IHByaW9yaXRpemUgbW9yZSBkZXRhaWxlZCB0cmFja3MgaW4gdGhlIGV2ZW50IG9mIHRpZXNcbiAgICAgICAgICByZXR1cm4gdjsgXG4gICAgICAgIH0pO1xuICAgICAgICBoZWlnaHRzLnNvcnQoZnVuY3Rpb24oYSwgYil7IHJldHVybiBhWzFdIC0gYlsxXTsgfSk7XG4gICAgICAgIF8uZWFjaChoZWlnaHRzLCBmdW5jdGlvbih2KSB7IG9yZGVyW3ZbMF1dID0gKytpOyB9KTtcbiAgICAgICAgLy8gVW5sZXNzIGFsbCBvZiB0aGUgb3RoZXIgZGVuc2l0aWVzIHdlcmUgMCBoZWlnaHQgdGlsZXMsIG1ha2UgdGhlIGJhc2UgZGVuc2l0eSBsYXN0IHByaW9yaXR5LlxuICAgICAgICBpZiAoaGVpZ2h0cy5sZW5ndGggLSBfLmNvbXBhY3QoXy5wbHVjayhoZWlnaHRzLCAnMicpKS5sZW5ndGggPiAxKSB7IG9yZGVyW2Jhc2VdID0gKytpOyB9XG4gICAgICB9XG4gICAgICBzZWxmLl9kZW5zaXR5T3JkZXJbdC5uXSA9IG9yZGVyO1xuICAgICAgc2VsZi5fZGVuc2l0eU9yZGVyRm9yW3Qubl0gPSBvcmRlckZvcjtcbiAgICAgIGlmIChwcmV2T3JkZXIgJiYgIV8uaXNFcXVhbChvcmRlciwgcHJldk9yZGVyKSkgeyBcbiAgICAgICAgJGVsZW0uZmluZCgnLmJyb3dzZXItdHJhY2stJyt0Lm4pLmdlbm90cmFjaygndXBkYXRlRGVuc2l0eScpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gPSBUaGVzZSBhcmUgbmF2aWdhdGlvbmFsIGZ1bmN0aW9uczsgdGhleSBoYW5kbGUgbW92ZW1lbnQsIHpvb21pbmcsIHBvc2l0aW9uIGNhbGN1bGF0aW9ucywgZXRjLiA9XG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAvLyBSZXR1cm5zIHRoZSBleHBlY3RlZCB3aWR0aCwgaW4gYmFzZSBwYWlycywgb2YgZWFjaCBsaW5lXG4gICAgYnBXaWR0aDogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLmxpbmVXaWR0aCgpICogdGhpcy5icHBwOyB9LFxuICAgIFxuICAgIC8vIFJldHVybnMgdGhlIGNocm9tb3NvbWUgdGhhdCBjb250YWlucyB0aGUgZ2l2ZW4gYWJzb2x1dGUgYnAgcG9zaXRpb25cbiAgICBjaHJBdDogZnVuY3Rpb24ocG9zKSB7XG4gICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgY2hySW5kZXggPSBfLnNvcnRlZEluZGV4KG8uY2hyTGFiZWxzLCB7cDogcG9zfSwgZnVuY3Rpb24odikgeyByZXR1cm4gdi5wOyB9KTtcbiAgICAgIHJldHVybiBjaHJJbmRleCA+IDAgPyBvLmNockxhYmVsc1tjaHJJbmRleCAtIDFdIDogbnVsbDtcbiAgICB9LFxuICAgIFxuICAgIC8vIFR1cm5zIGEgc3RyaW5nIGxpa2UgXCJjaHJYOjEyNTEyXCIgaW50byBhbiBicCBwb3NpdGlvbiBmcm9tIHRoZSBzdGFydCBvZiB0aGUgZ2Vub21lXG4gICAgbm9ybWFsaXplUG9zOiBmdW5jdGlvbihwb3MsIGZvcmNlZnVsKSB7XG4gICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucywgXG4gICAgICAgIHJldCA9IHt9LCBcbiAgICAgICAgbWF0Y2hlcywgZW5kO1xuICAgICAgICBcbiAgICAgIHJldC5wb3MgPSAkLnRyaW0oXy5pc1VuZGVmaW5lZChwb3MpID8gJChvLmp1bXBbMF0pLnZhbCgpIDogcG9zKTtcbiAgICAgIGlmIChyZXQucG9zID09PSAnJykgeyB0aGlzLl9zZWFyY2hGb3IoJycpOyByZXR1cm4gbnVsbDsgfVxuICAgICAgXG4gICAgICBtYXRjaGVzID0gcmV0LnBvcy5tYXRjaCgvXihbYS16XStbXjpdKikoOihcXGQrKSgoWy1AXSkoXFxkKyhcXC5cXGQrKT8pKT8pPy9pKTtcbiAgICAgIC8vIERvZXMgdGhlIHBvc2l0aW9uIHN0cmluZyBoYXZlIGEgY29sb24gaW4gaXQ/IElmIHNvLCB3ZSB0cnkgdG8gcGFyc2UgaXQgYXMgYSBicCBwb3NpdGlvblxuICAgICAgaWYgKG1hdGNoZXMgJiYgbWF0Y2hlc1sxXSkge1xuICAgICAgICB2YXIgY2hyID0gXy5maW5kKG8uY2hyTGFiZWxzLCBmdW5jdGlvbih2KSB7IHJldHVybiB2Lm4gPT09IG1hdGNoZXNbMV07IH0pO1xuICAgICAgICAvLyBJZiB0aGlzIGRpZG4ndCBtYXRjaCBhIHJlYWwgY2hyb21vc29tZSBuYW1lLCB1c2UgdGhlIGZpcnN0LCBieSBkZWZhdWx0LlxuICAgICAgICBpZiAoIWNocikgeyBjaHIgPSBfLmZpcnN0KG8uY2hyTGFiZWxzKTsgfVxuICAgICAgICB0aGlzLl9zZWFyY2hGb3IoJycsIGZvcmNlZnVsKTtcbiAgICAgICAgcmV0LnBvcyA9IGNoci5wICsgcGFyc2VJbnQobWF0Y2hlc1szXSB8fCAnMScsIDEwKTtcbiAgICAgICAgaWYgKG1hdGNoZXNbNV0gPT0gJy0nKSB7XG4gICAgICAgICAgLy8gQWxsb3cgcmFuZ2VzLCBlLmcuIGNoclg6MTI1MTItMTI2MzBcbiAgICAgICAgICBlbmQgPSBjaHIucCArIHBhcnNlSW50KG1hdGNoZXNbNl0sIDEwKTtcbiAgICAgICAgICBpZiAoZW5kID4gcmV0LnBvcykge1xuICAgICAgICAgICAgcmV0LmJwcHAgPSAoZW5kIC0gcmV0LnBvcykgLyAodGhpcy5saW5lV2lkdGgoKSAtIG8uc2lkZUJhcldpZHRoKTtcbiAgICAgICAgICAgIC8vIEZpbmQgdGhlIG5lYXJlc3Qgb3B0aW1hbCB6b29tIGxldmVsIG9uIHRoZSBzbGlkZXIgdGhhdCBmdWxseSBlbmNvbXBhc3NlcyB0aGUgcmFuZ2UuXG4gICAgICAgICAgICByZXQuYnBwcCA9IF8uZmluZCh0aGlzLnNsaWRlckJwcHBzLnJldmVyc2UoKSwgZnVuY3Rpb24odikgeyByZXR1cm4gdiA+PSByZXQuYnBwcDsgfSkgfHwgXy5sYXN0KHRoaXMuc2xpZGVyQnBwcHMpO1xuICAgICAgICAgICAgdGhpcy5zbGlkZXJCcHBwcy5yZXZlcnNlKCk7IC8vIC5yZXZlcnNlKCkgaXMgZGVzdHJ1Y3RpdmUgaW4gSlMgLV8tXG4gICAgICAgICAgICByZXQucG9zICs9IGZsb29ySGFjaygoZW5kIC0gcmV0LnBvcykgLyAyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAobWF0Y2hlc1s1XSA9PSAnQCcpIHtcbiAgICAgICAgICAvLyBvciBzcGVjaWZ5aW5nIGJwcHAgZGlyZWN0bHksIGUuZy4gY2hyWDoxMjUxMkAxMDBcbiAgICAgICAgICByZXQuYnBwcCA9IHBhcnNlRmxvYXQobWF0Y2hlc1s2XSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7IFxuICAgICAgICBwb3MgPSBwYXJzZUludChyZXQucG9zLCAxMCk7XG4gICAgICAgIGlmIChfLmlzTmFOKHBvcykpIHtcbiAgICAgICAgICB0aGlzLl9zZWFyY2hGb3IocmV0LnBvcywgZm9yY2VmdWwpO1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldC5wb3MgPSBwb3M7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiByZXQ7XG4gICAgfSxcbiAgICBcbiAgICAvLyBEaXNwbGF5cyB0aGUgc2VhcmNoIGRyb3Bkb3duIHdoZXJlIHRoZSB1c2VyIGNhbiBzZWxlY3QgZnJvbSBmZWF0dXJlcyB0aGF0IG1hdGNoIHRoZSBxdWVyeVxuICAgIF9zZWFyY2hGb3I6IGZ1bmN0aW9uKHNlYXJjaCwgZm9yY2VmdWwpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQ7XG4gICAgICBmdW5jdGlvbiBoaWxpdGUodGV4dCwgc2VhcmNoRm9yKSB7XG4gICAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UobmV3IFJlZ0V4cChyZWdFeHBRdW90ZShzZWFyY2hGb3IpLCBcImdpXCIpLCAnPHNwYW4gY2xhc3M9XCJoaWxpdGVcIj4nK3NlYXJjaEZvcisnPC9zcGFuPicpO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gY3JlYXRlQ2hvaWNlKGMsIGNhdCkge1xuICAgICAgICB2YXIgJGMgPSAkKCc8ZGl2IGNsYXNzPVwiY2hvaWNlXCIvPicpO1xuICAgICAgICAkKCc8aDMgY2xhc3M9XCJuYW1lXCIvPicpLmh0bWwoaGlsaXRlKGMubmFtZSwgc2VhcmNoKSkuYXBwZW5kVG8oJGMpO1xuICAgICAgICAkKCc8cCBjbGFzcz1cImxvbmctZGVzY1wiLz4nKS5odG1sKGhpbGl0ZShjLmRlc2MsIHNlYXJjaCkpLmFwcGVuZFRvKCRjKTtcbiAgICAgICAgJGMuYmluZCgnZmFrZWZvY3VzJywgZnVuY3Rpb24oKSB7ICQodGhpcykuYWRkQ2xhc3MoJ2ZvY3VzJyk7ICQodGhpcykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnZm9jdXMnKTsgfSk7XG4gICAgICAgICRjLmJpbmQoJ2Zha2VibHVyJywgZnVuY3Rpb24oKSB7ICQodGhpcykucmVtb3ZlQ2xhc3MoJ2ZvY3VzJyk7IH0pO1xuICAgICAgICAkYy5tb3VzZW92ZXIoZnVuY3Rpb24oKSB7ICQodGhpcykudHJpZ2dlcignZmFrZWZvY3VzJyk7IH0pO1xuICAgICAgICAkYy5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgbSwgcGlja2VkID0gKG0gPSBjLmRlc2MubWF0Y2goL15cXCgoLispXFwpLykpID8gbVsxXS50b0xvd2VyQ2FzZSgpIDogYy5uYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgJCgnYm9keScpLnVuYmluZCgnbW91c2Vkb3duLnNlYXJjaCcpO1xuICAgICAgICAgIHNlbGYuJHRyYWNrUGlja2VyLmZpbmQoJ2lucHV0W25hbWU9JytjYXQudHJhY2srJ10nKS5hdHRyKCdjaGVja2VkJywgdHJ1ZSk7XG4gICAgICAgICAgc2VsZi50aWxlRml4aW5nRW5hYmxlZChmYWxzZSk7XG4gICAgICAgICAgc2VsZi5fZml4VHJhY2tzKHtkdXJhdGlvbjogMCwgY29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gVGhpcyBjYWxsYmFjayBtYXhpbWl6ZXMgdGhlIHRyYWNrIHRoYXQgY29udGFpbmVkIHRoZSBmZWF0dXJlIGNsaWNrZWQsIGFuZCBmbGFzaGVzIHRoZSBmZWF0dXJlLlxuICAgICAgICAgICAgLy8gRmxhc2hpbmcgdGhlIGNsaWNrZWQgZmVhdHVyZSBpcyB0cmlja3kgYmVjYXVzZSBldmVyeXRoaW5nIGlzIGxvYWRpbmcgYXQgZGlmZmVyZW50IHRpbWVzLlxuICAgICAgICAgICAgdmFyICRtYXhpbWl6ZVRyYWNrID0gc2VsZi4kbGluZXMuZXEoc2VsZi5jZW50cmFsTGluZSkuZmluZCgnLmJyb3dzZXItdHJhY2stJytjYXQudHJhY2spLmVxKDApO1xuICAgICAgICAgICAgJG1heGltaXplVHJhY2sub25lKCd0cmFja2xvYWQnLCBmdW5jdGlvbihlLCBicHBwcykge1xuICAgICAgICAgICAgICB2YXIgJGltZ3MgPSBzZWxmLiRsaW5lcy5maW5kKCcuYnBwcC0nK2NsYXNzRnJpZW5kbHkoYnBwcHMudG9wKSsnIC50ZGF0YS5kZW5zLXBhY2snKTtcbiAgICAgICAgICAgICAgbWF4SGVpZ2h0ID0gNSArIE1hdGgubWF4LmFwcGx5KE1hdGgsICRpbWdzLm1hcChmdW5jdGlvbigpIHsgXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmF0dXJhbEhlaWdodCB8fCB0aGlzLmhlaWdodDtcbiAgICAgICAgICAgICAgfSkuZ2V0KCkpO1xuICAgICAgICAgICAgICAvLyBBZnRlciB0aGUgdHJhY2sgaXMgcmVzaXplZCwgZmxhc2ggYWxsIHRoZSBmZWF0dXJlcyB0aGF0IHdlcmUgYWRkZWQgdG8gb3VyIHRvZG8tbGlzdFxuICAgICAgICAgICAgICBzZWxmLl9yZXNpemVUcmFjayhjYXQudHJhY2ssIG1heEhlaWdodCwgc2VsZi5jZW50cmFsTGluZSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyICRzdGlsbExvYWRpbmcgPSBzZWxmLiRsaW5lcy5maW5kKCcuYnJvd3Nlci10cmFjay0nK2NhdC50cmFjaykuaGFzKCcuYXJlYXMtbG9hZGluZycpO1xuICAgICAgICAgICAgICAgICRlbGVtLmZpbmQoJy5icm93c2VyLXRyYWNrJykuZ2Vub3RyYWNrKCd1cGRhdGVEZW5zaXR5Jyk7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZmxhc2goKSB7IHNlbGYuYXJlYUhvdmVyKFtjYXQudHJhY2ssIGJwcHBzLnRvcCwgXCJwYWNrXCIsIFwibmFtZVwiLCBwaWNrZWRdLCBcIkZMQVNITUVcIik7IH07XG4gICAgICAgICAgICAgICAgLy8gRklYTUU6IHRoaXMgaXMgcHJldHR5IHJpY2tldHlcbiAgICAgICAgICAgICAgICBpZiAoISRzdGlsbExvYWRpbmcubGVuZ3RoKSB7IGZsYXNoKCk7IH1cbiAgICAgICAgICAgICAgICBlbHNlIHsgJHN0aWxsTG9hZGluZy5vbmUoJ2FyZWFsb2FkJywgXy5hZnRlcigkc3RpbGxMb2FkaW5nLmxlbmd0aCwgZmxhc2gpKTsgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXy5kZWZlcihmdW5jdGlvbigpeyBzZWxmLnRpbGVGaXhpbmdFbmFibGVkKHRydWUpOyAkZWxlbS5maW5kKCcuYnJvd3Nlci10cmFjay0nK2NhdC50cmFjaykuZ2Vub3RyYWNrKCdmaXhDbGlja0FyZWFzJyk7IH0pO1xuICAgICAgICAgIH19KTtcbiAgICAgICAgICBzZWxmLmp1bXBUbyhjLnBvcyk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlOyBcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAkYztcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGhpZGVDaG9pY2VzKCkgeyBzZWxmLiRjaG9pY2VzLmZpbmQoJy5jaG9pY2UnKS50cmlnZ2VyKCdmYWtlYmx1cicpOyBzZWxmLiRjaG9pY2VzLmhpZGUoKTsgfVxuICAgICAgXG4gICAgICBpZiAoc2VhcmNoPT09JycpIHsgcmV0dXJuIGhpZGVDaG9pY2VzKCk7IH1cbiAgICAgIGlmIChzZWFyY2g9PT1zZWxmLnByZXZTZWFyY2ggJiYgIWZvcmNlZnVsKSB7IHJldHVybjsgfVxuICAgICAgc2VsZi4kY2hvaWNlcy5lbXB0eSgpLmFkZENsYXNzKCdsb2FkaW5nJykucmVtb3ZlQ2xhc3MoJ25vLXJlc3VsdHMnKS5zbGlkZURvd24oKTtcbiAgICAgICQoJ2JvZHknKS5iaW5kKCdtb3VzZWRvd24uc2VhcmNoJywgZnVuY3Rpb24oZSkgeyBcbiAgICAgICAgaWYgKCEkKGUudGFyZ2V0KS5jbG9zZXN0KHNlbGYuJGNob2ljZXMpLmxlbmd0aCkgeyBoaWRlQ2hvaWNlcygpOyB9XG4gICAgICAgICQoJ2JvZHknKS51bmJpbmQoJ21vdXNlZG93bi5zZWFyY2gnKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKHNlbGYuY3VycmVudFNlYXJjaCkgeyBzZWxmLmN1cnJlbnRTZWFyY2guYWJvcnQoKTsgfVxuICAgICAgXG4gICAgICBzZWxmLnByZXZTZWFyY2ggPSBzZWFyY2g7XG4gICAgICBzZWxmLmN1cnJlbnRTZWFyY2ggPSAkLmFqYXgoby5hamF4RGlyKydzZWFyY2gucGhwJywge1xuICAgICAgICBkYXRhOiB7cG9zaXRpb246IHNlYXJjaCwgZGI6IG8uZ2Vub21lfSxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIHNlbGYuJGNob2ljZXMucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcbiAgICAgICAgICBpZiAoZGF0YVsnZ290byddKSB7IHNlbGYuanVtcFRvKGRhdGFbJ2dvdG8nXSk7IHJldHVybjsgfVxuICAgICAgICAgIGlmICghZGF0YS5jYXRlZ29yaWVzIHx8IGRhdGEuY2F0ZWdvcmllcy5sZW5ndGg9PT0wKSB7IHNlbGYuJGNob2ljZXMuYWRkQ2xhc3MoJ25vLXJlc3VsdHMnKTsgcmV0dXJuOyB9XG4gICAgICAgICAgdmFyIG51bUNhdGVnb3JpZXMgPSBfLmtleXMoZGF0YS5jYXRlZ29yaWVzKS5sZW5ndGgsXG4gICAgICAgICAgICBjaG9pY2VzUGVyQ2F0ZWdvcnkgPSBNYXRoLm1heChNYXRoLmNlaWwoMTIgLyBudW1DYXRlZ29yaWVzKSwgMyk7XG4gICAgICAgICAgXy5lYWNoKGRhdGEuY2F0ZWdvcmllcywgZnVuY3Rpb24oY2F0LCBjYXRuYW1lKSB7XG4gICAgICAgICAgICAkKCc8ZGl2IGNsYXNzPVwiY2hvaWNlLWNhdGVnb3J5XCIvPicpLnRleHQoY2F0bmFtZSkuYXBwZW5kVG8oc2VsZi4kY2hvaWNlcyk7XG4gICAgICAgICAgICBfLmVhY2goY2F0LmNob2ljZXMuc2xpY2UoMCwgY2hvaWNlc1BlckNhdGVnb3J5KSwgZnVuY3Rpb24oYykge1xuICAgICAgICAgICAgICB2YXIgJGMgPSBjcmVhdGVDaG9pY2UoYywgY2F0KS5hcHBlbmRUbyhzZWxmLiRjaG9pY2VzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHNlbGYuJGNob2ljZXMuZmluZCgnLmNob2ljZScpLmVxKDApLnRyaWdnZXIoJ2Zha2Vmb2N1cycpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgICAgICBcbiAgICAvLyBwdWJsaWMgKGluZGlyZWN0KSBzZXR0ZXIgZm9yIHRoaXMucG9zOyBjZW50ZXJzIHRoZSByZXRpY2xlIG9uIHJldGljUG9zXG4gICAganVtcFRvOiBmdW5jdGlvbihyZXRpY1Bvcykge1xuICAgICAgdmFyIGRlc3QgPSB0aGlzLm5vcm1hbGl6ZVBvcyhyZXRpY1BvcywgdHJ1ZSk7XG4gICAgICBpZiAoZGVzdCAhPT0gbnVsbCkge1xuICAgICAgICB0aGlzLiRjaG9pY2VzLmhpZGUoKS5lbXB0eSgpO1xuICAgICAgICBpZiAoZGVzdC5icHBwKSB7XG4gICAgICAgICAgdGhpcy5wb3MgPSBkZXN0LnBvcyAtIHRoaXMuX3JldGljRGVsdGEoKTtcbiAgICAgICAgICB0aGlzLnpvb20oZGVzdC5icHBwKTsgXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5fcG9zKGRlc3QucG9zIC0gdGhpcy5fcmV0aWNEZWx0YSgpKTtcbiAgICAgICAgfVxuICAgICAgICAkKHRoaXMub3B0aW9ucy5qdW1wWzBdKS5ibHVyKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcbiAgICAvLyBwcml2YXRlIHNldHRlciBmb3IgdGhpcy5wb3MgdGhhdCB1cGRhdGVzIHRoZSBVSSBhY2NvcmRpbmdseS5cbiAgICAvLyBmb3JjZVJlcG9zIHVzdWFsbHkgbWVhbnMgYSB6b29tIGhhcHBlbmVkLCB3aGljaCByZXF1aXJlcyB0aGF0IHRoZSB0aWxlcyBhcmUgcmVwb3NpdGlvbmVkIHdpdGhpbiB0aGUgdHJhY2tzLlxuICAgIF9wb3M6IGZ1bmN0aW9uKHBvcywgZXhjZXB0Rm9yLCBmb3JjZVJlcG9zKSB7XG4gICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgYnBXaWR0aCA9IHRoaXMuYnBXaWR0aCgpLFxuICAgICAgICByZCA9IHRoaXMuX3JldGljRGVsdGEoKTtcbiAgICAgIGV4Y2VwdEZvciA9ICQoZXhjZXB0Rm9yKS5nZXQoMCk7XG4gICAgICBwb3MgPSBfLmlzVW5kZWZpbmVkKHBvcykgPyB0aGlzLnBvcyA6IHBvcztcbiAgICAgIHRoaXMucG9zID0gcG9zO1xuICAgICAgdGhpcy4kbGluZXMuZWFjaChmdW5jdGlvbihpKSB7XG4gICAgICAgIGlmICh0aGlzID09IGV4Y2VwdEZvcikgeyByZXR1cm47IH1cbiAgICAgICAgJCh0aGlzKS5nZW5vbGluZSgnanVtcFRvJywgcG9zICsgaSAqIGJwV2lkdGgsIGZvcmNlUmVwb3MpOyBcbiAgICAgIH0pO1xuICAgICAgaWYgKGZvcmNlUmVwb3MpIHsgdGhpcy5fZml4Wm9vbWVkVHJhY2tEZWJvdW5jZWQoKTsgfVxuICAgICAgdGhpcy5fZml4Q2xpY2tBcmVhc0RlYm91bmNlZCgpO1xuICAgICAgdGhpcy5fc2F2ZVBhcmFtc0RlYm91bmNlZCgpO1xuICAgIH0sXG4gICAgXG4gICAgLy8gUmV0dXJucyB0aGUgcG9zaXRpb24gKGluIGJhc2VwYWlycykgY2xvc2VzdCB0byB0aGUgbW91c2UgY3Vyc29yXG4gICAgX3Bvc0F0TW91c2U6IGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciAkbGluZSA9ICQoZS5zcmNFbGVtZW50IHx8IGUub3JpZ2luYWxUYXJnZXQpLmNsb3Nlc3QoJy5icm93c2VyLWxpbmUnKTtcbiAgICAgIGlmICghJGxpbmUubGVuZ3RoKSB7IHJldHVybiBudWxsOyB9XG4gICAgICByZXR1cm4gKGUucGFnZVggLSB0aGlzLm9wdGlvbnMuc2lkZUJhcldpZHRoKSAqIHRoaXMuYnBwcCArICRsaW5lLmdlbm9saW5lKCdnZXRQb3MnKTtcbiAgICB9LFxuICAgIFxuICAgIC8vIHB1YmxpYyBnZXR0ZXIvc2V0dGVyIGZvciB0aGlzLmJwcHAgdGhhdCB1cGRhdGVzIHRoZSBVSS4gIElmIGR1cmF0aW9uIGlzIHNwZWNpZmllZCwgYW5pbWF0ZXMgdGhlIGNoYW5nZSBpbiB6b29tLlxuICAgIHpvb206IGZ1bmN0aW9uKHpvb20sIGNlbnRlcmVkT24sIGR1cmF0aW9uKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnM7XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIHNsaWRlclZhbHVlKHpvb20pIHtcbiAgICAgICAgdmFyIHJldCA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5zbGlkZXJCcHBwcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHZhciBicHBwID0gc2VsZi5zbGlkZXJCcHBwc1tpXTtcbiAgICAgICAgICBpZiAoem9vbSA+IGJwcHApIHtcbiAgICAgICAgICAgIHZhciBmcmFjID0gem9vbSAtIGJwcHA7XG4gICAgICAgICAgICByZXR1cm4gcmV0ICsgKDEuMCAtIGZyYWMgLyAoc2VsZi5zbGlkZXJCcHBwc1tyZXRdIC0gc2VsZi5zbGlkZXJCcHBwc1tpXSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXQgPSBpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh6b29tKSkge1xuICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoY2VudGVyZWRPbikgJiYgY2VudGVyZWRPbiAhPT0gbnVsbCkgeyB0aGlzLmNlbnRlcmVkT24gPSBjZW50ZXJlZE9uOyB9XG4gICAgICAgIGVsc2UgeyBkZWxldGUgdGhpcy5jZW50ZXJlZE9uOyB9XG4gICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChkdXJhdGlvbikpIHtcbiAgICAgICAgICB0aGlzLl9hbmltYXRlWm9vbShfLmlzQm9vbGVhbih6b29tKSA/IHpvb20gOiBzbGlkZXJWYWx1ZSh6b29tKSwgZHVyYXRpb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuJHNsaWRlci5zbGlkZXIoJ3ZhbHVlJywgc2xpZGVyVmFsdWUoem9vbSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5icHBwOyBcbiAgICB9LFxuICAgIFxuICAgIC8vIHByaXZhdGUgc2V0dGVyIGZvciB0aGlzLmJwcHA7IGRvZXMgbm90IHVwZGF0ZSB0aGUgc2xpZGVyLS11c2VkIGludGVybmFsbHkgYnkgaXQuXG4gICAgX3pvb206IGZ1bmN0aW9uKHpvb20sIGNlbnRlcmVkT24pIHtcbiAgICAgIGNlbnRlcmVkT24gPSBjZW50ZXJlZE9uIHx8IHRoaXMuY2VudGVyZWRPbiB8fCAodGhpcy5wb3MgKyB0aGlzLl9yZXRpY0RlbHRhKCkpO1xuICAgICAgdmFyIHBvcyA9IGNlbnRlcmVkT24gLSAoY2VudGVyZWRPbiAtIHRoaXMucG9zKSAvICh0aGlzLmJwcHAgLyB6b29tKTtcbiAgICAgIHRoaXMuYnBwcCA9IHpvb207XG4gICAgICB2YXIgbm93ID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7XG4gICAgICB0aGlzLl9wb3MocG9zLCBudWxsLCB0cnVlKTtcbiAgICAgIGZwcyhcIlpPT01cIiwgKG5ldyBEYXRlKS5nZXRUaW1lKCkgLSBub3csIHRoaXMuYnBwcCk7XG4gICAgICB0aGlzLl91cGRhdGVSZXRpY2xlKGNlbnRlcmVkT24pO1xuICAgIH0sXG4gICAgXG4gICAgLy8gSWYgXCJ0b1wiIGlzIGJvb2xlYW4sIHRydWUgd2lsbCByYWlzZSB0aGUgc2xpZGVyIG9uZSBzdGVwIGFuZCBmYWxzZSB3aWxsIGxvd2VyIGl0IG9uZSBzdGVwLlxuICAgIF9hbmltYXRlWm9vbTogZnVuY3Rpb24odG8sIGR1cmF0aW9uKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgICRzbGlkZXIgPSAkKHNlbGYub3B0aW9ucy56b29tU2xpZGVyKSxcbiAgICAgICAgZnJvbSA9ICRzbGlkZXIuc2xpZGVyKCd2YWx1ZScpO1xuICAgICAgaWYgKF8uaXNCb29sZWFuKHRvKSkgeyB0byA9IE1hdGhbdG8gPyAnY2VpbCcgOiAnZmxvb3InXShmcm9tICsgKHRvID8gMC4wMDEgOiAtMC4wMDEpKTsgfVxuICAgICAgJHNsaWRlci5jc3MoJ3RleHQtaW5kZW50JywgMCkuYW5pbWF0ZSh7dGV4dEluZGVudDogMX0sIHtcbiAgICAgICAgcXVldWU6IGZhbHNlLFxuICAgICAgICBzdGVwOiBmdW5jdGlvbihpKSB7ICRzbGlkZXIuc2xpZGVyKCd2YWx1ZScsICh0byAtIGZyb20pICogaSArIGZyb20pOyB9LFxuICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7IHNlbGYuYm91bmNlQ2hlY2soKTsgfSxcbiAgICAgICAgZHVyYXRpb246IGR1cmF0aW9uIHx8IDE1MFxuICAgICAgfSk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBCb3VuY2Ugb2ZmIGVkZ2VzIGlmIHdlIGFyZSB0b3dhcmQgdGhlIG1hcmdpbnMgb2YgdGhlIGdlbm9tZVxuICAgIGJvdW5jZUNoZWNrOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsXG4gICAgICAgIGJwV2lkdGggPSB0aGlzLmJwV2lkdGgoKSxcbiAgICAgICAgcG9zID0gc2VsZi5wb3MsXG4gICAgICAgIG51bUxpbmVzID0gc2VsZi5saW5lcygpLmxlbmd0aCxcbiAgICAgICAgbWFyZ2lucyA9IFsoLW51bUxpbmVzICsgby5ib3VuY2VNYXJnaW4pICogYnBXaWR0aCwgby5nZW5vbWVTaXplIC0gby5ib3VuY2VNYXJnaW4gKiBicFdpZHRoXSxcbiAgICAgICAgb3V0c2lkZUdlbm9tZVJhbmdlID0gcG9zIDwgbWFyZ2luc1swXSB8fCBwb3MgPiBtYXJnaW5zWzFdO1xuICAgICAgXG4gICAgICBpZiAob3V0c2lkZUdlbm9tZVJhbmdlICYmICFzZWxmLl9ib3VuY2luZykge1xuICAgICAgICAkZWxlbS5maW5kKCcuZHJhZy1jb250Jykuc3RvcCh0cnVlKTsgLy8gU3RvcCBhbnkgY3VycmVudCBpbmVydGlhbCBzY3JvbGxpbmdcbiAgICAgICAgc2VsZi5ib3VuY2VUbyhfLm1pbihtYXJnaW5zLCBmdW5jdGlvbihtYXJnKSB7IHJldHVybiBNYXRoLmFicyhtYXJnIC0gcG9zKTsgfSkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLy8gQW5pbWF0ZXMgYSBcImJvdW5jZVwiIGZyb20gdGhlIGN1cnJlbnQgYnJvd3NlciBwb3NpdGlvbiB0byB0YXJnZXRQb3NcbiAgICBib3VuY2VUbzogZnVuY3Rpb24odGFyZ2V0UG9zLCBjYWxsYmFjaykge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgICAgem9vbSA9IHNlbGYuem9vbSgpLFxuICAgICAgICBwb3MgPSBzZWxmLnBvcyxcbiAgICAgICAgbmF0dXJhbEZyZXEgPSAwLjAzLFxuICAgICAgICB2SW5pdCA9ICRlbGVtLmRhdGEoJ3ZlbG9jaXR5JykgfHwgMCxcbiAgICAgICAgZGVsdGFYSW5pdCA9ICh0YXJnZXRQb3MgLSBwb3MpIC8gem9vbTtcbiAgICAgICAgYm91bmNlU3RhcnQgPSAobmV3IERhdGUpLmdldFRpbWUoKTtcbiAgICAgICAgXG4gICAgICAkZWxlbS5jc3MoJ3RleHQtaW5kZW50JywgMSk7XG4gICAgICBzZWxmLl9ib3VuY2luZyA9IHRydWU7XG4gICAgICAkZWxlbS5hbmltYXRlKHt0ZXh0SW5kZW50OiAwfSwge1xuICAgICAgICBxdWV1ZTogZmFsc2UsXG4gICAgICAgIGR1cmF0aW9uOiA1MDAsIC8vIFRPRE86IHNvbWUgYmV0dGVyIHdheSBvZiBhcHByb3hpbWF0aW5nIHRoaXMgYmFzZWQgb24gZGFtcGVuZWQgc3ByaW5nIG1vdGlvbi5cbiAgICAgICAgc3RlcDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIG5ld1RpbWUgPSAobmV3IERhdGUpLmdldFRpbWUoKSxcbiAgICAgICAgICAgIGRlbHRhVCA9IG5ld1RpbWUgLSBib3VuY2VTdGFydCxcbiAgICAgICAgICAgIC8vIHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0RhbXBpbmcjQ3JpdGljYWxfZGFtcGluZ18uMjguQ0UuQjZfLjNEXzEuMjlcbiAgICAgICAgICAgIG5ld0RlbHRhWCA9IChkZWx0YVhJbml0ICsgKHZJbml0ICsgbmF0dXJhbEZyZXEgKiBkZWx0YVhJbml0KSAqIGRlbHRhVCkgKiBNYXRoLmV4cCgtbmF0dXJhbEZyZXEgKiBkZWx0YVQpO1xuICAgICAgICAgIHNlbGYuX3Bvcyhwb3MgKyAoZGVsdGFYSW5pdCAtIG5ld0RlbHRhWCkgKiB6b29tKTtcbiAgICAgICAgfSxcbiAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkgeyBzZWxmLl9ib3VuY2luZyA9IGZhbHNlOyBfLmlzRnVuY3Rpb24oY2FsbGJhY2spICYmIGNhbGxiYWNrKCk7IH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gPSBUaGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBoYW5kbGUgb3IgYXNzaXN0IGV2ZW50cyBzZW50IGZyb20gc3ViLXdpZGdldHMsIGxpa2UgdGhlIGxpbmVzIG9yIHRyYWNrcyA9XG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgXG4gICAgLy8gUmV0dXJucyB0aGUgZGlzdGFuY2UgbGVmdCBvciByaWdodCwgaW4gcGl4ZWxzLCB0aGF0IHRoZSBsaW5lcyBoYXZlIGJlZW4gc2hpZnRlZCBieSB0aGUgbGFzdCBrZXlwcmVzc1xuICAgIGtleWVkT2Zmc2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuX2tleWVkT2Zmc2V0OyB9LFxuICAgIFxuICAgIC8vIEZpeGluZyB0aWxlcyBjYW4gYmUgdGVtcG9yYXJpbHkgZGlzYWJsZWQgYW5kIHJlLWVuYWJsZWQgd2l0aCB0aGlzIGZ1bmN0aW9uXG4gICAgdGlsZUZpeGluZ0VuYWJsZWQ6IGZ1bmN0aW9uKHNldCkge1xuICAgICAgdGhpcy5fdGlsZUZpeGluZ0VuYWJsZWQgPSAoIV8uaXNVbmRlZmluZWQoc2V0KSA/ICEhc2V0IDogdGhpcy5fdGlsZUZpeGluZ0VuYWJsZWQpO1xuICAgICAgaWYgKHNldCkgeyB0aGlzLiRsaW5lcy5nZW5vbGluZSgnZml4VHJhY2tUaWxlcycsIHRydWUpOyB9XG4gICAgICByZXR1cm4gdGhpcy5fdGlsZUZpeGluZ0VuYWJsZWQ7IFxuICAgIH0sXG4gICAgXG4gICAgLy8gSGFuZGxlIGEgZHJhZyBldmVudCBvbiBvbmUgb2YgdGhlIGxpbmVzLCBwcm9wYWdhdGluZyBpdHMgbW90aW9uIHRvIHRoZSBvdGhlciBsaW5lc1xuICAgIHJlY3ZEcmFnOiBmdW5jdGlvbigkc3JjLCBsaW5lUG9zKSB7XG4gICAgICB2YXIgbGluZUluZGV4ID0gdGhpcy4kbGluZXMuaW5kZXgoJHNyYyksXG4gICAgICAgIHBvcyA9IGxpbmVQb3MgLSBsaW5lSW5kZXggKiB0aGlzLmJwV2lkdGgoKTtcbiAgICAgIHZhciBub3cgPSAobmV3IERhdGUpLmdldFRpbWUoKTtcbiAgICAgIHRoaXMuX3Bvcyhwb3MsICRzcmMpO1xuICAgICAgZnBzKFwiTU9WRVwiLCAobmV3IERhdGUpLmdldFRpbWUoKSAtIG5vdywgdGhpcy5icHBwKTtcbiAgICB9LFxuICAgIFxuICAgIC8vIEhhbmRsZSBhIHRyYWNrIHJlc2l6ZSBldmVudCBvbiBvbmUgb2YgdGhlIGxpbmVzLCBwcm9wYWdhdGluZyBpdHMgY2hhbmdlcyB0byB0aGUgb3RoZXIgbGluZXMgYW5kIGZpeGluZyB0aGUgbGF5b3V0XG4gICAgcmVjdlRyYWNrUmVzaXplOiBmdW5jdGlvbigkc3JjLCBuYW1lLCBoZWlnaHQsIGNhbGxiYWNrKSB7XG4gICAgICB2YXIgaG9sZFN0ZWFkeSA9ICRzcmMgJiYgdGhpcy4kbGluZXMuaW5kZXgoJHNyYyk7XG4gICAgICB0aGlzLl9yZXNpemVUcmFjayhuYW1lLCBoZWlnaHQsIGhvbGRTdGVhZHksIF8uaXNGdW5jdGlvbihjYWxsYmFjaykgPyBjYWxsYmFjayA6IHRydWUpO1xuICAgIH0sXG4gICAgXG4gICAgLy8gSGFuZGxlIGEgdHJhY2sgcmVvcmRlciBhY3Rpb24gb24gb25lIG9mIHRoZSBsaW5lcywgcHJvcGFnYXRpbmcgaXRzIGNoYW5nZXMgdG8gdGhlIG90aGVyIGxpbmVzXG4gICAgLy8gbmV3T3JkZXIgaXMgYW4gYXJyYXkgbWFwcGluZyBvbGRJbmRleCA9PiBuZXdJbmRleFxuICAgIHJlY3ZTb3J0OiBmdW5jdGlvbigkc3JjLCBuZXdPcmRlcikge1xuICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICBfLmVhY2goby50cmFja3MsIGZ1bmN0aW9uKHYsIGkpIHsgdi5faSA9IGk7IH0pO1xuICAgICAgby50cmFja3Muc29ydChmdW5jdGlvbihhLCBiKSB7IHJldHVybiBuZXdPcmRlclthLl9pXSAtIG5ld09yZGVyW2IuX2ldOyB9KTtcbiAgICAgIF8uZWFjaChvLnRyYWNrcywgZnVuY3Rpb24odiwgaSkgeyBkZWxldGUgdi5faTsgfSk7XG4gICAgICB0aGlzLiRsaW5lcy5ub3QoJHNyYykuZ2Vub2xpbmUoJ2ZpeFRyYWNrcycpLmdlbm9saW5lKCdmaXhUcmFja1RpbGVzJyk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBIYW5kbGUgYSBtb3VzZXdoZWVsIGV2ZW50IG9uIG9uZSBvZiB0aGUgbGluZXMsIHByb3BhZ2F0aW5nIGl0cyBjaGFuZ2VzIHRvIGFsbCBsaW5lcy5cbiAgICBfcmVjdlpvb206IGZ1bmN0aW9uKGUsIG1hbnVhbERlbHRhKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgIGQgPSBbbWFudWFsRGVsdGEsIGUub3JpZ2luYWxFdmVudC53aGVlbERlbHRhWSwgZS5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGEsIFxuICAgICAgICAgIGUub3JpZ2luYWxFdmVudC5heGlzID09IDIgJiYgLWUub3JpZ2luYWxFdmVudC5kZXRhaWxdLFxuICAgICAgICB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudCxcbiAgICAgICAgYWRqdXN0ID0gW1soL2Nocm9tZS9pKSwgMC4wNl0sIFsoL3NhZmFyaS9pKSwgMC4wM10sIFsoL29wZXJhfG1zaWUvaSksIDAuMDFdXTtcbiAgICAgICAgXG4gICAgICAvLyBZb3UgY2FuIHNjcm9sbCB0aGUgdHJhY2sgcGlja2Vycywgc2VsZWN0IGJveGVzLCBhbmQgdGV4dGFyZWFzXG4gICAgICBpZiAoJChlLnRhcmdldCkuY2xvc2VzdCgnLnBpY2tlcixzZWxlY3QsdGV4dGFyZWEnKS5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgICBcbiAgICAgIHNlbGYuZWxlbWVudC5maW5kKCcuZHJhZy1jb250Jykuc3RvcCgpOyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0b3AgYW55IGN1cnJlbnQgaW5lcnRpYWwgc2Nyb2xsaW5nXG4gICAgICBpZiAoXy5pc1VuZGVmaW5lZChzZWxmLl93aGVlbERlbHRhKSkgeyBzZWxmLl93aGVlbERlbHRhID0gMDsgfVxuICAgICAgJC50aXBUaXAuaGlkZSgpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGlkZSBhbnkgdGlwVGlwcyBzaG93aW5nXG4gICAgICBkID0gXy5yZWplY3QoZCwgXy5pc1VuZGVmaW5lZCkuc2hpZnQoKTtcbiAgICAgIHNlbGYuY2VudGVyZWRPbiA9IHNlbGYuX3Bvc0F0TW91c2UoZS5vcmlnaW5hbEV2ZW50KTtcbiAgICAgIFxuICAgICAgLy8gbW91c2V3aGVlbGluZyBpcyBtb3JlIHBlcmZvcm1hbnQgKGVzcCBpbiBTYWZhcmkpIGlmIGl0IGFsbCB0aGUgZXZlbnRzIGZpcmUgb24gYSBzaW5nbGUgZWxlbWVudFxuICAgICAgLy8gd2hpY2ggaXMgd2h5IHdlIHRocm93IGEgXCJzaGllbGRcIiBlbGVtZW50IGluIGZyb250IG9mIGFsbCB0aGUgYnJvd3NlciBsaW5lcyBkdXJpbmcgem9vbXMgdG8gY2FwdHVyZSB0aGUgZXZlbnRzXG4gICAgICAvLyBGSVhNRTogSXMgdGhpcyBzdGlsbCBuZWVkZWQ/IFNhZmFyaSBoYXMgcG9zc2libHkgZml4ZWQgdGhpcz9cbiAgICAgIC8vIHNlbGYubGluZXMoKS5nZW5vbGluZSgndG9nZ2xlWm9vbVNoaWVsZCcsIHRydWUpOyAgICAgICAgICAgICAgICBcbiAgICAgIFxuICAgICAgaWYgKGQgJiYgc2VsZi5jZW50ZXJlZE9uICE9PSBudWxsKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHNlbGYuJHNsaWRlci5zbGlkZXIoJ3ZhbHVlJyksXG4gICAgICAgICAgZGVsdGEgPSAoby5zbmFwWm9vbSA/IChzZWxmLl93aGVlbERlbHRhICs9IGQpIDogZCkgLyAyMDtcbiAgICAgICAgaWYgKHVzZXJBZ2VudCAmJiBfLmlzVW5kZWZpbmVkKG1hbnVhbERlbHRhKSkgeyBcbiAgICAgICAgICBfLmZpbmQoYWRqdXN0LCBmdW5jdGlvbih2KSB7IHJldHVybiB2WzBdLnRlc3QodXNlckFnZW50KSAmJiAoZGVsdGEgKj0gdlsxXSk7IH0pOyBcbiAgICAgICAgfSBlbHNlIGlmIChlLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YVkpIHsgZGVsdGEgKj0gMC4wNTsgfVxuICAgICAgICBpZiAoby5zbmFwWm9vbSkge1xuICAgICAgICAgIGlmIChNYXRoLmFicyhkZWx0YSkgPiAxLjIpIHsgXG4gICAgICAgICAgICBzZWxmLl9hbmltYXRlWm9vbShkZWx0YSA+IDAsIDEwMDApO1xuICAgICAgICAgICAgc2VsZi5fd2hlZWxEZWx0YSA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgeyBzZWxmLiRzbGlkZXIuc2xpZGVyKCd2YWx1ZScsIHZhbHVlICsgZGVsdGEpOyB9XG4gICAgICAgIHNlbGYuX2ZpbmlzaFpvb21EZWJvdW5jZWQoZGVsdGEgPiAwKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIGZhbHNlOyAvLyBkaXNhYmxlIHNjcm9sbGluZyBvZiB0aGUgZG9jdW1lbnRcbiAgICB9LFxuICAgIFxuICAgIC8vIFRoaXMgaXMgZmlyZWQgc2hvcnRseSBhZnRlciB0cmFja3MgYmVsaWV2ZSB0aGF0IGFsbCBpbWFnZXMgaGF2ZSBsb2FkZWQuXG4gICAgLy8gV2UgcmVjYWxjdWxhdGUgdGhlIGRlbnNpdHkgb3JkZXIgb2YgdHJhY2tzLCBhbmQgZml4IHRoZSBvcmFuZ2UgY2xpcCBpbmRpY2F0b3JzLlxuICAgIF9yZWN2VHJhY2tMb2FkOiBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgICRlbGVtID0gc2VsZi5lbGVtZW50LFxuICAgICAgICAkdHJrID0gJChlLnRhcmdldCksXG4gICAgICAgIHQgPSAkdHJrLmdlbm90cmFjaygnb3B0aW9uJywgJ3RyYWNrJyk7XG4gICAgICBcbiAgICAgIC8vIFRoaXMgaGFuZGxlciBpcyBtYW51YWxseSBkZWJvdW5jZWQgYnkgMTAwbXMsIHNlcGFyYXRlbHkgcGVyIHRyYWNrLlxuICAgICAgc2VsZi5fdHJhY2tMb2FkVGltZXJzID0gc2VsZi5fdHJhY2tMb2FkVGltZXJzIHx8IHt9O1xuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHNlbGYuX3RyYWNrTG9hZFRpbWVyc1t0Lm5dKSkgeyBjbGVhclRpbWVvdXQoc2VsZi5fdHJhY2tMb2FkVGltZXJzW3Qubl0pOyB9XG4gICAgICBzZWxmLl90cmFja0xvYWRUaW1lcnNbdC5uXSA9IHNldFRpbWVvdXQoXy5iaW5kKGZ1bmN0aW9uKCR0cmssIHQpIHtcbiAgICAgICAgLy8gd2UgaGF2ZSBuZXcgaW1hZ2UgZGF0YSwgc28gKmZvcmNlKiByZWNhbGN1bGF0aW9uIG9mIHRoZSBkZW5zaXR5T3JkZXJcbiAgICAgICAgc2VsZi5kZW5zaXR5T3JkZXIodC5uLCB0LmgsICR0cmsuZ2Vub3RyYWNrKCdicHBwcycpLCB0cnVlKTtcbiAgICAgICAgJGVsZW0uZmluZCgnLmJyb3dzZXItdHJhY2stJyt0Lm4pLmdlbm90cmFjaygnZml4Q2xpcHBlZCcpO1xuICAgICAgfSwgc2VsZiwgJHRyaywgdCksIDEwMCk7XG4gICAgfSxcbiAgICBcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vID0gVGhlc2UgZnVuY3Rpb25zIG1hbmlwdWxhdGUgdGhlIHRhbmsgcmV0aWNsZSA9XG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBcbiAgICAvLyBSZXR1cm5zIHRoZSBvZmZzZXQgb2YgdGhlIHJldGljbGUsIGluIGJhc2VwYWlycywgZnJvbSB0aGUgcG9zaXRpb24gb2YgdGhlIGJyb3dzZXJcbiAgICAvLyB3aGljaCBpcyBkZXNpZ25hdGVkIGFzIHRoZSBiYXNlcGFpciBhdCB0aGUgbGVmdCBlZGdlIG9mIHRoZSB0b3Btb3N0IGxpbmVcbiAgICBfcmV0aWNEZWx0YTogZnVuY3Rpb24obGluZSkge1xuICAgICAgbGluZSA9IF8uaXNVbmRlZmluZWQobGluZSkgPyB0aGlzLmNlbnRyYWxMaW5lIDogbGluZTtcbiAgICAgIHZhciBicFdpZHRoID0gdGhpcy5icFdpZHRoKCk7XG4gICAgICByZXR1cm4gKGxpbmUgKyAwLjUpICogYnBXaWR0aCAtIHRoaXMub3B0aW9ucy5zaWRlQmFyV2lkdGggKiAwLjUgKiB0aGlzLmJwcHA7XG4gICAgfSxcblxuICAgIC8vIENoYW5nZSB0aGUgcG9zaXRpb24gYW5kIHdpZHRoIG9mIHRoZSByZXRpY2xlXG4gICAgX3VwZGF0ZVJldGljbGU6IGZ1bmN0aW9uKGNlbnRlcmVkT24sIGFuaW1PcHRzKSB7XG4gICAgICB2YXIgJGVsZW0gPSB0aGlzLmVsZW1lbnQsXG4gICAgICAgIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgIGJwV2lkdGggPSB0aGlzLmJwV2lkdGgoKSxcbiAgICAgICAgem9vbSA9IHRoaXMuYnBwcCxcbiAgICAgICAgbGluZUluZGV4ID0gXy5pc051bWJlcihjZW50ZXJlZE9uKSA/IGZsb29ySGFjaygoY2VudGVyZWRPbiAtIHRoaXMucG9zKSAvIGJwV2lkdGgpIDogdGhpcy5jZW50cmFsTGluZSxcbiAgICAgICAgbmV4dFpvb21zID0gdGhpcy5zbGlkZXJCcHBwcy5zbGljZShNYXRoLmNlaWwodGhpcy4kc2xpZGVyLnNsaWRlcigndmFsdWUnKSArIDAuMDAxKSksXG4gICAgICAgICRsaW5lID0gdGhpcy4kbGluZXMuZXEobGluZUluZGV4KSxcbiAgICAgICAgZHVyYXRpb24gPSBhbmltT3B0cyAmJiAhXy5pc1VuZGVmaW5lZChhbmltT3B0cy5kdXJhdGlvbikgPyBhbmltT3B0cy5kdXJhdGlvbiA6IDIwMDtcbiAgICAgIGZ1bmN0aW9uIGhpZGUoJHJldGljcywgZCkge1xuICAgICAgICBkID0gZCB8fCBkdXJhdGlvbjtcbiAgICAgICAgJHJldGljcy5hbmltYXRlKHtvcGFjaXR5OiAwfSwgeyBkdXJhdGlvbjogZCwgY29tcGxldGU6IGZ1bmN0aW9uKCkgeyAkKHRoaXMpLmFkZENsYXNzKCdoaWRkZW4nKTsgfSB9KTtcbiAgICAgIH1cbiAgICAgIGlmICghbmV4dFpvb21zLmxlbmd0aCkgeyBuZXh0Wm9vbXMgPSB0aGlzLnNsaWRlckJwcHBzLnNsaWNlKC0xKTsgfVxuICAgICAgaWYgKF8uaXNVbmRlZmluZWQoY2VudGVyZWRPbikpIHtcbiAgICAgICAgaWYgKCFfLmFueSh0aGlzLl9zaG93UmV0aWNsZSkpIHsgcmV0dXJuIGhpZGUoJGVsZW0uZmluZCgnLnJldGljOm5vdCguaGlkZGVuKScpKTsgfVxuICAgICAgICAkbGluZS5maW5kKCcucmV0aWMuaGlkZGVuJykuYW5pbWF0ZSh7b3BhY2l0eTogby5yZXRpY09wYWNpdHl9LCB7XG4gICAgICAgICAgZHVyYXRpb246IDIwMCwgXG4gICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkgeyAkKHRoaXMpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRsaW5lLmZpbmQoJy5yZXRpYycpLmNzcygnb3BhY2l0eScsIG8ucmV0aWNPcGFjaXR5KS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVJldGljbGVEZWJvdW5jZWQoKTtcbiAgICAgIH1cbiAgICAgICRsaW5lLmdlbm9saW5lKCdzZXRSZXRpY2xlJywgbmV4dFpvb21zLCBjZW50ZXJlZE9uKTtcbiAgICAgIGhpZGUodGhpcy4kbGluZXMubm90KCRsaW5lLmdldCgwKSkuZmluZCgnLnJldGljOm5vdCguaGlkZGVuKScpLCAwKTtcbiAgICB9LFxuICAgIFxuICAgIC8vIERpc3BsYXkgdGhlIHJldGljbGUgZm9yIG9uZSBvZiBzZXZlcmFsIHBvc3NpYmxlIHJlYXNvbnMgKHNldCB0aGVtIGFzIHRydWUgb3IgZmFsc2UpXG4gICAgLy8gVGhlIHJldGljbGUgd2lsbCBiZSBzaG93biBpZiBhbnkgb2YgdGhlIHJlYXNvbnMgYXBwbHlcbiAgICBzaG93UmV0aWNsZTogZnVuY3Rpb24od2h5LCB2YWwpIHtcbiAgICAgIHRoaXMuX3Nob3dSZXRpY2xlW3doeV0gPSB2YWw7XG4gICAgICB0aGlzLl91cGRhdGVSZXRpY2xlKCk7XG4gICAgfSxcbiAgICBcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyA9IFRoZSBmb2xsb3dpbmcgZnVuY3Rpb25zIGFyZSBkZWJvdW5jZWQ7IHRoZXkgdXBkYXRlIHRoZSBkaXNwbGF5IGFmdGVyIGEgcmVwZWF0ZWQgZXZlbnQgY29uY2x1ZGVzID1cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBcbiAgICAvLyBBZnRlciBhIHNob3J0IGRlbGF5LCBhIHpvb20gYWN0aW9uIGNhbiBiZSBcInNuYXBwZWRcIiB0byB0aGUgbmVhcmVzdCBvcHRpbWFsIGxldmVsXG4gICAgLy8gTk9URTogVGhpcyBpcyBfLmRlYm91bmNlJ2QgaW4gaW5pdCgpXG4gICAgX2ZpbmlzaFpvb21EZWJvdW5jZWQ6IGZ1bmN0aW9uKGRpcmVjdGlvbikge1xuICAgICAgdGhpcy5ib3VuY2VDaGVjaygpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5zbmFwWm9vbUFmdGVyICYmICF0aGlzLm9wdGlvbnMuc25hcFpvb20pIHsgdGhpcy5fYW5pbWF0ZVpvb20oZGlyZWN0aW9uKTsgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5zbmFwWm9vbSkgeyBzZWxmLl93aGVlbERlbHRhID0gMDsgfVxuICAgICAgdGhpcy5saW5lcygpLmdlbm9saW5lKCd0b2dnbGVab29tU2hpZWxkJywgZmFsc2UpO1xuICAgIH0sXG4gICAgXG4gICAgLy8gRXZlcnl0aW1lIHdlIHpvb20gaW4gb24gYSBsaW5lLCB3ZSBoYXZlIHRvIHJlY2FsY3VsYXRlIHRoZSBkZW5zaXR5IG9yZGVyIG9mIHRyYWNrcyxcbiAgICAvLyBhbmQgcmVkcmF3IHRoZSB0aWNrIG1hcmtzIG9uIHRoZSBydWxlciB0cmFjay5cbiAgICAvLyBOT1RFOiBUaGlzIGlzIF8uZGVib3VuY2UnZCBpbiBfaW5pdCgpXG4gICAgX2ZpeFpvb21lZFRyYWNrRGVib3VuY2VkOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQ7XG4gICAgICBfLmVhY2goby50cmFja3MsIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgc2VsZi5kZW5zaXR5T3JkZXIodC5uLCB0LmgsICRlbGVtLmZpbmQoJy5icm93c2VyLXRyYWNrLScrdC5uKS5nZW5vdHJhY2soJ2JwcHBzJykpO1xuICAgICAgICAkZWxlbS5maW5kKCcuYnJvd3Nlci10cmFjay0nK3QubikuZ2Vub3RyYWNrKCdyZWRyYXdDYW52YXNUaWNrcycpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBSZW1lbWJlcnMgdGhlIGdlbmVyYWwgbGF5b3V0ICYgcG9zaXRpb24gb2YgdGhlIGJyb3dzZXIgZm9yIHRoZSBuZXh0IHRpbWUgaXQgaXMgb3BlbmVkXG4gICAgLy8gTk9URTogVGhpcyBpcyBfLmRlYm91bmNlJ2QgaW4gX2luaXQoKVxuICAgIF9zYXZlUGFyYW1zRGVib3VuY2VkOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgcG9zID0gc2VsZi5wb3MsXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgIHJkID0gc2VsZi5fcmV0aWNEZWx0YSgpLFxuICAgICAgICBjaHIgPSBzZWxmLmNockF0KHBvcyArIHJkKSB8fCBvLmNockxhYmVsc1swXSxcbiAgICAgICAgem9vbUZvcm1hdHRlZCA9IHNlbGYuYnBwcC50b1ByZWNpc2lvbihNYXRoLm1heChmbG9vckhhY2soc2VsZi5icHBwKS50b1N0cmluZygpLmxlbmd0aCwgNikpLFxuICAgICAgICBzdGF0ZSA9IHtwb3NpdGlvbjogY2hyLm4gKyAnOicgKyBNYXRoLnJvdW5kKHBvcyArIHJkIC0gY2hyLnApICsgJ0AnICsgem9vbUZvcm1hdHRlZH0sXG4gICAgICAgIGxpbmVNb2RlID0gJChvLmxpbmVNb2RlKS5maW5kKCc6Y2hlY2tlZCcpLnZhbCgpLFxuICAgICAgICAkbGlua1BpY2tlciA9ICQoby5saW5raW5nWzFdKSxcbiAgICAgICAgJHVybCA9ICRsaW5rUGlja2VyLmZpbmQoJy51cmwnKSxcbiAgICAgICAgJHVjc2NMaW5rID0gJGxpbmtQaWNrZXIuZmluZCgnYVtuYW1lPXVjc2NdJyksXG4gICAgICAgIHVybCwgc3RhcnQsIGVuZCwgdWNzY1BhcmFtcztcbiAgICAgIHN0YXRlLnRyYWNrcyA9IF8ubWFwKG8udHJhY2tzLCBmdW5jdGlvbih0KSB7IHJldHVybiB0Lm4gKyAnOicgKyB0Lmg7IH0pLmpvaW4oJ3wnKTtcbiAgICAgIHN0YXRlLmN1c3RvbVRyYWNrcyA9IHNlbGYuX2N1c3RvbVRyYWNrVXJscy5sb2FkZWQ7XG4gICAgICBpZiAobGluZU1vZGUgIT0gc2VsZi5fZGVmYXVsdExpbmVNb2RlKSB7IHN0YXRlLm1vZGUgPSBsaW5lTW9kZTsgfVxuICAgICAgXG4gICAgICAvLyAkLnBhcmFtKHsuLi59LCB0cnVlKSAtLT4gZG9uJ3QgYWRkIFtdIHRvIGFycmF5IHBhcmFtc1xuICAgICAgdXJsID0gJz8nICsgZGVjb2RlU2FmZU9jdGV0cygkLnBhcmFtKF8uZXh0ZW5kKHtkYjogby5nZW5vbWV9LCBzdGF0ZSksIHRydWUpKTtcbiAgICAgIC8vIElmIHRoZSBIVE1MNSBoaXN0b3J5IEFQSSBpcyBpbXBsZW1lbnRlZCwgc2F2ZSB0aGUgc3RhdGUgdG8gdGhlIFVSTCBiYXIgYWZ0ZXIgdGhlIGZpcnN0IGNoYW5nZVxuICAgICAgaWYgKHdpbmRvdy5oaXN0b3J5ICYmIHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSAmJiBzZWxmLnN0YXRlKSB7XG4gICAgICAgIHZhciBub3cgPSAobmV3IERhdGUpLmdldFRpbWUoKSxcbiAgICAgICAgICBoaXN0b3J5Rm4gPSBub3cgLSAoc2VsZi5faGlzdExhc3RSZXBsYWNlZCB8fCAwKSA+IDIwMDAwID8gJ3B1c2hTdGF0ZScgOiAncmVwbGFjZVN0YXRlJztcbiAgICAgICAgd2luZG93Lmhpc3RvcnlbaGlzdG9yeUZuXSh7fSwgd2luZG93LmRvY3VtZW50LnRpdGxlLCB1cmwpO1xuICAgICAgICBzZWxmLl9oaXN0TGFzdFJlcGxhY2VkID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgICAkdXJsLnZhbCh3aW5kb3cubG9jYXRpb24uaHJlZi5yZXBsYWNlKC9cXD8uKiQvLCAnJykgKyB1cmwpO1xuICAgICAgXG4gICAgICAvLyBBbHNvIG1ha2UgYSBVUkwgdG8gdGhlIGVxdWl2YWxlbnQgdmlldyBpbiBVQ1NDXG4gICAgICBpZiAoIW8uY3VzdG9tIHx8ICgvXnVjc2M6LykudGVzdChvLmdlbm9tZSkpIHtcbiAgICAgICAgc3RhcnQgPSBNYXRoLm1heChNYXRoLnJvdW5kKHBvcyAtIGNoci5wKSwgMSk7XG4gICAgICAgIGVuZCA9IE1hdGgubWluKE1hdGgucm91bmQocG9zIC0gY2hyLnAgKyBzZWxmLmJwV2lkdGgoKSAqIHNlbGYuJGxpbmVzLmxlbmd0aCksIG8uY2hyTGVuZ3Roc1tjaHIubl0pO1xuICAgICAgICB1Y3NjUGFyYW1zID0ge2RiOiBvLmdlbm9tZS5yZXBsYWNlKC9edWNzYzp8OlxcZCskL2csICcnKSwgcG9zaXRpb246IGNoci5uICsgJzonICsgc3RhcnQgKyAnLScgKyBlbmR9O1xuICAgICAgICBfLmVhY2goby50cmFja3MsIGZ1bmN0aW9uKHQpIHsgXG4gICAgICAgICAgdmFyIGRlbnNpdHlPcmRlckFzQXJyYXkgPSBfLm1hcChzZWxmLmRlbnNpdHlPcmRlcih0Lm4pLCBmdW5jdGlvbih2LGspIHsgcmV0dXJuIFtrLHZdOyB9KSxcbiAgICAgICAgICAgIHRvcERlbnNpdHkgPSBfLm1pbihkZW5zaXR5T3JkZXJBc0FycmF5LCBmdW5jdGlvbihwKSB7IHJldHVybiBwWzFdOyB9KTtcbiAgICAgICAgICBpZiAodG9wRGVuc2l0eSkgeyB1Y3NjUGFyYW1zW3Qubl0gPSB0b3BEZW5zaXR5WzBdOyB9XG4gICAgICAgIH0pO1xuICAgICAgICAkdWNzY0xpbmsuY2xvc2VzdCgnLmZvcm0tbGluZScpLnNob3coKTtcbiAgICAgICAgJHVjc2NMaW5rLmF0dHIoJ2hyZWYnLCBvLnVjc2NVUkwgKyAnPycgKyAkLnBhcmFtKHVjc2NQYXJhbXMpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICR1Y3NjTGluay5jbG9zZXN0KCcuZm9ybS1saW5lJykuaGlkZSgpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBTYXZlIHN0YXRlIGluIGxvY2FsU3RvcmFnZSwgc2Vzc2lvblN0b3JhZ2UsIGFuZCAkLmNvb2tpZSBhcyBhcHByb3ByaWF0ZVxuICAgICAgc2VsZi5zdGF0ZSA9IHN0YXRlO1xuICAgICAgc2VsZi5zdG9yYWdlICYmIF8uZWFjaChvLnNhdmFibGVQYXJhbXMsIGZ1bmN0aW9uKGtleXMsIGRlc3QpIHtcbiAgICAgICAgXy5lYWNoKGtleXMsIGZ1bmN0aW9uKGspIHtcbiAgICAgICAgICB2YXIgZnVsbEtleSA9IChkZXN0ICE9ICdwZXJzaXN0ZW50JyA/IG8uZ2Vub21lICsgJy4nIDogJycpICsgaztcbiAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc3RhdGVba10pKSB7IFxuICAgICAgICAgICAgc2VsZi5zdG9yYWdlW2Rlc3RdLnNldEl0ZW0oZnVsbEtleSwgc3RhdGVba10pOyBcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VsZi5zdG9yYWdlW2Rlc3RdLnJlbW92ZUl0ZW0oZnVsbEtleSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vID0gVGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgY29vcmRpbmF0ZSB0aGUgY2xpY2sgYXJlYXMgdGhhdCBhcHBlYXIgd2hlbiBob3ZlcmluZyBvdmVyIHRpbGVzID1cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgXG4gICAgLy8gRXZlcnl0aW1lIHdlIG1vdmUgdGhlIGJyb3dzZXIsIHdlIGhhdmUgdG8gZmV0Y2ggbmV3IGNsaWNrIGFyZWEgZGF0YS5cbiAgICAvLyBOT1RFOiBUaGlzIGlzIF8uZGVib3VuY2UnZCBpbiBfaW5pdCgpXG4gICAgX2ZpeENsaWNrQXJlYXNEZWJvdW5jZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLCBcbiAgICAgICAgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQ7XG4gICAgICBfLmVhY2goby50cmFja3MsIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgJGVsZW0uZmluZCgnLmJyb3dzZXItdHJhY2stJyt0Lm4pLmdlbm90cmFjaygnZml4Q2xpY2tBcmVhcycpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBBcmVhcyBhcmUgc3RvcmVkIGluIGEgZ2xvYmFsIGluZGV4LCBzbyB0aGF0IG1vdXNpbmcgb3ZlciBhbiBhcmVhIGluIG9uZSB0aWxlIGNhbiByZXRyaWV2ZVxuICAgIC8vIGFyZWFzIHdpdGggYSBzaW1pbGFyIG5hbWUvaHJlZkhhc2ggdGhhdCBtdXN0IGFsc28gYmUgaGlnaGxpZ2h0ZWQuICBUaGlzIGZ1bmN0aW9uIHJlY2VpdmVzXG4gICAgLy8gaW5mb3JtYXRpb24gYWJvdXQgYSBjdXJyZW50IGhvdmVyIGV2ZW50IGFuZCBjcmVhdGVzIHRoZSBhcHByb3ByaWF0ZSBoaWdobGlnaHRlZCBhbmNob3JzXG4gICAgLy8gd2l0aGluIHRoZSBjb3JyZWN0IHRpbGVzLiBcbiAgICBhcmVhSG92ZXI6IGZ1bmN0aW9uKGtleXMsIHRhcmdldCkge1xuICAgICAgdmFyICRlbGVtID0gdGhpcy5lbGVtZW50O1xuICAgICAgaWYgKF8uaXNVbmRlZmluZWQoa2V5cykpIHsgcmV0dXJuIHRoaXMuX2FyZWFIb3ZlcjsgfVxuICAgICAgJGVsZW0uZmluZCgnLmFyZWEucmVjdCcpLnJlbW92ZSgpO1xuICAgICAgJGVsZW0uZmluZCgnLmFyZWEubGFiZWwuaG92ZXInKS5yZW1vdmVDbGFzcygnaG92ZXInKTtcbiAgICAgIGlmICgha2V5cykgeyAkLnRpcFRpcC5oaWRlKCk7IHJldHVybiAodGhpcy5fYXJlYUhvdmVyID0gZmFsc2UpOyB9XG4gICAgICBpZiAoa2V5cy5sZW5ndGggIT0gNSkgeyB0aHJvdyAnbm90IGVub3VnaCBsZXZlbHMgdG8gdHJhdmVyc2UgaW5kZXgnOyB9XG4gICAgICB2YXIgYXJlYUluZGljZXMgPSB0aGlzLl9hcmVhSW5kZXg7XG4gICAgICAvLyBrZXlzIGlzIHVzZWQgdG8gdHJhdmVyc2UgdGhlIGZpcnN0IDUgbGV2ZWxzIG9mIHRoZSBhcmVhSW5kZXgsIHdoaWNoIGlzIG9yZ2FuaXplZCBhcyBmb2xsb3dzOlxuICAgICAgLy8gYXJlYUluZGV4W3RyYWNrXVticHBwXVtkZW5zaXR5XVtcImhyZWZIYXNoXCJ8XCJuYW1lXCJdW2hyZWZIYXNofG5hbWVdW3RpbGVJZF1bbG9jYWxBcmVhSWRdID0gdHJ1ZVxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBrID0ga2V5c1tpXTtcbiAgICAgICAgaWYgKCFhcmVhSW5kaWNlc1trXSkgeyBhcmVhSW5kaWNlcyA9IGZhbHNlOyBicmVhazsgfVxuICAgICAgICBhcmVhSW5kaWNlcyA9IGFyZWFJbmRpY2VzW2tdO1xuICAgICAgfVxuICAgICAgaWYgKGFyZWFJbmRpY2VzKSB7XG4gICAgICAgIF8uZWFjaChhcmVhSW5kaWNlcywgZnVuY3Rpb24obG9jYWxBcmVhSWRzLCB0aWxlSWQpIHtcbiAgICAgICAgICB2YXIgJHQgPSAkKCcjJyt0aWxlSWQpLFxuICAgICAgICAgICAgJHRkYXRhID0gJHQuY2hpbGRyZW4oJy50ZGF0YS5kZW5zLScra2V5c1syXSksXG4gICAgICAgICAgICAkdHJhY2ssIGFyZWFzO1xuICAgICAgICAgIGlmICghJHQubGVuZ3RoIHx8ICEoYXJlYXMgPSAkdGRhdGEuZGF0YSgnYXJlYXMnKSkpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgJHRyYWNrID0gJHQucGFyZW50KCk7XG4gICAgICAgICAgXy5lYWNoKGxvY2FsQXJlYUlkcywgZnVuY3Rpb24oZHVtbXksIGlkKSB7XG4gICAgICAgICAgICB2YXIgYXJlYSA9IGFyZWFzW2lkXSxcbiAgICAgICAgICAgICAgZmxhZ3MgPSB7fTtcbiAgICAgICAgICAgIGlmICh0YXJnZXQgPT09IFwiRkxBU0hNRVwiKSB7IGZsYWdzLmZsYXNobWUgPSB0cnVlOyB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgZmxhZ3MuaG92ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICBpZiAodGFyZ2V0ICYmIHRhcmdldCA9PSB0aWxlSWQgKyAnLicgKyBpZCkgeyBmbGFncy50aXBUaXBBY3RpdmF0ZWQgPSB0cnVlOyB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkdHJhY2suZ2Vub3RyYWNrKCdtYWtlQW5jaG9yJywgJHQsIGFyZWEsICR0ZGF0YS5kYXRhKCdicHBwJyksICR0ZGF0YS5kYXRhKCdkZW5zaXR5JyksIGZsYWdzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChrZXlzWzNdPT0naHJlZkhhc2gnKSB7XG4gICAgICAgICAgLy8gQWxzbyBoaWdobGlnaHQgYW55IGV4aXN0aW5nIC5hcmVhJ3MgKGUuZy4gbGFiZWxzIG9uIGN1c3RvbSB0cmFja3MpXG4gICAgICAgICAgJGVsZW0uZmluZCgnLmJyb3dzZXItdHJhY2stJytrZXlzWzBdKyc+LmJwcHAtJytjbGFzc0ZyaWVuZGx5KGtleXNbMV0pKyc+LmRlbnMtJytrZXlzWzJdKycuaHJlZi1oYXNoLScra2V5c1s0XSkuYWRkQ2xhc3MoJ2hvdmVyJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7IHRocm93ICdzb21ldGhpbmcgd2VudCB3cm9uZyB3aGlsZSBydW5uaW5nIHRocm91Z2ggdGhlIGFyZWFJbmRleCc7IH1cbiAgICAgIHJldHVybiAodGhpcy5fYXJlYUhvdmVyID0ga2V5c1swXSArICcuJyArIGtleXNbM10gKyAnLicgKyBrZXlzWzRdKTtcbiAgICB9LFxuICAgIFxuICAgIC8vIFJldHVybiB0aGUgYXJlYSBpbmRleDsgb3RoZXIgd2lkZ2V0cyBjYW4gYWNjZXNzIGl0IGRpcmVjdGx5XG4gICAgYXJlYUluZGV4OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuX2FyZWFJbmRleDsgfSxcbiAgICBcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vID0gTWlzY2VsbGFuZW91cyBmdW5jdGlvbnMgdGhhdCBkaWRuJ3QgZml0IGVsc2V3aGVyZSA9XG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBcbiAgICAvLyBGZXRjaGVzIEROQSBmcm9tIHRoZSBBSkFYIHNlcnZpY2UgZm9yIGEgcGFydGljdWxhciBicCByYW5nZSBhbmQgc2VuZHMgaXQgb2ZmIHRvIHRoZSBjYWxsYmFjayBmdW5jdGlvblxuICAgIGdldEROQTogZnVuY3Rpb24obGVmdCwgcmlnaHQsIGNhbGxiYWNrLCBleHRyYURhdGEpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgY2h1bmtTaXplID0gby5tYXhOdFJlcXVlc3Q7XG4gICAgICBpZiAoIXRoaXMuX2RuYUNhbGxiYWNrcykgeyB0aGlzLl9kbmFDYWxsYmFja3MgPSBbXTsgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBsb2FkZWRGcm9tQWpheChkYXRhLCBzdGF0dXNDb2RlLCBqcVhIUikge1xuICAgICAgICBzZWxmLl9kbmFbanFYSFIuX3NdID0gZGF0YS5zZXE7XG4gICAgICAgIGNoZWNrQ2FsbGJhY2tzKCk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBhamF4TG9hZEROQSgpIHtcbiAgICAgICAgdmFyIHNsb3RzID0gZW1wdHlDYWNoZVNsb3RzKHNlbGYucG9zLCBzZWxmLnBvcyArIHNlbGYuYnBXaWR0aCgpICogc2VsZi4kbGluZXMubGVuZ3RoKTtcbiAgICAgICAgXy5lYWNoKHNsb3RzLCBmdW5jdGlvbihzKSB7XG4gICAgICAgICAgdmFyIGFqYXhPcHRpb25zID0ge1xuICAgICAgICAgICAgZGF0YToge2RiOiBvLmdlbm9tZSwgbGVmdDogcyAqIGNodW5rU2l6ZSArIDEsIHJpZ2h0OiAocyArIDEpICogY2h1bmtTaXplICsgMX0sXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgc3VjY2VzczogbG9hZGVkRnJvbUFqYXgsXG4gICAgICAgICAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbihqcVhIUikgeyBqcVhIUi5fcyA9IHM7IH1cbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmIChvLmN1c3RvbSkge1xuICAgICAgICAgICAgYWpheE9wdGlvbnMudHlwZSA9IFwiUE9TVFwiO1xuICAgICAgICAgICAgYWpheE9wdGlvbnMuZGF0YS5jaHJfb3JkZXIgPSBKU09OLnN0cmluZ2lmeShvLmNock9yZGVyKTtcbiAgICAgICAgICAgIGFqYXhPcHRpb25zLmRhdGEuY2hyX2xlbmd0aHMgPSBKU09OLnN0cmluZ2lmeShvLmNockxlbmd0aHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAkLmFqYXgoby5hamF4RGlyICsgJ2RuYS5waHAnLCBhamF4T3B0aW9ucyk7XG4gICAgICAgICAgc2VsZi5fZG5hW3NdID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gZW1wdHlDYWNoZVNsb3RzKGxlZnQsIHJpZ2h0KSB7XG4gICAgICAgIC8vIGNvbnZlcnQgMS1iYXNlZCBwb3NpdGlvbnMgdG8gMC1iYXNlZFxuICAgICAgICBsZWZ0ID0gTWF0aC5tYXgobGVmdCAtIDEsIDEpO1xuICAgICAgICByaWdodCA9IE1hdGgubWluKHJpZ2h0IC0gMSwgby5nZW5vbWVTaXplKTtcbiAgICAgICAgdmFyIGkgPSBNYXRoLmZsb29yKGxlZnQgLyBjaHVua1NpemUpLFxuICAgICAgICAgIGVuZCA9IE1hdGguZmxvb3IocmlnaHQgLyBjaHVua1NpemUpLFxuICAgICAgICAgIHNsb3RzID0gW107XG4gICAgICAgIHdoaWxlIChpIDw9IGVuZCkgeyBpZiAoXy5pc1VuZGVmaW5lZChzZWxmLl9kbmFbaV0pKSB7IHNsb3RzLnB1c2goaSk7IH0gaSsrOyB9XG4gICAgICAgIHJldHVybiBzbG90cztcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGdldEZyb21DYWNoZShsZWZ0LCByaWdodCkge1xuICAgICAgICBsZWZ0LS07IHJpZ2h0LS07IC8vIGNvbnZlcnQgMS1iYXNlZCBwb3NpdGlvbnMgdG8gMC1iYXNlZFxuICAgICAgICB2YXIgaSA9IE1hdGguZmxvb3IobGVmdCAvIGNodW5rU2l6ZSksXG4gICAgICAgICAgZW5kID0gTWF0aC5mbG9vcihyaWdodCAvIGNodW5rU2l6ZSksXG4gICAgICAgICAgc2VncyA9IFtdLCBzZWcsIHN0YXJ0O1xuICAgICAgICB3aGlsZSAoaSA8PSBlbmQpIHtcbiAgICAgICAgICBzZWcgPSBzZWxmLl9kbmFbaV07XG4gICAgICAgICAgc3RhcnQgPSBNYXRoLm1heChsZWZ0IC0gaSAqIGNodW5rU2l6ZSwgMCk7XG4gICAgICAgICAgaWYgKCFzZWcpIHsgcmV0dXJuIG51bGw7IH1cbiAgICAgICAgICBzZWdzLnB1c2goc2VnLnN1YnN0cihzdGFydCwgaT09ZW5kID8gKHJpZ2h0IC0gZW5kICogY2h1bmtTaXplIC0gc3RhcnQpIDogdW5kZWZpbmVkKSk7XG4gICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZWdzLmpvaW4oJycpO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gY2hlY2tDYWxsYmFja3MoKSB7XG4gICAgICAgIHNlbGYuX2RuYUNhbGxiYWNrcyA9IF8uZmlsdGVyKHNlbGYuX2RuYUNhbGxiYWNrcywgZnVuY3Rpb24oYykge1xuICAgICAgICAgIHZhciBkbmEgPSBnZXRGcm9tQ2FjaGUoYy5sZWZ0LCBjLnJpZ2h0KTtcbiAgICAgICAgICBpZiAoZG5hICE9PSBudWxsKSB7IGMuZm4oZG5hLCBjLmV4dHJhRGF0YSk7IHJldHVybiBmYWxzZTsgfVxuICAgICAgICAgIGVsc2UgeyByZXR1cm4gdHJ1ZTsgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdmFyIGRuYTtcbiAgICAgIGlmIChvLmN1c3RvbSAmJiBvLmN1c3RvbS5jYW5HZXRTZXF1ZW5jZSkge1xuICAgICAgICBvLmN1c3RvbS5nZXRTZXF1ZW5jZShsZWZ0LCByaWdodCwgZnVuY3Rpb24oZG5hKSB7IGNhbGxiYWNrKGRuYSwgZXh0cmFEYXRhKTsgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRuYSA9IGdldEZyb21DYWNoZShsZWZ0LCByaWdodCk7XG4gICAgICB9XG4gICAgICBpZiAoZG5hICE9PSBudWxsKSB7IGNhbGxiYWNrKGRuYSwgZXh0cmFEYXRhKTsgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuX2RuYUNhbGxiYWNrcy5wdXNoKHtsZWZ0OiBsZWZ0LCByaWdodDogcmlnaHQsIGZuOiBjYWxsYmFjaywgZXh0cmFEYXRhOiBleHRyYURhdGF9KTtcbiAgICAgICAgYWpheExvYWRETkEoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIC8vIFVwZGF0ZXMgdGhlIHRleHQgZm9yIHRoZSBnZW5vbWUgc3BlY2llcyBhbmQgZGVzY3JpcHRpb24gaW4gdGhlIHdpbmRvdyB0aXRsZSBhbmQgZm9vdGVyXG4gICAgX3VwZGF0ZUdlbm9tZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICAkZ2Vub21lID0gJChvLmdlbm9tZVBpY2tlclswXSksXG4gICAgICAgICR0aXRsZSA9ICRnZW5vbWUuZmluZCgnLnRpdGxlJyksXG4gICAgICAgIHNwZWNpZXNQYXJlbnRoZXRpY2FsID0gby5zcGVjaWVzLm1hdGNoKC9cXCgoLispXFwpLyksXG4gICAgICAgICRsaSA9ICRnZW5vbWUuZmluZCgnbGkuZGl2aWRlcicpLmVxKDApLnNob3coKTtcbiAgICAgIFxuICAgICAgc2VsZi5fZGVmYXVsdFRpdGxlID0gc2VsZi5fZGVmYXVsdFRpdGxlIHx8IHdpbmRvdy5kb2N1bWVudC50aXRsZTtcbiAgICAgIHdpbmRvdy5kb2N1bWVudC50aXRsZSA9IG8uc3BlY2llcyArICcgLSAnICsgc2VsZi5fZGVmYXVsdFRpdGxlO1xuICAgICAgJHRpdGxlLnRleHQoby5zcGVjaWVzLnJlcGxhY2UoL1xccytcXCguKiQvLCAnJykpLmF0dHIoJ3RpdGxlJywgby5zcGVjaWVzKTtcbiAgICAgIGlmIChzcGVjaWVzUGFyZW50aGV0aWNhbCkgeyAkKCc8ZW0gY2xhc3M9XCJwYXJlbnRoXCIgLz4nKS50ZXh0KCcsICcgKyBzcGVjaWVzUGFyZW50aGV0aWNhbFsxXSkuYXBwZW5kVG8oJHRpdGxlKTsgfVxuICAgICAgJGdlbm9tZS5maW5kKCcuZGVzY3JpcHRpb24nKS50ZXh0KG8uYXNzZW1ibHlEYXRlICsgJyAoJyArIG8uZ2Vub21lLnJlcGxhY2UoL1xcfC4qJC8sICcnKSArICcpJyk7XG4gICAgICBcbiAgICAgIC8vIEZpbGwgdGhlIGdlbm9tZSBwaWNrZXIgd2l0aCBhdmFpbGFibGUgY29uZmlndXJlZCBnZW5vbWVzXG4gICAgICAkZ2Vub21lLmZpbmQoJy5jaG9pY2UuZ2Vub21lLWNob2ljZScpLnJlbW92ZSgpO1xuICAgICAgXy5lYWNoKG8uZ2Vub21lcywgZnVuY3Rpb24odiwgaykge1xuICAgICAgICBpZiAoL15fLy50ZXN0KGspIHx8IGsgPT0gby5nZW5vbWUpIHsgcmV0dXJuOyB9XG4gICAgICAgIHZhciAkYSA9ICQoJzxhIGNsYXNzPVwiY2xpY2thYmxlXCIvPicpLmF0dHIoJ2hyZWYnLCAnLi8/ZGI9JytrKTtcbiAgICAgICAgJGEuYXBwZW5kVG8oJCgnPGxpIGNsYXNzPVwiY2hvaWNlIGdlbm9tZS1jaG9pY2VcIi8+JykuaW5zZXJ0QmVmb3JlKCRsaSkpO1xuICAgICAgICAkKCc8c3BhbiBjbGFzcz1cIm5hbWVcIi8+JykudGV4dCh2LnNwZWNpZXMpLmFwcGVuZFRvKCRhKTtcbiAgICAgICAgJCgnPHNwYW4gY2xhc3M9XCJsb25nLWRlc2NcIi8+JykudGV4dCh2LmFzc2VtYmx5RGF0ZSArICcgKCcgKyBrICsgJyknKS5hcHBlbmRUbygkYSk7XG4gICAgICAgICRhLmhvdmVyKGZ1bmN0aW9uKCkgeyAkKHRoaXMpLmFkZENsYXNzKCdob3ZlcicpOyB9LCBmdW5jdGlvbigpIHsgJCh0aGlzKS5yZW1vdmVDbGFzcygnaG92ZXInKTsgfSk7XG4gICAgICB9KTtcbiAgICAgIGlmICgkZ2Vub21lLmZpbmQoJy5jaG9pY2UuZ2Vub21lLWNob2ljZScpLmxlbmd0aCA9PSAwKSB7ICRsaS5oaWRlKCk7IH1cbiAgICB9XG4gICAgXG4gIH0pO1xuXG59KTtcbiIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gRWFjaCBsaW5lIG9mIHRoZSAkLnVpLmdlbm9icm93c2VyIGlzIG1hbmFnZWQgYnkgYSAkLnVpLmdlbm9saW5lID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigkKSB7XG5cbiQud2lkZ2V0KCd1aS5nZW5vbGluZScsIHtcblxuICAvLyBEZWZhdWx0IG9wdGlvbnMgdGhhdCBjYW4gYmUgb3ZlcnJpZGRlblxuICBvcHRpb25zOiB7XG4gICAgZGlzYWJsZWQ6IGZhbHNlXG4gIH0sXG5cbiAgLy8gQ2FsbGVkIGF1dG9tYXRpY2FsbHkgd2hlbiB3aWRnZXQgaXMgaW5zdGFudGlhdGVkXG4gIF9pbml0OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgJGVsZW0gPSB0aGlzLmVsZW1lbnQsIFxuICAgICAgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgIGh0bWw7XG4gICAgdGhpcy5wb3MgPSBwYXJzZUludChvLm9yaWdpbiwgMTApIHx8IDA7XG4gICAgdGhpcy4kc2lkZSA9ICQoJzxkaXYgY2xhc3M9XCJzaWRlLWNvbnRcIi8+JykuYXBwZW5kVG8oJGVsZW0pO1xuICAgIHRoaXMuJGZpcnN0TGFiZWwgPSAkKCc8ZGl2IGNsYXNzPVwiZmlyc3QtbGFiZWxcIi8+JykuYXBwZW5kVG8oJGVsZW0pO1xuICAgIHRoaXMuJHRyYWNrQ29udCA9ICQoJzxkaXYgY2xhc3M9XCJ0cmFjay1jb250XCIvPicpLmFwcGVuZFRvKCRlbGVtKTtcbiAgICB0aGlzLiRjb250ID0gJCgnPGRpdiBjbGFzcz1cImRyYWctY29udFwiLz4nKS5hcHBlbmRUbyh0aGlzLiR0cmFja0NvbnQpO1xuICAgIHRoaXMuJHJldGljID0gJCgnPGRpdiBjbGFzcz1cInJldGljIGhpZGRlblwiLz4nKS5hcHBlbmRUbygkZWxlbSk7XG4gICAgdGhpcy4kaW5kaWNlcyA9ICQoJzxkaXYgY2xhc3M9XCJpbmRpY2VzXCIvPicpLmFwcGVuZFRvKCRlbGVtKTtcbiAgICB0aGlzLiR6b29tc2hpZWxkID0gJCgnPGRpdiBjbGFzcz1cInpvb20tc2hpZWxkIGhpZGRlblwiLz4nKS5hcHBlbmRUbygkZWxlbSk7XG4gICAgdGhpcy5jZW50ZXJlZE9uID0gbnVsbDsgLy8gZm9yIHRoZSByZXRpY2xlXG4gICAgXG4gICAgaHRtbCA9ICc8ZGl2IGNsYXNzPVwiYyBud1wiLz48ZGl2IGNsYXNzPVwiYyBuZVwiLz48ZGl2IGNsYXNzPVwiYyBzd1wiLz4nXG4gICAgICArICc8ZGl2IGNsYXNzPVwiYyBzZVwiLz48ZGl2IGNsYXNzPVwidiBuXCIvPjxkaXYgY2xhc3M9XCJ2IHNcIi8+PGRpdiBjbGFzcz1cImlubmVyLXJldGljXCI+J1xuICAgICAgKyAnPGRpdiBjbGFzcz1cImMgbndcIi8+PGRpdiBjbGFzcz1cImMgbmVcIi8+PGRpdiBjbGFzcz1cImMgc3dcIi8+PGRpdiBjbGFzcz1cImMgc2VcIi8+PC9kaXY+JztcbiAgICAkKGh0bWwpLmFwcGVuZFRvKHRoaXMuJHJldGljKTtcbiAgICBodG1sID0gJzxkaXYgY2xhc3M9XCJzdGFydFwiPjwvZGl2PjxkaXYgY2xhc3M9XCJlbmRcIj48L2Rpdj4nO1xuICAgICQoaHRtbCkuYXBwZW5kVG8odGhpcy4kaW5kaWNlcyk7XG4gICAgXG4gICAgdGhpcy5faW5pdENvbnREcmFnZ2FibGUoKTtcbiAgICB0aGlzLl9pbml0U2lkZVNvcnRhYmxlKCk7XG4gICAgdGhpcy4kdHJhY2tDb250LmJpbmQoJ2RibGNsaWNrJywge3NlbGY6IHRoaXN9LCB0aGlzLl9yZWN2RG91YmxlQ2xpY2spO1xuICAgICRlbGVtLmFkZENsYXNzKCdzaGFkb3cnKTtcbiAgICB0aGlzLmZpeFRyYWNrcygpO1xuICAgIHRoaXMuanVtcFRvKHRoaXMucG9zKTtcbiAgfSxcbiAgXG4gIF9pbml0Q29udERyYWdnYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLCAkZWxlbSA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucywgXG4gICAgICBkcmFnRXZlbnRzID0gW10sXG4gICAgICBpbml0S2V5ZWRPZmZzZXQgPSAwLFxuICAgICAgc25hcHBpbmdUb0FuaW1hdGlvbiA9IHt9LFxuICAgICAgZnVkZ2UsXG4gICAgICBsaW5lSnVtcCxcbiAgICAgIHRvcE9mZnNldHMsXG4gICAgICBzbmFwcGluZ1RvLFxuICAgICAgc25hcHBpbmdUb0ludGVydmFsO1xuICAgIGZ1bmN0aW9uIHNuYXBwaW5nVG9Nb3Rpb24oKSB7XG4gICAgICB2YXIgZHQgPSAobmV3IERhdGUpLmdldFRpbWUoKSAtIHNuYXBwaW5nVG9BbmltYXRpb24uc3RhcnQsXG4gICAgICAgIHByb3BvcnRpb24gPSBNYXRoLm1pbihkdCAvIG8ubGluZUZpeER1cmF0aW9uLCAxKTtcbiAgICAgIHNuYXBwaW5nVG8gPSAoMSAtIE1hdGgucG93KDEgLSBwcm9wb3J0aW9uLCA0KSkgKiAoc25hcHBpbmdUb0FuaW1hdGlvbi50byAtIHNuYXBwaW5nVG9BbmltYXRpb24uZnJvbSkgKyBzbmFwcGluZ1RvQW5pbWF0aW9uLmZyb207XG4gICAgICB1cGRhdGVMaW5lVG9wKCk7XG4gICAgICBpZiAocHJvcG9ydGlvbiA9PSAxKSB7IGNsZWFySW50ZXJ2YWwoc25hcHBpbmdUb0ludGVydmFsKTsgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBhbmltYXRlU25hcCgpIHtcbiAgICAgIHNuYXBwaW5nVG9BbmltYXRpb24gPSB7ZnJvbTogc25hcHBpbmdUbywgdG86ICRlbGVtLmRhdGEoJ25hdHVyYWxUb3AnKSwgc3RhcnQ6IChuZXcgRGF0ZSkuZ2V0VGltZSgpfTtcbiAgICAgIGNsZWFySW50ZXJ2YWwoc25hcHBpbmdUb0ludGVydmFsKTtcbiAgICAgIHNuYXBwaW5nVG9JbnRlcnZhbCA9IHNldEludGVydmFsKHNuYXBwaW5nVG9Nb3Rpb24sIDEzKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdXBkYXRlTGluZVRvcCh0b3ApIHtcbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh0b3ApKSB7IHNuYXBwaW5nVG9BbmltYXRpb24udG9wID0gdG9wOyB9XG4gICAgICB2YXIgc25hcE9mZnNldCA9IChzbmFwcGluZ1RvQW5pbWF0aW9uLnRvcCAtIHRvcE9mZnNldHMudG9wIC0gdG9wT2Zmc2V0cy5jbGljayAtIHNuYXBwaW5nVG8pLFxuICAgICAgICBkZWFkWm9uZSA9IG8udmVydGljYWxEcmFnRGVhZFpvbmUgLyAyLFxuICAgICAgICBzbmFwT2Zmc2V0U3F1YXNoZWQgPSBNYXRoLmFicyhzbmFwT2Zmc2V0KSA+IGRlYWRab25lID8gc25hcE9mZnNldCArIChzbmFwT2Zmc2V0ID4gMCA/IC1kZWFkWm9uZSA6IGRlYWRab25lKSA6IDAsXG4gICAgICAvLyBGaXJzdCBhcHBseSBhIGZsYXQgZGVhZCB6b25lIGFyb3VuZCB0aGUgemVybyBwb2ludFxuICAgICAgICBjdXJ2ZWQgPSA0MCAvICgxICsgTWF0aC5leHAoMC4xICogc25hcE9mZnNldFNxdWFzaGVkKSkgLSAyMCArIHNuYXBPZmZzZXRTcXVhc2hlZDtcbiAgICAgIC8vIFRoZW4gdXNlIGEgbG9naXN0aWMgZnVuY3Rpb24gdHJhbnNmb3JtZWQgdG8gYXN5bXB0b3RpY2FsbHkgYXBwcm9hY2ggYSBzbG9wZSBvZiAxXG4gICAgICBpZiAodG9wT2Zmc2V0cy5sZW5ndGggPiAxKSB7ICRlbGVtLmNzcygndG9wJywgc25hcHBpbmdUbyArIGN1cnZlZCk7IH1cbiAgICB9XG4gICAgZnVuY3Rpb24gdXBkYXRlUG9zKGxlZnQsIHRvcCkge1xuICAgICAgdmFyIG5ld0p1bXAgPSBsaW5lSnVtcCwgXG4gICAgICAgIHpvb20gPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3pvb20nKTtcbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh0b3ApKSB7XG4gICAgICAgIF8uZWFjaCh0b3BPZmZzZXRzLCBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgaWYgKG5ld0p1bXAgPT0gbGluZUp1bXAgJiYgdlsxXSA+IGxpbmVKdW1wICYmIHRvcCA8IHZbMF0gKyBmdWRnZSkgeyBuZXdKdW1wID0gdlsxXTsgfVxuICAgICAgICAgIGlmICh2WzFdIDwgbGluZUp1bXAgJiYgdG9wID4gdlswXSAtIGZ1ZGdlKSB7IG5ld0p1bXAgPSB2WzFdOyB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAobmV3SnVtcCAhPSBsaW5lSnVtcCkge1xuICAgICAgICAgIG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignc2hpZnRMaW5lcycsIG5ld0p1bXAgLSBsaW5lSnVtcCwgJGVsZW0uZ2V0KDApKTtcbiAgICAgICAgICBhbmltYXRlU25hcCgpO1xuICAgICAgICAgIHNlbGYuZml4VHJhY2tUaWxlcygpOyBcbiAgICAgICAgICBsaW5lSnVtcCA9IG5ld0p1bXA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHNlbGYucG9zID0gby5vcmlnaW4gLSBsZWZ0ICogem9vbTtcbiAgICAgIHVwZGF0ZUxpbmVUb3AodG9wKTtcbiAgICAgIHNlbGYuZml4Rmlyc3RMYWJlbCgpO1xuICAgICAgc2VsZi5maXhJbmRpY2VzKCk7XG4gICAgICBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3JlY3ZEcmFnJywgJGVsZW0sIHNlbGYucG9zKTtcbiAgICB9O1xuICAgIFxuICAgIHNlbGYuJGNvbnQubW91c2Vkb3duKGZ1bmN0aW9uKCkge1xuICAgICAgby5icm93c2VyLmZpbmQoJy5kcmFnLWNvbnQnKS5zdG9wKCk7IC8vIFN0b3AgYW55IGN1cnJlbnQgaW5lcnRpYWwgc2Nyb2xsaW5nIGltbWVkaWF0ZWx5IG9uIG1vdXNlZG93blxuICAgIH0pXG4gICAgc2VsZi4kY29udC5kcmFnZ2FibGUoe1xuICAgICAgYXhpczogJ3gnLFxuICAgICAgY3Vyc29yOiAnJyxcbiAgICAgIGNhbmNlbDogJy5udHMsOmlucHV0LG9wdGlvbicsXG4gICAgICBzdGFydDogZnVuY3Rpb24oZSkgeyBcbiAgICAgICAgdmFyIHdpZHRoID0gby5icm93c2VyLmdlbm9icm93c2VyKCdsaW5lV2lkdGgnKSxcbiAgICAgICAgICAkbGluZXMgPSAgby5icm93c2VyLmdlbm9icm93c2VyKCdsaW5lcycpLnJlbW92ZUNsYXNzKCdsYXN0LXJlc2l6ZWQnKSxcbiAgICAgICAgICBsaW5lSW5kZXggPSAkbGluZXMuaW5kZXgoJGVsZW0uZ2V0KDApKTtcbiAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdkcmFnZ2luZycpO1xuICAgICAgICAkZWxlbS5hZGRDbGFzcygnbGFzdC1yZXNpemVkJyk7XG4gICAgICAgIGxpbmVKdW1wID0gMDtcbiAgICAgICAgdG9wT2Zmc2V0cyA9IFtdO1xuICAgICAgICBmdWRnZSA9IChzZWxmLmxpbmVIZWlnaHQoKSArIG8uYmV0d2VlbkxpbmVzKSAqIDAuMztcbiAgICAgICAgc25hcHBpbmdUbyA9ICRlbGVtLmRhdGEoJ25hdHVyYWxUb3AnKTtcbiAgICAgICAgc25hcHBpbmdUb0FuaW1hdGlvbiA9IHt9O1xuICAgICAgICB0b3BPZmZzZXRzLmNsaWNrID0gZS5vcmlnaW5hbEV2ZW50LnBhZ2VZIC0gJGVsZW0ub2Zmc2V0KCkudG9wO1xuICAgICAgICBfLmVhY2goJGxpbmVzLCBmdW5jdGlvbih2LCBpKSB7XG4gICAgICAgICAgdmFyIHRvcCA9ICQodikub2Zmc2V0KCkudG9wO1xuICAgICAgICAgIGlmIChpID09IDApIHsgdG9wT2Zmc2V0cy50b3AgPSB0b3A7IH1cbiAgICAgICAgICB0b3BPZmZzZXRzLnB1c2goW3RvcCArIHRvcE9mZnNldHMuY2xpY2ssIGxpbmVJbmRleCAtIGldKTsgXG4gICAgICAgIH0pO1xuICAgICAgICBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3Nob3dSZXRpY2xlJywgJ2RyYWdnaW5nJywgdHJ1ZSk7XG4gICAgICAgICQudGlwVGlwLmhpZGUoKTtcbiAgICAgIH0sXG4gICAgICBkcmFnOiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICB2YXIgb2UgPSBlLm9yaWdpbmFsRXZlbnQsIG5vdyA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpO1xuICAgICAgICB1cGRhdGVQb3ModWkucG9zaXRpb24ubGVmdCwgb2UucGFnZVkpO1xuICAgICAgICBkcmFnRXZlbnRzLnB1c2goe3Q6IG5vdywgeDogb2UucGFnZVh9KTtcbiAgICAgICAgd2hpbGUgKGRyYWdFdmVudHNbMF0udCA8IG5vdyAtIDI1MCkgeyBkcmFnRXZlbnRzLnNoaWZ0KCk7IH1cbiAgICAgIH0sXG4gICAgICBzdG9wOiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICB2YXIgeCA9IGUub3JpZ2luYWxFdmVudC5wYWdlWCwgXG4gICAgICAgICAgbm93ID0gKG5ldyBEYXRlKS5nZXRUaW1lKCksXG4gICAgICAgICAgLy8gdGhlIHNlY29uZCB0byBsYXN0IGRyYWdFdmVudCBzZWVtcyB0byBiZSB0aGUgbW9zdCBpbmZvcm1hdGl2ZSBmb3IgdmVsb2NpdHkuXG4gICAgICAgICAgZHJhZ0V2ZW50ID0gZHJhZ0V2ZW50cy5zbGljZSgtMiwtMSkucG9wKCksIFxuICAgICAgICAgIGR0ID0gZHJhZ0V2ZW50ICYmIChub3cgLSBkcmFnRXZlbnQudCksXG4gICAgICAgICAgdkluaXQgPSBkcmFnRXZlbnQgJiYgKHggLSBkcmFnRXZlbnQueCkgLyBkdCxcbiAgICAgICAgICBwZXJmZWN0UGFnZVkgPSAoXy5pc1VuZGVmaW5lZChzbmFwcGluZ1RvQW5pbWF0aW9uLnRvKSA/ICRlbGVtLmRhdGEoJ25hdHVyYWxUb3AnKSA6IHNuYXBwaW5nVG9BbmltYXRpb24udG8pIFxuICAgICAgICAgICAgKyB0b3BPZmZzZXRzLnRvcCArIHRvcE9mZnNldHMuY2xpY2s7XG4gICAgICAgIHNlbGYuZml4VHJhY2tUaWxlcygpO1xuICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ2RyYWdnaW5nJyk7XG4gICAgICAgIHVwZGF0ZUxpbmVUb3AocGVyZmVjdFBhZ2VZKTtcbiAgICAgICAgaW5pdEtleWVkT2Zmc2V0ID0gby5icm93c2VyLmdlbm9icm93c2VyKCdrZXllZE9mZnNldCcpO1xuICAgICAgICBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3Nob3dSZXRpY2xlJywgJ2RyYWdnaW5nJywgZmFsc2UpO1xuICAgICAgICBpZiAoTWF0aC5hYnModkluaXQpID4gMC4xKSB7XG4gICAgICAgICAgdmFyIHhJbml0ID0gdWkucG9zaXRpb24ubGVmdCwgZGVjZWwgPSB2SW5pdCA+IDAgPyAwLjAwMSA6IC0wLjAwMSwgbGFzdFJlZnJlc2ggPSAwOyAgICAgICAgICAgIFxuICAgICAgICAgIHNlbGYuJGNvbnQuY3NzKCd0ZXh0LWluZGVudCcsIDEpO1xuICAgICAgICAgIHNlbGYuJGNvbnQuYW5pbWF0ZSh7dGV4dEluZGVudDogMH0sIHtcbiAgICAgICAgICAgIHF1ZXVlOiBmYWxzZSxcbiAgICAgICAgICAgIGR1cmF0aW9uOiBNYXRoLmFicyh2SW5pdCAvIGRlY2VsKSxcbiAgICAgICAgICAgIHN0ZXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICB2YXIgbmV3VGltZSA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpLFxuICAgICAgICAgICAgICAgIGRlbHRhVCA9IG5ld1RpbWUgLSBub3csXG4gICAgICAgICAgICAgICAgLy8gYWxsb3cgdGhlIGtleWJvYXJkIHRvIHNoaWZ0IHRoZSBwb3NpdGlvbiAqZHVyaW5nKiBpbmVydGlhbCBzY3JvbGxzXG4gICAgICAgICAgICAgICAga2V5ZWRPZmZzZXQgPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2tleWVkT2Zmc2V0JyksXG4gICAgICAgICAgICAgICAgZGVsdGFMID0gKHZJbml0KmRlbHRhVCkgLSAoMC41KmRlY2VsKmRlbHRhVCpkZWx0YVQpICsgaW5pdEtleWVkT2Zmc2V0IC0ga2V5ZWRPZmZzZXQ7XG4gICAgICAgICAgICAgICAgbGVmdCA9IHhJbml0ICsgZGVsdGFMO1xuICAgICAgICAgICAgICAvLyBzdG9yZSB0aGUgdmVsb2NpdHkgb24gdGhlIGJyb3dzZXIgZWxlbWVudCBzbyBpdCBjYW4gY2F0Y2ggdGhlIHRocm93IGlmIGEgYm91bmNlIGlzIG5lZWRlZFxuICAgICAgICAgICAgICBvLmJyb3dzZXIuZGF0YSgndmVsb2NpdHknLCB2SW5pdCAtIGRlY2VsICogZGVsdGFUKTtcbiAgICAgICAgICAgICAgLy8gZm9yIHRob3NlIGxvb29uZyBpbmVydGlhbCBzY3JvbGxzLCBrZWVwIHRoZSB0aWxlcyBjb21pbmdcbiAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRlbHRhTCAtIGxhc3RSZWZyZXNoKSA+IDEwMDApIHsgbGFzdFJlZnJlc2ggPSBkZWx0YUw7IHNlbGYuZml4VHJhY2tUaWxlcygpOyB9XG4gICAgICAgICAgICAgIHNlbGYuJGNvbnQuY3NzKCdsZWZ0JywgbGVmdCk7XG4gICAgICAgICAgICAgIHVwZGF0ZVBvcyhsZWZ0KTtcbiAgICAgICAgICAgICAgby5icm93c2VyLmdlbm9icm93c2VyKCdib3VuY2VDaGVjaycpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpIHsgXG4gICAgICAgICAgICAgIHNlbGYuZml4VHJhY2tUaWxlcygpOyBcbiAgICAgICAgICAgICAgby5icm93c2VyLmRhdGEoJ3ZlbG9jaXR5JywgMCk7XG4gICAgICAgICAgICAgIG8uYnJvd3Nlci5nZW5vYnJvd3NlcignYm91bmNlQ2hlY2snKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWxmLmZpeFRyYWNrVGlsZXMoKTtcbiAgICAgICAgICBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2JvdW5jZUNoZWNrJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgXG4gIF9pbml0U2lkZVNvcnRhYmxlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQ7XG4gICAgdGhpcy4kc2lkZS5zb3J0YWJsZSh7XG4gICAgICBheGlzOiAneScsXG4gICAgICBwbGFjZWhvbGRlcjogJ3NpZGUgcGxhY2Vob2xkZXIgaW5zZXQtc2hhZG93JyxcbiAgICAgIGZvcmNlUGxhY2Vob2xkZXJTaXplOiB0cnVlLFxuICAgICAgYXBwZW5kVG86ICcjJyArIG8uYnJvd3Nlci5hdHRyKCdpZCcpLFxuICAgICAgaGFuZGxlOiAnLnN1YnRyYWNrLWNvbnQnLFxuICAgICAgaGVscGVyOiAnY2xvbmUnLFxuICAgICAgc3RhcnQ6IGZ1bmN0aW9uKCkgeyBcbiAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdkcmFnZ2luZycpO1xuICAgICAgICBzZWxmLiRjb250LmNoaWxkcmVuKCcuYnJvd3Nlci10cmFjaycpLmVhY2goZnVuY3Rpb24oaSkgeyAkKHRoaXMpLmRhdGEoJ29sZEluZGV4JywgaSk7IH0pO1xuICAgICAgfSxcbiAgICAgIHN0b3A6IGZ1bmN0aW9uKCkgeyAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ2RyYWdnaW5nJyk7IH0sXG4gICAgICBjaGFuZ2U6IGZ1bmN0aW9uKGUsIHVpKSB7XG4gICAgICAgIHNlbGYuJGNvbnQuY2hpbGRyZW4oJy5icm93c2VyLXRyYWNrJykuc29ydEVsZW1lbnRzKGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICBhID0gJChhKS5nZW5vdHJhY2soJ3NpZGUnKTtcbiAgICAgICAgICBhID0gc2VsZi4kc2lkZS5jaGlsZHJlbignLnNpZGUnKS5pbmRleChhLmlzKHVpLml0ZW0pID8gdWkucGxhY2Vob2xkZXIgOiBhKTtcbiAgICAgICAgICBiID0gJChiKS5nZW5vdHJhY2soJ3NpZGUnKTtcbiAgICAgICAgICBiID0gc2VsZi4kc2lkZS5jaGlsZHJlbignLnNpZGUnKS5pbmRleChiLmlzKHVpLml0ZW0pID8gdWkucGxhY2Vob2xkZXIgOiBiKTtcbiAgICAgICAgICByZXR1cm4gYSAtIGI7XG4gICAgICAgIH0pO1xuICAgICAgICBzZWxmLmZpeEZpcnN0TGFiZWwodHJ1ZSk7XG4gICAgICB9LFxuICAgICAgdXBkYXRlOiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICB2YXIgbmV3T3JkZXIgPSBbXTtcbiAgICAgICAgc2VsZi4kY29udC5jaGlsZHJlbignLmJyb3dzZXItdHJhY2snKS5lYWNoKGZ1bmN0aW9uKGkpIHsgbmV3T3JkZXJbJCh0aGlzKS5kYXRhKCdvbGRJbmRleCcpXSA9IGk7IH0pO1xuICAgICAgICBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3JlY3ZTb3J0JywgJGVsZW0sIG5ld09yZGVyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgXG4gIGZpeFRyYWNrczogZnVuY3Rpb24oKSB7XG4gICAgdmFyICRlbGVtID0gdGhpcy5lbGVtZW50LCBcbiAgICAgIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICAkdCA9IHRoaXMuJGNvbnQuY2hpbGRyZW4oJy5icm93c2VyLXRyYWNrJykuZmlyc3QoKSxcbiAgICAgIHRyYWNrcyA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcigndHJhY2tzJyksXG4gICAgICAkdTtcbiAgICBpZiAoISR0Lmxlbmd0aCkgeyAkdCA9IHRoaXMuX2FkZFRyYWNrKHRyYWNrc1swXSwgMCk7IH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyYWNrcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHRyYWNrID0gdHJhY2tzW2ldO1xuICAgICAgaWYgKCR0Lmhhc0NsYXNzKCdicm93c2VyLXRyYWNrLScgKyB0cmFjay5uKSkgeyAkdCA9ICR0Lm5leHQoKTsgfVxuICAgICAgZWxzZSB7IHRoaXMuX2FkZFRyYWNrKHRyYWNrLCAkdCk7IH1cbiAgICB9XG4gICAgZG8geyAkdSA9ICR0OyAkdCA9ICR0Lm5leHQoKTsgJHUuZ2Vub3RyYWNrKCdzaWRlJykucmVtb3ZlKCk7ICR1LnJlbW92ZSgpOyB9IHdoaWxlICgkdC5sZW5ndGgpO1xuICAgIHRoaXMuJHNpZGUuc29ydGFibGUoJ3JlZnJlc2gnKTtcbiAgICB0aGlzLmZpeEZpcnN0TGFiZWwodHJ1ZSk7XG4gIH0sXG4gIFxuICBqdW1wVG86IGZ1bmN0aW9uKHBvcywgZm9yY2VSZXBvcykge1xuICAgIHZhciBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgem9vbSA9IG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignem9vbScpLFxuICAgICAgbGVmdCA9IChvLm9yaWdpbiAtIHBvcykgLyB6b29tO1xuICAgIC8vIE1vemlsbGEgZ2V0cyBhZ2dyYXZhdGVkIGJ5IENTUyBsZW5ndGhzIG91dHNpZGUgb2YgwrExLjBlNzsgT3BlcmEgZ2V0cyBhZ2dyYXZhdGVkIHNvbWV3aGVyZSBvdXRzaWRlIG9mIMKxMS4wZTZcbiAgICBpZiAobGVmdCA+IDEuMGUrNiB8fCBsZWZ0IDwgLTEuMGUrNikgeyBvLm9yaWdpbiA9IHBvczsgbGVmdCA9IDA7IGZvcmNlUmVwb3MgPSB0cnVlOyB9XG4gICAgdGhpcy5wb3MgPSBwb3M7XG4gICAgdGhpcy4kY29udC5jc3MoJ2xlZnQnLCBsZWZ0KTtcbiAgICB0aGlzLmZpeFRyYWNrVGlsZXMoZm9yY2VSZXBvcyk7XG4gICAgdGhpcy5maXhGaXJzdExhYmVsKCk7XG4gICAgdGhpcy5maXhJbmRpY2VzKCk7XG4gIH0sXG4gIFxuICBmaXhUcmFja1RpbGVzOiBmdW5jdGlvbihmb3JjZVJlcG9zKSB7XG4gICAgdGhpcy4kY29udC5jaGlsZHJlbignLmJyb3dzZXItdHJhY2snKS5nZW5vdHJhY2soJ2ZpeFRpbGVzJywgZm9yY2VSZXBvcyk7XG4gIH0sXG4gIFxuICBnZXRQb3M6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnBvcztcbiAgfSxcbiAgXG4gIF9hZGRUcmFjazogZnVuY3Rpb24odHJhY2ssIHBvcykge1xuICAgIHZhciAkZWxlbSA9IHRoaXMuZWxlbWVudCxcbiAgICAgICR0cmsgPSAkKCc8ZGl2IGNsYXNzPVwiYnJvd3Nlci10cmFja1wiPjwvZGl2PicpO1xuICAgIGlmICghcG9zIHx8ICFwb3MubGVuZ3RoKSB7ICR0cmtbcG9zID09PSAwID8gJ3ByZXBlbmRUbycgOiAnYXBwZW5kVG8nXSh0aGlzLiRjb250KTsgfVxuICAgIGVsc2UgeyBcbiAgICAgIGlmIChfLmlzTnVtYmVyKHBvcykpIHsgcG9zID0gdGhpcy4kY29udC5jaGlsZHJlbignLmJyb3dzZXItdHJhY2snKS5lcShwb3MpOyB9XG4gICAgICAkdHJrLmluc2VydEJlZm9yZShwb3MpOyBcbiAgICB9XG4gICAgcG9zID0gdGhpcy4kY29udC5jaGlsZHJlbignLmJyb3dzZXItdHJhY2snKS5pbmRleCgkdHJrLmdldCgwKSk7XG4gICAgdmFyICRzaWRlID0gJCgnPGRpdiBjbGFzcz1cInNpZGVcIi8+JyksICRzaWRlcyA9IHRoaXMuJHNpZGUuY2hpbGRyZW4oJy5zaWRlJyk7XG4gICAgaWYgKHBvcyAmJiAkc2lkZXMubGVuZ3RoKSB7ICRzaWRlLmluc2VydEFmdGVyKCRzaWRlcy5lcShwb3MgLSAxKSk7IH1cbiAgICBlbHNlIHsgJHNpZGUucHJlcGVuZFRvKHRoaXMuJHNpZGUpOyB9XG4gICAgcmV0dXJuICR0cmsuZ2Vub3RyYWNrKCQuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMsIHt0cmFjazogdHJhY2ssIGxpbmU6ICRlbGVtLCBzaWRlOiAkc2lkZX0pKTtcbiAgfSxcbiAgXG4gIF9saW5lSGVpZ2h0OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0aW9ucywgdHJhY2tzID0gby5icm93c2VyLmdlbm9icm93c2VyKCd0cmFja3MnKTtcbiAgICByZXR1cm4gXy5yZWR1Y2UodHJhY2tzLCBmdW5jdGlvbih0LCB1KSB7IHJldHVybiB7aDp0LmggKyB1Lmh9OyB9KS5oO1xuICB9LFxuICBcbiAgbGluZUhlaWdodDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xpbmVIZWlnaHQoKTtcbiAgfSxcbiAgXG4gIGZpeEZpcnN0TGFiZWw6IGZ1bmN0aW9uKG5vSG9yaXpNb3Rpb24pIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsICRlbGVtID0gc2VsZi5lbGVtZW50LCBvID0gc2VsZi5vcHRpb25zO1xuICAgIGlmICghc2VsZi4kZmlyc3RMYWJlbCkgeyByZXR1cm47IH1cbiAgICBpZiAoJGVsZW0uZ2V0KDApICE9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignbGluZXMnKS5nZXQoMCkpIHsgXG4gICAgICBzZWxmLiRmaXJzdExhYmVsLmFkZENsYXNzKCdvY2NsdWRlZCcpO1xuICAgICAgJGVsZW0uZmluZCgnLmJyb3dzZXItdHJhY2stcnVsZXIgLmxhYmVsJykucmVtb3ZlQ2xhc3MoJ29jY2x1ZGVkJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChub0hvcml6TW90aW9uID09PSB0cnVlKSB7XG4gICAgICB2YXIgJHJ1bGVyID0gJGVsZW0uZmluZCgnLmJyb3dzZXItdHJhY2stcnVsZXInKTtcbiAgICAgIGlmICghJHJ1bGVyLmxlbmd0aCkgeyB0aGlzLiRmaXJzdExhYmVsLmFkZENsYXNzKCduby1ydWxlcicpOyB9XG4gICAgICBlbHNlIHsgdGhpcy4kZmlyc3RMYWJlbC5yZW1vdmVDbGFzcygnbm8tcnVsZXInKS5jc3MoJ3RvcCcsICRydWxlci5wb3NpdGlvbigpLnRvcCk7IH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gSG9yaXpvbnRhbCBtb3Rpb24gbWVhbnMgd2UgbWF5IGhhdmUgdG8gZml4IHRoZSBjb250ZW50IGFuZCBvY2NsdXNpb24gb2YgdGhlIGxhYmVsLlxuICAgIHZhciBsYWJlbCA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignY2hyQXQnLCBzZWxmLnBvcyksIG9mZnNldExlZnQsIHdpZHRoO1xuICAgICRlbGVtLmZpbmQoJy5icm93c2VyLXRyYWNrLXJ1bGVyIC5sYWJlbCcpLnJlbW92ZUNsYXNzKCdvY2NsdWRlZCcpO1xuICAgIGlmIChsYWJlbD09PW51bGwpIHsgc2VsZi4kZmlyc3RMYWJlbC5hZGRDbGFzcygnb2NjbHVkZWQnKTsgcmV0dXJuOyB9IC8vIFdlIGFyZSBiZWhpbmQgY2hyMS5cbiAgICBzZWxmLiRmaXJzdExhYmVsLnRleHQobGFiZWwubikucmVtb3ZlQ2xhc3MoJ29jY2x1ZGVkJyk7XG4gICAgb2Zmc2V0TGVmdCA9IHNlbGYuJGZpcnN0TGFiZWwub2Zmc2V0KCkubGVmdDtcbiAgICB3aWR0aCA9IHNlbGYuJGZpcnN0TGFiZWwud2lkdGgoKTtcbiAgICAkZWxlbS5maW5kKCcuYnJvd3Nlci10cmFjay1ydWxlciAubGFiZWwnKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHRoaXNMZWZ0ID0gJCh0aGlzKS5vZmZzZXQoKS5sZWZ0LCB0aGlzV2lkdGggPSAkKHRoaXMpLndpZHRoKCk7XG4gICAgICBpZiAodGhpc0xlZnQgKyB0aGlzV2lkdGggPiBvZmZzZXRMZWZ0ICYmIHRoaXNMZWZ0IDwgb2Zmc2V0TGVmdCArIHdpZHRoKSB7IFxuICAgICAgICBzZWxmLiRmaXJzdExhYmVsLmFkZENsYXNzKCdvY2NsdWRlZCcpO1xuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdvY2NsdWRlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICBcbiAgZml4SW5kaWNlczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICBwb3MgPSB0aGlzLnBvcyxcbiAgICAgIGJwV2lkdGggPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2JwV2lkdGgnKSxcbiAgICAgIHpvb20gPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3pvb20nKSxcbiAgICAgIGVsZW0gPSB0aGlzLmVsZW1lbnQuZ2V0KDApLFxuICAgICAgbXVsdGlwbGVMaW5lcyA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignbGluZXMnKS5sZW5ndGggPiAxLFxuICAgICAgcmV0aWNQb3MgPSB0aGlzLmNlbnRlcmVkT24gPT09IG51bGwgPyB0aGlzLnBvcyArIDAuNSAqIChicFdpZHRoIC0gby5zaWRlQmFyV2lkdGggKiB6b29tKSA6IHRoaXMuY2VudGVyZWRPbixcbiAgICAgIGNoclN0YXJ0LCBjaHJFbmQsIGNoclJldGljO1xuICAgICAgXG4gICAgaWYgKGVsZW0gPT0gby5icm93c2VyLmdlbm9icm93c2VyKCdsaW5lcycpLmdldCgwKSkge1xuICAgICAgY2hyU3RhcnQgPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2NockF0JywgcG9zKSB8fCBvLmNockxhYmVsc1swXTtcbiAgICAgIHRoaXMuJGluZGljZXMuY2hpbGRyZW4oJy5zdGFydCcpLnRleHQoKG11bHRpcGxlTGluZXMgPyBjaHJTdGFydC5uICsgJzonIDogJycpICsgTWF0aC5mbG9vcihwb3MgLSBjaHJTdGFydC5wKSk7XG4gICAgfSBlbHNlIHsgdGhpcy4kaW5kaWNlcy5jaGlsZHJlbignLnN0YXJ0JykuZW1wdHkoKTsgfVxuICAgIFxuICAgIGlmIChlbGVtID09IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignbGluZXMnKS5sYXN0KCkuZ2V0KDApKSB7XG4gICAgICBjaHJFbmQgPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2NockF0JywgcG9zICsgYnBXaWR0aCkgfHwgby5jaHJMYWJlbHNbMF07XG4gICAgICB0aGlzLiRpbmRpY2VzLmNoaWxkcmVuKCcuZW5kJykudGV4dCgobXVsdGlwbGVMaW5lcyA/IGNockVuZC5uICsgJzonIDogJycpICsgTWF0aC5jZWlsKHBvcyArIGJwV2lkdGggLSBjaHJFbmQucCkpO1xuICAgIH0gZWxzZSB7IHRoaXMuJGluZGljZXMuY2hpbGRyZW4oJy5lbmQnKS5lbXB0eSgpOyB9XG4gICAgXG4gICAgY2hyUmV0aWMgPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2NockF0JywgcmV0aWNQb3MpIHx8IG8uY2hyTGFiZWxzWzBdO1xuICAgIHRoaXMuJHJldGljLmNoaWxkcmVuKCcubicpLnRleHQoKG11bHRpcGxlTGluZXMgPyBjaHJSZXRpYy5uICsgJzonIDogJycpICsgTWF0aC5mbG9vcihyZXRpY1BvcyAtIGNoclJldGljLnApKTtcbiAgfSxcbiAgXG4gIHNldFJldGljbGU6IGZ1bmN0aW9uKG5leHRab29tcywgY2VudGVyZWRPbikge1xuICAgIHZhciBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgem9vbSA9IG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignem9vbScpLFxuICAgICAgbGluZVdpZHRoID0gby5icm93c2VyLmdlbm9icm93c2VyKCdsaW5lV2lkdGgnKSxcbiAgICAgIGJwV2lkdGggPSBsaW5lV2lkdGggKiB6b29tLFxuICAgICAgd2lkdGgxID0gbmV4dFpvb21zWzBdIC8gem9vbSAqIGxpbmVXaWR0aCxcbiAgICAgICRpbm5lclJldGljID0gdGhpcy4kcmV0aWMuY2hpbGRyZW4oJy5pbm5lci1yZXRpYycpLFxuICAgICAgb3BhY2l0eSA9IG5leHRab29tc1sxXSA/IE1hdGgubWluKDIgLSAyICogd2lkdGgxIC8gbGluZVdpZHRoLCAxKSA6IDEsXG4gICAgICBub0NlbnRlcmVkT24gPSBfLmlzVW5kZWZpbmVkKGNlbnRlcmVkT24pIHx8IGNlbnRlcmVkT24gPT09IG51bGwsXG4gICAgICBsZWZ0ID0gbm9DZW50ZXJlZE9uID8gJzUwJScgOiAoY2VudGVyZWRPbiAtIHRoaXMucG9zKSAvIHpvb20gKyBvLnNpZGVCYXJXaWR0aDtcbiAgICB0aGlzLiRyZXRpYy5jc3MoJ3dpZHRoJywgd2lkdGgxKS5jc3MoJ21hcmdpbi1sZWZ0JywgLXdpZHRoMSAqIDAuNSk7XG4gICAgdGhpcy4kcmV0aWMuY2hpbGRyZW4oJy5jJykuY3NzKCdvcGFjaXR5Jywgb3BhY2l0eSk7XG4gICAgaWYgKG5leHRab29tc1sxXSkge1xuICAgICAgdmFyIHdpZHRoMiA9IG5leHRab29tc1sxXSAvIHpvb20gKiBsaW5lV2lkdGg7XG4gICAgICAkaW5uZXJSZXRpYy5zaG93KCkuY3NzKCd3aWR0aCcsIHdpZHRoMikuY3NzKCdtYXJnaW4tbGVmdCcsIC13aWR0aDIgKiAwLjUpO1xuICAgICAgJGlubmVyUmV0aWMuY3NzKCdvcGFjaXR5JywgMSAtIG9wYWNpdHkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkaW5uZXJSZXRpYy5oaWRlKCk7XG4gICAgfVxuICAgIHRoaXMuJHJldGljLmNzcygnbGVmdCcsIGxlZnQpO1xuICAgIHRoaXMuY2VudGVyZWRPbiA9IG5vQ2VudGVyZWRPbiA/IG51bGwgOiBjZW50ZXJlZE9uO1xuICB9LFxuICBcbiAgX3JlY3ZEb3VibGVDbGljazogZnVuY3Rpb24oZSkge1xuICAgIHZhciBzZWxmID0gZS5kYXRhLnNlbGYsXG4gICAgICAkYnJvd3NlciA9IHNlbGYub3B0aW9ucy5icm93c2VyLFxuICAgICAgem9vbSA9ICRicm93c2VyLmdlbm9icm93c2VyKCd6b29tJyksXG4gICAgICBvZmZzZXQgPSAkKHNlbGYuJHRyYWNrQ29udCkub2Zmc2V0KCksXG4gICAgICBvZmZzZXRMZWZ0ID0gKGUucGFnZVggKyA4KSAtIG9mZnNldC5sZWZ0OyAvLyBjb21wZW5zYXRpbmcgZm9yIHRoZSBjZW50ZXIgb2YgdGhlIGN1cnNvcj9cbiAgICAkYnJvd3Nlci5nZW5vYnJvd3Nlcignem9vbScsICFlLnNoaWZ0S2V5LCBzZWxmLnBvcyArIChvZmZzZXRMZWZ0ICogem9vbSksIDEwMDApO1xuICB9LFxuICBcbiAgdG9nZ2xlWm9vbVNoaWVsZDogZnVuY3Rpb24oc2hvdykge1xuICAgIHRoaXMuJHpvb21zaGllbGQudG9nZ2xlQ2xhc3MoJ2hpZGRlbicsICFzaG93KTtcbiAgfVxuICBcbn0pO1xuXG59OyIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9IEVhY2ggdHJhY2sgd2l0aGluIGEgJC51aS5nZW5vbGluZSBpcyBtYW5hZ2VkIGJ5IGEgJC51aS5nZW5vdHJhY2sgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigkKSB7XG5cbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMuanMnKSgkKSxcbiAgcGFkID0gdXRpbHMucGFkLFxuICBjbGFzc0ZyaWVuZGx5ID0gdXRpbHMuY2xhc3NGcmllbmRseSxcbiAgc2hvcnRIYXNoID0gdXRpbHMuc2hvcnRIYXNoLFxuICBmbG9vckhhY2sgPSB1dGlscy5mbG9vckhhY2s7XG5cbiQud2lkZ2V0KCd1aS5nZW5vdHJhY2snLCB7XG4gIFxuICAvLyBEZWZhdWx0IG9wdGlvbnMgdGhhdCBjYW4gYmUgb3ZlcnJpZGRlblxuICBvcHRpb25zOiB7XG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIGxpbmU6IG51bGwsICAgICAgIC8vIG11c3QgYmUgc3BlY2lmaWVkIG9uIGluc3RhbnRpYXRpb25cbiAgICBzaWRlOiBudWxsICAgICAgICAvLyBtdXN0IGJlIHNwZWNpZmllZCBvbiBpbnN0YW50aWF0aW9uXG4gIH0sXG4gIFxuICAvLyBDYWxsZWQgYXV0b21hdGljYWxseSB3aGVuIHdpZGdldCBpcyBpbnN0YW50aWF0ZWRcbiAgX2luaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICRlbGVtID0gdGhpcy5lbGVtZW50LCBcbiAgICAgIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICBicHBwcztcbiAgICBpZiAoIW8ubGluZSkgeyB0aHJvdyBcIkNhbm5vdCBpbnN0YW50aWF0ZSB1aS5nZW5vdHJhY2sgd2l0aG91dCBzcGVjaWZ5aW5nICdsaW5lJyBvcHRpb25cIjsgfVxuICAgIGlmICghby5zaWRlKSB7IHRocm93IFwiQ2Fubm90IGluc3RhbnRpYXRlIHVpLmdlbm90cmFjayB3aXRob3V0IHNwZWNpZnlpbmcgJ3NpZGUnIG9wdGlvblwiOyB9XG4gICAgc2VsZi5ydWxlciA9IG8udHJhY2subiA9PSAncnVsZXInO1xuICAgIHNlbGYuc2xpZGVyQnBwcHMgPSBvLmJwcHBzLmNvbmNhdChvLm92ZXJ6b29tQnBwcHMpO1xuICAgIHNlbGYudGlsZUxvYWRDb3VudGVyID0gc2VsZi5hcmVhTG9hZENvdW50ZXIgPSAwO1xuICAgIHNlbGYuY3VzdG9tID0gISFvLnRyYWNrLmN1c3RvbTtcbiAgICBzZWxmLmJpcnRoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7XG4gICAgc2VsZi4kc2lkZSA9ICQoby5zaWRlKS5hcHBlbmQoJzxkaXYgY2xhc3M9XCJzdWJ0cmFjay1jb250XCIvPicpO1xuICAgICRlbGVtLmFkZENsYXNzKCdicm93c2VyLXRyYWNrLScrby50cmFjay5uKS50b2dnbGVDbGFzcygnbm8taWRlb2dyYW1zJywgc2VsZi5ydWxlciAmJiAhby5jaHJCYW5kcyk7XG4gICAgc2VsZi5fbmVhcmVzdEJwcHBzKG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignem9vbScpKTtcbiAgICAvLyBJZiB0aGUgdHJhY2sgaGFzIG11bHRpcGxlIGRlbnNpdGllcywgb3IgaXRzIHNpbmdsZSBkZW5zaXR5IGhhcyBtdWx0aXBsZSBmaXhlZCBoZWlnaHRzLFxuICAgIC8vIG1ha2UgdGhlIHNpZGViYXIgcmVzaXphYmxlXG4gICAgc2VsZi5faW5pdFNpZGVSZXNpemFibGUoKTtcbiAgICBzZWxmLl9hdmFpbERlbnNpdGllcygpO1xuICAgIHNlbGYubG9hZGluZ0NvdW50ZXIgPSAwO1xuICAgICRlbGVtLmF0dHIoJ2lkJywgc2VsZi51bmlxSWQgPSAkLnVuaXFJZCgndHJrJykpO1xuICAgIHNlbGYucmVzaXplKG8udHJhY2suaCk7XG4gICAgc2VsZi51cGRhdGVEZW5zaXR5KCk7XG4gIH0sXG4gIFxuICBfaW5pdFNpZGVSZXNpemFibGU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICRlbGVtID0gdGhpcy5lbGVtZW50LFxuICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgIGJGID0gc2VsZi5fYnBwcEZvcm1hdChvLmJwcHBzWzBdKSxcbiAgICAgIGZpcnN0Rml4ZWRIZWlnaHQgPSBfLnVuaXEoXy5wbHVjayhvLnRyYWNrLmZoLCBfLmZsYXR0ZW4oby50cmFjay5zKVswXSkpLFxuICAgICAgcGFkZGluZ0JvcmRlcnNZID0gc2VsZi4kc2lkZS5vdXRlckhlaWdodCgpIC0gc2VsZi4kc2lkZS5oZWlnaHQoKSxcbiAgICAgIG1pbkhlaWdodCA9IChzZWxmLmN1c3RvbSA/IG8udHJhY2suY3VzdG9tLmhlaWdodHMubWluIDogTWF0aC5taW4oXy5taW4oby50cmFjay5maFtiRl0pLCAzMikpIC0gcGFkZGluZ0JvcmRlcnNZLFxuICAgICAgJGxpbmVzQmVsb3csICRoO1xuICAgIHZhciBvcHRzID0ge1xuICAgICAgaGFuZGxlczogJ3MnLCBcbiAgICAgIG1pbkhlaWdodDogbWluSGVpZ2h0LFxuICAgICAgc3RhcnQ6IGZ1bmN0aW9uKGUsIHVpKSB7XG4gICAgICAgIHZhciBicHBwID0gc2VsZi5icHBwcygpLnRvcCxcbiAgICAgICAgICBmaXhlZEhlaWdodHMgPSBvLnRyYWNrLmZoW3NlbGYuX2JwcHBGb3JtYXQoYnBwcCldLFxuICAgICAgICAgIGN1c3RvbUhlaWdodHMgPSBvLnRyYWNrLmN1c3RvbSAmJiBvLnRyYWNrLmN1c3RvbS5oZWlnaHRzO1xuICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ3Jvdy1yZXNpemluZycpO1xuICAgICAgICBpZiAoIXNlbGYucnVsZXIgJiYgIXNlbGYuY3VzdG9tKSB7XG4gICAgICAgICAgdmFyICRpbWdzID0gJCgnLmJyb3dzZXItdHJhY2stJytvLnRyYWNrLm4rJz4uYnBwcC0nK2NsYXNzRnJpZW5kbHkoYnBwcCkrJyBpbWcudGRhdGEnKSxcbiAgICAgICAgICAgIG1heEhlaWdodCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsICRpbWdzLm1hcChmdW5jdGlvbigpIHsgXG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLm5hdHVyYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQ7IFxuICAgICAgICAgICAgfSkuZ2V0KCkpO1xuICAgICAgICAgICQodGhpcykucmVzaXphYmxlKCdvcHRpb24nLCAnbWF4SGVpZ2h0JywgTWF0aC5tYXgobWF4SGVpZ2h0ICogMS4yLCB1aS5vcmlnaW5hbFNpemUuaGVpZ2h0LCAxOCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZWxmLmN1c3RvbSkge1xuICAgICAgICAgIGlmIChjdXN0b21IZWlnaHRzLm1heCkgeyAkKHRoaXMpLnJlc2l6YWJsZSgnb3B0aW9uJywgJ21heEhlaWdodCcsIGN1c3RvbUhlaWdodHMubWF4IC0gcGFkZGluZ0JvcmRlcnNZKTsgfVxuICAgICAgICAgIGlmIChjdXN0b21IZWlnaHRzLm1pbikgeyAkKHRoaXMpLnJlc2l6YWJsZSgnb3B0aW9uJywgJ21pbkhlaWdodCcsIGN1c3RvbUhlaWdodHMubWluIC0gcGFkZGluZ0JvcmRlcnNZKTsgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghc2VsZi5ydWxlcikge1xuICAgICAgICAgIHNlbGYuc25hcHMgPSBmaXhlZEhlaWdodHMgJiYgXy5tYXAoZml4ZWRIZWlnaHRzLCBmdW5jdGlvbih2LCBrKSB7IHJldHVybiBrPT0nZGVuc2UnID8gdiA6IHYgKyAxOyB9KTtcbiAgICAgICAgICBpZiAoc2VsZi5zbmFwcykgeyBzZWxmLnNuYXBzLmFsd2F5cyA9IGZpeGVkSGVpZ2h0cyAmJiAhIShmaXhlZEhlaWdodHMucGFjayB8fCBmaXhlZEhlaWdodHMuZnVsbCk7IH1cbiAgICAgICAgfVxuICAgICAgICBvLmJyb3dzZXIuZmluZCgnLmJyb3dzZXItbGluZScpLnJlbW92ZUNsYXNzKCdsYXN0LXJlc2l6ZWQnKTtcbiAgICAgICAgby5saW5lLmFkZENsYXNzKCdsYXN0LXJlc2l6ZWQnKTtcbiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygncmVzaXppbmctc2lkZScpO1xuICAgICAgICAkbGluZXNCZWxvdyA9IG8ubGluZS5uZXh0QWxsKCkuZWFjaChmdW5jdGlvbigpIHsgJCh0aGlzKS5kYXRhKCdvcmlnVG9wJywgJCh0aGlzKS5wb3NpdGlvbigpLnRvcCk7IH0pO1xuICAgICAgfSxcbiAgICAgIHJlc2l6ZTogZnVuY3Rpb24oZSwgdWkpIHtcbiAgICAgICAgdmFyIGhlaWdodCA9IHNlbGYuJHNpZGUub3V0ZXJIZWlnaHQoKTsgLy8gZm9yIHNvbWUgcmVhc29uIHVpLnNpemUuaGVpZ2h0IGlzIGFsd2F5cyBiZWhpbmQgYnkgMSBmcmFtZVxuICAgICAgICBpZiAoc2VsZi5zbmFwcyAmJiAodWkuc2l6ZS5oZWlnaHQgPCBfLm1heChzZWxmLnNuYXBzKSB8fCBzZWxmLnNuYXBzLmFsd2F5cykpIHtcbiAgICAgICAgICBoZWlnaHQgPSBfLm1pbihzZWxmLnNuYXBzLCBmdW5jdGlvbih2KSB7IHJldHVybiBNYXRoLmFicyh2IC0gdWkuc2l6ZS5oZWlnaHQpOyB9KTtcbiAgICAgICAgICBzZWxmLiRzaWRlLm91dGVySGVpZ2h0KGhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgby5saW5lLmdlbm9saW5lKCdmaXhGaXJzdExhYmVsJywgdHJ1ZSk7XG4gICAgICAgIHNlbGYuX3Jlc2l6ZShoZWlnaHQpO1xuICAgICAgICAkbGluZXNCZWxvdy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICQodGhpcykuY3NzKCd0b3AnLCAkKHRoaXMpLmRhdGEoJ29yaWdUb3AnKSArIGhlaWdodCAtIHVpLm9yaWdpbmFsU2l6ZS5oZWlnaHQpO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBzdG9wOiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3Jvdy1yZXNpemluZycpO1xuICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdyZXNpemluZy1zaWRlJyk7XG4gICAgICAgICQodGhpcykuY3NzKCd3aWR0aCcsICcnKTtcbiAgICAgICAgby5icm93c2VyLmdlbm9icm93c2VyKCdyZWN2VHJhY2tSZXNpemUnLCBvLmxpbmUsIG8udHJhY2subiwgc2VsZi4kc2lkZS5vdXRlckhlaWdodCgpKTsgXG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAoc2VsZi5ydWxlcikgeyBvcHRzLm1heEhlaWdodCA9IG8udHJhY2sub2ggLSBwYWRkaW5nQm9yZGVyc1k7IH1cbiAgICBzZWxmLiRzaWRlLnJlc2l6YWJsZShvcHRzKTtcbiAgICAkaCA9IHNlbGYuJHNpZGUuZmluZCgnLnVpLXJlc2l6YWJsZS1oYW5kbGUnKTtcbiAgICAkaC5ob3ZlcihmdW5jdGlvbigpIHsgJCh0aGlzKS5hZGRDbGFzcygnaG92ZXInKTsgfSwgZnVuY3Rpb24oKSB7ICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hvdmVyJyk7IH0pO1xuICB9LFxuICBcbiAgc2lkZTogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLiRzaWRlOyB9LFxuICBcbiAgX2ZpeFNpZGU6IGZ1bmN0aW9uKGRlbnNpdHksIGJwcHApIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsXG4gICAgICBuID0gby50cmFjay5uLFxuICAgICAgJGNvbnQgPSBzZWxmLiRzaWRlLmNoaWxkcmVuKCcuc3VidHJhY2stY29udCcpLFxuICAgICAgdHJhY2tEZXNjID0gby5icm93c2VyLmdlbm9icm93c2VyKCdvcHRpb24nLCAndHJhY2tEZXNjJyksIC8vIGFsd2F5cyB1c2UgdGhlIGxhdGVzdCB2YWx1ZXMgZnJvbSB0aGUgYnJvd3NlclxuICAgICAgZGVuc0JwcHBNZW1vID0gW2RlbnNpdHksIGJwcHBdLmpvaW4oJ3wnKSxcbiAgICAgICR0b29NYW55RGF0YVdhcm5pbmcgPSBzZWxmLiRzaWRlLmNoaWxkcmVuKCcudG9vLW1hbnktd2FybmluZycpLCBcbiAgICAgIGRlbnMsIHRleHQsIGg7XG4gICAgaWYgKCRjb250LmRhdGEoJ2RlbnNCcHBwJykgPT09IGRlbnNCcHBwTWVtbykgeyByZXR1cm47IH1cbiAgICAkY29udC5lbXB0eSgpO1xuICAgIGlmIChkZW5zID0gdHJhY2tEZXNjW25dICYmIHRyYWNrRGVzY1tuXS5kZW5zICYmIHRyYWNrRGVzY1tuXS5kZW5zW2RlbnNpdHldKSB7XG4gICAgICBpZiAoZGVuc1swXVswXSA9PT0gMCkge1xuICAgICAgICAvLyBMYWJlbHMgY2hhbmdlIGZvciBjZXJ0YWluIGJwcHAgbGV2ZWxzXG4gICAgICAgIGRlbnMgPSAoZGVuc1tfLnNvcnRlZEluZGV4KGRlbnMsIFticHBwXSwgZnVuY3Rpb24odikgeyByZXR1cm4gdlswXTsgfSkgLSAxXSB8fCBkZW5zWzBdKS5zbGljZSgxKTtcbiAgICAgIH1cbiAgICAgIC8vIEFwcGx5IHRoZSBhcHByb3ByaWF0ZSBzdWJ0cmFjayBsYWJlbHMgZm9yIGNlcnRhaW4gYnBwcCBsZXZlbHNcbiAgICAgIF8uZWFjaChkZW5zLCBmdW5jdGlvbih2KSB7XG4gICAgICAgIHYgPSBfLmlzQXJyYXkodikgPyB2IDogW3ZdO1xuICAgICAgICBoID0gdlsxXSB8fCAxNTtcbiAgICAgICAgJCgnPGRpdiBjbGFzcz1cInN1YnRyYWNrXCIvPicpLmNzcyh7aGVpZ2h0OiBoLCBsaW5lSGVpZ2h0OiBoKydweCd9KS5odG1sKHZbMF0pLmFwcGVuZFRvKCRjb250KTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0ZXh0ID0gKHRyYWNrRGVzY1tuXSAmJiB0cmFja0Rlc2Nbbl0uc20pIHx8IG8udHJhY2subjtcbiAgICAgIGggPSBvLnRyYWNrLmg7XG4gICAgICAkY29udC5hcHBlbmQoJCgnPGRpdiBjbGFzcz1cInN1YnRyYWNrIHVuc2l6ZWRcIi8+JykudGV4dCh0ZXh0KSk7XG4gICAgfVxuICAgICRjb250LmRhdGEoJ2RlbnNCcHBwJywgZGVuc0JwcHBNZW1vKTtcbiAgfSxcbiAgXG4gIC8vIHB1YmxpYyByZXNpemUgZnVuY3Rpb24gdGhhdCB1cGRhdGVzIHRoZSBlbnRpcmUgVUkgYWNjb3JkaW5nbHkuXG4gIHJlc2l6ZTogZnVuY3Rpb24oaGVpZ2h0LCBhbmltQ2FsbGJhY2spIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgIHBhZGRpbmdCb3JkZXJzWSA9IHRoaXMuJHNpZGUub3V0ZXJIZWlnaHQoKSAtIHRoaXMuJHNpZGUuaGVpZ2h0KCk7XG4gICAgLy8gY2FuIHBhc3MgY2FsbGJhY2s9PXRydWUgdG8gYW5pbWF0ZSB3aXRob3V0IGEgY2FsbGJhY2tcbiAgICBpZiAoIV8uaXNGdW5jdGlvbihhbmltQ2FsbGJhY2spICYmIGFuaW1DYWxsYmFjaykgeyBhbmltQ2FsbGJhY2sgPSBmdW5jdGlvbigpIHt9OyB9XG4gICAgdGhpcy5fcmVzaXplKGhlaWdodCwgYW5pbUNhbGxiYWNrKTtcbiAgICBpZiAoYW5pbUNhbGxiYWNrKSB7IHRoaXMuJHNpZGUuYW5pbWF0ZSh7aGVpZ2h0OiBoZWlnaHQgLSBwYWRkaW5nQm9yZGVyc1l9LCBvLmxpbmVGaXhEdXJhdGlvbik7IH1cbiAgICBlbHNlIHsgdGhpcy4kc2lkZS5vdXRlckhlaWdodChoZWlnaHQpOyB9XG4gIH0sXG4gIFxuICAvLyBpbnRlcm5hbCByZXNpemUgaGFuZGxlciwgdXNlZCBieSB0aGUgcmVzaXphYmxlIHNpZGUgaGFuZGxlLCBkb2VzIG5vdCB1cGRhdGUgdGhlIHNpZGUgaGVpZ2h0LlxuICBfcmVzaXplOiBmdW5jdGlvbihoZWlnaHQsIGNhbGxiYWNrKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICAkZWxlbSA9IHRoaXMuZWxlbWVudCxcbiAgICAgIGJwcHBzID0gdGhpcy5icHBwcygpO1xuICAgIGlmICh0aGlzLnJ1bGVyKSB7XG4gICAgICBpZiAoaGVpZ2h0IDwgdGhpcy4kc2lkZS5yZXNpemFibGUoJ29wdGlvbicsICdtaW5IZWlnaHQnKSArIDMpIHsgJGVsZW0uYWRkQ2xhc3MoJ3J1bGVyLWNvbGxhcHNlZCcpOyB9XG4gICAgICBlbHNlIHsgJGVsZW0ucmVtb3ZlQ2xhc3MoJ3J1bGVyLWNvbGxhcHNlZCcpOyB9XG4gICAgfVxuICAgIG8udHJhY2suaCA9IGhlaWdodDtcbiAgICBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2RlbnNpdHlPcmRlcicsIG8udHJhY2subiwgaGVpZ2h0LCBicHBwcyk7XG4gICAgdGhpcy5maXhUaWxlcygpO1xuICAgIHRoaXMuZml4Q2xpcHBlZCgpO1xuICAgIGlmIChfLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7IFxuICAgICAgdGhpcy5lbGVtZW50LmFuaW1hdGUoe2hlaWdodDogaGVpZ2h0fSwgby5saW5lRml4RHVyYXRpb24sIGNhbGxiYWNrKS5jc3MoJ292ZXJmbG93JywgJ3Zpc2libGUnKTsgXG4gICAgfSBlbHNlIHsgdGhpcy5lbGVtZW50LmhlaWdodChoZWlnaHQpOyB9XG4gIH0sXG4gIFxuICBfYXZhaWxEZW5zaXRpZXM6IGZ1bmN0aW9uKGJwcHApIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gc2VsZi5vcHRpb25zO1xuICAgIHNlbGYuYXZhaWxEZW5zaXRpZXMgPSB7fTtcbiAgICBfLmVhY2goby5icHBwcywgZnVuY3Rpb24oYnBwcCkge1xuICAgICAgdmFyIGRlbnNpdGllcyA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvLnRyYWNrLnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHYgPSBvLnRyYWNrLnNbaV07XG4gICAgICAgIGlmICghXy5pc0FycmF5KHYpKSB7IHYgPSBbdl07IH1cbiAgICAgICAgaWYgKHZbMV0gJiYgYnBwcCA+IHZbMV0pIHsgY29udGludWU7IH1cbiAgICAgICAgaWYgKHZbMl0gJiYgYnBwcCA8PSB2WzJdKSB7IGNvbnRpbnVlOyB9XG4gICAgICAgIGRlbnNpdGllcy5wdXNoKHZbMF0pO1xuICAgICAgfVxuICAgICAgc2VsZi5hdmFpbERlbnNpdGllc1ticHBwXSA9IGRlbnNpdGllcztcbiAgICB9KTtcbiAgICByZXR1cm4gc2VsZi5hdmFpbERlbnNpdGllcztcbiAgfSxcbiAgXG4gIF9iZXN0RGVuc2l0eTogZnVuY3Rpb24oYnBwcCkge1xuICAgIHZhciBkZW5zaXRpZXMgPSB0aGlzLmF2YWlsRGVuc2l0aWVzW2JwcHBdLFxuICAgICAgZGVuc2l0eU9yZGVyID0gdGhpcy5vcHRpb25zLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2RlbnNpdHlPcmRlcicsIHRoaXMub3B0aW9ucy50cmFjay5uKTtcbiAgICByZXR1cm4gXy5taW4oZGVuc2l0aWVzLCBmdW5jdGlvbihkKSB7IHJldHVybiBkZW5zaXR5T3JkZXJbZF07IH0pXG4gIH0sXG4gIFxuICB1cGRhdGVEZW5zaXR5OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsXG4gICAgICB0b3BCcHBwID0gc2VsZi5icHBwcygpLnRvcDtcbiAgICB2YXIgYmVzdERlbnNpdHkgPSBzZWxmLl9iZXN0RGVuc2l0eSh0b3BCcHBwKTtcbiAgICAvLyBGaXggc2lkZSBsYWJlbHMgKGUuZy4gZm9yIHN1YnRyYWNrcykgZm9yIHRoZSBiZXN0IGRlbnNpdHlcbiAgICBzZWxmLl9maXhTaWRlKGJlc3REZW5zaXR5LCB0b3BCcHBwKTtcbiAgICAvLyBTZXQgdGhlIGJlc3QgZGVuc2l0eSBhbmQgdHJpZ2dlciBldmVudHMgb24gdGhlc2UgdGlsZXNcbiAgICAkZWxlbS5maW5kKCcudGlsZS1mdWxsJykuY2hpbGRyZW4oJy50ZGF0YSwuYXJlYS5sYWJlbCcpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICBpc0Jlc3QgPSAkdGhpcy5oYXNDbGFzcygnZGVucy0nK2Jlc3REZW5zaXR5KTtcbiAgICAgICR0aGlzLnRvZ2dsZUNsYXNzKCdkZW5zLWJlc3QnLCBpc0Jlc3QpO1xuICAgICAgaWYgKGlzQmVzdCkgeyAkdGhpcy50cmlnZ2VyKCdiZXN0RGVuc2l0eScpOyB9XG4gICAgfSk7XG4gICAgLy8gSWYgdGhlIHRvby1tYW55IGNsYXNzIHdhcyBzZXQgb24gdGlsZXMsIHdlIGNvdWxkbid0IGRyYXcvbG9hZCBzb21lIGN1c3RvbSBkYXRhIGJlY2F1c2UgdGhlcmUncyB0b28gbXVjaCBvZiBpdC5cbiAgICAvLyBBZGQgYSBjbGFzcyB0byB0aGlzIHRyYWNrIHRvIHNob3cgd2FybmluZ3MgYWJvdXQgdGhpcyB0byB0aGUgdXNlci5cbiAgICAvLyBGaW5hbGx5LCBmaXggY2xpcHBpbmcgaW5kaWNhdG9yc1xuICAgIHNlbGYuZml4Q2xpcHBlZCgpO1xuICB9LFxuICBcbiAgX25lYXJlc3RCcHBwczogZnVuY3Rpb24oem9vbSkge1xuICAgIHZhciBvID0gdGhpcy5vcHRpb25zLCBcbiAgICAgIGJwcHBzID0geyBuZWFyZXN0OiBbby5icHBwc1swXV0sIGNhY2hlOiBbXSwgdG9wOiBvLmJwcHBzWzBdIH0sXG4gICAgICBwb3NzaWJsZUJwcHBzID0gdGhpcy5ydWxlciA/IHRoaXMuc2xpZGVyQnBwcHMgOiBvLmJwcHBzLFxuICAgICAgbCA9IHBvc3NpYmxlQnBwcHMubGVuZ3RoLFxuICAgICAgZm91bmQgPSBmYWxzZSxcbiAgICAgIHNocmlua2FibGVXaW5kb3csIGdldE5leHQ7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsOyBpKyspIHtcbiAgICAgIHZhciB6b29tRGlmZiA9IHpvb20gLSBwb3NzaWJsZUJwcHBzW2ldO1xuICAgICAgaWYgKHpvb21EaWZmID4gMCkge1xuICAgICAgICBzaHJpbmthYmxlV2luZG93ID0gKHBvc3NpYmxlQnBwcHNbaSArIDFdIHx8IHBvc3NpYmxlQnBwcHNbaV0gLyAzKTtcbiAgICAgICAgZ2V0TmV4dCA9IDAgKyAoem9vbURpZmYgPCBzaHJpbmthYmxlV2luZG93KTtcbiAgICAgICAgYnBwcHMubmVhcmVzdCA9IHBvc3NpYmxlQnBwcHMuc2xpY2UoTWF0aC5tYXgoaSAtIDIgKyBnZXROZXh0LCAwKSwgaSArIGdldE5leHQpO1xuICAgICAgICBpZiAoZ2V0TmV4dCkgeyBicHBwcy5jYWNoZSA9IFtmYWxzZSwgem9vbURpZmYgPiBzaHJpbmthYmxlV2luZG93IC8gMl07IH1cbiAgICAgICAgYnBwcHMudG9wID0gYnBwcHMuY2FjaGVbMV0gPyBicHBwcy5uZWFyZXN0WzBdIDogYnBwcHMubmVhcmVzdC5zbGljZSgtMSlbMF07XG4gICAgICAgIGZvdW5kID0gdHJ1ZTsgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghZm91bmQpIHtcbiAgICAgIGJwcHBzLm5lYXJlc3QgPSBwb3NzaWJsZUJwcHBzLnNsaWNlKC0yKTtcbiAgICAgIGJwcHBzLnRvcCA9IHBvc3NpYmxlQnBwcHMuc2xpY2UoLTEpWzBdO1xuICAgIH1cbiAgICBpZiAodGhpcy5ydWxlciAmJiB6b29tIDw9IG8uaWRlb2dyYW1zQWJvdmUpIHtcbiAgICAgIGJwcHBzLm5lYXJlc3QgPSBicHBwcy5uZWFyZXN0LnNsaWNlKC0xKTtcbiAgICB9XG4gICAgYnBwcHMudG9wRm9ybWF0dGVkID0gdGhpcy5fYnBwcEZvcm1hdChicHBwcy50b3ApO1xuICAgIHJldHVybiAodGhpcy5fYnBwcHMgPSBicHBwcyk7XG4gIH0sXG4gIFxuICBicHBwczogZnVuY3Rpb24oZm9yY2VSZWNhbGMpIHtcbiAgICB2YXIgem9vbSA9IHRoaXMub3B0aW9ucy5icm93c2VyLmdlbm9icm93c2VyKCd6b29tJyk7XG4gICAgcmV0dXJuIChmb3JjZVJlY2FsYyB8fCAhdGhpcy5fYnBwcHMpID8gdGhpcy5fbmVhcmVzdEJwcHBzKHpvb20pIDogdGhpcy5fYnBwcHM7XG4gIH0sXG4gIFxuICBmaXhUaWxlczogZnVuY3Rpb24oZm9yY2VSZXBvcykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICRlbGVtID0gc2VsZi5lbGVtZW50LCBcbiAgICAgIG8gPSBzZWxmLm9wdGlvbnM7XG4gICAgaWYgKCFvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3RpbGVGaXhpbmdFbmFibGVkJykpIHsgcmV0dXJuOyB9XG4gICAgdmFyIHBvcyA9IG8ubGluZS5nZW5vbGluZSgnZ2V0UG9zJyksXG4gICAgICB6b29tID0gby5icm93c2VyLmdlbm9icm93c2VyKCd6b29tJyksXG4gICAgICBhdmFpbFdpZHRoID0gby5icm93c2VyLmdlbm9icm93c2VyKCdsaW5lV2lkdGgnKSxcbiAgICAgIGFsbFRpbGVzTmVlZGVkID0gW10sXG4gICAgICBwcmV2VG9wID0gdGhpcy5fYnBwcHMgJiYgdGhpcy5fYnBwcHMudG9wLFxuICAgICAgYnBwcHMgPSB0aGlzLmJwcHBzKGZvcmNlUmVwb3MpLFxuICAgICAgJG5vdE5lZWRlZDtcbiAgICBfLmVhY2goYnBwcHMubmVhcmVzdCwgZnVuY3Rpb24oYnBwcCwgaSkge1xuICAgICAgdmFyIGJwUGVyVGlsZSA9IG8udGlsZVdpZHRoICogYnBwcCxcbiAgICAgICAgdGlsZUlkID0gZmxvb3JIYWNrKChwb3MgLSBhdmFpbFdpZHRoICogYnBwcCAqIChicHBwcy5jYWNoZVtpXSA/IDAgOiAxKSkgLyBicFBlclRpbGUpICogYnBQZXJUaWxlICsgMSxcbiAgICAgICAgdGlsZXNOZWVkZWQgPSBbdGlsZUlkXSxcbiAgICAgICAgcmlnaHRNYXJnaW4gPSBwb3MgKyAoYnBwcHMuY2FjaGVbaV0gPyAxIDogMikgKiBhdmFpbFdpZHRoICogYnBwcCxcbiAgICAgICAgYmVzdERlbnNpdHkgPSBzZWxmLl9iZXN0RGVuc2l0eShicHBwKTtcbiAgICAgIHdoaWxlICgodGlsZUlkICs9IGJwUGVyVGlsZSkgPCByaWdodE1hcmdpbikgeyB0aWxlc05lZWRlZC5wdXNoKHRpbGVJZCk7IH1cbiAgICAgIF8uZWFjaCh0aWxlc05lZWRlZCwgZnVuY3Rpb24odGlsZUlkKSB7XG4gICAgICAgIHZhciByZXBvcyA9IGZhbHNlLCAkdCA9ICQoJyMnICsgc2VsZi5fdGlsZUlkKHRpbGVJZCwgYnBwcCkpO1xuICAgICAgICBpZiAoISR0Lmxlbmd0aCkgeyBcbiAgICAgICAgICAkdCA9IHNlbGYuX2FkZFRpbGUodGlsZUlkLCBicHBwLCBiZXN0RGVuc2l0eSwgYnBwcHMuY2FjaGVbaV0pOyBcbiAgICAgICAgICByZXBvcyA9IHRydWU7IFxuICAgICAgICB9XG4gICAgICAgIGlmICghYnBwcHMuY2FjaGVbaV0pIHsgc2VsZi5fc2hvd1RpbGUoJHQpOyB9XG4gICAgICAgIGlmIChyZXBvcyB8fCBmb3JjZVJlcG9zKSB7IHNlbGYuX3JlcG9zVGlsZSgkdCwgdGlsZUlkLCB6b29tLCBicHBwKTsgfVxuICAgICAgICBhbGxUaWxlc05lZWRlZC5wdXNoKCR0LmdldCgwKSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICAkbm90TmVlZGVkID0gJGVsZW0uY2hpbGRyZW4oJy50aWxlJykubm90KGFsbFRpbGVzTmVlZGVkKTtcbiAgICBzZWxmLnRpbGVMb2FkQ291bnRlciAtPSAkbm90TmVlZGVkLmNoaWxkcmVuKCcubG9hZGluZycpLmxlbmd0aDtcbiAgICAkbm90TmVlZGVkLnJlbW92ZSgpO1xuICAgIGlmIChwcmV2VG9wICYmIHByZXZUb3AgIT0gYnBwcHMudG9wKSB7IHNlbGYudXBkYXRlRGVuc2l0eSgpOyB9XG4gICAgdGhpcy5fZml4TGFiZWxzKGZvcmNlUmVwb3MpO1xuICAgIHRoaXMuX2ZpeFNpZGVDbGlwcGVkKCk7XG4gIH0sXG4gIFxuICBfc2V0SW1nRGltczogZnVuY3Rpb24oZSkge1xuICAgIC8vIE5PVEU6IHRoaXMgaXMgb25seSB1c2VkIGFzIGJvdW5kIHRvIGEgdGlsZSA8aW1nPidzIG9uTG9hZCEgU2VlIF9hZGRUaWxlXG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgaCA9IHRoaXMubmF0dXJhbEhlaWdodCB8fCB0aGlzLmhlaWdodDtcbi8vICAgICAgaWYgKHRoaXMubmF0dXJhbEhlaWdodCA9PSAxKSB7IF8uZGVmZXIoZnVuY3Rpb24oKSB7IGNvbnNvbGUubG9nKHNlbGYubmF0dXJhbEhlaWdodCk7IH0pIH0gLy8gRklYTUU6IHRoaXMgaXMgc29tZXRpbWVzIGVycm9uZW91c2x5IDFweFxuICAgICQodGhpcykuY3NzKCdoZWlnaHQnLCBoKS5jc3MoJ3dpZHRoJywgJzEwMCUnKTtcbiAgfSxcbiAgXG4gIF90cmFja0xvYWRGaXJlOiBmdW5jdGlvbihlKSB7XG4gICAgLy8gTk9URTogdGhpcyBpcyBvbmx5IHVzZWQgYXMgYm91bmQgdG8gYSB0aWxlIDxpbWc+J3Mgb25Mb2FkISBTZWUgX2FkZFRpbGVcbiAgICB2YXIgc2VsZiA9IGUuZGF0YS5zZWxmLFxuICAgICAgdHJhY2tIID0gc2VsZi5vcHRpb25zLnRyYWNrLmgsXG4gICAgICAkdCA9IGUuZGF0YS50aWxlLFxuICAgICAgaCA9IHRoaXMubmF0dXJhbEhlaWdodCB8fCB0aGlzLmhlaWdodDtcbiAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG4gICAgaWYgKGUuZGF0YS5pc0Jlc3QgJiYgZS50eXBlICE9ICdlcnJvcicpIHsgXG4gICAgICAkdC5hZGRDbGFzcygndGlsZS1sb2FkZWQnKTtcbiAgICAgIGlmIChoID4gdHJhY2tIKSB7ICR0LmFkZENsYXNzKCdjbGlwcGVkJyk7IH1cbiAgICAgIGlmICghZS5kYXRhLmNhY2hlZCkgeyBzZWxmLl9zaG93VGlsZSgkdCk7IH1cbiAgICB9XG4gICAgLy8gZS5kYXRhLnNlbGYuYXZhaWxEZW5zaXRpZXNbYnBwcF0gPSBfLndpdGhvdXQoZGVuc2l0aWVzLCBkZW5zaXR5KTsgLy8gRklYTUUsIGhvdyB0byBrbm9jayBvdXQgdHJhY2tzIHRoYXQgZG9uJ3QgbG9hZD9cbiAgICBpZiAoLS1zZWxmLnRpbGVMb2FkQ291bnRlciA9PT0gMCkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcigndHJhY2tsb2FkJywgc2VsZi5icHBwcygpKTsgfTtcbiAgfSxcbiAgXG4gIF9hZGRUaWxlOiBmdW5jdGlvbih0aWxlSWQsIGJwcHAsIGJlc3REZW5zaXR5LCBjYWNoZWQpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsXG4gICAgICAkZCA9ICQubWsoJ2RpdicpLmF0dHIoJ2NsYXNzJywgJ3RpbGUnKSxcbiAgICAgIGJwUGVyVGlsZSA9IG8udGlsZVdpZHRoICogYnBwcCxcbiAgICAgIHNwZWNpYWwgPSBzZWxmLl9zcGVjaWFsVGlsZSh0aWxlSWQsIGJwcHApLFxuICAgICAgZGVuc2l0aWVzID0gc2VsZi5hdmFpbERlbnNpdGllc1ticHBwXSxcbiAgICAgICR0aWxlQmVmb3JlID0gJCgnIycgKyBzZWxmLl90aWxlSWQodGlsZUlkIC0gYnBQZXJUaWxlLCBicHBwKSk7XG4gICAgaWYgKCR0aWxlQmVmb3JlLmxlbmd0aCkgeyAkZC5pbnNlcnRBZnRlcigkdGlsZUJlZm9yZSk7IH1cbiAgICBlbHNlIHsgJGQucHJlcGVuZFRvKHNlbGYuZWxlbWVudCkgfTtcbiAgICAkZC5hdHRyKCdpZCcsIHNlbGYuX3RpbGVJZCh0aWxlSWQsIGJwcHApKS5kYXRhKHt6SW5kZXg6IF8uaW5kZXhPZihzZWxmLnNsaWRlckJwcHBzLCBicHBwKSwgdGlsZUlkOiB0aWxlSWR9KTtcbiAgICBpZiAoJC5zdXBwb3J0LnRvdWNoKSB7IHNlbGYuX3RpbGVUb3VjaEV2ZW50cygkZCk7IH1cbiAgICBlbHNlIHsgJGQubW91c2Vtb3ZlKHtzZWxmOiBzZWxmfSwgc2VsZi5fdGlsZU1vdXNlTW92ZSkubW91c2VvdXQoe3NlbGY6IHNlbGZ9LCBzZWxmLl90aWxlTW91c2VPdXQpOyB9XG4gICAgaWYgKHNwZWNpYWwpIHtcbiAgICAgIGlmIChzcGVjaWFsLmJsYW5rKSB7ICRkLmFkZENsYXNzKCd0aWxlLWJsYW5rJykuYWRkQ2xhc3MoJ3RpbGUtb2ZmLScgKyAoc3BlY2lhbC5sZWZ0ID8gJ2wnIDogJ3InKSk7IH1cbiAgICAgIGVsc2UgaWYgKHNwZWNpYWwuY3VzdG9tKSB7IHNlbGYuX2N1c3RvbVRpbGUoJGQsIHRpbGVJZCwgYnBwcCwgYmVzdERlbnNpdHkpOyB9XG4gICAgICBlbHNlIHsgc2VsZi5fcnVsZXJUaWxlKCRkLCB0aWxlSWQsIGJwcHApOyB9IC8vIHNwZWNpYWwucnVsZXIgPT09IHRydWVcbiAgICAgIHJldHVybiAkZDtcbiAgICB9XG4gICAgJGQuYWRkQ2xhc3MoJ3RpbGUtZnVsbCBicHBwLScrY2xhc3NGcmllbmRseShicHBwKSk7XG4gICAgXy5lYWNoKGRlbnNpdGllcywgZnVuY3Rpb24oZGVuc2l0eSkge1xuICAgICAgdmFyIHRpbGVTcmMgPSBzZWxmLl90aWxlU3JjKHRpbGVJZCwgYnBwcCwgZGVuc2l0eSksIFxuICAgICAgICBmaXhlZEhlaWdodCA9IG8udHJhY2suZmhbdGlsZVNyYy5icHBwRm9ybWF0XSAmJiBvLnRyYWNrLmZoW3RpbGVTcmMuYnBwcEZvcm1hdF1bZGVuc2l0eV0sXG4gICAgICAgICRpO1xuICAgICAgaWYgKGZpeGVkSGVpZ2h0KSB7XG4gICAgICAgICRpID0gJC5taygnaW1nJykuYWRkQ2xhc3MoJ3RkYXRhIGxvYWRpbmcgZGVucy0nK2RlbnNpdHkpLmNzcygnd2lkdGgnLCAnMTAwJScpLmNzcygnaGVpZ2h0JywgZml4ZWRIZWlnaHQpO1xuICAgICAgICAkZC5hcHBlbmQoJGkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGkgPSAkLm1rKCdpbWcnKS5hZGRDbGFzcygndGRhdGEgbG9hZGluZyBkZW5zLScrZGVuc2l0eSkuYmluZCgnbG9hZCcsIHNlbGYuX3NldEltZ0RpbXMpO1xuICAgICAgICAkZC5hcHBlbmQoJGkpO1xuICAgICAgfVxuICAgICAgc2VsZi50aWxlTG9hZENvdW50ZXIrKztcbiAgICAgICRpLmJpbmQoJ2xvYWQgZXJyb3InLCB7c2VsZjogc2VsZiwgdGlsZTogJGQsIGlzQmVzdDogZGVuc2l0eT09YmVzdERlbnNpdHksIGNhY2hlZDogY2FjaGVkfSwgc2VsZi5fdHJhY2tMb2FkRmlyZSk7XG4gICAgICAkaS50b2dnbGVDbGFzcygnZGVucy1iZXN0JywgZGVuc2l0eSA9PSBiZXN0RGVuc2l0eSk7XG4gICAgICBpZiAoby50cmFjay5tICYmIF8uaW5jbHVkZShvLnRyYWNrLm0sIGRlbnNpdHkpKSB7ICRpLmFkZENsYXNzKCduby1hcmVhcycpOyB9XG4gICAgICBcbiAgICAgICRpLmF0dHIoJ3NyYycsIG8udGlsZURpciArIHRpbGVTcmMuZnVsbCk7XG4gICAgfSk7XG4gICAgcmV0dXJuICRkO1xuICB9LFxuICBcbiAgLy8gU2hvd3Mgb3JhbmdlIGNsaXBwaW5nIGluZGljYXRvcnMgaWYgYW55IG9mIHRoZSBiZXN0IGRlbnNpdHkgdGlsZXMgaGF2ZSBkYXRhIGN1dCBvZmYgYXQgdGhlIGJvdHRvbVxuICBmaXhDbGlwcGVkOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgJGVsZW0gPSB0aGlzLmVsZW1lbnQsXG4gICAgICBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgc2lkZUNsaXBwZWQgPSBmYWxzZTtcbiAgICAkZWxlbS5maW5kKCcudGlsZS1mdWxsJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIHZhciAkdCA9ICQodGhpcyksXG4gICAgICAgIGJlc3QgPSAkdC5jaGlsZHJlbignLnRkYXRhLmRlbnMtYmVzdDpub3QoLmxvYWRpbmcpOm5vdCguc3RyZXRjaC1oZWlnaHQpJykuZ2V0KDApLFxuICAgICAgICBoID0gYmVzdCAmJiAoYmVzdC5uYXR1cmFsSGVpZ2h0IHx8IGJlc3QuaGVpZ2h0KSB8fCAwLFxuICAgICAgICBjbGlwcGVkID0gaCA+IG8udHJhY2suaDtcbiAgICAgICR0LnRvZ2dsZUNsYXNzKCdjbGlwcGVkJywgY2xpcHBlZCk7XG4gICAgfSk7XG4gICAgdGhpcy5fZml4U2lkZUNsaXBwZWQoKTtcbiAgfSxcbiAgXG4gIF9maXhTaWRlQ2xpcHBlZDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJwcHBzID0gdGhpcy5icHBwcygpLFxuICAgICAgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgIHBvcyA9IG8ubGluZS5nZW5vbGluZSgnZ2V0UG9zJyksXG4gICAgICB6b29tID0gby5icm93c2VyLmdlbm9icm93c2VyKCd6b29tJyksXG4gICAgICBicFdpZHRoID0gby5icm93c2VyLmdlbm9icm93c2VyKCdicFdpZHRoJyksXG4gICAgICB0aWxlQnBXaWR0aCA9IGJwcHBzLnRvcCAqIG8udGlsZVdpZHRoLFxuICAgICAgY2xpcHBlZCA9IGZhbHNlO1xuICAgIHRoaXMuZWxlbWVudC5jaGlsZHJlbignLmNsaXBwZWQuYnBwcC0nK2NsYXNzRnJpZW5kbHkoYnBwcHMudG9wKSkuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIHZhciB0aWxlSWQgPSAkKHRoaXMpLmRhdGEoJ3RpbGVJZCcpO1xuICAgICAgaWYgKHRpbGVJZCA+IHBvcyAtIHRpbGVCcFdpZHRoICYmIHRpbGVJZCA8IHBvcyArIGJwV2lkdGgpIHsgY2xpcHBlZCA9IHRydWU7IHJldHVybiBmYWxzZTsgfVxuICAgIH0pO1xuICAgIHRoaXMuJHNpZGUudG9nZ2xlQ2xhc3MoJ2NsaXBwZWQnLCBjbGlwcGVkKTtcbiAgfSxcbiAgXG4gIF90aWxlVG91Y2hFdmVudHM6IGZ1bmN0aW9uKCR0aWxlKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICR0aWxlLmJpbmQoJ3RvdWNoc3RhcnQnLCB7c2VsZjogc2VsZn0sIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGlmIChlLm9yaWdpbmFsRXZlbnQudG91Y2hlcy5sZW5ndGggPiAxKSB7IHJldHVybjsgfVxuICAgICAgZS5wYWdlWCA9IGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xuICAgICAgZS5wYWdlWSA9IGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VZO1xuICAgICAgc2VsZi5fdGlsZU1vdXNlTW92ZS5jYWxsKHRoaXMsIGUpO1xuICAgIH0pO1xuICB9LFxuICBcbiAgX3RpbGVNb3VzZU1vdmU6IGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgJHRhcmcgPSAkKGUudGFyZ2V0KSxcbiAgICAgICR0ZGF0YSA9ICR0YXJnLmNsb3Nlc3QoJy50ZGF0YScpLFxuICAgICAgc2VsZiA9IGUuZGF0YS5zZWxmLFxuICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgIHByZXYgPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2FyZWFIb3ZlcicpLFxuICAgICAgYXJlYXMsIHJhdGlvLCBicHBwO1xuICAgIGlmICghJHRkYXRhLmxlbmd0aCB8fCAhJHRkYXRhLmhhc0NsYXNzKCdkZW5zLWJlc3QnKSB8fCAhKGFyZWFzID0gJHRkYXRhLmRhdGEoJ2FyZWFzJykpKSB7XG4gICAgICBpZiAoISR0YXJnLmlzKCcuYXJlYScpKSB7IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignYXJlYUhvdmVyJywgZmFsc2UpOyB9XG4gICAgICByZXR1cm47IFxuICAgIH1cbiAgICBicHBwID0gJHRkYXRhLmRhdGEoJ2JwcHAnKTtcbiAgICByYXRpbyA9IGJwcHAgLyBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3pvb20nKTtcbiAgICB2YXIgb2Zmc2V0ID0gJCh0aGlzKS5vZmZzZXQoKSxcbiAgICAgIHggPSBlLnBhZ2VYIC0gb2Zmc2V0LmxlZnQsXG4gICAgICB5ID0gZS5wYWdlWSAtIG9mZnNldC50b3A7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmVhcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHYgPSBhcmVhc1tpXSwgYXJlYUlkO1xuICAgICAgaWYgKHggPiB2WzBdICogcmF0aW8gJiYgeCA8IHZbMl0gKiByYXRpbyAmJiB5ID4gdlsxXSAmJiB5IDwgdlszXSkge1xuICAgICAgICBpZiAoby50cmFjay5uICsgJy5ocmVmSGFzaC4nICsgdi5ocmVmSGFzaCAhPT0gcHJldikge1xuICAgICAgICAgIGFyZWFJZCA9ICQodGhpcykuYXR0cignaWQnKSArICcuJyArIGk7XG4gICAgICAgICAgby5icm93c2VyLmdlbm9icm93c2VyKCdhcmVhSG92ZXInLCBbby50cmFjay5uLCBicHBwLCAkdGRhdGEuZGF0YSgnZGVuc2l0eScpLCAnaHJlZkhhc2gnLCB2LmhyZWZIYXNoXSwgYXJlYUlkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghJHRhcmcuaXMoJy5hcmVhJykpIHsgby5icm93c2VyLmdlbm9icm93c2VyKCdhcmVhSG92ZXInLCBmYWxzZSk7IH1cbiAgICByZXR1cm47XG4gIH0sXG4gIFxuICBfdGlsZU1vdXNlT3V0OiBmdW5jdGlvbihlKSB7XG4gICAgdmFyICR0YXJnID0gJChlLnRhcmdldCksXG4gICAgICAkdGRhdGEgPSAkdGFyZy5jbG9zZXN0KCcudGRhdGEnKSxcbiAgICAgIHNlbGYgPSBlLmRhdGEuc2VsZixcbiAgICAgICRyZWxUYXJnZXQgPSAkKGUucmVsYXRlZFRhcmdldCk7XG4gICAgaWYgKCEkdGRhdGEubGVuZ3RoKSB7IHJldHVybjsgfVxuICAgIGlmICghJHJlbFRhcmdldC5pcygnLnRpbGUnKSAmJiAhJHJlbFRhcmdldC5jbG9zZXN0KCcudGlsZScpLmxlbmd0aCkgeyBzZWxmLm9wdGlvbnMuYnJvd3Nlci5nZW5vYnJvd3NlcignYXJlYUhvdmVyJywgZmFsc2UpOyB9XG4gIH0sXG4gIFxuICBfYXJlYU1vdXNlT3ZlcjogZnVuY3Rpb24oZSkge1xuICAgIHZhciBkID0gZS5kYXRhLFxuICAgICAgbyA9IGQuc2VsZi5vcHRpb25zO1xuICAgIG8uYnJvd3Nlci5nZW5vYnJvd3NlcignYXJlYUhvdmVyJywgW28udHJhY2subiwgZC5icHBwLCBkLmRlbnNpdHksICdocmVmSGFzaCcsIGQuaHJlZkhhc2hdLCBkLmFyZWFJZCk7XG4gIH0sXG4gIFxuICBmaXhDbGlja0FyZWFzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsXG4gICAgICBuZWFyZXN0ID0gdGhpcy5icHBwcygpLm5lYXJlc3QsXG4gICAgICBkZW5zaXR5T3JkZXIgPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2RlbnNpdHlPcmRlcicsIG8udHJhY2subik7XG4gICAgaWYgKCFvLnRyYWNrLm0gfHwgIW8udHJhY2subS5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgXy5lYWNoKG8udHJhY2subSwgZnVuY3Rpb24oZGVuc2l0eSkge1xuICAgICAgXy5lYWNoKG5lYXJlc3QsIGZ1bmN0aW9uKGJwcHApIHtcbiAgICAgICAgdmFyIGRlbnNpdGllcyA9IHNlbGYuYXZhaWxEZW5zaXRpZXNbYnBwcF0sXG4gICAgICAgICAgYmVzdERlbnNpdHkgPSBzZWxmLl9iZXN0RGVuc2l0eShicHBwKTtcbiAgICAgICAgaWYgKCFfLmluY2x1ZGUoZGVuc2l0aWVzLCBkZW5zaXR5KSkgeyByZXR1cm47IH1cbiAgICAgICAgJGVsZW0uZmluZCgnLmJwcHAtJytjbGFzc0ZyaWVuZGx5KGJwcHApKycgLnRkYXRhLmRlbnMtJytkZW5zaXR5Kycubm8tYXJlYXMnKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgc2VsZi5fYWRkQ2xpY2thYmxlQXJlYXModGhpcywgYnBwcCwgZGVuc2l0eSwgYmVzdERlbnNpdHkpO1xuICAgICAgICB9KS5yZW1vdmVDbGFzcygnbm8tYXJlYXMnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LFxuICBcbiAgX2FyZWFUaXBUaXBFbnRlcjogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICB2YXIgc2VsZiA9ICQodGhpcykuZGF0YSgnZ2Vub3RyYWNrJyksXG4gICAgICBocmVmID0gJCh0aGlzKS5hdHRyKCdocmVmJyksXG4gICAgICB0aXB0aXBEYXRhID0gJCh0aGlzKS5kYXRhKCd0aXB0aXBEYXRhJyksXG4gICAgICBvbGRUaXRsZSA9ICQodGhpcykuZGF0YSgndGl0bGUnKTtcbiAgICBpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdkcmFnZ2luZycpKSB7IHJldHVybiBjYWxsYmFjayhmYWxzZSk7IH1cbiAgICBmdW5jdGlvbiBjcmVhdGVUaXBUaXBIdG1sKGRhdGEpIHtcbiAgICAgIHZhciAkdGlwVGlwRGl2ID0gJCgnPGRpdi8+JyksXG4gICAgICAgICRuYW1lID0gJCgnPGRpdiBjbGFzcz1cIm5hbWVcIi8+JykuYXBwZW5kVG8oJHRpcFRpcERpdiksXG4gICAgICAgICR0YWJsZSA9ICQoJzx0YWJsZS8+JykuYXBwZW5kVG8oJHRpcFRpcERpdiksXG4gICAgICAgICR0Ym9keSA9ICQoJzx0Ym9keS8+JykuYXBwZW5kVG8oJHRhYmxlKSxcbiAgICAgICAgJHByZXZEZXNjVHI7XG4gICAgICBfLmVhY2goZGF0YSwgZnVuY3Rpb24odiwgaykge1xuICAgICAgICB2YXIgJHRyO1xuICAgICAgICBpZiAoL15kZXNjcmlwdGlvbiR8XnR5cGUkfHJlZnNlcSBzdW1tYXJ5L2kudGVzdChrKSkge1xuICAgICAgICAgICRwcmV2RGVzY1RyID0gJHRib2R5LmNoaWxkcmVuKCcuZGVzYycpO1xuICAgICAgICAgIGlmICgkcHJldkRlc2NUci5sZW5ndGgpIHsgJHRyID0gJCgnPHRyIGNsYXNzPVwiZGVzY1wiLz4nKS5pbnNlcnRBZnRlcigkcHJldkRlc2NUcik7IH1cbiAgICAgICAgICBlbHNlIHsgJHRyID0gJCgnPHRyIGNsYXNzPVwiZGVzY1wiLz4nKS5wcmVwZW5kVG8oJHRib2R5KTsgfVxuICAgICAgICAgIGlmICh2Lmxlbmd0aCA+IDMwMCkgeyB2ID0gdi5zdWJzdHIoMCwgMzAwKS5yZXBsYWNlKC9cXHMrXFxTKyQvLCAnJykgKyAnLi4uJzsgfVxuICAgICAgICAgICQoJzx0ZCBjb2xzcGFuPVwiMlwiLz4nKS50ZXh0KHYpLmFwcGVuZFRvKCR0cik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJHRyID0gJCgnPHRyLz4nKS5hcHBlbmRUbygkdGJvZHkpO1xuICAgICAgICAgIGlmICh2ID09ICctLS0nKSB7XG4gICAgICAgICAgICAkKCc8dGQgY29sc3Bhbj1cIjJcIiBjbGFzcz1cImZpZWxkcy1oZWFkZXJcIi8+JykudGV4dChrKS5hcHBlbmRUbygkdHIpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKCc8dGQgY2xhc3M9XCJmaWVsZFwiIHdpZHRoPVwiNDUlXCIvPicpLnRleHQoaykuYXBwZW5kVG8oJHRyKTtcbiAgICAgICAgICAgICQoJzx0ZCBjbGFzcz1cInZhbHVlXCIgd2lkdGg9XCI1NSVcIi8+JykudGV4dCh2KS5hcHBlbmRUbygkdHIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBpZiAob2xkVGl0bGUpIHsgJG5hbWUudGV4dChvbGRUaXRsZSk7IH1cbiAgICAgIGNhbGxiYWNrKCR0aXBUaXBEaXYpO1xuICAgIH1cbiAgICBpZiAodGlwdGlwRGF0YSkge1xuICAgICAgY3JlYXRlVGlwVGlwSHRtbCh0aXB0aXBEYXRhKTtcbiAgICB9IGVsc2UgaWYgKC9eaHR0cHM/OlxcL1xcLy8udGVzdChocmVmKSkge1xuICAgICAgJC5hamF4KHNlbGYub3B0aW9ucy5hamF4RGlyICsgJ3Rvb2x0aXAucGhwJywge1xuICAgICAgICBkYXRhOiB7dXJsOiBocmVmfSxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgc3VjY2VzczogY3JlYXRlVGlwVGlwSHRtbFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICBcbiAgbWFrZUFuY2hvcjogZnVuY3Rpb24oJHRpbGUsIGFyZWEsIGJwcHAsIGRlbnNpdHksIGZsYWdzKSB7XG4gICAgdmFyIGJlc3REZW5zaXR5ID0gdGhpcy5fYmVzdERlbnNpdHkoYnBwcCksXG4gICAgICBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgY3VzdG9tID0gby50cmFjay5jdXN0b20sXG4gICAgICBkZWZhdWx0Q29sb3IgPSAoY3VzdG9tICYmIGN1c3RvbS5vcHRzLmNvbG9yKSB8fCAnMCwwLDAnLFxuICAgICAgdGlwVGlwT3B0aW9ucyA9IHtcbiAgICAgICAgYXN5bmM6IHRydWUsIGRlbGF5OiA0MDAsXG4gICAgICAgIGVudGVyOiB0aGlzLl9hcmVhVGlwVGlwRW50ZXJcbiAgICAgIH0sXG4gICAgICBoYXNoID0gc2hvcnRIYXNoKGFyZWFbNV0pLFxuICAgICAgc2NhbGVUb1BjdCA9IDEwMCAvIG8udGlsZVdpZHRoLFxuICAgICAgJGEgPSAkLm1rKCdhJykuYWRkQ2xhc3MoJ2FyZWEgZGVucy0nK2RlbnNpdHkrJyBocmVmLWhhc2gtJytoYXNoKS5hdHRyKCd0aXRsZScsIGFyZWFbNF0pO1xuICAgICRhLmF0dHIoJ2hyZWYnLCAoY3VzdG9tID8gJycgOiB0aGlzLmJhc2VVUkwpICsgYXJlYVs1XSkuYXR0cigndGFyZ2V0JywgJ19ibGFuaycpO1xuICAgICRhLmNzcyh7dG9wOiBhcmVhWzFdLCBoZWlnaHQ6IGFyZWFbM10gLSBhcmVhWzFdIC0gMn0pO1xuICAgIGlmIChmbGFncy5sYWJlbCkgeyBcbiAgICAgICRhLmNzcyh7cmlnaHQ6ICgxMDAgLSBhcmVhWzBdICogc2NhbGVUb1BjdCkgKyAnJScsIGNvbG9yOiAncmdiKCcgKyAoYXJlYVs3XSB8fCBkZWZhdWx0Q29sb3IpICsgJyknfSkuYWRkQ2xhc3MoJ2xhYmVsJyk7XG4gICAgICBpZiAoYXJlYVs4XSkgeyAkYS5odG1sKGFyZWFbOF0pIH0gZWxzZSB7ICRhLnRleHQoYXJlYVs0XSk7IH1cbiAgICAgICRhLm1vdXNlb3Zlcih7c2VsZjogdGhpcywgYnBwcDogYnBwcCwgZGVuc2l0eTogZGVuc2l0eSwgaHJlZkhhc2g6IGhhc2gsIGFyZWFJZDogJHRpbGUuYXR0cignaWQnKSArICcuJyArIGZsYWdzLml9LCB0aGlzLl9hcmVhTW91c2VPdmVyKTtcbiAgICB9IGVsc2UgeyBcbiAgICAgICRhLmFkZENsYXNzKCdyZWN0JykuY3NzKHtsZWZ0OiAoYXJlYVswXSAqIHNjYWxlVG9QY3QpICsgJyUnLCB3aWR0aDogKChhcmVhWzJdIC0gYXJlYVswXSkgKiBzY2FsZVRvUGN0KSArICclJ30pO1xuICAgICAgaWYgKGZsYWdzLmZsYXNobWUpIHtcbiAgICAgICAgJGEuYWRkQ2xhc3MoJ2ZsYXNoaW5nJykuZWZmZWN0KFwicHVsc2F0ZVwiLCB7dGltZXM6IDJ9LCAxMDAwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAkKHRoaXMpLmZhZGVPdXQoMzAwLCBmdW5jdGlvbigpIHsgJCh0aGlzKS5yZW1vdmVDbGFzcygnZmxhc2hpbmcnKTsgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKGZsYWdzLmhvdmVyKSB7ICRhLmFkZENsYXNzKCdob3ZlcicpOyB9XG4gICAgICBpZiAoZmxhZ3MudGlwVGlwQWN0aXZhdGVkKSB7IHRpcFRpcE9wdGlvbnMuc3RhcnRBY3RpdmF0ZWQgPSB0cnVlOyB9XG4gICAgfVxuICAgICRhLmRhdGEoJ2dlbm90cmFjaycsIHRoaXMpLnRpcFRpcCh0aXBUaXBPcHRpb25zKTtcbiAgICBpZiAoYXJlYVs5XSkgeyAkYS5kYXRhKCd0aXB0aXBEYXRhJywgYXJlYVs5XSk7IH1cbiAgICByZXR1cm4gJGEuZGF0YSgnaHJlZkhhc2gnLCBoYXNoKS50b2dnbGVDbGFzcygnZGVucy1iZXN0JywgZGVuc2l0eSA9PSBiZXN0RGVuc2l0eSkuYXBwZW5kVG8oJHRpbGUpO1xuICB9LFxuICBcbiAgX2FyZWFEYXRhRmV0Y2g6IGZ1bmN0aW9uKGUpIHtcbiAgICAkLmFqYXgoZS5kYXRhLnNyYyArICcuanNvbicsIHtcbiAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICBzdWNjZXNzOiBlLmRhdGEuc3VjY2VzcyxcbiAgICAgIGJlZm9yZVNlbmQ6IGUuZGF0YS5iZWZvcmVTZW5kXG4gICAgfSk7XG4gIH0sXG4gIFxuICBfYXJlYURhdGFMb2FkOiBmdW5jdGlvbihkYXRhLCBzdGF0dXNUZXh0LCBqcVhIUikge1xuICAgIC8vIE5PVEU6IHRoaXMgaXMgdXNlZCBhcyBhbiBBSkFYIGNhbGxiYWNrLCBzbyB0aGlzL3NlbGYgbXVzdCBiZSByZW9idGFpbmVkIGZyb20gdGhlIGpxWEhSIG9iamVjdFxuICAgIHZhciBvID0ganFYSFIuX3NlbGYub3B0aW9ucyxcbiAgICAgICR0aWxlID0gJChqcVhIUi5fYXBwZW5kVG8pLFxuICAgICAgdGlsZUlkID0gJHRpbGUuYXR0cignaWQnKSxcbiAgICAgICR0ZGF0YSA9ICR0aWxlLmNoaWxkcmVuKCcudGRhdGEuZGVucy0nK2pxWEhSLl9kZW5zaXR5KTtcbiAgICBcbiAgICBmdW5jdGlvbiBjcmVhdGVBcmVhcyhlKSB7XG4gICAgICBfLmVhY2goJHRkYXRhLmRhdGEoJ2FyZWFzJyksIGZ1bmN0aW9uKHYsIGkpIHtcbiAgICAgICAgLy8gV2UgaGF2ZSB0byBtYWtlIHRoZSBsYWJlbCA8YT4ncyBmb3IgY3VzdG9tIHRyYWNrc1xuICAgICAgICBpZiAoanFYSFIuX2N1c3RvbSAmJiAhdls2XSkge1xuICAgICAgICAgIGpxWEhSLl9zZWxmLm1ha2VBbmNob3IoJHRpbGUsIHYsIGpxWEhSLl9icHBwLCBqcVhIUi5fZGVuc2l0eSwge2xhYmVsOiAhanFYSFIuX2N1c3RvbS5ub0FyZWFMYWJlbHMsIGk6IGl9KTsgXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgXG4gICAgLy8gQXJlYXMgYXJlIHN0b3JlZCBpbiBhIGdsb2JhbCBpbmRleCwgc28gdGhhdCBtb3VzaW5nIG92ZXIgYW4gYXJlYSBpbiBvbmUgdGlsZSBjYW4gcmV0cmlldmVcbiAgICAvLyBhcmVhcyB3aXRoIGEgc2ltaWxhciBuYW1lL2hyZWZIYXNoIHRoYXQgbXVzdCBhbHNvIGJlIGhpZ2hsaWdodGVkLiBcbiAgICAvLyBTZWUgJC51aS5nZW5vYnJvd3NlcidzIC5hcmVhSG92ZXIoKSBmb3IgaG93IGl0IGlzIHRyYXZlcnNlZCBkdXJpbmcgbW91c2VvdmVyLlxuICAgIC8vIEFkZCB0byBnbG9iYWwgYXJlYSBpbmRleDogYXJlYUluZGV4W3RyYWNrXVticHBwXVtkZW5zaXR5XVtcImhyZWZIYXNoXCJ8XCJuYW1lXCJdW2hyZWZIYXNofG5hbWVdW3RpbGVJZF1baV0gPSB0cnVlXG4gICAgLy8gRklYTUU6IHRoZSBnbG9iYWwgYXJlYSBpbmRleCBjYW4gZ2V0IHZlcnkgYmlnIG92ZXIgdGltZTsgYXMgb2Ygbm93LCBpdCBpcyBuZXZlciBwcnVuZWQuXG4gICAgXy5lYWNoKGRhdGEsIGZ1bmN0aW9uKHYsIGkpIHtcbiAgICAgIHZhciBpbmRleCA9IGpxWEhSLl9hcmVhSW5kZXgsXG4gICAgICAgIGtleXMgPSBbby50cmFjay5uLCBqcVhIUi5fYnBwcCwganFYSFIuX2RlbnNpdHldLFxuICAgICAgICBpbmRleEJ5ID0ge2hyZWZIYXNoOiBzaG9ydEhhc2godls1XSB8fCAnJyksIG5hbWU6ICh2WzRdIHx8ICcnKS50b0xvd2VyQ2FzZSgpfTtcbiAgICAgIHYuaHJlZkhhc2ggPSBpbmRleEJ5LmhyZWZIYXNoO1xuICAgICAgXy5lYWNoKGtleXMsIGZ1bmN0aW9uKGspIHtcbiAgICAgICAgaWYgKCFpbmRleFtrXSkgeyBpbmRleFtrXSA9IHt9OyB9XG4gICAgICAgIGluZGV4ID0gaW5kZXhba107XG4gICAgICB9KTtcbiAgICAgIGlmICghaW5kZXguaHJlZkhhc2gpIHsgaW5kZXguaHJlZkhhc2ggPSB7fTsgaW5kZXgubmFtZSA9IHt9OyB9XG4gICAgICBfLmVhY2goWydocmVmSGFzaCcsICduYW1lJ10sIGZ1bmN0aW9uKGJ5KSB7XG4gICAgICAgIHZhciBrZXkgPSBpbmRleEJ5W2J5XTtcbiAgICAgICAgaWYgKCFpbmRleFtieV1ba2V5XSkgeyBpbmRleFtieV1ba2V5XSA9IHt9OyB9XG4gICAgICAgIGlmICghaW5kZXhbYnldW2tleV1bdGlsZUlkXSkgeyBpbmRleFtieV1ba2V5XVt0aWxlSWRdID0ge307IH1cbiAgICAgICAgaW5kZXhbYnldW2tleV1bdGlsZUlkXVtpXSA9IHRydWU7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICAkdGRhdGEuZGF0YSgnYXJlYXMnLCBkYXRhKS5kYXRhKCdicHBwJywganFYSFIuX2JwcHApLmRhdGEoJ2RlbnNpdHknLCBqcVhIUi5fZGVuc2l0eSkucmVtb3ZlQ2xhc3MoJ2FyZWFzLWxvYWRpbmcnKTtcbiAgICBcbiAgICBpZiAoanFYSFIuX2N1c3RvbSkge1xuICAgICAgJHRkYXRhLm9uZSgnYmVzdERlbnNpdHknLCBjcmVhdGVBcmVhcyk7XG4gICAgICBpZiAoanFYSFIuX2RlbnNpdHkgPT0ganFYSFIuX2Jlc3REZW5zaXR5KSB7ICR0ZGF0YS50cmlnZ2VyKCdiZXN0RGVuc2l0eScpOyB9XG4gICAgfVxuICAgIGlmICgtLWpxWEhSLl9zZWxmLmFyZWFMb2FkQ291bnRlciA9PT0gMCkgeyAkKGpxWEhSLl9zZWxmLmVsZW1lbnQpLnRyaWdnZXIoJ2FyZWFsb2FkJywganFYSFIuX2Jlc3REZW5zaXR5KTsgfTtcbiAgfSxcbiAgXG4gIF9hZGRDbGlja2FibGVBcmVhczogZnVuY3Rpb24odGRhdGFFbGVtLCBicHBwLCBkZW5zaXR5LCBiZXN0RGVuc2l0eSkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICB0YWdOYW1lID0gdGRhdGFFbGVtLnRhZ05hbWUudG9Mb3dlckNhc2UoKSxcbiAgICAgICR0ZGF0YSA9ICQodGRhdGFFbGVtKSxcbiAgICAgIGFyZWFEYXRhLCBlZGF0YTtcbiAgICBzZWxmLmFyZWFMb2FkQ291bnRlcisrO1xuICAgICR0ZGF0YS5hZGRDbGFzcygnYXJlYXMtbG9hZGluZycpO1xuICAgIHNlbGYuYmFzZVVSTCA9IHNlbGYuYmFzZVVSTCB8fCBvLnVjc2NVUkwucmVwbGFjZSgvW15cXC9dKyQvLCAnJyk7XG4gICAgZnVuY3Rpb24gYmVmb3JlU2VuZChqcVhIUikgeyBcbiAgICAgICQuZXh0ZW5kKGpxWEhSLCB7XG4gICAgICAgIF9hcHBlbmRUbzogdGRhdGFFbGVtLnBhcmVudE5vZGUsXG4gICAgICAgIF9zZWxmOiBzZWxmLFxuICAgICAgICBfYnBwcDogYnBwcCxcbiAgICAgICAgX2Jlc3REZW5zaXR5OiBiZXN0RGVuc2l0eSxcbiAgICAgICAgX2RlbnNpdHk6IGRlbnNpdHksXG4gICAgICAgIF9hcmVhSW5kZXg6IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignYXJlYUluZGV4JylcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBpZiAodGFnTmFtZSA9PSAnaW1nJykge1xuICAgICAgLy8gVE9ETzogbWFrZSB0aGlzIGFib3J0YWJsZSwgZm9yIHdoZW4gZml4VGlsZXMoZm9yY2VSZXBvcz10cnVlKSBpcyBjYWxsZWQgYmVmb3JlIGl0IGZpbmlzaGVzIVxuICAgICAgZWRhdGEgPSB7c3JjOiB0ZGF0YUVsZW0uc3JjLCBzdWNjZXNzOiBzZWxmLl9hcmVhRGF0YUxvYWQsIGJlZm9yZVNlbmQ6IGJlZm9yZVNlbmR9O1xuICAgICAgaWYgKGRlbnNpdHk9PWJlc3REZW5zaXR5KSB7IHNlbGYuX2FyZWFEYXRhRmV0Y2goe2RhdGE6IGVkYXRhfSk7IH1cbiAgICAgIGVsc2UgeyAkdGRhdGEub25lKCdiZXN0RGVuc2l0eScsIGVkYXRhLCBzZWxmLl9hcmVhRGF0YUZldGNoKTsgfVxuICAgIH0gZWxzZSBpZiAodGFnTmFtZSA9PSAnY2FudmFzJyAmJiBvLnRyYWNrLmN1c3RvbS5hcmVhcyAmJiAoYXJlYURhdGEgPSBvLnRyYWNrLmN1c3RvbS5hcmVhc1t0ZGF0YUVsZW0uaWRdKSkge1xuICAgICAgLy8gRm9yIDxjYW52YXM+IHRpbGVzIG9uIGN1c3RvbSB0cmFja3MsIHdlIHNob3VsZCBhbHJlYWR5IGhhdmUgdGhpcyBpbmZvIGluIG8udHJhY2suY3VzdG9tLmFyZWFzXG4gICAgICBtb2NrSnFYSFIgPSB7X2N1c3RvbTogby50cmFjay5jdXN0b219O1xuICAgICAgYmVmb3JlU2VuZChtb2NrSnFYSFIpO1xuICAgICAgc2VsZi5fYXJlYURhdGFMb2FkKGFyZWFEYXRhLCAnJywgbW9ja0pxWEhSKTtcbiAgICB9IGVsc2UgeyBcbiAgICAgIHNlbGYuYXJlYUxvYWRDb3VudGVyLS07XG4gICAgICAkKHRkYXRhRWxlbSkucmVtb3ZlQ2xhc3MoJ2FyZWFzLWxvYWRpbmcnKTtcbiAgICB9XG4gIH0sXG4gIFxuICBfc2hvd1RpbGU6IGZ1bmN0aW9uKCR0KSB7XG4gICAgJHQuYWRkQ2xhc3MoJ3RpbGUtc2hvdycpLmNzcygnei1pbmRleCcsICR0LmRhdGEoJ3pJbmRleCcpKTtcbiAgfSxcbiAgXG4gIF9yZXBvc1RpbGU6IGZ1bmN0aW9uKCR0aWxlLCB0aWxlSWQsIHpvb20sIGJwcHApIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcbiAgICAkdGlsZS5jc3MoJ2xlZnQnLCAodGlsZUlkIC0gby5saW5lLmdlbm9saW5lKCdvcHRpb24nLCAnb3JpZ2luJykpIC8gem9vbSk7XG4gICAgJHRpbGUuY3NzKCd3aWR0aCcsIE1hdGguY2VpbChvLnRpbGVXaWR0aCAqIGJwcHAgLyB6b29tKSk7XG4gICAgXG4gICAgaWYgKHRoaXMucnVsZXIgJiYgYnBwcCA8PSBvLm50c0JlbG93WzBdKSB7XG4gICAgICAkdGlsZS5maW5kKCdzdmcnKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgd2lkdGggPSAkdGlsZS53aWR0aCgpICsgJ3B4JztcbiAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcIndpZHRoXCIsIHdpZHRoKTtcbiAgICAgICAgdGhpcy5maXJzdENoaWxkLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwieVwiLCBcIjExXCIpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICBcbiAgX3NwZWNpYWxUaWxlOiBmdW5jdGlvbih0aWxlSWQsIGJwcHApIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcbiAgICBpZiAodGlsZUlkIDwgMCB8fCB0aWxlSWQgPiBvLmdlbm9tZVNpemUpIHsgcmV0dXJuIHtibGFuazogdHJ1ZSwgbGVmdDogdGlsZUlkIDwgMH07IH1cbiAgICBpZiAoby50cmFjay5jdXN0b20pIHsgcmV0dXJuIHtjdXN0b206IHRydWV9OyB9XG4gICAgaWYgKHRoaXMucnVsZXIgJiYgKGJwcHAgPD0gby5pZGVvZ3JhbXNBYm92ZSB8fCAhby5jaHJCYW5kcykpIHsgcmV0dXJuIHtydWxlcjogdHJ1ZX07IH1cbiAgfSxcbiAgXG4gIF90aWxlU3JjOiBmdW5jdGlvbih0aWxlSWQsIGJwcHAsIGRlbnNpdHkpIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgIGJGID0gdGhpcy5fYnBwcEZvcm1hdChicHBwKSxcbiAgICAgIGltZ05hbWUgPSBwYWQodGlsZUlkLCAxMCkgKyAnLnBuZyc7XG4gICAgaWYgKGJwcHAgPCBvLnN1YmRpckZvckJwcHBzVW5kZXIpIHsgaW1nTmFtZSA9IGltZ05hbWUuc3Vic3RyKDAsIDQpICsgJy8nICsgaW1nTmFtZS5zdWJzdHIoNCk7IH1cbiAgICB2YXIgcmV0ID0ge1xuICAgICAgZnVsbDogdGhpcy5ydWxlciA/ICdpZGVvZ3JhbXMvJytiRisnLycraW1nTmFtZSA6IG8udHJhY2subisnLycrYkYrJ18nK2RlbnNpdHkrJy8nK2ltZ05hbWUsXG4gICAgICBicHBwRm9ybWF0OiBiRlxuICAgIH07XG4gICAgcmV0dXJuIHJldDtcbiAgfSxcbiAgXG4gIF9icHBwRm9ybWF0OiBmdW5jdGlvbihicHBwKSB7IHJldHVybiB0aGlzLm9wdGlvbnMuYnBwcEZvcm1hdChicHBwKTsgfSxcbiAgXG4gIF90aWxlSWQ6IGZ1bmN0aW9uKHRpbGVJZCwgYnBwcCkgeyBcbiAgICByZXR1cm4gdGhpcy51bmlxSWQgKyAnLXRpbGUtJyArIGJwcHAudG9TdHJpbmcoKS5yZXBsYWNlKCcuJywgJy0nKSArICctJyArIHRpbGVJZDtcbiAgfSxcbiAgXG4gIF9maXhMYWJlbHM6IGZ1bmN0aW9uKGZvcmNlUmVwb3MpIHtcbiAgICBpZiAoIXRoaXMucnVsZXIpIHsgcmV0dXJuOyB9XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICRlbGVtID0gc2VsZi5lbGVtZW50LFxuICAgICAgYXZhaWxXaWR0aCA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignbGluZVdpZHRoJyksXG4gICAgICBwb3MgPSBvLmxpbmUuZ2Vub2xpbmUoJ2dldFBvcycpLFxuICAgICAgem9vbSA9IG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignem9vbScpLFxuICAgICAgbGVmdE1hcmcgPSBwb3MgLSBhdmFpbFdpZHRoICogem9vbSAqIDAuNSxcbiAgICAgIHJpZ2h0TWFyZyA9IHBvcyArIDEuNSAqIGF2YWlsV2lkdGggKiB6b29tLFxuICAgICAgYnBwcHMgPSB0aGlzLmJwcHBzKCksXG4gICAgICBsYWJlbHNOZWVkZWQgPSBfLmZpbHRlcihvLmNockxhYmVscywgZnVuY3Rpb24odikgeyByZXR1cm4gdi5wID4gbGVmdE1hcmcgJiYgdi5wIDwgcmlnaHRNYXJnOyB9KSxcbiAgICAgIGxhYmVsRWxlbWVudHMgPSBbXTtcbiAgICBfLmVhY2gobGFiZWxzTmVlZGVkLCBmdW5jdGlvbih2KSB7XG4gICAgICB2YXIgcmVwb3MgPSBmYWxzZSwgJGwgPSAkZWxlbS5jaGlsZHJlbignLmxhYmVsLScgKyB2LnApO1xuICAgICAgaWYgKCEkbC5sZW5ndGgpIHsgJGwgPSBzZWxmLl9hZGRMYWJlbCh2LCB6b29tKTsgcmVwb3MgPSB0cnVlOyB9XG4gICAgICBpZiAocmVwb3MgfHwgZm9yY2VSZXBvcykgeyBzZWxmLl9yZXBvc0xhYmVsKCRsLCB2LCB6b29tKTsgfVxuICAgICAgbGFiZWxFbGVtZW50cy5wdXNoKCRsLmdldCgwKSk7XG4gICAgfSk7XG4gICAgJGVsZW0uY2hpbGRyZW4oJy5sYWJlbCcpLm5vdChsYWJlbEVsZW1lbnRzKS5yZW1vdmUoKTtcbiAgICBcbiAgICBpZiAoby5jaHJCYW5kcyAmJiB6b29tIDw9IG8uaWRlb2dyYW1zQWJvdmUpIHtcbiAgICAgIHZhciBmaXJzdEJhbmRJbmRleCA9IF8uc29ydGVkSW5kZXgoby5jaHJCYW5kcywgWzAsIDAsIGxlZnRNYXJnXSwgZnVuY3Rpb24odikgeyByZXR1cm4gdlsyXTsgfSksXG4gICAgICAgIGxhc3RCYW5kSW5kZXggPSBfLnNvcnRlZEluZGV4KG8uY2hyQmFuZHMsIFswLCByaWdodE1hcmddLCBmdW5jdGlvbih2KSB7IHJldHVybiB2WzFdOyB9KSxcbiAgICAgICAgYmFuZHNOZWVkZWQgPSBvLmNockJhbmRzLnNsaWNlKGZpcnN0QmFuZEluZGV4LCBsYXN0QmFuZEluZGV4KSxcbiAgICAgICAgYmFuZEVsZW1lbnRzID0gW107XG4gICAgICBfLmVhY2goYmFuZHNOZWVkZWQsIGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgdmFyIHJlcG9zID0gZmFsc2UsICRiID0gJCgnIycgKyBzZWxmLl90aWxlSWQodlsxXSwgJ2JhbmQnKSk7XG4gICAgICAgIGlmICghJGIubGVuZ3RoKSB7ICRiID0gc2VsZi5fYWRkQmFuZCh2LCB6b29tKTsgcmVwb3MgPSB0cnVlOyB9XG4gICAgICAgIGlmIChyZXBvcyB8fCBmb3JjZVJlcG9zKSB7IHNlbGYuX3JlcG9zQmFuZCgkYiwgdiwgem9vbSk7IH1cbiAgICAgICAgYmFuZEVsZW1lbnRzLnB1c2goJGIuZ2V0KDApKTtcbiAgICAgIH0pO1xuICAgICAgJGVsZW0uY2hpbGRyZW4oJy5iYW5kJykubm90KGJhbmRFbGVtZW50cykucmVtb3ZlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRlbGVtLmNoaWxkcmVuKCcuYmFuZCcpLnJlbW92ZSgpO1xuICAgIH1cbiAgfSxcbiAgXG4gIF9ydWxlclRpbGU6IGZ1bmN0aW9uKCR0LCB0aWxlSWQsIGJwcHApIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgYnBQZXJUaWxlID0gYnBwcCAqIG8udGlsZVdpZHRoLFxuICAgICAgem9vbSA9IG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignem9vbScpO1xuICAgICR0LmFkZENsYXNzKCd0aWxlLXJ1bGVyIGJwcHAtJytjbGFzc0ZyaWVuZGx5KGJwcHApKS5kYXRhKCdicHBwJywgYnBwcCk7XG4gICAgXG4gICAgc2VsZi5fZHJhd0NhbnZhc1RpY2tzKCR0LCB0aWxlSWQsIGJwcHAsIHpvb20pO1xuICAgIFxuICAgIGlmIChicHBwIDw9IG8ubnRzQmVsb3dbMF0pIHtcbiAgICAgIHZhciBzaG93TnRUZXh0ID0gYnBwcCA8PSBvLm50c0JlbG93WzFdLFxuICAgICAgICBjYW52YXNIZWlnaHQgPSAoc2hvd050VGV4dCA/IDEyIDogMykgKyAoby5jaHJCYW5kcyA/IDEgOiAwKSwgLy8gd2l0aCBiYW5kcywgd2UgbmVlZCBhbiBleHRyYSBwaXhlbFxuICAgICAgICBjYW52YXNBdHRycyA9IHt3aWR0aDogby50aWxlV2lkdGgsIGhlaWdodDogY2FudmFzSGVpZ2h0LCBcImNsYXNzXCI6IFwibnRkYXRhXCJ9O1xuICAgICAgJHQuYWRkQ2xhc3MoJ3RpbGUtbnRkYXRhIHRpbGUtbG9hZGVkJyk7XG4gICAgICAkdC50b2dnbGVDbGFzcyhvLmNockJhbmRzID8gJ3RpbGUtb3ZlcmxheS1udGRhdGEnIDogJ3RpbGUtYmlnLW50ZGF0YScsIHNob3dOdFRleHQpO1xuICAgICAgaWYgKG8uY2hyQmFuZHMgJiYgc2hvd050VGV4dCkgeyAkdC5kYXRhKCd6SW5kZXgnLCAxMDEpOyB9IC8vIGlmIHdlIGhhdmUgYmFuZHMsIGRyYXcgaXQgb24gdG9wIG9mIHRoZSBiYW5kcy5cbiAgICAgIG8uYnJvd3Nlci5nZW5vYnJvd3NlcignZ2V0RE5BJywgdGlsZUlkLCB0aWxlSWQgKyBicFBlclRpbGUsIHNlbGYuX250U2VxdWVuY2VMb2FkLCB7XG4gICAgICAgIF9jOiAkLm1rKCdjYW52YXMnKS5hdHRyKGNhbnZhc0F0dHJzKS5jc3MoJ2hlaWdodCcsIGNhbnZhc0hlaWdodCkuYXBwZW5kVG8oJHQpLFxuICAgICAgICBfZDogc2hvd050VGV4dCAmJiAkLm1rKCdkaXYnKS5hZGRDbGFzcygnbnRzJykuYXBwZW5kVG8oJHQpLFxuICAgICAgICBfdzogTWF0aC5jZWlsKG8udGlsZVdpZHRoICogYnBwcCAvIHpvb20pLFxuICAgICAgICBfc2VsZjogc2VsZlxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICBcbiAgX2RyYXdDYW52YXNUaWNrczogZnVuY3Rpb24oJHQsIHRpbGVJZCwgYnBwcCwgem9vbSkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICBjaHIgPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2NockF0JywgdGlsZUlkKSxcbiAgICAgIGJwUGVyVGlsZSA9IGJwcHAgKiBvLnRpbGVXaWR0aCxcbiAgICAgIHNjYWxlID0gTWF0aC5yb3VuZChNYXRoLmxvZyhicFBlclRpbGUgLyAxMCkvTWF0aC5sb2coMTApKjIpLFxuICAgICAgdG9vTG9uZyA9IHRpbGVJZC50b1N0cmluZygpLmxlbmd0aCA+IDggJiYgc2NhbGUgPCA2LFxuICAgICAgc3RlcCA9IHNjYWxlICUgMiA/ICh0b29Mb25nID8gNSA6IDIpICogTWF0aC5wb3coMTAsIGZsb29ySGFjayhzY2FsZS8yKSkgOiBNYXRoLnBvdygxMCwgc2NhbGUvMiksXG4gICAgICBtYWpvclN0ZXAgPSBzY2FsZSAlIDIgPyAodG9vTG9uZyA/IFtzdGVwICogMiwgc3RlcCAqIDJdIDogW3N0ZXAgKiA1LCBzdGVwICogNV0pIDogW3N0ZXAgKiA1LCBzdGVwICogMTBdLFxuICAgICAgc3RhcnQgPSBmbG9vckhhY2soKHRpbGVJZCAtIGNoci5wKSAvIHN0ZXApICogc3RlcCArIHN0ZXAsXG4gICAgICBuZXdDaHI7XG4gICAgXG4gICAgaWYgKGJwcHAgPD0gby5icHBwTnVtYmVyc0JlbG93WzBdKSB7XG4gICAgICAkdC50b2dnbGVDbGFzcygndGlsZS1oYWxmd2F5JywgYnBwcCA9PSBvLmJwcHBOdW1iZXJzQmVsb3dbMF0pO1xuICAgICAgJHQudG9nZ2xlQ2xhc3MoJ3RpbGUtbG9hZGVkJywgYnBwcCA8PSBvLmJwcHBOdW1iZXJzQmVsb3dbMV0pO1xuICAgICAgaWYgKG8udXNlQ2FudmFzVGlja3MpIHtcbiAgICAgICAgLy8gVGhpcyBtYXkgYWxsZXZpYXRlIHNvbWUgb2YgdGhlIGV4Y2Vzc2l2ZSBlbGVtZW50IGNyZWF0aW9uIHRoYXQgb2NjdXJzIHdpdGggdGhlIEhUTUwgbWV0aG9kXG4gICAgICAgIHN0YXJ0IC09IHN0ZXA7XG4gICAgICAgIHZhciBvZmZzZXRGb3JOdFRleHQgPSAhby5jaHJCYW5kcyAmJiBicHBwIDw9IG8ubnRzQmVsb3dbMV0sXG4gICAgICAgICAgY2FudmFzSGVpZ2h0ID0gby5jaHJCYW5kcyA/IDIzIDogKG9mZnNldEZvck50VGV4dCA/IDEyIDogMjMpLFxuICAgICAgICAgIGNhbnZhc1dpZHRoID0gYnBwcCAvIHpvb20gKiBvLnRpbGVXaWR0aCxcbiAgICAgICAgICAkb2xkQyA9ICR0LmNoaWxkcmVuKCdjYW52YXMudGlja3MnKSxcbiAgICAgICAgICBjYW52YXNBdHRycyA9IHt3aWR0aDogY2FudmFzV2lkdGgsIGhlaWdodDogY2FudmFzSGVpZ2h0LCBcImNsYXNzXCI6IFwidGlja3NcIiArICgkb2xkQy5sZW5ndGggPyAnIGhpZGRlbicgOiAnJyl9LFxuICAgICAgICAgICRjID0gJC5taygnY2FudmFzJykuY3NzKCdoZWlnaHQnLCBjYW52YXNIZWlnaHQpLnByZXBlbmRUbygkdCksXG4gICAgICAgICAgY3R4ID0gJGMuZ2V0KDApLmdldENvbnRleHQgJiYgJGMuZ2V0KDApLmdldENvbnRleHQoJzJkJyksXG4gICAgICAgICAgdGV4dFkgPSBvLmNockJhbmRzID8gMTYgOiAob2Zmc2V0Rm9yTnRUZXh0ID8gMTAgOiAxNiksXG4gICAgICAgICAgZGVmYXVsdEZvbnQgPSBcIjExcHggJ0x1Y2lkYSBHcmFuZGUnLFRhaG9tYSxBcmlhbCxMaWJlcmF0aW9uIFNhbnMsRnJlZVNhbnMsc2Fucy1zZXJpZlwiO1xuICAgICAgICBpZiAoJC5icm93c2VyLm9wZXJhKSB7IGRlZmF1bHRGb250ID0gXCIxMnB4IEFyaWFsLHNhbnMtc2VyaWZcIjsgfSAvLyBPcGVyYSBjYW4gb25seSByZW5kZXIgQXJpYWwgZGVjZW50bHkgb24gY2FudmFzXG4gICAgICAgIGlmICghY3R4KSB7IHJldHVybjsgfVxuICAgICAgICAkYy5hdHRyKGNhbnZhc0F0dHJzKTtcbiAgICAgICAgY3R4LmZvbnQgPSBkZWZhdWx0Rm9udDtcbiAgICAgICAgZm9yICh2YXIgdCA9IHN0YXJ0OyB0ICsgY2hyLnAgPCB0aWxlSWQgKyBicHBwICogby50aWxlV2lkdGggKyBzdGVwOyB0ICs9IHN0ZXApIHtcbiAgICAgICAgICBpZiAodCA+IG8uY2hyTGVuZ3Roc1tjaHIubl0pIHtcbiAgICAgICAgICAgIG5ld0NociA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignY2hyQXQnLCBjaHIucCArIHQpO1xuICAgICAgICAgICAgaWYgKGNociA9PT0gbmV3Q2hyKSB7IGJyZWFrOyB9IC8vIG9mZiB0aGUgZW5kIG9mIHRoZSBsYXN0IGNocm9tb3NvbWVcbiAgICAgICAgICAgIHQgPSAwO1xuICAgICAgICAgICAgY2hyID0gbmV3Q2hyO1xuICAgICAgICAgICAgY29udGludWU7IC8vIHRoZSBsYWJlbCBmb3IgMCBpcyBuZXZlciBzaG93blxuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgdW5pdCA9IF8uZmluZChbWzEwMDAwMDAsICdtJ10sIFsxMDAwLCAnayddLCBbMSwgJyddXSwgZnVuY3Rpb24odikgeyByZXR1cm4gdlswXSA8PSBzdGVwOyB9KSxcbiAgICAgICAgICAgIG1ham9yID0gZmxvb3JIYWNrKHQgLyBtYWpvclN0ZXBbMV0pLFxuICAgICAgICAgICAgbWlub3IgPSAodCAvIHVuaXRbMF0pLnRvU3RyaW5nKCkuc3Vic3RyKG1ham9yID4gMCA/IG1ham9yLnRvU3RyaW5nKCkubGVuZ3RoIDogMCksXG4gICAgICAgICAgICBpc01ham9yID0gISh0ICUgbWFqb3JTdGVwWzBdKSxcbiAgICAgICAgICAgIHggPSAoKHQgKyBjaHIucCAtIHRpbGVJZCArIDAuNSkgLyBicFBlclRpbGUgKiBjYW52YXNXaWR0aCk7XG4gICAgICAgICAgaWYgKGlzTWFqb3IpIHtcbiAgICAgICAgICAgIGN0eC5mb250ID0gXCJib2xkIFwiICsgZGVmYXVsdEZvbnQ7XG4gICAgICAgICAgICBpZiAobWFqb3IpIHtcbiAgICAgICAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdlbmQnO1xuICAgICAgICAgICAgICBjdHguZmlsbFRleHQobWFqb3IsIHggLSAxLCB0ZXh0WSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdHgudGV4dEFsaWduID0gJ3N0YXJ0JztcbiAgICAgICAgICAgIGN0eC5maWxsUmVjdCh4LCBvZmZzZXRGb3JOdFRleHQgPyAxIDogMywgMSwgMTkpOyBcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjNjY2NjY2JztcbiAgICAgICAgICAgIGN0eC5maWxsUmVjdCh4LCBvZmZzZXRGb3JOdFRleHQgPyAxIDogNywgMSwgMTQpO1xuICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMDAwMDAwJztcbiAgICAgICAgICB9XG4gICAgICAgICAgY3R4LmZpbGxUZXh0KG1pbm9yICsgKGlzTWFqb3IgPyB1bml0WzFdIDogJycpLCB4ICsgMiwgdGV4dFkpO1xuICAgICAgICAgIGlmIChpc01ham9yKSB7IGN0eC5mb250ID0gZGVmYXVsdEZvbnQ7IH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoJG9sZEMubGVuZ3RoKSB7IFxuICAgICAgICAgICRvbGRDLmFkZENsYXNzKCdoaWRkZW4nKTtcbiAgICAgICAgICAkYy5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgJG9sZEMucmVtb3ZlKCk7IH0sIDEwMDApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmdW5jdGlvbiBnaG9zdGlmeSh0ZXh0KSB7XG4gICAgICAgICAgdGV4dCA9IHRleHQudG9TdHJpbmcoKTtcbiAgICAgICAgICByZXR1cm4gdGV4dDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZm9yICh2YXIgdCA9IHN0YXJ0OyB0ICsgY2hyLnAgPCB0aWxlSWQgKyBicHBwICogby50aWxlV2lkdGg7IHQgKz0gc3RlcCkge1xuICAgICAgICAgIGlmICh0ID4gby5jaHJMZW5ndGhzW2Noci5uXSkge1xuICAgICAgICAgICAgbmV3Q2hyID0gby5icm93c2VyLmdlbm9icm93c2VyKCdjaHJBdCcsIGNoci5wICsgdCk7XG4gICAgICAgICAgICBpZiAoY2hyID09PSBuZXdDaHIpIHsgYnJlYWs7IH0gLy8gb2ZmIHRoZSBlbmQgb2YgdGhlIGxhc3QgY2hyb21vc29tZVxuICAgICAgICAgICAgdCA9IDA7XG4gICAgICAgICAgICBjaHIgPSBuZXdDaHI7XG4gICAgICAgICAgICBjb250aW51ZTsgLy8gdGhlIGxhYmVsIGZvciAwIGlzIG5ldmVyIHNob3duXG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciB1bml0ID0gXy5maW5kKFtbMTAwMDAwMCwgJ20nXSwgWzEwMDAsICdrJ10sIFsxLCAnJ11dLCBmdW5jdGlvbih2KSB7IHJldHVybiB2WzBdIDw9IHN0ZXA7IH0pLFxuICAgICAgICAgICAgbWFqb3IgPSBmbG9vckhhY2sodCAvIG1ham9yU3RlcFsxXSksXG4gICAgICAgICAgICBtaW5vciA9ICh0IC8gdW5pdFswXSkudG9TdHJpbmcoKS5zdWJzdHIobWFqb3IgPiAwID8gbWFqb3IudG9TdHJpbmcoKS5sZW5ndGggOiAwKSxcbiAgICAgICAgICAgIGlzTWFqb3IgPSAhKHQgJSBtYWpvclN0ZXBbMF0pLFxuICAgICAgICAgICAgdGlja0hUTUwgPSAnPGRpdiBjbGFzcz1cInRpY2snICsgKGlzTWFqb3IgPyAnIG1ham9yXCI+JyArIGdob3N0aWZ5KG1ham9yID8gbWFqb3IgOiAnJykgOiAnXCI+JykgKyBcbiAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwibWlub3JcIj4nICsgZ2hvc3RpZnkobWlub3IgKyAoaXNNYWpvciA/IHVuaXRbMV0gOiAnJykpICsgJzwvc3Bhbj48L2Rpdj4nLFxuICAgICAgICAgICAgJHRpY2sgPSAkKHRpY2tIVE1MKS5hcHBlbmRUbygkdCk7XG4gICAgICAgICAgJHRpY2suY3NzKCdyaWdodCcsICgoMSAtICh0ICsgY2hyLnAgLSB0aWxlSWQgKyAwLjUpIC8gYnBQZXJUaWxlKSAqIDEwMCkrJyUnKTsgLy8gVGhlIDAuNSBjZW50ZXJzIGl0IG92ZXIgdGhlIGJhc2UuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIFxuICByZWRyYXdDYW52YXNUaWNrczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsIFxuICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgIHpvb20gPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3pvb20nKTtcbiAgICAkZWxlbS5jaGlsZHJlbignLnRpbGUtcnVsZXInKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyICR0ID0gJCh0aGlzKTtcbiAgICAgIHNlbGYuX2RyYXdDYW52YXNUaWNrcygkdCwgJHQuZGF0YSgndGlsZUlkJyksICR0LmRhdGEoJ2JwcHAnKSwgem9vbSk7XG4gICAgfSk7XG4gIH0sXG4gIFxuICBfbnRTZXF1ZW5jZUxvYWQ6IGZ1bmN0aW9uKGRuYSwgZXh0cmFEYXRhKSB7XG4gICAgaWYgKCFkbmEpIHsgcmV0dXJuOyB9XG4gICAgdmFyIG8gPSBleHRyYURhdGEuX3NlbGYub3B0aW9ucyxcbiAgICAgICRkID0gZXh0cmFEYXRhLl9kLFxuICAgICAgbCA9IGRuYS5sZW5ndGgsXG4gICAgICBwcGJwID0gby50aWxlV2lkdGggLyBsLCAvLyBwaXhlbHMgcGVyIGJwXG4gICAgICBjb2xvcnMgPSB7YTonMjU1LDAsMCcsIHQ6JzI1NSwwLDI1NScsIGM6JzAsMCwyNTUnLCBnOicwLDE4MCwwJ30sXG4gICAgICBjYW52YXMsIGhlaWdodCwgY3R4LCBudDtcbiAgICBpZiAoJGQpIHtcbiAgICAgIHZhciAkc3ZnID0gJC5tayhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwic3ZnXCIpLmF0dHIoe1xuICAgICAgICB2ZXJzaW9uOiBcIjEuMlwiLFxuICAgICAgICBiYXNlUHJvZmlsZTogXCJ0aW55XCIsXG4gICAgICAgIGhlaWdodDogJzE0cHgnLFxuICAgICAgICB3aWR0aDogKCRkLmNsb3Nlc3QoJy50aWxlJykud2lkdGgoKSB8fCBleHRyYURhdGEuX3cpICsgJ3B4J1xuICAgICAgfSk7XG4gICAgICAkZC5hcHBlbmQoJHN2Zyk7XG4gICAgICAkLm1rKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJ0ZXh0XCIpLmF0dHIoe1xuICAgICAgICB4OiBfLm1hcChfLnJhbmdlKGwpLCBmdW5jdGlvbih4KSB7IHJldHVybiB4IC8gbCAqIDEwMDsgfSkuam9pbignJSAnKSArICclJyxcbiAgICAgICAgeTogMTEsXG4gICAgICAgIGZpbGw6ICcjRkZGRkZGJ1xuICAgICAgfSkudGV4dChkbmEpLmFwcGVuZFRvKCRzdmcpO1xuICAgIH1cbiAgICBjYW52YXMgPSBleHRyYURhdGEuX2MgJiYgZXh0cmFEYXRhLl9jLmdldCgwKTtcbiAgICBoZWlnaHQgPSBjYW52YXMuaGVpZ2h0O1xuICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0ICYmIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIGlmICghY3R4KSB7IHJldHVybjsgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7XG4gICAgICBudCA9IGRuYS5zdWJzdHIoaSwgMSk7XG4gICAgICBpZiAobnQgPT0gJy0nKSB7IGNvbnRpbnVlOyB9XG4gICAgICBjdHguZmlsbFN0eWxlID0gXCJyZ2IoXCIgKyBjb2xvcnNbbnQudG9Mb3dlckNhc2UoKV0gKyBcIilcIjtcbiAgICAgIGN0eC5maWxsUmVjdChpICogcHBicCwgMCwgcHBicCwgaGVpZ2h0KTtcbiAgICB9XG4gIH0sXG4gIFxuICBfYWRkTGFiZWw6IGZ1bmN0aW9uKGxhYmVsLCB6b29tKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICAkbCA9ICQubWsoJ2RpdicpLmFkZENsYXNzKCdsYWJlbCBsYWJlbC0nK2xhYmVsLnApLFxuICAgICAgJGx0ID0gJC5taygnZGl2JykuYWRkQ2xhc3MoJ2xhYmVsLXRleHQnKS5wcmVwZW5kVG8oJGwpLnRleHQobGFiZWwubi5yZXBsYWNlKC9eY2hyLywnJykpO1xuICAgIGlmIChsYWJlbC5uLmluZGV4T2YoJ2NocicpID09PSAwKSB7ICRsdC5wcmVwZW5kKCc8c3BhbiBjbGFzcz1cImNoclwiPmNocjwvc3Bhbj4nKTsgfVxuICAgICRsLnByZXBlbmQoJzxzcGFuIGNsYXNzPVwic3RhcnQtbGluZVwiPjwvc3Bhbj4nKTtcbiAgICBpZiAobGFiZWwuZW5kID09PSB0cnVlKSB7ICRsLmFkZENsYXNzKCdsYWJlbC1lbmQnKTsgfVxuICAgIC8vJGwuY3NzKCd6LWluZGV4JywgMjAwICsgbGFiZWwuaSk7XG4gICAgcmV0dXJuICRsLmFwcGVuZFRvKHRoaXMuZWxlbWVudCk7XG4gIH0sXG4gIFxuICBfcmVwb3NMYWJlbDogZnVuY3Rpb24oJGwsIGxhYmVsLCB6b29tKSB7ICBcbiAgICAvLyBjb25zdHJhaW4gd2lkdGggb2YgbGFiZWwgc28gaXQgZG9lc24ndCBydW4gb3ZlciBpbnRvIHRoZSBuZXh0IG9uZVxuICAgIC8vIG1heC13aWR0aCBkb2Vzbid0IGluY2x1ZGUgcGFkZGluZyAoNXB4KVxuICAgIGlmIChsYWJlbC5lbmQgIT09IHRydWUpIHsgJGwuY2hpbGRyZW4oJy5sYWJlbC10ZXh0JykuY3NzKCdtYXgtd2lkdGgnLCBNYXRoLm1heChsYWJlbC53IC8gem9vbSAtIDUsIDApKTsgfVxuICAgIC8vIGArIDFgIC0tPiBjb252ZXJ0IDAtYmFzZWQgcG9zaXRpb25pbmdcbiAgICAvLyBgLSAxYCAtLT4gbGFiZWwgaXMgb2Zmc2V0IDFweCB0byBsZWZ0IHRvIGNvbXBlbnNhdGUgZm9yIHRoZSAycHggd2lkdGggb2YgdGhlIHJlZCBpbmRpY2F0b3IgbGluZVxuICAgICRsLmNzcygnbGVmdCcsIChsYWJlbC5wICsgMSAtIHRoaXMub3B0aW9ucy5saW5lLmdlbm9saW5lKCdvcHRpb24nLCAnb3JpZ2luJykpIC8gem9vbSAtIDEpO1xuICB9LFxuICBcbiAgX2FkZEJhbmQ6IGZ1bmN0aW9uKGJhbmQsIHpvb20pIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICRiID0gJCgnPGRpdiBjbGFzcz1cImJhbmQgYmFuZC0nK2JhbmRbNF0rJyBiYW5kLScrYmFuZFszXS5zdWJzdHIoMCwxKSsnXCIvPicpO1xuICAgICRiLmF0dHIoJ2lkJywgdGhpcy5fdGlsZUlkKGJhbmRbMV0sICdiYW5kJykpO1xuICAgIGlmIChiYW5kWzVdID09PSAwKSB7ICRiLnByZXBlbmQoJzxkaXYgY2xhc3M9XCJjaHItc3RhcnRcIi8+Jyk7IH1cbiAgICAkYi5hcHBlbmQoJCgnPGRpdiBjbGFzcz1cImJhbmQtbmFtZVwiLz4nKS50ZXh0KGJhbmRbMF0uc3Vic3RyKDMpICsgYmFuZFszXSkpO1xuICAgIHJldHVybiAkYi5hcHBlbmRUbyh0aGlzLmVsZW1lbnQpO1xuICB9LFxuICBcbiAgX3JlcG9zQmFuZDogZnVuY3Rpb24oJGIsIGJhbmQsIHpvb20pIHsgXG4gICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsIFxuICAgICAgcHJvcCA9IGJhbmRbNF0gPT0gJ2FjZW4nID8gKC9ecC8udGVzdChiYW5kWzNdKSA/ICdib3JkZXItbGVmdC13aWR0aCcgOiAnYm9yZGVyLXJpZ2h0LXdpZHRoJyk6ICd3aWR0aCc7XG4gICAgJGIuY3NzKCdsZWZ0JywgKGJhbmRbMV0gLSBvLmxpbmUuZ2Vub2xpbmUoJ29wdGlvbicsICdvcmlnaW4nKSkgLyB6b29tKTtcbiAgICAkYi5jc3MocHJvcCwgKGJhbmRbMl0gLSBiYW5kWzFdKSAvIHpvb20gKyAxKTsgXG4gIH0sXG4gIFxuICBfY3VzdG9tVGlsZVJlbmRlcjogZnVuY3Rpb24oZSwgY2FsbGJhY2spIHtcbiAgICB2YXIgY2FudmFzID0gdGhpcyxcbiAgICAgICRjYW52YXMgPSAkKHRoaXMpLFxuICAgICAgZCA9IGUuZGF0YSxcbiAgICAgIGJyb3dzZXIgPSBkLnNlbGYub3B0aW9ucy5icm93c2VyO1xuICAgIGZ1bmN0aW9uIHB1c2hDYWxsYmFjaygpIHsgXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSAmJiAkY2FudmFzLmRhdGEoJ3JlbmRlcmluZ0NhbGxiYWNrcycpLnB1c2goY2FsbGJhY2spOyB9XG4gICAgaWYgKCRjYW52YXMuZGF0YSgncmVuZGVyaW5nJykgPT09IHRydWUpIHsgcHVzaENhbGxiYWNrKCk7IHJldHVybjsgfVxuICAgICRjYW52YXMuZGF0YSgncmVuZGVyaW5nJywgdHJ1ZSk7XG4gICAgJGNhbnZhcy5kYXRhKCdyZW5kZXJpbmdDYWxsYmFja3MnLCBbXSk7XG4gICAgcHVzaENhbGxiYWNrKCk7XG4gICAgZC5jdXN0b20ucmVuZGVyKGNhbnZhcywgZC5zdGFydCwgZC5lbmQsIGQuZGVuc2l0eSwgZnVuY3Rpb24oKSB7XG4gICAgICAkY2FudmFzLmNzcygnd2lkdGgnLCAnMTAwJScpLmNzcygnaGVpZ2h0JywgZC5jdXN0b20uc3RyZXRjaEhlaWdodCA/ICcxMDAlJyA6IGNhbnZhcy5oZWlnaHQpO1xuICAgICAgJGNhbnZhcy50b2dnbGVDbGFzcygnc3RyZXRjaC1oZWlnaHQnLCBkLmN1c3RvbS5zdHJldGNoSGVpZ2h0KTtcbiAgICAgICRjYW52YXMucmVtb3ZlQ2xhc3MoJ3VucmVuZGVyZWQnKS5hZGRDbGFzcygnbm8tYXJlYXMnKTtcbiAgICAgIGQuc2VsZi5maXhDbGlja0FyZWFzKCk7XG4gICAgICAvLyBJZiB0aGUgdG9vLW1hbnkgY2xhc3Mgd2FzIHNldCwgd2UgY291bGRuJ3QgZHJhdy9sb2FkIHRoZSBkYXRhIGF0IHRoaXMgZGVuc2l0eSBiZWNhdXNlIHRoZXJlJ3MgdG9vIG11Y2ggb2YgaXRcbiAgICAgIC8vIElmIHRoaXMgaXMgYXQgXCJzcXVpc2hcIiBkZW5zaXR5LCB3ZSBhbHNvIGFkZCB0aGUgY2xhc3MgdG8gcGFyZW50IDxkaXY+IHRvIHRlbGwgdGhlIHVzZXIgdGhhdCBzaGUgbmVlZHMgdG8gem9vbVxuICAgICAgaWYgKCRjYW52YXMuaGFzQ2xhc3MoJ3Rvby1tYW55JykpIHsgJGNhbnZhcy5wYXJlbnQoKS5hZGRDbGFzcygndG9vLW1hbnknKTsgfVxuICAgICAgaWYgKCRjYW52YXMuaGFzQ2xhc3MoJ3Rvby1tYW55JykgJiYgZC5kZW5zaXR5ID09ICdkZW5zZScpIHsgJGNhbnZhcy5wYXJlbnQoKS5hZGRDbGFzcygndG9vLW1hbnktZm9yLWRlbnNlJyk7IH1cbiAgICAgIF8uZWFjaCgkY2FudmFzLmRhdGEoJ3JlbmRlcmluZ0NhbGxiYWNrcycpLCBmdW5jdGlvbihmKSB7IGYoKTsgfSk7XG4gICAgICAkY2FudmFzLmRhdGEoJ3JlbmRlcmluZycsIGZhbHNlKTtcbiAgICB9KTtcbiAgICBpZiAoZC5jdXN0b20uZXhwZWN0c1NlcXVlbmNlICYmIChkLmVuZCAtIGQuc3RhcnQpIDwgYnJvd3Nlci5nZW5vYnJvd3Nlcignb3B0aW9uJywgJ21heE50UmVxdWVzdCcpKSB7XG4gICAgICBicm93c2VyLmdlbm9icm93c2VyKCdnZXRETkEnLCBkLnN0YXJ0LCBkLmVuZCwgZnVuY3Rpb24oc2VxdWVuY2UpIHtcbiAgICAgICAgZC5jdXN0b20ucmVuZGVyU2VxdWVuY2UoY2FudmFzLCBkLnN0YXJ0LCBkLmVuZCwgZC5kZW5zaXR5LCBzZXF1ZW5jZSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgLy8gVE9ETzogbWF5IG5lZWQgdG8gZC5zZWxmLmZpeENsaWNrQXJlYXMoKSBhZ2FpbiBpZiAucmVuZGVyU2VxdWVuY2UgYWRkZWQgYXJlYXM/XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICBcbiAgX2N1c3RvbVRpbGU6IGZ1bmN0aW9uKCR0LCB0aWxlSWQsIGJwcHAsIGJlc3REZW5zaXR5KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgIGJwUGVyVGlsZSA9IGJwcHAgKiBvLnRpbGVXaWR0aCxcbiAgICAgIGVuZCA9IHRpbGVJZCArIGJwUGVyVGlsZTtcbiAgICAkdC5hZGRDbGFzcygndGlsZS1jdXN0b20gdGlsZS1mdWxsIHRpbGUtbG9hZGVkIGJwcHAtJytjbGFzc0ZyaWVuZGx5KGJwcHApKTtcbiAgICBfLmVhY2goby50cmFjay5zLCBmdW5jdGlvbihkZW5zaXR5KSB7XG4gICAgICB2YXIgY2FudmFzSFRNTCA9ICc8Y2FudmFzIHdpZHRoPVwiJytvLnRpbGVXaWR0aCsnXCIgaGVpZ2h0PVwiJytvLnRyYWNrLmgrJ1wiIGNsYXNzPVwidGRhdGEgdW5yZW5kZXJlZCBkZW5zLScrZGVuc2l0eSsnXCIgJ1xuICAgICAgICAgICsgJ2lkPVwiY2FudmFzLScrc2VsZi5fdGlsZUlkKHRpbGVJZCwgYnBwcCkrJy0nK2RlbnNpdHkrJ1wiPjwvY2FudmFzPicsXG4gICAgICAgICRjID0gJChjYW52YXNIVE1MKS5hcHBlbmRUbygkdCk7XG4gICAgICAkYy5iaW5kKCdyZW5kZXInLCB7c3RhcnQ6IHRpbGVJZCwgZW5kOiBlbmQsIGRlbnNpdHk6IGRlbnNpdHksIHNlbGY6IHNlbGYsIGN1c3RvbTogby50cmFjay5jdXN0b219LCBzZWxmLl9jdXN0b21UaWxlUmVuZGVyKTtcbiAgICAgICRjLmJpbmQoJ2VyYXNlJywgZnVuY3Rpb24oKSB7IG8udHJhY2suY3VzdG9tLmVyYXNlKCRjLmdldCgwKSk7ICRjLmFkZENsYXNzKCd1bnJlbmRlcmVkJyk7IH0pO1xuICAgICAgaWYgKGRlbnNpdHk9PWJlc3REZW5zaXR5KSB7ICRjLmFkZENsYXNzKCdkZW5zLWJlc3QnKS50cmlnZ2VyKCdyZW5kZXInKTsgfVxuICAgIH0pO1xuICB9XG4gIFxufSk7XG5cbn07IiwiLyohXG4gKiBqUXVlcnkgVUkgMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSVxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGpRdWVyeSkge1xuKGZ1bmN0aW9uKGEsZCl7ZnVuY3Rpb24gYyhoLGcpe3ZhciBpPWgubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtpZihcImFyZWFcIj09PWkpe2c9aC5wYXJlbnROb2RlO2k9Zy5uYW1lO2lmKCFoLmhyZWZ8fCFpfHxnLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkhPT1cIm1hcFwiKXJldHVybiBmYWxzZTtoPWEoXCJpbWdbdXNlbWFwPSNcIitpK1wiXVwiKVswXTtyZXR1cm4hIWgmJmUoaCl9cmV0dXJuKC9pbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdC8udGVzdChpKT8haC5kaXNhYmxlZDpcImFcIj09aT9oLmhyZWZ8fGc6ZykmJmUoaCl9ZnVuY3Rpb24gZShoKXtyZXR1cm4hYShoKS5wYXJlbnRzKCkuYW5kU2VsZigpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiBhLmN1ckNTUyh0aGlzLFwidmlzaWJpbGl0eVwiKT09PVwiaGlkZGVuXCJ8fGEuZXhwci5maWx0ZXJzLmhpZGRlbih0aGlzKX0pLmxlbmd0aH1hLnVpPWEudWl8fHt9O2lmKCFhLnVpLnZlcnNpb24pe2EuZXh0ZW5kKGEudWkse3ZlcnNpb246XCIxLjguMTZcIixcbmtleUNvZGU6e0FMVDoxOCxCQUNLU1BBQ0U6OCxDQVBTX0xPQ0s6MjAsQ09NTUE6MTg4LENPTU1BTkQ6OTEsQ09NTUFORF9MRUZUOjkxLENPTU1BTkRfUklHSFQ6OTMsQ09OVFJPTDoxNyxERUxFVEU6NDYsRE9XTjo0MCxFTkQ6MzUsRU5URVI6MTMsRVNDQVBFOjI3LEhPTUU6MzYsSU5TRVJUOjQ1LExFRlQ6MzcsTUVOVTo5MyxOVU1QQURfQUREOjEwNyxOVU1QQURfREVDSU1BTDoxMTAsTlVNUEFEX0RJVklERToxMTEsTlVNUEFEX0VOVEVSOjEwOCxOVU1QQURfTVVMVElQTFk6MTA2LE5VTVBBRF9TVUJUUkFDVDoxMDksUEFHRV9ET1dOOjM0LFBBR0VfVVA6MzMsUEVSSU9EOjE5MCxSSUdIVDozOSxTSElGVDoxNixTUEFDRTozMixUQUI6OSxVUDozOCxXSU5ET1dTOjkxfX0pO2EuZm4uZXh0ZW5kKHtwcm9wQXR0cjphLmZuLnByb3B8fGEuZm4uYXR0cixfZm9jdXM6YS5mbi5mb2N1cyxmb2N1czpmdW5jdGlvbihoLGcpe3JldHVybiB0eXBlb2YgaD09PVwibnVtYmVyXCI/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGk9XG50aGlzO3NldFRpbWVvdXQoZnVuY3Rpb24oKXthKGkpLmZvY3VzKCk7ZyYmZy5jYWxsKGkpfSxoKX0pOnRoaXMuX2ZvY3VzLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sc2Nyb2xsUGFyZW50OmZ1bmN0aW9uKCl7dmFyIGg7aD1hLmJyb3dzZXIubXNpZSYmLyhzdGF0aWN8cmVsYXRpdmUpLy50ZXN0KHRoaXMuY3NzKFwicG9zaXRpb25cIikpfHwvYWJzb2x1dGUvLnRlc3QodGhpcy5jc3MoXCJwb3NpdGlvblwiKSk/dGhpcy5wYXJlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuLyhyZWxhdGl2ZXxhYnNvbHV0ZXxmaXhlZCkvLnRlc3QoYS5jdXJDU1ModGhpcyxcInBvc2l0aW9uXCIsMSkpJiYvKGF1dG98c2Nyb2xsKS8udGVzdChhLmN1ckNTUyh0aGlzLFwib3ZlcmZsb3dcIiwxKSthLmN1ckNTUyh0aGlzLFwib3ZlcmZsb3cteVwiLDEpK2EuY3VyQ1NTKHRoaXMsXCJvdmVyZmxvdy14XCIsMSkpfSkuZXEoMCk6dGhpcy5wYXJlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuLyhhdXRvfHNjcm9sbCkvLnRlc3QoYS5jdXJDU1ModGhpcyxcblwib3ZlcmZsb3dcIiwxKSthLmN1ckNTUyh0aGlzLFwib3ZlcmZsb3cteVwiLDEpK2EuY3VyQ1NTKHRoaXMsXCJvdmVyZmxvdy14XCIsMSkpfSkuZXEoMCk7cmV0dXJuL2ZpeGVkLy50ZXN0KHRoaXMuY3NzKFwicG9zaXRpb25cIikpfHwhaC5sZW5ndGg/YShkb2N1bWVudCk6aH0sekluZGV4OmZ1bmN0aW9uKGgpe2lmKGghPT1kKXJldHVybiB0aGlzLmNzcyhcInpJbmRleFwiLGgpO2lmKHRoaXMubGVuZ3RoKXtoPWEodGhpc1swXSk7Zm9yKHZhciBnO2gubGVuZ3RoJiZoWzBdIT09ZG9jdW1lbnQ7KXtnPWguY3NzKFwicG9zaXRpb25cIik7aWYoZz09PVwiYWJzb2x1dGVcInx8Zz09PVwicmVsYXRpdmVcInx8Zz09PVwiZml4ZWRcIil7Zz1wYXJzZUludChoLmNzcyhcInpJbmRleFwiKSwxMCk7aWYoIWlzTmFOKGcpJiZnIT09MClyZXR1cm4gZ31oPWgucGFyZW50KCl9fXJldHVybiAwfSxkaXNhYmxlU2VsZWN0aW9uOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYmluZCgoYS5zdXBwb3J0LnNlbGVjdHN0YXJ0P1wic2VsZWN0c3RhcnRcIjpcblwibW91c2Vkb3duXCIpK1wiLnVpLWRpc2FibGVTZWxlY3Rpb25cIixmdW5jdGlvbihoKXtoLnByZXZlbnREZWZhdWx0KCl9KX0sZW5hYmxlU2VsZWN0aW9uOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudW5iaW5kKFwiLnVpLWRpc2FibGVTZWxlY3Rpb25cIil9fSk7YS5lYWNoKFtcIldpZHRoXCIsXCJIZWlnaHRcIl0sZnVuY3Rpb24oaCxnKXtmdW5jdGlvbiBpKGwsbyxuLGspe2EuZWFjaChiLGZ1bmN0aW9uKCl7by09cGFyc2VGbG9hdChhLmN1ckNTUyhsLFwicGFkZGluZ1wiK3RoaXMsdHJ1ZSkpfHwwO2lmKG4pby09cGFyc2VGbG9hdChhLmN1ckNTUyhsLFwiYm9yZGVyXCIrdGhpcytcIldpZHRoXCIsdHJ1ZSkpfHwwO2lmKGspby09cGFyc2VGbG9hdChhLmN1ckNTUyhsLFwibWFyZ2luXCIrdGhpcyx0cnVlKSl8fDB9KTtyZXR1cm4gb312YXIgYj1nPT09XCJXaWR0aFwiP1tcIkxlZnRcIixcIlJpZ2h0XCJdOltcIlRvcFwiLFwiQm90dG9tXCJdLGY9Zy50b0xvd2VyQ2FzZSgpLGo9e2lubmVyV2lkdGg6YS5mbi5pbm5lcldpZHRoLGlubmVySGVpZ2h0OmEuZm4uaW5uZXJIZWlnaHQsXG5vdXRlcldpZHRoOmEuZm4ub3V0ZXJXaWR0aCxvdXRlckhlaWdodDphLmZuLm91dGVySGVpZ2h0fTthLmZuW1wiaW5uZXJcIitnXT1mdW5jdGlvbihsKXtpZihsPT09ZClyZXR1cm4galtcImlubmVyXCIrZ10uY2FsbCh0aGlzKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7YSh0aGlzKS5jc3MoZixpKHRoaXMsbCkrXCJweFwiKX0pfTthLmZuW1wib3V0ZXJcIitnXT1mdW5jdGlvbihsLG8pe2lmKHR5cGVvZiBsIT09XCJudW1iZXJcIilyZXR1cm4galtcIm91dGVyXCIrZ10uY2FsbCh0aGlzLGwpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXthKHRoaXMpLmNzcyhmLGkodGhpcyxsLHRydWUsbykrXCJweFwiKX0pfX0pO2EuZXh0ZW5kKGEuZXhwcltcIjpcIl0se2RhdGE6ZnVuY3Rpb24oaCxnLGkpe3JldHVybiEhYS5kYXRhKGgsaVszXSl9LGZvY3VzYWJsZTpmdW5jdGlvbihoKXtyZXR1cm4gYyhoLCFpc05hTihhLmF0dHIoaCxcInRhYmluZGV4XCIpKSl9LHRhYmJhYmxlOmZ1bmN0aW9uKGgpe3ZhciBnPWEuYXR0cihoLFxuXCJ0YWJpbmRleFwiKSxpPWlzTmFOKGcpO3JldHVybihpfHxnPj0wKSYmYyhoLCFpKX19KTthKGZ1bmN0aW9uKCl7dmFyIGg9ZG9jdW1lbnQuYm9keSxnPWguYXBwZW5kQ2hpbGQoZz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpKTthLmV4dGVuZChnLnN0eWxlLHttaW5IZWlnaHQ6XCIxMDBweFwiLGhlaWdodDpcImF1dG9cIixwYWRkaW5nOjAsYm9yZGVyV2lkdGg6MH0pO2Euc3VwcG9ydC5taW5IZWlnaHQ9Zy5vZmZzZXRIZWlnaHQ9PT0xMDA7YS5zdXBwb3J0LnNlbGVjdHN0YXJ0PVwib25zZWxlY3RzdGFydFwiaW4gZztoLnJlbW92ZUNoaWxkKGcpLnN0eWxlLmRpc3BsYXk9XCJub25lXCJ9KTthLmV4dGVuZChhLnVpLHtwbHVnaW46e2FkZDpmdW5jdGlvbihoLGcsaSl7aD1hLnVpW2hdLnByb3RvdHlwZTtmb3IodmFyIGIgaW4gaSl7aC5wbHVnaW5zW2JdPWgucGx1Z2luc1tiXXx8W107aC5wbHVnaW5zW2JdLnB1c2goW2csaVtiXV0pfX0sY2FsbDpmdW5jdGlvbihoLGcsaSl7aWYoKGc9aC5wbHVnaW5zW2ddKSYmXG5oLmVsZW1lbnRbMF0ucGFyZW50Tm9kZSlmb3IodmFyIGI9MDtiPGcubGVuZ3RoO2IrKyloLm9wdGlvbnNbZ1tiXVswXV0mJmdbYl1bMV0uYXBwbHkoaC5lbGVtZW50LGkpfX0sY29udGFpbnM6ZnVuY3Rpb24oaCxnKXtyZXR1cm4gZG9jdW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24/aC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihnKSYxNjpoIT09ZyYmaC5jb250YWlucyhnKX0saGFzU2Nyb2xsOmZ1bmN0aW9uKGgsZyl7aWYoYShoKS5jc3MoXCJvdmVyZmxvd1wiKT09PVwiaGlkZGVuXCIpcmV0dXJuIGZhbHNlO2c9ZyYmZz09PVwibGVmdFwiP1wic2Nyb2xsTGVmdFwiOlwic2Nyb2xsVG9wXCI7dmFyIGk9ZmFsc2U7aWYoaFtnXT4wKXJldHVybiB0cnVlO2hbZ109MTtpPWhbZ10+MDtoW2ddPTA7cmV0dXJuIGl9LGlzT3ZlckF4aXM6ZnVuY3Rpb24oaCxnLGkpe3JldHVybiBoPmcmJmg8ZytpfSxpc092ZXI6ZnVuY3Rpb24oaCxnLGksYixmLGope3JldHVybiBhLnVpLmlzT3ZlckF4aXMoaCxpLGYpJiZcbmEudWkuaXNPdmVyQXhpcyhnLGIsail9fSl9fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhLGQpe2lmKGEuY2xlYW5EYXRhKXt2YXIgYz1hLmNsZWFuRGF0YTthLmNsZWFuRGF0YT1mdW5jdGlvbihoKXtmb3IodmFyIGc9MCxpOyhpPWhbZ10pIT1udWxsO2crKyl0cnl7YShpKS50cmlnZ2VySGFuZGxlcihcInJlbW92ZVwiKX1jYXRjaChiKXt9YyhoKX19ZWxzZXt2YXIgZT1hLmZuLnJlbW92ZTthLmZuLnJlbW92ZT1mdW5jdGlvbihoLGcpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZighZylpZighaHx8YS5maWx0ZXIoaCxbdGhpc10pLmxlbmd0aClhKFwiKlwiLHRoaXMpLmFkZChbdGhpc10pLmVhY2goZnVuY3Rpb24oKXt0cnl7YSh0aGlzKS50cmlnZ2VySGFuZGxlcihcInJlbW92ZVwiKX1jYXRjaChpKXt9fSk7cmV0dXJuIGUuY2FsbChhKHRoaXMpLGgsZyl9KX19YS53aWRnZXQ9ZnVuY3Rpb24oaCxnLGkpe3ZhciBiPWguc3BsaXQoXCIuXCIpWzBdLGY7aD1oLnNwbGl0KFwiLlwiKVsxXTtmPWIrXCItXCIraDtpZighaSl7aT1nO2c9YS5XaWRnZXR9YS5leHByW1wiOlwiXVtmXT1cbmZ1bmN0aW9uKGope3JldHVybiEhYS5kYXRhKGosaCl9O2FbYl09YVtiXXx8e307YVtiXVtoXT1mdW5jdGlvbihqLGwpe2FyZ3VtZW50cy5sZW5ndGgmJnRoaXMuX2NyZWF0ZVdpZGdldChqLGwpfTtnPW5ldyBnO2cub3B0aW9ucz1hLmV4dGVuZCh0cnVlLHt9LGcub3B0aW9ucyk7YVtiXVtoXS5wcm90b3R5cGU9YS5leHRlbmQodHJ1ZSxnLHtuYW1lc3BhY2U6Yix3aWRnZXROYW1lOmgsd2lkZ2V0RXZlbnRQcmVmaXg6YVtiXVtoXS5wcm90b3R5cGUud2lkZ2V0RXZlbnRQcmVmaXh8fGgsd2lkZ2V0QmFzZUNsYXNzOmZ9LGkpO2Eud2lkZ2V0LmJyaWRnZShoLGFbYl1baF0pfTthLndpZGdldC5icmlkZ2U9ZnVuY3Rpb24oaCxnKXthLmZuW2hdPWZ1bmN0aW9uKGkpe3ZhciBiPXR5cGVvZiBpPT09XCJzdHJpbmdcIixmPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSxqPXRoaXM7aT0hYiYmZi5sZW5ndGg/YS5leHRlbmQuYXBwbHkobnVsbCxbdHJ1ZSxpXS5jb25jYXQoZikpOlxuaTtpZihiJiZpLmNoYXJBdCgwKT09PVwiX1wiKXJldHVybiBqO2I/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGw9YS5kYXRhKHRoaXMsaCksbz1sJiZhLmlzRnVuY3Rpb24obFtpXSk/bFtpXS5hcHBseShsLGYpOmw7aWYobyE9PWwmJm8hPT1kKXtqPW87cmV0dXJuIGZhbHNlfX0pOnRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBsPWEuZGF0YSh0aGlzLGgpO2w/bC5vcHRpb24oaXx8e30pLl9pbml0KCk6YS5kYXRhKHRoaXMsaCxuZXcgZyhpLHRoaXMpKX0pO3JldHVybiBqfX07YS5XaWRnZXQ9ZnVuY3Rpb24oaCxnKXthcmd1bWVudHMubGVuZ3RoJiZ0aGlzLl9jcmVhdGVXaWRnZXQoaCxnKX07YS5XaWRnZXQucHJvdG90eXBlPXt3aWRnZXROYW1lOlwid2lkZ2V0XCIsd2lkZ2V0RXZlbnRQcmVmaXg6XCJcIixvcHRpb25zOntkaXNhYmxlZDpmYWxzZX0sX2NyZWF0ZVdpZGdldDpmdW5jdGlvbihoLGcpe2EuZGF0YShnLHRoaXMud2lkZ2V0TmFtZSx0aGlzKTt0aGlzLmVsZW1lbnQ9YShnKTt0aGlzLm9wdGlvbnM9XG5hLmV4dGVuZCh0cnVlLHt9LHRoaXMub3B0aW9ucyx0aGlzLl9nZXRDcmVhdGVPcHRpb25zKCksaCk7dmFyIGk9dGhpczt0aGlzLmVsZW1lbnQuYmluZChcInJlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsZnVuY3Rpb24oKXtpLmRlc3Ryb3koKX0pO3RoaXMuX2NyZWF0ZSgpO3RoaXMuX3RyaWdnZXIoXCJjcmVhdGVcIik7dGhpcy5faW5pdCgpfSxfZ2V0Q3JlYXRlT3B0aW9uczpmdW5jdGlvbigpe3JldHVybiBhLm1ldGFkYXRhJiZhLm1ldGFkYXRhLmdldCh0aGlzLmVsZW1lbnRbMF0pW3RoaXMud2lkZ2V0TmFtZV19LF9jcmVhdGU6ZnVuY3Rpb24oKXt9LF9pbml0OmZ1bmN0aW9uKCl7fSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnVuYmluZChcIi5cIit0aGlzLndpZGdldE5hbWUpLnJlbW92ZURhdGEodGhpcy53aWRnZXROYW1lKTt0aGlzLndpZGdldCgpLnVuYmluZChcIi5cIit0aGlzLndpZGdldE5hbWUpLnJlbW92ZUF0dHIoXCJhcmlhLWRpc2FibGVkXCIpLnJlbW92ZUNsYXNzKHRoaXMud2lkZ2V0QmFzZUNsYXNzK1xuXCItZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWRcIil9LHdpZGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnR9LG9wdGlvbjpmdW5jdGlvbihoLGcpe3ZhciBpPWg7aWYoYXJndW1lbnRzLmxlbmd0aD09PTApcmV0dXJuIGEuZXh0ZW5kKHt9LHRoaXMub3B0aW9ucyk7aWYodHlwZW9mIGg9PT1cInN0cmluZ1wiKXtpZihnPT09ZClyZXR1cm4gdGhpcy5vcHRpb25zW2hdO2k9e307aVtoXT1nfXRoaXMuX3NldE9wdGlvbnMoaSk7cmV0dXJuIHRoaXN9LF9zZXRPcHRpb25zOmZ1bmN0aW9uKGgpe3ZhciBnPXRoaXM7YS5lYWNoKGgsZnVuY3Rpb24oaSxiKXtnLl9zZXRPcHRpb24oaSxiKX0pO3JldHVybiB0aGlzfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGgsZyl7dGhpcy5vcHRpb25zW2hdPWc7aWYoaD09PVwiZGlzYWJsZWRcIil0aGlzLndpZGdldCgpW2c/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0odGhpcy53aWRnZXRCYXNlQ2xhc3MrXCItZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWRcIikuYXR0cihcImFyaWEtZGlzYWJsZWRcIixcbmcpO3JldHVybiB0aGlzfSxlbmFibGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc2V0T3B0aW9uKFwiZGlzYWJsZWRcIixmYWxzZSl9LGRpc2FibGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc2V0T3B0aW9uKFwiZGlzYWJsZWRcIix0cnVlKX0sX3RyaWdnZXI6ZnVuY3Rpb24oaCxnLGkpe3ZhciBiPXRoaXMub3B0aW9uc1toXTtnPWEuRXZlbnQoZyk7Zy50eXBlPShoPT09dGhpcy53aWRnZXRFdmVudFByZWZpeD9oOnRoaXMud2lkZ2V0RXZlbnRQcmVmaXgraCkudG9Mb3dlckNhc2UoKTtpPWl8fHt9O2lmKGcub3JpZ2luYWxFdmVudCl7aD1hLmV2ZW50LnByb3BzLmxlbmd0aDtmb3IodmFyIGY7aDspe2Y9YS5ldmVudC5wcm9wc1stLWhdO2dbZl09Zy5vcmlnaW5hbEV2ZW50W2ZdfX10aGlzLmVsZW1lbnQudHJpZ2dlcihnLGkpO3JldHVybiEoYS5pc0Z1bmN0aW9uKGIpJiZiLmNhbGwodGhpcy5lbGVtZW50WzBdLGcsaSk9PT1mYWxzZXx8Zy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl9fX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7dmFyIGQ9ZmFsc2U7YShkb2N1bWVudCkubW91c2V1cChmdW5jdGlvbigpe2Q9ZmFsc2V9KTthLndpZGdldChcInVpLm1vdXNlXCIse29wdGlvbnM6e2NhbmNlbDpcIjppbnB1dCxvcHRpb25cIixkaXN0YW5jZToxLGRlbGF5OjB9LF9tb3VzZUluaXQ6ZnVuY3Rpb24oKXt2YXIgYz10aGlzO3RoaXMuZWxlbWVudC5iaW5kKFwibW91c2Vkb3duLlwiK3RoaXMud2lkZ2V0TmFtZSxmdW5jdGlvbihlKXtyZXR1cm4gYy5fbW91c2VEb3duKGUpfSkuYmluZChcImNsaWNrLlwiK3RoaXMud2lkZ2V0TmFtZSxmdW5jdGlvbihlKXtpZih0cnVlPT09YS5kYXRhKGUudGFyZ2V0LGMud2lkZ2V0TmFtZStcIi5wcmV2ZW50Q2xpY2tFdmVudFwiKSl7YS5yZW1vdmVEYXRhKGUudGFyZ2V0LGMud2lkZ2V0TmFtZStcIi5wcmV2ZW50Q2xpY2tFdmVudFwiKTtlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO3JldHVybiBmYWxzZX19KTt0aGlzLnN0YXJ0ZWQ9ZmFsc2V9LF9tb3VzZURlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQudW5iaW5kKFwiLlwiK1xudGhpcy53aWRnZXROYW1lKX0sX21vdXNlRG93bjpmdW5jdGlvbihjKXtpZighZCl7dGhpcy5fbW91c2VTdGFydGVkJiZ0aGlzLl9tb3VzZVVwKGMpO3RoaXMuX21vdXNlRG93bkV2ZW50PWM7dmFyIGU9dGhpcyxoPWMud2hpY2g9PTEsZz10eXBlb2YgdGhpcy5vcHRpb25zLmNhbmNlbD09XCJzdHJpbmdcIiYmYy50YXJnZXQubm9kZU5hbWU/YShjLnRhcmdldCkuY2xvc2VzdCh0aGlzLm9wdGlvbnMuY2FuY2VsKS5sZW5ndGg6ZmFsc2U7aWYoIWh8fGd8fCF0aGlzLl9tb3VzZUNhcHR1cmUoYykpcmV0dXJuIHRydWU7dGhpcy5tb3VzZURlbGF5TWV0PSF0aGlzLm9wdGlvbnMuZGVsYXk7aWYoIXRoaXMubW91c2VEZWxheU1ldCl0aGlzLl9tb3VzZURlbGF5VGltZXI9c2V0VGltZW91dChmdW5jdGlvbigpe2UubW91c2VEZWxheU1ldD10cnVlfSx0aGlzLm9wdGlvbnMuZGVsYXkpO2lmKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoYykmJnRoaXMuX21vdXNlRGVsYXlNZXQoYykpe3RoaXMuX21vdXNlU3RhcnRlZD1cbnRoaXMuX21vdXNlU3RhcnQoYykhPT1mYWxzZTtpZighdGhpcy5fbW91c2VTdGFydGVkKXtjLnByZXZlbnREZWZhdWx0KCk7cmV0dXJuIHRydWV9fXRydWU9PT1hLmRhdGEoYy50YXJnZXQsdGhpcy53aWRnZXROYW1lK1wiLnByZXZlbnRDbGlja0V2ZW50XCIpJiZhLnJlbW92ZURhdGEoYy50YXJnZXQsdGhpcy53aWRnZXROYW1lK1wiLnByZXZlbnRDbGlja0V2ZW50XCIpO3RoaXMuX21vdXNlTW92ZURlbGVnYXRlPWZ1bmN0aW9uKGkpe3JldHVybiBlLl9tb3VzZU1vdmUoaSl9O3RoaXMuX21vdXNlVXBEZWxlZ2F0ZT1mdW5jdGlvbihpKXtyZXR1cm4gZS5fbW91c2VVcChpKX07YShkb2N1bWVudCkuYmluZChcIm1vdXNlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLmJpbmQoXCJtb3VzZXVwLlwiK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZVVwRGVsZWdhdGUpO2MucHJldmVudERlZmF1bHQoKTtyZXR1cm4gZD10cnVlfX0sX21vdXNlTW92ZTpmdW5jdGlvbihjKXtpZihhLmJyb3dzZXIubXNpZSYmXG4hKGRvY3VtZW50LmRvY3VtZW50TW9kZT49OSkmJiFjLmJ1dHRvbilyZXR1cm4gdGhpcy5fbW91c2VVcChjKTtpZih0aGlzLl9tb3VzZVN0YXJ0ZWQpe3RoaXMuX21vdXNlRHJhZyhjKTtyZXR1cm4gYy5wcmV2ZW50RGVmYXVsdCgpfWlmKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoYykmJnRoaXMuX21vdXNlRGVsYXlNZXQoYykpKHRoaXMuX21vdXNlU3RhcnRlZD10aGlzLl9tb3VzZVN0YXJ0KHRoaXMuX21vdXNlRG93bkV2ZW50LGMpIT09ZmFsc2UpP3RoaXMuX21vdXNlRHJhZyhjKTp0aGlzLl9tb3VzZVVwKGMpO3JldHVybiF0aGlzLl9tb3VzZVN0YXJ0ZWR9LF9tb3VzZVVwOmZ1bmN0aW9uKGMpe2EoZG9jdW1lbnQpLnVuYmluZChcIm1vdXNlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLnVuYmluZChcIm1vdXNldXAuXCIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSk7aWYodGhpcy5fbW91c2VTdGFydGVkKXt0aGlzLl9tb3VzZVN0YXJ0ZWQ9XG5mYWxzZTtjLnRhcmdldD09dGhpcy5fbW91c2VEb3duRXZlbnQudGFyZ2V0JiZhLmRhdGEoYy50YXJnZXQsdGhpcy53aWRnZXROYW1lK1wiLnByZXZlbnRDbGlja0V2ZW50XCIsdHJ1ZSk7dGhpcy5fbW91c2VTdG9wKGMpfXJldHVybiBmYWxzZX0sX21vdXNlRGlzdGFuY2VNZXQ6ZnVuY3Rpb24oYyl7cmV0dXJuIE1hdGgubWF4KE1hdGguYWJzKHRoaXMuX21vdXNlRG93bkV2ZW50LnBhZ2VYLWMucGFnZVgpLE1hdGguYWJzKHRoaXMuX21vdXNlRG93bkV2ZW50LnBhZ2VZLWMucGFnZVkpKT49dGhpcy5vcHRpb25zLmRpc3RhbmNlfSxfbW91c2VEZWxheU1ldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1vdXNlRGVsYXlNZXR9LF9tb3VzZVN0YXJ0OmZ1bmN0aW9uKCl7fSxfbW91c2VEcmFnOmZ1bmN0aW9uKCl7fSxfbW91c2VTdG9wOmZ1bmN0aW9uKCl7fSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKCl7cmV0dXJuIHRydWV9fSl9KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2Eud2lkZ2V0KFwidWkuZHJhZ2dhYmxlXCIsYS51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6XCJkcmFnXCIsb3B0aW9uczp7YWRkQ2xhc3Nlczp0cnVlLGFwcGVuZFRvOlwicGFyZW50XCIsYXhpczpmYWxzZSxjb25uZWN0VG9Tb3J0YWJsZTpmYWxzZSxjb250YWlubWVudDpmYWxzZSxjdXJzb3I6XCJhdXRvXCIsY3Vyc29yQXQ6ZmFsc2UsZ3JpZDpmYWxzZSxoYW5kbGU6ZmFsc2UsaGVscGVyOlwib3JpZ2luYWxcIixpZnJhbWVGaXg6ZmFsc2Usb3BhY2l0eTpmYWxzZSxyZWZyZXNoUG9zaXRpb25zOmZhbHNlLHJldmVydDpmYWxzZSxyZXZlcnREdXJhdGlvbjo1MDAsc2NvcGU6XCJkZWZhdWx0XCIsc2Nyb2xsOnRydWUsc2Nyb2xsU2Vuc2l0aXZpdHk6MjAsc2Nyb2xsU3BlZWQ6MjAsc25hcDpmYWxzZSxzbmFwTW9kZTpcImJvdGhcIixzbmFwVG9sZXJhbmNlOjIwLHN0YWNrOmZhbHNlLHpJbmRleDpmYWxzZX0sX2NyZWF0ZTpmdW5jdGlvbigpe2lmKHRoaXMub3B0aW9ucy5oZWxwZXI9PVxuXCJvcmlnaW5hbFwiJiYhL14oPzpyfGF8ZikvLnRlc3QodGhpcy5lbGVtZW50LmNzcyhcInBvc2l0aW9uXCIpKSl0aGlzLmVsZW1lbnRbMF0uc3R5bGUucG9zaXRpb249XCJyZWxhdGl2ZVwiO3RoaXMub3B0aW9ucy5hZGRDbGFzc2VzJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1kcmFnZ2FibGVcIik7dGhpcy5vcHRpb25zLmRpc2FibGVkJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1kcmFnZ2FibGUtZGlzYWJsZWRcIik7dGhpcy5fbW91c2VJbml0KCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXtpZih0aGlzLmVsZW1lbnQuZGF0YShcImRyYWdnYWJsZVwiKSl7dGhpcy5lbGVtZW50LnJlbW92ZURhdGEoXCJkcmFnZ2FibGVcIikudW5iaW5kKFwiLmRyYWdnYWJsZVwiKS5yZW1vdmVDbGFzcyhcInVpLWRyYWdnYWJsZSB1aS1kcmFnZ2FibGUtZHJhZ2dpbmcgdWktZHJhZ2dhYmxlLWRpc2FibGVkXCIpO3RoaXMuX21vdXNlRGVzdHJveSgpO3JldHVybiB0aGlzfX0sX21vdXNlQ2FwdHVyZTpmdW5jdGlvbihkKXt2YXIgYz1cbnRoaXMub3B0aW9ucztpZih0aGlzLmhlbHBlcnx8Yy5kaXNhYmxlZHx8YShkLnRhcmdldCkuaXMoXCIudWktcmVzaXphYmxlLWhhbmRsZVwiKSlyZXR1cm4gZmFsc2U7dGhpcy5oYW5kbGU9dGhpcy5fZ2V0SGFuZGxlKGQpO2lmKCF0aGlzLmhhbmRsZSlyZXR1cm4gZmFsc2U7aWYoYy5pZnJhbWVGaXgpYShjLmlmcmFtZUZpeD09PXRydWU/XCJpZnJhbWVcIjpjLmlmcmFtZUZpeCkuZWFjaChmdW5jdGlvbigpe2EoJzxkaXYgY2xhc3M9XCJ1aS1kcmFnZ2FibGUtaWZyYW1lRml4XCIgc3R5bGU9XCJiYWNrZ3JvdW5kOiAjZmZmO1wiPjwvZGl2PicpLmNzcyh7d2lkdGg6dGhpcy5vZmZzZXRXaWR0aCtcInB4XCIsaGVpZ2h0OnRoaXMub2Zmc2V0SGVpZ2h0K1wicHhcIixwb3NpdGlvbjpcImFic29sdXRlXCIsb3BhY2l0eTpcIjAuMDAxXCIsekluZGV4OjFFM30pLmNzcyhhKHRoaXMpLm9mZnNldCgpKS5hcHBlbmRUbyhcImJvZHlcIil9KTtyZXR1cm4gdHJ1ZX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oZCl7dmFyIGM9dGhpcy5vcHRpb25zO1xudGhpcy5oZWxwZXI9dGhpcy5fY3JlYXRlSGVscGVyKGQpO3RoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKTtpZihhLnVpLmRkbWFuYWdlcilhLnVpLmRkbWFuYWdlci5jdXJyZW50PXRoaXM7dGhpcy5fY2FjaGVNYXJnaW5zKCk7dGhpcy5jc3NQb3NpdGlvbj10aGlzLmhlbHBlci5jc3MoXCJwb3NpdGlvblwiKTt0aGlzLnNjcm9sbFBhcmVudD10aGlzLmhlbHBlci5zY3JvbGxQYXJlbnQoKTt0aGlzLm9mZnNldD10aGlzLnBvc2l0aW9uQWJzPXRoaXMuZWxlbWVudC5vZmZzZXQoKTt0aGlzLm9mZnNldD17dG9wOnRoaXMub2Zmc2V0LnRvcC10aGlzLm1hcmdpbnMudG9wLGxlZnQ6dGhpcy5vZmZzZXQubGVmdC10aGlzLm1hcmdpbnMubGVmdH07YS5leHRlbmQodGhpcy5vZmZzZXQse2NsaWNrOntsZWZ0OmQucGFnZVgtdGhpcy5vZmZzZXQubGVmdCx0b3A6ZC5wYWdlWS10aGlzLm9mZnNldC50b3B9LHBhcmVudDp0aGlzLl9nZXRQYXJlbnRPZmZzZXQoKSxyZWxhdGl2ZTp0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpfSk7XG50aGlzLm9yaWdpbmFsUG9zaXRpb249dGhpcy5wb3NpdGlvbj10aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKGQpO3RoaXMub3JpZ2luYWxQYWdlWD1kLnBhZ2VYO3RoaXMub3JpZ2luYWxQYWdlWT1kLnBhZ2VZO2MuY3Vyc29yQXQmJnRoaXMuX2FkanVzdE9mZnNldEZyb21IZWxwZXIoYy5jdXJzb3JBdCk7Yy5jb250YWlubWVudCYmdGhpcy5fc2V0Q29udGFpbm1lbnQoKTtpZih0aGlzLl90cmlnZ2VyKFwic3RhcnRcIixkKT09PWZhbHNlKXt0aGlzLl9jbGVhcigpO3JldHVybiBmYWxzZX10aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCk7YS51aS5kZG1hbmFnZXImJiFjLmRyb3BCZWhhdmlvdXImJmEudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsZCk7dGhpcy5oZWxwZXIuYWRkQ2xhc3MoXCJ1aS1kcmFnZ2FibGUtZHJhZ2dpbmdcIik7dGhpcy5fbW91c2VEcmFnKGQsdHJ1ZSk7YS51aS5kZG1hbmFnZXImJmEudWkuZGRtYW5hZ2VyLmRyYWdTdGFydCh0aGlzLGQpO3JldHVybiB0cnVlfSxcbl9tb3VzZURyYWc6ZnVuY3Rpb24oZCxjKXt0aGlzLnBvc2l0aW9uPXRoaXMuX2dlbmVyYXRlUG9zaXRpb24oZCk7dGhpcy5wb3NpdGlvbkFicz10aGlzLl9jb252ZXJ0UG9zaXRpb25UbyhcImFic29sdXRlXCIpO2lmKCFjKXtjPXRoaXMuX3VpSGFzaCgpO2lmKHRoaXMuX3RyaWdnZXIoXCJkcmFnXCIsZCxjKT09PWZhbHNlKXt0aGlzLl9tb3VzZVVwKHt9KTtyZXR1cm4gZmFsc2V9dGhpcy5wb3NpdGlvbj1jLnBvc2l0aW9ufWlmKCF0aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5vcHRpb25zLmF4aXMhPVwieVwiKXRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQ9dGhpcy5wb3NpdGlvbi5sZWZ0K1wicHhcIjtpZighdGhpcy5vcHRpb25zLmF4aXN8fHRoaXMub3B0aW9ucy5heGlzIT1cInhcIil0aGlzLmhlbHBlclswXS5zdHlsZS50b3A9dGhpcy5wb3NpdGlvbi50b3ArXCJweFwiO2EudWkuZGRtYW5hZ2VyJiZhLnVpLmRkbWFuYWdlci5kcmFnKHRoaXMsZCk7cmV0dXJuIGZhbHNlfSxfbW91c2VTdG9wOmZ1bmN0aW9uKGQpe3ZhciBjPVxuZmFsc2U7aWYoYS51aS5kZG1hbmFnZXImJiF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91ciljPWEudWkuZGRtYW5hZ2VyLmRyb3AodGhpcyxkKTtpZih0aGlzLmRyb3BwZWQpe2M9dGhpcy5kcm9wcGVkO3RoaXMuZHJvcHBlZD1mYWxzZX1pZigoIXRoaXMuZWxlbWVudFswXXx8IXRoaXMuZWxlbWVudFswXS5wYXJlbnROb2RlKSYmdGhpcy5vcHRpb25zLmhlbHBlcj09XCJvcmlnaW5hbFwiKXJldHVybiBmYWxzZTtpZih0aGlzLm9wdGlvbnMucmV2ZXJ0PT1cImludmFsaWRcIiYmIWN8fHRoaXMub3B0aW9ucy5yZXZlcnQ9PVwidmFsaWRcIiYmY3x8dGhpcy5vcHRpb25zLnJldmVydD09PXRydWV8fGEuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMucmV2ZXJ0KSYmdGhpcy5vcHRpb25zLnJldmVydC5jYWxsKHRoaXMuZWxlbWVudCxjKSl7dmFyIGU9dGhpczthKHRoaXMuaGVscGVyKS5hbmltYXRlKHRoaXMub3JpZ2luYWxQb3NpdGlvbixwYXJzZUludCh0aGlzLm9wdGlvbnMucmV2ZXJ0RHVyYXRpb24sXG4xMCksZnVuY3Rpb24oKXtlLl90cmlnZ2VyKFwic3RvcFwiLGQpIT09ZmFsc2UmJmUuX2NsZWFyKCl9KX1lbHNlIHRoaXMuX3RyaWdnZXIoXCJzdG9wXCIsZCkhPT1mYWxzZSYmdGhpcy5fY2xlYXIoKTtyZXR1cm4gZmFsc2V9LF9tb3VzZVVwOmZ1bmN0aW9uKGQpe3RoaXMub3B0aW9ucy5pZnJhbWVGaXg9PT10cnVlJiZhKFwiZGl2LnVpLWRyYWdnYWJsZS1pZnJhbWVGaXhcIikuZWFjaChmdW5jdGlvbigpe3RoaXMucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzKX0pO2EudWkuZGRtYW5hZ2VyJiZhLnVpLmRkbWFuYWdlci5kcmFnU3RvcCh0aGlzLGQpO3JldHVybiBhLnVpLm1vdXNlLnByb3RvdHlwZS5fbW91c2VVcC5jYWxsKHRoaXMsZCl9LGNhbmNlbDpmdW5jdGlvbigpe3RoaXMuaGVscGVyLmlzKFwiLnVpLWRyYWdnYWJsZS1kcmFnZ2luZ1wiKT90aGlzLl9tb3VzZVVwKHt9KTp0aGlzLl9jbGVhcigpO3JldHVybiB0aGlzfSxfZ2V0SGFuZGxlOmZ1bmN0aW9uKGQpe3ZhciBjPSF0aGlzLm9wdGlvbnMuaGFuZGxlfHxcbiFhKHRoaXMub3B0aW9ucy5oYW5kbGUsdGhpcy5lbGVtZW50KS5sZW5ndGg/dHJ1ZTpmYWxzZTthKHRoaXMub3B0aW9ucy5oYW5kbGUsdGhpcy5lbGVtZW50KS5maW5kKFwiKlwiKS5hbmRTZWxmKCkuZWFjaChmdW5jdGlvbigpe2lmKHRoaXM9PWQudGFyZ2V0KWM9dHJ1ZX0pO3JldHVybiBjfSxfY3JlYXRlSGVscGVyOmZ1bmN0aW9uKGQpe3ZhciBjPXRoaXMub3B0aW9ucztkPWEuaXNGdW5jdGlvbihjLmhlbHBlcik/YShjLmhlbHBlci5hcHBseSh0aGlzLmVsZW1lbnRbMF0sW2RdKSk6Yy5oZWxwZXI9PVwiY2xvbmVcIj90aGlzLmVsZW1lbnQuY2xvbmUoKS5yZW1vdmVBdHRyKFwiaWRcIik6dGhpcy5lbGVtZW50O2QucGFyZW50cyhcImJvZHlcIikubGVuZ3RofHxkLmFwcGVuZFRvKGMuYXBwZW5kVG89PVwicGFyZW50XCI/dGhpcy5lbGVtZW50WzBdLnBhcmVudE5vZGU6Yy5hcHBlbmRUbyk7ZFswXSE9dGhpcy5lbGVtZW50WzBdJiYhLyhmaXhlZHxhYnNvbHV0ZSkvLnRlc3QoZC5jc3MoXCJwb3NpdGlvblwiKSkmJlxuZC5jc3MoXCJwb3NpdGlvblwiLFwiYWJzb2x1dGVcIik7cmV0dXJuIGR9LF9hZGp1c3RPZmZzZXRGcm9tSGVscGVyOmZ1bmN0aW9uKGQpe2lmKHR5cGVvZiBkPT1cInN0cmluZ1wiKWQ9ZC5zcGxpdChcIiBcIik7aWYoYS5pc0FycmF5KGQpKWQ9e2xlZnQ6K2RbMF0sdG9wOitkWzFdfHwwfTtpZihcImxlZnRcImluIGQpdGhpcy5vZmZzZXQuY2xpY2subGVmdD1kLmxlZnQrdGhpcy5tYXJnaW5zLmxlZnQ7aWYoXCJyaWdodFwiaW4gZCl0aGlzLm9mZnNldC5jbGljay5sZWZ0PXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtZC5yaWdodCt0aGlzLm1hcmdpbnMubGVmdDtpZihcInRvcFwiaW4gZCl0aGlzLm9mZnNldC5jbGljay50b3A9ZC50b3ArdGhpcy5tYXJnaW5zLnRvcDtpZihcImJvdHRvbVwiaW4gZCl0aGlzLm9mZnNldC5jbGljay50b3A9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtZC5ib3R0b20rdGhpcy5tYXJnaW5zLnRvcH0sX2dldFBhcmVudE9mZnNldDpmdW5jdGlvbigpe3RoaXMub2Zmc2V0UGFyZW50PVxudGhpcy5oZWxwZXIub2Zmc2V0UGFyZW50KCk7dmFyIGQ9dGhpcy5vZmZzZXRQYXJlbnQub2Zmc2V0KCk7aWYodGhpcy5jc3NQb3NpdGlvbj09XCJhYnNvbHV0ZVwiJiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmEudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKXtkLmxlZnQrPXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTtkLnRvcCs9dGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCl9aWYodGhpcy5vZmZzZXRQYXJlbnRbMF09PWRvY3VtZW50LmJvZHl8fHRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUmJnRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKT09XCJodG1sXCImJmEuYnJvd3Nlci5tc2llKWQ9e3RvcDowLGxlZnQ6MH07cmV0dXJue3RvcDpkLnRvcCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKSxsZWZ0OmQubGVmdCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLFxuMTApfHwwKX19LF9nZXRSZWxhdGl2ZU9mZnNldDpmdW5jdGlvbigpe2lmKHRoaXMuY3NzUG9zaXRpb249PVwicmVsYXRpdmVcIil7dmFyIGQ9dGhpcy5lbGVtZW50LnBvc2l0aW9uKCk7cmV0dXJue3RvcDpkLnRvcC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKFwidG9wXCIpLDEwKXx8MCkrdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCksbGVmdDpkLmxlZnQtKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcyhcImxlZnRcIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCl9fWVsc2UgcmV0dXJue3RvcDowLGxlZnQ6MH19LF9jYWNoZU1hcmdpbnM6ZnVuY3Rpb24oKXt0aGlzLm1hcmdpbnM9e2xlZnQ6cGFyc2VJbnQodGhpcy5lbGVtZW50LmNzcyhcIm1hcmdpbkxlZnRcIiksMTApfHwwLHRvcDpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKFwibWFyZ2luVG9wXCIpLDEwKXx8MCxyaWdodDpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKFwibWFyZ2luUmlnaHRcIiksMTApfHwwLGJvdHRvbTpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKFwibWFyZ2luQm90dG9tXCIpLFxuMTApfHwwfX0sX2NhY2hlSGVscGVyUHJvcG9ydGlvbnM6ZnVuY3Rpb24oKXt0aGlzLmhlbHBlclByb3BvcnRpb25zPXt3aWR0aDp0aGlzLmhlbHBlci5vdXRlcldpZHRoKCksaGVpZ2h0OnRoaXMuaGVscGVyLm91dGVySGVpZ2h0KCl9fSxfc2V0Q29udGFpbm1lbnQ6ZnVuY3Rpb24oKXt2YXIgZD10aGlzLm9wdGlvbnM7aWYoZC5jb250YWlubWVudD09XCJwYXJlbnRcIilkLmNvbnRhaW5tZW50PXRoaXMuaGVscGVyWzBdLnBhcmVudE5vZGU7aWYoZC5jb250YWlubWVudD09XCJkb2N1bWVudFwifHxkLmNvbnRhaW5tZW50PT1cIndpbmRvd1wiKXRoaXMuY29udGFpbm1lbnQ9W2QuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcIj8wOmEod2luZG93KS5zY3JvbGxMZWZ0KCktdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCxkLmNvbnRhaW5tZW50PT1cImRvY3VtZW50XCI/MDphKHdpbmRvdykuc2Nyb2xsVG9wKCktdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3AsXG4oZC5jb250YWlubWVudD09XCJkb2N1bWVudFwiPzA6YSh3aW5kb3cpLnNjcm9sbExlZnQoKSkrYShkLmNvbnRhaW5tZW50PT1cImRvY3VtZW50XCI/ZG9jdW1lbnQ6d2luZG93KS53aWR0aCgpLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtdGhpcy5tYXJnaW5zLmxlZnQsKGQuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcIj8wOmEod2luZG93KS5zY3JvbGxUb3AoKSkrKGEoZC5jb250YWlubWVudD09XCJkb2N1bWVudFwiP2RvY3VtZW50OndpbmRvdykuaGVpZ2h0KCl8fGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZS5zY3JvbGxIZWlnaHQpLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LXRoaXMubWFyZ2lucy50b3BdO2lmKCEvXihkb2N1bWVudHx3aW5kb3d8cGFyZW50KSQvLnRlc3QoZC5jb250YWlubWVudCkmJmQuY29udGFpbm1lbnQuY29uc3RydWN0b3IhPUFycmF5KXtkPWEoZC5jb250YWlubWVudCk7dmFyIGM9ZFswXTtpZihjKXtkLm9mZnNldCgpO3ZhciBlPWEoYykuY3NzKFwib3ZlcmZsb3dcIikhPVxuXCJoaWRkZW5cIjt0aGlzLmNvbnRhaW5tZW50PVsocGFyc2VJbnQoYShjKS5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKSsocGFyc2VJbnQoYShjKS5jc3MoXCJwYWRkaW5nTGVmdFwiKSwxMCl8fDApLChwYXJzZUludChhKGMpLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLDEwKXx8MCkrKHBhcnNlSW50KGEoYykuY3NzKFwicGFkZGluZ1RvcFwiKSwxMCl8fDApLChlP01hdGgubWF4KGMuc2Nyb2xsV2lkdGgsYy5vZmZzZXRXaWR0aCk6Yy5vZmZzZXRXaWR0aCktKHBhcnNlSW50KGEoYykuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCktKHBhcnNlSW50KGEoYykuY3NzKFwicGFkZGluZ1JpZ2h0XCIpLDEwKXx8MCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdC10aGlzLm1hcmdpbnMucmlnaHQsKGU/TWF0aC5tYXgoYy5zY3JvbGxIZWlnaHQsYy5vZmZzZXRIZWlnaHQpOmMub2Zmc2V0SGVpZ2h0KS0ocGFyc2VJbnQoYShjKS5jc3MoXCJib3JkZXJUb3BXaWR0aFwiKSxcbjEwKXx8MCktKHBhcnNlSW50KGEoYykuY3NzKFwicGFkZGluZ0JvdHRvbVwiKSwxMCl8fDApLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LXRoaXMubWFyZ2lucy50b3AtdGhpcy5tYXJnaW5zLmJvdHRvbV07dGhpcy5yZWxhdGl2ZV9jb250YWluZXI9ZH19ZWxzZSBpZihkLmNvbnRhaW5tZW50LmNvbnN0cnVjdG9yPT1BcnJheSl0aGlzLmNvbnRhaW5tZW50PWQuY29udGFpbm1lbnR9LF9jb252ZXJ0UG9zaXRpb25UbzpmdW5jdGlvbihkLGMpe2lmKCFjKWM9dGhpcy5wb3NpdGlvbjtkPWQ9PVwiYWJzb2x1dGVcIj8xOi0xO3ZhciBlPXRoaXMuY3NzUG9zaXRpb249PVwiYWJzb2x1dGVcIiYmISh0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmEudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKT90aGlzLm9mZnNldFBhcmVudDp0aGlzLnNjcm9sbFBhcmVudCxoPS8oaHRtbHxib2R5KS9pLnRlc3QoZVswXS50YWdOYW1lKTtyZXR1cm57dG9wOmMudG9wK1xudGhpcy5vZmZzZXQucmVsYXRpdmUudG9wKmQrdGhpcy5vZmZzZXQucGFyZW50LnRvcCpkLShhLmJyb3dzZXIuc2FmYXJpJiZhLmJyb3dzZXIudmVyc2lvbjw1MjYmJnRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8wOih0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpOmg/MDplLnNjcm9sbFRvcCgpKSpkKSxsZWZ0OmMubGVmdCt0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0KmQrdGhpcy5vZmZzZXQucGFyZW50LmxlZnQqZC0oYS5icm93c2VyLnNhZmFyaSYmYS5icm93c2VyLnZlcnNpb248NTI2JiZ0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/MDoodGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk6aD8wOmUuc2Nyb2xsTGVmdCgpKSpkKX19LF9nZW5lcmF0ZVBvc2l0aW9uOmZ1bmN0aW9uKGQpe3ZhciBjPXRoaXMub3B0aW9ucyxlPXRoaXMuY3NzUG9zaXRpb249PVwiYWJzb2x1dGVcIiYmXG4hKHRoaXMuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmYS51aS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSkpP3RoaXMub2Zmc2V0UGFyZW50OnRoaXMuc2Nyb2xsUGFyZW50LGg9LyhodG1sfGJvZHkpL2kudGVzdChlWzBdLnRhZ05hbWUpLGc9ZC5wYWdlWCxpPWQucGFnZVk7aWYodGhpcy5vcmlnaW5hbFBvc2l0aW9uKXt2YXIgYjtpZih0aGlzLmNvbnRhaW5tZW50KXtpZih0aGlzLnJlbGF0aXZlX2NvbnRhaW5lcil7Yj10aGlzLnJlbGF0aXZlX2NvbnRhaW5lci5vZmZzZXQoKTtiPVt0aGlzLmNvbnRhaW5tZW50WzBdK2IubGVmdCx0aGlzLmNvbnRhaW5tZW50WzFdK2IudG9wLHRoaXMuY29udGFpbm1lbnRbMl0rYi5sZWZ0LHRoaXMuY29udGFpbm1lbnRbM10rYi50b3BdfWVsc2UgYj10aGlzLmNvbnRhaW5tZW50O2lmKGQucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdDxiWzBdKWc9YlswXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0O1xuaWYoZC5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A8YlsxXSlpPWJbMV0rdGhpcy5vZmZzZXQuY2xpY2sudG9wO2lmKGQucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdD5iWzJdKWc9YlsyXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0O2lmKGQucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPmJbM10paT1iWzNdK3RoaXMub2Zmc2V0LmNsaWNrLnRvcH1pZihjLmdyaWQpe2k9Yy5ncmlkWzFdP3RoaXMub3JpZ2luYWxQYWdlWStNYXRoLnJvdW5kKChpLXRoaXMub3JpZ2luYWxQYWdlWSkvYy5ncmlkWzFdKSpjLmdyaWRbMV06dGhpcy5vcmlnaW5hbFBhZ2VZO2k9Yj8hKGktdGhpcy5vZmZzZXQuY2xpY2sudG9wPGJbMV18fGktdGhpcy5vZmZzZXQuY2xpY2sudG9wPmJbM10pP2k6IShpLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDxiWzFdKT9pLWMuZ3JpZFsxXTppK2MuZ3JpZFsxXTppO2c9Yy5ncmlkWzBdP3RoaXMub3JpZ2luYWxQYWdlWCtNYXRoLnJvdW5kKChnLXRoaXMub3JpZ2luYWxQYWdlWCkvXG5jLmdyaWRbMF0pKmMuZ3JpZFswXTp0aGlzLm9yaWdpbmFsUGFnZVg7Zz1iPyEoZy10aGlzLm9mZnNldC5jbGljay5sZWZ0PGJbMF18fGctdGhpcy5vZmZzZXQuY2xpY2subGVmdD5iWzJdKT9nOiEoZy10aGlzLm9mZnNldC5jbGljay5sZWZ0PGJbMF0pP2ctYy5ncmlkWzBdOmcrYy5ncmlkWzBdOmd9fXJldHVybnt0b3A6aS10aGlzLm9mZnNldC5jbGljay50b3AtdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3ArKGEuYnJvd3Nlci5zYWZhcmkmJmEuYnJvd3Nlci52ZXJzaW9uPDUyNiYmdGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPzA6dGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTpoPzA6ZS5zY3JvbGxUb3AoKSksbGVmdDpnLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQtdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCsoYS5icm93c2VyLnNhZmFyaSYmYS5icm93c2VyLnZlcnNpb248XG41MjYmJnRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8wOnRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOmg/MDplLnNjcm9sbExlZnQoKSl9fSxfY2xlYXI6ZnVuY3Rpb24oKXt0aGlzLmhlbHBlci5yZW1vdmVDbGFzcyhcInVpLWRyYWdnYWJsZS1kcmFnZ2luZ1wiKTt0aGlzLmhlbHBlclswXSE9dGhpcy5lbGVtZW50WzBdJiYhdGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsJiZ0aGlzLmhlbHBlci5yZW1vdmUoKTt0aGlzLmhlbHBlcj1udWxsO3RoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbD1mYWxzZX0sX3RyaWdnZXI6ZnVuY3Rpb24oZCxjLGUpe2U9ZXx8dGhpcy5fdWlIYXNoKCk7YS51aS5wbHVnaW4uY2FsbCh0aGlzLGQsW2MsZV0pO2lmKGQ9PVwiZHJhZ1wiKXRoaXMucG9zaXRpb25BYnM9dGhpcy5fY29udmVydFBvc2l0aW9uVG8oXCJhYnNvbHV0ZVwiKTtyZXR1cm4gYS5XaWRnZXQucHJvdG90eXBlLl90cmlnZ2VyLmNhbGwodGhpcyxkLGMsXG5lKX0scGx1Z2luczp7fSxfdWlIYXNoOmZ1bmN0aW9uKCl7cmV0dXJue2hlbHBlcjp0aGlzLmhlbHBlcixwb3NpdGlvbjp0aGlzLnBvc2l0aW9uLG9yaWdpbmFsUG9zaXRpb246dGhpcy5vcmlnaW5hbFBvc2l0aW9uLG9mZnNldDp0aGlzLnBvc2l0aW9uQWJzfX19KTthLmV4dGVuZChhLnVpLmRyYWdnYWJsZSx7dmVyc2lvbjpcIjEuOC4xNlwifSk7YS51aS5wbHVnaW4uYWRkKFwiZHJhZ2dhYmxlXCIsXCJjb25uZWN0VG9Tb3J0YWJsZVwiLHtzdGFydDpmdW5jdGlvbihkLGMpe3ZhciBlPWEodGhpcykuZGF0YShcImRyYWdnYWJsZVwiKSxoPWUub3B0aW9ucyxnPWEuZXh0ZW5kKHt9LGMse2l0ZW06ZS5lbGVtZW50fSk7ZS5zb3J0YWJsZXM9W107YShoLmNvbm5lY3RUb1NvcnRhYmxlKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGk9YS5kYXRhKHRoaXMsXCJzb3J0YWJsZVwiKTtpZihpJiYhaS5vcHRpb25zLmRpc2FibGVkKXtlLnNvcnRhYmxlcy5wdXNoKHtpbnN0YW5jZTppLHNob3VsZFJldmVydDppLm9wdGlvbnMucmV2ZXJ0fSk7XG5pLnJlZnJlc2hQb3NpdGlvbnMoKTtpLl90cmlnZ2VyKFwiYWN0aXZhdGVcIixkLGcpfX0pfSxzdG9wOmZ1bmN0aW9uKGQsYyl7dmFyIGU9YSh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLGg9YS5leHRlbmQoe30sYyx7aXRlbTplLmVsZW1lbnR9KTthLmVhY2goZS5zb3J0YWJsZXMsZnVuY3Rpb24oKXtpZih0aGlzLmluc3RhbmNlLmlzT3Zlcil7dGhpcy5pbnN0YW5jZS5pc092ZXI9MDtlLmNhbmNlbEhlbHBlclJlbW92YWw9dHJ1ZTt0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWw9ZmFsc2U7aWYodGhpcy5zaG91bGRSZXZlcnQpdGhpcy5pbnN0YW5jZS5vcHRpb25zLnJldmVydD10cnVlO3RoaXMuaW5zdGFuY2UuX21vdXNlU3RvcChkKTt0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5faGVscGVyO2Uub3B0aW9ucy5oZWxwZXI9PVwib3JpZ2luYWxcIiYmdGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbS5jc3Moe3RvcDpcImF1dG9cIixsZWZ0OlwiYXV0b1wifSl9ZWxzZXt0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWw9XG5mYWxzZTt0aGlzLmluc3RhbmNlLl90cmlnZ2VyKFwiZGVhY3RpdmF0ZVwiLGQsaCl9fSl9LGRyYWc6ZnVuY3Rpb24oZCxjKXt2YXIgZT1hKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIiksaD10aGlzO2EuZWFjaChlLnNvcnRhYmxlcyxmdW5jdGlvbigpe3RoaXMuaW5zdGFuY2UucG9zaXRpb25BYnM9ZS5wb3NpdGlvbkFiczt0aGlzLmluc3RhbmNlLmhlbHBlclByb3BvcnRpb25zPWUuaGVscGVyUHJvcG9ydGlvbnM7dGhpcy5pbnN0YW5jZS5vZmZzZXQuY2xpY2s9ZS5vZmZzZXQuY2xpY2s7aWYodGhpcy5pbnN0YW5jZS5faW50ZXJzZWN0c1dpdGgodGhpcy5pbnN0YW5jZS5jb250YWluZXJDYWNoZSkpe2lmKCF0aGlzLmluc3RhbmNlLmlzT3Zlcil7dGhpcy5pbnN0YW5jZS5pc092ZXI9MTt0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtPWEoaCkuY2xvbmUoKS5yZW1vdmVBdHRyKFwiaWRcIikuYXBwZW5kVG8odGhpcy5pbnN0YW5jZS5lbGVtZW50KS5kYXRhKFwic29ydGFibGUtaXRlbVwiLHRydWUpO1xudGhpcy5pbnN0YW5jZS5vcHRpb25zLl9oZWxwZXI9dGhpcy5pbnN0YW5jZS5vcHRpb25zLmhlbHBlcjt0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPWZ1bmN0aW9uKCl7cmV0dXJuIGMuaGVscGVyWzBdfTtkLnRhcmdldD10aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtWzBdO3RoaXMuaW5zdGFuY2UuX21vdXNlQ2FwdHVyZShkLHRydWUpO3RoaXMuaW5zdGFuY2UuX21vdXNlU3RhcnQoZCx0cnVlLHRydWUpO3RoaXMuaW5zdGFuY2Uub2Zmc2V0LmNsaWNrLnRvcD1lLm9mZnNldC5jbGljay50b3A7dGhpcy5pbnN0YW5jZS5vZmZzZXQuY2xpY2subGVmdD1lLm9mZnNldC5jbGljay5sZWZ0O3RoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC5sZWZ0LT1lLm9mZnNldC5wYXJlbnQubGVmdC10aGlzLmluc3RhbmNlLm9mZnNldC5wYXJlbnQubGVmdDt0aGlzLmluc3RhbmNlLm9mZnNldC5wYXJlbnQudG9wLT1lLm9mZnNldC5wYXJlbnQudG9wLXRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC50b3A7XG5lLl90cmlnZ2VyKFwidG9Tb3J0YWJsZVwiLGQpO2UuZHJvcHBlZD10aGlzLmluc3RhbmNlLmVsZW1lbnQ7ZS5jdXJyZW50SXRlbT1lLmVsZW1lbnQ7dGhpcy5pbnN0YW5jZS5mcm9tT3V0c2lkZT1lfXRoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW0mJnRoaXMuaW5zdGFuY2UuX21vdXNlRHJhZyhkKX1lbHNlIGlmKHRoaXMuaW5zdGFuY2UuaXNPdmVyKXt0aGlzLmluc3RhbmNlLmlzT3Zlcj0wO3RoaXMuaW5zdGFuY2UuY2FuY2VsSGVscGVyUmVtb3ZhbD10cnVlO3RoaXMuaW5zdGFuY2Uub3B0aW9ucy5yZXZlcnQ9ZmFsc2U7dGhpcy5pbnN0YW5jZS5fdHJpZ2dlcihcIm91dFwiLGQsdGhpcy5pbnN0YW5jZS5fdWlIYXNoKHRoaXMuaW5zdGFuY2UpKTt0aGlzLmluc3RhbmNlLl9tb3VzZVN0b3AoZCx0cnVlKTt0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5faGVscGVyO3RoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW0ucmVtb3ZlKCk7dGhpcy5pbnN0YW5jZS5wbGFjZWhvbGRlciYmXG50aGlzLmluc3RhbmNlLnBsYWNlaG9sZGVyLnJlbW92ZSgpO2UuX3RyaWdnZXIoXCJmcm9tU29ydGFibGVcIixkKTtlLmRyb3BwZWQ9ZmFsc2V9fSl9fSk7YS51aS5wbHVnaW4uYWRkKFwiZHJhZ2dhYmxlXCIsXCJjdXJzb3JcIix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgZD1hKFwiYm9keVwiKSxjPWEodGhpcykuZGF0YShcImRyYWdnYWJsZVwiKS5vcHRpb25zO2lmKGQuY3NzKFwiY3Vyc29yXCIpKWMuX2N1cnNvcj1kLmNzcyhcImN1cnNvclwiKTtkLmNzcyhcImN1cnNvclwiLGMuY3Vyc29yKX0sc3RvcDpmdW5jdGlvbigpe3ZhciBkPWEodGhpcykuZGF0YShcImRyYWdnYWJsZVwiKS5vcHRpb25zO2QuX2N1cnNvciYmYShcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIsZC5fY3Vyc29yKX19KTthLnVpLnBsdWdpbi5hZGQoXCJkcmFnZ2FibGVcIixcIm9wYWNpdHlcIix7c3RhcnQ6ZnVuY3Rpb24oZCxjKXtkPWEoYy5oZWxwZXIpO2M9YSh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLm9wdGlvbnM7aWYoZC5jc3MoXCJvcGFjaXR5XCIpKWMuX29wYWNpdHk9XG5kLmNzcyhcIm9wYWNpdHlcIik7ZC5jc3MoXCJvcGFjaXR5XCIsYy5vcGFjaXR5KX0sc3RvcDpmdW5jdGlvbihkLGMpe2Q9YSh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLm9wdGlvbnM7ZC5fb3BhY2l0eSYmYShjLmhlbHBlcikuY3NzKFwib3BhY2l0eVwiLGQuX29wYWNpdHkpfX0pO2EudWkucGx1Z2luLmFkZChcImRyYWdnYWJsZVwiLFwic2Nyb2xsXCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpO2lmKGQuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmZC5zY3JvbGxQYXJlbnRbMF0udGFnTmFtZSE9XCJIVE1MXCIpZC5vdmVyZmxvd09mZnNldD1kLnNjcm9sbFBhcmVudC5vZmZzZXQoKX0sZHJhZzpmdW5jdGlvbihkKXt2YXIgYz1hKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIiksZT1jLm9wdGlvbnMsaD1mYWxzZTtpZihjLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUhPVwiSFRNTFwiKXtpZighZS5heGlzfHxlLmF4aXMhPVxuXCJ4XCIpaWYoYy5vdmVyZmxvd09mZnNldC50b3ArYy5zY3JvbGxQYXJlbnRbMF0ub2Zmc2V0SGVpZ2h0LWQucGFnZVk8ZS5zY3JvbGxTZW5zaXRpdml0eSljLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3A9aD1jLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3ArZS5zY3JvbGxTcGVlZDtlbHNlIGlmKGQucGFnZVktYy5vdmVyZmxvd09mZnNldC50b3A8ZS5zY3JvbGxTZW5zaXRpdml0eSljLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3A9aD1jLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AtZS5zY3JvbGxTcGVlZDtpZighZS5heGlzfHxlLmF4aXMhPVwieVwiKWlmKGMub3ZlcmZsb3dPZmZzZXQubGVmdCtjLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aC1kLnBhZ2VYPGUuc2Nyb2xsU2Vuc2l0aXZpdHkpYy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1oPWMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQrZS5zY3JvbGxTcGVlZDtlbHNlIGlmKGQucGFnZVgtYy5vdmVyZmxvd09mZnNldC5sZWZ0PFxuZS5zY3JvbGxTZW5zaXRpdml0eSljLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0PWg9Yy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdC1lLnNjcm9sbFNwZWVkfWVsc2V7aWYoIWUuYXhpc3x8ZS5heGlzIT1cInhcIilpZihkLnBhZ2VZLWEoZG9jdW1lbnQpLnNjcm9sbFRvcCgpPGUuc2Nyb2xsU2Vuc2l0aXZpdHkpaD1hKGRvY3VtZW50KS5zY3JvbGxUb3AoYShkb2N1bWVudCkuc2Nyb2xsVG9wKCktZS5zY3JvbGxTcGVlZCk7ZWxzZSBpZihhKHdpbmRvdykuaGVpZ2h0KCktKGQucGFnZVktYShkb2N1bWVudCkuc2Nyb2xsVG9wKCkpPGUuc2Nyb2xsU2Vuc2l0aXZpdHkpaD1hKGRvY3VtZW50KS5zY3JvbGxUb3AoYShkb2N1bWVudCkuc2Nyb2xsVG9wKCkrZS5zY3JvbGxTcGVlZCk7aWYoIWUuYXhpc3x8ZS5heGlzIT1cInlcIilpZihkLnBhZ2VYLWEoZG9jdW1lbnQpLnNjcm9sbExlZnQoKTxlLnNjcm9sbFNlbnNpdGl2aXR5KWg9YShkb2N1bWVudCkuc2Nyb2xsTGVmdChhKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCktXG5lLnNjcm9sbFNwZWVkKTtlbHNlIGlmKGEod2luZG93KS53aWR0aCgpLShkLnBhZ2VYLWEoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSk8ZS5zY3JvbGxTZW5zaXRpdml0eSloPWEoZG9jdW1lbnQpLnNjcm9sbExlZnQoYShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpK2Uuc2Nyb2xsU3BlZWQpfWghPT1mYWxzZSYmYS51aS5kZG1hbmFnZXImJiFlLmRyb3BCZWhhdmlvdXImJmEudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKGMsZCl9fSk7YS51aS5wbHVnaW4uYWRkKFwiZHJhZ2dhYmxlXCIsXCJzbmFwXCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLGM9ZC5vcHRpb25zO2Quc25hcEVsZW1lbnRzPVtdO2EoYy5zbmFwLmNvbnN0cnVjdG9yIT1TdHJpbmc/Yy5zbmFwLml0ZW1zfHxcIjpkYXRhKGRyYWdnYWJsZSlcIjpjLnNuYXApLmVhY2goZnVuY3Rpb24oKXt2YXIgZT1hKHRoaXMpLGg9ZS5vZmZzZXQoKTt0aGlzIT1kLmVsZW1lbnRbMF0mJmQuc25hcEVsZW1lbnRzLnB1c2goe2l0ZW06dGhpcyxcbndpZHRoOmUub3V0ZXJXaWR0aCgpLGhlaWdodDplLm91dGVySGVpZ2h0KCksdG9wOmgudG9wLGxlZnQ6aC5sZWZ0fSl9KX0sZHJhZzpmdW5jdGlvbihkLGMpe2Zvcih2YXIgZT1hKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIiksaD1lLm9wdGlvbnMsZz1oLnNuYXBUb2xlcmFuY2UsaT1jLm9mZnNldC5sZWZ0LGI9aStlLmhlbHBlclByb3BvcnRpb25zLndpZHRoLGY9Yy5vZmZzZXQudG9wLGo9ZitlLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxsPWUuc25hcEVsZW1lbnRzLmxlbmd0aC0xO2w+PTA7bC0tKXt2YXIgbz1lLnNuYXBFbGVtZW50c1tsXS5sZWZ0LG49bytlLnNuYXBFbGVtZW50c1tsXS53aWR0aCxrPWUuc25hcEVsZW1lbnRzW2xdLnRvcCxtPWsrZS5zbmFwRWxlbWVudHNbbF0uaGVpZ2h0O2lmKG8tZzxpJiZpPG4rZyYmay1nPGYmJmY8bStnfHxvLWc8aSYmaTxuK2cmJmstZzxqJiZqPG0rZ3x8by1nPGImJmI8bitnJiZrLWc8ZiYmZjxtK2d8fG8tZzxiJiZiPG4rZyYmay1nPGomJlxuajxtK2cpe2lmKGguc25hcE1vZGUhPVwiaW5uZXJcIil7dmFyIHA9TWF0aC5hYnMoay1qKTw9ZyxxPU1hdGguYWJzKG0tZik8PWcscz1NYXRoLmFicyhvLWIpPD1nLHI9TWF0aC5hYnMobi1pKTw9ZztpZihwKWMucG9zaXRpb24udG9wPWUuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOmstZS5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsbGVmdDowfSkudG9wLWUubWFyZ2lucy50b3A7aWYocSljLnBvc2l0aW9uLnRvcD1lLl9jb252ZXJ0UG9zaXRpb25UbyhcInJlbGF0aXZlXCIse3RvcDptLGxlZnQ6MH0pLnRvcC1lLm1hcmdpbnMudG9wO2lmKHMpYy5wb3NpdGlvbi5sZWZ0PWUuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOjAsbGVmdDpvLWUuaGVscGVyUHJvcG9ydGlvbnMud2lkdGh9KS5sZWZ0LWUubWFyZ2lucy5sZWZ0O2lmKHIpYy5wb3NpdGlvbi5sZWZ0PWUuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOjAsbGVmdDpufSkubGVmdC1lLm1hcmdpbnMubGVmdH12YXIgdT1cbnB8fHF8fHN8fHI7aWYoaC5zbmFwTW9kZSE9XCJvdXRlclwiKXtwPU1hdGguYWJzKGstZik8PWc7cT1NYXRoLmFicyhtLWopPD1nO3M9TWF0aC5hYnMoby1pKTw9ZztyPU1hdGguYWJzKG4tYik8PWc7aWYocCljLnBvc2l0aW9uLnRvcD1lLl9jb252ZXJ0UG9zaXRpb25UbyhcInJlbGF0aXZlXCIse3RvcDprLGxlZnQ6MH0pLnRvcC1lLm1hcmdpbnMudG9wO2lmKHEpYy5wb3NpdGlvbi50b3A9ZS5fY29udmVydFBvc2l0aW9uVG8oXCJyZWxhdGl2ZVwiLHt0b3A6bS1lLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxsZWZ0OjB9KS50b3AtZS5tYXJnaW5zLnRvcDtpZihzKWMucG9zaXRpb24ubGVmdD1lLl9jb252ZXJ0UG9zaXRpb25UbyhcInJlbGF0aXZlXCIse3RvcDowLGxlZnQ6b30pLmxlZnQtZS5tYXJnaW5zLmxlZnQ7aWYociljLnBvc2l0aW9uLmxlZnQ9ZS5fY29udmVydFBvc2l0aW9uVG8oXCJyZWxhdGl2ZVwiLHt0b3A6MCxsZWZ0Om4tZS5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aH0pLmxlZnQtZS5tYXJnaW5zLmxlZnR9aWYoIWUuc25hcEVsZW1lbnRzW2xdLnNuYXBwaW5nJiZcbihwfHxxfHxzfHxyfHx1KSllLm9wdGlvbnMuc25hcC5zbmFwJiZlLm9wdGlvbnMuc25hcC5zbmFwLmNhbGwoZS5lbGVtZW50LGQsYS5leHRlbmQoZS5fdWlIYXNoKCkse3NuYXBJdGVtOmUuc25hcEVsZW1lbnRzW2xdLml0ZW19KSk7ZS5zbmFwRWxlbWVudHNbbF0uc25hcHBpbmc9cHx8cXx8c3x8cnx8dX1lbHNle2Uuc25hcEVsZW1lbnRzW2xdLnNuYXBwaW5nJiZlLm9wdGlvbnMuc25hcC5yZWxlYXNlJiZlLm9wdGlvbnMuc25hcC5yZWxlYXNlLmNhbGwoZS5lbGVtZW50LGQsYS5leHRlbmQoZS5fdWlIYXNoKCkse3NuYXBJdGVtOmUuc25hcEVsZW1lbnRzW2xdLml0ZW19KSk7ZS5zbmFwRWxlbWVudHNbbF0uc25hcHBpbmc9ZmFsc2V9fX19KTthLnVpLnBsdWdpbi5hZGQoXCJkcmFnZ2FibGVcIixcInN0YWNrXCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLm9wdGlvbnM7ZD1hLm1ha2VBcnJheShhKGQuc3RhY2spKS5zb3J0KGZ1bmN0aW9uKGUsaCl7cmV0dXJuKHBhcnNlSW50KGEoZSkuY3NzKFwiekluZGV4XCIpLFxuMTApfHwwKS0ocGFyc2VJbnQoYShoKS5jc3MoXCJ6SW5kZXhcIiksMTApfHwwKX0pO2lmKGQubGVuZ3RoKXt2YXIgYz1wYXJzZUludChkWzBdLnN0eWxlLnpJbmRleCl8fDA7YShkKS5lYWNoKGZ1bmN0aW9uKGUpe3RoaXMuc3R5bGUuekluZGV4PWMrZX0pO3RoaXNbMF0uc3R5bGUuekluZGV4PWMrZC5sZW5ndGh9fX0pO2EudWkucGx1Z2luLmFkZChcImRyYWdnYWJsZVwiLFwiekluZGV4XCIse3N0YXJ0OmZ1bmN0aW9uKGQsYyl7ZD1hKGMuaGVscGVyKTtjPWEodGhpcykuZGF0YShcImRyYWdnYWJsZVwiKS5vcHRpb25zO2lmKGQuY3NzKFwiekluZGV4XCIpKWMuX3pJbmRleD1kLmNzcyhcInpJbmRleFwiKTtkLmNzcyhcInpJbmRleFwiLGMuekluZGV4KX0sc3RvcDpmdW5jdGlvbihkLGMpe2Q9YSh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLm9wdGlvbnM7ZC5fekluZGV4JiZhKGMuaGVscGVyKS5jc3MoXCJ6SW5kZXhcIixkLl96SW5kZXgpfX0pfSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLndpZGdldChcInVpLmRyb3BwYWJsZVwiLHt3aWRnZXRFdmVudFByZWZpeDpcImRyb3BcIixvcHRpb25zOnthY2NlcHQ6XCIqXCIsYWN0aXZlQ2xhc3M6ZmFsc2UsYWRkQ2xhc3Nlczp0cnVlLGdyZWVkeTpmYWxzZSxob3ZlckNsYXNzOmZhbHNlLHNjb3BlOlwiZGVmYXVsdFwiLHRvbGVyYW5jZTpcImludGVyc2VjdFwifSxfY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIGQ9dGhpcy5vcHRpb25zLGM9ZC5hY2NlcHQ7dGhpcy5pc292ZXI9MDt0aGlzLmlzb3V0PTE7dGhpcy5hY2NlcHQ9YS5pc0Z1bmN0aW9uKGMpP2M6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuaXMoYyl9O3RoaXMucHJvcG9ydGlvbnM9e3dpZHRoOnRoaXMuZWxlbWVudFswXS5vZmZzZXRXaWR0aCxoZWlnaHQ6dGhpcy5lbGVtZW50WzBdLm9mZnNldEhlaWdodH07YS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1tkLnNjb3BlXT1hLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Quc2NvcGVdfHxbXTthLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Quc2NvcGVdLnB1c2godGhpcyk7XG5kLmFkZENsYXNzZXMmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWRyb3BwYWJsZVwiKX0sZGVzdHJveTpmdW5jdGlvbigpe2Zvcih2YXIgZD1hLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW3RoaXMub3B0aW9ucy5zY29wZV0sYz0wO2M8ZC5sZW5ndGg7YysrKWRbY109PXRoaXMmJmQuc3BsaWNlKGMsMSk7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktZHJvcHBhYmxlIHVpLWRyb3BwYWJsZS1kaXNhYmxlZFwiKS5yZW1vdmVEYXRhKFwiZHJvcHBhYmxlXCIpLnVuYmluZChcIi5kcm9wcGFibGVcIik7cmV0dXJuIHRoaXN9LF9zZXRPcHRpb246ZnVuY3Rpb24oZCxjKXtpZihkPT1cImFjY2VwdFwiKXRoaXMuYWNjZXB0PWEuaXNGdW5jdGlvbihjKT9jOmZ1bmN0aW9uKGUpe3JldHVybiBlLmlzKGMpfTthLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LF9hY3RpdmF0ZTpmdW5jdGlvbihkKXt2YXIgYz1hLnVpLmRkbWFuYWdlci5jdXJyZW50O3RoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyYmXG50aGlzLmVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzKTtjJiZ0aGlzLl90cmlnZ2VyKFwiYWN0aXZhdGVcIixkLHRoaXMudWkoYykpfSxfZGVhY3RpdmF0ZTpmdW5jdGlvbihkKXt2YXIgYz1hLnVpLmRkbWFuYWdlci5jdXJyZW50O3RoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyk7YyYmdGhpcy5fdHJpZ2dlcihcImRlYWN0aXZhdGVcIixkLHRoaXMudWkoYykpfSxfb3ZlcjpmdW5jdGlvbihkKXt2YXIgYz1hLnVpLmRkbWFuYWdlci5jdXJyZW50O2lmKCEoIWN8fChjLmN1cnJlbnRJdGVtfHxjLmVsZW1lbnQpWzBdPT10aGlzLmVsZW1lbnRbMF0pKWlmKHRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLGMuY3VycmVudEl0ZW18fGMuZWxlbWVudCkpe3RoaXMub3B0aW9ucy5ob3ZlckNsYXNzJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpO1xudGhpcy5fdHJpZ2dlcihcIm92ZXJcIixkLHRoaXMudWkoYykpfX0sX291dDpmdW5jdGlvbihkKXt2YXIgYz1hLnVpLmRkbWFuYWdlci5jdXJyZW50O2lmKCEoIWN8fChjLmN1cnJlbnRJdGVtfHxjLmVsZW1lbnQpWzBdPT10aGlzLmVsZW1lbnRbMF0pKWlmKHRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLGMuY3VycmVudEl0ZW18fGMuZWxlbWVudCkpe3RoaXMub3B0aW9ucy5ob3ZlckNsYXNzJiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpO3RoaXMuX3RyaWdnZXIoXCJvdXRcIixkLHRoaXMudWkoYykpfX0sX2Ryb3A6ZnVuY3Rpb24oZCxjKXt2YXIgZT1jfHxhLnVpLmRkbWFuYWdlci5jdXJyZW50O2lmKCFlfHwoZS5jdXJyZW50SXRlbXx8ZS5lbGVtZW50KVswXT09dGhpcy5lbGVtZW50WzBdKXJldHVybiBmYWxzZTt2YXIgaD1mYWxzZTt0aGlzLmVsZW1lbnQuZmluZChcIjpkYXRhKGRyb3BwYWJsZSlcIikubm90KFwiLnVpLWRyYWdnYWJsZS1kcmFnZ2luZ1wiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGc9XG5hLmRhdGEodGhpcyxcImRyb3BwYWJsZVwiKTtpZihnLm9wdGlvbnMuZ3JlZWR5JiYhZy5vcHRpb25zLmRpc2FibGVkJiZnLm9wdGlvbnMuc2NvcGU9PWUub3B0aW9ucy5zY29wZSYmZy5hY2NlcHQuY2FsbChnLmVsZW1lbnRbMF0sZS5jdXJyZW50SXRlbXx8ZS5lbGVtZW50KSYmYS51aS5pbnRlcnNlY3QoZSxhLmV4dGVuZChnLHtvZmZzZXQ6Zy5lbGVtZW50Lm9mZnNldCgpfSksZy5vcHRpb25zLnRvbGVyYW5jZSkpe2g9dHJ1ZTtyZXR1cm4gZmFsc2V9fSk7aWYoaClyZXR1cm4gZmFsc2U7aWYodGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sZS5jdXJyZW50SXRlbXx8ZS5lbGVtZW50KSl7dGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzJiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzKTt0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzKTt0aGlzLl90cmlnZ2VyKFwiZHJvcFwiLFxuZCx0aGlzLnVpKGUpKTtyZXR1cm4gdGhpcy5lbGVtZW50fXJldHVybiBmYWxzZX0sdWk6ZnVuY3Rpb24oZCl7cmV0dXJue2RyYWdnYWJsZTpkLmN1cnJlbnRJdGVtfHxkLmVsZW1lbnQsaGVscGVyOmQuaGVscGVyLHBvc2l0aW9uOmQucG9zaXRpb24sb2Zmc2V0OmQucG9zaXRpb25BYnN9fX0pO2EuZXh0ZW5kKGEudWkuZHJvcHBhYmxlLHt2ZXJzaW9uOlwiMS44LjE2XCJ9KTthLnVpLmludGVyc2VjdD1mdW5jdGlvbihkLGMsZSl7aWYoIWMub2Zmc2V0KXJldHVybiBmYWxzZTt2YXIgaD0oZC5wb3NpdGlvbkFic3x8ZC5wb3NpdGlvbi5hYnNvbHV0ZSkubGVmdCxnPWgrZC5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCxpPShkLnBvc2l0aW9uQWJzfHxkLnBvc2l0aW9uLmFic29sdXRlKS50b3AsYj1pK2QuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LGY9Yy5vZmZzZXQubGVmdCxqPWYrYy5wcm9wb3J0aW9ucy53aWR0aCxsPWMub2Zmc2V0LnRvcCxvPWwrYy5wcm9wb3J0aW9ucy5oZWlnaHQ7XG5zd2l0Y2goZSl7Y2FzZSBcImZpdFwiOnJldHVybiBmPD1oJiZnPD1qJiZsPD1pJiZiPD1vO2Nhc2UgXCJpbnRlcnNlY3RcIjpyZXR1cm4gZjxoK2QuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgvMiYmZy1kLmhlbHBlclByb3BvcnRpb25zLndpZHRoLzI8aiYmbDxpK2QuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LzImJmItZC5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQvMjxvO2Nhc2UgXCJwb2ludGVyXCI6cmV0dXJuIGEudWkuaXNPdmVyKChkLnBvc2l0aW9uQWJzfHxkLnBvc2l0aW9uLmFic29sdXRlKS50b3ArKGQuY2xpY2tPZmZzZXR8fGQub2Zmc2V0LmNsaWNrKS50b3AsKGQucG9zaXRpb25BYnN8fGQucG9zaXRpb24uYWJzb2x1dGUpLmxlZnQrKGQuY2xpY2tPZmZzZXR8fGQub2Zmc2V0LmNsaWNrKS5sZWZ0LGwsZixjLnByb3BvcnRpb25zLmhlaWdodCxjLnByb3BvcnRpb25zLndpZHRoKTtjYXNlIFwidG91Y2hcIjpyZXR1cm4oaT49bCYmaTw9b3x8Yj49bCYmYjw9b3x8aTxsJiZiPm8pJiYoaD49XG5mJiZoPD1qfHxnPj1mJiZnPD1qfHxoPGYmJmc+aik7ZGVmYXVsdDpyZXR1cm4gZmFsc2V9fTthLnVpLmRkbWFuYWdlcj17Y3VycmVudDpudWxsLGRyb3BwYWJsZXM6e1wiZGVmYXVsdFwiOltdfSxwcmVwYXJlT2Zmc2V0czpmdW5jdGlvbihkLGMpe3ZhciBlPWEudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbZC5vcHRpb25zLnNjb3BlXXx8W10saD1jP2MudHlwZTpudWxsLGc9KGQuY3VycmVudEl0ZW18fGQuZWxlbWVudCkuZmluZChcIjpkYXRhKGRyb3BwYWJsZSlcIikuYW5kU2VsZigpLGk9MDthOmZvcig7aTxlLmxlbmd0aDtpKyspaWYoIShlW2ldLm9wdGlvbnMuZGlzYWJsZWR8fGQmJiFlW2ldLmFjY2VwdC5jYWxsKGVbaV0uZWxlbWVudFswXSxkLmN1cnJlbnRJdGVtfHxkLmVsZW1lbnQpKSl7Zm9yKHZhciBiPTA7YjxnLmxlbmd0aDtiKyspaWYoZ1tiXT09ZVtpXS5lbGVtZW50WzBdKXtlW2ldLnByb3BvcnRpb25zLmhlaWdodD0wO2NvbnRpbnVlIGF9ZVtpXS52aXNpYmxlPWVbaV0uZWxlbWVudC5jc3MoXCJkaXNwbGF5XCIpIT1cblwibm9uZVwiO2lmKGVbaV0udmlzaWJsZSl7aD09XCJtb3VzZWRvd25cIiYmZVtpXS5fYWN0aXZhdGUuY2FsbChlW2ldLGMpO2VbaV0ub2Zmc2V0PWVbaV0uZWxlbWVudC5vZmZzZXQoKTtlW2ldLnByb3BvcnRpb25zPXt3aWR0aDplW2ldLmVsZW1lbnRbMF0ub2Zmc2V0V2lkdGgsaGVpZ2h0OmVbaV0uZWxlbWVudFswXS5vZmZzZXRIZWlnaHR9fX19LGRyb3A6ZnVuY3Rpb24oZCxjKXt2YXIgZT1mYWxzZTthLmVhY2goYS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1tkLm9wdGlvbnMuc2NvcGVdfHxbXSxmdW5jdGlvbigpe2lmKHRoaXMub3B0aW9ucyl7aWYoIXRoaXMub3B0aW9ucy5kaXNhYmxlZCYmdGhpcy52aXNpYmxlJiZhLnVpLmludGVyc2VjdChkLHRoaXMsdGhpcy5vcHRpb25zLnRvbGVyYW5jZSkpZT1lfHx0aGlzLl9kcm9wLmNhbGwodGhpcyxjKTtpZighdGhpcy5vcHRpb25zLmRpc2FibGVkJiZ0aGlzLnZpc2libGUmJnRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLGQuY3VycmVudEl0ZW18fFxuZC5lbGVtZW50KSl7dGhpcy5pc291dD0xO3RoaXMuaXNvdmVyPTA7dGhpcy5fZGVhY3RpdmF0ZS5jYWxsKHRoaXMsYyl9fX0pO3JldHVybiBlfSxkcmFnU3RhcnQ6ZnVuY3Rpb24oZCxjKXtkLmVsZW1lbnQucGFyZW50cyhcIjpub3QoYm9keSxodG1sKVwiKS5iaW5kKFwic2Nyb2xsLmRyb3BwYWJsZVwiLGZ1bmN0aW9uKCl7ZC5vcHRpb25zLnJlZnJlc2hQb3NpdGlvbnN8fGEudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKGQsYyl9KX0sZHJhZzpmdW5jdGlvbihkLGMpe2Qub3B0aW9ucy5yZWZyZXNoUG9zaXRpb25zJiZhLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyhkLGMpO2EuZWFjaChhLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Qub3B0aW9ucy5zY29wZV18fFtdLGZ1bmN0aW9uKCl7aWYoISh0aGlzLm9wdGlvbnMuZGlzYWJsZWR8fHRoaXMuZ3JlZWR5Q2hpbGR8fCF0aGlzLnZpc2libGUpKXt2YXIgZT1hLnVpLmludGVyc2VjdChkLHRoaXMsdGhpcy5vcHRpb25zLnRvbGVyYW5jZSk7XG5pZihlPSFlJiZ0aGlzLmlzb3Zlcj09MT9cImlzb3V0XCI6ZSYmdGhpcy5pc292ZXI9PTA/XCJpc292ZXJcIjpudWxsKXt2YXIgaDtpZih0aGlzLm9wdGlvbnMuZ3JlZWR5KXt2YXIgZz10aGlzLmVsZW1lbnQucGFyZW50cyhcIjpkYXRhKGRyb3BwYWJsZSk6ZXEoMClcIik7aWYoZy5sZW5ndGgpe2g9YS5kYXRhKGdbMF0sXCJkcm9wcGFibGVcIik7aC5ncmVlZHlDaGlsZD1lPT1cImlzb3ZlclwiPzE6MH19aWYoaCYmZT09XCJpc292ZXJcIil7aC5pc292ZXI9MDtoLmlzb3V0PTE7aC5fb3V0LmNhbGwoaCxjKX10aGlzW2VdPTE7dGhpc1tlPT1cImlzb3V0XCI/XCJpc292ZXJcIjpcImlzb3V0XCJdPTA7dGhpc1tlPT1cImlzb3ZlclwiP1wiX292ZXJcIjpcIl9vdXRcIl0uY2FsbCh0aGlzLGMpO2lmKGgmJmU9PVwiaXNvdXRcIil7aC5pc291dD0wO2guaXNvdmVyPTE7aC5fb3Zlci5jYWxsKGgsYyl9fX19KX0sZHJhZ1N0b3A6ZnVuY3Rpb24oZCxjKXtkLmVsZW1lbnQucGFyZW50cyhcIjpub3QoYm9keSxodG1sKVwiKS51bmJpbmQoXCJzY3JvbGwuZHJvcHBhYmxlXCIpO1xuZC5vcHRpb25zLnJlZnJlc2hQb3NpdGlvbnN8fGEudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKGQsYyl9fX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS53aWRnZXQoXCJ1aS5yZXNpemFibGVcIixhLnVpLm1vdXNlLHt3aWRnZXRFdmVudFByZWZpeDpcInJlc2l6ZVwiLG9wdGlvbnM6e2Fsc29SZXNpemU6ZmFsc2UsYW5pbWF0ZTpmYWxzZSxhbmltYXRlRHVyYXRpb246XCJzbG93XCIsYW5pbWF0ZUVhc2luZzpcInN3aW5nXCIsYXNwZWN0UmF0aW86ZmFsc2UsYXV0b0hpZGU6ZmFsc2UsY29udGFpbm1lbnQ6ZmFsc2UsZ2hvc3Q6ZmFsc2UsZ3JpZDpmYWxzZSxoYW5kbGVzOlwiZSxzLHNlXCIsaGVscGVyOmZhbHNlLG1heEhlaWdodDpudWxsLG1heFdpZHRoOm51bGwsbWluSGVpZ2h0OjEwLG1pbldpZHRoOjEwLHpJbmRleDoxRTN9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLGg9dGhpcy5vcHRpb25zO3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLXJlc2l6YWJsZVwiKTthLmV4dGVuZCh0aGlzLHtfYXNwZWN0UmF0aW86ISFoLmFzcGVjdFJhdGlvLGFzcGVjdFJhdGlvOmguYXNwZWN0UmF0aW8sb3JpZ2luYWxFbGVtZW50OnRoaXMuZWxlbWVudCxcbl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzOltdLF9oZWxwZXI6aC5oZWxwZXJ8fGguZ2hvc3R8fGguYW5pbWF0ZT9oLmhlbHBlcnx8XCJ1aS1yZXNpemFibGUtaGVscGVyXCI6bnVsbH0pO2lmKHRoaXMuZWxlbWVudFswXS5ub2RlTmFtZS5tYXRjaCgvY2FudmFzfHRleHRhcmVhfGlucHV0fHNlbGVjdHxidXR0b258aW1nL2kpKXsvcmVsYXRpdmUvLnRlc3QodGhpcy5lbGVtZW50LmNzcyhcInBvc2l0aW9uXCIpKSYmYS5icm93c2VyLm9wZXJhJiZ0aGlzLmVsZW1lbnQuY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCIsdG9wOlwiYXV0b1wiLGxlZnQ6XCJhdXRvXCJ9KTt0aGlzLmVsZW1lbnQud3JhcChhKCc8ZGl2IGNsYXNzPVwidWktd3JhcHBlclwiIHN0eWxlPVwib3ZlcmZsb3c6IGhpZGRlbjtcIj48L2Rpdj4nKS5jc3Moe3Bvc2l0aW9uOnRoaXMuZWxlbWVudC5jc3MoXCJwb3NpdGlvblwiKSx3aWR0aDp0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpLGhlaWdodDp0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSxcbnRvcDp0aGlzLmVsZW1lbnQuY3NzKFwidG9wXCIpLGxlZnQ6dGhpcy5lbGVtZW50LmNzcyhcImxlZnRcIil9KSk7dGhpcy5lbGVtZW50PXRoaXMuZWxlbWVudC5wYXJlbnQoKS5kYXRhKFwicmVzaXphYmxlXCIsdGhpcy5lbGVtZW50LmRhdGEoXCJyZXNpemFibGVcIikpO3RoaXMuZWxlbWVudElzV3JhcHBlcj10cnVlO3RoaXMuZWxlbWVudC5jc3Moe21hcmdpbkxlZnQ6dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKFwibWFyZ2luTGVmdFwiKSxtYXJnaW5Ub3A6dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKFwibWFyZ2luVG9wXCIpLG1hcmdpblJpZ2h0OnRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyhcIm1hcmdpblJpZ2h0XCIpLG1hcmdpbkJvdHRvbTp0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoXCJtYXJnaW5Cb3R0b21cIil9KTt0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3Moe21hcmdpbkxlZnQ6MCxtYXJnaW5Ub3A6MCxtYXJnaW5SaWdodDowLG1hcmdpbkJvdHRvbTowfSk7dGhpcy5vcmlnaW5hbFJlc2l6ZVN0eWxlPVxudGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKFwicmVzaXplXCIpO3RoaXMub3JpZ2luYWxFbGVtZW50LmNzcyhcInJlc2l6ZVwiLFwibm9uZVwiKTt0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLnB1c2godGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKHtwb3NpdGlvbjpcInN0YXRpY1wiLHpvb206MSxkaXNwbGF5OlwiYmxvY2tcIn0pKTt0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3Moe21hcmdpbjp0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoXCJtYXJnaW5cIil9KTt0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpfXRoaXMuaGFuZGxlcz1oLmhhbmRsZXN8fCghYShcIi51aS1yZXNpemFibGUtaGFuZGxlXCIsdGhpcy5lbGVtZW50KS5sZW5ndGg/XCJlLHMsc2VcIjp7bjpcIi51aS1yZXNpemFibGUtblwiLGU6XCIudWktcmVzaXphYmxlLWVcIixzOlwiLnVpLXJlc2l6YWJsZS1zXCIsdzpcIi51aS1yZXNpemFibGUtd1wiLHNlOlwiLnVpLXJlc2l6YWJsZS1zZVwiLHN3OlwiLnVpLXJlc2l6YWJsZS1zd1wiLG5lOlwiLnVpLXJlc2l6YWJsZS1uZVwiLFxubnc6XCIudWktcmVzaXphYmxlLW53XCJ9KTtpZih0aGlzLmhhbmRsZXMuY29uc3RydWN0b3I9PVN0cmluZyl7aWYodGhpcy5oYW5kbGVzPT1cImFsbFwiKXRoaXMuaGFuZGxlcz1cIm4sZSxzLHcsc2Usc3csbmUsbndcIjt2YXIgZz10aGlzLmhhbmRsZXMuc3BsaXQoXCIsXCIpO3RoaXMuaGFuZGxlcz17fTtmb3IodmFyIGk9MDtpPGcubGVuZ3RoO2krKyl7dmFyIGI9YS50cmltKGdbaV0pLGY9YSgnPGRpdiBjbGFzcz1cInVpLXJlc2l6YWJsZS1oYW5kbGUgJysoXCJ1aS1yZXNpemFibGUtXCIrYikrJ1wiPjwvZGl2PicpOy9zd3xzZXxuZXxudy8udGVzdChiKSYmZi5jc3Moe3pJbmRleDorK2guekluZGV4fSk7XCJzZVwiPT1iJiZmLmFkZENsYXNzKFwidWktaWNvbiB1aS1pY29uLWdyaXBzbWFsbC1kaWFnb25hbC1zZVwiKTt0aGlzLmhhbmRsZXNbYl09XCIudWktcmVzaXphYmxlLVwiK2I7dGhpcy5lbGVtZW50LmFwcGVuZChmKX19dGhpcy5fcmVuZGVyQXhpcz1mdW5jdGlvbihqKXtqPWp8fHRoaXMuZWxlbWVudDtmb3IodmFyIGwgaW4gdGhpcy5oYW5kbGVzKXtpZih0aGlzLmhhbmRsZXNbbF0uY29uc3RydWN0b3I9PVxuU3RyaW5nKXRoaXMuaGFuZGxlc1tsXT1hKHRoaXMuaGFuZGxlc1tsXSx0aGlzLmVsZW1lbnQpLnNob3coKTtpZih0aGlzLmVsZW1lbnRJc1dyYXBwZXImJnRoaXMub3JpZ2luYWxFbGVtZW50WzBdLm5vZGVOYW1lLm1hdGNoKC90ZXh0YXJlYXxpbnB1dHxzZWxlY3R8YnV0dG9uL2kpKXt2YXIgbz1hKHRoaXMuaGFuZGxlc1tsXSx0aGlzLmVsZW1lbnQpLG49MDtuPS9zd3xuZXxud3xzZXxufHMvLnRlc3QobCk/by5vdXRlckhlaWdodCgpOm8ub3V0ZXJXaWR0aCgpO289W1wicGFkZGluZ1wiLC9uZXxud3xuLy50ZXN0KGwpP1wiVG9wXCI6L3NlfHN3fHMvLnRlc3QobCk/XCJCb3R0b21cIjovXmUkLy50ZXN0KGwpP1wiUmlnaHRcIjpcIkxlZnRcIl0uam9pbihcIlwiKTtqLmNzcyhvLG4pO3RoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCl9YSh0aGlzLmhhbmRsZXNbbF0pfX07dGhpcy5fcmVuZGVyQXhpcyh0aGlzLmVsZW1lbnQpO3RoaXMuX2hhbmRsZXM9YShcIi51aS1yZXNpemFibGUtaGFuZGxlXCIsdGhpcy5lbGVtZW50KS5kaXNhYmxlU2VsZWN0aW9uKCk7XG50aGlzLl9oYW5kbGVzLm1vdXNlb3ZlcihmdW5jdGlvbigpe2lmKCFlLnJlc2l6aW5nKXtpZih0aGlzLmNsYXNzTmFtZSl2YXIgaj10aGlzLmNsYXNzTmFtZS5tYXRjaCgvdWktcmVzaXphYmxlLShzZXxzd3xuZXxud3xufGV8c3x3KS9pKTtlLmF4aXM9aiYmalsxXT9qWzFdOlwic2VcIn19KTtpZihoLmF1dG9IaWRlKXt0aGlzLl9oYW5kbGVzLmhpZGUoKTthKHRoaXMuZWxlbWVudCkuYWRkQ2xhc3MoXCJ1aS1yZXNpemFibGUtYXV0b2hpZGVcIikuaG92ZXIoZnVuY3Rpb24oKXtpZighaC5kaXNhYmxlZCl7YSh0aGlzKS5yZW1vdmVDbGFzcyhcInVpLXJlc2l6YWJsZS1hdXRvaGlkZVwiKTtlLl9oYW5kbGVzLnNob3coKX19LGZ1bmN0aW9uKCl7aWYoIWguZGlzYWJsZWQpaWYoIWUucmVzaXppbmcpe2EodGhpcykuYWRkQ2xhc3MoXCJ1aS1yZXNpemFibGUtYXV0b2hpZGVcIik7ZS5faGFuZGxlcy5oaWRlKCl9fSl9dGhpcy5fbW91c2VJbml0KCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLl9tb3VzZURlc3Ryb3koKTtcbnZhciBlPWZ1bmN0aW9uKGcpe2EoZykucmVtb3ZlQ2xhc3MoXCJ1aS1yZXNpemFibGUgdWktcmVzaXphYmxlLWRpc2FibGVkIHVpLXJlc2l6YWJsZS1yZXNpemluZ1wiKS5yZW1vdmVEYXRhKFwicmVzaXphYmxlXCIpLnVuYmluZChcIi5yZXNpemFibGVcIikuZmluZChcIi51aS1yZXNpemFibGUtaGFuZGxlXCIpLnJlbW92ZSgpfTtpZih0aGlzLmVsZW1lbnRJc1dyYXBwZXIpe2UodGhpcy5lbGVtZW50KTt2YXIgaD10aGlzLmVsZW1lbnQ7aC5hZnRlcih0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3Moe3Bvc2l0aW9uOmguY3NzKFwicG9zaXRpb25cIiksd2lkdGg6aC5vdXRlcldpZHRoKCksaGVpZ2h0Omgub3V0ZXJIZWlnaHQoKSx0b3A6aC5jc3MoXCJ0b3BcIiksbGVmdDpoLmNzcyhcImxlZnRcIil9KSkucmVtb3ZlKCl9dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKFwicmVzaXplXCIsdGhpcy5vcmlnaW5hbFJlc2l6ZVN0eWxlKTtlKHRoaXMub3JpZ2luYWxFbGVtZW50KTtyZXR1cm4gdGhpc30sX21vdXNlQ2FwdHVyZTpmdW5jdGlvbihlKXt2YXIgaD1cbmZhbHNlO2Zvcih2YXIgZyBpbiB0aGlzLmhhbmRsZXMpaWYoYSh0aGlzLmhhbmRsZXNbZ10pWzBdPT1lLnRhcmdldCloPXRydWU7cmV0dXJuIXRoaXMub3B0aW9ucy5kaXNhYmxlZCYmaH0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oZSl7dmFyIGg9dGhpcy5vcHRpb25zLGc9dGhpcy5lbGVtZW50LnBvc2l0aW9uKCksaT10aGlzLmVsZW1lbnQ7dGhpcy5yZXNpemluZz10cnVlO3RoaXMuZG9jdW1lbnRTY3JvbGw9e3RvcDphKGRvY3VtZW50KS5zY3JvbGxUb3AoKSxsZWZ0OmEoZG9jdW1lbnQpLnNjcm9sbExlZnQoKX07aWYoaS5pcyhcIi51aS1kcmFnZ2FibGVcIil8fC9hYnNvbHV0ZS8udGVzdChpLmNzcyhcInBvc2l0aW9uXCIpKSlpLmNzcyh7cG9zaXRpb246XCJhYnNvbHV0ZVwiLHRvcDpnLnRvcCxsZWZ0OmcubGVmdH0pO2EuYnJvd3Nlci5vcGVyYSYmL3JlbGF0aXZlLy50ZXN0KGkuY3NzKFwicG9zaXRpb25cIikpJiZpLmNzcyh7cG9zaXRpb246XCJyZWxhdGl2ZVwiLHRvcDpcImF1dG9cIixsZWZ0OlwiYXV0b1wifSk7XG50aGlzLl9yZW5kZXJQcm94eSgpO2c9ZCh0aGlzLmhlbHBlci5jc3MoXCJsZWZ0XCIpKTt2YXIgYj1kKHRoaXMuaGVscGVyLmNzcyhcInRvcFwiKSk7aWYoaC5jb250YWlubWVudCl7Zys9YShoLmNvbnRhaW5tZW50KS5zY3JvbGxMZWZ0KCl8fDA7Yis9YShoLmNvbnRhaW5tZW50KS5zY3JvbGxUb3AoKXx8MH10aGlzLm9mZnNldD10aGlzLmhlbHBlci5vZmZzZXQoKTt0aGlzLnBvc2l0aW9uPXtsZWZ0OmcsdG9wOmJ9O3RoaXMuc2l6ZT10aGlzLl9oZWxwZXI/e3dpZHRoOmkub3V0ZXJXaWR0aCgpLGhlaWdodDppLm91dGVySGVpZ2h0KCl9Ont3aWR0aDppLndpZHRoKCksaGVpZ2h0OmkuaGVpZ2h0KCl9O3RoaXMub3JpZ2luYWxTaXplPXRoaXMuX2hlbHBlcj97d2lkdGg6aS5vdXRlcldpZHRoKCksaGVpZ2h0Omkub3V0ZXJIZWlnaHQoKX06e3dpZHRoOmkud2lkdGgoKSxoZWlnaHQ6aS5oZWlnaHQoKX07dGhpcy5vcmlnaW5hbFBvc2l0aW9uPXtsZWZ0OmcsdG9wOmJ9O3RoaXMuc2l6ZURpZmY9XG57d2lkdGg6aS5vdXRlcldpZHRoKCktaS53aWR0aCgpLGhlaWdodDppLm91dGVySGVpZ2h0KCktaS5oZWlnaHQoKX07dGhpcy5vcmlnaW5hbE1vdXNlUG9zaXRpb249e2xlZnQ6ZS5wYWdlWCx0b3A6ZS5wYWdlWX07dGhpcy5hc3BlY3RSYXRpbz10eXBlb2YgaC5hc3BlY3RSYXRpbz09XCJudW1iZXJcIj9oLmFzcGVjdFJhdGlvOnRoaXMub3JpZ2luYWxTaXplLndpZHRoL3RoaXMub3JpZ2luYWxTaXplLmhlaWdodHx8MTtoPWEoXCIudWktcmVzaXphYmxlLVwiK3RoaXMuYXhpcykuY3NzKFwiY3Vyc29yXCIpO2EoXCJib2R5XCIpLmNzcyhcImN1cnNvclwiLGg9PVwiYXV0b1wiP3RoaXMuYXhpcytcIi1yZXNpemVcIjpoKTtpLmFkZENsYXNzKFwidWktcmVzaXphYmxlLXJlc2l6aW5nXCIpO3RoaXMuX3Byb3BhZ2F0ZShcInN0YXJ0XCIsZSk7cmV0dXJuIHRydWV9LF9tb3VzZURyYWc6ZnVuY3Rpb24oZSl7dmFyIGg9dGhpcy5oZWxwZXIsZz10aGlzLm9yaWdpbmFsTW91c2VQb3NpdGlvbixpPXRoaXMuX2NoYW5nZVt0aGlzLmF4aXNdO1xuaWYoIWkpcmV0dXJuIGZhbHNlO2c9aS5hcHBseSh0aGlzLFtlLGUucGFnZVgtZy5sZWZ0fHwwLGUucGFnZVktZy50b3B8fDBdKTt0aGlzLl91cGRhdGVWaXJ0dWFsQm91bmRhcmllcyhlLnNoaWZ0S2V5KTtpZih0aGlzLl9hc3BlY3RSYXRpb3x8ZS5zaGlmdEtleSlnPXRoaXMuX3VwZGF0ZVJhdGlvKGcsZSk7Zz10aGlzLl9yZXNwZWN0U2l6ZShnLGUpO3RoaXMuX3Byb3BhZ2F0ZShcInJlc2l6ZVwiLGUpO2guY3NzKHt0b3A6dGhpcy5wb3NpdGlvbi50b3ArXCJweFwiLGxlZnQ6dGhpcy5wb3NpdGlvbi5sZWZ0K1wicHhcIix3aWR0aDp0aGlzLnNpemUud2lkdGgrXCJweFwiLGhlaWdodDp0aGlzLnNpemUuaGVpZ2h0K1wicHhcIn0pOyF0aGlzLl9oZWxwZXImJnRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoJiZ0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpO3RoaXMuX3VwZGF0ZUNhY2hlKGcpO3RoaXMuX3RyaWdnZXIoXCJyZXNpemVcIixlLHRoaXMudWkoKSk7cmV0dXJuIGZhbHNlfSxcbl9tb3VzZVN0b3A6ZnVuY3Rpb24oZSl7dGhpcy5yZXNpemluZz1mYWxzZTt2YXIgaD10aGlzLm9wdGlvbnMsZz10aGlzO2lmKHRoaXMuX2hlbHBlcil7dmFyIGk9dGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cyxiPWkubGVuZ3RoJiYvdGV4dGFyZWEvaS50ZXN0KGlbMF0ubm9kZU5hbWUpO2k9YiYmYS51aS5oYXNTY3JvbGwoaVswXSxcImxlZnRcIik/MDpnLnNpemVEaWZmLmhlaWdodDtiPWI/MDpnLnNpemVEaWZmLndpZHRoO2I9e3dpZHRoOmcuaGVscGVyLndpZHRoKCktYixoZWlnaHQ6Zy5oZWxwZXIuaGVpZ2h0KCktaX07aT1wYXJzZUludChnLmVsZW1lbnQuY3NzKFwibGVmdFwiKSwxMCkrKGcucG9zaXRpb24ubGVmdC1nLm9yaWdpbmFsUG9zaXRpb24ubGVmdCl8fG51bGw7dmFyIGY9cGFyc2VJbnQoZy5lbGVtZW50LmNzcyhcInRvcFwiKSwxMCkrKGcucG9zaXRpb24udG9wLWcub3JpZ2luYWxQb3NpdGlvbi50b3ApfHxudWxsO2guYW5pbWF0ZXx8dGhpcy5lbGVtZW50LmNzcyhhLmV4dGVuZChiLFxue3RvcDpmLGxlZnQ6aX0pKTtnLmhlbHBlci5oZWlnaHQoZy5zaXplLmhlaWdodCk7Zy5oZWxwZXIud2lkdGgoZy5zaXplLndpZHRoKTt0aGlzLl9oZWxwZXImJiFoLmFuaW1hdGUmJnRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCl9YShcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIsXCJhdXRvXCIpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXJlc2l6YWJsZS1yZXNpemluZ1wiKTt0aGlzLl9wcm9wYWdhdGUoXCJzdG9wXCIsZSk7dGhpcy5faGVscGVyJiZ0aGlzLmhlbHBlci5yZW1vdmUoKTtyZXR1cm4gZmFsc2V9LF91cGRhdGVWaXJ0dWFsQm91bmRhcmllczpmdW5jdGlvbihlKXt2YXIgaD10aGlzLm9wdGlvbnMsZyxpLGI7aD17bWluV2lkdGg6YyhoLm1pbldpZHRoKT9oLm1pbldpZHRoOjAsbWF4V2lkdGg6YyhoLm1heFdpZHRoKT9oLm1heFdpZHRoOkluZmluaXR5LG1pbkhlaWdodDpjKGgubWluSGVpZ2h0KT9oLm1pbkhlaWdodDowLG1heEhlaWdodDpjKGgubWF4SGVpZ2h0KT9oLm1heEhlaWdodDpcbkluZmluaXR5fTtpZih0aGlzLl9hc3BlY3RSYXRpb3x8ZSl7ZT1oLm1pbkhlaWdodCp0aGlzLmFzcGVjdFJhdGlvO2k9aC5taW5XaWR0aC90aGlzLmFzcGVjdFJhdGlvO2c9aC5tYXhIZWlnaHQqdGhpcy5hc3BlY3RSYXRpbztiPWgubWF4V2lkdGgvdGhpcy5hc3BlY3RSYXRpbztpZihlPmgubWluV2lkdGgpaC5taW5XaWR0aD1lO2lmKGk+aC5taW5IZWlnaHQpaC5taW5IZWlnaHQ9aTtpZihnPGgubWF4V2lkdGgpaC5tYXhXaWR0aD1nO2lmKGI8aC5tYXhIZWlnaHQpaC5tYXhIZWlnaHQ9Yn10aGlzLl92Qm91bmRhcmllcz1ofSxfdXBkYXRlQ2FjaGU6ZnVuY3Rpb24oZSl7dGhpcy5vZmZzZXQ9dGhpcy5oZWxwZXIub2Zmc2V0KCk7aWYoYyhlLmxlZnQpKXRoaXMucG9zaXRpb24ubGVmdD1lLmxlZnQ7aWYoYyhlLnRvcCkpdGhpcy5wb3NpdGlvbi50b3A9ZS50b3A7aWYoYyhlLmhlaWdodCkpdGhpcy5zaXplLmhlaWdodD1lLmhlaWdodDtpZihjKGUud2lkdGgpKXRoaXMuc2l6ZS53aWR0aD1cbmUud2lkdGh9LF91cGRhdGVSYXRpbzpmdW5jdGlvbihlKXt2YXIgaD10aGlzLnBvc2l0aW9uLGc9dGhpcy5zaXplLGk9dGhpcy5heGlzO2lmKGMoZS5oZWlnaHQpKWUud2lkdGg9ZS5oZWlnaHQqdGhpcy5hc3BlY3RSYXRpbztlbHNlIGlmKGMoZS53aWR0aCkpZS5oZWlnaHQ9ZS53aWR0aC90aGlzLmFzcGVjdFJhdGlvO2lmKGk9PVwic3dcIil7ZS5sZWZ0PWgubGVmdCsoZy53aWR0aC1lLndpZHRoKTtlLnRvcD1udWxsfWlmKGk9PVwibndcIil7ZS50b3A9aC50b3ArKGcuaGVpZ2h0LWUuaGVpZ2h0KTtlLmxlZnQ9aC5sZWZ0KyhnLndpZHRoLWUud2lkdGgpfXJldHVybiBlfSxfcmVzcGVjdFNpemU6ZnVuY3Rpb24oZSl7dmFyIGg9dGhpcy5fdkJvdW5kYXJpZXMsZz10aGlzLmF4aXMsaT1jKGUud2lkdGgpJiZoLm1heFdpZHRoJiZoLm1heFdpZHRoPGUud2lkdGgsYj1jKGUuaGVpZ2h0KSYmaC5tYXhIZWlnaHQmJmgubWF4SGVpZ2h0PGUuaGVpZ2h0LGY9YyhlLndpZHRoKSYmaC5taW5XaWR0aCYmXG5oLm1pbldpZHRoPmUud2lkdGgsaj1jKGUuaGVpZ2h0KSYmaC5taW5IZWlnaHQmJmgubWluSGVpZ2h0PmUuaGVpZ2h0O2lmKGYpZS53aWR0aD1oLm1pbldpZHRoO2lmKGopZS5oZWlnaHQ9aC5taW5IZWlnaHQ7aWYoaSllLndpZHRoPWgubWF4V2lkdGg7aWYoYillLmhlaWdodD1oLm1heEhlaWdodDt2YXIgbD10aGlzLm9yaWdpbmFsUG9zaXRpb24ubGVmdCt0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aCxvPXRoaXMucG9zaXRpb24udG9wK3RoaXMuc2l6ZS5oZWlnaHQsbj0vc3d8bnd8dy8udGVzdChnKTtnPS9ud3xuZXxuLy50ZXN0KGcpO2lmKGYmJm4pZS5sZWZ0PWwtaC5taW5XaWR0aDtpZihpJiZuKWUubGVmdD1sLWgubWF4V2lkdGg7aWYoaiYmZyllLnRvcD1vLWgubWluSGVpZ2h0O2lmKGImJmcpZS50b3A9by1oLm1heEhlaWdodDtpZigoaD0hZS53aWR0aCYmIWUuaGVpZ2h0KSYmIWUubGVmdCYmZS50b3ApZS50b3A9bnVsbDtlbHNlIGlmKGgmJiFlLnRvcCYmZS5sZWZ0KWUubGVmdD1cbm51bGw7cmV0dXJuIGV9LF9wcm9wb3J0aW9uYWxseVJlc2l6ZTpmdW5jdGlvbigpe2lmKHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoKWZvcih2YXIgZT10aGlzLmhlbHBlcnx8dGhpcy5lbGVtZW50LGg9MDtoPHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoO2grKyl7dmFyIGc9dGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50c1toXTtpZighdGhpcy5ib3JkZXJEaWYpe3ZhciBpPVtnLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLGcuY3NzKFwiYm9yZGVyUmlnaHRXaWR0aFwiKSxnLmNzcyhcImJvcmRlckJvdHRvbVdpZHRoXCIpLGcuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpXSxiPVtnLmNzcyhcInBhZGRpbmdUb3BcIiksZy5jc3MoXCJwYWRkaW5nUmlnaHRcIiksZy5jc3MoXCJwYWRkaW5nQm90dG9tXCIpLGcuY3NzKFwicGFkZGluZ0xlZnRcIildO3RoaXMuYm9yZGVyRGlmPWEubWFwKGksZnVuY3Rpb24oZixqKXtmPXBhcnNlSW50KGYsMTApfHxcbjA7aj1wYXJzZUludChiW2pdLDEwKXx8MDtyZXR1cm4gZitqfSl9YS5icm93c2VyLm1zaWUmJihhKGUpLmlzKFwiOmhpZGRlblwiKXx8YShlKS5wYXJlbnRzKFwiOmhpZGRlblwiKS5sZW5ndGgpfHxnLmNzcyh7aGVpZ2h0OmUuaGVpZ2h0KCktdGhpcy5ib3JkZXJEaWZbMF0tdGhpcy5ib3JkZXJEaWZbMl18fDAsd2lkdGg6ZS53aWR0aCgpLXRoaXMuYm9yZGVyRGlmWzFdLXRoaXMuYm9yZGVyRGlmWzNdfHwwfSl9fSxfcmVuZGVyUHJveHk6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLm9wdGlvbnM7dGhpcy5lbGVtZW50T2Zmc2V0PXRoaXMuZWxlbWVudC5vZmZzZXQoKTtpZih0aGlzLl9oZWxwZXIpe3RoaXMuaGVscGVyPXRoaXMuaGVscGVyfHxhKCc8ZGl2IHN0eWxlPVwib3ZlcmZsb3c6aGlkZGVuO1wiPjwvZGl2PicpO3ZhciBoPWEuYnJvd3Nlci5tc2llJiZhLmJyb3dzZXIudmVyc2lvbjw3LGc9aD8xOjA7aD1oPzI6LTE7dGhpcy5oZWxwZXIuYWRkQ2xhc3ModGhpcy5faGVscGVyKS5jc3Moe3dpZHRoOnRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCkrXG5oLGhlaWdodDp0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKStoLHBvc2l0aW9uOlwiYWJzb2x1dGVcIixsZWZ0OnRoaXMuZWxlbWVudE9mZnNldC5sZWZ0LWcrXCJweFwiLHRvcDp0aGlzLmVsZW1lbnRPZmZzZXQudG9wLWcrXCJweFwiLHpJbmRleDorK2UuekluZGV4fSk7dGhpcy5oZWxwZXIuYXBwZW5kVG8oXCJib2R5XCIpLmRpc2FibGVTZWxlY3Rpb24oKX1lbHNlIHRoaXMuaGVscGVyPXRoaXMuZWxlbWVudH0sX2NoYW5nZTp7ZTpmdW5jdGlvbihlLGgpe3JldHVybnt3aWR0aDp0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aCtofX0sdzpmdW5jdGlvbihlLGgpe3JldHVybntsZWZ0OnRoaXMub3JpZ2luYWxQb3NpdGlvbi5sZWZ0K2gsd2lkdGg6dGhpcy5vcmlnaW5hbFNpemUud2lkdGgtaH19LG46ZnVuY3Rpb24oZSxoLGcpe3JldHVybnt0b3A6dGhpcy5vcmlnaW5hbFBvc2l0aW9uLnRvcCtnLGhlaWdodDp0aGlzLm9yaWdpbmFsU2l6ZS5oZWlnaHQtZ319LHM6ZnVuY3Rpb24oZSxoLGcpe3JldHVybntoZWlnaHQ6dGhpcy5vcmlnaW5hbFNpemUuaGVpZ2h0K1xuZ319LHNlOmZ1bmN0aW9uKGUsaCxnKXtyZXR1cm4gYS5leHRlbmQodGhpcy5fY2hhbmdlLnMuYXBwbHkodGhpcyxhcmd1bWVudHMpLHRoaXMuX2NoYW5nZS5lLmFwcGx5KHRoaXMsW2UsaCxnXSkpfSxzdzpmdW5jdGlvbihlLGgsZyl7cmV0dXJuIGEuZXh0ZW5kKHRoaXMuX2NoYW5nZS5zLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0aGlzLl9jaGFuZ2Uudy5hcHBseSh0aGlzLFtlLGgsZ10pKX0sbmU6ZnVuY3Rpb24oZSxoLGcpe3JldHVybiBhLmV4dGVuZCh0aGlzLl9jaGFuZ2Uubi5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5fY2hhbmdlLmUuYXBwbHkodGhpcyxbZSxoLGddKSl9LG53OmZ1bmN0aW9uKGUsaCxnKXtyZXR1cm4gYS5leHRlbmQodGhpcy5fY2hhbmdlLm4uYXBwbHkodGhpcyxhcmd1bWVudHMpLHRoaXMuX2NoYW5nZS53LmFwcGx5KHRoaXMsW2UsaCxnXSkpfX0sX3Byb3BhZ2F0ZTpmdW5jdGlvbihlLGgpe2EudWkucGx1Z2luLmNhbGwodGhpcyxlLFtoLHRoaXMudWkoKV0pO1xuZSE9XCJyZXNpemVcIiYmdGhpcy5fdHJpZ2dlcihlLGgsdGhpcy51aSgpKX0scGx1Z2luczp7fSx1aTpmdW5jdGlvbigpe3JldHVybntvcmlnaW5hbEVsZW1lbnQ6dGhpcy5vcmlnaW5hbEVsZW1lbnQsZWxlbWVudDp0aGlzLmVsZW1lbnQsaGVscGVyOnRoaXMuaGVscGVyLHBvc2l0aW9uOnRoaXMucG9zaXRpb24sc2l6ZTp0aGlzLnNpemUsb3JpZ2luYWxTaXplOnRoaXMub3JpZ2luYWxTaXplLG9yaWdpbmFsUG9zaXRpb246dGhpcy5vcmlnaW5hbFBvc2l0aW9ufX19KTthLmV4dGVuZChhLnVpLnJlc2l6YWJsZSx7dmVyc2lvbjpcIjEuOC4xNlwifSk7YS51aS5wbHVnaW4uYWRkKFwicmVzaXphYmxlXCIsXCJhbHNvUmVzaXplXCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGU9YSh0aGlzKS5kYXRhKFwicmVzaXphYmxlXCIpLm9wdGlvbnMsaD1mdW5jdGlvbihnKXthKGcpLmVhY2goZnVuY3Rpb24oKXt2YXIgaT1hKHRoaXMpO2kuZGF0YShcInJlc2l6YWJsZS1hbHNvcmVzaXplXCIse3dpZHRoOnBhcnNlSW50KGkud2lkdGgoKSxcbjEwKSxoZWlnaHQ6cGFyc2VJbnQoaS5oZWlnaHQoKSwxMCksbGVmdDpwYXJzZUludChpLmNzcyhcImxlZnRcIiksMTApLHRvcDpwYXJzZUludChpLmNzcyhcInRvcFwiKSwxMCkscG9zaXRpb246aS5jc3MoXCJwb3NpdGlvblwiKX0pfSl9O2lmKHR5cGVvZiBlLmFsc29SZXNpemU9PVwib2JqZWN0XCImJiFlLmFsc29SZXNpemUucGFyZW50Tm9kZSlpZihlLmFsc29SZXNpemUubGVuZ3RoKXtlLmFsc29SZXNpemU9ZS5hbHNvUmVzaXplWzBdO2goZS5hbHNvUmVzaXplKX1lbHNlIGEuZWFjaChlLmFsc29SZXNpemUsZnVuY3Rpb24oZyl7aChnKX0pO2Vsc2UgaChlLmFsc29SZXNpemUpfSxyZXNpemU6ZnVuY3Rpb24oZSxoKXt2YXIgZz1hKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIik7ZT1nLm9wdGlvbnM7dmFyIGk9Zy5vcmlnaW5hbFNpemUsYj1nLm9yaWdpbmFsUG9zaXRpb24sZj17aGVpZ2h0Omcuc2l6ZS5oZWlnaHQtaS5oZWlnaHR8fDAsd2lkdGg6Zy5zaXplLndpZHRoLWkud2lkdGh8fDAsdG9wOmcucG9zaXRpb24udG9wLVxuYi50b3B8fDAsbGVmdDpnLnBvc2l0aW9uLmxlZnQtYi5sZWZ0fHwwfSxqPWZ1bmN0aW9uKGwsbyl7YShsKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIG49YSh0aGlzKSxrPWEodGhpcykuZGF0YShcInJlc2l6YWJsZS1hbHNvcmVzaXplXCIpLG09e30scD1vJiZvLmxlbmd0aD9vOm4ucGFyZW50cyhoLm9yaWdpbmFsRWxlbWVudFswXSkubGVuZ3RoP1tcIndpZHRoXCIsXCJoZWlnaHRcIl06W1wid2lkdGhcIixcImhlaWdodFwiLFwidG9wXCIsXCJsZWZ0XCJdO2EuZWFjaChwLGZ1bmN0aW9uKHEscyl7aWYoKHE9KGtbc118fDApKyhmW3NdfHwwKSkmJnE+PTApbVtzXT1xfHxudWxsfSk7aWYoYS5icm93c2VyLm9wZXJhJiYvcmVsYXRpdmUvLnRlc3Qobi5jc3MoXCJwb3NpdGlvblwiKSkpe2cuX3JldmVydFRvUmVsYXRpdmVQb3NpdGlvbj10cnVlO24uY3NzKHtwb3NpdGlvbjpcImFic29sdXRlXCIsdG9wOlwiYXV0b1wiLGxlZnQ6XCJhdXRvXCJ9KX1uLmNzcyhtKX0pfTt0eXBlb2YgZS5hbHNvUmVzaXplPT1cIm9iamVjdFwiJiYhZS5hbHNvUmVzaXplLm5vZGVUeXBlP1xuYS5lYWNoKGUuYWxzb1Jlc2l6ZSxmdW5jdGlvbihsLG8pe2oobCxvKX0pOmooZS5hbHNvUmVzaXplKX0sc3RvcDpmdW5jdGlvbigpe3ZhciBlPWEodGhpcykuZGF0YShcInJlc2l6YWJsZVwiKSxoPWUub3B0aW9ucyxnPWZ1bmN0aW9uKGkpe2EoaSkuZWFjaChmdW5jdGlvbigpe3ZhciBiPWEodGhpcyk7Yi5jc3Moe3Bvc2l0aW9uOmIuZGF0YShcInJlc2l6YWJsZS1hbHNvcmVzaXplXCIpLnBvc2l0aW9ufSl9KX07aWYoZS5fcmV2ZXJ0VG9SZWxhdGl2ZVBvc2l0aW9uKXtlLl9yZXZlcnRUb1JlbGF0aXZlUG9zaXRpb249ZmFsc2U7dHlwZW9mIGguYWxzb1Jlc2l6ZT09XCJvYmplY3RcIiYmIWguYWxzb1Jlc2l6ZS5ub2RlVHlwZT9hLmVhY2goaC5hbHNvUmVzaXplLGZ1bmN0aW9uKGkpe2coaSl9KTpnKGguYWxzb1Jlc2l6ZSl9YSh0aGlzKS5yZW1vdmVEYXRhKFwicmVzaXphYmxlLWFsc29yZXNpemVcIil9fSk7YS51aS5wbHVnaW4uYWRkKFwicmVzaXphYmxlXCIsXCJhbmltYXRlXCIse3N0b3A6ZnVuY3Rpb24oZSl7dmFyIGg9XG5hKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIiksZz1oLm9wdGlvbnMsaT1oLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLGI9aS5sZW5ndGgmJi90ZXh0YXJlYS9pLnRlc3QoaVswXS5ub2RlTmFtZSksZj1iJiZhLnVpLmhhc1Njcm9sbChpWzBdLFwibGVmdFwiKT8wOmguc2l6ZURpZmYuaGVpZ2h0O2I9e3dpZHRoOmguc2l6ZS53aWR0aC0oYj8wOmguc2l6ZURpZmYud2lkdGgpLGhlaWdodDpoLnNpemUuaGVpZ2h0LWZ9O2Y9cGFyc2VJbnQoaC5lbGVtZW50LmNzcyhcImxlZnRcIiksMTApKyhoLnBvc2l0aW9uLmxlZnQtaC5vcmlnaW5hbFBvc2l0aW9uLmxlZnQpfHxudWxsO3ZhciBqPXBhcnNlSW50KGguZWxlbWVudC5jc3MoXCJ0b3BcIiksMTApKyhoLnBvc2l0aW9uLnRvcC1oLm9yaWdpbmFsUG9zaXRpb24udG9wKXx8bnVsbDtoLmVsZW1lbnQuYW5pbWF0ZShhLmV4dGVuZChiLGomJmY/e3RvcDpqLGxlZnQ6Zn06e30pLHtkdXJhdGlvbjpnLmFuaW1hdGVEdXJhdGlvbixlYXNpbmc6Zy5hbmltYXRlRWFzaW5nLFxuc3RlcDpmdW5jdGlvbigpe3ZhciBsPXt3aWR0aDpwYXJzZUludChoLmVsZW1lbnQuY3NzKFwid2lkdGhcIiksMTApLGhlaWdodDpwYXJzZUludChoLmVsZW1lbnQuY3NzKFwiaGVpZ2h0XCIpLDEwKSx0b3A6cGFyc2VJbnQoaC5lbGVtZW50LmNzcyhcInRvcFwiKSwxMCksbGVmdDpwYXJzZUludChoLmVsZW1lbnQuY3NzKFwibGVmdFwiKSwxMCl9O2kmJmkubGVuZ3RoJiZhKGlbMF0pLmNzcyh7d2lkdGg6bC53aWR0aCxoZWlnaHQ6bC5oZWlnaHR9KTtoLl91cGRhdGVDYWNoZShsKTtoLl9wcm9wYWdhdGUoXCJyZXNpemVcIixlKX19KX19KTthLnVpLnBsdWdpbi5hZGQoXCJyZXNpemFibGVcIixcImNvbnRhaW5tZW50XCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGU9YSh0aGlzKS5kYXRhKFwicmVzaXphYmxlXCIpLGg9ZS5lbGVtZW50LGc9ZS5vcHRpb25zLmNvbnRhaW5tZW50O2lmKGg9ZyBpbnN0YW5jZW9mIGE/Zy5nZXQoMCk6L3BhcmVudC8udGVzdChnKT9oLnBhcmVudCgpLmdldCgwKTpnKXtlLmNvbnRhaW5lckVsZW1lbnQ9XG5hKGgpO2lmKC9kb2N1bWVudC8udGVzdChnKXx8Zz09ZG9jdW1lbnQpe2UuY29udGFpbmVyT2Zmc2V0PXtsZWZ0OjAsdG9wOjB9O2UuY29udGFpbmVyUG9zaXRpb249e2xlZnQ6MCx0b3A6MH07ZS5wYXJlbnREYXRhPXtlbGVtZW50OmEoZG9jdW1lbnQpLGxlZnQ6MCx0b3A6MCx3aWR0aDphKGRvY3VtZW50KS53aWR0aCgpLGhlaWdodDphKGRvY3VtZW50KS5oZWlnaHQoKXx8ZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodH19ZWxzZXt2YXIgaT1hKGgpLGI9W107YShbXCJUb3BcIixcIlJpZ2h0XCIsXCJMZWZ0XCIsXCJCb3R0b21cIl0pLmVhY2goZnVuY3Rpb24obCxvKXtiW2xdPWQoaS5jc3MoXCJwYWRkaW5nXCIrbykpfSk7ZS5jb250YWluZXJPZmZzZXQ9aS5vZmZzZXQoKTtlLmNvbnRhaW5lclBvc2l0aW9uPWkucG9zaXRpb24oKTtlLmNvbnRhaW5lclNpemU9e2hlaWdodDppLmlubmVySGVpZ2h0KCktYlszXSx3aWR0aDppLmlubmVyV2lkdGgoKS1iWzFdfTtnPWUuY29udGFpbmVyT2Zmc2V0O1xudmFyIGY9ZS5jb250YWluZXJTaXplLmhlaWdodCxqPWUuY29udGFpbmVyU2l6ZS53aWR0aDtqPWEudWkuaGFzU2Nyb2xsKGgsXCJsZWZ0XCIpP2guc2Nyb2xsV2lkdGg6ajtmPWEudWkuaGFzU2Nyb2xsKGgpP2guc2Nyb2xsSGVpZ2h0OmY7ZS5wYXJlbnREYXRhPXtlbGVtZW50OmgsbGVmdDpnLmxlZnQsdG9wOmcudG9wLHdpZHRoOmosaGVpZ2h0OmZ9fX19LHJlc2l6ZTpmdW5jdGlvbihlKXt2YXIgaD1hKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIiksZz1oLm9wdGlvbnMsaT1oLmNvbnRhaW5lck9mZnNldCxiPWgucG9zaXRpb247ZT1oLl9hc3BlY3RSYXRpb3x8ZS5zaGlmdEtleTt2YXIgZj17dG9wOjAsbGVmdDowfSxqPWguY29udGFpbmVyRWxlbWVudDtpZihqWzBdIT1kb2N1bWVudCYmL3N0YXRpYy8udGVzdChqLmNzcyhcInBvc2l0aW9uXCIpKSlmPWk7aWYoYi5sZWZ0PChoLl9oZWxwZXI/aS5sZWZ0OjApKXtoLnNpemUud2lkdGgrPWguX2hlbHBlcj9oLnBvc2l0aW9uLmxlZnQtaS5sZWZ0OlxuaC5wb3NpdGlvbi5sZWZ0LWYubGVmdDtpZihlKWguc2l6ZS5oZWlnaHQ9aC5zaXplLndpZHRoL2cuYXNwZWN0UmF0aW87aC5wb3NpdGlvbi5sZWZ0PWcuaGVscGVyP2kubGVmdDowfWlmKGIudG9wPChoLl9oZWxwZXI/aS50b3A6MCkpe2guc2l6ZS5oZWlnaHQrPWguX2hlbHBlcj9oLnBvc2l0aW9uLnRvcC1pLnRvcDpoLnBvc2l0aW9uLnRvcDtpZihlKWguc2l6ZS53aWR0aD1oLnNpemUuaGVpZ2h0KmcuYXNwZWN0UmF0aW87aC5wb3NpdGlvbi50b3A9aC5faGVscGVyP2kudG9wOjB9aC5vZmZzZXQubGVmdD1oLnBhcmVudERhdGEubGVmdCtoLnBvc2l0aW9uLmxlZnQ7aC5vZmZzZXQudG9wPWgucGFyZW50RGF0YS50b3AraC5wb3NpdGlvbi50b3A7Zz1NYXRoLmFicygoaC5faGVscGVyP2gub2Zmc2V0LmxlZnQtZi5sZWZ0Omgub2Zmc2V0LmxlZnQtZi5sZWZ0KStoLnNpemVEaWZmLndpZHRoKTtpPU1hdGguYWJzKChoLl9oZWxwZXI/aC5vZmZzZXQudG9wLWYudG9wOmgub2Zmc2V0LnRvcC1cbmkudG9wKStoLnNpemVEaWZmLmhlaWdodCk7Yj1oLmNvbnRhaW5lckVsZW1lbnQuZ2V0KDApPT1oLmVsZW1lbnQucGFyZW50KCkuZ2V0KDApO2Y9L3JlbGF0aXZlfGFic29sdXRlLy50ZXN0KGguY29udGFpbmVyRWxlbWVudC5jc3MoXCJwb3NpdGlvblwiKSk7aWYoYiYmZilnLT1oLnBhcmVudERhdGEubGVmdDtpZihnK2guc2l6ZS53aWR0aD49aC5wYXJlbnREYXRhLndpZHRoKXtoLnNpemUud2lkdGg9aC5wYXJlbnREYXRhLndpZHRoLWc7aWYoZSloLnNpemUuaGVpZ2h0PWguc2l6ZS53aWR0aC9oLmFzcGVjdFJhdGlvfWlmKGkraC5zaXplLmhlaWdodD49aC5wYXJlbnREYXRhLmhlaWdodCl7aC5zaXplLmhlaWdodD1oLnBhcmVudERhdGEuaGVpZ2h0LWk7aWYoZSloLnNpemUud2lkdGg9aC5zaXplLmhlaWdodCpoLmFzcGVjdFJhdGlvfX0sc3RvcDpmdW5jdGlvbigpe3ZhciBlPWEodGhpcykuZGF0YShcInJlc2l6YWJsZVwiKSxoPWUub3B0aW9ucyxnPWUuY29udGFpbmVyT2Zmc2V0LGk9ZS5jb250YWluZXJQb3NpdGlvbixcbmI9ZS5jb250YWluZXJFbGVtZW50LGY9YShlLmhlbHBlciksaj1mLm9mZnNldCgpLGw9Zi5vdXRlcldpZHRoKCktZS5zaXplRGlmZi53aWR0aDtmPWYub3V0ZXJIZWlnaHQoKS1lLnNpemVEaWZmLmhlaWdodDtlLl9oZWxwZXImJiFoLmFuaW1hdGUmJi9yZWxhdGl2ZS8udGVzdChiLmNzcyhcInBvc2l0aW9uXCIpKSYmYSh0aGlzKS5jc3Moe2xlZnQ6ai5sZWZ0LWkubGVmdC1nLmxlZnQsd2lkdGg6bCxoZWlnaHQ6Zn0pO2UuX2hlbHBlciYmIWguYW5pbWF0ZSYmL3N0YXRpYy8udGVzdChiLmNzcyhcInBvc2l0aW9uXCIpKSYmYSh0aGlzKS5jc3Moe2xlZnQ6ai5sZWZ0LWkubGVmdC1nLmxlZnQsd2lkdGg6bCxoZWlnaHQ6Zn0pfX0pO2EudWkucGx1Z2luLmFkZChcInJlc2l6YWJsZVwiLFwiZ2hvc3RcIix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgZT1hKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIiksaD1lLm9wdGlvbnMsZz1lLnNpemU7ZS5naG9zdD1lLm9yaWdpbmFsRWxlbWVudC5jbG9uZSgpO2UuZ2hvc3QuY3NzKHtvcGFjaXR5OjAuMjUsXG5kaXNwbGF5OlwiYmxvY2tcIixwb3NpdGlvbjpcInJlbGF0aXZlXCIsaGVpZ2h0OmcuaGVpZ2h0LHdpZHRoOmcud2lkdGgsbWFyZ2luOjAsbGVmdDowLHRvcDowfSkuYWRkQ2xhc3MoXCJ1aS1yZXNpemFibGUtZ2hvc3RcIikuYWRkQ2xhc3ModHlwZW9mIGguZ2hvc3Q9PVwic3RyaW5nXCI/aC5naG9zdDpcIlwiKTtlLmdob3N0LmFwcGVuZFRvKGUuaGVscGVyKX0scmVzaXplOmZ1bmN0aW9uKCl7dmFyIGU9YSh0aGlzKS5kYXRhKFwicmVzaXphYmxlXCIpO2UuZ2hvc3QmJmUuZ2hvc3QuY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCIsaGVpZ2h0OmUuc2l6ZS5oZWlnaHQsd2lkdGg6ZS5zaXplLndpZHRofSl9LHN0b3A6ZnVuY3Rpb24oKXt2YXIgZT1hKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIik7ZS5naG9zdCYmZS5oZWxwZXImJmUuaGVscGVyLmdldCgwKS5yZW1vdmVDaGlsZChlLmdob3N0LmdldCgwKSl9fSk7YS51aS5wbHVnaW4uYWRkKFwicmVzaXphYmxlXCIsXCJncmlkXCIse3Jlc2l6ZTpmdW5jdGlvbigpe3ZhciBlPVxuYSh0aGlzKS5kYXRhKFwicmVzaXphYmxlXCIpLGg9ZS5vcHRpb25zLGc9ZS5zaXplLGk9ZS5vcmlnaW5hbFNpemUsYj1lLm9yaWdpbmFsUG9zaXRpb24sZj1lLmF4aXM7aC5ncmlkPXR5cGVvZiBoLmdyaWQ9PVwibnVtYmVyXCI/W2guZ3JpZCxoLmdyaWRdOmguZ3JpZDt2YXIgaj1NYXRoLnJvdW5kKChnLndpZHRoLWkud2lkdGgpLyhoLmdyaWRbMF18fDEpKSooaC5ncmlkWzBdfHwxKTtoPU1hdGgucm91bmQoKGcuaGVpZ2h0LWkuaGVpZ2h0KS8oaC5ncmlkWzFdfHwxKSkqKGguZ3JpZFsxXXx8MSk7aWYoL14oc2V8c3xlKSQvLnRlc3QoZikpe2Uuc2l6ZS53aWR0aD1pLndpZHRoK2o7ZS5zaXplLmhlaWdodD1pLmhlaWdodCtofWVsc2UgaWYoL14obmUpJC8udGVzdChmKSl7ZS5zaXplLndpZHRoPWkud2lkdGgrajtlLnNpemUuaGVpZ2h0PWkuaGVpZ2h0K2g7ZS5wb3NpdGlvbi50b3A9Yi50b3AtaH1lbHNle2lmKC9eKHN3KSQvLnRlc3QoZikpe2Uuc2l6ZS53aWR0aD1pLndpZHRoK2o7ZS5zaXplLmhlaWdodD1cbmkuaGVpZ2h0K2h9ZWxzZXtlLnNpemUud2lkdGg9aS53aWR0aCtqO2Uuc2l6ZS5oZWlnaHQ9aS5oZWlnaHQraDtlLnBvc2l0aW9uLnRvcD1iLnRvcC1ofWUucG9zaXRpb24ubGVmdD1iLmxlZnQtan19fSk7dmFyIGQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHBhcnNlSW50KGUsMTApfHwwfSxjPWZ1bmN0aW9uKGUpe3JldHVybiFpc05hTihwYXJzZUludChlLDEwKSl9fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLndpZGdldChcInVpLnNlbGVjdGFibGVcIixhLnVpLm1vdXNlLHtvcHRpb25zOnthcHBlbmRUbzpcImJvZHlcIixhdXRvUmVmcmVzaDp0cnVlLGRpc3RhbmNlOjAsZmlsdGVyOlwiKlwiLHRvbGVyYW5jZTpcInRvdWNoXCJ9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgZD10aGlzO3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLXNlbGVjdGFibGVcIik7dGhpcy5kcmFnZ2VkPWZhbHNlO3ZhciBjO3RoaXMucmVmcmVzaD1mdW5jdGlvbigpe2M9YShkLm9wdGlvbnMuZmlsdGVyLGQuZWxlbWVudFswXSk7Yy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGU9YSh0aGlzKSxoPWUub2Zmc2V0KCk7YS5kYXRhKHRoaXMsXCJzZWxlY3RhYmxlLWl0ZW1cIix7ZWxlbWVudDp0aGlzLCRlbGVtZW50OmUsbGVmdDpoLmxlZnQsdG9wOmgudG9wLHJpZ2h0OmgubGVmdCtlLm91dGVyV2lkdGgoKSxib3R0b206aC50b3ArZS5vdXRlckhlaWdodCgpLHN0YXJ0c2VsZWN0ZWQ6ZmFsc2Usc2VsZWN0ZWQ6ZS5oYXNDbGFzcyhcInVpLXNlbGVjdGVkXCIpLFxuc2VsZWN0aW5nOmUuaGFzQ2xhc3MoXCJ1aS1zZWxlY3RpbmdcIiksdW5zZWxlY3Rpbmc6ZS5oYXNDbGFzcyhcInVpLXVuc2VsZWN0aW5nXCIpfSl9KX07dGhpcy5yZWZyZXNoKCk7dGhpcy5zZWxlY3RlZXM9Yy5hZGRDbGFzcyhcInVpLXNlbGVjdGVlXCIpO3RoaXMuX21vdXNlSW5pdCgpO3RoaXMuaGVscGVyPWEoXCI8ZGl2IGNsYXNzPSd1aS1zZWxlY3RhYmxlLWhlbHBlcic+PC9kaXY+XCIpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5zZWxlY3RlZXMucmVtb3ZlQ2xhc3MoXCJ1aS1zZWxlY3RlZVwiKS5yZW1vdmVEYXRhKFwic2VsZWN0YWJsZS1pdGVtXCIpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXNlbGVjdGFibGUgdWktc2VsZWN0YWJsZS1kaXNhYmxlZFwiKS5yZW1vdmVEYXRhKFwic2VsZWN0YWJsZVwiKS51bmJpbmQoXCIuc2VsZWN0YWJsZVwiKTt0aGlzLl9tb3VzZURlc3Ryb3koKTtyZXR1cm4gdGhpc30sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oZCl7dmFyIGM9dGhpczt0aGlzLm9wb3M9W2QucGFnZVgsXG5kLnBhZ2VZXTtpZighdGhpcy5vcHRpb25zLmRpc2FibGVkKXt2YXIgZT10aGlzLm9wdGlvbnM7dGhpcy5zZWxlY3RlZXM9YShlLmZpbHRlcix0aGlzLmVsZW1lbnRbMF0pO3RoaXMuX3RyaWdnZXIoXCJzdGFydFwiLGQpO2EoZS5hcHBlbmRUbykuYXBwZW5kKHRoaXMuaGVscGVyKTt0aGlzLmhlbHBlci5jc3Moe2xlZnQ6ZC5jbGllbnRYLHRvcDpkLmNsaWVudFksd2lkdGg6MCxoZWlnaHQ6MH0pO2UuYXV0b1JlZnJlc2gmJnRoaXMucmVmcmVzaCgpO3RoaXMuc2VsZWN0ZWVzLmZpbHRlcihcIi51aS1zZWxlY3RlZFwiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGg9YS5kYXRhKHRoaXMsXCJzZWxlY3RhYmxlLWl0ZW1cIik7aC5zdGFydHNlbGVjdGVkPXRydWU7aWYoIWQubWV0YUtleSl7aC4kZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXNlbGVjdGVkXCIpO2guc2VsZWN0ZWQ9ZmFsc2U7aC4kZWxlbWVudC5hZGRDbGFzcyhcInVpLXVuc2VsZWN0aW5nXCIpO2gudW5zZWxlY3Rpbmc9dHJ1ZTtjLl90cmlnZ2VyKFwidW5zZWxlY3RpbmdcIixcbmQse3Vuc2VsZWN0aW5nOmguZWxlbWVudH0pfX0pO2EoZC50YXJnZXQpLnBhcmVudHMoKS5hbmRTZWxmKCkuZWFjaChmdW5jdGlvbigpe3ZhciBoPWEuZGF0YSh0aGlzLFwic2VsZWN0YWJsZS1pdGVtXCIpO2lmKGgpe3ZhciBnPSFkLm1ldGFLZXl8fCFoLiRlbGVtZW50Lmhhc0NsYXNzKFwidWktc2VsZWN0ZWRcIik7aC4kZWxlbWVudC5yZW1vdmVDbGFzcyhnP1widWktdW5zZWxlY3RpbmdcIjpcInVpLXNlbGVjdGVkXCIpLmFkZENsYXNzKGc/XCJ1aS1zZWxlY3RpbmdcIjpcInVpLXVuc2VsZWN0aW5nXCIpO2gudW5zZWxlY3Rpbmc9IWc7aC5zZWxlY3Rpbmc9ZzsoaC5zZWxlY3RlZD1nKT9jLl90cmlnZ2VyKFwic2VsZWN0aW5nXCIsZCx7c2VsZWN0aW5nOmguZWxlbWVudH0pOmMuX3RyaWdnZXIoXCJ1bnNlbGVjdGluZ1wiLGQse3Vuc2VsZWN0aW5nOmguZWxlbWVudH0pO3JldHVybiBmYWxzZX19KX19LF9tb3VzZURyYWc6ZnVuY3Rpb24oZCl7dmFyIGM9dGhpczt0aGlzLmRyYWdnZWQ9dHJ1ZTtpZighdGhpcy5vcHRpb25zLmRpc2FibGVkKXt2YXIgZT1cbnRoaXMub3B0aW9ucyxoPXRoaXMub3Bvc1swXSxnPXRoaXMub3Bvc1sxXSxpPWQucGFnZVgsYj1kLnBhZ2VZO2lmKGg+aSl7dmFyIGY9aTtpPWg7aD1mfWlmKGc+Yil7Zj1iO2I9ZztnPWZ9dGhpcy5oZWxwZXIuY3NzKHtsZWZ0OmgsdG9wOmcsd2lkdGg6aS1oLGhlaWdodDpiLWd9KTt0aGlzLnNlbGVjdGVlcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGo9YS5kYXRhKHRoaXMsXCJzZWxlY3RhYmxlLWl0ZW1cIik7aWYoISghanx8ai5lbGVtZW50PT1jLmVsZW1lbnRbMF0pKXt2YXIgbD1mYWxzZTtpZihlLnRvbGVyYW5jZT09XCJ0b3VjaFwiKWw9IShqLmxlZnQ+aXx8ai5yaWdodDxofHxqLnRvcD5ifHxqLmJvdHRvbTxnKTtlbHNlIGlmKGUudG9sZXJhbmNlPT1cImZpdFwiKWw9ai5sZWZ0PmgmJmoucmlnaHQ8aSYmai50b3A+ZyYmai5ib3R0b208YjtpZihsKXtpZihqLnNlbGVjdGVkKXtqLiRlbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc2VsZWN0ZWRcIik7ai5zZWxlY3RlZD1mYWxzZX1pZihqLnVuc2VsZWN0aW5nKXtqLiRlbGVtZW50LnJlbW92ZUNsYXNzKFwidWktdW5zZWxlY3RpbmdcIik7XG5qLnVuc2VsZWN0aW5nPWZhbHNlfWlmKCFqLnNlbGVjdGluZyl7ai4kZWxlbWVudC5hZGRDbGFzcyhcInVpLXNlbGVjdGluZ1wiKTtqLnNlbGVjdGluZz10cnVlO2MuX3RyaWdnZXIoXCJzZWxlY3RpbmdcIixkLHtzZWxlY3Rpbmc6ai5lbGVtZW50fSl9fWVsc2V7aWYoai5zZWxlY3RpbmcpaWYoZC5tZXRhS2V5JiZqLnN0YXJ0c2VsZWN0ZWQpe2ouJGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zZWxlY3RpbmdcIik7ai5zZWxlY3Rpbmc9ZmFsc2U7ai4kZWxlbWVudC5hZGRDbGFzcyhcInVpLXNlbGVjdGVkXCIpO2ouc2VsZWN0ZWQ9dHJ1ZX1lbHNle2ouJGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zZWxlY3RpbmdcIik7ai5zZWxlY3Rpbmc9ZmFsc2U7aWYoai5zdGFydHNlbGVjdGVkKXtqLiRlbGVtZW50LmFkZENsYXNzKFwidWktdW5zZWxlY3RpbmdcIik7ai51bnNlbGVjdGluZz10cnVlfWMuX3RyaWdnZXIoXCJ1bnNlbGVjdGluZ1wiLGQse3Vuc2VsZWN0aW5nOmouZWxlbWVudH0pfWlmKGouc2VsZWN0ZWQpaWYoIWQubWV0YUtleSYmXG4hai5zdGFydHNlbGVjdGVkKXtqLiRlbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc2VsZWN0ZWRcIik7ai5zZWxlY3RlZD1mYWxzZTtqLiRlbGVtZW50LmFkZENsYXNzKFwidWktdW5zZWxlY3RpbmdcIik7ai51bnNlbGVjdGluZz10cnVlO2MuX3RyaWdnZXIoXCJ1bnNlbGVjdGluZ1wiLGQse3Vuc2VsZWN0aW5nOmouZWxlbWVudH0pfX19fSk7cmV0dXJuIGZhbHNlfX0sX21vdXNlU3RvcDpmdW5jdGlvbihkKXt2YXIgYz10aGlzO3RoaXMuZHJhZ2dlZD1mYWxzZTthKFwiLnVpLXVuc2VsZWN0aW5nXCIsdGhpcy5lbGVtZW50WzBdKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGU9YS5kYXRhKHRoaXMsXCJzZWxlY3RhYmxlLWl0ZW1cIik7ZS4kZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXVuc2VsZWN0aW5nXCIpO2UudW5zZWxlY3Rpbmc9ZmFsc2U7ZS5zdGFydHNlbGVjdGVkPWZhbHNlO2MuX3RyaWdnZXIoXCJ1bnNlbGVjdGVkXCIsZCx7dW5zZWxlY3RlZDplLmVsZW1lbnR9KX0pO2EoXCIudWktc2VsZWN0aW5nXCIsdGhpcy5lbGVtZW50WzBdKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGU9XG5hLmRhdGEodGhpcyxcInNlbGVjdGFibGUtaXRlbVwiKTtlLiRlbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc2VsZWN0aW5nXCIpLmFkZENsYXNzKFwidWktc2VsZWN0ZWRcIik7ZS5zZWxlY3Rpbmc9ZmFsc2U7ZS5zZWxlY3RlZD10cnVlO2Uuc3RhcnRzZWxlY3RlZD10cnVlO2MuX3RyaWdnZXIoXCJzZWxlY3RlZFwiLGQse3NlbGVjdGVkOmUuZWxlbWVudH0pfSk7dGhpcy5fdHJpZ2dlcihcInN0b3BcIixkKTt0aGlzLmhlbHBlci5yZW1vdmUoKTtyZXR1cm4gZmFsc2V9fSk7YS5leHRlbmQoYS51aS5zZWxlY3RhYmxlLHt2ZXJzaW9uOlwiMS44LjE2XCJ9KX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS53aWRnZXQoXCJ1aS5zb3J0YWJsZVwiLGEudWkubW91c2Use3dpZGdldEV2ZW50UHJlZml4Olwic29ydFwiLG9wdGlvbnM6e2FwcGVuZFRvOlwicGFyZW50XCIsYXhpczpmYWxzZSxjb25uZWN0V2l0aDpmYWxzZSxjb250YWlubWVudDpmYWxzZSxjdXJzb3I6XCJhdXRvXCIsY3Vyc29yQXQ6ZmFsc2UsZHJvcE9uRW1wdHk6dHJ1ZSxmb3JjZVBsYWNlaG9sZGVyU2l6ZTpmYWxzZSxmb3JjZUhlbHBlclNpemU6ZmFsc2UsZ3JpZDpmYWxzZSxoYW5kbGU6ZmFsc2UsaGVscGVyOlwib3JpZ2luYWxcIixpdGVtczpcIj4gKlwiLG9wYWNpdHk6ZmFsc2UscGxhY2Vob2xkZXI6ZmFsc2UscmV2ZXJ0OmZhbHNlLHNjcm9sbDp0cnVlLHNjcm9sbFNlbnNpdGl2aXR5OjIwLHNjcm9sbFNwZWVkOjIwLHNjb3BlOlwiZGVmYXVsdFwiLHRvbGVyYW5jZTpcImludGVyc2VjdFwiLHpJbmRleDoxRTN9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgZD10aGlzLm9wdGlvbnM7dGhpcy5jb250YWluZXJDYWNoZT17fTt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1zb3J0YWJsZVwiKTtcbnRoaXMucmVmcmVzaCgpO3RoaXMuZmxvYXRpbmc9dGhpcy5pdGVtcy5sZW5ndGg/ZC5heGlzPT09XCJ4XCJ8fC9sZWZ0fHJpZ2h0Ly50ZXN0KHRoaXMuaXRlbXNbMF0uaXRlbS5jc3MoXCJmbG9hdFwiKSl8fC9pbmxpbmV8dGFibGUtY2VsbC8udGVzdCh0aGlzLml0ZW1zWzBdLml0ZW0uY3NzKFwiZGlzcGxheVwiKSk6ZmFsc2U7dGhpcy5vZmZzZXQ9dGhpcy5lbGVtZW50Lm9mZnNldCgpO3RoaXMuX21vdXNlSW5pdCgpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc29ydGFibGUgdWktc29ydGFibGUtZGlzYWJsZWRcIikucmVtb3ZlRGF0YShcInNvcnRhYmxlXCIpLnVuYmluZChcIi5zb3J0YWJsZVwiKTt0aGlzLl9tb3VzZURlc3Ryb3koKTtmb3IodmFyIGQ9dGhpcy5pdGVtcy5sZW5ndGgtMTtkPj0wO2QtLSl0aGlzLml0ZW1zW2RdLml0ZW0ucmVtb3ZlRGF0YShcInNvcnRhYmxlLWl0ZW1cIik7cmV0dXJuIHRoaXN9LF9zZXRPcHRpb246ZnVuY3Rpb24oZCxjKXtpZihkPT09XG5cImRpc2FibGVkXCIpe3RoaXMub3B0aW9uc1tkXT1jO3RoaXMud2lkZ2V0KClbYz9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcInVpLXNvcnRhYmxlLWRpc2FibGVkXCIpfWVsc2UgYS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKGQsYyl7aWYodGhpcy5yZXZlcnRpbmcpcmV0dXJuIGZhbHNlO2lmKHRoaXMub3B0aW9ucy5kaXNhYmxlZHx8dGhpcy5vcHRpb25zLnR5cGU9PVwic3RhdGljXCIpcmV0dXJuIGZhbHNlO3RoaXMuX3JlZnJlc2hJdGVtcyhkKTt2YXIgZT1udWxsLGg9dGhpczthKGQudGFyZ2V0KS5wYXJlbnRzKCkuZWFjaChmdW5jdGlvbigpe2lmKGEuZGF0YSh0aGlzLFwic29ydGFibGUtaXRlbVwiKT09aCl7ZT1hKHRoaXMpO3JldHVybiBmYWxzZX19KTtpZihhLmRhdGEoZC50YXJnZXQsXCJzb3J0YWJsZS1pdGVtXCIpPT1oKWU9YShkLnRhcmdldCk7aWYoIWUpcmV0dXJuIGZhbHNlO2lmKHRoaXMub3B0aW9ucy5oYW5kbGUmJlxuIWMpe3ZhciBnPWZhbHNlO2EodGhpcy5vcHRpb25zLmhhbmRsZSxlKS5maW5kKFwiKlwiKS5hbmRTZWxmKCkuZWFjaChmdW5jdGlvbigpe2lmKHRoaXM9PWQudGFyZ2V0KWc9dHJ1ZX0pO2lmKCFnKXJldHVybiBmYWxzZX10aGlzLmN1cnJlbnRJdGVtPWU7dGhpcy5fcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXMoKTtyZXR1cm4gdHJ1ZX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oZCxjLGUpe2M9dGhpcy5vcHRpb25zO3ZhciBoPXRoaXM7dGhpcy5jdXJyZW50Q29udGFpbmVyPXRoaXM7dGhpcy5yZWZyZXNoUG9zaXRpb25zKCk7dGhpcy5oZWxwZXI9dGhpcy5fY3JlYXRlSGVscGVyKGQpO3RoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKTt0aGlzLl9jYWNoZU1hcmdpbnMoKTt0aGlzLnNjcm9sbFBhcmVudD10aGlzLmhlbHBlci5zY3JvbGxQYXJlbnQoKTt0aGlzLm9mZnNldD10aGlzLmN1cnJlbnRJdGVtLm9mZnNldCgpO3RoaXMub2Zmc2V0PXt0b3A6dGhpcy5vZmZzZXQudG9wLXRoaXMubWFyZ2lucy50b3AsXG5sZWZ0OnRoaXMub2Zmc2V0LmxlZnQtdGhpcy5tYXJnaW5zLmxlZnR9O3RoaXMuaGVscGVyLmNzcyhcInBvc2l0aW9uXCIsXCJhYnNvbHV0ZVwiKTt0aGlzLmNzc1Bvc2l0aW9uPXRoaXMuaGVscGVyLmNzcyhcInBvc2l0aW9uXCIpO2EuZXh0ZW5kKHRoaXMub2Zmc2V0LHtjbGljazp7bGVmdDpkLnBhZ2VYLXRoaXMub2Zmc2V0LmxlZnQsdG9wOmQucGFnZVktdGhpcy5vZmZzZXQudG9wfSxwYXJlbnQ6dGhpcy5fZ2V0UGFyZW50T2Zmc2V0KCkscmVsYXRpdmU6dGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKX0pO3RoaXMub3JpZ2luYWxQb3NpdGlvbj10aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKGQpO3RoaXMub3JpZ2luYWxQYWdlWD1kLnBhZ2VYO3RoaXMub3JpZ2luYWxQYWdlWT1kLnBhZ2VZO2MuY3Vyc29yQXQmJnRoaXMuX2FkanVzdE9mZnNldEZyb21IZWxwZXIoYy5jdXJzb3JBdCk7dGhpcy5kb21Qb3NpdGlvbj17cHJldjp0aGlzLmN1cnJlbnRJdGVtLnByZXYoKVswXSxwYXJlbnQ6dGhpcy5jdXJyZW50SXRlbS5wYXJlbnQoKVswXX07XG50aGlzLmhlbHBlclswXSE9dGhpcy5jdXJyZW50SXRlbVswXSYmdGhpcy5jdXJyZW50SXRlbS5oaWRlKCk7dGhpcy5fY3JlYXRlUGxhY2Vob2xkZXIoKTtjLmNvbnRhaW5tZW50JiZ0aGlzLl9zZXRDb250YWlubWVudCgpO2lmKGMuY3Vyc29yKXtpZihhKFwiYm9keVwiKS5jc3MoXCJjdXJzb3JcIikpdGhpcy5fc3RvcmVkQ3Vyc29yPWEoXCJib2R5XCIpLmNzcyhcImN1cnNvclwiKTthKFwiYm9keVwiKS5jc3MoXCJjdXJzb3JcIixjLmN1cnNvcil9aWYoYy5vcGFjaXR5KXtpZih0aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIpKXRoaXMuX3N0b3JlZE9wYWNpdHk9dGhpcy5oZWxwZXIuY3NzKFwib3BhY2l0eVwiKTt0aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIsYy5vcGFjaXR5KX1pZihjLnpJbmRleCl7aWYodGhpcy5oZWxwZXIuY3NzKFwiekluZGV4XCIpKXRoaXMuX3N0b3JlZFpJbmRleD10aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIik7dGhpcy5oZWxwZXIuY3NzKFwiekluZGV4XCIsYy56SW5kZXgpfWlmKHRoaXMuc2Nyb2xsUGFyZW50WzBdIT1cbmRvY3VtZW50JiZ0aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lIT1cIkhUTUxcIil0aGlzLm92ZXJmbG93T2Zmc2V0PXRoaXMuc2Nyb2xsUGFyZW50Lm9mZnNldCgpO3RoaXMuX3RyaWdnZXIoXCJzdGFydFwiLGQsdGhpcy5fdWlIYXNoKCkpO3RoaXMuX3ByZXNlcnZlSGVscGVyUHJvcG9ydGlvbnN8fHRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKTtpZighZSlmb3IoZT10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7ZT49MDtlLS0pdGhpcy5jb250YWluZXJzW2VdLl90cmlnZ2VyKFwiYWN0aXZhdGVcIixkLGguX3VpSGFzaCh0aGlzKSk7aWYoYS51aS5kZG1hbmFnZXIpYS51aS5kZG1hbmFnZXIuY3VycmVudD10aGlzO2EudWkuZGRtYW5hZ2VyJiYhYy5kcm9wQmVoYXZpb3VyJiZhLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLGQpO3RoaXMuZHJhZ2dpbmc9dHJ1ZTt0aGlzLmhlbHBlci5hZGRDbGFzcyhcInVpLXNvcnRhYmxlLWhlbHBlclwiKTt0aGlzLl9tb3VzZURyYWcoZCk7XG5yZXR1cm4gdHJ1ZX0sX21vdXNlRHJhZzpmdW5jdGlvbihkKXt0aGlzLnBvc2l0aW9uPXRoaXMuX2dlbmVyYXRlUG9zaXRpb24oZCk7dGhpcy5wb3NpdGlvbkFicz10aGlzLl9jb252ZXJ0UG9zaXRpb25UbyhcImFic29sdXRlXCIpO2lmKCF0aGlzLmxhc3RQb3NpdGlvbkFicyl0aGlzLmxhc3RQb3NpdGlvbkFicz10aGlzLnBvc2l0aW9uQWJzO2lmKHRoaXMub3B0aW9ucy5zY3JvbGwpe3ZhciBjPXRoaXMub3B0aW9ucyxlPWZhbHNlO2lmKHRoaXMuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmdGhpcy5zY3JvbGxQYXJlbnRbMF0udGFnTmFtZSE9XCJIVE1MXCIpe2lmKHRoaXMub3ZlcmZsb3dPZmZzZXQudG9wK3RoaXMuc2Nyb2xsUGFyZW50WzBdLm9mZnNldEhlaWdodC1kLnBhZ2VZPGMuc2Nyb2xsU2Vuc2l0aXZpdHkpdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wPWU9dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wK2Muc2Nyb2xsU3BlZWQ7ZWxzZSBpZihkLnBhZ2VZLXRoaXMub3ZlcmZsb3dPZmZzZXQudG9wPFxuYy5zY3JvbGxTZW5zaXRpdml0eSl0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3A9ZT10aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AtYy5zY3JvbGxTcGVlZDtpZih0aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQrdGhpcy5zY3JvbGxQYXJlbnRbMF0ub2Zmc2V0V2lkdGgtZC5wYWdlWDxjLnNjcm9sbFNlbnNpdGl2aXR5KXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQ9ZT10aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0K2Muc2Nyb2xsU3BlZWQ7ZWxzZSBpZihkLnBhZ2VYLXRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdDxjLnNjcm9sbFNlbnNpdGl2aXR5KXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQ9ZT10aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0LWMuc2Nyb2xsU3BlZWR9ZWxzZXtpZihkLnBhZ2VZLWEoZG9jdW1lbnQpLnNjcm9sbFRvcCgpPGMuc2Nyb2xsU2Vuc2l0aXZpdHkpZT1hKGRvY3VtZW50KS5zY3JvbGxUb3AoYShkb2N1bWVudCkuc2Nyb2xsVG9wKCktXG5jLnNjcm9sbFNwZWVkKTtlbHNlIGlmKGEod2luZG93KS5oZWlnaHQoKS0oZC5wYWdlWS1hKGRvY3VtZW50KS5zY3JvbGxUb3AoKSk8Yy5zY3JvbGxTZW5zaXRpdml0eSllPWEoZG9jdW1lbnQpLnNjcm9sbFRvcChhKGRvY3VtZW50KS5zY3JvbGxUb3AoKStjLnNjcm9sbFNwZWVkKTtpZihkLnBhZ2VYLWEoZG9jdW1lbnQpLnNjcm9sbExlZnQoKTxjLnNjcm9sbFNlbnNpdGl2aXR5KWU9YShkb2N1bWVudCkuc2Nyb2xsTGVmdChhKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCktYy5zY3JvbGxTcGVlZCk7ZWxzZSBpZihhKHdpbmRvdykud2lkdGgoKS0oZC5wYWdlWC1hKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkpPGMuc2Nyb2xsU2Vuc2l0aXZpdHkpZT1hKGRvY3VtZW50KS5zY3JvbGxMZWZ0KGEoZG9jdW1lbnQpLnNjcm9sbExlZnQoKStjLnNjcm9sbFNwZWVkKX1lIT09ZmFsc2UmJmEudWkuZGRtYW5hZ2VyJiYhYy5kcm9wQmVoYXZpb3VyJiZhLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLFxuZCl9dGhpcy5wb3NpdGlvbkFicz10aGlzLl9jb252ZXJ0UG9zaXRpb25UbyhcImFic29sdXRlXCIpO2lmKCF0aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5vcHRpb25zLmF4aXMhPVwieVwiKXRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQ9dGhpcy5wb3NpdGlvbi5sZWZ0K1wicHhcIjtpZighdGhpcy5vcHRpb25zLmF4aXN8fHRoaXMub3B0aW9ucy5heGlzIT1cInhcIil0aGlzLmhlbHBlclswXS5zdHlsZS50b3A9dGhpcy5wb3NpdGlvbi50b3ArXCJweFwiO2ZvcihjPXRoaXMuaXRlbXMubGVuZ3RoLTE7Yz49MDtjLS0pe2U9dGhpcy5pdGVtc1tjXTt2YXIgaD1lLml0ZW1bMF0sZz10aGlzLl9pbnRlcnNlY3RzV2l0aFBvaW50ZXIoZSk7aWYoZylpZihoIT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLnBsYWNlaG9sZGVyW2c9PTE/XCJuZXh0XCI6XCJwcmV2XCJdKClbMF0hPWgmJiFhLnVpLmNvbnRhaW5zKHRoaXMucGxhY2Vob2xkZXJbMF0saCkmJih0aGlzLm9wdGlvbnMudHlwZT09XCJzZW1pLWR5bmFtaWNcIj8hYS51aS5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sXG5oKTp0cnVlKSl7dGhpcy5kaXJlY3Rpb249Zz09MT9cImRvd25cIjpcInVwXCI7aWYodGhpcy5vcHRpb25zLnRvbGVyYW5jZT09XCJwb2ludGVyXCJ8fHRoaXMuX2ludGVyc2VjdHNXaXRoU2lkZXMoZSkpdGhpcy5fcmVhcnJhbmdlKGQsZSk7ZWxzZSBicmVhazt0aGlzLl90cmlnZ2VyKFwiY2hhbmdlXCIsZCx0aGlzLl91aUhhc2goKSk7YnJlYWt9fXRoaXMuX2NvbnRhY3RDb250YWluZXJzKGQpO2EudWkuZGRtYW5hZ2VyJiZhLnVpLmRkbWFuYWdlci5kcmFnKHRoaXMsZCk7dGhpcy5fdHJpZ2dlcihcInNvcnRcIixkLHRoaXMuX3VpSGFzaCgpKTt0aGlzLmxhc3RQb3NpdGlvbkFicz10aGlzLnBvc2l0aW9uQWJzO3JldHVybiBmYWxzZX0sX21vdXNlU3RvcDpmdW5jdGlvbihkLGMpe2lmKGQpe2EudWkuZGRtYW5hZ2VyJiYhdGhpcy5vcHRpb25zLmRyb3BCZWhhdmlvdXImJmEudWkuZGRtYW5hZ2VyLmRyb3AodGhpcyxkKTtpZih0aGlzLm9wdGlvbnMucmV2ZXJ0KXt2YXIgZT10aGlzO2M9ZS5wbGFjZWhvbGRlci5vZmZzZXQoKTtcbmUucmV2ZXJ0aW5nPXRydWU7YSh0aGlzLmhlbHBlcikuYW5pbWF0ZSh7bGVmdDpjLmxlZnQtdGhpcy5vZmZzZXQucGFyZW50LmxlZnQtZS5tYXJnaW5zLmxlZnQrKHRoaXMub2Zmc2V0UGFyZW50WzBdPT1kb2N1bWVudC5ib2R5PzA6dGhpcy5vZmZzZXRQYXJlbnRbMF0uc2Nyb2xsTGVmdCksdG9wOmMudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3AtZS5tYXJnaW5zLnRvcCsodGhpcy5vZmZzZXRQYXJlbnRbMF09PWRvY3VtZW50LmJvZHk/MDp0aGlzLm9mZnNldFBhcmVudFswXS5zY3JvbGxUb3ApfSxwYXJzZUludCh0aGlzLm9wdGlvbnMucmV2ZXJ0LDEwKXx8NTAwLGZ1bmN0aW9uKCl7ZS5fY2xlYXIoZCl9KX1lbHNlIHRoaXMuX2NsZWFyKGQsYyk7cmV0dXJuIGZhbHNlfX0sY2FuY2VsOmZ1bmN0aW9uKCl7dmFyIGQ9dGhpcztpZih0aGlzLmRyYWdnaW5nKXt0aGlzLl9tb3VzZVVwKHt0YXJnZXQ6bnVsbH0pO3RoaXMub3B0aW9ucy5oZWxwZXI9PVwib3JpZ2luYWxcIj90aGlzLmN1cnJlbnRJdGVtLmNzcyh0aGlzLl9zdG9yZWRDU1MpLnJlbW92ZUNsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpOlxudGhpcy5jdXJyZW50SXRlbS5zaG93KCk7Zm9yKHZhciBjPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtjPj0wO2MtLSl7dGhpcy5jb250YWluZXJzW2NdLl90cmlnZ2VyKFwiZGVhY3RpdmF0ZVwiLG51bGwsZC5fdWlIYXNoKHRoaXMpKTtpZih0aGlzLmNvbnRhaW5lcnNbY10uY29udGFpbmVyQ2FjaGUub3Zlcil7dGhpcy5jb250YWluZXJzW2NdLl90cmlnZ2VyKFwib3V0XCIsbnVsbCxkLl91aUhhc2godGhpcykpO3RoaXMuY29udGFpbmVyc1tjXS5jb250YWluZXJDYWNoZS5vdmVyPTB9fX1pZih0aGlzLnBsYWNlaG9sZGVyKXt0aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUmJnRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKTt0aGlzLm9wdGlvbnMuaGVscGVyIT1cIm9yaWdpbmFsXCImJnRoaXMuaGVscGVyJiZ0aGlzLmhlbHBlclswXS5wYXJlbnROb2RlJiZ0aGlzLmhlbHBlci5yZW1vdmUoKTthLmV4dGVuZCh0aGlzLHtoZWxwZXI6bnVsbCxcbmRyYWdnaW5nOmZhbHNlLHJldmVydGluZzpmYWxzZSxfbm9GaW5hbFNvcnQ6bnVsbH0pO3RoaXMuZG9tUG9zaXRpb24ucHJldj9hKHRoaXMuZG9tUG9zaXRpb24ucHJldikuYWZ0ZXIodGhpcy5jdXJyZW50SXRlbSk6YSh0aGlzLmRvbVBvc2l0aW9uLnBhcmVudCkucHJlcGVuZCh0aGlzLmN1cnJlbnRJdGVtKX1yZXR1cm4gdGhpc30sc2VyaWFsaXplOmZ1bmN0aW9uKGQpe3ZhciBjPXRoaXMuX2dldEl0ZW1zQXNqUXVlcnkoZCYmZC5jb25uZWN0ZWQpLGU9W107ZD1kfHx7fTthKGMpLmVhY2goZnVuY3Rpb24oKXt2YXIgaD0oYShkLml0ZW18fHRoaXMpLmF0dHIoZC5hdHRyaWJ1dGV8fFwiaWRcIil8fFwiXCIpLm1hdGNoKGQuZXhwcmVzc2lvbnx8LyguKylbLT1fXSguKykvKTtpZihoKWUucHVzaCgoZC5rZXl8fGhbMV0rXCJbXVwiKStcIj1cIisoZC5rZXkmJmQuZXhwcmVzc2lvbj9oWzFdOmhbMl0pKX0pOyFlLmxlbmd0aCYmZC5rZXkmJmUucHVzaChkLmtleStcIj1cIik7cmV0dXJuIGUuam9pbihcIiZcIil9LFxudG9BcnJheTpmdW5jdGlvbihkKXt2YXIgYz10aGlzLl9nZXRJdGVtc0FzalF1ZXJ5KGQmJmQuY29ubmVjdGVkKSxlPVtdO2Q9ZHx8e307Yy5lYWNoKGZ1bmN0aW9uKCl7ZS5wdXNoKGEoZC5pdGVtfHx0aGlzKS5hdHRyKGQuYXR0cmlidXRlfHxcImlkXCIpfHxcIlwiKX0pO3JldHVybiBlfSxfaW50ZXJzZWN0c1dpdGg6ZnVuY3Rpb24oZCl7dmFyIGM9dGhpcy5wb3NpdGlvbkFicy5sZWZ0LGU9Yyt0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLGg9dGhpcy5wb3NpdGlvbkFicy50b3AsZz1oK3RoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LGk9ZC5sZWZ0LGI9aStkLndpZHRoLGY9ZC50b3Asaj1mK2QuaGVpZ2h0LGw9dGhpcy5vZmZzZXQuY2xpY2sudG9wLG89dGhpcy5vZmZzZXQuY2xpY2subGVmdDtsPWgrbD5mJiZoK2w8aiYmYytvPmkmJmMrbzxiO3JldHVybiB0aGlzLm9wdGlvbnMudG9sZXJhbmNlPT1cInBvaW50ZXJcInx8dGhpcy5vcHRpb25zLmZvcmNlUG9pbnRlckZvckNvbnRhaW5lcnN8fFxudGhpcy5vcHRpb25zLnRvbGVyYW5jZSE9XCJwb2ludGVyXCImJnRoaXMuaGVscGVyUHJvcG9ydGlvbnNbdGhpcy5mbG9hdGluZz9cIndpZHRoXCI6XCJoZWlnaHRcIl0+ZFt0aGlzLmZsb2F0aW5nP1wid2lkdGhcIjpcImhlaWdodFwiXT9sOmk8Yyt0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLzImJmUtdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC8yPGImJmY8aCt0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC8yJiZnLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LzI8an0sX2ludGVyc2VjdHNXaXRoUG9pbnRlcjpmdW5jdGlvbihkKXt2YXIgYz1hLnVpLmlzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy50b3ArdGhpcy5vZmZzZXQuY2xpY2sudG9wLGQudG9wLGQuaGVpZ2h0KTtkPWEudWkuaXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLmxlZnQrdGhpcy5vZmZzZXQuY2xpY2subGVmdCxkLmxlZnQsZC53aWR0aCk7Yz1jJiZkO2Q9dGhpcy5fZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uKCk7XG52YXIgZT10aGlzLl9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbigpO2lmKCFjKXJldHVybiBmYWxzZTtyZXR1cm4gdGhpcy5mbG9hdGluZz9lJiZlPT1cInJpZ2h0XCJ8fGQ9PVwiZG93blwiPzI6MTpkJiYoZD09XCJkb3duXCI/MjoxKX0sX2ludGVyc2VjdHNXaXRoU2lkZXM6ZnVuY3Rpb24oZCl7dmFyIGM9YS51aS5pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMudG9wK3RoaXMub2Zmc2V0LmNsaWNrLnRvcCxkLnRvcCtkLmhlaWdodC8yLGQuaGVpZ2h0KTtkPWEudWkuaXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLmxlZnQrdGhpcy5vZmZzZXQuY2xpY2subGVmdCxkLmxlZnQrZC53aWR0aC8yLGQud2lkdGgpO3ZhciBlPXRoaXMuX2dldERyYWdWZXJ0aWNhbERpcmVjdGlvbigpLGg9dGhpcy5fZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb24oKTtyZXR1cm4gdGhpcy5mbG9hdGluZyYmaD9oPT1cInJpZ2h0XCImJmR8fGg9PVwibGVmdFwiJiYhZDplJiYoZT09XCJkb3duXCImJmN8fGU9PVwidXBcIiYmIWMpfSxcbl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb246ZnVuY3Rpb24oKXt2YXIgZD10aGlzLnBvc2l0aW9uQWJzLnRvcC10aGlzLmxhc3RQb3NpdGlvbkFicy50b3A7cmV0dXJuIGQhPTAmJihkPjA/XCJkb3duXCI6XCJ1cFwiKX0sX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uOmZ1bmN0aW9uKCl7dmFyIGQ9dGhpcy5wb3NpdGlvbkFicy5sZWZ0LXRoaXMubGFzdFBvc2l0aW9uQWJzLmxlZnQ7cmV0dXJuIGQhPTAmJihkPjA/XCJyaWdodFwiOlwibGVmdFwiKX0scmVmcmVzaDpmdW5jdGlvbihkKXt0aGlzLl9yZWZyZXNoSXRlbXMoZCk7dGhpcy5yZWZyZXNoUG9zaXRpb25zKCk7cmV0dXJuIHRoaXN9LF9jb25uZWN0V2l0aDpmdW5jdGlvbigpe3ZhciBkPXRoaXMub3B0aW9ucztyZXR1cm4gZC5jb25uZWN0V2l0aC5jb25zdHJ1Y3Rvcj09U3RyaW5nP1tkLmNvbm5lY3RXaXRoXTpkLmNvbm5lY3RXaXRofSxfZ2V0SXRlbXNBc2pRdWVyeTpmdW5jdGlvbihkKXt2YXIgYz1bXSxlPVtdLGg9dGhpcy5fY29ubmVjdFdpdGgoKTtcbmlmKGgmJmQpZm9yKGQ9aC5sZW5ndGgtMTtkPj0wO2QtLSlmb3IodmFyIGc9YShoW2RdKSxpPWcubGVuZ3RoLTE7aT49MDtpLS0pe3ZhciBiPWEuZGF0YShnW2ldLFwic29ydGFibGVcIik7aWYoYiYmYiE9dGhpcyYmIWIub3B0aW9ucy5kaXNhYmxlZCllLnB1c2goW2EuaXNGdW5jdGlvbihiLm9wdGlvbnMuaXRlbXMpP2Iub3B0aW9ucy5pdGVtcy5jYWxsKGIuZWxlbWVudCk6YShiLm9wdGlvbnMuaXRlbXMsYi5lbGVtZW50KS5ub3QoXCIudWktc29ydGFibGUtaGVscGVyXCIpLm5vdChcIi51aS1zb3J0YWJsZS1wbGFjZWhvbGRlclwiKSxiXSl9ZS5wdXNoKFthLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKT90aGlzLm9wdGlvbnMuaXRlbXMuY2FsbCh0aGlzLmVsZW1lbnQsbnVsbCx7b3B0aW9uczp0aGlzLm9wdGlvbnMsaXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6YSh0aGlzLm9wdGlvbnMuaXRlbXMsdGhpcy5lbGVtZW50KS5ub3QoXCIudWktc29ydGFibGUtaGVscGVyXCIpLm5vdChcIi51aS1zb3J0YWJsZS1wbGFjZWhvbGRlclwiKSxcbnRoaXNdKTtmb3IoZD1lLmxlbmd0aC0xO2Q+PTA7ZC0tKWVbZF1bMF0uZWFjaChmdW5jdGlvbigpe2MucHVzaCh0aGlzKX0pO3JldHVybiBhKGMpfSxfcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXM6ZnVuY3Rpb24oKXtmb3IodmFyIGQ9dGhpcy5jdXJyZW50SXRlbS5maW5kKFwiOmRhdGEoc29ydGFibGUtaXRlbSlcIiksYz0wO2M8dGhpcy5pdGVtcy5sZW5ndGg7YysrKWZvcih2YXIgZT0wO2U8ZC5sZW5ndGg7ZSsrKWRbZV09PXRoaXMuaXRlbXNbY10uaXRlbVswXSYmdGhpcy5pdGVtcy5zcGxpY2UoYywxKX0sX3JlZnJlc2hJdGVtczpmdW5jdGlvbihkKXt0aGlzLml0ZW1zPVtdO3RoaXMuY29udGFpbmVycz1bdGhpc107dmFyIGM9dGhpcy5pdGVtcyxlPVtbYS5pc0Z1bmN0aW9uKHRoaXMub3B0aW9ucy5pdGVtcyk/dGhpcy5vcHRpb25zLml0ZW1zLmNhbGwodGhpcy5lbGVtZW50WzBdLGQse2l0ZW06dGhpcy5jdXJyZW50SXRlbX0pOmEodGhpcy5vcHRpb25zLml0ZW1zLHRoaXMuZWxlbWVudCksXG50aGlzXV0saD10aGlzLl9jb25uZWN0V2l0aCgpO2lmKGgpZm9yKHZhciBnPWgubGVuZ3RoLTE7Zz49MDtnLS0pZm9yKHZhciBpPWEoaFtnXSksYj1pLmxlbmd0aC0xO2I+PTA7Yi0tKXt2YXIgZj1hLmRhdGEoaVtiXSxcInNvcnRhYmxlXCIpO2lmKGYmJmYhPXRoaXMmJiFmLm9wdGlvbnMuZGlzYWJsZWQpe2UucHVzaChbYS5pc0Z1bmN0aW9uKGYub3B0aW9ucy5pdGVtcyk/Zi5vcHRpb25zLml0ZW1zLmNhbGwoZi5lbGVtZW50WzBdLGQse2l0ZW06dGhpcy5jdXJyZW50SXRlbX0pOmEoZi5vcHRpb25zLml0ZW1zLGYuZWxlbWVudCksZl0pO3RoaXMuY29udGFpbmVycy5wdXNoKGYpfX1mb3IoZz1lLmxlbmd0aC0xO2c+PTA7Zy0tKXtkPWVbZ11bMV07aD1lW2ddWzBdO2I9MDtmb3IoaT1oLmxlbmd0aDtiPGk7YisrKXtmPWEoaFtiXSk7Zi5kYXRhKFwic29ydGFibGUtaXRlbVwiLGQpO2MucHVzaCh7aXRlbTpmLGluc3RhbmNlOmQsd2lkdGg6MCxoZWlnaHQ6MCxsZWZ0OjAsdG9wOjB9KX19fSxyZWZyZXNoUG9zaXRpb25zOmZ1bmN0aW9uKGQpe2lmKHRoaXMub2Zmc2V0UGFyZW50JiZcbnRoaXMuaGVscGVyKXRoaXMub2Zmc2V0LnBhcmVudD10aGlzLl9nZXRQYXJlbnRPZmZzZXQoKTtmb3IodmFyIGM9dGhpcy5pdGVtcy5sZW5ndGgtMTtjPj0wO2MtLSl7dmFyIGU9dGhpcy5pdGVtc1tjXTtpZighKGUuaW5zdGFuY2UhPXRoaXMuY3VycmVudENvbnRhaW5lciYmdGhpcy5jdXJyZW50Q29udGFpbmVyJiZlLml0ZW1bMF0hPXRoaXMuY3VycmVudEl0ZW1bMF0pKXt2YXIgaD10aGlzLm9wdGlvbnMudG9sZXJhbmNlRWxlbWVudD9hKHRoaXMub3B0aW9ucy50b2xlcmFuY2VFbGVtZW50LGUuaXRlbSk6ZS5pdGVtO2lmKCFkKXtlLndpZHRoPWgub3V0ZXJXaWR0aCgpO2UuaGVpZ2h0PWgub3V0ZXJIZWlnaHQoKX1oPWgub2Zmc2V0KCk7ZS5sZWZ0PWgubGVmdDtlLnRvcD1oLnRvcH19aWYodGhpcy5vcHRpb25zLmN1c3RvbSYmdGhpcy5vcHRpb25zLmN1c3RvbS5yZWZyZXNoQ29udGFpbmVycyl0aGlzLm9wdGlvbnMuY3VzdG9tLnJlZnJlc2hDb250YWluZXJzLmNhbGwodGhpcyk7ZWxzZSBmb3IoYz1cbnRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtjPj0wO2MtLSl7aD10aGlzLmNvbnRhaW5lcnNbY10uZWxlbWVudC5vZmZzZXQoKTt0aGlzLmNvbnRhaW5lcnNbY10uY29udGFpbmVyQ2FjaGUubGVmdD1oLmxlZnQ7dGhpcy5jb250YWluZXJzW2NdLmNvbnRhaW5lckNhY2hlLnRvcD1oLnRvcDt0aGlzLmNvbnRhaW5lcnNbY10uY29udGFpbmVyQ2FjaGUud2lkdGg9dGhpcy5jb250YWluZXJzW2NdLmVsZW1lbnQub3V0ZXJXaWR0aCgpO3RoaXMuY29udGFpbmVyc1tjXS5jb250YWluZXJDYWNoZS5oZWlnaHQ9dGhpcy5jb250YWluZXJzW2NdLmVsZW1lbnQub3V0ZXJIZWlnaHQoKX1yZXR1cm4gdGhpc30sX2NyZWF0ZVBsYWNlaG9sZGVyOmZ1bmN0aW9uKGQpe3ZhciBjPWR8fHRoaXMsZT1jLm9wdGlvbnM7aWYoIWUucGxhY2Vob2xkZXJ8fGUucGxhY2Vob2xkZXIuY29uc3RydWN0b3I9PVN0cmluZyl7dmFyIGg9ZS5wbGFjZWhvbGRlcjtlLnBsYWNlaG9sZGVyPXtlbGVtZW50OmZ1bmN0aW9uKCl7dmFyIGc9XG5hKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYy5jdXJyZW50SXRlbVswXS5ub2RlTmFtZSkpLmFkZENsYXNzKGh8fGMuY3VycmVudEl0ZW1bMF0uY2xhc3NOYW1lK1wiIHVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyXCIpLnJlbW92ZUNsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpWzBdO2lmKCFoKWcuc3R5bGUudmlzaWJpbGl0eT1cImhpZGRlblwiO3JldHVybiBnfSx1cGRhdGU6ZnVuY3Rpb24oZyxpKXtpZighKGgmJiFlLmZvcmNlUGxhY2Vob2xkZXJTaXplKSl7aS5oZWlnaHQoKXx8aS5oZWlnaHQoYy5jdXJyZW50SXRlbS5pbm5lckhlaWdodCgpLXBhcnNlSW50KGMuY3VycmVudEl0ZW0uY3NzKFwicGFkZGluZ1RvcFwiKXx8MCwxMCktcGFyc2VJbnQoYy5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nQm90dG9tXCIpfHwwLDEwKSk7aS53aWR0aCgpfHxpLndpZHRoKGMuY3VycmVudEl0ZW0uaW5uZXJXaWR0aCgpLXBhcnNlSW50KGMuY3VycmVudEl0ZW0uY3NzKFwicGFkZGluZ0xlZnRcIil8fDAsMTApLXBhcnNlSW50KGMuY3VycmVudEl0ZW0uY3NzKFwicGFkZGluZ1JpZ2h0XCIpfHxcbjAsMTApKX19fX1jLnBsYWNlaG9sZGVyPWEoZS5wbGFjZWhvbGRlci5lbGVtZW50LmNhbGwoYy5lbGVtZW50LGMuY3VycmVudEl0ZW0pKTtjLmN1cnJlbnRJdGVtLmFmdGVyKGMucGxhY2Vob2xkZXIpO2UucGxhY2Vob2xkZXIudXBkYXRlKGMsYy5wbGFjZWhvbGRlcil9LF9jb250YWN0Q29udGFpbmVyczpmdW5jdGlvbihkKXtmb3IodmFyIGM9bnVsbCxlPW51bGwsaD10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7aD49MDtoLS0paWYoIWEudWkuY29udGFpbnModGhpcy5jdXJyZW50SXRlbVswXSx0aGlzLmNvbnRhaW5lcnNbaF0uZWxlbWVudFswXSkpaWYodGhpcy5faW50ZXJzZWN0c1dpdGgodGhpcy5jb250YWluZXJzW2hdLmNvbnRhaW5lckNhY2hlKSl7aWYoIShjJiZhLnVpLmNvbnRhaW5zKHRoaXMuY29udGFpbmVyc1toXS5lbGVtZW50WzBdLGMuZWxlbWVudFswXSkpKXtjPXRoaXMuY29udGFpbmVyc1toXTtlPWh9fWVsc2UgaWYodGhpcy5jb250YWluZXJzW2hdLmNvbnRhaW5lckNhY2hlLm92ZXIpe3RoaXMuY29udGFpbmVyc1toXS5fdHJpZ2dlcihcIm91dFwiLFxuZCx0aGlzLl91aUhhc2godGhpcykpO3RoaXMuY29udGFpbmVyc1toXS5jb250YWluZXJDYWNoZS5vdmVyPTB9aWYoYylpZih0aGlzLmNvbnRhaW5lcnMubGVuZ3RoPT09MSl7dGhpcy5jb250YWluZXJzW2VdLl90cmlnZ2VyKFwib3ZlclwiLGQsdGhpcy5fdWlIYXNoKHRoaXMpKTt0aGlzLmNvbnRhaW5lcnNbZV0uY29udGFpbmVyQ2FjaGUub3Zlcj0xfWVsc2UgaWYodGhpcy5jdXJyZW50Q29udGFpbmVyIT10aGlzLmNvbnRhaW5lcnNbZV0pe2M9MUU0O2g9bnVsbDtmb3IodmFyIGc9dGhpcy5wb3NpdGlvbkFic1t0aGlzLmNvbnRhaW5lcnNbZV0uZmxvYXRpbmc/XCJsZWZ0XCI6XCJ0b3BcIl0saT10aGlzLml0ZW1zLmxlbmd0aC0xO2k+PTA7aS0tKWlmKGEudWkuY29udGFpbnModGhpcy5jb250YWluZXJzW2VdLmVsZW1lbnRbMF0sdGhpcy5pdGVtc1tpXS5pdGVtWzBdKSl7dmFyIGI9dGhpcy5pdGVtc1tpXVt0aGlzLmNvbnRhaW5lcnNbZV0uZmxvYXRpbmc/XCJsZWZ0XCI6XCJ0b3BcIl07aWYoTWF0aC5hYnMoYi1cbmcpPGMpe2M9TWF0aC5hYnMoYi1nKTtoPXRoaXMuaXRlbXNbaV19fWlmKGh8fHRoaXMub3B0aW9ucy5kcm9wT25FbXB0eSl7dGhpcy5jdXJyZW50Q29udGFpbmVyPXRoaXMuY29udGFpbmVyc1tlXTtoP3RoaXMuX3JlYXJyYW5nZShkLGgsbnVsbCx0cnVlKTp0aGlzLl9yZWFycmFuZ2UoZCxudWxsLHRoaXMuY29udGFpbmVyc1tlXS5lbGVtZW50LHRydWUpO3RoaXMuX3RyaWdnZXIoXCJjaGFuZ2VcIixkLHRoaXMuX3VpSGFzaCgpKTt0aGlzLmNvbnRhaW5lcnNbZV0uX3RyaWdnZXIoXCJjaGFuZ2VcIixkLHRoaXMuX3VpSGFzaCh0aGlzKSk7dGhpcy5vcHRpb25zLnBsYWNlaG9sZGVyLnVwZGF0ZSh0aGlzLmN1cnJlbnRDb250YWluZXIsdGhpcy5wbGFjZWhvbGRlcik7dGhpcy5jb250YWluZXJzW2VdLl90cmlnZ2VyKFwib3ZlclwiLGQsdGhpcy5fdWlIYXNoKHRoaXMpKTt0aGlzLmNvbnRhaW5lcnNbZV0uY29udGFpbmVyQ2FjaGUub3Zlcj0xfX19LF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24oZCl7dmFyIGM9XG50aGlzLm9wdGlvbnM7ZD1hLmlzRnVuY3Rpb24oYy5oZWxwZXIpP2EoYy5oZWxwZXIuYXBwbHkodGhpcy5lbGVtZW50WzBdLFtkLHRoaXMuY3VycmVudEl0ZW1dKSk6Yy5oZWxwZXI9PVwiY2xvbmVcIj90aGlzLmN1cnJlbnRJdGVtLmNsb25lKCk6dGhpcy5jdXJyZW50SXRlbTtkLnBhcmVudHMoXCJib2R5XCIpLmxlbmd0aHx8YShjLmFwcGVuZFRvIT1cInBhcmVudFwiP2MuYXBwZW5kVG86dGhpcy5jdXJyZW50SXRlbVswXS5wYXJlbnROb2RlKVswXS5hcHBlbmRDaGlsZChkWzBdKTtpZihkWzBdPT10aGlzLmN1cnJlbnRJdGVtWzBdKXRoaXMuX3N0b3JlZENTUz17d2lkdGg6dGhpcy5jdXJyZW50SXRlbVswXS5zdHlsZS53aWR0aCxoZWlnaHQ6dGhpcy5jdXJyZW50SXRlbVswXS5zdHlsZS5oZWlnaHQscG9zaXRpb246dGhpcy5jdXJyZW50SXRlbS5jc3MoXCJwb3NpdGlvblwiKSx0b3A6dGhpcy5jdXJyZW50SXRlbS5jc3MoXCJ0b3BcIiksbGVmdDp0aGlzLmN1cnJlbnRJdGVtLmNzcyhcImxlZnRcIil9O2lmKGRbMF0uc3R5bGUud2lkdGg9PVxuXCJcInx8Yy5mb3JjZUhlbHBlclNpemUpZC53aWR0aCh0aGlzLmN1cnJlbnRJdGVtLndpZHRoKCkpO2lmKGRbMF0uc3R5bGUuaGVpZ2h0PT1cIlwifHxjLmZvcmNlSGVscGVyU2l6ZSlkLmhlaWdodCh0aGlzLmN1cnJlbnRJdGVtLmhlaWdodCgpKTtyZXR1cm4gZH0sX2FkanVzdE9mZnNldEZyb21IZWxwZXI6ZnVuY3Rpb24oZCl7aWYodHlwZW9mIGQ9PVwic3RyaW5nXCIpZD1kLnNwbGl0KFwiIFwiKTtpZihhLmlzQXJyYXkoZCkpZD17bGVmdDorZFswXSx0b3A6K2RbMV18fDB9O2lmKFwibGVmdFwiaW4gZCl0aGlzLm9mZnNldC5jbGljay5sZWZ0PWQubGVmdCt0aGlzLm1hcmdpbnMubGVmdDtpZihcInJpZ2h0XCJpbiBkKXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC1kLnJpZ2h0K3RoaXMubWFyZ2lucy5sZWZ0O2lmKFwidG9wXCJpbiBkKXRoaXMub2Zmc2V0LmNsaWNrLnRvcD1kLnRvcCt0aGlzLm1hcmdpbnMudG9wO2lmKFwiYm90dG9tXCJpbiBkKXRoaXMub2Zmc2V0LmNsaWNrLnRvcD1cbnRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LWQuYm90dG9tK3RoaXMubWFyZ2lucy50b3B9LF9nZXRQYXJlbnRPZmZzZXQ6ZnVuY3Rpb24oKXt0aGlzLm9mZnNldFBhcmVudD10aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTt2YXIgZD10aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTtpZih0aGlzLmNzc1Bvc2l0aW9uPT1cImFic29sdXRlXCImJnRoaXMuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmYS51aS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSkpe2QubGVmdCs9dGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpO2QudG9wKz10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKX1pZih0aGlzLm9mZnNldFBhcmVudFswXT09ZG9jdW1lbnQuYm9keXx8dGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZSYmdGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpPT1cImh0bWxcIiYmYS5icm93c2VyLm1zaWUpZD1cbnt0b3A6MCxsZWZ0OjB9O3JldHVybnt0b3A6ZC50b3ArKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLDEwKXx8MCksbGVmdDpkLmxlZnQrKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcyhcImJvcmRlckxlZnRXaWR0aFwiKSwxMCl8fDApfX0sX2dldFJlbGF0aXZlT2Zmc2V0OmZ1bmN0aW9uKCl7aWYodGhpcy5jc3NQb3NpdGlvbj09XCJyZWxhdGl2ZVwiKXt2YXIgZD10aGlzLmN1cnJlbnRJdGVtLnBvc2l0aW9uKCk7cmV0dXJue3RvcDpkLnRvcC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKFwidG9wXCIpLDEwKXx8MCkrdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCksbGVmdDpkLmxlZnQtKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcyhcImxlZnRcIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCl9fWVsc2UgcmV0dXJue3RvcDowLGxlZnQ6MH19LF9jYWNoZU1hcmdpbnM6ZnVuY3Rpb24oKXt0aGlzLm1hcmdpbnM9e2xlZnQ6cGFyc2VJbnQodGhpcy5jdXJyZW50SXRlbS5jc3MoXCJtYXJnaW5MZWZ0XCIpLFxuMTApfHwwLHRvcDpwYXJzZUludCh0aGlzLmN1cnJlbnRJdGVtLmNzcyhcIm1hcmdpblRvcFwiKSwxMCl8fDB9fSxfY2FjaGVIZWxwZXJQcm9wb3J0aW9uczpmdW5jdGlvbigpe3RoaXMuaGVscGVyUHJvcG9ydGlvbnM9e3dpZHRoOnRoaXMuaGVscGVyLm91dGVyV2lkdGgoKSxoZWlnaHQ6dGhpcy5oZWxwZXIub3V0ZXJIZWlnaHQoKX19LF9zZXRDb250YWlubWVudDpmdW5jdGlvbigpe3ZhciBkPXRoaXMub3B0aW9ucztpZihkLmNvbnRhaW5tZW50PT1cInBhcmVudFwiKWQuY29udGFpbm1lbnQ9dGhpcy5oZWxwZXJbMF0ucGFyZW50Tm9kZTtpZihkLmNvbnRhaW5tZW50PT1cImRvY3VtZW50XCJ8fGQuY29udGFpbm1lbnQ9PVwid2luZG93XCIpdGhpcy5jb250YWlubWVudD1bMC10aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LDAtdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3AsYShkLmNvbnRhaW5tZW50PT1cImRvY3VtZW50XCI/XG5kb2N1bWVudDp3aW5kb3cpLndpZHRoKCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdCwoYShkLmNvbnRhaW5tZW50PT1cImRvY3VtZW50XCI/ZG9jdW1lbnQ6d2luZG93KS5oZWlnaHQoKXx8ZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcF07aWYoIS9eKGRvY3VtZW50fHdpbmRvd3xwYXJlbnQpJC8udGVzdChkLmNvbnRhaW5tZW50KSl7dmFyIGM9YShkLmNvbnRhaW5tZW50KVswXTtkPWEoZC5jb250YWlubWVudCkub2Zmc2V0KCk7dmFyIGU9YShjKS5jc3MoXCJvdmVyZmxvd1wiKSE9XCJoaWRkZW5cIjt0aGlzLmNvbnRhaW5tZW50PVtkLmxlZnQrKHBhcnNlSW50KGEoYykuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCkrKHBhcnNlSW50KGEoYykuY3NzKFwicGFkZGluZ0xlZnRcIiksMTApfHwwKS10aGlzLm1hcmdpbnMubGVmdCxkLnRvcCsocGFyc2VJbnQoYShjKS5jc3MoXCJib3JkZXJUb3BXaWR0aFwiKSxcbjEwKXx8MCkrKHBhcnNlSW50KGEoYykuY3NzKFwicGFkZGluZ1RvcFwiKSwxMCl8fDApLXRoaXMubWFyZ2lucy50b3AsZC5sZWZ0KyhlP01hdGgubWF4KGMuc2Nyb2xsV2lkdGgsYy5vZmZzZXRXaWR0aCk6Yy5vZmZzZXRXaWR0aCktKHBhcnNlSW50KGEoYykuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCktKHBhcnNlSW50KGEoYykuY3NzKFwicGFkZGluZ1JpZ2h0XCIpLDEwKXx8MCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdCxkLnRvcCsoZT9NYXRoLm1heChjLnNjcm9sbEhlaWdodCxjLm9mZnNldEhlaWdodCk6Yy5vZmZzZXRIZWlnaHQpLShwYXJzZUludChhKGMpLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLDEwKXx8MCktKHBhcnNlSW50KGEoYykuY3NzKFwicGFkZGluZ0JvdHRvbVwiKSwxMCl8fDApLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LXRoaXMubWFyZ2lucy50b3BdfX0sX2NvbnZlcnRQb3NpdGlvblRvOmZ1bmN0aW9uKGQsYyl7aWYoIWMpYz1cbnRoaXMucG9zaXRpb247ZD1kPT1cImFic29sdXRlXCI/MTotMTt2YXIgZT10aGlzLmNzc1Bvc2l0aW9uPT1cImFic29sdXRlXCImJiEodGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZhLnVpLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSk/dGhpcy5vZmZzZXRQYXJlbnQ6dGhpcy5zY3JvbGxQYXJlbnQsaD0vKGh0bWx8Ym9keSkvaS50ZXN0KGVbMF0udGFnTmFtZSk7cmV0dXJue3RvcDpjLnRvcCt0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AqZCt0aGlzLm9mZnNldC5wYXJlbnQudG9wKmQtKGEuYnJvd3Nlci5zYWZhcmkmJnRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8wOih0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpOmg/MDplLnNjcm9sbFRvcCgpKSpkKSxsZWZ0OmMubGVmdCt0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0KmQrdGhpcy5vZmZzZXQucGFyZW50LmxlZnQqZC0oYS5icm93c2VyLnNhZmFyaSYmXG50aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/MDoodGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk6aD8wOmUuc2Nyb2xsTGVmdCgpKSpkKX19LF9nZW5lcmF0ZVBvc2l0aW9uOmZ1bmN0aW9uKGQpe3ZhciBjPXRoaXMub3B0aW9ucyxlPXRoaXMuY3NzUG9zaXRpb249PVwiYWJzb2x1dGVcIiYmISh0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmEudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKT90aGlzLm9mZnNldFBhcmVudDp0aGlzLnNjcm9sbFBhcmVudCxoPS8oaHRtbHxib2R5KS9pLnRlc3QoZVswXS50YWdOYW1lKTtpZih0aGlzLmNzc1Bvc2l0aW9uPT1cInJlbGF0aXZlXCImJiEodGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9dGhpcy5vZmZzZXRQYXJlbnRbMF0pKXRoaXMub2Zmc2V0LnJlbGF0aXZlPXRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCk7XG52YXIgZz1kLnBhZ2VYLGk9ZC5wYWdlWTtpZih0aGlzLm9yaWdpbmFsUG9zaXRpb24pe2lmKHRoaXMuY29udGFpbm1lbnQpe2lmKGQucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdDx0aGlzLmNvbnRhaW5tZW50WzBdKWc9dGhpcy5jb250YWlubWVudFswXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0O2lmKGQucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPHRoaXMuY29udGFpbm1lbnRbMV0paT10aGlzLmNvbnRhaW5tZW50WzFdK3RoaXMub2Zmc2V0LmNsaWNrLnRvcDtpZihkLnBhZ2VYLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ+dGhpcy5jb250YWlubWVudFsyXSlnPXRoaXMuY29udGFpbm1lbnRbMl0rdGhpcy5vZmZzZXQuY2xpY2subGVmdDtpZihkLnBhZ2VZLXRoaXMub2Zmc2V0LmNsaWNrLnRvcD50aGlzLmNvbnRhaW5tZW50WzNdKWk9dGhpcy5jb250YWlubWVudFszXSt0aGlzLm9mZnNldC5jbGljay50b3B9aWYoYy5ncmlkKXtpPXRoaXMub3JpZ2luYWxQYWdlWStNYXRoLnJvdW5kKChpLVxudGhpcy5vcmlnaW5hbFBhZ2VZKS9jLmdyaWRbMV0pKmMuZ3JpZFsxXTtpPXRoaXMuY29udGFpbm1lbnQ/IShpLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDx0aGlzLmNvbnRhaW5tZW50WzFdfHxpLXRoaXMub2Zmc2V0LmNsaWNrLnRvcD50aGlzLmNvbnRhaW5tZW50WzNdKT9pOiEoaS10aGlzLm9mZnNldC5jbGljay50b3A8dGhpcy5jb250YWlubWVudFsxXSk/aS1jLmdyaWRbMV06aStjLmdyaWRbMV06aTtnPXRoaXMub3JpZ2luYWxQYWdlWCtNYXRoLnJvdW5kKChnLXRoaXMub3JpZ2luYWxQYWdlWCkvYy5ncmlkWzBdKSpjLmdyaWRbMF07Zz10aGlzLmNvbnRhaW5tZW50PyEoZy10aGlzLm9mZnNldC5jbGljay5sZWZ0PHRoaXMuY29udGFpbm1lbnRbMF18fGctdGhpcy5vZmZzZXQuY2xpY2subGVmdD50aGlzLmNvbnRhaW5tZW50WzJdKT9nOiEoZy10aGlzLm9mZnNldC5jbGljay5sZWZ0PHRoaXMuY29udGFpbm1lbnRbMF0pP2ctYy5ncmlkWzBdOmcrYy5ncmlkWzBdOmd9fXJldHVybnt0b3A6aS1cbnRoaXMub2Zmc2V0LmNsaWNrLnRvcC10aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcCsoYS5icm93c2VyLnNhZmFyaSYmdGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPzA6dGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTpoPzA6ZS5zY3JvbGxUb3AoKSksbGVmdDpnLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQtdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCsoYS5icm93c2VyLnNhZmFyaSYmdGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPzA6dGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk6aD8wOmUuc2Nyb2xsTGVmdCgpKX19LF9yZWFycmFuZ2U6ZnVuY3Rpb24oZCxjLGUsaCl7ZT9lWzBdLmFwcGVuZENoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pOmMuaXRlbVswXS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLnBsYWNlaG9sZGVyWzBdLFxudGhpcy5kaXJlY3Rpb249PVwiZG93blwiP2MuaXRlbVswXTpjLml0ZW1bMF0ubmV4dFNpYmxpbmcpO3RoaXMuY291bnRlcj10aGlzLmNvdW50ZXI/Kyt0aGlzLmNvdW50ZXI6MTt2YXIgZz10aGlzLGk9dGhpcy5jb3VudGVyO3dpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7aT09Zy5jb3VudGVyJiZnLnJlZnJlc2hQb3NpdGlvbnMoIWgpfSwwKX0sX2NsZWFyOmZ1bmN0aW9uKGQsYyl7dGhpcy5yZXZlcnRpbmc9ZmFsc2U7dmFyIGU9W107IXRoaXMuX25vRmluYWxTb3J0JiZ0aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpLmxlbmd0aCYmdGhpcy5wbGFjZWhvbGRlci5iZWZvcmUodGhpcy5jdXJyZW50SXRlbSk7dGhpcy5fbm9GaW5hbFNvcnQ9bnVsbDtpZih0aGlzLmhlbHBlclswXT09dGhpcy5jdXJyZW50SXRlbVswXSl7Zm9yKHZhciBoIGluIHRoaXMuX3N0b3JlZENTUylpZih0aGlzLl9zdG9yZWRDU1NbaF09PVwiYXV0b1wifHx0aGlzLl9zdG9yZWRDU1NbaF09PVwic3RhdGljXCIpdGhpcy5fc3RvcmVkQ1NTW2hdPVxuXCJcIjt0aGlzLmN1cnJlbnRJdGVtLmNzcyh0aGlzLl9zdG9yZWRDU1MpLnJlbW92ZUNsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpfWVsc2UgdGhpcy5jdXJyZW50SXRlbS5zaG93KCk7dGhpcy5mcm9tT3V0c2lkZSYmIWMmJmUucHVzaChmdW5jdGlvbihnKXt0aGlzLl90cmlnZ2VyKFwicmVjZWl2ZVwiLGcsdGhpcy5fdWlIYXNoKHRoaXMuZnJvbU91dHNpZGUpKX0pO2lmKCh0aGlzLmZyb21PdXRzaWRlfHx0aGlzLmRvbVBvc2l0aW9uLnByZXYhPXRoaXMuY3VycmVudEl0ZW0ucHJldigpLm5vdChcIi51aS1zb3J0YWJsZS1oZWxwZXJcIilbMF18fHRoaXMuZG9tUG9zaXRpb24ucGFyZW50IT10aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpWzBdKSYmIWMpZS5wdXNoKGZ1bmN0aW9uKGcpe3RoaXMuX3RyaWdnZXIoXCJ1cGRhdGVcIixnLHRoaXMuX3VpSGFzaCgpKX0pO2lmKCFhLnVpLmNvbnRhaW5zKHRoaXMuZWxlbWVudFswXSx0aGlzLmN1cnJlbnRJdGVtWzBdKSl7Y3x8ZS5wdXNoKGZ1bmN0aW9uKGcpe3RoaXMuX3RyaWdnZXIoXCJyZW1vdmVcIixcbmcsdGhpcy5fdWlIYXNoKCkpfSk7Zm9yKGg9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2g+PTA7aC0tKWlmKGEudWkuY29udGFpbnModGhpcy5jb250YWluZXJzW2hdLmVsZW1lbnRbMF0sdGhpcy5jdXJyZW50SXRlbVswXSkmJiFjKXtlLnB1c2goZnVuY3Rpb24oZyl7cmV0dXJuIGZ1bmN0aW9uKGkpe2cuX3RyaWdnZXIoXCJyZWNlaXZlXCIsaSx0aGlzLl91aUhhc2godGhpcykpfX0uY2FsbCh0aGlzLHRoaXMuY29udGFpbmVyc1toXSkpO2UucHVzaChmdW5jdGlvbihnKXtyZXR1cm4gZnVuY3Rpb24oaSl7Zy5fdHJpZ2dlcihcInVwZGF0ZVwiLGksdGhpcy5fdWlIYXNoKHRoaXMpKX19LmNhbGwodGhpcyx0aGlzLmNvbnRhaW5lcnNbaF0pKX19Zm9yKGg9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2g+PTA7aC0tKXtjfHxlLnB1c2goZnVuY3Rpb24oZyl7cmV0dXJuIGZ1bmN0aW9uKGkpe2cuX3RyaWdnZXIoXCJkZWFjdGl2YXRlXCIsaSx0aGlzLl91aUhhc2godGhpcykpfX0uY2FsbCh0aGlzLFxudGhpcy5jb250YWluZXJzW2hdKSk7aWYodGhpcy5jb250YWluZXJzW2hdLmNvbnRhaW5lckNhY2hlLm92ZXIpe2UucHVzaChmdW5jdGlvbihnKXtyZXR1cm4gZnVuY3Rpb24oaSl7Zy5fdHJpZ2dlcihcIm91dFwiLGksdGhpcy5fdWlIYXNoKHRoaXMpKX19LmNhbGwodGhpcyx0aGlzLmNvbnRhaW5lcnNbaF0pKTt0aGlzLmNvbnRhaW5lcnNbaF0uY29udGFpbmVyQ2FjaGUub3Zlcj0wfX10aGlzLl9zdG9yZWRDdXJzb3ImJmEoXCJib2R5XCIpLmNzcyhcImN1cnNvclwiLHRoaXMuX3N0b3JlZEN1cnNvcik7dGhpcy5fc3RvcmVkT3BhY2l0eSYmdGhpcy5oZWxwZXIuY3NzKFwib3BhY2l0eVwiLHRoaXMuX3N0b3JlZE9wYWNpdHkpO2lmKHRoaXMuX3N0b3JlZFpJbmRleCl0aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIix0aGlzLl9zdG9yZWRaSW5kZXg9PVwiYXV0b1wiP1wiXCI6dGhpcy5fc3RvcmVkWkluZGV4KTt0aGlzLmRyYWdnaW5nPWZhbHNlO2lmKHRoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbCl7aWYoIWMpe3RoaXMuX3RyaWdnZXIoXCJiZWZvcmVTdG9wXCIsXG5kLHRoaXMuX3VpSGFzaCgpKTtmb3IoaD0wO2g8ZS5sZW5ndGg7aCsrKWVbaF0uY2FsbCh0aGlzLGQpO3RoaXMuX3RyaWdnZXIoXCJzdG9wXCIsZCx0aGlzLl91aUhhc2goKSl9cmV0dXJuIGZhbHNlfWN8fHRoaXMuX3RyaWdnZXIoXCJiZWZvcmVTdG9wXCIsZCx0aGlzLl91aUhhc2goKSk7dGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pO3RoaXMuaGVscGVyWzBdIT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLmhlbHBlci5yZW1vdmUoKTt0aGlzLmhlbHBlcj1udWxsO2lmKCFjKXtmb3IoaD0wO2g8ZS5sZW5ndGg7aCsrKWVbaF0uY2FsbCh0aGlzLGQpO3RoaXMuX3RyaWdnZXIoXCJzdG9wXCIsZCx0aGlzLl91aUhhc2goKSl9dGhpcy5mcm9tT3V0c2lkZT1mYWxzZTtyZXR1cm4gdHJ1ZX0sX3RyaWdnZXI6ZnVuY3Rpb24oKXthLldpZGdldC5wcm90b3R5cGUuX3RyaWdnZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpPT09ZmFsc2UmJnRoaXMuY2FuY2VsKCl9LFxuX3VpSGFzaDpmdW5jdGlvbihkKXt2YXIgYz1kfHx0aGlzO3JldHVybntoZWxwZXI6Yy5oZWxwZXIscGxhY2Vob2xkZXI6Yy5wbGFjZWhvbGRlcnx8YShbXSkscG9zaXRpb246Yy5wb3NpdGlvbixvcmlnaW5hbFBvc2l0aW9uOmMub3JpZ2luYWxQb3NpdGlvbixvZmZzZXQ6Yy5wb3NpdGlvbkFicyxpdGVtOmMuY3VycmVudEl0ZW0sc2VuZGVyOmQ/ZC5lbGVtZW50Om51bGx9fX0pO2EuZXh0ZW5kKGEudWkuc29ydGFibGUse3ZlcnNpb246XCIxLjguMTZcIn0pfSkoalF1ZXJ5KTtcbmpRdWVyeS5lZmZlY3RzfHxmdW5jdGlvbihhLGQpe2Z1bmN0aW9uIGMobil7dmFyIGs7aWYobiYmbi5jb25zdHJ1Y3Rvcj09QXJyYXkmJm4ubGVuZ3RoPT0zKXJldHVybiBuO2lmKGs9L3JnYlxcKFxccyooWzAtOV17MSwzfSlcXHMqLFxccyooWzAtOV17MSwzfSlcXHMqLFxccyooWzAtOV17MSwzfSlcXHMqXFwpLy5leGVjKG4pKXJldHVybltwYXJzZUludChrWzFdLDEwKSxwYXJzZUludChrWzJdLDEwKSxwYXJzZUludChrWzNdLDEwKV07aWYoaz0vcmdiXFwoXFxzKihbMC05XSsoPzpcXC5bMC05XSspPylcXCVcXHMqLFxccyooWzAtOV0rKD86XFwuWzAtOV0rKT8pXFwlXFxzKixcXHMqKFswLTldKyg/OlxcLlswLTldKyk/KVxcJVxccypcXCkvLmV4ZWMobikpcmV0dXJuW3BhcnNlRmxvYXQoa1sxXSkqMi41NSxwYXJzZUZsb2F0KGtbMl0pKjIuNTUscGFyc2VGbG9hdChrWzNdKSoyLjU1XTtpZihrPS8jKFthLWZBLUYwLTldezJ9KShbYS1mQS1GMC05XXsyfSkoW2EtZkEtRjAtOV17Mn0pLy5leGVjKG4pKXJldHVybltwYXJzZUludChrWzFdLFxuMTYpLHBhcnNlSW50KGtbMl0sMTYpLHBhcnNlSW50KGtbM10sMTYpXTtpZihrPS8jKFthLWZBLUYwLTldKShbYS1mQS1GMC05XSkoW2EtZkEtRjAtOV0pLy5leGVjKG4pKXJldHVybltwYXJzZUludChrWzFdK2tbMV0sMTYpLHBhcnNlSW50KGtbMl0ra1syXSwxNikscGFyc2VJbnQoa1szXStrWzNdLDE2KV07aWYoL3JnYmFcXCgwLCAwLCAwLCAwXFwpLy5leGVjKG4pKXJldHVybiBqLnRyYW5zcGFyZW50O3JldHVybiBqW2EudHJpbShuKS50b0xvd2VyQ2FzZSgpXX1mdW5jdGlvbiBlKG4sayl7dmFyIG07ZG97bT1hLmN1ckNTUyhuLGspO2lmKG0hPVwiXCImJm0hPVwidHJhbnNwYXJlbnRcInx8YS5ub2RlTmFtZShuLFwiYm9keVwiKSlicmVhaztrPVwiYmFja2dyb3VuZENvbG9yXCJ9d2hpbGUobj1uLnBhcmVudE5vZGUpO3JldHVybiBjKG0pfWZ1bmN0aW9uIGgoKXt2YXIgbj1kb2N1bWVudC5kZWZhdWx0Vmlldz9kb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKHRoaXMsbnVsbCk6dGhpcy5jdXJyZW50U3R5bGUsXG5rPXt9LG0scDtpZihuJiZuLmxlbmd0aCYmblswXSYmbltuWzBdXSlmb3IodmFyIHE9bi5sZW5ndGg7cS0tOyl7bT1uW3FdO2lmKHR5cGVvZiBuW21dPT1cInN0cmluZ1wiKXtwPW0ucmVwbGFjZSgvXFwtKFxcdykvZyxmdW5jdGlvbihzLHIpe3JldHVybiByLnRvVXBwZXJDYXNlKCl9KTtrW3BdPW5bbV19fWVsc2UgZm9yKG0gaW4gbilpZih0eXBlb2YgblttXT09PVwic3RyaW5nXCIpa1ttXT1uW21dO3JldHVybiBrfWZ1bmN0aW9uIGcobil7dmFyIGssbTtmb3IoayBpbiBuKXttPW5ba107aWYobT09bnVsbHx8YS5pc0Z1bmN0aW9uKG0pfHxrIGluIG98fC9zY3JvbGxiYXIvLnRlc3Qoayl8fCEvY29sb3IvaS50ZXN0KGspJiZpc05hTihwYXJzZUZsb2F0KG0pKSlkZWxldGUgbltrXX1yZXR1cm4gbn1mdW5jdGlvbiBpKG4sayl7dmFyIG09e186MH0scDtmb3IocCBpbiBrKWlmKG5bcF0hPWtbcF0pbVtwXT1rW3BdO3JldHVybiBtfWZ1bmN0aW9uIGIobixrLG0scCl7aWYodHlwZW9mIG49PVwib2JqZWN0XCIpe3A9XG5rO209bnVsbDtrPW47bj1rLmVmZmVjdH1pZihhLmlzRnVuY3Rpb24oaykpe3A9azttPW51bGw7az17fX1pZih0eXBlb2Ygaz09XCJudW1iZXJcInx8YS5meC5zcGVlZHNba10pe3A9bTttPWs7az17fX1pZihhLmlzRnVuY3Rpb24obSkpe3A9bTttPW51bGx9az1rfHx7fTttPW18fGsuZHVyYXRpb247bT1hLmZ4Lm9mZj8wOnR5cGVvZiBtPT1cIm51bWJlclwiP206bSBpbiBhLmZ4LnNwZWVkcz9hLmZ4LnNwZWVkc1ttXTphLmZ4LnNwZWVkcy5fZGVmYXVsdDtwPXB8fGsuY29tcGxldGU7cmV0dXJuW24sayxtLHBdfWZ1bmN0aW9uIGYobil7aWYoIW58fHR5cGVvZiBuPT09XCJudW1iZXJcInx8YS5meC5zcGVlZHNbbl0pcmV0dXJuIHRydWU7aWYodHlwZW9mIG49PT1cInN0cmluZ1wiJiYhYS5lZmZlY3RzW25dKXJldHVybiB0cnVlO3JldHVybiBmYWxzZX1hLmVmZmVjdHM9e307YS5lYWNoKFtcImJhY2tncm91bmRDb2xvclwiLFwiYm9yZGVyQm90dG9tQ29sb3JcIixcImJvcmRlckxlZnRDb2xvclwiLFwiYm9yZGVyUmlnaHRDb2xvclwiLFxuXCJib3JkZXJUb3BDb2xvclwiLFwiYm9yZGVyQ29sb3JcIixcImNvbG9yXCIsXCJvdXRsaW5lQ29sb3JcIl0sZnVuY3Rpb24obixrKXthLmZ4LnN0ZXBba109ZnVuY3Rpb24obSl7aWYoIW0uY29sb3JJbml0KXttLnN0YXJ0PWUobS5lbGVtLGspO20uZW5kPWMobS5lbmQpO20uY29sb3JJbml0PXRydWV9bS5lbGVtLnN0eWxlW2tdPVwicmdiKFwiK01hdGgubWF4KE1hdGgubWluKHBhcnNlSW50KG0ucG9zKihtLmVuZFswXS1tLnN0YXJ0WzBdKSttLnN0YXJ0WzBdLDEwKSwyNTUpLDApK1wiLFwiK01hdGgubWF4KE1hdGgubWluKHBhcnNlSW50KG0ucG9zKihtLmVuZFsxXS1tLnN0YXJ0WzFdKSttLnN0YXJ0WzFdLDEwKSwyNTUpLDApK1wiLFwiK01hdGgubWF4KE1hdGgubWluKHBhcnNlSW50KG0ucG9zKihtLmVuZFsyXS1tLnN0YXJ0WzJdKSttLnN0YXJ0WzJdLDEwKSwyNTUpLDApK1wiKVwifX0pO3ZhciBqPXthcXVhOlswLDI1NSwyNTVdLGF6dXJlOlsyNDAsMjU1LDI1NV0sYmVpZ2U6WzI0NSwyNDUsMjIwXSxibGFjazpbMCxcbjAsMF0sYmx1ZTpbMCwwLDI1NV0sYnJvd246WzE2NSw0Miw0Ml0sY3lhbjpbMCwyNTUsMjU1XSxkYXJrYmx1ZTpbMCwwLDEzOV0sZGFya2N5YW46WzAsMTM5LDEzOV0sZGFya2dyZXk6WzE2OSwxNjksMTY5XSxkYXJrZ3JlZW46WzAsMTAwLDBdLGRhcmtraGFraTpbMTg5LDE4MywxMDddLGRhcmttYWdlbnRhOlsxMzksMCwxMzldLGRhcmtvbGl2ZWdyZWVuOls4NSwxMDcsNDddLGRhcmtvcmFuZ2U6WzI1NSwxNDAsMF0sZGFya29yY2hpZDpbMTUzLDUwLDIwNF0sZGFya3JlZDpbMTM5LDAsMF0sZGFya3NhbG1vbjpbMjMzLDE1MCwxMjJdLGRhcmt2aW9sZXQ6WzE0OCwwLDIxMV0sZnVjaHNpYTpbMjU1LDAsMjU1XSxnb2xkOlsyNTUsMjE1LDBdLGdyZWVuOlswLDEyOCwwXSxpbmRpZ286Wzc1LDAsMTMwXSxraGFraTpbMjQwLDIzMCwxNDBdLGxpZ2h0Ymx1ZTpbMTczLDIxNiwyMzBdLGxpZ2h0Y3lhbjpbMjI0LDI1NSwyNTVdLGxpZ2h0Z3JlZW46WzE0NCwyMzgsMTQ0XSxsaWdodGdyZXk6WzIxMSxcbjIxMSwyMTFdLGxpZ2h0cGluazpbMjU1LDE4MiwxOTNdLGxpZ2h0eWVsbG93OlsyNTUsMjU1LDIyNF0sbGltZTpbMCwyNTUsMF0sbWFnZW50YTpbMjU1LDAsMjU1XSxtYXJvb246WzEyOCwwLDBdLG5hdnk6WzAsMCwxMjhdLG9saXZlOlsxMjgsMTI4LDBdLG9yYW5nZTpbMjU1LDE2NSwwXSxwaW5rOlsyNTUsMTkyLDIwM10scHVycGxlOlsxMjgsMCwxMjhdLHZpb2xldDpbMTI4LDAsMTI4XSxyZWQ6WzI1NSwwLDBdLHNpbHZlcjpbMTkyLDE5MiwxOTJdLHdoaXRlOlsyNTUsMjU1LDI1NV0seWVsbG93OlsyNTUsMjU1LDBdLHRyYW5zcGFyZW50OlsyNTUsMjU1LDI1NV19LGw9W1wiYWRkXCIsXCJyZW1vdmVcIixcInRvZ2dsZVwiXSxvPXtib3JkZXI6MSxib3JkZXJCb3R0b206MSxib3JkZXJDb2xvcjoxLGJvcmRlckxlZnQ6MSxib3JkZXJSaWdodDoxLGJvcmRlclRvcDoxLGJvcmRlcldpZHRoOjEsbWFyZ2luOjEscGFkZGluZzoxfTthLmVmZmVjdHMuYW5pbWF0ZUNsYXNzPWZ1bmN0aW9uKG4sayxtLFxucCl7aWYoYS5pc0Z1bmN0aW9uKG0pKXtwPW07bT1udWxsfXJldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIHE9YSh0aGlzKSxzPXEuYXR0cihcInN0eWxlXCIpfHxcIiBcIixyPWcoaC5jYWxsKHRoaXMpKSx1LHY9cS5hdHRyKFwiY2xhc3NcIik7YS5lYWNoKGwsZnVuY3Rpb24odyx4KXtuW3hdJiZxW3grXCJDbGFzc1wiXShuW3hdKX0pO3U9ZyhoLmNhbGwodGhpcykpO3EuYXR0cihcImNsYXNzXCIsdik7cS5hbmltYXRlKGkocix1KSx7cXVldWU6ZmFsc2UsZHVyYXRpb246ayxlYXNpbmc6bSxjb21wbGV0ZTpmdW5jdGlvbigpe2EuZWFjaChsLGZ1bmN0aW9uKHcseCl7blt4XSYmcVt4K1wiQ2xhc3NcIl0oblt4XSl9KTtpZih0eXBlb2YgcS5hdHRyKFwic3R5bGVcIik9PVwib2JqZWN0XCIpe3EuYXR0cihcInN0eWxlXCIpLmNzc1RleHQ9XCJcIjtxLmF0dHIoXCJzdHlsZVwiKS5jc3NUZXh0PXN9ZWxzZSBxLmF0dHIoXCJzdHlsZVwiLHMpO3AmJnAuYXBwbHkodGhpcyxhcmd1bWVudHMpO2EuZGVxdWV1ZSh0aGlzKX19KX0pfTtcbmEuZm4uZXh0ZW5kKHtfYWRkQ2xhc3M6YS5mbi5hZGRDbGFzcyxhZGRDbGFzczpmdW5jdGlvbihuLGssbSxwKXtyZXR1cm4gaz9hLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmFwcGx5KHRoaXMsW3thZGQ6bn0sayxtLHBdKTp0aGlzLl9hZGRDbGFzcyhuKX0sX3JlbW92ZUNsYXNzOmEuZm4ucmVtb3ZlQ2xhc3MscmVtb3ZlQ2xhc3M6ZnVuY3Rpb24obixrLG0scCl7cmV0dXJuIGs/YS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5hcHBseSh0aGlzLFt7cmVtb3ZlOm59LGssbSxwXSk6dGhpcy5fcmVtb3ZlQ2xhc3Mobil9LF90b2dnbGVDbGFzczphLmZuLnRvZ2dsZUNsYXNzLHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuIHR5cGVvZiBrPT1cImJvb2xlYW5cInx8az09PWQ/bT9hLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmFwcGx5KHRoaXMsW2s/e2FkZDpufTp7cmVtb3ZlOm59LG0scCxxXSk6dGhpcy5fdG9nZ2xlQ2xhc3MobixrKTphLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmFwcGx5KHRoaXMsXG5be3RvZ2dsZTpufSxrLG0scF0pfSxzd2l0Y2hDbGFzczpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybiBhLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmFwcGx5KHRoaXMsW3thZGQ6ayxyZW1vdmU6bn0sbSxwLHFdKX19KTthLmV4dGVuZChhLmVmZmVjdHMse3ZlcnNpb246XCIxLjguMTZcIixzYXZlOmZ1bmN0aW9uKG4sayl7Zm9yKHZhciBtPTA7bTxrLmxlbmd0aDttKyspa1ttXSE9PW51bGwmJm4uZGF0YShcImVjLnN0b3JhZ2UuXCIra1ttXSxuWzBdLnN0eWxlW2tbbV1dKX0scmVzdG9yZTpmdW5jdGlvbihuLGspe2Zvcih2YXIgbT0wO208ay5sZW5ndGg7bSsrKWtbbV0hPT1udWxsJiZuLmNzcyhrW21dLG4uZGF0YShcImVjLnN0b3JhZ2UuXCIra1ttXSkpfSxzZXRNb2RlOmZ1bmN0aW9uKG4sayl7aWYoaz09XCJ0b2dnbGVcIilrPW4uaXMoXCI6aGlkZGVuXCIpP1wic2hvd1wiOlwiaGlkZVwiO3JldHVybiBrfSxnZXRCYXNlbGluZTpmdW5jdGlvbihuLGspe3ZhciBtO3N3aXRjaChuWzBdKXtjYXNlIFwidG9wXCI6bT1cbjA7YnJlYWs7Y2FzZSBcIm1pZGRsZVwiOm09MC41O2JyZWFrO2Nhc2UgXCJib3R0b21cIjptPTE7YnJlYWs7ZGVmYXVsdDptPW5bMF0vay5oZWlnaHR9c3dpdGNoKG5bMV0pe2Nhc2UgXCJsZWZ0XCI6bj0wO2JyZWFrO2Nhc2UgXCJjZW50ZXJcIjpuPTAuNTticmVhaztjYXNlIFwicmlnaHRcIjpuPTE7YnJlYWs7ZGVmYXVsdDpuPW5bMV0vay53aWR0aH1yZXR1cm57eDpuLHk6bX19LGNyZWF0ZVdyYXBwZXI6ZnVuY3Rpb24obil7aWYobi5wYXJlbnQoKS5pcyhcIi51aS1lZmZlY3RzLXdyYXBwZXJcIikpcmV0dXJuIG4ucGFyZW50KCk7dmFyIGs9e3dpZHRoOm4ub3V0ZXJXaWR0aCh0cnVlKSxoZWlnaHQ6bi5vdXRlckhlaWdodCh0cnVlKSxcImZsb2F0XCI6bi5jc3MoXCJmbG9hdFwiKX0sbT1hKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJ1aS1lZmZlY3RzLXdyYXBwZXJcIikuY3NzKHtmb250U2l6ZTpcIjEwMCVcIixiYWNrZ3JvdW5kOlwidHJhbnNwYXJlbnRcIixib3JkZXI6XCJub25lXCIsbWFyZ2luOjAscGFkZGluZzowfSksXG5wPWRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7bi53cmFwKG0pO2lmKG5bMF09PT1wfHxhLmNvbnRhaW5zKG5bMF0scCkpYShwKS5mb2N1cygpO209bi5wYXJlbnQoKTtpZihuLmNzcyhcInBvc2l0aW9uXCIpPT1cInN0YXRpY1wiKXttLmNzcyh7cG9zaXRpb246XCJyZWxhdGl2ZVwifSk7bi5jc3Moe3Bvc2l0aW9uOlwicmVsYXRpdmVcIn0pfWVsc2V7YS5leHRlbmQoayx7cG9zaXRpb246bi5jc3MoXCJwb3NpdGlvblwiKSx6SW5kZXg6bi5jc3MoXCJ6LWluZGV4XCIpfSk7YS5lYWNoKFtcInRvcFwiLFwibGVmdFwiLFwiYm90dG9tXCIsXCJyaWdodFwiXSxmdW5jdGlvbihxLHMpe2tbc109bi5jc3Mocyk7aWYoaXNOYU4ocGFyc2VJbnQoa1tzXSwxMCkpKWtbc109XCJhdXRvXCJ9KTtuLmNzcyh7cG9zaXRpb246XCJyZWxhdGl2ZVwiLHRvcDowLGxlZnQ6MCxyaWdodDpcImF1dG9cIixib3R0b206XCJhdXRvXCJ9KX1yZXR1cm4gbS5jc3Moaykuc2hvdygpfSxyZW1vdmVXcmFwcGVyOmZ1bmN0aW9uKG4pe3ZhciBrLG09ZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbmlmKG4ucGFyZW50KCkuaXMoXCIudWktZWZmZWN0cy13cmFwcGVyXCIpKXtrPW4ucGFyZW50KCkucmVwbGFjZVdpdGgobik7aWYoblswXT09PW18fGEuY29udGFpbnMoblswXSxtKSlhKG0pLmZvY3VzKCk7cmV0dXJuIGt9cmV0dXJuIG59LHNldFRyYW5zaXRpb246ZnVuY3Rpb24obixrLG0scCl7cD1wfHx7fTthLmVhY2goayxmdW5jdGlvbihxLHMpe3VuaXQ9bi5jc3NVbml0KHMpO2lmKHVuaXRbMF0+MClwW3NdPXVuaXRbMF0qbSt1bml0WzFdfSk7cmV0dXJuIHB9fSk7YS5mbi5leHRlbmQoe2VmZmVjdDpmdW5jdGlvbihuKXt2YXIgaz1iLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxtPXtvcHRpb25zOmtbMV0sZHVyYXRpb246a1syXSxjYWxsYmFjazprWzNdfTtrPW0ub3B0aW9ucy5tb2RlO3ZhciBwPWEuZWZmZWN0c1tuXTtpZihhLmZ4Lm9mZnx8IXApcmV0dXJuIGs/dGhpc1trXShtLmR1cmF0aW9uLG0uY2FsbGJhY2spOnRoaXMuZWFjaChmdW5jdGlvbigpe20uY2FsbGJhY2smJm0uY2FsbGJhY2suY2FsbCh0aGlzKX0pO1xucmV0dXJuIHAuY2FsbCh0aGlzLG0pfSxfc2hvdzphLmZuLnNob3csc2hvdzpmdW5jdGlvbihuKXtpZihmKG4pKXJldHVybiB0aGlzLl9zaG93LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtlbHNle3ZhciBrPWIuYXBwbHkodGhpcyxhcmd1bWVudHMpO2tbMV0ubW9kZT1cInNob3dcIjtyZXR1cm4gdGhpcy5lZmZlY3QuYXBwbHkodGhpcyxrKX19LF9oaWRlOmEuZm4uaGlkZSxoaWRlOmZ1bmN0aW9uKG4pe2lmKGYobikpcmV0dXJuIHRoaXMuX2hpZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO2Vsc2V7dmFyIGs9Yi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7a1sxXS5tb2RlPVwiaGlkZVwiO3JldHVybiB0aGlzLmVmZmVjdC5hcHBseSh0aGlzLGspfX0sX190b2dnbGU6YS5mbi50b2dnbGUsdG9nZ2xlOmZ1bmN0aW9uKG4pe2lmKGYobil8fHR5cGVvZiBuPT09XCJib29sZWFuXCJ8fGEuaXNGdW5jdGlvbihuKSlyZXR1cm4gdGhpcy5fX3RvZ2dsZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7ZWxzZXt2YXIgaz1iLmFwcGx5KHRoaXMsXG5hcmd1bWVudHMpO2tbMV0ubW9kZT1cInRvZ2dsZVwiO3JldHVybiB0aGlzLmVmZmVjdC5hcHBseSh0aGlzLGspfX0sY3NzVW5pdDpmdW5jdGlvbihuKXt2YXIgaz10aGlzLmNzcyhuKSxtPVtdO2EuZWFjaChbXCJlbVwiLFwicHhcIixcIiVcIixcInB0XCJdLGZ1bmN0aW9uKHAscSl7aWYoay5pbmRleE9mKHEpPjApbT1bcGFyc2VGbG9hdChrKSxxXX0pO3JldHVybiBtfX0pO2EuZWFzaW5nLmpzd2luZz1hLmVhc2luZy5zd2luZzthLmV4dGVuZChhLmVhc2luZyx7ZGVmOlwiZWFzZU91dFF1YWRcIixzd2luZzpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybiBhLmVhc2luZ1thLmVhc2luZy5kZWZdKG4sayxtLHAscSl9LGVhc2VJblF1YWQ6ZnVuY3Rpb24obixrLG0scCxxKXtyZXR1cm4gcCooay89cSkqayttfSxlYXNlT3V0UXVhZDpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybi1wKihrLz1xKSooay0yKSttfSxlYXNlSW5PdXRRdWFkOmZ1bmN0aW9uKG4sayxtLHAscSl7aWYoKGsvPXEvMik8MSlyZXR1cm4gcC9cbjIqayprK207cmV0dXJuLXAvMiooLS1rKihrLTIpLTEpK219LGVhc2VJbkN1YmljOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuIHAqKGsvPXEpKmsqayttfSxlYXNlT3V0Q3ViaWM6ZnVuY3Rpb24obixrLG0scCxxKXtyZXR1cm4gcCooKGs9ay9xLTEpKmsqaysxKSttfSxlYXNlSW5PdXRDdWJpYzpmdW5jdGlvbihuLGssbSxwLHEpe2lmKChrLz1xLzIpPDEpcmV0dXJuIHAvMiprKmsqayttO3JldHVybiBwLzIqKChrLT0yKSprKmsrMikrbX0sZWFzZUluUXVhcnQ6ZnVuY3Rpb24obixrLG0scCxxKXtyZXR1cm4gcCooay89cSkqayprKmsrbX0sZWFzZU91dFF1YXJ0OmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuLXAqKChrPWsvcS0xKSprKmsqay0xKSttfSxlYXNlSW5PdXRRdWFydDpmdW5jdGlvbihuLGssbSxwLHEpe2lmKChrLz1xLzIpPDEpcmV0dXJuIHAvMiprKmsqayprK207cmV0dXJuLXAvMiooKGstPTIpKmsqayprLTIpK219LGVhc2VJblF1aW50OmZ1bmN0aW9uKG4sayxtLFxucCxxKXtyZXR1cm4gcCooay89cSkqayprKmsqayttfSxlYXNlT3V0UXVpbnQ6ZnVuY3Rpb24obixrLG0scCxxKXtyZXR1cm4gcCooKGs9ay9xLTEpKmsqayprKmsrMSkrbX0sZWFzZUluT3V0UXVpbnQ6ZnVuY3Rpb24obixrLG0scCxxKXtpZigoay89cS8yKTwxKXJldHVybiBwLzIqayprKmsqayprK207cmV0dXJuIHAvMiooKGstPTIpKmsqayprKmsrMikrbX0sZWFzZUluU2luZTpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybi1wKk1hdGguY29zKGsvcSooTWF0aC5QSS8yKSkrcCttfSxlYXNlT3V0U2luZTpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybiBwKk1hdGguc2luKGsvcSooTWF0aC5QSS8yKSkrbX0sZWFzZUluT3V0U2luZTpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybi1wLzIqKE1hdGguY29zKE1hdGguUEkqay9xKS0xKSttfSxlYXNlSW5FeHBvOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuIGs9PTA/bTpwKk1hdGgucG93KDIsMTAqKGsvcS0xKSkrbX0sZWFzZU91dEV4cG86ZnVuY3Rpb24obixcbmssbSxwLHEpe3JldHVybiBrPT1xP20rcDpwKigtTWF0aC5wb3coMiwtMTAqay9xKSsxKSttfSxlYXNlSW5PdXRFeHBvOmZ1bmN0aW9uKG4sayxtLHAscSl7aWYoaz09MClyZXR1cm4gbTtpZihrPT1xKXJldHVybiBtK3A7aWYoKGsvPXEvMik8MSlyZXR1cm4gcC8yKk1hdGgucG93KDIsMTAqKGstMSkpK207cmV0dXJuIHAvMiooLU1hdGgucG93KDIsLTEwKi0taykrMikrbX0sZWFzZUluQ2lyYzpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybi1wKihNYXRoLnNxcnQoMS0oay89cSkqayktMSkrbX0sZWFzZU91dENpcmM6ZnVuY3Rpb24obixrLG0scCxxKXtyZXR1cm4gcCpNYXRoLnNxcnQoMS0oaz1rL3EtMSkqaykrbX0sZWFzZUluT3V0Q2lyYzpmdW5jdGlvbihuLGssbSxwLHEpe2lmKChrLz1xLzIpPDEpcmV0dXJuLXAvMiooTWF0aC5zcXJ0KDEtayprKS0xKSttO3JldHVybiBwLzIqKE1hdGguc3FydCgxLShrLT0yKSprKSsxKSttfSxlYXNlSW5FbGFzdGljOmZ1bmN0aW9uKG4sayxtLFxucCxxKXtuPTEuNzAxNTg7dmFyIHM9MCxyPXA7aWYoaz09MClyZXR1cm4gbTtpZigoay89cSk9PTEpcmV0dXJuIG0rcDtzfHwocz1xKjAuMyk7aWYocjxNYXRoLmFicyhwKSl7cj1wO249cy80fWVsc2Ugbj1zLygyKk1hdGguUEkpKk1hdGguYXNpbihwL3IpO3JldHVybi0ocipNYXRoLnBvdygyLDEwKihrLT0xKSkqTWF0aC5zaW4oKGsqcS1uKSoyKk1hdGguUEkvcykpK219LGVhc2VPdXRFbGFzdGljOmZ1bmN0aW9uKG4sayxtLHAscSl7bj0xLjcwMTU4O3ZhciBzPTAscj1wO2lmKGs9PTApcmV0dXJuIG07aWYoKGsvPXEpPT0xKXJldHVybiBtK3A7c3x8KHM9cSowLjMpO2lmKHI8TWF0aC5hYnMocCkpe3I9cDtuPXMvNH1lbHNlIG49cy8oMipNYXRoLlBJKSpNYXRoLmFzaW4ocC9yKTtyZXR1cm4gcipNYXRoLnBvdygyLC0xMCprKSpNYXRoLnNpbigoaypxLW4pKjIqTWF0aC5QSS9zKStwK219LGVhc2VJbk91dEVsYXN0aWM6ZnVuY3Rpb24obixrLG0scCxxKXtuPTEuNzAxNTg7dmFyIHM9XG4wLHI9cDtpZihrPT0wKXJldHVybiBtO2lmKChrLz1xLzIpPT0yKXJldHVybiBtK3A7c3x8KHM9cSowLjMqMS41KTtpZihyPE1hdGguYWJzKHApKXtyPXA7bj1zLzR9ZWxzZSBuPXMvKDIqTWF0aC5QSSkqTWF0aC5hc2luKHAvcik7aWYoazwxKXJldHVybi0wLjUqcipNYXRoLnBvdygyLDEwKihrLT0xKSkqTWF0aC5zaW4oKGsqcS1uKSoyKk1hdGguUEkvcykrbTtyZXR1cm4gcipNYXRoLnBvdygyLC0xMCooay09MSkpKk1hdGguc2luKChrKnEtbikqMipNYXRoLlBJL3MpKjAuNStwK219LGVhc2VJbkJhY2s6ZnVuY3Rpb24obixrLG0scCxxLHMpe2lmKHM9PWQpcz0xLjcwMTU4O3JldHVybiBwKihrLz1xKSprKigocysxKSprLXMpK219LGVhc2VPdXRCYWNrOmZ1bmN0aW9uKG4sayxtLHAscSxzKXtpZihzPT1kKXM9MS43MDE1ODtyZXR1cm4gcCooKGs9ay9xLTEpKmsqKChzKzEpKmsrcykrMSkrbX0sZWFzZUluT3V0QmFjazpmdW5jdGlvbihuLGssbSxwLHEscyl7aWYocz09ZClzPTEuNzAxNTg7XG5pZigoay89cS8yKTwxKXJldHVybiBwLzIqayprKigoKHMqPTEuNTI1KSsxKSprLXMpK207cmV0dXJuIHAvMiooKGstPTIpKmsqKCgocyo9MS41MjUpKzEpKmsrcykrMikrbX0sZWFzZUluQm91bmNlOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuIHAtYS5lYXNpbmcuZWFzZU91dEJvdW5jZShuLHEtaywwLHAscSkrbX0sZWFzZU91dEJvdW5jZTpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybihrLz1xKTwxLzIuNzU/cCo3LjU2MjUqayprK206azwyLzIuNzU/cCooNy41NjI1KihrLT0xLjUvMi43NSkqayswLjc1KSttOms8Mi41LzIuNzU/cCooNy41NjI1KihrLT0yLjI1LzIuNzUpKmsrMC45Mzc1KSttOnAqKDcuNTYyNSooay09Mi42MjUvMi43NSkqayswLjk4NDM3NSkrbX0sZWFzZUluT3V0Qm91bmNlOmZ1bmN0aW9uKG4sayxtLHAscSl7aWYoazxxLzIpcmV0dXJuIGEuZWFzaW5nLmVhc2VJbkJvdW5jZShuLGsqMiwwLHAscSkqMC41K207cmV0dXJuIGEuZWFzaW5nLmVhc2VPdXRCb3VuY2UobixcbmsqMi1xLDAscCxxKSowLjUrcCowLjUrbX19KX0oalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLmVmZmVjdHMuYmxpbmQ9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGU9W1wicG9zaXRpb25cIixcInRvcFwiLFwiYm90dG9tXCIsXCJsZWZ0XCIsXCJyaWdodFwiXSxoPWEuZWZmZWN0cy5zZXRNb2RlKGMsZC5vcHRpb25zLm1vZGV8fFwiaGlkZVwiKSxnPWQub3B0aW9ucy5kaXJlY3Rpb258fFwidmVydGljYWxcIjthLmVmZmVjdHMuc2F2ZShjLGUpO2Muc2hvdygpO3ZhciBpPWEuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpLmNzcyh7b3ZlcmZsb3c6XCJoaWRkZW5cIn0pLGI9Zz09XCJ2ZXJ0aWNhbFwiP1wiaGVpZ2h0XCI6XCJ3aWR0aFwiO2c9Zz09XCJ2ZXJ0aWNhbFwiP2kuaGVpZ2h0KCk6aS53aWR0aCgpO2g9PVwic2hvd1wiJiZpLmNzcyhiLDApO3ZhciBmPXt9O2ZbYl09aD09XCJzaG93XCI/ZzowO2kuYW5pbWF0ZShmLGQuZHVyYXRpb24sZC5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2g9PVwiaGlkZVwiJiZjLmhpZGUoKTthLmVmZmVjdHMucmVzdG9yZShjLFxuZSk7YS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyk7ZC5jYWxsYmFjayYmZC5jYWxsYmFjay5hcHBseShjWzBdLGFyZ3VtZW50cyk7Yy5kZXF1ZXVlKCl9KX0pfX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS5lZmZlY3RzLmJvdW5jZT1mdW5jdGlvbihkKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZT1bXCJwb3NpdGlvblwiLFwidG9wXCIsXCJib3R0b21cIixcImxlZnRcIixcInJpZ2h0XCJdLGg9YS5lZmZlY3RzLnNldE1vZGUoYyxkLm9wdGlvbnMubW9kZXx8XCJlZmZlY3RcIiksZz1kLm9wdGlvbnMuZGlyZWN0aW9ufHxcInVwXCIsaT1kLm9wdGlvbnMuZGlzdGFuY2V8fDIwLGI9ZC5vcHRpb25zLnRpbWVzfHw1LGY9ZC5kdXJhdGlvbnx8MjUwOy9zaG93fGhpZGUvLnRlc3QoaCkmJmUucHVzaChcIm9wYWNpdHlcIik7YS5lZmZlY3RzLnNhdmUoYyxlKTtjLnNob3coKTthLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihjKTt2YXIgaj1nPT1cInVwXCJ8fGc9PVwiZG93blwiP1widG9wXCI6XCJsZWZ0XCI7Zz1nPT1cInVwXCJ8fGc9PVwibGVmdFwiP1wicG9zXCI6XCJuZWdcIjtpPWQub3B0aW9ucy5kaXN0YW5jZXx8KGo9PVwidG9wXCI/Yy5vdXRlckhlaWdodCh7bWFyZ2luOnRydWV9KS8zOmMub3V0ZXJXaWR0aCh7bWFyZ2luOnRydWV9KS9cbjMpO2lmKGg9PVwic2hvd1wiKWMuY3NzKFwib3BhY2l0eVwiLDApLmNzcyhqLGc9PVwicG9zXCI/LWk6aSk7aWYoaD09XCJoaWRlXCIpaS89YioyO2ghPVwiaGlkZVwiJiZiLS07aWYoaD09XCJzaG93XCIpe3ZhciBsPXtvcGFjaXR5OjF9O2xbal09KGc9PVwicG9zXCI/XCIrPVwiOlwiLT1cIikraTtjLmFuaW1hdGUobCxmLzIsZC5vcHRpb25zLmVhc2luZyk7aS89MjtiLS19Zm9yKGw9MDtsPGI7bCsrKXt2YXIgbz17fSxuPXt9O29bal09KGc9PVwicG9zXCI/XCItPVwiOlwiKz1cIikraTtuW2pdPShnPT1cInBvc1wiP1wiKz1cIjpcIi09XCIpK2k7Yy5hbmltYXRlKG8sZi8yLGQub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUobixmLzIsZC5vcHRpb25zLmVhc2luZyk7aT1oPT1cImhpZGVcIj9pKjI6aS8yfWlmKGg9PVwiaGlkZVwiKXtsPXtvcGFjaXR5OjB9O2xbal09KGc9PVwicG9zXCI/XCItPVwiOlwiKz1cIikraTtjLmFuaW1hdGUobCxmLzIsZC5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2MuaGlkZSgpO2EuZWZmZWN0cy5yZXN0b3JlKGMsZSk7YS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyk7XG5kLmNhbGxiYWNrJiZkLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pfWVsc2V7bz17fTtuPXt9O29bal09KGc9PVwicG9zXCI/XCItPVwiOlwiKz1cIikraTtuW2pdPShnPT1cInBvc1wiP1wiKz1cIjpcIi09XCIpK2k7Yy5hbmltYXRlKG8sZi8yLGQub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUobixmLzIsZC5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2EuZWZmZWN0cy5yZXN0b3JlKGMsZSk7YS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyk7ZC5jYWxsYmFjayYmZC5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KX1jLnF1ZXVlKFwiZnhcIixmdW5jdGlvbigpe2MuZGVxdWV1ZSgpfSk7Yy5kZXF1ZXVlKCl9KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EuZWZmZWN0cy5jbGlwPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxlPVtcInBvc2l0aW9uXCIsXCJ0b3BcIixcImJvdHRvbVwiLFwibGVmdFwiLFwicmlnaHRcIixcImhlaWdodFwiLFwid2lkdGhcIl0saD1hLmVmZmVjdHMuc2V0TW9kZShjLGQub3B0aW9ucy5tb2RlfHxcImhpZGVcIiksZz1kLm9wdGlvbnMuZGlyZWN0aW9ufHxcInZlcnRpY2FsXCI7YS5lZmZlY3RzLnNhdmUoYyxlKTtjLnNob3coKTt2YXIgaT1hLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihjKS5jc3Moe292ZXJmbG93OlwiaGlkZGVuXCJ9KTtpPWNbMF0udGFnTmFtZT09XCJJTUdcIj9pOmM7dmFyIGI9e3NpemU6Zz09XCJ2ZXJ0aWNhbFwiP1wiaGVpZ2h0XCI6XCJ3aWR0aFwiLHBvc2l0aW9uOmc9PVwidmVydGljYWxcIj9cInRvcFwiOlwibGVmdFwifTtnPWc9PVwidmVydGljYWxcIj9pLmhlaWdodCgpOmkud2lkdGgoKTtpZihoPT1cInNob3dcIil7aS5jc3MoYi5zaXplLDApO2kuY3NzKGIucG9zaXRpb24sXG5nLzIpfXZhciBmPXt9O2ZbYi5zaXplXT1oPT1cInNob3dcIj9nOjA7ZltiLnBvc2l0aW9uXT1oPT1cInNob3dcIj8wOmcvMjtpLmFuaW1hdGUoZix7cXVldWU6ZmFsc2UsZHVyYXRpb246ZC5kdXJhdGlvbixlYXNpbmc6ZC5vcHRpb25zLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2g9PVwiaGlkZVwiJiZjLmhpZGUoKTthLmVmZmVjdHMucmVzdG9yZShjLGUpO2EuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGMpO2QuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkoY1swXSxhcmd1bWVudHMpO2MuZGVxdWV1ZSgpfX0pfSl9fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLmVmZmVjdHMuZHJvcD1mdW5jdGlvbihkKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZT1bXCJwb3NpdGlvblwiLFwidG9wXCIsXCJib3R0b21cIixcImxlZnRcIixcInJpZ2h0XCIsXCJvcGFjaXR5XCJdLGg9YS5lZmZlY3RzLnNldE1vZGUoYyxkLm9wdGlvbnMubW9kZXx8XCJoaWRlXCIpLGc9ZC5vcHRpb25zLmRpcmVjdGlvbnx8XCJsZWZ0XCI7YS5lZmZlY3RzLnNhdmUoYyxlKTtjLnNob3coKTthLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihjKTt2YXIgaT1nPT1cInVwXCJ8fGc9PVwiZG93blwiP1widG9wXCI6XCJsZWZ0XCI7Zz1nPT1cInVwXCJ8fGc9PVwibGVmdFwiP1wicG9zXCI6XCJuZWdcIjt2YXIgYj1kLm9wdGlvbnMuZGlzdGFuY2V8fChpPT1cInRvcFwiP2Mub3V0ZXJIZWlnaHQoe21hcmdpbjp0cnVlfSkvMjpjLm91dGVyV2lkdGgoe21hcmdpbjp0cnVlfSkvMik7aWYoaD09XCJzaG93XCIpYy5jc3MoXCJvcGFjaXR5XCIsMCkuY3NzKGksZz09XCJwb3NcIj8tYjpiKTt2YXIgZj17b3BhY2l0eTpoPT1cblwic2hvd1wiPzE6MH07ZltpXT0oaD09XCJzaG93XCI/Zz09XCJwb3NcIj9cIis9XCI6XCItPVwiOmc9PVwicG9zXCI/XCItPVwiOlwiKz1cIikrYjtjLmFuaW1hdGUoZix7cXVldWU6ZmFsc2UsZHVyYXRpb246ZC5kdXJhdGlvbixlYXNpbmc6ZC5vcHRpb25zLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2g9PVwiaGlkZVwiJiZjLmhpZGUoKTthLmVmZmVjdHMucmVzdG9yZShjLGUpO2EuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGMpO2QuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpO2MuZGVxdWV1ZSgpfX0pfSl9fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLmVmZmVjdHMuZXhwbG9kZT1mdW5jdGlvbihkKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWQub3B0aW9ucy5waWVjZXM/TWF0aC5yb3VuZChNYXRoLnNxcnQoZC5vcHRpb25zLnBpZWNlcykpOjMsZT1kLm9wdGlvbnMucGllY2VzP01hdGgucm91bmQoTWF0aC5zcXJ0KGQub3B0aW9ucy5waWVjZXMpKTozO2Qub3B0aW9ucy5tb2RlPWQub3B0aW9ucy5tb2RlPT1cInRvZ2dsZVwiP2EodGhpcykuaXMoXCI6dmlzaWJsZVwiKT9cImhpZGVcIjpcInNob3dcIjpkLm9wdGlvbnMubW9kZTt2YXIgaD1hKHRoaXMpLnNob3coKS5jc3MoXCJ2aXNpYmlsaXR5XCIsXCJoaWRkZW5cIiksZz1oLm9mZnNldCgpO2cudG9wLT1wYXJzZUludChoLmNzcyhcIm1hcmdpblRvcFwiKSwxMCl8fDA7Zy5sZWZ0LT1wYXJzZUludChoLmNzcyhcIm1hcmdpbkxlZnRcIiksMTApfHwwO2Zvcih2YXIgaT1oLm91dGVyV2lkdGgodHJ1ZSksYj1oLm91dGVySGVpZ2h0KHRydWUpLGY9MDtmPGM7ZisrKWZvcih2YXIgaj1cbjA7ajxlO2orKyloLmNsb25lKCkuYXBwZW5kVG8oXCJib2R5XCIpLndyYXAoXCI8ZGl2PjwvZGl2PlwiKS5jc3Moe3Bvc2l0aW9uOlwiYWJzb2x1dGVcIix2aXNpYmlsaXR5OlwidmlzaWJsZVwiLGxlZnQ6LWoqKGkvZSksdG9wOi1mKihiL2MpfSkucGFyZW50KCkuYWRkQ2xhc3MoXCJ1aS1lZmZlY3RzLWV4cGxvZGVcIikuY3NzKHtwb3NpdGlvbjpcImFic29sdXRlXCIsb3ZlcmZsb3c6XCJoaWRkZW5cIix3aWR0aDppL2UsaGVpZ2h0OmIvYyxsZWZ0OmcubGVmdCtqKihpL2UpKyhkLm9wdGlvbnMubW9kZT09XCJzaG93XCI/KGotTWF0aC5mbG9vcihlLzIpKSooaS9lKTowKSx0b3A6Zy50b3ArZiooYi9jKSsoZC5vcHRpb25zLm1vZGU9PVwic2hvd1wiPyhmLU1hdGguZmxvb3IoYy8yKSkqKGIvYyk6MCksb3BhY2l0eTpkLm9wdGlvbnMubW9kZT09XCJzaG93XCI/MDoxfSkuYW5pbWF0ZSh7bGVmdDpnLmxlZnQraiooaS9lKSsoZC5vcHRpb25zLm1vZGU9PVwic2hvd1wiPzA6KGotTWF0aC5mbG9vcihlLzIpKSooaS9lKSksdG9wOmcudG9wK1xuZiooYi9jKSsoZC5vcHRpb25zLm1vZGU9PVwic2hvd1wiPzA6KGYtTWF0aC5mbG9vcihjLzIpKSooYi9jKSksb3BhY2l0eTpkLm9wdGlvbnMubW9kZT09XCJzaG93XCI/MTowfSxkLmR1cmF0aW9ufHw1MDApO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtkLm9wdGlvbnMubW9kZT09XCJzaG93XCI/aC5jc3Moe3Zpc2liaWxpdHk6XCJ2aXNpYmxlXCJ9KTpoLmNzcyh7dmlzaWJpbGl0eTpcInZpc2libGVcIn0pLmhpZGUoKTtkLmNhbGxiYWNrJiZkLmNhbGxiYWNrLmFwcGx5KGhbMF0pO2guZGVxdWV1ZSgpO2EoXCJkaXYudWktZWZmZWN0cy1leHBsb2RlXCIpLnJlbW92ZSgpfSxkLmR1cmF0aW9ufHw1MDApfSl9fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLmVmZmVjdHMuZmFkZT1mdW5jdGlvbihkKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZT1hLmVmZmVjdHMuc2V0TW9kZShjLGQub3B0aW9ucy5tb2RlfHxcImhpZGVcIik7Yy5hbmltYXRlKHtvcGFjaXR5OmV9LHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpkLmR1cmF0aW9uLGVhc2luZzpkLm9wdGlvbnMuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7ZC5jYWxsYmFjayYmZC5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Yy5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EuZWZmZWN0cy5mb2xkPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxlPVtcInBvc2l0aW9uXCIsXCJ0b3BcIixcImJvdHRvbVwiLFwibGVmdFwiLFwicmlnaHRcIl0saD1hLmVmZmVjdHMuc2V0TW9kZShjLGQub3B0aW9ucy5tb2RlfHxcImhpZGVcIiksZz1kLm9wdGlvbnMuc2l6ZXx8MTUsaT0hIWQub3B0aW9ucy5ob3JpekZpcnN0LGI9ZC5kdXJhdGlvbj9kLmR1cmF0aW9uLzI6YS5meC5zcGVlZHMuX2RlZmF1bHQvMjthLmVmZmVjdHMuc2F2ZShjLGUpO2Muc2hvdygpO3ZhciBmPWEuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpLmNzcyh7b3ZlcmZsb3c6XCJoaWRkZW5cIn0pLGo9aD09XCJzaG93XCIhPWksbD1qP1tcIndpZHRoXCIsXCJoZWlnaHRcIl06W1wiaGVpZ2h0XCIsXCJ3aWR0aFwiXTtqPWo/W2Yud2lkdGgoKSxmLmhlaWdodCgpXTpbZi5oZWlnaHQoKSxmLndpZHRoKCldO3ZhciBvPS8oWzAtOV0rKSUvLmV4ZWMoZyk7aWYobylnPXBhcnNlSW50KG9bMV0sXG4xMCkvMTAwKmpbaD09XCJoaWRlXCI/MDoxXTtpZihoPT1cInNob3dcIilmLmNzcyhpP3toZWlnaHQ6MCx3aWR0aDpnfTp7aGVpZ2h0Omcsd2lkdGg6MH0pO2k9e307bz17fTtpW2xbMF1dPWg9PVwic2hvd1wiP2pbMF06ZztvW2xbMV1dPWg9PVwic2hvd1wiP2pbMV06MDtmLmFuaW1hdGUoaSxiLGQub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUobyxiLGQub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXtoPT1cImhpZGVcIiYmYy5oaWRlKCk7YS5lZmZlY3RzLnJlc3RvcmUoYyxlKTthLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihjKTtkLmNhbGxiYWNrJiZkLmNhbGxiYWNrLmFwcGx5KGNbMF0sYXJndW1lbnRzKTtjLmRlcXVldWUoKX0pfSl9fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLmVmZmVjdHMuaGlnaGxpZ2h0PWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxlPVtcImJhY2tncm91bmRJbWFnZVwiLFwiYmFja2dyb3VuZENvbG9yXCIsXCJvcGFjaXR5XCJdLGg9YS5lZmZlY3RzLnNldE1vZGUoYyxkLm9wdGlvbnMubW9kZXx8XCJzaG93XCIpLGc9e2JhY2tncm91bmRDb2xvcjpjLmNzcyhcImJhY2tncm91bmRDb2xvclwiKX07aWYoaD09XCJoaWRlXCIpZy5vcGFjaXR5PTA7YS5lZmZlY3RzLnNhdmUoYyxlKTtjLnNob3coKS5jc3Moe2JhY2tncm91bmRJbWFnZTpcIm5vbmVcIixiYWNrZ3JvdW5kQ29sb3I6ZC5vcHRpb25zLmNvbG9yfHxcIiNmZmZmOTlcIn0pLmFuaW1hdGUoZyx7cXVldWU6ZmFsc2UsZHVyYXRpb246ZC5kdXJhdGlvbixlYXNpbmc6ZC5vcHRpb25zLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2g9PVwiaGlkZVwiJiZjLmhpZGUoKTthLmVmZmVjdHMucmVzdG9yZShjLGUpO2g9PVwic2hvd1wiJiYhYS5zdXBwb3J0Lm9wYWNpdHkmJlxudGhpcy5zdHlsZS5yZW1vdmVBdHRyaWJ1dGUoXCJmaWx0ZXJcIik7ZC5jYWxsYmFjayYmZC5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Yy5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EuZWZmZWN0cy5wdWxzYXRlPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxlPWEuZWZmZWN0cy5zZXRNb2RlKGMsZC5vcHRpb25zLm1vZGV8fFwic2hvd1wiKTt0aW1lcz0oZC5vcHRpb25zLnRpbWVzfHw1KSoyLTE7ZHVyYXRpb249ZC5kdXJhdGlvbj9kLmR1cmF0aW9uLzI6YS5meC5zcGVlZHMuX2RlZmF1bHQvMjtpc1Zpc2libGU9Yy5pcyhcIjp2aXNpYmxlXCIpO2FuaW1hdGVUbz0wO2lmKCFpc1Zpc2libGUpe2MuY3NzKFwib3BhY2l0eVwiLDApLnNob3coKTthbmltYXRlVG89MX1pZihlPT1cImhpZGVcIiYmaXNWaXNpYmxlfHxlPT1cInNob3dcIiYmIWlzVmlzaWJsZSl0aW1lcy0tO2ZvcihlPTA7ZTx0aW1lcztlKyspe2MuYW5pbWF0ZSh7b3BhY2l0eTphbmltYXRlVG99LGR1cmF0aW9uLGQub3B0aW9ucy5lYXNpbmcpO2FuaW1hdGVUbz0oYW5pbWF0ZVRvKzEpJTJ9Yy5hbmltYXRlKHtvcGFjaXR5OmFuaW1hdGVUb30sZHVyYXRpb24sXG5kLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7YW5pbWF0ZVRvPT0wJiZjLmhpZGUoKTtkLmNhbGxiYWNrJiZkLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pO2MucXVldWUoXCJmeFwiLGZ1bmN0aW9uKCl7Yy5kZXF1ZXVlKCl9KS5kZXF1ZXVlKCl9KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EuZWZmZWN0cy5wdWZmPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxlPWEuZWZmZWN0cy5zZXRNb2RlKGMsZC5vcHRpb25zLm1vZGV8fFwiaGlkZVwiKSxoPXBhcnNlSW50KGQub3B0aW9ucy5wZXJjZW50LDEwKXx8MTUwLGc9aC8xMDAsaT17aGVpZ2h0OmMuaGVpZ2h0KCksd2lkdGg6Yy53aWR0aCgpfTthLmV4dGVuZChkLm9wdGlvbnMse2ZhZGU6dHJ1ZSxtb2RlOmUscGVyY2VudDplPT1cImhpZGVcIj9oOjEwMCxmcm9tOmU9PVwiaGlkZVwiP2k6e2hlaWdodDppLmhlaWdodCpnLHdpZHRoOmkud2lkdGgqZ319KTtjLmVmZmVjdChcInNjYWxlXCIsZC5vcHRpb25zLGQuZHVyYXRpb24sZC5jYWxsYmFjayk7Yy5kZXF1ZXVlKCl9KX07YS5lZmZlY3RzLnNjYWxlPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxlPWEuZXh0ZW5kKHRydWUse30sZC5vcHRpb25zKSxoPWEuZWZmZWN0cy5zZXRNb2RlKGMsXG5kLm9wdGlvbnMubW9kZXx8XCJlZmZlY3RcIiksZz1wYXJzZUludChkLm9wdGlvbnMucGVyY2VudCwxMCl8fChwYXJzZUludChkLm9wdGlvbnMucGVyY2VudCwxMCk9PTA/MDpoPT1cImhpZGVcIj8wOjEwMCksaT1kLm9wdGlvbnMuZGlyZWN0aW9ufHxcImJvdGhcIixiPWQub3B0aW9ucy5vcmlnaW47aWYoaCE9XCJlZmZlY3RcIil7ZS5vcmlnaW49Ynx8W1wibWlkZGxlXCIsXCJjZW50ZXJcIl07ZS5yZXN0b3JlPXRydWV9Yj17aGVpZ2h0OmMuaGVpZ2h0KCksd2lkdGg6Yy53aWR0aCgpfTtjLmZyb209ZC5vcHRpb25zLmZyb218fChoPT1cInNob3dcIj97aGVpZ2h0OjAsd2lkdGg6MH06Yik7Zz17eTppIT1cImhvcml6b250YWxcIj9nLzEwMDoxLHg6aSE9XCJ2ZXJ0aWNhbFwiP2cvMTAwOjF9O2MudG89e2hlaWdodDpiLmhlaWdodCpnLnksd2lkdGg6Yi53aWR0aCpnLnh9O2lmKGQub3B0aW9ucy5mYWRlKXtpZihoPT1cInNob3dcIil7Yy5mcm9tLm9wYWNpdHk9MDtjLnRvLm9wYWNpdHk9MX1pZihoPT1cImhpZGVcIil7Yy5mcm9tLm9wYWNpdHk9XG4xO2MudG8ub3BhY2l0eT0wfX1lLmZyb209Yy5mcm9tO2UudG89Yy50bztlLm1vZGU9aDtjLmVmZmVjdChcInNpemVcIixlLGQuZHVyYXRpb24sZC5jYWxsYmFjayk7Yy5kZXF1ZXVlKCl9KX07YS5lZmZlY3RzLnNpemU9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGU9W1wicG9zaXRpb25cIixcInRvcFwiLFwiYm90dG9tXCIsXCJsZWZ0XCIsXCJyaWdodFwiLFwid2lkdGhcIixcImhlaWdodFwiLFwib3ZlcmZsb3dcIixcIm9wYWNpdHlcIl0saD1bXCJwb3NpdGlvblwiLFwidG9wXCIsXCJib3R0b21cIixcImxlZnRcIixcInJpZ2h0XCIsXCJvdmVyZmxvd1wiLFwib3BhY2l0eVwiXSxnPVtcIndpZHRoXCIsXCJoZWlnaHRcIixcIm92ZXJmbG93XCJdLGk9W1wiZm9udFNpemVcIl0sYj1bXCJib3JkZXJUb3BXaWR0aFwiLFwiYm9yZGVyQm90dG9tV2lkdGhcIixcInBhZGRpbmdUb3BcIixcInBhZGRpbmdCb3R0b21cIl0sZj1bXCJib3JkZXJMZWZ0V2lkdGhcIixcImJvcmRlclJpZ2h0V2lkdGhcIixcInBhZGRpbmdMZWZ0XCIsXCJwYWRkaW5nUmlnaHRcIl0sXG5qPWEuZWZmZWN0cy5zZXRNb2RlKGMsZC5vcHRpb25zLm1vZGV8fFwiZWZmZWN0XCIpLGw9ZC5vcHRpb25zLnJlc3RvcmV8fGZhbHNlLG89ZC5vcHRpb25zLnNjYWxlfHxcImJvdGhcIixuPWQub3B0aW9ucy5vcmlnaW4saz17aGVpZ2h0OmMuaGVpZ2h0KCksd2lkdGg6Yy53aWR0aCgpfTtjLmZyb209ZC5vcHRpb25zLmZyb218fGs7Yy50bz1kLm9wdGlvbnMudG98fGs7aWYobil7bj1hLmVmZmVjdHMuZ2V0QmFzZWxpbmUobixrKTtjLmZyb20udG9wPShrLmhlaWdodC1jLmZyb20uaGVpZ2h0KSpuLnk7Yy5mcm9tLmxlZnQ9KGsud2lkdGgtYy5mcm9tLndpZHRoKSpuLng7Yy50by50b3A9KGsuaGVpZ2h0LWMudG8uaGVpZ2h0KSpuLnk7Yy50by5sZWZ0PShrLndpZHRoLWMudG8ud2lkdGgpKm4ueH12YXIgbT17ZnJvbTp7eTpjLmZyb20uaGVpZ2h0L2suaGVpZ2h0LHg6Yy5mcm9tLndpZHRoL2sud2lkdGh9LHRvOnt5OmMudG8uaGVpZ2h0L2suaGVpZ2h0LHg6Yy50by53aWR0aC9rLndpZHRofX07XG5pZihvPT1cImJveFwifHxvPT1cImJvdGhcIil7aWYobS5mcm9tLnkhPW0udG8ueSl7ZT1lLmNvbmNhdChiKTtjLmZyb209YS5lZmZlY3RzLnNldFRyYW5zaXRpb24oYyxiLG0uZnJvbS55LGMuZnJvbSk7Yy50bz1hLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjLGIsbS50by55LGMudG8pfWlmKG0uZnJvbS54IT1tLnRvLngpe2U9ZS5jb25jYXQoZik7Yy5mcm9tPWEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGMsZixtLmZyb20ueCxjLmZyb20pO2MudG89YS5lZmZlY3RzLnNldFRyYW5zaXRpb24oYyxmLG0udG8ueCxjLnRvKX19aWYobz09XCJjb250ZW50XCJ8fG89PVwiYm90aFwiKWlmKG0uZnJvbS55IT1tLnRvLnkpe2U9ZS5jb25jYXQoaSk7Yy5mcm9tPWEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGMsaSxtLmZyb20ueSxjLmZyb20pO2MudG89YS5lZmZlY3RzLnNldFRyYW5zaXRpb24oYyxpLG0udG8ueSxjLnRvKX1hLmVmZmVjdHMuc2F2ZShjLGw/ZTpoKTtjLnNob3coKTthLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihjKTtcbmMuY3NzKFwib3ZlcmZsb3dcIixcImhpZGRlblwiKS5jc3MoYy5mcm9tKTtpZihvPT1cImNvbnRlbnRcInx8bz09XCJib3RoXCIpe2I9Yi5jb25jYXQoW1wibWFyZ2luVG9wXCIsXCJtYXJnaW5Cb3R0b21cIl0pLmNvbmNhdChpKTtmPWYuY29uY2F0KFtcIm1hcmdpbkxlZnRcIixcIm1hcmdpblJpZ2h0XCJdKTtnPWUuY29uY2F0KGIpLmNvbmNhdChmKTtjLmZpbmQoXCIqW3dpZHRoXVwiKS5lYWNoKGZ1bmN0aW9uKCl7Y2hpbGQ9YSh0aGlzKTtsJiZhLmVmZmVjdHMuc2F2ZShjaGlsZCxnKTt2YXIgcD17aGVpZ2h0OmNoaWxkLmhlaWdodCgpLHdpZHRoOmNoaWxkLndpZHRoKCl9O2NoaWxkLmZyb209e2hlaWdodDpwLmhlaWdodCptLmZyb20ueSx3aWR0aDpwLndpZHRoKm0uZnJvbS54fTtjaGlsZC50bz17aGVpZ2h0OnAuaGVpZ2h0Km0udG8ueSx3aWR0aDpwLndpZHRoKm0udG8ueH07aWYobS5mcm9tLnkhPW0udG8ueSl7Y2hpbGQuZnJvbT1hLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjaGlsZCxiLG0uZnJvbS55LGNoaWxkLmZyb20pO1xuY2hpbGQudG89YS5lZmZlY3RzLnNldFRyYW5zaXRpb24oY2hpbGQsYixtLnRvLnksY2hpbGQudG8pfWlmKG0uZnJvbS54IT1tLnRvLngpe2NoaWxkLmZyb209YS5lZmZlY3RzLnNldFRyYW5zaXRpb24oY2hpbGQsZixtLmZyb20ueCxjaGlsZC5mcm9tKTtjaGlsZC50bz1hLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjaGlsZCxmLG0udG8ueCxjaGlsZC50byl9Y2hpbGQuY3NzKGNoaWxkLmZyb20pO2NoaWxkLmFuaW1hdGUoY2hpbGQudG8sZC5kdXJhdGlvbixkLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7bCYmYS5lZmZlY3RzLnJlc3RvcmUoY2hpbGQsZyl9KX0pfWMuYW5pbWF0ZShjLnRvLHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpkLmR1cmF0aW9uLGVhc2luZzpkLm9wdGlvbnMuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7Yy50by5vcGFjaXR5PT09MCYmYy5jc3MoXCJvcGFjaXR5XCIsYy5mcm9tLm9wYWNpdHkpO2o9PVwiaGlkZVwiJiZjLmhpZGUoKTthLmVmZmVjdHMucmVzdG9yZShjLFxubD9lOmgpO2EuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGMpO2QuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpO2MuZGVxdWV1ZSgpfX0pfSl9fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLmVmZmVjdHMuc2hha2U9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGU9W1wicG9zaXRpb25cIixcInRvcFwiLFwiYm90dG9tXCIsXCJsZWZ0XCIsXCJyaWdodFwiXTthLmVmZmVjdHMuc2V0TW9kZShjLGQub3B0aW9ucy5tb2RlfHxcImVmZmVjdFwiKTt2YXIgaD1kLm9wdGlvbnMuZGlyZWN0aW9ufHxcImxlZnRcIixnPWQub3B0aW9ucy5kaXN0YW5jZXx8MjAsaT1kLm9wdGlvbnMudGltZXN8fDMsYj1kLmR1cmF0aW9ufHxkLm9wdGlvbnMuZHVyYXRpb258fDE0MDthLmVmZmVjdHMuc2F2ZShjLGUpO2Muc2hvdygpO2EuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpO3ZhciBmPWg9PVwidXBcInx8aD09XCJkb3duXCI/XCJ0b3BcIjpcImxlZnRcIixqPWg9PVwidXBcInx8aD09XCJsZWZ0XCI/XCJwb3NcIjpcIm5lZ1wiO2g9e307dmFyIGw9e30sbz17fTtoW2ZdPShqPT1cInBvc1wiP1wiLT1cIjpcIis9XCIpK2c7bFtmXT0oaj09XCJwb3NcIj9cIis9XCI6XCItPVwiKStnKjI7b1tmXT1cbihqPT1cInBvc1wiP1wiLT1cIjpcIis9XCIpK2cqMjtjLmFuaW1hdGUoaCxiLGQub3B0aW9ucy5lYXNpbmcpO2ZvcihnPTE7ZzxpO2crKyljLmFuaW1hdGUobCxiLGQub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUobyxiLGQub3B0aW9ucy5lYXNpbmcpO2MuYW5pbWF0ZShsLGIsZC5vcHRpb25zLmVhc2luZykuYW5pbWF0ZShoLGIvMixkLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7YS5lZmZlY3RzLnJlc3RvcmUoYyxlKTthLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihjKTtkLmNhbGxiYWNrJiZkLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pO2MucXVldWUoXCJmeFwiLGZ1bmN0aW9uKCl7Yy5kZXF1ZXVlKCl9KTtjLmRlcXVldWUoKX0pfX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS5lZmZlY3RzLnNsaWRlPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxlPVtcInBvc2l0aW9uXCIsXCJ0b3BcIixcImJvdHRvbVwiLFwibGVmdFwiLFwicmlnaHRcIl0saD1hLmVmZmVjdHMuc2V0TW9kZShjLGQub3B0aW9ucy5tb2RlfHxcInNob3dcIiksZz1kLm9wdGlvbnMuZGlyZWN0aW9ufHxcImxlZnRcIjthLmVmZmVjdHMuc2F2ZShjLGUpO2Muc2hvdygpO2EuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpLmNzcyh7b3ZlcmZsb3c6XCJoaWRkZW5cIn0pO3ZhciBpPWc9PVwidXBcInx8Zz09XCJkb3duXCI/XCJ0b3BcIjpcImxlZnRcIjtnPWc9PVwidXBcInx8Zz09XCJsZWZ0XCI/XCJwb3NcIjpcIm5lZ1wiO3ZhciBiPWQub3B0aW9ucy5kaXN0YW5jZXx8KGk9PVwidG9wXCI/Yy5vdXRlckhlaWdodCh7bWFyZ2luOnRydWV9KTpjLm91dGVyV2lkdGgoe21hcmdpbjp0cnVlfSkpO2lmKGg9PVwic2hvd1wiKWMuY3NzKGksZz09XCJwb3NcIj9pc05hTihiKT9cIi1cIitiOi1iOmIpO1xudmFyIGY9e307ZltpXT0oaD09XCJzaG93XCI/Zz09XCJwb3NcIj9cIis9XCI6XCItPVwiOmc9PVwicG9zXCI/XCItPVwiOlwiKz1cIikrYjtjLmFuaW1hdGUoZix7cXVldWU6ZmFsc2UsZHVyYXRpb246ZC5kdXJhdGlvbixlYXNpbmc6ZC5vcHRpb25zLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2g9PVwiaGlkZVwiJiZjLmhpZGUoKTthLmVmZmVjdHMucmVzdG9yZShjLGUpO2EuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGMpO2QuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpO2MuZGVxdWV1ZSgpfX0pfSl9fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLmVmZmVjdHMudHJhbnNmZXI9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGU9YShkLm9wdGlvbnMudG8pLGg9ZS5vZmZzZXQoKTtlPXt0b3A6aC50b3AsbGVmdDpoLmxlZnQsaGVpZ2h0OmUuaW5uZXJIZWlnaHQoKSx3aWR0aDplLmlubmVyV2lkdGgoKX07aD1jLm9mZnNldCgpO3ZhciBnPWEoJzxkaXYgY2xhc3M9XCJ1aS1lZmZlY3RzLXRyYW5zZmVyXCI+PC9kaXY+JykuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkuYWRkQ2xhc3MoZC5vcHRpb25zLmNsYXNzTmFtZSkuY3NzKHt0b3A6aC50b3AsbGVmdDpoLmxlZnQsaGVpZ2h0OmMuaW5uZXJIZWlnaHQoKSx3aWR0aDpjLmlubmVyV2lkdGgoKSxwb3NpdGlvbjpcImFic29sdXRlXCJ9KS5hbmltYXRlKGUsZC5kdXJhdGlvbixkLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7Zy5yZW1vdmUoKTtkLmNhbGxiYWNrJiZkLmNhbGxiYWNrLmFwcGx5KGNbMF0sYXJndW1lbnRzKTtcbmMuZGVxdWV1ZSgpfSl9KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2Eud2lkZ2V0KFwidWkuYWNjb3JkaW9uXCIse29wdGlvbnM6e2FjdGl2ZTowLGFuaW1hdGVkOlwic2xpZGVcIixhdXRvSGVpZ2h0OnRydWUsY2xlYXJTdHlsZTpmYWxzZSxjb2xsYXBzaWJsZTpmYWxzZSxldmVudDpcImNsaWNrXCIsZmlsbFNwYWNlOmZhbHNlLGhlYWRlcjpcIj4gbGkgPiA6Zmlyc3QtY2hpbGQsPiA6bm90KGxpKTpldmVuXCIsaWNvbnM6e2hlYWRlcjpcInVpLWljb24tdHJpYW5nbGUtMS1lXCIsaGVhZGVyU2VsZWN0ZWQ6XCJ1aS1pY29uLXRyaWFuZ2xlLTEtc1wifSxuYXZpZ2F0aW9uOmZhbHNlLG5hdmlnYXRpb25GaWx0ZXI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5ocmVmLnRvTG93ZXJDYXNlKCk9PT1sb2NhdGlvbi5ocmVmLnRvTG93ZXJDYXNlKCl9fSxfY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIGQ9dGhpcyxjPWQub3B0aW9ucztkLnJ1bm5pbmc9MDtkLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1hY2NvcmRpb24gdWktd2lkZ2V0IHVpLWhlbHBlci1yZXNldFwiKS5jaGlsZHJlbihcImxpXCIpLmFkZENsYXNzKFwidWktYWNjb3JkaW9uLWxpLWZpeFwiKTtkLmhlYWRlcnM9XG5kLmVsZW1lbnQuZmluZChjLmhlYWRlcikuYWRkQ2xhc3MoXCJ1aS1hY2NvcmRpb24taGVhZGVyIHVpLWhlbHBlci1yZXNldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGxcIikuYmluZChcIm1vdXNlZW50ZXIuYWNjb3JkaW9uXCIsZnVuY3Rpb24oKXtjLmRpc2FibGVkfHxhKHRoaXMpLmFkZENsYXNzKFwidWktc3RhdGUtaG92ZXJcIil9KS5iaW5kKFwibW91c2VsZWF2ZS5hY2NvcmRpb25cIixmdW5jdGlvbigpe2MuZGlzYWJsZWR8fGEodGhpcykucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX0pLmJpbmQoXCJmb2N1cy5hY2NvcmRpb25cIixmdW5jdGlvbigpe2MuZGlzYWJsZWR8fGEodGhpcykuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX0pLmJpbmQoXCJibHVyLmFjY29yZGlvblwiLGZ1bmN0aW9uKCl7Yy5kaXNhYmxlZHx8YSh0aGlzKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWZvY3VzXCIpfSk7ZC5oZWFkZXJzLm5leHQoKS5hZGRDbGFzcyhcInVpLWFjY29yZGlvbi1jb250ZW50IHVpLWhlbHBlci1yZXNldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tXCIpO1xuaWYoYy5uYXZpZ2F0aW9uKXt2YXIgZT1kLmVsZW1lbnQuZmluZChcImFcIikuZmlsdGVyKGMubmF2aWdhdGlvbkZpbHRlcikuZXEoMCk7aWYoZS5sZW5ndGgpe3ZhciBoPWUuY2xvc2VzdChcIi51aS1hY2NvcmRpb24taGVhZGVyXCIpO2QuYWN0aXZlPWgubGVuZ3RoP2g6ZS5jbG9zZXN0KFwiLnVpLWFjY29yZGlvbi1jb250ZW50XCIpLnByZXYoKX19ZC5hY3RpdmU9ZC5fZmluZEFjdGl2ZShkLmFjdGl2ZXx8Yy5hY3RpdmUpLmFkZENsYXNzKFwidWktc3RhdGUtZGVmYXVsdCB1aS1zdGF0ZS1hY3RpdmVcIikudG9nZ2xlQ2xhc3MoXCJ1aS1jb3JuZXItYWxsXCIpLnRvZ2dsZUNsYXNzKFwidWktY29ybmVyLXRvcFwiKTtkLmFjdGl2ZS5uZXh0KCkuYWRkQ2xhc3MoXCJ1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmVcIik7ZC5fY3JlYXRlSWNvbnMoKTtkLnJlc2l6ZSgpO2QuZWxlbWVudC5hdHRyKFwicm9sZVwiLFwidGFibGlzdFwiKTtkLmhlYWRlcnMuYXR0cihcInJvbGVcIixcInRhYlwiKS5iaW5kKFwia2V5ZG93bi5hY2NvcmRpb25cIixcbmZ1bmN0aW9uKGcpe3JldHVybiBkLl9rZXlkb3duKGcpfSkubmV4dCgpLmF0dHIoXCJyb2xlXCIsXCJ0YWJwYW5lbFwiKTtkLmhlYWRlcnMubm90KGQuYWN0aXZlfHxcIlwiKS5hdHRyKHtcImFyaWEtZXhwYW5kZWRcIjpcImZhbHNlXCIsXCJhcmlhLXNlbGVjdGVkXCI6XCJmYWxzZVwiLHRhYkluZGV4Oi0xfSkubmV4dCgpLmhpZGUoKTtkLmFjdGl2ZS5sZW5ndGg/ZC5hY3RpdmUuYXR0cih7XCJhcmlhLWV4cGFuZGVkXCI6XCJ0cnVlXCIsXCJhcmlhLXNlbGVjdGVkXCI6XCJ0cnVlXCIsdGFiSW5kZXg6MH0pOmQuaGVhZGVycy5lcSgwKS5hdHRyKFwidGFiSW5kZXhcIiwwKTthLmJyb3dzZXIuc2FmYXJpfHxkLmhlYWRlcnMuZmluZChcImFcIikuYXR0cihcInRhYkluZGV4XCIsLTEpO2MuZXZlbnQmJmQuaGVhZGVycy5iaW5kKGMuZXZlbnQuc3BsaXQoXCIgXCIpLmpvaW4oXCIuYWNjb3JkaW9uIFwiKStcIi5hY2NvcmRpb25cIixmdW5jdGlvbihnKXtkLl9jbGlja0hhbmRsZXIuY2FsbChkLGcsdGhpcyk7Zy5wcmV2ZW50RGVmYXVsdCgpfSl9LF9jcmVhdGVJY29uczpmdW5jdGlvbigpe3ZhciBkPVxudGhpcy5vcHRpb25zO2lmKGQuaWNvbnMpe2EoXCI8c3Bhbj48L3NwYW4+XCIpLmFkZENsYXNzKFwidWktaWNvbiBcIitkLmljb25zLmhlYWRlcikucHJlcGVuZFRvKHRoaXMuaGVhZGVycyk7dGhpcy5hY3RpdmUuY2hpbGRyZW4oXCIudWktaWNvblwiKS50b2dnbGVDbGFzcyhkLmljb25zLmhlYWRlcikudG9nZ2xlQ2xhc3MoZC5pY29ucy5oZWFkZXJTZWxlY3RlZCk7dGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktYWNjb3JkaW9uLWljb25zXCIpfX0sX2Rlc3Ryb3lJY29uczpmdW5jdGlvbigpe3RoaXMuaGVhZGVycy5jaGlsZHJlbihcIi51aS1pY29uXCIpLnJlbW92ZSgpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLWFjY29yZGlvbi1pY29uc1wiKX0sZGVzdHJveTpmdW5jdGlvbigpe3ZhciBkPXRoaXMub3B0aW9uczt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1hY2NvcmRpb24gdWktd2lkZ2V0IHVpLWhlbHBlci1yZXNldFwiKS5yZW1vdmVBdHRyKFwicm9sZVwiKTt0aGlzLmhlYWRlcnMudW5iaW5kKFwiLmFjY29yZGlvblwiKS5yZW1vdmVDbGFzcyhcInVpLWFjY29yZGlvbi1oZWFkZXIgdWktYWNjb3JkaW9uLWRpc2FibGVkIHVpLWhlbHBlci1yZXNldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwgdWktc3RhdGUtYWN0aXZlIHVpLXN0YXRlLWRpc2FibGVkIHVpLWNvcm5lci10b3BcIikucmVtb3ZlQXR0cihcInJvbGVcIikucmVtb3ZlQXR0cihcImFyaWEtZXhwYW5kZWRcIikucmVtb3ZlQXR0cihcImFyaWEtc2VsZWN0ZWRcIikucmVtb3ZlQXR0cihcInRhYkluZGV4XCIpO1xudGhpcy5oZWFkZXJzLmZpbmQoXCJhXCIpLnJlbW92ZUF0dHIoXCJ0YWJJbmRleFwiKTt0aGlzLl9kZXN0cm95SWNvbnMoKTt2YXIgYz10aGlzLmhlYWRlcnMubmV4dCgpLmNzcyhcImRpc3BsYXlcIixcIlwiKS5yZW1vdmVBdHRyKFwicm9sZVwiKS5yZW1vdmVDbGFzcyhcInVpLWhlbHBlci1yZXNldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tIHVpLWFjY29yZGlvbi1jb250ZW50IHVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZSB1aS1hY2NvcmRpb24tZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWRcIik7aWYoZC5hdXRvSGVpZ2h0fHxkLmZpbGxIZWlnaHQpYy5jc3MoXCJoZWlnaHRcIixcIlwiKTtyZXR1cm4gYS5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKX0sX3NldE9wdGlvbjpmdW5jdGlvbihkLGMpe2EuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtkPT1cImFjdGl2ZVwiJiZ0aGlzLmFjdGl2YXRlKGMpO2lmKGQ9PVwiaWNvbnNcIil7dGhpcy5fZGVzdHJveUljb25zKCk7XG5jJiZ0aGlzLl9jcmVhdGVJY29ucygpfWlmKGQ9PVwiZGlzYWJsZWRcIil0aGlzLmhlYWRlcnMuYWRkKHRoaXMuaGVhZGVycy5uZXh0KCkpW2M/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJ1aS1hY2NvcmRpb24tZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWRcIil9LF9rZXlkb3duOmZ1bmN0aW9uKGQpe2lmKCEodGhpcy5vcHRpb25zLmRpc2FibGVkfHxkLmFsdEtleXx8ZC5jdHJsS2V5KSl7dmFyIGM9YS51aS5rZXlDb2RlLGU9dGhpcy5oZWFkZXJzLmxlbmd0aCxoPXRoaXMuaGVhZGVycy5pbmRleChkLnRhcmdldCksZz1mYWxzZTtzd2l0Y2goZC5rZXlDb2RlKXtjYXNlIGMuUklHSFQ6Y2FzZSBjLkRPV046Zz10aGlzLmhlYWRlcnNbKGgrMSklZV07YnJlYWs7Y2FzZSBjLkxFRlQ6Y2FzZSBjLlVQOmc9dGhpcy5oZWFkZXJzWyhoLTErZSklZV07YnJlYWs7Y2FzZSBjLlNQQUNFOmNhc2UgYy5FTlRFUjp0aGlzLl9jbGlja0hhbmRsZXIoe3RhcmdldDpkLnRhcmdldH0sZC50YXJnZXQpO1xuZC5wcmV2ZW50RGVmYXVsdCgpfWlmKGcpe2EoZC50YXJnZXQpLmF0dHIoXCJ0YWJJbmRleFwiLC0xKTthKGcpLmF0dHIoXCJ0YWJJbmRleFwiLDApO2cuZm9jdXMoKTtyZXR1cm4gZmFsc2V9cmV0dXJuIHRydWV9fSxyZXNpemU6ZnVuY3Rpb24oKXt2YXIgZD10aGlzLm9wdGlvbnMsYztpZihkLmZpbGxTcGFjZSl7aWYoYS5icm93c2VyLm1zaWUpe3ZhciBlPXRoaXMuZWxlbWVudC5wYXJlbnQoKS5jc3MoXCJvdmVyZmxvd1wiKTt0aGlzLmVsZW1lbnQucGFyZW50KCkuY3NzKFwib3ZlcmZsb3dcIixcImhpZGRlblwiKX1jPXRoaXMuZWxlbWVudC5wYXJlbnQoKS5oZWlnaHQoKTthLmJyb3dzZXIubXNpZSYmdGhpcy5lbGVtZW50LnBhcmVudCgpLmNzcyhcIm92ZXJmbG93XCIsZSk7dGhpcy5oZWFkZXJzLmVhY2goZnVuY3Rpb24oKXtjLT1hKHRoaXMpLm91dGVySGVpZ2h0KHRydWUpfSk7dGhpcy5oZWFkZXJzLm5leHQoKS5lYWNoKGZ1bmN0aW9uKCl7YSh0aGlzKS5oZWlnaHQoTWF0aC5tYXgoMCxjLWEodGhpcykuaW5uZXJIZWlnaHQoKStcbmEodGhpcykuaGVpZ2h0KCkpKX0pLmNzcyhcIm92ZXJmbG93XCIsXCJhdXRvXCIpfWVsc2UgaWYoZC5hdXRvSGVpZ2h0KXtjPTA7dGhpcy5oZWFkZXJzLm5leHQoKS5lYWNoKGZ1bmN0aW9uKCl7Yz1NYXRoLm1heChjLGEodGhpcykuaGVpZ2h0KFwiXCIpLmhlaWdodCgpKX0pLmhlaWdodChjKX1yZXR1cm4gdGhpc30sYWN0aXZhdGU6ZnVuY3Rpb24oZCl7dGhpcy5vcHRpb25zLmFjdGl2ZT1kO2Q9dGhpcy5fZmluZEFjdGl2ZShkKVswXTt0aGlzLl9jbGlja0hhbmRsZXIoe3RhcmdldDpkfSxkKTtyZXR1cm4gdGhpc30sX2ZpbmRBY3RpdmU6ZnVuY3Rpb24oZCl7cmV0dXJuIGQ/dHlwZW9mIGQ9PT1cIm51bWJlclwiP3RoaXMuaGVhZGVycy5maWx0ZXIoXCI6ZXEoXCIrZCtcIilcIik6dGhpcy5oZWFkZXJzLm5vdCh0aGlzLmhlYWRlcnMubm90KGQpKTpkPT09ZmFsc2U/YShbXSk6dGhpcy5oZWFkZXJzLmZpbHRlcihcIjplcSgwKVwiKX0sX2NsaWNrSGFuZGxlcjpmdW5jdGlvbihkLGMpe3ZhciBlPXRoaXMub3B0aW9ucztcbmlmKCFlLmRpc2FibGVkKWlmKGQudGFyZ2V0KXtkPWEoZC5jdXJyZW50VGFyZ2V0fHxjKTtjPWRbMF09PT10aGlzLmFjdGl2ZVswXTtlLmFjdGl2ZT1lLmNvbGxhcHNpYmxlJiZjP2ZhbHNlOnRoaXMuaGVhZGVycy5pbmRleChkKTtpZighKHRoaXMucnVubmluZ3x8IWUuY29sbGFwc2libGUmJmMpKXt2YXIgaD10aGlzLmFjdGl2ZTtmPWQubmV4dCgpO2k9dGhpcy5hY3RpdmUubmV4dCgpO2I9e29wdGlvbnM6ZSxuZXdIZWFkZXI6YyYmZS5jb2xsYXBzaWJsZT9hKFtdKTpkLG9sZEhlYWRlcjp0aGlzLmFjdGl2ZSxuZXdDb250ZW50OmMmJmUuY29sbGFwc2libGU/YShbXSk6ZixvbGRDb250ZW50Oml9O3ZhciBnPXRoaXMuaGVhZGVycy5pbmRleCh0aGlzLmFjdGl2ZVswXSk+dGhpcy5oZWFkZXJzLmluZGV4KGRbMF0pO3RoaXMuYWN0aXZlPWM/YShbXSk6ZDt0aGlzLl90b2dnbGUoZixpLGIsYyxnKTtoLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlIHVpLWNvcm5lci10b3BcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGxcIikuY2hpbGRyZW4oXCIudWktaWNvblwiKS5yZW1vdmVDbGFzcyhlLmljb25zLmhlYWRlclNlbGVjdGVkKS5hZGRDbGFzcyhlLmljb25zLmhlYWRlcik7XG5pZighYyl7ZC5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbFwiKS5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZSB1aS1jb3JuZXItdG9wXCIpLmNoaWxkcmVuKFwiLnVpLWljb25cIikucmVtb3ZlQ2xhc3MoZS5pY29ucy5oZWFkZXIpLmFkZENsYXNzKGUuaWNvbnMuaGVhZGVyU2VsZWN0ZWQpO2QubmV4dCgpLmFkZENsYXNzKFwidWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlXCIpfX19ZWxzZSBpZihlLmNvbGxhcHNpYmxlKXt0aGlzLmFjdGl2ZS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZSB1aS1jb3JuZXItdG9wXCIpLmFkZENsYXNzKFwidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsXCIpLmNoaWxkcmVuKFwiLnVpLWljb25cIikucmVtb3ZlQ2xhc3MoZS5pY29ucy5oZWFkZXJTZWxlY3RlZCkuYWRkQ2xhc3MoZS5pY29ucy5oZWFkZXIpO3RoaXMuYWN0aXZlLm5leHQoKS5hZGRDbGFzcyhcInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZVwiKTt2YXIgaT10aGlzLmFjdGl2ZS5uZXh0KCksXG5iPXtvcHRpb25zOmUsbmV3SGVhZGVyOmEoW10pLG9sZEhlYWRlcjplLmFjdGl2ZSxuZXdDb250ZW50OmEoW10pLG9sZENvbnRlbnQ6aX0sZj10aGlzLmFjdGl2ZT1hKFtdKTt0aGlzLl90b2dnbGUoZixpLGIpfX0sX3RvZ2dsZTpmdW5jdGlvbihkLGMsZSxoLGcpe3ZhciBpPXRoaXMsYj1pLm9wdGlvbnM7aS50b1Nob3c9ZDtpLnRvSGlkZT1jO2kuZGF0YT1lO3ZhciBmPWZ1bmN0aW9uKCl7aWYoaSlyZXR1cm4gaS5fY29tcGxldGVkLmFwcGx5KGksYXJndW1lbnRzKX07aS5fdHJpZ2dlcihcImNoYW5nZXN0YXJ0XCIsbnVsbCxpLmRhdGEpO2kucnVubmluZz1jLnNpemUoKT09PTA/ZC5zaXplKCk6Yy5zaXplKCk7aWYoYi5hbmltYXRlZCl7ZT17fTtlPWIuY29sbGFwc2libGUmJmg/e3RvU2hvdzphKFtdKSx0b0hpZGU6Yyxjb21wbGV0ZTpmLGRvd246ZyxhdXRvSGVpZ2h0OmIuYXV0b0hlaWdodHx8Yi5maWxsU3BhY2V9Ont0b1Nob3c6ZCx0b0hpZGU6Yyxjb21wbGV0ZTpmLGRvd246ZyxhdXRvSGVpZ2h0OmIuYXV0b0hlaWdodHx8XG5iLmZpbGxTcGFjZX07aWYoIWIucHJveGllZCliLnByb3hpZWQ9Yi5hbmltYXRlZDtpZighYi5wcm94aWVkRHVyYXRpb24pYi5wcm94aWVkRHVyYXRpb249Yi5kdXJhdGlvbjtiLmFuaW1hdGVkPWEuaXNGdW5jdGlvbihiLnByb3hpZWQpP2IucHJveGllZChlKTpiLnByb3hpZWQ7Yi5kdXJhdGlvbj1hLmlzRnVuY3Rpb24oYi5wcm94aWVkRHVyYXRpb24pP2IucHJveGllZER1cmF0aW9uKGUpOmIucHJveGllZER1cmF0aW9uO2g9YS51aS5hY2NvcmRpb24uYW5pbWF0aW9uczt2YXIgaj1iLmR1cmF0aW9uLGw9Yi5hbmltYXRlZDtpZihsJiYhaFtsXSYmIWEuZWFzaW5nW2xdKWw9XCJzbGlkZVwiO2hbbF18fChoW2xdPWZ1bmN0aW9uKG8pe3RoaXMuc2xpZGUobyx7ZWFzaW5nOmwsZHVyYXRpb246anx8NzAwfSl9KTtoW2xdKGUpfWVsc2V7aWYoYi5jb2xsYXBzaWJsZSYmaClkLnRvZ2dsZSgpO2Vsc2V7Yy5oaWRlKCk7ZC5zaG93KCl9Zih0cnVlKX1jLnByZXYoKS5hdHRyKHtcImFyaWEtZXhwYW5kZWRcIjpcImZhbHNlXCIsXG5cImFyaWEtc2VsZWN0ZWRcIjpcImZhbHNlXCIsdGFiSW5kZXg6LTF9KS5ibHVyKCk7ZC5wcmV2KCkuYXR0cih7XCJhcmlhLWV4cGFuZGVkXCI6XCJ0cnVlXCIsXCJhcmlhLXNlbGVjdGVkXCI6XCJ0cnVlXCIsdGFiSW5kZXg6MH0pLmZvY3VzKCl9LF9jb21wbGV0ZWQ6ZnVuY3Rpb24oZCl7dGhpcy5ydW5uaW5nPWQ/MDotLXRoaXMucnVubmluZztpZighdGhpcy5ydW5uaW5nKXt0aGlzLm9wdGlvbnMuY2xlYXJTdHlsZSYmdGhpcy50b1Nob3cuYWRkKHRoaXMudG9IaWRlKS5jc3Moe2hlaWdodDpcIlwiLG92ZXJmbG93OlwiXCJ9KTt0aGlzLnRvSGlkZS5yZW1vdmVDbGFzcyhcInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZVwiKTtpZih0aGlzLnRvSGlkZS5sZW5ndGgpdGhpcy50b0hpZGUucGFyZW50KClbMF0uY2xhc3NOYW1lPXRoaXMudG9IaWRlLnBhcmVudCgpWzBdLmNsYXNzTmFtZTt0aGlzLl90cmlnZ2VyKFwiY2hhbmdlXCIsbnVsbCx0aGlzLmRhdGEpfX19KTthLmV4dGVuZChhLnVpLmFjY29yZGlvbix7dmVyc2lvbjpcIjEuOC4xNlwiLFxuYW5pbWF0aW9uczp7c2xpZGU6ZnVuY3Rpb24oZCxjKXtkPWEuZXh0ZW5kKHtlYXNpbmc6XCJzd2luZ1wiLGR1cmF0aW9uOjMwMH0sZCxjKTtpZihkLnRvSGlkZS5zaXplKCkpaWYoZC50b1Nob3cuc2l6ZSgpKXt2YXIgZT1kLnRvU2hvdy5jc3MoXCJvdmVyZmxvd1wiKSxoPTAsZz17fSxpPXt9LGI7Yz1kLnRvU2hvdztiPWNbMF0uc3R5bGUud2lkdGg7Yy53aWR0aChwYXJzZUludChjLnBhcmVudCgpLndpZHRoKCksMTApLXBhcnNlSW50KGMuY3NzKFwicGFkZGluZ0xlZnRcIiksMTApLXBhcnNlSW50KGMuY3NzKFwicGFkZGluZ1JpZ2h0XCIpLDEwKS0ocGFyc2VJbnQoYy5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKS0ocGFyc2VJbnQoYy5jc3MoXCJib3JkZXJSaWdodFdpZHRoXCIpLDEwKXx8MCkpO2EuZWFjaChbXCJoZWlnaHRcIixcInBhZGRpbmdUb3BcIixcInBhZGRpbmdCb3R0b21cIl0sZnVuY3Rpb24oZixqKXtpW2pdPVwiaGlkZVwiO2Y9KFwiXCIrYS5jc3MoZC50b1Nob3dbMF0saikpLm1hdGNoKC9eKFtcXGQrLS5dKykoLiopJC8pO1xuZ1tqXT17dmFsdWU6ZlsxXSx1bml0OmZbMl18fFwicHhcIn19KTtkLnRvU2hvdy5jc3Moe2hlaWdodDowLG92ZXJmbG93OlwiaGlkZGVuXCJ9KS5zaG93KCk7ZC50b0hpZGUuZmlsdGVyKFwiOmhpZGRlblwiKS5lYWNoKGQuY29tcGxldGUpLmVuZCgpLmZpbHRlcihcIjp2aXNpYmxlXCIpLmFuaW1hdGUoaSx7c3RlcDpmdW5jdGlvbihmLGope2lmKGoucHJvcD09XCJoZWlnaHRcIiloPWouZW5kLWouc3RhcnQ9PT0wPzA6KGoubm93LWouc3RhcnQpLyhqLmVuZC1qLnN0YXJ0KTtkLnRvU2hvd1swXS5zdHlsZVtqLnByb3BdPWgqZ1tqLnByb3BdLnZhbHVlK2dbai5wcm9wXS51bml0fSxkdXJhdGlvbjpkLmR1cmF0aW9uLGVhc2luZzpkLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2QuYXV0b0hlaWdodHx8ZC50b1Nob3cuY3NzKFwiaGVpZ2h0XCIsXCJcIik7ZC50b1Nob3cuY3NzKHt3aWR0aDpiLG92ZXJmbG93OmV9KTtkLmNvbXBsZXRlKCl9fSl9ZWxzZSBkLnRvSGlkZS5hbmltYXRlKHtoZWlnaHQ6XCJoaWRlXCIsXG5wYWRkaW5nVG9wOlwiaGlkZVwiLHBhZGRpbmdCb3R0b206XCJoaWRlXCJ9LGQpO2Vsc2UgZC50b1Nob3cuYW5pbWF0ZSh7aGVpZ2h0Olwic2hvd1wiLHBhZGRpbmdUb3A6XCJzaG93XCIscGFkZGluZ0JvdHRvbTpcInNob3dcIn0sZCl9LGJvdW5jZXNsaWRlOmZ1bmN0aW9uKGQpe3RoaXMuc2xpZGUoZCx7ZWFzaW5nOmQuZG93bj9cImVhc2VPdXRCb3VuY2VcIjpcInN3aW5nXCIsZHVyYXRpb246ZC5kb3duPzFFMzoyMDB9KX19fSl9KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe3ZhciBkPTA7YS53aWRnZXQoXCJ1aS5hdXRvY29tcGxldGVcIix7b3B0aW9uczp7YXBwZW5kVG86XCJib2R5XCIsYXV0b0ZvY3VzOmZhbHNlLGRlbGF5OjMwMCxtaW5MZW5ndGg6MSxwb3NpdGlvbjp7bXk6XCJsZWZ0IHRvcFwiLGF0OlwibGVmdCBib3R0b21cIixjb2xsaXNpb246XCJub25lXCJ9LHNvdXJjZTpudWxsfSxwZW5kaW5nOjAsX2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBjPXRoaXMsZT10aGlzLmVsZW1lbnRbMF0ub3duZXJEb2N1bWVudCxoO3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWF1dG9jb21wbGV0ZS1pbnB1dFwiKS5hdHRyKFwiYXV0b2NvbXBsZXRlXCIsXCJvZmZcIikuYXR0cih7cm9sZTpcInRleHRib3hcIixcImFyaWEtYXV0b2NvbXBsZXRlXCI6XCJsaXN0XCIsXCJhcmlhLWhhc3BvcHVwXCI6XCJ0cnVlXCJ9KS5iaW5kKFwia2V5ZG93bi5hdXRvY29tcGxldGVcIixmdW5jdGlvbihnKXtpZighKGMub3B0aW9ucy5kaXNhYmxlZHx8Yy5lbGVtZW50LnByb3BBdHRyKFwicmVhZE9ubHlcIikpKXtoPVxuZmFsc2U7dmFyIGk9YS51aS5rZXlDb2RlO3N3aXRjaChnLmtleUNvZGUpe2Nhc2UgaS5QQUdFX1VQOmMuX21vdmUoXCJwcmV2aW91c1BhZ2VcIixnKTticmVhaztjYXNlIGkuUEFHRV9ET1dOOmMuX21vdmUoXCJuZXh0UGFnZVwiLGcpO2JyZWFrO2Nhc2UgaS5VUDpjLl9tb3ZlKFwicHJldmlvdXNcIixnKTtnLnByZXZlbnREZWZhdWx0KCk7YnJlYWs7Y2FzZSBpLkRPV046Yy5fbW92ZShcIm5leHRcIixnKTtnLnByZXZlbnREZWZhdWx0KCk7YnJlYWs7Y2FzZSBpLkVOVEVSOmNhc2UgaS5OVU1QQURfRU5URVI6aWYoYy5tZW51LmFjdGl2ZSl7aD10cnVlO2cucHJldmVudERlZmF1bHQoKX1jYXNlIGkuVEFCOmlmKCFjLm1lbnUuYWN0aXZlKXJldHVybjtjLm1lbnUuc2VsZWN0KGcpO2JyZWFrO2Nhc2UgaS5FU0NBUEU6Yy5lbGVtZW50LnZhbChjLnRlcm0pO2MuY2xvc2UoZyk7YnJlYWs7ZGVmYXVsdDpjbGVhclRpbWVvdXQoYy5zZWFyY2hpbmcpO2Muc2VhcmNoaW5nPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtpZihjLnRlcm0hPVxuYy5lbGVtZW50LnZhbCgpKXtjLnNlbGVjdGVkSXRlbT1udWxsO2Muc2VhcmNoKG51bGwsZyl9fSxjLm9wdGlvbnMuZGVsYXkpO2JyZWFrfX19KS5iaW5kKFwia2V5cHJlc3MuYXV0b2NvbXBsZXRlXCIsZnVuY3Rpb24oZyl7aWYoaCl7aD1mYWxzZTtnLnByZXZlbnREZWZhdWx0KCl9fSkuYmluZChcImZvY3VzLmF1dG9jb21wbGV0ZVwiLGZ1bmN0aW9uKCl7aWYoIWMub3B0aW9ucy5kaXNhYmxlZCl7Yy5zZWxlY3RlZEl0ZW09bnVsbDtjLnByZXZpb3VzPWMuZWxlbWVudC52YWwoKX19KS5iaW5kKFwiYmx1ci5hdXRvY29tcGxldGVcIixmdW5jdGlvbihnKXtpZighYy5vcHRpb25zLmRpc2FibGVkKXtjbGVhclRpbWVvdXQoYy5zZWFyY2hpbmcpO2MuY2xvc2luZz1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yy5jbG9zZShnKTtjLl9jaGFuZ2UoZyl9LDE1MCl9fSk7dGhpcy5faW5pdFNvdXJjZSgpO3RoaXMucmVzcG9uc2U9ZnVuY3Rpb24oKXtyZXR1cm4gYy5fcmVzcG9uc2UuYXBwbHkoYyxhcmd1bWVudHMpfTtcbnRoaXMubWVudT1hKFwiPHVsPjwvdWw+XCIpLmFkZENsYXNzKFwidWktYXV0b2NvbXBsZXRlXCIpLmFwcGVuZFRvKGEodGhpcy5vcHRpb25zLmFwcGVuZFRvfHxcImJvZHlcIixlKVswXSkubW91c2Vkb3duKGZ1bmN0aW9uKGcpe3ZhciBpPWMubWVudS5lbGVtZW50WzBdO2EoZy50YXJnZXQpLmNsb3Nlc3QoXCIudWktbWVudS1pdGVtXCIpLmxlbmd0aHx8c2V0VGltZW91dChmdW5jdGlvbigpe2EoZG9jdW1lbnQpLm9uZShcIm1vdXNlZG93blwiLGZ1bmN0aW9uKGIpe2IudGFyZ2V0IT09Yy5lbGVtZW50WzBdJiZiLnRhcmdldCE9PWkmJiFhLnVpLmNvbnRhaW5zKGksYi50YXJnZXQpJiZjLmNsb3NlKCl9KX0sMSk7c2V0VGltZW91dChmdW5jdGlvbigpe2NsZWFyVGltZW91dChjLmNsb3NpbmcpfSwxMyl9KS5tZW51KHtmb2N1czpmdW5jdGlvbihnLGkpe2k9aS5pdGVtLmRhdGEoXCJpdGVtLmF1dG9jb21wbGV0ZVwiKTtmYWxzZSE9PWMuX3RyaWdnZXIoXCJmb2N1c1wiLGcse2l0ZW06aX0pJiYvXmtleS8udGVzdChnLm9yaWdpbmFsRXZlbnQudHlwZSkmJlxuYy5lbGVtZW50LnZhbChpLnZhbHVlKX0sc2VsZWN0ZWQ6ZnVuY3Rpb24oZyxpKXt2YXIgYj1pLml0ZW0uZGF0YShcIml0ZW0uYXV0b2NvbXBsZXRlXCIpLGY9Yy5wcmV2aW91cztpZihjLmVsZW1lbnRbMF0hPT1lLmFjdGl2ZUVsZW1lbnQpe2MuZWxlbWVudC5mb2N1cygpO2MucHJldmlvdXM9ZjtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yy5wcmV2aW91cz1mO2Muc2VsZWN0ZWRJdGVtPWJ9LDEpfWZhbHNlIT09Yy5fdHJpZ2dlcihcInNlbGVjdFwiLGcse2l0ZW06Yn0pJiZjLmVsZW1lbnQudmFsKGIudmFsdWUpO2MudGVybT1jLmVsZW1lbnQudmFsKCk7Yy5jbG9zZShnKTtjLnNlbGVjdGVkSXRlbT1ifSxibHVyOmZ1bmN0aW9uKCl7Yy5tZW51LmVsZW1lbnQuaXMoXCI6dmlzaWJsZVwiKSYmYy5lbGVtZW50LnZhbCgpIT09Yy50ZXJtJiZjLmVsZW1lbnQudmFsKGMudGVybSl9fSkuekluZGV4KHRoaXMuZWxlbWVudC56SW5kZXgoKSsxKS5jc3Moe3RvcDowLGxlZnQ6MH0pLmhpZGUoKS5kYXRhKFwibWVudVwiKTtcbmEuZm4uYmdpZnJhbWUmJnRoaXMubWVudS5lbGVtZW50LmJnaWZyYW1lKCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1hdXRvY29tcGxldGUtaW5wdXRcIikucmVtb3ZlQXR0cihcImF1dG9jb21wbGV0ZVwiKS5yZW1vdmVBdHRyKFwicm9sZVwiKS5yZW1vdmVBdHRyKFwiYXJpYS1hdXRvY29tcGxldGVcIikucmVtb3ZlQXR0cihcImFyaWEtaGFzcG9wdXBcIik7dGhpcy5tZW51LmVsZW1lbnQucmVtb3ZlKCk7YS5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKX0sX3NldE9wdGlvbjpmdW5jdGlvbihjLGUpe2EuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtjPT09XCJzb3VyY2VcIiYmdGhpcy5faW5pdFNvdXJjZSgpO2lmKGM9PT1cImFwcGVuZFRvXCIpdGhpcy5tZW51LmVsZW1lbnQuYXBwZW5kVG8oYShlfHxcImJvZHlcIix0aGlzLmVsZW1lbnRbMF0ub3duZXJEb2N1bWVudClbMF0pO2M9PT1cImRpc2FibGVkXCImJlxuZSYmdGhpcy54aHImJnRoaXMueGhyLmFib3J0KCl9LF9pbml0U291cmNlOmZ1bmN0aW9uKCl7dmFyIGM9dGhpcyxlLGg7aWYoYS5pc0FycmF5KHRoaXMub3B0aW9ucy5zb3VyY2UpKXtlPXRoaXMub3B0aW9ucy5zb3VyY2U7dGhpcy5zb3VyY2U9ZnVuY3Rpb24oZyxpKXtpKGEudWkuYXV0b2NvbXBsZXRlLmZpbHRlcihlLGcudGVybSkpfX1lbHNlIGlmKHR5cGVvZiB0aGlzLm9wdGlvbnMuc291cmNlPT09XCJzdHJpbmdcIil7aD10aGlzLm9wdGlvbnMuc291cmNlO3RoaXMuc291cmNlPWZ1bmN0aW9uKGcsaSl7Yy54aHImJmMueGhyLmFib3J0KCk7Yy54aHI9YS5hamF4KHt1cmw6aCxkYXRhOmcsZGF0YVR5cGU6XCJqc29uXCIsYXV0b2NvbXBsZXRlUmVxdWVzdDorK2Qsc3VjY2VzczpmdW5jdGlvbihiKXt0aGlzLmF1dG9jb21wbGV0ZVJlcXVlc3Q9PT1kJiZpKGIpfSxlcnJvcjpmdW5jdGlvbigpe3RoaXMuYXV0b2NvbXBsZXRlUmVxdWVzdD09PWQmJmkoW10pfX0pfX1lbHNlIHRoaXMuc291cmNlPVxudGhpcy5vcHRpb25zLnNvdXJjZX0sc2VhcmNoOmZ1bmN0aW9uKGMsZSl7Yz1jIT1udWxsP2M6dGhpcy5lbGVtZW50LnZhbCgpO3RoaXMudGVybT10aGlzLmVsZW1lbnQudmFsKCk7aWYoYy5sZW5ndGg8dGhpcy5vcHRpb25zLm1pbkxlbmd0aClyZXR1cm4gdGhpcy5jbG9zZShlKTtjbGVhclRpbWVvdXQodGhpcy5jbG9zaW5nKTtpZih0aGlzLl90cmlnZ2VyKFwic2VhcmNoXCIsZSkhPT1mYWxzZSlyZXR1cm4gdGhpcy5fc2VhcmNoKGMpfSxfc2VhcmNoOmZ1bmN0aW9uKGMpe3RoaXMucGVuZGluZysrO3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWF1dG9jb21wbGV0ZS1sb2FkaW5nXCIpO3RoaXMuc291cmNlKHt0ZXJtOmN9LHRoaXMucmVzcG9uc2UpfSxfcmVzcG9uc2U6ZnVuY3Rpb24oYyl7aWYoIXRoaXMub3B0aW9ucy5kaXNhYmxlZCYmYyYmYy5sZW5ndGgpe2M9dGhpcy5fbm9ybWFsaXplKGMpO3RoaXMuX3N1Z2dlc3QoYyk7dGhpcy5fdHJpZ2dlcihcIm9wZW5cIil9ZWxzZSB0aGlzLmNsb3NlKCk7XG50aGlzLnBlbmRpbmctLTt0aGlzLnBlbmRpbmd8fHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLWF1dG9jb21wbGV0ZS1sb2FkaW5nXCIpfSxjbG9zZTpmdW5jdGlvbihjKXtjbGVhclRpbWVvdXQodGhpcy5jbG9zaW5nKTtpZih0aGlzLm1lbnUuZWxlbWVudC5pcyhcIjp2aXNpYmxlXCIpKXt0aGlzLm1lbnUuZWxlbWVudC5oaWRlKCk7dGhpcy5tZW51LmRlYWN0aXZhdGUoKTt0aGlzLl90cmlnZ2VyKFwiY2xvc2VcIixjKX19LF9jaGFuZ2U6ZnVuY3Rpb24oYyl7dGhpcy5wcmV2aW91cyE9PXRoaXMuZWxlbWVudC52YWwoKSYmdGhpcy5fdHJpZ2dlcihcImNoYW5nZVwiLGMse2l0ZW06dGhpcy5zZWxlY3RlZEl0ZW19KX0sX25vcm1hbGl6ZTpmdW5jdGlvbihjKXtpZihjLmxlbmd0aCYmY1swXS5sYWJlbCYmY1swXS52YWx1ZSlyZXR1cm4gYztyZXR1cm4gYS5tYXAoYyxmdW5jdGlvbihlKXtpZih0eXBlb2YgZT09PVwic3RyaW5nXCIpcmV0dXJue2xhYmVsOmUsdmFsdWU6ZX07cmV0dXJuIGEuZXh0ZW5kKHtsYWJlbDplLmxhYmVsfHxcbmUudmFsdWUsdmFsdWU6ZS52YWx1ZXx8ZS5sYWJlbH0sZSl9KX0sX3N1Z2dlc3Q6ZnVuY3Rpb24oYyl7dmFyIGU9dGhpcy5tZW51LmVsZW1lbnQuZW1wdHkoKS56SW5kZXgodGhpcy5lbGVtZW50LnpJbmRleCgpKzEpO3RoaXMuX3JlbmRlck1lbnUoZSxjKTt0aGlzLm1lbnUuZGVhY3RpdmF0ZSgpO3RoaXMubWVudS5yZWZyZXNoKCk7ZS5zaG93KCk7dGhpcy5fcmVzaXplTWVudSgpO2UucG9zaXRpb24oYS5leHRlbmQoe29mOnRoaXMuZWxlbWVudH0sdGhpcy5vcHRpb25zLnBvc2l0aW9uKSk7dGhpcy5vcHRpb25zLmF1dG9Gb2N1cyYmdGhpcy5tZW51Lm5leHQobmV3IGEuRXZlbnQoXCJtb3VzZW92ZXJcIikpfSxfcmVzaXplTWVudTpmdW5jdGlvbigpe3ZhciBjPXRoaXMubWVudS5lbGVtZW50O2Mub3V0ZXJXaWR0aChNYXRoLm1heChjLndpZHRoKFwiXCIpLm91dGVyV2lkdGgoKSx0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpKSl9LF9yZW5kZXJNZW51OmZ1bmN0aW9uKGMsZSl7dmFyIGg9dGhpcztcbmEuZWFjaChlLGZ1bmN0aW9uKGcsaSl7aC5fcmVuZGVySXRlbShjLGkpfSl9LF9yZW5kZXJJdGVtOmZ1bmN0aW9uKGMsZSl7cmV0dXJuIGEoXCI8bGk+PC9saT5cIikuZGF0YShcIml0ZW0uYXV0b2NvbXBsZXRlXCIsZSkuYXBwZW5kKGEoXCI8YT48L2E+XCIpLnRleHQoZS5sYWJlbCkpLmFwcGVuZFRvKGMpfSxfbW92ZTpmdW5jdGlvbihjLGUpe2lmKHRoaXMubWVudS5lbGVtZW50LmlzKFwiOnZpc2libGVcIikpaWYodGhpcy5tZW51LmZpcnN0KCkmJi9ecHJldmlvdXMvLnRlc3QoYyl8fHRoaXMubWVudS5sYXN0KCkmJi9ebmV4dC8udGVzdChjKSl7dGhpcy5lbGVtZW50LnZhbCh0aGlzLnRlcm0pO3RoaXMubWVudS5kZWFjdGl2YXRlKCl9ZWxzZSB0aGlzLm1lbnVbY10oZSk7ZWxzZSB0aGlzLnNlYXJjaChudWxsLGUpfSx3aWRnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tZW51LmVsZW1lbnR9fSk7YS5leHRlbmQoYS51aS5hdXRvY29tcGxldGUse2VzY2FwZVJlZ2V4OmZ1bmN0aW9uKGMpe3JldHVybiBjLnJlcGxhY2UoL1stW1xcXXt9KCkqKz8uLFxcXFxeJHwjXFxzXS9nLFxuXCJcXFxcJCZcIil9LGZpbHRlcjpmdW5jdGlvbihjLGUpe3ZhciBoPW5ldyBSZWdFeHAoYS51aS5hdXRvY29tcGxldGUuZXNjYXBlUmVnZXgoZSksXCJpXCIpO3JldHVybiBhLmdyZXAoYyxmdW5jdGlvbihnKXtyZXR1cm4gaC50ZXN0KGcubGFiZWx8fGcudmFsdWV8fGcpfSl9fSl9KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2Eud2lkZ2V0KFwidWkubWVudVwiLHtfY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIGQ9dGhpczt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1tZW51IHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsXCIpLmF0dHIoe3JvbGU6XCJsaXN0Ym94XCIsXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIjpcInVpLWFjdGl2ZS1tZW51aXRlbVwifSkuY2xpY2soZnVuY3Rpb24oYyl7aWYoYShjLnRhcmdldCkuY2xvc2VzdChcIi51aS1tZW51LWl0ZW0gYVwiKS5sZW5ndGgpe2MucHJldmVudERlZmF1bHQoKTtkLnNlbGVjdChjKX19KTt0aGlzLnJlZnJlc2goKX0scmVmcmVzaDpmdW5jdGlvbigpe3ZhciBkPXRoaXM7dGhpcy5lbGVtZW50LmNoaWxkcmVuKFwibGk6bm90KC51aS1tZW51LWl0ZW0pOmhhcyhhKVwiKS5hZGRDbGFzcyhcInVpLW1lbnUtaXRlbVwiKS5hdHRyKFwicm9sZVwiLFwibWVudWl0ZW1cIikuY2hpbGRyZW4oXCJhXCIpLmFkZENsYXNzKFwidWktY29ybmVyLWFsbFwiKS5hdHRyKFwidGFiaW5kZXhcIixcbi0xKS5tb3VzZWVudGVyKGZ1bmN0aW9uKGMpe2QuYWN0aXZhdGUoYyxhKHRoaXMpLnBhcmVudCgpKX0pLm1vdXNlbGVhdmUoZnVuY3Rpb24oKXtkLmRlYWN0aXZhdGUoKX0pfSxhY3RpdmF0ZTpmdW5jdGlvbihkLGMpe3RoaXMuZGVhY3RpdmF0ZSgpO2lmKHRoaXMuaGFzU2Nyb2xsKCkpe3ZhciBlPWMub2Zmc2V0KCkudG9wLXRoaXMuZWxlbWVudC5vZmZzZXQoKS50b3AsaD10aGlzLmVsZW1lbnQuc2Nyb2xsVG9wKCksZz10aGlzLmVsZW1lbnQuaGVpZ2h0KCk7aWYoZTwwKXRoaXMuZWxlbWVudC5zY3JvbGxUb3AoaCtlKTtlbHNlIGU+PWcmJnRoaXMuZWxlbWVudC5zY3JvbGxUb3AoaCtlLWcrYy5oZWlnaHQoKSl9dGhpcy5hY3RpdmU9Yy5lcSgwKS5jaGlsZHJlbihcImFcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKS5hdHRyKFwiaWRcIixcInVpLWFjdGl2ZS1tZW51aXRlbVwiKS5lbmQoKTt0aGlzLl90cmlnZ2VyKFwiZm9jdXNcIixkLHtpdGVtOmN9KX0sZGVhY3RpdmF0ZTpmdW5jdGlvbigpe2lmKHRoaXMuYWN0aXZlKXt0aGlzLmFjdGl2ZS5jaGlsZHJlbihcImFcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKS5yZW1vdmVBdHRyKFwiaWRcIik7XG50aGlzLl90cmlnZ2VyKFwiYmx1clwiKTt0aGlzLmFjdGl2ZT1udWxsfX0sbmV4dDpmdW5jdGlvbihkKXt0aGlzLm1vdmUoXCJuZXh0XCIsXCIudWktbWVudS1pdGVtOmZpcnN0XCIsZCl9LHByZXZpb3VzOmZ1bmN0aW9uKGQpe3RoaXMubW92ZShcInByZXZcIixcIi51aS1tZW51LWl0ZW06bGFzdFwiLGQpfSxmaXJzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmFjdGl2ZSYmIXRoaXMuYWN0aXZlLnByZXZBbGwoXCIudWktbWVudS1pdGVtXCIpLmxlbmd0aH0sbGFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmFjdGl2ZSYmIXRoaXMuYWN0aXZlLm5leHRBbGwoXCIudWktbWVudS1pdGVtXCIpLmxlbmd0aH0sbW92ZTpmdW5jdGlvbihkLGMsZSl7aWYodGhpcy5hY3RpdmUpe2Q9dGhpcy5hY3RpdmVbZCtcIkFsbFwiXShcIi51aS1tZW51LWl0ZW1cIikuZXEoMCk7ZC5sZW5ndGg/dGhpcy5hY3RpdmF0ZShlLGQpOnRoaXMuYWN0aXZhdGUoZSx0aGlzLmVsZW1lbnQuY2hpbGRyZW4oYykpfWVsc2UgdGhpcy5hY3RpdmF0ZShlLFxudGhpcy5lbGVtZW50LmNoaWxkcmVuKGMpKX0sbmV4dFBhZ2U6ZnVuY3Rpb24oZCl7aWYodGhpcy5oYXNTY3JvbGwoKSlpZighdGhpcy5hY3RpdmV8fHRoaXMubGFzdCgpKXRoaXMuYWN0aXZhdGUoZCx0aGlzLmVsZW1lbnQuY2hpbGRyZW4oXCIudWktbWVudS1pdGVtOmZpcnN0XCIpKTtlbHNle3ZhciBjPXRoaXMuYWN0aXZlLm9mZnNldCgpLnRvcCxlPXRoaXMuZWxlbWVudC5oZWlnaHQoKSxoPXRoaXMuZWxlbWVudC5jaGlsZHJlbihcIi51aS1tZW51LWl0ZW1cIikuZmlsdGVyKGZ1bmN0aW9uKCl7dmFyIGc9YSh0aGlzKS5vZmZzZXQoKS50b3AtYy1lK2EodGhpcykuaGVpZ2h0KCk7cmV0dXJuIGc8MTAmJmc+LTEwfSk7aC5sZW5ndGh8fChoPXRoaXMuZWxlbWVudC5jaGlsZHJlbihcIi51aS1tZW51LWl0ZW06bGFzdFwiKSk7dGhpcy5hY3RpdmF0ZShkLGgpfWVsc2UgdGhpcy5hY3RpdmF0ZShkLHRoaXMuZWxlbWVudC5jaGlsZHJlbihcIi51aS1tZW51LWl0ZW1cIikuZmlsdGVyKCF0aGlzLmFjdGl2ZXx8XG50aGlzLmxhc3QoKT9cIjpmaXJzdFwiOlwiOmxhc3RcIikpfSxwcmV2aW91c1BhZ2U6ZnVuY3Rpb24oZCl7aWYodGhpcy5oYXNTY3JvbGwoKSlpZighdGhpcy5hY3RpdmV8fHRoaXMuZmlyc3QoKSl0aGlzLmFjdGl2YXRlKGQsdGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLnVpLW1lbnUtaXRlbTpsYXN0XCIpKTtlbHNle3ZhciBjPXRoaXMuYWN0aXZlLm9mZnNldCgpLnRvcCxlPXRoaXMuZWxlbWVudC5oZWlnaHQoKTtyZXN1bHQ9dGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLnVpLW1lbnUtaXRlbVwiKS5maWx0ZXIoZnVuY3Rpb24oKXt2YXIgaD1hKHRoaXMpLm9mZnNldCgpLnRvcC1jK2UtYSh0aGlzKS5oZWlnaHQoKTtyZXR1cm4gaDwxMCYmaD4tMTB9KTtyZXN1bHQubGVuZ3RofHwocmVzdWx0PXRoaXMuZWxlbWVudC5jaGlsZHJlbihcIi51aS1tZW51LWl0ZW06Zmlyc3RcIikpO3RoaXMuYWN0aXZhdGUoZCxyZXN1bHQpfWVsc2UgdGhpcy5hY3RpdmF0ZShkLHRoaXMuZWxlbWVudC5jaGlsZHJlbihcIi51aS1tZW51LWl0ZW1cIikuZmlsdGVyKCF0aGlzLmFjdGl2ZXx8XG50aGlzLmZpcnN0KCk/XCI6bGFzdFwiOlwiOmZpcnN0XCIpKX0saGFzU2Nyb2xsOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWxlbWVudC5oZWlnaHQoKTx0aGlzLmVsZW1lbnRbYS5mbi5wcm9wP1wicHJvcFwiOlwiYXR0clwiXShcInNjcm9sbEhlaWdodFwiKX0sc2VsZWN0OmZ1bmN0aW9uKGQpe3RoaXMuX3RyaWdnZXIoXCJzZWxlY3RlZFwiLGQse2l0ZW06dGhpcy5hY3RpdmV9KX19KX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7dmFyIGQsYyxlLGgsZz1mdW5jdGlvbigpe3ZhciBiPWEodGhpcykuZmluZChcIjp1aS1idXR0b25cIik7c2V0VGltZW91dChmdW5jdGlvbigpe2IuYnV0dG9uKFwicmVmcmVzaFwiKX0sMSl9LGk9ZnVuY3Rpb24oYil7dmFyIGY9Yi5uYW1lLGo9Yi5mb3JtLGw9YShbXSk7aWYoZilsPWo/YShqKS5maW5kKFwiW25hbWU9J1wiK2YrXCInXVwiKTphKFwiW25hbWU9J1wiK2YrXCInXVwiLGIub3duZXJEb2N1bWVudCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMuZm9ybX0pO3JldHVybiBsfTthLndpZGdldChcInVpLmJ1dHRvblwiLHtvcHRpb25zOntkaXNhYmxlZDpudWxsLHRleHQ6dHJ1ZSxsYWJlbDpudWxsLGljb25zOntwcmltYXJ5Om51bGwsc2Vjb25kYXJ5Om51bGx9fSxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LmNsb3Nlc3QoXCJmb3JtXCIpLnVuYmluZChcInJlc2V0LmJ1dHRvblwiKS5iaW5kKFwicmVzZXQuYnV0dG9uXCIsZyk7aWYodHlwZW9mIHRoaXMub3B0aW9ucy5kaXNhYmxlZCE9PVxuXCJib29sZWFuXCIpdGhpcy5vcHRpb25zLmRpc2FibGVkPXRoaXMuZWxlbWVudC5wcm9wQXR0cihcImRpc2FibGVkXCIpO3RoaXMuX2RldGVybWluZUJ1dHRvblR5cGUoKTt0aGlzLmhhc1RpdGxlPSEhdGhpcy5idXR0b25FbGVtZW50LmF0dHIoXCJ0aXRsZVwiKTt2YXIgYj10aGlzLGY9dGhpcy5vcHRpb25zLGo9dGhpcy50eXBlPT09XCJjaGVja2JveFwifHx0aGlzLnR5cGU9PT1cInJhZGlvXCIsbD1cInVpLXN0YXRlLWhvdmVyXCIrKCFqP1wiIHVpLXN0YXRlLWFjdGl2ZVwiOlwiXCIpO2lmKGYubGFiZWw9PT1udWxsKWYubGFiZWw9dGhpcy5idXR0b25FbGVtZW50Lmh0bWwoKTtpZih0aGlzLmVsZW1lbnQuaXMoXCI6ZGlzYWJsZWRcIikpZi5kaXNhYmxlZD10cnVlO3RoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcyhcInVpLWJ1dHRvbiB1aS13aWRnZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsXCIpLmF0dHIoXCJyb2xlXCIsXCJidXR0b25cIikuYmluZChcIm1vdXNlZW50ZXIuYnV0dG9uXCIsZnVuY3Rpb24oKXtpZighZi5kaXNhYmxlZCl7YSh0aGlzKS5hZGRDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpO1xudGhpcz09PWQmJmEodGhpcykuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIil9fSkuYmluZChcIm1vdXNlbGVhdmUuYnV0dG9uXCIsZnVuY3Rpb24oKXtmLmRpc2FibGVkfHxhKHRoaXMpLnJlbW92ZUNsYXNzKGwpfSkuYmluZChcImNsaWNrLmJ1dHRvblwiLGZ1bmN0aW9uKG8pe2lmKGYuZGlzYWJsZWQpe28ucHJldmVudERlZmF1bHQoKTtvLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpfX0pO3RoaXMuZWxlbWVudC5iaW5kKFwiZm9jdXMuYnV0dG9uXCIsZnVuY3Rpb24oKXtiLmJ1dHRvbkVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX0pLmJpbmQoXCJibHVyLmJ1dHRvblwiLGZ1bmN0aW9uKCl7Yi5idXR0b25FbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9KTtpZihqKXt0aGlzLmVsZW1lbnQuYmluZChcImNoYW5nZS5idXR0b25cIixmdW5jdGlvbigpe2h8fGIucmVmcmVzaCgpfSk7dGhpcy5idXR0b25FbGVtZW50LmJpbmQoXCJtb3VzZWRvd24uYnV0dG9uXCIsZnVuY3Rpb24obyl7aWYoIWYuZGlzYWJsZWQpe2g9XG5mYWxzZTtjPW8ucGFnZVg7ZT1vLnBhZ2VZfX0pLmJpbmQoXCJtb3VzZXVwLmJ1dHRvblwiLGZ1bmN0aW9uKG8pe2lmKCFmLmRpc2FibGVkKWlmKGMhPT1vLnBhZ2VYfHxlIT09by5wYWdlWSloPXRydWV9KX1pZih0aGlzLnR5cGU9PT1cImNoZWNrYm94XCIpdGhpcy5idXR0b25FbGVtZW50LmJpbmQoXCJjbGljay5idXR0b25cIixmdW5jdGlvbigpe2lmKGYuZGlzYWJsZWR8fGgpcmV0dXJuIGZhbHNlO2EodGhpcykudG9nZ2xlQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIik7Yi5idXR0b25FbGVtZW50LmF0dHIoXCJhcmlhLXByZXNzZWRcIixiLmVsZW1lbnRbMF0uY2hlY2tlZCl9KTtlbHNlIGlmKHRoaXMudHlwZT09PVwicmFkaW9cIil0aGlzLmJ1dHRvbkVsZW1lbnQuYmluZChcImNsaWNrLmJ1dHRvblwiLGZ1bmN0aW9uKCl7aWYoZi5kaXNhYmxlZHx8aClyZXR1cm4gZmFsc2U7YSh0aGlzKS5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKTtiLmJ1dHRvbkVsZW1lbnQuYXR0cihcImFyaWEtcHJlc3NlZFwiLFwidHJ1ZVwiKTtcbnZhciBvPWIuZWxlbWVudFswXTtpKG8pLm5vdChvKS5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gYSh0aGlzKS5idXR0b24oXCJ3aWRnZXRcIilbMF19KS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKS5hdHRyKFwiYXJpYS1wcmVzc2VkXCIsXCJmYWxzZVwiKX0pO2Vsc2V7dGhpcy5idXR0b25FbGVtZW50LmJpbmQoXCJtb3VzZWRvd24uYnV0dG9uXCIsZnVuY3Rpb24oKXtpZihmLmRpc2FibGVkKXJldHVybiBmYWxzZTthKHRoaXMpLmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpO2Q9dGhpczthKGRvY3VtZW50KS5vbmUoXCJtb3VzZXVwXCIsZnVuY3Rpb24oKXtkPW51bGx9KX0pLmJpbmQoXCJtb3VzZXVwLmJ1dHRvblwiLGZ1bmN0aW9uKCl7aWYoZi5kaXNhYmxlZClyZXR1cm4gZmFsc2U7YSh0aGlzKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKX0pLmJpbmQoXCJrZXlkb3duLmJ1dHRvblwiLGZ1bmN0aW9uKG8pe2lmKGYuZGlzYWJsZWQpcmV0dXJuIGZhbHNlO2lmKG8ua2V5Q29kZT09YS51aS5rZXlDb2RlLlNQQUNFfHxcbm8ua2V5Q29kZT09YS51aS5rZXlDb2RlLkVOVEVSKWEodGhpcykuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIil9KS5iaW5kKFwia2V5dXAuYnV0dG9uXCIsZnVuY3Rpb24oKXthKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpfSk7dGhpcy5idXR0b25FbGVtZW50LmlzKFwiYVwiKSYmdGhpcy5idXR0b25FbGVtZW50LmtleXVwKGZ1bmN0aW9uKG8pe28ua2V5Q29kZT09PWEudWkua2V5Q29kZS5TUEFDRSYmYSh0aGlzKS5jbGljaygpfSl9dGhpcy5fc2V0T3B0aW9uKFwiZGlzYWJsZWRcIixmLmRpc2FibGVkKTt0aGlzLl9yZXNldEJ1dHRvbigpfSxfZGV0ZXJtaW5lQnV0dG9uVHlwZTpmdW5jdGlvbigpe3RoaXMudHlwZT10aGlzLmVsZW1lbnQuaXMoXCI6Y2hlY2tib3hcIik/XCJjaGVja2JveFwiOnRoaXMuZWxlbWVudC5pcyhcIjpyYWRpb1wiKT9cInJhZGlvXCI6dGhpcy5lbGVtZW50LmlzKFwiaW5wdXRcIik/XCJpbnB1dFwiOlwiYnV0dG9uXCI7aWYodGhpcy50eXBlPT09XCJjaGVja2JveFwifHx0aGlzLnR5cGU9PT1cblwicmFkaW9cIil7dmFyIGI9dGhpcy5lbGVtZW50LnBhcmVudHMoKS5maWx0ZXIoXCI6bGFzdFwiKSxmPVwibGFiZWxbZm9yPSdcIit0aGlzLmVsZW1lbnQuYXR0cihcImlkXCIpK1wiJ11cIjt0aGlzLmJ1dHRvbkVsZW1lbnQ9Yi5maW5kKGYpO2lmKCF0aGlzLmJ1dHRvbkVsZW1lbnQubGVuZ3RoKXtiPWIubGVuZ3RoP2Iuc2libGluZ3MoKTp0aGlzLmVsZW1lbnQuc2libGluZ3MoKTt0aGlzLmJ1dHRvbkVsZW1lbnQ9Yi5maWx0ZXIoZik7aWYoIXRoaXMuYnV0dG9uRWxlbWVudC5sZW5ndGgpdGhpcy5idXR0b25FbGVtZW50PWIuZmluZChmKX10aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1oZWxwZXItaGlkZGVuLWFjY2Vzc2libGVcIik7KGI9dGhpcy5lbGVtZW50LmlzKFwiOmNoZWNrZWRcIikpJiZ0aGlzLmJ1dHRvbkVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIik7dGhpcy5idXR0b25FbGVtZW50LmF0dHIoXCJhcmlhLXByZXNzZWRcIixiKX1lbHNlIHRoaXMuYnV0dG9uRWxlbWVudD10aGlzLmVsZW1lbnR9LFxud2lkZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYnV0dG9uRWxlbWVudH0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLWhlbHBlci1oaWRkZW4tYWNjZXNzaWJsZVwiKTt0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1idXR0b24gdWktd2lkZ2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1ob3ZlciB1aS1zdGF0ZS1hY3RpdmUgIHVpLWJ1dHRvbi1pY29ucy1vbmx5IHVpLWJ1dHRvbi1pY29uLW9ubHkgdWktYnV0dG9uLXRleHQtaWNvbnMgdWktYnV0dG9uLXRleHQtaWNvbi1wcmltYXJ5IHVpLWJ1dHRvbi10ZXh0LWljb24tc2Vjb25kYXJ5IHVpLWJ1dHRvbi10ZXh0LW9ubHlcIikucmVtb3ZlQXR0cihcInJvbGVcIikucmVtb3ZlQXR0cihcImFyaWEtcHJlc3NlZFwiKS5odG1sKHRoaXMuYnV0dG9uRWxlbWVudC5maW5kKFwiLnVpLWJ1dHRvbi10ZXh0XCIpLmh0bWwoKSk7dGhpcy5oYXNUaXRsZXx8dGhpcy5idXR0b25FbGVtZW50LnJlbW92ZUF0dHIoXCJ0aXRsZVwiKTtcbmEuV2lkZ2V0LnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyl9LF9zZXRPcHRpb246ZnVuY3Rpb24oYixmKXthLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7aWYoYj09PVwiZGlzYWJsZWRcIilmP3RoaXMuZWxlbWVudC5wcm9wQXR0cihcImRpc2FibGVkXCIsdHJ1ZSk6dGhpcy5lbGVtZW50LnByb3BBdHRyKFwiZGlzYWJsZWRcIixmYWxzZSk7ZWxzZSB0aGlzLl9yZXNldEJ1dHRvbigpfSxyZWZyZXNoOmZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5lbGVtZW50LmlzKFwiOmRpc2FibGVkXCIpO2IhPT10aGlzLm9wdGlvbnMuZGlzYWJsZWQmJnRoaXMuX3NldE9wdGlvbihcImRpc2FibGVkXCIsYik7aWYodGhpcy50eXBlPT09XCJyYWRpb1wiKWkodGhpcy5lbGVtZW50WzBdKS5lYWNoKGZ1bmN0aW9uKCl7YSh0aGlzKS5pcyhcIjpjaGVja2VkXCIpP2EodGhpcykuYnV0dG9uKFwid2lkZ2V0XCIpLmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpLmF0dHIoXCJhcmlhLXByZXNzZWRcIixcblwidHJ1ZVwiKTphKHRoaXMpLmJ1dHRvbihcIndpZGdldFwiKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKS5hdHRyKFwiYXJpYS1wcmVzc2VkXCIsXCJmYWxzZVwiKX0pO2Vsc2UgaWYodGhpcy50eXBlPT09XCJjaGVja2JveFwiKXRoaXMuZWxlbWVudC5pcyhcIjpjaGVja2VkXCIpP3RoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKS5hdHRyKFwiYXJpYS1wcmVzc2VkXCIsXCJ0cnVlXCIpOnRoaXMuYnV0dG9uRWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKS5hdHRyKFwiYXJpYS1wcmVzc2VkXCIsXCJmYWxzZVwiKX0sX3Jlc2V0QnV0dG9uOmZ1bmN0aW9uKCl7aWYodGhpcy50eXBlPT09XCJpbnB1dFwiKXRoaXMub3B0aW9ucy5sYWJlbCYmdGhpcy5lbGVtZW50LnZhbCh0aGlzLm9wdGlvbnMubGFiZWwpO2Vsc2V7dmFyIGI9dGhpcy5idXR0b25FbGVtZW50LnJlbW92ZUNsYXNzKFwidWktYnV0dG9uLWljb25zLW9ubHkgdWktYnV0dG9uLWljb24tb25seSB1aS1idXR0b24tdGV4dC1pY29ucyB1aS1idXR0b24tdGV4dC1pY29uLXByaW1hcnkgdWktYnV0dG9uLXRleHQtaWNvbi1zZWNvbmRhcnkgdWktYnV0dG9uLXRleHQtb25seVwiKSxcbmY9YShcIjxzcGFuPjwvc3Bhbj5cIikuYWRkQ2xhc3MoXCJ1aS1idXR0b24tdGV4dFwiKS5odG1sKHRoaXMub3B0aW9ucy5sYWJlbCkuYXBwZW5kVG8oYi5lbXB0eSgpKS50ZXh0KCksaj10aGlzLm9wdGlvbnMuaWNvbnMsbD1qLnByaW1hcnkmJmouc2Vjb25kYXJ5LG89W107aWYoai5wcmltYXJ5fHxqLnNlY29uZGFyeSl7aWYodGhpcy5vcHRpb25zLnRleHQpby5wdXNoKFwidWktYnV0dG9uLXRleHQtaWNvblwiKyhsP1wic1wiOmoucHJpbWFyeT9cIi1wcmltYXJ5XCI6XCItc2Vjb25kYXJ5XCIpKTtqLnByaW1hcnkmJmIucHJlcGVuZChcIjxzcGFuIGNsYXNzPSd1aS1idXR0b24taWNvbi1wcmltYXJ5IHVpLWljb24gXCIrai5wcmltYXJ5K1wiJz48L3NwYW4+XCIpO2ouc2Vjb25kYXJ5JiZiLmFwcGVuZChcIjxzcGFuIGNsYXNzPSd1aS1idXR0b24taWNvbi1zZWNvbmRhcnkgdWktaWNvbiBcIitqLnNlY29uZGFyeStcIic+PC9zcGFuPlwiKTtpZighdGhpcy5vcHRpb25zLnRleHQpe28ucHVzaChsP1widWktYnV0dG9uLWljb25zLW9ubHlcIjpcblwidWktYnV0dG9uLWljb24tb25seVwiKTt0aGlzLmhhc1RpdGxlfHxiLmF0dHIoXCJ0aXRsZVwiLGYpfX1lbHNlIG8ucHVzaChcInVpLWJ1dHRvbi10ZXh0LW9ubHlcIik7Yi5hZGRDbGFzcyhvLmpvaW4oXCIgXCIpKX19fSk7YS53aWRnZXQoXCJ1aS5idXR0b25zZXRcIix7b3B0aW9uczp7aXRlbXM6XCI6YnV0dG9uLCA6c3VibWl0LCA6cmVzZXQsIDpjaGVja2JveCwgOnJhZGlvLCBhLCA6ZGF0YShidXR0b24pXCJ9LF9jcmVhdGU6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1idXR0b25zZXRcIil9LF9pbml0OmZ1bmN0aW9uKCl7dGhpcy5yZWZyZXNoKCl9LF9zZXRPcHRpb246ZnVuY3Rpb24oYixmKXtiPT09XCJkaXNhYmxlZFwiJiZ0aGlzLmJ1dHRvbnMuYnV0dG9uKFwib3B0aW9uXCIsYixmKTthLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHJlZnJlc2g6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLmVsZW1lbnQuY3NzKFwiZGlyZWN0aW9uXCIpPT09XG5cImx0clwiO3RoaXMuYnV0dG9ucz10aGlzLmVsZW1lbnQuZmluZCh0aGlzLm9wdGlvbnMuaXRlbXMpLmZpbHRlcihcIjp1aS1idXR0b25cIikuYnV0dG9uKFwicmVmcmVzaFwiKS5lbmQoKS5ub3QoXCI6dWktYnV0dG9uXCIpLmJ1dHRvbigpLmVuZCgpLm1hcChmdW5jdGlvbigpe3JldHVybiBhKHRoaXMpLmJ1dHRvbihcIndpZGdldFwiKVswXX0pLnJlbW92ZUNsYXNzKFwidWktY29ybmVyLWFsbCB1aS1jb3JuZXItbGVmdCB1aS1jb3JuZXItcmlnaHRcIikuZmlsdGVyKFwiOmZpcnN0XCIpLmFkZENsYXNzKGI/XCJ1aS1jb3JuZXItbGVmdFwiOlwidWktY29ybmVyLXJpZ2h0XCIpLmVuZCgpLmZpbHRlcihcIjpsYXN0XCIpLmFkZENsYXNzKGI/XCJ1aS1jb3JuZXItcmlnaHRcIjpcInVpLWNvcm5lci1sZWZ0XCIpLmVuZCgpLmVuZCgpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktYnV0dG9uc2V0XCIpO3RoaXMuYnV0dG9ucy5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gYSh0aGlzKS5idXR0b24oXCJ3aWRnZXRcIilbMF19KS5yZW1vdmVDbGFzcyhcInVpLWNvcm5lci1sZWZ0IHVpLWNvcm5lci1yaWdodFwiKS5lbmQoKS5idXR0b24oXCJkZXN0cm95XCIpO1xuYS5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKX19KX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSxkKXtmdW5jdGlvbiBjKCl7dGhpcy5kZWJ1Zz1mYWxzZTt0aGlzLl9jdXJJbnN0PW51bGw7dGhpcy5fa2V5RXZlbnQ9ZmFsc2U7dGhpcy5fZGlzYWJsZWRJbnB1dHM9W107dGhpcy5faW5EaWFsb2c9dGhpcy5fZGF0ZXBpY2tlclNob3dpbmc9ZmFsc2U7dGhpcy5fbWFpbkRpdklkPVwidWktZGF0ZXBpY2tlci1kaXZcIjt0aGlzLl9pbmxpbmVDbGFzcz1cInVpLWRhdGVwaWNrZXItaW5saW5lXCI7dGhpcy5fYXBwZW5kQ2xhc3M9XCJ1aS1kYXRlcGlja2VyLWFwcGVuZFwiO3RoaXMuX3RyaWdnZXJDbGFzcz1cInVpLWRhdGVwaWNrZXItdHJpZ2dlclwiO3RoaXMuX2RpYWxvZ0NsYXNzPVwidWktZGF0ZXBpY2tlci1kaWFsb2dcIjt0aGlzLl9kaXNhYmxlQ2xhc3M9XCJ1aS1kYXRlcGlja2VyLWRpc2FibGVkXCI7dGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3M9XCJ1aS1kYXRlcGlja2VyLXVuc2VsZWN0YWJsZVwiO3RoaXMuX2N1cnJlbnRDbGFzcz1cInVpLWRhdGVwaWNrZXItY3VycmVudC1kYXlcIjt0aGlzLl9kYXlPdmVyQ2xhc3M9XG5cInVpLWRhdGVwaWNrZXItZGF5cy1jZWxsLW92ZXJcIjt0aGlzLnJlZ2lvbmFsPVtdO3RoaXMucmVnaW9uYWxbXCJcIl09e2Nsb3NlVGV4dDpcIkRvbmVcIixwcmV2VGV4dDpcIlByZXZcIixuZXh0VGV4dDpcIk5leHRcIixjdXJyZW50VGV4dDpcIlRvZGF5XCIsbW9udGhOYW1lczpbXCJKYW51YXJ5XCIsXCJGZWJydWFyeVwiLFwiTWFyY2hcIixcIkFwcmlsXCIsXCJNYXlcIixcIkp1bmVcIixcIkp1bHlcIixcIkF1Z3VzdFwiLFwiU2VwdGVtYmVyXCIsXCJPY3RvYmVyXCIsXCJOb3ZlbWJlclwiLFwiRGVjZW1iZXJcIl0sbW9udGhOYW1lc1Nob3J0OltcIkphblwiLFwiRmViXCIsXCJNYXJcIixcIkFwclwiLFwiTWF5XCIsXCJKdW5cIixcIkp1bFwiLFwiQXVnXCIsXCJTZXBcIixcIk9jdFwiLFwiTm92XCIsXCJEZWNcIl0sZGF5TmFtZXM6W1wiU3VuZGF5XCIsXCJNb25kYXlcIixcIlR1ZXNkYXlcIixcIldlZG5lc2RheVwiLFwiVGh1cnNkYXlcIixcIkZyaWRheVwiLFwiU2F0dXJkYXlcIl0sZGF5TmFtZXNTaG9ydDpbXCJTdW5cIixcIk1vblwiLFwiVHVlXCIsXCJXZWRcIixcIlRodVwiLFwiRnJpXCIsXCJTYXRcIl0sZGF5TmFtZXNNaW46W1wiU3VcIixcblwiTW9cIixcIlR1XCIsXCJXZVwiLFwiVGhcIixcIkZyXCIsXCJTYVwiXSx3ZWVrSGVhZGVyOlwiV2tcIixkYXRlRm9ybWF0OlwibW0vZGQveXlcIixmaXJzdERheTowLGlzUlRMOmZhbHNlLHNob3dNb250aEFmdGVyWWVhcjpmYWxzZSx5ZWFyU3VmZml4OlwiXCJ9O3RoaXMuX2RlZmF1bHRzPXtzaG93T246XCJmb2N1c1wiLHNob3dBbmltOlwiZmFkZUluXCIsc2hvd09wdGlvbnM6e30sZGVmYXVsdERhdGU6bnVsbCxhcHBlbmRUZXh0OlwiXCIsYnV0dG9uVGV4dDpcIi4uLlwiLGJ1dHRvbkltYWdlOlwiXCIsYnV0dG9uSW1hZ2VPbmx5OmZhbHNlLGhpZGVJZk5vUHJldk5leHQ6ZmFsc2UsbmF2aWdhdGlvbkFzRGF0ZUZvcm1hdDpmYWxzZSxnb3RvQ3VycmVudDpmYWxzZSxjaGFuZ2VNb250aDpmYWxzZSxjaGFuZ2VZZWFyOmZhbHNlLHllYXJSYW5nZTpcImMtMTA6YysxMFwiLHNob3dPdGhlck1vbnRoczpmYWxzZSxzZWxlY3RPdGhlck1vbnRoczpmYWxzZSxzaG93V2VlazpmYWxzZSxjYWxjdWxhdGVXZWVrOnRoaXMuaXNvODYwMVdlZWssc2hvcnRZZWFyQ3V0b2ZmOlwiKzEwXCIsXG5taW5EYXRlOm51bGwsbWF4RGF0ZTpudWxsLGR1cmF0aW9uOlwiZmFzdFwiLGJlZm9yZVNob3dEYXk6bnVsbCxiZWZvcmVTaG93Om51bGwsb25TZWxlY3Q6bnVsbCxvbkNoYW5nZU1vbnRoWWVhcjpudWxsLG9uQ2xvc2U6bnVsbCxudW1iZXJPZk1vbnRoczoxLHNob3dDdXJyZW50QXRQb3M6MCxzdGVwTW9udGhzOjEsc3RlcEJpZ01vbnRoczoxMixhbHRGaWVsZDpcIlwiLGFsdEZvcm1hdDpcIlwiLGNvbnN0cmFpbklucHV0OnRydWUsc2hvd0J1dHRvblBhbmVsOmZhbHNlLGF1dG9TaXplOmZhbHNlLGRpc2FibGVkOmZhbHNlfTthLmV4dGVuZCh0aGlzLl9kZWZhdWx0cyx0aGlzLnJlZ2lvbmFsW1wiXCJdKTt0aGlzLmRwRGl2PWUoYSgnPGRpdiBpZD1cIicrdGhpcy5fbWFpbkRpdklkKydcIiBjbGFzcz1cInVpLWRhdGVwaWNrZXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWhlbHBlci1jbGVhcmZpeCB1aS1jb3JuZXItYWxsXCI+PC9kaXY+JykpfWZ1bmN0aW9uIGUoYil7cmV0dXJuIGIuYmluZChcIm1vdXNlb3V0XCIsXG5mdW5jdGlvbihmKXtmPWEoZi50YXJnZXQpLmNsb3Nlc3QoXCJidXR0b24sIC51aS1kYXRlcGlja2VyLXByZXYsIC51aS1kYXRlcGlja2VyLW5leHQsIC51aS1kYXRlcGlja2VyLWNhbGVuZGFyIHRkIGFcIik7Zi5sZW5ndGgmJmYucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlciB1aS1kYXRlcGlja2VyLXByZXYtaG92ZXIgdWktZGF0ZXBpY2tlci1uZXh0LWhvdmVyXCIpfSkuYmluZChcIm1vdXNlb3ZlclwiLGZ1bmN0aW9uKGYpe2Y9YShmLnRhcmdldCkuY2xvc2VzdChcImJ1dHRvbiwgLnVpLWRhdGVwaWNrZXItcHJldiwgLnVpLWRhdGVwaWNrZXItbmV4dCwgLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIgdGQgYVwiKTtpZighKGEuZGF0ZXBpY2tlci5faXNEaXNhYmxlZERhdGVwaWNrZXIoaS5pbmxpbmU/Yi5wYXJlbnQoKVswXTppLmlucHV0WzBdKXx8IWYubGVuZ3RoKSl7Zi5wYXJlbnRzKFwiLnVpLWRhdGVwaWNrZXItY2FsZW5kYXJcIikuZmluZChcImFcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKTtcbmYuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKTtmLmhhc0NsYXNzKFwidWktZGF0ZXBpY2tlci1wcmV2XCIpJiZmLmFkZENsYXNzKFwidWktZGF0ZXBpY2tlci1wcmV2LWhvdmVyXCIpO2YuaGFzQ2xhc3MoXCJ1aS1kYXRlcGlja2VyLW5leHRcIikmJmYuYWRkQ2xhc3MoXCJ1aS1kYXRlcGlja2VyLW5leHQtaG92ZXJcIil9fSl9ZnVuY3Rpb24gaChiLGYpe2EuZXh0ZW5kKGIsZik7Zm9yKHZhciBqIGluIGYpaWYoZltqXT09bnVsbHx8ZltqXT09ZCliW2pdPWZbal07cmV0dXJuIGJ9YS5leHRlbmQoYS51aSx7ZGF0ZXBpY2tlcjp7dmVyc2lvbjpcIjEuOC4xNlwifX0pO3ZhciBnPShuZXcgRGF0ZSkuZ2V0VGltZSgpLGk7YS5leHRlbmQoYy5wcm90b3R5cGUse21hcmtlckNsYXNzTmFtZTpcImhhc0RhdGVwaWNrZXJcIixtYXhSb3dzOjQsbG9nOmZ1bmN0aW9uKCl7dGhpcy5kZWJ1ZyYmY29uc29sZS5sb2cuYXBwbHkoXCJcIixhcmd1bWVudHMpfSxfd2lkZ2V0RGF0ZXBpY2tlcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRwRGl2fSxcbnNldERlZmF1bHRzOmZ1bmN0aW9uKGIpe2godGhpcy5fZGVmYXVsdHMsYnx8e30pO3JldHVybiB0aGlzfSxfYXR0YWNoRGF0ZXBpY2tlcjpmdW5jdGlvbihiLGYpe3ZhciBqPW51bGw7Zm9yKHZhciBsIGluIHRoaXMuX2RlZmF1bHRzKXt2YXIgbz1iLmdldEF0dHJpYnV0ZShcImRhdGU6XCIrbCk7aWYobyl7aj1qfHx7fTt0cnl7altsXT1ldmFsKG8pfWNhdGNoKG4pe2pbbF09b319fWw9Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO289bD09XCJkaXZcInx8bD09XCJzcGFuXCI7aWYoIWIuaWQpe3RoaXMudXVpZCs9MTtiLmlkPVwiZHBcIit0aGlzLnV1aWR9dmFyIGs9dGhpcy5fbmV3SW5zdChhKGIpLG8pO2suc2V0dGluZ3M9YS5leHRlbmQoe30sZnx8e30sanx8e30pO2lmKGw9PVwiaW5wdXRcIil0aGlzLl9jb25uZWN0RGF0ZXBpY2tlcihiLGspO2Vsc2UgbyYmdGhpcy5faW5saW5lRGF0ZXBpY2tlcihiLGspfSxfbmV3SW5zdDpmdW5jdGlvbihiLGYpe3JldHVybntpZDpiWzBdLmlkLnJlcGxhY2UoLyhbXkEtWmEtejAtOV8tXSkvZyxcblwiXFxcXFxcXFwkMVwiKSxpbnB1dDpiLHNlbGVjdGVkRGF5OjAsc2VsZWN0ZWRNb250aDowLHNlbGVjdGVkWWVhcjowLGRyYXdNb250aDowLGRyYXdZZWFyOjAsaW5saW5lOmYsZHBEaXY6IWY/dGhpcy5kcERpdjplKGEoJzxkaXYgY2xhc3M9XCInK3RoaXMuX2lubGluZUNsYXNzKycgdWktZGF0ZXBpY2tlciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktaGVscGVyLWNsZWFyZml4IHVpLWNvcm5lci1hbGxcIj48L2Rpdj4nKSl9fSxfY29ubmVjdERhdGVwaWNrZXI6ZnVuY3Rpb24oYixmKXt2YXIgaj1hKGIpO2YuYXBwZW5kPWEoW10pO2YudHJpZ2dlcj1hKFtdKTtpZighai5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpe3RoaXMuX2F0dGFjaG1lbnRzKGosZik7ai5hZGRDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkua2V5ZG93bih0aGlzLl9kb0tleURvd24pLmtleXByZXNzKHRoaXMuX2RvS2V5UHJlc3MpLmtleXVwKHRoaXMuX2RvS2V5VXApLmJpbmQoXCJzZXREYXRhLmRhdGVwaWNrZXJcIixcbmZ1bmN0aW9uKGwsbyxuKXtmLnNldHRpbmdzW29dPW59KS5iaW5kKFwiZ2V0RGF0YS5kYXRlcGlja2VyXCIsZnVuY3Rpb24obCxvKXtyZXR1cm4gdGhpcy5fZ2V0KGYsbyl9KTt0aGlzLl9hdXRvU2l6ZShmKTthLmRhdGEoYixcImRhdGVwaWNrZXJcIixmKTtmLnNldHRpbmdzLmRpc2FibGVkJiZ0aGlzLl9kaXNhYmxlRGF0ZXBpY2tlcihiKX19LF9hdHRhY2htZW50czpmdW5jdGlvbihiLGYpe3ZhciBqPXRoaXMuX2dldChmLFwiYXBwZW5kVGV4dFwiKSxsPXRoaXMuX2dldChmLFwiaXNSVExcIik7Zi5hcHBlbmQmJmYuYXBwZW5kLnJlbW92ZSgpO2lmKGope2YuYXBwZW5kPWEoJzxzcGFuIGNsYXNzPVwiJyt0aGlzLl9hcHBlbmRDbGFzcysnXCI+JytqK1wiPC9zcGFuPlwiKTtiW2w/XCJiZWZvcmVcIjpcImFmdGVyXCJdKGYuYXBwZW5kKX1iLnVuYmluZChcImZvY3VzXCIsdGhpcy5fc2hvd0RhdGVwaWNrZXIpO2YudHJpZ2dlciYmZi50cmlnZ2VyLnJlbW92ZSgpO2o9dGhpcy5fZ2V0KGYsXCJzaG93T25cIik7aWYoaj09XG5cImZvY3VzXCJ8fGo9PVwiYm90aFwiKWIuZm9jdXModGhpcy5fc2hvd0RhdGVwaWNrZXIpO2lmKGo9PVwiYnV0dG9uXCJ8fGo9PVwiYm90aFwiKXtqPXRoaXMuX2dldChmLFwiYnV0dG9uVGV4dFwiKTt2YXIgbz10aGlzLl9nZXQoZixcImJ1dHRvbkltYWdlXCIpO2YudHJpZ2dlcj1hKHRoaXMuX2dldChmLFwiYnV0dG9uSW1hZ2VPbmx5XCIpP2EoXCI8aW1nLz5cIikuYWRkQ2xhc3ModGhpcy5fdHJpZ2dlckNsYXNzKS5hdHRyKHtzcmM6byxhbHQ6aix0aXRsZTpqfSk6YSgnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCI+PC9idXR0b24+JykuYWRkQ2xhc3ModGhpcy5fdHJpZ2dlckNsYXNzKS5odG1sKG89PVwiXCI/ajphKFwiPGltZy8+XCIpLmF0dHIoe3NyYzpvLGFsdDpqLHRpdGxlOmp9KSkpO2JbbD9cImJlZm9yZVwiOlwiYWZ0ZXJcIl0oZi50cmlnZ2VyKTtmLnRyaWdnZXIuY2xpY2soZnVuY3Rpb24oKXthLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nJiZhLmRhdGVwaWNrZXIuX2xhc3RJbnB1dD09YlswXT9hLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk6XG5hLmRhdGVwaWNrZXIuX3Nob3dEYXRlcGlja2VyKGJbMF0pO3JldHVybiBmYWxzZX0pfX0sX2F1dG9TaXplOmZ1bmN0aW9uKGIpe2lmKHRoaXMuX2dldChiLFwiYXV0b1NpemVcIikmJiFiLmlubGluZSl7dmFyIGY9bmV3IERhdGUoMjAwOSwxMSwyMCksaj10aGlzLl9nZXQoYixcImRhdGVGb3JtYXRcIik7aWYoai5tYXRjaCgvW0RNXS8pKXt2YXIgbD1mdW5jdGlvbihvKXtmb3IodmFyIG49MCxrPTAsbT0wO208by5sZW5ndGg7bSsrKWlmKG9bbV0ubGVuZ3RoPm4pe249b1ttXS5sZW5ndGg7az1tfXJldHVybiBrfTtmLnNldE1vbnRoKGwodGhpcy5fZ2V0KGIsai5tYXRjaCgvTU0vKT9cIm1vbnRoTmFtZXNcIjpcIm1vbnRoTmFtZXNTaG9ydFwiKSkpO2Yuc2V0RGF0ZShsKHRoaXMuX2dldChiLGoubWF0Y2goL0RELyk/XCJkYXlOYW1lc1wiOlwiZGF5TmFtZXNTaG9ydFwiKSkrMjAtZi5nZXREYXkoKSl9Yi5pbnB1dC5hdHRyKFwic2l6ZVwiLHRoaXMuX2Zvcm1hdERhdGUoYixmKS5sZW5ndGgpfX0sX2lubGluZURhdGVwaWNrZXI6ZnVuY3Rpb24oYixcbmYpe3ZhciBqPWEoYik7aWYoIWouaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpKXtqLmFkZENsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS5hcHBlbmQoZi5kcERpdikuYmluZChcInNldERhdGEuZGF0ZXBpY2tlclwiLGZ1bmN0aW9uKGwsbyxuKXtmLnNldHRpbmdzW29dPW59KS5iaW5kKFwiZ2V0RGF0YS5kYXRlcGlja2VyXCIsZnVuY3Rpb24obCxvKXtyZXR1cm4gdGhpcy5fZ2V0KGYsbyl9KTthLmRhdGEoYixcImRhdGVwaWNrZXJcIixmKTt0aGlzLl9zZXREYXRlKGYsdGhpcy5fZ2V0RGVmYXVsdERhdGUoZiksdHJ1ZSk7dGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihmKTt0aGlzLl91cGRhdGVBbHRlcm5hdGUoZik7Zi5zZXR0aW5ncy5kaXNhYmxlZCYmdGhpcy5fZGlzYWJsZURhdGVwaWNrZXIoYik7Zi5kcERpdi5jc3MoXCJkaXNwbGF5XCIsXCJibG9ja1wiKX19LF9kaWFsb2dEYXRlcGlja2VyOmZ1bmN0aW9uKGIsZixqLGwsbyl7Yj10aGlzLl9kaWFsb2dJbnN0O2lmKCFiKXt0aGlzLnV1aWQrPVxuMTt0aGlzLl9kaWFsb2dJbnB1dD1hKCc8aW5wdXQgdHlwZT1cInRleHRcIiBpZD1cIicrKFwiZHBcIit0aGlzLnV1aWQpKydcIiBzdHlsZT1cInBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAtMTAwcHg7IHdpZHRoOiAwcHg7IHotaW5kZXg6IC0xMDtcIi8+Jyk7dGhpcy5fZGlhbG9nSW5wdXQua2V5ZG93bih0aGlzLl9kb0tleURvd24pO2EoXCJib2R5XCIpLmFwcGVuZCh0aGlzLl9kaWFsb2dJbnB1dCk7Yj10aGlzLl9kaWFsb2dJbnN0PXRoaXMuX25ld0luc3QodGhpcy5fZGlhbG9nSW5wdXQsZmFsc2UpO2Iuc2V0dGluZ3M9e307YS5kYXRhKHRoaXMuX2RpYWxvZ0lucHV0WzBdLFwiZGF0ZXBpY2tlclwiLGIpfWgoYi5zZXR0aW5ncyxsfHx7fSk7Zj1mJiZmLmNvbnN0cnVjdG9yPT1EYXRlP3RoaXMuX2Zvcm1hdERhdGUoYixmKTpmO3RoaXMuX2RpYWxvZ0lucHV0LnZhbChmKTt0aGlzLl9wb3M9bz9vLmxlbmd0aD9vOltvLnBhZ2VYLG8ucGFnZVldOm51bGw7aWYoIXRoaXMuX3Bvcyl0aGlzLl9wb3M9W2RvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aC9cbjItMTAwKyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdHx8ZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0KSxkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LzItMTUwKyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wfHxkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCldO3RoaXMuX2RpYWxvZ0lucHV0LmNzcyhcImxlZnRcIix0aGlzLl9wb3NbMF0rMjArXCJweFwiKS5jc3MoXCJ0b3BcIix0aGlzLl9wb3NbMV0rXCJweFwiKTtiLnNldHRpbmdzLm9uU2VsZWN0PWo7dGhpcy5faW5EaWFsb2c9dHJ1ZTt0aGlzLmRwRGl2LmFkZENsYXNzKHRoaXMuX2RpYWxvZ0NsYXNzKTt0aGlzLl9zaG93RGF0ZXBpY2tlcih0aGlzLl9kaWFsb2dJbnB1dFswXSk7YS5ibG9ja1VJJiZhLmJsb2NrVUkodGhpcy5kcERpdik7YS5kYXRhKHRoaXMuX2RpYWxvZ0lucHV0WzBdLFwiZGF0ZXBpY2tlclwiLGIpO3JldHVybiB0aGlzfSxfZGVzdHJveURhdGVwaWNrZXI6ZnVuY3Rpb24oYil7dmFyIGY9XG5hKGIpLGo9YS5kYXRhKGIsXCJkYXRlcGlja2VyXCIpO2lmKGYuaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpKXt2YXIgbD1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7YS5yZW1vdmVEYXRhKGIsXCJkYXRlcGlja2VyXCIpO2lmKGw9PVwiaW5wdXRcIil7ai5hcHBlbmQucmVtb3ZlKCk7ai50cmlnZ2VyLnJlbW92ZSgpO2YucmVtb3ZlQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpLnVuYmluZChcImZvY3VzXCIsdGhpcy5fc2hvd0RhdGVwaWNrZXIpLnVuYmluZChcImtleWRvd25cIix0aGlzLl9kb0tleURvd24pLnVuYmluZChcImtleXByZXNzXCIsdGhpcy5fZG9LZXlQcmVzcykudW5iaW5kKFwia2V5dXBcIix0aGlzLl9kb0tleVVwKX1lbHNlIGlmKGw9PVwiZGl2XCJ8fGw9PVwic3BhblwiKWYucmVtb3ZlQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpLmVtcHR5KCl9fSxfZW5hYmxlRGF0ZXBpY2tlcjpmdW5jdGlvbihiKXt2YXIgZj1hKGIpLGo9YS5kYXRhKGIsXCJkYXRlcGlja2VyXCIpO2lmKGYuaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpKXt2YXIgbD1cbmIubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtpZihsPT1cImlucHV0XCIpe2IuZGlzYWJsZWQ9ZmFsc2U7ai50cmlnZ2VyLmZpbHRlcihcImJ1dHRvblwiKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5kaXNhYmxlZD1mYWxzZX0pLmVuZCgpLmZpbHRlcihcImltZ1wiKS5jc3Moe29wYWNpdHk6XCIxLjBcIixjdXJzb3I6XCJcIn0pfWVsc2UgaWYobD09XCJkaXZcInx8bD09XCJzcGFuXCIpe2Y9Zi5jaGlsZHJlbihcIi5cIit0aGlzLl9pbmxpbmVDbGFzcyk7Zi5jaGlsZHJlbigpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZGlzYWJsZWRcIik7Zi5maW5kKFwic2VsZWN0LnVpLWRhdGVwaWNrZXItbW9udGgsIHNlbGVjdC51aS1kYXRlcGlja2VyLXllYXJcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpfXRoaXMuX2Rpc2FibGVkSW5wdXRzPWEubWFwKHRoaXMuX2Rpc2FibGVkSW5wdXRzLGZ1bmN0aW9uKG8pe3JldHVybiBvPT1iP251bGw6b30pfX0sX2Rpc2FibGVEYXRlcGlja2VyOmZ1bmN0aW9uKGIpe3ZhciBmPWEoYiksaj1hLmRhdGEoYixcblwiZGF0ZXBpY2tlclwiKTtpZihmLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSl7dmFyIGw9Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmKGw9PVwiaW5wdXRcIil7Yi5kaXNhYmxlZD10cnVlO2oudHJpZ2dlci5maWx0ZXIoXCJidXR0b25cIikuZWFjaChmdW5jdGlvbigpe3RoaXMuZGlzYWJsZWQ9dHJ1ZX0pLmVuZCgpLmZpbHRlcihcImltZ1wiKS5jc3Moe29wYWNpdHk6XCIwLjVcIixjdXJzb3I6XCJkZWZhdWx0XCJ9KX1lbHNlIGlmKGw9PVwiZGl2XCJ8fGw9PVwic3BhblwiKXtmPWYuY2hpbGRyZW4oXCIuXCIrdGhpcy5faW5saW5lQ2xhc3MpO2YuY2hpbGRyZW4oKS5hZGRDbGFzcyhcInVpLXN0YXRlLWRpc2FibGVkXCIpO2YuZmluZChcInNlbGVjdC51aS1kYXRlcGlja2VyLW1vbnRoLCBzZWxlY3QudWktZGF0ZXBpY2tlci15ZWFyXCIpLmF0dHIoXCJkaXNhYmxlZFwiLFwiZGlzYWJsZWRcIil9dGhpcy5fZGlzYWJsZWRJbnB1dHM9YS5tYXAodGhpcy5fZGlzYWJsZWRJbnB1dHMsZnVuY3Rpb24obyl7cmV0dXJuIG89PVxuYj9udWxsOm99KTt0aGlzLl9kaXNhYmxlZElucHV0c1t0aGlzLl9kaXNhYmxlZElucHV0cy5sZW5ndGhdPWJ9fSxfaXNEaXNhYmxlZERhdGVwaWNrZXI6ZnVuY3Rpb24oYil7aWYoIWIpcmV0dXJuIGZhbHNlO2Zvcih2YXIgZj0wO2Y8dGhpcy5fZGlzYWJsZWRJbnB1dHMubGVuZ3RoO2YrKylpZih0aGlzLl9kaXNhYmxlZElucHV0c1tmXT09YilyZXR1cm4gdHJ1ZTtyZXR1cm4gZmFsc2V9LF9nZXRJbnN0OmZ1bmN0aW9uKGIpe3RyeXtyZXR1cm4gYS5kYXRhKGIsXCJkYXRlcGlja2VyXCIpfWNhdGNoKGYpe3Rocm93XCJNaXNzaW5nIGluc3RhbmNlIGRhdGEgZm9yIHRoaXMgZGF0ZXBpY2tlclwiO319LF9vcHRpb25EYXRlcGlja2VyOmZ1bmN0aW9uKGIsZixqKXt2YXIgbD10aGlzLl9nZXRJbnN0KGIpO2lmKGFyZ3VtZW50cy5sZW5ndGg9PTImJnR5cGVvZiBmPT1cInN0cmluZ1wiKXJldHVybiBmPT1cImRlZmF1bHRzXCI/YS5leHRlbmQoe30sYS5kYXRlcGlja2VyLl9kZWZhdWx0cyk6bD9mPT1cImFsbFwiP1xuYS5leHRlbmQoe30sbC5zZXR0aW5ncyk6dGhpcy5fZ2V0KGwsZik6bnVsbDt2YXIgbz1mfHx7fTtpZih0eXBlb2YgZj09XCJzdHJpbmdcIil7bz17fTtvW2ZdPWp9aWYobCl7dGhpcy5fY3VySW5zdD09bCYmdGhpcy5faGlkZURhdGVwaWNrZXIoKTt2YXIgbj10aGlzLl9nZXREYXRlRGF0ZXBpY2tlcihiLHRydWUpLGs9dGhpcy5fZ2V0TWluTWF4RGF0ZShsLFwibWluXCIpLG09dGhpcy5fZ2V0TWluTWF4RGF0ZShsLFwibWF4XCIpO2gobC5zZXR0aW5ncyxvKTtpZihrIT09bnVsbCYmby5kYXRlRm9ybWF0IT09ZCYmby5taW5EYXRlPT09ZClsLnNldHRpbmdzLm1pbkRhdGU9dGhpcy5fZm9ybWF0RGF0ZShsLGspO2lmKG0hPT1udWxsJiZvLmRhdGVGb3JtYXQhPT1kJiZvLm1heERhdGU9PT1kKWwuc2V0dGluZ3MubWF4RGF0ZT10aGlzLl9mb3JtYXREYXRlKGwsbSk7dGhpcy5fYXR0YWNobWVudHMoYShiKSxsKTt0aGlzLl9hdXRvU2l6ZShsKTt0aGlzLl9zZXREYXRlKGwsbik7dGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGwpO1xudGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihsKX19LF9jaGFuZ2VEYXRlcGlja2VyOmZ1bmN0aW9uKGIsZixqKXt0aGlzLl9vcHRpb25EYXRlcGlja2VyKGIsZixqKX0sX3JlZnJlc2hEYXRlcGlja2VyOmZ1bmN0aW9uKGIpeyhiPXRoaXMuX2dldEluc3QoYikpJiZ0aGlzLl91cGRhdGVEYXRlcGlja2VyKGIpfSxfc2V0RGF0ZURhdGVwaWNrZXI6ZnVuY3Rpb24oYixmKXtpZihiPXRoaXMuX2dldEluc3QoYikpe3RoaXMuX3NldERhdGUoYixmKTt0aGlzLl91cGRhdGVEYXRlcGlja2VyKGIpO3RoaXMuX3VwZGF0ZUFsdGVybmF0ZShiKX19LF9nZXREYXRlRGF0ZXBpY2tlcjpmdW5jdGlvbihiLGYpeyhiPXRoaXMuX2dldEluc3QoYikpJiYhYi5pbmxpbmUmJnRoaXMuX3NldERhdGVGcm9tRmllbGQoYixmKTtyZXR1cm4gYj90aGlzLl9nZXREYXRlKGIpOm51bGx9LF9kb0tleURvd246ZnVuY3Rpb24oYil7dmFyIGY9YS5kYXRlcGlja2VyLl9nZXRJbnN0KGIudGFyZ2V0KSxqPXRydWUsbD1mLmRwRGl2LmlzKFwiLnVpLWRhdGVwaWNrZXItcnRsXCIpO1xuZi5fa2V5RXZlbnQ9dHJ1ZTtpZihhLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nKXN3aXRjaChiLmtleUNvZGUpe2Nhc2UgOTphLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7aj1mYWxzZTticmVhaztjYXNlIDEzOmo9YShcInRkLlwiK2EuZGF0ZXBpY2tlci5fZGF5T3ZlckNsYXNzK1wiOm5vdCguXCIrYS5kYXRlcGlja2VyLl9jdXJyZW50Q2xhc3MrXCIpXCIsZi5kcERpdik7alswXSYmYS5kYXRlcGlja2VyLl9zZWxlY3REYXkoYi50YXJnZXQsZi5zZWxlY3RlZE1vbnRoLGYuc2VsZWN0ZWRZZWFyLGpbMF0pO2lmKGI9YS5kYXRlcGlja2VyLl9nZXQoZixcIm9uU2VsZWN0XCIpKXtqPWEuZGF0ZXBpY2tlci5fZm9ybWF0RGF0ZShmKTtiLmFwcGx5KGYuaW5wdXQ/Zi5pbnB1dFswXTpudWxsLFtqLGZdKX1lbHNlIGEuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKTtyZXR1cm4gZmFsc2U7Y2FzZSAyNzphLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7YnJlYWs7Y2FzZSAzMzphLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYi50YXJnZXQsXG5iLmN0cmxLZXk/LWEuZGF0ZXBpY2tlci5fZ2V0KGYsXCJzdGVwQmlnTW9udGhzXCIpOi1hLmRhdGVwaWNrZXIuX2dldChmLFwic3RlcE1vbnRoc1wiKSxcIk1cIik7YnJlYWs7Y2FzZSAzNDphLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYi50YXJnZXQsYi5jdHJsS2V5PythLmRhdGVwaWNrZXIuX2dldChmLFwic3RlcEJpZ01vbnRoc1wiKTorYS5kYXRlcGlja2VyLl9nZXQoZixcInN0ZXBNb250aHNcIiksXCJNXCIpO2JyZWFrO2Nhc2UgMzU6aWYoYi5jdHJsS2V5fHxiLm1ldGFLZXkpYS5kYXRlcGlja2VyLl9jbGVhckRhdGUoYi50YXJnZXQpO2o9Yi5jdHJsS2V5fHxiLm1ldGFLZXk7YnJlYWs7Y2FzZSAzNjppZihiLmN0cmxLZXl8fGIubWV0YUtleSlhLmRhdGVwaWNrZXIuX2dvdG9Ub2RheShiLnRhcmdldCk7aj1iLmN0cmxLZXl8fGIubWV0YUtleTticmVhaztjYXNlIDM3OmlmKGIuY3RybEtleXx8Yi5tZXRhS2V5KWEuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShiLnRhcmdldCxsPysxOi0xLFwiRFwiKTtqPVxuYi5jdHJsS2V5fHxiLm1ldGFLZXk7aWYoYi5vcmlnaW5hbEV2ZW50LmFsdEtleSlhLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYi50YXJnZXQsYi5jdHJsS2V5Py1hLmRhdGVwaWNrZXIuX2dldChmLFwic3RlcEJpZ01vbnRoc1wiKTotYS5kYXRlcGlja2VyLl9nZXQoZixcInN0ZXBNb250aHNcIiksXCJNXCIpO2JyZWFrO2Nhc2UgMzg6aWYoYi5jdHJsS2V5fHxiLm1ldGFLZXkpYS5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGIudGFyZ2V0LC03LFwiRFwiKTtqPWIuY3RybEtleXx8Yi5tZXRhS2V5O2JyZWFrO2Nhc2UgMzk6aWYoYi5jdHJsS2V5fHxiLm1ldGFLZXkpYS5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGIudGFyZ2V0LGw/LTE6KzEsXCJEXCIpO2o9Yi5jdHJsS2V5fHxiLm1ldGFLZXk7aWYoYi5vcmlnaW5hbEV2ZW50LmFsdEtleSlhLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYi50YXJnZXQsYi5jdHJsS2V5PythLmRhdGVwaWNrZXIuX2dldChmLFwic3RlcEJpZ01vbnRoc1wiKTorYS5kYXRlcGlja2VyLl9nZXQoZixcblwic3RlcE1vbnRoc1wiKSxcIk1cIik7YnJlYWs7Y2FzZSA0MDppZihiLmN0cmxLZXl8fGIubWV0YUtleSlhLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYi50YXJnZXQsKzcsXCJEXCIpO2o9Yi5jdHJsS2V5fHxiLm1ldGFLZXk7YnJlYWs7ZGVmYXVsdDpqPWZhbHNlfWVsc2UgaWYoYi5rZXlDb2RlPT0zNiYmYi5jdHJsS2V5KWEuZGF0ZXBpY2tlci5fc2hvd0RhdGVwaWNrZXIodGhpcyk7ZWxzZSBqPWZhbHNlO2lmKGope2IucHJldmVudERlZmF1bHQoKTtiLnN0b3BQcm9wYWdhdGlvbigpfX0sX2RvS2V5UHJlc3M6ZnVuY3Rpb24oYil7dmFyIGY9YS5kYXRlcGlja2VyLl9nZXRJbnN0KGIudGFyZ2V0KTtpZihhLmRhdGVwaWNrZXIuX2dldChmLFwiY29uc3RyYWluSW5wdXRcIikpe2Y9YS5kYXRlcGlja2VyLl9wb3NzaWJsZUNoYXJzKGEuZGF0ZXBpY2tlci5fZ2V0KGYsXCJkYXRlRm9ybWF0XCIpKTt2YXIgaj1TdHJpbmcuZnJvbUNoYXJDb2RlKGIuY2hhckNvZGU9PWQ/Yi5rZXlDb2RlOmIuY2hhckNvZGUpO1xucmV0dXJuIGIuY3RybEtleXx8Yi5tZXRhS2V5fHxqPFwiIFwifHwhZnx8Zi5pbmRleE9mKGopPi0xfX0sX2RvS2V5VXA6ZnVuY3Rpb24oYil7Yj1hLmRhdGVwaWNrZXIuX2dldEluc3QoYi50YXJnZXQpO2lmKGIuaW5wdXQudmFsKCkhPWIubGFzdFZhbCl0cnl7aWYoYS5kYXRlcGlja2VyLnBhcnNlRGF0ZShhLmRhdGVwaWNrZXIuX2dldChiLFwiZGF0ZUZvcm1hdFwiKSxiLmlucHV0P2IuaW5wdXQudmFsKCk6bnVsbCxhLmRhdGVwaWNrZXIuX2dldEZvcm1hdENvbmZpZyhiKSkpe2EuZGF0ZXBpY2tlci5fc2V0RGF0ZUZyb21GaWVsZChiKTthLmRhdGVwaWNrZXIuX3VwZGF0ZUFsdGVybmF0ZShiKTthLmRhdGVwaWNrZXIuX3VwZGF0ZURhdGVwaWNrZXIoYil9fWNhdGNoKGYpe2EuZGF0ZXBpY2tlci5sb2coZil9cmV0dXJuIHRydWV9LF9zaG93RGF0ZXBpY2tlcjpmdW5jdGlvbihiKXtiPWIudGFyZ2V0fHxiO2lmKGIubm9kZU5hbWUudG9Mb3dlckNhc2UoKSE9XCJpbnB1dFwiKWI9YShcImlucHV0XCIsXG5iLnBhcmVudE5vZGUpWzBdO2lmKCEoYS5kYXRlcGlja2VyLl9pc0Rpc2FibGVkRGF0ZXBpY2tlcihiKXx8YS5kYXRlcGlja2VyLl9sYXN0SW5wdXQ9PWIpKXt2YXIgZj1hLmRhdGVwaWNrZXIuX2dldEluc3QoYik7aWYoYS5kYXRlcGlja2VyLl9jdXJJbnN0JiZhLmRhdGVwaWNrZXIuX2N1ckluc3QhPWYpe2EuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcmJmEuZGF0ZXBpY2tlci5fdHJpZ2dlck9uQ2xvc2UoYS5kYXRlcGlja2VyLl9jdXJJbnN0KTthLmRhdGVwaWNrZXIuX2N1ckluc3QuZHBEaXYuc3RvcCh0cnVlLHRydWUpfXZhciBqPWEuZGF0ZXBpY2tlci5fZ2V0KGYsXCJiZWZvcmVTaG93XCIpO2o9aj9qLmFwcGx5KGIsW2IsZl0pOnt9O2lmKGohPT1mYWxzZSl7aChmLnNldHRpbmdzLGopO2YubGFzdFZhbD1udWxsO2EuZGF0ZXBpY2tlci5fbGFzdElucHV0PWI7YS5kYXRlcGlja2VyLl9zZXREYXRlRnJvbUZpZWxkKGYpO2lmKGEuZGF0ZXBpY2tlci5faW5EaWFsb2cpYi52YWx1ZT1cblwiXCI7aWYoIWEuZGF0ZXBpY2tlci5fcG9zKXthLmRhdGVwaWNrZXIuX3Bvcz1hLmRhdGVwaWNrZXIuX2ZpbmRQb3MoYik7YS5kYXRlcGlja2VyLl9wb3NbMV0rPWIub2Zmc2V0SGVpZ2h0fXZhciBsPWZhbHNlO2EoYikucGFyZW50cygpLmVhY2goZnVuY3Rpb24oKXtsfD1hKHRoaXMpLmNzcyhcInBvc2l0aW9uXCIpPT1cImZpeGVkXCI7cmV0dXJuIWx9KTtpZihsJiZhLmJyb3dzZXIub3BlcmEpe2EuZGF0ZXBpY2tlci5fcG9zWzBdLT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdDthLmRhdGVwaWNrZXIuX3Bvc1sxXS09ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcH1qPXtsZWZ0OmEuZGF0ZXBpY2tlci5fcG9zWzBdLHRvcDphLmRhdGVwaWNrZXIuX3Bvc1sxXX07YS5kYXRlcGlja2VyLl9wb3M9bnVsbDtmLmRwRGl2LmVtcHR5KCk7Zi5kcERpdi5jc3Moe3Bvc2l0aW9uOlwiYWJzb2x1dGVcIixkaXNwbGF5OlwiYmxvY2tcIix0b3A6XCItMTAwMHB4XCJ9KTthLmRhdGVwaWNrZXIuX3VwZGF0ZURhdGVwaWNrZXIoZik7XG5qPWEuZGF0ZXBpY2tlci5fY2hlY2tPZmZzZXQoZixqLGwpO2YuZHBEaXYuY3NzKHtwb3NpdGlvbjphLmRhdGVwaWNrZXIuX2luRGlhbG9nJiZhLmJsb2NrVUk/XCJzdGF0aWNcIjpsP1wiZml4ZWRcIjpcImFic29sdXRlXCIsZGlzcGxheTpcIm5vbmVcIixsZWZ0OmoubGVmdCtcInB4XCIsdG9wOmoudG9wK1wicHhcIn0pO2lmKCFmLmlubGluZSl7aj1hLmRhdGVwaWNrZXIuX2dldChmLFwic2hvd0FuaW1cIik7dmFyIG89YS5kYXRlcGlja2VyLl9nZXQoZixcImR1cmF0aW9uXCIpLG49ZnVuY3Rpb24oKXt2YXIgaz1mLmRwRGl2LmZpbmQoXCJpZnJhbWUudWktZGF0ZXBpY2tlci1jb3ZlclwiKTtpZihrLmxlbmd0aCl7dmFyIG09YS5kYXRlcGlja2VyLl9nZXRCb3JkZXJzKGYuZHBEaXYpO2suY3NzKHtsZWZ0Oi1tWzBdLHRvcDotbVsxXSx3aWR0aDpmLmRwRGl2Lm91dGVyV2lkdGgoKSxoZWlnaHQ6Zi5kcERpdi5vdXRlckhlaWdodCgpfSl9fTtmLmRwRGl2LnpJbmRleChhKGIpLnpJbmRleCgpKzEpO2EuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmc9XG50cnVlO2EuZWZmZWN0cyYmYS5lZmZlY3RzW2pdP2YuZHBEaXYuc2hvdyhqLGEuZGF0ZXBpY2tlci5fZ2V0KGYsXCJzaG93T3B0aW9uc1wiKSxvLG4pOmYuZHBEaXZbanx8XCJzaG93XCJdKGo/bzpudWxsLG4pO2lmKCFqfHwhbyluKCk7Zi5pbnB1dC5pcyhcIjp2aXNpYmxlXCIpJiYhZi5pbnB1dC5pcyhcIjpkaXNhYmxlZFwiKSYmZi5pbnB1dC5mb2N1cygpO2EuZGF0ZXBpY2tlci5fY3VySW5zdD1mfX19fSxfdXBkYXRlRGF0ZXBpY2tlcjpmdW5jdGlvbihiKXt0aGlzLm1heFJvd3M9NDt2YXIgZj1hLmRhdGVwaWNrZXIuX2dldEJvcmRlcnMoYi5kcERpdik7aT1iO2IuZHBEaXYuZW1wdHkoKS5hcHBlbmQodGhpcy5fZ2VuZXJhdGVIVE1MKGIpKTt2YXIgaj1iLmRwRGl2LmZpbmQoXCJpZnJhbWUudWktZGF0ZXBpY2tlci1jb3ZlclwiKTtqLmxlbmd0aCYmai5jc3Moe2xlZnQ6LWZbMF0sdG9wOi1mWzFdLHdpZHRoOmIuZHBEaXYub3V0ZXJXaWR0aCgpLGhlaWdodDpiLmRwRGl2Lm91dGVySGVpZ2h0KCl9KTtcbmIuZHBEaXYuZmluZChcIi5cIit0aGlzLl9kYXlPdmVyQ2xhc3MrXCIgYVwiKS5tb3VzZW92ZXIoKTtmPXRoaXMuX2dldE51bWJlck9mTW9udGhzKGIpO2o9ZlsxXTtiLmRwRGl2LnJlbW92ZUNsYXNzKFwidWktZGF0ZXBpY2tlci1tdWx0aS0yIHVpLWRhdGVwaWNrZXItbXVsdGktMyB1aS1kYXRlcGlja2VyLW11bHRpLTRcIikud2lkdGgoXCJcIik7aj4xJiZiLmRwRGl2LmFkZENsYXNzKFwidWktZGF0ZXBpY2tlci1tdWx0aS1cIitqKS5jc3MoXCJ3aWR0aFwiLDE3KmorXCJlbVwiKTtiLmRwRGl2WyhmWzBdIT0xfHxmWzFdIT0xP1wiYWRkXCI6XCJyZW1vdmVcIikrXCJDbGFzc1wiXShcInVpLWRhdGVwaWNrZXItbXVsdGlcIik7Yi5kcERpdlsodGhpcy5fZ2V0KGIsXCJpc1JUTFwiKT9cImFkZFwiOlwicmVtb3ZlXCIpK1wiQ2xhc3NcIl0oXCJ1aS1kYXRlcGlja2VyLXJ0bFwiKTtiPT1hLmRhdGVwaWNrZXIuX2N1ckluc3QmJmEuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcmJmIuaW5wdXQmJmIuaW5wdXQuaXMoXCI6dmlzaWJsZVwiKSYmXG4hYi5pbnB1dC5pcyhcIjpkaXNhYmxlZFwiKSYmYi5pbnB1dFswXSE9ZG9jdW1lbnQuYWN0aXZlRWxlbWVudCYmYi5pbnB1dC5mb2N1cygpO2lmKGIueWVhcnNodG1sKXt2YXIgbD1iLnllYXJzaHRtbDtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7bD09PWIueWVhcnNodG1sJiZiLnllYXJzaHRtbCYmYi5kcERpdi5maW5kKFwic2VsZWN0LnVpLWRhdGVwaWNrZXIteWVhcjpmaXJzdFwiKS5yZXBsYWNlV2l0aChiLnllYXJzaHRtbCk7bD1iLnllYXJzaHRtbD1udWxsfSwwKX19LF9nZXRCb3JkZXJzOmZ1bmN0aW9uKGIpe3ZhciBmPWZ1bmN0aW9uKGope3JldHVybnt0aGluOjEsbWVkaXVtOjIsdGhpY2s6M31bal18fGp9O3JldHVybltwYXJzZUZsb2F0KGYoYi5jc3MoXCJib3JkZXItbGVmdC13aWR0aFwiKSkpLHBhcnNlRmxvYXQoZihiLmNzcyhcImJvcmRlci10b3Atd2lkdGhcIikpKV19LF9jaGVja09mZnNldDpmdW5jdGlvbihiLGYsail7dmFyIGw9Yi5kcERpdi5vdXRlcldpZHRoKCksbz1iLmRwRGl2Lm91dGVySGVpZ2h0KCksXG5uPWIuaW5wdXQ/Yi5pbnB1dC5vdXRlcldpZHRoKCk6MCxrPWIuaW5wdXQ/Yi5pbnB1dC5vdXRlckhlaWdodCgpOjAsbT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgrYShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpLHA9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCthKGRvY3VtZW50KS5zY3JvbGxUb3AoKTtmLmxlZnQtPXRoaXMuX2dldChiLFwiaXNSVExcIik/bC1uOjA7Zi5sZWZ0LT1qJiZmLmxlZnQ9PWIuaW5wdXQub2Zmc2V0KCkubGVmdD9hKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCk6MDtmLnRvcC09aiYmZi50b3A9PWIuaW5wdXQub2Zmc2V0KCkudG9wK2s/YShkb2N1bWVudCkuc2Nyb2xsVG9wKCk6MDtmLmxlZnQtPU1hdGgubWluKGYubGVmdCxmLmxlZnQrbD5tJiZtPmw/TWF0aC5hYnMoZi5sZWZ0K2wtbSk6MCk7Zi50b3AtPU1hdGgubWluKGYudG9wLGYudG9wK28+cCYmcD5vP01hdGguYWJzKG8rayk6MCk7cmV0dXJuIGZ9LF9maW5kUG9zOmZ1bmN0aW9uKGIpe2Zvcih2YXIgZj1cbnRoaXMuX2dldCh0aGlzLl9nZXRJbnN0KGIpLFwiaXNSVExcIik7YiYmKGIudHlwZT09XCJoaWRkZW5cInx8Yi5ub2RlVHlwZSE9MXx8YS5leHByLmZpbHRlcnMuaGlkZGVuKGIpKTspYj1iW2Y/XCJwcmV2aW91c1NpYmxpbmdcIjpcIm5leHRTaWJsaW5nXCJdO2I9YShiKS5vZmZzZXQoKTtyZXR1cm5bYi5sZWZ0LGIudG9wXX0sX3RyaWdnZXJPbkNsb3NlOmZ1bmN0aW9uKGIpe3ZhciBmPXRoaXMuX2dldChiLFwib25DbG9zZVwiKTtpZihmKWYuYXBwbHkoYi5pbnB1dD9iLmlucHV0WzBdOm51bGwsW2IuaW5wdXQ/Yi5pbnB1dC52YWwoKTpcIlwiLGJdKX0sX2hpZGVEYXRlcGlja2VyOmZ1bmN0aW9uKGIpe3ZhciBmPXRoaXMuX2N1ckluc3Q7aWYoISghZnx8YiYmZiE9YS5kYXRhKGIsXCJkYXRlcGlja2VyXCIpKSlpZih0aGlzLl9kYXRlcGlja2VyU2hvd2luZyl7Yj10aGlzLl9nZXQoZixcInNob3dBbmltXCIpO3ZhciBqPXRoaXMuX2dldChmLFwiZHVyYXRpb25cIiksbD1mdW5jdGlvbigpe2EuZGF0ZXBpY2tlci5fdGlkeURpYWxvZyhmKTtcbnRoaXMuX2N1ckluc3Q9bnVsbH07YS5lZmZlY3RzJiZhLmVmZmVjdHNbYl0/Zi5kcERpdi5oaWRlKGIsYS5kYXRlcGlja2VyLl9nZXQoZixcInNob3dPcHRpb25zXCIpLGosbCk6Zi5kcERpdltiPT1cInNsaWRlRG93blwiP1wic2xpZGVVcFwiOmI9PVwiZmFkZUluXCI/XCJmYWRlT3V0XCI6XCJoaWRlXCJdKGI/ajpudWxsLGwpO2J8fGwoKTthLmRhdGVwaWNrZXIuX3RyaWdnZXJPbkNsb3NlKGYpO3RoaXMuX2RhdGVwaWNrZXJTaG93aW5nPWZhbHNlO3RoaXMuX2xhc3RJbnB1dD1udWxsO2lmKHRoaXMuX2luRGlhbG9nKXt0aGlzLl9kaWFsb2dJbnB1dC5jc3Moe3Bvc2l0aW9uOlwiYWJzb2x1dGVcIixsZWZ0OlwiMFwiLHRvcDpcIi0xMDBweFwifSk7aWYoYS5ibG9ja1VJKXthLnVuYmxvY2tVSSgpO2EoXCJib2R5XCIpLmFwcGVuZCh0aGlzLmRwRGl2KX19dGhpcy5faW5EaWFsb2c9ZmFsc2V9fSxfdGlkeURpYWxvZzpmdW5jdGlvbihiKXtiLmRwRGl2LnJlbW92ZUNsYXNzKHRoaXMuX2RpYWxvZ0NsYXNzKS51bmJpbmQoXCIudWktZGF0ZXBpY2tlci1jYWxlbmRhclwiKX0sXG5fY2hlY2tFeHRlcm5hbENsaWNrOmZ1bmN0aW9uKGIpe2lmKGEuZGF0ZXBpY2tlci5fY3VySW5zdCl7Yj1hKGIudGFyZ2V0KTtiWzBdLmlkIT1hLmRhdGVwaWNrZXIuX21haW5EaXZJZCYmYi5wYXJlbnRzKFwiI1wiK2EuZGF0ZXBpY2tlci5fbWFpbkRpdklkKS5sZW5ndGg9PTAmJiFiLmhhc0NsYXNzKGEuZGF0ZXBpY2tlci5tYXJrZXJDbGFzc05hbWUpJiYhYi5oYXNDbGFzcyhhLmRhdGVwaWNrZXIuX3RyaWdnZXJDbGFzcykmJmEuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcmJiEoYS5kYXRlcGlja2VyLl9pbkRpYWxvZyYmYS5ibG9ja1VJKSYmYS5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpfX0sX2FkanVzdERhdGU6ZnVuY3Rpb24oYixmLGope2I9YShiKTt2YXIgbD10aGlzLl9nZXRJbnN0KGJbMF0pO2lmKCF0aGlzLl9pc0Rpc2FibGVkRGF0ZXBpY2tlcihiWzBdKSl7dGhpcy5fYWRqdXN0SW5zdERhdGUobCxmKyhqPT1cIk1cIj90aGlzLl9nZXQobCxcInNob3dDdXJyZW50QXRQb3NcIik6XG4wKSxqKTt0aGlzLl91cGRhdGVEYXRlcGlja2VyKGwpfX0sX2dvdG9Ub2RheTpmdW5jdGlvbihiKXtiPWEoYik7dmFyIGY9dGhpcy5fZ2V0SW5zdChiWzBdKTtpZih0aGlzLl9nZXQoZixcImdvdG9DdXJyZW50XCIpJiZmLmN1cnJlbnREYXkpe2Yuc2VsZWN0ZWREYXk9Zi5jdXJyZW50RGF5O2YuZHJhd01vbnRoPWYuc2VsZWN0ZWRNb250aD1mLmN1cnJlbnRNb250aDtmLmRyYXdZZWFyPWYuc2VsZWN0ZWRZZWFyPWYuY3VycmVudFllYXJ9ZWxzZXt2YXIgaj1uZXcgRGF0ZTtmLnNlbGVjdGVkRGF5PWouZ2V0RGF0ZSgpO2YuZHJhd01vbnRoPWYuc2VsZWN0ZWRNb250aD1qLmdldE1vbnRoKCk7Zi5kcmF3WWVhcj1mLnNlbGVjdGVkWWVhcj1qLmdldEZ1bGxZZWFyKCl9dGhpcy5fbm90aWZ5Q2hhbmdlKGYpO3RoaXMuX2FkanVzdERhdGUoYil9LF9zZWxlY3RNb250aFllYXI6ZnVuY3Rpb24oYixmLGope2I9YShiKTt2YXIgbD10aGlzLl9nZXRJbnN0KGJbMF0pO2xbXCJzZWxlY3RlZFwiKyhqPT1cIk1cIj9cblwiTW9udGhcIjpcIlllYXJcIildPWxbXCJkcmF3XCIrKGo9PVwiTVwiP1wiTW9udGhcIjpcIlllYXJcIildPXBhcnNlSW50KGYub3B0aW9uc1tmLnNlbGVjdGVkSW5kZXhdLnZhbHVlLDEwKTt0aGlzLl9ub3RpZnlDaGFuZ2UobCk7dGhpcy5fYWRqdXN0RGF0ZShiKX0sX3NlbGVjdERheTpmdW5jdGlvbihiLGYsaixsKXt2YXIgbz1hKGIpO2lmKCEoYShsKS5oYXNDbGFzcyh0aGlzLl91bnNlbGVjdGFibGVDbGFzcyl8fHRoaXMuX2lzRGlzYWJsZWREYXRlcGlja2VyKG9bMF0pKSl7bz10aGlzLl9nZXRJbnN0KG9bMF0pO28uc2VsZWN0ZWREYXk9by5jdXJyZW50RGF5PWEoXCJhXCIsbCkuaHRtbCgpO28uc2VsZWN0ZWRNb250aD1vLmN1cnJlbnRNb250aD1mO28uc2VsZWN0ZWRZZWFyPW8uY3VycmVudFllYXI9ajt0aGlzLl9zZWxlY3REYXRlKGIsdGhpcy5fZm9ybWF0RGF0ZShvLG8uY3VycmVudERheSxvLmN1cnJlbnRNb250aCxvLmN1cnJlbnRZZWFyKSl9fSxfY2xlYXJEYXRlOmZ1bmN0aW9uKGIpe2I9YShiKTtcbnRoaXMuX2dldEluc3QoYlswXSk7dGhpcy5fc2VsZWN0RGF0ZShiLFwiXCIpfSxfc2VsZWN0RGF0ZTpmdW5jdGlvbihiLGYpe2I9dGhpcy5fZ2V0SW5zdChhKGIpWzBdKTtmPWYhPW51bGw/Zjp0aGlzLl9mb3JtYXREYXRlKGIpO2IuaW5wdXQmJmIuaW5wdXQudmFsKGYpO3RoaXMuX3VwZGF0ZUFsdGVybmF0ZShiKTt2YXIgaj10aGlzLl9nZXQoYixcIm9uU2VsZWN0XCIpO2lmKGopai5hcHBseShiLmlucHV0P2IuaW5wdXRbMF06bnVsbCxbZixiXSk7ZWxzZSBiLmlucHV0JiZiLmlucHV0LnRyaWdnZXIoXCJjaGFuZ2VcIik7aWYoYi5pbmxpbmUpdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihiKTtlbHNle3RoaXMuX2hpZGVEYXRlcGlja2VyKCk7dGhpcy5fbGFzdElucHV0PWIuaW5wdXRbMF07dHlwZW9mIGIuaW5wdXRbMF0hPVwib2JqZWN0XCImJmIuaW5wdXQuZm9jdXMoKTt0aGlzLl9sYXN0SW5wdXQ9bnVsbH19LF91cGRhdGVBbHRlcm5hdGU6ZnVuY3Rpb24oYil7dmFyIGY9dGhpcy5fZ2V0KGIsXCJhbHRGaWVsZFwiKTtcbmlmKGYpe3ZhciBqPXRoaXMuX2dldChiLFwiYWx0Rm9ybWF0XCIpfHx0aGlzLl9nZXQoYixcImRhdGVGb3JtYXRcIiksbD10aGlzLl9nZXREYXRlKGIpLG89dGhpcy5mb3JtYXREYXRlKGosbCx0aGlzLl9nZXRGb3JtYXRDb25maWcoYikpO2EoZikuZWFjaChmdW5jdGlvbigpe2EodGhpcykudmFsKG8pfSl9fSxub1dlZWtlbmRzOmZ1bmN0aW9uKGIpe2I9Yi5nZXREYXkoKTtyZXR1cm5bYj4wJiZiPDYsXCJcIl19LGlzbzg2MDFXZWVrOmZ1bmN0aW9uKGIpe2I9bmV3IERhdGUoYi5nZXRUaW1lKCkpO2Iuc2V0RGF0ZShiLmdldERhdGUoKSs0LShiLmdldERheSgpfHw3KSk7dmFyIGY9Yi5nZXRUaW1lKCk7Yi5zZXRNb250aCgwKTtiLnNldERhdGUoMSk7cmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yb3VuZCgoZi1iKS84NjRFNSkvNykrMX0scGFyc2VEYXRlOmZ1bmN0aW9uKGIsZixqKXtpZihiPT1udWxsfHxmPT1udWxsKXRocm93XCJJbnZhbGlkIGFyZ3VtZW50c1wiO2Y9dHlwZW9mIGY9PVwib2JqZWN0XCI/XG5mLnRvU3RyaW5nKCk6ZitcIlwiO2lmKGY9PVwiXCIpcmV0dXJuIG51bGw7dmFyIGw9KGo/ai5zaG9ydFllYXJDdXRvZmY6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLnNob3J0WWVhckN1dG9mZjtsPXR5cGVvZiBsIT1cInN0cmluZ1wiP2w6KG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpJTEwMCtwYXJzZUludChsLDEwKTtmb3IodmFyIG89KGo/ai5kYXlOYW1lc1Nob3J0Om51bGwpfHx0aGlzLl9kZWZhdWx0cy5kYXlOYW1lc1Nob3J0LG49KGo/ai5kYXlOYW1lczpudWxsKXx8dGhpcy5fZGVmYXVsdHMuZGF5TmFtZXMsaz0oaj9qLm1vbnRoTmFtZXNTaG9ydDpudWxsKXx8dGhpcy5fZGVmYXVsdHMubW9udGhOYW1lc1Nob3J0LG09KGo/ai5tb250aE5hbWVzOm51bGwpfHx0aGlzLl9kZWZhdWx0cy5tb250aE5hbWVzLHA9aj0tMSxxPS0xLHM9LTEscj1mYWxzZSx1PWZ1bmN0aW9uKHopeyh6PUgrMTxiLmxlbmd0aCYmYi5jaGFyQXQoSCsxKT09eikmJkgrKztyZXR1cm4gen0sdj1mdW5jdGlvbih6KXt2YXIgST1cbnUoeik7ej1uZXcgUmVnRXhwKFwiXlxcXFxkezEsXCIrKHo9PVwiQFwiPzE0Ono9PVwiIVwiPzIwOno9PVwieVwiJiZJPzQ6ej09XCJvXCI/MzoyKStcIn1cIik7ej1mLnN1YnN0cmluZyh5KS5tYXRjaCh6KTtpZigheil0aHJvd1wiTWlzc2luZyBudW1iZXIgYXQgcG9zaXRpb24gXCIreTt5Kz16WzBdLmxlbmd0aDtyZXR1cm4gcGFyc2VJbnQoelswXSwxMCl9LHc9ZnVuY3Rpb24oeixJLE4pe3o9YS5tYXAodSh6KT9OOkksZnVuY3Rpb24oRCxFKXtyZXR1cm5bW0UsRF1dfSkuc29ydChmdW5jdGlvbihELEUpe3JldHVybi0oRFsxXS5sZW5ndGgtRVsxXS5sZW5ndGgpfSk7dmFyIEo9LTE7YS5lYWNoKHosZnVuY3Rpb24oRCxFKXtEPUVbMV07aWYoZi5zdWJzdHIoeSxELmxlbmd0aCkudG9Mb3dlckNhc2UoKT09RC50b0xvd2VyQ2FzZSgpKXtKPUVbMF07eSs9RC5sZW5ndGg7cmV0dXJuIGZhbHNlfX0pO2lmKEohPS0xKXJldHVybiBKKzE7ZWxzZSB0aHJvd1wiVW5rbm93biBuYW1lIGF0IHBvc2l0aW9uIFwiK3k7fSx4PVxuZnVuY3Rpb24oKXtpZihmLmNoYXJBdCh5KSE9Yi5jaGFyQXQoSCkpdGhyb3dcIlVuZXhwZWN0ZWQgbGl0ZXJhbCBhdCBwb3NpdGlvbiBcIit5O3krK30seT0wLEg9MDtIPGIubGVuZ3RoO0grKylpZihyKWlmKGIuY2hhckF0KEgpPT1cIidcIiYmIXUoXCInXCIpKXI9ZmFsc2U7ZWxzZSB4KCk7ZWxzZSBzd2l0Y2goYi5jaGFyQXQoSCkpe2Nhc2UgXCJkXCI6cT12KFwiZFwiKTticmVhaztjYXNlIFwiRFwiOncoXCJEXCIsbyxuKTticmVhaztjYXNlIFwib1wiOnM9dihcIm9cIik7YnJlYWs7Y2FzZSBcIm1cIjpwPXYoXCJtXCIpO2JyZWFrO2Nhc2UgXCJNXCI6cD13KFwiTVwiLGssbSk7YnJlYWs7Y2FzZSBcInlcIjpqPXYoXCJ5XCIpO2JyZWFrO2Nhc2UgXCJAXCI6dmFyIEM9bmV3IERhdGUodihcIkBcIikpO2o9Qy5nZXRGdWxsWWVhcigpO3A9Qy5nZXRNb250aCgpKzE7cT1DLmdldERhdGUoKTticmVhaztjYXNlIFwiIVwiOkM9bmV3IERhdGUoKHYoXCIhXCIpLXRoaXMuX3RpY2tzVG8xOTcwKS8xRTQpO2o9Qy5nZXRGdWxsWWVhcigpO3A9Qy5nZXRNb250aCgpK1xuMTtxPUMuZ2V0RGF0ZSgpO2JyZWFrO2Nhc2UgXCInXCI6aWYodShcIidcIikpeCgpO2Vsc2Ugcj10cnVlO2JyZWFrO2RlZmF1bHQ6eCgpfWlmKHk8Zi5sZW5ndGgpdGhyb3dcIkV4dHJhL3VucGFyc2VkIGNoYXJhY3RlcnMgZm91bmQgaW4gZGF0ZTogXCIrZi5zdWJzdHJpbmcoeSk7aWYoaj09LTEpaj0obmV3IERhdGUpLmdldEZ1bGxZZWFyKCk7ZWxzZSBpZihqPDEwMClqKz0obmV3IERhdGUpLmdldEZ1bGxZZWFyKCktKG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpJTEwMCsoajw9bD8wOi0xMDApO2lmKHM+LTEpe3A9MTtxPXM7ZG97bD10aGlzLl9nZXREYXlzSW5Nb250aChqLHAtMSk7aWYocTw9bClicmVhaztwKys7cS09bH13aGlsZSgxKX1DPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGoscC0xLHEpKTtpZihDLmdldEZ1bGxZZWFyKCkhPWp8fEMuZ2V0TW9udGgoKSsxIT1wfHxDLmdldERhdGUoKSE9cSl0aHJvd1wiSW52YWxpZCBkYXRlXCI7cmV0dXJuIEN9LEFUT006XCJ5eS1tbS1kZFwiLFxuQ09PS0lFOlwiRCwgZGQgTSB5eVwiLElTT184NjAxOlwieXktbW0tZGRcIixSRkNfODIyOlwiRCwgZCBNIHlcIixSRkNfODUwOlwiREQsIGRkLU0teVwiLFJGQ18xMDM2OlwiRCwgZCBNIHlcIixSRkNfMTEyMzpcIkQsIGQgTSB5eVwiLFJGQ18yODIyOlwiRCwgZCBNIHl5XCIsUlNTOlwiRCwgZCBNIHlcIixUSUNLUzpcIiFcIixUSU1FU1RBTVA6XCJAXCIsVzNDOlwieXktbW0tZGRcIixfdGlja3NUbzE5NzA6KDcxODY4NStNYXRoLmZsb29yKDQ5Mi41KS1NYXRoLmZsb29yKDE5LjcpK01hdGguZmxvb3IoNC45MjUpKSoyNCo2MCo2MCoxRTcsZm9ybWF0RGF0ZTpmdW5jdGlvbihiLGYsail7aWYoIWYpcmV0dXJuXCJcIjt2YXIgbD0oaj9qLmRheU5hbWVzU2hvcnQ6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzU2hvcnQsbz0oaj9qLmRheU5hbWVzOm51bGwpfHx0aGlzLl9kZWZhdWx0cy5kYXlOYW1lcyxuPShqP2oubW9udGhOYW1lc1Nob3J0Om51bGwpfHx0aGlzLl9kZWZhdWx0cy5tb250aE5hbWVzU2hvcnQ7aj0oaj9qLm1vbnRoTmFtZXM6XG5udWxsKXx8dGhpcy5fZGVmYXVsdHMubW9udGhOYW1lczt2YXIgaz1mdW5jdGlvbih1KXsodT1yKzE8Yi5sZW5ndGgmJmIuY2hhckF0KHIrMSk9PXUpJiZyKys7cmV0dXJuIHV9LG09ZnVuY3Rpb24odSx2LHcpe3Y9XCJcIit2O2lmKGsodSkpZm9yKDt2Lmxlbmd0aDx3Oyl2PVwiMFwiK3Y7cmV0dXJuIHZ9LHA9ZnVuY3Rpb24odSx2LHcseCl7cmV0dXJuIGsodSk/eFt2XTp3W3ZdfSxxPVwiXCIscz1mYWxzZTtpZihmKWZvcih2YXIgcj0wO3I8Yi5sZW5ndGg7cisrKWlmKHMpaWYoYi5jaGFyQXQocik9PVwiJ1wiJiYhayhcIidcIikpcz1mYWxzZTtlbHNlIHErPWIuY2hhckF0KHIpO2Vsc2Ugc3dpdGNoKGIuY2hhckF0KHIpKXtjYXNlIFwiZFwiOnErPW0oXCJkXCIsZi5nZXREYXRlKCksMik7YnJlYWs7Y2FzZSBcIkRcIjpxKz1wKFwiRFwiLGYuZ2V0RGF5KCksbCxvKTticmVhaztjYXNlIFwib1wiOnErPW0oXCJvXCIsTWF0aC5yb3VuZCgoKG5ldyBEYXRlKGYuZ2V0RnVsbFllYXIoKSxmLmdldE1vbnRoKCksZi5nZXREYXRlKCkpKS5nZXRUaW1lKCktXG4obmV3IERhdGUoZi5nZXRGdWxsWWVhcigpLDAsMCkpLmdldFRpbWUoKSkvODY0RTUpLDMpO2JyZWFrO2Nhc2UgXCJtXCI6cSs9bShcIm1cIixmLmdldE1vbnRoKCkrMSwyKTticmVhaztjYXNlIFwiTVwiOnErPXAoXCJNXCIsZi5nZXRNb250aCgpLG4saik7YnJlYWs7Y2FzZSBcInlcIjpxKz1rKFwieVwiKT9mLmdldEZ1bGxZZWFyKCk6KGYuZ2V0WWVhcigpJTEwMDwxMD9cIjBcIjpcIlwiKStmLmdldFllYXIoKSUxMDA7YnJlYWs7Y2FzZSBcIkBcIjpxKz1mLmdldFRpbWUoKTticmVhaztjYXNlIFwiIVwiOnErPWYuZ2V0VGltZSgpKjFFNCt0aGlzLl90aWNrc1RvMTk3MDticmVhaztjYXNlIFwiJ1wiOmlmKGsoXCInXCIpKXErPVwiJ1wiO2Vsc2Ugcz10cnVlO2JyZWFrO2RlZmF1bHQ6cSs9Yi5jaGFyQXQocil9cmV0dXJuIHF9LF9wb3NzaWJsZUNoYXJzOmZ1bmN0aW9uKGIpe2Zvcih2YXIgZj1cIlwiLGo9ZmFsc2UsbD1mdW5jdGlvbihuKXsobj1vKzE8Yi5sZW5ndGgmJmIuY2hhckF0KG8rMSk9PW4pJiZvKys7cmV0dXJuIG59LG89XG4wO288Yi5sZW5ndGg7bysrKWlmKGopaWYoYi5jaGFyQXQobyk9PVwiJ1wiJiYhbChcIidcIikpaj1mYWxzZTtlbHNlIGYrPWIuY2hhckF0KG8pO2Vsc2Ugc3dpdGNoKGIuY2hhckF0KG8pKXtjYXNlIFwiZFwiOmNhc2UgXCJtXCI6Y2FzZSBcInlcIjpjYXNlIFwiQFwiOmYrPVwiMDEyMzQ1Njc4OVwiO2JyZWFrO2Nhc2UgXCJEXCI6Y2FzZSBcIk1cIjpyZXR1cm4gbnVsbDtjYXNlIFwiJ1wiOmlmKGwoXCInXCIpKWYrPVwiJ1wiO2Vsc2Ugaj10cnVlO2JyZWFrO2RlZmF1bHQ6Zis9Yi5jaGFyQXQobyl9cmV0dXJuIGZ9LF9nZXQ6ZnVuY3Rpb24oYixmKXtyZXR1cm4gYi5zZXR0aW5nc1tmXSE9PWQ/Yi5zZXR0aW5nc1tmXTp0aGlzLl9kZWZhdWx0c1tmXX0sX3NldERhdGVGcm9tRmllbGQ6ZnVuY3Rpb24oYixmKXtpZihiLmlucHV0LnZhbCgpIT1iLmxhc3RWYWwpe3ZhciBqPXRoaXMuX2dldChiLFwiZGF0ZUZvcm1hdFwiKSxsPWIubGFzdFZhbD1iLmlucHV0P2IuaW5wdXQudmFsKCk6bnVsbCxvLG47bz1uPXRoaXMuX2dldERlZmF1bHREYXRlKGIpO1xudmFyIGs9dGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGIpO3RyeXtvPXRoaXMucGFyc2VEYXRlKGosbCxrKXx8bn1jYXRjaChtKXt0aGlzLmxvZyhtKTtsPWY/XCJcIjpsfWIuc2VsZWN0ZWREYXk9by5nZXREYXRlKCk7Yi5kcmF3TW9udGg9Yi5zZWxlY3RlZE1vbnRoPW8uZ2V0TW9udGgoKTtiLmRyYXdZZWFyPWIuc2VsZWN0ZWRZZWFyPW8uZ2V0RnVsbFllYXIoKTtiLmN1cnJlbnREYXk9bD9vLmdldERhdGUoKTowO2IuY3VycmVudE1vbnRoPWw/by5nZXRNb250aCgpOjA7Yi5jdXJyZW50WWVhcj1sP28uZ2V0RnVsbFllYXIoKTowO3RoaXMuX2FkanVzdEluc3REYXRlKGIpfX0sX2dldERlZmF1bHREYXRlOmZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLl9yZXN0cmljdE1pbk1heChiLHRoaXMuX2RldGVybWluZURhdGUoYix0aGlzLl9nZXQoYixcImRlZmF1bHREYXRlXCIpLG5ldyBEYXRlKSl9LF9kZXRlcm1pbmVEYXRlOmZ1bmN0aW9uKGIsZixqKXt2YXIgbD1mdW5jdGlvbihuKXt2YXIgaz1uZXcgRGF0ZTtcbmsuc2V0RGF0ZShrLmdldERhdGUoKStuKTtyZXR1cm4ga30sbz1mdW5jdGlvbihuKXt0cnl7cmV0dXJuIGEuZGF0ZXBpY2tlci5wYXJzZURhdGUoYS5kYXRlcGlja2VyLl9nZXQoYixcImRhdGVGb3JtYXRcIiksbixhLmRhdGVwaWNrZXIuX2dldEZvcm1hdENvbmZpZyhiKSl9Y2F0Y2goayl7fXZhciBtPShuLnRvTG93ZXJDYXNlKCkubWF0Y2goL15jLyk/YS5kYXRlcGlja2VyLl9nZXREYXRlKGIpOm51bGwpfHxuZXcgRGF0ZSxwPW0uZ2V0RnVsbFllYXIoKSxxPW0uZ2V0TW9udGgoKTttPW0uZ2V0RGF0ZSgpO2Zvcih2YXIgcz0vKFsrLV0/WzAtOV0rKVxccyooZHxEfHd8V3xtfE18eXxZKT8vZyxyPXMuZXhlYyhuKTtyOyl7c3dpdGNoKHJbMl18fFwiZFwiKXtjYXNlIFwiZFwiOmNhc2UgXCJEXCI6bSs9cGFyc2VJbnQoclsxXSwxMCk7YnJlYWs7Y2FzZSBcIndcIjpjYXNlIFwiV1wiOm0rPXBhcnNlSW50KHJbMV0sMTApKjc7YnJlYWs7Y2FzZSBcIm1cIjpjYXNlIFwiTVwiOnErPXBhcnNlSW50KHJbMV0sMTApO209XG5NYXRoLm1pbihtLGEuZGF0ZXBpY2tlci5fZ2V0RGF5c0luTW9udGgocCxxKSk7YnJlYWs7Y2FzZSBcInlcIjpjYXNlIFwiWVwiOnArPXBhcnNlSW50KHJbMV0sMTApO209TWF0aC5taW4obSxhLmRhdGVwaWNrZXIuX2dldERheXNJbk1vbnRoKHAscSkpO2JyZWFrfXI9cy5leGVjKG4pfXJldHVybiBuZXcgRGF0ZShwLHEsbSl9O2lmKGY9KGY9Zj09bnVsbHx8Zj09PVwiXCI/ajp0eXBlb2YgZj09XCJzdHJpbmdcIj9vKGYpOnR5cGVvZiBmPT1cIm51bWJlclwiP2lzTmFOKGYpP2o6bChmKTpuZXcgRGF0ZShmLmdldFRpbWUoKSkpJiZmLnRvU3RyaW5nKCk9PVwiSW52YWxpZCBEYXRlXCI/ajpmKXtmLnNldEhvdXJzKDApO2Yuc2V0TWludXRlcygwKTtmLnNldFNlY29uZHMoMCk7Zi5zZXRNaWxsaXNlY29uZHMoMCl9cmV0dXJuIHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KGYpfSxfZGF5bGlnaHRTYXZpbmdBZGp1c3Q6ZnVuY3Rpb24oYil7aWYoIWIpcmV0dXJuIG51bGw7Yi5zZXRIb3VycyhiLmdldEhvdXJzKCk+XG4xMj9iLmdldEhvdXJzKCkrMjowKTtyZXR1cm4gYn0sX3NldERhdGU6ZnVuY3Rpb24oYixmLGope3ZhciBsPSFmLG89Yi5zZWxlY3RlZE1vbnRoLG49Yi5zZWxlY3RlZFllYXI7Zj10aGlzLl9yZXN0cmljdE1pbk1heChiLHRoaXMuX2RldGVybWluZURhdGUoYixmLG5ldyBEYXRlKSk7Yi5zZWxlY3RlZERheT1iLmN1cnJlbnREYXk9Zi5nZXREYXRlKCk7Yi5kcmF3TW9udGg9Yi5zZWxlY3RlZE1vbnRoPWIuY3VycmVudE1vbnRoPWYuZ2V0TW9udGgoKTtiLmRyYXdZZWFyPWIuc2VsZWN0ZWRZZWFyPWIuY3VycmVudFllYXI9Zi5nZXRGdWxsWWVhcigpO2lmKChvIT1iLnNlbGVjdGVkTW9udGh8fG4hPWIuc2VsZWN0ZWRZZWFyKSYmIWopdGhpcy5fbm90aWZ5Q2hhbmdlKGIpO3RoaXMuX2FkanVzdEluc3REYXRlKGIpO2lmKGIuaW5wdXQpYi5pbnB1dC52YWwobD9cIlwiOnRoaXMuX2Zvcm1hdERhdGUoYikpfSxfZ2V0RGF0ZTpmdW5jdGlvbihiKXtyZXR1cm4hYi5jdXJyZW50WWVhcnx8Yi5pbnB1dCYmXG5iLmlucHV0LnZhbCgpPT1cIlwiP251bGw6dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoYi5jdXJyZW50WWVhcixiLmN1cnJlbnRNb250aCxiLmN1cnJlbnREYXkpKX0sX2dlbmVyYXRlSFRNTDpmdW5jdGlvbihiKXt2YXIgZj1uZXcgRGF0ZTtmPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGYuZ2V0RnVsbFllYXIoKSxmLmdldE1vbnRoKCksZi5nZXREYXRlKCkpKTt2YXIgaj10aGlzLl9nZXQoYixcImlzUlRMXCIpLGw9dGhpcy5fZ2V0KGIsXCJzaG93QnV0dG9uUGFuZWxcIiksbz10aGlzLl9nZXQoYixcImhpZGVJZk5vUHJldk5leHRcIiksbj10aGlzLl9nZXQoYixcIm5hdmlnYXRpb25Bc0RhdGVGb3JtYXRcIiksaz10aGlzLl9nZXROdW1iZXJPZk1vbnRocyhiKSxtPXRoaXMuX2dldChiLFwic2hvd0N1cnJlbnRBdFBvc1wiKSxwPXRoaXMuX2dldChiLFwic3RlcE1vbnRoc1wiKSxxPWtbMF0hPTF8fGtbMV0hPTEscz10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdCghYi5jdXJyZW50RGF5P1xubmV3IERhdGUoOTk5OSw5LDkpOm5ldyBEYXRlKGIuY3VycmVudFllYXIsYi5jdXJyZW50TW9udGgsYi5jdXJyZW50RGF5KSkscj10aGlzLl9nZXRNaW5NYXhEYXRlKGIsXCJtaW5cIiksdT10aGlzLl9nZXRNaW5NYXhEYXRlKGIsXCJtYXhcIik7bT1iLmRyYXdNb250aC1tO3ZhciB2PWIuZHJhd1llYXI7aWYobTwwKXttKz0xMjt2LS19aWYodSl7dmFyIHc9dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUodS5nZXRGdWxsWWVhcigpLHUuZ2V0TW9udGgoKS1rWzBdKmtbMV0rMSx1LmdldERhdGUoKSkpO2Zvcih3PXImJnc8cj9yOnc7dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUodixtLDEpKT53Oyl7bS0tO2lmKG08MCl7bT0xMTt2LS19fX1iLmRyYXdNb250aD1tO2IuZHJhd1llYXI9djt3PXRoaXMuX2dldChiLFwicHJldlRleHRcIik7dz0hbj93OnRoaXMuZm9ybWF0RGF0ZSh3LHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKHYsbS1wLDEpKSx0aGlzLl9nZXRGb3JtYXRDb25maWcoYikpO1xudz10aGlzLl9jYW5BZGp1c3RNb250aChiLC0xLHYsbSk/JzxhIGNsYXNzPVwidWktZGF0ZXBpY2tlci1wcmV2IHVpLWNvcm5lci1hbGxcIiBvbmNsaWNrPVwiRFBfalF1ZXJ5XycrZytcIi5kYXRlcGlja2VyLl9hZGp1c3REYXRlKCcjXCIrYi5pZCtcIicsIC1cIitwK1wiLCAnTScpO1xcXCIgdGl0bGU9XFxcIlwiK3crJ1wiPjxzcGFuIGNsYXNzPVwidWktaWNvbiB1aS1pY29uLWNpcmNsZS10cmlhbmdsZS0nKyhqP1wiZVwiOlwid1wiKSsnXCI+Jyt3K1wiPC9zcGFuPjwvYT5cIjpvP1wiXCI6JzxhIGNsYXNzPVwidWktZGF0ZXBpY2tlci1wcmV2IHVpLWNvcm5lci1hbGwgdWktc3RhdGUtZGlzYWJsZWRcIiB0aXRsZT1cIicrdysnXCI+PHNwYW4gY2xhc3M9XCJ1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLScrKGo/XCJlXCI6XCJ3XCIpKydcIj4nK3crXCI8L3NwYW4+PC9hPlwiO3ZhciB4PXRoaXMuX2dldChiLFwibmV4dFRleHRcIik7eD0hbj94OnRoaXMuZm9ybWF0RGF0ZSh4LHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKHYsXG5tK3AsMSkpLHRoaXMuX2dldEZvcm1hdENvbmZpZyhiKSk7bz10aGlzLl9jYW5BZGp1c3RNb250aChiLCsxLHYsbSk/JzxhIGNsYXNzPVwidWktZGF0ZXBpY2tlci1uZXh0IHVpLWNvcm5lci1hbGxcIiBvbmNsaWNrPVwiRFBfalF1ZXJ5XycrZytcIi5kYXRlcGlja2VyLl9hZGp1c3REYXRlKCcjXCIrYi5pZCtcIicsICtcIitwK1wiLCAnTScpO1xcXCIgdGl0bGU9XFxcIlwiK3grJ1wiPjxzcGFuIGNsYXNzPVwidWktaWNvbiB1aS1pY29uLWNpcmNsZS10cmlhbmdsZS0nKyhqP1wid1wiOlwiZVwiKSsnXCI+Jyt4K1wiPC9zcGFuPjwvYT5cIjpvP1wiXCI6JzxhIGNsYXNzPVwidWktZGF0ZXBpY2tlci1uZXh0IHVpLWNvcm5lci1hbGwgdWktc3RhdGUtZGlzYWJsZWRcIiB0aXRsZT1cIicreCsnXCI+PHNwYW4gY2xhc3M9XCJ1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLScrKGo/XCJ3XCI6XCJlXCIpKydcIj4nK3grXCI8L3NwYW4+PC9hPlwiO3A9dGhpcy5fZ2V0KGIsXCJjdXJyZW50VGV4dFwiKTt4PXRoaXMuX2dldChiLFwiZ290b0N1cnJlbnRcIikmJlxuYi5jdXJyZW50RGF5P3M6ZjtwPSFuP3A6dGhpcy5mb3JtYXREYXRlKHAseCx0aGlzLl9nZXRGb3JtYXRDb25maWcoYikpO249IWIuaW5saW5lPyc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cInVpLWRhdGVwaWNrZXItY2xvc2UgdWktc3RhdGUtZGVmYXVsdCB1aS1wcmlvcml0eS1wcmltYXJ5IHVpLWNvcm5lci1hbGxcIiBvbmNsaWNrPVwiRFBfalF1ZXJ5XycrZysnLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7XCI+Jyt0aGlzLl9nZXQoYixcImNsb3NlVGV4dFwiKStcIjwvYnV0dG9uPlwiOlwiXCI7bD1sPyc8ZGl2IGNsYXNzPVwidWktZGF0ZXBpY2tlci1idXR0b25wYW5lIHVpLXdpZGdldC1jb250ZW50XCI+Jysoaj9uOlwiXCIpKyh0aGlzLl9pc0luUmFuZ2UoYix4KT8nPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLWN1cnJlbnQgdWktc3RhdGUtZGVmYXVsdCB1aS1wcmlvcml0eS1zZWNvbmRhcnkgdWktY29ybmVyLWFsbFwiIG9uY2xpY2s9XCJEUF9qUXVlcnlfJytcbmcrXCIuZGF0ZXBpY2tlci5fZ290b1RvZGF5KCcjXCIrYi5pZCtcIicpO1xcXCI+XCIrcCtcIjwvYnV0dG9uPlwiOlwiXCIpKyhqP1wiXCI6bikrXCI8L2Rpdj5cIjpcIlwiO249cGFyc2VJbnQodGhpcy5fZ2V0KGIsXCJmaXJzdERheVwiKSwxMCk7bj1pc05hTihuKT8wOm47cD10aGlzLl9nZXQoYixcInNob3dXZWVrXCIpO3g9dGhpcy5fZ2V0KGIsXCJkYXlOYW1lc1wiKTt0aGlzLl9nZXQoYixcImRheU5hbWVzU2hvcnRcIik7dmFyIHk9dGhpcy5fZ2V0KGIsXCJkYXlOYW1lc01pblwiKSxIPXRoaXMuX2dldChiLFwibW9udGhOYW1lc1wiKSxDPXRoaXMuX2dldChiLFwibW9udGhOYW1lc1Nob3J0XCIpLHo9dGhpcy5fZ2V0KGIsXCJiZWZvcmVTaG93RGF5XCIpLEk9dGhpcy5fZ2V0KGIsXCJzaG93T3RoZXJNb250aHNcIiksTj10aGlzLl9nZXQoYixcInNlbGVjdE90aGVyTW9udGhzXCIpO3RoaXMuX2dldChiLFwiY2FsY3VsYXRlV2Vla1wiKTtmb3IodmFyIEo9dGhpcy5fZ2V0RGVmYXVsdERhdGUoYiksRD1cIlwiLEU9MDtFPGtbMF07RSsrKXt2YXIgUD1cblwiXCI7dGhpcy5tYXhSb3dzPTQ7Zm9yKHZhciBMPTA7TDxrWzFdO0wrKyl7dmFyIFE9dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUodixtLGIuc2VsZWN0ZWREYXkpKSxCPVwiIHVpLWNvcm5lci1hbGxcIixGPVwiXCI7aWYocSl7Ris9JzxkaXYgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLWdyb3VwJztpZihrWzFdPjEpc3dpdGNoKEwpe2Nhc2UgMDpGKz1cIiB1aS1kYXRlcGlja2VyLWdyb3VwLWZpcnN0XCI7Qj1cIiB1aS1jb3JuZXItXCIrKGo/XCJyaWdodFwiOlwibGVmdFwiKTticmVhaztjYXNlIGtbMV0tMTpGKz1cIiB1aS1kYXRlcGlja2VyLWdyb3VwLWxhc3RcIjtCPVwiIHVpLWNvcm5lci1cIisoaj9cImxlZnRcIjpcInJpZ2h0XCIpO2JyZWFrO2RlZmF1bHQ6Ris9XCIgdWktZGF0ZXBpY2tlci1ncm91cC1taWRkbGVcIjtCPVwiXCI7YnJlYWt9Ris9J1wiPid9Ris9JzxkaXYgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLWhlYWRlciB1aS13aWRnZXQtaGVhZGVyIHVpLWhlbHBlci1jbGVhcmZpeCcrQisnXCI+JysoL2FsbHxsZWZ0Ly50ZXN0KEIpJiZcbkU9PTA/aj9vOnc6XCJcIikrKC9hbGx8cmlnaHQvLnRlc3QoQikmJkU9PTA/aj93Om86XCJcIikrdGhpcy5fZ2VuZXJhdGVNb250aFllYXJIZWFkZXIoYixtLHYscix1LEU+MHx8TD4wLEgsQykrJzwvZGl2Pjx0YWJsZSBjbGFzcz1cInVpLWRhdGVwaWNrZXItY2FsZW5kYXJcIj48dGhlYWQ+PHRyPic7dmFyIEc9cD8nPHRoIGNsYXNzPVwidWktZGF0ZXBpY2tlci13ZWVrLWNvbFwiPicrdGhpcy5fZ2V0KGIsXCJ3ZWVrSGVhZGVyXCIpK1wiPC90aD5cIjpcIlwiO2ZvcihCPTA7Qjw3O0IrKyl7dmFyIEE9KEIrbiklNztHKz1cIjx0aFwiKygoQituKzYpJTc+PTU/JyBjbGFzcz1cInVpLWRhdGVwaWNrZXItd2Vlay1lbmRcIic6XCJcIikrJz48c3BhbiB0aXRsZT1cIicreFtBXSsnXCI+Jyt5W0FdK1wiPC9zcGFuPjwvdGg+XCJ9Ris9RytcIjwvdHI+PC90aGVhZD48dGJvZHk+XCI7Rz10aGlzLl9nZXREYXlzSW5Nb250aCh2LG0pO2lmKHY9PWIuc2VsZWN0ZWRZZWFyJiZtPT1iLnNlbGVjdGVkTW9udGgpYi5zZWxlY3RlZERheT1NYXRoLm1pbihiLnNlbGVjdGVkRGF5LFxuRyk7Qj0odGhpcy5fZ2V0Rmlyc3REYXlPZk1vbnRoKHYsbSktbis3KSU3O0c9TWF0aC5jZWlsKChCK0cpLzcpO3RoaXMubWF4Um93cz1HPXE/dGhpcy5tYXhSb3dzPkc/dGhpcy5tYXhSb3dzOkc6RztBPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKHYsbSwxLUIpKTtmb3IodmFyIFI9MDtSPEc7UisrKXtGKz1cIjx0cj5cIjt2YXIgUz0hcD9cIlwiOic8dGQgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLXdlZWstY29sXCI+Jyt0aGlzLl9nZXQoYixcImNhbGN1bGF0ZVdlZWtcIikoQSkrXCI8L3RkPlwiO2ZvcihCPTA7Qjw3O0IrKyl7dmFyIE09ej96LmFwcGx5KGIuaW5wdXQ/Yi5pbnB1dFswXTpudWxsLFtBXSk6W3RydWUsXCJcIl0sSz1BLmdldE1vbnRoKCkhPW0sTz1LJiYhTnx8IU1bMF18fHImJkE8cnx8dSYmQT51O1MrPSc8dGQgY2xhc3M9XCInKygoQituKzYpJTc+PTU/XCIgdWktZGF0ZXBpY2tlci13ZWVrLWVuZFwiOlwiXCIpKyhLP1wiIHVpLWRhdGVwaWNrZXItb3RoZXItbW9udGhcIjpcIlwiKSsoQS5nZXRUaW1lKCk9PVxuUS5nZXRUaW1lKCkmJm09PWIuc2VsZWN0ZWRNb250aCYmYi5fa2V5RXZlbnR8fEouZ2V0VGltZSgpPT1BLmdldFRpbWUoKSYmSi5nZXRUaW1lKCk9PVEuZ2V0VGltZSgpP1wiIFwiK3RoaXMuX2RheU92ZXJDbGFzczpcIlwiKSsoTz9cIiBcIit0aGlzLl91bnNlbGVjdGFibGVDbGFzcytcIiB1aS1zdGF0ZS1kaXNhYmxlZFwiOlwiXCIpKyhLJiYhST9cIlwiOlwiIFwiK01bMV0rKEEuZ2V0VGltZSgpPT1zLmdldFRpbWUoKT9cIiBcIit0aGlzLl9jdXJyZW50Q2xhc3M6XCJcIikrKEEuZ2V0VGltZSgpPT1mLmdldFRpbWUoKT9cIiB1aS1kYXRlcGlja2VyLXRvZGF5XCI6XCJcIikpKydcIicrKCghS3x8SSkmJk1bMl0/JyB0aXRsZT1cIicrTVsyXSsnXCInOlwiXCIpKyhPP1wiXCI6JyBvbmNsaWNrPVwiRFBfalF1ZXJ5XycrZytcIi5kYXRlcGlja2VyLl9zZWxlY3REYXkoJyNcIitiLmlkK1wiJyxcIitBLmdldE1vbnRoKCkrXCIsXCIrQS5nZXRGdWxsWWVhcigpKycsIHRoaXMpO3JldHVybiBmYWxzZTtcIicpK1wiPlwiKyhLJiYhST9cIiYjeGEwO1wiOk8/JzxzcGFuIGNsYXNzPVwidWktc3RhdGUtZGVmYXVsdFwiPicrXG5BLmdldERhdGUoKStcIjwvc3Bhbj5cIjonPGEgY2xhc3M9XCJ1aS1zdGF0ZS1kZWZhdWx0JysoQS5nZXRUaW1lKCk9PWYuZ2V0VGltZSgpP1wiIHVpLXN0YXRlLWhpZ2hsaWdodFwiOlwiXCIpKyhBLmdldFRpbWUoKT09cy5nZXRUaW1lKCk/XCIgdWktc3RhdGUtYWN0aXZlXCI6XCJcIikrKEs/XCIgdWktcHJpb3JpdHktc2Vjb25kYXJ5XCI6XCJcIikrJ1wiIGhyZWY9XCIjXCI+JytBLmdldERhdGUoKStcIjwvYT5cIikrXCI8L3RkPlwiO0Euc2V0RGF0ZShBLmdldERhdGUoKSsxKTtBPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KEEpfUYrPVMrXCI8L3RyPlwifW0rKztpZihtPjExKXttPTA7disrfUYrPVwiPC90Ym9keT48L3RhYmxlPlwiKyhxP1wiPC9kaXY+XCIrKGtbMF0+MCYmTD09a1sxXS0xPyc8ZGl2IGNsYXNzPVwidWktZGF0ZXBpY2tlci1yb3ctYnJlYWtcIj48L2Rpdj4nOlwiXCIpOlwiXCIpO1ArPUZ9RCs9UH1EKz1sKyhhLmJyb3dzZXIubXNpZSYmcGFyc2VJbnQoYS5icm93c2VyLnZlcnNpb24sMTApPDcmJiFiLmlubGluZT8nPGlmcmFtZSBzcmM9XCJqYXZhc2NyaXB0OmZhbHNlO1wiIGNsYXNzPVwidWktZGF0ZXBpY2tlci1jb3ZlclwiIGZyYW1lYm9yZGVyPVwiMFwiPjwvaWZyYW1lPic6XG5cIlwiKTtiLl9rZXlFdmVudD1mYWxzZTtyZXR1cm4gRH0sX2dlbmVyYXRlTW9udGhZZWFySGVhZGVyOmZ1bmN0aW9uKGIsZixqLGwsbyxuLGssbSl7dmFyIHA9dGhpcy5fZ2V0KGIsXCJjaGFuZ2VNb250aFwiKSxxPXRoaXMuX2dldChiLFwiY2hhbmdlWWVhclwiKSxzPXRoaXMuX2dldChiLFwic2hvd01vbnRoQWZ0ZXJZZWFyXCIpLHI9JzxkaXYgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLXRpdGxlXCI+Jyx1PVwiXCI7aWYobnx8IXApdSs9JzxzcGFuIGNsYXNzPVwidWktZGF0ZXBpY2tlci1tb250aFwiPicra1tmXStcIjwvc3Bhbj5cIjtlbHNle2s9bCYmbC5nZXRGdWxsWWVhcigpPT1qO3ZhciB2PW8mJm8uZ2V0RnVsbFllYXIoKT09ajt1Kz0nPHNlbGVjdCBjbGFzcz1cInVpLWRhdGVwaWNrZXItbW9udGhcIiBvbmNoYW5nZT1cIkRQX2pRdWVyeV8nK2crXCIuZGF0ZXBpY2tlci5fc2VsZWN0TW9udGhZZWFyKCcjXCIrYi5pZCtcIicsIHRoaXMsICdNJyk7XFxcIiA+XCI7Zm9yKHZhciB3PTA7dzwxMjt3KyspaWYoKCFrfHx3Pj1sLmdldE1vbnRoKCkpJiZcbighdnx8dzw9by5nZXRNb250aCgpKSl1Kz0nPG9wdGlvbiB2YWx1ZT1cIicrdysnXCInKyh3PT1mPycgc2VsZWN0ZWQ9XCJzZWxlY3RlZFwiJzpcIlwiKStcIj5cIittW3ddK1wiPC9vcHRpb24+XCI7dSs9XCI8L3NlbGVjdD5cIn1zfHwocis9dSsobnx8IShwJiZxKT9cIiYjeGEwO1wiOlwiXCIpKTtpZighYi55ZWFyc2h0bWwpe2IueWVhcnNodG1sPVwiXCI7aWYobnx8IXEpcis9JzxzcGFuIGNsYXNzPVwidWktZGF0ZXBpY2tlci15ZWFyXCI+JytqK1wiPC9zcGFuPlwiO2Vsc2V7bT10aGlzLl9nZXQoYixcInllYXJSYW5nZVwiKS5zcGxpdChcIjpcIik7dmFyIHg9KG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpO2s9ZnVuY3Rpb24oeSl7eT15Lm1hdGNoKC9jWystXS4qLyk/aitwYXJzZUludCh5LnN1YnN0cmluZygxKSwxMCk6eS5tYXRjaCgvWystXS4qLyk/eCtwYXJzZUludCh5LDEwKTpwYXJzZUludCh5LDEwKTtyZXR1cm4gaXNOYU4oeSk/eDp5fTtmPWsobVswXSk7bT1NYXRoLm1heChmLGsobVsxXXx8XCJcIikpO2Y9bD9NYXRoLm1heChmLFxubC5nZXRGdWxsWWVhcigpKTpmO209bz9NYXRoLm1pbihtLG8uZ2V0RnVsbFllYXIoKSk6bTtmb3IoYi55ZWFyc2h0bWwrPSc8c2VsZWN0IGNsYXNzPVwidWktZGF0ZXBpY2tlci15ZWFyXCIgb25jaGFuZ2U9XCJEUF9qUXVlcnlfJytnK1wiLmRhdGVwaWNrZXIuX3NlbGVjdE1vbnRoWWVhcignI1wiK2IuaWQrXCInLCB0aGlzLCAnWScpO1xcXCIgPlwiO2Y8PW07ZisrKWIueWVhcnNodG1sKz0nPG9wdGlvbiB2YWx1ZT1cIicrZisnXCInKyhmPT1qPycgc2VsZWN0ZWQ9XCJzZWxlY3RlZFwiJzpcIlwiKStcIj5cIitmK1wiPC9vcHRpb24+XCI7Yi55ZWFyc2h0bWwrPVwiPC9zZWxlY3Q+XCI7cis9Yi55ZWFyc2h0bWw7Yi55ZWFyc2h0bWw9bnVsbH19cis9dGhpcy5fZ2V0KGIsXCJ5ZWFyU3VmZml4XCIpO2lmKHMpcis9KG58fCEocCYmcSk/XCImI3hhMDtcIjpcIlwiKSt1O3IrPVwiPC9kaXY+XCI7cmV0dXJuIHJ9LF9hZGp1c3RJbnN0RGF0ZTpmdW5jdGlvbihiLGYsail7dmFyIGw9Yi5kcmF3WWVhcisoaj09XCJZXCI/ZjowKSxvPWIuZHJhd01vbnRoK1xuKGo9PVwiTVwiP2Y6MCk7Zj1NYXRoLm1pbihiLnNlbGVjdGVkRGF5LHRoaXMuX2dldERheXNJbk1vbnRoKGwsbykpKyhqPT1cIkRcIj9mOjApO2w9dGhpcy5fcmVzdHJpY3RNaW5NYXgoYix0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShsLG8sZikpKTtiLnNlbGVjdGVkRGF5PWwuZ2V0RGF0ZSgpO2IuZHJhd01vbnRoPWIuc2VsZWN0ZWRNb250aD1sLmdldE1vbnRoKCk7Yi5kcmF3WWVhcj1iLnNlbGVjdGVkWWVhcj1sLmdldEZ1bGxZZWFyKCk7aWYoaj09XCJNXCJ8fGo9PVwiWVwiKXRoaXMuX25vdGlmeUNoYW5nZShiKX0sX3Jlc3RyaWN0TWluTWF4OmZ1bmN0aW9uKGIsZil7dmFyIGo9dGhpcy5fZ2V0TWluTWF4RGF0ZShiLFwibWluXCIpO2I9dGhpcy5fZ2V0TWluTWF4RGF0ZShiLFwibWF4XCIpO2Y9aiYmZjxqP2o6ZjtyZXR1cm4gZj1iJiZmPmI/YjpmfSxfbm90aWZ5Q2hhbmdlOmZ1bmN0aW9uKGIpe3ZhciBmPXRoaXMuX2dldChiLFwib25DaGFuZ2VNb250aFllYXJcIik7aWYoZilmLmFwcGx5KGIuaW5wdXQ/XG5iLmlucHV0WzBdOm51bGwsW2Iuc2VsZWN0ZWRZZWFyLGIuc2VsZWN0ZWRNb250aCsxLGJdKX0sX2dldE51bWJlck9mTW9udGhzOmZ1bmN0aW9uKGIpe2I9dGhpcy5fZ2V0KGIsXCJudW1iZXJPZk1vbnRoc1wiKTtyZXR1cm4gYj09bnVsbD9bMSwxXTp0eXBlb2YgYj09XCJudW1iZXJcIj9bMSxiXTpifSxfZ2V0TWluTWF4RGF0ZTpmdW5jdGlvbihiLGYpe3JldHVybiB0aGlzLl9kZXRlcm1pbmVEYXRlKGIsdGhpcy5fZ2V0KGIsZitcIkRhdGVcIiksbnVsbCl9LF9nZXREYXlzSW5Nb250aDpmdW5jdGlvbihiLGYpe3JldHVybiAzMi10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShiLGYsMzIpKS5nZXREYXRlKCl9LF9nZXRGaXJzdERheU9mTW9udGg6ZnVuY3Rpb24oYixmKXtyZXR1cm4obmV3IERhdGUoYixmLDEpKS5nZXREYXkoKX0sX2NhbkFkanVzdE1vbnRoOmZ1bmN0aW9uKGIsZixqLGwpe3ZhciBvPXRoaXMuX2dldE51bWJlck9mTW9udGhzKGIpO2o9dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoaixcbmwrKGY8MD9mOm9bMF0qb1sxXSksMSkpO2Y8MCYmai5zZXREYXRlKHRoaXMuX2dldERheXNJbk1vbnRoKGouZ2V0RnVsbFllYXIoKSxqLmdldE1vbnRoKCkpKTtyZXR1cm4gdGhpcy5faXNJblJhbmdlKGIsail9LF9pc0luUmFuZ2U6ZnVuY3Rpb24oYixmKXt2YXIgaj10aGlzLl9nZXRNaW5NYXhEYXRlKGIsXCJtaW5cIik7Yj10aGlzLl9nZXRNaW5NYXhEYXRlKGIsXCJtYXhcIik7cmV0dXJuKCFqfHxmLmdldFRpbWUoKT49ai5nZXRUaW1lKCkpJiYoIWJ8fGYuZ2V0VGltZSgpPD1iLmdldFRpbWUoKSl9LF9nZXRGb3JtYXRDb25maWc6ZnVuY3Rpb24oYil7dmFyIGY9dGhpcy5fZ2V0KGIsXCJzaG9ydFllYXJDdXRvZmZcIik7Zj10eXBlb2YgZiE9XCJzdHJpbmdcIj9mOihuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSUxMDArcGFyc2VJbnQoZiwxMCk7cmV0dXJue3Nob3J0WWVhckN1dG9mZjpmLGRheU5hbWVzU2hvcnQ6dGhpcy5fZ2V0KGIsXCJkYXlOYW1lc1Nob3J0XCIpLGRheU5hbWVzOnRoaXMuX2dldChiLFxuXCJkYXlOYW1lc1wiKSxtb250aE5hbWVzU2hvcnQ6dGhpcy5fZ2V0KGIsXCJtb250aE5hbWVzU2hvcnRcIiksbW9udGhOYW1lczp0aGlzLl9nZXQoYixcIm1vbnRoTmFtZXNcIil9fSxfZm9ybWF0RGF0ZTpmdW5jdGlvbihiLGYsaixsKXtpZighZil7Yi5jdXJyZW50RGF5PWIuc2VsZWN0ZWREYXk7Yi5jdXJyZW50TW9udGg9Yi5zZWxlY3RlZE1vbnRoO2IuY3VycmVudFllYXI9Yi5zZWxlY3RlZFllYXJ9Zj1mP3R5cGVvZiBmPT1cIm9iamVjdFwiP2Y6dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUobCxqLGYpKTp0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShiLmN1cnJlbnRZZWFyLGIuY3VycmVudE1vbnRoLGIuY3VycmVudERheSkpO3JldHVybiB0aGlzLmZvcm1hdERhdGUodGhpcy5fZ2V0KGIsXCJkYXRlRm9ybWF0XCIpLGYsdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGIpKX19KTthLmZuLmRhdGVwaWNrZXI9ZnVuY3Rpb24oYil7aWYoIXRoaXMubGVuZ3RoKXJldHVybiB0aGlzO1xuaWYoIWEuZGF0ZXBpY2tlci5pbml0aWFsaXplZCl7YShkb2N1bWVudCkubW91c2Vkb3duKGEuZGF0ZXBpY2tlci5fY2hlY2tFeHRlcm5hbENsaWNrKS5maW5kKFwiYm9keVwiKS5hcHBlbmQoYS5kYXRlcGlja2VyLmRwRGl2KTthLmRhdGVwaWNrZXIuaW5pdGlhbGl6ZWQ9dHJ1ZX12YXIgZj1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7aWYodHlwZW9mIGI9PVwic3RyaW5nXCImJihiPT1cImlzRGlzYWJsZWRcInx8Yj09XCJnZXREYXRlXCJ8fGI9PVwid2lkZ2V0XCIpKXJldHVybiBhLmRhdGVwaWNrZXJbXCJfXCIrYitcIkRhdGVwaWNrZXJcIl0uYXBwbHkoYS5kYXRlcGlja2VyLFt0aGlzWzBdXS5jb25jYXQoZikpO2lmKGI9PVwib3B0aW9uXCImJmFyZ3VtZW50cy5sZW5ndGg9PTImJnR5cGVvZiBhcmd1bWVudHNbMV09PVwic3RyaW5nXCIpcmV0dXJuIGEuZGF0ZXBpY2tlcltcIl9cIitiK1wiRGF0ZXBpY2tlclwiXS5hcHBseShhLmRhdGVwaWNrZXIsW3RoaXNbMF1dLmNvbmNhdChmKSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3R5cGVvZiBiPT1cblwic3RyaW5nXCI/YS5kYXRlcGlja2VyW1wiX1wiK2IrXCJEYXRlcGlja2VyXCJdLmFwcGx5KGEuZGF0ZXBpY2tlcixbdGhpc10uY29uY2F0KGYpKTphLmRhdGVwaWNrZXIuX2F0dGFjaERhdGVwaWNrZXIodGhpcyxiKX0pfTthLmRhdGVwaWNrZXI9bmV3IGM7YS5kYXRlcGlja2VyLmluaXRpYWxpemVkPWZhbHNlO2EuZGF0ZXBpY2tlci51dWlkPShuZXcgRGF0ZSkuZ2V0VGltZSgpO2EuZGF0ZXBpY2tlci52ZXJzaW9uPVwiMS44LjE2XCI7d2luZG93W1wiRFBfalF1ZXJ5X1wiK2ddPWF9KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEsZCl7dmFyIGM9e2J1dHRvbnM6dHJ1ZSxoZWlnaHQ6dHJ1ZSxtYXhIZWlnaHQ6dHJ1ZSxtYXhXaWR0aDp0cnVlLG1pbkhlaWdodDp0cnVlLG1pbldpZHRoOnRydWUsd2lkdGg6dHJ1ZX0sZT17bWF4SGVpZ2h0OnRydWUsbWF4V2lkdGg6dHJ1ZSxtaW5IZWlnaHQ6dHJ1ZSxtaW5XaWR0aDp0cnVlfSxoPWEuYXR0ckZufHx7dmFsOnRydWUsY3NzOnRydWUsaHRtbDp0cnVlLHRleHQ6dHJ1ZSxkYXRhOnRydWUsd2lkdGg6dHJ1ZSxoZWlnaHQ6dHJ1ZSxvZmZzZXQ6dHJ1ZSxjbGljazp0cnVlfTthLndpZGdldChcInVpLmRpYWxvZ1wiLHtvcHRpb25zOnthdXRvT3Blbjp0cnVlLGJ1dHRvbnM6e30sY2xvc2VPbkVzY2FwZTp0cnVlLGNsb3NlVGV4dDpcImNsb3NlXCIsZGlhbG9nQ2xhc3M6XCJcIixkcmFnZ2FibGU6dHJ1ZSxoaWRlOm51bGwsaGVpZ2h0OlwiYXV0b1wiLG1heEhlaWdodDpmYWxzZSxtYXhXaWR0aDpmYWxzZSxtaW5IZWlnaHQ6MTUwLG1pbldpZHRoOjE1MCxtb2RhbDpmYWxzZSxcbnBvc2l0aW9uOntteTpcImNlbnRlclwiLGF0OlwiY2VudGVyXCIsY29sbGlzaW9uOlwiZml0XCIsdXNpbmc6ZnVuY3Rpb24oZyl7dmFyIGk9YSh0aGlzKS5jc3MoZykub2Zmc2V0KCkudG9wO2k8MCYmYSh0aGlzKS5jc3MoXCJ0b3BcIixnLnRvcC1pKX19LHJlc2l6YWJsZTp0cnVlLHNob3c6bnVsbCxzdGFjazp0cnVlLHRpdGxlOlwiXCIsd2lkdGg6MzAwLHpJbmRleDoxRTN9LF9jcmVhdGU6ZnVuY3Rpb24oKXt0aGlzLm9yaWdpbmFsVGl0bGU9dGhpcy5lbGVtZW50LmF0dHIoXCJ0aXRsZVwiKTtpZih0eXBlb2YgdGhpcy5vcmlnaW5hbFRpdGxlIT09XCJzdHJpbmdcIil0aGlzLm9yaWdpbmFsVGl0bGU9XCJcIjt0aGlzLm9wdGlvbnMudGl0bGU9dGhpcy5vcHRpb25zLnRpdGxlfHx0aGlzLm9yaWdpbmFsVGl0bGU7dmFyIGc9dGhpcyxpPWcub3B0aW9ucyxiPWkudGl0bGV8fFwiJiMxNjA7XCIsZj1hLnVpLmRpYWxvZy5nZXRUaXRsZUlkKGcuZWxlbWVudCksaj0oZy51aURpYWxvZz1hKFwiPGRpdj48L2Rpdj5cIikpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLmhpZGUoKS5hZGRDbGFzcyhcInVpLWRpYWxvZyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCBcIitcbmkuZGlhbG9nQ2xhc3MpLmNzcyh7ekluZGV4OmkuekluZGV4fSkuYXR0cihcInRhYkluZGV4XCIsLTEpLmNzcyhcIm91dGxpbmVcIiwwKS5rZXlkb3duKGZ1bmN0aW9uKG4pe2lmKGkuY2xvc2VPbkVzY2FwZSYmIW4uaXNEZWZhdWx0UHJldmVudGVkKCkmJm4ua2V5Q29kZSYmbi5rZXlDb2RlPT09YS51aS5rZXlDb2RlLkVTQ0FQRSl7Zy5jbG9zZShuKTtuLnByZXZlbnREZWZhdWx0KCl9fSkuYXR0cih7cm9sZTpcImRpYWxvZ1wiLFwiYXJpYS1sYWJlbGxlZGJ5XCI6Zn0pLm1vdXNlZG93bihmdW5jdGlvbihuKXtnLm1vdmVUb1RvcChmYWxzZSxuKX0pO2cuZWxlbWVudC5zaG93KCkucmVtb3ZlQXR0cihcInRpdGxlXCIpLmFkZENsYXNzKFwidWktZGlhbG9nLWNvbnRlbnQgdWktd2lkZ2V0LWNvbnRlbnRcIikuYXBwZW5kVG8oaik7dmFyIGw9KGcudWlEaWFsb2dUaXRsZWJhcj1hKFwiPGRpdj48L2Rpdj5cIikpLmFkZENsYXNzKFwidWktZGlhbG9nLXRpdGxlYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWFsbCB1aS1oZWxwZXItY2xlYXJmaXhcIikucHJlcGVuZFRvKGopLFxubz1hKCc8YSBocmVmPVwiI1wiPjwvYT4nKS5hZGRDbGFzcyhcInVpLWRpYWxvZy10aXRsZWJhci1jbG9zZSB1aS1jb3JuZXItYWxsXCIpLmF0dHIoXCJyb2xlXCIsXCJidXR0b25cIikuaG92ZXIoZnVuY3Rpb24oKXtvLmFkZENsYXNzKFwidWktc3RhdGUtaG92ZXJcIil9LGZ1bmN0aW9uKCl7by5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpfSkuZm9jdXMoZnVuY3Rpb24oKXtvLmFkZENsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9KS5ibHVyKGZ1bmN0aW9uKCl7by5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWZvY3VzXCIpfSkuY2xpY2soZnVuY3Rpb24obil7Zy5jbG9zZShuKTtyZXR1cm4gZmFsc2V9KS5hcHBlbmRUbyhsKTsoZy51aURpYWxvZ1RpdGxlYmFyQ2xvc2VUZXh0PWEoXCI8c3Bhbj48L3NwYW4+XCIpKS5hZGRDbGFzcyhcInVpLWljb24gdWktaWNvbi1jbG9zZXRoaWNrXCIpLnRleHQoaS5jbG9zZVRleHQpLmFwcGVuZFRvKG8pO2EoXCI8c3Bhbj48L3NwYW4+XCIpLmFkZENsYXNzKFwidWktZGlhbG9nLXRpdGxlXCIpLmF0dHIoXCJpZFwiLFxuZikuaHRtbChiKS5wcmVwZW5kVG8obCk7aWYoYS5pc0Z1bmN0aW9uKGkuYmVmb3JlY2xvc2UpJiYhYS5pc0Z1bmN0aW9uKGkuYmVmb3JlQ2xvc2UpKWkuYmVmb3JlQ2xvc2U9aS5iZWZvcmVjbG9zZTtsLmZpbmQoXCIqXCIpLmFkZChsKS5kaXNhYmxlU2VsZWN0aW9uKCk7aS5kcmFnZ2FibGUmJmEuZm4uZHJhZ2dhYmxlJiZnLl9tYWtlRHJhZ2dhYmxlKCk7aS5yZXNpemFibGUmJmEuZm4ucmVzaXphYmxlJiZnLl9tYWtlUmVzaXphYmxlKCk7Zy5fY3JlYXRlQnV0dG9ucyhpLmJ1dHRvbnMpO2cuX2lzT3Blbj1mYWxzZTthLmZuLmJnaWZyYW1lJiZqLmJnaWZyYW1lKCl9LF9pbml0OmZ1bmN0aW9uKCl7dGhpcy5vcHRpb25zLmF1dG9PcGVuJiZ0aGlzLm9wZW4oKX0sZGVzdHJveTpmdW5jdGlvbigpe3ZhciBnPXRoaXM7Zy5vdmVybGF5JiZnLm92ZXJsYXkuZGVzdHJveSgpO2cudWlEaWFsb2cuaGlkZSgpO2cuZWxlbWVudC51bmJpbmQoXCIuZGlhbG9nXCIpLnJlbW92ZURhdGEoXCJkaWFsb2dcIikucmVtb3ZlQ2xhc3MoXCJ1aS1kaWFsb2ctY29udGVudCB1aS13aWRnZXQtY29udGVudFwiKS5oaWRlKCkuYXBwZW5kVG8oXCJib2R5XCIpO1xuZy51aURpYWxvZy5yZW1vdmUoKTtnLm9yaWdpbmFsVGl0bGUmJmcuZWxlbWVudC5hdHRyKFwidGl0bGVcIixnLm9yaWdpbmFsVGl0bGUpO3JldHVybiBnfSx3aWRnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy51aURpYWxvZ30sY2xvc2U6ZnVuY3Rpb24oZyl7dmFyIGk9dGhpcyxiLGY7aWYoZmFsc2UhPT1pLl90cmlnZ2VyKFwiYmVmb3JlQ2xvc2VcIixnKSl7aS5vdmVybGF5JiZpLm92ZXJsYXkuZGVzdHJveSgpO2kudWlEaWFsb2cudW5iaW5kKFwia2V5cHJlc3MudWktZGlhbG9nXCIpO2kuX2lzT3Blbj1mYWxzZTtpZihpLm9wdGlvbnMuaGlkZSlpLnVpRGlhbG9nLmhpZGUoaS5vcHRpb25zLmhpZGUsZnVuY3Rpb24oKXtpLl90cmlnZ2VyKFwiY2xvc2VcIixnKX0pO2Vsc2V7aS51aURpYWxvZy5oaWRlKCk7aS5fdHJpZ2dlcihcImNsb3NlXCIsZyl9YS51aS5kaWFsb2cub3ZlcmxheS5yZXNpemUoKTtpZihpLm9wdGlvbnMubW9kYWwpe2I9MDthKFwiLnVpLWRpYWxvZ1wiKS5lYWNoKGZ1bmN0aW9uKCl7aWYodGhpcyE9PVxuaS51aURpYWxvZ1swXSl7Zj1hKHRoaXMpLmNzcyhcInotaW5kZXhcIik7aXNOYU4oZil8fChiPU1hdGgubWF4KGIsZikpfX0pO2EudWkuZGlhbG9nLm1heFo9Yn1yZXR1cm4gaX19LGlzT3BlbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9pc09wZW59LG1vdmVUb1RvcDpmdW5jdGlvbihnLGkpe3ZhciBiPXRoaXMsZj1iLm9wdGlvbnM7aWYoZi5tb2RhbCYmIWd8fCFmLnN0YWNrJiYhZi5tb2RhbClyZXR1cm4gYi5fdHJpZ2dlcihcImZvY3VzXCIsaSk7aWYoZi56SW5kZXg+YS51aS5kaWFsb2cubWF4WilhLnVpLmRpYWxvZy5tYXhaPWYuekluZGV4O2lmKGIub3ZlcmxheSl7YS51aS5kaWFsb2cubWF4Wis9MTtiLm92ZXJsYXkuJGVsLmNzcyhcInotaW5kZXhcIixhLnVpLmRpYWxvZy5vdmVybGF5Lm1heFo9YS51aS5kaWFsb2cubWF4Wil9Zz17c2Nyb2xsVG9wOmIuZWxlbWVudC5zY3JvbGxUb3AoKSxzY3JvbGxMZWZ0OmIuZWxlbWVudC5zY3JvbGxMZWZ0KCl9O2EudWkuZGlhbG9nLm1heForPTE7XG5iLnVpRGlhbG9nLmNzcyhcInotaW5kZXhcIixhLnVpLmRpYWxvZy5tYXhaKTtiLmVsZW1lbnQuYXR0cihnKTtiLl90cmlnZ2VyKFwiZm9jdXNcIixpKTtyZXR1cm4gYn0sb3BlbjpmdW5jdGlvbigpe2lmKCF0aGlzLl9pc09wZW4pe3ZhciBnPXRoaXMsaT1nLm9wdGlvbnMsYj1nLnVpRGlhbG9nO2cub3ZlcmxheT1pLm1vZGFsP25ldyBhLnVpLmRpYWxvZy5vdmVybGF5KGcpOm51bGw7Zy5fc2l6ZSgpO2cuX3Bvc2l0aW9uKGkucG9zaXRpb24pO2Iuc2hvdyhpLnNob3cpO2cubW92ZVRvVG9wKHRydWUpO2kubW9kYWwmJmIuYmluZChcImtleXByZXNzLnVpLWRpYWxvZ1wiLGZ1bmN0aW9uKGYpe2lmKGYua2V5Q29kZT09PWEudWkua2V5Q29kZS5UQUIpe3ZhciBqPWEoXCI6dGFiYmFibGVcIix0aGlzKSxsPWouZmlsdGVyKFwiOmZpcnN0XCIpO2o9ai5maWx0ZXIoXCI6bGFzdFwiKTtpZihmLnRhcmdldD09PWpbMF0mJiFmLnNoaWZ0S2V5KXtsLmZvY3VzKDEpO3JldHVybiBmYWxzZX1lbHNlIGlmKGYudGFyZ2V0PT09XG5sWzBdJiZmLnNoaWZ0S2V5KXtqLmZvY3VzKDEpO3JldHVybiBmYWxzZX19fSk7YShnLmVsZW1lbnQuZmluZChcIjp0YWJiYWJsZVwiKS5nZXQoKS5jb25jYXQoYi5maW5kKFwiLnVpLWRpYWxvZy1idXR0b25wYW5lIDp0YWJiYWJsZVwiKS5nZXQoKS5jb25jYXQoYi5nZXQoKSkpKS5lcSgwKS5mb2N1cygpO2cuX2lzT3Blbj10cnVlO2cuX3RyaWdnZXIoXCJvcGVuXCIpO3JldHVybiBnfX0sX2NyZWF0ZUJ1dHRvbnM6ZnVuY3Rpb24oZyl7dmFyIGk9dGhpcyxiPWZhbHNlLGY9YShcIjxkaXY+PC9kaXY+XCIpLmFkZENsYXNzKFwidWktZGlhbG9nLWJ1dHRvbnBhbmUgdWktd2lkZ2V0LWNvbnRlbnQgdWktaGVscGVyLWNsZWFyZml4XCIpLGo9YShcIjxkaXY+PC9kaXY+XCIpLmFkZENsYXNzKFwidWktZGlhbG9nLWJ1dHRvbnNldFwiKS5hcHBlbmRUbyhmKTtpLnVpRGlhbG9nLmZpbmQoXCIudWktZGlhbG9nLWJ1dHRvbnBhbmVcIikucmVtb3ZlKCk7dHlwZW9mIGc9PT1cIm9iamVjdFwiJiZnIT09bnVsbCYmYS5lYWNoKGcsXG5mdW5jdGlvbigpe3JldHVybiEoYj10cnVlKX0pO2lmKGIpe2EuZWFjaChnLGZ1bmN0aW9uKGwsbyl7bz1hLmlzRnVuY3Rpb24obyk/e2NsaWNrOm8sdGV4dDpsfTpvO3ZhciBuPWEoJzxidXR0b24gdHlwZT1cImJ1dHRvblwiPjwvYnV0dG9uPicpLmNsaWNrKGZ1bmN0aW9uKCl7by5jbGljay5hcHBseShpLmVsZW1lbnRbMF0sYXJndW1lbnRzKX0pLmFwcGVuZFRvKGopO2EuZWFjaChvLGZ1bmN0aW9uKGssbSl7aWYoayE9PVwiY2xpY2tcIilrIGluIGg/bltrXShtKTpuLmF0dHIoayxtKX0pO2EuZm4uYnV0dG9uJiZuLmJ1dHRvbigpfSk7Zi5hcHBlbmRUbyhpLnVpRGlhbG9nKX19LF9tYWtlRHJhZ2dhYmxlOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gZyhsKXtyZXR1cm57cG9zaXRpb246bC5wb3NpdGlvbixvZmZzZXQ6bC5vZmZzZXR9fXZhciBpPXRoaXMsYj1pLm9wdGlvbnMsZj1hKGRvY3VtZW50KSxqO2kudWlEaWFsb2cuZHJhZ2dhYmxlKHtjYW5jZWw6XCIudWktZGlhbG9nLWNvbnRlbnQsIC51aS1kaWFsb2ctdGl0bGViYXItY2xvc2VcIixcbmhhbmRsZTpcIi51aS1kaWFsb2ctdGl0bGViYXJcIixjb250YWlubWVudDpcImRvY3VtZW50XCIsc3RhcnQ6ZnVuY3Rpb24obCxvKXtqPWIuaGVpZ2h0PT09XCJhdXRvXCI/XCJhdXRvXCI6YSh0aGlzKS5oZWlnaHQoKTthKHRoaXMpLmhlaWdodChhKHRoaXMpLmhlaWdodCgpKS5hZGRDbGFzcyhcInVpLWRpYWxvZy1kcmFnZ2luZ1wiKTtpLl90cmlnZ2VyKFwiZHJhZ1N0YXJ0XCIsbCxnKG8pKX0sZHJhZzpmdW5jdGlvbihsLG8pe2kuX3RyaWdnZXIoXCJkcmFnXCIsbCxnKG8pKX0sc3RvcDpmdW5jdGlvbihsLG8pe2IucG9zaXRpb249W28ucG9zaXRpb24ubGVmdC1mLnNjcm9sbExlZnQoKSxvLnBvc2l0aW9uLnRvcC1mLnNjcm9sbFRvcCgpXTthKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktZGlhbG9nLWRyYWdnaW5nXCIpLmhlaWdodChqKTtpLl90cmlnZ2VyKFwiZHJhZ1N0b3BcIixsLGcobykpO2EudWkuZGlhbG9nLm92ZXJsYXkucmVzaXplKCl9fSl9LF9tYWtlUmVzaXphYmxlOmZ1bmN0aW9uKGcpe2Z1bmN0aW9uIGkobCl7cmV0dXJue29yaWdpbmFsUG9zaXRpb246bC5vcmlnaW5hbFBvc2l0aW9uLFxub3JpZ2luYWxTaXplOmwub3JpZ2luYWxTaXplLHBvc2l0aW9uOmwucG9zaXRpb24sc2l6ZTpsLnNpemV9fWc9Zz09PWQ/dGhpcy5vcHRpb25zLnJlc2l6YWJsZTpnO3ZhciBiPXRoaXMsZj1iLm9wdGlvbnMsaj1iLnVpRGlhbG9nLmNzcyhcInBvc2l0aW9uXCIpO2c9dHlwZW9mIGc9PT1cInN0cmluZ1wiP2c6XCJuLGUscyx3LHNlLHN3LG5lLG53XCI7Yi51aURpYWxvZy5yZXNpemFibGUoe2NhbmNlbDpcIi51aS1kaWFsb2ctY29udGVudFwiLGNvbnRhaW5tZW50OlwiZG9jdW1lbnRcIixhbHNvUmVzaXplOmIuZWxlbWVudCxtYXhXaWR0aDpmLm1heFdpZHRoLG1heEhlaWdodDpmLm1heEhlaWdodCxtaW5XaWR0aDpmLm1pbldpZHRoLG1pbkhlaWdodDpiLl9taW5IZWlnaHQoKSxoYW5kbGVzOmcsc3RhcnQ6ZnVuY3Rpb24obCxvKXthKHRoaXMpLmFkZENsYXNzKFwidWktZGlhbG9nLXJlc2l6aW5nXCIpO2IuX3RyaWdnZXIoXCJyZXNpemVTdGFydFwiLGwsaShvKSl9LHJlc2l6ZTpmdW5jdGlvbihsLG8pe2IuX3RyaWdnZXIoXCJyZXNpemVcIixcbmwsaShvKSl9LHN0b3A6ZnVuY3Rpb24obCxvKXthKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktZGlhbG9nLXJlc2l6aW5nXCIpO2YuaGVpZ2h0PWEodGhpcykuaGVpZ2h0KCk7Zi53aWR0aD1hKHRoaXMpLndpZHRoKCk7Yi5fdHJpZ2dlcihcInJlc2l6ZVN0b3BcIixsLGkobykpO2EudWkuZGlhbG9nLm92ZXJsYXkucmVzaXplKCl9fSkuY3NzKFwicG9zaXRpb25cIixqKS5maW5kKFwiLnVpLXJlc2l6YWJsZS1zZVwiKS5hZGRDbGFzcyhcInVpLWljb24gdWktaWNvbi1ncmlwLWRpYWdvbmFsLXNlXCIpfSxfbWluSGVpZ2h0OmZ1bmN0aW9uKCl7dmFyIGc9dGhpcy5vcHRpb25zO3JldHVybiBnLmhlaWdodD09PVwiYXV0b1wiP2cubWluSGVpZ2h0Ok1hdGgubWluKGcubWluSGVpZ2h0LGcuaGVpZ2h0KX0sX3Bvc2l0aW9uOmZ1bmN0aW9uKGcpe3ZhciBpPVtdLGI9WzAsMF0sZjtpZihnKXtpZih0eXBlb2YgZz09PVwic3RyaW5nXCJ8fHR5cGVvZiBnPT09XCJvYmplY3RcIiYmXCIwXCJpbiBnKXtpPWcuc3BsaXQ/Zy5zcGxpdChcIiBcIik6XG5bZ1swXSxnWzFdXTtpZihpLmxlbmd0aD09PTEpaVsxXT1pWzBdO2EuZWFjaChbXCJsZWZ0XCIsXCJ0b3BcIl0sZnVuY3Rpb24oaixsKXtpZigraVtqXT09PWlbal0pe2Jbal09aVtqXTtpW2pdPWx9fSk7Zz17bXk6aS5qb2luKFwiIFwiKSxhdDppLmpvaW4oXCIgXCIpLG9mZnNldDpiLmpvaW4oXCIgXCIpfX1nPWEuZXh0ZW5kKHt9LGEudWkuZGlhbG9nLnByb3RvdHlwZS5vcHRpb25zLnBvc2l0aW9uLGcpfWVsc2UgZz1hLnVpLmRpYWxvZy5wcm90b3R5cGUub3B0aW9ucy5wb3NpdGlvbjsoZj10aGlzLnVpRGlhbG9nLmlzKFwiOnZpc2libGVcIikpfHx0aGlzLnVpRGlhbG9nLnNob3coKTt0aGlzLnVpRGlhbG9nLmNzcyh7dG9wOjAsbGVmdDowfSkucG9zaXRpb24oYS5leHRlbmQoe29mOndpbmRvd30sZykpO2Z8fHRoaXMudWlEaWFsb2cuaGlkZSgpfSxfc2V0T3B0aW9uczpmdW5jdGlvbihnKXt2YXIgaT10aGlzLGI9e30sZj1mYWxzZTthLmVhY2goZyxmdW5jdGlvbihqLGwpe2kuX3NldE9wdGlvbihqLGwpO1xuaWYoaiBpbiBjKWY9dHJ1ZTtpZihqIGluIGUpYltqXT1sfSk7ZiYmdGhpcy5fc2l6ZSgpO3RoaXMudWlEaWFsb2cuaXMoXCI6ZGF0YShyZXNpemFibGUpXCIpJiZ0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZShcIm9wdGlvblwiLGIpfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGcsaSl7dmFyIGI9dGhpcyxmPWIudWlEaWFsb2c7c3dpdGNoKGcpe2Nhc2UgXCJiZWZvcmVjbG9zZVwiOmc9XCJiZWZvcmVDbG9zZVwiO2JyZWFrO2Nhc2UgXCJidXR0b25zXCI6Yi5fY3JlYXRlQnV0dG9ucyhpKTticmVhaztjYXNlIFwiY2xvc2VUZXh0XCI6Yi51aURpYWxvZ1RpdGxlYmFyQ2xvc2VUZXh0LnRleHQoXCJcIitpKTticmVhaztjYXNlIFwiZGlhbG9nQ2xhc3NcIjpmLnJlbW92ZUNsYXNzKGIub3B0aW9ucy5kaWFsb2dDbGFzcykuYWRkQ2xhc3MoXCJ1aS1kaWFsb2cgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwgXCIraSk7YnJlYWs7Y2FzZSBcImRpc2FibGVkXCI6aT9mLmFkZENsYXNzKFwidWktZGlhbG9nLWRpc2FibGVkXCIpOlxuZi5yZW1vdmVDbGFzcyhcInVpLWRpYWxvZy1kaXNhYmxlZFwiKTticmVhaztjYXNlIFwiZHJhZ2dhYmxlXCI6dmFyIGo9Zi5pcyhcIjpkYXRhKGRyYWdnYWJsZSlcIik7aiYmIWkmJmYuZHJhZ2dhYmxlKFwiZGVzdHJveVwiKTshaiYmaSYmYi5fbWFrZURyYWdnYWJsZSgpO2JyZWFrO2Nhc2UgXCJwb3NpdGlvblwiOmIuX3Bvc2l0aW9uKGkpO2JyZWFrO2Nhc2UgXCJyZXNpemFibGVcIjooaj1mLmlzKFwiOmRhdGEocmVzaXphYmxlKVwiKSkmJiFpJiZmLnJlc2l6YWJsZShcImRlc3Ryb3lcIik7aiYmdHlwZW9mIGk9PT1cInN0cmluZ1wiJiZmLnJlc2l6YWJsZShcIm9wdGlvblwiLFwiaGFuZGxlc1wiLGkpOyFqJiZpIT09ZmFsc2UmJmIuX21ha2VSZXNpemFibGUoaSk7YnJlYWs7Y2FzZSBcInRpdGxlXCI6YShcIi51aS1kaWFsb2ctdGl0bGVcIixiLnVpRGlhbG9nVGl0bGViYXIpLmh0bWwoXCJcIisoaXx8XCImIzE2MDtcIikpO2JyZWFrfWEuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KGIsYXJndW1lbnRzKX0sX3NpemU6ZnVuY3Rpb24oKXt2YXIgZz1cbnRoaXMub3B0aW9ucyxpLGIsZj10aGlzLnVpRGlhbG9nLmlzKFwiOnZpc2libGVcIik7dGhpcy5lbGVtZW50LnNob3coKS5jc3Moe3dpZHRoOlwiYXV0b1wiLG1pbkhlaWdodDowLGhlaWdodDowfSk7aWYoZy5taW5XaWR0aD5nLndpZHRoKWcud2lkdGg9Zy5taW5XaWR0aDtpPXRoaXMudWlEaWFsb2cuY3NzKHtoZWlnaHQ6XCJhdXRvXCIsd2lkdGg6Zy53aWR0aH0pLmhlaWdodCgpO2I9TWF0aC5tYXgoMCxnLm1pbkhlaWdodC1pKTtpZihnLmhlaWdodD09PVwiYXV0b1wiKWlmKGEuc3VwcG9ydC5taW5IZWlnaHQpdGhpcy5lbGVtZW50LmNzcyh7bWluSGVpZ2h0OmIsaGVpZ2h0OlwiYXV0b1wifSk7ZWxzZXt0aGlzLnVpRGlhbG9nLnNob3coKTtnPXRoaXMuZWxlbWVudC5jc3MoXCJoZWlnaHRcIixcImF1dG9cIikuaGVpZ2h0KCk7Znx8dGhpcy51aURpYWxvZy5oaWRlKCk7dGhpcy5lbGVtZW50LmhlaWdodChNYXRoLm1heChnLGIpKX1lbHNlIHRoaXMuZWxlbWVudC5oZWlnaHQoTWF0aC5tYXgoZy5oZWlnaHQtXG5pLDApKTt0aGlzLnVpRGlhbG9nLmlzKFwiOmRhdGEocmVzaXphYmxlKVwiKSYmdGhpcy51aURpYWxvZy5yZXNpemFibGUoXCJvcHRpb25cIixcIm1pbkhlaWdodFwiLHRoaXMuX21pbkhlaWdodCgpKX19KTthLmV4dGVuZChhLnVpLmRpYWxvZyx7dmVyc2lvbjpcIjEuOC4xNlwiLHV1aWQ6MCxtYXhaOjAsZ2V0VGl0bGVJZDpmdW5jdGlvbihnKXtnPWcuYXR0cihcImlkXCIpO2lmKCFnKXt0aGlzLnV1aWQrPTE7Zz10aGlzLnV1aWR9cmV0dXJuXCJ1aS1kaWFsb2ctdGl0bGUtXCIrZ30sb3ZlcmxheTpmdW5jdGlvbihnKXt0aGlzLiRlbD1hLnVpLmRpYWxvZy5vdmVybGF5LmNyZWF0ZShnKX19KTthLmV4dGVuZChhLnVpLmRpYWxvZy5vdmVybGF5LHtpbnN0YW5jZXM6W10sb2xkSW5zdGFuY2VzOltdLG1heFo6MCxldmVudHM6YS5tYXAoXCJmb2N1cyxtb3VzZWRvd24sbW91c2V1cCxrZXlkb3duLGtleXByZXNzLGNsaWNrXCIuc3BsaXQoXCIsXCIpLGZ1bmN0aW9uKGcpe3JldHVybiBnK1wiLmRpYWxvZy1vdmVybGF5XCJ9KS5qb2luKFwiIFwiKSxcbmNyZWF0ZTpmdW5jdGlvbihnKXtpZih0aGlzLmluc3RhbmNlcy5sZW5ndGg9PT0wKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YS51aS5kaWFsb2cub3ZlcmxheS5pbnN0YW5jZXMubGVuZ3RoJiZhKGRvY3VtZW50KS5iaW5kKGEudWkuZGlhbG9nLm92ZXJsYXkuZXZlbnRzLGZ1bmN0aW9uKGIpe2lmKGEoYi50YXJnZXQpLnpJbmRleCgpPGEudWkuZGlhbG9nLm92ZXJsYXkubWF4WilyZXR1cm4gZmFsc2V9KX0sMSk7YShkb2N1bWVudCkuYmluZChcImtleWRvd24uZGlhbG9nLW92ZXJsYXlcIixmdW5jdGlvbihiKXtpZihnLm9wdGlvbnMuY2xvc2VPbkVzY2FwZSYmIWIuaXNEZWZhdWx0UHJldmVudGVkKCkmJmIua2V5Q29kZSYmYi5rZXlDb2RlPT09YS51aS5rZXlDb2RlLkVTQ0FQRSl7Zy5jbG9zZShiKTtiLnByZXZlbnREZWZhdWx0KCl9fSk7YSh3aW5kb3cpLmJpbmQoXCJyZXNpemUuZGlhbG9nLW92ZXJsYXlcIixhLnVpLmRpYWxvZy5vdmVybGF5LnJlc2l6ZSl9dmFyIGk9KHRoaXMub2xkSW5zdGFuY2VzLnBvcCgpfHxcbmEoXCI8ZGl2PjwvZGl2PlwiKS5hZGRDbGFzcyhcInVpLXdpZGdldC1vdmVybGF5XCIpKS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KS5jc3Moe3dpZHRoOnRoaXMud2lkdGgoKSxoZWlnaHQ6dGhpcy5oZWlnaHQoKX0pO2EuZm4uYmdpZnJhbWUmJmkuYmdpZnJhbWUoKTt0aGlzLmluc3RhbmNlcy5wdXNoKGkpO3JldHVybiBpfSxkZXN0cm95OmZ1bmN0aW9uKGcpe3ZhciBpPWEuaW5BcnJheShnLHRoaXMuaW5zdGFuY2VzKTtpIT0tMSYmdGhpcy5vbGRJbnN0YW5jZXMucHVzaCh0aGlzLmluc3RhbmNlcy5zcGxpY2UoaSwxKVswXSk7dGhpcy5pbnN0YW5jZXMubGVuZ3RoPT09MCYmYShbZG9jdW1lbnQsd2luZG93XSkudW5iaW5kKFwiLmRpYWxvZy1vdmVybGF5XCIpO2cucmVtb3ZlKCk7dmFyIGI9MDthLmVhY2godGhpcy5pbnN0YW5jZXMsZnVuY3Rpb24oKXtiPU1hdGgubWF4KGIsdGhpcy5jc3MoXCJ6LWluZGV4XCIpKX0pO3RoaXMubWF4Wj1ifSxoZWlnaHQ6ZnVuY3Rpb24oKXt2YXIgZyxpO2lmKGEuYnJvd3Nlci5tc2llJiZcbmEuYnJvd3Nlci52ZXJzaW9uPDcpe2c9TWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodCxkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodCk7aT1NYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0LGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0KTtyZXR1cm4gZzxpP2Eod2luZG93KS5oZWlnaHQoKStcInB4XCI6ZytcInB4XCJ9ZWxzZSByZXR1cm4gYShkb2N1bWVudCkuaGVpZ2h0KCkrXCJweFwifSx3aWR0aDpmdW5jdGlvbigpe3ZhciBnLGk7aWYoYS5icm93c2VyLm1zaWUpe2c9TWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFdpZHRoLGRvY3VtZW50LmJvZHkuc2Nyb2xsV2lkdGgpO2k9TWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoLGRvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGgpO3JldHVybiBnPGk/YSh3aW5kb3cpLndpZHRoKCkrXCJweFwiOmcrXCJweFwifWVsc2UgcmV0dXJuIGEoZG9jdW1lbnQpLndpZHRoKCkrXG5cInB4XCJ9LHJlc2l6ZTpmdW5jdGlvbigpe3ZhciBnPWEoW10pO2EuZWFjaChhLnVpLmRpYWxvZy5vdmVybGF5Lmluc3RhbmNlcyxmdW5jdGlvbigpe2c9Zy5hZGQodGhpcyl9KTtnLmNzcyh7d2lkdGg6MCxoZWlnaHQ6MH0pLmNzcyh7d2lkdGg6YS51aS5kaWFsb2cub3ZlcmxheS53aWR0aCgpLGhlaWdodDphLnVpLmRpYWxvZy5vdmVybGF5LmhlaWdodCgpfSl9fSk7YS5leHRlbmQoYS51aS5kaWFsb2cub3ZlcmxheS5wcm90b3R5cGUse2Rlc3Ryb3k6ZnVuY3Rpb24oKXthLnVpLmRpYWxvZy5vdmVybGF5LmRlc3Ryb3kodGhpcy4kZWwpfX0pfSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLnVpPWEudWl8fHt9O3ZhciBkPS9sZWZ0fGNlbnRlcnxyaWdodC8sYz0vdG9wfGNlbnRlcnxib3R0b20vLGU9YS5mbi5wb3NpdGlvbixoPWEuZm4ub2Zmc2V0O2EuZm4ucG9zaXRpb249ZnVuY3Rpb24oZyl7aWYoIWd8fCFnLm9mKXJldHVybiBlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtnPWEuZXh0ZW5kKHt9LGcpO3ZhciBpPWEoZy5vZiksYj1pWzBdLGY9KGcuY29sbGlzaW9ufHxcImZsaXBcIikuc3BsaXQoXCIgXCIpLGo9Zy5vZmZzZXQ/Zy5vZmZzZXQuc3BsaXQoXCIgXCIpOlswLDBdLGwsbyxuO2lmKGIubm9kZVR5cGU9PT05KXtsPWkud2lkdGgoKTtvPWkuaGVpZ2h0KCk7bj17dG9wOjAsbGVmdDowfX1lbHNlIGlmKGIuc2V0VGltZW91dCl7bD1pLndpZHRoKCk7bz1pLmhlaWdodCgpO249e3RvcDppLnNjcm9sbFRvcCgpLGxlZnQ6aS5zY3JvbGxMZWZ0KCl9fWVsc2UgaWYoYi5wcmV2ZW50RGVmYXVsdCl7Zy5hdD1cImxlZnQgdG9wXCI7bD1vPTA7bj17dG9wOmcub2YucGFnZVksXG5sZWZ0Omcub2YucGFnZVh9fWVsc2V7bD1pLm91dGVyV2lkdGgoKTtvPWkub3V0ZXJIZWlnaHQoKTtuPWkub2Zmc2V0KCl9YS5lYWNoKFtcIm15XCIsXCJhdFwiXSxmdW5jdGlvbigpe3ZhciBrPShnW3RoaXNdfHxcIlwiKS5zcGxpdChcIiBcIik7aWYoay5sZW5ndGg9PT0xKWs9ZC50ZXN0KGtbMF0pP2suY29uY2F0KFtcImNlbnRlclwiXSk6Yy50ZXN0KGtbMF0pP1tcImNlbnRlclwiXS5jb25jYXQoayk6W1wiY2VudGVyXCIsXCJjZW50ZXJcIl07a1swXT1kLnRlc3Qoa1swXSk/a1swXTpcImNlbnRlclwiO2tbMV09Yy50ZXN0KGtbMV0pP2tbMV06XCJjZW50ZXJcIjtnW3RoaXNdPWt9KTtpZihmLmxlbmd0aD09PTEpZlsxXT1mWzBdO2pbMF09cGFyc2VJbnQoalswXSwxMCl8fDA7aWYoai5sZW5ndGg9PT0xKWpbMV09alswXTtqWzFdPXBhcnNlSW50KGpbMV0sMTApfHwwO2lmKGcuYXRbMF09PT1cInJpZ2h0XCIpbi5sZWZ0Kz1sO2Vsc2UgaWYoZy5hdFswXT09PVwiY2VudGVyXCIpbi5sZWZ0Kz1sLzI7aWYoZy5hdFsxXT09PVwiYm90dG9tXCIpbi50b3ArPVxubztlbHNlIGlmKGcuYXRbMV09PT1cImNlbnRlclwiKW4udG9wKz1vLzI7bi5sZWZ0Kz1qWzBdO24udG9wKz1qWzFdO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgaz1hKHRoaXMpLG09ay5vdXRlcldpZHRoKCkscD1rLm91dGVySGVpZ2h0KCkscT1wYXJzZUludChhLmN1ckNTUyh0aGlzLFwibWFyZ2luTGVmdFwiLHRydWUpKXx8MCxzPXBhcnNlSW50KGEuY3VyQ1NTKHRoaXMsXCJtYXJnaW5Ub3BcIix0cnVlKSl8fDAscj1tK3ErKHBhcnNlSW50KGEuY3VyQ1NTKHRoaXMsXCJtYXJnaW5SaWdodFwiLHRydWUpKXx8MCksdT1wK3MrKHBhcnNlSW50KGEuY3VyQ1NTKHRoaXMsXCJtYXJnaW5Cb3R0b21cIix0cnVlKSl8fDApLHY9YS5leHRlbmQoe30sbiksdztpZihnLm15WzBdPT09XCJyaWdodFwiKXYubGVmdC09bTtlbHNlIGlmKGcubXlbMF09PT1cImNlbnRlclwiKXYubGVmdC09bS8yO2lmKGcubXlbMV09PT1cImJvdHRvbVwiKXYudG9wLT1wO2Vsc2UgaWYoZy5teVsxXT09PVwiY2VudGVyXCIpdi50b3AtPVxucC8yO3YubGVmdD1NYXRoLnJvdW5kKHYubGVmdCk7di50b3A9TWF0aC5yb3VuZCh2LnRvcCk7dz17bGVmdDp2LmxlZnQtcSx0b3A6di50b3Atc307YS5lYWNoKFtcImxlZnRcIixcInRvcFwiXSxmdW5jdGlvbih4LHkpe2EudWkucG9zaXRpb25bZlt4XV0mJmEudWkucG9zaXRpb25bZlt4XV1beV0odix7dGFyZ2V0V2lkdGg6bCx0YXJnZXRIZWlnaHQ6byxlbGVtV2lkdGg6bSxlbGVtSGVpZ2h0OnAsY29sbGlzaW9uUG9zaXRpb246dyxjb2xsaXNpb25XaWR0aDpyLGNvbGxpc2lvbkhlaWdodDp1LG9mZnNldDpqLG15OmcubXksYXQ6Zy5hdH0pfSk7YS5mbi5iZ2lmcmFtZSYmay5iZ2lmcmFtZSgpO2sub2Zmc2V0KGEuZXh0ZW5kKHYse3VzaW5nOmcudXNpbmd9KSl9KX07YS51aS5wb3NpdGlvbj17Zml0OntsZWZ0OmZ1bmN0aW9uKGcsaSl7dmFyIGI9YSh3aW5kb3cpO2I9aS5jb2xsaXNpb25Qb3NpdGlvbi5sZWZ0K2kuY29sbGlzaW9uV2lkdGgtYi53aWR0aCgpLWIuc2Nyb2xsTGVmdCgpO2cubGVmdD1cbmI+MD9nLmxlZnQtYjpNYXRoLm1heChnLmxlZnQtaS5jb2xsaXNpb25Qb3NpdGlvbi5sZWZ0LGcubGVmdCl9LHRvcDpmdW5jdGlvbihnLGkpe3ZhciBiPWEod2luZG93KTtiPWkuY29sbGlzaW9uUG9zaXRpb24udG9wK2kuY29sbGlzaW9uSGVpZ2h0LWIuaGVpZ2h0KCktYi5zY3JvbGxUb3AoKTtnLnRvcD1iPjA/Zy50b3AtYjpNYXRoLm1heChnLnRvcC1pLmNvbGxpc2lvblBvc2l0aW9uLnRvcCxnLnRvcCl9fSxmbGlwOntsZWZ0OmZ1bmN0aW9uKGcsaSl7aWYoaS5hdFswXSE9PVwiY2VudGVyXCIpe3ZhciBiPWEod2luZG93KTtiPWkuY29sbGlzaW9uUG9zaXRpb24ubGVmdCtpLmNvbGxpc2lvbldpZHRoLWIud2lkdGgoKS1iLnNjcm9sbExlZnQoKTt2YXIgZj1pLm15WzBdPT09XCJsZWZ0XCI/LWkuZWxlbVdpZHRoOmkubXlbMF09PT1cInJpZ2h0XCI/aS5lbGVtV2lkdGg6MCxqPWkuYXRbMF09PT1cImxlZnRcIj9pLnRhcmdldFdpZHRoOi1pLnRhcmdldFdpZHRoLGw9LTIqaS5vZmZzZXRbMF07Zy5sZWZ0Kz1cbmkuY29sbGlzaW9uUG9zaXRpb24ubGVmdDwwP2YraitsOmI+MD9mK2orbDowfX0sdG9wOmZ1bmN0aW9uKGcsaSl7aWYoaS5hdFsxXSE9PVwiY2VudGVyXCIpe3ZhciBiPWEod2luZG93KTtiPWkuY29sbGlzaW9uUG9zaXRpb24udG9wK2kuY29sbGlzaW9uSGVpZ2h0LWIuaGVpZ2h0KCktYi5zY3JvbGxUb3AoKTt2YXIgZj1pLm15WzFdPT09XCJ0b3BcIj8taS5lbGVtSGVpZ2h0OmkubXlbMV09PT1cImJvdHRvbVwiP2kuZWxlbUhlaWdodDowLGo9aS5hdFsxXT09PVwidG9wXCI/aS50YXJnZXRIZWlnaHQ6LWkudGFyZ2V0SGVpZ2h0LGw9LTIqaS5vZmZzZXRbMV07Zy50b3ArPWkuY29sbGlzaW9uUG9zaXRpb24udG9wPDA/ZitqK2w6Yj4wP2YraitsOjB9fX19O2lmKCFhLm9mZnNldC5zZXRPZmZzZXQpe2Eub2Zmc2V0LnNldE9mZnNldD1mdW5jdGlvbihnLGkpe2lmKC9zdGF0aWMvLnRlc3QoYS5jdXJDU1MoZyxcInBvc2l0aW9uXCIpKSlnLnN0eWxlLnBvc2l0aW9uPVwicmVsYXRpdmVcIjt2YXIgYj1hKGcpLFxuZj1iLm9mZnNldCgpLGo9cGFyc2VJbnQoYS5jdXJDU1MoZyxcInRvcFwiLHRydWUpLDEwKXx8MCxsPXBhcnNlSW50KGEuY3VyQ1NTKGcsXCJsZWZ0XCIsdHJ1ZSksMTApfHwwO2Y9e3RvcDppLnRvcC1mLnRvcCtqLGxlZnQ6aS5sZWZ0LWYubGVmdCtsfTtcInVzaW5nXCJpbiBpP2kudXNpbmcuY2FsbChnLGYpOmIuY3NzKGYpfTthLmZuLm9mZnNldD1mdW5jdGlvbihnKXt2YXIgaT10aGlzWzBdO2lmKCFpfHwhaS5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGcpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2Eub2Zmc2V0LnNldE9mZnNldCh0aGlzLGcpfSk7cmV0dXJuIGguY2FsbCh0aGlzKX19fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhLGQpe2Eud2lkZ2V0KFwidWkucHJvZ3Jlc3NiYXJcIix7b3B0aW9uczp7dmFsdWU6MCxtYXg6MTAwfSxtaW46MCxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktcHJvZ3Jlc3NiYXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGxcIikuYXR0cih7cm9sZTpcInByb2dyZXNzYmFyXCIsXCJhcmlhLXZhbHVlbWluXCI6dGhpcy5taW4sXCJhcmlhLXZhbHVlbWF4XCI6dGhpcy5vcHRpb25zLm1heCxcImFyaWEtdmFsdWVub3dcIjp0aGlzLl92YWx1ZSgpfSk7dGhpcy52YWx1ZURpdj1hKFwiPGRpdiBjbGFzcz0ndWktcHJvZ3Jlc3NiYXItdmFsdWUgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItbGVmdCc+PC9kaXY+XCIpLmFwcGVuZFRvKHRoaXMuZWxlbWVudCk7dGhpcy5vbGRWYWx1ZT10aGlzLl92YWx1ZSgpO3RoaXMuX3JlZnJlc2hWYWx1ZSgpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktcHJvZ3Jlc3NiYXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGxcIikucmVtb3ZlQXR0cihcInJvbGVcIikucmVtb3ZlQXR0cihcImFyaWEtdmFsdWVtaW5cIikucmVtb3ZlQXR0cihcImFyaWEtdmFsdWVtYXhcIikucmVtb3ZlQXR0cihcImFyaWEtdmFsdWVub3dcIik7XG50aGlzLnZhbHVlRGl2LnJlbW92ZSgpO2EuV2lkZ2V0LnByb3RvdHlwZS5kZXN0cm95LmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sdmFsdWU6ZnVuY3Rpb24oYyl7aWYoYz09PWQpcmV0dXJuIHRoaXMuX3ZhbHVlKCk7dGhpcy5fc2V0T3B0aW9uKFwidmFsdWVcIixjKTtyZXR1cm4gdGhpc30sX3NldE9wdGlvbjpmdW5jdGlvbihjLGUpe2lmKGM9PT1cInZhbHVlXCIpe3RoaXMub3B0aW9ucy52YWx1ZT1lO3RoaXMuX3JlZnJlc2hWYWx1ZSgpO3RoaXMuX3ZhbHVlKCk9PT10aGlzLm9wdGlvbnMubWF4JiZ0aGlzLl90cmlnZ2VyKFwiY29tcGxldGVcIil9YS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxfdmFsdWU6ZnVuY3Rpb24oKXt2YXIgYz10aGlzLm9wdGlvbnMudmFsdWU7aWYodHlwZW9mIGMhPT1cIm51bWJlclwiKWM9MDtyZXR1cm4gTWF0aC5taW4odGhpcy5vcHRpb25zLm1heCxNYXRoLm1heCh0aGlzLm1pbixjKSl9LF9wZXJjZW50YWdlOmZ1bmN0aW9uKCl7cmV0dXJuIDEwMCpcbnRoaXMuX3ZhbHVlKCkvdGhpcy5vcHRpb25zLm1heH0sX3JlZnJlc2hWYWx1ZTpmdW5jdGlvbigpe3ZhciBjPXRoaXMudmFsdWUoKSxlPXRoaXMuX3BlcmNlbnRhZ2UoKTtpZih0aGlzLm9sZFZhbHVlIT09Yyl7dGhpcy5vbGRWYWx1ZT1jO3RoaXMuX3RyaWdnZXIoXCJjaGFuZ2VcIil9dGhpcy52YWx1ZURpdi50b2dnbGUoYz50aGlzLm1pbikudG9nZ2xlQ2xhc3MoXCJ1aS1jb3JuZXItcmlnaHRcIixjPT09dGhpcy5vcHRpb25zLm1heCkud2lkdGgoZS50b0ZpeGVkKDApK1wiJVwiKTt0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtdmFsdWVub3dcIixjKX19KTthLmV4dGVuZChhLnVpLnByb2dyZXNzYmFyLHt2ZXJzaW9uOlwiMS44LjE2XCJ9KX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS53aWRnZXQoXCJ1aS5zbGlkZXJcIixhLnVpLm1vdXNlLHt3aWRnZXRFdmVudFByZWZpeDpcInNsaWRlXCIsb3B0aW9uczp7YW5pbWF0ZTpmYWxzZSxkaXN0YW5jZTowLG1heDoxMDAsbWluOjAsb3JpZW50YXRpb246XCJob3Jpem9udGFsXCIscmFuZ2U6ZmFsc2Usc3RlcDoxLHZhbHVlOjAsdmFsdWVzOm51bGx9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgZD10aGlzLGM9dGhpcy5vcHRpb25zLGU9dGhpcy5lbGVtZW50LmZpbmQoXCIudWktc2xpZGVyLWhhbmRsZVwiKS5hZGRDbGFzcyhcInVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbFwiKSxoPWMudmFsdWVzJiZjLnZhbHVlcy5sZW5ndGh8fDEsZz1bXTt0aGlzLl9tb3VzZVNsaWRpbmc9dGhpcy5fa2V5U2xpZGluZz1mYWxzZTt0aGlzLl9hbmltYXRlT2ZmPXRydWU7dGhpcy5faGFuZGxlSW5kZXg9bnVsbDt0aGlzLl9kZXRlY3RPcmllbnRhdGlvbigpO3RoaXMuX21vdXNlSW5pdCgpO3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLXNsaWRlciB1aS1zbGlkZXItXCIrXG50aGlzLm9yaWVudGF0aW9uK1wiIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsXCIrKGMuZGlzYWJsZWQ/XCIgdWktc2xpZGVyLWRpc2FibGVkIHVpLWRpc2FibGVkXCI6XCJcIikpO3RoaXMucmFuZ2U9YShbXSk7aWYoYy5yYW5nZSl7aWYoYy5yYW5nZT09PXRydWUpe2lmKCFjLnZhbHVlcyljLnZhbHVlcz1bdGhpcy5fdmFsdWVNaW4oKSx0aGlzLl92YWx1ZU1pbigpXTtpZihjLnZhbHVlcy5sZW5ndGgmJmMudmFsdWVzLmxlbmd0aCE9PTIpYy52YWx1ZXM9W2MudmFsdWVzWzBdLGMudmFsdWVzWzBdXX10aGlzLnJhbmdlPWEoXCI8ZGl2PjwvZGl2PlwiKS5hcHBlbmRUbyh0aGlzLmVsZW1lbnQpLmFkZENsYXNzKFwidWktc2xpZGVyLXJhbmdlIHVpLXdpZGdldC1oZWFkZXJcIisoYy5yYW5nZT09PVwibWluXCJ8fGMucmFuZ2U9PT1cIm1heFwiP1wiIHVpLXNsaWRlci1yYW5nZS1cIitjLnJhbmdlOlwiXCIpKX1mb3IodmFyIGk9ZS5sZW5ndGg7aTxoO2krPTEpZy5wdXNoKFwiPGEgY2xhc3M9J3VpLXNsaWRlci1oYW5kbGUgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsJyBocmVmPScjJz48L2E+XCIpO1xudGhpcy5oYW5kbGVzPWUuYWRkKGEoZy5qb2luKFwiXCIpKS5hcHBlbmRUbyhkLmVsZW1lbnQpKTt0aGlzLmhhbmRsZT10aGlzLmhhbmRsZXMuZXEoMCk7dGhpcy5oYW5kbGVzLmFkZCh0aGlzLnJhbmdlKS5maWx0ZXIoXCJhXCIpLmNsaWNrKGZ1bmN0aW9uKGIpe2IucHJldmVudERlZmF1bHQoKX0pLmhvdmVyKGZ1bmN0aW9uKCl7Yy5kaXNhYmxlZHx8YSh0aGlzKS5hZGRDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpfSxmdW5jdGlvbigpe2EodGhpcykucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX0pLmZvY3VzKGZ1bmN0aW9uKCl7aWYoYy5kaXNhYmxlZClhKHRoaXMpLmJsdXIoKTtlbHNle2EoXCIudWktc2xpZGVyIC51aS1zdGF0ZS1mb2N1c1wiKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWZvY3VzXCIpO2EodGhpcykuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX19KS5ibHVyKGZ1bmN0aW9uKCl7YSh0aGlzKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWZvY3VzXCIpfSk7dGhpcy5oYW5kbGVzLmVhY2goZnVuY3Rpb24oYil7YSh0aGlzKS5kYXRhKFwiaW5kZXgudWktc2xpZGVyLWhhbmRsZVwiLFxuYil9KTt0aGlzLmhhbmRsZXMua2V5ZG93bihmdW5jdGlvbihiKXt2YXIgZj10cnVlLGo9YSh0aGlzKS5kYXRhKFwiaW5kZXgudWktc2xpZGVyLWhhbmRsZVwiKSxsLG8sbjtpZighZC5vcHRpb25zLmRpc2FibGVkKXtzd2l0Y2goYi5rZXlDb2RlKXtjYXNlIGEudWkua2V5Q29kZS5IT01FOmNhc2UgYS51aS5rZXlDb2RlLkVORDpjYXNlIGEudWkua2V5Q29kZS5QQUdFX1VQOmNhc2UgYS51aS5rZXlDb2RlLlBBR0VfRE9XTjpjYXNlIGEudWkua2V5Q29kZS5VUDpjYXNlIGEudWkua2V5Q29kZS5SSUdIVDpjYXNlIGEudWkua2V5Q29kZS5ET1dOOmNhc2UgYS51aS5rZXlDb2RlLkxFRlQ6Zj1mYWxzZTtpZighZC5fa2V5U2xpZGluZyl7ZC5fa2V5U2xpZGluZz10cnVlO2EodGhpcykuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIik7bD1kLl9zdGFydChiLGopO2lmKGw9PT1mYWxzZSlyZXR1cm59YnJlYWt9bj1kLm9wdGlvbnMuc3RlcDtsPWQub3B0aW9ucy52YWx1ZXMmJmQub3B0aW9ucy52YWx1ZXMubGVuZ3RoP1xuKG89ZC52YWx1ZXMoaikpOihvPWQudmFsdWUoKSk7c3dpdGNoKGIua2V5Q29kZSl7Y2FzZSBhLnVpLmtleUNvZGUuSE9NRTpvPWQuX3ZhbHVlTWluKCk7YnJlYWs7Y2FzZSBhLnVpLmtleUNvZGUuRU5EOm89ZC5fdmFsdWVNYXgoKTticmVhaztjYXNlIGEudWkua2V5Q29kZS5QQUdFX1VQOm89ZC5fdHJpbUFsaWduVmFsdWUobCsoZC5fdmFsdWVNYXgoKS1kLl92YWx1ZU1pbigpKS81KTticmVhaztjYXNlIGEudWkua2V5Q29kZS5QQUdFX0RPV046bz1kLl90cmltQWxpZ25WYWx1ZShsLShkLl92YWx1ZU1heCgpLWQuX3ZhbHVlTWluKCkpLzUpO2JyZWFrO2Nhc2UgYS51aS5rZXlDb2RlLlVQOmNhc2UgYS51aS5rZXlDb2RlLlJJR0hUOmlmKGw9PT1kLl92YWx1ZU1heCgpKXJldHVybjtvPWQuX3RyaW1BbGlnblZhbHVlKGwrbik7YnJlYWs7Y2FzZSBhLnVpLmtleUNvZGUuRE9XTjpjYXNlIGEudWkua2V5Q29kZS5MRUZUOmlmKGw9PT1kLl92YWx1ZU1pbigpKXJldHVybjtvPWQuX3RyaW1BbGlnblZhbHVlKGwtXG5uKTticmVha31kLl9zbGlkZShiLGosbyk7cmV0dXJuIGZ9fSkua2V5dXAoZnVuY3Rpb24oYil7dmFyIGY9YSh0aGlzKS5kYXRhKFwiaW5kZXgudWktc2xpZGVyLWhhbmRsZVwiKTtpZihkLl9rZXlTbGlkaW5nKXtkLl9rZXlTbGlkaW5nPWZhbHNlO2QuX3N0b3AoYixmKTtkLl9jaGFuZ2UoYixmKTthKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpfX0pO3RoaXMuX3JlZnJlc2hWYWx1ZSgpO3RoaXMuX2FuaW1hdGVPZmY9ZmFsc2V9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmhhbmRsZXMucmVtb3ZlKCk7dGhpcy5yYW5nZS5yZW1vdmUoKTt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zbGlkZXIgdWktc2xpZGVyLWhvcml6b250YWwgdWktc2xpZGVyLXZlcnRpY2FsIHVpLXNsaWRlci1kaXNhYmxlZCB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbFwiKS5yZW1vdmVEYXRhKFwic2xpZGVyXCIpLnVuYmluZChcIi5zbGlkZXJcIik7dGhpcy5fbW91c2VEZXN0cm95KCk7XG5yZXR1cm4gdGhpc30sX21vdXNlQ2FwdHVyZTpmdW5jdGlvbihkKXt2YXIgYz10aGlzLm9wdGlvbnMsZSxoLGcsaSxiO2lmKGMuZGlzYWJsZWQpcmV0dXJuIGZhbHNlO3RoaXMuZWxlbWVudFNpemU9e3dpZHRoOnRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCksaGVpZ2h0OnRoaXMuZWxlbWVudC5vdXRlckhlaWdodCgpfTt0aGlzLmVsZW1lbnRPZmZzZXQ9dGhpcy5lbGVtZW50Lm9mZnNldCgpO2U9dGhpcy5fbm9ybVZhbHVlRnJvbU1vdXNlKHt4OmQucGFnZVgseTpkLnBhZ2VZfSk7aD10aGlzLl92YWx1ZU1heCgpLXRoaXMuX3ZhbHVlTWluKCkrMTtpPXRoaXM7dGhpcy5oYW5kbGVzLmVhY2goZnVuY3Rpb24oZil7dmFyIGo9TWF0aC5hYnMoZS1pLnZhbHVlcyhmKSk7aWYoaD5qKXtoPWo7Zz1hKHRoaXMpO2I9Zn19KTtpZihjLnJhbmdlPT09dHJ1ZSYmdGhpcy52YWx1ZXMoMSk9PT1jLm1pbil7Yis9MTtnPWEodGhpcy5oYW5kbGVzW2JdKX1pZih0aGlzLl9zdGFydChkLGIpPT09ZmFsc2UpcmV0dXJuIGZhbHNlO1xudGhpcy5fbW91c2VTbGlkaW5nPXRydWU7aS5faGFuZGxlSW5kZXg9YjtnLmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpLmZvY3VzKCk7Yz1nLm9mZnNldCgpO3RoaXMuX2NsaWNrT2Zmc2V0PSFhKGQudGFyZ2V0KS5wYXJlbnRzKCkuYW5kU2VsZigpLmlzKFwiLnVpLXNsaWRlci1oYW5kbGVcIik/e2xlZnQ6MCx0b3A6MH06e2xlZnQ6ZC5wYWdlWC1jLmxlZnQtZy53aWR0aCgpLzIsdG9wOmQucGFnZVktYy50b3AtZy5oZWlnaHQoKS8yLShwYXJzZUludChnLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLDEwKXx8MCktKHBhcnNlSW50KGcuY3NzKFwiYm9yZGVyQm90dG9tV2lkdGhcIiksMTApfHwwKSsocGFyc2VJbnQoZy5jc3MoXCJtYXJnaW5Ub3BcIiksMTApfHwwKX07dGhpcy5oYW5kbGVzLmhhc0NsYXNzKFwidWktc3RhdGUtaG92ZXJcIil8fHRoaXMuX3NsaWRlKGQsYixlKTtyZXR1cm4gdGhpcy5fYW5pbWF0ZU9mZj10cnVlfSxfbW91c2VTdGFydDpmdW5jdGlvbigpe3JldHVybiB0cnVlfSxfbW91c2VEcmFnOmZ1bmN0aW9uKGQpe3ZhciBjPVxudGhpcy5fbm9ybVZhbHVlRnJvbU1vdXNlKHt4OmQucGFnZVgseTpkLnBhZ2VZfSk7dGhpcy5fc2xpZGUoZCx0aGlzLl9oYW5kbGVJbmRleCxjKTtyZXR1cm4gZmFsc2V9LF9tb3VzZVN0b3A6ZnVuY3Rpb24oZCl7dGhpcy5oYW5kbGVzLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpO3RoaXMuX21vdXNlU2xpZGluZz1mYWxzZTt0aGlzLl9zdG9wKGQsdGhpcy5faGFuZGxlSW5kZXgpO3RoaXMuX2NoYW5nZShkLHRoaXMuX2hhbmRsZUluZGV4KTt0aGlzLl9jbGlja09mZnNldD10aGlzLl9oYW5kbGVJbmRleD1udWxsO3JldHVybiB0aGlzLl9hbmltYXRlT2ZmPWZhbHNlfSxfZGV0ZWN0T3JpZW50YXRpb246ZnVuY3Rpb24oKXt0aGlzLm9yaWVudGF0aW9uPXRoaXMub3B0aW9ucy5vcmllbnRhdGlvbj09PVwidmVydGljYWxcIj9cInZlcnRpY2FsXCI6XCJob3Jpem9udGFsXCJ9LF9ub3JtVmFsdWVGcm9tTW91c2U6ZnVuY3Rpb24oZCl7dmFyIGM7aWYodGhpcy5vcmllbnRhdGlvbj09PVwiaG9yaXpvbnRhbFwiKXtjPVxudGhpcy5lbGVtZW50U2l6ZS53aWR0aDtkPWQueC10aGlzLmVsZW1lbnRPZmZzZXQubGVmdC0odGhpcy5fY2xpY2tPZmZzZXQ/dGhpcy5fY2xpY2tPZmZzZXQubGVmdDowKX1lbHNle2M9dGhpcy5lbGVtZW50U2l6ZS5oZWlnaHQ7ZD1kLnktdGhpcy5lbGVtZW50T2Zmc2V0LnRvcC0odGhpcy5fY2xpY2tPZmZzZXQ/dGhpcy5fY2xpY2tPZmZzZXQudG9wOjApfWM9ZC9jO2lmKGM+MSljPTE7aWYoYzwwKWM9MDtpZih0aGlzLm9yaWVudGF0aW9uPT09XCJ2ZXJ0aWNhbFwiKWM9MS1jO2Q9dGhpcy5fdmFsdWVNYXgoKS10aGlzLl92YWx1ZU1pbigpO3JldHVybiB0aGlzLl90cmltQWxpZ25WYWx1ZSh0aGlzLl92YWx1ZU1pbigpK2MqZCl9LF9zdGFydDpmdW5jdGlvbihkLGMpe3ZhciBlPXtoYW5kbGU6dGhpcy5oYW5kbGVzW2NdLHZhbHVlOnRoaXMudmFsdWUoKX07aWYodGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGgpe2UudmFsdWU9dGhpcy52YWx1ZXMoYyk7XG5lLnZhbHVlcz10aGlzLnZhbHVlcygpfXJldHVybiB0aGlzLl90cmlnZ2VyKFwic3RhcnRcIixkLGUpfSxfc2xpZGU6ZnVuY3Rpb24oZCxjLGUpe3ZhciBoO2lmKHRoaXMub3B0aW9ucy52YWx1ZXMmJnRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoKXtoPXRoaXMudmFsdWVzKGM/MDoxKTtpZih0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aD09PTImJnRoaXMub3B0aW9ucy5yYW5nZT09PXRydWUmJihjPT09MCYmZT5ofHxjPT09MSYmZTxoKSllPWg7aWYoZSE9PXRoaXMudmFsdWVzKGMpKXtoPXRoaXMudmFsdWVzKCk7aFtjXT1lO2Q9dGhpcy5fdHJpZ2dlcihcInNsaWRlXCIsZCx7aGFuZGxlOnRoaXMuaGFuZGxlc1tjXSx2YWx1ZTplLHZhbHVlczpofSk7dGhpcy52YWx1ZXMoYz8wOjEpO2QhPT1mYWxzZSYmdGhpcy52YWx1ZXMoYyxlLHRydWUpfX1lbHNlIGlmKGUhPT10aGlzLnZhbHVlKCkpe2Q9dGhpcy5fdHJpZ2dlcihcInNsaWRlXCIsZCx7aGFuZGxlOnRoaXMuaGFuZGxlc1tjXSx2YWx1ZTplfSk7XG5kIT09ZmFsc2UmJnRoaXMudmFsdWUoZSl9fSxfc3RvcDpmdW5jdGlvbihkLGMpe3ZhciBlPXtoYW5kbGU6dGhpcy5oYW5kbGVzW2NdLHZhbHVlOnRoaXMudmFsdWUoKX07aWYodGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGgpe2UudmFsdWU9dGhpcy52YWx1ZXMoYyk7ZS52YWx1ZXM9dGhpcy52YWx1ZXMoKX10aGlzLl90cmlnZ2VyKFwic3RvcFwiLGQsZSl9LF9jaGFuZ2U6ZnVuY3Rpb24oZCxjKXtpZighdGhpcy5fa2V5U2xpZGluZyYmIXRoaXMuX21vdXNlU2xpZGluZyl7dmFyIGU9e2hhbmRsZTp0aGlzLmhhbmRsZXNbY10sdmFsdWU6dGhpcy52YWx1ZSgpfTtpZih0aGlzLm9wdGlvbnMudmFsdWVzJiZ0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCl7ZS52YWx1ZT10aGlzLnZhbHVlcyhjKTtlLnZhbHVlcz10aGlzLnZhbHVlcygpfXRoaXMuX3RyaWdnZXIoXCJjaGFuZ2VcIixkLGUpfX0sdmFsdWU6ZnVuY3Rpb24oZCl7aWYoYXJndW1lbnRzLmxlbmd0aCl7dGhpcy5vcHRpb25zLnZhbHVlPVxudGhpcy5fdHJpbUFsaWduVmFsdWUoZCk7dGhpcy5fcmVmcmVzaFZhbHVlKCk7dGhpcy5fY2hhbmdlKG51bGwsMCl9ZWxzZSByZXR1cm4gdGhpcy5fdmFsdWUoKX0sdmFsdWVzOmZ1bmN0aW9uKGQsYyl7dmFyIGUsaCxnO2lmKGFyZ3VtZW50cy5sZW5ndGg+MSl7dGhpcy5vcHRpb25zLnZhbHVlc1tkXT10aGlzLl90cmltQWxpZ25WYWx1ZShjKTt0aGlzLl9yZWZyZXNoVmFsdWUoKTt0aGlzLl9jaGFuZ2UobnVsbCxkKX1lbHNlIGlmKGFyZ3VtZW50cy5sZW5ndGgpaWYoYS5pc0FycmF5KGFyZ3VtZW50c1swXSkpe2U9dGhpcy5vcHRpb25zLnZhbHVlcztoPWFyZ3VtZW50c1swXTtmb3IoZz0wO2c8ZS5sZW5ndGg7Zys9MSl7ZVtnXT10aGlzLl90cmltQWxpZ25WYWx1ZShoW2ddKTt0aGlzLl9jaGFuZ2UobnVsbCxnKX10aGlzLl9yZWZyZXNoVmFsdWUoKX1lbHNlIHJldHVybiB0aGlzLm9wdGlvbnMudmFsdWVzJiZ0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aD90aGlzLl92YWx1ZXMoZCk6XG50aGlzLnZhbHVlKCk7ZWxzZSByZXR1cm4gdGhpcy5fdmFsdWVzKCl9LF9zZXRPcHRpb246ZnVuY3Rpb24oZCxjKXt2YXIgZSxoPTA7aWYoYS5pc0FycmF5KHRoaXMub3B0aW9ucy52YWx1ZXMpKWg9dGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGg7YS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpO3N3aXRjaChkKXtjYXNlIFwiZGlzYWJsZWRcIjppZihjKXt0aGlzLmhhbmRsZXMuZmlsdGVyKFwiLnVpLXN0YXRlLWZvY3VzXCIpLmJsdXIoKTt0aGlzLmhhbmRsZXMucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKTt0aGlzLmhhbmRsZXMucHJvcEF0dHIoXCJkaXNhYmxlZFwiLHRydWUpO3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWRpc2FibGVkXCIpfWVsc2V7dGhpcy5oYW5kbGVzLnByb3BBdHRyKFwiZGlzYWJsZWRcIixmYWxzZSk7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktZGlzYWJsZWRcIil9YnJlYWs7Y2FzZSBcIm9yaWVudGF0aW9uXCI6dGhpcy5fZGV0ZWN0T3JpZW50YXRpb24oKTtcbnRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXNsaWRlci1ob3Jpem9udGFsIHVpLXNsaWRlci12ZXJ0aWNhbFwiKS5hZGRDbGFzcyhcInVpLXNsaWRlci1cIit0aGlzLm9yaWVudGF0aW9uKTt0aGlzLl9yZWZyZXNoVmFsdWUoKTticmVhaztjYXNlIFwidmFsdWVcIjp0aGlzLl9hbmltYXRlT2ZmPXRydWU7dGhpcy5fcmVmcmVzaFZhbHVlKCk7dGhpcy5fY2hhbmdlKG51bGwsMCk7dGhpcy5fYW5pbWF0ZU9mZj1mYWxzZTticmVhaztjYXNlIFwidmFsdWVzXCI6dGhpcy5fYW5pbWF0ZU9mZj10cnVlO3RoaXMuX3JlZnJlc2hWYWx1ZSgpO2ZvcihlPTA7ZTxoO2UrPTEpdGhpcy5fY2hhbmdlKG51bGwsZSk7dGhpcy5fYW5pbWF0ZU9mZj1mYWxzZTticmVha319LF92YWx1ZTpmdW5jdGlvbigpe3ZhciBkPXRoaXMub3B0aW9ucy52YWx1ZTtyZXR1cm4gZD10aGlzLl90cmltQWxpZ25WYWx1ZShkKX0sX3ZhbHVlczpmdW5jdGlvbihkKXt2YXIgYyxlO2lmKGFyZ3VtZW50cy5sZW5ndGgpe2M9dGhpcy5vcHRpb25zLnZhbHVlc1tkXTtcbnJldHVybiBjPXRoaXMuX3RyaW1BbGlnblZhbHVlKGMpfWVsc2V7Yz10aGlzLm9wdGlvbnMudmFsdWVzLnNsaWNlKCk7Zm9yKGU9MDtlPGMubGVuZ3RoO2UrPTEpY1tlXT10aGlzLl90cmltQWxpZ25WYWx1ZShjW2VdKTtyZXR1cm4gY319LF90cmltQWxpZ25WYWx1ZTpmdW5jdGlvbihkKXtpZihkPD10aGlzLl92YWx1ZU1pbigpKXJldHVybiB0aGlzLl92YWx1ZU1pbigpO2lmKGQ+PXRoaXMuX3ZhbHVlTWF4KCkpcmV0dXJuIHRoaXMuX3ZhbHVlTWF4KCk7dmFyIGM9dGhpcy5vcHRpb25zLnN0ZXA+MD90aGlzLm9wdGlvbnMuc3RlcDoxLGU9KGQtdGhpcy5fdmFsdWVNaW4oKSklYztkPWQtZTtpZihNYXRoLmFicyhlKSoyPj1jKWQrPWU+MD9jOi1jO3JldHVybiBwYXJzZUZsb2F0KGQudG9GaXhlZCg1KSl9LF92YWx1ZU1pbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMubWlufSxfdmFsdWVNYXg6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLm1heH0sX3JlZnJlc2hWYWx1ZTpmdW5jdGlvbigpe3ZhciBkPVxudGhpcy5vcHRpb25zLnJhbmdlLGM9dGhpcy5vcHRpb25zLGU9dGhpcyxoPSF0aGlzLl9hbmltYXRlT2ZmP2MuYW5pbWF0ZTpmYWxzZSxnLGk9e30sYixmLGosbDtpZih0aGlzLm9wdGlvbnMudmFsdWVzJiZ0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCl0aGlzLmhhbmRsZXMuZWFjaChmdW5jdGlvbihvKXtnPShlLnZhbHVlcyhvKS1lLl92YWx1ZU1pbigpKS8oZS5fdmFsdWVNYXgoKS1lLl92YWx1ZU1pbigpKSoxMDA7aVtlLm9yaWVudGF0aW9uPT09XCJob3Jpem9udGFsXCI/XCJsZWZ0XCI6XCJib3R0b21cIl09ZytcIiVcIjthKHRoaXMpLnN0b3AoMSwxKVtoP1wiYW5pbWF0ZVwiOlwiY3NzXCJdKGksYy5hbmltYXRlKTtpZihlLm9wdGlvbnMucmFuZ2U9PT10cnVlKWlmKGUub3JpZW50YXRpb249PT1cImhvcml6b250YWxcIil7aWYobz09PTApZS5yYW5nZS5zdG9wKDEsMSlbaD9cImFuaW1hdGVcIjpcImNzc1wiXSh7bGVmdDpnK1wiJVwifSxjLmFuaW1hdGUpO2lmKG89PT0xKWUucmFuZ2VbaD9cImFuaW1hdGVcIjpcImNzc1wiXSh7d2lkdGg6Zy1cbmIrXCIlXCJ9LHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpjLmFuaW1hdGV9KX1lbHNle2lmKG89PT0wKWUucmFuZ2Uuc3RvcCgxLDEpW2g/XCJhbmltYXRlXCI6XCJjc3NcIl0oe2JvdHRvbTpnK1wiJVwifSxjLmFuaW1hdGUpO2lmKG89PT0xKWUucmFuZ2VbaD9cImFuaW1hdGVcIjpcImNzc1wiXSh7aGVpZ2h0OmctYitcIiVcIn0se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmMuYW5pbWF0ZX0pfWI9Z30pO2Vsc2V7Zj10aGlzLnZhbHVlKCk7aj10aGlzLl92YWx1ZU1pbigpO2w9dGhpcy5fdmFsdWVNYXgoKTtnPWwhPT1qPyhmLWopLyhsLWopKjEwMDowO2lbZS5vcmllbnRhdGlvbj09PVwiaG9yaXpvbnRhbFwiP1wibGVmdFwiOlwiYm90dG9tXCJdPWcrXCIlXCI7dGhpcy5oYW5kbGUuc3RvcCgxLDEpW2g/XCJhbmltYXRlXCI6XCJjc3NcIl0oaSxjLmFuaW1hdGUpO2lmKGQ9PT1cIm1pblwiJiZ0aGlzLm9yaWVudGF0aW9uPT09XCJob3Jpem9udGFsXCIpdGhpcy5yYW5nZS5zdG9wKDEsMSlbaD9cImFuaW1hdGVcIjpcImNzc1wiXSh7d2lkdGg6ZytcIiVcIn0sXG5jLmFuaW1hdGUpO2lmKGQ9PT1cIm1heFwiJiZ0aGlzLm9yaWVudGF0aW9uPT09XCJob3Jpem9udGFsXCIpdGhpcy5yYW5nZVtoP1wiYW5pbWF0ZVwiOlwiY3NzXCJdKHt3aWR0aDoxMDAtZytcIiVcIn0se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmMuYW5pbWF0ZX0pO2lmKGQ9PT1cIm1pblwiJiZ0aGlzLm9yaWVudGF0aW9uPT09XCJ2ZXJ0aWNhbFwiKXRoaXMucmFuZ2Uuc3RvcCgxLDEpW2g/XCJhbmltYXRlXCI6XCJjc3NcIl0oe2hlaWdodDpnK1wiJVwifSxjLmFuaW1hdGUpO2lmKGQ9PT1cIm1heFwiJiZ0aGlzLm9yaWVudGF0aW9uPT09XCJ2ZXJ0aWNhbFwiKXRoaXMucmFuZ2VbaD9cImFuaW1hdGVcIjpcImNzc1wiXSh7aGVpZ2h0OjEwMC1nK1wiJVwifSx7cXVldWU6ZmFsc2UsZHVyYXRpb246Yy5hbmltYXRlfSl9fX0pO2EuZXh0ZW5kKGEudWkuc2xpZGVyLHt2ZXJzaW9uOlwiMS44LjE2XCJ9KX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSxkKXtmdW5jdGlvbiBjKCl7cmV0dXJuKytofWZ1bmN0aW9uIGUoKXtyZXR1cm4rK2d9dmFyIGg9MCxnPTA7YS53aWRnZXQoXCJ1aS50YWJzXCIse29wdGlvbnM6e2FkZDpudWxsLGFqYXhPcHRpb25zOm51bGwsY2FjaGU6ZmFsc2UsY29va2llOm51bGwsY29sbGFwc2libGU6ZmFsc2UsZGlzYWJsZTpudWxsLGRpc2FibGVkOltdLGVuYWJsZTpudWxsLGV2ZW50OlwiY2xpY2tcIixmeDpudWxsLGlkUHJlZml4OlwidWktdGFicy1cIixsb2FkOm51bGwscGFuZWxUZW1wbGF0ZTpcIjxkaXY+PC9kaXY+XCIscmVtb3ZlOm51bGwsc2VsZWN0Om51bGwsc2hvdzpudWxsLHNwaW5uZXI6XCI8ZW0+TG9hZGluZyYjODIzMDs8L2VtPlwiLHRhYlRlbXBsYXRlOlwiPGxpPjxhIGhyZWY9JyN7aHJlZn0nPjxzcGFuPiN7bGFiZWx9PC9zcGFuPjwvYT48L2xpPlwifSxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5fdGFiaWZ5KHRydWUpfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGksYil7aWYoaT09XCJzZWxlY3RlZFwiKXRoaXMub3B0aW9ucy5jb2xsYXBzaWJsZSYmXG5iPT10aGlzLm9wdGlvbnMuc2VsZWN0ZWR8fHRoaXMuc2VsZWN0KGIpO2Vsc2V7dGhpcy5vcHRpb25zW2ldPWI7dGhpcy5fdGFiaWZ5KCl9fSxfdGFiSWQ6ZnVuY3Rpb24oaSl7cmV0dXJuIGkudGl0bGUmJmkudGl0bGUucmVwbGFjZSgvXFxzL2csXCJfXCIpLnJlcGxhY2UoL1teXFx3XFx1MDBjMC1cXHVGRkZGLV0vZyxcIlwiKXx8dGhpcy5vcHRpb25zLmlkUHJlZml4K2MoKX0sX3Nhbml0aXplU2VsZWN0b3I6ZnVuY3Rpb24oaSl7cmV0dXJuIGkucmVwbGFjZSgvOi9nLFwiXFxcXDpcIil9LF9jb29raWU6ZnVuY3Rpb24oKXt2YXIgaT10aGlzLmNvb2tpZXx8KHRoaXMuY29va2llPXRoaXMub3B0aW9ucy5jb29raWUubmFtZXx8XCJ1aS10YWJzLVwiK2UoKSk7cmV0dXJuIGEuY29va2llLmFwcGx5KG51bGwsW2ldLmNvbmNhdChhLm1ha2VBcnJheShhcmd1bWVudHMpKSl9LF91aTpmdW5jdGlvbihpLGIpe3JldHVybnt0YWI6aSxwYW5lbDpiLGluZGV4OnRoaXMuYW5jaG9ycy5pbmRleChpKX19LF9jbGVhbnVwOmZ1bmN0aW9uKCl7dGhpcy5saXMuZmlsdGVyKFwiLnVpLXN0YXRlLXByb2Nlc3NpbmdcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1wcm9jZXNzaW5nXCIpLmZpbmQoXCJzcGFuOmRhdGEobGFiZWwudGFicylcIikuZWFjaChmdW5jdGlvbigpe3ZhciBpPVxuYSh0aGlzKTtpLmh0bWwoaS5kYXRhKFwibGFiZWwudGFic1wiKSkucmVtb3ZlRGF0YShcImxhYmVsLnRhYnNcIil9KX0sX3RhYmlmeTpmdW5jdGlvbihpKXtmdW5jdGlvbiBiKHIsdSl7ci5jc3MoXCJkaXNwbGF5XCIsXCJcIik7IWEuc3VwcG9ydC5vcGFjaXR5JiZ1Lm9wYWNpdHkmJnJbMF0uc3R5bGUucmVtb3ZlQXR0cmlidXRlKFwiZmlsdGVyXCIpfXZhciBmPXRoaXMsaj10aGlzLm9wdGlvbnMsbD0vXiMuKy87dGhpcy5saXN0PXRoaXMuZWxlbWVudC5maW5kKFwib2wsdWxcIikuZXEoMCk7dGhpcy5saXM9YShcIiA+IGxpOmhhcyhhW2hyZWZdKVwiLHRoaXMubGlzdCk7dGhpcy5hbmNob3JzPXRoaXMubGlzLm1hcChmdW5jdGlvbigpe3JldHVybiBhKFwiYVwiLHRoaXMpWzBdfSk7dGhpcy5wYW5lbHM9YShbXSk7dGhpcy5hbmNob3JzLmVhY2goZnVuY3Rpb24ocix1KXt2YXIgdj1hKHUpLmF0dHIoXCJocmVmXCIpLHc9di5zcGxpdChcIiNcIilbMF0seDtpZih3JiYodz09PWxvY2F0aW9uLnRvU3RyaW5nKCkuc3BsaXQoXCIjXCIpWzBdfHxcbih4PWEoXCJiYXNlXCIpWzBdKSYmdz09PXguaHJlZikpe3Y9dS5oYXNoO3UuaHJlZj12fWlmKGwudGVzdCh2KSlmLnBhbmVscz1mLnBhbmVscy5hZGQoZi5lbGVtZW50LmZpbmQoZi5fc2FuaXRpemVTZWxlY3Rvcih2KSkpO2Vsc2UgaWYodiYmdiE9PVwiI1wiKXthLmRhdGEodSxcImhyZWYudGFic1wiLHYpO2EuZGF0YSh1LFwibG9hZC50YWJzXCIsdi5yZXBsYWNlKC8jLiokLyxcIlwiKSk7dj1mLl90YWJJZCh1KTt1LmhyZWY9XCIjXCIrdjt1PWYuZWxlbWVudC5maW5kKFwiI1wiK3YpO2lmKCF1Lmxlbmd0aCl7dT1hKGoucGFuZWxUZW1wbGF0ZSkuYXR0cihcImlkXCIsdikuYWRkQ2xhc3MoXCJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b21cIikuaW5zZXJ0QWZ0ZXIoZi5wYW5lbHNbci0xXXx8Zi5saXN0KTt1LmRhdGEoXCJkZXN0cm95LnRhYnNcIix0cnVlKX1mLnBhbmVscz1mLnBhbmVscy5hZGQodSl9ZWxzZSBqLmRpc2FibGVkLnB1c2gocil9KTtpZihpKXt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS10YWJzIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsXCIpO1xudGhpcy5saXN0LmFkZENsYXNzKFwidWktdGFicy1uYXYgdWktaGVscGVyLXJlc2V0IHVpLWhlbHBlci1jbGVhcmZpeCB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1hbGxcIik7dGhpcy5saXMuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci10b3BcIik7dGhpcy5wYW5lbHMuYWRkQ2xhc3MoXCJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b21cIik7aWYoai5zZWxlY3RlZD09PWQpe2xvY2F0aW9uLmhhc2gmJnRoaXMuYW5jaG9ycy5lYWNoKGZ1bmN0aW9uKHIsdSl7aWYodS5oYXNoPT1sb2NhdGlvbi5oYXNoKXtqLnNlbGVjdGVkPXI7cmV0dXJuIGZhbHNlfX0pO2lmKHR5cGVvZiBqLnNlbGVjdGVkIT09XCJudW1iZXJcIiYmai5jb29raWUpai5zZWxlY3RlZD1wYXJzZUludChmLl9jb29raWUoKSwxMCk7aWYodHlwZW9mIGouc2VsZWN0ZWQhPT1cIm51bWJlclwiJiZ0aGlzLmxpcy5maWx0ZXIoXCIudWktdGFicy1zZWxlY3RlZFwiKS5sZW5ndGgpai5zZWxlY3RlZD1cbnRoaXMubGlzLmluZGV4KHRoaXMubGlzLmZpbHRlcihcIi51aS10YWJzLXNlbGVjdGVkXCIpKTtqLnNlbGVjdGVkPWouc2VsZWN0ZWR8fCh0aGlzLmxpcy5sZW5ndGg/MDotMSl9ZWxzZSBpZihqLnNlbGVjdGVkPT09bnVsbClqLnNlbGVjdGVkPS0xO2ouc2VsZWN0ZWQ9ai5zZWxlY3RlZD49MCYmdGhpcy5hbmNob3JzW2ouc2VsZWN0ZWRdfHxqLnNlbGVjdGVkPDA/ai5zZWxlY3RlZDowO2ouZGlzYWJsZWQ9YS51bmlxdWUoai5kaXNhYmxlZC5jb25jYXQoYS5tYXAodGhpcy5saXMuZmlsdGVyKFwiLnVpLXN0YXRlLWRpc2FibGVkXCIpLGZ1bmN0aW9uKHIpe3JldHVybiBmLmxpcy5pbmRleChyKX0pKSkuc29ydCgpO2EuaW5BcnJheShqLnNlbGVjdGVkLGouZGlzYWJsZWQpIT0tMSYmai5kaXNhYmxlZC5zcGxpY2UoYS5pbkFycmF5KGouc2VsZWN0ZWQsai5kaXNhYmxlZCksMSk7dGhpcy5wYW5lbHMuYWRkQ2xhc3MoXCJ1aS10YWJzLWhpZGVcIik7dGhpcy5saXMucmVtb3ZlQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZVwiKTtcbmlmKGouc2VsZWN0ZWQ+PTAmJnRoaXMuYW5jaG9ycy5sZW5ndGgpe2YuZWxlbWVudC5maW5kKGYuX3Nhbml0aXplU2VsZWN0b3IoZi5hbmNob3JzW2ouc2VsZWN0ZWRdLmhhc2gpKS5yZW1vdmVDbGFzcyhcInVpLXRhYnMtaGlkZVwiKTt0aGlzLmxpcy5lcShqLnNlbGVjdGVkKS5hZGRDbGFzcyhcInVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlXCIpO2YuZWxlbWVudC5xdWV1ZShcInRhYnNcIixmdW5jdGlvbigpe2YuX3RyaWdnZXIoXCJzaG93XCIsbnVsbCxmLl91aShmLmFuY2hvcnNbai5zZWxlY3RlZF0sZi5lbGVtZW50LmZpbmQoZi5fc2FuaXRpemVTZWxlY3RvcihmLmFuY2hvcnNbai5zZWxlY3RlZF0uaGFzaCkpWzBdKSl9KTt0aGlzLmxvYWQoai5zZWxlY3RlZCl9YSh3aW5kb3cpLmJpbmQoXCJ1bmxvYWRcIixmdW5jdGlvbigpe2YubGlzLmFkZChmLmFuY2hvcnMpLnVuYmluZChcIi50YWJzXCIpO2YubGlzPWYuYW5jaG9ycz1mLnBhbmVscz1udWxsfSl9ZWxzZSBqLnNlbGVjdGVkPXRoaXMubGlzLmluZGV4KHRoaXMubGlzLmZpbHRlcihcIi51aS10YWJzLXNlbGVjdGVkXCIpKTtcbnRoaXMuZWxlbWVudFtqLmNvbGxhcHNpYmxlP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwidWktdGFicy1jb2xsYXBzaWJsZVwiKTtqLmNvb2tpZSYmdGhpcy5fY29va2llKGouc2VsZWN0ZWQsai5jb29raWUpO2k9MDtmb3IodmFyIG87bz10aGlzLmxpc1tpXTtpKyspYShvKVthLmluQXJyYXkoaSxqLmRpc2FibGVkKSE9LTEmJiFhKG8pLmhhc0NsYXNzKFwidWktdGFicy1zZWxlY3RlZFwiKT9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcInVpLXN0YXRlLWRpc2FibGVkXCIpO2ouY2FjaGU9PT1mYWxzZSYmdGhpcy5hbmNob3JzLnJlbW92ZURhdGEoXCJjYWNoZS50YWJzXCIpO3RoaXMubGlzLmFkZCh0aGlzLmFuY2hvcnMpLnVuYmluZChcIi50YWJzXCIpO2lmKGouZXZlbnQhPT1cIm1vdXNlb3ZlclwiKXt2YXIgbj1mdW5jdGlvbihyLHUpe3UuaXMoXCI6bm90KC51aS1zdGF0ZS1kaXNhYmxlZClcIikmJnUuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1cIityKX0saz1mdW5jdGlvbihyLHUpe3UucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1cIitcbnIpfTt0aGlzLmxpcy5iaW5kKFwibW91c2VvdmVyLnRhYnNcIixmdW5jdGlvbigpe24oXCJob3ZlclwiLGEodGhpcykpfSk7dGhpcy5saXMuYmluZChcIm1vdXNlb3V0LnRhYnNcIixmdW5jdGlvbigpe2soXCJob3ZlclwiLGEodGhpcykpfSk7dGhpcy5hbmNob3JzLmJpbmQoXCJmb2N1cy50YWJzXCIsZnVuY3Rpb24oKXtuKFwiZm9jdXNcIixhKHRoaXMpLmNsb3Nlc3QoXCJsaVwiKSl9KTt0aGlzLmFuY2hvcnMuYmluZChcImJsdXIudGFic1wiLGZ1bmN0aW9uKCl7ayhcImZvY3VzXCIsYSh0aGlzKS5jbG9zZXN0KFwibGlcIikpfSl9dmFyIG0scDtpZihqLmZ4KWlmKGEuaXNBcnJheShqLmZ4KSl7bT1qLmZ4WzBdO3A9ai5meFsxXX1lbHNlIG09cD1qLmZ4O3ZhciBxPXA/ZnVuY3Rpb24ocix1KXthKHIpLmNsb3Nlc3QoXCJsaVwiKS5hZGRDbGFzcyhcInVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlXCIpO3UuaGlkZSgpLnJlbW92ZUNsYXNzKFwidWktdGFicy1oaWRlXCIpLmFuaW1hdGUocCxwLmR1cmF0aW9ufHxcIm5vcm1hbFwiLFxuZnVuY3Rpb24oKXtiKHUscCk7Zi5fdHJpZ2dlcihcInNob3dcIixudWxsLGYuX3VpKHIsdVswXSkpfSl9OmZ1bmN0aW9uKHIsdSl7YShyKS5jbG9zZXN0KFwibGlcIikuYWRkQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZVwiKTt1LnJlbW92ZUNsYXNzKFwidWktdGFicy1oaWRlXCIpO2YuX3RyaWdnZXIoXCJzaG93XCIsbnVsbCxmLl91aShyLHVbMF0pKX0scz1tP2Z1bmN0aW9uKHIsdSl7dS5hbmltYXRlKG0sbS5kdXJhdGlvbnx8XCJub3JtYWxcIixmdW5jdGlvbigpe2YubGlzLnJlbW92ZUNsYXNzKFwidWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmVcIik7dS5hZGRDbGFzcyhcInVpLXRhYnMtaGlkZVwiKTtiKHUsbSk7Zi5lbGVtZW50LmRlcXVldWUoXCJ0YWJzXCIpfSl9OmZ1bmN0aW9uKHIsdSl7Zi5saXMucmVtb3ZlQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZVwiKTt1LmFkZENsYXNzKFwidWktdGFicy1oaWRlXCIpO2YuZWxlbWVudC5kZXF1ZXVlKFwidGFic1wiKX07XG50aGlzLmFuY2hvcnMuYmluZChqLmV2ZW50K1wiLnRhYnNcIixmdW5jdGlvbigpe3ZhciByPXRoaXMsdT1hKHIpLmNsb3Nlc3QoXCJsaVwiKSx2PWYucGFuZWxzLmZpbHRlcihcIjpub3QoLnVpLXRhYnMtaGlkZSlcIiksdz1mLmVsZW1lbnQuZmluZChmLl9zYW5pdGl6ZVNlbGVjdG9yKHIuaGFzaCkpO2lmKHUuaGFzQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkXCIpJiYhai5jb2xsYXBzaWJsZXx8dS5oYXNDbGFzcyhcInVpLXN0YXRlLWRpc2FibGVkXCIpfHx1Lmhhc0NsYXNzKFwidWktc3RhdGUtcHJvY2Vzc2luZ1wiKXx8Zi5wYW5lbHMuZmlsdGVyKFwiOmFuaW1hdGVkXCIpLmxlbmd0aHx8Zi5fdHJpZ2dlcihcInNlbGVjdFwiLG51bGwsZi5fdWkodGhpcyx3WzBdKSk9PT1mYWxzZSl7dGhpcy5ibHVyKCk7cmV0dXJuIGZhbHNlfWouc2VsZWN0ZWQ9Zi5hbmNob3JzLmluZGV4KHRoaXMpO2YuYWJvcnQoKTtpZihqLmNvbGxhcHNpYmxlKWlmKHUuaGFzQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkXCIpKXtqLnNlbGVjdGVkPVxuLTE7ai5jb29raWUmJmYuX2Nvb2tpZShqLnNlbGVjdGVkLGouY29va2llKTtmLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIsZnVuY3Rpb24oKXtzKHIsdil9KS5kZXF1ZXVlKFwidGFic1wiKTt0aGlzLmJsdXIoKTtyZXR1cm4gZmFsc2V9ZWxzZSBpZighdi5sZW5ndGgpe2ouY29va2llJiZmLl9jb29raWUoai5zZWxlY3RlZCxqLmNvb2tpZSk7Zi5lbGVtZW50LnF1ZXVlKFwidGFic1wiLGZ1bmN0aW9uKCl7cShyLHcpfSk7Zi5sb2FkKGYuYW5jaG9ycy5pbmRleCh0aGlzKSk7dGhpcy5ibHVyKCk7cmV0dXJuIGZhbHNlfWouY29va2llJiZmLl9jb29raWUoai5zZWxlY3RlZCxqLmNvb2tpZSk7aWYody5sZW5ndGgpe3YubGVuZ3RoJiZmLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIsZnVuY3Rpb24oKXtzKHIsdil9KTtmLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIsZnVuY3Rpb24oKXtxKHIsdyl9KTtmLmxvYWQoZi5hbmNob3JzLmluZGV4KHRoaXMpKX1lbHNlIHRocm93XCJqUXVlcnkgVUkgVGFiczogTWlzbWF0Y2hpbmcgZnJhZ21lbnQgaWRlbnRpZmllci5cIjtcbmEuYnJvd3Nlci5tc2llJiZ0aGlzLmJsdXIoKX0pO3RoaXMuYW5jaG9ycy5iaW5kKFwiY2xpY2sudGFic1wiLGZ1bmN0aW9uKCl7cmV0dXJuIGZhbHNlfSl9LF9nZXRJbmRleDpmdW5jdGlvbihpKXtpZih0eXBlb2YgaT09XCJzdHJpbmdcIilpPXRoaXMuYW5jaG9ycy5pbmRleCh0aGlzLmFuY2hvcnMuZmlsdGVyKFwiW2hyZWYkPVwiK2krXCJdXCIpKTtyZXR1cm4gaX0sZGVzdHJveTpmdW5jdGlvbigpe3ZhciBpPXRoaXMub3B0aW9uczt0aGlzLmFib3J0KCk7dGhpcy5lbGVtZW50LnVuYmluZChcIi50YWJzXCIpLnJlbW92ZUNsYXNzKFwidWktdGFicyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCB1aS10YWJzLWNvbGxhcHNpYmxlXCIpLnJlbW92ZURhdGEoXCJ0YWJzXCIpO3RoaXMubGlzdC5yZW1vdmVDbGFzcyhcInVpLXRhYnMtbmF2IHVpLWhlbHBlci1yZXNldCB1aS1oZWxwZXItY2xlYXJmaXggdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYWxsXCIpO3RoaXMuYW5jaG9ycy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9XG5hLmRhdGEodGhpcyxcImhyZWYudGFic1wiKTtpZihiKXRoaXMuaHJlZj1iO3ZhciBmPWEodGhpcykudW5iaW5kKFwiLnRhYnNcIik7YS5lYWNoKFtcImhyZWZcIixcImxvYWRcIixcImNhY2hlXCJdLGZ1bmN0aW9uKGosbCl7Zi5yZW1vdmVEYXRhKGwrXCIudGFic1wiKX0pfSk7dGhpcy5saXMudW5iaW5kKFwiLnRhYnNcIikuYWRkKHRoaXMucGFuZWxzKS5lYWNoKGZ1bmN0aW9uKCl7YS5kYXRhKHRoaXMsXCJkZXN0cm95LnRhYnNcIik/YSh0aGlzKS5yZW1vdmUoKTphKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItdG9wIHVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlIHVpLXN0YXRlLWhvdmVyIHVpLXN0YXRlLWZvY3VzIHVpLXN0YXRlLWRpc2FibGVkIHVpLXRhYnMtcGFuZWwgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWJvdHRvbSB1aS10YWJzLWhpZGVcIil9KTtpLmNvb2tpZSYmdGhpcy5fY29va2llKG51bGwsaS5jb29raWUpO3JldHVybiB0aGlzfSxhZGQ6ZnVuY3Rpb24oaSxcbmIsZil7aWYoZj09PWQpZj10aGlzLmFuY2hvcnMubGVuZ3RoO3ZhciBqPXRoaXMsbD10aGlzLm9wdGlvbnM7Yj1hKGwudGFiVGVtcGxhdGUucmVwbGFjZSgvI1xce2hyZWZcXH0vZyxpKS5yZXBsYWNlKC8jXFx7bGFiZWxcXH0vZyxiKSk7aT0haS5pbmRleE9mKFwiI1wiKT9pLnJlcGxhY2UoXCIjXCIsXCJcIik6dGhpcy5fdGFiSWQoYShcImFcIixiKVswXSk7Yi5hZGRDbGFzcyhcInVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLXRvcFwiKS5kYXRhKFwiZGVzdHJveS50YWJzXCIsdHJ1ZSk7dmFyIG89ai5lbGVtZW50LmZpbmQoXCIjXCIraSk7by5sZW5ndGh8fChvPWEobC5wYW5lbFRlbXBsYXRlKS5hdHRyKFwiaWRcIixpKS5kYXRhKFwiZGVzdHJveS50YWJzXCIsdHJ1ZSkpO28uYWRkQ2xhc3MoXCJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20gdWktdGFicy1oaWRlXCIpO2lmKGY+PXRoaXMubGlzLmxlbmd0aCl7Yi5hcHBlbmRUbyh0aGlzLmxpc3QpO28uYXBwZW5kVG8odGhpcy5saXN0WzBdLnBhcmVudE5vZGUpfWVsc2V7Yi5pbnNlcnRCZWZvcmUodGhpcy5saXNbZl0pO1xuby5pbnNlcnRCZWZvcmUodGhpcy5wYW5lbHNbZl0pfWwuZGlzYWJsZWQ9YS5tYXAobC5kaXNhYmxlZCxmdW5jdGlvbihuKXtyZXR1cm4gbj49Zj8rK246bn0pO3RoaXMuX3RhYmlmeSgpO2lmKHRoaXMuYW5jaG9ycy5sZW5ndGg9PTEpe2wuc2VsZWN0ZWQ9MDtiLmFkZENsYXNzKFwidWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmVcIik7by5yZW1vdmVDbGFzcyhcInVpLXRhYnMtaGlkZVwiKTt0aGlzLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIsZnVuY3Rpb24oKXtqLl90cmlnZ2VyKFwic2hvd1wiLG51bGwsai5fdWkoai5hbmNob3JzWzBdLGoucGFuZWxzWzBdKSl9KTt0aGlzLmxvYWQoMCl9dGhpcy5fdHJpZ2dlcihcImFkZFwiLG51bGwsdGhpcy5fdWkodGhpcy5hbmNob3JzW2ZdLHRoaXMucGFuZWxzW2ZdKSk7cmV0dXJuIHRoaXN9LHJlbW92ZTpmdW5jdGlvbihpKXtpPXRoaXMuX2dldEluZGV4KGkpO3ZhciBiPXRoaXMub3B0aW9ucyxmPXRoaXMubGlzLmVxKGkpLnJlbW92ZSgpLGo9dGhpcy5wYW5lbHMuZXEoaSkucmVtb3ZlKCk7XG5pZihmLmhhc0NsYXNzKFwidWktdGFicy1zZWxlY3RlZFwiKSYmdGhpcy5hbmNob3JzLmxlbmd0aD4xKXRoaXMuc2VsZWN0KGkrKGkrMTx0aGlzLmFuY2hvcnMubGVuZ3RoPzE6LTEpKTtiLmRpc2FibGVkPWEubWFwKGEuZ3JlcChiLmRpc2FibGVkLGZ1bmN0aW9uKGwpe3JldHVybiBsIT1pfSksZnVuY3Rpb24obCl7cmV0dXJuIGw+PWk/LS1sOmx9KTt0aGlzLl90YWJpZnkoKTt0aGlzLl90cmlnZ2VyKFwicmVtb3ZlXCIsbnVsbCx0aGlzLl91aShmLmZpbmQoXCJhXCIpWzBdLGpbMF0pKTtyZXR1cm4gdGhpc30sZW5hYmxlOmZ1bmN0aW9uKGkpe2k9dGhpcy5fZ2V0SW5kZXgoaSk7dmFyIGI9dGhpcy5vcHRpb25zO2lmKGEuaW5BcnJheShpLGIuZGlzYWJsZWQpIT0tMSl7dGhpcy5saXMuZXEoaSkucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1kaXNhYmxlZFwiKTtiLmRpc2FibGVkPWEuZ3JlcChiLmRpc2FibGVkLGZ1bmN0aW9uKGYpe3JldHVybiBmIT1pfSk7dGhpcy5fdHJpZ2dlcihcImVuYWJsZVwiLG51bGwsXG50aGlzLl91aSh0aGlzLmFuY2hvcnNbaV0sdGhpcy5wYW5lbHNbaV0pKTtyZXR1cm4gdGhpc319LGRpc2FibGU6ZnVuY3Rpb24oaSl7aT10aGlzLl9nZXRJbmRleChpKTt2YXIgYj10aGlzLm9wdGlvbnM7aWYoaSE9Yi5zZWxlY3RlZCl7dGhpcy5saXMuZXEoaSkuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1kaXNhYmxlZFwiKTtiLmRpc2FibGVkLnB1c2goaSk7Yi5kaXNhYmxlZC5zb3J0KCk7dGhpcy5fdHJpZ2dlcihcImRpc2FibGVcIixudWxsLHRoaXMuX3VpKHRoaXMuYW5jaG9yc1tpXSx0aGlzLnBhbmVsc1tpXSkpfXJldHVybiB0aGlzfSxzZWxlY3Q6ZnVuY3Rpb24oaSl7aT10aGlzLl9nZXRJbmRleChpKTtpZihpPT0tMSlpZih0aGlzLm9wdGlvbnMuY29sbGFwc2libGUmJnRoaXMub3B0aW9ucy5zZWxlY3RlZCE9LTEpaT10aGlzLm9wdGlvbnMuc2VsZWN0ZWQ7ZWxzZSByZXR1cm4gdGhpczt0aGlzLmFuY2hvcnMuZXEoaSkudHJpZ2dlcih0aGlzLm9wdGlvbnMuZXZlbnQrXCIudGFic1wiKTtyZXR1cm4gdGhpc30sXG5sb2FkOmZ1bmN0aW9uKGkpe2k9dGhpcy5fZ2V0SW5kZXgoaSk7dmFyIGI9dGhpcyxmPXRoaXMub3B0aW9ucyxqPXRoaXMuYW5jaG9ycy5lcShpKVswXSxsPWEuZGF0YShqLFwibG9hZC50YWJzXCIpO3RoaXMuYWJvcnQoKTtpZighbHx8dGhpcy5lbGVtZW50LnF1ZXVlKFwidGFic1wiKS5sZW5ndGghPT0wJiZhLmRhdGEoaixcImNhY2hlLnRhYnNcIikpdGhpcy5lbGVtZW50LmRlcXVldWUoXCJ0YWJzXCIpO2Vsc2V7dGhpcy5saXMuZXEoaSkuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1wcm9jZXNzaW5nXCIpO2lmKGYuc3Bpbm5lcil7dmFyIG89YShcInNwYW5cIixqKTtvLmRhdGEoXCJsYWJlbC50YWJzXCIsby5odG1sKCkpLmh0bWwoZi5zcGlubmVyKX10aGlzLnhocj1hLmFqYXgoYS5leHRlbmQoe30sZi5hamF4T3B0aW9ucyx7dXJsOmwsc3VjY2VzczpmdW5jdGlvbihuLGspe2IuZWxlbWVudC5maW5kKGIuX3Nhbml0aXplU2VsZWN0b3Ioai5oYXNoKSkuaHRtbChuKTtiLl9jbGVhbnVwKCk7Zi5jYWNoZSYmYS5kYXRhKGosXG5cImNhY2hlLnRhYnNcIix0cnVlKTtiLl90cmlnZ2VyKFwibG9hZFwiLG51bGwsYi5fdWkoYi5hbmNob3JzW2ldLGIucGFuZWxzW2ldKSk7dHJ5e2YuYWpheE9wdGlvbnMuc3VjY2VzcyhuLGspfWNhdGNoKG0pe319LGVycm9yOmZ1bmN0aW9uKG4sayl7Yi5fY2xlYW51cCgpO2IuX3RyaWdnZXIoXCJsb2FkXCIsbnVsbCxiLl91aShiLmFuY2hvcnNbaV0sYi5wYW5lbHNbaV0pKTt0cnl7Zi5hamF4T3B0aW9ucy5lcnJvcihuLGssaSxqKX1jYXRjaChtKXt9fX0pKTtiLmVsZW1lbnQuZGVxdWV1ZShcInRhYnNcIik7cmV0dXJuIHRoaXN9fSxhYm9ydDpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5xdWV1ZShbXSk7dGhpcy5wYW5lbHMuc3RvcChmYWxzZSx0cnVlKTt0aGlzLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIsdGhpcy5lbGVtZW50LnF1ZXVlKFwidGFic1wiKS5zcGxpY2UoLTIsMikpO2lmKHRoaXMueGhyKXt0aGlzLnhoci5hYm9ydCgpO2RlbGV0ZSB0aGlzLnhocn10aGlzLl9jbGVhbnVwKCk7cmV0dXJuIHRoaXN9LFxudXJsOmZ1bmN0aW9uKGksYil7dGhpcy5hbmNob3JzLmVxKGkpLnJlbW92ZURhdGEoXCJjYWNoZS50YWJzXCIpLmRhdGEoXCJsb2FkLnRhYnNcIixiKTtyZXR1cm4gdGhpc30sbGVuZ3RoOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYW5jaG9ycy5sZW5ndGh9fSk7YS5leHRlbmQoYS51aS50YWJzLHt2ZXJzaW9uOlwiMS44LjE2XCJ9KTthLmV4dGVuZChhLnVpLnRhYnMucHJvdG90eXBlLHtyb3RhdGlvbjpudWxsLHJvdGF0ZTpmdW5jdGlvbihpLGIpe3ZhciBmPXRoaXMsaj10aGlzLm9wdGlvbnMsbD1mLl9yb3RhdGV8fChmLl9yb3RhdGU9ZnVuY3Rpb24obyl7Y2xlYXJUaW1lb3V0KGYucm90YXRpb24pO2Yucm90YXRpb249c2V0VGltZW91dChmdW5jdGlvbigpe3ZhciBuPWouc2VsZWN0ZWQ7Zi5zZWxlY3QoKytuPGYuYW5jaG9ycy5sZW5ndGg/bjowKX0saSk7byYmby5zdG9wUHJvcGFnYXRpb24oKX0pO2I9Zi5fdW5yb3RhdGV8fChmLl91bnJvdGF0ZT0hYj9mdW5jdGlvbihvKXtvLmNsaWVudFgmJlxuZi5yb3RhdGUobnVsbCl9OmZ1bmN0aW9uKCl7dD1qLnNlbGVjdGVkO2woKX0pO2lmKGkpe3RoaXMuZWxlbWVudC5iaW5kKFwidGFic3Nob3dcIixsKTt0aGlzLmFuY2hvcnMuYmluZChqLmV2ZW50K1wiLnRhYnNcIixiKTtsKCl9ZWxzZXtjbGVhclRpbWVvdXQoZi5yb3RhdGlvbik7dGhpcy5lbGVtZW50LnVuYmluZChcInRhYnNzaG93XCIsbCk7dGhpcy5hbmNob3JzLnVuYmluZChqLmV2ZW50K1wiLnRhYnNcIixiKTtkZWxldGUgdGhpcy5fcm90YXRlO2RlbGV0ZSB0aGlzLl91bnJvdGF0ZX1yZXR1cm4gdGhpc319KX0pKGpRdWVyeSk7XG59O1xuIiwiLyohXG4gKiBqUXVlcnkgVUkgVG91Y2ggUHVuY2ggMC4yLjJcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgRGF2ZSBGdXJmZXJvXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqXG4gKiBEZXBlbmRzOlxuICogIGpxdWVyeS51aS53aWRnZXQuanNcbiAqICBqcXVlcnkudWkubW91c2UuanNcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoJCkge1xuXG4gIC8vIERldGVjdCB0b3VjaCBzdXBwb3J0XG4gICQuc3VwcG9ydC50b3VjaCA9ICdvbnRvdWNoZW5kJyBpbiBkb2N1bWVudDtcblxuICAvLyBJZ25vcmUgYnJvd3NlcnMgd2l0aG91dCB0b3VjaCBzdXBwb3J0XG4gIGlmICghJC5zdXBwb3J0LnRvdWNoKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vdXNlUHJvdG8gPSAkLnVpLm1vdXNlLnByb3RvdHlwZSxcbiAgICAgIF9tb3VzZUluaXQgPSBtb3VzZVByb3RvLl9tb3VzZUluaXQsXG4gICAgICB0b3VjaEhhbmRsZWQ7XG5cbiAgLyoqXG4gICAqIFNpbXVsYXRlIGEgbW91c2UgZXZlbnQgYmFzZWQgb24gYSBjb3JyZXNwb25kaW5nIHRvdWNoIGV2ZW50XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBBIHRvdWNoIGV2ZW50XG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzaW11bGF0ZWRUeXBlIFRoZSBjb3JyZXNwb25kaW5nIG1vdXNlIGV2ZW50XG4gICAqL1xuICBmdW5jdGlvbiBzaW11bGF0ZU1vdXNlRXZlbnQgKGV2ZW50LCBzaW11bGF0ZWRUeXBlKSB7XG5cbiAgICAvLyBJZ25vcmUgbXVsdGktdG91Y2ggZXZlbnRzXG4gICAgaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlcy5sZW5ndGggPiAxKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIHZhciB0b3VjaCA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0sXG4gICAgICAgIHNpbXVsYXRlZEV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ01vdXNlRXZlbnRzJyk7XG4gICAgXG4gICAgLy8gSW5pdGlhbGl6ZSB0aGUgc2ltdWxhdGVkIG1vdXNlIGV2ZW50IHVzaW5nIHRoZSB0b3VjaCBldmVudCdzIGNvb3JkaW5hdGVzXG4gICAgc2ltdWxhdGVkRXZlbnQuaW5pdE1vdXNlRXZlbnQoXG4gICAgICBzaW11bGF0ZWRUeXBlLCAgICAvLyB0eXBlXG4gICAgICB0cnVlLCAgICAgICAgICAgICAvLyBidWJibGVzICAgICAgICAgICAgICAgICAgICBcbiAgICAgIHRydWUsICAgICAgICAgICAgIC8vIGNhbmNlbGFibGUgICAgICAgICAgICAgICAgIFxuICAgICAgd2luZG93LCAgICAgICAgICAgLy8gdmlldyAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAxLCAgICAgICAgICAgICAgICAvLyBkZXRhaWwgICAgICAgICAgICAgICAgICAgICBcbiAgICAgIHRvdWNoLnNjcmVlblgsICAgIC8vIHNjcmVlblggICAgICAgICAgICAgICAgICAgIFxuICAgICAgdG91Y2guc2NyZWVuWSwgICAgLy8gc2NyZWVuWSAgICAgICAgICAgICAgICAgICAgXG4gICAgICB0b3VjaC5jbGllbnRYLCAgICAvLyBjbGllbnRYICAgICAgICAgICAgICAgICAgICBcbiAgICAgIHRvdWNoLmNsaWVudFksICAgIC8vIGNsaWVudFkgICAgICAgICAgICAgICAgICAgIFxuICAgICAgZmFsc2UsICAgICAgICAgICAgLy8gY3RybEtleSAgICAgICAgICAgICAgICAgICAgXG4gICAgICBmYWxzZSwgICAgICAgICAgICAvLyBhbHRLZXkgICAgICAgICAgICAgICAgICAgICBcbiAgICAgIGZhbHNlLCAgICAgICAgICAgIC8vIHNoaWZ0S2V5ICAgICAgICAgICAgICAgICAgIFxuICAgICAgZmFsc2UsICAgICAgICAgICAgLy8gbWV0YUtleSAgICAgICAgICAgICAgICAgICAgXG4gICAgICAwLCAgICAgICAgICAgICAgICAvLyBidXR0b24gICAgICAgICAgICAgICAgICAgICBcbiAgICAgIG51bGwgICAgICAgICAgICAgIC8vIHJlbGF0ZWRUYXJnZXQgICAgICAgICAgICAgIFxuICAgICk7XG5cbiAgICAvLyBEaXNwYXRjaCB0aGUgc2ltdWxhdGVkIGV2ZW50IHRvIHRoZSB0YXJnZXQgZWxlbWVudFxuICAgIGV2ZW50LnRhcmdldC5kaXNwYXRjaEV2ZW50KHNpbXVsYXRlZEV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGpRdWVyeSBVSSB3aWRnZXQncyB0b3VjaHN0YXJ0IGV2ZW50c1xuICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIHdpZGdldCBlbGVtZW50J3MgdG91Y2hzdGFydCBldmVudFxuICAgKi9cbiAgbW91c2VQcm90by5fdG91Y2hTdGFydCA9IGZ1bmN0aW9uIChldmVudCkge1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLy8gSWdub3JlIHRoZSBldmVudCBpZiBhbm90aGVyIHdpZGdldCBpcyBhbHJlYWR5IGJlaW5nIGhhbmRsZWRcbiAgICBpZiAodG91Y2hIYW5kbGVkIHx8ICFzZWxmLl9tb3VzZUNhcHR1cmUoZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgXG4gICAgLy8gU2V0IHRoZSBmbGFnIHRvIHByZXZlbnQgb3RoZXIgd2lkZ2V0cyBmcm9tIGluaGVyaXRpbmcgdGhlIHRvdWNoIGV2ZW50XG4gICAgdG91Y2hIYW5kbGVkID0gdHJ1ZTtcblxuICAgIC8vIFRyYWNrIG1vdmVtZW50IHRvIGRldGVybWluZSBpZiBpbnRlcmFjdGlvbiB3YXMgYSBjbGlja1xuICAgIHNlbGYuX3RvdWNoTW92ZWQgPSBmYWxzZTtcblxuICAgIC8vIFNpbXVsYXRlIHRoZSBtb3VzZW92ZXIgZXZlbnRcbiAgICBzaW11bGF0ZU1vdXNlRXZlbnQoZXZlbnQsICdtb3VzZW92ZXInKTtcblxuICAgIC8vIFNpbXVsYXRlIHRoZSBtb3VzZW1vdmUgZXZlbnRcbiAgICBzaW11bGF0ZU1vdXNlRXZlbnQoZXZlbnQsICdtb3VzZW1vdmUnKTtcblxuICAgIC8vIFNpbXVsYXRlIHRoZSBtb3VzZWRvd24gZXZlbnRcbiAgICBzaW11bGF0ZU1vdXNlRXZlbnQoZXZlbnQsICdtb3VzZWRvd24nKTtcbiAgICBcbiAgfTtcblxuICAvKipcbiAgICogSGFuZGxlIHRoZSBqUXVlcnkgVUkgd2lkZ2V0J3MgdG91Y2htb3ZlIGV2ZW50c1xuICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIGRvY3VtZW50J3MgdG91Y2htb3ZlIGV2ZW50XG4gICAqL1xuICBtb3VzZVByb3RvLl90b3VjaE1vdmUgPSBmdW5jdGlvbiAoZXZlbnQpIHtcblxuICAgIC8vIElnbm9yZSBldmVudCBpZiBub3QgaGFuZGxlZFxuICAgIGlmICghdG91Y2hIYW5kbGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gSW50ZXJhY3Rpb24gd2FzIG5vdCBhIGNsaWNrXG4gICAgdGhpcy5fdG91Y2hNb3ZlZCA9IHRydWU7XG5cbiAgICAvLyBTaW11bGF0ZSB0aGUgbW91c2Vtb3ZlIGV2ZW50XG4gICAgc2ltdWxhdGVNb3VzZUV2ZW50KGV2ZW50LCAnbW91c2Vtb3ZlJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB0aGUgalF1ZXJ5IFVJIHdpZGdldCdzIHRvdWNoZW5kIGV2ZW50c1xuICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIGRvY3VtZW50J3MgdG91Y2hlbmQgZXZlbnRcbiAgICovXG4gIG1vdXNlUHJvdG8uX3RvdWNoRW5kID0gZnVuY3Rpb24gKGV2ZW50KSB7XG5cbiAgICAvLyBJZ25vcmUgZXZlbnQgaWYgbm90IGhhbmRsZWRcbiAgICBpZiAoIXRvdWNoSGFuZGxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFNpbXVsYXRlIHRoZSBtb3VzZXVwIGV2ZW50XG4gICAgc2ltdWxhdGVNb3VzZUV2ZW50KGV2ZW50LCAnbW91c2V1cCcpO1xuXG4gICAgLy8gU2ltdWxhdGUgdGhlIG1vdXNlb3V0IGV2ZW50XG4gICAgc2ltdWxhdGVNb3VzZUV2ZW50KGV2ZW50LCAnbW91c2VvdXQnKTtcblxuICAgIC8vIElmIHRoZSB0b3VjaCBpbnRlcmFjdGlvbiBkaWQgbm90IG1vdmUsIGl0IHNob3VsZCB0cmlnZ2VyIGEgY2xpY2tcbiAgICBpZiAoIXRoaXMuX3RvdWNoTW92ZWQpIHtcblxuICAgICAgLy8gU2ltdWxhdGUgdGhlIGNsaWNrIGV2ZW50XG4gICAgICBzaW11bGF0ZU1vdXNlRXZlbnQoZXZlbnQsICdjbGljaycpO1xuICAgIH1cblxuICAgIC8vIFVuc2V0IHRoZSBmbGFnIHRvIGFsbG93IG90aGVyIHdpZGdldHMgdG8gaW5oZXJpdCB0aGUgdG91Y2ggZXZlbnRcbiAgICB0b3VjaEhhbmRsZWQgPSBmYWxzZTtcbiAgfTtcblxuICAvKipcbiAgICogQSBkdWNrIHB1bmNoIG9mIHRoZSAkLnVpLm1vdXNlIF9tb3VzZUluaXQgbWV0aG9kIHRvIHN1cHBvcnQgdG91Y2ggZXZlbnRzLlxuICAgKiBUaGlzIG1ldGhvZCBleHRlbmRzIHRoZSB3aWRnZXQgd2l0aCBib3VuZCB0b3VjaCBldmVudCBoYW5kbGVycyB0aGF0XG4gICAqIHRyYW5zbGF0ZSB0b3VjaCBldmVudHMgdG8gbW91c2UgZXZlbnRzIGFuZCBwYXNzIHRoZW0gdG8gdGhlIHdpZGdldCdzXG4gICAqIG9yaWdpbmFsIG1vdXNlIGV2ZW50IGhhbmRsaW5nIG1ldGhvZHMuXG4gICAqL1xuICBtb3VzZVByb3RvLl9tb3VzZUluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLy8gRGVsZWdhdGUgdGhlIHRvdWNoIGhhbmRsZXJzIHRvIHRoZSB3aWRnZXQncyBlbGVtZW50XG4gICAgc2VsZi5lbGVtZW50XG4gICAgICAuYmluZCgndG91Y2hzdGFydCcsICQucHJveHkoc2VsZiwgJ190b3VjaFN0YXJ0JykpXG4gICAgICAuYmluZCgndG91Y2htb3ZlJywgJC5wcm94eShzZWxmLCAnX3RvdWNoTW92ZScpKVxuICAgICAgLmJpbmQoJ3RvdWNoZW5kJywgJC5wcm94eShzZWxmLCAnX3RvdWNoRW5kJykpO1xuXG4gICAgLy8gQ2FsbCB0aGUgb3JpZ2luYWwgJC51aS5tb3VzZSBpbml0IG1ldGhvZFxuICAgIF9tb3VzZUluaXQuY2FsbChzZWxmKTtcbiAgfTtcblxufTsiLCIvKipcbiAqIEZhcmJ0YXN0aWMgQ29sb3IgUGlja2VyIDEuMlxuICogwqkgMjAwOCBTdGV2ZW4gV2l0dGVuc1xuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmVcbiAqIEZvdW5kYXRpb24sIEluYy4sIDUxIEZyYW5rbGluIFN0cmVldCwgRmlmdGggRmxvb3IsIEJvc3RvbiwgTUEgIDAyMTEwLTEzMDEgIFVTQVxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oalF1ZXJ5KSB7XG5cbmpRdWVyeS5mbi5mYXJidGFzdGljID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICQuZmFyYnRhc3RpYyh0aGlzLCBjYWxsYmFjayk7XG4gIHJldHVybiB0aGlzO1xufTtcblxualF1ZXJ5LmZhcmJ0YXN0aWMgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBjYWxsYmFjaykge1xuICB2YXIgY29udGFpbmVyID0gJChjb250YWluZXIpLmdldCgwKTtcbiAgcmV0dXJuIGNvbnRhaW5lci5mYXJidGFzdGljIHx8IChjb250YWluZXIuZmFyYnRhc3RpYyA9IG5ldyBqUXVlcnkuX2ZhcmJ0YXN0aWMoY29udGFpbmVyLCBjYWxsYmFjaykpO1xufVxuXG5qUXVlcnkuX2ZhcmJ0YXN0aWMgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBjYWxsYmFjaykge1xuICAvLyBTdG9yZSBmYXJidGFzdGljIG9iamVjdFxuICB2YXIgZmIgPSB0aGlzO1xuXG4gIC8vIEluc2VydCBtYXJrdXBcbiAgJChjb250YWluZXIpLmh0bWwoJzxkaXYgY2xhc3M9XCJmYXJidGFzdGljXCI+PGRpdiBjbGFzcz1cImNvbG9yXCI+PC9kaXY+PGRpdiBjbGFzcz1cIndoZWVsXCI+PC9kaXY+PGRpdiBjbGFzcz1cIm92ZXJsYXlcIj48L2Rpdj48ZGl2IGNsYXNzPVwiaC1tYXJrZXIgbWFya2VyXCI+PC9kaXY+PGRpdiBjbGFzcz1cInNsLW1hcmtlciBtYXJrZXJcIj48L2Rpdj48L2Rpdj4nKTtcbiAgdmFyIGUgPSAkKCcuZmFyYnRhc3RpYycsIGNvbnRhaW5lcik7XG4gIGZiLndoZWVsID0gJCgnLndoZWVsJywgY29udGFpbmVyKS5nZXQoMCk7XG4gIC8vIERpbWVuc2lvbnNcbiAgZmIucmFkaXVzID0gODQ7XG4gIGZiLnNxdWFyZSA9IDEwMDtcbiAgZmIud2lkdGggPSAxOTQ7XG5cbiAgLy8gRml4IGJhY2tncm91bmQgUE5HcyBpbiBJRTZcbiAgaWYgKG5hdmlnYXRvci5hcHBWZXJzaW9uLm1hdGNoKC9NU0lFIFswLTZdXFwuLykpIHtcbiAgICAkKCcqJywgZSkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5jdXJyZW50U3R5bGUuYmFja2dyb3VuZEltYWdlICE9ICdub25lJykge1xuICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmN1cnJlbnRTdHlsZS5iYWNrZ3JvdW5kSW1hZ2U7XG4gICAgICAgIGltYWdlID0gdGhpcy5jdXJyZW50U3R5bGUuYmFja2dyb3VuZEltYWdlLnN1YnN0cmluZyg1LCBpbWFnZS5sZW5ndGggLSAyKTtcbiAgICAgICAgJCh0aGlzKS5jc3Moe1xuICAgICAgICAgICdiYWNrZ3JvdW5kSW1hZ2UnOiAnbm9uZScsXG4gICAgICAgICAgJ2ZpbHRlcic6IFwicHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LkFscGhhSW1hZ2VMb2FkZXIoZW5hYmxlZD10cnVlLCBzaXppbmdNZXRob2Q9Y3JvcCwgc3JjPSdcIiArIGltYWdlICsgXCInKVwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIExpbmsgdG8gdGhlIGdpdmVuIGVsZW1lbnQocykgb3IgY2FsbGJhY2suXG4gICAqL1xuICBmYi5saW5rVG8gPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAvLyBVbmJpbmQgcHJldmlvdXMgbm9kZXNcbiAgICBpZiAodHlwZW9mIGZiLmNhbGxiYWNrID09ICdvYmplY3QnKSB7XG4gICAgICAkKGZiLmNhbGxiYWNrKS51bmJpbmQoJ2tleXVwJywgZmIudXBkYXRlVmFsdWUpO1xuICAgIH1cblxuICAgIC8vIFJlc2V0IGNvbG9yXG4gICAgZmIuY29sb3IgPSBudWxsO1xuXG4gICAgLy8gQmluZCBjYWxsYmFjayBvciBlbGVtZW50c1xuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgZmIuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZW9mIGNhbGxiYWNrID09ICdvYmplY3QnIHx8IHR5cGVvZiBjYWxsYmFjayA9PSAnc3RyaW5nJykge1xuICAgICAgZmIuY2FsbGJhY2sgPSAkKGNhbGxiYWNrKTtcbiAgICAgIGZiLmNhbGxiYWNrLmJpbmQoJ2tleXVwIGNoYW5nZSBibHVyJywgZmIudXBkYXRlVmFsdWUpO1xuICAgICAgaWYgKGZiLmNhbGxiYWNrLmdldCgwKS52YWx1ZSkge1xuICAgICAgICBmYi5zZXRDb2xvcihmYi5jYWxsYmFjay5nZXQoMCkudmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBmYi51cGRhdGVWYWx1ZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgIGlmICh0aGlzLnZhbHVlICYmIHRoaXMudmFsdWUgIT0gZmIuY29sb3IpIHtcbiAgICAgIGZiLnNldENvbG9yKHRoaXMudmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgY29sb3Igd2l0aCBIVE1MIHN5bnRheCAjMTIzNDU2XG4gICAqL1xuICBmYi5zZXRDb2xvciA9IGZ1bmN0aW9uIChjb2xvcikge1xuICAgIHZhciB1bnBhY2sgPSBmYi51bnBhY2soY29sb3IpO1xuICAgIGlmIChmYi5jb2xvciAhPSBjb2xvciAmJiB1bnBhY2spIHtcbiAgICAgIGZiLmNvbG9yID0gY29sb3I7XG4gICAgICBmYi5yZ2IgPSB1bnBhY2s7XG4gICAgICBmYi5oc2wgPSBmYi5SR0JUb0hTTChmYi5yZ2IpO1xuICAgICAgZmIudXBkYXRlRGlzcGxheSgpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgY29sb3Igd2l0aCBIU0wgdHJpcGxldCBbMC4uMSwgMC4uMSwgMC4uMV1cbiAgICovXG4gIGZiLnNldEhTTCA9IGZ1bmN0aW9uIChoc2wpIHtcbiAgICBmYi5oc2wgPSBoc2w7XG4gICAgZmIucmdiID0gZmIuSFNMVG9SR0IoaHNsKTtcbiAgICBmYi5jb2xvciA9IGZiLnBhY2soZmIucmdiKTtcbiAgICBmYi51cGRhdGVEaXNwbGF5KCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgY29vcmRpbmF0ZXMgb2YgdGhlIGdpdmVuIGV2ZW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXJcbiAgICogb2YgdGhlIHdpZGdldC5cbiAgICovXG4gIGZiLndpZGdldENvb3JkcyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgIHZhciB4LCB5O1xuICAgIHZhciBlbCA9IGV2ZW50LnRhcmdldCB8fCBldmVudC5zcmNFbGVtZW50O1xuICAgIHZhciByZWZlcmVuY2UgPSBmYi53aGVlbDtcblxuICAgIGlmICh0eXBlb2YgZXZlbnQub2Zmc2V0WCAhPSAndW5kZWZpbmVkJykge1xuICAgICAgLy8gVXNlIG9mZnNldCBjb29yZGluYXRlcyBhbmQgZmluZCBjb21tb24gb2Zmc2V0UGFyZW50XG4gICAgICB2YXIgcG9zID0geyB4OiBldmVudC5vZmZzZXRYLCB5OiBldmVudC5vZmZzZXRZIH07XG5cbiAgICAgIC8vIFNlbmQgdGhlIGNvb3JkaW5hdGVzIHVwd2FyZHMgdGhyb3VnaCB0aGUgb2Zmc2V0UGFyZW50IGNoYWluLlxuICAgICAgdmFyIGUgPSBlbDtcbiAgICAgIHdoaWxlIChlKSB7XG4gICAgICAgIGUubW91c2VYID0gcG9zLng7XG4gICAgICAgIGUubW91c2VZID0gcG9zLnk7XG4gICAgICAgIHBvcy54ICs9IGUub2Zmc2V0TGVmdDtcbiAgICAgICAgcG9zLnkgKz0gZS5vZmZzZXRUb3A7XG4gICAgICAgIGUgPSBlLm9mZnNldFBhcmVudDtcbiAgICAgIH1cblxuICAgICAgLy8gTG9vayBmb3IgdGhlIGNvb3JkaW5hdGVzIHN0YXJ0aW5nIGZyb20gdGhlIHdoZWVsIHdpZGdldC5cbiAgICAgIHZhciBlID0gcmVmZXJlbmNlO1xuICAgICAgdmFyIG9mZnNldCA9IHsgeDogMCwgeTogMCB9XG4gICAgICB3aGlsZSAoZSkge1xuICAgICAgICBpZiAodHlwZW9mIGUubW91c2VYICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgeCA9IGUubW91c2VYIC0gb2Zmc2V0Lng7XG4gICAgICAgICAgeSA9IGUubW91c2VZIC0gb2Zmc2V0Lnk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgb2Zmc2V0LnggKz0gZS5vZmZzZXRMZWZ0O1xuICAgICAgICBvZmZzZXQueSArPSBlLm9mZnNldFRvcDtcbiAgICAgICAgZSA9IGUub2Zmc2V0UGFyZW50O1xuICAgICAgfVxuXG4gICAgICAvLyBSZXNldCBzdG9yZWQgY29vcmRpbmF0ZXNcbiAgICAgIGUgPSBlbDtcbiAgICAgIHdoaWxlIChlKSB7XG4gICAgICAgIGUubW91c2VYID0gdW5kZWZpbmVkO1xuICAgICAgICBlLm1vdXNlWSA9IHVuZGVmaW5lZDtcbiAgICAgICAgZSA9IGUub2Zmc2V0UGFyZW50O1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIC8vIFVzZSBhYnNvbHV0ZSBjb29yZGluYXRlc1xuICAgICAgdmFyIHBvcyA9IGZiLmFic29sdXRlUG9zaXRpb24ocmVmZXJlbmNlKTtcbiAgICAgIHggPSAoZXZlbnQucGFnZVggfHwgMCooZXZlbnQuY2xpZW50WCArICQoJ2h0bWwnKS5nZXQoMCkuc2Nyb2xsTGVmdCkpIC0gcG9zLng7XG4gICAgICB5ID0gKGV2ZW50LnBhZ2VZIHx8IDAqKGV2ZW50LmNsaWVudFkgKyAkKCdodG1sJykuZ2V0KDApLnNjcm9sbFRvcCkpIC0gcG9zLnk7XG4gICAgfVxuICAgIC8vIFN1YnRyYWN0IGRpc3RhbmNlIHRvIG1pZGRsZVxuICAgIHJldHVybiB7IHg6IHggLSBmYi53aWR0aCAvIDIsIHk6IHkgLSBmYi53aWR0aCAvIDIgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3VzZWRvd24gaGFuZGxlclxuICAgKi9cbiAgZmIubW91c2Vkb3duID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgLy8gQ2FwdHVyZSBtb3VzZVxuICAgIGlmICghZG9jdW1lbnQuZHJhZ2dpbmcpIHtcbiAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ21vdXNlbW92ZScsIGZiLm1vdXNlbW92ZSkuYmluZCgnbW91c2V1cCcsIGZiLm1vdXNldXApO1xuICAgICAgZG9jdW1lbnQuZHJhZ2dpbmcgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIENoZWNrIHdoaWNoIGFyZWEgaXMgYmVpbmcgZHJhZ2dlZFxuICAgIHZhciBwb3MgPSBmYi53aWRnZXRDb29yZHMoZXZlbnQpO1xuICAgIGZiLmNpcmNsZURyYWcgPSBNYXRoLm1heChNYXRoLmFicyhwb3MueCksIE1hdGguYWJzKHBvcy55KSkgKiAyID4gZmIuc3F1YXJlO1xuXG4gICAgLy8gUHJvY2Vzc1xuICAgIGZiLm1vdXNlbW92ZShldmVudCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIE1vdXNlbW92ZSBoYW5kbGVyXG4gICAqL1xuICBmYi5tb3VzZW1vdmUgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAvLyBHZXQgY29vcmRpbmF0ZXMgcmVsYXRpdmUgdG8gY29sb3IgcGlja2VyIGNlbnRlclxuICAgIHZhciBwb3MgPSBmYi53aWRnZXRDb29yZHMoZXZlbnQpO1xuXG4gICAgLy8gU2V0IG5ldyBIU0wgcGFyYW1ldGVyc1xuICAgIGlmIChmYi5jaXJjbGVEcmFnKSB7XG4gICAgICB2YXIgaHVlID0gTWF0aC5hdGFuMihwb3MueCwgLXBvcy55KSAvIDYuMjg7XG4gICAgICBpZiAoaHVlIDwgMCkgaHVlICs9IDE7XG4gICAgICBmYi5zZXRIU0woW2h1ZSwgZmIuaHNsWzFdLCBmYi5oc2xbMl1dKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB2YXIgc2F0ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgLShwb3MueCAvIGZiLnNxdWFyZSkgKyAuNSkpO1xuICAgICAgdmFyIGx1bSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIC0ocG9zLnkgLyBmYi5zcXVhcmUpICsgLjUpKTtcbiAgICAgIGZiLnNldEhTTChbZmIuaHNsWzBdLCBzYXQsIGx1bV0pO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogTW91c2V1cCBoYW5kbGVyXG4gICAqL1xuICBmYi5tb3VzZXVwID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIFVuY2FwdHVyZSBtb3VzZVxuICAgICQoZG9jdW1lbnQpLnVuYmluZCgnbW91c2Vtb3ZlJywgZmIubW91c2Vtb3ZlKTtcbiAgICAkKGRvY3VtZW50KS51bmJpbmQoJ21vdXNldXAnLCBmYi5tb3VzZXVwKTtcbiAgICBkb2N1bWVudC5kcmFnZ2luZyA9IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgbWFya2VycyBhbmQgc3R5bGVzXG4gICAqL1xuICBmYi51cGRhdGVEaXNwbGF5ID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIE1hcmtlcnNcbiAgICB2YXIgYW5nbGUgPSBmYi5oc2xbMF0gKiA2LjI4O1xuICAgICQoJy5oLW1hcmtlcicsIGUpLmNzcyh7XG4gICAgICBsZWZ0OiBNYXRoLnJvdW5kKE1hdGguc2luKGFuZ2xlKSAqIGZiLnJhZGl1cyArIGZiLndpZHRoIC8gMikgKyAncHgnLFxuICAgICAgdG9wOiBNYXRoLnJvdW5kKC1NYXRoLmNvcyhhbmdsZSkgKiBmYi5yYWRpdXMgKyBmYi53aWR0aCAvIDIpICsgJ3B4J1xuICAgIH0pO1xuXG4gICAgJCgnLnNsLW1hcmtlcicsIGUpLmNzcyh7XG4gICAgICBsZWZ0OiBNYXRoLnJvdW5kKGZiLnNxdWFyZSAqICguNSAtIGZiLmhzbFsxXSkgKyBmYi53aWR0aCAvIDIpICsgJ3B4JyxcbiAgICAgIHRvcDogTWF0aC5yb3VuZChmYi5zcXVhcmUgKiAoLjUgLSBmYi5oc2xbMl0pICsgZmIud2lkdGggLyAyKSArICdweCdcbiAgICB9KTtcblxuICAgIC8vIFNhdHVyYXRpb24vTHVtaW5hbmNlIGdyYWRpZW50XG4gICAgJCgnLmNvbG9yJywgZSkuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCAncmdiKCcgKyBmYi5wYWNrKGZiLkhTTFRvUkdCKFtmYi5oc2xbMF0sIDEsIDAuNV0pKSArICcpJyk7XG5cbiAgICAvLyBMaW5rZWQgZWxlbWVudHMgb3IgY2FsbGJhY2tcbiAgICBpZiAodHlwZW9mIGZiLmNhbGxiYWNrID09ICdvYmplY3QnKSB7XG4gICAgICAvLyBTZXQgYmFja2dyb3VuZC9mb3JlZ3JvdW5kIGNvbG9yXG4gICAgICAkKGZiLmNhbGxiYWNrKS5jc3Moe1xuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2IoJyArIGZiLmNvbG9yICsgJyknLFxuICAgICAgICBjb2xvcjogZmIuaHNsWzJdID4gMC41ID8gJyMwMDAnIDogJyNmZmYnXG4gICAgICB9KTtcblxuICAgICAgLy8gQ2hhbmdlIGxpbmtlZCB2YWx1ZVxuICAgICAgJChmYi5jYWxsYmFjaykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMudmFsdWUgIT0gZmIuY29sb3IpIHtcbiAgICAgICAgICB0aGlzLnZhbHVlID0gZmIuY29sb3I7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgZmIuY2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgZmIuY2FsbGJhY2suY2FsbChmYiwgZmIuY29sb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWJzb2x1dGUgcG9zaXRpb24gb2YgZWxlbWVudFxuICAgKi9cbiAgZmIuYWJzb2x1dGVQb3NpdGlvbiA9IGZ1bmN0aW9uIChlbCkge1xuICAgIHZhciByID0geyB4OiBlbC5vZmZzZXRMZWZ0LCB5OiBlbC5vZmZzZXRUb3AgfTtcbiAgICAvLyBSZXNvbHZlIHJlbGF0aXZlIHRvIG9mZnNldFBhcmVudFxuICAgIGlmIChlbC5vZmZzZXRQYXJlbnQpIHtcbiAgICAgIHZhciB0bXAgPSBmYi5hYnNvbHV0ZVBvc2l0aW9uKGVsLm9mZnNldFBhcmVudCk7XG4gICAgICByLnggKz0gdG1wLng7XG4gICAgICByLnkgKz0gdG1wLnk7XG4gICAgfVxuICAgIHJldHVybiByO1xuICB9O1xuXG4gIC8qIFZhcmlvdXMgY29sb3IgdXRpbGl0eSBmdW5jdGlvbnMgKi9cbiAgZmIucGFjayA9IGZ1bmN0aW9uIChyZ2IsIGhleCkge1xuICAgIHZhciByID0gTWF0aC5yb3VuZChyZ2JbMF0gKiAyNTUpO1xuICAgIHZhciBnID0gTWF0aC5yb3VuZChyZ2JbMV0gKiAyNTUpO1xuICAgIHZhciBiID0gTWF0aC5yb3VuZChyZ2JbMl0gKiAyNTUpO1xuICAgIGlmIChoZXgpIHtcbiAgICAgIHJldHVybiAnIycgKyAociA8IDE2ID8gJzAnIDogJycpICsgci50b1N0cmluZygxNikgK1xuICAgICAgICAgICAgIChnIDwgMTYgPyAnMCcgOiAnJykgKyBnLnRvU3RyaW5nKDE2KSArXG4gICAgICAgICAgICAgKGIgPCAxNiA/ICcwJyA6ICcnKSArIGIudG9TdHJpbmcoMTYpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gci50b1N0cmluZygpICsgJywnICsgZy50b1N0cmluZygpICsgJywnICsgYi50b1N0cmluZygpO1xuICAgIH1cbiAgfVxuXG4gIGZiLnVucGFjayA9IGZ1bmN0aW9uIChjb2xvcikge1xuICAgIGlmICgoL1xcZCssXFxkKyxcXGQvKS50ZXN0KGNvbG9yKSkge1xuICAgICAgdmFyIG51bXMgPSBjb2xvci5zcGxpdCgvLC8pO1xuICAgICAgcmV0dXJuIFtwYXJzZUludChudW1zWzBdLCAxMCkgLyAyNTUsXG4gICAgICAgIHBhcnNlSW50KG51bXNbMV0sIDEwKSAvIDI1NSxcbiAgICAgICAgcGFyc2VJbnQobnVtc1syXSwgMTApIC8gMjU1XTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29sb3IubGVuZ3RoID09IDcpIHtcbiAgICAgIHJldHVybiBbcGFyc2VJbnQoJzB4JyArIGNvbG9yLnN1YnN0cmluZygxLCAzKSkgLyAyNTUsXG4gICAgICAgIHBhcnNlSW50KCcweCcgKyBjb2xvci5zdWJzdHJpbmcoMywgNSkpIC8gMjU1LFxuICAgICAgICBwYXJzZUludCgnMHgnICsgY29sb3Iuc3Vic3RyaW5nKDUsIDcpKSAvIDI1NV07XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbG9yLmxlbmd0aCA9PSA0KSB7XG4gICAgICByZXR1cm4gW3BhcnNlSW50KCcweCcgKyBjb2xvci5zdWJzdHJpbmcoMSwgMikpIC8gMTUsXG4gICAgICAgIHBhcnNlSW50KCcweCcgKyBjb2xvci5zdWJzdHJpbmcoMiwgMykpIC8gMTUsXG4gICAgICAgIHBhcnNlSW50KCcweCcgKyBjb2xvci5zdWJzdHJpbmcoMywgNCkpIC8gMTVdO1xuICAgIH1cbiAgfVxuXG4gIGZiLkhTTFRvUkdCID0gZnVuY3Rpb24gKGhzbCkge1xuICAgIHZhciBtMSwgbTIsIHIsIGcsIGI7XG4gICAgdmFyIGggPSBoc2xbMF0sIHMgPSBoc2xbMV0sIGwgPSBoc2xbMl07XG4gICAgbTIgPSAobCA8PSAwLjUpID8gbCAqIChzICsgMSkgOiBsICsgcyAtIGwqcztcbiAgICBtMSA9IGwgKiAyIC0gbTI7XG4gICAgcmV0dXJuIFt0aGlzLmh1ZVRvUkdCKG0xLCBtMiwgaCswLjMzMzMzKSxcbiAgICAgICAgdGhpcy5odWVUb1JHQihtMSwgbTIsIGgpLFxuICAgICAgICB0aGlzLmh1ZVRvUkdCKG0xLCBtMiwgaC0wLjMzMzMzKV07XG4gIH1cblxuICBmYi5odWVUb1JHQiA9IGZ1bmN0aW9uIChtMSwgbTIsIGgpIHtcbiAgICBoID0gKGggPCAwKSA/IGggKyAxIDogKChoID4gMSkgPyBoIC0gMSA6IGgpO1xuICAgIGlmIChoICogNiA8IDEpIHJldHVybiBtMSArIChtMiAtIG0xKSAqIGggKiA2O1xuICAgIGlmIChoICogMiA8IDEpIHJldHVybiBtMjtcbiAgICBpZiAoaCAqIDMgPCAyKSByZXR1cm4gbTEgKyAobTIgLSBtMSkgKiAoMC42NjY2NiAtIGgpICogNjtcbiAgICByZXR1cm4gbTE7XG4gIH1cblxuICBmYi5SR0JUb0hTTCA9IGZ1bmN0aW9uIChyZ2IpIHtcbiAgICB2YXIgbWluLCBtYXgsIGRlbHRhLCBoLCBzLCBsO1xuICAgIHZhciByID0gcmdiWzBdLCBnID0gcmdiWzFdLCBiID0gcmdiWzJdO1xuICAgIG1pbiA9IE1hdGgubWluKHIsIE1hdGgubWluKGcsIGIpKTtcbiAgICBtYXggPSBNYXRoLm1heChyLCBNYXRoLm1heChnLCBiKSk7XG4gICAgZGVsdGEgPSBtYXggLSBtaW47XG4gICAgbCA9IChtaW4gKyBtYXgpIC8gMjtcbiAgICBzID0gMDtcbiAgICBpZiAobCA+IDAgJiYgbCA8IDEpIHtcbiAgICAgIHMgPSBkZWx0YSAvIChsIDwgMC41ID8gKDIgKiBsKSA6ICgyIC0gMiAqIGwpKTtcbiAgICB9XG4gICAgaCA9IDA7XG4gICAgaWYgKGRlbHRhID4gMCkge1xuICAgICAgaWYgKG1heCA9PSByICYmIG1heCAhPSBnKSBoICs9IChnIC0gYikgLyBkZWx0YTtcbiAgICAgIGlmIChtYXggPT0gZyAmJiBtYXggIT0gYikgaCArPSAoMiArIChiIC0gcikgLyBkZWx0YSk7XG4gICAgICBpZiAobWF4ID09IGIgJiYgbWF4ICE9IHIpIGggKz0gKDQgKyAociAtIGcpIC8gZGVsdGEpO1xuICAgICAgaCAvPSA2O1xuICAgIH1cbiAgICByZXR1cm4gW2gsIHMsIGxdO1xuICB9XG5cbiAgLy8gSW5zdGFsbCBtb3VzZWRvd24gaGFuZGxlciAodGhlIG90aGVycyBhcmUgc2V0IG9uIHRoZSBkb2N1bWVudCBvbi1kZW1hbmQpXG4gICQoJyonLCBlKS5tb3VzZWRvd24oZmIubW91c2Vkb3duKTtcblxuICAgIC8vIEluaXQgY29sb3JcbiAgZmIuc2V0Q29sb3IoJyMwMDAwMDAnKTtcblxuICAvLyBTZXQgbGlua2VkIGVsZW1lbnRzL2NhbGxiYWNrXG4gIGlmIChjYWxsYmFjaykge1xuICAgIGZiLmxpbmtUbyhjYWxsYmFjayk7XG4gIH1cbn1cblxufTsiLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9IFRoZSBmb2xsb3dpbmcgYXJlIHNob3J0IGpRdWVyeSBleHRlbnNpb25zIHVzZWQgYnkgY2hyb21vem9vbSA9XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oJCkge1xuICBcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMuanMnKSgkKSxcbiAgZmxvb3JIYWNrID0gdXRpbHMuZmxvb3JIYWNrO1xuXG4vLyBNYWtlIGEgdW5pcXVlIElEIGZvciBhbiBhcmJpdGFyeSBlbGVtZW50LCB1c2luZyB0aGUgZ2l2ZW4gcHJlZml4IHN0cmluZ1xuJC51bmlxSWQgPSBmdW5jdGlvbihwcmVmaXgsIGFsc29EaXNhbGxvdykge1xuICB2YXIgcmFuZCA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gZmxvb3JIYWNrKE1hdGgucmFuZG9tKCkqMTAwMDAwMCk7IH07XG4gIHZhciBudW0gPSByYW5kKCk7XG4gIHdoaWxlICgoYWxzb0Rpc2FsbG93ICYmIGFsc29EaXNhbGxvd1tudW1dKSB8fCAkKCcjJytwcmVmaXgrJy0nK251bSkubGVuZ3RoKSB7IG51bSA9IHJhbmQoKTsgfVxuICByZXR1cm4gcHJlZml4KyctJytudW07XG59O1xuXG4vLyBNYWtlIGEgbmV3IGVsZW1lbnQgKGZhc3RlciB0aGFuICQoXCI8ZWxlbS8+XCIpKVxuJC5tayA9IGZ1bmN0aW9uKE5TLCBlbGVtKSB7IFxuICByZXR1cm4gKGVsZW0gJiYgZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKSA/ICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKE5TLCBlbGVtKSkgXG4gICAgOiAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZWxlbSA9IE5TKSk7IFxufVxuXG4vLyBqUXVlcnkgSG90a2V5cyBQbHVnaW4sIGNvcHlyaWdodCAyMDEwLCBKb2huIFJlc2lnXG4vLyBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlc1xuLy8gaHR0cHM6Ly9naXRodWIuY29tL2plcmVzaWcvanF1ZXJ5LmhvdGtleXNcbiQuaG90a2V5cyA9IHtcbiAgdmVyc2lvbjogXCIwLjhcIixcblxuICBzcGVjaWFsS2V5czoge1xuICAgIDg6IFwiYmFja3NwYWNlXCIsIDk6IFwidGFiXCIsIDEzOiBcInJldHVyblwiLCAxNjogXCJzaGlmdFwiLCAxNzogXCJjdHJsXCIsIDE4OiBcImFsdFwiLCAxOTogXCJwYXVzZVwiLFxuICAgIDIwOiBcImNhcHNsb2NrXCIsIDI3OiBcImVzY1wiLCAzMjogXCJzcGFjZVwiLCAzMzogXCJwYWdldXBcIiwgMzQ6IFwicGFnZWRvd25cIiwgMzU6IFwiZW5kXCIsIDM2OiBcImhvbWVcIixcbiAgICAzNzogXCJsZWZ0XCIsIDM4OiBcInVwXCIsIDM5OiBcInJpZ2h0XCIsIDQwOiBcImRvd25cIiwgNDU6IFwiaW5zZXJ0XCIsIDQ2OiBcImRlbFwiLCBcbiAgICA5NjogXCIwXCIsIDk3OiBcIjFcIiwgOTg6IFwiMlwiLCA5OTogXCIzXCIsIDEwMDogXCI0XCIsIDEwMTogXCI1XCIsIDEwMjogXCI2XCIsIDEwMzogXCI3XCIsXG4gICAgMTA0OiBcIjhcIiwgMTA1OiBcIjlcIiwgMTA2OiBcIipcIiwgMTA3OiBcIitcIiwgMTA5OiBcIi1cIiwgMTEwOiBcIi5cIiwgMTExIDogXCIvXCIsIFxuICAgIDExMjogXCJmMVwiLCAxMTM6IFwiZjJcIiwgMTE0OiBcImYzXCIsIDExNTogXCJmNFwiLCAxMTY6IFwiZjVcIiwgMTE3OiBcImY2XCIsIDExODogXCJmN1wiLCAxMTk6IFwiZjhcIiwgXG4gICAgMTIwOiBcImY5XCIsIDEyMTogXCJmMTBcIiwgMTIyOiBcImYxMVwiLCAxMjM6IFwiZjEyXCIsIDE0NDogXCJudW1sb2NrXCIsIDE0NTogXCJzY3JvbGxcIiwgMTkxOiBcIi9cIiwgMjI0OiBcIm1ldGFcIlxuICB9LFxuXG4gIHNoaWZ0TnVtczoge1xuICAgIFwiYFwiOiBcIn5cIiwgXCIxXCI6IFwiIVwiLCBcIjJcIjogXCJAXCIsIFwiM1wiOiBcIiNcIiwgXCI0XCI6IFwiJFwiLCBcIjVcIjogXCIlXCIsIFwiNlwiOiBcIl5cIiwgXCI3XCI6IFwiJlwiLCBcbiAgICBcIjhcIjogXCIqXCIsIFwiOVwiOiBcIihcIiwgXCIwXCI6IFwiKVwiLCBcIi1cIjogXCJfXCIsIFwiPVwiOiBcIitcIiwgXCI7XCI6IFwiOiBcIiwgXCInXCI6IFwiXFxcIlwiLCBcIixcIjogXCI8XCIsIFxuICAgIFwiLlwiOiBcIj5cIiwgIFwiL1wiOiBcIj9cIiwgIFwiXFxcXFwiOiBcInxcIlxuICB9XG59O1xuXG5mdW5jdGlvbiBrZXlIYW5kbGVyKCBoYW5kbGVPYmogKSB7XG4gIC8vIE9ubHkgY2FyZSB3aGVuIGEgcG9zc2libGUgaW5wdXQgaGFzIGJlZW4gc3BlY2lmaWVkXG4gIGlmICggdHlwZW9mIGhhbmRsZU9iai5kYXRhICE9PSBcInN0cmluZ1wiICkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBvcmlnSGFuZGxlciA9IGhhbmRsZU9iai5oYW5kbGVyLFxuICAgIGtleXMgPSBoYW5kbGVPYmouZGF0YS50b0xvd2VyQ2FzZSgpLnNwbGl0KFwiIFwiKTtcblxuICBoYW5kbGVPYmouaGFuZGxlciA9IGZ1bmN0aW9uKCBldmVudCApIHtcbiAgICAvLyBEb24ndCBmaXJlIGluIHRleHQtYWNjZXB0aW5nIGlucHV0cyB0aGF0IHdlIGRpZG4ndCBkaXJlY3RseSBiaW5kIHRvXG4gICAgaWYgKCB0aGlzICE9PSBldmVudC50YXJnZXQgJiYgKC90ZXh0YXJlYXxzZWxlY3QvaS50ZXN0KCBldmVudC50YXJnZXQubm9kZU5hbWUgKSB8fFxuICAgICAgZXZlbnQudGFyZ2V0LnR5cGUgPT09IFwidGV4dFwiIHx8IGV2ZW50LnRhcmdldC50eXBlID09IFwic2VhcmNoXCIgfHwgZXZlbnQudGFyZ2V0LnR5cGUgPT09IFwidXJsXCIpICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEtleXByZXNzIHJlcHJlc2VudHMgY2hhcmFjdGVycywgbm90IHNwZWNpYWwga2V5c1xuICAgIHZhciBzcGVjaWFsID0gZXZlbnQudHlwZSAhPT0gXCJrZXlwcmVzc1wiICYmICQuaG90a2V5cy5zcGVjaWFsS2V5c1sgZXZlbnQud2hpY2ggXSxcbiAgICAgIGNoYXJhY3RlciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoIGV2ZW50LndoaWNoICkudG9Mb3dlckNhc2UoKSxcbiAgICAgIGtleSwgbW9kaWYgPSBcIlwiLCBwb3NzaWJsZSA9IHt9O1xuXG4gICAgLy8gY2hlY2sgY29tYmluYXRpb25zIChhbHR8Y3RybHxzaGlmdCthbnl0aGluZylcbiAgICBpZiAoIGV2ZW50LmFsdEtleSAmJiBzcGVjaWFsICE9PSBcImFsdFwiICkge1xuICAgICAgbW9kaWYgKz0gXCJhbHQrXCI7XG4gICAgfVxuXG4gICAgaWYgKCBldmVudC5jdHJsS2V5ICYmIHNwZWNpYWwgIT09IFwiY3RybFwiICkge1xuICAgICAgbW9kaWYgKz0gXCJjdHJsK1wiO1xuICAgIH1cblxuICAgIC8vIFRPRE86IE5lZWQgdG8gbWFrZSBzdXJlIHRoaXMgd29ya3MgY29uc2lzdGVudGx5IGFjcm9zcyBwbGF0Zm9ybXNcbiAgICBpZiAoIGV2ZW50Lm1ldGFLZXkgJiYgIWV2ZW50LmN0cmxLZXkgJiYgc3BlY2lhbCAhPT0gXCJtZXRhXCIgKSB7XG4gICAgICBtb2RpZiArPSBcIm1ldGErXCI7XG4gICAgfVxuXG4gICAgaWYgKCBldmVudC5zaGlmdEtleSAmJiBzcGVjaWFsICE9PSBcInNoaWZ0XCIgKSB7XG4gICAgICBtb2RpZiArPSBcInNoaWZ0K1wiO1xuICAgIH1cblxuICAgIGlmICggc3BlY2lhbCApIHtcbiAgICAgIHBvc3NpYmxlWyBtb2RpZiArIHNwZWNpYWwgXSA9IHRydWU7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgcG9zc2libGVbIG1vZGlmICsgY2hhcmFjdGVyIF0gPSB0cnVlO1xuICAgICAgcG9zc2libGVbIG1vZGlmICsgJC5ob3RrZXlzLnNoaWZ0TnVtc1sgY2hhcmFjdGVyIF0gXSA9IHRydWU7XG5cbiAgICAgIC8vIFwiJFwiIGNhbiBiZSB0cmlnZ2VyZWQgYXMgXCJTaGlmdCs0XCIgb3IgXCJTaGlmdCskXCIgb3IganVzdCBcIiRcIlxuICAgICAgaWYgKCBtb2RpZiA9PT0gXCJzaGlmdCtcIiApIHtcbiAgICAgICAgcG9zc2libGVbICQuaG90a2V5cy5zaGlmdE51bXNbIGNoYXJhY3RlciBdIF0gPSB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAoIHZhciBpID0gMCwgbCA9IGtleXMubGVuZ3RoOyBpIDwgbDsgaSsrICkge1xuICAgICAgaWYgKCBwb3NzaWJsZVsga2V5c1tpXSBdICkge1xuICAgICAgICByZXR1cm4gb3JpZ0hhbmRsZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn1cblxuJC5lYWNoKFsgXCJrZXlkb3duXCIsIFwia2V5dXBcIiwgXCJrZXlwcmVzc1wiIF0sIGZ1bmN0aW9uKCkge1xuICAkLmV2ZW50LnNwZWNpYWxbIHRoaXMgXSA9IHsgYWRkOiBrZXlIYW5kbGVyIH07XG59KTtcblxuLy8galF1ZXJ5IHNvcnRFbGVtZW50cyBieSBKYW1lcyBQYWRvbHNleSwgZHVhbCBsaWNlbnNlZCBNSVQvR1BMXG4vLyBGb3VuZCBhdCBodHRwczovL2dpdGh1Yi5jb20vcGFkb2xzZXkvalF1ZXJ5LVBsdWdpbnMvdHJlZS9tYXN0ZXIvc29ydEVsZW1lbnRzL1xuJC5mbi5zb3J0RWxlbWVudHMgPSAoZnVuY3Rpb24oKXtcbiAgdmFyIHNvcnQgPSBbXS5zb3J0O1xuICByZXR1cm4gZnVuY3Rpb24oY29tcGFyYXRvciwgZ2V0U29ydGFibGUpIHtcbiAgICBnZXRTb3J0YWJsZSA9IGdldFNvcnRhYmxlIHx8IGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXM7fTtcbiAgICB2YXIgcGxhY2VtZW50cyA9IHRoaXMubWFwKGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgc29ydEVsZW1lbnQgPSBnZXRTb3J0YWJsZS5jYWxsKHRoaXMpLFxuICAgICAgICBwYXJlbnROb2RlID0gc29ydEVsZW1lbnQucGFyZW50Tm9kZSxcbiAgICAgICAgLy8gU2luY2UgdGhlIGVsZW1lbnQgaXRzZWxmIHdpbGwgY2hhbmdlIHBvc2l0aW9uLCB3ZSBoYXZlXG4gICAgICAgIC8vIHRvIGhhdmUgc29tZSB3YXkgb2Ygc3RvcmluZyBpdHMgb3JpZ2luYWwgcG9zaXRpb24gaW5cbiAgICAgICAgLy8gdGhlIERPTS4gVGhlIGVhc2llc3Qgd2F5IGlzIHRvIGhhdmUgYSAnZmxhZycgbm9kZTpcbiAgICAgICAgbmV4dFNpYmxpbmcgPSBwYXJlbnROb2RlLmluc2VydEJlZm9yZShcbiAgICAgICAgICBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyksXG4gICAgICAgICAgc29ydEVsZW1lbnQubmV4dFNpYmxpbmdcbiAgICAgICAgKTtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHBhcmVudE5vZGUgPT09IHRoaXMpIHtcbiAgICAgICAgICB0aHJvdyBcIllvdSBjYW4ndCBzb3J0IGVsZW1lbnRzIGlmIGFueSBvbmUgaXMgYSBkZXNjZW5kYW50IG9mIGFub3RoZXIuXCI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSW5zZXJ0IGJlZm9yZSBmbGFnOlxuICAgICAgICBwYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLCBuZXh0U2libGluZyk7XG4gICAgICAgIC8vIFJlbW92ZSBmbGFnOlxuICAgICAgICBwYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5leHRTaWJsaW5nKTtcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICByZXR1cm4gc29ydC5jYWxsKHRoaXMsIGNvbXBhcmF0b3IpLmVhY2goZnVuY3Rpb24oaSl7XG4gICAgICBwbGFjZW1lbnRzW2ldLmNhbGwoZ2V0U29ydGFibGUuY2FsbCh0aGlzKSk7XG4gICAgfSk7XG4gIH07XG59KSgpO1xuXG4vLyBqUXVlcnkgQ29va2llIFBsdWdpbiwgZm91bmQgYXQgaHR0cHM6Ly9naXRodWIuY29tL2NhcmhhcnRsL2pxdWVyeS1jb29raWVcbi8vIENvcHlyaWdodCAyMDExLCBLbGF1cyBIYXJ0bFxuLy8gRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4oZnVuY3Rpb24oJCkge1xuICAkLmNvb2tpZSA9IGZ1bmN0aW9uKGtleSwgdmFsdWUsIG9wdGlvbnMpIHtcbiAgICAvLyBrZXkgYW5kIGF0IGxlYXN0IHZhbHVlIGdpdmVuLCBzZXQgY29va2llLi4uXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxICYmICghL09iamVjdC8udGVzdChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpKSB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSkge1xuICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTtcblxuICAgICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgb3B0aW9ucy5leHBpcmVzID0gLTE7XG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5leHBpcmVzID09PSAnbnVtYmVyJykge1xuICAgICAgICB2YXIgZGF5cyA9IG9wdGlvbnMuZXhwaXJlcywgdCA9IG9wdGlvbnMuZXhwaXJlcyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHQuc2V0RGF0ZSh0LmdldERhdGUoKSArIGRheXMpO1xuICAgICAgfVxuXG4gICAgICB2YWx1ZSA9IFN0cmluZyh2YWx1ZSk7XG5cbiAgICAgIHJldHVybiAoZG9jdW1lbnQuY29va2llID0gW1xuICAgICAgICBlbmNvZGVVUklDb21wb25lbnQoa2V5KSwgJz0nLCBvcHRpb25zLnJhdyA/IHZhbHVlIDogZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSxcbiAgICAgICAgLy8gdXNlIGV4cGlyZXMgYXR0cmlidXRlLCBtYXgtYWdlIGlzIG5vdCBzdXBwb3J0ZWQgYnkgSUVcbiAgICAgICAgb3B0aW9ucy5leHBpcmVzID8gJzsgZXhwaXJlcz0nICsgb3B0aW9ucy5leHBpcmVzLnRvVVRDU3RyaW5nKCkgOiAnJyxcbiAgICAgICAgb3B0aW9ucy5wYXRoICAgID8gJzsgcGF0aD0nICsgb3B0aW9ucy5wYXRoIDogJycsXG4gICAgICAgIG9wdGlvbnMuZG9tYWluICA/ICc7IGRvbWFpbj0nICsgb3B0aW9ucy5kb21haW4gOiAnJyxcbiAgICAgICAgb3B0aW9ucy5zZWN1cmUgID8gJzsgc2VjdXJlJyA6ICcnXG4gICAgICBdLmpvaW4oJycpKTtcbiAgICB9XG5cbiAgICAvLyBrZXkgYW5kIHBvc3NpYmx5IG9wdGlvbnMgZ2l2ZW4sIGdldCBjb29raWUuLi5cbiAgICBvcHRpb25zID0gdmFsdWUgfHwge307XG4gICAgdmFyIGRlY29kZSA9IG9wdGlvbnMucmF3ID8gZnVuY3Rpb24ocykgeyByZXR1cm4gczsgfSA6IGRlY29kZVVSSUNvbXBvbmVudDtcblxuICAgIHZhciBwYWlycyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOyAnKTtcbiAgICBmb3IgKHZhciBpID0gMCwgcGFpcjsgcGFpciA9IHBhaXJzW2ldICYmIHBhaXJzW2ldLnNwbGl0KCc9Jyk7IGkrKykge1xuICAgICAgLy8gSUUgc2F2ZXMgY29va2llcyB3aXRoIGVtcHR5IHN0cmluZyBhcyBcImM7IFwiLCBlLmcuIHdpdGhvdXQgXCI9XCIgYXMgb3Bwb3NlZCB0byBFT01CLCB0aHVzIHBhaXJbMV0gbWF5IGJlIHVuZGVmaW5lZFxuICAgICAgaWYgKGRlY29kZShwYWlyWzBdKSA9PT0ga2V5KSByZXR1cm4gZGVjb2RlKHBhaXJbMV0gfHwgJycpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcbn0pKCQpO1xuXG4vLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzkwMTExNS9nZXQtcXVlcnktc3RyaW5nLXZhbHVlcy1pbi1qYXZhc2NyaXB0XG4kLnVybFBhcmFtcyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgcCA9IHt9LFxuICAgIGUsXG4gICAgYSA9IC9cXCsvZywgIC8vIFJlZ2V4IGZvciByZXBsYWNpbmcgYWRkaXRpb24gc3ltYm9sIHdpdGggYSBzcGFjZVxuICAgIHIgPSAvKFteJj1dKyk9PyhbXiZdKikvZyxcbiAgICBkID0gZnVuY3Rpb24gKHMpIHsgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzLnJlcGxhY2UoYSwgXCIgXCIpKTsgfSxcbiAgICBxID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7XG5cbiAgd2hpbGUgKGUgPSByLmV4ZWMocSkpIHsgXG4gICAgdmFyIGsgPSBkKGVbMV0pLCB2ID0gZChlWzJdKTsgXG4gICAgcFtrXSA9IHBba10gPyAoXy5pc0FycmF5KHBba10pID8gcFtrXS5wdXNoKHYpIDogW3Bba10sIHZdKSA6IHY7IFxuICB9XG4gIHJldHVybiBwO1xufTtcblxufTsiLCIgLypcbiAqIFRpcFRpcFxuICogQ29weXJpZ2h0IDIwMTAgRHJldyBXaWxzb25cbiAqIHd3dy5kcmV3d2lsc29uLmNvbVxuICogY29kZS5kcmV3d2lsc29uLmNvbS9lbnRyeS90aXB0aXAtanF1ZXJ5LXBsdWdpblxuICpcbiAqIFZlcnNpb24gMS4zICAgLSAgIFVwZGF0ZWQ6IE1hci4gMjMsIDIwMTBcbiAqXG4gKiBUaGlzIFBsdWctSW4gd2lsbCBjcmVhdGUgYSBjdXN0b20gdG9vbHRpcCB0byByZXBsYWNlIHRoZSBkZWZhdWx0XG4gKiBicm93c2VyIHRvb2x0aXAuIEl0IGlzIGV4dHJlbWVseSBsaWdodHdlaWdodCBhbmQgdmVyeSBzbWFydCBpblxuICogdGhhdCBpdCBkZXRlY3RzIHRoZSBlZGdlcyBvZiB0aGUgYnJvd3NlciB3aW5kb3cgYW5kIHdpbGwgbWFrZSBzdXJlXG4gKiB0aGUgdG9vbHRpcCBzdGF5cyB3aXRoaW4gdGhlIGN1cnJlbnQgd2luZG93IHNpemUuIEFzIGEgcmVzdWx0IHRoZVxuICogdG9vbHRpcCB3aWxsIGFkanVzdCBpdHNlbGYgdG8gYmUgZGlzcGxheWVkIGFib3ZlLCBiZWxvdywgdG8gdGhlIGxlZnQgXG4gKiBvciB0byB0aGUgcmlnaHQgZGVwZW5kaW5nIG9uIHdoYXQgaXMgbmVjZXNzYXJ5IHRvIHN0YXkgd2l0aGluIHRoZVxuICogYnJvd3NlciB3aW5kb3cuIEl0IGlzIGNvbXBsZXRlbHkgY3VzdG9taXphYmxlIGFzIHdlbGwgdmlhIENTUy5cbiAqXG4gKiBUaGlzIFRpcFRpcCBqUXVlcnkgcGx1Zy1pbiBpcyBkdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlczpcbiAqICAgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHBcbiAqICAgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC5odG1sXG4gKi9cblxudmFyIF8gPSByZXF1aXJlKCcuLi91bmRlcnNjb3JlLm1pbi5qcycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCQpe1xuICAgIFxuICB2YXIgZGVmYXVsdHMgPSB7IFxuICAgIGFjdGl2YXRpb246IFwiaG92ZXJcIixcbiAgICBrZWVwQWxpdmU6IGZhbHNlLFxuICAgIGVkZ2VPZmZzZXQ6IDMsXG4gICAgZGVmYXVsdFBvc2l0aW9uOiBcImJvdHRvbVwiLFxuICAgIGRlbGF5OiA0MDAsXG4gICAgZmFkZUluOiAyMDAsXG4gICAgZmFkZU91dDogMjAwLFxuICAgIGF0dHJpYnV0ZTogXCJ0aXRsZVwiLFxuICAgIGNvbnRlbnQ6IGZhbHNlLCAvLyBIVE1MIG9yIFN0cmluZyB0byBmaWxsIFRpcFRJcCB3aXRoXG4gICAgZW50ZXI6IGZ1bmN0aW9uKCl7fSxcbiAgICBhc3luYzogZmFsc2UsXG4gICAgc3RhcnRBY3RpdmF0ZWQ6IGZhbHNlXG4gIH07XG4gIHZhciAkdGlwdGlwX2hvbGRlciwgJHRpcHRpcF9jb250ZW50LCAkdGlwdGlwX2Fycm93LCBhY3RpdmF0aW5nX2VsZW07XG4gIFxuICBmdW5jdGlvbiBzaG93X3RpcHRpcChvcHRzKSB7IFxuICAgICR0aXB0aXBfaG9sZGVyLnN0b3AodHJ1ZSwgdHJ1ZSkuZmFkZUluKG9wdHMuZmFkZUluKTtcbiAgICBpZiAob3B0cy5hc3luYyAmJiAhJCh0aGlzKS5kYXRhKCd0aXB0aXBBY3RpdmUnKSkgeyByZXR1cm47IH1cbiAgICBcbiAgfTtcbiAgXG4gIGZ1bmN0aW9uIGZpbGxfc2hvd190aXB0aXAoZCwgc2VsZiwgY29udGVudCkge1xuICAgIHZhciBvcHRzID0gZC5vcHRzLFxuICAgICAgJG9yZ19lbGVtID0gZC5vcmdfZWxlbSxcbiAgICAgIG9yZ190aXRsZSA9IGNvbnRlbnQgPyBjb250ZW50IDogZC5vcmdfdGl0bGUsXG4gICAgICB0aW1lb3V0ID0gJChzZWxmKS5kYXRhKCd0aXB0aXBUaW1lb3V0JyksXG4gICAgICBhY3RpdmUgPSAkKHNlbGYpLmRhdGEoJ3RpcHRpcEFjdGl2ZScpLFxuICAgICAgZmlyZWRBZnRlciA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpIC0gYWN0aXZlO1xuICAgICAgXG4gICAgaWYgKG9wdHMuYXN5bmMpIHtcbiAgICAgIGlmICghYWN0aXZlKSB7IHJldHVybjsgfVxuICAgICAgaWYgKGNvbnRlbnQgPT09IGZhbHNlKSB7ICQodGhpcykuZGF0YSgndGlwdGlwQWN0aXZlJywgZmFsc2UpOyByZXR1cm47IH1cbiAgICB9XG4gICAgXG4gICAgaWYgKF8uaXNTdHJpbmcob3JnX3RpdGxlKSkgeyAkdGlwdGlwX2NvbnRlbnQuaHRtbChvcmdfdGl0bGUpOyB9XG4gICAgZWxzZSB7ICR0aXB0aXBfY29udGVudC5lbXB0eSgpLmFwcGVuZChvcmdfdGl0bGUpOyB9XG4gICAgJHRpcHRpcF9ob2xkZXIucmVtb3ZlQXR0cihcImNsYXNzXCIpLmNzcyhcIm1hcmdpblwiLCAwKTtcbiAgICAkdGlwdGlwX2Fycm93LnJlbW92ZUF0dHIoXCJzdHlsZVwiKTtcblxuICAgIHZhciBvZmZzZXQgPSAkb3JnX2VsZW0ub2Zmc2V0KCksXG4gICAgICB0b3AgPSBvZmZzZXQudG9wLFxuICAgICAgbGVmdCA9IG9mZnNldC5sZWZ0LFxuICAgICAgc2Nyb2xsX3RvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKSxcbiAgICAgIHNjcm9sbF9sZWZ0ID0gJCh3aW5kb3cpLnNjcm9sbExlZnQoKSxcbiAgICAgIHdpbl93aWR0aCA9ICQod2luZG93KS53aWR0aCgpLFxuICAgICAgd2luX2hlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKSxcbiAgICAgIG9yZ193aWR0aCA9ICRvcmdfZWxlbS5vdXRlcldpZHRoKCksXG4gICAgICBvcmdfaGVpZ2h0ID0gJG9yZ19lbGVtLm91dGVySGVpZ2h0KCk7XG5cbiAgICBpZiAobGVmdCAtIHNjcm9sbF9sZWZ0ID49IDApIHsgb3JnX3dpZHRoID0gTWF0aC5taW4ob3JnX3dpZHRoLCB3aW5fd2lkdGggLSAobGVmdCAtIHNjcm9sbF9sZWZ0KSk7IH1cbiAgICBlbHNlIHsgb3JnX3dpZHRoICs9IChsZWZ0IC0gc2Nyb2xsX2xlZnQpOyBsZWZ0ID0gc2Nyb2xsX2xlZnQ7IH1cbiAgICBcbiAgICB2YXIgdGlwX3cgPSAkdGlwdGlwX2hvbGRlci5vdXRlcldpZHRoKCksXG4gICAgICB0aXBfaCA9ICR0aXB0aXBfaG9sZGVyLm91dGVySGVpZ2h0KCksXG4gICAgICB3X2NvbXBhcmUgPSBNYXRoLnJvdW5kKChvcmdfd2lkdGggLSB0aXBfdykgLyAyKSxcbiAgICAgIGhfY29tcGFyZSA9IE1hdGgucm91bmQoKG9yZ19oZWlnaHQgLSB0aXBfaCkgLyAyKSxcbiAgICAgIG1hcmdfbGVmdCA9IE1hdGgucm91bmQobGVmdCArIHdfY29tcGFyZSksXG4gICAgICBtYXJnX3RvcCA9IE1hdGgucm91bmQodG9wICsgb3JnX2hlaWdodCArIG9wdHMuZWRnZU9mZnNldCksXG4gICAgICB0X2NsYXNzID0gXCJcIixcbiAgICAgIGFycm93X3RvcCA9IFwiXCIsXG4gICAgICBhcnJvd19sZWZ0ID0gTWF0aC5yb3VuZCh0aXBfdyAtIDEyKSAvIDI7XG5cbiAgICB0X2NsYXNzID0gXCJfXCIgKyBvcHRzLmRlZmF1bHRQb3NpdGlvbjtcblxuICAgIHZhciByaWdodF9jb21wYXJlID0gKHdfY29tcGFyZSArIGxlZnQpIDwgc2Nyb2xsX2xlZnQsXG4gICAgICBsZWZ0X2NvbXBhcmUgPSAodGlwX3cgKyBsZWZ0KSA+IHdpbl93aWR0aDtcblxuICAgIGlmICgocmlnaHRfY29tcGFyZSAmJiB3X2NvbXBhcmUgPCAwKSB8fCAodF9jbGFzcyA9PSBcIl9yaWdodFwiICYmICFsZWZ0X2NvbXBhcmUpIFxuICAgICAgICB8fCAodF9jbGFzcyA9PSBcIl9sZWZ0XCIgJiYgbGVmdCA8ICh0aXBfdyArIG9wdHMuZWRnZU9mZnNldCArIDUpKSkge1xuICAgICAgdF9jbGFzcyA9IFwiX3JpZ2h0XCI7XG4gICAgICBhcnJvd190b3AgPSBNYXRoLnJvdW5kKHRpcF9oIC0gMTMpIC8gMjtcbiAgICAgIGFycm93X2xlZnQgPSAtMTI7XG4gICAgICBtYXJnX2xlZnQgPSBNYXRoLnJvdW5kKGxlZnQgKyBvcmdfd2lkdGggKyBvcHRzLmVkZ2VPZmZzZXQpO1xuICAgICAgbWFyZ190b3AgPSBNYXRoLnJvdW5kKHRvcCArIGhfY29tcGFyZSk7XG4gICAgfSBlbHNlIGlmKChsZWZ0X2NvbXBhcmUgJiYgd19jb21wYXJlIDwgMCkgfHwgKHRfY2xhc3MgPT0gXCJfbGVmdFwiICYmICFyaWdodF9jb21wYXJlKSl7XG4gICAgICB0X2NsYXNzID0gXCJfbGVmdFwiO1xuICAgICAgYXJyb3dfdG9wID0gTWF0aC5yb3VuZCh0aXBfaCAtIDEzKSAvIDI7XG4gICAgICBhcnJvd19sZWZ0ID0gIE1hdGgucm91bmQodGlwX3cpO1xuICAgICAgbWFyZ19sZWZ0ID0gTWF0aC5yb3VuZChsZWZ0IC0gKHRpcF93ICsgb3B0cy5lZGdlT2Zmc2V0ICsgNSkpO1xuICAgICAgbWFyZ190b3AgPSBNYXRoLnJvdW5kKHRvcCArIGhfY29tcGFyZSk7XG4gICAgfVxuXG4gICAgdmFyIHRvcF9jb21wYXJlID0gKHRvcCArIG9yZ19oZWlnaHQgKyBvcHRzLmVkZ2VPZmZzZXQgKyB0aXBfaCArIDgpID4gd2luX2hlaWdodCArIHNjcm9sbF90b3AsXG4gICAgICBib3R0b21fY29tcGFyZSA9ICgodG9wICsgb3JnX2hlaWdodCkgLSAob3B0cy5lZGdlT2Zmc2V0ICsgdGlwX2ggKyA4KSkgPCAwO1xuXG4gICAgaWYodG9wX2NvbXBhcmUgfHwgKHRfY2xhc3MgPT0gXCJfYm90dG9tXCIgJiYgdG9wX2NvbXBhcmUpIHx8ICh0X2NsYXNzID09IFwiX3RvcFwiICYmICFib3R0b21fY29tcGFyZSkpe1xuICAgICAgaWYodF9jbGFzcyA9PSBcIl90b3BcIiB8fCB0X2NsYXNzID09IFwiX2JvdHRvbVwiKXtcbiAgICAgICAgdF9jbGFzcyA9IFwiX3RvcFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdF9jbGFzcyA9IHRfY2xhc3MrXCJfdG9wXCI7XG4gICAgICB9XG4gICAgICBhcnJvd190b3AgPSB0aXBfaDtcbiAgICAgIG1hcmdfdG9wID0gTWF0aC5yb3VuZCh0b3AgLSAodGlwX2ggKyA1ICsgb3B0cy5lZGdlT2Zmc2V0KSk7XG4gICAgfSBlbHNlIGlmKGJvdHRvbV9jb21wYXJlIHwgKHRfY2xhc3MgPT0gXCJfdG9wXCIgJiYgYm90dG9tX2NvbXBhcmUpIHx8ICh0X2NsYXNzID09IFwiX2JvdHRvbVwiICYmICF0b3BfY29tcGFyZSkpe1xuICAgICAgaWYodF9jbGFzcyA9PSBcIl90b3BcIiB8fCB0X2NsYXNzID09IFwiX2JvdHRvbVwiKXtcbiAgICAgICAgdF9jbGFzcyA9IFwiX2JvdHRvbVwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdF9jbGFzcyA9IHRfY2xhc3MrXCJfYm90dG9tXCI7XG4gICAgICB9XG4gICAgICBhcnJvd190b3AgPSAtMTI7ICAgICAgICAgICAgXG4gICAgICBtYXJnX3RvcCA9IE1hdGgucm91bmQodG9wICsgb3JnX2hlaWdodCArIG9wdHMuZWRnZU9mZnNldCk7XG4gICAgfVxuXG4gICAgaWYodF9jbGFzcyA9PSBcIl9yaWdodF90b3BcIiB8fCB0X2NsYXNzID09IFwiX2xlZnRfdG9wXCIpe1xuICAgICAgbWFyZ190b3AgPSBtYXJnX3RvcCArIDU7XG4gICAgfSBlbHNlIGlmKHRfY2xhc3MgPT0gXCJfcmlnaHRfYm90dG9tXCIgfHwgdF9jbGFzcyA9PSBcIl9sZWZ0X2JvdHRvbVwiKXsgICBcbiAgICAgIG1hcmdfdG9wID0gbWFyZ190b3AgLSA1O1xuICAgIH1cbiAgICBpZih0X2NsYXNzID09IFwiX2xlZnRfdG9wXCIgfHwgdF9jbGFzcyA9PSBcIl9sZWZ0X2JvdHRvbVwiKXsgIFxuICAgICAgbWFyZ19sZWZ0ID0gbWFyZ19sZWZ0ICsgNTtcbiAgICB9XG4gICAgJHRpcHRpcF9hcnJvdy5jc3Moe1wibWFyZ2luLWxlZnRcIjogYXJyb3dfbGVmdCtcInB4XCIsIFwibWFyZ2luLXRvcFwiOiBhcnJvd190b3ArXCJweFwifSk7XG4gICAgJHRpcHRpcF9ob2xkZXIuY3NzKHtcIm1hcmdpbi1sZWZ0XCI6IG1hcmdfbGVmdCtcInB4XCIsIFwibWFyZ2luLXRvcFwiOiBtYXJnX3RvcCtcInB4XCJ9KS5hdHRyKFwiY2xhc3NcIiwgXCJ0aXBcIit0X2NsYXNzKTtcblxuICAgIGlmICh0aW1lb3V0KSB7IGNsZWFyVGltZW91dCh0aW1lb3V0KTsgfVxuICAgIGlmIChmaXJlZEFmdGVyID4gb3B0cy5kZWxheSkgeyBzaG93X3RpcHRpcChvcHRzKTsgfSBcbiAgICBlbHNlIHsgJChzZWxmKS5kYXRhKCd0aXB0aXBUaW1lb3V0Jywgc2V0VGltZW91dChfLmJpbmQoc2hvd190aXB0aXAsIHNlbGYsIG9wdHMpLCBvcHRzLmRlbGF5IC0gZmlyZWRBZnRlcikpOyB9XG4gIH1cblxuICBmdW5jdGlvbiBhY3RpdmVfdGlwdGlwKGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBkID0gZS5kYXRhLFxuICAgICAgY29udGVudDtcbiAgICAkKHRoaXMpLmRhdGEoJ3RpcHRpcEFjdGl2ZScsIChuZXcgRGF0ZSkuZ2V0VGltZSgpKTtcbiAgICBpZiAoYWN0aXZhdGluZ19lbGVtICYmIGFjdGl2YXRpbmdfZWxlbSAhPSBzZWxmKSB7ICQudGlwVGlwLmhpZGUoKTsgfVxuICAgIGFjdGl2YXRpbmdfZWxlbSA9IHNlbGY7XG4gICAgaWYgKGQub3B0cy5hc3luYykgeyBkLm9wdHMuZW50ZXIuY2FsbCh0aGlzLCBmdW5jdGlvbihuZXdDb250ZW50KSB7IGZpbGxfc2hvd190aXB0aXAoZCwgc2VsZiwgbmV3Q29udGVudCk7IH0pOyB9XG4gICAgZWxzZSB7XG4gICAgICBjb250ZW50ID0gZC5vcHRzLmVudGVyLmNhbGwodGhpcyk7XG4gICAgICBmaWxsX3Nob3dfdGlwdGlwKGQsIHRoaXMsIGNvbnRlbnQpOyBcbiAgICB9XG4gICAgcmV0dXJuIGQucmV0RmFsc2UgPyBmYWxzZSA6IG51bGw7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGRlYWN0aXZlX3RpcHRpcChlLCBub3cpIHtcbiAgICB2YXIgZCA9IGUuZGF0YSxcbiAgICAgIHRpbWVvdXQgPSAkKHRoaXMpLmRhdGEoJ3RpcHRpcFRpbWVvdXQnKTtcbiAgICAkKHRoaXMpLmRhdGEoJ3RpcHRpcEFjdGl2ZScsIGZhbHNlKTtcbiAgICBpZiAodGltZW91dCl7IGNsZWFyVGltZW91dCh0aW1lb3V0KTsgfVxuICAgIGFjdGl2YXRpbmdfZWxlbSA9IG51bGw7XG4gICAgJHRpcHRpcF9ob2xkZXIuZmFkZU91dChub3cgPyBkLm9wdHMuZmFkZU91dCA6IDApO1xuICB9XG4gIFxuICAkLnRpcFRpcCA9IHtcbiAgICBoaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciAkYWN0aXZlID0gJChhY3RpdmF0aW5nX2VsZW0pO1xuICAgICAgaWYgKCRhY3RpdmUucGFyZW50KCkubGVuZ3RoID4gMCkgeyAkYWN0aXZlLnRyaWdnZXIoJ2hpZGVUaXBUaXAnKTsgfSBcbiAgICAgIGVsc2UgeyAkdGlwdGlwX2hvbGRlciAmJiAkdGlwdGlwX2hvbGRlci5oaWRlKCk7IH1cbiAgICAgIGFjdGl2YXRpbmdfZWxlbSA9IG51bGw7XG4gICAgfVxuICB9O1xuICBcbiAgJC5mbi50aXBUaXAgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgdmFyIG9wdHMgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIG9wdGlvbnMpO1xuICAgIFxuICAgIC8vIFNldHVwIHRpcCB0aXAgZWxlbWVudHMgYW5kIHJlbmRlciB0aGVtIHRvIHRoZSBET00sIGlmIHRoaXMgd2Fzbid0IGFscmVhZHkgZG9uZSBwcmV2aW91c2x5XG4gICAgaWYodHlwZW9mICR0aXB0aXBfaG9sZGVyID09ICd1bmRlZmluZWQnKXtcbiAgICAgICR0aXB0aXBfaG9sZGVyID0gJCgnPGRpdiBpZD1cInRpcHRpcF9ob2xkZXJcIj48L2Rpdj4nKTtcbiAgICAgICR0aXB0aXBfY29udGVudCA9ICQoJzxkaXYgaWQ9XCJ0aXB0aXBfY29udGVudFwiPjwvZGl2PicpO1xuICAgICAgJHRpcHRpcF9hcnJvdyA9ICQoJzxkaXYgaWQ9XCJ0aXB0aXBfYXJyb3dcIj48L2Rpdj4nKTtcbiAgICAgICQoXCJib2R5XCIpLmFwcGVuZCgkdGlwdGlwX2hvbGRlci5odG1sKCR0aXB0aXBfY29udGVudCkucHJlcGVuZCgkdGlwdGlwX2Fycm93Lmh0bWwoJzxkaXYgaWQ9XCJ0aXB0aXBfYXJyb3dfaW5uZXJcIj48L2Rpdj4nKSkpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgJG9yZ19lbGVtID0gJCh0aGlzKTtcbiAgICAgIFxuICAgICAgaWYgKG9wdHMuY29udGVudCkge1xuICAgICAgICB2YXIgb3JnX3RpdGxlID0gb3B0cy5jb250ZW50O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG9yZ190aXRsZSA9ICRvcmdfZWxlbS5hdHRyKG9wdHMuYXR0cmlidXRlKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKG9yZ190aXRsZSAhPSBcIlwiIHx8IG9wdHMuYXN5bmMpIHtcbiAgICAgICAgJG9yZ19lbGVtLmRhdGEoJ3RpdGxlJywgb3JnX3RpdGxlKTtcbiAgICAgICAgJG9yZ19lbGVtLnJlbW92ZUF0dHIob3B0cy5hdHRyaWJ1dGUpOyAvL3JlbW92ZSBvcmlnaW5hbCBBdHRyaWJ1dGVcbiAgICAgICAgdmFyIGVkYXRhID0ge29yZ19lbGVtOiAkb3JnX2VsZW0sIG9yZ190aXRsZTogb3JnX3RpdGxlLCBvcHRzOiBvcHRzfTtcbiAgICAgICAgXG4gICAgICAgIGlmIChvcHRzLmFjdGl2YXRpb24gPT0gXCJob3ZlclwiKSB7XG4gICAgICAgICAgJG9yZ19lbGVtLmJpbmQoJ21vdXNlZW50ZXIgc2hvd1RpcFRpcCcsIGVkYXRhLCBhY3RpdmVfdGlwdGlwKTtcbiAgICAgICAgICBpZiAob3B0cy5rZWVwQWxpdmUpIHsgJHRpcHRpcF9ob2xkZXIuYmluZCgnbW91c2VsZWF2ZSBoaWRlVGlwVGlwJywgZWRhdGEsIGRlYWN0aXZlX3RpcHRpcCk7IH1cbiAgICAgICAgICBlbHNlIHsgJG9yZ19lbGVtLmJpbmQoJ21vdXNlbGVhdmUgaGlkZVRpcFRpcCcsIGVkYXRhLCBkZWFjdGl2ZV90aXB0aXApOyB9XG4gICAgICAgIH0gZWxzZSBpZiAob3B0cy5hY3RpdmF0aW9uID09IFwiZm9jdXNcIikge1xuICAgICAgICAgICRvcmdfZWxlbS5iaW5kKCdmb2N1cyBzaG93VGlwVGlwJywgZWRhdGEsIGFjdGl2ZV90aXB0aXApLmJpbmQoJ2JsdXIgaGlkZVRpcFRpcCcsIGVkYXRhLCBkZWFjdGl2ZV90aXB0aXApO1xuICAgICAgICB9IGVsc2UgaWYgKG9wdHMuYWN0aXZhdGlvbiA9PSBcImNsaWNrXCIpIHtcbiAgICAgICAgICAkb3JnX2VsZW0uYmluZCgnY2xpY2sgc2hvd1RpcFRpcCcsICQuZXh0ZW5kKHtyZXRGYWxzZTogdHJ1ZX0sIGVkYXRhKSwgYWN0aXZlX3RpcHRpcCk7XG4gICAgICAgICAgaWYob3B0cy5rZWVwQWxpdmUpeyAkdGlwdGlwX2hvbGRlci5iaW5kKCdtb3VzZWxlYXZlIGhpZGVUaXBUaXAnLCBlZGF0YSwgZGVhY3RpdmVfdGlwdGlwKTsgfSBcbiAgICAgICAgICBlbHNlIHsgJG9yZ19lbGVtLmJpbmQoJ21vdXNlbGVhdmUgaGlkZVRpcFRpcCcsIGVkYXRhLCBkZWFjdGl2ZV90aXB0aXApOyB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdHMuc3RhcnRBY3RpdmF0ZWQpIHsgJG9yZ19lbGVtLnRyaWdnZXIoJ3Nob3dUaXBUaXAnKTsgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG59OyIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oJCkge1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vID0gVGhlIGZvbGxvd2luZyBhcmUgaGVscGVyIGZ1bmN0aW9ucyB1c2VkIHdpZGVseSB0aHJvdWdob3V0IHRoZSByZXN0IG9mIHRoZSBjb2RlID1cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBcbiAgdXRpbHMgPSB7fTtcbiAgXG4gIC8vIEZhc3RlciB0aGFuIE1hdGguZmxvb3IgKGh0dHA6Ly93ZWJkb29kLmNvbS8/cD0yMTkpXG4gIHV0aWxzLmZsb29ySGFjayA9IGZ1bmN0aW9uKG51bSkgeyByZXR1cm4gKG51bSA8PCAwKSAtIChudW0gPCAwID8gMSA6IDApOyB9XG4gIFxuICAvLyBQYWRzIGEgbnVtYmVyIHdpdGggZnJvbnQtbGVhZGluZyAwJ3MgdG8gZ2l2ZW4gbGVuZ3RoXG4gIHV0aWxzLnBhZCA9IGZ1bmN0aW9uKG51bWJlciwgbGVuZ3RoKSB7XG4gICAgdmFyIHN0ciA9ICcnICsgbnVtYmVyO1xuICAgIHdoaWxlIChzdHIubGVuZ3RoIDwgbGVuZ3RoKSB7IHN0ciA9ICcwJyArIHN0cjsgfVxuICAgIHJldHVybiBzdHI7XG4gIH1cblxuICAvLyBUdXJucyBhbiBhcmJpdHJhcnkgc3RyaW5nIGludG8gc29tZXRoaW5nIHRoYXQgY2FuIGJlIHVzZWQgYXMgYW4gZWxlbWVudCdzIGNsYXNzXG4gIHV0aWxzLmNsYXNzRnJpZW5kbHkgPSBmdW5jdGlvbih2YWwpIHsgcmV0dXJuIHZhbC50b1N0cmluZygpLnJlcGxhY2UoL1teX2EtekEtWjAtOS1dL2csICctJyk7IH1cbiAgXG4gIC8vIE1vc3RseSBmb3IgZGVidWdnaW5nOyBzaG93IHRoZSBmcHMgaW4gdGhlIGJvdHRvbS1yaWdodCBjb3JuZXIgb2YgdGhlIGJyb3dzZXJcbiAgdXRpbHMuZnBzID0gZnVuY3Rpb24oYSwgYiwgYykge1xuICAgICQoJyNmcHMnKS50ZXh0KGEgKyAnICcgKyB1dGlscy5mbG9vckhhY2soMTAwMC9iKSArICcgJyArIHV0aWxzLmZsb29ySGFjayhjKjEwKS8xMCArICcgJyArICQoJyNicm93c2VyIConKS5sZW5ndGgpO1xuICB9XG4gIFxuICAvLyBBIHNpbXBsaXN0aWMgaGFzaCBmdW5jdGlvbiBmb3IgcXVpY2tseSB0dXJuaW5nIHN0cmluZ3MgaW50byBudW1iZXJzXG4gIC8vIE5vdGUgdGhhdCBzaW5jZSB0aGUgaGFzaCBzcGFjZSBpcyAyXjMyLCBjb2xsaXNpb25zIGFyZSBwcmFjdGljYWxseSBndWFyYW50ZWVkIGFmdGVyIDgwayBzdHJpbmdzLCBcbiAgLy8gYW5kIHRoZXJlJ3MgYSA1JSBjaGFuY2UgYXQgMjBrOiBodHRwOi8vYmV0dGVyZXhwbGFpbmVkLmNvbS9hcnRpY2xlcy91bmRlcnN0YW5kaW5nLXRoZS1iaXJ0aGRheS1wYXJhZG94L1xuICB1dGlscy5zaG9ydEhhc2ggPSBmdW5jdGlvbihzdHIpIHtcbiAgICB2YXIgaGFzaCA9IDA7XG4gICAgaWYgKHN0ci5sZW5ndGggPT0gMCkgcmV0dXJuIGhhc2g7XG4gICAgZm9yIChpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgY2hyID0gc3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgICBoYXNoID0gKChoYXNoPDw1KS1oYXNoKStjaHI7XG4gICAgICBoYXNoID0gaGFzaCAmIGhhc2g7XG4gICAgfVxuICAgIHJldHVybiBoYXNoO1xuICB9XG4gIFxuICAvLyBHZXQgdGhlIGxhc3QgbmFtZSBpbiBhIHBhdGgtbGlrZSBzdHJpbmcgKGFmdGVyIHRoZSBsYXN0IHNsYXNoL2JhY2tzbGFzaClcbiAgdXRpbHMuYmFzZW5hbWUgPSBmdW5jdGlvbihwYXRoKSB7IHJldHVybiBwYXRoLnJlcGxhY2UoL14uKltcXC9cXFxcXS9nLCAnJyk7IH07XG4gIFxuICAvLyBEZWNvZGUgY2hhcmFjdGVycyB0aGF0IGFyZSBzYWZlIHdpdGhpbiBvdXIgcXVlcnkgc3RyaW5ncywgZm9yIGluY3JlYXNlZCByZWFkYWJpbGl0eVxuICB1dGlscy5kZWNvZGVTYWZlT2N0ZXRzID0gZnVuY3Rpb24ocXVlcnkpIHtcbiAgICB2YXIgc2FmZSA9IHsnM0EnOiAnOicsICc0MCc6ICdAJywgJzdDJzogJ3wnLCAnMkYnOiAnLyd9O1xuICAgIHJldHVybiBxdWVyeS5yZXBsYWNlKC8lKFswLTlBLUZdezJ9KS9naSwgZnVuY3Rpb24obSwgb2N0KSB7IHJldHVybiBzYWZlW29jdF0gfHwgbTsgfSk7XG4gIH1cbiAgXG4gIC8vIEVzY2FwZSBzb21ldGhpbmcgc28gaXQgY2FuIGJlIGluc2VydGVkIGludG8gYSByZWd1bGFyIGV4cHJlc3Npb25cbiAgdXRpbHMucmVnRXhwUXVvdGUgPSBmdW5jdGlvbihzdHIpIHsgcmV0dXJuIHN0ci5yZXBsYWNlKC8oWy4/KiteJFtcXF1cXFxcKCl7fS1dKS9nLCBcIlxcXFwkMVwiKTsgfTtcbiAgXG4gIHJldHVybiB1dGlscztcbiAgXG59OyIsIi8vICAgICBVbmRlcnNjb3JlLmpzIDEuOC4zXG4vLyAgICAgaHR0cDovL3VuZGVyc2NvcmVqcy5vcmdcbi8vICAgICAoYykgMjAwOS0yMDE1IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzXG4vLyAgICAgVW5kZXJzY29yZSBtYXkgYmUgZnJlZWx5IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS5cbihmdW5jdGlvbigpe2Z1bmN0aW9uIG4obil7ZnVuY3Rpb24gdCh0LHIsZSx1LGksbyl7Zm9yKDtpPj0wJiZvPmk7aSs9bil7dmFyIGE9dT91W2ldOmk7ZT1yKGUsdFthXSxhLHQpfXJldHVybiBlfXJldHVybiBmdW5jdGlvbihyLGUsdSxpKXtlPWIoZSxpLDQpO3ZhciBvPSFrKHIpJiZtLmtleXMociksYT0ob3x8cikubGVuZ3RoLGM9bj4wPzA6YS0xO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDMmJih1PXJbbz9vW2NdOmNdLGMrPW4pLHQocixlLHUsbyxjLGEpfX1mdW5jdGlvbiB0KG4pe3JldHVybiBmdW5jdGlvbih0LHIsZSl7cj14KHIsZSk7Zm9yKHZhciB1PU8odCksaT1uPjA/MDp1LTE7aT49MCYmdT5pO2krPW4paWYocih0W2ldLGksdCkpcmV0dXJuIGk7cmV0dXJuLTF9fWZ1bmN0aW9uIHIobix0LHIpe3JldHVybiBmdW5jdGlvbihlLHUsaSl7dmFyIG89MCxhPU8oZSk7aWYoXCJudW1iZXJcIj09dHlwZW9mIGkpbj4wP289aT49MD9pOk1hdGgubWF4KGkrYSxvKTphPWk+PTA/TWF0aC5taW4oaSsxLGEpOmkrYSsxO2Vsc2UgaWYociYmaSYmYSlyZXR1cm4gaT1yKGUsdSksZVtpXT09PXU/aTotMTtpZih1IT09dSlyZXR1cm4gaT10KGwuY2FsbChlLG8sYSksbS5pc05hTiksaT49MD9pK286LTE7Zm9yKGk9bj4wP286YS0xO2k+PTAmJmE+aTtpKz1uKWlmKGVbaV09PT11KXJldHVybiBpO3JldHVybi0xfX1mdW5jdGlvbiBlKG4sdCl7dmFyIHI9SS5sZW5ndGgsZT1uLmNvbnN0cnVjdG9yLHU9bS5pc0Z1bmN0aW9uKGUpJiZlLnByb3RvdHlwZXx8YSxpPVwiY29uc3RydWN0b3JcIjtmb3IobS5oYXMobixpKSYmIW0uY29udGFpbnModCxpKSYmdC5wdXNoKGkpO3ItLTspaT1JW3JdLGkgaW4gbiYmbltpXSE9PXVbaV0mJiFtLmNvbnRhaW5zKHQsaSkmJnQucHVzaChpKX12YXIgdT10aGlzLGk9dS5fLG89QXJyYXkucHJvdG90eXBlLGE9T2JqZWN0LnByb3RvdHlwZSxjPUZ1bmN0aW9uLnByb3RvdHlwZSxmPW8ucHVzaCxsPW8uc2xpY2Uscz1hLnRvU3RyaW5nLHA9YS5oYXNPd25Qcm9wZXJ0eSxoPUFycmF5LmlzQXJyYXksdj1PYmplY3Qua2V5cyxnPWMuYmluZCx5PU9iamVjdC5jcmVhdGUsZD1mdW5jdGlvbigpe30sbT1mdW5jdGlvbihuKXtyZXR1cm4gbiBpbnN0YW5jZW9mIG0/bjp0aGlzIGluc3RhbmNlb2YgbT92b2lkKHRoaXMuX3dyYXBwZWQ9bik6bmV3IG0obil9O1widW5kZWZpbmVkXCIhPXR5cGVvZiBleHBvcnRzPyhcInVuZGVmaW5lZFwiIT10eXBlb2YgbW9kdWxlJiZtb2R1bGUuZXhwb3J0cyYmKGV4cG9ydHM9bW9kdWxlLmV4cG9ydHM9bSksZXhwb3J0cy5fPW0pOnUuXz1tLG0uVkVSU0lPTj1cIjEuOC4zXCI7dmFyIGI9ZnVuY3Rpb24obix0LHIpe2lmKHQ9PT12b2lkIDApcmV0dXJuIG47c3dpdGNoKG51bGw9PXI/MzpyKXtjYXNlIDE6cmV0dXJuIGZ1bmN0aW9uKHIpe3JldHVybiBuLmNhbGwodCxyKX07Y2FzZSAyOnJldHVybiBmdW5jdGlvbihyLGUpe3JldHVybiBuLmNhbGwodCxyLGUpfTtjYXNlIDM6cmV0dXJuIGZ1bmN0aW9uKHIsZSx1KXtyZXR1cm4gbi5jYWxsKHQscixlLHUpfTtjYXNlIDQ6cmV0dXJuIGZ1bmN0aW9uKHIsZSx1LGkpe3JldHVybiBuLmNhbGwodCxyLGUsdSxpKX19cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIG4uYXBwbHkodCxhcmd1bWVudHMpfX0seD1mdW5jdGlvbihuLHQscil7cmV0dXJuIG51bGw9PW4/bS5pZGVudGl0eTptLmlzRnVuY3Rpb24obik/YihuLHQscik6bS5pc09iamVjdChuKT9tLm1hdGNoZXIobik6bS5wcm9wZXJ0eShuKX07bS5pdGVyYXRlZT1mdW5jdGlvbihuLHQpe3JldHVybiB4KG4sdCwxLzApfTt2YXIgXz1mdW5jdGlvbihuLHQpe3JldHVybiBmdW5jdGlvbihyKXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoO2lmKDI+ZXx8bnVsbD09cilyZXR1cm4gcjtmb3IodmFyIHU9MTtlPnU7dSsrKWZvcih2YXIgaT1hcmd1bWVudHNbdV0sbz1uKGkpLGE9by5sZW5ndGgsYz0wO2E+YztjKyspe3ZhciBmPW9bY107dCYmcltmXSE9PXZvaWQgMHx8KHJbZl09aVtmXSl9cmV0dXJuIHJ9fSxqPWZ1bmN0aW9uKG4pe2lmKCFtLmlzT2JqZWN0KG4pKXJldHVybnt9O2lmKHkpcmV0dXJuIHkobik7ZC5wcm90b3R5cGU9bjt2YXIgdD1uZXcgZDtyZXR1cm4gZC5wcm90b3R5cGU9bnVsbCx0fSx3PWZ1bmN0aW9uKG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gbnVsbD09dD92b2lkIDA6dFtuXX19LEE9TWF0aC5wb3coMiw1MyktMSxPPXcoXCJsZW5ndGhcIiksaz1mdW5jdGlvbihuKXt2YXIgdD1PKG4pO3JldHVyblwibnVtYmVyXCI9PXR5cGVvZiB0JiZ0Pj0wJiZBPj10fTttLmVhY2g9bS5mb3JFYWNoPWZ1bmN0aW9uKG4sdCxyKXt0PWIodCxyKTt2YXIgZSx1O2lmKGsobikpZm9yKGU9MCx1PW4ubGVuZ3RoO3U+ZTtlKyspdChuW2VdLGUsbik7ZWxzZXt2YXIgaT1tLmtleXMobik7Zm9yKGU9MCx1PWkubGVuZ3RoO3U+ZTtlKyspdChuW2lbZV1dLGlbZV0sbil9cmV0dXJuIG59LG0ubWFwPW0uY29sbGVjdD1mdW5jdGlvbihuLHQscil7dD14KHQscik7Zm9yKHZhciBlPSFrKG4pJiZtLmtleXMobiksdT0oZXx8bikubGVuZ3RoLGk9QXJyYXkodSksbz0wO3U+bztvKyspe3ZhciBhPWU/ZVtvXTpvO2lbb109dChuW2FdLGEsbil9cmV0dXJuIGl9LG0ucmVkdWNlPW0uZm9sZGw9bS5pbmplY3Q9bigxKSxtLnJlZHVjZVJpZ2h0PW0uZm9sZHI9bigtMSksbS5maW5kPW0uZGV0ZWN0PWZ1bmN0aW9uKG4sdCxyKXt2YXIgZTtyZXR1cm4gZT1rKG4pP20uZmluZEluZGV4KG4sdCxyKTptLmZpbmRLZXkobix0LHIpLGUhPT12b2lkIDAmJmUhPT0tMT9uW2VdOnZvaWQgMH0sbS5maWx0ZXI9bS5zZWxlY3Q9ZnVuY3Rpb24obix0LHIpe3ZhciBlPVtdO3JldHVybiB0PXgodCxyKSxtLmVhY2gobixmdW5jdGlvbihuLHIsdSl7dChuLHIsdSkmJmUucHVzaChuKX0pLGV9LG0ucmVqZWN0PWZ1bmN0aW9uKG4sdCxyKXtyZXR1cm4gbS5maWx0ZXIobixtLm5lZ2F0ZSh4KHQpKSxyKX0sbS5ldmVyeT1tLmFsbD1mdW5jdGlvbihuLHQscil7dD14KHQscik7Zm9yKHZhciBlPSFrKG4pJiZtLmtleXMobiksdT0oZXx8bikubGVuZ3RoLGk9MDt1Pmk7aSsrKXt2YXIgbz1lP2VbaV06aTtpZighdChuW29dLG8sbikpcmV0dXJuITF9cmV0dXJuITB9LG0uc29tZT1tLmFueT1mdW5jdGlvbihuLHQscil7dD14KHQscik7Zm9yKHZhciBlPSFrKG4pJiZtLmtleXMobiksdT0oZXx8bikubGVuZ3RoLGk9MDt1Pmk7aSsrKXt2YXIgbz1lP2VbaV06aTtpZih0KG5bb10sbyxuKSlyZXR1cm4hMH1yZXR1cm4hMX0sbS5jb250YWlucz1tLmluY2x1ZGVzPW0uaW5jbHVkZT1mdW5jdGlvbihuLHQscixlKXtyZXR1cm4gayhuKXx8KG49bS52YWx1ZXMobikpLChcIm51bWJlclwiIT10eXBlb2Ygcnx8ZSkmJihyPTApLG0uaW5kZXhPZihuLHQscik+PTB9LG0uaW52b2tlPWZ1bmN0aW9uKG4sdCl7dmFyIHI9bC5jYWxsKGFyZ3VtZW50cywyKSxlPW0uaXNGdW5jdGlvbih0KTtyZXR1cm4gbS5tYXAobixmdW5jdGlvbihuKXt2YXIgdT1lP3Q6blt0XTtyZXR1cm4gbnVsbD09dT91OnUuYXBwbHkobixyKX0pfSxtLnBsdWNrPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG0ubWFwKG4sbS5wcm9wZXJ0eSh0KSl9LG0ud2hlcmU9ZnVuY3Rpb24obix0KXtyZXR1cm4gbS5maWx0ZXIobixtLm1hdGNoZXIodCkpfSxtLmZpbmRXaGVyZT1mdW5jdGlvbihuLHQpe3JldHVybiBtLmZpbmQobixtLm1hdGNoZXIodCkpfSxtLm1heD1mdW5jdGlvbihuLHQscil7dmFyIGUsdSxpPS0xLzAsbz0tMS8wO2lmKG51bGw9PXQmJm51bGwhPW4pe249ayhuKT9uOm0udmFsdWVzKG4pO2Zvcih2YXIgYT0wLGM9bi5sZW5ndGg7Yz5hO2ErKyllPW5bYV0sZT5pJiYoaT1lKX1lbHNlIHQ9eCh0LHIpLG0uZWFjaChuLGZ1bmN0aW9uKG4scixlKXt1PXQobixyLGUpLCh1Pm98fHU9PT0tMS8wJiZpPT09LTEvMCkmJihpPW4sbz11KX0pO3JldHVybiBpfSxtLm1pbj1mdW5jdGlvbihuLHQscil7dmFyIGUsdSxpPTEvMCxvPTEvMDtpZihudWxsPT10JiZudWxsIT1uKXtuPWsobik/bjptLnZhbHVlcyhuKTtmb3IodmFyIGE9MCxjPW4ubGVuZ3RoO2M+YTthKyspZT1uW2FdLGk+ZSYmKGk9ZSl9ZWxzZSB0PXgodCxyKSxtLmVhY2gobixmdW5jdGlvbihuLHIsZSl7dT10KG4scixlKSwobz51fHwxLzA9PT11JiYxLzA9PT1pKSYmKGk9bixvPXUpfSk7cmV0dXJuIGl9LG0uc2h1ZmZsZT1mdW5jdGlvbihuKXtmb3IodmFyIHQscj1rKG4pP246bS52YWx1ZXMobiksZT1yLmxlbmd0aCx1PUFycmF5KGUpLGk9MDtlPmk7aSsrKXQ9bS5yYW5kb20oMCxpKSx0IT09aSYmKHVbaV09dVt0XSksdVt0XT1yW2ldO3JldHVybiB1fSxtLnNhbXBsZT1mdW5jdGlvbihuLHQscil7cmV0dXJuIG51bGw9PXR8fHI/KGsobil8fChuPW0udmFsdWVzKG4pKSxuW20ucmFuZG9tKG4ubGVuZ3RoLTEpXSk6bS5zaHVmZmxlKG4pLnNsaWNlKDAsTWF0aC5tYXgoMCx0KSl9LG0uc29ydEJ5PWZ1bmN0aW9uKG4sdCxyKXtyZXR1cm4gdD14KHQsciksbS5wbHVjayhtLm1hcChuLGZ1bmN0aW9uKG4scixlKXtyZXR1cm57dmFsdWU6bixpbmRleDpyLGNyaXRlcmlhOnQobixyLGUpfX0pLnNvcnQoZnVuY3Rpb24obix0KXt2YXIgcj1uLmNyaXRlcmlhLGU9dC5jcml0ZXJpYTtpZihyIT09ZSl7aWYocj5lfHxyPT09dm9pZCAwKXJldHVybiAxO2lmKGU+cnx8ZT09PXZvaWQgMClyZXR1cm4tMX1yZXR1cm4gbi5pbmRleC10LmluZGV4fSksXCJ2YWx1ZVwiKX07dmFyIEY9ZnVuY3Rpb24obil7cmV0dXJuIGZ1bmN0aW9uKHQscixlKXt2YXIgdT17fTtyZXR1cm4gcj14KHIsZSksbS5lYWNoKHQsZnVuY3Rpb24oZSxpKXt2YXIgbz1yKGUsaSx0KTtuKHUsZSxvKX0pLHV9fTttLmdyb3VwQnk9RihmdW5jdGlvbihuLHQscil7bS5oYXMobixyKT9uW3JdLnB1c2godCk6bltyXT1bdF19KSxtLmluZGV4Qnk9RihmdW5jdGlvbihuLHQscil7bltyXT10fSksbS5jb3VudEJ5PUYoZnVuY3Rpb24obix0LHIpe20uaGFzKG4scik/bltyXSsrOm5bcl09MX0pLG0udG9BcnJheT1mdW5jdGlvbihuKXtyZXR1cm4gbj9tLmlzQXJyYXkobik/bC5jYWxsKG4pOmsobik/bS5tYXAobixtLmlkZW50aXR5KTptLnZhbHVlcyhuKTpbXX0sbS5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBudWxsPT1uPzA6ayhuKT9uLmxlbmd0aDptLmtleXMobikubGVuZ3RofSxtLnBhcnRpdGlvbj1mdW5jdGlvbihuLHQscil7dD14KHQscik7dmFyIGU9W10sdT1bXTtyZXR1cm4gbS5lYWNoKG4sZnVuY3Rpb24obixyLGkpeyh0KG4scixpKT9lOnUpLnB1c2gobil9KSxbZSx1XX0sbS5maXJzdD1tLmhlYWQ9bS50YWtlPWZ1bmN0aW9uKG4sdCxyKXtyZXR1cm4gbnVsbD09bj92b2lkIDA6bnVsbD09dHx8cj9uWzBdOm0uaW5pdGlhbChuLG4ubGVuZ3RoLXQpfSxtLmluaXRpYWw9ZnVuY3Rpb24obix0LHIpe3JldHVybiBsLmNhbGwobiwwLE1hdGgubWF4KDAsbi5sZW5ndGgtKG51bGw9PXR8fHI/MTp0KSkpfSxtLmxhc3Q9ZnVuY3Rpb24obix0LHIpe3JldHVybiBudWxsPT1uP3ZvaWQgMDpudWxsPT10fHxyP25bbi5sZW5ndGgtMV06bS5yZXN0KG4sTWF0aC5tYXgoMCxuLmxlbmd0aC10KSl9LG0ucmVzdD1tLnRhaWw9bS5kcm9wPWZ1bmN0aW9uKG4sdCxyKXtyZXR1cm4gbC5jYWxsKG4sbnVsbD09dHx8cj8xOnQpfSxtLmNvbXBhY3Q9ZnVuY3Rpb24obil7cmV0dXJuIG0uZmlsdGVyKG4sbS5pZGVudGl0eSl9O3ZhciBTPWZ1bmN0aW9uKG4sdCxyLGUpe2Zvcih2YXIgdT1bXSxpPTAsbz1lfHwwLGE9TyhuKTthPm87bysrKXt2YXIgYz1uW29dO2lmKGsoYykmJihtLmlzQXJyYXkoYyl8fG0uaXNBcmd1bWVudHMoYykpKXt0fHwoYz1TKGMsdCxyKSk7dmFyIGY9MCxsPWMubGVuZ3RoO2Zvcih1Lmxlbmd0aCs9bDtsPmY7KXVbaSsrXT1jW2YrK119ZWxzZSByfHwodVtpKytdPWMpfXJldHVybiB1fTttLmZsYXR0ZW49ZnVuY3Rpb24obix0KXtyZXR1cm4gUyhuLHQsITEpfSxtLndpdGhvdXQ9ZnVuY3Rpb24obil7cmV0dXJuIG0uZGlmZmVyZW5jZShuLGwuY2FsbChhcmd1bWVudHMsMSkpfSxtLnVuaXE9bS51bmlxdWU9ZnVuY3Rpb24obix0LHIsZSl7bS5pc0Jvb2xlYW4odCl8fChlPXIscj10LHQ9ITEpLG51bGwhPXImJihyPXgocixlKSk7Zm9yKHZhciB1PVtdLGk9W10sbz0wLGE9TyhuKTthPm87bysrKXt2YXIgYz1uW29dLGY9cj9yKGMsbyxuKTpjO3Q/KG8mJmk9PT1mfHx1LnB1c2goYyksaT1mKTpyP20uY29udGFpbnMoaSxmKXx8KGkucHVzaChmKSx1LnB1c2goYykpOm0uY29udGFpbnModSxjKXx8dS5wdXNoKGMpfXJldHVybiB1fSxtLnVuaW9uPWZ1bmN0aW9uKCl7cmV0dXJuIG0udW5pcShTKGFyZ3VtZW50cywhMCwhMCkpfSxtLmludGVyc2VjdGlvbj1mdW5jdGlvbihuKXtmb3IodmFyIHQ9W10scj1hcmd1bWVudHMubGVuZ3RoLGU9MCx1PU8obik7dT5lO2UrKyl7dmFyIGk9bltlXTtpZighbS5jb250YWlucyh0LGkpKXtmb3IodmFyIG89MTtyPm8mJm0uY29udGFpbnMoYXJndW1lbnRzW29dLGkpO28rKyk7bz09PXImJnQucHVzaChpKX19cmV0dXJuIHR9LG0uZGlmZmVyZW5jZT1mdW5jdGlvbihuKXt2YXIgdD1TKGFyZ3VtZW50cywhMCwhMCwxKTtyZXR1cm4gbS5maWx0ZXIobixmdW5jdGlvbihuKXtyZXR1cm4hbS5jb250YWlucyh0LG4pfSl9LG0uemlwPWZ1bmN0aW9uKCl7cmV0dXJuIG0udW56aXAoYXJndW1lbnRzKX0sbS51bnppcD1mdW5jdGlvbihuKXtmb3IodmFyIHQ9biYmbS5tYXgobixPKS5sZW5ndGh8fDAscj1BcnJheSh0KSxlPTA7dD5lO2UrKylyW2VdPW0ucGx1Y2sobixlKTtyZXR1cm4gcn0sbS5vYmplY3Q9ZnVuY3Rpb24obix0KXtmb3IodmFyIHI9e30sZT0wLHU9TyhuKTt1PmU7ZSsrKXQ/cltuW2VdXT10W2VdOnJbbltlXVswXV09bltlXVsxXTtyZXR1cm4gcn0sbS5maW5kSW5kZXg9dCgxKSxtLmZpbmRMYXN0SW5kZXg9dCgtMSksbS5zb3J0ZWRJbmRleD1mdW5jdGlvbihuLHQscixlKXtyPXgocixlLDEpO2Zvcih2YXIgdT1yKHQpLGk9MCxvPU8obik7bz5pOyl7dmFyIGE9TWF0aC5mbG9vcigoaStvKS8yKTtyKG5bYV0pPHU/aT1hKzE6bz1hfXJldHVybiBpfSxtLmluZGV4T2Y9cigxLG0uZmluZEluZGV4LG0uc29ydGVkSW5kZXgpLG0ubGFzdEluZGV4T2Y9cigtMSxtLmZpbmRMYXN0SW5kZXgpLG0ucmFuZ2U9ZnVuY3Rpb24obix0LHIpe251bGw9PXQmJih0PW58fDAsbj0wKSxyPXJ8fDE7Zm9yKHZhciBlPU1hdGgubWF4KE1hdGguY2VpbCgodC1uKS9yKSwwKSx1PUFycmF5KGUpLGk9MDtlPmk7aSsrLG4rPXIpdVtpXT1uO3JldHVybiB1fTt2YXIgRT1mdW5jdGlvbihuLHQscixlLHUpe2lmKCEoZSBpbnN0YW5jZW9mIHQpKXJldHVybiBuLmFwcGx5KHIsdSk7dmFyIGk9aihuLnByb3RvdHlwZSksbz1uLmFwcGx5KGksdSk7cmV0dXJuIG0uaXNPYmplY3Qobyk/bzppfTttLmJpbmQ9ZnVuY3Rpb24obix0KXtpZihnJiZuLmJpbmQ9PT1nKXJldHVybiBnLmFwcGx5KG4sbC5jYWxsKGFyZ3VtZW50cywxKSk7aWYoIW0uaXNGdW5jdGlvbihuKSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiQmluZCBtdXN0IGJlIGNhbGxlZCBvbiBhIGZ1bmN0aW9uXCIpO3ZhciByPWwuY2FsbChhcmd1bWVudHMsMiksZT1mdW5jdGlvbigpe3JldHVybiBFKG4sZSx0LHRoaXMsci5jb25jYXQobC5jYWxsKGFyZ3VtZW50cykpKX07cmV0dXJuIGV9LG0ucGFydGlhbD1mdW5jdGlvbihuKXt2YXIgdD1sLmNhbGwoYXJndW1lbnRzLDEpLHI9ZnVuY3Rpb24oKXtmb3IodmFyIGU9MCx1PXQubGVuZ3RoLGk9QXJyYXkodSksbz0wO3U+bztvKyspaVtvXT10W29dPT09bT9hcmd1bWVudHNbZSsrXTp0W29dO2Zvcig7ZTxhcmd1bWVudHMubGVuZ3RoOylpLnB1c2goYXJndW1lbnRzW2UrK10pO3JldHVybiBFKG4scix0aGlzLHRoaXMsaSl9O3JldHVybiByfSxtLmJpbmRBbGw9ZnVuY3Rpb24obil7dmFyIHQscixlPWFyZ3VtZW50cy5sZW5ndGg7aWYoMT49ZSl0aHJvdyBuZXcgRXJyb3IoXCJiaW5kQWxsIG11c3QgYmUgcGFzc2VkIGZ1bmN0aW9uIG5hbWVzXCIpO2Zvcih0PTE7ZT50O3QrKylyPWFyZ3VtZW50c1t0XSxuW3JdPW0uYmluZChuW3JdLG4pO3JldHVybiBufSxtLm1lbW9pemU9ZnVuY3Rpb24obix0KXt2YXIgcj1mdW5jdGlvbihlKXt2YXIgdT1yLmNhY2hlLGk9XCJcIisodD90LmFwcGx5KHRoaXMsYXJndW1lbnRzKTplKTtyZXR1cm4gbS5oYXModSxpKXx8KHVbaV09bi5hcHBseSh0aGlzLGFyZ3VtZW50cykpLHVbaV19O3JldHVybiByLmNhY2hlPXt9LHJ9LG0uZGVsYXk9ZnVuY3Rpb24obix0KXt2YXIgcj1sLmNhbGwoYXJndW1lbnRzLDIpO3JldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7cmV0dXJuIG4uYXBwbHkobnVsbCxyKX0sdCl9LG0uZGVmZXI9bS5wYXJ0aWFsKG0uZGVsYXksbSwxKSxtLnRocm90dGxlPWZ1bmN0aW9uKG4sdCxyKXt2YXIgZSx1LGksbz1udWxsLGE9MDtyfHwocj17fSk7dmFyIGM9ZnVuY3Rpb24oKXthPXIubGVhZGluZz09PSExPzA6bS5ub3coKSxvPW51bGwsaT1uLmFwcGx5KGUsdSksb3x8KGU9dT1udWxsKX07cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGY9bS5ub3coKTthfHxyLmxlYWRpbmchPT0hMXx8KGE9Zik7dmFyIGw9dC0oZi1hKTtyZXR1cm4gZT10aGlzLHU9YXJndW1lbnRzLDA+PWx8fGw+dD8obyYmKGNsZWFyVGltZW91dChvKSxvPW51bGwpLGE9ZixpPW4uYXBwbHkoZSx1KSxvfHwoZT11PW51bGwpKTpvfHxyLnRyYWlsaW5nPT09ITF8fChvPXNldFRpbWVvdXQoYyxsKSksaX19LG0uZGVib3VuY2U9ZnVuY3Rpb24obix0LHIpe3ZhciBlLHUsaSxvLGEsYz1mdW5jdGlvbigpe3ZhciBmPW0ubm93KCktbzt0PmYmJmY+PTA/ZT1zZXRUaW1lb3V0KGMsdC1mKTooZT1udWxsLHJ8fChhPW4uYXBwbHkoaSx1KSxlfHwoaT11PW51bGwpKSl9O3JldHVybiBmdW5jdGlvbigpe2k9dGhpcyx1PWFyZ3VtZW50cyxvPW0ubm93KCk7dmFyIGY9ciYmIWU7cmV0dXJuIGV8fChlPXNldFRpbWVvdXQoYyx0KSksZiYmKGE9bi5hcHBseShpLHUpLGk9dT1udWxsKSxhfX0sbS53cmFwPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG0ucGFydGlhbCh0LG4pfSxtLm5lZ2F0ZT1mdW5jdGlvbihuKXtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4hbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fSxtLmNvbXBvc2U9ZnVuY3Rpb24oKXt2YXIgbj1hcmd1bWVudHMsdD1uLmxlbmd0aC0xO3JldHVybiBmdW5jdGlvbigpe2Zvcih2YXIgcj10LGU9blt0XS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7ci0tOyllPW5bcl0uY2FsbCh0aGlzLGUpO3JldHVybiBlfX0sbS5hZnRlcj1mdW5jdGlvbihuLHQpe3JldHVybiBmdW5jdGlvbigpe3JldHVybi0tbjwxP3QuYXBwbHkodGhpcyxhcmd1bWVudHMpOnZvaWQgMH19LG0uYmVmb3JlPWZ1bmN0aW9uKG4sdCl7dmFyIHI7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuLS1uPjAmJihyPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpKSwxPj1uJiYodD1udWxsKSxyfX0sbS5vbmNlPW0ucGFydGlhbChtLmJlZm9yZSwyKTt2YXIgTT0he3RvU3RyaW5nOm51bGx9LnByb3BlcnR5SXNFbnVtZXJhYmxlKFwidG9TdHJpbmdcIiksST1bXCJ2YWx1ZU9mXCIsXCJpc1Byb3RvdHlwZU9mXCIsXCJ0b1N0cmluZ1wiLFwicHJvcGVydHlJc0VudW1lcmFibGVcIixcImhhc093blByb3BlcnR5XCIsXCJ0b0xvY2FsZVN0cmluZ1wiXTttLmtleXM9ZnVuY3Rpb24obil7aWYoIW0uaXNPYmplY3QobikpcmV0dXJuW107aWYodilyZXR1cm4gdihuKTt2YXIgdD1bXTtmb3IodmFyIHIgaW4gbiltLmhhcyhuLHIpJiZ0LnB1c2gocik7cmV0dXJuIE0mJmUobix0KSx0fSxtLmFsbEtleXM9ZnVuY3Rpb24obil7aWYoIW0uaXNPYmplY3QobikpcmV0dXJuW107dmFyIHQ9W107Zm9yKHZhciByIGluIG4pdC5wdXNoKHIpO3JldHVybiBNJiZlKG4sdCksdH0sbS52YWx1ZXM9ZnVuY3Rpb24obil7Zm9yKHZhciB0PW0ua2V5cyhuKSxyPXQubGVuZ3RoLGU9QXJyYXkociksdT0wO3I+dTt1KyspZVt1XT1uW3RbdV1dO3JldHVybiBlfSxtLm1hcE9iamVjdD1mdW5jdGlvbihuLHQscil7dD14KHQscik7Zm9yKHZhciBlLHU9bS5rZXlzKG4pLGk9dS5sZW5ndGgsbz17fSxhPTA7aT5hO2ErKyllPXVbYV0sb1tlXT10KG5bZV0sZSxuKTtyZXR1cm4gb30sbS5wYWlycz1mdW5jdGlvbihuKXtmb3IodmFyIHQ9bS5rZXlzKG4pLHI9dC5sZW5ndGgsZT1BcnJheShyKSx1PTA7cj51O3UrKyllW3VdPVt0W3VdLG5bdFt1XV1dO3JldHVybiBlfSxtLmludmVydD1mdW5jdGlvbihuKXtmb3IodmFyIHQ9e30scj1tLmtleXMobiksZT0wLHU9ci5sZW5ndGg7dT5lO2UrKyl0W25bcltlXV1dPXJbZV07cmV0dXJuIHR9LG0uZnVuY3Rpb25zPW0ubWV0aG9kcz1mdW5jdGlvbihuKXt2YXIgdD1bXTtmb3IodmFyIHIgaW4gbiltLmlzRnVuY3Rpb24obltyXSkmJnQucHVzaChyKTtyZXR1cm4gdC5zb3J0KCl9LG0uZXh0ZW5kPV8obS5hbGxLZXlzKSxtLmV4dGVuZE93bj1tLmFzc2lnbj1fKG0ua2V5cyksbS5maW5kS2V5PWZ1bmN0aW9uKG4sdCxyKXt0PXgodCxyKTtmb3IodmFyIGUsdT1tLmtleXMobiksaT0wLG89dS5sZW5ndGg7bz5pO2krKylpZihlPXVbaV0sdChuW2VdLGUsbikpcmV0dXJuIGV9LG0ucGljaz1mdW5jdGlvbihuLHQscil7dmFyIGUsdSxpPXt9LG89bjtpZihudWxsPT1vKXJldHVybiBpO20uaXNGdW5jdGlvbih0KT8odT1tLmFsbEtleXMobyksZT1iKHQscikpOih1PVMoYXJndW1lbnRzLCExLCExLDEpLGU9ZnVuY3Rpb24obix0LHIpe3JldHVybiB0IGluIHJ9LG89T2JqZWN0KG8pKTtmb3IodmFyIGE9MCxjPXUubGVuZ3RoO2M+YTthKyspe3ZhciBmPXVbYV0sbD1vW2ZdO2UobCxmLG8pJiYoaVtmXT1sKX1yZXR1cm4gaX0sbS5vbWl0PWZ1bmN0aW9uKG4sdCxyKXtpZihtLmlzRnVuY3Rpb24odCkpdD1tLm5lZ2F0ZSh0KTtlbHNle3ZhciBlPW0ubWFwKFMoYXJndW1lbnRzLCExLCExLDEpLFN0cmluZyk7dD1mdW5jdGlvbihuLHQpe3JldHVybiFtLmNvbnRhaW5zKGUsdCl9fXJldHVybiBtLnBpY2sobix0LHIpfSxtLmRlZmF1bHRzPV8obS5hbGxLZXlzLCEwKSxtLmNyZWF0ZT1mdW5jdGlvbihuLHQpe3ZhciByPWoobik7cmV0dXJuIHQmJm0uZXh0ZW5kT3duKHIsdCkscn0sbS5jbG9uZT1mdW5jdGlvbihuKXtyZXR1cm4gbS5pc09iamVjdChuKT9tLmlzQXJyYXkobik/bi5zbGljZSgpOm0uZXh0ZW5kKHt9LG4pOm59LG0udGFwPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHQobiksbn0sbS5pc01hdGNoPWZ1bmN0aW9uKG4sdCl7dmFyIHI9bS5rZXlzKHQpLGU9ci5sZW5ndGg7aWYobnVsbD09bilyZXR1cm4hZTtmb3IodmFyIHU9T2JqZWN0KG4pLGk9MDtlPmk7aSsrKXt2YXIgbz1yW2ldO2lmKHRbb10hPT11W29dfHwhKG8gaW4gdSkpcmV0dXJuITF9cmV0dXJuITB9O3ZhciBOPWZ1bmN0aW9uKG4sdCxyLGUpe2lmKG49PT10KXJldHVybiAwIT09bnx8MS9uPT09MS90O2lmKG51bGw9PW58fG51bGw9PXQpcmV0dXJuIG49PT10O24gaW5zdGFuY2VvZiBtJiYobj1uLl93cmFwcGVkKSx0IGluc3RhbmNlb2YgbSYmKHQ9dC5fd3JhcHBlZCk7dmFyIHU9cy5jYWxsKG4pO2lmKHUhPT1zLmNhbGwodCkpcmV0dXJuITE7c3dpdGNoKHUpe2Nhc2VcIltvYmplY3QgUmVnRXhwXVwiOmNhc2VcIltvYmplY3QgU3RyaW5nXVwiOnJldHVyblwiXCIrbj09XCJcIit0O2Nhc2VcIltvYmplY3QgTnVtYmVyXVwiOnJldHVybituIT09K24/K3QhPT0rdDowPT09K24/MS8rbj09PTEvdDorbj09PSt0O2Nhc2VcIltvYmplY3QgRGF0ZV1cIjpjYXNlXCJbb2JqZWN0IEJvb2xlYW5dXCI6cmV0dXJuK249PT0rdH12YXIgaT1cIltvYmplY3QgQXJyYXldXCI9PT11O2lmKCFpKXtpZihcIm9iamVjdFwiIT10eXBlb2Ygbnx8XCJvYmplY3RcIiE9dHlwZW9mIHQpcmV0dXJuITE7dmFyIG89bi5jb25zdHJ1Y3RvcixhPXQuY29uc3RydWN0b3I7aWYobyE9PWEmJiEobS5pc0Z1bmN0aW9uKG8pJiZvIGluc3RhbmNlb2YgbyYmbS5pc0Z1bmN0aW9uKGEpJiZhIGluc3RhbmNlb2YgYSkmJlwiY29uc3RydWN0b3JcImluIG4mJlwiY29uc3RydWN0b3JcImluIHQpcmV0dXJuITF9cj1yfHxbXSxlPWV8fFtdO2Zvcih2YXIgYz1yLmxlbmd0aDtjLS07KWlmKHJbY109PT1uKXJldHVybiBlW2NdPT09dDtpZihyLnB1c2gobiksZS5wdXNoKHQpLGkpe2lmKGM9bi5sZW5ndGgsYyE9PXQubGVuZ3RoKXJldHVybiExO2Zvcig7Yy0tOylpZighTihuW2NdLHRbY10scixlKSlyZXR1cm4hMX1lbHNle3ZhciBmLGw9bS5rZXlzKG4pO2lmKGM9bC5sZW5ndGgsbS5rZXlzKHQpLmxlbmd0aCE9PWMpcmV0dXJuITE7Zm9yKDtjLS07KWlmKGY9bFtjXSwhbS5oYXModCxmKXx8IU4obltmXSx0W2ZdLHIsZSkpcmV0dXJuITF9cmV0dXJuIHIucG9wKCksZS5wb3AoKSwhMH07bS5pc0VxdWFsPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIE4obix0KX0sbS5pc0VtcHR5PWZ1bmN0aW9uKG4pe3JldHVybiBudWxsPT1uPyEwOmsobikmJihtLmlzQXJyYXkobil8fG0uaXNTdHJpbmcobil8fG0uaXNBcmd1bWVudHMobikpPzA9PT1uLmxlbmd0aDowPT09bS5rZXlzKG4pLmxlbmd0aH0sbS5pc0VsZW1lbnQ9ZnVuY3Rpb24obil7cmV0dXJuISghbnx8MSE9PW4ubm9kZVR5cGUpfSxtLmlzQXJyYXk9aHx8ZnVuY3Rpb24obil7cmV0dXJuXCJbb2JqZWN0IEFycmF5XVwiPT09cy5jYWxsKG4pfSxtLmlzT2JqZWN0PWZ1bmN0aW9uKG4pe3ZhciB0PXR5cGVvZiBuO3JldHVyblwiZnVuY3Rpb25cIj09PXR8fFwib2JqZWN0XCI9PT10JiYhIW59LG0uZWFjaChbXCJBcmd1bWVudHNcIixcIkZ1bmN0aW9uXCIsXCJTdHJpbmdcIixcIk51bWJlclwiLFwiRGF0ZVwiLFwiUmVnRXhwXCIsXCJFcnJvclwiXSxmdW5jdGlvbihuKXttW1wiaXNcIituXT1mdW5jdGlvbih0KXtyZXR1cm4gcy5jYWxsKHQpPT09XCJbb2JqZWN0IFwiK24rXCJdXCJ9fSksbS5pc0FyZ3VtZW50cyhhcmd1bWVudHMpfHwobS5pc0FyZ3VtZW50cz1mdW5jdGlvbihuKXtyZXR1cm4gbS5oYXMobixcImNhbGxlZVwiKX0pLFwiZnVuY3Rpb25cIiE9dHlwZW9mLy4vJiZcIm9iamVjdFwiIT10eXBlb2YgSW50OEFycmF5JiYobS5pc0Z1bmN0aW9uPWZ1bmN0aW9uKG4pe3JldHVyblwiZnVuY3Rpb25cIj09dHlwZW9mIG58fCExfSksbS5pc0Zpbml0ZT1mdW5jdGlvbihuKXtyZXR1cm4gaXNGaW5pdGUobikmJiFpc05hTihwYXJzZUZsb2F0KG4pKX0sbS5pc05hTj1mdW5jdGlvbihuKXtyZXR1cm4gbS5pc051bWJlcihuKSYmbiE9PStufSxtLmlzQm9vbGVhbj1mdW5jdGlvbihuKXtyZXR1cm4gbj09PSEwfHxuPT09ITF8fFwiW29iamVjdCBCb29sZWFuXVwiPT09cy5jYWxsKG4pfSxtLmlzTnVsbD1mdW5jdGlvbihuKXtyZXR1cm4gbnVsbD09PW59LG0uaXNVbmRlZmluZWQ9ZnVuY3Rpb24obil7cmV0dXJuIG49PT12b2lkIDB9LG0uaGFzPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG51bGwhPW4mJnAuY2FsbChuLHQpfSxtLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gdS5fPWksdGhpc30sbS5pZGVudGl0eT1mdW5jdGlvbihuKXtyZXR1cm4gbn0sbS5jb25zdGFudD1mdW5jdGlvbihuKXtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gbn19LG0ubm9vcD1mdW5jdGlvbigpe30sbS5wcm9wZXJ0eT13LG0ucHJvcGVydHlPZj1mdW5jdGlvbihuKXtyZXR1cm4gbnVsbD09bj9mdW5jdGlvbigpe306ZnVuY3Rpb24odCl7cmV0dXJuIG5bdF19fSxtLm1hdGNoZXI9bS5tYXRjaGVzPWZ1bmN0aW9uKG4pe3JldHVybiBuPW0uZXh0ZW5kT3duKHt9LG4pLGZ1bmN0aW9uKHQpe3JldHVybiBtLmlzTWF0Y2godCxuKX19LG0udGltZXM9ZnVuY3Rpb24obix0LHIpe3ZhciBlPUFycmF5KE1hdGgubWF4KDAsbikpO3Q9Yih0LHIsMSk7Zm9yKHZhciB1PTA7bj51O3UrKyllW3VdPXQodSk7cmV0dXJuIGV9LG0ucmFuZG9tPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG51bGw9PXQmJih0PW4sbj0wKSxuK01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoodC1uKzEpKX0sbS5ub3c9RGF0ZS5ub3d8fGZ1bmN0aW9uKCl7cmV0dXJuKG5ldyBEYXRlKS5nZXRUaW1lKCl9O3ZhciBCPXtcIiZcIjpcIiZhbXA7XCIsXCI8XCI6XCImbHQ7XCIsXCI+XCI6XCImZ3Q7XCIsJ1wiJzpcIiZxdW90O1wiLFwiJ1wiOlwiJiN4Mjc7XCIsXCJgXCI6XCImI3g2MDtcIn0sVD1tLmludmVydChCKSxSPWZ1bmN0aW9uKG4pe3ZhciB0PWZ1bmN0aW9uKHQpe3JldHVybiBuW3RdfSxyPVwiKD86XCIrbS5rZXlzKG4pLmpvaW4oXCJ8XCIpK1wiKVwiLGU9UmVnRXhwKHIpLHU9UmVnRXhwKHIsXCJnXCIpO3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gbj1udWxsPT1uP1wiXCI6XCJcIituLGUudGVzdChuKT9uLnJlcGxhY2UodSx0KTpufX07bS5lc2NhcGU9UihCKSxtLnVuZXNjYXBlPVIoVCksbS5yZXN1bHQ9ZnVuY3Rpb24obix0LHIpe3ZhciBlPW51bGw9PW4/dm9pZCAwOm5bdF07cmV0dXJuIGU9PT12b2lkIDAmJihlPXIpLG0uaXNGdW5jdGlvbihlKT9lLmNhbGwobik6ZX07dmFyIHE9MDttLnVuaXF1ZUlkPWZ1bmN0aW9uKG4pe3ZhciB0PSsrcStcIlwiO3JldHVybiBuP24rdDp0fSxtLnRlbXBsYXRlU2V0dGluZ3M9e2V2YWx1YXRlOi88JShbXFxzXFxTXSs/KSU+L2csaW50ZXJwb2xhdGU6LzwlPShbXFxzXFxTXSs/KSU+L2csZXNjYXBlOi88JS0oW1xcc1xcU10rPyklPi9nfTt2YXIgSz0vKC4pXi8sej17XCInXCI6XCInXCIsXCJcXFxcXCI6XCJcXFxcXCIsXCJcXHJcIjpcInJcIixcIlxcblwiOlwiblwiLFwiXFx1MjAyOFwiOlwidTIwMjhcIixcIlxcdTIwMjlcIjpcInUyMDI5XCJ9LEQ9L1xcXFx8J3xcXHJ8XFxufFxcdTIwMjh8XFx1MjAyOS9nLEw9ZnVuY3Rpb24obil7cmV0dXJuXCJcXFxcXCIreltuXX07bS50ZW1wbGF0ZT1mdW5jdGlvbihuLHQscil7IXQmJnImJih0PXIpLHQ9bS5kZWZhdWx0cyh7fSx0LG0udGVtcGxhdGVTZXR0aW5ncyk7dmFyIGU9UmVnRXhwKFsodC5lc2NhcGV8fEspLnNvdXJjZSwodC5pbnRlcnBvbGF0ZXx8Sykuc291cmNlLCh0LmV2YWx1YXRlfHxLKS5zb3VyY2VdLmpvaW4oXCJ8XCIpK1wifCRcIixcImdcIiksdT0wLGk9XCJfX3ArPSdcIjtuLnJlcGxhY2UoZSxmdW5jdGlvbih0LHIsZSxvLGEpe3JldHVybiBpKz1uLnNsaWNlKHUsYSkucmVwbGFjZShELEwpLHU9YSt0Lmxlbmd0aCxyP2krPVwiJytcXG4oKF9fdD0oXCIrcitcIikpPT1udWxsPycnOl8uZXNjYXBlKF9fdCkpK1xcbidcIjplP2krPVwiJytcXG4oKF9fdD0oXCIrZStcIikpPT1udWxsPycnOl9fdCkrXFxuJ1wiOm8mJihpKz1cIic7XFxuXCIrbytcIlxcbl9fcCs9J1wiKSx0fSksaSs9XCInO1xcblwiLHQudmFyaWFibGV8fChpPVwid2l0aChvYmp8fHt9KXtcXG5cIitpK1wifVxcblwiKSxpPVwidmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLFwiK1wicHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTtcXG5cIitpK1wicmV0dXJuIF9fcDtcXG5cIjt0cnl7dmFyIG89bmV3IEZ1bmN0aW9uKHQudmFyaWFibGV8fFwib2JqXCIsXCJfXCIsaSl9Y2F0Y2goYSl7dGhyb3cgYS5zb3VyY2U9aSxhfXZhciBjPWZ1bmN0aW9uKG4pe3JldHVybiBvLmNhbGwodGhpcyxuLG0pfSxmPXQudmFyaWFibGV8fFwib2JqXCI7cmV0dXJuIGMuc291cmNlPVwiZnVuY3Rpb24oXCIrZitcIil7XFxuXCIraStcIn1cIixjfSxtLmNoYWluPWZ1bmN0aW9uKG4pe3ZhciB0PW0obik7cmV0dXJuIHQuX2NoYWluPSEwLHR9O3ZhciBQPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4uX2NoYWluP20odCkuY2hhaW4oKTp0fTttLm1peGluPWZ1bmN0aW9uKG4pe20uZWFjaChtLmZ1bmN0aW9ucyhuKSxmdW5jdGlvbih0KXt2YXIgcj1tW3RdPW5bdF07bS5wcm90b3R5cGVbdF09ZnVuY3Rpb24oKXt2YXIgbj1bdGhpcy5fd3JhcHBlZF07cmV0dXJuIGYuYXBwbHkobixhcmd1bWVudHMpLFAodGhpcyxyLmFwcGx5KG0sbikpfX0pfSxtLm1peGluKG0pLG0uZWFjaChbXCJwb3BcIixcInB1c2hcIixcInJldmVyc2VcIixcInNoaWZ0XCIsXCJzb3J0XCIsXCJzcGxpY2VcIixcInVuc2hpZnRcIl0sZnVuY3Rpb24obil7dmFyIHQ9b1tuXTttLnByb3RvdHlwZVtuXT1mdW5jdGlvbigpe3ZhciByPXRoaXMuX3dyYXBwZWQ7cmV0dXJuIHQuYXBwbHkocixhcmd1bWVudHMpLFwic2hpZnRcIiE9PW4mJlwic3BsaWNlXCIhPT1ufHwwIT09ci5sZW5ndGh8fGRlbGV0ZSByWzBdLFAodGhpcyxyKX19KSxtLmVhY2goW1wiY29uY2F0XCIsXCJqb2luXCIsXCJzbGljZVwiXSxmdW5jdGlvbihuKXt2YXIgdD1vW25dO20ucHJvdG90eXBlW25dPWZ1bmN0aW9uKCl7cmV0dXJuIFAodGhpcyx0LmFwcGx5KHRoaXMuX3dyYXBwZWQsYXJndW1lbnRzKSl9fSksbS5wcm90b3R5cGUudmFsdWU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fd3JhcHBlZH0sbS5wcm90b3R5cGUudmFsdWVPZj1tLnByb3RvdHlwZS50b0pTT049bS5wcm90b3R5cGUudmFsdWUsbS5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIlwiK3RoaXMuX3dyYXBwZWR9LFwiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZCYmZGVmaW5lKFwidW5kZXJzY29yZVwiLFtdLGZ1bmN0aW9uKCl7cmV0dXJuIG19KX0pLmNhbGwodGhpcyk7Il19
