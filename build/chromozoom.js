(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/***************************************************/
//                                                 //
// Welcome to ChromoZoom!                          //
//                                                 //
// This is the JavaScript entry point which is     //
// built into the final application by browserify  //
//                                                 //
// For information on installing, see ../README.md //
// (c) 2016 Theodore Pak, AGPL, see ../LICENSE     //
//                                                 //
/***************************************************/

require('./jquery.min.js')(window);
var jQuery = window['$'] = window.jQuery;

require('./ui/jquery-ui.min.js')(jQuery);
require('./ui/jquery-ui.touch-punch.js')(jQuery);

window._ = require('./underscore.min.js');

require('./custom/CustomTracks.js')(window);
require('./custom/CustomGenomes.js')(window);

require('./ui/jquery-ui.genobrowser.js')(jQuery);
},{"./custom/CustomGenomes.js":3,"./custom/CustomTracks.js":5,"./jquery.min.js":24,"./ui/jquery-ui.genobrowser.js":25,"./ui/jquery-ui.min.js":28,"./ui/jquery-ui.touch-punch.js":29,"./underscore.min.js":34}],2:[function(require,module,exports){
// ================================================================================================
// = CustomGenome represents a genome specification that can produce options for $.ui.genobrowser =
// ================================================================================================

module.exports = function(global) {

var _ = require('../underscore.min.js');

var utils = require('./genome-formats/utils/utils.js'),
  deepClone = utils.deepClone,
  log10 = utils.log10,
  roundToPlaces = utils.roundToPlaces;

function CustomGenome(givenFormat, metadata) {    
  // givenFormat = false --> this is an empty CustomGenome that will be hydrated with values from a serialized object
  if (givenFormat === false) { return; } 
  
  this._parsed = false;
  this._format = (givenFormat && givenFormat.toLowerCase()) || "chromsizes";
  var format = this.format();
  if (format === null) { throw new Error("Unsupported genome format '"+format+"' encountered"); }
  
  // this.opts holds everything that $.ui.genobrowser will need to construct a view (see CustomGenome.defaults below)
  // it DOES NOT relate to "options" for parsing, or how the genome is being interpreted, or anything like that
  this.opts = _.extend({}, deepClone(this.constructor.defaults), deepClone(format.defaults || {}));
  
  // this.metadata holds information external to the parsed text passed in from the browser (e.g. filename, source)
  this.metadata = metadata;
  
  // this.data holds anything additionally parsed from the genome file (metadata, references, etc.)
  // typically this is arranged per contig, in the arrangement of this.data.contigs[i]. ...
  this.data = {
    sequence: "" // the full concatenated sequence for all contigs in this genome, if available
  };
  
  // can we call .getSequence on this CustomGenome?
  this.canGetSequence = false;
  
  if(format.init) { format.init.call(this); }
}

CustomGenome.defaults = {
  // The following keys should be overridden while parsing the genome file
  genome: '_blank',
  species: 'Blank Genome',
  assemblyDate: '',
  tileDir: null,
  overzoomBppps: [],
  ntsBelow: [1, 0.1],
  availTracks: [
    {
      fh: {},        // "fixed heights" above which a density is forced to display above a certain track height
                     //    formatted like {"1.00e+05":{"dense":15}}
      n: "ruler",    // short unique name for the track
      s: ["dense"],  // possible densities for tiles, e.g. ["dense", "squish", "pack"]
      h: 25          // starting height in px
    }
  ],
  genomeSize: 0,
  chrLengths: {},
  chrOrder: [],
  chrBands: null,
  tileWidth: 1000,
  subdirForBpppsUnder: 330,
  ideogramsAbove: 1000,
  maxNtRequest: 20000,
  tracks: [{n: "ruler"}],
  trackDesc: {
    ruler: {
      cat: "Mapping and Sequencing Tracks",
      sm: "Base Position"
    }
  },
  // These last three will be overridden using knowledge of the window's width
  bppps: [],
  bpppNumbersBelow: [],
  initZoom: null
};

CustomGenome.formats = {
  chromsizes: require('./genome-formats/chromsizes.js'),
  fasta: require('./genome-formats/fasta.js'),
  genbank: require('./genome-formats/genbank.js'),
  embl: null // TODO. Basically genbank with extra columns.
}

CustomGenome.prototype.parse = function() {
  this.format().parse.apply(this, _.toArray(arguments));
  this.setGenomeString();
  this._parsed = true;
};

CustomGenome.prototype.format = function(format) {
  var self = this;
  if (_.isUndefined(format)) { format = self._format; }
  var FormatWrapper = function() { _.extend(this, self.constructor.formats[format]); return this; };
  FormatWrapper.prototype = self;
  return new FormatWrapper();
};

CustomGenome.prototype.setGenomeString = function() {
  var self = this,
    o = self.opts,
    exceptions = ['file', 'igb', 'acc', 'url', 'ucsc'],
    exception = _.find(exceptions, function(v) { return !_.isUndefined(self.metadata[v]); }),
    pieces = [];
  if (exception) { o.genome = exception + ":" + self.metadata[exception]; }
  else {
    pieces = ['custom' + (self.metadata.name ? ':' + self.metadata.name : '')];
    _.each(o.chrOrder, function(chr) {
      pieces.push(chr + ':' + o.chrLengths[chr]);
    });
    o.genome = pieces.join('|');
  }
};

// Some of the options for $.ui.genobrowser (all r/t zoom levels) must be set based on the width of the window
//   They are .bppps, .bpppNumbersBelow, and .initZoom
//   They do not affect any of the other options set during parsing.
//
// windowOpts MUST include a property, .width, that is the window.innerWidth
CustomGenome.prototype.setBppps = function(windowOpts) {
  windowOpts = windowOpts || {};
  
  var o = this.opts,
    windowWidth = (windowOpts.width * 0.6) || 1000,
    bppp = Math.round(o.genomeSize / windowWidth),
    lowestBppp = windowOpts.lowestBppp || 0.1,
    maxBppps = 100,
    bppps = [], i = 0, log;
  
  // comparable to part of UCSCClient#make_config in lib/ucsc_stitch.rb
  while (bppp >= lowestBppp && i < maxBppps) {
    bppps.push(bppp);
    log = roundToPlaces(log10(bppp), 4);
    bppp = (Math.ceil(log) - log < 0.481) ? 3.3 * Math.pow(10, Math.ceil(log) - 1) : Math.pow(10, Math.floor(log));
    i++;
  }
  o.bppps = bppps;
  o.bpppNumbersBelow = bppps.slice(0, 2);
  o.initZoom = bppps[0];
};

// Construct a complete configuration for $.ui.genobrowser based on the information parsed from the genome file
// which should be mostly in this.opts, excepting those related to zoom levels, which can be set now.
// (see CustomGenome.defaults above for what a base configuration looks like)
//
// windowOpts MUST include include the property .width which is the window.innerWidth
CustomGenome.prototype.options = function(windowOpts) {
  if (!this._parsed) { throw "Cannot generate options before parsing the genome file"; }
  this.setBppps(windowOpts);
  this.opts.custom = this;   // same convention as custom tracks in self.availTracks in chromozoom.js
  return this.opts;
};

// Fetch the sequence, if available, between left and right, and optionally pass it to the callback.
CustomGenome.prototype.getSequence = function(left, right, callback) {
  var seq = this.data.sequence.substring(left - 1, right - 1);
  return _.isFunction(callback) ? callback(seq) : seq; 
};

CustomGenome.prototype.getSequenceAsync = function() {
  global.CustomGenomes.async(this, 'getSequence', arguments, [this.id]);
};

return CustomGenome;

};
},{"../underscore.min.js":34,"./genome-formats/chromsizes.js":6,"./genome-formats/fasta.js":7,"./genome-formats/genbank.js":8,"./genome-formats/utils/utils.js":9}],3:[function(require,module,exports){
module.exports = (function(global){
  
  var _ = require('../underscore.min.js');
  if (!global.CustomTracks) { require('./CustomTracks.js')(global); }
  
  // The class that represents a singular custom genome object
  var CustomGenome = require('./CustomGenome')(global);
  
  // ================================================================
  // = CustomGenomes, the module exported to the global environment =
  // ================================================================
  //
  // Broadly speaking this is a factory for CustomGenome objects that can delegate the
  // work of parsing to a Web Worker thread.
  
  var CustomGenomes = {
    parse: function(text, metadata) {
      metadata = metadata || {};
      if (!metadata.format) { metadata.format = this.guessFormat(text); }
      var genome = new CustomGenome(metadata.format, metadata);
      genome.parse(text);
      return genome;
    },
    
    blank: function() {
      var genome = new CustomGenome("chromsizes", {species: "Blank Genome"});
      genome.parse("blank\t50000");
      return genome;
    },
    
    guessFormat: function(text) {
      if (text.substring(0, 5) == 'LOCUS') { return "genbank"; }
      if (/^[A-Z]{2} {3}/.test(text)) { return "embl"; }
      if (/^[>;]/.test(text)) { return "fasta"; }
      // default is fasta
      return "fasta";
    },
    
    error: function(e) {
      // Can be overridden by a parent library to handle errors more gracefully.
      console.log(e);
    },
    
    _workerScript: 'build/CustomGenomeWorker.js',
    _disableWorkers: false,
    worker: global.CustomTracks.worker,
    
    async: global.CustomTracks.async,
    
    parseAsync: function() {
      this.async(this, 'parse', arguments, [], function(genome) {
        // This has been serialized, so it must be hydrated into a real CustomGenome object.
        // We replace .getSequence() with an asynchronous version.
        return _.extend(new CustomGenome(false), genome, {
          getSequence: function() { CustomGenome.prototype.getSequenceAsync.apply(this, arguments); }
        });
      });
    }
  };
  
  global.CustomGenomes = CustomGenomes;
  
});
},{"../underscore.min.js":34,"./CustomGenome":2,"./CustomTracks.js":5}],4:[function(require,module,exports){
// =============================================================================
// = CustomTrack, an object representing a custom track as understood by UCSC. =
// =============================================================================
//
// This class *does* depend on global objects and therefore must be required as a 
// function that is executed on the global object.

module.exports = function(global) {

var _ = require('../underscore.min.js');

var utils = require('./track-types/utils/utils.js'),
  parseInt10 = utils.parseInt10;

function CustomTrack(opts, browserOpts) {
  if (!opts) { return; } // This is an empty customTrack that will be hydrated with values from a serialized object
  this._type = (opts.type && opts.type.toLowerCase()) || "bed";
  var type = this.type();
  if (type === null) { throw new Error("Unsupported track type '"+opts.type+"' encountered on line " + opts.lineNum); }
  this.opts = _.extend({}, this.constructor.defaults, type.defaults || {}, opts);
  _.extend(this, {
    browserOpts: browserOpts,
    stretchHeight: false,
    heights: {},
    sizes: ['dense'],
    mapSizes: [],
    areas: {},
    noAreaLabels: false,
    expectsSequence: false
  });
  this.init();
}

CustomTrack.defaults = {
  name: 'User Track',
  description: 'User Supplied Track',
  color: '0,0,0'
};

CustomTrack.types = {
  bed: require('./track-types/bed.js'),
  featuretable: require('./track-types/featuretable.js'),
  bedgraph: require('./track-types/bedgraph.js'),
  wiggle_0: require('./track-types/wiggle_0.js'),
  vcftabix: require('./track-types/vcftabix.js'),
  bigbed: require('./track-types/bigbed.js'),
  bam: require('./track-types/bam.js'),
  bigwig: require('./track-types/bigwig.js')
};

// ==========================================================================
// = bedDetail format: https://genome.ucsc.edu/FAQ/FAQformat.html#format1.7 =
// ==========================================================================  

CustomTrack.types.beddetail = _.clone(CustomTrack.types.bed);
CustomTrack.types.beddetail.defaults = _.extend({}, CustomTrack.types.beddetail.defaults, {detail: true});

// These functions branch to different methods depending on the .type() of the track
_.each(['init', 'parse', 'render', 'renderSequence', 'prerender'], function(fn) {
  CustomTrack.prototype[fn] = function() {
    var args = _.toArray(arguments),
      type = this.type();
    if (!type[fn]) { return false; }
    return type[fn].apply(this, args);
  }
});

CustomTrack.prototype.loadOpts = function($dialog) {
  var type = this.type(),
    o = this.opts;
  $dialog.find('.custom-opts-form').hide();
  $dialog.find('.custom-opts-form.'+this._type).show();
  $dialog.find('.custom-name').text(o.name);
  $dialog.find('.custom-desc').text(o.description);
  $dialog.find('.custom-format').text(this._type);
  $dialog.find('[name=color]').val(o.color).change();
  if (type.loadOpts) { type.loadOpts.call(this, $dialog); }
  $dialog.find('.enabler').change();
};

CustomTrack.prototype.saveOpts = function($dialog) {
  var type = this.type(),
    o = this.opts;
  o.color = $dialog.find('[name=color]').val();
  if (!this.validateColor(o.color)) { o.color = '0,0,0'; }
  if (type.saveOpts) { type.saveOpts.call(this, $dialog); }
  this.applyOpts();
  global.CustomTracks.worker() && this.applyOptsAsync(); // Apply the changes to the worker too!
};

CustomTrack.prototype.applyOpts = function(opts) {
  var type = this.type();
  if (opts) { this.opts = opts; }
  if (type.applyOpts) { type.applyOpts.call(this); }
};

CustomTrack.prototype.erase = function(canvas) {
  var self = this,
    ctx = canvas.getContext && canvas.getContext('2d');
  if (ctx) { ctx.clearRect(0, 0, canvas.width, canvas.height); }
}

CustomTrack.prototype.type = function(type) {
  if (_.isUndefined(type)) { type = this._type; }
  return this.constructor.types[type] || null;
};

CustomTrack.prototype.warn = function(warning) {
  if (this.opts.strict) {
    throw new Error(warning);
  } else {
    if (!this.warnings) { this.warnings = []; }
    this.warnings.push(warning);
  }
};

CustomTrack.prototype.isOn = function(val) {
  return /^(on|yes|true|t|y|1)$/i.test(val.toString());
};

CustomTrack.prototype.chrList = function() {
  if (!this._chrList) {
    this._chrList = _.sortBy(_.map(this.browserOpts.chrPos, function(pos, chr) { return [pos, chr]; }), function(v) { return v[0]; });
  }
  return this._chrList;
}

CustomTrack.prototype.chrAt = function(pos) {
  var chrList = this.chrList(),
    chrIndex = _.sortedIndex(chrList, [pos], function(v) { return v[0]; }),
    chr = chrIndex > 0 ? chrList[chrIndex - 1][1] : null;
  return {i: chrIndex - 1, c: chr, p: pos - this.browserOpts.chrPos[chr]};
};

CustomTrack.prototype.chrRange = function(start, end) {
  var chrLengths = this.browserOpts.chrLengths,
    startChr = this.chrAt(start),
    endChr = this.chrAt(end),
    range;
  if (startChr.c && startChr.i === endChr.i) { return [startChr.c + ':' + startChr.p + '-' + endChr.p]; }
  else {
    range = _.map(this.chrList().slice(startChr.i + 1, endChr.i), function(v) {
      return v[1] + ':1-' + chrLengths[v[1]];
    });
    startChr.c && range.unshift(startChr.c + ':' + startChr.p + '-' + chrLengths[startChr.c]);
    endChr.c && range.push(endChr.c + ':1-' + endChr.p);
    return range;
  }
}

CustomTrack.prototype.prerenderAsync = function() {
  global.CustomTracks.async(this, 'prerender', arguments, [this.id]);
};

CustomTrack.prototype.applyOptsAsync = function() {
  global.CustomTracks.async(this, 'applyOpts', [this.opts, function(){}], [this.id]);
};

CustomTrack.prototype.ajaxDir = function() {
  // Web Workers fetch URLs relative to the JS file itself.
  return (global.HTMLDocument ? '' : '../') + this.browserOpts.ajaxDir;
};

CustomTrack.prototype.rgbToHsl = function(r, g, b) {
  r /= 255, g /= 255, b /= 255;
  var max = Math.max(r, g, b), min = Math.min(r, g, b);
  var h, s, l = (max + min) / 2;

  if (max == min) {
    h = s = 0; // achromatic
  } else {
    var d = max - min;
    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
    switch(max){
      case r: h = (g - b) / d + (g < b ? 6 : 0); break;
      case g: h = (b - r) / d + 2; break;
      case b: h = (r - g) / d + 4; break;
    }
    h /= 6;
  }

  return [h, s, l];
}

CustomTrack.prototype.hslToRgb = function(h, s, l) {
  var r, g, b;

  if (s == 0) {
    r = g = b = l; // achromatic
  } else {
    function hue2rgb(p, q, t) {
      if(t < 0) t += 1;
      if(t > 1) t -= 1;
      if(t < 1/6) return p + (q - p) * 6 * t;
      if(t < 1/2) return q;
      if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
      return p;
    }

    var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
    var p = 2 * l - q;
    r = hue2rgb(p, q, h + 1/3);
    g = hue2rgb(p, q, h);
    b = hue2rgb(p, q, h - 1/3);
  }

  return [r * 255, g * 255, b * 255];
}

CustomTrack.prototype.validateColor = function(color) {
  var m = color.match(/(\d+),(\d+),(\d+)/);
  if (!m) { return false; }
  m.shift();
  return _.all(_.map(m, parseInt10), function(v) { return v >=0 && v <= 255; });
}

return CustomTrack;

};
},{"../underscore.min.js":34,"./track-types/bam.js":10,"./track-types/bed.js":11,"./track-types/bedgraph.js":12,"./track-types/bigbed.js":13,"./track-types/bigwig.js":14,"./track-types/featuretable.js":15,"./track-types/utils/utils.js":21,"./track-types/vcftabix.js":22,"./track-types/wiggle_0.js":23}],5:[function(require,module,exports){
module.exports = (function(global){
  
  var _ = require('../underscore.min.js');
  
  // Some utility functions.
  var utils = require('./track-types/utils/utils.js'),
    parseDeclarationLine = utils.parseDeclarationLine;
  
  // The class that represents a singular custom track object
  var CustomTrack = require('./CustomTrack.js')(global);

  // ========================================================================
  // = CustomTracks, the module that is exported to the global environment. =
  // ========================================================================
  //
  // Broadly speaking this is a factory for parsing data into CustomTrack objects,
  // and it can delegate this work to a worker thread.

  var CustomTracks = {
    parse: function(chunks, browserOpts) {
      var customTracks = [],
        data = [],
        track, opts, m;
      
      if (typeof chunks == "string") { chunks = [chunks]; }
      
      function pushTrack() {
        if (track.parse(data)) { customTracks.push(track); }
      }
      
      customTracks.browser = {};
      _.each(chunks, function(text) {
        _.each(text.split("\n"), function(line, lineno) {
          if (/^#/.test(line)) {
            // comment line
          } else if (/^browser\s+/.test(line)) {
            // browser lines
            m = line.match(/^browser\s+(\w+)\s+(\S*)/);
            if (!m) { throw new Error("Could not parse browser line found at line " + (lineno + 1)); }
            customTracks.browser[m[1]] = m[2];
          } else if (/^track\s+/i.test(line)) {
            if (track) { pushTrack(); }
            opts = parseDeclarationLine(line, (/^track\s+/i));
            if (!opts) { throw new Error("Could not parse track line found at line " + (lineno + 1)); }
            opts.lineNum = lineno + 1;
            track = new CustomTrack(opts, browserOpts);
            data = [];
          } else if (/\S/.test(line)) {
            if (!track) { throw new Error("Found data on line "+(lineno+1)+" but no preceding track definition"); }
            data.push(line);
          }
        });
      });
      if (track) { pushTrack(); }
      return customTracks;
    },
    
    parseDeclarationLine: parseDeclarationLine,
    
    error: function(e) {
      // Can be overridden by a parent library to handle errors more gracefully.
      // Note: this is overridden by ui.genobrowser during UI setup.
      console.log(e);
    },
    
    _workerScript: 'build/CustomTrackWorker.js',
    // NOTE: To temporarily disable Web Worker usage, set this to true.
    _disableWorkers: false,
    
    worker: function() { 
      var self = this,
        callbacks = [];
      if (!self._worker && global.Worker) { 
        self._worker = new global.Worker(self._workerScript);
        self._worker.addEventListener('error', function(e) { self.error(e); }, false);
        self._worker.addEventListener('message', function(e) {
          if (e.data.log) { console.log(JSON.parse(e.data.log)); return; }
          if (e.data.error) {
            if (e.data.id) { callbacks[e.data.id] = null; }
            self.error(JSON.parse(e.data.error));
            return;
          }
          callbacks[e.data.id](JSON.parse(e.data.ret));
          callbacks[e.data.id] = null;
        });
        self._worker.call = function(op, args, callback) {
          var id = callbacks.push(callback) - 1;
          this.postMessage({op: op, id: id, args: args});
        };
        // To have the worker throw errors instead of passing them nicely back, call this with toggle=true
        self._worker.throwErrors = function(toggle) {
          this.postMessage({op: 'throwErrors', args: [toggle]});
        };
      }
      return self._disableWorkers ? null : self._worker;
    },
    
    async: function(self, fn, args, asyncExtraArgs, wrapper) {
      args = _.toArray(args);
      wrapper = wrapper || _.identity;
      var argsExceptLastOne = _.initial(args),
        callback = _.last(args),
        w = this.worker();
      // Fallback if web workers are not supported.
      // This could also be tweaked to not use web workers when there would be no performance gain;
      //   activating this branch disables web workers entirely and everything happens synchronously.
      if (!w) { return callback(self[fn].apply(self, argsExceptLastOne)); }
      Array.prototype.unshift.apply(argsExceptLastOne, asyncExtraArgs);
      w.call(fn, argsExceptLastOne, function(ret) { callback(wrapper(ret)); });
    },
    
    parseAsync: function() {
      this.async(this, 'parse', arguments, [], function(tracks) {
        // These have been serialized, so they must be hydrated into real CustomTrack objects.
        // We replace .prerender() with an asynchronous version.
        return _.map(tracks, function(t) {
          return _.extend(new CustomTrack(), t, {
            prerender: function() { CustomTrack.prototype.prerenderAsync.apply(this, arguments); }
          });
        });
      });
    }
  };

  global.CustomTracks = CustomTracks;

});
},{"../underscore.min.js":34,"./CustomTrack.js":4,"./track-types/utils/utils.js":21}],6:[function(require,module,exports){
(function (global){
// ====================================================================
// = chrom.sizes format: http://www.broadinstitute.org/igv/chromSizes =
// ====================================================================
// Note: we are extending the general use of this to include data loaded from the genome.txt and annots.xml
// files of an IGB quickload directory,

var utils = require('./utils/utils.js'),
  parseInt10 = utils.parseInt10,
  strip = utils.strip,
  optsAsTrackLine = utils.optsAsTrackLine;

var ChromSizesFormat = {
  init: function() {
    var self = this,
      m = self.metadata,
      o = self.opts;
    o.species = m.species || 'Custom Genome';
    o.assemblyDate = m.assemblyDate || '';
    
    // TODO: if metadata also contains custom track data, e.g. from annots.xml
    // must convert them into items for o.availTracks, o.tracks, and o.trackDesc
    // The o.availTracks items should contain {customData: tracklines} to be parsed
    if (m.tracks) { self.format().createTracks(m.tracks); }
  },
  
  createTracks: function(tracks) {
    var self = this,
      o = self.opts;
      
    _.each(tracks, function(t) {
      var trackOpts;
      t.lines = t.lines || [];
      trackOpts = /^track\s+/i.test(t.lines[0]) ? global.CustomTracks.parseDeclarationLine(t.lines.shift()) : {};
      t.lines.unshift('track ' + optsAsTrackLine(_.extend(trackOpts, t.opts, {name: t.name, type: t.type})) + '\n');
      o.availTracks.push({
        fh: {},
        n: t.name,
        s: ['dense', 'squish', 'pack'],
        h: 15,
        m: ['pack'],
        customData: t.lines
      });
      o.tracks.push({n: t.name});
      o.trackDesc[t.name] = {
        cat: "Feature Tracks",
        sm: t.name,
        lg: t.description || t.name
      };
    });
  },
  
  parse: function(text) {
    var lines = text.split("\n"),
      o = this.opts;
    _.each(lines, function(line, i) {
      var chrsize = strip(line).split(/\s+/, 2),
        chr = chrsize[0],
        size = parseInt10(chrsize[1]);
      if (_.isNaN(size)) { return; }
      o.chrOrder.push(chr);
      o.chrLengths[chr] = size;
      o.genomeSize += size;
    });
  }
};

module.exports = ChromSizesFormat;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./utils/utils.js":9}],7:[function(require,module,exports){
// ===========================================================
// = FASTA format: http://en.wikipedia.org/wiki/FASTA_format =
// ===========================================================

var utils = require('./utils/utils.js'),
  ensureUnique = utils.ensureUnique;

var FastaFormat = {
  init: function() {
    var self = this,
      m = self.metadata,
      o = self.opts;
      
    self.data = {};
  },
  
  parse: function(text) {
    var lines = text.split("\n"),
      self = this,
      o = self.opts,
      chr = null,
      unnamedCounter = 1,
      chrseq = [];
      
    self.data.sequence = [];
    
    _.each(lines, function(line, i) {
      var chrLine = line.match(/^[>;](.+)/),
        cleanedLine = line.replace(/\s+/g, '');
      if (chrLine) {
        chr = chrLine[1].replace(/^\s+|\s+$/g, '');
        if (!chr.length) { chr = "unnamedChr"; }
        chr = ensureUnique(chr, o.chrLengths);
        o.chrOrder.push(chr);
      } else {
        self.data.sequence.push(cleanedLine);
        o.chrLengths[chr] = (o.chrLengths[chr] || 0) + cleanedLine.length;
        o.genomeSize += cleanedLine.length;
      }
    });
    
    self.data.sequence = self.data.sequence.join('');
    self.canGetSequence = true;
  }
};

module.exports = FastaFormat;
},{"./utils/utils.js":9}],8:[function(require,module,exports){

// =========================================================================
// = GenBank format: http://www.ncbi.nlm.nih.gov/Sitemap/samplerecord.html =
// =========================================================================

var utils = require('./utils/utils.js'),
  parseInt10 = utils.parseInt10,
  strip = utils.strip,
  topTagsAsArray = utils.topTagsAsArray,
  subTagsAsArray = utils.subTagsAsArray,
  fetchField = utils.fetchField,
  getTag = utils.getTag,
  ensureUnique = utils.ensureUnique;

var GenBankFormat = {
  init: function() {
    // Note that we call GenBank field names like "LOCUS", "DEFINITION", etc. tags instead of keys.
    // We do this because: 1) certain field names can be repeated (e.g. REFERENCE) which is more 
    // evocative of "tags" as opposed to the behavior of keys in a hash.  Also, 2) this is the
    // nomenclature picked by BioRuby.
    
    this.tagSize = 12; // how wide the column for tags is in a GenBank file
    this.featureTagSize = 21; // how wide the column for tags is in the feature table section
                              // see section 4.1 of http://www.insdc.org/files/feature_table.html
    
    this.data = {
      contigs: [],
      trackLines: {
        source: [],
        genes: [],
        other: []
      }
    };
  },
  
  parseLocus: function(contig) {
    var locusLine = contig.orig.locus;
    if (locusLine) {
      if (locusLine.length > 75) { // after Rel 126.0
        contig.entryId  = strip(locusLine.substring(12, 28));
        contig.length   = parseInt10(locusLine.substring(29, 40));
        contig.strand   = strip(locusLine.substring(44, 47));
        contig.natype   = strip(locusLine.substring(47, 53));
        contig.circular = strip(locusLine.substring(55, 63));
        contig.division = strip(locusLine.substring(63, 67));
        contig.date     = strip(locusLine.substring(68, 79));
      } else {
        contig.entryId  = strip(locusLine.substring(12, 22));
        contig.length   = parseInt10(locusLine.substring(22, 30));
        contig.strand   = strip(locusLine.substring(33, 36));
        contig.natype   = strip(locusLine.substring(36, 40));
        contig.circular = strip(locusLine.substring(42, 52));
        contig.division = strip(locusLine.substring(52, 55));
        contig.date     = strip(locusLine.substring(62, 73));
      }
    }
  },
  
  parseHeaderFields: function(contig) {
    var tagSize = this.tagSize,
      headerFieldsToParse = {
        simple: ['definition', 'accession', 'version'],
        deep: ['source'] // could add references, but we don't care about those here
      };
    
    // Parse simple fields (tag --> content)
    _.each(headerFieldsToParse.simple, function(tag) {
      if (!contig.orig[tag]) { contig[tag] = null; return; }
      contig[tag] = fetchField(contig.orig[tag], tagSize);
    });
    
    // Parse tags that can repeat and have subtags
    _.each(headerFieldsToParse.deep, function(tag) {
      var data = [],
        items;
      if (!contig.orig[tag]) { contig[tag] = null; return; }
      
      items = contig.orig[tag].replace(/\n([A-Za-z\/\*])/g, "\n\001$1").split("\001");
      _.each(items, function(item) {
        var subTags = subTagsAsArray(item, tagSize),
          itemName = fetchField(subTags.shift(), tagSize), 
          itemData = {_name: itemName};
        _.each(subTags, function(subTagField) {
          var tag = getTag(subTagField, tagSize);
          itemData[tag] = fetchField(subTagField, tagSize);
        });
        data.push(itemData);
      });
      contig[tag] = data;
      
    });
  },
  
  parseFeatureTable: function(chr, contigData) {
    var self = this,
      tagSize = self.tagSize,
      featureTagSize = self.featureTagSize,
      tagsToSkip = ["features"],
      tagsRelatedToGenes = ["cds", "gene", "mrna", "exon", "intron"],
      contigLine = "ACCESSION   " + chr + "\n";
    if (contigData.orig.features) {
      var subTags = subTagsAsArray(contigData.orig.features, tagSize);
      self.data.trackLines.source.push(contigLine);
      self.data.trackLines.genes.push(contigLine);
      self.data.trackLines.other.push(contigLine);
      _.each(subTags, function(subTagField) {
        var tag = getTag(subTagField, featureTagSize);
        if (tagsToSkip.indexOf(tag) !== -1) { return; }
        else if (tag === "source") { self.data.trackLines.source.push(subTagField); }
        else if (tagsRelatedToGenes.indexOf(tag) !== -1) { self.data.trackLines.genes.push(subTagField);  }
        else { self.data.trackLines.other.push(subTagField); }
      });
    }
  },
  
  parseSequence: function(contigData) {
    if (contigData.orig.origin) {
      return contigData.orig.origin.replace(/^origin.*|\n[ 0-9]{10}| /ig, '');
    } else {
      return Array(contigData.length).join('n');
    }
  },
  
  createTracksFromFeatures: function() {
    var self = this,
      o = self.opts,
      categoryTuples = [
        ["source", "Sources", "Regions annotated by source organism or specimen"], 
        ["genes", "Gene annotations", "CDS and gene features"], 
        ["other", "Other annotations", "tRNAs and other features"]
      ];
    
    // For the categories of features, create appropriate entries in o.availTracks, o.tracks, and o.trackDesc
    // Leave the actual data as arrays of lines that are attached as .customData to o.availTracks
    // They will be parsed later via CustomTracks.parse.
    _.each(categoryTuples, function(categoryTuple) {
      var category = categoryTuple[0],
        label = categoryTuple[1],
        longLabel = categoryTuple[2],
        trackLines = [];
      if (self.data.trackLines[category].length > 0) {
        self.data.trackLines[category].unshift('track type="featureTable" name="' + label + 
          '" collapseByGene="' + (category=="genes" ? 'on' : 'off') + '"\n');
      }
      o.availTracks.push({
        fh: {},
        n: category,
        s: ['dense', 'squish', 'pack'],
        h: 15,
        m: ['pack'],
        customData: self.data.trackLines[category]
      });
      o.tracks.push({n: category});
      o.trackDesc[category] = {
        cat: "Feature Tracks",
        sm: label,
        lg: longLabel
      };
    });
  },
  
  parse: function(text) {
    var self = this,
      o = self.opts,
      contigDelimiter = "\n//\n",
      contigs = text.split(contigDelimiter),
      firstContig = null;
    
    self.data.sequence = [];
      
    _.each(contigs, function(contig) {
      if (!strip(contig).length) { return; }
                           
      var contigData = {orig: {}},
        chr, size, contigSequence;
      
      // Splits on any lines with a character in the first column
      _.each(topTagsAsArray(contig), function(field) {
        var tag = getTag(field, self.tagSize);
        if (_.isUndefined(contigData.orig[tag])) { contigData.orig[tag] = field; }
        else { contigData.orig[tag] += field; }
      });
      
      self.data.contigs.push(contigData);
      self.format().parseLocus(contigData);
      self.format().parseHeaderFields(contigData);
      contigSequence = self.format().parseSequence(contigData);
      
      chr = contigData.accession && contigData.accession != 'unknown' ? contigData.accession : contigData.entryId;
      chr = ensureUnique(chr, o.chrLengths);
      
      if (contigData.length) {
        size = contigData.length;
        if (size != contigSequence.length) {
          throw new Error("Sequence data for contig "+chr+" does not match length "+size+"bp from header");
        }
      } else {
        size = contigSequence.length;
      }
      
      o.chrOrder.push(chr);
      o.chrLengths[chr] = size;
      o.genomeSize += size;
      
      self.format().parseFeatureTable(chr, contigData);
      self.data.sequence.push(contigSequence);
      
      firstContig = firstContig || contigData;
    });
    
    self.data.sequence = self.data.sequence.join('');
    self.canGetSequence = true;
    self.format().createTracksFromFeatures();
    
    o.species = firstContig.source ? firstContig.source[0].organism.split("\n")[0] : 'Custom Genome';
    if (firstContig.date) { o.assemblyDate = firstContig.date; }
  }
  
};

module.exports = GenBankFormat;
},{"./utils/utils.js":9}],9:[function(require,module,exports){
var trackUtils = require('../../track-types/utils/utils.js');

module.exports.parseInt10 = trackUtils.parseInt10;

module.exports.deepClone = function(obj) { return JSON.parse(JSON.stringify(obj)); }

module.exports.log10 = function(val) { return Math.log(val) / Math.LN10; }

var strip = module.exports.strip = trackUtils.strip;

module.exports.roundToPlaces = function(num, dec) { return Math.round(num * Math.pow(10, dec)) / Math.pow(10, dec); }

/****
 * These functions are common subroutines for parsing GenBank and other formats based on column positions
 ****/

// Splits a multiline string before the lines that contain a character in the first column
// (a "top tag") in a GenBank-style text file
module.exports.topTagsAsArray = function(field) {
  return field.replace(/\n([A-Za-z\/\*])/g, "\n\001$1").split("\001");
}

// Splits a multiline string before the lines that contain a character not in the first column
// but within the next tagSize columns, which is a "sub tag" in a GenBank-style text file
module.exports.subTagsAsArray = function(field, tagSize) {
  if (!isFinite(tagSize) || tagSize < 2) { throw "invalid tagSize"; }
  var re = new RegExp("\\n(\\s{1," + (tagSize - 1) + "}\\S)", "g");
  return field.replace(re, "\n\001$1").split("\001");
}

// Returns a new string with the first tagSize columns from field removed
module.exports.fetchField = function(field, tagSize) {
  if (!isFinite(tagSize) || tagSize < 1) { throw "invalid tagSize"; }
  var re = new RegExp("(^|\\n).{0," + tagSize + "}", "g");
  return strip(field.replace(re, "$1"));
}

// Gets a tag from a field by trimming it out of the first tagSize characters of the field
module.exports.getTag = function(field, tagSize) { 
  if (!isFinite(tagSize) || tagSize < 1) { throw "invalid tagSize"; }
  return strip(field.substring(0, tagSize).toLowerCase());
}

/****
 * End GenBank and column-based format helpers
 ****/

// Given a hash and a presumptive new key, appends a counter to the key until it is actually an unused key
module.exports.ensureUnique = function(key, hash) {
  var i = 1, keyCheck = key;
  while (typeof hash[keyCheck] != 'undefined') { keyCheck = key + '_' + i++; }
  return keyCheck;
}

// Given a hash with option names and values, formats it in BED track line format (similar to HTML element attributes)
module.exports.optsAsTrackLine = function(opthash) {
  return _.map(opthash, function(v, k) { return k + '="' + v.toString().replace(/"/g, '') + '"'; }).join(' ');
}
},{"../../track-types/utils/utils.js":21}],10:[function(require,module,exports){
// ==============================================================
// = BAM format: https://samtools.github.io/hts-specs/SAMv1.pdf =
// ==============================================================

var utils = require('./utils/utils.js'),
  floorHack = utils.floorHack,
  parseInt10 = utils.parseInt10,
  deepClone = utils.deepClone;
var PairedIntervalTree = require('./utils/PairedIntervalTree.js').PairedIntervalTree;
var RemoteTrack = require('./utils/RemoteTrack.js').RemoteTrack;

var BamFormat = {
  defaults: {
    chromosomes: '',
    itemRgb: 'off',
    color: '188,188,188',
    colorByStrand: '',
    useScore: 0,
    group: 'user',
    priority: 'user',
    offset: 0,
    detail: false,
    url: '',
    htmlUrl: '',
    drawLimit: {squish: 2000, pack: 2000},
    // If a nucleotide differs from the reference sequence in greater than 20% of quality weighted reads, 
    // IGV colors the bar in proportion to the read count of each base; the following changes that threshold for chromozoom
    alleleFreqThreshold: 0.2,
    optimalFetchWindow: 0,
    maxFetchWindow: 0,
    // The following can be "ensembl_ucsc" or "ucsc_ensembl" to attempt auto-crossmapping of reference contig names
    // between the two schemes, which IGV does, but is a perennial issue: https://www.biostars.org/p/10062/
    // I hope not to need all the mappings in here https://github.com/dpryan79/ChromosomeMappings but it may be necessary
    convertChrScheme: "auto",
    // Draw paired ends within a range of expected insert sizes as a continuous feature?
    // See https://www.broadinstitute.org/igv/AlignmentData#paired for how this works
    viewAsPairs: false
  },
  
  // The FLAG column for BAM/SAM is a combination of bitwise flags
  flags: {
    isReadPaired: 0x1,
    isReadProperlyAligned: 0x2,
    isReadUnmapped: 0x4,
    isMateUnmapped: 0x8,
    readStrandReverse: 0x10,
    mateStrandReverse: 0x20,
    isReadFirstOfPair: 0x40,
    isReadLastOfPair: 0x80,
    isSecondaryAlignment: 0x100,
    isReadFailingVendorQC: 0x200,
    isDuplicateRead: 0x400,
    isSupplementaryAlignment: 0x800
  },

  init: function() {
    var browserChrs = _.keys(this.browserOpts);
    if (!this.opts.bigDataUrl) {
      throw new Error("Required parameter bigDataUrl not found for BAM track at " +
          JSON.stringify(this.opts) + (this.opts.lineNum + 1));
    }
    this.browserChrScheme = this.type("bam").guessChrScheme(_.keys(this.browserOpts.chrPos));
  },
  
  // TODO: We must note that when we change opts.viewAsPairs, we *need* to throw out this.data.pileup.
  // TODO: If the pairing interval changed, we should toss the entire cache and reset the RemoteTrack bins,
  //         and blow up the areaIndex.
  applyOpts: function() {
    this.prevOpts = deepClone(this.opts);
  },
  
  guessChrScheme: function(chrs) {
    limit = Math.min(chrs.length * 0.8, 20);
    if (_.filter(chrs, function(chr) { return (/^chr/).test(chr); }).length > limit) { return 'ucsc'; }
    if (_.filter(chrs, function(chr) { return (/^\d\d?$/).test(chr); }).length > limit) { return 'ensembl'; }
    return null;
  },
  
  parse: function(lines) {
    var self = this,
      o = self.opts,
      middleishPos = self.browserOpts.genomeSize / 2,
      cache = new PairedIntervalTree(floorHack(middleishPos), {startKey: 'start', endKey: 'end'}, 
          {startKey: 'templateStart', endKey: 'templateEnd', pairedLengthKey: 'tlen', pairingKey: 'qname'}),
      ajaxUrl = self.ajaxDir() + 'bam.php',
      remote;
    
    remote = new RemoteTrack(cache, function(start, end, storeIntervals) {
      range = self.chrRange(start, end);
      // Convert automatically between Ensembl style 1, 2, 3, X <--> UCSC style chr1, chr2, chr3, chrX as configured/autodetected
      // Note that chrM is NOT equivalent to MT https://www.biostars.org/p/120042/#120058
      switch (o.convertChrScheme == "auto" ? self.data.info.convertChrScheme : o.convertChrScheme) {
        case 'ensembl_ucsc': range = _.map(range, function(r) { return r.replace(/^chr/, ''); }); break;
        case 'ucsc_ensembl': range = _.map(range, function(r) { return r.replace(/^(\d\d?|X):/, 'chr$1:'); }); break;
      }
      $.ajax(ajaxUrl, {
        data: {range: range, url: self.opts.bigDataUrl},
        success: function(data) {
          var lines = _.filter(data.split('\n'), function(l) { var m = l.match(/\t/g); return m && m.length >= 2; });
          
          // Parse the SAM format into intervals that can be inserted into the IntervalTree cache
          var intervals = _.map(lines, function(l) { return self.type('bam').parseLine.call(self, l); });
          storeIntervals(intervals);
        }
      });
    });
    
    self.data = {cache: cache, remote: remote, pileup: {}, info: {}};
    self.heights = {max: null, min: 24, start: 24};
    self.sizes = ['dense', 'squish', 'pack'];
    self.mapSizes = ['pack'];
    self.noAreaLabels = true;
    self.expectsSequence = true;
    self.renderSequenceCallbacks = {};
    self.prevOpts = deepClone(o);  // used to detect which drawing options have been changed by the user
    
    // Get general info on the bam (e.g. `samtools idxstats`, use mapped reads per reference sequence
    // to estimate maxFetchWindow and optimalFetchWindow, and setup binning on the RemoteTrack.
    $.ajax(ajaxUrl, {
      data: {url: o.bigDataUrl},
      success: function(data) {
        var mappedReads = 0,
          maxItemsToDraw = _.max(_.values(o.drawLimit)),
          bamChrs = [],
          infoParts = data.split("\n\n"),
          sampleIntervals, meanItemLength, chrScheme, meanItemsPerBp;
        
        _.each(infoParts[0].split("\n"), function(line) {
          var fields = line.split("\t"),
            readsMappedToContig = parseInt(fields[2], 10);
          if (fields.length == 1 && fields[0] == '') { return; } // blank line
          bamChrs.push(fields[0]);
          if (_.isNaN(readsMappedToContig)) { throw new Error("Invalid output for samtools idxstats on this BAM track."); }
          mappedReads += readsMappedToContig;
        });
        
        self.data.info.chrScheme = chrScheme = self.type("bam").guessChrScheme(bamChrs);
        if (chrScheme && self.browserChrScheme) {
          self.data.info.convertChrScheme = chrScheme != self.browserChrScheme ? chrScheme + '_' + self.browserChrScheme : null;
        }
        
        sampleIntervals = _.compact(_.map(infoParts[1].split("\n"), function(line) {
          return self.type('bam').parseLine.call(self, line);
        }));
        if (sampleIntervals.length) {
          meanItemLength = _.reduce(sampleIntervals, function(memo, next) { return memo + (next.end - next.start); }, 0);
          meanItemLength = meanItemLength / sampleIntervals.length;
        }
        console.log(self.browserOpts.pos);
        console.log(meanItemLength);
        // TODO: Can estimate insert sizes from TLEN - 2 * (end - start).
        
        self.data.info.meanItemsPerBp = meanItemsPerBp = mappedReads / self.browserOpts.genomeSize;
        self.data.info.meanItemLength = meanItemLength || 100;
        o.maxFetchWindow = maxItemsToDraw / meanItemsPerBp;
        o.optimalFetchWindow = Math.floor(o.maxFetchWindow / 2);
        
        // TODO: We should deactivate the pairing functionality of the PairedIntervalTree 
        //       if we don't see any paired reads in this BAM.
        //       If there is pairing, we need to tell the PairedIntervalTree what range of insert sizes
        //       should trigger pairing.
        self.data.cache.setPairingInterval(10, 5000);
        remote.setupBins(self.browserOpts.genomeSize, o.optimalFetchWindow, o.maxFetchWindow);
      }
    });
    
    return true;
  },
  
  // Sets feature.flags[...] to a human interpretable version of feature.flag (expanding the bitwise flags)
  parseFlags: function(feature, lineno) {
    feature.flags = {};
    _.each(this.type('bam').flags, function(bit, flag) {
      feature.flags[flag] = !!(feature.flag & bit);
    });
  },
  
  // Sets feature.blocks and feature.end based on feature.cigar
  // See section 1.4 of https://samtools.github.io/hts-specs/SAMv1.pdf for an explanation of CIGAR 
  parseCigar: function(feature, lineno) {        
    var cigar = feature.cigar,
      seq = feature.seq || "",
      refLen = 0,
      seqPos = 0,
      operations, lengths;
    
    feature.blocks = [];
    feature.insertions = [];
    
    ops = cigar.split(/\d+/).slice(1);
    lengths = cigar.split(/[A-Z=]/).slice(0, -1);
    if (ops.length != lengths.length) { this.warn("Invalid CIGAR '" + cigar + "' for " + feature.desc); return; }
    lengths = _.map(lengths, parseInt10);
    
    _.each(ops, function(op, i) {
      var len = lengths[i],
        block, insertion;
      if (/^[MX=]$/.test(op)) {
        // Alignment match, sequence match, sequence mismatch
        block = {start: feature.start + refLen};
        block.end = block.start + len;
        block.type = op;
        block.seq = seq.slice(seqPos, seqPos + len);
        feature.blocks.push(block);
        refLen += len;
        seqPos += len;
      } else if (/^[ND]$/.test(op)) {
        // Skipped reference region, deletion from reference
        refLen += len;
      } else if (op == 'I') {
        // Insertion
        insertion = {start: feature.start + refLen, end: feature.start + refLen};
        insertion.seq = seq.slice(seqPos, seqPos + len);
        feature.insertions.push(insertion);
        seqPos += len;
      } else if (op == 'S') {
        // Soft clipping; simply skip these bases in SEQ, position on reference is unchanged.
        seqPos += len;
      }
      // The other two CIGAR ops, H and P, are not relevant to drawing alignments.
    });
    
    feature.end = feature.start + refLen;
  },
  
  parseLine: function(line, lineno) {
    var o = this.opts,
      cols = ['qname', 'flag', 'rname', 'pos', 'mapq', 'cigar', 'rnext', 'pnext', 'tlen', 'seq', 'qual'],
      feature = {},
      fields = line.split("\t"),
      availFlags = this.type('bam').flags,
      chrPos, blockSizes;
    
    _.each(_.first(fields, cols.length), function(v, i) { feature[cols[i]] = v; });
    // Convert automatically between Ensembl style 1, 2, 3, X <--> UCSC style chr1, chr2, chr3, chrX as configured/autodetected
    // Note that chrM is NOT equivalent to MT https://www.biostars.org/p/120042/#120058
    switch (o.convertChrScheme == "auto" ? this.data.info.convertChrScheme : o.convertChrScheme) {
      case 'ucsc_ensembl': feature.rname = feature.rname.replace(/^chr/, ''); break;
      case 'ensembl_ucsc': feature.rname = (/^(\d\d?|X)$/.test(feature.rname) ? 'chr' : '') + feature.rname; break;
    }
    feature.name = feature.qname;
    feature.flag = parseInt10(feature.flag);
    chrPos = this.browserOpts.chrPos[feature.rname];
    lineno = lineno || 0;
    
    if (_.isUndefined(chrPos)) {
      this.warn("Invalid RNAME '"+feature.rname+"' at line " + (lineno + 1 + this.opts.lineNum));
      return null;
    } else if (feature.pos === '0' || !feature.cigar || feature.cigar == '*' || feature.flag & availFlags.isReadUnmapped) {
      // Unmapped read. Since we can't draw these at all, we don't bother parsing them further.
      return null;
    } else {
      feature.score = _.isUndefined(feature.score) ? '?' : feature.score;
      feature.start = chrPos + parseInt10(feature.pos);        // POS is 1-based, hence no increment as for parsing BED
      feature.desc = feature.qname + ' at ' + feature.rname + ':' + feature.pos;
      feature.tlen = parseInt10(feature.tlen);
      this.type('bam').parseFlags.call(this, feature, lineno);
      feature.strand = feature.flags.readStrandReverse ? '-' : '+';
      this.type('bam').parseCigar.call(this, feature, lineno); // This also sets .end appropriately
    }
    // We have to come up with something that is a unique label for every line to dedupe rows.
    // The following is technically not guaranteed by a valid BAM (even at GATK standards), but it's the best I got.
    feature.id = [feature.qname, feature.flag, feature.rname, feature.pos, feature.cigar].join("\t");
    
    return feature;
  },
  
  pileup: function(intervals, start, end) {
    var pileup = this.data.pileup,
      positionsToCalculate = {},
      numPositionsToCalculate = 0,
      i;
    
    for (i = start; i < end; i++) {
      // No need to pileup again on already-piled-up nucleotide positions
      if (!pileup[i]) { positionsToCalculate[i] = true; numPositionsToCalculate++; }
    }
    if (numPositionsToCalculate === 0) { return; } // All positions already piled up!
    
    _.each(intervals, function(interval) {
      var blockSets = [interval.data.blocks];
      if (interval.data.drawAsMates && interval.data.mate) { blockSets.push(interval.data.mate.blocks); }
      _.each(blockSets, function(blocks) {
        _.each(blocks, function(block) {
          var nt, i;
          for (i = Math.max(block.start, start); i < Math.min(block.end, end); i++) {
            if (!positionsToCalculate[i]) { continue; }
            nt = (block.seq[i - block.start] || '').toUpperCase();
            pileup[i] = pileup[i] || {A: 0, C: 0, G: 0, T: 0, N: 0, cov: 0};
            if (/[ACTGN]/.test(nt)) { pileup[i][nt] += 1; }
            pileup[i].cov += 1;
          }
        });
      });
    });
  },
  
  coverage: function(start, width, bppp) {
    // Compare with binning on the fly in .type('wiggle_0').prerender(...)
    var j = start,
      vScale = this.data.info.meanItemsPerBp * this.data.info.meanItemLength * 2,
      curr = this.data.pileup[j],
      bars = [],
      next, bin, i;
    for (i = 0; i < width; i++) {
      bin = curr && (j + 1 >= i * bppp + start) ? [curr.cov] : [];
      next = this.data.pileup[j + 1];
      while (j + 1 < (i + 1) * bppp + start && j + 2 >= i * bppp + start) { 
        if (next) { bin.push(next.cov); }
        ++j;
        curr = next;
        next = this.data.pileup[j + 1];
      }
      bars.push(utils.wigBinFunctions.maximum(bin) / vScale);
    }
    return bars;
  },
  
  alleles: function(start, sequence, bppp) {
    var pileup = this.data.pileup,
      vScale = this.data.info.meanItemsPerBp * this.data.info.meanItemLength * 2,
      alleleFreqThreshold = this.opts.alleleFreqThreshold,
      alleleSplits = [],
      split, refNt, i, pileupAtPos;
      
    for (i = 0; i < sequence.length; i++) {
      refNt = sequence[i].toUpperCase();
      pileupAtPos = pileup[start + i];
      if (pileupAtPos && pileupAtPos.cov && pileupAtPos[refNt] / pileupAtPos.cov < (1 - alleleFreqThreshold)) {
        split = {
          x: i / bppp,
          splits: []
        };
        _.each(['A', 'C', 'G', 'T'], function(nt) {
          if (pileupAtPos[nt] > 0) { split.splits.push({nt: nt, h: pileupAtPos[nt] / vScale}); }
        });
        alleleSplits.push(split);
      }
    }
    
    return alleleSplits;
  },
  
  mismatches: function(start, sequence, bppp, intervals, width, lineNum, viewAsPairs) {
    var mismatches = [],
      viewAsPairs = this.opts.viewAsPairs;
    sequence = sequence.toUpperCase();
    _.each(intervals, function(interval) {
      var blockSets = [interval.data.blocks];
      if (viewAsPairs && interval.data.drawAsMates && interval.data.mate) { 
        blockSets.push(interval.data.mate.blocks);
      }
      _.each(blockSets, function(blocks) {
        _.each(blocks, function(block) {
          var line = lineNum(interval.data),
            nt, i, x;
          for (i = Math.max(block.start, start); i < Math.min(block.end, start + width * bppp); i++) {
            x = (i - start) / bppp;
            nt = (block.seq[i - block.start] || '').toUpperCase();
            if (nt && nt != sequence[i - start] && line) { mismatches.push({x: x, nt: nt, line: line}); }
          }
        });
      });
    });
    return mismatches;
  },

  prerender: function(start, end, density, precalc, callback) {
    var self = this,
      width = precalc.width,
      sequence = precalc.sequence,
      data = self.data,
      viewAsPairs = self.opts.viewAsPairs,
      startKey = viewAsPairs ? 'templateStart' : 'start',
      endKey = viewAsPairs ? 'templateEnd' : 'end',
      bppp = (end - start) / width;
    
    function lineNum(d, setTo) {
      var key = bppp + '_' + density + '_' + (viewAsPairs ? 'p' : 'u');
      if (!_.isUndefined(setTo)) { 
        if (!d.line) { d.line = {}; }
        return (d.line[key] = setTo);
      }
      return d.line && d.line[key]; 
    }
    
    // Don't even attempt to fetch the data if we can reasonably estimate that we will fetch an insane amount of rows 
    // (>500 alignments), as this will only hold up other requests.
    if (self.opts.maxFetchWindow && (end - start) > self.opts.maxFetchWindow) {
      callback({tooMany: true});
    } else {
      // Fetch from the RemoteTrack and call the above when the data is available.
      self.data.remote.fetchAsync(start, end, viewAsPairs, function(intervals) {
        var drawSpec = {sequence: !!sequence, width: width},
          calcPixIntervalMated = new utils.pixIntervalCalculator(start, width, bppp, 4, false, startKey, endKey),
          calcPixInterval = new utils.pixIntervalCalculator(start, width, bppp, 4);
        
        if (intervals.tooMany) { return callback(intervals); }

        if (!sequence) {
          // First drawing pass, with features that don't depend on sequence.
          self.type('bam').pileup.call(self, intervals, start, end);
          drawSpec.layout = self.type('bed').stackedLayout.call(self, intervals, width, calcPixIntervalMated, lineNum);
          _.each(drawSpec.layout, function(lines) {
            _.each(lines, function(interval) {
              interval.insertionPts = _.map(interval.d.insertions, calcPixInterval);
              if (!viewAsPairs) { return; }
              if (interval.d.drawAsMates && interval.d.mate) {
                interval.mateInts = _.map([interval.d, interval.d.mate], calcPixInterval);
                interval.mateBlockInts = _.map(interval.d.mate.blocks, calcPixInterval);
                interval.mateInsertionPts = _.map(interval.d.mate.insertionPts, calcPixInterval);
              } else if (interval.d.mateExpected) {
                interval.mateInts = [calcPixInterval(interval)];
                interval.mateBlockInts = [];
                interval.mateInsertionPts = [];
              }
            });
          });
          drawSpec.coverage = self.type('bam').coverage.call(self, start, width, bppp);
        } else {
          // Second drawing pass, to draw things that are dependent on sequence, like mismatches (potential SNPs).
          drawSpec.bppp = bppp;  
          // Find allele splits within the coverage graph.
          drawSpec.alleles = self.type('bam').alleles.call(self, start, sequence, bppp);
          // Find mismatches within each aligned block.
          drawSpec.mismatches = self.type('bam').mismatches.call(self, start, sequence, bppp, intervals, width, lineNum);
        }
        
        callback(drawSpec);
      });
    }
  },
  
  // special formatter for content in tooltips for features
  tipTipData: function(data) {
    var o = this.opts,
      content = {},
      firstMate = data.d,
      secondMate = data.d.mate,
      mateHeaders = ["this alignment", "mate pair alignment"],
      leftMate, rightMate, pairOrientation;
    function yesNo(bool) { return bool ? "yes" : "no"; }
    function addAlignedSegmentInfo(content, seg, prefix) {
      prefix = prefix || "";
      _.each({
        "position": seg.rname + ':' + seg.pos,
        "cigar": seg.cigar,
        "read strand": seg.flags.readStrandReverse ? '(-)' : '(+)',
        "mapped": yesNo(!seg.flags.isReadUnmapped),
        "map quality": seg.mapq,
        "secondary": yesNo(seg.flags.isSecondaryAlignment),
        "supplementary": yesNo(seg.flags.isSupplementaryAlignment),
        "duplicate": yesNo(seg.flags.isDuplicateRead),
        "failed QC": yesNo(seg.flags.isReadFailingVendorQC)
      }, function(v, k) { content[prefix + k] = v; });
    }
    
    if (data.d.mate && data.d.mate.flags) {
      leftMate = data.d.start < data.d.mate.start ? data.d : data.d.mate;
      rightMate = data.d.start < data.d.mate.start ? data.d.mate : data.d;
      pairOrientation = (leftMate.flags.readStrandReverse ? "R" : "F") + (leftMate.flags.isReadFirstOfPair ? "1" : "2");
      pairOrientation += (rightMate.flags.readStrandReverse ? "R" : "F") + (rightMate.flags.isReadLastOfPair ? "2" : "1");
    }
    
    if (o.viewAsPairs && data.d.drawAsMates && data.d.mate) {
      firstMate = leftMate;
      secondMate = rightMate;
      mateHeaders = ["left alignment", "right alignment"];
    }
    if (secondMate) {
      if (!_.isUndefined(data.d.insertSize)) { content["insert size"] = data.d.insertSize; }
      if (!_.isUndefined(pairOrientation)) { content["pair orientation"] = pairOrientation; }
      content[mateHeaders[0]] = "---";
      addAlignedSegmentInfo(content, firstMate);
      content[mateHeaders[1]] = "---";
      addAlignedSegmentInfo(content, secondMate, " ");
    } else {
      addAlignedSegmentInfo(content, data.d);
    }
    
    return content;
  },
  
  // See https://www.broadinstitute.org/igv/AlignmentData#coverage for an idea of what we're imitating
  drawCoverage: function(ctx, coverage, height) {
    _.each(coverage, function(d, x) {
      if (d === null) { return; }
      ctx.fillRect(x, Math.max(height - (d * height), 0), 1, Math.min(d * height, height));
    });
  },
  
  drawStrandIndicator: function(ctx, x, blockY, blockHeight, xScale, bigStyle) {
    var prevFillStyle = ctx.fillStyle;
    if (bigStyle) {
      ctx.beginPath();
      ctx.moveTo(x - (2 * xScale), blockY);
      ctx.lineTo(x + (3 * xScale), blockY + blockHeight/2);
      ctx.lineTo(x - (2 * xScale), blockY + blockHeight);
      ctx.closePath();
      ctx.fill();
    } else {
      ctx.fillStyle = 'rgb(140,140,140)';
      ctx.fillRect(x + (xScale > 0 ? -2 : 1), blockY, 1, blockHeight);
      ctx.fillRect(x + (xScale > 0 ? -1 : 0), blockY + 1, 1, blockHeight - 2);
      ctx.fillStyle = prevFillStyle;
    }
  },
  
  drawAlignment: function(ctx, width, data, i, lineHeight) {
    var self = this,
      drawMates = data.mateInts,
      color = self.opts.color,
      lineGap = lineHeight > 6 ? 2 : 0,
      blockY = i * lineHeight + lineGap/2,
      blockHeight = lineHeight - lineGap,
      deletionLineWidth = 2,
      insertionCaretLineWidth = lineHeight > 6 ? 2 : 1,
      halfHeight = Math.round(0.5 * lineHeight) - deletionLineWidth * 0.5,
      blockSets = [{blockInts: data.blockInts, strand: data.d.strand}];
    
    // For mate pairs, the full pixel interval represents the line linking the mates
    if (drawMates) {
      ctx.fillStyle = ctx.strokeStyle = "rgb(" + color + ")";
      ctx.fillRect(data.pInt.x, i * lineHeight + halfHeight, data.pInt.w, deletionLineWidth);
    }
    
    // Draw the lines that show the full alignment for each segment, including deletions
    ctx.fillStyle = ctx.strokeStyle = 'rgb(0,0,0)';
    _.each(drawMates || [data.pInt], function(pInt) {
      if (pInt.w <= 0) { return; }
      // Note that the "- 1" below fixes rounding issues but gambles on there never being a deletion at the right edge
      ctx.fillRect(pInt.x, i * lineHeight + halfHeight, pInt.w - 1, deletionLineWidth);
    });
    
    // First, determine and set the color we will be using
    // Note that the default color was already set in drawSpec
    if (self.opts.altColor && data.d.strand == '-') { color = self.opts.altColor; }
    ctx.fillStyle = ctx.strokeStyle = "rgb(" + color + ")";
    
    // Draw the [mis]match (M/X/=) blocks
    if (drawMates && data.d.mate) { blockSets.push({blockInts: data.mateBlockInts, strand: data.d.mate.strand}); }
    _.each(blockSets, function(blockSet) {
      var strand = blockSet.strand;
      _.each(blockSet.blockInts, function(bInt, blockNum) {
      
        // Skip drawing blocks that aren't inside the canvas
        if (bInt.x + bInt.w < 0 || bInt.x > width) { return; }
      
        if (blockNum == 0 && blockSet.strand == '-' && !bInt.oPrev) {
          ctx.fillRect(bInt.x + 2, blockY, bInt.w - 2, blockHeight);
          self.type('bam').drawStrandIndicator.call(self, ctx, bInt.x, blockY, blockHeight, -1, lineHeight > 6);
        } else if (blockNum == blockSet.blockInts.length - 1 && blockSet.strand == '+' && !bInt.oNext) {
          ctx.fillRect(bInt.x, blockY, bInt.w - 2, blockHeight);
          self.type('bam').drawStrandIndicator.call(self, ctx, bInt.x + bInt.w, blockY, blockHeight, 1, lineHeight > 6);
        } else {
          ctx.fillRect(bInt.x, blockY, bInt.w, blockHeight);
        }
      });
    });
    
    // Draw insertions
    ctx.fillStyle = ctx.strokeStyle = "rgb(114,41,218)";
    _.each(drawMates ? [data.insertionPts, data.mateInsertionPts] : [data.insertionPts], function(insertionPts) {
      _.each(insertionPts, function(insert) {
        if (insert.x + insert.w < 0 || insert.x > width) { return; }
        ctx.fillRect(insert.x - 1, i * lineHeight, 2, lineHeight);
        ctx.fillRect(insert.x - 2, i * lineHeight, 4, insertionCaretLineWidth);
        ctx.fillRect(insert.x - 2, (i + 1) * lineHeight - insertionCaretLineWidth, 4, insertionCaretLineWidth);
      });
    });
  },
  
  drawAlleles: function(ctx, alleles, height, barWidth) {
    // Same colors as $.ui.genotrack._ntSequenceLoad(...) but could be configurable?
    var colors = {A: '255,0,0', T: '255,0,255', C: '0,0,255', G: '0,180,0'},
      yPos;
    _.each(alleles, function(allelesForPosition) {
      yPos = height;
      _.each(allelesForPosition.splits, function(split) {
        ctx.fillStyle = 'rgb('+colors[split.nt]+')';
        ctx.fillRect(allelesForPosition.x, yPos -= (split.h * height), Math.max(barWidth, 1), split.h * height);
      });
    });
  },
  
  drawMismatch: function(ctx, mismatch, lineOffset, lineHeight, ppbp) {
    // ppbp == pixels per base pair (inverse of bppp)
    // Same colors as $.ui.genotrack._ntSequenceLoad(...) but could be configurable?
    var colors = {A: '255,0,0', T: '255,0,255', C: '0,0,255', G: '0,180,0'},
      lineGap = lineHeight > 6 ? 2 : 0,
      yPos;
    ctx.fillStyle = 'rgb('+colors[mismatch.nt]+')';
    ctx.fillRect(mismatch.x, (mismatch.line + lineOffset) * lineHeight + lineGap / 2, Math.max(ppbp, 1), lineHeight - lineGap);
    // Do we have room to print a whole letter?
    if (ppbp > 7 && lineHeight > 10) {
      ctx.fillStyle = 'rgb(255,255,255)';
      ctx.fillText(mismatch.nt, mismatch.x + ppbp * 0.5, (mismatch.line + lineOffset + 1) * lineHeight - lineGap);
    }
  },
  
  drawSpec: function(canvas, drawSpec, density) {
    var self = this,
      ctx = canvas.getContext && canvas.getContext('2d'),
      urlTemplate = 'javascript:void("'+self.opts.name+':$$")',
      drawLimit = self.opts.drawLimit && self.opts.drawLimit[density],
      lineHeight = density == 'pack' ? 14 : 4,
      covHeight = density == 'dense' ? 24 : 38,
      covMargin = 7,
      lineOffset = ((covHeight + covMargin) / lineHeight), 
      color = self.opts.color,
      areas = null;
            
    if (!ctx) { throw "Canvas not supported"; }
    
    if (!drawSpec.sequence) {
      // First drawing pass, with features that don't depend on sequence.
      
      // If necessary, indicate there was too much data to load/draw and that the user needs to zoom to see more
      if (drawSpec.tooMany || (drawLimit && drawSpec.layout.length > drawLimit)) { 
        canvas.height = 0;
        canvas.className = canvas.className + ' too-many';
        return;
      }
      
      // Only store areas for the "pack" density.
      // We have to empty this for every render, because areas can change if BAM display options change.
      if (density == 'pack' && !self.areas[canvas.id]) { areas = self.areas[canvas.id] = []; }
      // Set the expected height for the canvas (this also erases it).
      canvas.height = covHeight + ((density == 'dense') ? 0 : covMargin + drawSpec.layout.length * lineHeight);
      
      // First draw the coverage graph
      ctx.fillStyle = "rgb(159,159,159)";
      self.type('bam').drawCoverage.call(self, ctx, drawSpec.coverage, covHeight);
                
      // Now, draw alignments below it
      if (density != 'dense') {
        // Border between coverage
        ctx.fillStyle = "rgb(109,109,109)";
        ctx.fillRect(0, covHeight + 1, drawSpec.width, 1); 
        ctx.fillStyle = ctx.strokeStyle = "rgb("+color+")";
        
        _.each(drawSpec.layout, function(l, i) {
          i += lineOffset; // hackish method for leaving space at the top for the coverage graph
          _.each(l, function(data) {
            self.type('bam').drawAlignment.call(self, ctx, drawSpec.width, data, i, lineHeight, drawSpec.viewAsPairs);
            self.type('bed').addArea.call(self, areas, data, i, lineHeight, urlTemplate);
          });
        });
      }
    } else {
      // Second drawing pass, to draw things that are dependent on sequence:
      // (1) allele splits over coverage
      self.type('bam').drawAlleles.call(self, ctx, drawSpec.alleles, covHeight, 1 / drawSpec.bppp);
      // (2) mismatches over the alignments
      ctx.font = "12px 'Menlo','Bitstream Vera Sans Mono','Consolas','Lucida Console',monospace";
      ctx.textAlign = 'center';
      ctx.textBaseline = 'baseline';
      _.each(drawSpec.mismatches, function(mismatch) {
        self.type('bam').drawMismatch.call(self, ctx, mismatch, lineOffset, lineHeight, 1 / drawSpec.bppp);
      });
    }

  },

  render: function(canvas, start, end, density, callback) {
    var self = this;
    self.prerender(start, end, density, {width: canvas.width}, function(drawSpec) {
      var callbackKey = start + '-' + end + '-' + density;
      self.type('bam').drawSpec.call(self, canvas, drawSpec, density);
      
      // Have we been waiting to draw sequence data too? If so, do that now, too.
      if (_.isFunction(self.renderSequenceCallbacks[callbackKey])) {
        self.renderSequenceCallbacks[callbackKey]();
        delete self.renderSequenceCallbacks[callbackKey];
      }
      
      if (_.isFunction(callback)) { callback(); }
    });
  },
  
  renderSequence: function(canvas, start, end, density, sequence, callback) {
    var self = this;
    
    // If we weren't able to fetch sequence for some reason, there is no reason to proceed.
    if (!sequence) { return false; }

    function renderSequenceCallback() {
      self.prerender(start, end, density, {width: canvas.width, sequence: sequence}, function(drawSpec) {
        self.type('bam').drawSpec.call(self, canvas, drawSpec, density);
        if (_.isFunction(callback)) { callback(); }
      });
    }
    
    // Check if the canvas was already rendered (by lack of the class 'unrendered').
    // If yes, go ahead and execute renderSequenceCallback(); if not, save it for later.
    if ((' ' + canvas.className + ' ').indexOf(' unrendered ') > -1) {
      self.renderSequenceCallbacks[start + '-' + end + '-' + density] = renderSequenceCallback;
    } else {
      renderSequenceCallback();
    }
  },
  
  loadOpts: function($dialog) {
    var o = this.opts;
    $dialog.find('[name=viewAsPairs]').attr('checked', !!o.viewAsPairs);
    $dialog.find('[name=convertChrScheme]').val(o.convertChrScheme).change();
  },

  saveOpts: function($dialog) {
    var o = this.opts;
    o.viewAsPairs = $dialog.find('[name=viewAsPairs]').is(':checked');
    o.convertChrScheme = $dialog.find('[name=convertChrScheme]').val();
    
    // If o.viewAsPairs was changed, we *need* to blow away the genobrowser's areaIndex 
    // and our locally cached areas, as all the areas will change.
    if (o.viewAsPairs != this.prevOpts.viewAsPairs) {
      this.areas = {};
      delete $dialog.data('genobrowser').genobrowser('areaIndex')[$dialog.data('track').n];
    }
  }
  
};

module.exports = BamFormat;
},{"./utils/PairedIntervalTree.js":18,"./utils/RemoteTrack.js":19,"./utils/utils.js":21}],11:[function(require,module,exports){
// =================================================================
// = BED format: http://genome.ucsc.edu/FAQ/FAQformat.html#format1 =
// =================================================================
//
// bedDetail is a trivial extension of BED that is defined separately,
// although a BED file with >12 columns is assumed to be bedDetail track regardless of type.

var utils = require('./utils/utils.js'),
  floorHack = utils.floorHack,
  parseInt10 = utils.parseInt10;
var IntervalTree = require('./utils/IntervalTree.js').IntervalTree;
var LineMask = require('./utils/LineMask.js').LineMask;

// Intended to be loaded into CustomTrack.types.bed
var BedFormat = {
  defaults: {
    itemRgb: 'off',
    colorByStrand: '',
    useScore: 0,
    group: 'user',
    priority: 'user',
    offset: 0,
    detail: false,
    url: '',
    htmlUrl: '',
    drawLimit: {squish: null, pack: null}
  },
  
  init: function() {
    this.type().initOpts.call(this);
  },
  
  initOpts: function() {
    var self = this,
      altColors = self.opts.colorByStrand.split(/\s+/),
      validColorByStrand = altColors.length > 1 && _.all(altColors, self.validateColor);
    self.opts.useScore = self.isOn(self.opts.useScore);
    self.opts.itemRgb = self.isOn(self.opts.itemRgb);
    if (!validColorByStrand) { self.opts.colorByStrand = ''; self.opts.altColor = null; }
    else { self.opts.altColor = altColors[1]; }
  },

  parseLine: function(line, lineno) {
    var cols = ['chrom', 'chromStart', 'chromEnd', 'name', 'score', 'strand', 'thickStart', 'thickEnd', 'itemRgb',
      'blockCount', 'blockSizes', 'blockStarts', 'id', 'description'],
      feature = {},
      fields = /\t/.test(line) ? line.split("\t") : line.split(/\s+/),
      chrPos, blockSizes;
    
    if (this.opts.detail) {
      cols[fields.length - 2] = 'id';
      cols[fields.length - 1] = 'description';
    }
    _.each(fields, function(v, i) { feature[cols[i]] = v; });
    chrPos = this.browserOpts.chrPos[feature.chrom];
    lineno = lineno || 0;
    
    if (_.isUndefined(chrPos)) { 
      this.warn("Invalid chromosome '"+feature.chrom+"' at line " + (lineno + 1 + this.opts.lineNum));
      return null;
    } else {
      feature.score = _.isUndefined(feature.score) ? '?' : feature.score;
      feature.start = chrPos + parseInt10(feature.chromStart) + 1;
      feature.end = chrPos + parseInt10(feature.chromEnd) + 1;
      feature.blocks = null;
      // fancier BED features to express coding regions and exons/introns
      if (/^\d+$/.test(feature.thickStart) && /^\d+$/.test(feature.thickEnd)) {
        feature.thickStart = chrPos + parseInt10(feature.thickStart) + 1;
        feature.thickEnd = chrPos + parseInt10(feature.thickEnd) + 1;
        if (/^\d+(,\d*)*$/.test(feature.blockSizes) && /^\d+(,\d*)*$/.test(feature.blockStarts)) {
          feature.blocks = [];
          blockSizes = feature.blockSizes.split(/,/);
          _.each(feature.blockStarts.split(/,/), function(start, i) {
            if (start === '') { return; }
            var block = {start: feature.start + parseInt10(start)};
            block.end = block.start + parseInt10(blockSizes[i]);
            feature.blocks.push(block);
          });
        }
      } else {
        feature.thickStart = feature.thickEnd = null;
      }
    }
    
    return feature;
  },

  parse: function(lines) {
    var self = this,
      middleishPos = self.browserOpts.genomeSize / 2,
      data = new IntervalTree(floorHack(middleishPos), {startKey: 'start', endKey: 'end'});
    _.each(lines, function(line, lineno) {
      var feature = self.type().parseLine.call(self, line, lineno);
      if (feature) { data.add(feature); }
    });
    self.data = data;
    self.heights = {max: null, min: 15, start: 15};
    self.sizes = ['dense', 'squish', 'pack'];
    self.mapSizes = ['pack'];
    return true;
  },
  
  stackedLayout: function(intervals, width, calcPixInterval, lineNum) {
    // A lineNum function can be provided which can set/retrieve the line of already rendered datapoints
    // so as to not break a ranged feature that extends over multiple tiles.
    lineNum = _.isFunction(lineNum) ? lineNum : function() { return; };
    var lines = [],
      maxExistingLine = _.max(_.map(intervals, function(v) { return lineNum(v.data) || 0; })) + 1,
      sortedIntervals = _.sortBy(intervals, function(v) { var ln = lineNum(v.data); return _.isUndefined(ln) ? 1 : -ln; });
    
    while (maxExistingLine-->0) { lines.push(new LineMask(width, 5)); }
    _.each(sortedIntervals, function(v) {
      var d = v.data,
        ln = lineNum(d),
        pInt = calcPixInterval(d),
        thickInt = d.thickStart !== null && calcPixInterval({start: d.thickStart, end: d.thickEnd}),
        blockInts = d.blocks !== null &&  _.map(d.blocks, calcPixInterval),
        i = 0,
        l = lines.length;
      if (!_.isUndefined(ln)) {
        if (lines[ln].conflict(pInt.tx, pInt.tw)) { console.log("Unresolvable LineMask conflict!"); }
        lines[ln].add(pInt.tx, pInt.tw, {pInt: pInt, thickInt: thickInt, blockInts: blockInts, d: d});
      } else {
        while (i < l && lines[i].conflict(pInt.tx, pInt.tw)) { ++i; }
        if (i == l) { lines.push(new LineMask(width, 5)); }
        lineNum(d, i);
        lines[i].add(pInt.tx, pInt.tw, {pInt: pInt, thickInt: thickInt, blockInts: blockInts, d: d});
      }
    });
    return _.map(lines, function(l) { return _.pluck(l.items, 'data'); });
  },
  
  prerender: function(start, end, density, precalc, callback) {
    var width = precalc.width,
      bppp = (end - start) / width,
      intervals = this.data.search(start, end),
      drawSpec = [],
      calcPixInterval = new utils.pixIntervalCalculator(start, width, bppp, density=='pack');
    
    function lineNum(d, set) {
      var key = bppp + '_' + density;
      if (!_.isUndefined(set)) { 
        if (!d.line) { d.line = {}; }
        return (d.line[key] = set);
      }
      return d.line && d.line[key]; 
    }
    
    if (density == 'dense') {
      _.each(intervals, function(v) {
        var pInt = calcPixInterval(v.data);
        pInt.v = v.data.score;
        drawSpec.push(pInt);
      });
    } else {
      drawSpec = {layout: this.type('bed').stackedLayout.call(this, intervals, width, calcPixInterval, lineNum)};
      drawSpec.width = width;
    }
    return _.isFunction(callback) ? callback(drawSpec) : drawSpec;
  },
  
  addArea: function(areas, data, i, lineHeight, urlTemplate) {
    var tipTipData = {},
      tipTipDataCallback = this.type().tipTipData;
    if (!areas) { return; }
    if (_.isFunction(tipTipDataCallback)) {
      tipTipData = tipTipDataCallback.call(this, data);
    } else {
      if (!_.isUndefined(data.d.description)) { tipTipData.description = data.d.description; }
      if (!_.isUndefined(data.d.score)) { tipTipData.score = data.d.score; }
      _.extend(tipTipData, {
        position: data.d.chrom + ':' + data.d.chromStart, 
        size: data.d.chromEnd - data.d.chromStart
      });
      // Display the ID column (from bedDetail), unless it contains a tab character, which means it was autogenerated
      if (!_.isUndefined(data.d.id) && !(/\t/).test(data.d.id)) { tipTipData.id = data.d.id; }
    }
    areas.push([
      data.pInt.x, i * lineHeight + 1, data.pInt.x + data.pInt.w, (i + 1) * lineHeight, // x1, x2, y1, y2
      data.d.name || data.d.id || '',                                                   // name
      urlTemplate.replace('$$', _.isUndefined(data.d.id) ? data.d.name : data.d.id),    // href
      data.pInt.oPrev,                                                                  // continuation from previous tile?
      null,
      null,
      tipTipData
    ]);
  },
  
  // Scales a score from 0-1000 into an alpha value between 0.2 and 1.0
  calcAlpha: function(value) { return Math.max(value, 166)/1000; },
  
  // Scales a score from 0-1000 into a color scaled between #cccccc and max Color
  calcGradient: function(maxColor, value) {
    var minColor = [230,230,230],
      valueColor = [];
    if (!_.isArray(maxColor)) { maxColor = _.map(maxColor.split(','), parseInt10); }
    _.each(minColor, function(v, i) { valueColor[i] = (v - maxColor[i]) * ((1000 - value) / 1000.0) + maxColor[i]; });
    return _.map(valueColor, parseInt10).join(',');
  },
  
  drawArrows: function(ctx, canvasWidth, lineY, halfHeight, startX, endX, direction) {
    var arrowHeight = Math.min(halfHeight, 3),
      X1, X2;
    startX = Math.max(startX, 0);
    endX = Math.min(endX, canvasWidth);
    if (endX - startX < 5) { return; } // can't draw arrows in that narrow of a space
    if (direction !== '+' && direction !== '-') { return; } // invalid direction
    ctx.beginPath();
    // All the 0.5's here are due to <canvas>'s somewhat silly coordinate system 
    // http://diveintohtml5.info/canvas.html#pixel-madness
    X1 = direction == '+' ? 0.5 : arrowHeight + 0.5;
    X2 = direction == '+' ? arrowHeight + 0.5 : 0.5;
    for (var i = Math.floor(startX) + 2; i < endX - arrowHeight; i += 7) {
      ctx.moveTo(i + X1, lineY + halfHeight - arrowHeight + 0.5);
      ctx.lineTo(i + X2, lineY + halfHeight + 0.5);
      ctx.lineTo(i + X1, lineY + halfHeight + arrowHeight + 0.5);
    }
    ctx.stroke();
  },
  
  drawFeature: function(ctx, width, data, i, lineHeight) {
    var self = this,
      color = self.opts.color,
      y = i * lineHeight,
      halfHeight = Math.round(0.5 * (lineHeight - 1)),
      quarterHeight = Math.ceil(0.25 * (lineHeight - 1)),
      lineGap = lineHeight > 6 ? 2 : 1,
      thickOverlap = null,
      prevBInt = null;
    
    // First, determine and set the color we will be using
    // Note that the default color was already set in drawSpec
    if (self.opts.altColor && data.d.strand == '-') { color = self.opts.altColor; }
    
    if (self.opts.itemRgb && data.d.itemRgb && this.validateColor(data.d.itemRgb)) { color = data.d.itemRgb; }
    
    if (self.opts.useScore) { color = self.type('bed').calcGradient(color, data.d.score); }
    
    if (self.opts.itemRgb || self.opts.altColor || self.opts.useScore) { ctx.fillStyle = ctx.strokeStyle = "rgb(" + color + ")"; }
    
    if (data.thickInt) {
      // The coding region is drawn as a thicker line within the gene
      if (data.blockInts) {
        // If there are exons and introns, draw the introns with a 1px line
        prevBInt = null;
        ctx.fillRect(data.pInt.x, y + halfHeight, data.pInt.w, 1);
        ctx.strokeStyle = color;
        _.each(data.blockInts, function(bInt) {
          if (bInt.x + bInt.w <= width && bInt.x >= 0) {
            ctx.fillRect(bInt.x, y + halfHeight - quarterHeight + 1, bInt.w, quarterHeight * 2 - 1);
          }
          thickOverlap = utils.pixIntervalOverlap(bInt, data.thickInt);
          if (thickOverlap) {
            ctx.fillRect(thickOverlap.x, y + 1, thickOverlap.w, lineHeight - lineGap);
          }
          // If there are introns, arrows are drawn on the introns, not the exons...
          if (data.d.strand && prevBInt) {
            ctx.strokeStyle = "rgb(" + color + ")";
            self.type('bed').drawArrows(ctx, width, y, halfHeight, prevBInt.x + prevBInt.w, bInt.x, data.d.strand);
          }
          prevBInt = bInt;
        });
        // ...unless there were no introns. Then it is drawn on the coding region.
        if (data.blockInts.length == 1) {
          ctx.strokeStyle = "white";
          self.type('bed').drawArrows(ctx, width, y, halfHeight, data.thickInt.x, data.thickInt.x + data.thickInt.w, data.d.strand);
        }
      } else {
        // We have a coding region but no introns/exons
        ctx.fillRect(data.pInt.x, y + halfHeight - quarterHeight + 1, data.pInt.w, quarterHeight * 2 - 1);
        ctx.fillRect(data.thickInt.x, y + 1, data.thickInt.w, lineHeight - lineGap);
        ctx.strokeStyle = "white";
        self.type('bed').drawArrows(ctx, width, y, halfHeight, data.thickInt.x, data.thickInt.x + data.thickInt.w, data.d.strand);
      }
    } else {
      // Nothing fancy.  It's a box.
      ctx.fillRect(data.pInt.x, y + 1, data.pInt.w, lineHeight - lineGap);
      ctx.strokeStyle = "white";
      self.type('bed').drawArrows(ctx, width, y, halfHeight, data.pInt.x, data.pInt.x + data.pInt.w, data.d.strand);
    }
  },
  
  drawSpec: function(canvas, drawSpec, density) {
    var self = this,
      ctx = canvas.getContext && canvas.getContext('2d'),
      urlTemplate = self.opts.url ? self.opts.url : 'javascript:void("'+self.opts.name+':$$")',
      drawLimit = self.opts.drawLimit && self.opts.drawLimit[density],
      lineHeight = density == 'pack' ? 15 : 6,
      color = self.opts.color,
      areas = null;
    
    if (!ctx) { throw "Canvas not supported"; }
    // TODO: I disabled regenerating areas here, which assumes that lineNum remains stable across re-renders. Should check on this.
    if (density == 'pack' && !self.areas[canvas.id]) { areas = self.areas[canvas.id] = []; }
    
    if (density == 'dense') {
      canvas.height = 15;
      ctx.fillStyle = "rgb("+color+")";
      _.each(drawSpec, function(pInt) {
        if (self.opts.useScore) { ctx.fillStyle = "rgba("+self.type('bed').calcGradient(color, pInt.v)+")"; }
        ctx.fillRect(pInt.x, 1, pInt.w, 13);
      });
    } else {
      if ((drawLimit && drawSpec.layout && drawSpec.layout.length > drawLimit) || drawSpec.tooMany) { 
        canvas.height = 0;
        // This applies styling that indicates there was too much data to load/draw and that the user needs to zoom to see more
        canvas.className = canvas.className + ' too-many';
        return;
      }
      canvas.height = drawSpec.layout.length * lineHeight;
      ctx.fillStyle = ctx.strokeStyle = "rgb("+color+")";
      _.each(drawSpec.layout, function(l, i) {
        _.each(l, function(data) {
          self.type('bed').drawFeature.call(self, ctx, drawSpec.width, data, i, lineHeight);              
          self.type('bed').addArea.call(self, areas, data, i, lineHeight, urlTemplate);
        });
      });
    }
  },

  render: function(canvas, start, end, density, callback) {
    var self = this;
    self.prerender(start, end, density, {width: canvas.width}, function(drawSpec) {
      self.type().drawSpec.call(self, canvas, drawSpec, density);
      if (_.isFunction(callback)) { callback(); }
    });
  },

  loadOpts: function($dialog) {
    var o = this.opts,
      colorByStrandOn = /\d+,\d+,\d+\s+\d+,\d+,\d+/.test(o.colorByStrand),
      colorByStrand = colorByStrandOn ? o.colorByStrand.split(/\s+/)[1] : '0,0,0';
    $dialog.find('[name=colorByStrandOn]').attr('checked', !!colorByStrandOn);
    $dialog.find('[name=colorByStrand]').val(colorByStrand).change();
    $dialog.find('[name=useScore]').attr('checked', this.isOn(o.useScore));    
    $dialog.find('[name=url]').val(o.url);
  },
  
  saveOpts: function($dialog) {
    var o = this.opts,
      colorByStrandOn = $dialog.find('[name=colorByStrandOn]').is(':checked'),
      colorByStrand = $dialog.find('[name=colorByStrand]').val(),
      validColorByStrand = this.validateColor(colorByStrand);
    o.colorByStrand = colorByStrandOn && validColorByStrand ? o.color + ' ' + colorByStrand : '';
    o.useScore = $dialog.find('[name=useScore]').is(':checked') ? 1 : 0;
    o.url = $dialog.find('[name=url]').val();
    this.type('bed').initOpts.call(this);
  }
};

module.exports = BedFormat;
},{"./utils/IntervalTree.js":16,"./utils/LineMask.js":17,"./utils/utils.js":21}],12:[function(require,module,exports){
// =========================================================================
// = bedGraph format: http://genome.ucsc.edu/goldenPath/help/bedgraph.html =
// =========================================================================

var utils = require('./utils/utils.js'),
  parseInt10 = utils.parseInt10;

// Intended to be loaded into CustomTrack.types.bedgraph
var BedGraphFormat = {
  defaults: {
    altColor: '',
    priority: 100,
    autoScale: 'on',
    alwaysZero: 'off',
    gridDefault: 'off',
    maxHeightPixels: '128:128:15',
    graphType: 'bar',
    viewLimits: '',
    yLineMark: 0.0,
    yLineOnOff: 'off',
    windowingFunction: 'maximum',
    smoothingWindow: 'off'
  },

  init: function() { return this.type('wiggle_0').init.call(this); },
  
  _binFunctions: utils.wigBinFunctions,
  
  initOpts: function() { return this.type('wiggle_0').initOpts.call(this); },
  
  applyOpts: function() { return this.type('wiggle_0').applyOpts.apply(this, arguments); },
  
  parse: function(lines) {
    var self = this,
      genomeSize = this.browserOpts.genomeSize,
      data = {all: []},
      mode, modeOpts, chrPos, m;
    self.range = self.isOn(this.opts.alwaysZero) ? [0, 0] : [Infinity, -Infinity];
  
    _.each(lines, function(line, lineno) {
      var cols = ['chrom', 'chromStart', 'chromEnd', 'dataValue'],
        datum = {},
        chrPos, start, end, val;
      _.each(line.split(/\s+/), function(v, i) { datum[cols[i]] = v; });
      chrPos = self.browserOpts.chrPos[datum.chrom];
      if (_.isUndefined(chrPos)) {
        self.warn("Invalid chromosome at line " + (lineno + 1 + self.opts.lineNum));
      }
      start = parseInt10(datum.chromStart);
      end = parseInt10(datum.chromEnd);
      val = parseFloat(datum.dataValue);
      data.all.push({start: chrPos + start, end: chrPos + end, val: val});
    });

    return self.type('wiggle_0').finishParse.call(self, data);
  },
  
  initDrawSpec: function() { return this.type('wiggle_0').initDrawSpec.apply(this, arguments); },
  
  drawBars: function() { return this.type('wiggle_0').drawBars.apply(this, arguments); },

  prerender: function(start, end, density, precalc, callback) {
    return this.type('wiggle_0').prerender.call(this, start, end, density, precalc, callback);
  },

  render: function(canvas, start, end, density, callback) {
    this.type('wiggle_0').render.call(this, canvas, start, end, density, callback);
  },
  
  loadOpts: function() { return this.type('wiggle_0').loadOpts.apply(this, arguments); },
  
  saveOpts: function() { return this.type('wiggle_0').saveOpts.apply(this, arguments); }
  
};

module.exports = BedGraphFormat;
},{"./utils/utils.js":21}],13:[function(require,module,exports){
// =====================================================================
// = bigBed format: http://genome.ucsc.edu/goldenPath/help/bigBed.html =
// =====================================================================

var utils = require('./utils/utils.js'),
  floorHack = utils.floorHack;
var IntervalTree = require('./utils/IntervalTree.js').IntervalTree;
var RemoteTrack = require('./utils/RemoteTrack.js').RemoteTrack;

// Intended to be loaded into CustomTrack.types.bigbed
var BigBedFormat = {
  defaults: {
    chromosomes: '',
    itemRgb: 'off',
    colorByStrand: '',
    useScore: 0,
    group: 'user',
    priority: 'user',
    offset: 0,
    detail: false,
    url: '',
    htmlUrl: '',
    drawLimit: {squish: 500, pack: 100},
    maxFetchWindow: 0
  },

  init: function() {
    if (!this.opts.bigDataUrl) {
      throw new Error("Required parameter bigDataUrl not found for bigBed track at " + JSON.stringify(this.opts) + (this.opts.lineNum + 1));
    }
  },
  
  parse: function(lines) {
    var self = this,
      middleishPos = self.browserOpts.genomeSize / 2,
      cache = new IntervalTree(floorHack(middleishPos), {startKey: 'start', endKey: 'end'}),
      ajaxUrl = self.ajaxDir() + 'bigbed.php',
      remote;
    
    remote = new RemoteTrack(cache, function(start, end, storeIntervals) {
      range = self.chrRange(start, end);
      $.ajax(ajaxUrl, {
        data: {range: range, url: self.opts.bigDataUrl, density: 'pack'},
        success: function(data) {
          var lines = _.filter(data.split('\n'), function(l) { var m = l.match(/\t/g); return m && m.length >= 2; });
          var intervals = _.map(lines, function(l) { 
            var itvl = self.type('bed').parseLine.call(self, l); 
            // Use BioPerl's Bio::DB:BigBed strategy for deduplicating re-fetched intervals:
            // "Because BED files don't actually use IDs, the ID is constructed from the feature's name (if any), chromosome coordinates, strand and block count."
            if (_.isUndefined(itvl.id)) {
              itvl.id = [itvl.name, itvl.chrom, itvl.chromStart, itvl.chromEnd, itvl.strand, itvl.blockCount].join("\t");
            }
            return itvl;
          });
          storeIntervals(intervals);
        }
      });
    });
    
    self.data = {cache: cache, remote: remote};
    self.heights = {max: null, min: 15, start: 15};
    self.sizes = ['dense', 'squish', 'pack'];
    self.mapSizes = ['pack'];
    
    // Get general info on the bigBed and setup the binning scheme for the RemoteTrack
    $.ajax(ajaxUrl, {
      data: { url: self.opts.bigDataUrl },
      success: function(data) {
        // Set maxFetchWindow to avoid overfetching data.
        if (!self.opts.maxFetchWindow) {
          var meanItemsPerBp = data.itemCount / self.browserOpts.genomeSize,
            maxItemsToDraw = _.max(_.values(self.opts.drawLimit));
          self.opts.maxFetchWindow = maxItemsToDraw / meanItemsPerBp;
          self.opts.optimalFetchWindow = Math.floor(self.opts.maxFetchWindow / 3);
        }
        remote.setupBins(self.browserOpts.genomeSize, self.opts.optimalFetchWindow, self.opts.maxFetchWindow);
      }
    });
    
    return true;
  },

  prerender: function(start, end, density, precalc, callback) {
    var self = this,
      width = precalc.width,
      data = self.data,
      bppp = (end - start) / width,
      range = this.chrRange(start, end);
    
    function lineNum(d, setTo) {
      var key = bppp + '_' + density;
      if (!_.isUndefined(setTo)) { 
        if (!d.line) { d.line = {}; }
        return (d.line[key] = setTo);
      }
      return d.line && d.line[key]; 
    }
    
    function parseDenseData(data) {
      var drawSpec = [], 
        lines;
      lines = data.split(/\s+/g);
      _.each(lines, function(line, x) { 
        if (line != 'n/a' && line.length) { drawSpec.push({x: x, w: 1, v: parseFloat(line) * 1000}); } 
      });
      callback(drawSpec);
    }
    
    // Don't even attempt to fetch the data if density is not 'dense' and we can reasonably
    // estimate that we will fetch too many rows (>500 features), as this will only delay other requests.
    if (density != 'dense' && (end - start) > self.opts.maxFetchWindow) {
      callback({tooMany: true});
    } else {
      if (density == 'dense') {
        $.ajax(self.ajaxDir() + 'bigbed.php', {
          data: {range: range, url: self.opts.bigDataUrl, width: width, density: density},
          success: parseDenseData
        });
      } else {
        self.data.remote.fetchAsync(start, end, function(intervals) {
          var calcPixInterval, drawSpec = {};
          if (intervals.tooMany) { return callback(intervals); }
          calcPixInterval = new utils.pixIntervalCalculator(start, width, bppp, density == 'pack');
          drawSpec.layout = self.type('bed').stackedLayout.call(self, intervals, width, calcPixInterval, lineNum);
          drawSpec.width = width;
          callback(drawSpec);
        });
      }
    }
  },

  render: function(canvas, start, end, density, callback) {
    var self = this;
    self.prerender(start, end, density, {width: canvas.width}, function(drawSpec) {
      self.type('bed').drawSpec.call(self, canvas, drawSpec, density);
      if (_.isFunction(callback)) { callback(); }
    });
  },
  
  loadOpts: function() { return this.type('bed').loadOpts.apply(this, arguments); },
  
  saveOpts: function() { return this.type('bed').saveOpts.apply(this, arguments); }
};

module.exports = BigBedFormat;
},{"./utils/IntervalTree.js":16,"./utils/RemoteTrack.js":19,"./utils/utils.js":21}],14:[function(require,module,exports){


// =====================================================================
// = bigWig format: http://genome.ucsc.edu/goldenPath/help/bigWig.html =
// =====================================================================

var BigWigFormat = {
  defaults: {
    altColor: '128,128,128',
    priority: 100,
    autoScale: 'on',
    alwaysZero: 'off',
    gridDefault: 'off',
    maxHeightPixels: '128:128:15',
    graphType: 'bar',
    viewLimits: '',
    yLineMark: 0.0,
    yLineOnOff: 'off',
    windowingFunction: 'maximum',
    smoothingWindow: 'off'
  },

  init: function() {
    if (!this.opts.bigDataUrl) {
      throw new Error("Required parameter bigDataUrl not found for bigWig track at " + JSON.stringify(this.opts) + (this.opts.lineNum + 1));
    }
    this.type('wiggle_0').initOpts.call(this);
  },
  
  _binFunctions: {'minimum':1, 'maximum':1, 'mean':1, 'min':1, 'max':1, 'std':1, 'coverage':1},
  
  applyOpts: function() { return this.type('wiggle_0').applyOpts.apply(this, arguments); },

  parse: function(lines) {
    var self = this;
    self.stretchHeight = true;
    self.range = self.isOn(self.opts.alwaysZero) ? [0, 0] : [Infinity, -Infinity];
    $.ajax(self.ajaxDir() + 'bigwig.php', {
      data: {info: 1, url: this.opts.bigDataUrl},
      async: false,  // This is cool since parsing normally happens in a Web Worker
      success: function(data) {
        var rows = data.split("\n");
        _.each(rows, function(r) {
          var keyval = r.split(': ');
          if (keyval[0]=='min') { self.range[0] = Math.min(parseFloat(keyval[1]), self.range[0]); }
          if (keyval[0]=='max') { self.range[1] = Math.max(parseFloat(keyval[1]), self.range[1]); }
        });
      }
    });
    self.type('wiggle_0').applyOpts.apply(self);
    return true;
  },

  prerender: function(start, end, density, precalc, callback) {
    var self = this,
      width = precalc.width,
      chrRange = self.chrRange(start, end);
  
    function success(data) {
      var drawSpec = self.type('wiggle_0').initDrawSpec.call(self, precalc),
        lines = data.split(/\s+/g);
      _.each(lines, function(line) {
        if (line == 'n/a') { drawSpec.bars.push(null); }
        else if (line.length) { drawSpec.bars.push((parseFloat(line) - self.drawRange[0]) / drawSpec.vScale); }
      });
      callback(drawSpec);
    }
  
    $.ajax(self.ajaxDir() + 'bigwig.php', {
      data: {range: chrRange, url: self.opts.bigDataUrl, width: width, winFunc: self.opts.windowingFunction},
      success: success
    });
  },

  render: function(canvas, start, end, density, callback) {
    var self = this,
      height = canvas.height,
      width = canvas.width,
      ctx = canvas.getContext && canvas.getContext('2d');
    if (!ctx) { throw "Canvas not supported"; }
    self.prerender(start, end, density, {width: width, height: height}, function(drawSpec) {
      self.type('wiggle_0').drawBars.call(self, ctx, drawSpec, height, width);
      _.isFunction(callback) && callback();
    });
  },

  loadOpts: function() { return this.type('wiggle_0').loadOpts.apply(this, arguments); },

  saveOpts: function() { return this.type('wiggle_0').saveOpts.apply(this, arguments); }
};

module.exports = BigWigFormat;
},{}],15:[function(require,module,exports){
// ======================================================================
// = featureTable format: http://www.insdc.org/files/feature_table.html =
// ======================================================================

var IntervalTree = require('./utils/IntervalTree.js').IntervalTree;
var utils = require('./utils/utils.js'),
  strip = utils.strip,
  floorHack = utils.floorHack,
  parseInt10 = utils.parseInt10;

// Intended to be loaded into CustomTrack.types.featuretable
var FeatureTableFormat = {
  defaults: {
    collapseByGene: 'off',
    keyColumnWidth: 21,
    itemRgb: 'off',
    colorByStrand: '',
    useScore: 0,
    group: 'user',
    priority: 'user',
    offset: 0,
    url: '',
    htmlUrl: '',
    drawLimit: {squish: null, pack: null}
  },
  
  init: function() {
    this.type('bed').initOpts.call(this);
    this.opts.collapseByGene = this.isOn(this.opts.collapseByGene);
    this.featureTypeCounts = {};
  },
  
  // parses one feature key + location/qualifiers row from the feature table
  parseEntry: function(chrom, lines, startLineNo) {
    var feature = {
        chrom: chrom,
        score: '?',
        blocks: null,
        qualifiers: {}
      },
      keyColumnWidth = this.opts.keyColumnWidth,
      qualifier = null,
      fullLocation = [],
      collapseKeyQualifiers = ['locus_tag', 'gene', 'db_xref'],
      qualifiersThatAreNames = ['gene', 'locus_tag', 'db_xref'],
      RNATypes = ['rrna', 'trna'],
      alsoTryForRNATypes = ['product'],
      locationPositions, chrPos, blockSizes;
    
    chrPos = this.browserOpts.chrPos[chrom];
    startLineNo = startLineNo || 0;
    if (_.isUndefined(chrPos)) {
      this.warn("Invalid chromosome at line " + (lineno + 1 + this.opts.lineNum));
      return null;
    }
    
    // fill out feature's keys with info from these lines
    _.each(lines, function(line, lineno) {
      var key = line.substr(0, keyColumnWidth),
        restOfLine = line.substr(keyColumnWidth),
        qualifierMatch = restOfLine.match(/^\/(\w+)(=?)(.*)/);
      if (key.match(/\w/)) {
        feature.type = strip(key);
        qualifier = null;
        fullLocation.push(restOfLine);
      } else {
        if (qualifierMatch) {
          qualifier = qualifierMatch[1];
          if (!feature.qualifiers[qualifier]) { feature.qualifiers[qualifier] = []; }
          feature.qualifiers[qualifier].push([qualifierMatch[2] ? qualifierMatch[3] : true]);
        } else {
          if (qualifier !== null) { 
            _.last(feature.qualifiers[qualifier]).push(restOfLine);
          } else {
            fullLocation.push(restOfLine);
          }
        }
      }
    });
    
    feature.fullLocation = fullLocation = fullLocation.join('');
    locationPositions = _.map(_.filter(fullLocation.split(/\D+/), _.identity), parseInt10);
    feature.chromStart =  _.min(locationPositions);
    feature.chromEnd = _.max(locationPositions) + 1; // Feature table ranges are *inclusive* of the end base
                                                     // chromEnd columns in BED format are *not*.
    feature.start = chrPos + feature.chromStart;
    feature.end = chrPos + feature.chromEnd; 
    feature.strand = /complement/.test(fullLocation) ? "-" : "+";
    
    // Until we merge by gene name, we don't care about these
    feature.thickStart = feature.thickEnd = null;
    feature.blocks = null;
    
    // Parse the qualifiers properly
    _.each(feature.qualifiers, function(v, k) {
      _.each(v, function(entryLines, i) {
        v[i] = strip(entryLines.join(' '));
        if (/^"[\s\S]*"$/.test(v[i])) {
          // Dequote free text
          v[i] = v[i].replace(/^"|"$/g, '').replace(/""/g, '"');
        }
      });
      //if (v.length == 1) { feature.qualifiers[k] = v[0]; }
    });
    
    // Find something that can serve as a name
    feature.name = feature.type;
    if (_.contains(RNATypes, feature.type.toLowerCase())) { 
      Array.prototype.push.apply(qualifiersThatAreNames, alsoTryForRNATypes); 
    }
    _.find(qualifiersThatAreNames, function(k) {
      if (feature.qualifiers[k] && feature.qualifiers[k][0]) { return (feature.name = feature.qualifiers[k][0]); }
    });
    // In the worst case, add a counter to disambiguate features named only by type
    if (feature.name == feature.type) {
      if (!this.featureTypeCounts[feature.type]) { this.featureTypeCounts[feature.type] = 1; }
      feature.name = feature.name + '_' + this.featureTypeCounts[feature.type]++;
    }
    
    // Find a key that is appropriate for collapsing
    if (this.opts.collapseByGene) {
      _.find(collapseKeyQualifiers, function(k) {
        if (feature.qualifiers[k] && feature.qualifiers[k][0]) { 
          return (feature._collapseKey = feature.qualifiers[k][0]);
        }
      });
    }
    
    return feature;
  },
  
  // collapses multiple features that are about the same gene into one drawable feature
  collapseFeatures: function(features) {
    var chrPos = this.browserOpts.chrPos,
      preferredTypeToMergeInto = ['mrna', 'gene', 'cds'],
      preferredTypeForExons = ['exon', 'cds'],
      mergeInto = features[0],
      blocks = [],
      foundType, cds, exons;
    foundType = _.find(preferredTypeToMergeInto, function(type) {
      var found = _.find(features, function(feat) { return feat.type.toLowerCase() == type; });
      if (found) { mergeInto = found; return true; }
    });
    
    // Look for exons (eukaryotic) or a CDS (prokaryotic)
    _.find(preferredTypeForExons, function(type) {
      exons = _.select(features, function(feat) { return feat.type.toLowerCase() == type; });
      if (exons.length) { return true; }
    });
    cds = _.find(features, function(feat) { return feat.type.toLowerCase() == "cds"; });
    
    _.each(exons, function(exonFeature) {
      exonFeature.fullLocation.replace(/(\d+)\.\.[><]?(\d+)/g, function(fullMatch, start, end) {
        blocks.push({
          start: chrPos[exonFeature.chrom] + Math.min(start, end), 
          // Feature table ranges are *inclusive* of the end base.
          end: chrPos[exonFeature.chrom] +  Math.max(start, end) + 1
        });
      });
    });
    
    // Convert exons and CDS into blocks, thickStart and thickEnd (in BED terminology)
    if (blocks.length) { 
      mergeInto.blocks = _.sortBy(blocks, function(b) { return b.start; });
      mergeInto.thickStart = cds ? cds.start : feature.start;
      mergeInto.thickEnd = cds ? cds.end : feature.end;
    }
    
    // finally, merge all the qualifiers
    _.each(features, function(feat) {
      if (feat === mergeInto) { return; }
      _.each(feat.qualifiers, function(values, k) {
        if (!mergeInto.qualifiers[k]) { mergeInto.qualifiers[k] = []; }
        _.each(values, function(v) {
          if (!_.contains(mergeInto.qualifiers[k], v)) { mergeInto.qualifiers[k].push(v); }
        });
      });
    });
    
    return mergeInto;
  },

  parse: function(lines) {
    var self = this,
      o = self.opts,
      middleishPos = this.browserOpts.genomeSize / 2,
      data = new IntervalTree(floorHack(middleishPos), {startKey: 'start', endKey: 'end'}),
      numLines = lines.length,
      chrom = null,
      lastEntryStart = null,
      featuresByCollapseKey = {},
      feature;
    
    function collectLastEntry(lineno) {
      if (lastEntryStart !== null) {
        feature = self.type().parseEntry.call(self, chrom, lines.slice(lastEntryStart, lineno), lastEntryStart);
        if (feature) { 
          if (o.collapseByGene) {
            featuresByCollapseKey[feature._collapseKey] = featuresByCollapseKey[feature._collapseKey] || [];
            featuresByCollapseKey[feature._collapseKey].push(feature);
          } else { data.add(feature); }
        }
      }
    }
    
    // Chunk the lines into entries and parse each of them
    _.each(lines, function(line, lineno) {
      if (line.substr(0, 12) == "ACCESSION   ") {
        collectLastEntry(lineno);
        chrom = line.substr(12);
        lastEntryStart = null;
      } else if (chrom !== null && line.substr(5, 1).match(/\w/)) {
        collectLastEntry(lineno);
        lastEntryStart = lineno;
      }
    });
    // parse the last entry
    if (chrom !== null) { collectLastEntry(lines.length); }
    
    if (o.collapseByGene) {
      _.each(featuresByCollapseKey, function(features, gene) {
        data.add(self.type().collapseFeatures.call(self, features));
      });
    }
    
    self.data = data;
    self.heights = {max: null, min: 15, start: 15};
    self.sizes = ['dense', 'squish', 'pack'];
    self.mapSizes = ['pack'];
    return true;
  },
  
  // special formatter for content in tooltips for features
  tipTipData: function(data) {
    var qualifiersToAbbreviate = {translation: 1},
      content = {
        type: data.d.type,
        position: data.d.chrom + ':' + data.d.chromStart, 
        size: data.d.chromEnd - data.d.chromStart
      };
    if (data.d.qualifiers.note && data.d.qualifiers.note[0]) {  }
    _.each(data.d.qualifiers, function(v, k) {
      if (k == 'note') { content.description = v.join('; '); return; }
      content[k] = v.join('; ');
      if (qualifiersToAbbreviate[k] && content[k].length > 25) { content[k] = content[k].substr(0, 25) + '...'; }
    });
    return content;
  },
  
  prerender: function(start, end, density, precalc, callback) {
    return this.type('bed').prerender.call(this, start, end, density, precalc, callback);
  },
  
  drawSpec: function() { return this.type('bed').drawSpec.apply(this, arguments); },
  
  render: function(canvas, start, end, density, callback) {
    this.type('bed').render.call(this, canvas, start, end, density, callback);
  },
  
  loadOpts: function() { return this.type('bed').loadOpts.apply(this, arguments); },
  
  saveOpts: function() { return this.type('bed').saveOpts.apply(this, arguments); }
};

module.exports = FeatureTableFormat;
},{"./utils/IntervalTree.js":16,"./utils/utils.js":21}],16:[function(require,module,exports){
(function(exports){
  
var SortedList = require('./SortedList.js').SortedList;  

// TODO: backport this code for JavaScript 1.5? using underscore.js
/**
 * By Shin Suzuki, MIT license
 * https://github.com/shinout/interval-tree
 * IntervalTree
 *
 * @param (object) data:
 * @param (number) center:
 * @param (object) options:
 *   center:
 *
 **/
function IntervalTree(center, options) {
  options || (options = {});

  this.startKey     = options.startKey || 0; // start key
  this.endKey       = options.endKey   || 1; // end key
  this.intervalHash = {};                    // id => interval object
  this.pointTree = new SortedList({          // b-tree of start, end points 
    compare: function(a, b) {
      if (a == null) return -1;
      if (b == null) return  1;
      var c = a[0]- b[0];
      return (c > 0) ? 1 : (c == 0)  ? 0 : -1;
    }
  });

  this._autoIncrement = 0;

  // index of the root node
  if (!center || typeof center != 'number') {
    throw new Error('you must specify center index as the 2nd argument.');
  }

  this.root = new Node(center, this);
}


/**
 * public methods
 **/


/**
 * add new range
 **/
IntervalTree.prototype.add = function(data, id) {
  if (this.contains(id)) {
    throw new DuplicateError('id ' + id + ' is already registered.');
  }

  if (id == undefined) {
    while (this.intervalHash[this._autoIncrement]) {
      this._autoIncrement++;
    }
    id = this._autoIncrement;
  }

  var itvl = new Interval(data, id, this.startKey, this.endKey);
  this.pointTree.insert([itvl.start, id]);
  this.pointTree.insert([itvl.end,   id]);
  this.intervalHash[id] = itvl;
  this._autoIncrement++;
  
  _insert.call(this, this.root, itvl);
};


/**
 * check if range is already present, based on its id
 **/
IntervalTree.prototype.contains = function(id) {
  return !!this.get(id);
}


/**
 * retrieve an interval by its id; returns null if it does not exist
 **/
IntervalTree.prototype.get = function(id) {
  return this.intervalHash[id] || null;
}


/**
 * add new range only if it is new, based on whether the id was already registered
 **/
IntervalTree.prototype.addIfNew = function(data, id) {
  try {
    this.add(data, id);
  } catch (e) {
    if (e instanceof DuplicateError) { return; }
    throw e;
  }
}


/**
 * search
 *
 * @param (integer) val:
 * @return (array)
 **/
IntervalTree.prototype.search = function(val1, val2) {
  var ret = [];
  if (typeof val1 != 'number') {
    throw new Error(val1 + ': invalid input');
  }

  if (val2 == undefined) {
    _pointSearch.call(this, this.root, val1, ret);
  }
  else if (typeof val2 == 'number') {
    _rangeSearch.call(this, val1, val2, ret);
  }
  else {
    throw new Error(val1 + ',' + val2 + ': invalid input');
  }
  return ret;
};


/**
 * remove: 
 **/
IntervalTree.prototype.remove = function(interval_id) {
  throw ".remove() is currently unimplemented";
};



/**
 * private methods
 **/

// the shift-right-and-fill operator, extended beyond the range of an int32
function _bitShiftRight(num) {
  if (num > 2147483647 || num < -2147483648) { return Math.floor(num / 2); }
  return num >>> 1;
}

/**
 * _insert
 **/
function _insert(node, itvl) {
  while (true) {
    if (itvl.end < node.idx) {
      if (!node.left) {
        node.left = new Node(_bitShiftRight(itvl.start + itvl.end), this);
      }
      node = node.left;
    } else if (node.idx < itvl.start) {
      if (!node.right) {
        node.right = new Node(_bitShiftRight(itvl.start + itvl.end), this);
      }
      node = node.right;
    } else {
      return node.insert(itvl);
    }
  }
}


/**
 * _pointSearch
 * @param (Node) node
 * @param (integer) idx 
 * @param (Array) arr
 **/
function _pointSearch(node, idx, arr) {
  while (true) {
    if (!node) break;
    if (idx < node.idx) {
      node.starts.arr.every(function(itvl) {
        var bool = (itvl.start <= idx);
        if (bool) arr.push(itvl.result());
        return bool;
      });
      node = node.left;
    } else if (idx > node.idx) {
      node.ends.arr.every(function(itvl) {
        var bool = (itvl.end >= idx);
        if (bool) arr.push(itvl.result());
        return bool;
      });
      node = node.right;
    } else {
      node.starts.arr.map(function(itvl) { arr.push(itvl.result()) });
      break;
    }
  }
}



/**
 * _rangeSearch
 * @param (integer) start
 * @param (integer) end
 * @param (Array) arr
 **/
function _rangeSearch(start, end, arr) {
  if (end - start <= 0) {
    throw new Error('end must be greater than start. start: ' + start + ', end: ' + end);
  }
  var resultHash = {};

  var wholeWraps = [];
  _pointSearch.call(this, this.root, _bitShiftRight(start + end), wholeWraps, true);

  wholeWraps.forEach(function(result) {
    resultHash[result.id] = true;
  });


  var idx1 = this.pointTree.bsearch([start, null]);
  while (idx1 >= 0 && this.pointTree.arr[idx1][0] == start) {
    idx1--;
  }

  var idx2 = this.pointTree.bsearch([end,   null]);
  var len = this.pointTree.arr.length - 1;
  while (idx2 == -1 || (idx2 <= len && this.pointTree.arr[idx2][0] <= end)) {
    idx2++;
  }

  this.pointTree.arr.slice(idx1 + 1, idx2).forEach(function(point) {
    var id = point[1];
    resultHash[id] = true;
  }, this);

  Object.keys(resultHash).forEach(function(id) {
    var itvl = this.intervalHash[id];
    arr.push(itvl.result(start, end));
  }, this);

}



/**
 * subclasses
 * 
 **/


/**
 * Node : prototype of each node in a interval tree
 * 
 **/
function Node(idx) {
  this.idx = idx;
  this.starts = new SortedList({
    compare: function(a, b) {
      if (a == null) return -1;
      if (b == null) return  1;
      var c = a.start - b.start;
      return (c > 0) ? 1 : (c == 0)  ? 0 : -1;
    }
  });

  this.ends = new SortedList({
    compare: function(a, b) {
      if (a == null) return -1;
      if (b == null) return  1;
      var c = a.end - b.end;
      return (c < 0) ? 1 : (c == 0)  ? 0 : -1;
    }
  });
};

/**
 * insert an Interval object to this node
 **/
Node.prototype.insert = function(interval) {
  this.starts.insert(interval);
  this.ends.insert(interval);
};



/**
 * Interval : prototype of interval info
 **/
function Interval(data, id, s, e) {
  this.id     = id;
  this.start  = data[s];
  this.end    = data[e];
  this.data   = data;

  if (typeof this.start != 'number' || typeof this.end != 'number') {
    throw new Error('start, end must be number. start: ' + this.start + ', end: ' + this.end);
  }

  if ( this.start >= this.end) {
    throw new Error('start must be smaller than end. start: ' + this.start + ', end: ' + this.end);
  }
}

/**
 * get result object
 **/
Interval.prototype.result = function(start, end) {
  var ret = {
    id   : this.id,
    data : this.data
  };
  if (typeof start == 'number' && typeof end == 'number') {
    /**
     * calc overlapping rate
     **/
    var left  = Math.max(this.start, start);
    var right = Math.min(this.end,   end);
    var lapLn = right - left;
    ret.rate1 = lapLn / (end - start);
    ret.rate2 = lapLn / (this.end - this.start);
  }
  return ret;
};

function DuplicateError(message) {
    this.name = 'DuplicateError';
    this.message = message;
    this.stack = (new Error()).stack;
}
DuplicateError.prototype = new Error;

exports.IntervalTree = IntervalTree;

})(module && module.exports || this);
},{"./SortedList.js":20}],17:[function(require,module,exports){
(function (global){
(function(exports){

// ==============================================================================================
// = LineMask: A (very cheap) alternative to IntervalTree: a small, 1D pixel buffer of objects. =
// ==============================================================================================
  
var utils = require('./utils.js'),
  floorHack = utils.floorHack;

function LineMask(width, fudge) {
  this.fudge = fudge = (fudge || 1);
  this.items = [];
  this.length = Math.ceil(width / fudge);
  this.mask = global.Uint8Array ? new Uint8Array(this.length) : new Array(this.length);
}

LineMask.prototype.add = function(x, w, data) {
  var upTo = Math.ceil((x + w) / this.fudge);
  this.items.push({x: x, w: w, data: data});
  for (var i = Math.max(floorHack(x / this.fudge), 0); i < Math.min(upTo, this.length); i++) { this.mask[i] = 1; }
};

LineMask.prototype.conflict = function(x, w) {
  var upTo = Math.ceil((x + w) / this.fudge);
  for (var i = Math.max(floorHack(x / this.fudge), 0); i < Math.min(upTo, this.length); i++) { if (this.mask[i]) return true; }
  return false;
};

exports.LineMask = LineMask;

})(module && module.exports || this);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./utils.js":21}],18:[function(require,module,exports){
(function(exports){
  
var IntervalTree = require('./IntervalTree.js').IntervalTree;  
var _ = require('../../../underscore.min.js');
var parseInt10 = require('./utils.js').parseInt10;

var PAIRING_CANNOT_MATE = 0,
  PAIRING_MATE_ONLY = 1,
  PAIRING_DRAW_AS_MATES = 2;

// TODO: backport this code for JavaScript 1.5? using underscore.js
/**
 * Wraps two of Shin Suzuki's IntervalTrees to store intervals that *may*
 * be paired.
 *
 * @see IntervalTree()
 **/
function PairedIntervalTree(center, unpairedOptions, pairedOptions) {
  var defaultOptions = {startKey: 0, endKey: 1};
  
  this.unpaired = new IntervalTree(center, unpairedOptions);
  this.unpairedOptions = _.extend({}, defaultOptions, unpairedOptions);
  
  this.paired = new IntervalTree(center, pairedOptions);
  this.pairedOptions = _.extend({pairingKey: 'qname', pairedLengthKey: 'tlen'}, defaultOptions, pairedOptions);
  if (this.pairedOptions.startKey === this.unpairedOptions.startKey) {
    throw new Error('startKey for unpairedOptions and pairedOptions must be different in a PairedIntervalTree');
  }
  if (this.pairedOptions.endKey === this.unpairedOptions.endKey) {
    throw new Error('endKey for unpairedOptions and pairedOptions must be different in a PairedIntervalTree');
  }
  
  this.pairingDisabled = false;
  this.pairingMinDistance = this.pairingMaxDistance = null;
}


/**
 * public methods
 **/


/**
 * Disables pairing. Effectively makes this equivalent, externally, to an IntervalTree.
 * This is useful if we discover that this data source doesn't contain paired reads.
 **/
PairedIntervalTree.prototype.disablePairing = function() {
  this.pairingDisabled = true;
  this.paired = this.unpaired;
};


/**
 * Set an interval within which paired mates will be saved as a continuous feature in .paired
 *
 * @param (number) min: Minimum distance, in bp
 * @param (number) max: Maximum distance, in bp
 **/
PairedIntervalTree.prototype.setPairingInterval = function(min, max) {
  if (typeof min != 'number') { throw new Error('you must specify min as the 1st argument.'); }
  if (typeof max != 'number') { throw new Error('you must specify max as the 2nd argument.'); }
  if (this.pairingMinDistance !== null) { throw new Error('Can only be called once. You can\'t change the pairing interval.'); }
  
  this.pairingMinDistance = min;
  this.pairingMaxDistance = max;
};


/**
 * add new range only if it is new, based on whether the id was already registered
 **/
PairedIntervalTree.prototype.addIfNew = function(data, id) {
  var mated = false,
    increment = 0,
    unpairedStart = this.unpairedOptions.startKey,
    unpairedEnd = this.unpairedOptions.endKey,
    pairedStart = this.pairedOptions.startKey,
    pairedEnd = this.pairedOptions.endKey,
    pairedLength = data[this.pairedOptions.pairedLengthKey],
    pairingState = PAIRING_CANNOT_MATE,
    newId, potentialMate;
  
  // .unpaired contains every alignment as a separate interval.
  // If it already contains this id, we've seen this read before and should disregard.
  if (this.unpaired.contains(id)) { return; }
  this.unpaired.add(data, id);
  
  // .paired contains alignments that may be mated into one interval if they are within the pairing range
  if (!this.pairingDisabled && _eligibleForPairing(this, data)) {
    if (this.pairingMinDistance === null) { 
      throw new Error('Can only add paired data after the pairing interval has been set!');
    }
    
    // instead of storing them with the given id, the pairingKey (for BAM, QNAME) is used as the id.
    // As intervals are added, we check if a read with the same pairingKey already exists in the .paired IntervalTree.
    newId = data[this.pairedOptions.pairingKey];
    potentialMate = this.paired.get(newId);
    
    if (potentialMate !== null) {
      potentialMate = potentialMate.data;
      pairingState = _pairingState(this, data, potentialMate);
      // Are the reads suitable for mating?
      if (pairingState === PAIRING_DRAW_AS_MATES || pairingState === PAIRING_MATE_ONLY) {
        // If yes: mate the reads
        potentialMate.mate = data;
        // In the other direction, has to be a selective shallow copy to avoid circular references.
        data.mate = _.extend({}, _.omit(potentialMate, function(v, k) { return _.isObject(v)}));
        data.mate.flags = _.clone(potentialMate.flags);
      }
    }
    
    // Are the mated reads within drawable range? If so, simply flag that they should be drawn together, and they will.
    // Alternatively, if the potentialMate expected a mate, we should mate them anyway.
    // The only reason we wouldn't get .drawAsMates is if the mate was on the threshold of the insert size range.
    if (pairingState === PAIRING_DRAW_AS_MATES || (pairingState === PAIRING_MATE_ONLY && potentialMate.mateExpected)) {
      data.drawAsMates = potentialMate.drawAsMates = true;
    } else {
      // Otherwise, need to insert this read into this.paired as a separate read.
      // Ensure the id is unique first.
      while (this.paired.contains(newId)) {
        newId = newId.replace(/\t.*/, '') + "\t" + (++increment);
      }
      
      data.mateExpected = _pairingState(this, data) === PAIRING_DRAW_AS_MATES;
      // FIXME: The following is perhaps a bit too specific to how TLEN for BAM files works; could generalize later
      // When inserting into .paired, the interval's .start and .end shouldn't be based on POS and the CIGAR string;
      // we must adjust them for TLEN, if it is nonzero, depending on its sign, and set new bounds for the interval.
      if (data.mateExpected && pairedLength > 0) {
        data[pairedStart] = data[unpairedStart];
        data[pairedEnd] = data[unpairedStart] + pairedLength;
      } else if (data.mateExpected && pairedLength < 0) {
        data[pairedEnd] = data[unpairedEnd];
        data[pairedStart] = data[unpairedEnd] + pairedLength;
      } else { // !data.mateExpected || pairedLength == 0
        data[pairedStart] = data[unpairedStart];
        data[pairedEnd] = data[unpairedEnd];
      }
      
      this.paired.add(data, newId);
    }
  }

};


/**
 * alias .add() to .addIfNew()
 **/
PairedIntervalTree.prototype.add = PairedIntervalTree.prototype.addIfNew;


/**
 * search
 *
 * @param (number) val:
 * @return (array)
 **/
PairedIntervalTree.prototype.search = function(val1, val2, paired) {
  if (paired && !this.pairingDisabled) {
    return this.paired.search(val1, val2);
  } else {
    return this.unpaired.search(val1, val2);
  }
};


/**
 * remove: unimplemented for now
 **/
PairedIntervalTree.prototype.remove = function(interval_id) {
  throw ".remove() is currently unimplemented";
};


/**
 * private methods
 **/

// Check if an itvl is eligible for pairing. 
// For now, this means that if any FLAG's 0x100 or higher are set, we totally discard this alignment and interval.
// FIXME: The following is entangled with bam.js internals; perhaps allow this to be generalized, overridden,
//        or set alongside .setPairingInterval()
//
// @return (boolean)
function _eligibleForPairing(pairedItvlTree, itvl) {
  var flags = itvl.flags;
  if (flags.isSecondaryAlignment || flags.isReadFailingVendorQC || flags.isDuplicateRead || flags.isSupplementaryAlignment) {
    return false;
  }
  return true;
}

// Check if an itvl and its potentialMate are within the right distance, and orientation, to be mated.
// If potentialMate isn't given, takes a best guess if a mate is expected, given the information in itvl alone.
// FIXME: The following is entangled with bam.js internals; perhaps allow this to be generalized, overridden,
//        or set alongside .setPairingInterval()
// 
// @return (number)
function _pairingState(pairedItvlTree, itvl, potentialMate) {
  var tlen = itvl[pairedItvlTree.pairedOptions.pairedLengthKey],
    itvlLength = itvl.end - itvl.start,
    itvlIsLater, inferredInsertSize;

  if (_.isUndefined(potentialMate)) {
    // Create the most receptive hypothetical mate, given the information in itvl.
    potentialMate = {
      _mocked: true,
      flags: {
        isReadPaired: true,
        isReadProperlyAligned: true,
        isReadFirstOfPair: itvl.flags.isReadLastOfPair,
        isReadLastOfPair: itvl.flags.isReadFirstOfPair
      }
    };
  }

  // First check a whole host of FLAG's. To make a long story short, we expect paired ends to be either
  // 99-147 or 163-83, depending on whether the rightmost or leftmost segment is primary.
  if (!itvl.flags.isReadPaired || !potentialMate.flags.isReadPaired) { return PAIRING_CANNOT_MATE; }
  if (!itvl.flags.isReadProperlyAligned || !potentialMate.flags.isReadProperlyAligned) { return PAIRING_CANNOT_MATE; }
  if (itvl.flags.isReadUnmapped || potentialMate.flags.isReadUnmapped) { return PAIRING_CANNOT_MATE; }
  if (itvl.flags.isMateUnmapped || potentialMate.flags.isMateUnmapped) { return PAIRING_CANNOT_MATE; }
  if (itvl.flags.isReadFirstOfPair && !potentialMate.flags.isReadLastOfPair) { return PAIRING_CANNOT_MATE; }
  if (itvl.flags.isReadLastOfPair && !potentialMate.flags.isReadFirstOfPair) { return PAIRING_CANNOT_MATE; }
    
  if (potentialMate._mocked) {
    _.extend(potentialMate, {
      rname: itvl.rnext == '=' ? itvl.rname : itvl.rnext,
      pos: itvl.pnext,
      start: itvl.rnext == '=' ? parseInt10(itvl.pnext) + (itvl.start - parseInt10(itvl.pos)) : 0,
      end: tlen > 0 ? itvl.start + tlen : (tlen < 0 ? itvl.end + tlen + itvlLength : 0),
      rnext: itvl.rnext == '=' ? '=' : itvl.rname,
      pnext: itvl.pos
    });
  }
  
  // Check that the alignments are on the same reference sequence
  if (itvl.rnext != '=' || potentialMate.rnext != '=') { 
    // and if not, do the coordinates match at all?
    if (itvl.rnext != potentialMate.rname || itvl.rnext != potentialMate.rname) { return PAIRING_CANNOT_MATE; }
    if (itvl.pnext != potentialMate.pos || itvl.pos != potentialMate.pnext) { return PAIRING_CANNOT_MATE; }
    return PAIRING_MATE_ONLY;
  }
  
  if (potentialMate._mocked) {
    _.extend(potentialMate.flags, {
      readStrandReverse: itvl.flags.mateStrandReverse,
      mateStrandReverse: itvl.flags.readStrandReverse
    });
  } 
  
  itvlIsLater = itvl.start > potentialMate.start;
  inferredInsertSize = itvlIsLater ? itvl.start - potentialMate.end : potentialMate.start - itvl.end;
  
  // Check that the alignments are --> <--
  if (itvlIsLater) {
    if (!itvl.flags.readStrandReverse || itvl.flags.mateStrandReverse) { return PAIRING_MATE_ONLY; }
    if (potentialMate.flags.readStrandReverse || !potentialMate.flags.mateStrandReverse) { return PAIRING_MATE_ONLY; }
  } else {
    if (itvl.flags.readStrandReverse || !itvl.flags.mateStrandReverse) { return PAIRING_MATE_ONLY; }
    if (!potentialMate.flags.readStrandReverse || potentialMate.flags.mateStrandReverse) { return PAIRING_MATE_ONLY; }
  }
  
  // Check that the inferredInsertSize is within the acceptable range.
  itvl.insertSize = potentialMate.insertSize = inferredInsertSize;
  if (inferredInsertSize > this.pairingMaxDistance || inferredInsertSize < this.pairingMinDistance) { return PAIRING_MATE_ONLY; }
  
  return PAIRING_DRAW_AS_MATES;
}

exports.PairedIntervalTree = PairedIntervalTree;

})(module && module.exports || this);
},{"../../../underscore.min.js":34,"./IntervalTree.js":16,"./utils.js":21}],19:[function(require,module,exports){
(function(exports){

var _ = require('../../../underscore.min.js');

/**
  * RemoteTrack
  *
  * A helper class built for caching data fetched from a remote track (data aligned to a genome).
  * The genome is divided into bins of optimalFetchWindow nts, for each of which data will only be fetched once.
  * To setup the bins, call .setupBins(...) after initializing the class.
  *
  * There is one main public method for this class: .fetchAsync(start, end, callback)
  * (For consistency with CustomTracks.js, all `start` and `end` positions are 1-based, oriented to
  * the start of the genome, and intervals are right-open.)
  *
  * This method will request and cache data for the given interval that is not already cached, and call 
  * callback(intervals) as soon as data for all intervals is available. (If the data is already available, 
  * it will call the callback immediately.)
  **/

var BIN_LOADING = 1,
  BIN_LOADED = 2;

/**
  * RemoteTrack constructor.
  *
  * Note you still must call `.setupBins(...)` before the RemoteTrack is ready to fetch data.
  *
  * @param (IntervalTree) cache: An cache store that will receive intervals fetched for each bin.
  *                              Should be an IntervalTree or equivalent, that implements `.addIfNew(...)` and 
  *                              `.search(start, end)` methods. If it is an *extension* of an IntervalTree, note 
  *                              the `extraArgs` param permitted for `.fetchAsync()`, which are passed along as 
  *                              extra arguments to `.search()`.
  * @param (function) fetcher: A function that will be called to fetch data for each bin.
  *                            This function should take three arguments, `start`, `end`, and `storeIntervals`.
  *                            `start` and `end` are 1-based genomic coordinates forming a right-open interval.
  *                            `storeIntervals` is a callback that `fetcher` MUST call on the array of intervals
  *                            once they have been fetched from the remote data source and parsed.
  * @see _fetchBin for how `fetcher` is utilized.
  **/
function RemoteTrack(cache, fetcher) {
  if (typeof cache != 'object' || (!cache.addIfNew && (!_.keys(cache).length || cache[_.keys(cache)[0]].addIfNew))) { 
    throw new Error('you must specify an IntervalTree cache, or an object/array containing IntervalTrees, as the 1st argument.'); 
  }
  if (typeof fetcher != 'function') { throw new Error('you must specify a fetcher function as the 2nd argument.'); }
  
  this.cache = cache;
  this.fetcher = fetcher;
  
  this.callbacks = [];
  this.afterBinSetup = [];
  this.binsLoaded = null;
}

/**
 * public methods
 **/

// Setup the binning scheme for this RemoteTrack. This can occur anytime after initialization, and in fact,
// can occur after calls to `.fetchAsync()` have been made, in which case they will be waiting on this method
// to be called to proceed. But it MUST be called before data will be received by callbacks passed to 
// `.fetchAsync()`.
RemoteTrack.prototype.setupBins = function(genomeSize, optimalFetchWindow, maxFetchWindow) {
  var self = this;
  if (self.binsLoaded) { throw new Error('you cannot run setupBins more than once.'); }
  if (typeof genomeSize != 'number') { throw new Error('you must specify the genomeSize as the 1st argument.'); }
  if (typeof optimalFetchWindow != 'number') { throw new Error('you must specify optimalFetchWindow as the 2nd argument.'); }
  if (typeof maxFetchWindow != 'number') { throw new Error('you must specify maxFetchWindow as the 3rd argument.'); }
  
  self.genomeSize = genomeSize;
  self.optimalFetchWindow = optimalFetchWindow;
  self.maxFetchWindow = maxFetchWindow;
  
  self.numBins = Math.ceil(genomeSize / optimalFetchWindow);
  self.binsLoaded = {};
  
  // Fire off ranges saved to afterBinSetup
  _.each(this.afterBinSetup, function(range) {
    self.fetchAsync(range.start, range.end, range.extraArgs);
  });
  _clearCallbacksForTooBigIntervals(self);
}


// Fetches data (if necessary) for unfetched bins overlapping with the interval from `start` to `end`.
// Then, run `callback` on all stored subintervals that overlap with the interval from `start` to `end`.
// `extraArgs` is an *optional* parameter that can contain arguments passed to the `.search()` function of the cache.
//
// @param (number) start:       1-based genomic coordinate to start fetching from
// @param (number) end:         1-based genomic coordinate (right-open) to start fetching *until*
// @param (Array) [extraArgs]:  optional, passed along to the `.search()` calls on the .cache as arguments 3 and up; 
//                              perhaps useful if the .cache has overridden this method
// @param (function) callback:  A function that will be called once data is ready for this interval. Will be passed
//                              all interval features that have been fetched for this interval, or {tooMany: true}
//                              if more data was requested than could be reasonably fetched.
RemoteTrack.prototype.fetchAsync = function(start, end, extraArgs, callback) {
  var self = this;
  if (_.isFunction(extraArgs) && _.isUndefined(callback)) { callback = extraArgs; extraArgs = undefined; }
  if (!self.binsLoaded) {
    // If bins *aren't* setup yet:
    // Save the callback onto the queue
    if (_.isFunction(callback)) { 
      self.callbacks.push({start: start, end: end, extraArgs: extraArgs, callback: callback}); 
    }
    
    // Save this fetch for when the bins are loaded
    self.afterBinSetup.push({start: start, end: end, extraArgs: extraArgs});
  } else {
    // If bins *are* setup, first calculate which bins correspond to this interval, 
    // and what state those bins are in
    var bins = _binOverlap(self, start, end),
      loadedBins = _.filter(bins, function(i) { return self.binsLoaded[i] === BIN_LOADED; }),
      binsToFetch = _.filter(bins, function(i) { return !self.binsLoaded[i]; });
    
    if (loadedBins.length == bins.length) {
      // If we've already loaded data for all the bins in question, short-circuit and run the callback now
      extraArgs = _.isUndefined(extraArgs) ? [] : extraArgs;
      return _.isFunction(callback) && callback(self.cache.search.apply(self.cache, [start, end].concat(extraArgs)));
    } else if (end - start > self.maxFetchWindow) {
      // else, if this interval is too big (> maxFetchWindow), fire the callback right away with {tooMany: true}
      return _.isFunction(callback) && callback({tooMany: true});
    }
    
    // else, push the callback onto the queue
    if (_.isFunction(callback)) { 
      self.callbacks.push({start: start, end: end, extraArgs: extraArgs, callback: callback}); 
    }
    
    // then run fetches for the unfetched bins, which should call _fireCallbacks after they complete,
    // which will automatically fire callbacks from the above queue as they acquire all needed data.
    _.each(binsToFetch, function(binIndex) {
      _fetchBin(self, binIndex, function() { _fireCallbacks(self); });
    });
  }
}


/**
 * private methods
 **/

// Calculates which bins overlap with an interval given by `start` and `end`.
// `start` and `end` are 1-based coordinates forming a right-open interval.
function _binOverlap(remoteTrk, start, end) {
  if (!remoteTrk.binsLoaded) { throw new Error('you cannot calculate bin overlap before setupBins is called.'); }
  // Internally, for assigning coordinates to bins, we use 0-based coordinates for easier calculations.
  var startBin = Math.floor((start - 1) / remoteTrk.optimalFetchWindow),
    endBin = Math.floor((end - 1) / remoteTrk.optimalFetchWindow);
  return _.range(startBin, endBin + 1);
}

// Runs the fetcher function on a given bin.
// The fetcher function is obligated to run a callback function `storeIntervals`, 
//    passed as its third argument, on a set of intervals that will be inserted into the 
//    remoteTrk.cache IntervalTree.
// The `storeIntervals` function may accept a second argument called `cacheIndex`, in case
//    remoteTrk.cache is actually a container for multiple IntervalTrees, indicating which 
//    one to store it in.
// We then call the `callback` given here after that is complete.
function _fetchBin(remoteTrk, binIndex, callback) {
  var start = binIndex * remoteTrk.optimalFetchWindow + 1,
    end = (binIndex + 1) * remoteTrk.optimalFetchWindow + 1;
  remoteTrk.binsLoaded[binIndex] = BIN_LOADING;
  remoteTrk.fetcher(start, end, function storeIntervals(intervals) {
    _.each(intervals, function(interval) {
      if (!interval) { return; }
      remoteTrk.cache.addIfNew(interval, interval.id);
    });
    remoteTrk.binsLoaded[binIndex] = BIN_LOADED;
    _.isFunction(callback) && callback();
  });
}

// Runs through all saved callbacks and fires any callbacks where all the required data is ready
// Callbacks that are fired are removed from the queue.
function _fireCallbacks(remoteTrk) {
  remoteTrk.callbacks = _.filter(remoteTrk.callbacks, function(afterLoad) {
    var callback = afterLoad.callback,
      extraArgs = _.isUndefined(afterLoad.extraArgs) ? [] : afterLoad.extraArgs,
      bins, stillLoadingBins;
        
    if (afterLoad.end - afterLoad.start > remoteTrk.maxFetchWindow) {
      callback({tooMany: true});
      return false;
    }
    
    bins = _binOverlap(remoteTrk, afterLoad.start, afterLoad.end);
    stillLoadingBins = _.filter(bins, function(i) { return remoteTrk.binsLoaded[i] !== BIN_LOADED; }).length > 0;
    if (!stillLoadingBins) {
      callback(remoteTrk.cache.search.apply(remoteTrk.cache, [afterLoad.start, afterLoad.end].concat(extraArgs)));
      return false;
    }
    return true;
  });
}

// Runs through all saved callbacks and fires any callbacks for which we won't load data since the amount
// requested is too large. Callbacks that are fired are removed from the queue.
function _clearCallbacksForTooBigIntervals(remoteTrk) {
  remoteTrk.callbacks = _.filter(remoteTrk.callbacks, function(afterLoad) {
    var callback = afterLoad.callback;
    if (afterLoad.end - afterLoad.start > remoteTrk.maxFetchWindow) {
      callback({tooMany: true});
      return false;
    }
    return true;
  });
}


exports.RemoteTrack = RemoteTrack;

})(module && module.exports || this);
},{"../../../underscore.min.js":34}],20:[function(require,module,exports){
(function(exports){
// TODO: backport this code for JavaScript 1.5? using underscore.js
/**
 * By Shin Suzuki, MIT license
 * https://github.com/shinout/SortedList
 *
 * SortedList : constructor
 * 
 * @param arr : Array or null : an array to set
 *
 * @param options : object  or null
 *         (function) filter  : filter function called before inserting data.
 *                              This receives a value and returns true if the value is valid.
 *
 *         (function) compare : function to compare two values, 
 *                              which is used for sorting order.
 *                              the same signature as Array.prototype.sort(fn).
 *                              
 *         (string)   compare : if you'd like to set a common comparison function,
 *                              you can specify it by string:
 *                              "number" : compares number
 *                              "string" : compares string
 */
function SortedList() {
  var arr     = null,
      options = {},
      args    = arguments;

  ["0","1"].forEach(function(n) {
    var val = args[n];
    if (Array.isArray(val)) {
      arr = val;
    }
    else if (val && typeof val == "object") {
      options = val;
    }
  });
  this.arr = [];

  ["filter", "compare"].forEach(function(k) {
    if (typeof options[k] == "function") {
      this[k] = options[k];
    }
    else if (options[k] && SortedList[k][options[k]]) {
      this[k] = SortedList[k][options[k]];
    }
  }, this);
  if (arr) this.massInsert(arr);
};

// Binary search for the index of the item equal to `val`, or if no such item exists, the next lower item
// This can be -1 if `val` is lower than the lowest item in the SortedList
SortedList.prototype.bsearch = function(val) {
  var mpos,
      spos = 0,
      epos = this.arr.length;
  while (epos - spos > 1) {
    mpos = Math.floor((spos + epos)/2);
    mval = this.arr[mpos];
    switch (this.compare(val, mval)) {
    case 1  :
    default :
      spos = mpos;
      break;
    case -1 :
      epos = mpos;
      break;
    case 0  :
      return mpos;
    }
  }
  return (this.arr[0] == null || spos == 0 && this.arr[0] != null && this.compare(this.arr[0], val) == 1) ? -1 : spos;
};

SortedList.prototype.get = function(pos) {
  return this.arr[pos];
};

SortedList.prototype.toArray = function(pos) {
  return this.arr.slice();
};

SortedList.prototype.slice = function() {
  return this.arr.slice.apply(this.arr, arguments);
}

SortedList.prototype.size = function() {
  return this.arr.length;
};

SortedList.prototype.head = function() {
  return this.arr[0];
};

SortedList.prototype.tail = function() {
  return (this.arr.length == 0) ? null : this.arr[this.arr.length -1];
};

SortedList.prototype.massInsert = function(items) {
  // This loop avoids call stack overflow because of too many arguments
  for (var i = 0; i < items.length; i += 4096) {
    Array.prototype.push.apply(this.arr, Array.prototype.slice.call(items, i, i + 4096));
  }
  this.arr.sort(this.compare);
}

SortedList.prototype.insert = function() {
  if (arguments.length > 100) {
    // .bsearch + .splice is too expensive to repeat for so many elements.
    // Let's just append them all to this.arr and resort.
    this.massInsert(arguments);
  } else {
    Array.prototype.forEach.call(arguments, function(val) {
      var pos = this.bsearch(val);
      if (this.filter(val, pos)) {
        this.arr.splice(pos+1, 0, val);
      }
    }, this);
  }
};

SortedList.prototype.filter = function(val, pos) {
  return true;
};

SortedList.prototype.add = SortedList.prototype.insert;

SortedList.prototype["delete"] = function(pos) {
  this.arr.splice(pos, 1);
};

SortedList.prototype.remove = SortedList.prototype["delete"];

SortedList.prototype.massRemove = function(startPos, count) {
  this.arr.splice(startPos, count);
};

/**
 * default compare functions 
 **/
SortedList.compare = {
  "number": function(a, b) {
    var c = a - b;
    return (c > 0) ? 1 : (c == 0)  ? 0 : -1;
  },

  "string": function(a, b) {
    return (a > b) ? 1 : (a == b)  ? 0 : -1;
  }
};

SortedList.prototype.compare = SortedList.compare["number"];

exports.SortedList = SortedList;

})(module && module.exports || this);
},{}],21:[function(require,module,exports){
var _ = require('../../../underscore.min.js');

// Parse a track declaration line, which is in the format of:
// track name="blah" optname1="value1" optname2="value2" ...
// into a hash of options
module.exports.parseDeclarationLine = function(line, start) {
  var opts = {}, optname = '', value = '', state = 'optname';
  function pushValue(quoting) {
    state = 'optname';
    opts[optname.replace(/^\s+|\s+$/g, '')] = value;
    optname = value = '';
  }
  for (i = line.match(start)[0].length; i < line.length; i++) {
    c = line[i];
    if (state == 'optname') {
      if (c == '=') { state = 'startvalue'; }
      else { optname += c; }
    } else if (state == 'startvalue') {
      if (/'|"/.test(c)) { state = c; }
      else { value += c; state = 'value'; }
    } else if (state == 'value') {
      if (/\s/.test(c)) { pushValue(); }
      else { value += c; }
    } else if (/'|"/.test(state)) {
      if (c == state) { pushValue(state); }
      else { value += c; }
    }
  }
  if (state == 'value') { pushValue(); }
  if (state != 'optname') { return false; }
  return opts;
}

// Constructs a mapping function that converts bp intervals into pixel intervals, with optional calculations for text too
module.exports.pixIntervalCalculator = function(start, width, bppp, withText, nameFunc, startkey, endkey) {
  if (!_.isFunction(nameFunc)) { nameFunc = function(d) { return d.name || ''; }; }
  if (_.isUndefined(startkey)) { startkey = 'start'; }
  if (_.isUndefined(endkey)) { endkey = 'end'; }
  return function(d) {
    var itvlStart = _.isUndefined(d[startkey]) ? d.start : d[startkey],
      itvlEnd = _.isUndefined(d[endkey]) ? d.end : d[endkey];
    var pInt = {
      x: Math.round((itvlStart - start) / bppp),
      w: Math.round((itvlEnd - itvlStart) / bppp) + 1,
      t: 0,          // calculated width of text
      oPrev: false,  // overflows into previous tile?
      oNext: false   // overflows into next tile?
    };
    pInt.tx = pInt.x;
    pInt.tw = pInt.w;
    if (pInt.x < 0) { pInt.w += pInt.x; pInt.x = 0; pInt.oPrev = true; }
    else if (withText) {
      pInt.t = _.isNumber(withText) ? withText : Math.min(nameFunc(d).length * 10 + 2, pInt.x);
      pInt.tx -= pInt.t;
      pInt.tw += pInt.t;  
    }
    if (pInt.x + pInt.w > width) { pInt.w = width - pInt.x; pInt.oNext = true; }
    return pInt;
  };
};

// For two given objects of the form {x: 1, w: 2} (pixel intervals), describe the overlap.
// Returns null if there is no overlap.
module.exports.pixIntervalOverlap = function(pInt1, pInt2) {
  var overlap = {},
    tmp;
  if (pInt1.x > pInt2.x) { tmp = pInt2; pInt2 = pInt1; pInt1 = tmp; }       // swap so that pInt1 is always lower
  if (!pInt1.w || !pInt2.w || pInt1.x + pInt1.w < pInt2.x) { return null; } // detect no-overlap conditions
  overlap.x = pInt2.x;
  overlap.w = Math.min(pInt1.w - pInt2.x + pInt1.x, pInt2.w);
  return overlap;
};

// Common functions for summarizing data in bins while plotting wiggle tracks
module.exports.wigBinFunctions = {
  minimum: function(bin) { return bin.length ? Math.min.apply(Math, bin) : 0; },
  mean: function(bin) { return _.reduce(bin, function(a,b) { return a + b; }, 0) / bin.length; },
  maximum: function(bin) { return bin.length ? Math.max.apply(Math, bin) : 0; }
};

// Faster than Math.floor (http://webdood.com/?p=219)
module.exports.floorHack = function(num) { return (num << 0) - (num < 0 ? 1 : 0); }

// Other tiny functions that we need for odds and ends...
module.exports.strip = function(str) { return str.replace(/^\s+|\s+$/g, ''); }
module.exports.parseInt10 = function(val) { return parseInt(val, 10); }
module.exports.deepClone = function(obj) { return JSON.parse(JSON.stringify(obj)); }
},{"../../../underscore.min.js":34}],22:[function(require,module,exports){
// ====================================================================
// = vcfTabix format: http://genome.ucsc.edu/goldenPath/help/vcf.html =
// ====================================================================

var utils = require('./utils/utils.js'),
  parseInt10 = utils.parseInt10;

// Intended to be loaded into CustomTrack.types.vcftabix
var VcfTabixFormat = {
  defaults: {
    priority: 100,
    drawLimit: {squish: 500, pack: 100},
    maxFetchWindow: 100000,
    chromosomes: ''
  },

  init: function() {
    if (!this.opts.bigDataUrl) {
      throw new Error("Required parameter bigDataUrl not found for vcfTabix track at " + JSON.stringify(this.opts) + (this.opts.lineNum + 1));
    }
  },

  parse: function(lines) {
    var self = this;
    self.heights = {max: null, min: 15, start: 15};
    self.sizes = ['dense', 'squish', 'pack'];
    self.mapSizes = ['pack'];
    // TODO: Set maxFetchWindow using some heuristic based on how many items are in the tabix index
    return true;
  },

  prerender: function(start, end, density, precalc, callback) {
    var self = this,
      width = precalc.width,
      data = self.data,
      bppp = (end - start) / width,
      range = this.chrRange(start, end);
    
    function lineToInterval(line) {
      var fields = line.split('\t'), data = {}, info = {};
      if (fields[7]) {
        _.each(fields[7].split(';'), function(l) { l = l.split('='); if (l.length > 1) { info[l[0]] = l[1]; } });
      }
      data.start = self.browserOpts.chrPos[fields[0]] + parseInt10(fields[1]);
      data.id = fields[2]=='.' ? 'vcf-' + Math.floor(Math.random() * 100000000) : fields[2];
      data.end = data.start + 1;
      data.ref = fields[3];
      data.alt = fields[4];
      data.qual = parseFloat(fields[5]);
      data.info = info;
      return {data: data};
    }
    function nameFunc(fields) {
      var ref = fields.ref || '',
        alt = fields.alt || '';
      return (ref.length > alt.length ? ref : alt) || '';
    }
  
    function success(data) {
      var drawSpec = [],
        lines = _.filter(data.split('\n'), function(l) { var m = l.match(/\t/g); return m && m.length > 8; }),
        calcPixInterval = new utils.pixIntervalCalculator(start, width, bppp, density=='pack', nameFunc);
      if (density == 'dense') {
        _.each(lines, function(line) {
          drawSpec.push(calcPixInterval(lineToInterval(line).data));
        });
      } else {
        drawSpec = {layout: self.type('bed').stackedLayout(_.map(lines, lineToInterval), width, calcPixInterval)};
        drawSpec.width = width;
      }
      callback(drawSpec);
    }
  
    // Don't even attempt to fetch the data if we can reasonably estimate that we will fetch too much data, as this will only delay other requests.
    // TODO: cache results so we aren't refetching the same regions over and over again.
    if ((end - start) > self.opts.maxFetchWindow) {
      callback({tooMany: true});
    } else {
      $.ajax(this.ajaxDir() + 'tabix.php', {
        data: {range: range, url: this.opts.bigDataUrl},
        success: success
      });
    }
  },

  render: function(canvas, start, end, density, callback) {
    var ctx = canvas.getContext && canvas.getContext('2d'),
      urlTemplate = this.opts.url ? this.opts.url : 'javascript:void("'+this.opts.name+':$$")',
      lineHeight = density == 'pack' ? 27 : 6,
      colors = {a:'255,0,0', t:'255,0,255', c:'0,0,255', g:'0,255,0'},
      drawLimit = this.opts.drawLimit && this.opts.drawLimit[density],
      areas = null;
    if (!ctx) { throw "Canvas not supported"; }
    if (density == 'pack') { areas = this.areas[canvas.id] = []; }
    ctx.fillStyle = "rgb(0,0,0)";
    this.prerender(start, end, density, {width: canvas.width}, function(drawSpec) {
      if ((drawLimit && drawSpec.length > drawLimit) || drawSpec.tooMany) { 
        canvas.height = 0;
        // This applies styling that indicates there was too much data to load/draw and that the user needs to zoom to see more
        canvas.className = canvas.className + ' too-many';
      } else if (density == 'dense') {
        canvas.height = 15;
        _.each(drawSpec, function(pInt) {
          ctx.fillRect(pInt.x, 1, pInt.w, 13);
        });
      } else {
        canvas.height = drawSpec.layout.length * lineHeight;
        _.each(drawSpec.layout, function(l, i) {
          _.each(l, function(data) {
            var altColor, refColor;
            if (areas) {
              refColor = colors[data.d.ref.toLowerCase()] || '255,0,0';
              altColor = colors[data.d.alt.toLowerCase()] || '255,0,0';
              ctx.fillStyle = "rgb(" + altColor + ")"; 
            }
            ctx.fillRect(data.pInt.x, i * lineHeight + 1, data.pInt.w, lineHeight - 1);
            if (areas) {
              areas.push([
                data.pInt.x, i * lineHeight + 1, data.pInt.x + data.pInt.w, (i + 1) * lineHeight, //x1, x2, y1, y2
                data.d.ref + ' > ' + data.d.alt, // title
                urlTemplate.replace('$$', data.d.id), // href
                data.pInt.oPrev, // continuation from previous tile?
                altColor, // label color
                '<span style="color: rgb(' + refColor + ')">' + data.d.ref + '</span><br/>' + data.d.alt, // label
                data.d.info
              ]);
            }
          });
        });
      }
      if (_.isFunction(callback)) { callback(); }
    });
  }
};

module.exports = VcfTabixFormat;


},{"./utils/utils.js":21}],23:[function(require,module,exports){
(function (global){
// ==================================================================
// = WIG format: http://genome.ucsc.edu/goldenPath/help/wiggle.html =
// ==================================================================

var utils = require('./utils/utils.js'),
  parseInt10 = utils.parseInt10,
  parseDeclarationLine = utils.parseDeclarationLine;
var SortedList = require('./utils/SortedList.js').SortedList;

// Intended to be loaded into CustomTrack.types.wiggle_0
var WiggleFormat = {
  defaults: {
    altColor: '',
    priority: 100,
    autoScale: 'on',
    alwaysZero: 'off',
    gridDefault: 'off',
    maxHeightPixels: '128:128:15',
    graphType: 'bar',
    viewLimits: '',
    yLineMark: 0.0,
    yLineOnOff: 'off',
    windowingFunction: 'maximum',
    smoothingWindow: 'off'
  },

  init: function() {
    this.type().initOpts.call(this);
  },
  
  _binFunctions: utils.wigBinFunctions,
  
  initOpts: function() {
    var o = this.opts,
      _binFunctions = this.type()._binFunctions;
    if (!this.validateColor(o.altColor)) { o.altColor = ''; }
    o.viewLimits = _.map(o.viewLimits.split(':'), parseFloat);
    o.maxHeightPixels = _.map(o.maxHeightPixels.split(':'), parseInt10);
    o.yLineOnOff = this.isOn(o.yLineOnOff);
    o.yLineMark = parseFloat(o.yLineMark);
    o.autoScale = this.isOn(o.autoScale);
    if (_binFunctions && !_binFunctions[o.windowingFunction]) {
      throw new Error("invalid windowingFunction at line " + o.lineNum); 
    }
    if (_.isNaN(o.yLineMark)) { o.yLineMark = 0.0; }
  },
  
  applyOpts: function() {
    var self = this,
      o = self.opts;
    self.drawRange = o.autoScale || o.viewLimits.length < 2 ? self.range : o.viewLimits;
    _.each({max: 0, min: 2, start: 1}, function(v, k) { self.heights[k] = o.maxHeightPixels[v]; });
    if (!o.altColor) {
      var hsl = this.rgbToHsl.apply(this, o.color.split(/,\s*/g));
      hsl[0] = hsl[0] + 0.02 % 1;
      hsl[1] = hsl[1] * 0.7;
      hsl[2] = 1 - (1 - hsl[2]) * 0.7;
      self.altColor = _.map(this.hslToRgb.apply(this, hsl), parseInt10).join(',');
    }
  },

  parse: function(lines) {
    var self = this,
      genomeSize = this.browserOpts.genomeSize,
      data = {all: []},
      mode, modeOpts, chrPos, m;
    self.range = self.isOn(this.opts.alwaysZero) ? [0, 0] : [Infinity, -Infinity];
  
    _.each(lines, function(line, lineno) {
      var val, start;
      
      m = line.match(/^(variable|fixed)Step\s+/i);
      if (m) {
        mode = m[1].toLowerCase();
        modeOpts = parseDeclarationLine(line, /^(variable|fixed)Step\s+/i);
        modeOpts.start = parseInt10(modeOpts.start);
        if (mode == 'fixed' && (_.isNaN(modeOpts.start) || !modeOpts.start)) {
          throw new Error("fixedStep at line " + (lineno + 1 + self.opts.lineNum) + " require non-zero start parameter"); 
        }
        modeOpts.step = parseInt10(modeOpts.step);
        if (mode == 'fixed' && (_.isNaN(modeOpts.step) || !modeOpts.step)) {
          throw new Error("fixedStep at line " + (lineno + 1 + self.opts.lineNum) + " require non-zero step parameter"); 
        }
        modeOpts.span = parseInt10(modeOpts.span) || 1;
        chrPos = self.browserOpts.chrPos[modeOpts.chrom];
        if (_.isUndefined(chrPos)) {
          self.warn("Invalid chromosome at line " + (lineno + 1 + self.opts.lineNum));
        }
      } else {
        if (!mode) { 
          throw new Error("Wiggle format at " + (lineno + 1 + self.opts.lineNum) + " has no preceding mode declaration"); 
        } else if (_.isUndefined(chrPos)) {
          // invalid chromosome
        } else {
          if (mode == 'fixed') {
            val = parseFloat(line);
            data.all.push({start: chrPos + modeOpts.start, end: chrPos + modeOpts.start + modeOpts.span, val: val});
            modeOpts.start += modeOpts.step;
          } else {
            line = line.split(/\s+/);
            if (line.length < 2) {
              throw new Error("variableStep at line " + (lineno + 1 + self.opts.lineNum) + " requires two values per line"); 
            }
            start = parseInt10(line[0]);
            val = parseFloat(line[1]);
            data.all.push({start: chrPos + start, end: chrPos + start + modeOpts.span, val: val});
          }
        }
      }
    });
    
    return self.type().finishParse.call(self, data);
  },
  
  finishParse: function(data) {
    var self = this,
      binFunction = self.type()._binFunctions[self.opts.windowingFunction];
    if (data.all.length > 0) {
      self.range[0] = _.min(data.all, function(d) { return d.val; }).val;
      self.range[1] = _.max(data.all, function(d) { return d.val; }).val;
    }
    data.all = new SortedList(data.all, {
      compare: function(a, b) {
        if (a === null) return -1;
        if (b === null) return  1;
        var c = a.start - b.start;
        return (c > 0) ? 1 : (c === 0)  ? 0 : -1;
      }
    });
  
    // Pre-optimize data for high bppps by downsampling
    _.each(self.browserOpts.bppps, function(bppp) {
      if (self.browserOpts.genomeSize / bppp > 1000000) { return; }
      var pixLen = Math.ceil(self.browserOpts.genomeSize / bppp),
        downsampledData = (data[bppp] = (global.Float32Array ? new Float32Array(pixLen) : new Array(pixLen))),
        j = 0,
        curr = data.all.get(0),
        bin, next;
      for (var i = 0; i < pixLen; i++) {
        bin = curr && (curr.start <= i * bppp && curr.end > i * bppp) ? [curr.val] : [];
        while ((next = data.all.get(j + 1)) && next.start < (i + 1) * bppp && next.end > i * bppp) { 
          bin.push(next.val); ++j; curr = next; 
        }
        downsampledData[i] = binFunction(bin);
      }
      data._binFunction = self.opts.windowingFunction;
    });
    self.data = data;
    self.stretchHeight = true;
    self.type('wiggle_0').applyOpts.apply(self);
    return true; // success!
  },
  
  initDrawSpec: function(precalc) {
    var vScale = (this.drawRange[1] - this.drawRange[0]) / precalc.height,
      drawSpec = {
        bars: [],
        vScale: vScale,
        yLine: this.isOn(this.opts.yLineOnOff) ? Math.round((this.opts.yLineMark - this.drawRange[0]) / vScale) : null, 
        zeroLine: -this.drawRange[0] / vScale
      };
    return drawSpec;
  },

  prerender: function(start, end, density, precalc, callback) {
    var self = this,
      bppp = (end - start) / precalc.width,
      drawSpec = self.type().initDrawSpec.call(self, precalc),
      binFunction = self.type()._binFunctions[self.opts.windowingFunction],
      downsampledData;
    if (self.data._binFunction == self.opts.windowingFunction && (downsampledData = self.data[bppp])) {
      // We've already pre-optimized for this bppp
      drawSpec.bars = _.map(_.range((start - 1) / bppp, (end - 1) / bppp), function(xFromOrigin, x) {
        return ((downsampledData[xFromOrigin] || 0) - self.drawRange[0]) / drawSpec.vScale;
      });
    } else {
      // We have to do the binning on the fly
      var j = self.data.all.bsearch({start: start}),
        curr = self.data.all.get(j), next, bin;
      for (var i = 0; i < precalc.width; i++) {
        bin = curr && (curr.end >= i * bppp + start) ? [curr.val] : [];
        while ((next = self.data.all.get(j + 1)) && next.start < (i + 1) * bppp + start && next.end >= i * bppp + start) { 
          bin.push(next.val); ++j; curr = next; 
        }
        drawSpec.bars.push((binFunction(bin) - self.drawRange[0]) / drawSpec.vScale);
      }
    }
    return _.isFunction(callback) ? callback(drawSpec) : drawSpec;
  },
  
  drawBars: function(ctx, drawSpec, height, width) {
    var zeroLine = drawSpec.zeroLine, // pixel position of the data value 0
      color = "rgb("+this.opts.color+")",
      altColor = "rgb("+(this.opts.altColor || this.altColor)+")",
      pointGraph = this.opts.graphType==='points';
    
    ctx.fillStyle = color;
    _.each(drawSpec.bars, function(d, x) {
      if (d === null) { return; }
      else if (d > zeroLine) { 
        if (pointGraph) { ctx.fillRect(x, height - d, 1, 1); }
        else { ctx.fillRect(x, height - d, 1, zeroLine > 0 ? (d - zeroLine) : d); }
      } else {
        ctx.fillStyle = altColor;
        if (pointGraph) { ctx.fillRect(x, zeroLine - d - 1, 1, 1); } 
        else { ctx.fillRect(x, height - zeroLine, 1, zeroLine - d); }
        ctx.fillStyle = color;
      }
    });
    if (drawSpec.yLine !== null) {
      ctx.fillStyle = "rgb(0,0,0)";
      ctx.fillRect(0, height - drawSpec.yLine, width, 1);
    }
  },

  render: function(canvas, start, end, density, callback) {
    var self = this,
      height = canvas.height,
      width = canvas.width,
      ctx = canvas.getContext && canvas.getContext('2d');
    if (!ctx) { throw "Canvas not supported"; }
    self.prerender(start, end, density, {width: width, height: height}, function(drawSpec) {
      self.type().drawBars.call(self, ctx, drawSpec, height, width);
      if (_.isFunction(callback)) { callback(); }
    });
  },
  
  loadOpts: function($dialog) {
    var o = this.opts,
      $viewLimits = $dialog.find('.view-limits'),
      $maxHeightPixels = $dialog.find('.max-height-pixels'),
      altColorOn = this.validateColor(o.altColor);
    $dialog.find('[name=altColorOn]').attr('checked', altColorOn).change();
    $dialog.find('[name=altColor]').val(altColorOn ? o.altColor :'128,128,128').change();
    $dialog.find('[name=autoScale]').attr('checked', !this.isOn(o.autoScale)).change();
    $viewLimits.slider("option", "min", this.range[0]);
    $viewLimits.slider("option", "max", this.range[1]);
    $dialog.find('[name=viewLimitsMin]').val(this.drawRange[0]).change();
    $dialog.find('[name=viewLimitsMax]').val(this.drawRange[1]).change();
    $dialog.find('[name=yLineOnOff]').attr('checked', this.isOn(o.yLineOnOff)).change();
    $dialog.find('[name=yLineMark]').val(o.yLineMark).change();
    $dialog.find('[name=graphType]').val(o.graphType).change();
    $dialog.find('[name=windowingFunction]').val(o.windowingFunction).change();
    $dialog.find('[name=maxHeightPixelsOn]').attr('checked', o.maxHeightPixels.length >= 3);
    $dialog.find('[name=maxHeightPixelsMin]').val(o.maxHeightPixels[2]).change();
    $dialog.find('[name=maxHeightPixelsMax]').val(o.maxHeightPixels[0]).change();
  },
  
  saveOpts: function($dialog) {
    var o = this.opts,
      altColorOn = $dialog.find('[name=altColorOn]').is(':checked'),
      maxHeightPixelsOn = $dialog.find('[name=maxHeightPixelsOn]').is(':checked'),
      maxHeightPixelsMax = $dialog.find('[name=maxHeightPixelsMax]').val();
    o.altColor = altColorOn ? $dialog.find('[name=altColor]').val() : '';
    o.autoScale = !$dialog.find('[name=autoScale]').is(':checked');
    o.viewLimits = $dialog.find('[name=viewLimitsMin]').val() + ':' + $dialog.find('[name=viewLimitsMax]').val();
    o.yLineOnOff = $dialog.find('[name=yLineOnOff]').is(':checked');
    o.yLineMark = $dialog.find('[name=yLineMark]').val();
    o.graphType = $dialog.find('[name=graphType]').val();
    o.windowingFunction = $dialog.find('[name=windowingFunction]').val();
    o.maxHeightPixels = maxHeightPixelsOn ? 
      [maxHeightPixelsMax, maxHeightPixelsMax, $dialog.find('[name=maxHeightPixelsMin]').val()].join(':') : '';
    this.type('wiggle_0').initOpts.call(this);
  }
  
};

module.exports = WiggleFormat;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./utils/SortedList.js":20,"./utils/utils.js":21}],24:[function(require,module,exports){
/*! jQuery v1.7.1 jquery.com | jquery.org/license | modified to use browserify/npm style module.exports */
module.exports = function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cv(a){if(!ck[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){cl||(cl=c.createElement("iframe"),cl.frameBorder=cl.width=cl.height=0),b.appendChild(cl);if(!cm||!cl.createElement)cm=(cl.contentWindow||cl.contentDocument).document,cm.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),cm.close();d=cm.createElement(a),cm.body.appendChild(d),e=f.css(d,"display"),b.removeChild(cl)}ck[a]=e}return ck[a]}function cu(a,b){var c={};f.each(cq.concat.apply([],cq.slice(0,b)),function(){c[this]=a});return c}function ct(){cr=b}function cs(){setTimeout(ct,0);return cr=f.now()}function cj(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ci(){try{return new a.XMLHttpRequest}catch(b){}}function cc(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function cb(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function ca(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bE.test(a)?d(a,e):ca(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)ca(a+"["+e+"]",b[e],c,d);else d(a,b)}function b_(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function b$(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bT,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=b$(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=b$(a,c,d,e,"*",g));return l}function bZ(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bP),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bC(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bx:by,g=0,h=e.length;if(d>0){if(c!=="border")for(;g<h;g++)c||(d-=parseFloat(f.css(a,"padding"+e[g]))||0),c==="margin"?d+=parseFloat(f.css(a,c+e[g]))||0:d-=parseFloat(f.css(a,"border"+e[g]+"Width"))||0;return d+"px"}d=bz(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0;if(c)for(;g<h;g++)d+=parseFloat(f.css(a,"padding"+e[g]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+e[g]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+e[g]))||0);return d+"px"}function bp(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(f.expando)}}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i)for(d=0,e=i[c].length;d<e;d++)f.event.add(b,c+(i[c][d].namespace?".":"")+i[c][d].namespace,i[c][d],i[c][d].data)}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function T(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function K(){return!0}function J(){return!1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?parseFloat(d):j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else d=b}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H)return H.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)e.access(a,j,c[j],f,g,d);return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++)g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test("")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++)g=b[d],h=f.type(g),h==="array"?m(g):h==="function"&&(!a.unique||!o.has(g))&&c.push(g)},n=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,l=j||0,j=0,k=c.length;for(;c&&l<k;l++)if(c[l].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}i=!1,c&&(a.once?e===!0?o.disable():c=[]:d&&d.length&&(e=d.shift(),o.fireWith(e[0],e[1])))},o={add:function(){if(c){var a=c.length;m(arguments),i?k=c.length:e&&e!==!0&&(j=a,n(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var f=0;f<c.length;f++)if(b[d]===c[f]){i&&f<=k&&(k--,f<=l&&l--),c.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return!c},lock:function(){d=b,(!e||e===!0)&&o.disable();return this},locked:function(){return!d},fireWith:function(b,c){d&&(i?a.once||d.push([b,c]):(!a.once||!e)&&n(b,c));return this},fire:function(){o.fireWith(this,arguments);return this},fired:function(){return!!e}};return o};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({}),j;for(j in g)i[j]=g[j].fire,i[j+"With"]=g[j].fireWith;i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g;g||j.resolveWith(j,b)}else j!==a&&j.resolveWith(j,d?[a]:[]);return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p,q=c.createElement("div"),r=c.documentElement;q.setAttribute("className","t"),q.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=q.getElementsByTagName("*"),e=q.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=q.getElementsByTagName("input")[0],b={leadingWhitespace:q.firstChild.nodeType===3,tbody:!q.getElementsByTagName("tbody").length,htmlSerialize:!!q.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:q.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete q.test}catch(s){b.deleteExpando=!1}!q.addEventListener&&q.attachEvent&&q.fireEvent&&(q.attachEvent("onclick",function(){b.noCloneEvent=!1}),q.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),q.appendChild(i),k=c.createDocumentFragment(),k.appendChild(q.lastChild),b.checkClone=k.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,k.removeChild(i),k.appendChild(q),q.innerHTML="",a.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",q.style.width="2px",q.appendChild(j),b.reliableMarginRight=(parseInt((a.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0);if(q.attachEvent)for(o in{submit:1,change:1,focusin:1})n="on"+o,p=n in q,p||(q.setAttribute(n,"return;"),p=typeof q[n]=="function"),b[o+"Bubbles"]=p;k.removeChild(q),k=g=h=j=q=i=null,f(function(){var a,d,e,g,h,i,j,k,m,n,o,r=c.getElementsByTagName("body")[0];!r||(j=1,k="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",m="visibility:hidden;border:0;",n="style='"+k+"border:5px solid #000;padding:0;'",o="<div "+n+"><div></div></div>"+"<table "+n+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",a=c.createElement("div"),a.style.cssText=m+"width:0;height:0;position:static;top:0;margin-top:"+j+"px",r.insertBefore(a,r.firstChild),q=c.createElement("div"),a.appendChild(q),q.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",l=q.getElementsByTagName("td"),p=l[0].offsetHeight===0,l[0].style.display="",l[1].style.display="none",b.reliableHiddenOffsets=p&&l[0].offsetHeight===0,q.innerHTML="",q.style.width=q.style.paddingLeft="1px",f.boxModel=b.boxModel=q.offsetWidth===2,typeof q.style.zoom!="undefined"&&(q.style.display="inline",q.style.zoom=1,b.inlineBlockNeedsLayout=q.offsetWidth===2,q.style.display="",q.innerHTML="<div style='width:4px;'></div>",b.shrinkWrapBlocks=q.offsetWidth!==2),q.style.cssText=k+m,q.innerHTML=o,d=q.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,i={doesNotAddBorder:e.offsetTop!==5,doesAddBorderForTableAndCells:h.offsetTop===5},e.style.position="fixed",e.style.top="20px",i.fixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",i.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,i.doesNotIncludeMarginInBodyOffset=r.offsetTop!==j,r.removeChild(a),q=a=null,f.extend(b,i))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b)return;n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c);g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c])return g.events;k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k])return;if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++)delete d[b[e]];if(!(c?m:f.isEmptyObject)(d))return}}if(!c){delete j[k].data;if(!m(j[k]))return}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d,e,g,h=null;if(typeof a=="undefined"){if(this.length){h=f.data(this[0]);if(this[0].nodeType===1&&!f._data(this[0],"parsedAttrs")){e=this[0].attributes;for(var i=0,j=e.length;i<j;i++)g=e[i].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),l(this[0],g,h[g]));f._data(this[0],"parsedAttrs",!0)}}return h}if(typeof a=="object")return this.each(function(){f.data(this,a)});d=a.split("."),d[1]=d[1]?"."+d[1]:"";if(c===b){h=this.triggerHandler("getData"+d[1]+"!",[d[0]]),h===b&&this.length&&(h=f.data(this[0],a),h=l(this[0],a,h));return h===b&&d[1]?this.data(d[0]):h}return this.each(function(){var b=f(this),e=[d[0],c];b.triggerHandler("setData"+d[1]+"!",e),f.data(this,a,c),b.triggerHandler("changeData"+d[1]+"!",e)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b)return f.queue(this[0],a);return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0))h++,l.add(m);m();return d.promise()}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,g=this[0];{if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}if(g){c=f.valHooks[g.nodeName.toLowerCase()]||f.valHooks[g.type];if(c&&"get"in c&&(d=c.get(g,"value"))!==b)return d;d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0)return null;c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j)return b;h.push(b)}}if(j&&!h.length&&i.length)return f(i[g]).val();return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn)return f(a)[c](d);if(typeof a.getAttribute=="undefined")return f.prop(a,c,d);i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set"in h&&i&&(g=h.set(a,d,c))!==b)return g;a.setAttribute(c,""+d);return d}if(h&&"get"in h&&i&&(g=h.get(a,c))!==null)return g;g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;h<g;h++)e=d[h],e&&(c=f.propFix[e]||e,f.attr(a,e,""),a.removeAttribute(v?e:c),u.test(e)&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button"))return w.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button"))return w.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set"in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get"in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/\bhover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};
f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1)a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o)f.event.remove(a,j+b[h],c,d,!0);continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++)s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s));r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered))return;h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h])return;c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j)j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1)return;r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode)r.push([m,s]),n=m;n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++)m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault();c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=[],j,k,l,m,n,o,p,q,r,s,t;g[0]=c,c.delegateTarget=this;if(e&&!c.target.disabled&&(!c.button||c.type!=="click")){m=f(this),m.context=this.ownerDocument||this;for(l=c.target;l!=this;l=l.parentNode||this){o={},q=[],m[0]=l;for(j=0;j<e;j++)r=d[j],s=r.selector,o[s]===b&&(o[s]=r.quick?H(l,r.quick):m.is(s)),o[s]&&q.push(r);q.length&&i.push({elem:l,matches:q})}}d.length>e&&i.push({elem:this,matches:d.slice(e)});for(j=0;j<i.length&&!c.isPropagationStopped();j++){p=i[j],c.currentTarget=p.elem;for(k=0;k<p.matches.length&&!c.isImmediatePropagationStopped();k++){r=p.matches[k];if(h||!c.namespace&&!r.namespace||c.namespace_re&&c.namespace_re.test(r.namespace))c.data=r.data,c.handleObj=r,n=((f.event.special[r.origType]||{}).handle||r.handler).apply(p.elem,g),n!==b&&(c.result=n,n===!1&&(c.preventDefault(),c.stopPropagation()))}}return c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando])return a;var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;)e=i[--d],a[e]=g[e];a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event))return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d))a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b;return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form"))return!1;f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0)}),d._submit_attached=!0)})},teardown:function(){if(f.nodeName(this,"form"))return!1;f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))});return!1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=J;else if(!e)return this;g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.type+"."+e.namespace:e.type,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a)this.off(g,c,a[g]);return this}if(c===!1||typeof c=="function")d=c,c=b;d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return e;var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b))if(w.length===2&&o.relative[w[0]])j=y(w[0]+w[1],d,f);else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length)b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length)q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}else k=w=[]}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]")if(!u)e.push.apply(e,k);else if(d&&d.nodeType===1)for(t=0;k[t]!=null;t++)k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t]);else for(t=0;k[t]!=null;t++)k[t]&&k[t].nodeType===1&&e.push(j[t]);else s(k,e);l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=m(b[3],null,null,c);else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],e=b[3];if(c===1&&e===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return s(e.getElementsByTagName(b),f);if(h[2]&&o.find.CLASS&&e.getElementsByClassName)return s(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return s([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return s([],f);if(i.id===h[3])return s([i],f)}try{return s(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p)return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}catch(r){}finally{l||k.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)m[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.POS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++)f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h});g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var V="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))});if(typeof a!="object"&&a!==b)return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function()
{for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,bp)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||!bc.test("<"+a.nodeName)?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g)e[g]&&bk(d[g],e[g])}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g)bj(d[g],e[g])}}d=e=null;return h},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k)continue;if(typeof k=="string")if(!_.test(k))k=b.createTextNode(k);else{k=k.replace(Y,"<$1></$2>");var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=bg[l]||bg._default,n=m[0],o=b.createElement("div");b===c?bh.appendChild(o):U(b).appendChild(o),o.innerHTML=m[1]+k+m[2];while(n--)o=o.lastChild;if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i)f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes}var r;if(!f.support.appendChecked)if(k[0]&&typeof (r=k.length)=="number")for(i=0;i<r;i++)bn(k[i]);else bn(k);k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return!a.type||be.test(a.type)};for(j=0;h[j];j++)if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript"))e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()])continue;c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events)e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle);b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bq=/alpha\([^)]*\)/i,br=/opacity=([^)]*)/,bs=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,bu=/^-?\d/,bv=/^([\-+])=([\-+.\de]+)/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Left","Right"],by=["Top","Bottom"],bz,bA,bB;f.fn.css=function(a,c){if(arguments.length===2&&c===b)return this;return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bz(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=bv.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(bz)return bz(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0)return bC(a,b,d);f.swap(a,bw,function(){e=bC(a,b,d)});return e}},set:function(a,b){if(!bt.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return br.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bq,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bq.test(g)?g.replace(bq,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bz(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bA=function(a,b){var c,d,e;b=b.replace(bs,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b)));return c}),c.documentElement.currentStyle&&(bB=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f===null&&g&&(e=g[b])&&(f=e),!bt.test(f)&&bu.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),bz=bA||bB,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)});var bD=/%20/g,bE=/\[\]$/,bF=/\r?\n/g,bG=/#.*$/,bH=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bI=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bJ=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bK=/^(?:GET|HEAD)$/,bL=/^\/\//,bM=/\?/,bN=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bO=/^(?:select|textarea)/i,bP=/\s+/,bQ=/([?&])_=[^&]*/,bR=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bS=f.fn.load,bT={},bU={},bV,bW,bX=["*/"]+["*"];try{bV=e.href}catch(bY){bV=c.createElement("a"),bV.href="",bV=bV.href}bW=bR.exec(bV.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bS)return bS.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bN,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bO.test(this.nodeName)||bI.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bF,"\r\n")}}):{name:b.name,value:c.replace(bF,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b_(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b_(a,b);return a},ajaxSettings:{url:bV,isLocal:bJ.test(bW[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bX},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bZ(bT),ajaxTransport:bZ(bU),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?cb(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=cc(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bH.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bG,"").replace(bL,bW[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bP),d.crossDomain==null&&(r=bR.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bW[1]&&r[2]==bW[2]&&(r[3]||(r[1]==="http:"?80:443))==(bW[3]||(bW[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),b$(bT,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bK.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bM.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bQ,"$1_="+x);d.url=y+(y===d.url?(bM.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bX+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=b$(bU,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2)w(-1,z);else throw z}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)ca(g,a[g],c,e);return d.join("&").replace(bD,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cd=f.now(),ce=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cd++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ce.test(b.url)||e&&ce.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ce,l),b.url===j&&(e&&(k=k.replace(ce,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cf=a.ActiveXObject?function(){for(var a in ch)ch[a](0,1)}:!1,cg=0,ch;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ci()||cj()}:ci,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cf&&delete ch[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cg,cf&&(ch||(ch={},f(a).unload(cf)),ch[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var ck={},cl,cm,cn=/^(?:toggle|show|hide)$/,co=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cp,cq=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cr;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(cu("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cv(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(cu("hide",3),a,b,c);var d,e,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cu("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cv(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new f.fx(this,b,i),h=a[i],cn.test(h)?(o=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),o?(f._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=co.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(f.cssNumber[i]?"":"px"),n!=="px"&&(f.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,f.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""));return!0}var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null)for(b in g)g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b);else g[b=a+".run"]&&g[b].stop&&h(this,g,b);for(b=e.length;b--;)e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1));(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:cu("show",1),slideUp:cu("hide",1),slideToggle:cu("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cr||cs(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){e.options.hide&&f._data(e.elem,"fxshow"+e.prop)===b&&f._data(e.elem,"fxshow"+e.prop,e.start)},h()&&f.timers.push(h)&&!cp&&(cp=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cr||cs(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(g=!1);if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cp),cp=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(["width","height"],function(a,b){f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=e.body,i=cy(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.support.fixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;f.support.fixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e)return null;g=cy(e);return g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cy(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,d,"padding")):this[d]():null},f.fn["outer"+c]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,d,a?"margin":"border")):this[d]():null},f.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(f.isFunction(a))return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))});if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var i=f.css(e,d),j=parseFloat(i);return f.isNumeric(j)?j:i}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})};
},{}],25:[function(require,module,exports){
module.exports = (function($){

  require('./jquery.misc-plugins.js')($);
  require('./jquery.tiptip.js')($);  
  require('./jquery.farbtastic.js')($);
  
  var _ = require('../underscore.min.js');
  // Sum elements of an array
  _.sum = function(arr) { return _.reduce(arr, function(memo, next) { return memo + next; }, 0); }

  var utils = require('./utils.js')($),
    classFriendly = utils.classFriendly,
    fps = utils.fps,
    basename = utils.basename,
    floorHack = utils.floorHack,
    decodeSafeOctets = utils.decodeSafeOctets,
    regExpQuote = utils.regExpQuote;

  /****************************************************************************************/
  //
  // We have three widgets that are built on the jQuery UI $.widget framework
  //    1) $.ui.genobrowser
  //    2) $.ui.genoline
  //    3) $.ui.genotrack
  //
  /****************************************************************************************/

  require('./jquery-ui.genoline.js')($);
  require('./jquery-ui.genotrack.js')($);

  // =======================================================================================
  // = $.ui.genobrowser is the central widget that coordinates the front-end of chromozoom =
  // =======================================================================================

  $.widget('ui.genobrowser', {

    // Default options that are overridden by the genome JSON configuration when this widget is instantiated
    options: {
      disabled: false,
      betweenLines: 20,
      tileWidth: 1000,
      genome: 'hg18',
      genomeSize: 3080419480,
      sideBarWidth: 100,
      tracks: [
        {n:'ruler', h:50, s:['dense']}
      ],
      chrOrder: [],
      chrLengths: {},
      chrBands: [],
      availTracks: [],
      tileDir: 'o/',
      ajaxDir: 'php/',
      bppps: [2.9e5],
      overzoomBppps: [],
      initZoom: 2.9e5,
      ideogramsAbove: 3.3e4,
      bpppNumbersBelow: [3.3e4, 3.3e3],
      ntsBelow: [1, 0.1],
      navBar: '#navbar',
      footerBar: '#footerbar',
      zoomSlider: '#zoom',
      zoomBtns: ['#zoom-in', '#zoom-out'],
      trackPicker: ['#tracks', '#track-picker', '#custom-tracks', '#custom-picker'],
      jump: ['#loc', '#jump', '#loc-picker'],
      genomePicker: ['#genome', '#genome-picker'],
      lineMode: '#line-mode',
      linking: ['#linking', '#link-picker'],
      overlay: ['#overlay', '#overlay-message'],
      lineFixDuration: 500,
      reticOpacity: 0.8,
      verticalDragDeadZone: 12,
      maxNtRequest: 20000,
      bounceMargin: 0.2,
      dialogs: ['#custom-dialog', '#quickstart', '#about', '#old-msie', '#chrom-sizes-dialog', '#custom-genome-dialog', '#binaries-warning-dialog'],
      ucscURL: 'http://genome.ucsc.edu/cgi-bin/hgTracks',
      trackDescURL: 'http://genome.ucsc.edu/cgi-bin/hgTrackUi',
      bpppFormat: function(bppp) { return bppp.toExponential(2).replace(/(\+|-)(\d)$/, '$10$2'); },
      useCanvasTicks: true,
      savableParams: {session: ['position', 'tracks'], persistent: ['mode']}
      //,snapZoom: true
      //,snapZoomAfter: 200
    },

    // ====================================================================
    // = The following _init functions handle instantiation-related tasks =
    // ====================================================================

    // Called automatically when widget is instantiated
    _init: function() {
      var self = this,
        $elem = self.element, 
        o = self.options;
      
      // Setup internal variables
      self._initInstanceVars();
      
      // Initialize some of the navbar widgets
      self.$slider = self._initSlider();
      self.$trackPicker = self._initTrackPicker();
      self.$customTracks = self._initCustomTracks();
      self.$links = self._initLinking();
      
      // Debounce some of the handler functions; this prevents it from firing more than once per X milliseconds
      // This cuts down on the load of some of the more expensive actions
      self._finishZoomDebounced = _.debounce(self._finishZoomDebounced, o.snapZoomAfter || 500);
      self._updateReticleDebounced = _.debounce(self._updateReticle, o.snapZoomAfter || 500);
      self._normalizePosDebounced = _.debounce(self.normalizePos, 200);
      self._fixZoomedTrackDebounced = _.debounce(self._fixZoomedTrackDebounced, 500);
      self._fixClickAreasDebounced = _.debounce(self._fixClickAreasDebounced, 500);
      self._saveParamsDebounced = _.debounce(self._saveParamsDebounced, 500);
      
      // Bind event handlers for the window and main widgets
      $(window).resize(function(e, callback) { 
        if (this == e.target) {
          self._width = $elem.width();
          self._fixNumLines(null, {duration: 0, complete: callback});
          $(o.navBar).toggleClass('narrow', self._width < 950).find('.picker').trigger('remaxheight');
        }
      });
      $(document.body).bind('DOMMouseScroll mousewheel', _.bind(self._recvZoom, self));
      $(o.zoomBtns[0]).click(function() { delete self.centeredOn; self._animateZoom(true, 1000); });
      $(o.zoomBtns[1]).click(function() { delete self.centeredOn; self._animateZoom(false, 1000); });
      $elem.mouseenter(function() { self.showReticle('mouseArea', false); });
      $elem.mouseleave(function() { self.showReticle('mouseArea', true); });
      $(o.lineMode).buttonset().click(function() { self._fixNumLines(self.centralLine); });
      $(o.lineMode).find('input,a').focus(function() { var $t = $(this); _.defer(function() { $t.blur(); }); });
      $elem.bind('trackload', _.bind(self._recvTrackLoad, self));
      $(window).bind('popstate', function() { self._initFromParams(null, true); });
      
      // Initialize the footer, the search bar, hotkeys, the AJAX proxy, mobile interactions, IE fixes
      // Finally, apply params from either the URL or the session state
      self._initFooter();
      self._initJump();
      self._initHotkeys();
      self._initAjax();
      self._initMobileFeatures();
      if ($.browser.msie) { self._initIEFixes(); }
      $(window).trigger('resize', function() { self._initFromParams(null, true); });
    },
    
    // Called when a new options object is passed in, typically after a custom genome is loaded
    _setOptions: function(options) {
      var self = this,
        $elem = self.element,
        o = self.options,
        tracksToParse,
        finishSetupAfterParsing,
        $overlay = $(o.overlay[0]),
        $overlayMessage = $(o.overlay[1]),
        nextDirectives = _.extend({}, self._nextDirectives);
      self._resetCustomTracks();
      self._removeLines(self.$lines.length, {duration: 0});

      o = _.extend(self.options, options);
      
      self._initInstanceVars();
      
      tracksToParse = _.filter(o.availTracks, function(t) { return t.customData; });
      // a subset of options that CustomTracks needs to parse tracks
      function browserOpts() {
        var pos = nextDirectives.position && self.normalizePos(nextDirectives.position, true);
        pos = pos ? pos.pos : self.pos;
        return {
          bppps: o.bppps,
          chrPos: self.chrPos,
          pos: pos,
          chrLengths: o.chrLengths,
          genomeSize: o.genomeSize,
          ajaxDir: o.ajaxDir
        };
      }
      
      function finishSetup() {
        _.each(o.tracks, function(t){ 
          $.extend(t, self.availTracks[t.n]);
        });
        
        self.$slider = self._initSlider();
        self.$trackPicker = self._initTrackPicker();
        self._updateGenomes();
      
        $overlay.add($overlayMessage).hide();
        $(window).trigger('resize', function() { 
          self._nextDirectives = {};
          if (_.keys(nextDirectives).length) { self._initFromParams(nextDirectives); }
        });
      }
      
      if (tracksToParse.length > 0) {
        finishSetupAfterParsing = _.after(tracksToParse.length, finishSetup);
        _.each(tracksToParse, function(t) {
          CustomTracks.parseAsync(t.customData, browserOpts(), function(customTracks) {
            var customTrack = customTracks[0]; // t.customData should only contain data for one track
            _.each(o.bppps, function(bppp) { 
              self.availTracks[t.n].fh[o.bpppFormat(bppp)] = {dense: customTrack.heights.min}; 
            });
            self.availTracks[t.n].custom = t.custom = customTrack;
            finishSetupAfterParsing();
          });
        });
      } else { finishSetup(); }
    },
    
    _initInstanceVars: function() {
      var self = this,
        $elem = self.element,
        o = self.options,
        p = 0;
        
      // Setup internal variables related to chromosome bands, lengths, and available tracks
      self.chrPos = {};
      o.chrLabels = [];
      _.each(o.chrOrder, function(v, i){ 
        o.chrLabels.push({p: p, n: v, w: o.chrLengths[v]}); self.chrPos[v] = p; p += o.chrLengths[v];
      });
      o.chrLabels.push({p: p, n: '', end: true}); // one more label for the end of the last chromosome
      _.each(o.chrBands, function(v){ v[5] = v[1]; v[1] += self.chrPos[v[0]]; v[2] += self.chrPos[v[0]]; });
      o.chrBands = o.chrBands && _.sortBy(o.chrBands, function(v) { return _.indexOf(o.chrOrder, v[0]) * o.genomeSize + v[1]; });
      self.availTracks = {};
      self.defaultTracks = [];
      _.each(o.availTracks, function(v) { self.availTracks[v.n] = $.extend({}, v, {oh: v.h}); });
      _.each(o.tracks, function(t){ 
        $.extend(t, self.availTracks[t.n]);
        self.defaultTracks.push({n: t.n, h: t.h});
      });
      
      // Setup remaining internal variables
      self.$lines = $elem.children('.browser-line');
      self.pos = 1; // this is the bp position of the left side of the top line
      self.bppp = o.initZoom;
      self._densityOrder = {};
      self._densityOrderFor = {};
      self._areaIndex = {};
      self._areaHover = null;
      self._tileFixingEnabled = true;
      self._showReticle = {mouseArea: false, dragging: false, hotKeys: false};
      self._defaultLineMode = $(o.lineMode).find(':checked').val();
      self._dna = {};
    },
    
    _initSlider: function() {
      var self = this,
        o = this.options;
      if (!o.overzoomBppps) { o.overzoomBppps = []; }
      
      var $slider = $(o.zoomSlider),
        numBppps = o.bppps.length + o.overzoomBppps.length,
        sliderWidth = (numBppps - 1) * 10,
        sliderBppps = (self.sliderBppps = o.bppps.concat(o.overzoomBppps)),
        prevVals = [],
        $ticks;
      
      function start(e, ui) { delete self.centeredOn; };
      function slide(e, ui) {
        var idx = floorHack(ui.value),
          frac = ui.value - idx,
          zoom, k;
        // Using the arrow keys with the slider focused should animate between optimal levels
        if (e.originalEvent && e.originalEvent.type=="keydown" && (k = e.originalEvent.keyCode)) {
          if (k >= 37 && k <= 40) { self._animateZoom(k == 38 || k == 39, 1000); return; }
        }
        prevVals = prevVals.concat([ui.value]).slice(-2);
        if (frac === 0.0) { self._zoom(sliderBppps[idx]); }
        else { self._zoom((sliderBppps[idx + 1] - sliderBppps[idx]) * frac + sliderBppps[idx]); }
      };
      function stop(e, ui) {
        if (e.originalEvent && e.originalEvent.type=="keyup") { return; }
        var direction = prevVals[0] < ui.value;
        o.snapZoomAfter && _.defer(function() { self._animateZoom(direction); });
      };
      
      $slider.parent().children('.ticks').remove();
      $ticks = $('<div class="ticks"/>').appendTo($slider.parent());
      $ticks.html(new Array(numBppps + 1).join('<div class="tick"/>'));
      
      if ($slider.hasClass('ui-slider')) { $slider.slider('destroy'); }
      $slider.parent().width(sliderWidth);
      return $slider.width(sliderWidth).slider({
        min: 0,
        max: numBppps - 1,
        step: 0.02,
        value: _.indexOf(sliderBppps, o.initZoom),
        slide: slide,
        change: slide,
        start: start,
        stop: stop
      });
    },
    
    // Utility function to a bind a button to toggling visibility of a slide-out menu, called a "picker"
    // Safe to call multiple times.
    _createPicker: function($btn, $picker, $done) {
      var self = this,
        $elem = $(self.element),
        closePicker = function() { $picker.slideUp(100); };
      $picker.unbind('remaxheight.genobrowser').bind('remaxheight.genobrowser', function() {
        var $ul = $(this).children('ul'),
          visible = $(this).is(':visible'),
          formLineHeights;
        if (!visible) { $(this).show(); } // can't make measurements while hidden
        formLineHeights = _.map($ul.nextAll(), function(el) { 
          return Math.max($(el).outerHeight(), $(el).find('textarea').outerHeight()); 
        });
        $ul.css('max-height', $elem.outerHeight() - _.sum(formLineHeights));
        if (!visible) { $(this).hide(); }
      });
      $btn.unbind('click.genobrowser').bind('click.genobrowser', function() {
        if (!$picker.is(':visible')) {
          $('body').bind('mousedown.picker', function(e) { 
            if ($(e.target).closest($picker.add($btn)).length) { return; }
            closePicker();
            $('body').unbind('mousedown.picker');
          });
          if ($btn.is('a.ui-button')) { $btn.addClass('ui-state-active'); }
          $picker.trigger('remaxheight');
        }
        $picker.slideToggle(100);
      });
      if ($done) { $done.unbind('click.genobrowser').bind('click.genobrowser', closePicker); }
      return $picker.unbind('close.genobrowser').bind('close.genobrowser', closePicker);
    },
    
    _initFooter: function() {
      var self = this,
        $elem = self.element,
        o = self.options,
        $foot = $(o.footerBar),
        $genome = $(o.genomePicker[0]),
        $genomePicker = $(o.genomePicker[1]),
        $ul = $('<ul/>').appendTo($genomePicker),
        $title = $genome.find('.title'),
        $toggleBtn = $genome.children('input').eq(0),
        speciesParenthetical = o.species.match(/\((.+)\)/),
        $binaryWarningDialog = $(o.dialogs[6]),
        $a;
      
      $ul.append('<li class="divider"/>')
      $a = $('<a class="clickable"/>').attr('href', o.dialogs[4]).appendTo($('<li class="choice"/>').appendTo($ul));
      $('<span class="name"/>').text('More genomes\u2026').appendTo($a);
      $('<span class="long-desc"/>').text('Fetch or specify chrom sizes').appendTo($a);
      $ul.append('<li class="divider"/>')
      $a = $('<a class="clickable"/>').attr('href', o.dialogs[5]).appendTo($('<li class="choice"/>').appendTo($ul));
      $('<span class="name"/>').text('Load from file or URL\u2026').appendTo($a);
      $('<span class="long-desc"/>').text('in GenBank, FASTA, or EMBL format').appendTo($a);
      
      $genome.find('.clickable').hover(function() { $(this).addClass('hover'); }, function() { $(this).removeClass('hover'); });
      self._updateGenomes();

      self._createPicker($toggleBtn, $genomePicker);
      
      // Setup the dialogs that appear upon clicking footerbar links
      _.each(o.dialogs, function(id) {
        var $dialog = $(id).closest('.ui-dialog');
        function openDialog() { 
          $('.ui-dialog').hide();
          $dialog.addClass('visible').show();
          $dialog.find('a[href^="http://"],a[href^="https://"]').attr('target', '_blank');
          $dialog.css('top', Math.max(($elem.parent().innerHeight() - $dialog.outerHeight()) * 0.5, 30));
        };
        $dialog.bind('open.genobrowser', openDialog);
        $foot.find('a[href='+id+']').click(function() { $dialog.trigger('open.genobrowser'); });
        $dialog.find('.ui-dialog-buttonpane button').button().not('.dont-close').click(function() {
          $dialog.fadeOut();
        });
      });
      
      self._initCustomGenomeDialogs();
      
      // Show the quickstart screen if the user has never been here before and the viewport is big enough to show it
      if ($.cookie('db')===null && $(window).width() > 600 && $(window).height() > 420) { 
        $foot.find('a[href="'+o.dialogs[1]+'"]').click();
      }
      // Show the uninstalled binaries warning, if it was written into the page
      if ($binaryWarningDialog.length) { $binaryWarningDialog.trigger('open.genobrowser'); }
    },
        
    _initTrackPicker: function() {
      var self = this,
        o = self.options,
        d = o.trackDesc,
        $toggleBtn = $(o.trackPicker[0]),
        $trackPicker = $(o.trackPicker[1]).empty(),
        $ul = $('<ul/>').appendTo($trackPicker),
        $div = $('<div class="button-line"/>').appendTo($trackPicker),
        $reset = $('<input type="button" name="reset" value="reset"/>').appendTo($div),
        $b = $('<input type="button" name="done" value="done"/>').appendTo($div);
      _.each(self.availTracks, function(t, n) {
        // TODO: This needs to distinguish between traditional image tracks and custom tracks brought in
        //       by custom genomes. The latter should have an options dialog and download links instead of "more info".
        var $l = $('<label class="clickable"/>').appendTo($('<li class="choice"/>').appendTo($ul)),
          $c = $('<input type="checkbox"/>').attr('name', n).prependTo($l),
          $d = $('<div class="desc"></div>').appendTo($l),
          href = o.trackDescURL + '?db=' + o.genome + '&g=' + n + '#TRACK_HTML',
          $a = d[n].lg ? $('<a class="more" target="_blank">more info&hellip;</a>').attr('href', href) : '';
        $('<h3/>').addClass('name').text(d[n].sm).append($a).appendTo($d);
        if (d[n].lg) { $('<p/>').addClass('long-desc').text(d[n].lg).appendTo($d); }
        if (_.find(o.tracks, function(trk) { return trk.n==n; })) { $c.attr('checked', true); }
        $l.bind('click', function(e) { if ($(e.target).is('a')) { e.stopPropagation(); }});
        $l.attr('title', n);
        $l.hover(function() { $(this).addClass('hover'); }, function() { $(this).removeClass('hover'); });
        $c.bind('change', _.bind(self._fixTracks, self));
      });
      if (o.tracks.length === 1) { $ul.find('input[name='+o.tracks[0].n+']').attr('disabled', true); }
      $reset.click(function(e) { self._resetToDefaultTracks(); });
      return self._createPicker($toggleBtn, $trackPicker, $b).hide();
    },
    
    _initCustomTracks: function() {
      var self = this,
        $elem = self.element,
        o = self.options,
        fileInputHTML = '<input type="file" name="customFile"/>',
        urlInputHTML = '<input type="url" name="customUrl" class="url"/><input type="button" name="customUrlGet" value="go!"/>',
        $toggleBtn = $(o.trackPicker[2]),
        $picker = $(o.trackPicker[3]).hide(),
        $ul = $('<ul/>').prependTo($picker),
        $add = $picker.find('.form-line').first(),
        $overlay = $(o.overlay[0]),
        $overlayMessage = $(o.overlay[1]),
        $urlInput, $urlGet, $div, $b, $reset;
      
      function browserOpts() {
        var nextDirectives = _.extend({}, self._nextDirectives),
          pos = nextDirectives.position && self.normalizePos(nextDirectives.position, true);
        pos = pos ? pos.pos : self.pos;
        return {
          bppps: o.bppps,
          chrPos: self.chrPos,
          pos: pos,
          chrLengths: o.chrLengths,
          genomeSize: o.genomeSize,
          ajaxDir: o.ajaxDir
        };
      }
      
      self._customTrackUrls = {
        requested: [],
        processing: [],
        loaded: []
      };
      
      function customTrackError(e) {
        $picker.find('.spinner').hide();
        var msg = e.message.replace(/^Uncaught Error: /, '');
        alert('Sorry, an error occurred while adding this custom track file:\n\n' + msg);
        // TODO: replace this with something more friendly.
        replaceFileInput(); 
      }
      
      function closePicker() { $picker.slideUp(100); }
      
      function handleFileSelect(e) {
        var reader = new FileReader(),
          $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner').show();
        if (e.target.files.length) {
          reader.onload = (function(f) {
            return function(ev) {
              CustomTracks.parseAsync(ev.target.result, browserOpts(), function(tracks) {
                $spinner.hide();
                self._addCustomTracks(f.name, tracks);
              });
            };
          })(e.target.files[0]);
          reader.readAsText(e.target.files[0]);
        }
        replaceFileInput();
      }
      if (window.File && window.FileReader && window.FileList) {
        $add.find('label').html(fileInputHTML);
        $add.find('[name=customFile]').change(handleFileSelect);
        $add = $add.nextAll('.form-line').first();
      } else {
        $add.remove();
        $picker.find('.help-line').first().remove();
        $add = $picker.find('.form-line').first();
      }
      
      function replaceFileInput() {
        _.defer(function() {
          $picker.find('[name=customFile]').replaceWith(fileInputHTML);
          $picker.find('[name=customFile]').change(handleFileSelect);
        });
      }
      
      function handlePastedData(e) {
        var $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner').show();
        CustomTracks.parseAsync($add.find('textarea').val(), browserOpts(), function(tracks) {
          $spinner.hide();
          self._addCustomTracks(_.uniqueId('pasted_data_'), tracks);
          $add.find('textarea').val('');
        });
      }
      function pasteAreaFocus(e) {
        var $this = $(this), height = $this.height();
        if (!$this.data('origHeight')) { $this.data('origHeight', $this.height()); }
        $this.animate({height: 120}, 200, 'easeInOutQuart');
      }
      function pasteAreaBlur(e) { $(this).animate({height: $(this).data('origHeight')}, 200, 'easeInOutQuart'); }
      $add.find('[name=customPasteAdd]').click(handlePastedData);
      $add.find('textarea').focus(pasteAreaFocus).blur(pasteAreaBlur);
      $add = $add.nextAll('.form-line').first();
      
      function handleUrlSelect(e) {
        var $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner'),
          $url = $add.find('[name=customUrl]'),
          url = $.trim($url.val());
        if (!url.length) { return; }
        $spinner.show();
        self._customTrackUrls.requested = _.without(self._customTrackUrls.requested, url);
        self._customTrackUrls.processing = _.union(self._customTrackUrls.processing, [url]);
        $.ajax(url, {
          success: function(data) {
            CustomTracks.parseAsync(data, browserOpts(), function(tracks) {
              $spinner.hide();
              $url.val('');
              self._customTrackUrls.loaded = _.union(self._customTrackUrls.loaded, [url]);
              self._addCustomTracks(basename(url), tracks, url);
              $overlay.add($overlayMessage).fadeOut();
            });
          },
          progress: function(loaded, total) {
            var $progress = $overlayMessage.find('.ui-progressbar');
            if (!$progress.length) { $progress = $('<div/>').appendTo($overlayMessage).progressbar(); }
            $progress.progressbar('value', loaded/total * 100);
          },
          error: function() {
            $overlay.hide();
            $overlayMessage.hide();
            customTrackError({message: "No valid custom track data was found at this URL."}); 
          }
        });
      }
      $add.find('label').html(urlInputHTML);
      $add.find('[name=customUrlGet]').click(handleUrlSelect);
      $add.find('[name=customUrl]').bind('keydown', function(e) { if (e.which==13) { handleUrlSelect(e); } });
      
      // Redefine the CustomTracks error handler so the user can see parse errors for their custom track(s).
      CustomTracks.error = customTrackError;
      
      $div = $('<div class="button-line"/>').appendTo($picker);
      $reset = $('<input type="button" name="reset" value="reset"/>').appendTo($div);
      $b = $('<input type="button" name="done" value="done"/>').appendTo($div);
      $reset.click(function(e) { self._resetCustomTracks(); });

      return self._createPicker($toggleBtn, $picker, $b);
    },
    
    _initLinking: function() {
      var self = this,
        o = self.options,
        $linkBtn = $(o.linking[0]),
        $linkPicker = $(o.linking[1]),
        $url = $linkPicker.find('.url');
      $linkBtn.button().click(function(e) { _.defer(function () { $url.select().focus(); }); return false; });
      self._createPicker($linkBtn, $linkPicker);
    },
    
    _initJump: function() {
      var self = this,
        o = self.options,
        $loc =  $(o.jump[0]),
        $jump = $(o.jump[1]);
      self.$choices = $(o.jump[2]).hide();
      function jumpToSubmit() {
        var $suggest = self.$choices.find('.focus');
        if ($suggest.length) { $suggest.click(); }
        else { self.jumpTo($loc.val()); }
      }
      $jump.click(jumpToSubmit);
      $loc.keydown(function(e) {
        if (e.which == 13) { jumpToSubmit(); }
        else if (e.which == 40) { 
          self.$choices.find('.focus').nextAll('.choice').eq(0).trigger('fakefocus');
          return false;
        } else if (e.which == 38) { 
          self.$choices.find('.focus').prevAll('.choice').eq(0).trigger('fakefocus');
          return false;
        } else {
          self._normalizePosDebounced();
        }
      });
      $loc.keyup(function(e) { _.defer(function() { ($loc.val()==='') && self._searchFor(''); }); });
    },
    
    _initHotkeys: function() {
      var self = this,
        o = this.options,
        $elem = self.element,
        motionOpts = {dir: 0},
        l = 500,
        shiftEverything = 'shift+down shift+s shift+up shift+w shift+left shift+a shift+right shift+d',
        motionInterval;
      self._keyedOffset = 0;
      // quadratic motion with an upper bound on the velocity after l milliseconds
      function x(t) { return (t > l ? 2 * l * t - l * l : t * t) / 1500; }
      function motion() {
        var now = (new Date).getTime(),
          deltaY = motionOpts.dir * x(now - motionOpts.start) - motionOpts.prev;
        self._keyedOffset -= deltaY;
        self._pos(self.pos - deltaY * self.bppp); 
        motionOpts.prev += deltaY;
      };
      $(document).bind('keydown', 'up down left right w s a d '+shiftEverything, function() { 
        self.showReticle('hotKeys', true);
        $.tipTip.hide();
        $elem.one('mousemove', function() { self.showReticle('hotKeys', false); });
      });
      $(document).bind('keydown', 'down s up w', function(e) {
        var dir = e.which == 40 || e.which == 83 ? 1 : -1; // down=>40, s=>83
        if ($(o.lineMode).find('input:checked').val() == 'single') {
          delete self.centeredOn;
          self._animateZoom(dir == -1, 1000); return false;
        } else {
          self._keyedOffset += dir * self.lineWidth();
          self._pos(self.pos + dir * self.bpWidth());
          self.bounceCheck();
        }
      });
      $(document).bind('keydown', 'left a right d', function(e) {
        var dir = e.which == 37 || e.which == 65 ? 1 : -1, // left=>37, a=>65
          now = (new Date).getTime();
        if (motionOpts.dir == dir) { return; }
        clearInterval(motionInterval);
        motionOpts = {dir: dir, start: now, prev: 0};
        motionInterval = setInterval(motion, 13); // based off of jQuery's .animate interval
      });
      $(document).bind('keyup', 'left a right d', function(e) {
        var dir = e.which == 37 || e.which == 65 ? 1 : -1;
        if (motionOpts.dir == dir) { clearInterval(motionInterval); self.bounceCheck(); motionOpts.dir = 0; }
      });
      $(document).bind('keydown', shiftEverything, function(e) {
        delete self.centeredOn;
        self._animateZoom(_.include([38, 87, 39, 68], e.which), 1000); // up=>38, w=>87, right=>39, d=>68
      });
      $(document).bind('keydown', 'esc', function(e) {
        var $pickers = $(o.trackPicker[1] + ',' + o.trackPicker[3]);
        $pickers.each(function() { if ($(this).is(':visible')) $(this).find('input[name=done]').click(); });
      });
    },
    
    _initAjax: function() {
      var options = this.options;
      // proxy external URLs through our local AJAX proxy
      $.ajax = (function(_ajax){
        var protocol = location.protocol,
          hostname = location.hostname,
          exRegex = RegExp(protocol + '//' + hostname),
          proxyURL = options.ajaxDir + 'proxy.php';

        function isExternal(url) {
          return !exRegex.test(url) && (/:\/\//).test(url);
        }

        return function(url, o) {
          if ( typeof url === "object" ) {
            o = url;
            url = o.url;
          } else { o.url = url; }
          
          // capture and forward progress events from XHR's to o.progress callback
          o.xhr = (function(_xhr){
            return function() {
              var xhr = _.isFunction(_xhr) ? _xhr() : new window.XMLHttpRequest();
              xhr.addEventListener("progress", function(e) {
                var total = e.lengthComputable ? e.total : xhr.getResponseHeader('X-Content-Length');
                if (total && _.isFunction(o.progress)) {
                  o.progress.call(this, e.loaded, total);
                }
              }, false);
              return xhr;
            };
          })(o.xhr);

          if ( (/get/i.test(o.type) || !o.type) && !/json/i.test(o.dataType) && isExternal(url) ) {
            // Manipulate options so that AJAX request gets sent to our proxy
            o.url = proxyURL;
            o.dataType = 'text';
            o.data = {
              url: url + (o.data ? (/\?/.test(url) ? '&' : '?') + jQuery.param(o.data) : '')
            };

            // Since it's a JSONP request
            // complete === success
            if (!o.success && o.complete) {
              o.success = o.complete;
              delete o.complete;
            }
            o.success = (function(_success){
              return function(data) {
                if (_success) {
                  // Fake XHR callback.
                  _success.call(this, data, 'success');
                }
              };
            })(o.success);
          }
          return _ajax.call(this, o);
        };
      })($.ajax);
    },
    
    _initMobileFeatures: function() {
      var self = this,
        o = self.options,
        $elems = self.element.add(o.navBar).add(o.footerBar);
      
      $(window).bind('orientationchange', function() { $(window).resize(); });
      
      if (!$.support.touch) { return; }
      $elems.addClass('mobile');
      
      var cachedPageXs = {}, prevPinchWidth = null, touchTarget, center, pinchWidth;
      function getPageX(e, identifier) {
        var pageX, changed = _.find(e.changedTouches, function(t) { return t.identifier == identifier; });
        if (changed) { pageX = changed.pageX; }
        else {
          if (!_.isUndefined(cachedPageXs[identifier])) { pageX = cachedPageXs[identifier]; }
          else { pageX = _.find(e.touches, function(t) { return t.identifier == identifier; }).pageX; }
        }
        cachedPageXs[identifier] = pageX;
        return pageX;
      }
      $(document).bind('touchstart', function(e) {
        var dragContTouch = _.find(e.originalEvent.touches, function(t) { return $(t.target).closest('.drag-cont').length > 0; });
        if (dragContTouch) { touchTarget = $(dragContTouch.target).closest('.drag-cont'); }
      });
      $(document).bind('touchmove', function(e) {
        var oe = e.originalEvent;
        // If nothing started within a draggable track area, we don't care about this event
        if (!touchTarget) { return; }
        // We're only handling pinch events here
        if (oe.touches.length != 2) { return; }
        if (center === null) {
          center = (oe.touches[0].pageX + oe.touches[1].pageX) * 0.5;
        }
        pinchWidth = Math.abs(getPageX(oe, oe.touches[0].identifier) - getPageX(oe, oe.touches[1].identifier));
        if (prevPinchWidth) {
          var delta = (pinchWidth / prevPinchWidth - 1) * 50, 
            // TODO: delta could probably be tweaked to proviude perfect positional zooming
            fakeEvent = {target: touchTarget, originalEvent: {srcElement: touchTarget, pageX: center}};
          // Simulate the equivalent mousewheel event
          self._recvZoom(fakeEvent, delta);
        }
        prevPinchWidth = pinchWidth;
      });
      $(document).bind('touchend', function(e) { cachedPageXs = {}; prevPinchWidth = touchTarget = center = null; });

      $(o.lineMode).find('input[value=single]').attr('checked', true);
    },
    
    _initIEFixes: function() {
      var self = this,
        o = self.options,
        $elems = self.element.add(o.navBar);
      $elems.addClass('msie');
      $(o.zoomSlider).parent().find('.tick').last().addClass('last');
      $(o.trackPicker[3]).find('textarea.paste').css('white-space', 'pre-wrap').attr('wrap', 'off');
      
      if (parseFloat($.browser.version) >= 9.0) { return; }
      // Stuff for old MSIE's (< MSIE 9)
      // Show the warning dialog
      $(o.footerBar).find('a[href="#old-msie"]').click();
      // Disable multiline mode
      $(o.lineMode).find('input[value=single]').attr('checked', true);
      // Old IE's have issues with creating new tabs when clicking features
      self.element.click(function(e) {
        var $a = $(e.target);
        if (e.target.nodeName.toLowerCase() == 'a' && $a.hasClass('area')) {
          var href = $a.attr('href');
          if (href) { window.location.href = href; }
        }
      });
    },
    
    _initCustomTrackDialog: function() {
      var self = this,
        o = self.options,
        $dialog = $(o.dialogs[0]).closest('.ui-dialog');
      
      $dialog.data('genobrowser', self.element);
      $dialog.find('.hidden').hide();
      $dialog.find('.show').show();
      
      if ($dialog.hasClass('initialized')) { return; } // The following only needs to be initialized once
      
      $dialog.bind('open.genobrowser', function() { self.$customTracks.trigger('close.genobrowser'); });
      $dialog.find('.range-slider').each(function() {
        var $min = $(this).prev('input'),
          $max = $(this).next('input'),
          min = parseFloat($min.val()),
          max = parseFloat($max.val()),
          $slider = $(this);
        $slider.slider({
          range: true,
          min: min,
          max: max,
          values: [min, max],
          slide: function(event, ui) {
            $min.val(ui.values[0]);
            $max.val(ui.values[1]);
          }
        });
        $min.change(function() { $slider.slider('value', $(this).val()); });
        $max.change(function() { $slider.slider('values', [$slider.slider('values')[0], $(this).val()]); });
      });
      $dialog.find('.color').each(function() {
        var $input = $(this),
          $p = $('<div class="color-picker ui-widget-content ui-corner-bottom shadow"></div>').insertAfter($input);
        $p.farbtastic(this);
        $input.focus(function() { $p.show(200); });
        $input.blur(function() { $p.hide(200); });
        $p.hide();
        $('<input type="button" value="done">').appendTo($p).click(function() { $input.blur(); });
      });
      $dialog.find('.enabler').each(function() {
        var $input = $(this);
        $input.change(function() {
          var value = $input.is(':checked');
          $input.siblings('[type=text]').attr('disabled', !value).toggleClass('disabled', !value);
          $input.siblings('.range-slider').slider(value ? 'enable' : 'disable');
        });
      });
      $dialog.find('[name=save]').click(function() {
        var trk = $dialog.data('track');
        trk.custom.saveOpts($dialog);
        self.$lines.find('.browser-track-'+trk.n+' .tile-custom canvas').trigger('erase').trigger('render');
        $dialog.data('track', false);
      });
      $dialog.find('[name=delete]').click(function() {
        $(this).hide();
        $dialog.find('.delete-confirm').fadeIn();
      });
      $dialog.find('[name=really_delete]').click(function() {
        var tname = $dialog.data('track').n;
        self._removeCustomTrack(tname);
        $dialog.data('track', false);
      });
      $dialog.addClass('initialized');
    },
    
    _initChromSizesDialog: function() {
      var self = this,
        o = self.options,
        $chromSizesDialog = $(o.dialogs[4]).closest('.ui-dialog');
        
      self._igbQuickloadData = self._igbQuickloadData || {};
        
      function filterGenomeList(e) {
        var searchTerms = _.map($(this).val().split(/\s+/), function(t) { return t.toLowerCase(); }),
          $list = $(e.data.list);
        searchTerms = _.reject(searchTerms, function(t) { t == ''; });
        $list.children('option').each(function() {
          var v = $(this).text().toLowerCase(),
            termsFound = _.reduce(searchTerms, function(memo, t){ return memo + (v.indexOf(t) !== -1 ? 1 : 0); }, 0);
          if (searchTerms.length == 0 || termsFound == searchTerms.length) { $(this).removeClass('hidden'); }
          else { $(this).addClass('hidden'); }
        });
        $list.scrollTop(0).val($list.children('option:not(.hidden)').eq(0).val()).change();
      }
      
      function loadedChromSizes(data, $panel) {
        $chromSizesDialog.find('.contigs-loading').stop().fadeOut();
        if (data.error) {
          $panel.find('.skipped-num').text(data.skipped);
          $panel.find('.ui-state-error').fadeIn().children('.contig-load-error').show();
        } else {
          $chromSizesDialog.find('[name=chromsizes]').val(data.chromsizes);
          $chromSizesDialog.find('[name=name]').val(data.db);
          $chromSizesDialog.data('genomeMetadata', data);
          $chromSizesDialog.find('[name=save]').button('enable').addClass('glowing');
          if (data.skipped) {
            $panel.find('.skipped-num').text(data.skipped);
            $panel.find('.ui-state-error').fadeIn().children('.skipped-warning').show();
          }
        }
      }
      
      $chromSizesDialog.bind('open.genobrowser', function() {
        var $genomeList = $chromSizesDialog.find('[name=ucscGenome]'),
          $igbDirs = $chromSizesDialog.find('[name=igbDirs]'),
          $igbList = $chromSizesDialog.find('[name=igbGenome]'),
          $newIgbDir = $chromSizesDialog.find('[name=newIgbDir]')
          $loadIgbBtn = $chromSizesDialog.find('[name=loadIgbDir]'),
          $cancelLoadIgbBtn = $chromSizesDialog.find('[name=cancelLoadIgbDir]');
        $chromSizesDialog.find('[name=filterUcscGenome]').select();
        $(o.genomePicker[1]).trigger('close.genobrowser');
        if ($chromSizesDialog.hasClass('initialized')) { return; }
        
        // the following only runs once, to initialize this dialog's UI
        $chromSizesDialog.find('.accordion').accordion({heightStyle: 'content'});
        $chromSizesDialog.find('[name=save]').button('disable');
        
        // loads the initial lists of available genomes from UCSC & IGB Quickload directories
        $.ajax(o.ajaxDir+'chromsizes.php', {
          dataType: 'json',
          success: function(data) {
            $genomeList.empty().removeClass('loading');
            _.each(data, function(v) {
              var $option = $('<option/>').text(v.species + ' (' + v.name + ') ' + v.assemblyDate);
              $option.val(v.name).data('metadata', v).appendTo($genomeList);
            });
          }
        });
        $.ajax(o.ajaxDir+'igb.php', {
          dataType: 'json',
          success: function(data) {
            var firstDir;
            $igbDirs.children().eq(0).remove();
            _.each(data, function(v, k) {
              firstDir = firstDir || k;
              $('<option/>').text(k).val(k).insertBefore($igbDirs.children().last());
              self._igbQuickloadData[k] = v;
            });
            $igbDirs.val(firstDir).change();
          }
        });
        
        // implements filtering by keyword
        $chromSizesDialog.find('[name=filterUcscGenome]').bind('keyup change', {list: $genomeList}, filterGenomeList);
        $chromSizesDialog.find('[name=filterIgbGenome]').bind('keyup change', {list: $igbList}, filterGenomeList);
        
        // load the chrom sizes data when selecting a UCSC genome
        $genomeList.bind('change', function() {
          var db = $(this).val(),
            $ucscOptions = $chromSizesDialog.find('.ucsc-options');
          if (!db) { return; }
          $chromSizesDialog.find('[name=save]').button('disable').removeClass('glowing');
          $chromSizesDialog.find('.contigs-loading').show();
          $ucscOptions.find('.ui-state-error, .contig-load-error, .skipped-warning').hide();
          $.ajax(o.ajaxDir+'chromsizes.php', {
            data: { db: db, limit: $chromSizesDialog.find('[name=limit]').val() },
            dataType: 'json',
            success: function(data) { loadedChromSizes(data, $ucscOptions); }
          });
        });
        $chromSizesDialog.find('[name=limit]').change(function() { $genomeList.change(); });
        
        // load the contents.txt of an IGB Quickload directory when selecting its URL
        $igbDirs.bind('change', function() {
          var url = $(this).val();
          if ($chromSizesDialog.find('.igb-dirs').is(':hidden')) { $cancelLoadIgbBtn.click(); }
          
          // Show the add URL input box
          if (url == '') {
            $chromSizesDialog.find('.igb-dirs').slideUp(function() {
              $chromSizesDialog.find('.add-igb-dir').slideDown();
            });
            return;
          }
          
          function populateList(url) {
            $igbList.empty().removeClass('loading');
            _.each(self._igbQuickloadData[url], function(v, k) {
              $('<option/>').text(v).val(url + '/' + k).appendTo($igbList);
            });
          }
          
          if (self._igbQuickloadData[url]) { populateList(url); }
          else {
            $igbList.empty().append('<option>loading...</option>').addClass('loading');
            $.ajax(o.ajaxDir+'igb.php', {
              data: { url: url, limit: $chromSizesDialog.find('[name=igblimit]').val() },
              dataType: 'json',
              success: function(data) {
                _.extend(self._igbQuickloadData, data);
                populateList(url);
              }
            });
          }
        });
        
        // UI for adding IGB Quickload directories
        $loadIgbBtn.click(function() {
          var url = $newIgbDir.val().replace(/\/$/, '');
          $('<option/>').text(url).val(url).insertBefore($igbDirs.children().last());
          $igbDirs.val(url).change();
        });
        $cancelLoadIgbBtn.click(function() {
          $newIgbDir.val('');
          $chromSizesDialog.find('.add-igb-dir').slideUp(function() {
            $chromSizesDialog.find('.igb-dirs').slideDown();
          });
        });
        
        // TODO: load an IGB Quickload genome's data when selecting it from the list
        $igbList.bind('change', function() {
          var url = $(this).val(),
            $igbOptions = $chromSizesDialog.find('.igb-options');
          if (!url) { return; }
          $chromSizesDialog.find('[name=save]').button('disable').removeClass('glowing');
          $chromSizesDialog.find('.contigs-loading').show();
          $igbOptions.find('.ui-state-error, .contig-load-error, .skipped-warning').hide();
          $.ajax(o.ajaxDir+'igb.php', {
            data: { url: url, limit: $chromSizesDialog.find('[name=igblimit]').val() },
            dataType: 'json',
            success: function(data) { loadedChromSizes(data, $igbOptions); }
          });
        });
        
        $chromSizesDialog.addClass('initialized');
      });
      $chromSizesDialog.find('[name=chromsizes]').one('focus', function() { 
        var $this = $(this).removeClass('placeholder');
        $chromSizesDialog.find('[name=save]').button('enable');
        _.defer(function() { $this.select(); });
      });
      $chromSizesDialog.find('[name=save]').click(function(e, chose) { 
        var metadata = { format: 'chromsizes' },
          remoteMetadata = $chromSizesDialog.data('genomeMetadata'),
          activeAccordion = $chromSizesDialog.find('.ui-accordion').accordion('option', 'active'),
          choseWhatSource = ['ucsc', 'igb', 'chromsizes'],
          origMetadata, $origOption, genome;
        chose = chose || choseWhatSource[activeAccordion];
        if (chose == 'ucsc' || chose == 'igb') {
          // This is an unaltered set of chromosome sizes pulled from UCSC
          chromSizes = remoteMetadata.chromsizes;
          metadata.name = remoteMetadata.db;
          metadata.tracks = remoteMetadata.tracks;
          origMetadata = remoteMetadata;
          if (chose == 'ucsc') {
            $origOption = $chromSizesDialog.find('[name=ucscGenome] > option[value='+metadata.name+']');
            if (!remoteMetadata.species) { origMetadata = $origOption.data('metadata'); }
            metadata.ucsc = metadata.name + ':' + remoteMetadata.limit;
          } else {
            // TODO: find some way to get the other metadata/custom track data from annots.xml into metadata
            metadata.igb = remoteMetadata.limit + ':' + metadata.name;
          }
          metadata.species = origMetadata.species;
          metadata.assemblyDate = origMetadata.assemblyDate;
        } else {
          chromSizes = $chromSizesDialog.find('[name=chromsizes]').val();
          metadata.name = $chromSizesDialog.find('[name=name]').val();
        }
        CustomGenomes.parseAsync(chromSizes, metadata, function(genome) {
          self._setOptions(genome.options({ width: self.lineWidth() * self.$lines.length }));
        });
      });
    },
    
    _initCustomGenomeDialogs: function() {
      var self = this,
        o = self.options,
        $genomeDialog = $(o.dialogs[5]).closest('.ui-dialog'),
        $add = $genomeDialog.find('.form-line').first(),
        $overlay = $(o.overlay[0]),
        $overlayMessage = $(o.overlay[1]),
        fileInputHTML = '<input type="file" name="genomeFile"/>',
        urlInputHTML = '<input type="url" name="genomeUrl" class="url"/>' +
                       '<input type="button" name="genomeUrlGet" value="Load"/>';
      
      self._initChromSizesDialog();
      
      function customGenomeError(e) {
        $genomeDialog.find('.spinner').hide();
        var msg = e.message.replace(/^Uncaught Error: /, '');
        alert('Sorry, an error occurred while adding this custom genome file:\n\n' + msg);
        // TODO: replace this with something more friendly.
        replaceFileInput(); 
      }
      
      function handleFileSelect(e) {
        var reader = new FileReader(),
          $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner').show();
          
        $overlay.show();
        $overlayMessage.show().text('Loading custom genome...');
        
        if (e.target.files.length) {
          reader.onload = (function(f) {
            var metadata = { file: f.name },
              genome;
            return function(ev) {
              CustomGenomes.parseAsync(ev.target.result, metadata, function(genome) {
                self._setOptions(genome.options({ width: self.lineWidth() * self.$lines.length }));
                $spinner.hide();
                $genomeDialog.fadeOut();
              });
            };
          })(e.target.files[0]);
          reader.readAsText(e.target.files[0]);
        }
        replaceFileInput();
      }
      function replaceFileInput() {
        _.defer(function() {
          $genomeDialog.find('[name=genomeFile]').replaceWith(fileInputHTML);
          $genomeDialog.find('[name=genomeFile]').change(handleFileSelect);
        });
      }
      if (window.File && window.FileReader && window.FileList) {
        $add.find('label').html(fileInputHTML);
        $add.find('[name=genomeFile]').change(handleFileSelect);
        $add = $add.nextAll('.form-line').first();
      } else {
        $add.remove();
        $genomeDialog.find('.help-line').first().remove();
        $add = $picker.find('.form-line').first();
      }
      
      function handlePastedData(e) {
        var $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner').show();
        $overlay.show();
        $overlayMessage.show().text('Loading custom genome...');
        CustomGenomes.parseAsync($add.find('textarea').val(), { file: "_pasted_data" }, function(genome) {
          self._setOptions(genome.options({ width: self.lineWidth() * self.$lines.length }));
          $spinner.hide();
          $genomeDialog.fadeOut();
          $add.find('textarea').val('');
        });
      }
      $add.find('[name=customGenomePasteAdd]').click(handlePastedData);
      $add = $add.nextAll('.form-line').first();
      
      function handleUrlSelect(e) {
        var $add = $(e.target).closest('.form-line'),
          $spinner = $add.find('.spinner'),
          $url = $add.find('[name=genomeUrl]'),
          url = $.trim($url.val());
        if (!url.length) { return; }
        $spinner.show();
        $overlay.show();
        $overlayMessage.show().text('Loading custom genome...');
        $.ajax(url, {
          dataType: "text",
          success: function(data) {
            CustomGenomes.parseAsync(data, {url: url}, function(genome) {
              self._setOptions(genome.options({ width: self.lineWidth() * self.$lines.length }));
              $spinner.hide();
              $url.val('');
              $genomeDialog.fadeOut();
            });
          },
          progress: function(loaded, total) {
            var $progress = $overlayMessage.find('.ui-progressbar');
            if (!$progress.length) { $progress = $('<div/>').appendTo($overlayMessage).progressbar(); }
            $progress.progressbar('value', loaded/total * 100);
          },
          error: function() {
            $overlay.hide();
            $overlayMessage.hide();
            customGenomeError({message: "No valid custom track data was found at this URL."}); 
          }
        });
      }
      $add.find('label').html(urlInputHTML);
      $add.find('[name=genomeUrlGet]').click(handleUrlSelect);
      $add.find('[name=genomeUrl]').bind('keydown', function(e) { if (e.which==13) { handleUrlSelect(e); } });
    },
    
    _initFromParams: function(params, suppressRepeat) {
      var self = this,
        o = self.options,
        $elem = self.element,
        $overlay = $(o.overlay[0]),
        $overlayMessage = $(o.overlay[1]),
        $customPicker = $(o.trackPicker[3]),
        $genomeDialog = $(o.dialogs[5]).closest('.ui-dialog'),
        $chromSizesDialog = $(o.dialogs[4]).closest('.ui-dialog'),
        $trackUrlInput = $customPicker.find('[name=customUrl]'),
        $trackUrlGet = $customPicker.find('[name=customUrlGet]'),
        $genomeUrlInput = $genomeDialog.find('[name=genomeUrl]'),
        $genomeUrlGet = $genomeDialog.find('[name=genomeUrlGet]'),
        remoteGenomeSettings = {
          ucsc: { url: 'chromsizes.php', messageText: 'from UCSC' },
          igb: { url: 'igb.php', messageText: 'via IGB Quickload' }
        },
        sessionVars = {},
        customTracksArray, customGenomePieces, customGenomeSource, customGenomeName, chromSizes, trackSpec, 
          remote, remoteParams;
      
      function persistentCookie(k, v) { $.cookie(k, v, {expires: 60}); }
      function removeCookie(k) { $.cookie(k, null); }
      persistentCookie('db', o.genome);
      self.storage = {
        session: window.sessionStorage || {setItem: $.cookie, getItem: $.cookie, removeItem: removeCookie},
        persistent: window.localStorage || {setItem: persistentCookie, getItem: $.cookie, removeItem: removeCookie}
      };
      _.each(o.savableParams, function(keys, dest) {
        _.each(keys, function(k) {
          var v = self.storage[dest].getItem((dest != 'persistent' ? o.genome + '.' : '') + k); 
          if (v !== null) { sessionVars[k] = v; }
        });
      });
      params = params || _.extend({}, sessionVars, $.urlParams());
            
      if (suppressRepeat && self._lastParams && _.isEqual(self._lastParams, params)) { return; }
      self._lastParams = _.clone(params);
      
      customTracksArray = _.compact([].concat(params.customTracks)),
      self._customTrackUrls.requested = _.union(self._customTrackUrls.requested, customTracksArray);
      var unprocessedUrls = _.difference(self._customTrackUrls.requested, self._customTrackUrls.processing);
      
      // We need to load a custom genome
      if (params.db != o.genome) {
        customGenomePieces = (params.db || '').split(':');
        customGenomeSource = customGenomePieces[0];
        remote = remoteGenomeSettings[customGenomeSource];
        if (customGenomeSource == 'url') {   // It's a URL to a full genome file
          $genomeUrlInput.val(customGenomePieces.slice(1).join(':'));
          $genomeUrlGet.click();
          self._nextDirectives = params;
          return;
        } else if (remote) {
          // It's a genome stored at UCSC or in an IGB Quickload directory
          $overlay.show();
          $overlayMessage.show().text('Loading genome ' + remote.messageText + '...');
          if (customGenomeSource == 'ucsc') {
            remoteParams = { db: customGenomePieces[1], limit: customGenomePieces[2], meta: 1 };
          } else { // customGenomeSource == 'igb'
            remoteParams = { url: customGenomePieces.slice(2).join(':'), limit: customGenomePieces[1] };
          }
          
          $.ajax(o.ajaxDir + remote.url, {
            data: remoteParams,
            dataType: 'json',
            success: function(data) {
              if (data.error) {
                $overlayMessage.text('Error loading genome data ' + remote.messageText);
              } else {
                $chromSizesDialog.data('genomeMetadata', data);
                $chromSizesDialog.find('[name=save]').trigger('click', [customGenomeSource]);
                self._nextDirectives = params;
              }
            }
          });
          return;
        } else if ((/^custom[:|]/).test(params.db)) {   // It's a custom chrom.sizes
          chromSizes = params.db.replace(/^[^|]+\|/, '').replace(/:/g, "\t").replace(/\|/g, "\n");
          $chromSizesDialog.find('[name=chromsizes]').val(chromSizes);
          customGenomeName = (params.db[6] == ':') ? params.db.substring(7).replace(/\|.*/, '') : '';
          $chromSizesDialog.find('[name=name]').val(customGenomeName);
          $chromSizesDialog.find('[name=save]').trigger('click', ['chromsizes']);
          self._nextDirectives = params;
          return;
        }
      }
      
      // If there are custom track URLs somewhere in the parameters that have not been processed yet
      // they need to be loaded before we can make sense of the rest of the params
      if (unprocessedUrls.length) {
        $overlay.show();
        $overlayMessage.show().text('Loading custom track...');
        $trackUrlInput.val(unprocessedUrls[0]); $trackUrlGet.click();
        // This should have added the URL to self._customTrackUrls.processing, so it will not be submitted again
        self._nextDirectives = params;
      } else {
        if (params.mode) { $(o.lineMode).find('[value="'+params.mode+'"]').click(); }
        if (params.tracks) {
          trackSpec = _.map(params.tracks.split('|'), function(v) { 
            var split = v.split(':'), trk = {n: split[0]};
            if (split.length > 1 && (/^\d+$/.test(split[1]))) { trk.h = parseInt(split[1], 10); }
            return trk; 
          });
          self._fixTracks({}, trackSpec);
        }
        if (params.position) { self.jumpTo(params.position); }
      }
    },
    
    // =====================================================================================
    // = The following functions coordinate the display of browser lines ($.ui.genoline's) =
    // =====================================================================================
    
    // Fix the number of lines displayed vertically, shifting and unshifting lines to fill the vertical space
    // You can specify the line index to holdSteady (keep in roughly the same place), and animOpts for the animation
    _fixNumLines: function(holdSteady, animOpts) {
      var self = this,
        $elem = self.element, 
        o = self.options,
        availHeight = $elem.innerHeight(),
        lineHeight = self._lineHeight(),
        numLines = self.$lines.length,
        forceOneLine = $(o.lineMode).find(':checked').val() == 'single',
        newNumLines = forceOneLine ? 1 : Math.max(floorHack(availHeight / lineHeight), 1),
        extraSpace = availHeight - (newNumLines * lineHeight),
        extraLineHeight = extraSpace > 0 ? lineHeight + extraSpace / newNumLines : lineHeight,
        extraTopMargin = newNumLines === 1 ? Math.max((availHeight - lineHeight) / 2.0, 0) : 0,
        unShiftLines = 0, pushLines = 0,
        destIndex, currTop;
      if (!_.isUndefined(holdSteady) && holdSteady !== null) {
        if (!_.isUndefined(holdSteady.shift)) {
          unShiftLines = -holdSteady.shift;
        } else {
          currTop = self.$lines.eq(holdSteady).position().top;
          // Special case the resizing of the central line: it must stay the central line
          if (holdSteady == this.centralLine) { destIndex = Math.ceil(newNumLines / 2) - 1; }
          else {
            destIndex = _.min(_.range(newNumLines), function(i) { 
              return Math.abs(i * extraLineHeight + extraTopMargin - currTop); 
            });
          }
          unShiftLines = destIndex - holdSteady;
        }
      }
      pushLines = newNumLines - numLines - unShiftLines;
      unShiftLines > 0 ? self._addLines(-unShiftLines) : self._removeLines(unShiftLines, animOpts);
      pushLines > 0 ? self._addLines(pushLines) : self._removeLines(-pushLines, animOpts);
      self.centralLine = Math.ceil(newNumLines / 2) - 1;
      self._pos(self.pos - unShiftLines * self.bpWidth());
      // Only fire a completion callback once for the whole browser
      if (animOpts && animOpts.complete) { animOpts.complete = _.after(self.$lines.length, animOpts.complete); }
      self.$lines.each(function(i) {
        var newTop = i * extraLineHeight + extraTopMargin;
        $(this).data('naturalTop', newTop);
        if (holdSteady && holdSteady.exceptFor == this) { return; }
        $(this).animate({top: newTop}, $.extend({
          duration: o.lineFixDuration,
          queue: false,
          easing: 'easeInOutQuart'
        }, animOpts));
      });
      self._updateReticle(null, animOpts);
    },
    
    // A shortcut that pushes the lines in the display up or down
    shiftLines: function(num, exceptFor, animOpts) { this._fixNumLines({shift: num, exceptFor: exceptFor}, animOpts); },
    
    // Add num lines to the browser; they begin offscreen and must be moved into view
    // positive num adds to the end; negative num adds to the beginning
    _addLines: function(num) {
      var o = this.options,
        bpWidth = this.bpWidth(),
        origin = this.pos + (num > 0 ? this.$lines.length * bpWidth : -bpWidth),
        bpStep = num > 0 ? bpWidth : -bpWidth,
        // Can't use normal .unshift() on a jQuery object, it only has splice.
        ops = num > 0 ? ['appendTo', function(x){this.push(x);}] : ['prependTo', function(x){this.splice(0,0,x);}],
        setTop = num > 0 ? $(window).innerHeight() + o.betweenLines : -this._lineHeight(),
        $line, newOpts;
      num = Math.abs(num);
      while (num-->0) {
        $line = $('<div class="browser-line"></div>')[ops[0]](this.element);
        newOpts = $.extend({}, o, {browser: this.element, origin: origin});
        ops[1].call(this.$lines, $line.get(0));
        $line.css('top', setTop).genoline(newOpts);
        origin += bpStep;
      }
    },
    
    // Remove num lines to the browser; they fade out and are deleted from the DOM
    // positive num removes from the end; negative num removes from the beginning
    _removeLines: function(num, animOpts) {
      var o = this.options,
        bpWidth = this.bpWidth(),
        duration = animOpts && !_.isUndefined(animOpts.duration) ? animOpts.duration : o.lineFixDuration,
        index = num > 0 ? -1 : 0,
        // We can't use normal .pop() and .shift() on a jQuery object, it only has splice.
        popOrShift = num > 0 ? 
          function($a){ $a.splice($a.length-1,1); } : function($a){ $a.splice(0,1); };
      num = Math.abs(num);
      while (num-->0) {
        if (duration > 0) {
          this.$lines.eq(index).fadeOut(duration, function() { $(this).remove(); });
        } else { this.$lines.eq(index).remove(); }
        popOrShift(this.$lines);
      }
    },
    
    // Returns the elements that contain each line of the display
    lines: function() { return this.$lines; },
    
    // Returns the expected width, in pixels, of each line
    lineWidth: function() { return this._width - this.options.sideBarWidth; },
    
    // Returns the expected height, in pixels, of each line
    _lineHeight: function() {
      var o = this.options;
      return o.betweenLines + _.reduce(o.tracks, function(t, u) { return {h:t.h + u.h}; }).h;
    },
    
    // ===============================================================================================
    // = The following functions coordinate the tracks ($.ui.genotrack's) displayed within each line =
    // ===============================================================================================
    
    // Returns the current array of tracks, with all associated options, that are supposed to be displayed
    tracks: function() { return this.options.tracks; },
    
    // Ensures all lines have the right tracks, as specified by the checkboxes in the track pickers or the trackSpec
    _fixTracks: function(animOpts, trackSpec) {
      var self = this,
        o = self.options,
        $elem = self.element,
        newTracks = [],
        prevTracks = [],
        prevPos = self.pos + self._reticDelta(),
        externalTrackSpec = !!trackSpec;
      
      // Sync the trackSpec with the checkboxes in the track pickers
      // If trackSpec was not provided, this simply retrieves one from the state of the checkboxes
      trackSpec = self._trackSpec(trackSpec);
      newTracks = _.pluck(trackSpec, 'n');
      
      // First remove any tracks that are not in the new set
      o.tracks = _.filter(o.tracks, function(t) {
        var i = _.indexOf(newTracks, t.n);
        if (i !== -1) { 
          prevTracks.push(t.n);
          // Resize existing tracks if a new height is specified
          if (trackSpec[i].h) { self._resizeTrack(t.n, trackSpec[i].h, false, false); }
          return true;
        }
      });
      // Now, add any tracks that are in the new set but aren't in the old set
      _.each(newTracks, function(name, i) {
        var spec = trackSpec[i];
        if (!_.include(prevTracks, name)) { o.tracks.splice(i, 0, $.extend({}, self.availTracks[name], spec.h ? {h: spec.h} : {})); } 
      });
      
      self.$lines.genoline('fixTracks');
      self._fixNumLines(0, animOpts);
      if (prevPos < o.genomeSize && prevPos > 0 && (!animOpts || !animOpts.complete)) { self.jumpTo(prevPos); }
      if (!externalTrackSpec) { this._saveParamsDebounced(); }
    },
    
    // Resize a track to a particular height, fixing the line layout afterward unless fixNumLinesHoldingSteady is false,
    // Set animCallback to true to animate with no callback, a function to provide a callback, or false for no animation.
    _resizeTrack: function(name, height, fixNumLinesHoldingSteady, animCallback) {
      var o = this.options,
        $elem = this.element,
        trk = _.find(o.tracks, function(t) { return t.n == name; }),
        $lines = this.$lines,
        $tracks = $lines.find('.browser-track-'+name);
      animCallback = _.isFunction(animCallback) ? _.after($tracks.length, animCallback) : animCallback;
      trk.h = height;
      $tracks.genotrack('resize', height, animCallback);
      if (fixNumLinesHoldingSteady !== false) { this._fixNumLines(fixNumLinesHoldingSteady); }
      $lines.genoline('fixFirstLabel', true);
    },
    
    // Syncs a list of tracks (with heights), the trackSpec, with the checkboxes in the track pickers
    _trackSpec: function(trackSpec) {
      var self = this,
        $checkboxes = self.$trackPicker.find(':checkbox').add(self.$customTracks.find(':checkbox'));
      if (!trackSpec || !_.isArray(trackSpec) || !trackSpec.length) {
        trackSpec = [];
        $checkboxes.filter(':checked').each(function() { trackSpec.push({n: $(this).attr('name')}); });
      } else {
        // Cleanup external trackSpecs: for now, disallow dupes, and make sure all tracks actually exist
        trackSpec = _.uniq(_.filter(trackSpec, function(t) { return self.availTracks[t.n]; }), function(t) { return t.n; });
        $checkboxes.attr('checked', false);
        _.each(trackSpec, function(t) { $checkboxes.filter('[name="'+t.n+'"]').attr('checked', true); });
      }
      // if there is only one newTrack, disable the checkbox so there are always 1 tracks
      if (trackSpec.length === 1) { $checkboxes.filter(':checked').attr('disabled', true); }
      else { $checkboxes.attr('disabled', false); }
      return trackSpec;
    },
    
    // Resets to the default set of tracks
    _resetToDefaultTracks: function() {
      this._fixTracks(false, this.defaultTracks);
      this._saveParamsDebounced();
    },
    
    // After a custom track file is parsed, this function is called to add them to the custom track picker and each
    // browser line; they are also inserted in self.availTracks just like "normal" tracks
    _addCustomTracks: function(fname, customTracks, url) {
      var self = this,
        o = self.options,
        $ul = $(o.trackPicker[3]).children('ul').eq(0),
        d = o.trackDesc,
        browserDirectives = _.extend({}, customTracks.browser, self._nextDirectives || {}),
        warnings = [],
        customTrackNames = _.map(customTracks, function(t, i) { return classFriendly('_'+fname+'_'+(t.opts.name || i)); }),
        newTracks = _.filter(customTrackNames, function(n) { return !self.availTracks[n] }),
        nextDirectivesIncludeOneNewTrack = self._nextDirectives && self._nextDirectives.tracks &&
          !!_.find(self._nextDirectives.tracks.split('|'), function(v) { return _.contains(newTracks, v.split(':')[0]); });
      
      _.each(customTracks, function(t, i) {
        var n = customTrackNames[i],
          newTrack = !self.availTracks[n],
          $li, $l, $c, $d, $o;
        if (newTrack) {
          $li = $('<li class="choice"/>').appendTo($ul);
          $l = $('<label class="clickable"/>').appendTo($li);
          $c = $('<input type="checkbox" checked="checked"/>').attr('name', n).prependTo($l);
          $d = $('<div class="desc"></div>').appendTo($l);
          $o = $('<button class="opts"><img src="css/gear.png" alt="gear" /></button>').appendTo($li),
          $l.hover(function() { $(this).addClass('hover'); }, function() { $(this).removeClass('hover'); });
          $l.attr('title', n);
          $c.bind('change', _.bind(self._fixTracks, self));
          $o.button().click(_.bind(self._editCustomTrack, self, n));
          $('<h3 class="name"/><p class="long-desc"/>').appendTo($d);
          // If track settings are to be applied, ensure any new custom tracks are added to them
          // This prevents new tracks from being added and then immediately hidden (confusing)
          // -- One exception! If self._nextDirectives contain at least one track name
          //    among the new tracks to be added, do not do this, we then assume they are overriding.
          if (browserDirectives.tracks && !nextDirectivesIncludeOneNewTrack) {
            if (!_.find(browserDirectives.tracks.split('|'), function(v) { return v.split(':')[0] == n; })) {
              browserDirectives.tracks += '|' + n;
            }
          }
        } else { $d = $ul.find('[name='+n+']').parent().children('.desc'); }
        if (url) { t.url = url; }
        // TODO: if the track is not new, inform that its data was replaced with the new track information
        self.availTracks[n] = {
          fh: {"0.1": {dense: t.heights.start}},
          n: n,
          h: t.heights.start,
          s: t.sizes,
          m: t.mapSizes,
          custom: t
        };
        _.each(o.bppps, function(bppp) { self.availTracks[n].fh[o.bpppFormat(bppp)] = {dense: t.heights.min}; });
        d[n] = {
          cat: fname,
          lg: t.opts.description || t.opts.name || n, 
          sm: t.opts.name || n
        };
        $d.children('h3.name').text(d[n].sm);
        $d.children('p.long-desc').text(d[n].lg && d[n].lg != d[n].sm ? d[n].lg : fname);
        if (t.warnings) { warnings.push.apply(warnings, t.warnings); }
      });
      if (warnings.length) {
        // TODO: Display warnings from custom track parsing to the user
        console.log(warnings);
      }
      self._fixTracks({complete: function() {
        // If browser directives were included, we need to obey them.
        self._nextDirectives = {};
        // Right now only position is supported.
        // TODO: other browser directives at http://genome.ucsc.edu/goldenPath/help/hgTracksHelp.html#lines
        if (_.keys(browserDirectives).length) { self._initFromParams(browserDirectives); }
      }}); 
    },
    
    // Opens a dialog to edit the options for a custom track.
    _editCustomTrack: function(n) {
      var self = this,
        o = self.options,
        $dialog = $(o.dialogs[0]).closest('.ui-dialog'),
        trk = self.availTracks[n];
        
      self._initCustomTrackDialog();
      trk.custom.loadOpts($dialog);
      $dialog.data('track', trk);
      $dialog.trigger('open');
    },
    
    // Removes a custom tracks.
    _removeCustomTrack: function(tname) {
      var self = this,
        $li = $(self.options.trackPicker[3]).find('input[name="'+tname+'"]').closest('li'),
        url = self.availTracks[tname].custom.url;
      delete self.availTracks[tname];
      $li.remove();
      // Remove url from list of loaded URLs if there are no other tracks that were loaded from it
      if (url && !_.find(self.availTracks, function(trk) { return trk.custom && trk.custom.url == url; })) {
        self._customTrackUrls.loaded = _.difference(self._customTrackUrls.loaded, [url]);
      }
      self._fixTracks();
    },
    
    // Removes all custom tracks.
    _resetCustomTracks: function() {
      var self = this,
        $lis = $(self.options.trackPicker[3]).children('ul').children();
      $lis.find(':checkbox').each(function() { delete self.availTracks[$(this).attr('name')]; });
      $lis.remove();
      self._customTrackUrls.loaded = [];
      self._fixTracks();
    },
    
    // Determine for a given track and height what density is optimal for display
    densityOrder: function(track, height, bppps, force) {
      if (_.isUndefined(height) || _.isUndefined(bppps)) { return this._densityOrder[track] || null; }
      // TODO: this needs tweaking... maybe on the debounced version, exclude off-screen tiles?
      var self = this, 
        o = self.options,
        $elem = self.element,
        t = this.availTracks[track],
        base = _.find(t.s, function(v) { return !_.isArray(v); }),
        fixedHeights = t.fh[bppps.topFormatted] || (_.keys(t.fh).length && t.fh[_.last(_.keys(t.fh))]) || {},
        baseHeight = fixedHeights[base] || 15,
        orderFor = height + "|" + bppps.topFormatted,
        prevOrder = self._densityOrder[t.n],
        prevOrderFor = self._densityOrderFor[t.n],
        $unrenderedCustom = $('.browser-track-'+t.n+' canvas.tdata.unrendered'),
        forceAt = {}, //{pack: [200, -2], full: [200, -3]},  // This is causing too much thrashing with heavy custom tracks
        order = {}, heights = [], i = 0, optimum;
      if (prevOrderFor && prevOrderFor == orderFor && !force) { return; }
      if ($unrenderedCustom.length) {
        // All custom tracks should be rendered before reordering the densities.  Defer this calculation until then.
        return $unrenderedCustom.trigger('render', _.after($unrenderedCustom.length, function() { 
          self.densityOrder(track, height, bppps); 
        }));
      }
      // Always show the base density when within 3px of the baseHeight (the initial height)
      if (height <= baseHeight + 3) {
        order[base] = 0;
        _.each(t.s, function(d) { if (_.isArray(d)) { order[d[0]] = ++i; } });
      } else {
        // Otherwise, order the densities by their tiles' max height's proximity to the track height
        // with a 3x bias toward showing the taller density
        _.each(t.s, function(d) {
          if (_.isArray(d)) { d = d[0]; }
          if (fixedHeights[d]) { return heights.push([d, fixedHeights[d]]); }
          var $imgs = $('.browser-track-'+t.n+'>.bppp-'+classFriendly(bppps.top)+'>.tdata.dens-'+d);
          if ($imgs.find('.loading').length > 0) { orderFor = null; }
          var h = Math.max.apply(Math, $imgs.map(function() { 
            return this.naturalHeight || this.height; 
          }).get());
          heights.push([d, h]);
        });
        heights = _.map(heights, function(v, i) {
          var deltaY;
          v[2] = v[1] == 0;
          v[1] = v[2] ? 1000000 : v[1];      // effectively, never show 0 height tiles
          deltaY = height - v[1];
                                             // this is where the 3x bias toward the taller density is inserted
          v[1] = (forceAt[v[0]] && height > forceAt[v[0]][0]) ? forceAt[v[0]][1] : (deltaY > 0 ? deltaY * 3 : -deltaY);
          v[1] -= i * 0.1;                   // marginally prioritize more detailed tracks in the event of ties
          return v; 
        });
        heights.sort(function(a, b){ return a[1] - b[1]; });
        _.each(heights, function(v) { order[v[0]] = ++i; });
        // Unless all of the other densities were 0 height tiles, make the base density last priority.
        if (heights.length - _.compact(_.pluck(heights, '2')).length > 1) { order[base] = ++i; }
      }
      self._densityOrder[t.n] = order;
      self._densityOrderFor[t.n] = orderFor;
      if (prevOrder && !_.isEqual(order, prevOrder)) { 
        $elem.find('.browser-track-'+t.n).genotrack('updateDensity');
      }
    },
    
    // ================================================================================================
    // = These are navigational functions; they handle movement, zooming, position calculations, etc. =
    // ================================================================================================

    // Returns the expected width, in base pairs, of each line
    bpWidth: function() { return this.lineWidth() * this.bppp; },
    
    // Returns the chromosome that contains the given absolute bp position
    chrAt: function(pos) {
      var o = this.options,
        chrIndex = _.sortedIndex(o.chrLabels, {p: pos}, function(v) { return v.p; });
      return chrIndex > 0 ? o.chrLabels[chrIndex - 1] : null;
    },
    
    // Turns a string like "chrX:12512" into an bp position from the start of the genome
    normalizePos: function(pos, forceful) {
      var o = this.options, 
        ret = {}, 
        matches, end;
        
      ret.pos = $.trim(_.isUndefined(pos) ? $(o.jump[0]).val() : pos);
      if (ret.pos === '') { this._searchFor(''); return null; }
      
      matches = ret.pos.match(/^([a-z]+[^:]*)(:(\d+)(([-@])(\d+(\.\d+)?))?)?/i);
      // Does the position string have a colon in it? If so, we try to parse it as a bp position
      if (matches && matches[1]) {
        var chr = _.find(o.chrLabels, function(v) { return v.n === matches[1]; });
        // If this didn't match a real chromosome name, use the first, by default.
        if (!chr) { chr = _.first(o.chrLabels); }
        this._searchFor('', forceful);
        ret.pos = chr.p + parseInt(matches[3] || '1', 10);
        if (matches[5] == '-') {
          // Allow ranges, e.g. chrX:12512-12630
          end = chr.p + parseInt(matches[6], 10);
          if (end > ret.pos) {
            ret.bppp = (end - ret.pos) / (this.lineWidth() - o.sideBarWidth);
            // Find the nearest optimal zoom level on the slider that fully encompasses the range.
            ret.bppp = _.find(this.sliderBppps.reverse(), function(v) { return v >= ret.bppp; }) || _.last(this.sliderBppps);
            this.sliderBppps.reverse(); // .reverse() is destructive in JS -_-
            ret.pos += floorHack((end - ret.pos) / 2);
          }
        } else if (matches[5] == '@') {
          // or specifying bppp directly, e.g. chrX:12512@100
          ret.bppp = parseFloat(matches[6]);
        }
      } else { 
        pos = parseInt(ret.pos, 10);
        if (_.isNaN(pos)) {
          this._searchFor(ret.pos, forceful);
          return null;
        }
        ret.pos = pos;
      }
      
      return ret;
    },
    
    // Displays the search dropdown where the user can select from features that match the query
    _searchFor: function(search, forceful) {
      var self = this,
        o = self.options,
        $elem = self.element;
      function hilite(text, searchFor) {
        return text.replace(new RegExp(regExpQuote(searchFor), "gi"), '<span class="hilite">'+searchFor+'</span>');
      }
      function createChoice(c, cat) {
        var $c = $('<div class="choice"/>');
        $('<h3 class="name"/>').html(hilite(c.name, search)).appendTo($c);
        $('<p class="long-desc"/>').html(hilite(c.desc, search)).appendTo($c);
        $c.bind('fakefocus', function() { $(this).addClass('focus'); $(this).siblings().removeClass('focus'); });
        $c.bind('fakeblur', function() { $(this).removeClass('focus'); });
        $c.mouseover(function() { $(this).trigger('fakefocus'); });
        $c.click(function() {
          var m, picked = (m = c.desc.match(/^\((.+)\)/)) ? m[1].toLowerCase() : c.name.toLowerCase();
          $('body').unbind('mousedown.search');
          self.$trackPicker.find('input[name='+cat.track+']').attr('checked', true);
          self.tileFixingEnabled(false);
          self._fixTracks({duration: 0, complete: function() {
            // This callback maximizes the track that contained the feature clicked, and flashes the feature.
            // Flashing the clicked feature is tricky because everything is loading at different times.
            var $maximizeTrack = self.$lines.eq(self.centralLine).find('.browser-track-'+cat.track).eq(0);
            $maximizeTrack.one('trackload', function(e, bppps) {
              var $imgs = self.$lines.find('.bppp-'+classFriendly(bppps.top)+' .tdata.dens-pack');
              maxHeight = 5 + Math.max.apply(Math, $imgs.map(function() { 
                return this.naturalHeight || this.height;
              }).get());
              // After the track is resized, flash all the features that were added to our todo-list
              self._resizeTrack(cat.track, maxHeight, self.centralLine, function() {
                var $stillLoading = self.$lines.find('.browser-track-'+cat.track).has('.areas-loading');
                $elem.find('.browser-track').genotrack('updateDensity');
                function flash() { self.areaHover([cat.track, bppps.top, "pack", "name", picked], "FLASHME"); };
                // FIXME: this is pretty rickety
                if (!$stillLoading.length) { flash(); }
                else { $stillLoading.one('areaload', _.after($stillLoading.length, flash)); }
              });
            });
            _.defer(function(){ self.tileFixingEnabled(true); $elem.find('.browser-track-'+cat.track).genotrack('fixClickAreas'); });
          }});
          self.jumpTo(c.pos);
          return false; 
        });
        return $c;
      }
      function hideChoices() { self.$choices.find('.choice').trigger('fakeblur'); self.$choices.hide(); }
      
      if (search==='') { return hideChoices(); }
      if (search===self.prevSearch && !forceful) { return; }
      self.$choices.empty().addClass('loading').removeClass('no-results').slideDown();
      $('body').bind('mousedown.search', function(e) { 
        if (!$(e.target).closest(self.$choices).length) { hideChoices(); }
        $('body').unbind('mousedown.search');
      });
      if (self.currentSearch) { self.currentSearch.abort(); }
      
      self.prevSearch = search;
      self.currentSearch = $.ajax(o.ajaxDir+'search.php', {
        data: {position: search, db: o.genome},
        dataType: 'json',
        success: function(data) {
          self.$choices.removeClass('loading');
          if (data['goto']) { self.jumpTo(data['goto']); return; }
          if (!data.categories || data.categories.length===0) { self.$choices.addClass('no-results'); return; }
          var numCategories = _.keys(data.categories).length,
            choicesPerCategory = Math.max(Math.ceil(12 / numCategories), 3);
          _.each(data.categories, function(cat, catname) {
            $('<div class="choice-category"/>').text(catname).appendTo(self.$choices);
            _.each(cat.choices.slice(0, choicesPerCategory), function(c) {
              var $c = createChoice(c, cat).appendTo(self.$choices);
            });
          });
          self.$choices.find('.choice').eq(0).trigger('fakefocus');
        }
      });
    },
        
    // public (indirect) setter for this.pos; centers the reticle on reticPos
    jumpTo: function(reticPos) {
      var dest = this.normalizePos(reticPos, true);
      if (dest !== null) {
        this.$choices.hide().empty();
        if (dest.bppp) {
          this.pos = dest.pos - this._reticDelta();
          this.zoom(dest.bppp); 
        } else {
          this._pos(dest.pos - this._reticDelta());
        }
        $(this.options.jump[0]).blur();
      }
    },
    
    // private setter for this.pos that updates the UI accordingly.
    // forceRepos usually means a zoom happened, which requires that the tiles are repositioned within the tracks.
    _pos: function(pos, exceptFor, forceRepos) {
      var o = this.options,
        bpWidth = this.bpWidth(),
        rd = this._reticDelta();
      exceptFor = $(exceptFor).get(0);
      pos = _.isUndefined(pos) ? this.pos : pos;
      this.pos = pos;
      this.$lines.each(function(i) {
        if (this == exceptFor) { return; }
        $(this).genoline('jumpTo', pos + i * bpWidth, forceRepos); 
      });
      if (forceRepos) { this._fixZoomedTrackDebounced(); }
      this._fixClickAreasDebounced();
      this._saveParamsDebounced();
    },
    
    // Returns the position (in basepairs) closest to the mouse cursor
    _posAtMouse: function(e) {
      var $line = $(e.srcElement || e.originalTarget).closest('.browser-line');
      if (!$line.length) { return null; }
      return (e.pageX - this.options.sideBarWidth) * this.bppp + $line.genoline('getPos');
    },
    
    // public getter/setter for this.bppp that updates the UI.  If duration is specified, animates the change in zoom.
    zoom: function(zoom, centeredOn, duration) {
      var self = this,
        o = self.options;
      
      function sliderValue(zoom) {
        var ret = 0;
        for (var i = 0; i < self.sliderBppps.length; i++) {
          var bppp = self.sliderBppps[i];
          if (zoom > bppp) {
            var frac = zoom - bppp;
            return ret + (1.0 - frac / (self.sliderBppps[ret] - self.sliderBppps[i]));
          }
          ret = i;
        }
        return ret;
      }
      
      if (!_.isUndefined(zoom)) {
        if (!_.isUndefined(centeredOn) && centeredOn !== null) { this.centeredOn = centeredOn; }
        else { delete this.centeredOn; }
        if (!_.isUndefined(duration)) {
          this._animateZoom(_.isBoolean(zoom) ? zoom : sliderValue(zoom), duration);
        } else {
          this.$slider.slider('value', sliderValue(zoom));
        }
      }
      return this.bppp; 
    },
    
    // private setter for this.bppp; does not update the slider--used internally by it.
    _zoom: function(zoom, centeredOn) {
      centeredOn = centeredOn || this.centeredOn || (this.pos + this._reticDelta());
      var pos = centeredOn - (centeredOn - this.pos) / (this.bppp / zoom);
      this.bppp = zoom;
      var now = (new Date).getTime();
      this._pos(pos, null, true);
      fps("ZOOM", (new Date).getTime() - now, this.bppp);
      this._updateReticle(centeredOn);
    },
    
    // If "to" is boolean, true will raise the slider one step and false will lower it one step.
    _animateZoom: function(to, duration) {
      var self = this,
        $slider = $(self.options.zoomSlider),
        from = $slider.slider('value');
      if (_.isBoolean(to)) { to = Math[to ? 'ceil' : 'floor'](from + (to ? 0.001 : -0.001)); }
      $slider.css('text-indent', 0).animate({textIndent: 1}, {
        queue: false,
        step: function(i) { $slider.slider('value', (to - from) * i + from); },
        complete: function() { self.bounceCheck(); },
        duration: duration || 150
      });
    },
    
    // Bounce off edges if we are toward the margins of the genome
    bounceCheck: function() {
      var self = this,
        o = self.options,
        $elem = self.element,
        bpWidth = this.bpWidth(),
        pos = self.pos,
        numLines = self.lines().length,
        margins = [(-numLines + o.bounceMargin) * bpWidth, o.genomeSize - o.bounceMargin * bpWidth],
        outsideGenomeRange = pos < margins[0] || pos > margins[1];
      
      if (outsideGenomeRange && !self._bouncing) {
        $elem.find('.drag-cont').stop(true); // Stop any current inertial scrolling
        self.bounceTo(_.min(margins, function(marg) { return Math.abs(marg - pos); }));
      }
    },
    
    // Animates a "bounce" from the current browser position to targetPos
    bounceTo: function(targetPos, callback) {
      var self = this,
        $elem = self.element,
        zoom = self.zoom(),
        pos = self.pos,
        naturalFreq = 0.03,
        vInit = $elem.data('velocity') || 0,
        deltaXInit = (targetPos - pos) / zoom;
        bounceStart = (new Date).getTime();
        
      $elem.css('text-indent', 1);
      self._bouncing = true;
      $elem.animate({textIndent: 0}, {
        queue: false,
        duration: 500, // TODO: some better way of approximating this based on dampened spring motion.
        step: function() {
          var newTime = (new Date).getTime(),
            deltaT = newTime - bounceStart,
            // see http://en.wikipedia.org/wiki/Damping#Critical_damping_.28.CE.B6_.3D_1.29
            newDeltaX = (deltaXInit + (vInit + naturalFreq * deltaXInit) * deltaT) * Math.exp(-naturalFreq * deltaT);
          self._pos(pos + (deltaXInit - newDeltaX) * zoom);
        },
        complete: function() { self._bouncing = false; _.isFunction(callback) && callback(); }
      });
    },
    
    // ===================================================================================================
    // = The following functions handle or assist events sent from sub-widgets, like the lines or tracks =
    // ===================================================================================================
    
    // Returns the distance left or right, in pixels, that the lines have been shifted by the last keypress
    keyedOffset: function() { return this._keyedOffset; },
    
    // Fixing tiles can be temporarily disabled and re-enabled with this function
    tileFixingEnabled: function(set) {
      this._tileFixingEnabled = (!_.isUndefined(set) ? !!set : this._tileFixingEnabled);
      if (set) { this.$lines.genoline('fixTrackTiles', true); }
      return this._tileFixingEnabled; 
    },
    
    // Handle a drag event on one of the lines, propagating its motion to the other lines
    recvDrag: function($src, linePos) {
      var lineIndex = this.$lines.index($src),
        pos = linePos - lineIndex * this.bpWidth();
      var now = (new Date).getTime();
      this._pos(pos, $src);
      fps("MOVE", (new Date).getTime() - now, this.bppp);
    },
    
    // Handle a track resize event on one of the lines, propagating its changes to the other lines and fixing the layout
    recvTrackResize: function($src, name, height, callback) {
      var holdSteady = $src && this.$lines.index($src);
      this._resizeTrack(name, height, holdSteady, _.isFunction(callback) ? callback : true);
    },
    
    // Handle a track reorder action on one of the lines, propagating its changes to the other lines
    // newOrder is an array mapping oldIndex => newIndex
    recvSort: function($src, newOrder) {
      var o = this.options;
      _.each(o.tracks, function(v, i) { v._i = i; });
      o.tracks.sort(function(a, b) { return newOrder[a._i] - newOrder[b._i]; });
      _.each(o.tracks, function(v, i) { delete v._i; });
      this.$lines.not($src).genoline('fixTracks').genoline('fixTrackTiles');
    },
    
    // Handle a mousewheel event on one of the lines, propagating its changes to all lines.
    _recvZoom: function(e, manualDelta) {
      var self = this,
        o = this.options,
        d = [manualDelta, e.originalEvent.wheelDeltaY, e.originalEvent.wheelDelta, 
          e.originalEvent.axis == 2 && -e.originalEvent.detail],
        userAgent = navigator && navigator.userAgent,
        adjust = [[(/chrome/i), 0.06], [(/safari/i), 0.03], [(/opera|msie/i), 0.01]];
        
      // You can scroll the track pickers, select boxes, and textareas
      if ($(e.target).closest('.picker,select,textarea').length) { return; }
      
      self.element.find('.drag-cont').stop();                           // Stop any current inertial scrolling
      if (_.isUndefined(self._wheelDelta)) { self._wheelDelta = 0; }
      $.tipTip.hide();                                                  // Hide any tipTips showing
      d = _.reject(d, _.isUndefined).shift();
      self.centeredOn = self._posAtMouse(e.originalEvent);
      
      // mousewheeling is more performant (esp in Safari) if it all the events fire on a single element
      // which is why we throw a "shield" element in front of all the browser lines during zooms to capture the events
      // FIXME: Is this still needed? Safari has possibly fixed this?
      // self.lines().genoline('toggleZoomShield', true);                
      
      if (d && self.centeredOn !== null) {
        var value = self.$slider.slider('value'),
          delta = (o.snapZoom ? (self._wheelDelta += d) : d) / 20;
        if (userAgent && _.isUndefined(manualDelta)) { 
          _.find(adjust, function(v) { return v[0].test(userAgent) && (delta *= v[1]); }); 
        } else if (e.originalEvent.wheelDeltaY) { delta *= 0.05; }
        if (o.snapZoom) {
          if (Math.abs(delta) > 1.2) { 
            self._animateZoom(delta > 0, 1000);
            self._wheelDelta = 0;
          }
        } else { self.$slider.slider('value', value + delta); }
        self._finishZoomDebounced(delta > 0);
      }
      
      return false; // disable scrolling of the document
    },
    
    // This is fired shortly after tracks believe that all images have loaded.
    // We recalculate the density order of tracks, and fix the orange clip indicators.
    _recvTrackLoad: function(e) {
      var self = this,
        $elem = self.element,
        $trk = $(e.target),
        t = $trk.genotrack('option', 'track');
      
      // This handler is manually debounced by 100ms, separately per track.
      self._trackLoadTimers = self._trackLoadTimers || {};
      if (!_.isUndefined(self._trackLoadTimers[t.n])) { clearTimeout(self._trackLoadTimers[t.n]); }
      self._trackLoadTimers[t.n] = setTimeout(_.bind(function($trk, t) {
        // we have new image data, so *force* recalculation of the densityOrder
        self.densityOrder(t.n, t.h, $trk.genotrack('bppps'), true);
        $elem.find('.browser-track-'+t.n).genotrack('fixClipped');
      }, self, $trk, t), 100);
    },
    
    // ===============================================
    // = These functions manipulate the tank reticle =
    // ===============================================
    
    // Returns the offset of the reticle, in basepairs, from the position of the browser
    // which is designated as the basepair at the left edge of the topmost line
    _reticDelta: function(line) {
      line = _.isUndefined(line) ? this.centralLine : line;
      var bpWidth = this.bpWidth();
      return (line + 0.5) * bpWidth - this.options.sideBarWidth * 0.5 * this.bppp;
    },

    // Change the position and width of the reticle
    _updateReticle: function(centeredOn, animOpts) {
      var $elem = this.element,
        o = this.options,
        bpWidth = this.bpWidth(),
        zoom = this.bppp,
        lineIndex = _.isNumber(centeredOn) ? floorHack((centeredOn - this.pos) / bpWidth) : this.centralLine,
        nextZooms = this.sliderBppps.slice(Math.ceil(this.$slider.slider('value') + 0.001)),
        $line = this.$lines.eq(lineIndex),
        duration = animOpts && !_.isUndefined(animOpts.duration) ? animOpts.duration : 200;
      function hide($retics, d) {
        d = d || duration;
        $retics.animate({opacity: 0}, { duration: d, complete: function() { $(this).addClass('hidden'); } });
      }
      if (!nextZooms.length) { nextZooms = this.sliderBppps.slice(-1); }
      if (_.isUndefined(centeredOn)) {
        if (!_.any(this._showReticle)) { return hide($elem.find('.retic:not(.hidden)')); }
        $line.find('.retic.hidden').animate({opacity: o.reticOpacity}, {
          duration: 200, 
          complete: function() { $(this).removeClass('hidden'); }
        });
      } else {
        $line.find('.retic').css('opacity', o.reticOpacity).removeClass('hidden');
        this._updateReticleDebounced();
      }
      $line.genoline('setReticle', nextZooms, centeredOn);
      hide(this.$lines.not($line.get(0)).find('.retic:not(.hidden)'), 0);
    },
    
    // Display the reticle for one of several possible reasons (set them as true or false)
    // The reticle will be shown if any of the reasons apply
    showReticle: function(why, val) {
      this._showReticle[why] = val;
      this._updateReticle();
    },
    
    // ===================================================================================================
    // = The following functions are debounced; they update the display after a repeated event concludes =
    // ===================================================================================================
    
    // After a short delay, a zoom action can be "snapped" to the nearest optimal level
    // NOTE: This is _.debounce'd in init()
    _finishZoomDebounced: function(direction) {
      this.bounceCheck();
      if (this.options.snapZoomAfter && !this.options.snapZoom) { this._animateZoom(direction); }
      if (this.options.snapZoom) { self._wheelDelta = 0; }
      this.lines().genoline('toggleZoomShield', false);
    },
    
    // Everytime we zoom in on a line, we have to recalculate the density order of tracks,
    // and redraw the tick marks on the ruler track.
    // NOTE: This is _.debounce'd in _init()
    _fixZoomedTrackDebounced: function() {
      var self = this,
        o = this.options,
        $elem = self.element;
      _.each(o.tracks, function(t) {
        self.densityOrder(t.n, t.h, $elem.find('.browser-track-'+t.n).genotrack('bppps'));
        $elem.find('.browser-track-'+t.n).genotrack('redrawCanvasTicks');
      });
    },
    
    // Remembers the general layout & position of the browser for the next time it is opened
    // NOTE: This is _.debounce'd in _init()
    _saveParamsDebounced: function() {
      var self = this,
        pos = self.pos,
        o = self.options,
        rd = self._reticDelta(),
        chr = self.chrAt(pos + rd) || o.chrLabels[0],
        zoomFormatted = self.bppp.toPrecision(Math.max(floorHack(self.bppp).toString().length, 6)),
        state = {position: chr.n + ':' + Math.round(pos + rd - chr.p) + '@' + zoomFormatted},
        lineMode = $(o.lineMode).find(':checked').val(),
        $linkPicker = $(o.linking[1]),
        $url = $linkPicker.find('.url'),
        $ucscLink = $linkPicker.find('a[name=ucsc]'),
        url, start, end, ucscParams;
      state.tracks = _.map(o.tracks, function(t) { return t.n + ':' + t.h; }).join('|');
      state.customTracks = self._customTrackUrls.loaded;
      if (lineMode != self._defaultLineMode) { state.mode = lineMode; }
      
      // $.param({...}, true) --> don't add [] to array params
      url = '?' + decodeSafeOctets($.param(_.extend({db: o.genome}, state), true));
      // If the HTML5 history API is implemented, save the state to the URL bar after the first change
      if (window.history && window.history.replaceState && self.state) {
        var now = (new Date).getTime(),
          historyFn = now - (self._histLastReplaced || 0) > 20000 ? 'pushState' : 'replaceState';
        window.history[historyFn]({}, window.document.title, url);
        self._histLastReplaced = (new Date).getTime();
      }
      $url.val(window.location.href.replace(/\?.*$/, '') + url);
      
      // Also make a URL to the equivalent view in UCSC
      if (!o.custom || (/^ucsc:/).test(o.genome)) {
        start = Math.max(Math.round(pos - chr.p), 1);
        end = Math.min(Math.round(pos - chr.p + self.bpWidth() * self.$lines.length), o.chrLengths[chr.n]);
        ucscParams = {db: o.genome.replace(/^ucsc:|:\d+$/g, ''), position: chr.n + ':' + start + '-' + end};
        _.each(o.tracks, function(t) { 
          var densityOrderAsArray = _.map(self.densityOrder(t.n), function(v,k) { return [k,v]; }),
            topDensity = _.min(densityOrderAsArray, function(p) { return p[1]; });
          if (topDensity) { ucscParams[t.n] = topDensity[0]; }
        });
        $ucscLink.closest('.form-line').show();
        $ucscLink.attr('href', o.ucscURL + '?' + $.param(ucscParams));
      } else {
        $ucscLink.closest('.form-line').hide();
      }
      
      // Save state in localStorage, sessionStorage, and $.cookie as appropriate
      self.state = state;
      self.storage && _.each(o.savableParams, function(keys, dest) {
        _.each(keys, function(k) {
          var fullKey = (dest != 'persistent' ? o.genome + '.' : '') + k;
          if (!_.isUndefined(state[k])) { 
            self.storage[dest].setItem(fullKey, state[k]); 
          } else {
            self.storage[dest].removeItem(fullKey);
          }
        });
      });
    },
    
    // ===========================================================================================
    // = The following functions coordinate the click areas that appear when hovering over tiles =
    // ===========================================================================================
    
    // Everytime we move the browser, we have to fetch new click area data.
    // NOTE: This is _.debounce'd in _init()
    _fixClickAreasDebounced: function() {
      var self = this, 
        o = this.options,
        $elem = self.element;
      _.each(o.tracks, function(t) {
        $elem.find('.browser-track-'+t.n).genotrack('fixClickAreas');
      });
    },
    
    // Areas are stored in a global index, so that mousing over an area in one tile can retrieve
    // areas with a similar name/hrefHash that must also be highlighted.  This function receives
    // information about a current hover event and creates the appropriate highlighted anchors
    // within the correct tiles. 
    areaHover: function(keys, target) {
      var $elem = this.element;
      if (_.isUndefined(keys)) { return this._areaHover; }
      $elem.find('.area.rect').remove();
      $elem.find('.area.label.hover').removeClass('hover');
      if (!keys) { $.tipTip.hide(); return (this._areaHover = false); }
      if (keys.length != 5) { throw 'not enough levels to traverse index'; }
      var areaIndices = this._areaIndex;
      // keys is used to traverse the first 5 levels of the areaIndex, which is organized as follows:
      // areaIndex[track][bppp][density]["hrefHash"|"name"][hrefHash|name][tileId][localAreaId] = true
      for (var i = 0; i < keys.length; i++) {
        var k = keys[i];
        if (!areaIndices[k]) { areaIndices = false; break; }
        areaIndices = areaIndices[k];
      }
      if (areaIndices) {
        _.each(areaIndices, function(localAreaIds, tileId) {
          var $t = $('#'+tileId),
            $tdata = $t.children('.tdata.dens-'+keys[2]),
            $track, areas;
          if (!$t.length || !(areas = $tdata.data('areas'))) { return; }
          $track = $t.parent();
          _.each(localAreaIds, function(dummy, id) {
            var area = areas[id],
              flags = {};
            if (target === "FLASHME") { flags.flashme = true; }
            else {
              flags.hover = true;
              if (target && target == tileId + '.' + id) { flags.tipTipActivated = true; }
            }
            $track.genotrack('makeAnchor', $t, area, $tdata.data('bppp'), $tdata.data('density'), flags);
          });
        });
        if (keys[3]=='hrefHash') {
          // Also highlight any existing .area's (e.g. labels on custom tracks)
          $elem.find('.browser-track-'+keys[0]+'>.bppp-'+classFriendly(keys[1])+'>.dens-'+keys[2]+'.href-hash-'+keys[4]).addClass('hover');
        }
      } else { throw 'something went wrong while running through the areaIndex'; }
      return (this._areaHover = keys[0] + '.' + keys[3] + '.' + keys[4]);
    },
    
    // Return the area index; other widgets can access it directly
    areaIndex: function() { return this._areaIndex; },
    
    // =====================================================
    // = Miscellaneous functions that didn't fit elsewhere =
    // =====================================================
    
    // Fetches DNA from the AJAX service for a particular bp range and sends it off to the callback function
    getDNA: function(left, right, callback, extraData) {
      var self = this,
        o = self.options,
        chunkSize = o.maxNtRequest;
      if (!this._dnaCallbacks) { this._dnaCallbacks = []; }
      
      function loadedFromAjax(data, statusCode, jqXHR) {
        self._dna[jqXHR._s] = data.seq;
        checkCallbacks();
      }
      function ajaxLoadDNA() {
        var slots = emptyCacheSlots(self.pos, self.pos + self.bpWidth() * self.$lines.length);
        _.each(slots, function(s) {
          var ajaxOptions = {
            data: {db: o.genome, left: s * chunkSize + 1, right: (s + 1) * chunkSize + 1},
            dataType: 'json',
            success: loadedFromAjax,
            beforeSend: function(jqXHR) { jqXHR._s = s; }
          };
          if (o.custom) {
            ajaxOptions.type = "POST";
            ajaxOptions.data.chr_order = JSON.stringify(o.chrOrder);
            ajaxOptions.data.chr_lengths = JSON.stringify(o.chrLengths);
          }
          $.ajax(o.ajaxDir + 'dna.php', ajaxOptions);
          self._dna[s] = false;
        });
      }
      function emptyCacheSlots(left, right) {
        // convert 1-based positions to 0-based
        left = Math.max(left - 1, 1);
        right = Math.min(right - 1, o.genomeSize);
        var i = Math.floor(left / chunkSize),
          end = Math.floor(right / chunkSize),
          slots = [];
        while (i <= end) { if (_.isUndefined(self._dna[i])) { slots.push(i); } i++; }
        return slots;
      }
      function getFromCache(left, right) {
        left--; right--; // convert 1-based positions to 0-based
        var i = Math.floor(left / chunkSize),
          end = Math.floor(right / chunkSize),
          segs = [], seg, start;
        while (i <= end) {
          seg = self._dna[i];
          start = Math.max(left - i * chunkSize, 0);
          if (!seg) { return null; }
          segs.push(seg.substr(start, i==end ? (right - end * chunkSize - start) : undefined));
          i++;
        }
        return segs.join('');
      }
      function checkCallbacks() {
        self._dnaCallbacks = _.filter(self._dnaCallbacks, function(c) {
          var dna = getFromCache(c.left, c.right);
          if (dna !== null) { c.fn(dna, c.extraData); return false; }
          else { return true; }
        });
      }
      
      var dna;
      if (o.custom && o.custom.canGetSequence) {
        o.custom.getSequence(left, right, function(dna) { callback(dna, extraData); });
        return;
      } else {
        dna = getFromCache(left, right);
      }
      if (dna !== null) { callback(dna, extraData); }
      else {
        this._dnaCallbacks.push({left: left, right: right, fn: callback, extraData: extraData});
        ajaxLoadDNA();
      }
    },
    
    // Updates the text for the genome species and description in the window title and footer
    _updateGenomes: function() {
      var self = this,
        o = self.options,
        $genome = $(o.genomePicker[0]),
        $title = $genome.find('.title'),
        speciesParenthetical = o.species.match(/\((.+)\)/),
        $li = $genome.find('li.divider').eq(0).show();
      
      self._defaultTitle = self._defaultTitle || window.document.title;
      window.document.title = o.species + ' - ' + self._defaultTitle;
      $title.text(o.species.replace(/\s+\(.*$/, '')).attr('title', o.species);
      if (speciesParenthetical) { $('<em class="parenth" />').text(', ' + speciesParenthetical[1]).appendTo($title); }
      $genome.find('.description').text(o.assemblyDate + ' (' + o.genome.replace(/\|.*$/, '') + ')');
      
      // Fill the genome picker with available configured genomes
      $genome.find('.choice.genome-choice').remove();
      _.each(o.genomes, function(v, k) {
        if (/^_/.test(k) || k == o.genome) { return; }
        var $a = $('<a class="clickable"/>').attr('href', './?db='+k);
        $a.appendTo($('<li class="choice genome-choice"/>').insertBefore($li));
        $('<span class="name"/>').text(v.species).appendTo($a);
        $('<span class="long-desc"/>').text(v.assemblyDate + ' (' + k + ')').appendTo($a);
        $a.hover(function() { $(this).addClass('hover'); }, function() { $(this).removeClass('hover'); });
      });
      if ($genome.find('.choice.genome-choice').length == 0) { $li.hide(); }
    }
    
  });

});

},{"../underscore.min.js":34,"./jquery-ui.genoline.js":26,"./jquery-ui.genotrack.js":27,"./jquery.farbtastic.js":30,"./jquery.misc-plugins.js":31,"./jquery.tiptip.js":32,"./utils.js":33}],26:[function(require,module,exports){
// ===================================================================
// = Each line of the $.ui.genobrowser is managed by a $.ui.genoline =
// ===================================================================

module.exports = function($) {

$.widget('ui.genoline', {

  // Default options that can be overridden
  options: {
    disabled: false
  },

  // Called automatically when widget is instantiated
  _init: function() {
    var $elem = this.element, 
      o = this.options,
      html;
    this.pos = parseInt(o.origin, 10) || 0;
    this.$side = $('<div class="side-cont"/>').appendTo($elem);
    this.$firstLabel = $('<div class="first-label"/>').appendTo($elem);
    this.$trackCont = $('<div class="track-cont"/>').appendTo($elem);
    this.$cont = $('<div class="drag-cont"/>').appendTo(this.$trackCont);
    this.$retic = $('<div class="retic hidden"/>').appendTo($elem);
    this.$indices = $('<div class="indices"/>').appendTo($elem);
    this.$zoomshield = $('<div class="zoom-shield hidden"/>').appendTo($elem);
    this.centeredOn = null; // for the reticle
    
    html = '<div class="c nw"/><div class="c ne"/><div class="c sw"/>'
      + '<div class="c se"/><div class="v n"/><div class="v s"/><div class="inner-retic">'
      + '<div class="c nw"/><div class="c ne"/><div class="c sw"/><div class="c se"/></div>';
    $(html).appendTo(this.$retic);
    html = '<div class="start"></div><div class="end"></div>';
    $(html).appendTo(this.$indices);
    
    this._initContDraggable();
    this._initSideSortable();
    this.$trackCont.bind('dblclick', {self: this}, this._recvDoubleClick);
    $elem.addClass('shadow');
    this.fixTracks();
    this.jumpTo(this.pos);
  },
  
  _initContDraggable: function() {
    var self = this, $elem = this.element, o = this.options, 
      dragEvents = [],
      initKeyedOffset = 0,
      snappingToAnimation = {},
      fudge,
      lineJump,
      topOffsets,
      snappingTo,
      snappingToInterval;
    function snappingToMotion() {
      var dt = (new Date).getTime() - snappingToAnimation.start,
        proportion = Math.min(dt / o.lineFixDuration, 1);
      snappingTo = (1 - Math.pow(1 - proportion, 4)) * (snappingToAnimation.to - snappingToAnimation.from) + snappingToAnimation.from;
      updateLineTop();
      if (proportion == 1) { clearInterval(snappingToInterval); }
    }
    function animateSnap() {
      snappingToAnimation = {from: snappingTo, to: $elem.data('naturalTop'), start: (new Date).getTime()};
      clearInterval(snappingToInterval);
      snappingToInterval = setInterval(snappingToMotion, 13);
    }
    function updateLineTop(top) {
      if (!_.isUndefined(top)) { snappingToAnimation.top = top; }
      var snapOffset = (snappingToAnimation.top - topOffsets.top - topOffsets.click - snappingTo),
        deadZone = o.verticalDragDeadZone / 2,
        snapOffsetSquashed = Math.abs(snapOffset) > deadZone ? snapOffset + (snapOffset > 0 ? -deadZone : deadZone) : 0,
      // First apply a flat dead zone around the zero point
        curved = 40 / (1 + Math.exp(0.1 * snapOffsetSquashed)) - 20 + snapOffsetSquashed;
      // Then use a logistic function transformed to asymptotically approach a slope of 1
      if (topOffsets.length > 1) { $elem.css('top', snappingTo + curved); }
    }
    function updatePos(left, top) {
      var newJump = lineJump, 
        zoom = o.browser.genobrowser('zoom');
      if (!_.isUndefined(top)) {
        _.each(topOffsets, function(v) {
          if (newJump == lineJump && v[1] > lineJump && top < v[0] + fudge) { newJump = v[1]; }
          if (v[1] < lineJump && top > v[0] - fudge) { newJump = v[1]; }
        });
        if (newJump != lineJump) {
          o.browser.genobrowser('shiftLines', newJump - lineJump, $elem.get(0));
          animateSnap();
          self.fixTrackTiles(); 
          lineJump = newJump;
        }
      }
      self.pos = o.origin - left * zoom;
      updateLineTop(top);
      self.fixFirstLabel();
      self.fixIndices();
      o.browser.genobrowser('recvDrag', $elem, self.pos);
    };
    
    self.$cont.mousedown(function() {
      o.browser.find('.drag-cont').stop(); // Stop any current inertial scrolling immediately on mousedown
    })
    self.$cont.draggable({
      axis: 'x',
      cursor: '',
      cancel: '.nts,:input,option',
      start: function(e) { 
        var width = o.browser.genobrowser('lineWidth'),
          $lines =  o.browser.genobrowser('lines').removeClass('last-resized'),
          lineIndex = $lines.index($elem.get(0));
        $('body').addClass('dragging');
        $elem.addClass('last-resized');
        lineJump = 0;
        topOffsets = [];
        fudge = (self.lineHeight() + o.betweenLines) * 0.3;
        snappingTo = $elem.data('naturalTop');
        snappingToAnimation = {};
        topOffsets.click = e.originalEvent.pageY - $elem.offset().top;
        _.each($lines, function(v, i) {
          var top = $(v).offset().top;
          if (i == 0) { topOffsets.top = top; }
          topOffsets.push([top + topOffsets.click, lineIndex - i]); 
        });
        o.browser.genobrowser('showReticle', 'dragging', true);
        $.tipTip.hide();
      },
      drag: function(e, ui) {
        var oe = e.originalEvent, now = (new Date).getTime();
        updatePos(ui.position.left, oe.pageY);
        dragEvents.push({t: now, x: oe.pageX});
        while (dragEvents[0].t < now - 250) { dragEvents.shift(); }
      },
      stop: function(e, ui) {
        var x = e.originalEvent.pageX, 
          now = (new Date).getTime(),
          // the second to last dragEvent seems to be the most informative for velocity.
          dragEvent = dragEvents.slice(-2,-1).pop(), 
          dt = dragEvent && (now - dragEvent.t),
          vInit = dragEvent && (x - dragEvent.x) / dt,
          perfectPageY = (_.isUndefined(snappingToAnimation.to) ? $elem.data('naturalTop') : snappingToAnimation.to) 
            + topOffsets.top + topOffsets.click;
        self.fixTrackTiles();
        $('body').removeClass('dragging');
        updateLineTop(perfectPageY);
        initKeyedOffset = o.browser.genobrowser('keyedOffset');
        o.browser.genobrowser('showReticle', 'dragging', false);
        if (Math.abs(vInit) > 0.1) {
          var xInit = ui.position.left, decel = vInit > 0 ? 0.001 : -0.001, lastRefresh = 0;            
          self.$cont.css('text-indent', 1);
          self.$cont.animate({textIndent: 0}, {
            queue: false,
            duration: Math.abs(vInit / decel),
            step: function() {
              var newTime = (new Date).getTime(),
                deltaT = newTime - now,
                // allow the keyboard to shift the position *during* inertial scrolls
                keyedOffset = o.browser.genobrowser('keyedOffset'),
                deltaL = (vInit*deltaT) - (0.5*decel*deltaT*deltaT) + initKeyedOffset - keyedOffset;
                left = xInit + deltaL;
              // store the velocity on the browser element so it can catch the throw if a bounce is needed
              o.browser.data('velocity', vInit - decel * deltaT);
              // for those looong inertial scrolls, keep the tiles coming
              if (Math.abs(deltaL - lastRefresh) > 1000) { lastRefresh = deltaL; self.fixTrackTiles(); }
              self.$cont.css('left', left);
              updatePos(left);
              o.browser.genobrowser('bounceCheck');
            },
            complete: function() { 
              self.fixTrackTiles(); 
              o.browser.data('velocity', 0);
              o.browser.genobrowser('bounceCheck');
            }
          });
        } else {
          self.fixTrackTiles();
          o.browser.genobrowser('bounceCheck');
        }
      }
    });
  },
  
  _initSideSortable: function() {
    var self = this,
      o = self.options,
      $elem = self.element;
    this.$side.sortable({
      axis: 'y',
      placeholder: 'side placeholder inset-shadow',
      forcePlaceholderSize: true,
      appendTo: '#' + o.browser.attr('id'),
      handle: '.subtrack-cont',
      helper: 'clone',
      start: function() { 
        $('body').addClass('dragging');
        self.$cont.children('.browser-track').each(function(i) { $(this).data('oldIndex', i); });
      },
      stop: function() { $('body').removeClass('dragging'); },
      change: function(e, ui) {
        self.$cont.children('.browser-track').sortElements(function(a, b) {
          a = $(a).genotrack('side');
          a = self.$side.children('.side').index(a.is(ui.item) ? ui.placeholder : a);
          b = $(b).genotrack('side');
          b = self.$side.children('.side').index(b.is(ui.item) ? ui.placeholder : b);
          return a - b;
        });
        self.fixFirstLabel(true);
      },
      update: function(e, ui) {
        var newOrder = [];
        self.$cont.children('.browser-track').each(function(i) { newOrder[$(this).data('oldIndex')] = i; });
        o.browser.genobrowser('recvSort', $elem, newOrder);
      }
    });
  },
  
  fixTracks: function() {
    var $elem = this.element, 
      o = this.options,
      $t = this.$cont.children('.browser-track').first(),
      tracks = o.browser.genobrowser('tracks'),
      $u;
    if (!$t.length) { $t = this._addTrack(tracks[0], 0); }
    for (var i = 0; i < tracks.length; i++) {
      var track = tracks[i];
      if ($t.hasClass('browser-track-' + track.n)) { $t = $t.next(); }
      else { this._addTrack(track, $t); }
    }
    do { $u = $t; $t = $t.next(); $u.genotrack('side').remove(); $u.remove(); } while ($t.length);
    this.$side.sortable('refresh');
    this.fixFirstLabel(true);
  },
  
  jumpTo: function(pos, forceRepos) {
    var o = this.options,
      zoom = o.browser.genobrowser('zoom'),
      left = (o.origin - pos) / zoom;
    // Mozilla gets aggravated by CSS lengths outside of 1.0e7; Opera gets aggravated somewhere outside of 1.0e6
    if (left > 1.0e+6 || left < -1.0e+6) { o.origin = pos; left = 0; forceRepos = true; }
    this.pos = pos;
    this.$cont.css('left', left);
    this.fixTrackTiles(forceRepos);
    this.fixFirstLabel();
    this.fixIndices();
  },
  
  fixTrackTiles: function(forceRepos) {
    this.$cont.children('.browser-track').genotrack('fixTiles', forceRepos);
  },
  
  getPos: function() {
    return this.pos;
  },
  
  _addTrack: function(track, pos) {
    var $elem = this.element,
      $trk = $('<div class="browser-track"></div>');
    if (!pos || !pos.length) { $trk[pos === 0 ? 'prependTo' : 'appendTo'](this.$cont); }
    else { 
      if (_.isNumber(pos)) { pos = this.$cont.children('.browser-track').eq(pos); }
      $trk.insertBefore(pos); 
    }
    pos = this.$cont.children('.browser-track').index($trk.get(0));
    var $side = $('<div class="side"/>'), $sides = this.$side.children('.side');
    if (pos && $sides.length) { $side.insertAfter($sides.eq(pos - 1)); }
    else { $side.prependTo(this.$side); }
    return $trk.genotrack($.extend({}, this.options, {track: track, line: $elem, side: $side}));
  },
  
  _lineHeight: function() {
    var o = this.options, tracks = o.browser.genobrowser('tracks');
    return _.reduce(tracks, function(t, u) { return {h:t.h + u.h}; }).h;
  },
  
  lineHeight: function() {
    return this._lineHeight();
  },
  
  fixFirstLabel: function(noHorizMotion) {
    var self = this, $elem = self.element, o = self.options;
    if (!self.$firstLabel) { return; }
    if ($elem.get(0) != o.browser.genobrowser('lines').get(0)) { 
      self.$firstLabel.addClass('occluded');
      $elem.find('.browser-track-ruler .label').removeClass('occluded');
      return;
    }
    if (noHorizMotion === true) {
      var $ruler = $elem.find('.browser-track-ruler');
      if (!$ruler.length) { this.$firstLabel.addClass('no-ruler'); }
      else { this.$firstLabel.removeClass('no-ruler').css('top', $ruler.position().top); }
      return;
    }
    // Horizontal motion means we may have to fix the content and occlusion of the label.
    var label = o.browser.genobrowser('chrAt', self.pos), offsetLeft, width;
    $elem.find('.browser-track-ruler .label').removeClass('occluded');
    if (label===null) { self.$firstLabel.addClass('occluded'); return; } // We are behind chr1.
    self.$firstLabel.text(label.n).removeClass('occluded');
    offsetLeft = self.$firstLabel.offset().left;
    width = self.$firstLabel.width();
    $elem.find('.browser-track-ruler .label').each(function() {
      var thisLeft = $(this).offset().left, thisWidth = $(this).width();
      if (thisLeft + thisWidth > offsetLeft && thisLeft < offsetLeft + width) { 
        self.$firstLabel.addClass('occluded');
        $(this).addClass('occluded');
      }
    });
  },
  
  fixIndices: function() {
    var o = this.options,
      pos = this.pos,
      bpWidth = o.browser.genobrowser('bpWidth'),
      zoom = o.browser.genobrowser('zoom'),
      elem = this.element.get(0),
      multipleLines = o.browser.genobrowser('lines').length > 1,
      reticPos = this.centeredOn === null ? this.pos + 0.5 * (bpWidth - o.sideBarWidth * zoom) : this.centeredOn,
      chrStart, chrEnd, chrRetic;
      
    if (elem == o.browser.genobrowser('lines').get(0)) {
      chrStart = o.browser.genobrowser('chrAt', pos) || o.chrLabels[0];
      this.$indices.children('.start').text((multipleLines ? chrStart.n + ':' : '') + Math.floor(pos - chrStart.p));
    } else { this.$indices.children('.start').empty(); }
    
    if (elem == o.browser.genobrowser('lines').last().get(0)) {
      chrEnd = o.browser.genobrowser('chrAt', pos + bpWidth) || o.chrLabels[0];
      this.$indices.children('.end').text((multipleLines ? chrEnd.n + ':' : '') + Math.ceil(pos + bpWidth - chrEnd.p));
    } else { this.$indices.children('.end').empty(); }
    
    chrRetic = o.browser.genobrowser('chrAt', reticPos) || o.chrLabels[0];
    this.$retic.children('.n').text((multipleLines ? chrRetic.n + ':' : '') + Math.floor(reticPos - chrRetic.p));
  },
  
  setReticle: function(nextZooms, centeredOn) {
    var o = this.options,
      zoom = o.browser.genobrowser('zoom'),
      lineWidth = o.browser.genobrowser('lineWidth'),
      bpWidth = lineWidth * zoom,
      width1 = nextZooms[0] / zoom * lineWidth,
      $innerRetic = this.$retic.children('.inner-retic'),
      opacity = nextZooms[1] ? Math.min(2 - 2 * width1 / lineWidth, 1) : 1,
      noCenteredOn = _.isUndefined(centeredOn) || centeredOn === null,
      left = noCenteredOn ? '50%' : (centeredOn - this.pos) / zoom + o.sideBarWidth;
    this.$retic.css('width', width1).css('margin-left', -width1 * 0.5);
    this.$retic.children('.c').css('opacity', opacity);
    if (nextZooms[1]) {
      var width2 = nextZooms[1] / zoom * lineWidth;
      $innerRetic.show().css('width', width2).css('margin-left', -width2 * 0.5);
      $innerRetic.css('opacity', 1 - opacity);
    } else {
      $innerRetic.hide();
    }
    this.$retic.css('left', left);
    this.centeredOn = noCenteredOn ? null : centeredOn;
  },
  
  _recvDoubleClick: function(e) {
    var self = e.data.self,
      $browser = self.options.browser,
      zoom = $browser.genobrowser('zoom'),
      offset = $(self.$trackCont).offset(),
      offsetLeft = (e.pageX + 8) - offset.left; // compensating for the center of the cursor?
    $browser.genobrowser('zoom', !e.shiftKey, self.pos + (offsetLeft * zoom), 1000);
  },
  
  toggleZoomShield: function(show) {
    this.$zoomshield.toggleClass('hidden', !show);
  }
  
});

};
},{}],27:[function(require,module,exports){
// ====================================================================
// = Each track within a $.ui.genoline is managed by a $.ui.genotrack =
// ====================================================================

module.exports = function($) {

var utils = require('./utils.js')($),
  pad = utils.pad,
  classFriendly = utils.classFriendly,
  shortHash = utils.shortHash,
  floorHack = utils.floorHack;

$.widget('ui.genotrack', {
  
  // Default options that can be overridden
  options: {
    disabled: false,
    line: null,       // must be specified on instantiation
    side: null        // must be specified on instantiation
  },
  
  // Called automatically when widget is instantiated
  _init: function() {
    var self = this,
      $elem = this.element, 
      o = this.options,
      bppps;
    if (!o.line) { throw "Cannot instantiate ui.genotrack without specifying 'line' option"; }
    if (!o.side) { throw "Cannot instantiate ui.genotrack without specifying 'side' option"; }
    self.ruler = o.track.n == 'ruler';
    self.sliderBppps = o.bppps.concat(o.overzoomBppps);
    self.tileLoadCounter = self.areaLoadCounter = 0;
    self.custom = !!o.track.custom;
    self.birth = (new Date).getTime();
    self.$side = $(o.side).append('<div class="subtrack-cont"/>');
    $elem.addClass('browser-track-'+o.track.n).toggleClass('no-ideograms', self.ruler && !o.chrBands);
    self._nearestBppps(o.browser.genobrowser('zoom'));
    // If the track has multiple densities, or its single density has multiple fixed heights,
    // make the sidebar resizable
    self._initSideResizable();
    self._availDensities();
    self.loadingCounter = 0;
    $elem.attr('id', self.uniqId = $.uniqId('trk'));
    self.resize(o.track.h);
    self.updateDensity();
  },
  
  _initSideResizable: function() {
    var self = this,
      $elem = this.element,
      o = self.options,
      bF = self._bpppFormat(o.bppps[0]),
      firstFixedHeight = _.uniq(_.pluck(o.track.fh, _.flatten(o.track.s)[0])),
      paddingBordersY = self.$side.outerHeight() - self.$side.height(),
      minHeight = (self.custom ? o.track.custom.heights.min : Math.min(_.min(o.track.fh[bF]), 32)) - paddingBordersY,
      $linesBelow, $h;
    var opts = {
      handles: 's', 
      minHeight: minHeight,
      start: function(e, ui) {
        var bppp = self.bppps().top,
          fixedHeights = o.track.fh[self._bpppFormat(bppp)],
          customHeights = o.track.custom && o.track.custom.heights;
        $('body').addClass('row-resizing');
        if (!self.ruler && !self.custom) {
          var $imgs = $('.browser-track-'+o.track.n+'>.bppp-'+classFriendly(bppp)+' img.tdata'),
            maxHeight = Math.max.apply(Math, $imgs.map(function() { 
              return this.naturalHeight || this.height; 
            }).get());
          $(this).resizable('option', 'maxHeight', Math.max(maxHeight * 1.2, ui.originalSize.height, 18));
        }
        if (self.custom) {
          if (customHeights.max) { $(this).resizable('option', 'maxHeight', customHeights.max - paddingBordersY); }
          if (customHeights.min) { $(this).resizable('option', 'minHeight', customHeights.min - paddingBordersY); }
        }
        if (!self.ruler) {
          self.snaps = fixedHeights && _.map(fixedHeights, function(v, k) { return k=='dense' ? v : v + 1; });
          if (self.snaps) { self.snaps.always = fixedHeights && !!(fixedHeights.pack || fixedHeights.full); }
        }
        o.browser.find('.browser-line').removeClass('last-resized');
        o.line.addClass('last-resized');
        $(this).addClass('resizing-side');
        $linesBelow = o.line.nextAll().each(function() { $(this).data('origTop', $(this).position().top); });
      },
      resize: function(e, ui) {
        var height = self.$side.outerHeight(); // for some reason ui.size.height is always behind by 1 frame
        if (self.snaps && (ui.size.height < _.max(self.snaps) || self.snaps.always)) {
          height = _.min(self.snaps, function(v) { return Math.abs(v - ui.size.height); });
          self.$side.outerHeight(height);
        }
        o.line.genoline('fixFirstLabel', true);
        self._resize(height);
        $linesBelow.each(function() {
          $(this).css('top', $(this).data('origTop') + height - ui.originalSize.height);
        });
      },
      stop: function(e, ui) {
        $('body').removeClass('row-resizing');
        $(this).removeClass('resizing-side');
        $(this).css('width', '');
        o.browser.genobrowser('recvTrackResize', o.line, o.track.n, self.$side.outerHeight()); 
      }
    };
    if (self.ruler) { opts.maxHeight = o.track.oh - paddingBordersY; }
    self.$side.resizable(opts);
    $h = self.$side.find('.ui-resizable-handle');
    $h.hover(function() { $(this).addClass('hover'); }, function() { $(this).removeClass('hover'); });
  },
  
  side: function() { return this.$side; },
  
  _fixSide: function(density, bppp) {
    var self = this,
      o = self.options,
      $elem = self.element,
      n = o.track.n,
      $cont = self.$side.children('.subtrack-cont'),
      trackDesc = o.browser.genobrowser('option', 'trackDesc'), // always use the latest values from the browser
      densBpppMemo = [density, bppp].join('|'),
      $tooManyDataWarning = self.$side.children('.too-many-warning'), 
      dens, text, h;
    if ($cont.data('densBppp') === densBpppMemo) { return; }
    $cont.empty();
    if (dens = trackDesc[n] && trackDesc[n].dens && trackDesc[n].dens[density]) {
      if (dens[0][0] === 0) {
        // Labels change for certain bppp levels
        dens = (dens[_.sortedIndex(dens, [bppp], function(v) { return v[0]; }) - 1] || dens[0]).slice(1);
      }
      // Apply the appropriate subtrack labels for certain bppp levels
      _.each(dens, function(v) {
        v = _.isArray(v) ? v : [v];
        h = v[1] || 15;
        $('<div class="subtrack"/>').css({height: h, lineHeight: h+'px'}).html(v[0]).appendTo($cont);
      });
    } else {
      text = (trackDesc[n] && trackDesc[n].sm) || o.track.n;
      h = o.track.h;
      $cont.append($('<div class="subtrack unsized"/>').text(text));
    }
    $cont.data('densBppp', densBpppMemo);
  },
  
  // public resize function that updates the entire UI accordingly.
  resize: function(height, animCallback) {
    var o = this.options,
      paddingBordersY = this.$side.outerHeight() - this.$side.height();
    // can pass callback==true to animate without a callback
    if (!_.isFunction(animCallback) && animCallback) { animCallback = function() {}; }
    this._resize(height, animCallback);
    if (animCallback) { this.$side.animate({height: height - paddingBordersY}, o.lineFixDuration); }
    else { this.$side.outerHeight(height); }
  },
  
  // internal resize handler, used by the resizable side handle, does not update the side height.
  _resize: function(height, callback) {
    var o = this.options,
      $elem = this.element,
      bppps = this.bppps();
    if (this.ruler) {
      if (height < this.$side.resizable('option', 'minHeight') + 3) { $elem.addClass('ruler-collapsed'); }
      else { $elem.removeClass('ruler-collapsed'); }
    }
    o.track.h = height;
    o.browser.genobrowser('densityOrder', o.track.n, height, bppps);
    this.fixTiles();
    this.fixClipped();
    if (_.isFunction(callback)) { 
      this.element.animate({height: height}, o.lineFixDuration, callback).css('overflow', 'visible'); 
    } else { this.element.height(height); }
  },
  
  _availDensities: function(bppp) {
    var self = this,
      o = self.options;
    self.availDensities = {};
    _.each(o.bppps, function(bppp) {
      var densities = [];
      for (var i = 0; i < o.track.s.length; i++) {
        var v = o.track.s[i];
        if (!_.isArray(v)) { v = [v]; }
        if (v[1] && bppp > v[1]) { continue; }
        if (v[2] && bppp <= v[2]) { continue; }
        densities.push(v[0]);
      }
      self.availDensities[bppp] = densities;
    });
    return self.availDensities;
  },
  
  _bestDensity: function(bppp) {
    var densities = this.availDensities[bppp],
      densityOrder = this.options.browser.genobrowser('densityOrder', this.options.track.n);
    return _.min(densities, function(d) { return densityOrder[d]; })
  },
  
  updateDensity: function() {
    var self = this,
      o = self.options,
      $elem = self.element,
      topBppp = self.bppps().top;
    var bestDensity = self._bestDensity(topBppp);
    // Fix side labels (e.g. for subtracks) for the best density
    self._fixSide(bestDensity, topBppp);
    // Set the best density and trigger events on these tiles
    $elem.find('.tile-full').children('.tdata,.area.label').each(function() {
      var $this = $(this),
        isBest = $this.hasClass('dens-'+bestDensity);
      $this.toggleClass('dens-best', isBest);
      if (isBest) { $this.trigger('bestDensity'); }
    });
    // If the too-many class was set on tiles, we couldn't draw/load some custom data because there's too much of it.
    // Add a class to this track to show warnings about this to the user.
    // Finally, fix clipping indicators
    self.fixClipped();
  },
  
  _nearestBppps: function(zoom) {
    var o = this.options, 
      bppps = { nearest: [o.bppps[0]], cache: [], top: o.bppps[0] },
      possibleBppps = this.ruler ? this.sliderBppps : o.bppps,
      l = possibleBppps.length,
      found = false,
      shrinkableWindow, getNext;
    for (var i = 0; i < l; i++) {
      var zoomDiff = zoom - possibleBppps[i];
      if (zoomDiff > 0) {
        shrinkableWindow = (possibleBppps[i + 1] || possibleBppps[i] / 3);
        getNext = 0 + (zoomDiff < shrinkableWindow);
        bppps.nearest = possibleBppps.slice(Math.max(i - 2 + getNext, 0), i + getNext);
        if (getNext) { bppps.cache = [false, zoomDiff > shrinkableWindow / 2]; }
        bppps.top = bppps.cache[1] ? bppps.nearest[0] : bppps.nearest.slice(-1)[0];
        found = true; break;
      }
    }
    if (!found) {
      bppps.nearest = possibleBppps.slice(-2);
      bppps.top = possibleBppps.slice(-1)[0];
    }
    if (this.ruler && zoom <= o.ideogramsAbove) {
      bppps.nearest = bppps.nearest.slice(-1);
    }
    bppps.topFormatted = this._bpppFormat(bppps.top);
    return (this._bppps = bppps);
  },
  
  bppps: function(forceRecalc) {
    var zoom = this.options.browser.genobrowser('zoom');
    return (forceRecalc || !this._bppps) ? this._nearestBppps(zoom) : this._bppps;
  },
  
  fixTiles: function(forceRepos) {
    var self = this,
      $elem = self.element, 
      o = self.options;
    if (!o.browser.genobrowser('tileFixingEnabled')) { return; }
    var pos = o.line.genoline('getPos'),
      zoom = o.browser.genobrowser('zoom'),
      availWidth = o.browser.genobrowser('lineWidth'),
      allTilesNeeded = [],
      prevTop = this._bppps && this._bppps.top,
      bppps = this.bppps(forceRepos),
      $notNeeded;
    _.each(bppps.nearest, function(bppp, i) {
      var bpPerTile = o.tileWidth * bppp,
        tileId = floorHack((pos - availWidth * bppp * (bppps.cache[i] ? 0 : 1)) / bpPerTile) * bpPerTile + 1,
        tilesNeeded = [tileId],
        rightMargin = pos + (bppps.cache[i] ? 1 : 2) * availWidth * bppp,
        bestDensity = self._bestDensity(bppp);
      while ((tileId += bpPerTile) < rightMargin) { tilesNeeded.push(tileId); }
      _.each(tilesNeeded, function(tileId) {
        var repos = false, $t = $('#' + self._tileId(tileId, bppp));
        if (!$t.length) { 
          $t = self._addTile(tileId, bppp, bestDensity, bppps.cache[i]); 
          repos = true; 
        }
        if (!bppps.cache[i]) { self._showTile($t); }
        if (repos || forceRepos) { self._reposTile($t, tileId, zoom, bppp); }
        allTilesNeeded.push($t.get(0));
      });
    });
    $notNeeded = $elem.children('.tile').not(allTilesNeeded);
    self.tileLoadCounter -= $notNeeded.children('.loading').length;
    $notNeeded.remove();
    if (prevTop && prevTop != bppps.top) { self.updateDensity(); }
    this._fixLabels(forceRepos);
    this._fixSideClipped();
  },
  
  _setImgDims: function(e) {
    // NOTE: this is only used as bound to a tile <img>'s onLoad! See _addTile
    var self = this,
      h = this.naturalHeight || this.height;
//      if (this.naturalHeight == 1) { _.defer(function() { console.log(self.naturalHeight); }) } // FIXME: this is sometimes erroneously 1px
    $(this).css('height', h).css('width', '100%');
  },
  
  _trackLoadFire: function(e) {
    // NOTE: this is only used as bound to a tile <img>'s onLoad! See _addTile
    var self = e.data.self,
      trackH = self.options.track.h,
      $t = e.data.tile,
      h = this.naturalHeight || this.height;
    $(this).removeClass('loading');
    if (e.data.isBest && e.type != 'error') { 
      $t.addClass('tile-loaded');
      if (h > trackH) { $t.addClass('clipped'); }
      if (!e.data.cached) { self._showTile($t); }
    }
    // e.data.self.availDensities[bppp] = _.without(densities, density); // FIXME, how to knock out tracks that don't load?
    if (--self.tileLoadCounter === 0) { self.element.trigger('trackload', self.bppps()); };
  },
  
  _addTile: function(tileId, bppp, bestDensity, cached) {
    var self = this,
      o = self.options,
      $elem = self.element,
      $d = $.mk('div').attr('class', 'tile'),
      bpPerTile = o.tileWidth * bppp,
      special = self._specialTile(tileId, bppp),
      densities = self.availDensities[bppp],
      $tileBefore = $('#' + self._tileId(tileId - bpPerTile, bppp));
    if ($tileBefore.length) { $d.insertAfter($tileBefore); }
    else { $d.prependTo(self.element) };
    $d.attr('id', self._tileId(tileId, bppp)).data({zIndex: _.indexOf(self.sliderBppps, bppp), tileId: tileId});
    if ($.support.touch) { self._tileTouchEvents($d); }
    else { $d.mousemove({self: self}, self._tileMouseMove).mouseout({self: self}, self._tileMouseOut); }
    if (special) {
      if (special.blank) { $d.addClass('tile-blank').addClass('tile-off-' + (special.left ? 'l' : 'r')); }
      else if (special.custom) { self._customTile($d, tileId, bppp, bestDensity); }
      else { self._rulerTile($d, tileId, bppp); } // special.ruler === true
      return $d;
    }
    $d.addClass('tile-full bppp-'+classFriendly(bppp));
    _.each(densities, function(density) {
      var tileSrc = self._tileSrc(tileId, bppp, density), 
        fixedHeight = o.track.fh[tileSrc.bpppFormat] && o.track.fh[tileSrc.bpppFormat][density],
        $i;
      if (fixedHeight) {
        $i = $.mk('img').addClass('tdata loading dens-'+density).css('width', '100%').css('height', fixedHeight);
        $d.append($i);
      } else {
        $i = $.mk('img').addClass('tdata loading dens-'+density).bind('load', self._setImgDims);
        $d.append($i);
      }
      self.tileLoadCounter++;
      $i.bind('load error', {self: self, tile: $d, isBest: density==bestDensity, cached: cached}, self._trackLoadFire);
      $i.toggleClass('dens-best', density == bestDensity);
      if (o.track.m && _.include(o.track.m, density)) { $i.addClass('no-areas'); }
      
      $i.attr('src', o.tileDir + tileSrc.full);
    });
    return $d;
  },
  
  // Shows orange clipping indicators if any of the best density tiles have data cut off at the bottom
  fixClipped: function() {
    var $elem = this.element,
      o = this.options,
      sideClipped = false;
    $elem.find('.tile-full').each(function() {
      var $t = $(this),
        best = $t.children('.tdata.dens-best:not(.loading):not(.stretch-height)').get(0),
        h = best && (best.naturalHeight || best.height) || 0,
        clipped = h > o.track.h;
      $t.toggleClass('clipped', clipped);
    });
    this._fixSideClipped();
  },
  
  _fixSideClipped: function() {
    var bppps = this.bppps(),
      o = this.options,
      pos = o.line.genoline('getPos'),
      zoom = o.browser.genobrowser('zoom'),
      bpWidth = o.browser.genobrowser('bpWidth'),
      tileBpWidth = bppps.top * o.tileWidth,
      clipped = false;
    this.element.children('.clipped.bppp-'+classFriendly(bppps.top)).each(function() {
      var tileId = $(this).data('tileId');
      if (tileId > pos - tileBpWidth && tileId < pos + bpWidth) { clipped = true; return false; }
    });
    this.$side.toggleClass('clipped', clipped);
  },
  
  _tileTouchEvents: function($tile) {
    var self = this;
    $tile.bind('touchstart', {self: self}, function(e) {
      if (e.originalEvent.touches.length > 1) { return; }
      e.pageX = e.originalEvent.touches[0].pageX;
      e.pageY = e.originalEvent.touches[0].pageY;
      self._tileMouseMove.call(this, e);
    });
  },
  
  _tileMouseMove: function(e) {
    var $targ = $(e.target),
      $tdata = $targ.closest('.tdata'),
      self = e.data.self,
      o = self.options,
      prev = o.browser.genobrowser('areaHover'),
      areas, ratio, bppp;
    if (!$tdata.length || !$tdata.hasClass('dens-best') || !(areas = $tdata.data('areas'))) {
      if (!$targ.is('.area')) { o.browser.genobrowser('areaHover', false); }
      return; 
    }
    bppp = $tdata.data('bppp');
    ratio = bppp / o.browser.genobrowser('zoom');
    var offset = $(this).offset(),
      x = e.pageX - offset.left,
      y = e.pageY - offset.top;
    for (var i = 0; i < areas.length; i++) {
      var v = areas[i], areaId;
      if (x > v[0] * ratio && x < v[2] * ratio && y > v[1] && y < v[3]) {
        if (o.track.n + '.hrefHash.' + v.hrefHash !== prev) {
          areaId = $(this).attr('id') + '.' + i;
          o.browser.genobrowser('areaHover', [o.track.n, bppp, $tdata.data('density'), 'hrefHash', v.hrefHash], areaId);
        }
        return;
      }
    }
    if (!$targ.is('.area')) { o.browser.genobrowser('areaHover', false); }
    return;
  },
  
  _tileMouseOut: function(e) {
    var $targ = $(e.target),
      $tdata = $targ.closest('.tdata'),
      self = e.data.self,
      $relTarget = $(e.relatedTarget);
    if (!$tdata.length) { return; }
    if (!$relTarget.is('.tile') && !$relTarget.closest('.tile').length) { self.options.browser.genobrowser('areaHover', false); }
  },
  
  _areaMouseOver: function(e) {
    var d = e.data,
      o = d.self.options;
    o.browser.genobrowser('areaHover', [o.track.n, d.bppp, d.density, 'hrefHash', d.hrefHash], d.areaId);
  },
  
  fixClickAreas: function() {
    var self = this,
      o = this.options,
      $elem = self.element,
      nearest = this.bppps().nearest,
      densityOrder = o.browser.genobrowser('densityOrder', o.track.n);
    if (!o.track.m || !o.track.m.length) { return; }
    _.each(o.track.m, function(density) {
      _.each(nearest, function(bppp) {
        var densities = self.availDensities[bppp],
          bestDensity = self._bestDensity(bppp);
        if (!_.include(densities, density)) { return; }
        $elem.find('.bppp-'+classFriendly(bppp)+' .tdata.dens-'+density+'.no-areas').each(function(){
          self._addClickableAreas(this, bppp, density, bestDensity);
        }).removeClass('no-areas');
      });
    });
  },
  
  _areaTipTipEnter: function(callback) {
    var self = $(this).data('genotrack'),
      href = $(this).attr('href'),
      tiptipData = $(this).data('tiptipData'),
      oldTitle = $(this).data('title');
    if ($('body').hasClass('dragging')) { return callback(false); }
    function createTipTipHtml(data) {
      var $tipTipDiv = $('<div/>'),
        $name = $('<div class="name"/>').appendTo($tipTipDiv),
        $table = $('<table/>').appendTo($tipTipDiv),
        $tbody = $('<tbody/>').appendTo($table),
        $prevDescTr;
      _.each(data, function(v, k) {
        var $tr;
        if (/^description$|^type$|refseq summary/i.test(k)) {
          $prevDescTr = $tbody.children('.desc');
          if ($prevDescTr.length) { $tr = $('<tr class="desc"/>').insertAfter($prevDescTr); }
          else { $tr = $('<tr class="desc"/>').prependTo($tbody); }
          if (v.length > 300) { v = v.substr(0, 300).replace(/\s+\S+$/, '') + '...'; }
          $('<td colspan="2"/>').text(v).appendTo($tr);
        } else {
          $tr = $('<tr/>').appendTo($tbody);
          if (v == '---') {
            $('<td colspan="2" class="fields-header"/>').text(k).appendTo($tr);
          } else {
            $('<td class="field" width="45%"/>').text(k).appendTo($tr);
            $('<td class="value" width="55%"/>').text(v).appendTo($tr);
          }
        }
      });
      if (oldTitle) { $name.text(oldTitle); }
      callback($tipTipDiv);
    }
    if (tiptipData) {
      createTipTipHtml(tiptipData);
    } else if (/^https?:\/\//.test(href)) {
      $.ajax(self.options.ajaxDir + 'tooltip.php', {
        data: {url: href},
        dataType: 'json',
        success: createTipTipHtml
      });
    }
  },
  
  makeAnchor: function($tile, area, bppp, density, flags) {
    var bestDensity = this._bestDensity(bppp),
      o = this.options,
      custom = o.track.custom,
      defaultColor = (custom && custom.opts.color) || '0,0,0',
      tipTipOptions = {
        async: true, delay: 400,
        enter: this._areaTipTipEnter
      },
      hash = shortHash(area[5]),
      scaleToPct = 100 / o.tileWidth,
      $a = $.mk('a').addClass('area dens-'+density+' href-hash-'+hash).attr('title', area[4]);
    $a.attr('href', (custom ? '' : this.baseURL) + area[5]).attr('target', '_blank');
    $a.css({top: area[1], height: area[3] - area[1] - 2});
    if (flags.label) { 
      $a.css({right: (100 - area[0] * scaleToPct) + '%', color: 'rgb(' + (area[7] || defaultColor) + ')'}).addClass('label');
      if (area[8]) { $a.html(area[8]) } else { $a.text(area[4]); }
      $a.mouseover({self: this, bppp: bppp, density: density, hrefHash: hash, areaId: $tile.attr('id') + '.' + flags.i}, this._areaMouseOver);
    } else { 
      $a.addClass('rect').css({left: (area[0] * scaleToPct) + '%', width: ((area[2] - area[0]) * scaleToPct) + '%'});
      if (flags.flashme) {
        $a.addClass('flashing').effect("pulsate", {times: 2}, 1000, function() {
          $(this).fadeOut(300, function() { $(this).removeClass('flashing'); });
        });
      }
      if (flags.hover) { $a.addClass('hover'); }
      if (flags.tipTipActivated) { tipTipOptions.startActivated = true; }
    }
    $a.data('genotrack', this).tipTip(tipTipOptions);
    if (area[9]) { $a.data('tiptipData', area[9]); }
    return $a.data('hrefHash', hash).toggleClass('dens-best', density == bestDensity).appendTo($tile);
  },
  
  _areaDataFetch: function(e) {
    $.ajax(e.data.src + '.json', {
      dataType: 'json',
      success: e.data.success,
      beforeSend: e.data.beforeSend
    });
  },
  
  _areaDataLoad: function(data, statusText, jqXHR) {
    // NOTE: this is used as an AJAX callback, so this/self must be reobtained from the jqXHR object
    var o = jqXHR._self.options,
      $tile = $(jqXHR._appendTo),
      tileId = $tile.attr('id'),
      $tdata = $tile.children('.tdata.dens-'+jqXHR._density);
    
    function createAreas(e) {
      _.each($tdata.data('areas'), function(v, i) {
        // We have to make the label <a>'s for custom tracks
        if (jqXHR._custom && !v[6]) {
          jqXHR._self.makeAnchor($tile, v, jqXHR._bppp, jqXHR._density, {label: !jqXHR._custom.noAreaLabels, i: i}); 
        }
      });
    };
    
    // Areas are stored in a global index, so that mousing over an area in one tile can retrieve
    // areas with a similar name/hrefHash that must also be highlighted. 
    // See $.ui.genobrowser's .areaHover() for how it is traversed during mouseover.
    // Add to global area index: areaIndex[track][bppp][density]["hrefHash"|"name"][hrefHash|name][tileId][i] = true
    // FIXME: the global area index can get very big over time; as of now, it is never pruned.
    _.each(data, function(v, i) {
      var index = jqXHR._areaIndex,
        keys = [o.track.n, jqXHR._bppp, jqXHR._density],
        indexBy = {hrefHash: shortHash(v[5] || ''), name: (v[4] || '').toLowerCase()};
      v.hrefHash = indexBy.hrefHash;
      _.each(keys, function(k) {
        if (!index[k]) { index[k] = {}; }
        index = index[k];
      });
      if (!index.hrefHash) { index.hrefHash = {}; index.name = {}; }
      _.each(['hrefHash', 'name'], function(by) {
        var key = indexBy[by];
        if (!index[by][key]) { index[by][key] = {}; }
        if (!index[by][key][tileId]) { index[by][key][tileId] = {}; }
        index[by][key][tileId][i] = true;
      });
    });
    $tdata.data('areas', data).data('bppp', jqXHR._bppp).data('density', jqXHR._density).removeClass('areas-loading');
    
    if (jqXHR._custom) {
      $tdata.one('bestDensity', createAreas);
      if (jqXHR._density == jqXHR._bestDensity) { $tdata.trigger('bestDensity'); }
    }
    if (--jqXHR._self.areaLoadCounter === 0) { $(jqXHR._self.element).trigger('areaload', jqXHR._bestDensity); };
  },
  
  _addClickableAreas: function(tdataElem, bppp, density, bestDensity) {
    var self = this,
      o = self.options,
      tagName = tdataElem.tagName.toLowerCase(),
      $tdata = $(tdataElem),
      areaData, edata;
    self.areaLoadCounter++;
    $tdata.addClass('areas-loading');
    self.baseURL = self.baseURL || o.ucscURL.replace(/[^\/]+$/, '');
    function beforeSend(jqXHR) { 
      $.extend(jqXHR, {
        _appendTo: tdataElem.parentNode,
        _self: self,
        _bppp: bppp,
        _bestDensity: bestDensity,
        _density: density,
        _areaIndex: o.browser.genobrowser('areaIndex')
      });
    }
    
    if (tagName == 'img') {
      // TODO: make this abortable, for when fixTiles(forceRepos=true) is called before it finishes!
      edata = {src: tdataElem.src, success: self._areaDataLoad, beforeSend: beforeSend};
      if (density==bestDensity) { self._areaDataFetch({data: edata}); }
      else { $tdata.one('bestDensity', edata, self._areaDataFetch); }
    } else if (tagName == 'canvas' && o.track.custom.areas && (areaData = o.track.custom.areas[tdataElem.id])) {
      // For <canvas> tiles on custom tracks, we should already have this info in o.track.custom.areas
      mockJqXHR = {_custom: o.track.custom};
      beforeSend(mockJqXHR);
      self._areaDataLoad(areaData, '', mockJqXHR);
    } else { 
      self.areaLoadCounter--;
      $(tdataElem).removeClass('areas-loading');
    }
  },
  
  _showTile: function($t) {
    $t.addClass('tile-show').css('z-index', $t.data('zIndex'));
  },
  
  _reposTile: function($tile, tileId, zoom, bppp) {
    var o = this.options;
    $tile.css('left', (tileId - o.line.genoline('option', 'origin')) / zoom);
    $tile.css('width', Math.ceil(o.tileWidth * bppp / zoom));
    
    if (this.ruler && bppp <= o.ntsBelow[0]) {
      $tile.find('svg').each(function() {
        var width = $tile.width() + 'px';
        this.setAttributeNS(null, "width", width);
        this.firstChild.setAttributeNS(null, "y", "11");
      });
    }
  },
  
  _specialTile: function(tileId, bppp) {
    var o = this.options;
    if (tileId < 0 || tileId > o.genomeSize) { return {blank: true, left: tileId < 0}; }
    if (o.track.custom) { return {custom: true}; }
    if (this.ruler && (bppp <= o.ideogramsAbove || !o.chrBands)) { return {ruler: true}; }
  },
  
  _tileSrc: function(tileId, bppp, density) {
    var o = this.options,
      bF = this._bpppFormat(bppp),
      imgName = pad(tileId, 10) + '.png';
    if (bppp < o.subdirForBpppsUnder) { imgName = imgName.substr(0, 4) + '/' + imgName.substr(4); }
    var ret = {
      full: this.ruler ? 'ideograms/'+bF+'/'+imgName : o.track.n+'/'+bF+'_'+density+'/'+imgName,
      bpppFormat: bF
    };
    return ret;
  },
  
  _bpppFormat: function(bppp) { return this.options.bpppFormat(bppp); },
  
  _tileId: function(tileId, bppp) { 
    return this.uniqId + '-tile-' + bppp.toString().replace('.', '-') + '-' + tileId;
  },
  
  _fixLabels: function(forceRepos) {
    if (!this.ruler) { return; }
    var self = this,
      o = self.options,
      $elem = self.element,
      availWidth = o.browser.genobrowser('lineWidth'),
      pos = o.line.genoline('getPos'),
      zoom = o.browser.genobrowser('zoom'),
      leftMarg = pos - availWidth * zoom * 0.5,
      rightMarg = pos + 1.5 * availWidth * zoom,
      bppps = this.bppps(),
      labelsNeeded = _.filter(o.chrLabels, function(v) { return v.p > leftMarg && v.p < rightMarg; }),
      labelElements = [];
    _.each(labelsNeeded, function(v) {
      var repos = false, $l = $elem.children('.label-' + v.p);
      if (!$l.length) { $l = self._addLabel(v, zoom); repos = true; }
      if (repos || forceRepos) { self._reposLabel($l, v, zoom); }
      labelElements.push($l.get(0));
    });
    $elem.children('.label').not(labelElements).remove();
    
    if (o.chrBands && zoom <= o.ideogramsAbove) {
      var firstBandIndex = _.sortedIndex(o.chrBands, [0, 0, leftMarg], function(v) { return v[2]; }),
        lastBandIndex = _.sortedIndex(o.chrBands, [0, rightMarg], function(v) { return v[1]; }),
        bandsNeeded = o.chrBands.slice(firstBandIndex, lastBandIndex),
        bandElements = [];
      _.each(bandsNeeded, function(v) {
        var repos = false, $b = $('#' + self._tileId(v[1], 'band'));
        if (!$b.length) { $b = self._addBand(v, zoom); repos = true; }
        if (repos || forceRepos) { self._reposBand($b, v, zoom); }
        bandElements.push($b.get(0));
      });
      $elem.children('.band').not(bandElements).remove();
    } else {
      $elem.children('.band').remove();
    }
  },
  
  _rulerTile: function($t, tileId, bppp) {
    var self = this,
      o = self.options,
      bpPerTile = bppp * o.tileWidth,
      zoom = o.browser.genobrowser('zoom');
    $t.addClass('tile-ruler bppp-'+classFriendly(bppp)).data('bppp', bppp);
    
    self._drawCanvasTicks($t, tileId, bppp, zoom);
    
    if (bppp <= o.ntsBelow[0]) {
      var showNtText = bppp <= o.ntsBelow[1],
        canvasHeight = (showNtText ? 12 : 3) + (o.chrBands ? 1 : 0), // with bands, we need an extra pixel
        canvasAttrs = {width: o.tileWidth, height: canvasHeight, "class": "ntdata"};
      $t.addClass('tile-ntdata tile-loaded');
      $t.toggleClass(o.chrBands ? 'tile-overlay-ntdata' : 'tile-big-ntdata', showNtText);
      if (o.chrBands && showNtText) { $t.data('zIndex', 101); } // if we have bands, draw it on top of the bands.
      o.browser.genobrowser('getDNA', tileId, tileId + bpPerTile, self._ntSequenceLoad, {
        _c: $.mk('canvas').attr(canvasAttrs).css('height', canvasHeight).appendTo($t),
        _d: showNtText && $.mk('div').addClass('nts').appendTo($t),
        _w: Math.ceil(o.tileWidth * bppp / zoom),
        _self: self
      });
    }
  },
  
  _drawCanvasTicks: function($t, tileId, bppp, zoom) {
    var self = this,
      o = self.options,
      chr = o.browser.genobrowser('chrAt', tileId),
      bpPerTile = bppp * o.tileWidth,
      scale = Math.round(Math.log(bpPerTile / 10)/Math.log(10)*2),
      tooLong = tileId.toString().length > 8 && scale < 6,
      step = scale % 2 ? (tooLong ? 5 : 2) * Math.pow(10, floorHack(scale/2)) : Math.pow(10, scale/2),
      majorStep = scale % 2 ? (tooLong ? [step * 2, step * 2] : [step * 5, step * 5]) : [step * 5, step * 10],
      start = floorHack((tileId - chr.p) / step) * step + step,
      newChr;
    
    if (bppp <= o.bpppNumbersBelow[0]) {
      $t.toggleClass('tile-halfway', bppp == o.bpppNumbersBelow[0]);
      $t.toggleClass('tile-loaded', bppp <= o.bpppNumbersBelow[1]);
      if (o.useCanvasTicks) {
        // This may alleviate some of the excessive element creation that occurs with the HTML method
        start -= step;
        var offsetForNtText = !o.chrBands && bppp <= o.ntsBelow[1],
          canvasHeight = o.chrBands ? 23 : (offsetForNtText ? 12 : 23),
          canvasWidth = bppp / zoom * o.tileWidth,
          $oldC = $t.children('canvas.ticks'),
          canvasAttrs = {width: canvasWidth, height: canvasHeight, "class": "ticks" + ($oldC.length ? ' hidden' : '')},
          $c = $.mk('canvas').css('height', canvasHeight).prependTo($t),
          ctx = $c.get(0).getContext && $c.get(0).getContext('2d'),
          textY = o.chrBands ? 16 : (offsetForNtText ? 10 : 16),
          defaultFont = "11px 'Lucida Grande',Tahoma,Arial,Liberation Sans,FreeSans,sans-serif";
        if ($.browser.opera) { defaultFont = "12px Arial,sans-serif"; } // Opera can only render Arial decently on canvas
        if (!ctx) { return; }
        $c.attr(canvasAttrs);
        ctx.font = defaultFont;
        for (var t = start; t + chr.p < tileId + bppp * o.tileWidth + step; t += step) {
          if (t > o.chrLengths[chr.n]) {
            newChr = o.browser.genobrowser('chrAt', chr.p + t);
            if (chr === newChr) { break; } // off the end of the last chromosome
            t = 0;
            chr = newChr;
            continue; // the label for 0 is never shown
          }
          var unit = _.find([[1000000, 'm'], [1000, 'k'], [1, '']], function(v) { return v[0] <= step; }),
            major = floorHack(t / majorStep[1]),
            minor = (t / unit[0]).toString().substr(major > 0 ? major.toString().length : 0),
            isMajor = !(t % majorStep[0]),
            x = ((t + chr.p - tileId + 0.5) / bpPerTile * canvasWidth);
          if (isMajor) {
            ctx.font = "bold " + defaultFont;
            if (major) {
              ctx.textAlign = 'end';
              ctx.fillText(major, x - 1, textY);
            }
            ctx.textAlign = 'start';
            ctx.fillRect(x, offsetForNtText ? 1 : 3, 1, 19); 
          } else {
            ctx.fillStyle = '#666666';
            ctx.fillRect(x, offsetForNtText ? 1 : 7, 1, 14);
            ctx.fillStyle = '#000000';
          }
          ctx.fillText(minor + (isMajor ? unit[1] : ''), x + 2, textY);
          if (isMajor) { ctx.font = defaultFont; }
        }
        if ($oldC.length) { 
          $oldC.addClass('hidden');
          $c.removeClass('hidden');
          setTimeout(function() { $oldC.remove(); }, 1000);
        }
      } else {
        function ghostify(text) {
          text = text.toString();
          return text;
        }
        
        for (var t = start; t + chr.p < tileId + bppp * o.tileWidth; t += step) {
          if (t > o.chrLengths[chr.n]) {
            newChr = o.browser.genobrowser('chrAt', chr.p + t);
            if (chr === newChr) { break; } // off the end of the last chromosome
            t = 0;
            chr = newChr;
            continue; // the label for 0 is never shown
          }
          var unit = _.find([[1000000, 'm'], [1000, 'k'], [1, '']], function(v) { return v[0] <= step; }),
            major = floorHack(t / majorStep[1]),
            minor = (t / unit[0]).toString().substr(major > 0 ? major.toString().length : 0),
            isMajor = !(t % majorStep[0]),
            tickHTML = '<div class="tick' + (isMajor ? ' major">' + ghostify(major ? major : '') : '">') + 
              '<span class="minor">' + ghostify(minor + (isMajor ? unit[1] : '')) + '</span></div>',
            $tick = $(tickHTML).appendTo($t);
          $tick.css('right', ((1 - (t + chr.p - tileId + 0.5) / bpPerTile) * 100)+'%'); // The 0.5 centers it over the base.
        }
      }
    }
  },
  
  redrawCanvasTicks: function() {
    var self = this,
      $elem = self.element, 
      o = self.options,
      zoom = o.browser.genobrowser('zoom');
    $elem.children('.tile-ruler').each(function() {
      var $t = $(this);
      self._drawCanvasTicks($t, $t.data('tileId'), $t.data('bppp'), zoom);
    });
  },
  
  _ntSequenceLoad: function(dna, extraData) {
    if (!dna) { return; }
    var o = extraData._self.options,
      $d = extraData._d,
      l = dna.length,
      ppbp = o.tileWidth / l, // pixels per bp
      colors = {a:'255,0,0', t:'255,0,255', c:'0,0,255', g:'0,180,0'},
      canvas, height, ctx, nt;
    if ($d) {
      var $svg = $.mk("http://www.w3.org/2000/svg", "svg").attr({
        version: "1.2",
        baseProfile: "tiny",
        height: '14px',
        width: ($d.closest('.tile').width() || extraData._w) + 'px'
      });
      $d.append($svg);
      $.mk("http://www.w3.org/2000/svg", "text").attr({
        x: _.map(_.range(l), function(x) { return x / l * 100; }).join('% ') + '%',
        y: 11,
        fill: '#FFFFFF'
      }).text(dna).appendTo($svg);
    }
    canvas = extraData._c && extraData._c.get(0);
    height = canvas.height;
    ctx = canvas.getContext && canvas.getContext('2d');
    if (!ctx) { return; }
    for (var i = 0; i < l; i++) {
      nt = dna.substr(i, 1);
      if (nt == '-') { continue; }
      ctx.fillStyle = "rgb(" + colors[nt.toLowerCase()] + ")";
      ctx.fillRect(i * ppbp, 0, ppbp, height);
    }
  },
  
  _addLabel: function(label, zoom) {
    var o = this.options,
      $l = $.mk('div').addClass('label label-'+label.p),
      $lt = $.mk('div').addClass('label-text').prependTo($l).text(label.n.replace(/^chr/,''));
    if (label.n.indexOf('chr') === 0) { $lt.prepend('<span class="chr">chr</span>'); }
    $l.prepend('<span class="start-line"></span>');
    if (label.end === true) { $l.addClass('label-end'); }
    //$l.css('z-index', 200 + label.i);
    return $l.appendTo(this.element);
  },
  
  _reposLabel: function($l, label, zoom) {  
    // constrain width of label so it doesn't run over into the next one
    // max-width doesn't include padding (5px)
    if (label.end !== true) { $l.children('.label-text').css('max-width', Math.max(label.w / zoom - 5, 0)); }
    // `+ 1` --> convert 0-based positioning
    // `- 1` --> label is offset 1px to left to compensate for the 2px width of the red indicator line
    $l.css('left', (label.p + 1 - this.options.line.genoline('option', 'origin')) / zoom - 1);
  },
  
  _addBand: function(band, zoom) {
    var o = this.options,
      $b = $('<div class="band band-'+band[4]+' band-'+band[3].substr(0,1)+'"/>');
    $b.attr('id', this._tileId(band[1], 'band'));
    if (band[5] === 0) { $b.prepend('<div class="chr-start"/>'); }
    $b.append($('<div class="band-name"/>').text(band[0].substr(3) + band[3]));
    return $b.appendTo(this.element);
  },
  
  _reposBand: function($b, band, zoom) { 
    var o = this.options, 
      prop = band[4] == 'acen' ? (/^p/.test(band[3]) ? 'border-left-width' : 'border-right-width'): 'width';
    $b.css('left', (band[1] - o.line.genoline('option', 'origin')) / zoom);
    $b.css(prop, (band[2] - band[1]) / zoom + 1); 
  },
  
  _customTileRender: function(e, callback) {
    var canvas = this,
      $canvas = $(this),
      d = e.data,
      browser = d.self.options.browser;
    function pushCallback() { _.isFunction(callback) && $canvas.data('renderingCallbacks').push(callback); }
    if ($canvas.data('rendering') === true) { pushCallback(); return; }
    $canvas.data('rendering', true);
    $canvas.data('renderingCallbacks', []);
    pushCallback();
    d.custom.render(canvas, d.start, d.end, d.density, function() {
      $canvas.css('width', '100%').css('height', d.custom.stretchHeight ? '100%' : canvas.height);
      $canvas.toggleClass('stretch-height', d.custom.stretchHeight);
      $canvas.removeClass('unrendered').addClass('no-areas');
      d.self.fixClickAreas();
      // If the too-many class was set, we couldn't draw/load the data at this density because there's too much of it
      // If this is at "squish" density, we also add the class to parent <div> to tell the user that she needs to zoom
      if ($canvas.hasClass('too-many')) { $canvas.parent().addClass('too-many'); }
      if ($canvas.hasClass('too-many') && d.density == 'dense') { $canvas.parent().addClass('too-many-for-dense'); }
      _.each($canvas.data('renderingCallbacks'), function(f) { f(); });
      $canvas.data('rendering', false);
    });
    if (d.custom.expectsSequence && (d.end - d.start) < browser.genobrowser('option', 'maxNtRequest')) {
      browser.genobrowser('getDNA', d.start, d.end, function(sequence) {
        d.custom.renderSequence(canvas, d.start, d.end, d.density, sequence, function() {
          // TODO: may need to d.self.fixClickAreas() again if .renderSequence added areas?
        });
      });
    }
  },
  
  _customTile: function($t, tileId, bppp, bestDensity) {
    var self = this,
      o = self.options,
      bpPerTile = bppp * o.tileWidth,
      end = tileId + bpPerTile;
    $t.addClass('tile-custom tile-full tile-loaded bppp-'+classFriendly(bppp));
    _.each(o.track.s, function(density) {
      var canvasHTML = '<canvas width="'+o.tileWidth+'" height="'+o.track.h+'" class="tdata unrendered dens-'+density+'" '
          + 'id="canvas-'+self._tileId(tileId, bppp)+'-'+density+'"></canvas>',
        $c = $(canvasHTML).appendTo($t);
      $c.bind('render', {start: tileId, end: end, density: density, self: self, custom: o.track.custom}, self._customTileRender);
      $c.bind('erase', function() { o.track.custom.erase($c.get(0)); $c.addClass('unrendered'); });
      if (density==bestDensity) { $c.addClass('dens-best').trigger('render'); }
    });
  }
  
});

};
},{"./utils.js":33}],28:[function(require,module,exports){
/*!
 * jQuery UI 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
module.exports = function(jQuery) {
(function(a,d){function c(h,g){var i=h.nodeName.toLowerCase();if("area"===i){g=h.parentNode;i=g.name;if(!h.href||!i||g.nodeName.toLowerCase()!=="map")return false;h=a("img[usemap=#"+i+"]")[0];return!!h&&e(h)}return(/input|select|textarea|button|object/.test(i)?!h.disabled:"a"==i?h.href||g:g)&&e(h)}function e(h){return!a(h).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}a.ui=a.ui||{};if(!a.ui.version){a.extend(a.ui,{version:"1.8.16",
keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(h,g){return typeof h==="number"?this.each(function(){var i=
this;setTimeout(function(){a(i).focus();g&&g.call(i)},h)}):this._focus.apply(this,arguments)},scrollParent:function(){var h;h=a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,
"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!h.length?a(document):h},zIndex:function(h){if(h!==d)return this.css("zIndex",h);if(this.length){h=a(this[0]);for(var g;h.length&&h[0]!==document;){g=h.css("position");if(g==="absolute"||g==="relative"||g==="fixed"){g=parseInt(h.css("zIndex"),10);if(!isNaN(g)&&g!==0)return g}h=h.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":
"mousedown")+".ui-disableSelection",function(h){h.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});a.each(["Width","Height"],function(h,g){function i(l,o,n,k){a.each(b,function(){o-=parseFloat(a.curCSS(l,"padding"+this,true))||0;if(n)o-=parseFloat(a.curCSS(l,"border"+this+"Width",true))||0;if(k)o-=parseFloat(a.curCSS(l,"margin"+this,true))||0});return o}var b=g==="Width"?["Left","Right"]:["Top","Bottom"],f=g.toLowerCase(),j={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,
outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+g]=function(l){if(l===d)return j["inner"+g].call(this);return this.each(function(){a(this).css(f,i(this,l)+"px")})};a.fn["outer"+g]=function(l,o){if(typeof l!=="number")return j["outer"+g].call(this,l);return this.each(function(){a(this).css(f,i(this,l,true,o)+"px")})}});a.extend(a.expr[":"],{data:function(h,g,i){return!!a.data(h,i[3])},focusable:function(h){return c(h,!isNaN(a.attr(h,"tabindex")))},tabbable:function(h){var g=a.attr(h,
"tabindex"),i=isNaN(g);return(i||g>=0)&&c(h,!i)}});a(function(){var h=document.body,g=h.appendChild(g=document.createElement("div"));a.extend(g.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});a.support.minHeight=g.offsetHeight===100;a.support.selectstart="onselectstart"in g;h.removeChild(g).style.display="none"});a.extend(a.ui,{plugin:{add:function(h,g,i){h=a.ui[h].prototype;for(var b in i){h.plugins[b]=h.plugins[b]||[];h.plugins[b].push([g,i[b]])}},call:function(h,g,i){if((g=h.plugins[g])&&
h.element[0].parentNode)for(var b=0;b<g.length;b++)h.options[g[b][0]]&&g[b][1].apply(h.element,i)}},contains:function(h,g){return document.compareDocumentPosition?h.compareDocumentPosition(g)&16:h!==g&&h.contains(g)},hasScroll:function(h,g){if(a(h).css("overflow")==="hidden")return false;g=g&&g==="left"?"scrollLeft":"scrollTop";var i=false;if(h[g]>0)return true;h[g]=1;i=h[g]>0;h[g]=0;return i},isOverAxis:function(h,g,i){return h>g&&h<g+i},isOver:function(h,g,i,b,f,j){return a.ui.isOverAxis(h,i,f)&&
a.ui.isOverAxis(g,b,j)}})}})(jQuery);
(function(a,d){if(a.cleanData){var c=a.cleanData;a.cleanData=function(h){for(var g=0,i;(i=h[g])!=null;g++)try{a(i).triggerHandler("remove")}catch(b){}c(h)}}else{var e=a.fn.remove;a.fn.remove=function(h,g){return this.each(function(){if(!g)if(!h||a.filter(h,[this]).length)a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(i){}});return e.call(a(this),h,g)})}}a.widget=function(h,g,i){var b=h.split(".")[0],f;h=h.split(".")[1];f=b+"-"+h;if(!i){i=g;g=a.Widget}a.expr[":"][f]=
function(j){return!!a.data(j,h)};a[b]=a[b]||{};a[b][h]=function(j,l){arguments.length&&this._createWidget(j,l)};g=new g;g.options=a.extend(true,{},g.options);a[b][h].prototype=a.extend(true,g,{namespace:b,widgetName:h,widgetEventPrefix:a[b][h].prototype.widgetEventPrefix||h,widgetBaseClass:f},i);a.widget.bridge(h,a[b][h])};a.widget.bridge=function(h,g){a.fn[h]=function(i){var b=typeof i==="string",f=Array.prototype.slice.call(arguments,1),j=this;i=!b&&f.length?a.extend.apply(null,[true,i].concat(f)):
i;if(b&&i.charAt(0)==="_")return j;b?this.each(function(){var l=a.data(this,h),o=l&&a.isFunction(l[i])?l[i].apply(l,f):l;if(o!==l&&o!==d){j=o;return false}}):this.each(function(){var l=a.data(this,h);l?l.option(i||{})._init():a.data(this,h,new g(i,this))});return j}};a.Widget=function(h,g){arguments.length&&this._createWidget(h,g)};a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(h,g){a.data(g,this.widgetName,this);this.element=a(g);this.options=
a.extend(true,{},this.options,this._getCreateOptions(),h);var i=this;this.element.bind("remove."+this.widgetName,function(){i.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+
"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(h,g){var i=h;if(arguments.length===0)return a.extend({},this.options);if(typeof h==="string"){if(g===d)return this.options[h];i={};i[h]=g}this._setOptions(i);return this},_setOptions:function(h){var g=this;a.each(h,function(i,b){g._setOption(i,b)});return this},_setOption:function(h,g){this.options[h]=g;if(h==="disabled")this.widget()[g?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",
g);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(h,g,i){var b=this.options[h];g=a.Event(g);g.type=(h===this.widgetEventPrefix?h:this.widgetEventPrefix+h).toLowerCase();i=i||{};if(g.originalEvent){h=a.event.props.length;for(var f;h;){f=a.event.props[--h];g[f]=g.originalEvent[f]}}this.element.trigger(g,i);return!(a.isFunction(b)&&b.call(this.element[0],g,i)===false||g.isDefaultPrevented())}}})(jQuery);
(function(a){var d=false;a(document).mouseup(function(){d=false});a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var c=this;this.element.bind("mousedown."+this.widgetName,function(e){return c._mouseDown(e)}).bind("click."+this.widgetName,function(e){if(true===a.data(e.target,c.widgetName+".preventClickEvent")){a.removeData(e.target,c.widgetName+".preventClickEvent");e.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+
this.widgetName)},_mouseDown:function(c){if(!d){this._mouseStarted&&this._mouseUp(c);this._mouseDownEvent=c;var e=this,h=c.which==1,g=typeof this.options.cancel=="string"&&c.target.nodeName?a(c.target).closest(this.options.cancel).length:false;if(!h||g||!this._mouseCapture(c))return true;this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet)this._mouseDelayTimer=setTimeout(function(){e.mouseDelayMet=true},this.options.delay);if(this._mouseDistanceMet(c)&&this._mouseDelayMet(c)){this._mouseStarted=
this._mouseStart(c)!==false;if(!this._mouseStarted){c.preventDefault();return true}}true===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(i){return e._mouseMove(i)};this._mouseUpDelegate=function(i){return e._mouseUp(i)};a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);c.preventDefault();return d=true}},_mouseMove:function(c){if(a.browser.msie&&
!(document.documentMode>=9)&&!c.button)return this._mouseUp(c);if(this._mouseStarted){this._mouseDrag(c);return c.preventDefault()}if(this._mouseDistanceMet(c)&&this._mouseDelayMet(c))(this._mouseStarted=this._mouseStart(this._mouseDownEvent,c)!==false)?this._mouseDrag(c):this._mouseUp(c);return!this._mouseStarted},_mouseUp:function(c){a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=
false;c.target==this._mouseDownEvent.target&&a.data(c.target,this.widgetName+".preventClickEvent",true);this._mouseStop(c)}return false},_mouseDistanceMet:function(c){return Math.max(Math.abs(this._mouseDownEvent.pageX-c.pageX),Math.abs(this._mouseDownEvent.pageY-c.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);
(function(a){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper==
"original"&&!/^(?:r|a|f)/.test(this.element.css("position")))this.element[0].style.position="relative";this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},destroy:function(){if(this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this}},_mouseCapture:function(d){var c=
this.options;if(this.helper||c.disabled||a(d.target).is(".ui-resizable-handle"))return false;this.handle=this._getHandle(d);if(!this.handle)return false;if(c.iframeFix)a(c.iframeFix===true?"iframe":c.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(a(this).offset()).appendTo("body")});return true},_mouseStart:function(d){var c=this.options;
this.helper=this._createHelper(d);this._cacheHelperProportions();if(a.ui.ddmanager)a.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:d.pageX-this.offset.left,top:d.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});
this.originalPosition=this.position=this._generatePosition(d);this.originalPageX=d.pageX;this.originalPageY=d.pageY;c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt);c.containment&&this._setContainment();if(this._trigger("start",d)===false){this._clear();return false}this._cacheHelperProportions();a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,d);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(d,true);a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,d);return true},
_mouseDrag:function(d,c){this.position=this._generatePosition(d);this.positionAbs=this._convertPositionTo("absolute");if(!c){c=this._uiHash();if(this._trigger("drag",d,c)===false){this._mouseUp({});return false}this.position=c.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";a.ui.ddmanager&&a.ui.ddmanager.drag(this,d);return false},_mouseStop:function(d){var c=
false;if(a.ui.ddmanager&&!this.options.dropBehaviour)c=a.ui.ddmanager.drop(this,d);if(this.dropped){c=this.dropped;this.dropped=false}if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")return false;if(this.options.revert=="invalid"&&!c||this.options.revert=="valid"&&c||this.options.revert===true||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,c)){var e=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,
10),function(){e._trigger("stop",d)!==false&&e._clear()})}else this._trigger("stop",d)!==false&&this._clear();return false},_mouseUp:function(d){this.options.iframeFix===true&&a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,d);return a.ui.mouse.prototype._mouseUp.call(this,d)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(d){var c=!this.options.handle||
!a(this.options.handle,this.element).length?true:false;a(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==d.target)c=true});return c},_createHelper:function(d){var c=this.options;d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[d])):c.helper=="clone"?this.element.clone().removeAttr("id"):this.element;d.parents("body").length||d.appendTo(c.appendTo=="parent"?this.element[0].parentNode:c.appendTo);d[0]!=this.element[0]&&!/(fixed|absolute)/.test(d.css("position"))&&
d.css("position","absolute");return d},_adjustOffsetFromHelper:function(d){if(typeof d=="string")d=d.split(" ");if(a.isArray(d))d={left:+d[0],top:+d[1]||0};if("left"in d)this.offset.click.left=d.left+this.margins.left;if("right"in d)this.offset.click.left=this.helperProportions.width-d.right+this.margins.left;if("top"in d)this.offset.click.top=d.top+this.margins.top;if("bottom"in d)this.offset.click.top=this.helperProportions.height-d.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=
this.helper.offsetParent();var d=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])){d.left+=this.scrollParent.scrollLeft();d.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)d={top:0,left:0};return{top:d.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:d.left+(parseInt(this.offsetParent.css("borderLeftWidth"),
10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var d=this.element.position();return{top:d.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:d.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),
10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var d=this.options;if(d.containment=="parent")d.containment=this.helper[0].parentNode;if(d.containment=="document"||d.containment=="window")this.containment=[d.containment=="document"?0:a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,d.containment=="document"?0:a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,
(d.containment=="document"?0:a(window).scrollLeft())+a(d.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(d.containment=="document"?0:a(window).scrollTop())+(a(d.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(d.containment)&&d.containment.constructor!=Array){d=a(d.containment);var c=d[0];if(c){d.offset();var e=a(c).css("overflow")!=
"hidden";this.containment=[(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0),(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0),(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),
10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=d}}else if(d.containment.constructor==Array)this.containment=d.containment},_convertPositionTo:function(d,c){if(!c)c=this.position;d=d=="absolute"?1:-1;var e=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(e[0].tagName);return{top:c.top+
this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:e.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:e.scrollLeft())*d)}},_generatePosition:function(d){var c=this.options,e=this.cssPosition=="absolute"&&
!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(e[0].tagName),g=d.pageX,i=d.pageY;if(this.originalPosition){var b;if(this.containment){if(this.relative_container){b=this.relative_container.offset();b=[this.containment[0]+b.left,this.containment[1]+b.top,this.containment[2]+b.left,this.containment[3]+b.top]}else b=this.containment;if(d.pageX-this.offset.click.left<b[0])g=b[0]+this.offset.click.left;
if(d.pageY-this.offset.click.top<b[1])i=b[1]+this.offset.click.top;if(d.pageX-this.offset.click.left>b[2])g=b[2]+this.offset.click.left;if(d.pageY-this.offset.click.top>b[3])i=b[3]+this.offset.click.top}if(c.grid){i=c.grid[1]?this.originalPageY+Math.round((i-this.originalPageY)/c.grid[1])*c.grid[1]:this.originalPageY;i=b?!(i-this.offset.click.top<b[1]||i-this.offset.click.top>b[3])?i:!(i-this.offset.click.top<b[1])?i-c.grid[1]:i+c.grid[1]:i;g=c.grid[0]?this.originalPageX+Math.round((g-this.originalPageX)/
c.grid[0])*c.grid[0]:this.originalPageX;g=b?!(g-this.offset.click.left<b[0]||g-this.offset.click.left>b[2])?g:!(g-this.offset.click.left<b[0])?g-c.grid[0]:g+c.grid[0]:g}}return{top:i-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:e.scrollTop()),left:g-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<
526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:e.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=false},_trigger:function(d,c,e){e=e||this._uiHash();a.ui.plugin.call(this,d,[c,e]);if(d=="drag")this.positionAbs=this._convertPositionTo("absolute");return a.Widget.prototype._trigger.call(this,d,c,
e)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});a.extend(a.ui.draggable,{version:"1.8.16"});a.ui.plugin.add("draggable","connectToSortable",{start:function(d,c){var e=a(this).data("draggable"),h=e.options,g=a.extend({},c,{item:e.element});e.sortables=[];a(h.connectToSortable).each(function(){var i=a.data(this,"sortable");if(i&&!i.options.disabled){e.sortables.push({instance:i,shouldRevert:i.options.revert});
i.refreshPositions();i._trigger("activate",d,g)}})},stop:function(d,c){var e=a(this).data("draggable"),h=a.extend({},c,{item:e.element});a.each(e.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;e.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(d);this.instance.options.helper=this.instance.options._helper;e.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=
false;this.instance._trigger("deactivate",d,h)}})},drag:function(d,c){var e=a(this).data("draggable"),h=this;a.each(e.sortables,function(){this.instance.positionAbs=e.positionAbs;this.instance.helperProportions=e.helperProportions;this.instance.offset.click=e.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=a(h).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",true);
this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return c.helper[0]};d.target=this.instance.currentItem[0];this.instance._mouseCapture(d,true);this.instance._mouseStart(d,true,true);this.instance.offset.click.top=e.offset.click.top;this.instance.offset.click.left=e.offset.click.left;this.instance.offset.parent.left-=e.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=e.offset.parent.top-this.instance.offset.parent.top;
e._trigger("toSortable",d);e.dropped=this.instance.element;e.currentItem=e.element;this.instance.fromOutside=e}this.instance.currentItem&&this.instance._mouseDrag(d)}else if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",d,this.instance._uiHash(this.instance));this.instance._mouseStop(d,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();this.instance.placeholder&&
this.instance.placeholder.remove();e._trigger("fromSortable",d);e.dropped=false}})}});a.ui.plugin.add("draggable","cursor",{start:function(){var d=a("body"),c=a(this).data("draggable").options;if(d.css("cursor"))c._cursor=d.css("cursor");d.css("cursor",c.cursor)},stop:function(){var d=a(this).data("draggable").options;d._cursor&&a("body").css("cursor",d._cursor)}});a.ui.plugin.add("draggable","opacity",{start:function(d,c){d=a(c.helper);c=a(this).data("draggable").options;if(d.css("opacity"))c._opacity=
d.css("opacity");d.css("opacity",c.opacity)},stop:function(d,c){d=a(this).data("draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}});a.ui.plugin.add("draggable","scroll",{start:function(){var d=a(this).data("draggable");if(d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML")d.overflowOffset=d.scrollParent.offset()},drag:function(d){var c=a(this).data("draggable"),e=c.options,h=false;if(c.scrollParent[0]!=document&&c.scrollParent[0].tagName!="HTML"){if(!e.axis||e.axis!=
"x")if(c.overflowOffset.top+c.scrollParent[0].offsetHeight-d.pageY<e.scrollSensitivity)c.scrollParent[0].scrollTop=h=c.scrollParent[0].scrollTop+e.scrollSpeed;else if(d.pageY-c.overflowOffset.top<e.scrollSensitivity)c.scrollParent[0].scrollTop=h=c.scrollParent[0].scrollTop-e.scrollSpeed;if(!e.axis||e.axis!="y")if(c.overflowOffset.left+c.scrollParent[0].offsetWidth-d.pageX<e.scrollSensitivity)c.scrollParent[0].scrollLeft=h=c.scrollParent[0].scrollLeft+e.scrollSpeed;else if(d.pageX-c.overflowOffset.left<
e.scrollSensitivity)c.scrollParent[0].scrollLeft=h=c.scrollParent[0].scrollLeft-e.scrollSpeed}else{if(!e.axis||e.axis!="x")if(d.pageY-a(document).scrollTop()<e.scrollSensitivity)h=a(document).scrollTop(a(document).scrollTop()-e.scrollSpeed);else if(a(window).height()-(d.pageY-a(document).scrollTop())<e.scrollSensitivity)h=a(document).scrollTop(a(document).scrollTop()+e.scrollSpeed);if(!e.axis||e.axis!="y")if(d.pageX-a(document).scrollLeft()<e.scrollSensitivity)h=a(document).scrollLeft(a(document).scrollLeft()-
e.scrollSpeed);else if(a(window).width()-(d.pageX-a(document).scrollLeft())<e.scrollSensitivity)h=a(document).scrollLeft(a(document).scrollLeft()+e.scrollSpeed)}h!==false&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(c,d)}});a.ui.plugin.add("draggable","snap",{start:function(){var d=a(this).data("draggable"),c=d.options;d.snapElements=[];a(c.snap.constructor!=String?c.snap.items||":data(draggable)":c.snap).each(function(){var e=a(this),h=e.offset();this!=d.element[0]&&d.snapElements.push({item:this,
width:e.outerWidth(),height:e.outerHeight(),top:h.top,left:h.left})})},drag:function(d,c){for(var e=a(this).data("draggable"),h=e.options,g=h.snapTolerance,i=c.offset.left,b=i+e.helperProportions.width,f=c.offset.top,j=f+e.helperProportions.height,l=e.snapElements.length-1;l>=0;l--){var o=e.snapElements[l].left,n=o+e.snapElements[l].width,k=e.snapElements[l].top,m=k+e.snapElements[l].height;if(o-g<i&&i<n+g&&k-g<f&&f<m+g||o-g<i&&i<n+g&&k-g<j&&j<m+g||o-g<b&&b<n+g&&k-g<f&&f<m+g||o-g<b&&b<n+g&&k-g<j&&
j<m+g){if(h.snapMode!="inner"){var p=Math.abs(k-j)<=g,q=Math.abs(m-f)<=g,s=Math.abs(o-b)<=g,r=Math.abs(n-i)<=g;if(p)c.position.top=e._convertPositionTo("relative",{top:k-e.helperProportions.height,left:0}).top-e.margins.top;if(q)c.position.top=e._convertPositionTo("relative",{top:m,left:0}).top-e.margins.top;if(s)c.position.left=e._convertPositionTo("relative",{top:0,left:o-e.helperProportions.width}).left-e.margins.left;if(r)c.position.left=e._convertPositionTo("relative",{top:0,left:n}).left-e.margins.left}var u=
p||q||s||r;if(h.snapMode!="outer"){p=Math.abs(k-f)<=g;q=Math.abs(m-j)<=g;s=Math.abs(o-i)<=g;r=Math.abs(n-b)<=g;if(p)c.position.top=e._convertPositionTo("relative",{top:k,left:0}).top-e.margins.top;if(q)c.position.top=e._convertPositionTo("relative",{top:m-e.helperProportions.height,left:0}).top-e.margins.top;if(s)c.position.left=e._convertPositionTo("relative",{top:0,left:o}).left-e.margins.left;if(r)c.position.left=e._convertPositionTo("relative",{top:0,left:n-e.helperProportions.width}).left-e.margins.left}if(!e.snapElements[l].snapping&&
(p||q||s||r||u))e.options.snap.snap&&e.options.snap.snap.call(e.element,d,a.extend(e._uiHash(),{snapItem:e.snapElements[l].item}));e.snapElements[l].snapping=p||q||s||r||u}else{e.snapElements[l].snapping&&e.options.snap.release&&e.options.snap.release.call(e.element,d,a.extend(e._uiHash(),{snapItem:e.snapElements[l].item}));e.snapElements[l].snapping=false}}}});a.ui.plugin.add("draggable","stack",{start:function(){var d=a(this).data("draggable").options;d=a.makeArray(a(d.stack)).sort(function(e,h){return(parseInt(a(e).css("zIndex"),
10)||0)-(parseInt(a(h).css("zIndex"),10)||0)});if(d.length){var c=parseInt(d[0].style.zIndex)||0;a(d).each(function(e){this.style.zIndex=c+e});this[0].style.zIndex=c+d.length}}});a.ui.plugin.add("draggable","zIndex",{start:function(d,c){d=a(c.helper);c=a(this).data("draggable").options;if(d.css("zIndex"))c._zIndex=d.css("zIndex");d.css("zIndex",c.zIndex)},stop:function(d,c){d=a(this).data("draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})})(jQuery);
(function(a){a.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect"},_create:function(){var d=this.options,c=d.accept;this.isover=0;this.isout=1;this.accept=a.isFunction(c)?c:function(e){return e.is(c)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};a.ui.ddmanager.droppables[d.scope]=a.ui.ddmanager.droppables[d.scope]||[];a.ui.ddmanager.droppables[d.scope].push(this);
d.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){for(var d=a.ui.ddmanager.droppables[this.options.scope],c=0;c<d.length;c++)d[c]==this&&d.splice(c,1);this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this},_setOption:function(d,c){if(d=="accept")this.accept=a.isFunction(c)?c:function(e){return e.is(c)};a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(d){var c=a.ui.ddmanager.current;this.options.activeClass&&
this.element.addClass(this.options.activeClass);c&&this._trigger("activate",d,this.ui(c))},_deactivate:function(d){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass);c&&this._trigger("deactivate",d,this.ui(c))},_over:function(d){var c=a.ui.ddmanager.current;if(!(!c||(c.currentItem||c.element)[0]==this.element[0]))if(this.accept.call(this.element[0],c.currentItem||c.element)){this.options.hoverClass&&this.element.addClass(this.options.hoverClass);
this._trigger("over",d,this.ui(c))}},_out:function(d){var c=a.ui.ddmanager.current;if(!(!c||(c.currentItem||c.element)[0]==this.element[0]))if(this.accept.call(this.element[0],c.currentItem||c.element)){this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("out",d,this.ui(c))}},_drop:function(d,c){var e=c||a.ui.ddmanager.current;if(!e||(e.currentItem||e.element)[0]==this.element[0])return false;var h=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var g=
a.data(this,"droppable");if(g.options.greedy&&!g.options.disabled&&g.options.scope==e.options.scope&&g.accept.call(g.element[0],e.currentItem||e.element)&&a.ui.intersect(e,a.extend(g,{offset:g.element.offset()}),g.options.tolerance)){h=true;return false}});if(h)return false;if(this.accept.call(this.element[0],e.currentItem||e.element)){this.options.activeClass&&this.element.removeClass(this.options.activeClass);this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("drop",
d,this.ui(e));return this.element}return false},ui:function(d){return{draggable:d.currentItem||d.element,helper:d.helper,position:d.position,offset:d.positionAbs}}});a.extend(a.ui.droppable,{version:"1.8.16"});a.ui.intersect=function(d,c,e){if(!c.offset)return false;var h=(d.positionAbs||d.position.absolute).left,g=h+d.helperProportions.width,i=(d.positionAbs||d.position.absolute).top,b=i+d.helperProportions.height,f=c.offset.left,j=f+c.proportions.width,l=c.offset.top,o=l+c.proportions.height;
switch(e){case "fit":return f<=h&&g<=j&&l<=i&&b<=o;case "intersect":return f<h+d.helperProportions.width/2&&g-d.helperProportions.width/2<j&&l<i+d.helperProportions.height/2&&b-d.helperProportions.height/2<o;case "pointer":return a.ui.isOver((d.positionAbs||d.position.absolute).top+(d.clickOffset||d.offset.click).top,(d.positionAbs||d.position.absolute).left+(d.clickOffset||d.offset.click).left,l,f,c.proportions.height,c.proportions.width);case "touch":return(i>=l&&i<=o||b>=l&&b<=o||i<l&&b>o)&&(h>=
f&&h<=j||g>=f&&g<=j||h<f&&g>j);default:return false}};a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(d,c){var e=a.ui.ddmanager.droppables[d.options.scope]||[],h=c?c.type:null,g=(d.currentItem||d.element).find(":data(droppable)").andSelf(),i=0;a:for(;i<e.length;i++)if(!(e[i].options.disabled||d&&!e[i].accept.call(e[i].element[0],d.currentItem||d.element))){for(var b=0;b<g.length;b++)if(g[b]==e[i].element[0]){e[i].proportions.height=0;continue a}e[i].visible=e[i].element.css("display")!=
"none";if(e[i].visible){h=="mousedown"&&e[i]._activate.call(e[i],c);e[i].offset=e[i].element.offset();e[i].proportions={width:e[i].element[0].offsetWidth,height:e[i].element[0].offsetHeight}}}},drop:function(d,c){var e=false;a.each(a.ui.ddmanager.droppables[d.options.scope]||[],function(){if(this.options){if(!this.options.disabled&&this.visible&&a.ui.intersect(d,this,this.options.tolerance))e=e||this._drop.call(this,c);if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],d.currentItem||
d.element)){this.isout=1;this.isover=0;this._deactivate.call(this,c)}}});return e},dragStart:function(d,c){d.element.parents(":not(body,html)").bind("scroll.droppable",function(){d.options.refreshPositions||a.ui.ddmanager.prepareOffsets(d,c)})},drag:function(d,c){d.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(d,c);a.each(a.ui.ddmanager.droppables[d.options.scope]||[],function(){if(!(this.options.disabled||this.greedyChild||!this.visible)){var e=a.ui.intersect(d,this,this.options.tolerance);
if(e=!e&&this.isover==1?"isout":e&&this.isover==0?"isover":null){var h;if(this.options.greedy){var g=this.element.parents(":data(droppable):eq(0)");if(g.length){h=a.data(g[0],"droppable");h.greedyChild=e=="isover"?1:0}}if(h&&e=="isover"){h.isover=0;h.isout=1;h._out.call(h,c)}this[e]=1;this[e=="isout"?"isover":"isout"]=0;this[e=="isover"?"_over":"_out"].call(this,c);if(h&&e=="isout"){h.isout=0;h.isover=1;h._over.call(h,c)}}}})},dragStop:function(d,c){d.element.parents(":not(body,html)").unbind("scroll.droppable");
d.options.refreshPositions||a.ui.ddmanager.prepareOffsets(d,c)}}})(jQuery);
(function(a){a.widget("ui.resizable",a.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1E3},_create:function(){var e=this,h=this.options;this.element.addClass("ui-resizable");a.extend(this,{_aspectRatio:!!h.aspectRatio,aspectRatio:h.aspectRatio,originalElement:this.element,
_proportionallyResizeElements:[],_helper:h.helper||h.ghost||h.animate?h.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){/relative/.test(this.element.css("position"))&&a.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"});this.element.wrap(a('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),
top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("resizable",this.element.data("resizable"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=
this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize()}this.handles=h.handles||(!a(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",
nw:".ui-resizable-nw"});if(this.handles.constructor==String){if(this.handles=="all")this.handles="n,e,s,w,se,sw,ne,nw";var g=this.handles.split(",");this.handles={};for(var i=0;i<g.length;i++){var b=a.trim(g[i]),f=a('<div class="ui-resizable-handle '+("ui-resizable-"+b)+'"></div>');/sw|se|ne|nw/.test(b)&&f.css({zIndex:++h.zIndex});"se"==b&&f.addClass("ui-icon ui-icon-gripsmall-diagonal-se");this.handles[b]=".ui-resizable-"+b;this.element.append(f)}}this._renderAxis=function(j){j=j||this.element;for(var l in this.handles){if(this.handles[l].constructor==
String)this.handles[l]=a(this.handles[l],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var o=a(this.handles[l],this.element),n=0;n=/sw|ne|nw|se|n|s/.test(l)?o.outerHeight():o.outerWidth();o=["padding",/ne|nw|n/.test(l)?"Top":/se|sw|s/.test(l)?"Bottom":/^e$/.test(l)?"Right":"Left"].join("");j.css(o,n);this._proportionallyResize()}a(this.handles[l])}};this._renderAxis(this.element);this._handles=a(".ui-resizable-handle",this.element).disableSelection();
this._handles.mouseover(function(){if(!e.resizing){if(this.className)var j=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);e.axis=j&&j[1]?j[1]:"se"}});if(h.autoHide){this._handles.hide();a(this.element).addClass("ui-resizable-autohide").hover(function(){if(!h.disabled){a(this).removeClass("ui-resizable-autohide");e._handles.show()}},function(){if(!h.disabled)if(!e.resizing){a(this).addClass("ui-resizable-autohide");e._handles.hide()}})}this._mouseInit()},destroy:function(){this._mouseDestroy();
var e=function(g){a(g).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){e(this.element);var h=this.element;h.after(this.originalElement.css({position:h.css("position"),width:h.outerWidth(),height:h.outerHeight(),top:h.css("top"),left:h.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle);e(this.originalElement);return this},_mouseCapture:function(e){var h=
false;for(var g in this.handles)if(a(this.handles[g])[0]==e.target)h=true;return!this.options.disabled&&h},_mouseStart:function(e){var h=this.options,g=this.element.position(),i=this.element;this.resizing=true;this.documentScroll={top:a(document).scrollTop(),left:a(document).scrollLeft()};if(i.is(".ui-draggable")||/absolute/.test(i.css("position")))i.css({position:"absolute",top:g.top,left:g.left});a.browser.opera&&/relative/.test(i.css("position"))&&i.css({position:"relative",top:"auto",left:"auto"});
this._renderProxy();g=d(this.helper.css("left"));var b=d(this.helper.css("top"));if(h.containment){g+=a(h.containment).scrollLeft()||0;b+=a(h.containment).scrollTop()||0}this.offset=this.helper.offset();this.position={left:g,top:b};this.size=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()};this.originalSize=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()};this.originalPosition={left:g,top:b};this.sizeDiff=
{width:i.outerWidth()-i.width(),height:i.outerHeight()-i.height()};this.originalMousePosition={left:e.pageX,top:e.pageY};this.aspectRatio=typeof h.aspectRatio=="number"?h.aspectRatio:this.originalSize.width/this.originalSize.height||1;h=a(".ui-resizable-"+this.axis).css("cursor");a("body").css("cursor",h=="auto"?this.axis+"-resize":h);i.addClass("ui-resizable-resizing");this._propagate("start",e);return true},_mouseDrag:function(e){var h=this.helper,g=this.originalMousePosition,i=this._change[this.axis];
if(!i)return false;g=i.apply(this,[e,e.pageX-g.left||0,e.pageY-g.top||0]);this._updateVirtualBoundaries(e.shiftKey);if(this._aspectRatio||e.shiftKey)g=this._updateRatio(g,e);g=this._respectSize(g,e);this._propagate("resize",e);h.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize();this._updateCache(g);this._trigger("resize",e,this.ui());return false},
_mouseStop:function(e){this.resizing=false;var h=this.options,g=this;if(this._helper){var i=this._proportionallyResizeElements,b=i.length&&/textarea/i.test(i[0].nodeName);i=b&&a.ui.hasScroll(i[0],"left")?0:g.sizeDiff.height;b=b?0:g.sizeDiff.width;b={width:g.helper.width()-b,height:g.helper.height()-i};i=parseInt(g.element.css("left"),10)+(g.position.left-g.originalPosition.left)||null;var f=parseInt(g.element.css("top"),10)+(g.position.top-g.originalPosition.top)||null;h.animate||this.element.css(a.extend(b,
{top:f,left:i}));g.helper.height(g.size.height);g.helper.width(g.size.width);this._helper&&!h.animate&&this._proportionallyResize()}a("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",e);this._helper&&this.helper.remove();return false},_updateVirtualBoundaries:function(e){var h=this.options,g,i,b;h={minWidth:c(h.minWidth)?h.minWidth:0,maxWidth:c(h.maxWidth)?h.maxWidth:Infinity,minHeight:c(h.minHeight)?h.minHeight:0,maxHeight:c(h.maxHeight)?h.maxHeight:
Infinity};if(this._aspectRatio||e){e=h.minHeight*this.aspectRatio;i=h.minWidth/this.aspectRatio;g=h.maxHeight*this.aspectRatio;b=h.maxWidth/this.aspectRatio;if(e>h.minWidth)h.minWidth=e;if(i>h.minHeight)h.minHeight=i;if(g<h.maxWidth)h.maxWidth=g;if(b<h.maxHeight)h.maxHeight=b}this._vBoundaries=h},_updateCache:function(e){this.offset=this.helper.offset();if(c(e.left))this.position.left=e.left;if(c(e.top))this.position.top=e.top;if(c(e.height))this.size.height=e.height;if(c(e.width))this.size.width=
e.width},_updateRatio:function(e){var h=this.position,g=this.size,i=this.axis;if(c(e.height))e.width=e.height*this.aspectRatio;else if(c(e.width))e.height=e.width/this.aspectRatio;if(i=="sw"){e.left=h.left+(g.width-e.width);e.top=null}if(i=="nw"){e.top=h.top+(g.height-e.height);e.left=h.left+(g.width-e.width)}return e},_respectSize:function(e){var h=this._vBoundaries,g=this.axis,i=c(e.width)&&h.maxWidth&&h.maxWidth<e.width,b=c(e.height)&&h.maxHeight&&h.maxHeight<e.height,f=c(e.width)&&h.minWidth&&
h.minWidth>e.width,j=c(e.height)&&h.minHeight&&h.minHeight>e.height;if(f)e.width=h.minWidth;if(j)e.height=h.minHeight;if(i)e.width=h.maxWidth;if(b)e.height=h.maxHeight;var l=this.originalPosition.left+this.originalSize.width,o=this.position.top+this.size.height,n=/sw|nw|w/.test(g);g=/nw|ne|n/.test(g);if(f&&n)e.left=l-h.minWidth;if(i&&n)e.left=l-h.maxWidth;if(j&&g)e.top=o-h.minHeight;if(b&&g)e.top=o-h.maxHeight;if((h=!e.width&&!e.height)&&!e.left&&e.top)e.top=null;else if(h&&!e.top&&e.left)e.left=
null;return e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e=this.helper||this.element,h=0;h<this._proportionallyResizeElements.length;h++){var g=this._proportionallyResizeElements[h];if(!this.borderDif){var i=[g.css("borderTopWidth"),g.css("borderRightWidth"),g.css("borderBottomWidth"),g.css("borderLeftWidth")],b=[g.css("paddingTop"),g.css("paddingRight"),g.css("paddingBottom"),g.css("paddingLeft")];this.borderDif=a.map(i,function(f,j){f=parseInt(f,10)||
0;j=parseInt(b[j],10)||0;return f+j})}a.browser.msie&&(a(e).is(":hidden")||a(e).parents(":hidden").length)||g.css({height:e.height()-this.borderDif[0]-this.borderDif[2]||0,width:e.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var e=this.options;this.elementOffset=this.element.offset();if(this._helper){this.helper=this.helper||a('<div style="overflow:hidden;"></div>');var h=a.browser.msie&&a.browser.version<7,g=h?1:0;h=h?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+
h,height:this.element.outerHeight()+h,position:"absolute",left:this.elementOffset.left-g+"px",top:this.elementOffset.top-g+"px",zIndex:++e.zIndex});this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,h){return{width:this.originalSize.width+h}},w:function(e,h){return{left:this.originalPosition.left+h,width:this.originalSize.width-h}},n:function(e,h,g){return{top:this.originalPosition.top+g,height:this.originalSize.height-g}},s:function(e,h,g){return{height:this.originalSize.height+
g}},se:function(e,h,g){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,h,g]))},sw:function(e,h,g){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,h,g]))},ne:function(e,h,g){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,h,g]))},nw:function(e,h,g){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,h,g]))}},_propagate:function(e,h){a.ui.plugin.call(this,e,[h,this.ui()]);
e!="resize"&&this._trigger(e,h,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});a.extend(a.ui.resizable,{version:"1.8.16"});a.ui.plugin.add("resizable","alsoResize",{start:function(){var e=a(this).data("resizable").options,h=function(g){a(g).each(function(){var i=a(this);i.data("resizable-alsoresize",{width:parseInt(i.width(),
10),height:parseInt(i.height(),10),left:parseInt(i.css("left"),10),top:parseInt(i.css("top"),10),position:i.css("position")})})};if(typeof e.alsoResize=="object"&&!e.alsoResize.parentNode)if(e.alsoResize.length){e.alsoResize=e.alsoResize[0];h(e.alsoResize)}else a.each(e.alsoResize,function(g){h(g)});else h(e.alsoResize)},resize:function(e,h){var g=a(this).data("resizable");e=g.options;var i=g.originalSize,b=g.originalPosition,f={height:g.size.height-i.height||0,width:g.size.width-i.width||0,top:g.position.top-
b.top||0,left:g.position.left-b.left||0},j=function(l,o){a(l).each(function(){var n=a(this),k=a(this).data("resizable-alsoresize"),m={},p=o&&o.length?o:n.parents(h.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(p,function(q,s){if((q=(k[s]||0)+(f[s]||0))&&q>=0)m[s]=q||null});if(a.browser.opera&&/relative/.test(n.css("position"))){g._revertToRelativePosition=true;n.css({position:"absolute",top:"auto",left:"auto"})}n.css(m)})};typeof e.alsoResize=="object"&&!e.alsoResize.nodeType?
a.each(e.alsoResize,function(l,o){j(l,o)}):j(e.alsoResize)},stop:function(){var e=a(this).data("resizable"),h=e.options,g=function(i){a(i).each(function(){var b=a(this);b.css({position:b.data("resizable-alsoresize").position})})};if(e._revertToRelativePosition){e._revertToRelativePosition=false;typeof h.alsoResize=="object"&&!h.alsoResize.nodeType?a.each(h.alsoResize,function(i){g(i)}):g(h.alsoResize)}a(this).removeData("resizable-alsoresize")}});a.ui.plugin.add("resizable","animate",{stop:function(e){var h=
a(this).data("resizable"),g=h.options,i=h._proportionallyResizeElements,b=i.length&&/textarea/i.test(i[0].nodeName),f=b&&a.ui.hasScroll(i[0],"left")?0:h.sizeDiff.height;b={width:h.size.width-(b?0:h.sizeDiff.width),height:h.size.height-f};f=parseInt(h.element.css("left"),10)+(h.position.left-h.originalPosition.left)||null;var j=parseInt(h.element.css("top"),10)+(h.position.top-h.originalPosition.top)||null;h.element.animate(a.extend(b,j&&f?{top:j,left:f}:{}),{duration:g.animateDuration,easing:g.animateEasing,
step:function(){var l={width:parseInt(h.element.css("width"),10),height:parseInt(h.element.css("height"),10),top:parseInt(h.element.css("top"),10),left:parseInt(h.element.css("left"),10)};i&&i.length&&a(i[0]).css({width:l.width,height:l.height});h._updateCache(l);h._propagate("resize",e)}})}});a.ui.plugin.add("resizable","containment",{start:function(){var e=a(this).data("resizable"),h=e.element,g=e.options.containment;if(h=g instanceof a?g.get(0):/parent/.test(g)?h.parent().get(0):g){e.containerElement=
a(h);if(/document/.test(g)||g==document){e.containerOffset={left:0,top:0};e.containerPosition={left:0,top:0};e.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight}}else{var i=a(h),b=[];a(["Top","Right","Left","Bottom"]).each(function(l,o){b[l]=d(i.css("padding"+o))});e.containerOffset=i.offset();e.containerPosition=i.position();e.containerSize={height:i.innerHeight()-b[3],width:i.innerWidth()-b[1]};g=e.containerOffset;
var f=e.containerSize.height,j=e.containerSize.width;j=a.ui.hasScroll(h,"left")?h.scrollWidth:j;f=a.ui.hasScroll(h)?h.scrollHeight:f;e.parentData={element:h,left:g.left,top:g.top,width:j,height:f}}}},resize:function(e){var h=a(this).data("resizable"),g=h.options,i=h.containerOffset,b=h.position;e=h._aspectRatio||e.shiftKey;var f={top:0,left:0},j=h.containerElement;if(j[0]!=document&&/static/.test(j.css("position")))f=i;if(b.left<(h._helper?i.left:0)){h.size.width+=h._helper?h.position.left-i.left:
h.position.left-f.left;if(e)h.size.height=h.size.width/g.aspectRatio;h.position.left=g.helper?i.left:0}if(b.top<(h._helper?i.top:0)){h.size.height+=h._helper?h.position.top-i.top:h.position.top;if(e)h.size.width=h.size.height*g.aspectRatio;h.position.top=h._helper?i.top:0}h.offset.left=h.parentData.left+h.position.left;h.offset.top=h.parentData.top+h.position.top;g=Math.abs((h._helper?h.offset.left-f.left:h.offset.left-f.left)+h.sizeDiff.width);i=Math.abs((h._helper?h.offset.top-f.top:h.offset.top-
i.top)+h.sizeDiff.height);b=h.containerElement.get(0)==h.element.parent().get(0);f=/relative|absolute/.test(h.containerElement.css("position"));if(b&&f)g-=h.parentData.left;if(g+h.size.width>=h.parentData.width){h.size.width=h.parentData.width-g;if(e)h.size.height=h.size.width/h.aspectRatio}if(i+h.size.height>=h.parentData.height){h.size.height=h.parentData.height-i;if(e)h.size.width=h.size.height*h.aspectRatio}},stop:function(){var e=a(this).data("resizable"),h=e.options,g=e.containerOffset,i=e.containerPosition,
b=e.containerElement,f=a(e.helper),j=f.offset(),l=f.outerWidth()-e.sizeDiff.width;f=f.outerHeight()-e.sizeDiff.height;e._helper&&!h.animate&&/relative/.test(b.css("position"))&&a(this).css({left:j.left-i.left-g.left,width:l,height:f});e._helper&&!h.animate&&/static/.test(b.css("position"))&&a(this).css({left:j.left-i.left-g.left,width:l,height:f})}});a.ui.plugin.add("resizable","ghost",{start:function(){var e=a(this).data("resizable"),h=e.options,g=e.size;e.ghost=e.originalElement.clone();e.ghost.css({opacity:0.25,
display:"block",position:"relative",height:g.height,width:g.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof h.ghost=="string"?h.ghost:"");e.ghost.appendTo(e.helper)},resize:function(){var e=a(this).data("resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=a(this).data("resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}});a.ui.plugin.add("resizable","grid",{resize:function(){var e=
a(this).data("resizable"),h=e.options,g=e.size,i=e.originalSize,b=e.originalPosition,f=e.axis;h.grid=typeof h.grid=="number"?[h.grid,h.grid]:h.grid;var j=Math.round((g.width-i.width)/(h.grid[0]||1))*(h.grid[0]||1);h=Math.round((g.height-i.height)/(h.grid[1]||1))*(h.grid[1]||1);if(/^(se|s|e)$/.test(f)){e.size.width=i.width+j;e.size.height=i.height+h}else if(/^(ne)$/.test(f)){e.size.width=i.width+j;e.size.height=i.height+h;e.position.top=b.top-h}else{if(/^(sw)$/.test(f)){e.size.width=i.width+j;e.size.height=
i.height+h}else{e.size.width=i.width+j;e.size.height=i.height+h;e.position.top=b.top-h}e.position.left=b.left-j}}});var d=function(e){return parseInt(e,10)||0},c=function(e){return!isNaN(parseInt(e,10))}})(jQuery);
(function(a){a.widget("ui.selectable",a.ui.mouse,{options:{appendTo:"body",autoRefresh:true,distance:0,filter:"*",tolerance:"touch"},_create:function(){var d=this;this.element.addClass("ui-selectable");this.dragged=false;var c;this.refresh=function(){c=a(d.options.filter,d.element[0]);c.each(function(){var e=a(this),h=e.offset();a.data(this,"selectable-item",{element:this,$element:e,left:h.left,top:h.top,right:h.left+e.outerWidth(),bottom:h.top+e.outerHeight(),startselected:false,selected:e.hasClass("ui-selected"),
selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})};this.refresh();this.selectees=c.addClass("ui-selectee");this._mouseInit();this.helper=a("<div class='ui-selectable-helper'></div>")},destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable");this._mouseDestroy();return this},_mouseStart:function(d){var c=this;this.opos=[d.pageX,
d.pageY];if(!this.options.disabled){var e=this.options;this.selectees=a(e.filter,this.element[0]);this._trigger("start",d);a(e.appendTo).append(this.helper);this.helper.css({left:d.clientX,top:d.clientY,width:0,height:0});e.autoRefresh&&this.refresh();this.selectees.filter(".ui-selected").each(function(){var h=a.data(this,"selectable-item");h.startselected=true;if(!d.metaKey){h.$element.removeClass("ui-selected");h.selected=false;h.$element.addClass("ui-unselecting");h.unselecting=true;c._trigger("unselecting",
d,{unselecting:h.element})}});a(d.target).parents().andSelf().each(function(){var h=a.data(this,"selectable-item");if(h){var g=!d.metaKey||!h.$element.hasClass("ui-selected");h.$element.removeClass(g?"ui-unselecting":"ui-selected").addClass(g?"ui-selecting":"ui-unselecting");h.unselecting=!g;h.selecting=g;(h.selected=g)?c._trigger("selecting",d,{selecting:h.element}):c._trigger("unselecting",d,{unselecting:h.element});return false}})}},_mouseDrag:function(d){var c=this;this.dragged=true;if(!this.options.disabled){var e=
this.options,h=this.opos[0],g=this.opos[1],i=d.pageX,b=d.pageY;if(h>i){var f=i;i=h;h=f}if(g>b){f=b;b=g;g=f}this.helper.css({left:h,top:g,width:i-h,height:b-g});this.selectees.each(function(){var j=a.data(this,"selectable-item");if(!(!j||j.element==c.element[0])){var l=false;if(e.tolerance=="touch")l=!(j.left>i||j.right<h||j.top>b||j.bottom<g);else if(e.tolerance=="fit")l=j.left>h&&j.right<i&&j.top>g&&j.bottom<b;if(l){if(j.selected){j.$element.removeClass("ui-selected");j.selected=false}if(j.unselecting){j.$element.removeClass("ui-unselecting");
j.unselecting=false}if(!j.selecting){j.$element.addClass("ui-selecting");j.selecting=true;c._trigger("selecting",d,{selecting:j.element})}}else{if(j.selecting)if(d.metaKey&&j.startselected){j.$element.removeClass("ui-selecting");j.selecting=false;j.$element.addClass("ui-selected");j.selected=true}else{j.$element.removeClass("ui-selecting");j.selecting=false;if(j.startselected){j.$element.addClass("ui-unselecting");j.unselecting=true}c._trigger("unselecting",d,{unselecting:j.element})}if(j.selected)if(!d.metaKey&&
!j.startselected){j.$element.removeClass("ui-selected");j.selected=false;j.$element.addClass("ui-unselecting");j.unselecting=true;c._trigger("unselecting",d,{unselecting:j.element})}}}});return false}},_mouseStop:function(d){var c=this;this.dragged=false;a(".ui-unselecting",this.element[0]).each(function(){var e=a.data(this,"selectable-item");e.$element.removeClass("ui-unselecting");e.unselecting=false;e.startselected=false;c._trigger("unselected",d,{unselected:e.element})});a(".ui-selecting",this.element[0]).each(function(){var e=
a.data(this,"selectable-item");e.$element.removeClass("ui-selecting").addClass("ui-selected");e.selecting=false;e.selected=true;e.startselected=true;c._trigger("selected",d,{selected:e.element})});this._trigger("stop",d);this.helper.remove();return false}});a.extend(a.ui.selectable,{version:"1.8.16"})})(jQuery);
(function(a){a.widget("ui.sortable",a.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1E3},_create:function(){var d=this.options;this.containerCache={};this.element.addClass("ui-sortable");
this.refresh();this.floating=this.items.length?d.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):false;this.offset=this.element.offset();this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable");this._mouseDestroy();for(var d=this.items.length-1;d>=0;d--)this.items[d].item.removeData("sortable-item");return this},_setOption:function(d,c){if(d===
"disabled"){this.options[d]=c;this.widget()[c?"addClass":"removeClass"]("ui-sortable-disabled")}else a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(d,c){if(this.reverting)return false;if(this.options.disabled||this.options.type=="static")return false;this._refreshItems(d);var e=null,h=this;a(d.target).parents().each(function(){if(a.data(this,"sortable-item")==h){e=a(this);return false}});if(a.data(d.target,"sortable-item")==h)e=a(d.target);if(!e)return false;if(this.options.handle&&
!c){var g=false;a(this.options.handle,e).find("*").andSelf().each(function(){if(this==d.target)g=true});if(!g)return false}this.currentItem=e;this._removeCurrentsFromItems();return true},_mouseStart:function(d,c,e){c=this.options;var h=this;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(d);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,
left:this.offset.left-this.margins.left};this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");a.extend(this.offset,{click:{left:d.pageX-this.offset.left,top:d.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this._generatePosition(d);this.originalPageX=d.pageX;this.originalPageY=d.pageY;c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};
this.helper[0]!=this.currentItem[0]&&this.currentItem.hide();this._createPlaceholder();c.containment&&this._setContainment();if(c.cursor){if(a("body").css("cursor"))this._storedCursor=a("body").css("cursor");a("body").css("cursor",c.cursor)}if(c.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",c.opacity)}if(c.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",c.zIndex)}if(this.scrollParent[0]!=
document&&this.scrollParent[0].tagName!="HTML")this.overflowOffset=this.scrollParent.offset();this._trigger("start",d,this._uiHash());this._preserveHelperProportions||this._cacheHelperProportions();if(!e)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",d,h._uiHash(this));if(a.ui.ddmanager)a.ui.ddmanager.current=this;a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,d);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(d);
return true},_mouseDrag:function(d){this.position=this._generatePosition(d);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs)this.lastPositionAbs=this.positionAbs;if(this.options.scroll){var c=this.options,e=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-d.pageY<c.scrollSensitivity)this.scrollParent[0].scrollTop=e=this.scrollParent[0].scrollTop+c.scrollSpeed;else if(d.pageY-this.overflowOffset.top<
c.scrollSensitivity)this.scrollParent[0].scrollTop=e=this.scrollParent[0].scrollTop-c.scrollSpeed;if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-d.pageX<c.scrollSensitivity)this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft+c.scrollSpeed;else if(d.pageX-this.overflowOffset.left<c.scrollSensitivity)this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft-c.scrollSpeed}else{if(d.pageY-a(document).scrollTop()<c.scrollSensitivity)e=a(document).scrollTop(a(document).scrollTop()-
c.scrollSpeed);else if(a(window).height()-(d.pageY-a(document).scrollTop())<c.scrollSensitivity)e=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed);if(d.pageX-a(document).scrollLeft()<c.scrollSensitivity)e=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed);else if(a(window).width()-(d.pageX-a(document).scrollLeft())<c.scrollSensitivity)e=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed)}e!==false&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,
d)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(c=this.items.length-1;c>=0;c--){e=this.items[c];var h=e.item[0],g=this._intersectsWithPointer(e);if(g)if(h!=this.currentItem[0]&&this.placeholder[g==1?"next":"prev"]()[0]!=h&&!a.ui.contains(this.placeholder[0],h)&&(this.options.type=="semi-dynamic"?!a.ui.contains(this.element[0],
h):true)){this.direction=g==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(e))this._rearrange(d,e);else break;this._trigger("change",d,this._uiHash());break}}this._contactContainers(d);a.ui.ddmanager&&a.ui.ddmanager.drag(this,d);this._trigger("sort",d,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(d,c){if(d){a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,d);if(this.options.revert){var e=this;c=e.placeholder.offset();
e.reverting=true;a(this.helper).animate({left:c.left-this.offset.parent.left-e.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:c.top-this.offset.parent.top-e.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){e._clear(d)})}else this._clear(d,c);return false}},cancel:function(){var d=this;if(this.dragging){this._mouseUp({target:null});this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):
this.currentItem.show();for(var c=this.containers.length-1;c>=0;c--){this.containers[c]._trigger("deactivate",null,d._uiHash(this));if(this.containers[c].containerCache.over){this.containers[c]._trigger("out",null,d._uiHash(this));this.containers[c].containerCache.over=0}}}if(this.placeholder){this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove();a.extend(this,{helper:null,
dragging:false,reverting:false,_noFinalSort:null});this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)}return this},serialize:function(d){var c=this._getItemsAsjQuery(d&&d.connected),e=[];d=d||{};a(c).each(function(){var h=(a(d.item||this).attr(d.attribute||"id")||"").match(d.expression||/(.+)[-=_](.+)/);if(h)e.push((d.key||h[1]+"[]")+"="+(d.key&&d.expression?h[1]:h[2]))});!e.length&&d.key&&e.push(d.key+"=");return e.join("&")},
toArray:function(d){var c=this._getItemsAsjQuery(d&&d.connected),e=[];d=d||{};c.each(function(){e.push(a(d.item||this).attr(d.attribute||"id")||"")});return e},_intersectsWith:function(d){var c=this.positionAbs.left,e=c+this.helperProportions.width,h=this.positionAbs.top,g=h+this.helperProportions.height,i=d.left,b=i+d.width,f=d.top,j=f+d.height,l=this.offset.click.top,o=this.offset.click.left;l=h+l>f&&h+l<j&&c+o>i&&c+o<b;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||
this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>d[this.floating?"width":"height"]?l:i<c+this.helperProportions.width/2&&e-this.helperProportions.width/2<b&&f<h+this.helperProportions.height/2&&g-this.helperProportions.height/2<j},_intersectsWithPointer:function(d){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,d.top,d.height);d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,d.left,d.width);c=c&&d;d=this._getDragVerticalDirection();
var e=this._getDragHorizontalDirection();if(!c)return false;return this.floating?e&&e=="right"||d=="down"?2:1:d&&(d=="down"?2:1)},_intersectsWithSides:function(d){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,d.top+d.height/2,d.height);d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,d.left+d.width/2,d.width);var e=this._getDragVerticalDirection(),h=this._getDragHorizontalDirection();return this.floating&&h?h=="right"&&d||h=="left"&&!d:e&&(e=="down"&&c||e=="up"&&!c)},
_getDragVerticalDirection:function(){var d=this.positionAbs.top-this.lastPositionAbs.top;return d!=0&&(d>0?"down":"up")},_getDragHorizontalDirection:function(){var d=this.positionAbs.left-this.lastPositionAbs.left;return d!=0&&(d>0?"right":"left")},refresh:function(d){this._refreshItems(d);this.refreshPositions();return this},_connectWith:function(){var d=this.options;return d.connectWith.constructor==String?[d.connectWith]:d.connectWith},_getItemsAsjQuery:function(d){var c=[],e=[],h=this._connectWith();
if(h&&d)for(d=h.length-1;d>=0;d--)for(var g=a(h[d]),i=g.length-1;i>=0;i--){var b=a.data(g[i],"sortable");if(b&&b!=this&&!b.options.disabled)e.push([a.isFunction(b.options.items)?b.options.items.call(b.element):a(b.options.items,b.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),b])}e.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),
this]);for(d=e.length-1;d>=0;d--)e[d][0].each(function(){c.push(this)});return a(c)},_removeCurrentsFromItems:function(){for(var d=this.currentItem.find(":data(sortable-item)"),c=0;c<this.items.length;c++)for(var e=0;e<d.length;e++)d[e]==this.items[c].item[0]&&this.items.splice(c,1)},_refreshItems:function(d){this.items=[];this.containers=[this];var c=this.items,e=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],d,{item:this.currentItem}):a(this.options.items,this.element),
this]],h=this._connectWith();if(h)for(var g=h.length-1;g>=0;g--)for(var i=a(h[g]),b=i.length-1;b>=0;b--){var f=a.data(i[b],"sortable");if(f&&f!=this&&!f.options.disabled){e.push([a.isFunction(f.options.items)?f.options.items.call(f.element[0],d,{item:this.currentItem}):a(f.options.items,f.element),f]);this.containers.push(f)}}for(g=e.length-1;g>=0;g--){d=e[g][1];h=e[g][0];b=0;for(i=h.length;b<i;b++){f=a(h[b]);f.data("sortable-item",d);c.push({item:f,instance:d,width:0,height:0,left:0,top:0})}}},refreshPositions:function(d){if(this.offsetParent&&
this.helper)this.offset.parent=this._getParentOffset();for(var c=this.items.length-1;c>=0;c--){var e=this.items[c];if(!(e.instance!=this.currentContainer&&this.currentContainer&&e.item[0]!=this.currentItem[0])){var h=this.options.toleranceElement?a(this.options.toleranceElement,e.item):e.item;if(!d){e.width=h.outerWidth();e.height=h.outerHeight()}h=h.offset();e.left=h.left;e.top=h.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=
this.containers.length-1;c>=0;c--){h=this.containers[c].element.offset();this.containers[c].containerCache.left=h.left;this.containers[c].containerCache.top=h.top;this.containers[c].containerCache.width=this.containers[c].element.outerWidth();this.containers[c].containerCache.height=this.containers[c].element.outerHeight()}return this},_createPlaceholder:function(d){var c=d||this,e=c.options;if(!e.placeholder||e.placeholder.constructor==String){var h=e.placeholder;e.placeholder={element:function(){var g=
a(document.createElement(c.currentItem[0].nodeName)).addClass(h||c.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!h)g.style.visibility="hidden";return g},update:function(g,i){if(!(h&&!e.forcePlaceholderSize)){i.height()||i.height(c.currentItem.innerHeight()-parseInt(c.currentItem.css("paddingTop")||0,10)-parseInt(c.currentItem.css("paddingBottom")||0,10));i.width()||i.width(c.currentItem.innerWidth()-parseInt(c.currentItem.css("paddingLeft")||0,10)-parseInt(c.currentItem.css("paddingRight")||
0,10))}}}}c.placeholder=a(e.placeholder.element.call(c.element,c.currentItem));c.currentItem.after(c.placeholder);e.placeholder.update(c,c.placeholder)},_contactContainers:function(d){for(var c=null,e=null,h=this.containers.length-1;h>=0;h--)if(!a.ui.contains(this.currentItem[0],this.containers[h].element[0]))if(this._intersectsWith(this.containers[h].containerCache)){if(!(c&&a.ui.contains(this.containers[h].element[0],c.element[0]))){c=this.containers[h];e=h}}else if(this.containers[h].containerCache.over){this.containers[h]._trigger("out",
d,this._uiHash(this));this.containers[h].containerCache.over=0}if(c)if(this.containers.length===1){this.containers[e]._trigger("over",d,this._uiHash(this));this.containers[e].containerCache.over=1}else if(this.currentContainer!=this.containers[e]){c=1E4;h=null;for(var g=this.positionAbs[this.containers[e].floating?"left":"top"],i=this.items.length-1;i>=0;i--)if(a.ui.contains(this.containers[e].element[0],this.items[i].item[0])){var b=this.items[i][this.containers[e].floating?"left":"top"];if(Math.abs(b-
g)<c){c=Math.abs(b-g);h=this.items[i]}}if(h||this.options.dropOnEmpty){this.currentContainer=this.containers[e];h?this._rearrange(d,h,null,true):this._rearrange(d,null,this.containers[e].element,true);this._trigger("change",d,this._uiHash());this.containers[e]._trigger("change",d,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[e]._trigger("over",d,this._uiHash(this));this.containers[e].containerCache.over=1}}},_createHelper:function(d){var c=
this.options;d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[d,this.currentItem])):c.helper=="clone"?this.currentItem.clone():this.currentItem;d.parents("body").length||a(c.appendTo!="parent"?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]);if(d[0]==this.currentItem[0])this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(d[0].style.width==
""||c.forceHelperSize)d.width(this.currentItem.width());if(d[0].style.height==""||c.forceHelperSize)d.height(this.currentItem.height());return d},_adjustOffsetFromHelper:function(d){if(typeof d=="string")d=d.split(" ");if(a.isArray(d))d={left:+d[0],top:+d[1]||0};if("left"in d)this.offset.click.left=d.left+this.margins.left;if("right"in d)this.offset.click.left=this.helperProportions.width-d.right+this.margins.left;if("top"in d)this.offset.click.top=d.top+this.margins.top;if("bottom"in d)this.offset.click.top=
this.helperProportions.height-d.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var d=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])){d.left+=this.scrollParent.scrollLeft();d.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)d=
{top:0,left:0};return{top:d.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:d.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var d=this.currentItem.position();return{top:d.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:d.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),
10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var d=this.options;if(d.containment=="parent")d.containment=this.helper[0].parentNode;if(d.containment=="document"||d.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(d.containment=="document"?
document:window).width()-this.helperProportions.width-this.margins.left,(a(d.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(d.containment)){var c=a(d.containment)[0];d=a(d.containment).offset();var e=a(c).css("overflow")!="hidden";this.containment=[d.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(c).css("borderTopWidth"),
10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,d.left+(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(d,c){if(!c)c=
this.position;d=d=="absolute"?1:-1;var e=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:e.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&
this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:e.scrollLeft())*d)}},_generatePosition:function(d){var c=this.options,e=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(e[0].tagName);if(this.cssPosition=="relative"&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]))this.offset.relative=this._getRelativeOffset();
var g=d.pageX,i=d.pageY;if(this.originalPosition){if(this.containment){if(d.pageX-this.offset.click.left<this.containment[0])g=this.containment[0]+this.offset.click.left;if(d.pageY-this.offset.click.top<this.containment[1])i=this.containment[1]+this.offset.click.top;if(d.pageX-this.offset.click.left>this.containment[2])g=this.containment[2]+this.offset.click.left;if(d.pageY-this.offset.click.top>this.containment[3])i=this.containment[3]+this.offset.click.top}if(c.grid){i=this.originalPageY+Math.round((i-
this.originalPageY)/c.grid[1])*c.grid[1];i=this.containment?!(i-this.offset.click.top<this.containment[1]||i-this.offset.click.top>this.containment[3])?i:!(i-this.offset.click.top<this.containment[1])?i-c.grid[1]:i+c.grid[1]:i;g=this.originalPageX+Math.round((g-this.originalPageX)/c.grid[0])*c.grid[0];g=this.containment?!(g-this.offset.click.left<this.containment[0]||g-this.offset.click.left>this.containment[2])?g:!(g-this.offset.click.left<this.containment[0])?g-c.grid[0]:g+c.grid[0]:g}}return{top:i-
this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:e.scrollTop()),left:g-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:e.scrollLeft())}},_rearrange:function(d,c,e,h){e?e[0].appendChild(this.placeholder[0]):c.item[0].parentNode.insertBefore(this.placeholder[0],
this.direction=="down"?c.item[0]:c.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var g=this,i=this.counter;window.setTimeout(function(){i==g.counter&&g.refreshPositions(!h)},0)},_clear:function(d,c){this.reverting=false;var e=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var h in this._storedCSS)if(this._storedCSS[h]=="auto"||this._storedCSS[h]=="static")this._storedCSS[h]=
"";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!c&&e.push(function(g){this._trigger("receive",g,this._uiHash(this.fromOutside))});if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!c)e.push(function(g){this._trigger("update",g,this._uiHash())});if(!a.ui.contains(this.element[0],this.currentItem[0])){c||e.push(function(g){this._trigger("remove",
g,this._uiHash())});for(h=this.containers.length-1;h>=0;h--)if(a.ui.contains(this.containers[h].element[0],this.currentItem[0])&&!c){e.push(function(g){return function(i){g._trigger("receive",i,this._uiHash(this))}}.call(this,this.containers[h]));e.push(function(g){return function(i){g._trigger("update",i,this._uiHash(this))}}.call(this,this.containers[h]))}}for(h=this.containers.length-1;h>=0;h--){c||e.push(function(g){return function(i){g._trigger("deactivate",i,this._uiHash(this))}}.call(this,
this.containers[h]));if(this.containers[h].containerCache.over){e.push(function(g){return function(i){g._trigger("out",i,this._uiHash(this))}}.call(this,this.containers[h]));this.containers[h].containerCache.over=0}}this._storedCursor&&a("body").css("cursor",this._storedCursor);this._storedOpacity&&this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!c){this._trigger("beforeStop",
d,this._uiHash());for(h=0;h<e.length;h++)e[h].call(this,d);this._trigger("stop",d,this._uiHash())}return false}c||this._trigger("beforeStop",d,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.helper[0]!=this.currentItem[0]&&this.helper.remove();this.helper=null;if(!c){for(h=0;h<e.length;h++)e[h].call(this,d);this._trigger("stop",d,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===false&&this.cancel()},
_uiHash:function(d){var c=d||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:d?d.element:null}}});a.extend(a.ui.sortable,{version:"1.8.16"})})(jQuery);
jQuery.effects||function(a,d){function c(n){var k;if(n&&n.constructor==Array&&n.length==3)return n;if(k=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(n))return[parseInt(k[1],10),parseInt(k[2],10),parseInt(k[3],10)];if(k=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(n))return[parseFloat(k[1])*2.55,parseFloat(k[2])*2.55,parseFloat(k[3])*2.55];if(k=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(n))return[parseInt(k[1],
16),parseInt(k[2],16),parseInt(k[3],16)];if(k=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(n))return[parseInt(k[1]+k[1],16),parseInt(k[2]+k[2],16),parseInt(k[3]+k[3],16)];if(/rgba\(0, 0, 0, 0\)/.exec(n))return j.transparent;return j[a.trim(n).toLowerCase()]}function e(n,k){var m;do{m=a.curCSS(n,k);if(m!=""&&m!="transparent"||a.nodeName(n,"body"))break;k="backgroundColor"}while(n=n.parentNode);return c(m)}function h(){var n=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,
k={},m,p;if(n&&n.length&&n[0]&&n[n[0]])for(var q=n.length;q--;){m=n[q];if(typeof n[m]=="string"){p=m.replace(/\-(\w)/g,function(s,r){return r.toUpperCase()});k[p]=n[m]}}else for(m in n)if(typeof n[m]==="string")k[m]=n[m];return k}function g(n){var k,m;for(k in n){m=n[k];if(m==null||a.isFunction(m)||k in o||/scrollbar/.test(k)||!/color/i.test(k)&&isNaN(parseFloat(m)))delete n[k]}return n}function i(n,k){var m={_:0},p;for(p in k)if(n[p]!=k[p])m[p]=k[p];return m}function b(n,k,m,p){if(typeof n=="object"){p=
k;m=null;k=n;n=k.effect}if(a.isFunction(k)){p=k;m=null;k={}}if(typeof k=="number"||a.fx.speeds[k]){p=m;m=k;k={}}if(a.isFunction(m)){p=m;m=null}k=k||{};m=m||k.duration;m=a.fx.off?0:typeof m=="number"?m:m in a.fx.speeds?a.fx.speeds[m]:a.fx.speeds._default;p=p||k.complete;return[n,k,m,p]}function f(n){if(!n||typeof n==="number"||a.fx.speeds[n])return true;if(typeof n==="string"&&!a.effects[n])return true;return false}a.effects={};a.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor",
"borderTopColor","borderColor","color","outlineColor"],function(n,k){a.fx.step[k]=function(m){if(!m.colorInit){m.start=e(m.elem,k);m.end=c(m.end);m.colorInit=true}m.elem.style[k]="rgb("+Math.max(Math.min(parseInt(m.pos*(m.end[0]-m.start[0])+m.start[0],10),255),0)+","+Math.max(Math.min(parseInt(m.pos*(m.end[1]-m.start[1])+m.start[1],10),255),0)+","+Math.max(Math.min(parseInt(m.pos*(m.end[2]-m.start[2])+m.start[2],10),255),0)+")"}});var j={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,
0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,
211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},l=["add","remove","toggle"],o={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};a.effects.animateClass=function(n,k,m,
p){if(a.isFunction(m)){p=m;m=null}return this.queue(function(){var q=a(this),s=q.attr("style")||" ",r=g(h.call(this)),u,v=q.attr("class");a.each(l,function(w,x){n[x]&&q[x+"Class"](n[x])});u=g(h.call(this));q.attr("class",v);q.animate(i(r,u),{queue:false,duration:k,easing:m,complete:function(){a.each(l,function(w,x){n[x]&&q[x+"Class"](n[x])});if(typeof q.attr("style")=="object"){q.attr("style").cssText="";q.attr("style").cssText=s}else q.attr("style",s);p&&p.apply(this,arguments);a.dequeue(this)}})})};
a.fn.extend({_addClass:a.fn.addClass,addClass:function(n,k,m,p){return k?a.effects.animateClass.apply(this,[{add:n},k,m,p]):this._addClass(n)},_removeClass:a.fn.removeClass,removeClass:function(n,k,m,p){return k?a.effects.animateClass.apply(this,[{remove:n},k,m,p]):this._removeClass(n)},_toggleClass:a.fn.toggleClass,toggleClass:function(n,k,m,p,q){return typeof k=="boolean"||k===d?m?a.effects.animateClass.apply(this,[k?{add:n}:{remove:n},m,p,q]):this._toggleClass(n,k):a.effects.animateClass.apply(this,
[{toggle:n},k,m,p])},switchClass:function(n,k,m,p,q){return a.effects.animateClass.apply(this,[{add:k,remove:n},m,p,q])}});a.extend(a.effects,{version:"1.8.16",save:function(n,k){for(var m=0;m<k.length;m++)k[m]!==null&&n.data("ec.storage."+k[m],n[0].style[k[m]])},restore:function(n,k){for(var m=0;m<k.length;m++)k[m]!==null&&n.css(k[m],n.data("ec.storage."+k[m]))},setMode:function(n,k){if(k=="toggle")k=n.is(":hidden")?"show":"hide";return k},getBaseline:function(n,k){var m;switch(n[0]){case "top":m=
0;break;case "middle":m=0.5;break;case "bottom":m=1;break;default:m=n[0]/k.height}switch(n[1]){case "left":n=0;break;case "center":n=0.5;break;case "right":n=1;break;default:n=n[1]/k.width}return{x:n,y:m}},createWrapper:function(n){if(n.parent().is(".ui-effects-wrapper"))return n.parent();var k={width:n.outerWidth(true),height:n.outerHeight(true),"float":n.css("float")},m=a("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),
p=document.activeElement;n.wrap(m);if(n[0]===p||a.contains(n[0],p))a(p).focus();m=n.parent();if(n.css("position")=="static"){m.css({position:"relative"});n.css({position:"relative"})}else{a.extend(k,{position:n.css("position"),zIndex:n.css("z-index")});a.each(["top","left","bottom","right"],function(q,s){k[s]=n.css(s);if(isNaN(parseInt(k[s],10)))k[s]="auto"});n.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})}return m.css(k).show()},removeWrapper:function(n){var k,m=document.activeElement;
if(n.parent().is(".ui-effects-wrapper")){k=n.parent().replaceWith(n);if(n[0]===m||a.contains(n[0],m))a(m).focus();return k}return n},setTransition:function(n,k,m,p){p=p||{};a.each(k,function(q,s){unit=n.cssUnit(s);if(unit[0]>0)p[s]=unit[0]*m+unit[1]});return p}});a.fn.extend({effect:function(n){var k=b.apply(this,arguments),m={options:k[1],duration:k[2],callback:k[3]};k=m.options.mode;var p=a.effects[n];if(a.fx.off||!p)return k?this[k](m.duration,m.callback):this.each(function(){m.callback&&m.callback.call(this)});
return p.call(this,m)},_show:a.fn.show,show:function(n){if(f(n))return this._show.apply(this,arguments);else{var k=b.apply(this,arguments);k[1].mode="show";return this.effect.apply(this,k)}},_hide:a.fn.hide,hide:function(n){if(f(n))return this._hide.apply(this,arguments);else{var k=b.apply(this,arguments);k[1].mode="hide";return this.effect.apply(this,k)}},__toggle:a.fn.toggle,toggle:function(n){if(f(n)||typeof n==="boolean"||a.isFunction(n))return this.__toggle.apply(this,arguments);else{var k=b.apply(this,
arguments);k[1].mode="toggle";return this.effect.apply(this,k)}},cssUnit:function(n){var k=this.css(n),m=[];a.each(["em","px","%","pt"],function(p,q){if(k.indexOf(q)>0)m=[parseFloat(k),q]});return m}});a.easing.jswing=a.easing.swing;a.extend(a.easing,{def:"easeOutQuad",swing:function(n,k,m,p,q){return a.easing[a.easing.def](n,k,m,p,q)},easeInQuad:function(n,k,m,p,q){return p*(k/=q)*k+m},easeOutQuad:function(n,k,m,p,q){return-p*(k/=q)*(k-2)+m},easeInOutQuad:function(n,k,m,p,q){if((k/=q/2)<1)return p/
2*k*k+m;return-p/2*(--k*(k-2)-1)+m},easeInCubic:function(n,k,m,p,q){return p*(k/=q)*k*k+m},easeOutCubic:function(n,k,m,p,q){return p*((k=k/q-1)*k*k+1)+m},easeInOutCubic:function(n,k,m,p,q){if((k/=q/2)<1)return p/2*k*k*k+m;return p/2*((k-=2)*k*k+2)+m},easeInQuart:function(n,k,m,p,q){return p*(k/=q)*k*k*k+m},easeOutQuart:function(n,k,m,p,q){return-p*((k=k/q-1)*k*k*k-1)+m},easeInOutQuart:function(n,k,m,p,q){if((k/=q/2)<1)return p/2*k*k*k*k+m;return-p/2*((k-=2)*k*k*k-2)+m},easeInQuint:function(n,k,m,
p,q){return p*(k/=q)*k*k*k*k+m},easeOutQuint:function(n,k,m,p,q){return p*((k=k/q-1)*k*k*k*k+1)+m},easeInOutQuint:function(n,k,m,p,q){if((k/=q/2)<1)return p/2*k*k*k*k*k+m;return p/2*((k-=2)*k*k*k*k+2)+m},easeInSine:function(n,k,m,p,q){return-p*Math.cos(k/q*(Math.PI/2))+p+m},easeOutSine:function(n,k,m,p,q){return p*Math.sin(k/q*(Math.PI/2))+m},easeInOutSine:function(n,k,m,p,q){return-p/2*(Math.cos(Math.PI*k/q)-1)+m},easeInExpo:function(n,k,m,p,q){return k==0?m:p*Math.pow(2,10*(k/q-1))+m},easeOutExpo:function(n,
k,m,p,q){return k==q?m+p:p*(-Math.pow(2,-10*k/q)+1)+m},easeInOutExpo:function(n,k,m,p,q){if(k==0)return m;if(k==q)return m+p;if((k/=q/2)<1)return p/2*Math.pow(2,10*(k-1))+m;return p/2*(-Math.pow(2,-10*--k)+2)+m},easeInCirc:function(n,k,m,p,q){return-p*(Math.sqrt(1-(k/=q)*k)-1)+m},easeOutCirc:function(n,k,m,p,q){return p*Math.sqrt(1-(k=k/q-1)*k)+m},easeInOutCirc:function(n,k,m,p,q){if((k/=q/2)<1)return-p/2*(Math.sqrt(1-k*k)-1)+m;return p/2*(Math.sqrt(1-(k-=2)*k)+1)+m},easeInElastic:function(n,k,m,
p,q){n=1.70158;var s=0,r=p;if(k==0)return m;if((k/=q)==1)return m+p;s||(s=q*0.3);if(r<Math.abs(p)){r=p;n=s/4}else n=s/(2*Math.PI)*Math.asin(p/r);return-(r*Math.pow(2,10*(k-=1))*Math.sin((k*q-n)*2*Math.PI/s))+m},easeOutElastic:function(n,k,m,p,q){n=1.70158;var s=0,r=p;if(k==0)return m;if((k/=q)==1)return m+p;s||(s=q*0.3);if(r<Math.abs(p)){r=p;n=s/4}else n=s/(2*Math.PI)*Math.asin(p/r);return r*Math.pow(2,-10*k)*Math.sin((k*q-n)*2*Math.PI/s)+p+m},easeInOutElastic:function(n,k,m,p,q){n=1.70158;var s=
0,r=p;if(k==0)return m;if((k/=q/2)==2)return m+p;s||(s=q*0.3*1.5);if(r<Math.abs(p)){r=p;n=s/4}else n=s/(2*Math.PI)*Math.asin(p/r);if(k<1)return-0.5*r*Math.pow(2,10*(k-=1))*Math.sin((k*q-n)*2*Math.PI/s)+m;return r*Math.pow(2,-10*(k-=1))*Math.sin((k*q-n)*2*Math.PI/s)*0.5+p+m},easeInBack:function(n,k,m,p,q,s){if(s==d)s=1.70158;return p*(k/=q)*k*((s+1)*k-s)+m},easeOutBack:function(n,k,m,p,q,s){if(s==d)s=1.70158;return p*((k=k/q-1)*k*((s+1)*k+s)+1)+m},easeInOutBack:function(n,k,m,p,q,s){if(s==d)s=1.70158;
if((k/=q/2)<1)return p/2*k*k*(((s*=1.525)+1)*k-s)+m;return p/2*((k-=2)*k*(((s*=1.525)+1)*k+s)+2)+m},easeInBounce:function(n,k,m,p,q){return p-a.easing.easeOutBounce(n,q-k,0,p,q)+m},easeOutBounce:function(n,k,m,p,q){return(k/=q)<1/2.75?p*7.5625*k*k+m:k<2/2.75?p*(7.5625*(k-=1.5/2.75)*k+0.75)+m:k<2.5/2.75?p*(7.5625*(k-=2.25/2.75)*k+0.9375)+m:p*(7.5625*(k-=2.625/2.75)*k+0.984375)+m},easeInOutBounce:function(n,k,m,p,q){if(k<q/2)return a.easing.easeInBounce(n,k*2,0,p,q)*0.5+m;return a.easing.easeOutBounce(n,
k*2-q,0,p,q)*0.5+p*0.5+m}})}(jQuery);
(function(a){a.effects.blind=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right"],h=a.effects.setMode(c,d.options.mode||"hide"),g=d.options.direction||"vertical";a.effects.save(c,e);c.show();var i=a.effects.createWrapper(c).css({overflow:"hidden"}),b=g=="vertical"?"height":"width";g=g=="vertical"?i.height():i.width();h=="show"&&i.css(b,0);var f={};f[b]=h=="show"?g:0;i.animate(f,d.duration,d.options.easing,function(){h=="hide"&&c.hide();a.effects.restore(c,
e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(c[0],arguments);c.dequeue()})})}})(jQuery);
(function(a){a.effects.bounce=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right"],h=a.effects.setMode(c,d.options.mode||"effect"),g=d.options.direction||"up",i=d.options.distance||20,b=d.options.times||5,f=d.duration||250;/show|hide/.test(h)&&e.push("opacity");a.effects.save(c,e);c.show();a.effects.createWrapper(c);var j=g=="up"||g=="down"?"top":"left";g=g=="up"||g=="left"?"pos":"neg";i=d.options.distance||(j=="top"?c.outerHeight({margin:true})/3:c.outerWidth({margin:true})/
3);if(h=="show")c.css("opacity",0).css(j,g=="pos"?-i:i);if(h=="hide")i/=b*2;h!="hide"&&b--;if(h=="show"){var l={opacity:1};l[j]=(g=="pos"?"+=":"-=")+i;c.animate(l,f/2,d.options.easing);i/=2;b--}for(l=0;l<b;l++){var o={},n={};o[j]=(g=="pos"?"-=":"+=")+i;n[j]=(g=="pos"?"+=":"-=")+i;c.animate(o,f/2,d.options.easing).animate(n,f/2,d.options.easing);i=h=="hide"?i*2:i/2}if(h=="hide"){l={opacity:0};l[j]=(g=="pos"?"-=":"+=")+i;c.animate(l,f/2,d.options.easing,function(){c.hide();a.effects.restore(c,e);a.effects.removeWrapper(c);
d.callback&&d.callback.apply(this,arguments)})}else{o={};n={};o[j]=(g=="pos"?"-=":"+=")+i;n[j]=(g=="pos"?"+=":"-=")+i;c.animate(o,f/2,d.options.easing).animate(n,f/2,d.options.easing,function(){a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(this,arguments)})}c.queue("fx",function(){c.dequeue()});c.dequeue()})}})(jQuery);
(function(a){a.effects.clip=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right","height","width"],h=a.effects.setMode(c,d.options.mode||"hide"),g=d.options.direction||"vertical";a.effects.save(c,e);c.show();var i=a.effects.createWrapper(c).css({overflow:"hidden"});i=c[0].tagName=="IMG"?i:c;var b={size:g=="vertical"?"height":"width",position:g=="vertical"?"top":"left"};g=g=="vertical"?i.height():i.width();if(h=="show"){i.css(b.size,0);i.css(b.position,
g/2)}var f={};f[b.size]=h=="show"?g:0;f[b.position]=h=="show"?0:g/2;i.animate(f,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){h=="hide"&&c.hide();a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(c[0],arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.drop=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right","opacity"],h=a.effects.setMode(c,d.options.mode||"hide"),g=d.options.direction||"left";a.effects.save(c,e);c.show();a.effects.createWrapper(c);var i=g=="up"||g=="down"?"top":"left";g=g=="up"||g=="left"?"pos":"neg";var b=d.options.distance||(i=="top"?c.outerHeight({margin:true})/2:c.outerWidth({margin:true})/2);if(h=="show")c.css("opacity",0).css(i,g=="pos"?-b:b);var f={opacity:h==
"show"?1:0};f[i]=(h=="show"?g=="pos"?"+=":"-=":g=="pos"?"-=":"+=")+b;c.animate(f,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){h=="hide"&&c.hide();a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.explode=function(d){return this.queue(function(){var c=d.options.pieces?Math.round(Math.sqrt(d.options.pieces)):3,e=d.options.pieces?Math.round(Math.sqrt(d.options.pieces)):3;d.options.mode=d.options.mode=="toggle"?a(this).is(":visible")?"hide":"show":d.options.mode;var h=a(this).show().css("visibility","hidden"),g=h.offset();g.top-=parseInt(h.css("marginTop"),10)||0;g.left-=parseInt(h.css("marginLeft"),10)||0;for(var i=h.outerWidth(true),b=h.outerHeight(true),f=0;f<c;f++)for(var j=
0;j<e;j++)h.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-j*(i/e),top:-f*(b/c)}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:i/e,height:b/c,left:g.left+j*(i/e)+(d.options.mode=="show"?(j-Math.floor(e/2))*(i/e):0),top:g.top+f*(b/c)+(d.options.mode=="show"?(f-Math.floor(c/2))*(b/c):0),opacity:d.options.mode=="show"?0:1}).animate({left:g.left+j*(i/e)+(d.options.mode=="show"?0:(j-Math.floor(e/2))*(i/e)),top:g.top+
f*(b/c)+(d.options.mode=="show"?0:(f-Math.floor(c/2))*(b/c)),opacity:d.options.mode=="show"?1:0},d.duration||500);setTimeout(function(){d.options.mode=="show"?h.css({visibility:"visible"}):h.css({visibility:"visible"}).hide();d.callback&&d.callback.apply(h[0]);h.dequeue();a("div.ui-effects-explode").remove()},d.duration||500)})}})(jQuery);
(function(a){a.effects.fade=function(d){return this.queue(function(){var c=a(this),e=a.effects.setMode(c,d.options.mode||"hide");c.animate({opacity:e},{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){d.callback&&d.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.fold=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right"],h=a.effects.setMode(c,d.options.mode||"hide"),g=d.options.size||15,i=!!d.options.horizFirst,b=d.duration?d.duration/2:a.fx.speeds._default/2;a.effects.save(c,e);c.show();var f=a.effects.createWrapper(c).css({overflow:"hidden"}),j=h=="show"!=i,l=j?["width","height"]:["height","width"];j=j?[f.width(),f.height()]:[f.height(),f.width()];var o=/([0-9]+)%/.exec(g);if(o)g=parseInt(o[1],
10)/100*j[h=="hide"?0:1];if(h=="show")f.css(i?{height:0,width:g}:{height:g,width:0});i={};o={};i[l[0]]=h=="show"?j[0]:g;o[l[1]]=h=="show"?j[1]:0;f.animate(i,b,d.options.easing).animate(o,b,d.options.easing,function(){h=="hide"&&c.hide();a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(c[0],arguments);c.dequeue()})})}})(jQuery);
(function(a){a.effects.highlight=function(d){return this.queue(function(){var c=a(this),e=["backgroundImage","backgroundColor","opacity"],h=a.effects.setMode(c,d.options.mode||"show"),g={backgroundColor:c.css("backgroundColor")};if(h=="hide")g.opacity=0;a.effects.save(c,e);c.show().css({backgroundImage:"none",backgroundColor:d.options.color||"#ffff99"}).animate(g,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){h=="hide"&&c.hide();a.effects.restore(c,e);h=="show"&&!a.support.opacity&&
this.style.removeAttribute("filter");d.callback&&d.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.pulsate=function(d){return this.queue(function(){var c=a(this),e=a.effects.setMode(c,d.options.mode||"show");times=(d.options.times||5)*2-1;duration=d.duration?d.duration/2:a.fx.speeds._default/2;isVisible=c.is(":visible");animateTo=0;if(!isVisible){c.css("opacity",0).show();animateTo=1}if(e=="hide"&&isVisible||e=="show"&&!isVisible)times--;for(e=0;e<times;e++){c.animate({opacity:animateTo},duration,d.options.easing);animateTo=(animateTo+1)%2}c.animate({opacity:animateTo},duration,
d.options.easing,function(){animateTo==0&&c.hide();d.callback&&d.callback.apply(this,arguments)});c.queue("fx",function(){c.dequeue()}).dequeue()})}})(jQuery);
(function(a){a.effects.puff=function(d){return this.queue(function(){var c=a(this),e=a.effects.setMode(c,d.options.mode||"hide"),h=parseInt(d.options.percent,10)||150,g=h/100,i={height:c.height(),width:c.width()};a.extend(d.options,{fade:true,mode:e,percent:e=="hide"?h:100,from:e=="hide"?i:{height:i.height*g,width:i.width*g}});c.effect("scale",d.options,d.duration,d.callback);c.dequeue()})};a.effects.scale=function(d){return this.queue(function(){var c=a(this),e=a.extend(true,{},d.options),h=a.effects.setMode(c,
d.options.mode||"effect"),g=parseInt(d.options.percent,10)||(parseInt(d.options.percent,10)==0?0:h=="hide"?0:100),i=d.options.direction||"both",b=d.options.origin;if(h!="effect"){e.origin=b||["middle","center"];e.restore=true}b={height:c.height(),width:c.width()};c.from=d.options.from||(h=="show"?{height:0,width:0}:b);g={y:i!="horizontal"?g/100:1,x:i!="vertical"?g/100:1};c.to={height:b.height*g.y,width:b.width*g.x};if(d.options.fade){if(h=="show"){c.from.opacity=0;c.to.opacity=1}if(h=="hide"){c.from.opacity=
1;c.to.opacity=0}}e.from=c.from;e.to=c.to;e.mode=h;c.effect("size",e,d.duration,d.callback);c.dequeue()})};a.effects.size=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right","width","height","overflow","opacity"],h=["position","top","bottom","left","right","overflow","opacity"],g=["width","height","overflow"],i=["fontSize"],b=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],f=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],
j=a.effects.setMode(c,d.options.mode||"effect"),l=d.options.restore||false,o=d.options.scale||"both",n=d.options.origin,k={height:c.height(),width:c.width()};c.from=d.options.from||k;c.to=d.options.to||k;if(n){n=a.effects.getBaseline(n,k);c.from.top=(k.height-c.from.height)*n.y;c.from.left=(k.width-c.from.width)*n.x;c.to.top=(k.height-c.to.height)*n.y;c.to.left=(k.width-c.to.width)*n.x}var m={from:{y:c.from.height/k.height,x:c.from.width/k.width},to:{y:c.to.height/k.height,x:c.to.width/k.width}};
if(o=="box"||o=="both"){if(m.from.y!=m.to.y){e=e.concat(b);c.from=a.effects.setTransition(c,b,m.from.y,c.from);c.to=a.effects.setTransition(c,b,m.to.y,c.to)}if(m.from.x!=m.to.x){e=e.concat(f);c.from=a.effects.setTransition(c,f,m.from.x,c.from);c.to=a.effects.setTransition(c,f,m.to.x,c.to)}}if(o=="content"||o=="both")if(m.from.y!=m.to.y){e=e.concat(i);c.from=a.effects.setTransition(c,i,m.from.y,c.from);c.to=a.effects.setTransition(c,i,m.to.y,c.to)}a.effects.save(c,l?e:h);c.show();a.effects.createWrapper(c);
c.css("overflow","hidden").css(c.from);if(o=="content"||o=="both"){b=b.concat(["marginTop","marginBottom"]).concat(i);f=f.concat(["marginLeft","marginRight"]);g=e.concat(b).concat(f);c.find("*[width]").each(function(){child=a(this);l&&a.effects.save(child,g);var p={height:child.height(),width:child.width()};child.from={height:p.height*m.from.y,width:p.width*m.from.x};child.to={height:p.height*m.to.y,width:p.width*m.to.x};if(m.from.y!=m.to.y){child.from=a.effects.setTransition(child,b,m.from.y,child.from);
child.to=a.effects.setTransition(child,b,m.to.y,child.to)}if(m.from.x!=m.to.x){child.from=a.effects.setTransition(child,f,m.from.x,child.from);child.to=a.effects.setTransition(child,f,m.to.x,child.to)}child.css(child.from);child.animate(child.to,d.duration,d.options.easing,function(){l&&a.effects.restore(child,g)})})}c.animate(c.to,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){c.to.opacity===0&&c.css("opacity",c.from.opacity);j=="hide"&&c.hide();a.effects.restore(c,
l?e:h);a.effects.removeWrapper(c);d.callback&&d.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.shake=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right"];a.effects.setMode(c,d.options.mode||"effect");var h=d.options.direction||"left",g=d.options.distance||20,i=d.options.times||3,b=d.duration||d.options.duration||140;a.effects.save(c,e);c.show();a.effects.createWrapper(c);var f=h=="up"||h=="down"?"top":"left",j=h=="up"||h=="left"?"pos":"neg";h={};var l={},o={};h[f]=(j=="pos"?"-=":"+=")+g;l[f]=(j=="pos"?"+=":"-=")+g*2;o[f]=
(j=="pos"?"-=":"+=")+g*2;c.animate(h,b,d.options.easing);for(g=1;g<i;g++)c.animate(l,b,d.options.easing).animate(o,b,d.options.easing);c.animate(l,b,d.options.easing).animate(h,b/2,d.options.easing,function(){a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(this,arguments)});c.queue("fx",function(){c.dequeue()});c.dequeue()})}})(jQuery);
(function(a){a.effects.slide=function(d){return this.queue(function(){var c=a(this),e=["position","top","bottom","left","right"],h=a.effects.setMode(c,d.options.mode||"show"),g=d.options.direction||"left";a.effects.save(c,e);c.show();a.effects.createWrapper(c).css({overflow:"hidden"});var i=g=="up"||g=="down"?"top":"left";g=g=="up"||g=="left"?"pos":"neg";var b=d.options.distance||(i=="top"?c.outerHeight({margin:true}):c.outerWidth({margin:true}));if(h=="show")c.css(i,g=="pos"?isNaN(b)?"-"+b:-b:b);
var f={};f[i]=(h=="show"?g=="pos"?"+=":"-=":g=="pos"?"-=":"+=")+b;c.animate(f,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){h=="hide"&&c.hide();a.effects.restore(c,e);a.effects.removeWrapper(c);d.callback&&d.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);
(function(a){a.effects.transfer=function(d){return this.queue(function(){var c=a(this),e=a(d.options.to),h=e.offset();e={top:h.top,left:h.left,height:e.innerHeight(),width:e.innerWidth()};h=c.offset();var g=a('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(d.options.className).css({top:h.top,left:h.left,height:c.innerHeight(),width:c.innerWidth(),position:"absolute"}).animate(e,d.duration,d.options.easing,function(){g.remove();d.callback&&d.callback.apply(c[0],arguments);
c.dequeue()})})}})(jQuery);
(function(a){a.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:true,clearStyle:false,collapsible:false,event:"click",fillSpace:false,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var d=this,c=d.options;d.running=0;d.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix");d.headers=
d.element.find(c.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){c.disabled||a(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){c.disabled||a(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){c.disabled||a(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){c.disabled||a(this).removeClass("ui-state-focus")});d.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");
if(c.navigation){var e=d.element.find("a").filter(c.navigationFilter).eq(0);if(e.length){var h=e.closest(".ui-accordion-header");d.active=h.length?h:e.closest(".ui-accordion-content").prev()}}d.active=d._findActive(d.active||c.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top");d.active.next().addClass("ui-accordion-content-active");d._createIcons();d.resize();d.element.attr("role","tablist");d.headers.attr("role","tab").bind("keydown.accordion",
function(g){return d._keydown(g)}).next().attr("role","tabpanel");d.headers.not(d.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide();d.active.length?d.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}):d.headers.eq(0).attr("tabIndex",0);a.browser.safari||d.headers.find("a").attr("tabIndex",-1);c.event&&d.headers.bind(c.event.split(" ").join(".accordion ")+".accordion",function(g){d._clickHandler.call(d,g,this);g.preventDefault()})},_createIcons:function(){var d=
this.options;if(d.icons){a("<span></span>").addClass("ui-icon "+d.icons.header).prependTo(this.headers);this.active.children(".ui-icon").toggleClass(d.icons.header).toggleClass(d.icons.headerSelected);this.element.addClass("ui-accordion-icons")}},_destroyIcons:function(){this.headers.children(".ui-icon").remove();this.element.removeClass("ui-accordion-icons")},destroy:function(){var d=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex");
this.headers.find("a").removeAttr("tabIndex");this._destroyIcons();var c=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");if(d.autoHeight||d.fillHeight)c.css("height","");return a.Widget.prototype.destroy.call(this)},_setOption:function(d,c){a.Widget.prototype._setOption.apply(this,arguments);d=="active"&&this.activate(c);if(d=="icons"){this._destroyIcons();
c&&this._createIcons()}if(d=="disabled")this.headers.add(this.headers.next())[c?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")},_keydown:function(d){if(!(this.options.disabled||d.altKey||d.ctrlKey)){var c=a.ui.keyCode,e=this.headers.length,h=this.headers.index(d.target),g=false;switch(d.keyCode){case c.RIGHT:case c.DOWN:g=this.headers[(h+1)%e];break;case c.LEFT:case c.UP:g=this.headers[(h-1+e)%e];break;case c.SPACE:case c.ENTER:this._clickHandler({target:d.target},d.target);
d.preventDefault()}if(g){a(d.target).attr("tabIndex",-1);a(g).attr("tabIndex",0);g.focus();return false}return true}},resize:function(){var d=this.options,c;if(d.fillSpace){if(a.browser.msie){var e=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}c=this.element.parent().height();a.browser.msie&&this.element.parent().css("overflow",e);this.headers.each(function(){c-=a(this).outerHeight(true)});this.headers.next().each(function(){a(this).height(Math.max(0,c-a(this).innerHeight()+
a(this).height()))}).css("overflow","auto")}else if(d.autoHeight){c=0;this.headers.next().each(function(){c=Math.max(c,a(this).height("").height())}).height(c)}return this},activate:function(d){this.options.active=d;d=this._findActive(d)[0];this._clickHandler({target:d},d);return this},_findActive:function(d){return d?typeof d==="number"?this.headers.filter(":eq("+d+")"):this.headers.not(this.headers.not(d)):d===false?a([]):this.headers.filter(":eq(0)")},_clickHandler:function(d,c){var e=this.options;
if(!e.disabled)if(d.target){d=a(d.currentTarget||c);c=d[0]===this.active[0];e.active=e.collapsible&&c?false:this.headers.index(d);if(!(this.running||!e.collapsible&&c)){var h=this.active;f=d.next();i=this.active.next();b={options:e,newHeader:c&&e.collapsible?a([]):d,oldHeader:this.active,newContent:c&&e.collapsible?a([]):f,oldContent:i};var g=this.headers.index(this.active[0])>this.headers.index(d[0]);this.active=c?a([]):d;this._toggle(f,i,b,c,g);h.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(e.icons.headerSelected).addClass(e.icons.header);
if(!c){d.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(e.icons.header).addClass(e.icons.headerSelected);d.next().addClass("ui-accordion-content-active")}}}else if(e.collapsible){this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(e.icons.headerSelected).addClass(e.icons.header);this.active.next().addClass("ui-accordion-content-active");var i=this.active.next(),
b={options:e,newHeader:a([]),oldHeader:e.active,newContent:a([]),oldContent:i},f=this.active=a([]);this._toggle(f,i,b)}},_toggle:function(d,c,e,h,g){var i=this,b=i.options;i.toShow=d;i.toHide=c;i.data=e;var f=function(){if(i)return i._completed.apply(i,arguments)};i._trigger("changestart",null,i.data);i.running=c.size()===0?d.size():c.size();if(b.animated){e={};e=b.collapsible&&h?{toShow:a([]),toHide:c,complete:f,down:g,autoHeight:b.autoHeight||b.fillSpace}:{toShow:d,toHide:c,complete:f,down:g,autoHeight:b.autoHeight||
b.fillSpace};if(!b.proxied)b.proxied=b.animated;if(!b.proxiedDuration)b.proxiedDuration=b.duration;b.animated=a.isFunction(b.proxied)?b.proxied(e):b.proxied;b.duration=a.isFunction(b.proxiedDuration)?b.proxiedDuration(e):b.proxiedDuration;h=a.ui.accordion.animations;var j=b.duration,l=b.animated;if(l&&!h[l]&&!a.easing[l])l="slide";h[l]||(h[l]=function(o){this.slide(o,{easing:l,duration:j||700})});h[l](e)}else{if(b.collapsible&&h)d.toggle();else{c.hide();d.show()}f(true)}c.prev().attr({"aria-expanded":"false",
"aria-selected":"false",tabIndex:-1}).blur();d.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus()},_completed:function(d){this.running=d?0:--this.running;if(!this.running){this.options.clearStyle&&this.toShow.add(this.toHide).css({height:"",overflow:""});this.toHide.removeClass("ui-accordion-content-active");if(this.toHide.length)this.toHide.parent()[0].className=this.toHide.parent()[0].className;this._trigger("change",null,this.data)}}});a.extend(a.ui.accordion,{version:"1.8.16",
animations:{slide:function(d,c){d=a.extend({easing:"swing",duration:300},d,c);if(d.toHide.size())if(d.toShow.size()){var e=d.toShow.css("overflow"),h=0,g={},i={},b;c=d.toShow;b=c[0].style.width;c.width(parseInt(c.parent().width(),10)-parseInt(c.css("paddingLeft"),10)-parseInt(c.css("paddingRight"),10)-(parseInt(c.css("borderLeftWidth"),10)||0)-(parseInt(c.css("borderRightWidth"),10)||0));a.each(["height","paddingTop","paddingBottom"],function(f,j){i[j]="hide";f=(""+a.css(d.toShow[0],j)).match(/^([\d+-.]+)(.*)$/);
g[j]={value:f[1],unit:f[2]||"px"}});d.toShow.css({height:0,overflow:"hidden"}).show();d.toHide.filter(":hidden").each(d.complete).end().filter(":visible").animate(i,{step:function(f,j){if(j.prop=="height")h=j.end-j.start===0?0:(j.now-j.start)/(j.end-j.start);d.toShow[0].style[j.prop]=h*g[j.prop].value+g[j.prop].unit},duration:d.duration,easing:d.easing,complete:function(){d.autoHeight||d.toShow.css("height","");d.toShow.css({width:b,overflow:e});d.complete()}})}else d.toHide.animate({height:"hide",
paddingTop:"hide",paddingBottom:"hide"},d);else d.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},d)},bounceslide:function(d){this.slide(d,{easing:d.down?"easeOutBounce":"swing",duration:d.down?1E3:200})}}})})(jQuery);
(function(a){var d=0;a.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var c=this,e=this.element[0].ownerDocument,h;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(g){if(!(c.options.disabled||c.element.propAttr("readOnly"))){h=
false;var i=a.ui.keyCode;switch(g.keyCode){case i.PAGE_UP:c._move("previousPage",g);break;case i.PAGE_DOWN:c._move("nextPage",g);break;case i.UP:c._move("previous",g);g.preventDefault();break;case i.DOWN:c._move("next",g);g.preventDefault();break;case i.ENTER:case i.NUMPAD_ENTER:if(c.menu.active){h=true;g.preventDefault()}case i.TAB:if(!c.menu.active)return;c.menu.select(g);break;case i.ESCAPE:c.element.val(c.term);c.close(g);break;default:clearTimeout(c.searching);c.searching=setTimeout(function(){if(c.term!=
c.element.val()){c.selectedItem=null;c.search(null,g)}},c.options.delay);break}}}).bind("keypress.autocomplete",function(g){if(h){h=false;g.preventDefault()}}).bind("focus.autocomplete",function(){if(!c.options.disabled){c.selectedItem=null;c.previous=c.element.val()}}).bind("blur.autocomplete",function(g){if(!c.options.disabled){clearTimeout(c.searching);c.closing=setTimeout(function(){c.close(g);c._change(g)},150)}});this._initSource();this.response=function(){return c._response.apply(c,arguments)};
this.menu=a("<ul></ul>").addClass("ui-autocomplete").appendTo(a(this.options.appendTo||"body",e)[0]).mousedown(function(g){var i=c.menu.element[0];a(g.target).closest(".ui-menu-item").length||setTimeout(function(){a(document).one("mousedown",function(b){b.target!==c.element[0]&&b.target!==i&&!a.ui.contains(i,b.target)&&c.close()})},1);setTimeout(function(){clearTimeout(c.closing)},13)}).menu({focus:function(g,i){i=i.item.data("item.autocomplete");false!==c._trigger("focus",g,{item:i})&&/^key/.test(g.originalEvent.type)&&
c.element.val(i.value)},selected:function(g,i){var b=i.item.data("item.autocomplete"),f=c.previous;if(c.element[0]!==e.activeElement){c.element.focus();c.previous=f;setTimeout(function(){c.previous=f;c.selectedItem=b},1)}false!==c._trigger("select",g,{item:b})&&c.element.val(b.value);c.term=c.element.val();c.close(g);c.selectedItem=b},blur:function(){c.menu.element.is(":visible")&&c.element.val()!==c.term&&c.element.val(c.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");
a.fn.bgiframe&&this.menu.element.bgiframe()},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");this.menu.element.remove();a.Widget.prototype.destroy.call(this)},_setOption:function(c,e){a.Widget.prototype._setOption.apply(this,arguments);c==="source"&&this._initSource();if(c==="appendTo")this.menu.element.appendTo(a(e||"body",this.element[0].ownerDocument)[0]);c==="disabled"&&
e&&this.xhr&&this.xhr.abort()},_initSource:function(){var c=this,e,h;if(a.isArray(this.options.source)){e=this.options.source;this.source=function(g,i){i(a.ui.autocomplete.filter(e,g.term))}}else if(typeof this.options.source==="string"){h=this.options.source;this.source=function(g,i){c.xhr&&c.xhr.abort();c.xhr=a.ajax({url:h,data:g,dataType:"json",autocompleteRequest:++d,success:function(b){this.autocompleteRequest===d&&i(b)},error:function(){this.autocompleteRequest===d&&i([])}})}}else this.source=
this.options.source},search:function(c,e){c=c!=null?c:this.element.val();this.term=this.element.val();if(c.length<this.options.minLength)return this.close(e);clearTimeout(this.closing);if(this._trigger("search",e)!==false)return this._search(c)},_search:function(c){this.pending++;this.element.addClass("ui-autocomplete-loading");this.source({term:c},this.response)},_response:function(c){if(!this.options.disabled&&c&&c.length){c=this._normalize(c);this._suggest(c);this._trigger("open")}else this.close();
this.pending--;this.pending||this.element.removeClass("ui-autocomplete-loading")},close:function(c){clearTimeout(this.closing);if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.deactivate();this._trigger("close",c)}},_change:function(c){this.previous!==this.element.val()&&this._trigger("change",c,{item:this.selectedItem})},_normalize:function(c){if(c.length&&c[0].label&&c[0].value)return c;return a.map(c,function(e){if(typeof e==="string")return{label:e,value:e};return a.extend({label:e.label||
e.value,value:e.value||e.label},e)})},_suggest:function(c){var e=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(e,c);this.menu.deactivate();this.menu.refresh();e.show();this._resizeMenu();e.position(a.extend({of:this.element},this.options.position));this.options.autoFocus&&this.menu.next(new a.Event("mouseover"))},_resizeMenu:function(){var c=this.menu.element;c.outerWidth(Math.max(c.width("").outerWidth(),this.element.outerWidth()))},_renderMenu:function(c,e){var h=this;
a.each(e,function(g,i){h._renderItem(c,i)})},_renderItem:function(c,e){return a("<li></li>").data("item.autocomplete",e).append(a("<a></a>").text(e.label)).appendTo(c)},_move:function(c,e){if(this.menu.element.is(":visible"))if(this.menu.first()&&/^previous/.test(c)||this.menu.last()&&/^next/.test(c)){this.element.val(this.term);this.menu.deactivate()}else this.menu[c](e);else this.search(null,e)},widget:function(){return this.menu.element}});a.extend(a.ui.autocomplete,{escapeRegex:function(c){return c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,
"\\$&")},filter:function(c,e){var h=new RegExp(a.ui.autocomplete.escapeRegex(e),"i");return a.grep(c,function(g){return h.test(g.label||g.value||g)})}})})(jQuery);
(function(a){a.widget("ui.menu",{_create:function(){var d=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(c){if(a(c.target).closest(".ui-menu-item a").length){c.preventDefault();d.select(c)}});this.refresh()},refresh:function(){var d=this;this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem").children("a").addClass("ui-corner-all").attr("tabindex",
-1).mouseenter(function(c){d.activate(c,a(this).parent())}).mouseleave(function(){d.deactivate()})},activate:function(d,c){this.deactivate();if(this.hasScroll()){var e=c.offset().top-this.element.offset().top,h=this.element.scrollTop(),g=this.element.height();if(e<0)this.element.scrollTop(h+e);else e>=g&&this.element.scrollTop(h+e-g+c.height())}this.active=c.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",d,{item:c})},deactivate:function(){if(this.active){this.active.children("a").removeClass("ui-state-hover").removeAttr("id");
this._trigger("blur");this.active=null}},next:function(d){this.move("next",".ui-menu-item:first",d)},previous:function(d){this.move("prev",".ui-menu-item:last",d)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(d,c,e){if(this.active){d=this.active[d+"All"](".ui-menu-item").eq(0);d.length?this.activate(e,d):this.activate(e,this.element.children(c))}else this.activate(e,
this.element.children(c))},nextPage:function(d){if(this.hasScroll())if(!this.active||this.last())this.activate(d,this.element.children(".ui-menu-item:first"));else{var c=this.active.offset().top,e=this.element.height(),h=this.element.children(".ui-menu-item").filter(function(){var g=a(this).offset().top-c-e+a(this).height();return g<10&&g>-10});h.length||(h=this.element.children(".ui-menu-item:last"));this.activate(d,h)}else this.activate(d,this.element.children(".ui-menu-item").filter(!this.active||
this.last()?":first":":last"))},previousPage:function(d){if(this.hasScroll())if(!this.active||this.first())this.activate(d,this.element.children(".ui-menu-item:last"));else{var c=this.active.offset().top,e=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var h=a(this).offset().top-c+e-a(this).height();return h<10&&h>-10});result.length||(result=this.element.children(".ui-menu-item:first"));this.activate(d,result)}else this.activate(d,this.element.children(".ui-menu-item").filter(!this.active||
this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[a.fn.prop?"prop":"attr"]("scrollHeight")},select:function(d){this._trigger("selected",d,{item:this.active})}})})(jQuery);
(function(a){var d,c,e,h,g=function(){var b=a(this).find(":ui-button");setTimeout(function(){b.button("refresh")},1)},i=function(b){var f=b.name,j=b.form,l=a([]);if(f)l=j?a(j).find("[name='"+f+"']"):a("[name='"+f+"']",b.ownerDocument).filter(function(){return!this.form});return l};a.widget("ui.button",{options:{disabled:null,text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",g);if(typeof this.options.disabled!==
"boolean")this.options.disabled=this.element.propAttr("disabled");this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var b=this,f=this.options,j=this.type==="checkbox"||this.type==="radio",l="ui-state-hover"+(!j?" ui-state-active":"");if(f.label===null)f.label=this.buttonElement.html();if(this.element.is(":disabled"))f.disabled=true;this.buttonElement.addClass("ui-button ui-widget ui-state-default ui-corner-all").attr("role","button").bind("mouseenter.button",function(){if(!f.disabled){a(this).addClass("ui-state-hover");
this===d&&a(this).addClass("ui-state-active")}}).bind("mouseleave.button",function(){f.disabled||a(this).removeClass(l)}).bind("click.button",function(o){if(f.disabled){o.preventDefault();o.stopImmediatePropagation()}});this.element.bind("focus.button",function(){b.buttonElement.addClass("ui-state-focus")}).bind("blur.button",function(){b.buttonElement.removeClass("ui-state-focus")});if(j){this.element.bind("change.button",function(){h||b.refresh()});this.buttonElement.bind("mousedown.button",function(o){if(!f.disabled){h=
false;c=o.pageX;e=o.pageY}}).bind("mouseup.button",function(o){if(!f.disabled)if(c!==o.pageX||e!==o.pageY)h=true})}if(this.type==="checkbox")this.buttonElement.bind("click.button",function(){if(f.disabled||h)return false;a(this).toggleClass("ui-state-active");b.buttonElement.attr("aria-pressed",b.element[0].checked)});else if(this.type==="radio")this.buttonElement.bind("click.button",function(){if(f.disabled||h)return false;a(this).addClass("ui-state-active");b.buttonElement.attr("aria-pressed","true");
var o=b.element[0];i(o).not(o).map(function(){return a(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")});else{this.buttonElement.bind("mousedown.button",function(){if(f.disabled)return false;a(this).addClass("ui-state-active");d=this;a(document).one("mouseup",function(){d=null})}).bind("mouseup.button",function(){if(f.disabled)return false;a(this).removeClass("ui-state-active")}).bind("keydown.button",function(o){if(f.disabled)return false;if(o.keyCode==a.ui.keyCode.SPACE||
o.keyCode==a.ui.keyCode.ENTER)a(this).addClass("ui-state-active")}).bind("keyup.button",function(){a(this).removeClass("ui-state-active")});this.buttonElement.is("a")&&this.buttonElement.keyup(function(o){o.keyCode===a.ui.keyCode.SPACE&&a(this).click()})}this._setOption("disabled",f.disabled);this._resetButton()},_determineButtonType:function(){this.type=this.element.is(":checkbox")?"checkbox":this.element.is(":radio")?"radio":this.element.is("input")?"input":"button";if(this.type==="checkbox"||this.type===
"radio"){var b=this.element.parents().filter(":last"),f="label[for='"+this.element.attr("id")+"']";this.buttonElement=b.find(f);if(!this.buttonElement.length){b=b.length?b.siblings():this.element.siblings();this.buttonElement=b.filter(f);if(!this.buttonElement.length)this.buttonElement=b.find(f)}this.element.addClass("ui-helper-hidden-accessible");(b=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active");this.buttonElement.attr("aria-pressed",b)}else this.buttonElement=this.element},
widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-state-hover ui-state-active  ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only").removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());this.hasTitle||this.buttonElement.removeAttr("title");
a.Widget.prototype.destroy.call(this)},_setOption:function(b,f){a.Widget.prototype._setOption.apply(this,arguments);if(b==="disabled")f?this.element.propAttr("disabled",true):this.element.propAttr("disabled",false);else this._resetButton()},refresh:function(){var b=this.element.is(":disabled");b!==this.options.disabled&&this._setOption("disabled",b);if(this.type==="radio")i(this.element[0]).each(function(){a(this).is(":checked")?a(this).button("widget").addClass("ui-state-active").attr("aria-pressed",
"true"):a(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")});else if(this.type==="checkbox")this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false")},_resetButton:function(){if(this.type==="input")this.options.label&&this.element.val(this.options.label);else{var b=this.buttonElement.removeClass("ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only"),
f=a("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(b.empty()).text(),j=this.options.icons,l=j.primary&&j.secondary,o=[];if(j.primary||j.secondary){if(this.options.text)o.push("ui-button-text-icon"+(l?"s":j.primary?"-primary":"-secondary"));j.primary&&b.prepend("<span class='ui-button-icon-primary ui-icon "+j.primary+"'></span>");j.secondary&&b.append("<span class='ui-button-icon-secondary ui-icon "+j.secondary+"'></span>");if(!this.options.text){o.push(l?"ui-button-icons-only":
"ui-button-icon-only");this.hasTitle||b.attr("title",f)}}else o.push("ui-button-text-only");b.addClass(o.join(" "))}}});a.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(b,f){b==="disabled"&&this.buttons.button("option",b,f);a.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){var b=this.element.css("direction")===
"ltr";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(b?"ui-corner-left":"ui-corner-right").end().filter(":last").addClass(b?"ui-corner-right":"ui-corner-left").end().end()},destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");
a.Widget.prototype.destroy.call(this)}})})(jQuery);
(function(a,d){function c(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._inDialog=this._datepickerShowing=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass=
"ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su",
"Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:"c-10:c+10",showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",
minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};a.extend(this._defaults,this.regional[""]);this.dpDiv=e(a('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function e(b){return b.bind("mouseout",
function(f){f=a(f.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");f.length&&f.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(f){f=a(f.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");if(!(a.datepicker._isDisabledDatepicker(i.inline?b.parent()[0]:i.input[0])||!f.length)){f.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");
f.addClass("ui-state-hover");f.hasClass("ui-datepicker-prev")&&f.addClass("ui-datepicker-prev-hover");f.hasClass("ui-datepicker-next")&&f.addClass("ui-datepicker-next-hover")}})}function h(b,f){a.extend(b,f);for(var j in f)if(f[j]==null||f[j]==d)b[j]=f[j];return b}a.extend(a.ui,{datepicker:{version:"1.8.16"}});var g=(new Date).getTime(),i;a.extend(c.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},
setDefaults:function(b){h(this._defaults,b||{});return this},_attachDatepicker:function(b,f){var j=null;for(var l in this._defaults){var o=b.getAttribute("date:"+l);if(o){j=j||{};try{j[l]=eval(o)}catch(n){j[l]=o}}}l=b.nodeName.toLowerCase();o=l=="div"||l=="span";if(!b.id){this.uuid+=1;b.id="dp"+this.uuid}var k=this._newInst(a(b),o);k.settings=a.extend({},f||{},j||{});if(l=="input")this._connectDatepicker(b,k);else o&&this._inlineDatepicker(b,k)},_newInst:function(b,f){return{id:b[0].id.replace(/([^A-Za-z0-9_-])/g,
"\\\\$1"),input:b,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:f,dpDiv:!f?this.dpDiv:e(a('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}},_connectDatepicker:function(b,f){var j=a(b);f.append=a([]);f.trigger=a([]);if(!j.hasClass(this.markerClassName)){this._attachments(j,f);j.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",
function(l,o,n){f.settings[o]=n}).bind("getData.datepicker",function(l,o){return this._get(f,o)});this._autoSize(f);a.data(b,"datepicker",f);f.settings.disabled&&this._disableDatepicker(b)}},_attachments:function(b,f){var j=this._get(f,"appendText"),l=this._get(f,"isRTL");f.append&&f.append.remove();if(j){f.append=a('<span class="'+this._appendClass+'">'+j+"</span>");b[l?"before":"after"](f.append)}b.unbind("focus",this._showDatepicker);f.trigger&&f.trigger.remove();j=this._get(f,"showOn");if(j==
"focus"||j=="both")b.focus(this._showDatepicker);if(j=="button"||j=="both"){j=this._get(f,"buttonText");var o=this._get(f,"buttonImage");f.trigger=a(this._get(f,"buttonImageOnly")?a("<img/>").addClass(this._triggerClass).attr({src:o,alt:j,title:j}):a('<button type="button"></button>').addClass(this._triggerClass).html(o==""?j:a("<img/>").attr({src:o,alt:j,title:j})));b[l?"before":"after"](f.trigger);f.trigger.click(function(){a.datepicker._datepickerShowing&&a.datepicker._lastInput==b[0]?a.datepicker._hideDatepicker():
a.datepicker._showDatepicker(b[0]);return false})}},_autoSize:function(b){if(this._get(b,"autoSize")&&!b.inline){var f=new Date(2009,11,20),j=this._get(b,"dateFormat");if(j.match(/[DM]/)){var l=function(o){for(var n=0,k=0,m=0;m<o.length;m++)if(o[m].length>n){n=o[m].length;k=m}return k};f.setMonth(l(this._get(b,j.match(/MM/)?"monthNames":"monthNamesShort")));f.setDate(l(this._get(b,j.match(/DD/)?"dayNames":"dayNamesShort"))+20-f.getDay())}b.input.attr("size",this._formatDate(b,f).length)}},_inlineDatepicker:function(b,
f){var j=a(b);if(!j.hasClass(this.markerClassName)){j.addClass(this.markerClassName).append(f.dpDiv).bind("setData.datepicker",function(l,o,n){f.settings[o]=n}).bind("getData.datepicker",function(l,o){return this._get(f,o)});a.data(b,"datepicker",f);this._setDate(f,this._getDefaultDate(f),true);this._updateDatepicker(f);this._updateAlternate(f);f.settings.disabled&&this._disableDatepicker(b);f.dpDiv.css("display","block")}},_dialogDatepicker:function(b,f,j,l,o){b=this._dialogInst;if(!b){this.uuid+=
1;this._dialogInput=a('<input type="text" id="'+("dp"+this.uuid)+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>');this._dialogInput.keydown(this._doKeyDown);a("body").append(this._dialogInput);b=this._dialogInst=this._newInst(this._dialogInput,false);b.settings={};a.data(this._dialogInput[0],"datepicker",b)}h(b.settings,l||{});f=f&&f.constructor==Date?this._formatDate(b,f):f;this._dialogInput.val(f);this._pos=o?o.length?o:[o.pageX,o.pageY]:null;if(!this._pos)this._pos=[document.documentElement.clientWidth/
2-100+(document.documentElement.scrollLeft||document.body.scrollLeft),document.documentElement.clientHeight/2-150+(document.documentElement.scrollTop||document.body.scrollTop)];this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px");b.settings.onSelect=j;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);a.blockUI&&a.blockUI(this.dpDiv);a.data(this._dialogInput[0],"datepicker",b);return this},_destroyDatepicker:function(b){var f=
a(b),j=a.data(b,"datepicker");if(f.hasClass(this.markerClassName)){var l=b.nodeName.toLowerCase();a.removeData(b,"datepicker");if(l=="input"){j.append.remove();j.trigger.remove();f.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)}else if(l=="div"||l=="span")f.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(b){var f=a(b),j=a.data(b,"datepicker");if(f.hasClass(this.markerClassName)){var l=
b.nodeName.toLowerCase();if(l=="input"){b.disabled=false;j.trigger.filter("button").each(function(){this.disabled=false}).end().filter("img").css({opacity:"1.0",cursor:""})}else if(l=="div"||l=="span"){f=f.children("."+this._inlineClass);f.children().removeClass("ui-state-disabled");f.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")}this._disabledInputs=a.map(this._disabledInputs,function(o){return o==b?null:o})}},_disableDatepicker:function(b){var f=a(b),j=a.data(b,
"datepicker");if(f.hasClass(this.markerClassName)){var l=b.nodeName.toLowerCase();if(l=="input"){b.disabled=true;j.trigger.filter("button").each(function(){this.disabled=true}).end().filter("img").css({opacity:"0.5",cursor:"default"})}else if(l=="div"||l=="span"){f=f.children("."+this._inlineClass);f.children().addClass("ui-state-disabled");f.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")}this._disabledInputs=a.map(this._disabledInputs,function(o){return o==
b?null:o});this._disabledInputs[this._disabledInputs.length]=b}},_isDisabledDatepicker:function(b){if(!b)return false;for(var f=0;f<this._disabledInputs.length;f++)if(this._disabledInputs[f]==b)return true;return false},_getInst:function(b){try{return a.data(b,"datepicker")}catch(f){throw"Missing instance data for this datepicker";}},_optionDatepicker:function(b,f,j){var l=this._getInst(b);if(arguments.length==2&&typeof f=="string")return f=="defaults"?a.extend({},a.datepicker._defaults):l?f=="all"?
a.extend({},l.settings):this._get(l,f):null;var o=f||{};if(typeof f=="string"){o={};o[f]=j}if(l){this._curInst==l&&this._hideDatepicker();var n=this._getDateDatepicker(b,true),k=this._getMinMaxDate(l,"min"),m=this._getMinMaxDate(l,"max");h(l.settings,o);if(k!==null&&o.dateFormat!==d&&o.minDate===d)l.settings.minDate=this._formatDate(l,k);if(m!==null&&o.dateFormat!==d&&o.maxDate===d)l.settings.maxDate=this._formatDate(l,m);this._attachments(a(b),l);this._autoSize(l);this._setDate(l,n);this._updateAlternate(l);
this._updateDatepicker(l)}},_changeDatepicker:function(b,f,j){this._optionDatepicker(b,f,j)},_refreshDatepicker:function(b){(b=this._getInst(b))&&this._updateDatepicker(b)},_setDateDatepicker:function(b,f){if(b=this._getInst(b)){this._setDate(b,f);this._updateDatepicker(b);this._updateAlternate(b)}},_getDateDatepicker:function(b,f){(b=this._getInst(b))&&!b.inline&&this._setDateFromField(b,f);return b?this._getDate(b):null},_doKeyDown:function(b){var f=a.datepicker._getInst(b.target),j=true,l=f.dpDiv.is(".ui-datepicker-rtl");
f._keyEvent=true;if(a.datepicker._datepickerShowing)switch(b.keyCode){case 9:a.datepicker._hideDatepicker();j=false;break;case 13:j=a("td."+a.datepicker._dayOverClass+":not(."+a.datepicker._currentClass+")",f.dpDiv);j[0]&&a.datepicker._selectDay(b.target,f.selectedMonth,f.selectedYear,j[0]);if(b=a.datepicker._get(f,"onSelect")){j=a.datepicker._formatDate(f);b.apply(f.input?f.input[0]:null,[j,f])}else a.datepicker._hideDatepicker();return false;case 27:a.datepicker._hideDatepicker();break;case 33:a.datepicker._adjustDate(b.target,
b.ctrlKey?-a.datepicker._get(f,"stepBigMonths"):-a.datepicker._get(f,"stepMonths"),"M");break;case 34:a.datepicker._adjustDate(b.target,b.ctrlKey?+a.datepicker._get(f,"stepBigMonths"):+a.datepicker._get(f,"stepMonths"),"M");break;case 35:if(b.ctrlKey||b.metaKey)a.datepicker._clearDate(b.target);j=b.ctrlKey||b.metaKey;break;case 36:if(b.ctrlKey||b.metaKey)a.datepicker._gotoToday(b.target);j=b.ctrlKey||b.metaKey;break;case 37:if(b.ctrlKey||b.metaKey)a.datepicker._adjustDate(b.target,l?+1:-1,"D");j=
b.ctrlKey||b.metaKey;if(b.originalEvent.altKey)a.datepicker._adjustDate(b.target,b.ctrlKey?-a.datepicker._get(f,"stepBigMonths"):-a.datepicker._get(f,"stepMonths"),"M");break;case 38:if(b.ctrlKey||b.metaKey)a.datepicker._adjustDate(b.target,-7,"D");j=b.ctrlKey||b.metaKey;break;case 39:if(b.ctrlKey||b.metaKey)a.datepicker._adjustDate(b.target,l?-1:+1,"D");j=b.ctrlKey||b.metaKey;if(b.originalEvent.altKey)a.datepicker._adjustDate(b.target,b.ctrlKey?+a.datepicker._get(f,"stepBigMonths"):+a.datepicker._get(f,
"stepMonths"),"M");break;case 40:if(b.ctrlKey||b.metaKey)a.datepicker._adjustDate(b.target,+7,"D");j=b.ctrlKey||b.metaKey;break;default:j=false}else if(b.keyCode==36&&b.ctrlKey)a.datepicker._showDatepicker(this);else j=false;if(j){b.preventDefault();b.stopPropagation()}},_doKeyPress:function(b){var f=a.datepicker._getInst(b.target);if(a.datepicker._get(f,"constrainInput")){f=a.datepicker._possibleChars(a.datepicker._get(f,"dateFormat"));var j=String.fromCharCode(b.charCode==d?b.keyCode:b.charCode);
return b.ctrlKey||b.metaKey||j<" "||!f||f.indexOf(j)>-1}},_doKeyUp:function(b){b=a.datepicker._getInst(b.target);if(b.input.val()!=b.lastVal)try{if(a.datepicker.parseDate(a.datepicker._get(b,"dateFormat"),b.input?b.input.val():null,a.datepicker._getFormatConfig(b))){a.datepicker._setDateFromField(b);a.datepicker._updateAlternate(b);a.datepicker._updateDatepicker(b)}}catch(f){a.datepicker.log(f)}return true},_showDatepicker:function(b){b=b.target||b;if(b.nodeName.toLowerCase()!="input")b=a("input",
b.parentNode)[0];if(!(a.datepicker._isDisabledDatepicker(b)||a.datepicker._lastInput==b)){var f=a.datepicker._getInst(b);if(a.datepicker._curInst&&a.datepicker._curInst!=f){a.datepicker._datepickerShowing&&a.datepicker._triggerOnClose(a.datepicker._curInst);a.datepicker._curInst.dpDiv.stop(true,true)}var j=a.datepicker._get(f,"beforeShow");j=j?j.apply(b,[b,f]):{};if(j!==false){h(f.settings,j);f.lastVal=null;a.datepicker._lastInput=b;a.datepicker._setDateFromField(f);if(a.datepicker._inDialog)b.value=
"";if(!a.datepicker._pos){a.datepicker._pos=a.datepicker._findPos(b);a.datepicker._pos[1]+=b.offsetHeight}var l=false;a(b).parents().each(function(){l|=a(this).css("position")=="fixed";return!l});if(l&&a.browser.opera){a.datepicker._pos[0]-=document.documentElement.scrollLeft;a.datepicker._pos[1]-=document.documentElement.scrollTop}j={left:a.datepicker._pos[0],top:a.datepicker._pos[1]};a.datepicker._pos=null;f.dpDiv.empty();f.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});a.datepicker._updateDatepicker(f);
j=a.datepicker._checkOffset(f,j,l);f.dpDiv.css({position:a.datepicker._inDialog&&a.blockUI?"static":l?"fixed":"absolute",display:"none",left:j.left+"px",top:j.top+"px"});if(!f.inline){j=a.datepicker._get(f,"showAnim");var o=a.datepicker._get(f,"duration"),n=function(){var k=f.dpDiv.find("iframe.ui-datepicker-cover");if(k.length){var m=a.datepicker._getBorders(f.dpDiv);k.css({left:-m[0],top:-m[1],width:f.dpDiv.outerWidth(),height:f.dpDiv.outerHeight()})}};f.dpDiv.zIndex(a(b).zIndex()+1);a.datepicker._datepickerShowing=
true;a.effects&&a.effects[j]?f.dpDiv.show(j,a.datepicker._get(f,"showOptions"),o,n):f.dpDiv[j||"show"](j?o:null,n);if(!j||!o)n();f.input.is(":visible")&&!f.input.is(":disabled")&&f.input.focus();a.datepicker._curInst=f}}}},_updateDatepicker:function(b){this.maxRows=4;var f=a.datepicker._getBorders(b.dpDiv);i=b;b.dpDiv.empty().append(this._generateHTML(b));var j=b.dpDiv.find("iframe.ui-datepicker-cover");j.length&&j.css({left:-f[0],top:-f[1],width:b.dpDiv.outerWidth(),height:b.dpDiv.outerHeight()});
b.dpDiv.find("."+this._dayOverClass+" a").mouseover();f=this._getNumberOfMonths(b);j=f[1];b.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");j>1&&b.dpDiv.addClass("ui-datepicker-multi-"+j).css("width",17*j+"em");b.dpDiv[(f[0]!=1||f[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi");b.dpDiv[(this._get(b,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");b==a.datepicker._curInst&&a.datepicker._datepickerShowing&&b.input&&b.input.is(":visible")&&
!b.input.is(":disabled")&&b.input[0]!=document.activeElement&&b.input.focus();if(b.yearshtml){var l=b.yearshtml;setTimeout(function(){l===b.yearshtml&&b.yearshtml&&b.dpDiv.find("select.ui-datepicker-year:first").replaceWith(b.yearshtml);l=b.yearshtml=null},0)}},_getBorders:function(b){var f=function(j){return{thin:1,medium:2,thick:3}[j]||j};return[parseFloat(f(b.css("border-left-width"))),parseFloat(f(b.css("border-top-width")))]},_checkOffset:function(b,f,j){var l=b.dpDiv.outerWidth(),o=b.dpDiv.outerHeight(),
n=b.input?b.input.outerWidth():0,k=b.input?b.input.outerHeight():0,m=document.documentElement.clientWidth+a(document).scrollLeft(),p=document.documentElement.clientHeight+a(document).scrollTop();f.left-=this._get(b,"isRTL")?l-n:0;f.left-=j&&f.left==b.input.offset().left?a(document).scrollLeft():0;f.top-=j&&f.top==b.input.offset().top+k?a(document).scrollTop():0;f.left-=Math.min(f.left,f.left+l>m&&m>l?Math.abs(f.left+l-m):0);f.top-=Math.min(f.top,f.top+o>p&&p>o?Math.abs(o+k):0);return f},_findPos:function(b){for(var f=
this._get(this._getInst(b),"isRTL");b&&(b.type=="hidden"||b.nodeType!=1||a.expr.filters.hidden(b));)b=b[f?"previousSibling":"nextSibling"];b=a(b).offset();return[b.left,b.top]},_triggerOnClose:function(b){var f=this._get(b,"onClose");if(f)f.apply(b.input?b.input[0]:null,[b.input?b.input.val():"",b])},_hideDatepicker:function(b){var f=this._curInst;if(!(!f||b&&f!=a.data(b,"datepicker")))if(this._datepickerShowing){b=this._get(f,"showAnim");var j=this._get(f,"duration"),l=function(){a.datepicker._tidyDialog(f);
this._curInst=null};a.effects&&a.effects[b]?f.dpDiv.hide(b,a.datepicker._get(f,"showOptions"),j,l):f.dpDiv[b=="slideDown"?"slideUp":b=="fadeIn"?"fadeOut":"hide"](b?j:null,l);b||l();a.datepicker._triggerOnClose(f);this._datepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if(a.blockUI){a.unblockUI();a("body").append(this.dpDiv)}}this._inDialog=false}},_tidyDialog:function(b){b.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},
_checkExternalClick:function(b){if(a.datepicker._curInst){b=a(b.target);b[0].id!=a.datepicker._mainDivId&&b.parents("#"+a.datepicker._mainDivId).length==0&&!b.hasClass(a.datepicker.markerClassName)&&!b.hasClass(a.datepicker._triggerClass)&&a.datepicker._datepickerShowing&&!(a.datepicker._inDialog&&a.blockUI)&&a.datepicker._hideDatepicker()}},_adjustDate:function(b,f,j){b=a(b);var l=this._getInst(b[0]);if(!this._isDisabledDatepicker(b[0])){this._adjustInstDate(l,f+(j=="M"?this._get(l,"showCurrentAtPos"):
0),j);this._updateDatepicker(l)}},_gotoToday:function(b){b=a(b);var f=this._getInst(b[0]);if(this._get(f,"gotoCurrent")&&f.currentDay){f.selectedDay=f.currentDay;f.drawMonth=f.selectedMonth=f.currentMonth;f.drawYear=f.selectedYear=f.currentYear}else{var j=new Date;f.selectedDay=j.getDate();f.drawMonth=f.selectedMonth=j.getMonth();f.drawYear=f.selectedYear=j.getFullYear()}this._notifyChange(f);this._adjustDate(b)},_selectMonthYear:function(b,f,j){b=a(b);var l=this._getInst(b[0]);l["selected"+(j=="M"?
"Month":"Year")]=l["draw"+(j=="M"?"Month":"Year")]=parseInt(f.options[f.selectedIndex].value,10);this._notifyChange(l);this._adjustDate(b)},_selectDay:function(b,f,j,l){var o=a(b);if(!(a(l).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0]))){o=this._getInst(o[0]);o.selectedDay=o.currentDay=a("a",l).html();o.selectedMonth=o.currentMonth=f;o.selectedYear=o.currentYear=j;this._selectDate(b,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear))}},_clearDate:function(b){b=a(b);
this._getInst(b[0]);this._selectDate(b,"")},_selectDate:function(b,f){b=this._getInst(a(b)[0]);f=f!=null?f:this._formatDate(b);b.input&&b.input.val(f);this._updateAlternate(b);var j=this._get(b,"onSelect");if(j)j.apply(b.input?b.input[0]:null,[f,b]);else b.input&&b.input.trigger("change");if(b.inline)this._updateDatepicker(b);else{this._hideDatepicker();this._lastInput=b.input[0];typeof b.input[0]!="object"&&b.input.focus();this._lastInput=null}},_updateAlternate:function(b){var f=this._get(b,"altField");
if(f){var j=this._get(b,"altFormat")||this._get(b,"dateFormat"),l=this._getDate(b),o=this.formatDate(j,l,this._getFormatConfig(b));a(f).each(function(){a(this).val(o)})}},noWeekends:function(b){b=b.getDay();return[b>0&&b<6,""]},iso8601Week:function(b){b=new Date(b.getTime());b.setDate(b.getDate()+4-(b.getDay()||7));var f=b.getTime();b.setMonth(0);b.setDate(1);return Math.floor(Math.round((f-b)/864E5)/7)+1},parseDate:function(b,f,j){if(b==null||f==null)throw"Invalid arguments";f=typeof f=="object"?
f.toString():f+"";if(f=="")return null;var l=(j?j.shortYearCutoff:null)||this._defaults.shortYearCutoff;l=typeof l!="string"?l:(new Date).getFullYear()%100+parseInt(l,10);for(var o=(j?j.dayNamesShort:null)||this._defaults.dayNamesShort,n=(j?j.dayNames:null)||this._defaults.dayNames,k=(j?j.monthNamesShort:null)||this._defaults.monthNamesShort,m=(j?j.monthNames:null)||this._defaults.monthNames,p=j=-1,q=-1,s=-1,r=false,u=function(z){(z=H+1<b.length&&b.charAt(H+1)==z)&&H++;return z},v=function(z){var I=
u(z);z=new RegExp("^\\d{1,"+(z=="@"?14:z=="!"?20:z=="y"&&I?4:z=="o"?3:2)+"}");z=f.substring(y).match(z);if(!z)throw"Missing number at position "+y;y+=z[0].length;return parseInt(z[0],10)},w=function(z,I,N){z=a.map(u(z)?N:I,function(D,E){return[[E,D]]}).sort(function(D,E){return-(D[1].length-E[1].length)});var J=-1;a.each(z,function(D,E){D=E[1];if(f.substr(y,D.length).toLowerCase()==D.toLowerCase()){J=E[0];y+=D.length;return false}});if(J!=-1)return J+1;else throw"Unknown name at position "+y;},x=
function(){if(f.charAt(y)!=b.charAt(H))throw"Unexpected literal at position "+y;y++},y=0,H=0;H<b.length;H++)if(r)if(b.charAt(H)=="'"&&!u("'"))r=false;else x();else switch(b.charAt(H)){case "d":q=v("d");break;case "D":w("D",o,n);break;case "o":s=v("o");break;case "m":p=v("m");break;case "M":p=w("M",k,m);break;case "y":j=v("y");break;case "@":var C=new Date(v("@"));j=C.getFullYear();p=C.getMonth()+1;q=C.getDate();break;case "!":C=new Date((v("!")-this._ticksTo1970)/1E4);j=C.getFullYear();p=C.getMonth()+
1;q=C.getDate();break;case "'":if(u("'"))x();else r=true;break;default:x()}if(y<f.length)throw"Extra/unparsed characters found in date: "+f.substring(y);if(j==-1)j=(new Date).getFullYear();else if(j<100)j+=(new Date).getFullYear()-(new Date).getFullYear()%100+(j<=l?0:-100);if(s>-1){p=1;q=s;do{l=this._getDaysInMonth(j,p-1);if(q<=l)break;p++;q-=l}while(1)}C=this._daylightSavingAdjust(new Date(j,p-1,q));if(C.getFullYear()!=j||C.getMonth()+1!=p||C.getDate()!=q)throw"Invalid date";return C},ATOM:"yy-mm-dd",
COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1E7,formatDate:function(b,f,j){if(!f)return"";var l=(j?j.dayNamesShort:null)||this._defaults.dayNamesShort,o=(j?j.dayNames:null)||this._defaults.dayNames,n=(j?j.monthNamesShort:null)||this._defaults.monthNamesShort;j=(j?j.monthNames:
null)||this._defaults.monthNames;var k=function(u){(u=r+1<b.length&&b.charAt(r+1)==u)&&r++;return u},m=function(u,v,w){v=""+v;if(k(u))for(;v.length<w;)v="0"+v;return v},p=function(u,v,w,x){return k(u)?x[v]:w[v]},q="",s=false;if(f)for(var r=0;r<b.length;r++)if(s)if(b.charAt(r)=="'"&&!k("'"))s=false;else q+=b.charAt(r);else switch(b.charAt(r)){case "d":q+=m("d",f.getDate(),2);break;case "D":q+=p("D",f.getDay(),l,o);break;case "o":q+=m("o",Math.round(((new Date(f.getFullYear(),f.getMonth(),f.getDate())).getTime()-
(new Date(f.getFullYear(),0,0)).getTime())/864E5),3);break;case "m":q+=m("m",f.getMonth()+1,2);break;case "M":q+=p("M",f.getMonth(),n,j);break;case "y":q+=k("y")?f.getFullYear():(f.getYear()%100<10?"0":"")+f.getYear()%100;break;case "@":q+=f.getTime();break;case "!":q+=f.getTime()*1E4+this._ticksTo1970;break;case "'":if(k("'"))q+="'";else s=true;break;default:q+=b.charAt(r)}return q},_possibleChars:function(b){for(var f="",j=false,l=function(n){(n=o+1<b.length&&b.charAt(o+1)==n)&&o++;return n},o=
0;o<b.length;o++)if(j)if(b.charAt(o)=="'"&&!l("'"))j=false;else f+=b.charAt(o);else switch(b.charAt(o)){case "d":case "m":case "y":case "@":f+="0123456789";break;case "D":case "M":return null;case "'":if(l("'"))f+="'";else j=true;break;default:f+=b.charAt(o)}return f},_get:function(b,f){return b.settings[f]!==d?b.settings[f]:this._defaults[f]},_setDateFromField:function(b,f){if(b.input.val()!=b.lastVal){var j=this._get(b,"dateFormat"),l=b.lastVal=b.input?b.input.val():null,o,n;o=n=this._getDefaultDate(b);
var k=this._getFormatConfig(b);try{o=this.parseDate(j,l,k)||n}catch(m){this.log(m);l=f?"":l}b.selectedDay=o.getDate();b.drawMonth=b.selectedMonth=o.getMonth();b.drawYear=b.selectedYear=o.getFullYear();b.currentDay=l?o.getDate():0;b.currentMonth=l?o.getMonth():0;b.currentYear=l?o.getFullYear():0;this._adjustInstDate(b)}},_getDefaultDate:function(b){return this._restrictMinMax(b,this._determineDate(b,this._get(b,"defaultDate"),new Date))},_determineDate:function(b,f,j){var l=function(n){var k=new Date;
k.setDate(k.getDate()+n);return k},o=function(n){try{return a.datepicker.parseDate(a.datepicker._get(b,"dateFormat"),n,a.datepicker._getFormatConfig(b))}catch(k){}var m=(n.toLowerCase().match(/^c/)?a.datepicker._getDate(b):null)||new Date,p=m.getFullYear(),q=m.getMonth();m=m.getDate();for(var s=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,r=s.exec(n);r;){switch(r[2]||"d"){case "d":case "D":m+=parseInt(r[1],10);break;case "w":case "W":m+=parseInt(r[1],10)*7;break;case "m":case "M":q+=parseInt(r[1],10);m=
Math.min(m,a.datepicker._getDaysInMonth(p,q));break;case "y":case "Y":p+=parseInt(r[1],10);m=Math.min(m,a.datepicker._getDaysInMonth(p,q));break}r=s.exec(n)}return new Date(p,q,m)};if(f=(f=f==null||f===""?j:typeof f=="string"?o(f):typeof f=="number"?isNaN(f)?j:l(f):new Date(f.getTime()))&&f.toString()=="Invalid Date"?j:f){f.setHours(0);f.setMinutes(0);f.setSeconds(0);f.setMilliseconds(0)}return this._daylightSavingAdjust(f)},_daylightSavingAdjust:function(b){if(!b)return null;b.setHours(b.getHours()>
12?b.getHours()+2:0);return b},_setDate:function(b,f,j){var l=!f,o=b.selectedMonth,n=b.selectedYear;f=this._restrictMinMax(b,this._determineDate(b,f,new Date));b.selectedDay=b.currentDay=f.getDate();b.drawMonth=b.selectedMonth=b.currentMonth=f.getMonth();b.drawYear=b.selectedYear=b.currentYear=f.getFullYear();if((o!=b.selectedMonth||n!=b.selectedYear)&&!j)this._notifyChange(b);this._adjustInstDate(b);if(b.input)b.input.val(l?"":this._formatDate(b))},_getDate:function(b){return!b.currentYear||b.input&&
b.input.val()==""?null:this._daylightSavingAdjust(new Date(b.currentYear,b.currentMonth,b.currentDay))},_generateHTML:function(b){var f=new Date;f=this._daylightSavingAdjust(new Date(f.getFullYear(),f.getMonth(),f.getDate()));var j=this._get(b,"isRTL"),l=this._get(b,"showButtonPanel"),o=this._get(b,"hideIfNoPrevNext"),n=this._get(b,"navigationAsDateFormat"),k=this._getNumberOfMonths(b),m=this._get(b,"showCurrentAtPos"),p=this._get(b,"stepMonths"),q=k[0]!=1||k[1]!=1,s=this._daylightSavingAdjust(!b.currentDay?
new Date(9999,9,9):new Date(b.currentYear,b.currentMonth,b.currentDay)),r=this._getMinMaxDate(b,"min"),u=this._getMinMaxDate(b,"max");m=b.drawMonth-m;var v=b.drawYear;if(m<0){m+=12;v--}if(u){var w=this._daylightSavingAdjust(new Date(u.getFullYear(),u.getMonth()-k[0]*k[1]+1,u.getDate()));for(w=r&&w<r?r:w;this._daylightSavingAdjust(new Date(v,m,1))>w;){m--;if(m<0){m=11;v--}}}b.drawMonth=m;b.drawYear=v;w=this._get(b,"prevText");w=!n?w:this.formatDate(w,this._daylightSavingAdjust(new Date(v,m-p,1)),this._getFormatConfig(b));
w=this._canAdjustMonth(b,-1,v,m)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+g+".datepicker._adjustDate('#"+b.id+"', -"+p+", 'M');\" title=\""+w+'"><span class="ui-icon ui-icon-circle-triangle-'+(j?"e":"w")+'">'+w+"</span></a>":o?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+w+'"><span class="ui-icon ui-icon-circle-triangle-'+(j?"e":"w")+'">'+w+"</span></a>";var x=this._get(b,"nextText");x=!n?x:this.formatDate(x,this._daylightSavingAdjust(new Date(v,
m+p,1)),this._getFormatConfig(b));o=this._canAdjustMonth(b,+1,v,m)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+g+".datepicker._adjustDate('#"+b.id+"', +"+p+", 'M');\" title=\""+x+'"><span class="ui-icon ui-icon-circle-triangle-'+(j?"w":"e")+'">'+x+"</span></a>":o?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+x+'"><span class="ui-icon ui-icon-circle-triangle-'+(j?"w":"e")+'">'+x+"</span></a>";p=this._get(b,"currentText");x=this._get(b,"gotoCurrent")&&
b.currentDay?s:f;p=!n?p:this.formatDate(p,x,this._getFormatConfig(b));n=!b.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+g+'.datepicker._hideDatepicker();">'+this._get(b,"closeText")+"</button>":"";l=l?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(j?n:"")+(this._isInRange(b,x)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+
g+".datepicker._gotoToday('#"+b.id+"');\">"+p+"</button>":"")+(j?"":n)+"</div>":"";n=parseInt(this._get(b,"firstDay"),10);n=isNaN(n)?0:n;p=this._get(b,"showWeek");x=this._get(b,"dayNames");this._get(b,"dayNamesShort");var y=this._get(b,"dayNamesMin"),H=this._get(b,"monthNames"),C=this._get(b,"monthNamesShort"),z=this._get(b,"beforeShowDay"),I=this._get(b,"showOtherMonths"),N=this._get(b,"selectOtherMonths");this._get(b,"calculateWeek");for(var J=this._getDefaultDate(b),D="",E=0;E<k[0];E++){var P=
"";this.maxRows=4;for(var L=0;L<k[1];L++){var Q=this._daylightSavingAdjust(new Date(v,m,b.selectedDay)),B=" ui-corner-all",F="";if(q){F+='<div class="ui-datepicker-group';if(k[1]>1)switch(L){case 0:F+=" ui-datepicker-group-first";B=" ui-corner-"+(j?"right":"left");break;case k[1]-1:F+=" ui-datepicker-group-last";B=" ui-corner-"+(j?"left":"right");break;default:F+=" ui-datepicker-group-middle";B="";break}F+='">'}F+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+B+'">'+(/all|left/.test(B)&&
E==0?j?o:w:"")+(/all|right/.test(B)&&E==0?j?w:o:"")+this._generateMonthYearHeader(b,m,v,r,u,E>0||L>0,H,C)+'</div><table class="ui-datepicker-calendar"><thead><tr>';var G=p?'<th class="ui-datepicker-week-col">'+this._get(b,"weekHeader")+"</th>":"";for(B=0;B<7;B++){var A=(B+n)%7;G+="<th"+((B+n+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+x[A]+'">'+y[A]+"</span></th>"}F+=G+"</tr></thead><tbody>";G=this._getDaysInMonth(v,m);if(v==b.selectedYear&&m==b.selectedMonth)b.selectedDay=Math.min(b.selectedDay,
G);B=(this._getFirstDayOfMonth(v,m)-n+7)%7;G=Math.ceil((B+G)/7);this.maxRows=G=q?this.maxRows>G?this.maxRows:G:G;A=this._daylightSavingAdjust(new Date(v,m,1-B));for(var R=0;R<G;R++){F+="<tr>";var S=!p?"":'<td class="ui-datepicker-week-col">'+this._get(b,"calculateWeek")(A)+"</td>";for(B=0;B<7;B++){var M=z?z.apply(b.input?b.input[0]:null,[A]):[true,""],K=A.getMonth()!=m,O=K&&!N||!M[0]||r&&A<r||u&&A>u;S+='<td class="'+((B+n+6)%7>=5?" ui-datepicker-week-end":"")+(K?" ui-datepicker-other-month":"")+(A.getTime()==
Q.getTime()&&m==b.selectedMonth&&b._keyEvent||J.getTime()==A.getTime()&&J.getTime()==Q.getTime()?" "+this._dayOverClass:"")+(O?" "+this._unselectableClass+" ui-state-disabled":"")+(K&&!I?"":" "+M[1]+(A.getTime()==s.getTime()?" "+this._currentClass:"")+(A.getTime()==f.getTime()?" ui-datepicker-today":""))+'"'+((!K||I)&&M[2]?' title="'+M[2]+'"':"")+(O?"":' onclick="DP_jQuery_'+g+".datepicker._selectDay('#"+b.id+"',"+A.getMonth()+","+A.getFullYear()+', this);return false;"')+">"+(K&&!I?"&#xa0;":O?'<span class="ui-state-default">'+
A.getDate()+"</span>":'<a class="ui-state-default'+(A.getTime()==f.getTime()?" ui-state-highlight":"")+(A.getTime()==s.getTime()?" ui-state-active":"")+(K?" ui-priority-secondary":"")+'" href="#">'+A.getDate()+"</a>")+"</td>";A.setDate(A.getDate()+1);A=this._daylightSavingAdjust(A)}F+=S+"</tr>"}m++;if(m>11){m=0;v++}F+="</tbody></table>"+(q?"</div>"+(k[0]>0&&L==k[1]-1?'<div class="ui-datepicker-row-break"></div>':""):"");P+=F}D+=P}D+=l+(a.browser.msie&&parseInt(a.browser.version,10)<7&&!b.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':
"");b._keyEvent=false;return D},_generateMonthYearHeader:function(b,f,j,l,o,n,k,m){var p=this._get(b,"changeMonth"),q=this._get(b,"changeYear"),s=this._get(b,"showMonthAfterYear"),r='<div class="ui-datepicker-title">',u="";if(n||!p)u+='<span class="ui-datepicker-month">'+k[f]+"</span>";else{k=l&&l.getFullYear()==j;var v=o&&o.getFullYear()==j;u+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+g+".datepicker._selectMonthYear('#"+b.id+"', this, 'M');\" >";for(var w=0;w<12;w++)if((!k||w>=l.getMonth())&&
(!v||w<=o.getMonth()))u+='<option value="'+w+'"'+(w==f?' selected="selected"':"")+">"+m[w]+"</option>";u+="</select>"}s||(r+=u+(n||!(p&&q)?"&#xa0;":""));if(!b.yearshtml){b.yearshtml="";if(n||!q)r+='<span class="ui-datepicker-year">'+j+"</span>";else{m=this._get(b,"yearRange").split(":");var x=(new Date).getFullYear();k=function(y){y=y.match(/c[+-].*/)?j+parseInt(y.substring(1),10):y.match(/[+-].*/)?x+parseInt(y,10):parseInt(y,10);return isNaN(y)?x:y};f=k(m[0]);m=Math.max(f,k(m[1]||""));f=l?Math.max(f,
l.getFullYear()):f;m=o?Math.min(m,o.getFullYear()):m;for(b.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+g+".datepicker._selectMonthYear('#"+b.id+"', this, 'Y');\" >";f<=m;f++)b.yearshtml+='<option value="'+f+'"'+(f==j?' selected="selected"':"")+">"+f+"</option>";b.yearshtml+="</select>";r+=b.yearshtml;b.yearshtml=null}}r+=this._get(b,"yearSuffix");if(s)r+=(n||!(p&&q)?"&#xa0;":"")+u;r+="</div>";return r},_adjustInstDate:function(b,f,j){var l=b.drawYear+(j=="Y"?f:0),o=b.drawMonth+
(j=="M"?f:0);f=Math.min(b.selectedDay,this._getDaysInMonth(l,o))+(j=="D"?f:0);l=this._restrictMinMax(b,this._daylightSavingAdjust(new Date(l,o,f)));b.selectedDay=l.getDate();b.drawMonth=b.selectedMonth=l.getMonth();b.drawYear=b.selectedYear=l.getFullYear();if(j=="M"||j=="Y")this._notifyChange(b)},_restrictMinMax:function(b,f){var j=this._getMinMaxDate(b,"min");b=this._getMinMaxDate(b,"max");f=j&&f<j?j:f;return f=b&&f>b?b:f},_notifyChange:function(b){var f=this._get(b,"onChangeMonthYear");if(f)f.apply(b.input?
b.input[0]:null,[b.selectedYear,b.selectedMonth+1,b])},_getNumberOfMonths:function(b){b=this._get(b,"numberOfMonths");return b==null?[1,1]:typeof b=="number"?[1,b]:b},_getMinMaxDate:function(b,f){return this._determineDate(b,this._get(b,f+"Date"),null)},_getDaysInMonth:function(b,f){return 32-this._daylightSavingAdjust(new Date(b,f,32)).getDate()},_getFirstDayOfMonth:function(b,f){return(new Date(b,f,1)).getDay()},_canAdjustMonth:function(b,f,j,l){var o=this._getNumberOfMonths(b);j=this._daylightSavingAdjust(new Date(j,
l+(f<0?f:o[0]*o[1]),1));f<0&&j.setDate(this._getDaysInMonth(j.getFullYear(),j.getMonth()));return this._isInRange(b,j)},_isInRange:function(b,f){var j=this._getMinMaxDate(b,"min");b=this._getMinMaxDate(b,"max");return(!j||f.getTime()>=j.getTime())&&(!b||f.getTime()<=b.getTime())},_getFormatConfig:function(b){var f=this._get(b,"shortYearCutoff");f=typeof f!="string"?f:(new Date).getFullYear()%100+parseInt(f,10);return{shortYearCutoff:f,dayNamesShort:this._get(b,"dayNamesShort"),dayNames:this._get(b,
"dayNames"),monthNamesShort:this._get(b,"monthNamesShort"),monthNames:this._get(b,"monthNames")}},_formatDate:function(b,f,j,l){if(!f){b.currentDay=b.selectedDay;b.currentMonth=b.selectedMonth;b.currentYear=b.selectedYear}f=f?typeof f=="object"?f:this._daylightSavingAdjust(new Date(l,j,f)):this._daylightSavingAdjust(new Date(b.currentYear,b.currentMonth,b.currentDay));return this.formatDate(this._get(b,"dateFormat"),f,this._getFormatConfig(b))}});a.fn.datepicker=function(b){if(!this.length)return this;
if(!a.datepicker.initialized){a(document).mousedown(a.datepicker._checkExternalClick).find("body").append(a.datepicker.dpDiv);a.datepicker.initialized=true}var f=Array.prototype.slice.call(arguments,1);if(typeof b=="string"&&(b=="isDisabled"||b=="getDate"||b=="widget"))return a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this[0]].concat(f));if(b=="option"&&arguments.length==2&&typeof arguments[1]=="string")return a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this[0]].concat(f));return this.each(function(){typeof b==
"string"?a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this].concat(f)):a.datepicker._attachDatepicker(this,b)})};a.datepicker=new c;a.datepicker.initialized=false;a.datepicker.uuid=(new Date).getTime();a.datepicker.version="1.8.16";window["DP_jQuery_"+g]=a})(jQuery);
(function(a,d){var c={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},e={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true},h=a.attrFn||{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true,click:true};a.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,
position:{my:"center",at:"center",collision:"fit",using:function(g){var i=a(this).css(g).offset().top;i<0&&a(this).css("top",g.top-i)}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1E3},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string")this.originalTitle="";this.options.title=this.options.title||this.originalTitle;var g=this,i=g.options,b=i.title||"&#160;",f=a.ui.dialog.getTitleId(g.element),j=(g.uiDialog=a("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+
i.dialogClass).css({zIndex:i.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(n){if(i.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===a.ui.keyCode.ESCAPE){g.close(n);n.preventDefault()}}).attr({role:"dialog","aria-labelledby":f}).mousedown(function(n){g.moveToTop(false,n)});g.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(j);var l=(g.uiDialogTitlebar=a("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(j),
o=a('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){o.addClass("ui-state-hover")},function(){o.removeClass("ui-state-hover")}).focus(function(){o.addClass("ui-state-focus")}).blur(function(){o.removeClass("ui-state-focus")}).click(function(n){g.close(n);return false}).appendTo(l);(g.uiDialogTitlebarCloseText=a("<span></span>")).addClass("ui-icon ui-icon-closethick").text(i.closeText).appendTo(o);a("<span></span>").addClass("ui-dialog-title").attr("id",
f).html(b).prependTo(l);if(a.isFunction(i.beforeclose)&&!a.isFunction(i.beforeClose))i.beforeClose=i.beforeclose;l.find("*").add(l).disableSelection();i.draggable&&a.fn.draggable&&g._makeDraggable();i.resizable&&a.fn.resizable&&g._makeResizable();g._createButtons(i.buttons);g._isOpen=false;a.fn.bgiframe&&j.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var g=this;g.overlay&&g.overlay.destroy();g.uiDialog.hide();g.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");
g.uiDialog.remove();g.originalTitle&&g.element.attr("title",g.originalTitle);return g},widget:function(){return this.uiDialog},close:function(g){var i=this,b,f;if(false!==i._trigger("beforeClose",g)){i.overlay&&i.overlay.destroy();i.uiDialog.unbind("keypress.ui-dialog");i._isOpen=false;if(i.options.hide)i.uiDialog.hide(i.options.hide,function(){i._trigger("close",g)});else{i.uiDialog.hide();i._trigger("close",g)}a.ui.dialog.overlay.resize();if(i.options.modal){b=0;a(".ui-dialog").each(function(){if(this!==
i.uiDialog[0]){f=a(this).css("z-index");isNaN(f)||(b=Math.max(b,f))}});a.ui.dialog.maxZ=b}return i}},isOpen:function(){return this._isOpen},moveToTop:function(g,i){var b=this,f=b.options;if(f.modal&&!g||!f.stack&&!f.modal)return b._trigger("focus",i);if(f.zIndex>a.ui.dialog.maxZ)a.ui.dialog.maxZ=f.zIndex;if(b.overlay){a.ui.dialog.maxZ+=1;b.overlay.$el.css("z-index",a.ui.dialog.overlay.maxZ=a.ui.dialog.maxZ)}g={scrollTop:b.element.scrollTop(),scrollLeft:b.element.scrollLeft()};a.ui.dialog.maxZ+=1;
b.uiDialog.css("z-index",a.ui.dialog.maxZ);b.element.attr(g);b._trigger("focus",i);return b},open:function(){if(!this._isOpen){var g=this,i=g.options,b=g.uiDialog;g.overlay=i.modal?new a.ui.dialog.overlay(g):null;g._size();g._position(i.position);b.show(i.show);g.moveToTop(true);i.modal&&b.bind("keypress.ui-dialog",function(f){if(f.keyCode===a.ui.keyCode.TAB){var j=a(":tabbable",this),l=j.filter(":first");j=j.filter(":last");if(f.target===j[0]&&!f.shiftKey){l.focus(1);return false}else if(f.target===
l[0]&&f.shiftKey){j.focus(1);return false}}});a(g.element.find(":tabbable").get().concat(b.find(".ui-dialog-buttonpane :tabbable").get().concat(b.get()))).eq(0).focus();g._isOpen=true;g._trigger("open");return g}},_createButtons:function(g){var i=this,b=false,f=a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),j=a("<div></div>").addClass("ui-dialog-buttonset").appendTo(f);i.uiDialog.find(".ui-dialog-buttonpane").remove();typeof g==="object"&&g!==null&&a.each(g,
function(){return!(b=true)});if(b){a.each(g,function(l,o){o=a.isFunction(o)?{click:o,text:l}:o;var n=a('<button type="button"></button>').click(function(){o.click.apply(i.element[0],arguments)}).appendTo(j);a.each(o,function(k,m){if(k!=="click")k in h?n[k](m):n.attr(k,m)});a.fn.button&&n.button()});f.appendTo(i.uiDialog)}},_makeDraggable:function(){function g(l){return{position:l.position,offset:l.offset}}var i=this,b=i.options,f=a(document),j;i.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",
handle:".ui-dialog-titlebar",containment:"document",start:function(l,o){j=b.height==="auto"?"auto":a(this).height();a(this).height(a(this).height()).addClass("ui-dialog-dragging");i._trigger("dragStart",l,g(o))},drag:function(l,o){i._trigger("drag",l,g(o))},stop:function(l,o){b.position=[o.position.left-f.scrollLeft(),o.position.top-f.scrollTop()];a(this).removeClass("ui-dialog-dragging").height(j);i._trigger("dragStop",l,g(o));a.ui.dialog.overlay.resize()}})},_makeResizable:function(g){function i(l){return{originalPosition:l.originalPosition,
originalSize:l.originalSize,position:l.position,size:l.size}}g=g===d?this.options.resizable:g;var b=this,f=b.options,j=b.uiDialog.css("position");g=typeof g==="string"?g:"n,e,s,w,se,sw,ne,nw";b.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:b.element,maxWidth:f.maxWidth,maxHeight:f.maxHeight,minWidth:f.minWidth,minHeight:b._minHeight(),handles:g,start:function(l,o){a(this).addClass("ui-dialog-resizing");b._trigger("resizeStart",l,i(o))},resize:function(l,o){b._trigger("resize",
l,i(o))},stop:function(l,o){a(this).removeClass("ui-dialog-resizing");f.height=a(this).height();f.width=a(this).width();b._trigger("resizeStop",l,i(o));a.ui.dialog.overlay.resize()}}).css("position",j).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var g=this.options;return g.height==="auto"?g.minHeight:Math.min(g.minHeight,g.height)},_position:function(g){var i=[],b=[0,0],f;if(g){if(typeof g==="string"||typeof g==="object"&&"0"in g){i=g.split?g.split(" "):
[g[0],g[1]];if(i.length===1)i[1]=i[0];a.each(["left","top"],function(j,l){if(+i[j]===i[j]){b[j]=i[j];i[j]=l}});g={my:i.join(" "),at:i.join(" "),offset:b.join(" ")}}g=a.extend({},a.ui.dialog.prototype.options.position,g)}else g=a.ui.dialog.prototype.options.position;(f=this.uiDialog.is(":visible"))||this.uiDialog.show();this.uiDialog.css({top:0,left:0}).position(a.extend({of:window},g));f||this.uiDialog.hide()},_setOptions:function(g){var i=this,b={},f=false;a.each(g,function(j,l){i._setOption(j,l);
if(j in c)f=true;if(j in e)b[j]=l});f&&this._size();this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",b)},_setOption:function(g,i){var b=this,f=b.uiDialog;switch(g){case "beforeclose":g="beforeClose";break;case "buttons":b._createButtons(i);break;case "closeText":b.uiDialogTitlebarCloseText.text(""+i);break;case "dialogClass":f.removeClass(b.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+i);break;case "disabled":i?f.addClass("ui-dialog-disabled"):
f.removeClass("ui-dialog-disabled");break;case "draggable":var j=f.is(":data(draggable)");j&&!i&&f.draggable("destroy");!j&&i&&b._makeDraggable();break;case "position":b._position(i);break;case "resizable":(j=f.is(":data(resizable)"))&&!i&&f.resizable("destroy");j&&typeof i==="string"&&f.resizable("option","handles",i);!j&&i!==false&&b._makeResizable(i);break;case "title":a(".ui-dialog-title",b.uiDialogTitlebar).html(""+(i||"&#160;"));break}a.Widget.prototype._setOption.apply(b,arguments)},_size:function(){var g=
this.options,i,b,f=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});if(g.minWidth>g.width)g.width=g.minWidth;i=this.uiDialog.css({height:"auto",width:g.width}).height();b=Math.max(0,g.minHeight-i);if(g.height==="auto")if(a.support.minHeight)this.element.css({minHeight:b,height:"auto"});else{this.uiDialog.show();g=this.element.css("height","auto").height();f||this.uiDialog.hide();this.element.height(Math.max(g,b))}else this.element.height(Math.max(g.height-
i,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}});a.extend(a.ui.dialog,{version:"1.8.16",uuid:0,maxZ:0,getTitleId:function(g){g=g.attr("id");if(!g){this.uuid+=1;g=this.uuid}return"ui-dialog-title-"+g},overlay:function(g){this.$el=a.ui.dialog.overlay.create(g)}});a.extend(a.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:a.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(g){return g+".dialog-overlay"}).join(" "),
create:function(g){if(this.instances.length===0){setTimeout(function(){a.ui.dialog.overlay.instances.length&&a(document).bind(a.ui.dialog.overlay.events,function(b){if(a(b.target).zIndex()<a.ui.dialog.overlay.maxZ)return false})},1);a(document).bind("keydown.dialog-overlay",function(b){if(g.options.closeOnEscape&&!b.isDefaultPrevented()&&b.keyCode&&b.keyCode===a.ui.keyCode.ESCAPE){g.close(b);b.preventDefault()}});a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize)}var i=(this.oldInstances.pop()||
a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});a.fn.bgiframe&&i.bgiframe();this.instances.push(i);return i},destroy:function(g){var i=a.inArray(g,this.instances);i!=-1&&this.oldInstances.push(this.instances.splice(i,1)[0]);this.instances.length===0&&a([document,window]).unbind(".dialog-overlay");g.remove();var b=0;a.each(this.instances,function(){b=Math.max(b,this.css("z-index"))});this.maxZ=b},height:function(){var g,i;if(a.browser.msie&&
a.browser.version<7){g=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);i=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return g<i?a(window).height()+"px":g+"px"}else return a(document).height()+"px"},width:function(){var g,i;if(a.browser.msie){g=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);i=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);return g<i?a(window).width()+"px":g+"px"}else return a(document).width()+
"px"},resize:function(){var g=a([]);a.each(a.ui.dialog.overlay.instances,function(){g=g.add(this)});g.css({width:0,height:0}).css({width:a.ui.dialog.overlay.width(),height:a.ui.dialog.overlay.height()})}});a.extend(a.ui.dialog.overlay.prototype,{destroy:function(){a.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);
(function(a){a.ui=a.ui||{};var d=/left|center|right/,c=/top|center|bottom/,e=a.fn.position,h=a.fn.offset;a.fn.position=function(g){if(!g||!g.of)return e.apply(this,arguments);g=a.extend({},g);var i=a(g.of),b=i[0],f=(g.collision||"flip").split(" "),j=g.offset?g.offset.split(" "):[0,0],l,o,n;if(b.nodeType===9){l=i.width();o=i.height();n={top:0,left:0}}else if(b.setTimeout){l=i.width();o=i.height();n={top:i.scrollTop(),left:i.scrollLeft()}}else if(b.preventDefault){g.at="left top";l=o=0;n={top:g.of.pageY,
left:g.of.pageX}}else{l=i.outerWidth();o=i.outerHeight();n=i.offset()}a.each(["my","at"],function(){var k=(g[this]||"").split(" ");if(k.length===1)k=d.test(k[0])?k.concat(["center"]):c.test(k[0])?["center"].concat(k):["center","center"];k[0]=d.test(k[0])?k[0]:"center";k[1]=c.test(k[1])?k[1]:"center";g[this]=k});if(f.length===1)f[1]=f[0];j[0]=parseInt(j[0],10)||0;if(j.length===1)j[1]=j[0];j[1]=parseInt(j[1],10)||0;if(g.at[0]==="right")n.left+=l;else if(g.at[0]==="center")n.left+=l/2;if(g.at[1]==="bottom")n.top+=
o;else if(g.at[1]==="center")n.top+=o/2;n.left+=j[0];n.top+=j[1];return this.each(function(){var k=a(this),m=k.outerWidth(),p=k.outerHeight(),q=parseInt(a.curCSS(this,"marginLeft",true))||0,s=parseInt(a.curCSS(this,"marginTop",true))||0,r=m+q+(parseInt(a.curCSS(this,"marginRight",true))||0),u=p+s+(parseInt(a.curCSS(this,"marginBottom",true))||0),v=a.extend({},n),w;if(g.my[0]==="right")v.left-=m;else if(g.my[0]==="center")v.left-=m/2;if(g.my[1]==="bottom")v.top-=p;else if(g.my[1]==="center")v.top-=
p/2;v.left=Math.round(v.left);v.top=Math.round(v.top);w={left:v.left-q,top:v.top-s};a.each(["left","top"],function(x,y){a.ui.position[f[x]]&&a.ui.position[f[x]][y](v,{targetWidth:l,targetHeight:o,elemWidth:m,elemHeight:p,collisionPosition:w,collisionWidth:r,collisionHeight:u,offset:j,my:g.my,at:g.at})});a.fn.bgiframe&&k.bgiframe();k.offset(a.extend(v,{using:g.using}))})};a.ui.position={fit:{left:function(g,i){var b=a(window);b=i.collisionPosition.left+i.collisionWidth-b.width()-b.scrollLeft();g.left=
b>0?g.left-b:Math.max(g.left-i.collisionPosition.left,g.left)},top:function(g,i){var b=a(window);b=i.collisionPosition.top+i.collisionHeight-b.height()-b.scrollTop();g.top=b>0?g.top-b:Math.max(g.top-i.collisionPosition.top,g.top)}},flip:{left:function(g,i){if(i.at[0]!=="center"){var b=a(window);b=i.collisionPosition.left+i.collisionWidth-b.width()-b.scrollLeft();var f=i.my[0]==="left"?-i.elemWidth:i.my[0]==="right"?i.elemWidth:0,j=i.at[0]==="left"?i.targetWidth:-i.targetWidth,l=-2*i.offset[0];g.left+=
i.collisionPosition.left<0?f+j+l:b>0?f+j+l:0}},top:function(g,i){if(i.at[1]!=="center"){var b=a(window);b=i.collisionPosition.top+i.collisionHeight-b.height()-b.scrollTop();var f=i.my[1]==="top"?-i.elemHeight:i.my[1]==="bottom"?i.elemHeight:0,j=i.at[1]==="top"?i.targetHeight:-i.targetHeight,l=-2*i.offset[1];g.top+=i.collisionPosition.top<0?f+j+l:b>0?f+j+l:0}}}};if(!a.offset.setOffset){a.offset.setOffset=function(g,i){if(/static/.test(a.curCSS(g,"position")))g.style.position="relative";var b=a(g),
f=b.offset(),j=parseInt(a.curCSS(g,"top",true),10)||0,l=parseInt(a.curCSS(g,"left",true),10)||0;f={top:i.top-f.top+j,left:i.left-f.left+l};"using"in i?i.using.call(g,f):b.css(f)};a.fn.offset=function(g){var i=this[0];if(!i||!i.ownerDocument)return null;if(g)return this.each(function(){a.offset.setOffset(this,g)});return h.call(this)}}})(jQuery);
(function(a,d){a.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=a("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue()},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");
this.valueDiv.remove();a.Widget.prototype.destroy.apply(this,arguments)},value:function(c){if(c===d)return this._value();this._setOption("value",c);return this},_setOption:function(c,e){if(c==="value"){this.options.value=e;this._refreshValue();this._value()===this.options.max&&this._trigger("complete")}a.Widget.prototype._setOption.apply(this,arguments)},_value:function(){var c=this.options.value;if(typeof c!=="number")c=0;return Math.min(this.options.max,Math.max(this.min,c))},_percentage:function(){return 100*
this._value()/this.options.max},_refreshValue:function(){var c=this.value(),e=this._percentage();if(this.oldValue!==c){this.oldValue=c;this._trigger("change")}this.valueDiv.toggle(c>this.min).toggleClass("ui-corner-right",c===this.options.max).width(e.toFixed(0)+"%");this.element.attr("aria-valuenow",c)}});a.extend(a.ui.progressbar,{version:"1.8.16"})})(jQuery);
(function(a){a.widget("ui.slider",a.ui.mouse,{widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var d=this,c=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),h=c.values&&c.values.length||1,g=[];this._mouseSliding=this._keySliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+
this.orientation+" ui-widget ui-widget-content ui-corner-all"+(c.disabled?" ui-slider-disabled ui-disabled":""));this.range=a([]);if(c.range){if(c.range===true){if(!c.values)c.values=[this._valueMin(),this._valueMin()];if(c.values.length&&c.values.length!==2)c.values=[c.values[0],c.values[0]]}this.range=a("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(c.range==="min"||c.range==="max"?" ui-slider-range-"+c.range:""))}for(var i=e.length;i<h;i+=1)g.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");
this.handles=e.add(a(g.join("")).appendTo(d.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(b){b.preventDefault()}).hover(function(){c.disabled||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).focus(function(){if(c.disabled)a(this).blur();else{a(".ui-slider .ui-state-focus").removeClass("ui-state-focus");a(this).addClass("ui-state-focus")}}).blur(function(){a(this).removeClass("ui-state-focus")});this.handles.each(function(b){a(this).data("index.ui-slider-handle",
b)});this.handles.keydown(function(b){var f=true,j=a(this).data("index.ui-slider-handle"),l,o,n;if(!d.options.disabled){switch(b.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:f=false;if(!d._keySliding){d._keySliding=true;a(this).addClass("ui-state-active");l=d._start(b,j);if(l===false)return}break}n=d.options.step;l=d.options.values&&d.options.values.length?
(o=d.values(j)):(o=d.value());switch(b.keyCode){case a.ui.keyCode.HOME:o=d._valueMin();break;case a.ui.keyCode.END:o=d._valueMax();break;case a.ui.keyCode.PAGE_UP:o=d._trimAlignValue(l+(d._valueMax()-d._valueMin())/5);break;case a.ui.keyCode.PAGE_DOWN:o=d._trimAlignValue(l-(d._valueMax()-d._valueMin())/5);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(l===d._valueMax())return;o=d._trimAlignValue(l+n);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(l===d._valueMin())return;o=d._trimAlignValue(l-
n);break}d._slide(b,j,o);return f}}).keyup(function(b){var f=a(this).data("index.ui-slider-handle");if(d._keySliding){d._keySliding=false;d._stop(b,f);d._change(b,f);a(this).removeClass("ui-state-active")}});this._refreshValue();this._animateOff=false},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();
return this},_mouseCapture:function(d){var c=this.options,e,h,g,i,b;if(c.disabled)return false;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();e=this._normValueFromMouse({x:d.pageX,y:d.pageY});h=this._valueMax()-this._valueMin()+1;i=this;this.handles.each(function(f){var j=Math.abs(e-i.values(f));if(h>j){h=j;g=a(this);b=f}});if(c.range===true&&this.values(1)===c.min){b+=1;g=a(this.handles[b])}if(this._start(d,b)===false)return false;
this._mouseSliding=true;i._handleIndex=b;g.addClass("ui-state-active").focus();c=g.offset();this._clickOffset=!a(d.target).parents().andSelf().is(".ui-slider-handle")?{left:0,top:0}:{left:d.pageX-c.left-g.width()/2,top:d.pageY-c.top-g.height()/2-(parseInt(g.css("borderTopWidth"),10)||0)-(parseInt(g.css("borderBottomWidth"),10)||0)+(parseInt(g.css("marginTop"),10)||0)};this.handles.hasClass("ui-state-hover")||this._slide(d,b,e);return this._animateOff=true},_mouseStart:function(){return true},_mouseDrag:function(d){var c=
this._normValueFromMouse({x:d.pageX,y:d.pageY});this._slide(d,this._handleIndex,c);return false},_mouseStop:function(d){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(d,this._handleIndex);this._change(d,this._handleIndex);this._clickOffset=this._handleIndex=null;return this._animateOff=false},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(d){var c;if(this.orientation==="horizontal"){c=
this.elementSize.width;d=d.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{c=this.elementSize.height;d=d.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}c=d/c;if(c>1)c=1;if(c<0)c=0;if(this.orientation==="vertical")c=1-c;d=this._valueMax()-this._valueMin();return this._trimAlignValue(this._valueMin()+c*d)},_start:function(d,c){var e={handle:this.handles[c],value:this.value()};if(this.options.values&&this.options.values.length){e.value=this.values(c);
e.values=this.values()}return this._trigger("start",d,e)},_slide:function(d,c,e){var h;if(this.options.values&&this.options.values.length){h=this.values(c?0:1);if(this.options.values.length===2&&this.options.range===true&&(c===0&&e>h||c===1&&e<h))e=h;if(e!==this.values(c)){h=this.values();h[c]=e;d=this._trigger("slide",d,{handle:this.handles[c],value:e,values:h});this.values(c?0:1);d!==false&&this.values(c,e,true)}}else if(e!==this.value()){d=this._trigger("slide",d,{handle:this.handles[c],value:e});
d!==false&&this.value(e)}},_stop:function(d,c){var e={handle:this.handles[c],value:this.value()};if(this.options.values&&this.options.values.length){e.value=this.values(c);e.values=this.values()}this._trigger("stop",d,e)},_change:function(d,c){if(!this._keySliding&&!this._mouseSliding){var e={handle:this.handles[c],value:this.value()};if(this.options.values&&this.options.values.length){e.value=this.values(c);e.values=this.values()}this._trigger("change",d,e)}},value:function(d){if(arguments.length){this.options.value=
this._trimAlignValue(d);this._refreshValue();this._change(null,0)}else return this._value()},values:function(d,c){var e,h,g;if(arguments.length>1){this.options.values[d]=this._trimAlignValue(c);this._refreshValue();this._change(null,d)}else if(arguments.length)if(a.isArray(arguments[0])){e=this.options.values;h=arguments[0];for(g=0;g<e.length;g+=1){e[g]=this._trimAlignValue(h[g]);this._change(null,g)}this._refreshValue()}else return this.options.values&&this.options.values.length?this._values(d):
this.value();else return this._values()},_setOption:function(d,c){var e,h=0;if(a.isArray(this.options.values))h=this.options.values.length;a.Widget.prototype._setOption.apply(this,arguments);switch(d){case "disabled":if(c){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.propAttr("disabled",true);this.element.addClass("ui-disabled")}else{this.handles.propAttr("disabled",false);this.element.removeClass("ui-disabled")}break;case "orientation":this._detectOrientation();
this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case "value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case "values":this._animateOff=true;this._refreshValue();for(e=0;e<h;e+=1)this._change(null,e);this._animateOff=false;break}},_value:function(){var d=this.options.value;return d=this._trimAlignValue(d)},_values:function(d){var c,e;if(arguments.length){c=this.options.values[d];
return c=this._trimAlignValue(c)}else{c=this.options.values.slice();for(e=0;e<c.length;e+=1)c[e]=this._trimAlignValue(c[e]);return c}},_trimAlignValue:function(d){if(d<=this._valueMin())return this._valueMin();if(d>=this._valueMax())return this._valueMax();var c=this.options.step>0?this.options.step:1,e=(d-this._valueMin())%c;d=d-e;if(Math.abs(e)*2>=c)d+=e>0?c:-c;return parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var d=
this.options.range,c=this.options,e=this,h=!this._animateOff?c.animate:false,g,i={},b,f,j,l;if(this.options.values&&this.options.values.length)this.handles.each(function(o){g=(e.values(o)-e._valueMin())/(e._valueMax()-e._valueMin())*100;i[e.orientation==="horizontal"?"left":"bottom"]=g+"%";a(this).stop(1,1)[h?"animate":"css"](i,c.animate);if(e.options.range===true)if(e.orientation==="horizontal"){if(o===0)e.range.stop(1,1)[h?"animate":"css"]({left:g+"%"},c.animate);if(o===1)e.range[h?"animate":"css"]({width:g-
b+"%"},{queue:false,duration:c.animate})}else{if(o===0)e.range.stop(1,1)[h?"animate":"css"]({bottom:g+"%"},c.animate);if(o===1)e.range[h?"animate":"css"]({height:g-b+"%"},{queue:false,duration:c.animate})}b=g});else{f=this.value();j=this._valueMin();l=this._valueMax();g=l!==j?(f-j)/(l-j)*100:0;i[e.orientation==="horizontal"?"left":"bottom"]=g+"%";this.handle.stop(1,1)[h?"animate":"css"](i,c.animate);if(d==="min"&&this.orientation==="horizontal")this.range.stop(1,1)[h?"animate":"css"]({width:g+"%"},
c.animate);if(d==="max"&&this.orientation==="horizontal")this.range[h?"animate":"css"]({width:100-g+"%"},{queue:false,duration:c.animate});if(d==="min"&&this.orientation==="vertical")this.range.stop(1,1)[h?"animate":"css"]({height:g+"%"},c.animate);if(d==="max"&&this.orientation==="vertical")this.range[h?"animate":"css"]({height:100-g+"%"},{queue:false,duration:c.animate})}}});a.extend(a.ui.slider,{version:"1.8.16"})})(jQuery);
(function(a,d){function c(){return++h}function e(){return++g}var h=0,g=0;a.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:false,cookie:null,collapsible:false,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(true)},_setOption:function(i,b){if(i=="selected")this.options.collapsible&&
b==this.options.selected||this.select(b);else{this.options[i]=b;this._tabify()}},_tabId:function(i){return i.title&&i.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+c()},_sanitizeSelector:function(i){return i.replace(/:/g,"\\:")},_cookie:function(){var i=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+e());return a.cookie.apply(null,[i].concat(a.makeArray(arguments)))},_ui:function(i,b){return{tab:i,panel:b,index:this.anchors.index(i)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var i=
a(this);i.html(i.data("label.tabs")).removeData("label.tabs")})},_tabify:function(i){function b(r,u){r.css("display","");!a.support.opacity&&u.opacity&&r[0].style.removeAttribute("filter")}var f=this,j=this.options,l=/^#.+/;this.list=this.element.find("ol,ul").eq(0);this.lis=a(" > li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return a("a",this)[0]});this.panels=a([]);this.anchors.each(function(r,u){var v=a(u).attr("href"),w=v.split("#")[0],x;if(w&&(w===location.toString().split("#")[0]||
(x=a("base")[0])&&w===x.href)){v=u.hash;u.href=v}if(l.test(v))f.panels=f.panels.add(f.element.find(f._sanitizeSelector(v)));else if(v&&v!=="#"){a.data(u,"href.tabs",v);a.data(u,"load.tabs",v.replace(/#.*$/,""));v=f._tabId(u);u.href="#"+v;u=f.element.find("#"+v);if(!u.length){u=a(j.panelTemplate).attr("id",v).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(f.panels[r-1]||f.list);u.data("destroy.tabs",true)}f.panels=f.panels.add(u)}else j.disabled.push(r)});if(i){this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");
this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.lis.addClass("ui-state-default ui-corner-top");this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");if(j.selected===d){location.hash&&this.anchors.each(function(r,u){if(u.hash==location.hash){j.selected=r;return false}});if(typeof j.selected!=="number"&&j.cookie)j.selected=parseInt(f._cookie(),10);if(typeof j.selected!=="number"&&this.lis.filter(".ui-tabs-selected").length)j.selected=
this.lis.index(this.lis.filter(".ui-tabs-selected"));j.selected=j.selected||(this.lis.length?0:-1)}else if(j.selected===null)j.selected=-1;j.selected=j.selected>=0&&this.anchors[j.selected]||j.selected<0?j.selected:0;j.disabled=a.unique(j.disabled.concat(a.map(this.lis.filter(".ui-state-disabled"),function(r){return f.lis.index(r)}))).sort();a.inArray(j.selected,j.disabled)!=-1&&j.disabled.splice(a.inArray(j.selected,j.disabled),1);this.panels.addClass("ui-tabs-hide");this.lis.removeClass("ui-tabs-selected ui-state-active");
if(j.selected>=0&&this.anchors.length){f.element.find(f._sanitizeSelector(f.anchors[j.selected].hash)).removeClass("ui-tabs-hide");this.lis.eq(j.selected).addClass("ui-tabs-selected ui-state-active");f.element.queue("tabs",function(){f._trigger("show",null,f._ui(f.anchors[j.selected],f.element.find(f._sanitizeSelector(f.anchors[j.selected].hash))[0]))});this.load(j.selected)}a(window).bind("unload",function(){f.lis.add(f.anchors).unbind(".tabs");f.lis=f.anchors=f.panels=null})}else j.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));
this.element[j.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible");j.cookie&&this._cookie(j.selected,j.cookie);i=0;for(var o;o=this.lis[i];i++)a(o)[a.inArray(i,j.disabled)!=-1&&!a(o).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");j.cache===false&&this.anchors.removeData("cache.tabs");this.lis.add(this.anchors).unbind(".tabs");if(j.event!=="mouseover"){var n=function(r,u){u.is(":not(.ui-state-disabled)")&&u.addClass("ui-state-"+r)},k=function(r,u){u.removeClass("ui-state-"+
r)};this.lis.bind("mouseover.tabs",function(){n("hover",a(this))});this.lis.bind("mouseout.tabs",function(){k("hover",a(this))});this.anchors.bind("focus.tabs",function(){n("focus",a(this).closest("li"))});this.anchors.bind("blur.tabs",function(){k("focus",a(this).closest("li"))})}var m,p;if(j.fx)if(a.isArray(j.fx)){m=j.fx[0];p=j.fx[1]}else m=p=j.fx;var q=p?function(r,u){a(r).closest("li").addClass("ui-tabs-selected ui-state-active");u.hide().removeClass("ui-tabs-hide").animate(p,p.duration||"normal",
function(){b(u,p);f._trigger("show",null,f._ui(r,u[0]))})}:function(r,u){a(r).closest("li").addClass("ui-tabs-selected ui-state-active");u.removeClass("ui-tabs-hide");f._trigger("show",null,f._ui(r,u[0]))},s=m?function(r,u){u.animate(m,m.duration||"normal",function(){f.lis.removeClass("ui-tabs-selected ui-state-active");u.addClass("ui-tabs-hide");b(u,m);f.element.dequeue("tabs")})}:function(r,u){f.lis.removeClass("ui-tabs-selected ui-state-active");u.addClass("ui-tabs-hide");f.element.dequeue("tabs")};
this.anchors.bind(j.event+".tabs",function(){var r=this,u=a(r).closest("li"),v=f.panels.filter(":not(.ui-tabs-hide)"),w=f.element.find(f._sanitizeSelector(r.hash));if(u.hasClass("ui-tabs-selected")&&!j.collapsible||u.hasClass("ui-state-disabled")||u.hasClass("ui-state-processing")||f.panels.filter(":animated").length||f._trigger("select",null,f._ui(this,w[0]))===false){this.blur();return false}j.selected=f.anchors.index(this);f.abort();if(j.collapsible)if(u.hasClass("ui-tabs-selected")){j.selected=
-1;j.cookie&&f._cookie(j.selected,j.cookie);f.element.queue("tabs",function(){s(r,v)}).dequeue("tabs");this.blur();return false}else if(!v.length){j.cookie&&f._cookie(j.selected,j.cookie);f.element.queue("tabs",function(){q(r,w)});f.load(f.anchors.index(this));this.blur();return false}j.cookie&&f._cookie(j.selected,j.cookie);if(w.length){v.length&&f.element.queue("tabs",function(){s(r,v)});f.element.queue("tabs",function(){q(r,w)});f.load(f.anchors.index(this))}else throw"jQuery UI Tabs: Mismatching fragment identifier.";
a.browser.msie&&this.blur()});this.anchors.bind("click.tabs",function(){return false})},_getIndex:function(i){if(typeof i=="string")i=this.anchors.index(this.anchors.filter("[href$="+i+"]"));return i},destroy:function(){var i=this.options;this.abort();this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var b=
a.data(this,"href.tabs");if(b)this.href=b;var f=a(this).unbind(".tabs");a.each(["href","load","cache"],function(j,l){f.removeData(l+".tabs")})});this.lis.unbind(".tabs").add(this.panels).each(function(){a.data(this,"destroy.tabs")?a(this).remove():a(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide")});i.cookie&&this._cookie(null,i.cookie);return this},add:function(i,
b,f){if(f===d)f=this.anchors.length;var j=this,l=this.options;b=a(l.tabTemplate.replace(/#\{href\}/g,i).replace(/#\{label\}/g,b));i=!i.indexOf("#")?i.replace("#",""):this._tabId(a("a",b)[0]);b.addClass("ui-state-default ui-corner-top").data("destroy.tabs",true);var o=j.element.find("#"+i);o.length||(o=a(l.panelTemplate).attr("id",i).data("destroy.tabs",true));o.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");if(f>=this.lis.length){b.appendTo(this.list);o.appendTo(this.list[0].parentNode)}else{b.insertBefore(this.lis[f]);
o.insertBefore(this.panels[f])}l.disabled=a.map(l.disabled,function(n){return n>=f?++n:n});this._tabify();if(this.anchors.length==1){l.selected=0;b.addClass("ui-tabs-selected ui-state-active");o.removeClass("ui-tabs-hide");this.element.queue("tabs",function(){j._trigger("show",null,j._ui(j.anchors[0],j.panels[0]))});this.load(0)}this._trigger("add",null,this._ui(this.anchors[f],this.panels[f]));return this},remove:function(i){i=this._getIndex(i);var b=this.options,f=this.lis.eq(i).remove(),j=this.panels.eq(i).remove();
if(f.hasClass("ui-tabs-selected")&&this.anchors.length>1)this.select(i+(i+1<this.anchors.length?1:-1));b.disabled=a.map(a.grep(b.disabled,function(l){return l!=i}),function(l){return l>=i?--l:l});this._tabify();this._trigger("remove",null,this._ui(f.find("a")[0],j[0]));return this},enable:function(i){i=this._getIndex(i);var b=this.options;if(a.inArray(i,b.disabled)!=-1){this.lis.eq(i).removeClass("ui-state-disabled");b.disabled=a.grep(b.disabled,function(f){return f!=i});this._trigger("enable",null,
this._ui(this.anchors[i],this.panels[i]));return this}},disable:function(i){i=this._getIndex(i);var b=this.options;if(i!=b.selected){this.lis.eq(i).addClass("ui-state-disabled");b.disabled.push(i);b.disabled.sort();this._trigger("disable",null,this._ui(this.anchors[i],this.panels[i]))}return this},select:function(i){i=this._getIndex(i);if(i==-1)if(this.options.collapsible&&this.options.selected!=-1)i=this.options.selected;else return this;this.anchors.eq(i).trigger(this.options.event+".tabs");return this},
load:function(i){i=this._getIndex(i);var b=this,f=this.options,j=this.anchors.eq(i)[0],l=a.data(j,"load.tabs");this.abort();if(!l||this.element.queue("tabs").length!==0&&a.data(j,"cache.tabs"))this.element.dequeue("tabs");else{this.lis.eq(i).addClass("ui-state-processing");if(f.spinner){var o=a("span",j);o.data("label.tabs",o.html()).html(f.spinner)}this.xhr=a.ajax(a.extend({},f.ajaxOptions,{url:l,success:function(n,k){b.element.find(b._sanitizeSelector(j.hash)).html(n);b._cleanup();f.cache&&a.data(j,
"cache.tabs",true);b._trigger("load",null,b._ui(b.anchors[i],b.panels[i]));try{f.ajaxOptions.success(n,k)}catch(m){}},error:function(n,k){b._cleanup();b._trigger("load",null,b._ui(b.anchors[i],b.panels[i]));try{f.ajaxOptions.error(n,k,i,j)}catch(m){}}}));b.element.dequeue("tabs");return this}},abort:function(){this.element.queue([]);this.panels.stop(false,true);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));if(this.xhr){this.xhr.abort();delete this.xhr}this._cleanup();return this},
url:function(i,b){this.anchors.eq(i).removeData("cache.tabs").data("load.tabs",b);return this},length:function(){return this.anchors.length}});a.extend(a.ui.tabs,{version:"1.8.16"});a.extend(a.ui.tabs.prototype,{rotation:null,rotate:function(i,b){var f=this,j=this.options,l=f._rotate||(f._rotate=function(o){clearTimeout(f.rotation);f.rotation=setTimeout(function(){var n=j.selected;f.select(++n<f.anchors.length?n:0)},i);o&&o.stopPropagation()});b=f._unrotate||(f._unrotate=!b?function(o){o.clientX&&
f.rotate(null)}:function(){t=j.selected;l()});if(i){this.element.bind("tabsshow",l);this.anchors.bind(j.event+".tabs",b);l()}else{clearTimeout(f.rotation);this.element.unbind("tabsshow",l);this.anchors.unbind(j.event+".tabs",b);delete this._rotate;delete this._unrotate}return this}})})(jQuery);
};

},{}],29:[function(require,module,exports){
/*!
 * jQuery UI Touch Punch 0.2.2
 *
 * Copyright 2011, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
module.exports = function ($) {

  // Detect touch support
  $.support.touch = 'ontouchend' in document;

  // Ignore browsers without touch support
  if (!$.support.touch) {
    return;
  }

  var mouseProto = $.ui.mouse.prototype,
      _mouseInit = mouseProto._mouseInit,
      touchHandled;

  /**
   * Simulate a mouse event based on a corresponding touch event
   * @param {Object} event A touch event
   * @param {String} simulatedType The corresponding mouse event
   */
  function simulateMouseEvent (event, simulatedType) {

    // Ignore multi-touch events
    if (event.originalEvent.touches.length > 1) {
      return;
    }

    event.preventDefault();

    var touch = event.originalEvent.changedTouches[0],
        simulatedEvent = document.createEvent('MouseEvents');
    
    // Initialize the simulated mouse event using the touch event's coordinates
    simulatedEvent.initMouseEvent(
      simulatedType,    // type
      true,             // bubbles                    
      true,             // cancelable                 
      window,           // view                       
      1,                // detail                     
      touch.screenX,    // screenX                    
      touch.screenY,    // screenY                    
      touch.clientX,    // clientX                    
      touch.clientY,    // clientY                    
      false,            // ctrlKey                    
      false,            // altKey                     
      false,            // shiftKey                   
      false,            // metaKey                    
      0,                // button                     
      null              // relatedTarget              
    );

    // Dispatch the simulated event to the target element
    event.target.dispatchEvent(simulatedEvent);
  }

  /**
   * Handle the jQuery UI widget's touchstart events
   * @param {Object} event The widget element's touchstart event
   */
  mouseProto._touchStart = function (event) {

    var self = this;

    // Ignore the event if another widget is already being handled
    if (touchHandled || !self._mouseCapture(event.originalEvent.changedTouches[0])) {
      return;
    }
    
    // Set the flag to prevent other widgets from inheriting the touch event
    touchHandled = true;

    // Track movement to determine if interaction was a click
    self._touchMoved = false;

    // Simulate the mouseover event
    simulateMouseEvent(event, 'mouseover');

    // Simulate the mousemove event
    simulateMouseEvent(event, 'mousemove');

    // Simulate the mousedown event
    simulateMouseEvent(event, 'mousedown');
    
  };

  /**
   * Handle the jQuery UI widget's touchmove events
   * @param {Object} event The document's touchmove event
   */
  mouseProto._touchMove = function (event) {

    // Ignore event if not handled
    if (!touchHandled) {
      return;
    }

    // Interaction was not a click
    this._touchMoved = true;

    // Simulate the mousemove event
    simulateMouseEvent(event, 'mousemove');
  };

  /**
   * Handle the jQuery UI widget's touchend events
   * @param {Object} event The document's touchend event
   */
  mouseProto._touchEnd = function (event) {

    // Ignore event if not handled
    if (!touchHandled) {
      return;
    }

    // Simulate the mouseup event
    simulateMouseEvent(event, 'mouseup');

    // Simulate the mouseout event
    simulateMouseEvent(event, 'mouseout');

    // If the touch interaction did not move, it should trigger a click
    if (!this._touchMoved) {

      // Simulate the click event
      simulateMouseEvent(event, 'click');
    }

    // Unset the flag to allow other widgets to inherit the touch event
    touchHandled = false;
  };

  /**
   * A duck punch of the $.ui.mouse _mouseInit method to support touch events.
   * This method extends the widget with bound touch event handlers that
   * translate touch events to mouse events and pass them to the widget's
   * original mouse event handling methods.
   */
  mouseProto._mouseInit = function () {
    
    var self = this;

    // Delegate the touch handlers to the widget's element
    self.element
      .bind('touchstart', $.proxy(self, '_touchStart'))
      .bind('touchmove', $.proxy(self, '_touchMove'))
      .bind('touchend', $.proxy(self, '_touchEnd'));

    // Call the original $.ui.mouse init method
    _mouseInit.call(self);
  };

};
},{}],30:[function(require,module,exports){
/**
 * Farbtastic Color Picker 1.2
 *  2008 Steven Wittens
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 */

module.exports = function(jQuery) {

jQuery.fn.farbtastic = function (callback) {
  $.farbtastic(this, callback);
  return this;
};

jQuery.farbtastic = function (container, callback) {
  var container = $(container).get(0);
  return container.farbtastic || (container.farbtastic = new jQuery._farbtastic(container, callback));
}

jQuery._farbtastic = function (container, callback) {
  // Store farbtastic object
  var fb = this;

  // Insert markup
  $(container).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');
  var e = $('.farbtastic', container);
  fb.wheel = $('.wheel', container).get(0);
  // Dimensions
  fb.radius = 84;
  fb.square = 100;
  fb.width = 194;

  // Fix background PNGs in IE6
  if (navigator.appVersion.match(/MSIE [0-6]\./)) {
    $('*', e).each(function () {
      if (this.currentStyle.backgroundImage != 'none') {
        var image = this.currentStyle.backgroundImage;
        image = this.currentStyle.backgroundImage.substring(5, image.length - 2);
        $(this).css({
          'backgroundImage': 'none',
          'filter': "progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='" + image + "')"
        });
      }
    });
  }

  /**
   * Link to the given element(s) or callback.
   */
  fb.linkTo = function (callback) {
    // Unbind previous nodes
    if (typeof fb.callback == 'object') {
      $(fb.callback).unbind('keyup', fb.updateValue);
    }

    // Reset color
    fb.color = null;

    // Bind callback or elements
    if (typeof callback == 'function') {
      fb.callback = callback;
    }
    else if (typeof callback == 'object' || typeof callback == 'string') {
      fb.callback = $(callback);
      fb.callback.bind('keyup change blur', fb.updateValue);
      if (fb.callback.get(0).value) {
        fb.setColor(fb.callback.get(0).value);
      }
    }
    return this;
  }
  fb.updateValue = function (event) {
    if (this.value && this.value != fb.color) {
      fb.setColor(this.value);
    }
  }

  /**
   * Change color with HTML syntax #123456
   */
  fb.setColor = function (color) {
    var unpack = fb.unpack(color);
    if (fb.color != color && unpack) {
      fb.color = color;
      fb.rgb = unpack;
      fb.hsl = fb.RGBToHSL(fb.rgb);
      fb.updateDisplay();
    }
    return this;
  }

  /**
   * Change color with HSL triplet [0..1, 0..1, 0..1]
   */
  fb.setHSL = function (hsl) {
    fb.hsl = hsl;
    fb.rgb = fb.HSLToRGB(hsl);
    fb.color = fb.pack(fb.rgb);
    fb.updateDisplay();
    return this;
  }

  /////////////////////////////////////////////////////

  /**
   * Retrieve the coordinates of the given event relative to the center
   * of the widget.
   */
  fb.widgetCoords = function (event) {
    var x, y;
    var el = event.target || event.srcElement;
    var reference = fb.wheel;

    if (typeof event.offsetX != 'undefined') {
      // Use offset coordinates and find common offsetParent
      var pos = { x: event.offsetX, y: event.offsetY };

      // Send the coordinates upwards through the offsetParent chain.
      var e = el;
      while (e) {
        e.mouseX = pos.x;
        e.mouseY = pos.y;
        pos.x += e.offsetLeft;
        pos.y += e.offsetTop;
        e = e.offsetParent;
      }

      // Look for the coordinates starting from the wheel widget.
      var e = reference;
      var offset = { x: 0, y: 0 }
      while (e) {
        if (typeof e.mouseX != 'undefined') {
          x = e.mouseX - offset.x;
          y = e.mouseY - offset.y;
          break;
        }
        offset.x += e.offsetLeft;
        offset.y += e.offsetTop;
        e = e.offsetParent;
      }

      // Reset stored coordinates
      e = el;
      while (e) {
        e.mouseX = undefined;
        e.mouseY = undefined;
        e = e.offsetParent;
      }
    }
    else {
      // Use absolute coordinates
      var pos = fb.absolutePosition(reference);
      x = (event.pageX || 0*(event.clientX + $('html').get(0).scrollLeft)) - pos.x;
      y = (event.pageY || 0*(event.clientY + $('html').get(0).scrollTop)) - pos.y;
    }
    // Subtract distance to middle
    return { x: x - fb.width / 2, y: y - fb.width / 2 };
  }

  /**
   * Mousedown handler
   */
  fb.mousedown = function (event) {
    // Capture mouse
    if (!document.dragging) {
      $(document).bind('mousemove', fb.mousemove).bind('mouseup', fb.mouseup);
      document.dragging = true;
    }

    // Check which area is being dragged
    var pos = fb.widgetCoords(event);
    fb.circleDrag = Math.max(Math.abs(pos.x), Math.abs(pos.y)) * 2 > fb.square;

    // Process
    fb.mousemove(event);
    return false;
  }

  /**
   * Mousemove handler
   */
  fb.mousemove = function (event) {
    // Get coordinates relative to color picker center
    var pos = fb.widgetCoords(event);

    // Set new HSL parameters
    if (fb.circleDrag) {
      var hue = Math.atan2(pos.x, -pos.y) / 6.28;
      if (hue < 0) hue += 1;
      fb.setHSL([hue, fb.hsl[1], fb.hsl[2]]);
    }
    else {
      var sat = Math.max(0, Math.min(1, -(pos.x / fb.square) + .5));
      var lum = Math.max(0, Math.min(1, -(pos.y / fb.square) + .5));
      fb.setHSL([fb.hsl[0], sat, lum]);
    }
    return false;
  }

  /**
   * Mouseup handler
   */
  fb.mouseup = function () {
    // Uncapture mouse
    $(document).unbind('mousemove', fb.mousemove);
    $(document).unbind('mouseup', fb.mouseup);
    document.dragging = false;
  }

  /**
   * Update the markers and styles
   */
  fb.updateDisplay = function () {
    // Markers
    var angle = fb.hsl[0] * 6.28;
    $('.h-marker', e).css({
      left: Math.round(Math.sin(angle) * fb.radius + fb.width / 2) + 'px',
      top: Math.round(-Math.cos(angle) * fb.radius + fb.width / 2) + 'px'
    });

    $('.sl-marker', e).css({
      left: Math.round(fb.square * (.5 - fb.hsl[1]) + fb.width / 2) + 'px',
      top: Math.round(fb.square * (.5 - fb.hsl[2]) + fb.width / 2) + 'px'
    });

    // Saturation/Luminance gradient
    $('.color', e).css('backgroundColor', 'rgb(' + fb.pack(fb.HSLToRGB([fb.hsl[0], 1, 0.5])) + ')');

    // Linked elements or callback
    if (typeof fb.callback == 'object') {
      // Set background/foreground color
      $(fb.callback).css({
        backgroundColor: 'rgb(' + fb.color + ')',
        color: fb.hsl[2] > 0.5 ? '#000' : '#fff'
      });

      // Change linked value
      $(fb.callback).each(function() {
        if (this.value != fb.color) {
          this.value = fb.color;
        }
      });
    }
    else if (typeof fb.callback == 'function') {
      fb.callback.call(fb, fb.color);
    }
  }

  /**
   * Get absolute position of element
   */
  fb.absolutePosition = function (el) {
    var r = { x: el.offsetLeft, y: el.offsetTop };
    // Resolve relative to offsetParent
    if (el.offsetParent) {
      var tmp = fb.absolutePosition(el.offsetParent);
      r.x += tmp.x;
      r.y += tmp.y;
    }
    return r;
  };

  /* Various color utility functions */
  fb.pack = function (rgb, hex) {
    var r = Math.round(rgb[0] * 255);
    var g = Math.round(rgb[1] * 255);
    var b = Math.round(rgb[2] * 255);
    if (hex) {
      return '#' + (r < 16 ? '0' : '') + r.toString(16) +
             (g < 16 ? '0' : '') + g.toString(16) +
             (b < 16 ? '0' : '') + b.toString(16);
    } else {
      return r.toString() + ',' + g.toString() + ',' + b.toString();
    }
  }

  fb.unpack = function (color) {
    if ((/\d+,\d+,\d/).test(color)) {
      var nums = color.split(/,/);
      return [parseInt(nums[0], 10) / 255,
        parseInt(nums[1], 10) / 255,
        parseInt(nums[2], 10) / 255];
    }
    else if (color.length == 7) {
      return [parseInt('0x' + color.substring(1, 3)) / 255,
        parseInt('0x' + color.substring(3, 5)) / 255,
        parseInt('0x' + color.substring(5, 7)) / 255];
    }
    else if (color.length == 4) {
      return [parseInt('0x' + color.substring(1, 2)) / 15,
        parseInt('0x' + color.substring(2, 3)) / 15,
        parseInt('0x' + color.substring(3, 4)) / 15];
    }
  }

  fb.HSLToRGB = function (hsl) {
    var m1, m2, r, g, b;
    var h = hsl[0], s = hsl[1], l = hsl[2];
    m2 = (l <= 0.5) ? l * (s + 1) : l + s - l*s;
    m1 = l * 2 - m2;
    return [this.hueToRGB(m1, m2, h+0.33333),
        this.hueToRGB(m1, m2, h),
        this.hueToRGB(m1, m2, h-0.33333)];
  }

  fb.hueToRGB = function (m1, m2, h) {
    h = (h < 0) ? h + 1 : ((h > 1) ? h - 1 : h);
    if (h * 6 < 1) return m1 + (m2 - m1) * h * 6;
    if (h * 2 < 1) return m2;
    if (h * 3 < 2) return m1 + (m2 - m1) * (0.66666 - h) * 6;
    return m1;
  }

  fb.RGBToHSL = function (rgb) {
    var min, max, delta, h, s, l;
    var r = rgb[0], g = rgb[1], b = rgb[2];
    min = Math.min(r, Math.min(g, b));
    max = Math.max(r, Math.max(g, b));
    delta = max - min;
    l = (min + max) / 2;
    s = 0;
    if (l > 0 && l < 1) {
      s = delta / (l < 0.5 ? (2 * l) : (2 - 2 * l));
    }
    h = 0;
    if (delta > 0) {
      if (max == r && max != g) h += (g - b) / delta;
      if (max == g && max != b) h += (2 + (b - r) / delta);
      if (max == b && max != r) h += (4 + (r - g) / delta);
      h /= 6;
    }
    return [h, s, l];
  }

  // Install mousedown handler (the others are set on the document on-demand)
  $('*', e).mousedown(fb.mousedown);

    // Init color
  fb.setColor('#000000');

  // Set linked elements/callback
  if (callback) {
    fb.linkTo(callback);
  }
}

};
},{}],31:[function(require,module,exports){
// ================================================================
// = The following are short jQuery extensions used by chromozoom =
// ================================================================

module.exports = function($) {
  
var utils = require('./utils.js')($),
  floorHack = utils.floorHack;

// Make a unique ID for an arbitary element, using the given prefix string
$.uniqId = function(prefix, alsoDisallow) {
  var rand = function() { return floorHack(Math.random()*1000000); };
  var num = rand();
  while ((alsoDisallow && alsoDisallow[num]) || $('#'+prefix+'-'+num).length) { num = rand(); }
  return prefix+'-'+num;
};

// Make a new element (faster than $("<elem/>"))
$.mk = function(NS, elem) { 
  return (elem && document.createElementNS) ? $(document.createElementNS(NS, elem)) 
    : $(document.createElement(elem = NS)); 
}

// jQuery Hotkeys Plugin, copyright 2010, John Resig
// Dual licensed under the MIT or GPL Version 2 licenses
// https://github.com/jeresig/jquery.hotkeys
$.hotkeys = {
  version: "0.8",

  specialKeys: {
    8: "backspace", 9: "tab", 13: "return", 16: "shift", 17: "ctrl", 18: "alt", 19: "pause",
    20: "capslock", 27: "esc", 32: "space", 33: "pageup", 34: "pagedown", 35: "end", 36: "home",
    37: "left", 38: "up", 39: "right", 40: "down", 45: "insert", 46: "del", 
    96: "0", 97: "1", 98: "2", 99: "3", 100: "4", 101: "5", 102: "6", 103: "7",
    104: "8", 105: "9", 106: "*", 107: "+", 109: "-", 110: ".", 111 : "/", 
    112: "f1", 113: "f2", 114: "f3", 115: "f4", 116: "f5", 117: "f6", 118: "f7", 119: "f8", 
    120: "f9", 121: "f10", 122: "f11", 123: "f12", 144: "numlock", 145: "scroll", 191: "/", 224: "meta"
  },

  shiftNums: {
    "`": "~", "1": "!", "2": "@", "3": "#", "4": "$", "5": "%", "6": "^", "7": "&", 
    "8": "*", "9": "(", "0": ")", "-": "_", "=": "+", ";": ": ", "'": "\"", ",": "<", 
    ".": ">",  "/": "?",  "\\": "|"
  }
};

function keyHandler( handleObj ) {
  // Only care when a possible input has been specified
  if ( typeof handleObj.data !== "string" ) {
    return;
  }

  var origHandler = handleObj.handler,
    keys = handleObj.data.toLowerCase().split(" ");

  handleObj.handler = function( event ) {
    // Don't fire in text-accepting inputs that we didn't directly bind to
    if ( this !== event.target && (/textarea|select/i.test( event.target.nodeName ) ||
      event.target.type === "text" || event.target.type == "search" || event.target.type === "url") ) {
      return;
    }

    // Keypress represents characters, not special keys
    var special = event.type !== "keypress" && $.hotkeys.specialKeys[ event.which ],
      character = String.fromCharCode( event.which ).toLowerCase(),
      key, modif = "", possible = {};

    // check combinations (alt|ctrl|shift+anything)
    if ( event.altKey && special !== "alt" ) {
      modif += "alt+";
    }

    if ( event.ctrlKey && special !== "ctrl" ) {
      modif += "ctrl+";
    }

    // TODO: Need to make sure this works consistently across platforms
    if ( event.metaKey && !event.ctrlKey && special !== "meta" ) {
      modif += "meta+";
    }

    if ( event.shiftKey && special !== "shift" ) {
      modif += "shift+";
    }

    if ( special ) {
      possible[ modif + special ] = true;

    } else {
      possible[ modif + character ] = true;
      possible[ modif + $.hotkeys.shiftNums[ character ] ] = true;

      // "$" can be triggered as "Shift+4" or "Shift+$" or just "$"
      if ( modif === "shift+" ) {
        possible[ $.hotkeys.shiftNums[ character ] ] = true;
      }
    }

    for ( var i = 0, l = keys.length; i < l; i++ ) {
      if ( possible[ keys[i] ] ) {
        return origHandler.apply( this, arguments );
      }
    }
  };
}

$.each([ "keydown", "keyup", "keypress" ], function() {
  $.event.special[ this ] = { add: keyHandler };
});

// jQuery sortElements by James Padolsey, dual licensed MIT/GPL
// Found at https://github.com/padolsey/jQuery-Plugins/tree/master/sortElements/
$.fn.sortElements = (function(){
  var sort = [].sort;
  return function(comparator, getSortable) {
    getSortable = getSortable || function(){return this;};
    var placements = this.map(function(){
      var sortElement = getSortable.call(this),
        parentNode = sortElement.parentNode,
        // Since the element itself will change position, we have
        // to have some way of storing its original position in
        // the DOM. The easiest way is to have a 'flag' node:
        nextSibling = parentNode.insertBefore(
          document.createTextNode(''),
          sortElement.nextSibling
        );
      return function() {
        if (parentNode === this) {
          throw "You can't sort elements if any one is a descendant of another.";
        }
        // Insert before flag:
        parentNode.insertBefore(this, nextSibling);
        // Remove flag:
        parentNode.removeChild(nextSibling);
      };
    });

    return sort.call(this, comparator).each(function(i){
      placements[i].call(getSortable.call(this));
    });
  };
})();

// jQuery Cookie Plugin, found at https://github.com/carhartl/jquery-cookie
// Copyright 2011, Klaus Hartl
// Dual licensed under the MIT or GPL Version 2 licenses.
(function($) {
  $.cookie = function(key, value, options) {
    // key and at least value given, set cookie...
    if (arguments.length > 1 && (!/Object/.test(Object.prototype.toString.call(value)) || value === null || value === undefined)) {
      options = $.extend({}, options);

      if (value === null || value === undefined) {
        options.expires = -1;
      }

      if (typeof options.expires === 'number') {
        var days = options.expires, t = options.expires = new Date();
        t.setDate(t.getDate() + days);
      }

      value = String(value);

      return (document.cookie = [
        encodeURIComponent(key), '=', options.raw ? value : encodeURIComponent(value),
        // use expires attribute, max-age is not supported by IE
        options.expires ? '; expires=' + options.expires.toUTCString() : '',
        options.path    ? '; path=' + options.path : '',
        options.domain  ? '; domain=' + options.domain : '',
        options.secure  ? '; secure' : ''
      ].join(''));
    }

    // key and possibly options given, get cookie...
    options = value || {};
    var decode = options.raw ? function(s) { return s; } : decodeURIComponent;

    var pairs = document.cookie.split('; ');
    for (var i = 0, pair; pair = pairs[i] && pairs[i].split('='); i++) {
      // IE saves cookies with empty string as "c; ", e.g. without "=" as opposed to EOMB, thus pair[1] may be undefined
      if (decode(pair[0]) === key) return decode(pair[1] || '');
    }
    return null;
  };
})($);

// http://stackoverflow.com/questions/901115/get-query-string-values-in-javascript
$.urlParams = function() {
  var p = {},
    e,
    a = /\+/g,  // Regex for replacing addition symbol with a space
    r = /([^&=]+)=?([^&]*)/g,
    d = function (s) { return decodeURIComponent(s.replace(a, " ")); },
    q = window.location.search.substring(1);

  while (e = r.exec(q)) { 
    var k = d(e[1]), v = d(e[2]); 
    p[k] = p[k] ? (_.isArray(p[k]) ? p[k].push(v) : [p[k], v]) : v; 
  }
  return p;
};

};
},{"./utils.js":33}],32:[function(require,module,exports){
 /*
 * TipTip
 * Copyright 2010 Drew Wilson
 * www.drewwilson.com
 * code.drewwilson.com/entry/tiptip-jquery-plugin
 *
 * Version 1.3   -   Updated: Mar. 23, 2010
 *
 * This Plug-In will create a custom tooltip to replace the default
 * browser tooltip. It is extremely lightweight and very smart in
 * that it detects the edges of the browser window and will make sure
 * the tooltip stays within the current window size. As a result the
 * tooltip will adjust itself to be displayed above, below, to the left 
 * or to the right depending on what is necessary to stay within the
 * browser window. It is completely customizable as well via CSS.
 *
 * This TipTip jQuery plug-in is dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */

var _ = require('../underscore.min.js');

module.exports = function($){
    
  var defaults = { 
    activation: "hover",
    keepAlive: false,
    edgeOffset: 3,
    defaultPosition: "bottom",
    delay: 400,
    fadeIn: 200,
    fadeOut: 200,
    attribute: "title",
    content: false, // HTML or String to fill TipTIp with
    enter: function(){},
    async: false,
    startActivated: false
  };
  var $tiptip_holder, $tiptip_content, $tiptip_arrow, activating_elem;
  
  function show_tiptip(opts) { 
    $tiptip_holder.stop(true, true).fadeIn(opts.fadeIn);
    if (opts.async && !$(this).data('tiptipActive')) { return; }
    
  };
  
  function fill_show_tiptip(d, self, content) {
    var opts = d.opts,
      $org_elem = d.org_elem,
      org_title = content ? content : d.org_title,
      timeout = $(self).data('tiptipTimeout'),
      active = $(self).data('tiptipActive'),
      firedAfter = (new Date).getTime() - active;
      
    if (opts.async) {
      if (!active) { return; }
      if (content === false) { $(this).data('tiptipActive', false); return; }
    }
    
    if (_.isString(org_title)) { $tiptip_content.html(org_title); }
    else { $tiptip_content.empty().append(org_title); }
    $tiptip_holder.removeAttr("class").css("margin", 0);
    $tiptip_arrow.removeAttr("style");

    var offset = $org_elem.offset(),
      top = offset.top,
      left = offset.left,
      scroll_top = $(window).scrollTop(),
      scroll_left = $(window).scrollLeft(),
      win_width = $(window).width(),
      win_height = $(window).height(),
      org_width = $org_elem.outerWidth(),
      org_height = $org_elem.outerHeight();

    if (left - scroll_left >= 0) { org_width = Math.min(org_width, win_width - (left - scroll_left)); }
    else { org_width += (left - scroll_left); left = scroll_left; }
    
    var tip_w = $tiptip_holder.outerWidth(),
      tip_h = $tiptip_holder.outerHeight(),
      w_compare = Math.round((org_width - tip_w) / 2),
      h_compare = Math.round((org_height - tip_h) / 2),
      marg_left = Math.round(left + w_compare),
      marg_top = Math.round(top + org_height + opts.edgeOffset),
      t_class = "",
      arrow_top = "",
      arrow_left = Math.round(tip_w - 12) / 2;

    t_class = "_" + opts.defaultPosition;

    var right_compare = (w_compare + left) < scroll_left,
      left_compare = (tip_w + left) > win_width;

    if ((right_compare && w_compare < 0) || (t_class == "_right" && !left_compare) 
        || (t_class == "_left" && left < (tip_w + opts.edgeOffset + 5))) {
      t_class = "_right";
      arrow_top = Math.round(tip_h - 13) / 2;
      arrow_left = -12;
      marg_left = Math.round(left + org_width + opts.edgeOffset);
      marg_top = Math.round(top + h_compare);
    } else if((left_compare && w_compare < 0) || (t_class == "_left" && !right_compare)){
      t_class = "_left";
      arrow_top = Math.round(tip_h - 13) / 2;
      arrow_left =  Math.round(tip_w);
      marg_left = Math.round(left - (tip_w + opts.edgeOffset + 5));
      marg_top = Math.round(top + h_compare);
    }

    var top_compare = (top + org_height + opts.edgeOffset + tip_h + 8) > win_height + scroll_top,
      bottom_compare = ((top + org_height) - (opts.edgeOffset + tip_h + 8)) < 0;

    if(top_compare || (t_class == "_bottom" && top_compare) || (t_class == "_top" && !bottom_compare)){
      if(t_class == "_top" || t_class == "_bottom"){
        t_class = "_top";
      } else {
        t_class = t_class+"_top";
      }
      arrow_top = tip_h;
      marg_top = Math.round(top - (tip_h + 5 + opts.edgeOffset));
    } else if(bottom_compare | (t_class == "_top" && bottom_compare) || (t_class == "_bottom" && !top_compare)){
      if(t_class == "_top" || t_class == "_bottom"){
        t_class = "_bottom";
      } else {
        t_class = t_class+"_bottom";
      }
      arrow_top = -12;            
      marg_top = Math.round(top + org_height + opts.edgeOffset);
    }

    if(t_class == "_right_top" || t_class == "_left_top"){
      marg_top = marg_top + 5;
    } else if(t_class == "_right_bottom" || t_class == "_left_bottom"){   
      marg_top = marg_top - 5;
    }
    if(t_class == "_left_top" || t_class == "_left_bottom"){  
      marg_left = marg_left + 5;
    }
    $tiptip_arrow.css({"margin-left": arrow_left+"px", "margin-top": arrow_top+"px"});
    $tiptip_holder.css({"margin-left": marg_left+"px", "margin-top": marg_top+"px"}).attr("class", "tip"+t_class);

    if (timeout) { clearTimeout(timeout); }
    if (firedAfter > opts.delay) { show_tiptip(opts); } 
    else { $(self).data('tiptipTimeout', setTimeout(_.bind(show_tiptip, self, opts), opts.delay - firedAfter)); }
  }

  function active_tiptip(e) {
    var self = this,
      d = e.data,
      content;
    $(this).data('tiptipActive', (new Date).getTime());
    if (activating_elem && activating_elem != self) { $.tipTip.hide(); }
    activating_elem = self;
    if (d.opts.async) { d.opts.enter.call(this, function(newContent) { fill_show_tiptip(d, self, newContent); }); }
    else {
      content = d.opts.enter.call(this);
      fill_show_tiptip(d, this, content); 
    }
    return d.retFalse ? false : null;
  }
  
  function deactive_tiptip(e, now) {
    var d = e.data,
      timeout = $(this).data('tiptipTimeout');
    $(this).data('tiptipActive', false);
    if (timeout){ clearTimeout(timeout); }
    activating_elem = null;
    $tiptip_holder.fadeOut(now ? d.opts.fadeOut : 0);
  }
  
  $.tipTip = {
    hide: function() {
      var $active = $(activating_elem);
      if ($active.parent().length > 0) { $active.trigger('hideTipTip'); } 
      else { $tiptip_holder && $tiptip_holder.hide(); }
      activating_elem = null;
    }
  };
  
  $.fn.tipTip = function(options) {
    var opts = $.extend({}, defaults, options);
    
    // Setup tip tip elements and render them to the DOM, if this wasn't already done previously
    if(typeof $tiptip_holder == 'undefined'){
      $tiptip_holder = $('<div id="tiptip_holder"></div>');
      $tiptip_content = $('<div id="tiptip_content"></div>');
      $tiptip_arrow = $('<div id="tiptip_arrow"></div>');
      $("body").append($tiptip_holder.html($tiptip_content).prepend($tiptip_arrow.html('<div id="tiptip_arrow_inner"></div>')));
    }
    
    return this.each(function(){
      var $org_elem = $(this);
      
      if (opts.content) {
        var org_title = opts.content;
      } else {
        var org_title = $org_elem.attr(opts.attribute);
      }
      
      if (org_title != "" || opts.async) {
        $org_elem.data('title', org_title);
        $org_elem.removeAttr(opts.attribute); //remove original Attribute
        var edata = {org_elem: $org_elem, org_title: org_title, opts: opts};
        
        if (opts.activation == "hover") {
          $org_elem.bind('mouseenter showTipTip', edata, active_tiptip);
          if (opts.keepAlive) { $tiptip_holder.bind('mouseleave hideTipTip', edata, deactive_tiptip); }
          else { $org_elem.bind('mouseleave hideTipTip', edata, deactive_tiptip); }
        } else if (opts.activation == "focus") {
          $org_elem.bind('focus showTipTip', edata, active_tiptip).bind('blur hideTipTip', edata, deactive_tiptip);
        } else if (opts.activation == "click") {
          $org_elem.bind('click showTipTip', $.extend({retFalse: true}, edata), active_tiptip);
          if(opts.keepAlive){ $tiptip_holder.bind('mouseleave hideTipTip', edata, deactive_tiptip); } 
          else { $org_elem.bind('mouseleave hideTipTip', edata, deactive_tiptip); }
        }
        if (opts.startActivated) { $org_elem.trigger('showTipTip'); }
      }
    });
  }
};
},{"../underscore.min.js":34}],33:[function(require,module,exports){
module.exports = function($) {
  // ==================================================================================
  // = The following are helper functions used widely throughout the rest of the code =
  // ==================================================================================
  
  utils = {};
  
  // Faster than Math.floor (http://webdood.com/?p=219)
  utils.floorHack = function(num) { return (num << 0) - (num < 0 ? 1 : 0); }
  
  // Pads a number with front-leading 0's to given length
  utils.pad = function(number, length) {
    var str = '' + number;
    while (str.length < length) { str = '0' + str; }
    return str;
  }

  // Turns an arbitrary string into something that can be used as an element's class
  utils.classFriendly = function(val) { return val.toString().replace(/[^_a-zA-Z0-9-]/g, '-'); }
  
  // Mostly for debugging; show the fps in the bottom-right corner of the browser
  utils.fps = function(a, b, c) {
    $('#fps').text(a + ' ' + utils.floorHack(1000/b) + ' ' + utils.floorHack(c*10)/10 + ' ' + $('#browser *').length);
  }
  
  // A simplistic hash function for quickly turning strings into numbers
  // Note that since the hash space is 2^32, collisions are practically guaranteed after 80k strings, 
  // and there's a 5% chance at 20k: http://betterexplained.com/articles/understanding-the-birthday-paradox/
  utils.shortHash = function(str) {
    var hash = 0;
    if (str.length == 0) return hash;
    for (i = 0; i < str.length; i++) {
      chr = str.charCodeAt(i);
      hash = ((hash<<5)-hash)+chr;
      hash = hash & hash;
    }
    return hash;
  }
  
  // Get the last name in a path-like string (after the last slash/backslash)
  utils.basename = function(path) { return path.replace(/^.*[\/\\]/g, ''); };
  
  // Decode characters that are safe within our query strings, for increased readability
  utils.decodeSafeOctets = function(query) {
    var safe = {'3A': ':', '40': '@', '7C': '|', '2F': '/'};
    return query.replace(/%([0-9A-F]{2})/gi, function(m, oct) { return safe[oct] || m; });
  }
  
  // Escape something so it can be inserted into a regular expression
  utils.regExpQuote = function(str) { return str.replace(/([.?*+^$[\]\\(){}-])/g, "\\$1"); };
  
  return utils;
  
};
},{}],34:[function(require,module,exports){
//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.
(function(){function n(n){function t(t,r,e,u,i,o){for(;i>=0&&o>i;i+=n){var a=u?u[i]:i;e=r(e,t[a],a,t)}return e}return function(r,e,u,i){e=b(e,i,4);var o=!k(r)&&m.keys(r),a=(o||r).length,c=n>0?0:a-1;return arguments.length<3&&(u=r[o?o[c]:c],c+=n),t(r,e,u,o,c,a)}}function t(n){return function(t,r,e){r=x(r,e);for(var u=O(t),i=n>0?0:u-1;i>=0&&u>i;i+=n)if(r(t[i],i,t))return i;return-1}}function r(n,t,r){return function(e,u,i){var o=0,a=O(e);if("number"==typeof i)n>0?o=i>=0?i:Math.max(i+a,o):a=i>=0?Math.min(i+1,a):i+a+1;else if(r&&i&&a)return i=r(e,u),e[i]===u?i:-1;if(u!==u)return i=t(l.call(e,o,a),m.isNaN),i>=0?i+o:-1;for(i=n>0?o:a-1;i>=0&&a>i;i+=n)if(e[i]===u)return i;return-1}}function e(n,t){var r=I.length,e=n.constructor,u=m.isFunction(e)&&e.prototype||a,i="constructor";for(m.has(n,i)&&!m.contains(t,i)&&t.push(i);r--;)i=I[r],i in n&&n[i]!==u[i]&&!m.contains(t,i)&&t.push(i)}var u=this,i=u._,o=Array.prototype,a=Object.prototype,c=Function.prototype,f=o.push,l=o.slice,s=a.toString,p=a.hasOwnProperty,h=Array.isArray,v=Object.keys,g=c.bind,y=Object.create,d=function(){},m=function(n){return n instanceof m?n:this instanceof m?void(this._wrapped=n):new m(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=m),exports._=m):u._=m,m.VERSION="1.8.3";var b=function(n,t,r){if(t===void 0)return n;switch(null==r?3:r){case 1:return function(r){return n.call(t,r)};case 2:return function(r,e){return n.call(t,r,e)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,i){return n.call(t,r,e,u,i)}}return function(){return n.apply(t,arguments)}},x=function(n,t,r){return null==n?m.identity:m.isFunction(n)?b(n,t,r):m.isObject(n)?m.matcher(n):m.property(n)};m.iteratee=function(n,t){return x(n,t,1/0)};var _=function(n,t){return function(r){var e=arguments.length;if(2>e||null==r)return r;for(var u=1;e>u;u++)for(var i=arguments[u],o=n(i),a=o.length,c=0;a>c;c++){var f=o[c];t&&r[f]!==void 0||(r[f]=i[f])}return r}},j=function(n){if(!m.isObject(n))return{};if(y)return y(n);d.prototype=n;var t=new d;return d.prototype=null,t},w=function(n){return function(t){return null==t?void 0:t[n]}},A=Math.pow(2,53)-1,O=w("length"),k=function(n){var t=O(n);return"number"==typeof t&&t>=0&&A>=t};m.each=m.forEach=function(n,t,r){t=b(t,r);var e,u;if(k(n))for(e=0,u=n.length;u>e;e++)t(n[e],e,n);else{var i=m.keys(n);for(e=0,u=i.length;u>e;e++)t(n[i[e]],i[e],n)}return n},m.map=m.collect=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=Array(u),o=0;u>o;o++){var a=e?e[o]:o;i[o]=t(n[a],a,n)}return i},m.reduce=m.foldl=m.inject=n(1),m.reduceRight=m.foldr=n(-1),m.find=m.detect=function(n,t,r){var e;return e=k(n)?m.findIndex(n,t,r):m.findKey(n,t,r),e!==void 0&&e!==-1?n[e]:void 0},m.filter=m.select=function(n,t,r){var e=[];return t=x(t,r),m.each(n,function(n,r,u){t(n,r,u)&&e.push(n)}),e},m.reject=function(n,t,r){return m.filter(n,m.negate(x(t)),r)},m.every=m.all=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=0;u>i;i++){var o=e?e[i]:i;if(!t(n[o],o,n))return!1}return!0},m.some=m.any=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=0;u>i;i++){var o=e?e[i]:i;if(t(n[o],o,n))return!0}return!1},m.contains=m.includes=m.include=function(n,t,r,e){return k(n)||(n=m.values(n)),("number"!=typeof r||e)&&(r=0),m.indexOf(n,t,r)>=0},m.invoke=function(n,t){var r=l.call(arguments,2),e=m.isFunction(t);return m.map(n,function(n){var u=e?t:n[t];return null==u?u:u.apply(n,r)})},m.pluck=function(n,t){return m.map(n,m.property(t))},m.where=function(n,t){return m.filter(n,m.matcher(t))},m.findWhere=function(n,t){return m.find(n,m.matcher(t))},m.max=function(n,t,r){var e,u,i=-1/0,o=-1/0;if(null==t&&null!=n){n=k(n)?n:m.values(n);for(var a=0,c=n.length;c>a;a++)e=n[a],e>i&&(i=e)}else t=x(t,r),m.each(n,function(n,r,e){u=t(n,r,e),(u>o||u===-1/0&&i===-1/0)&&(i=n,o=u)});return i},m.min=function(n,t,r){var e,u,i=1/0,o=1/0;if(null==t&&null!=n){n=k(n)?n:m.values(n);for(var a=0,c=n.length;c>a;a++)e=n[a],i>e&&(i=e)}else t=x(t,r),m.each(n,function(n,r,e){u=t(n,r,e),(o>u||1/0===u&&1/0===i)&&(i=n,o=u)});return i},m.shuffle=function(n){for(var t,r=k(n)?n:m.values(n),e=r.length,u=Array(e),i=0;e>i;i++)t=m.random(0,i),t!==i&&(u[i]=u[t]),u[t]=r[i];return u},m.sample=function(n,t,r){return null==t||r?(k(n)||(n=m.values(n)),n[m.random(n.length-1)]):m.shuffle(n).slice(0,Math.max(0,t))},m.sortBy=function(n,t,r){return t=x(t,r),m.pluck(m.map(n,function(n,r,e){return{value:n,index:r,criteria:t(n,r,e)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index-t.index}),"value")};var F=function(n){return function(t,r,e){var u={};return r=x(r,e),m.each(t,function(e,i){var o=r(e,i,t);n(u,e,o)}),u}};m.groupBy=F(function(n,t,r){m.has(n,r)?n[r].push(t):n[r]=[t]}),m.indexBy=F(function(n,t,r){n[r]=t}),m.countBy=F(function(n,t,r){m.has(n,r)?n[r]++:n[r]=1}),m.toArray=function(n){return n?m.isArray(n)?l.call(n):k(n)?m.map(n,m.identity):m.values(n):[]},m.size=function(n){return null==n?0:k(n)?n.length:m.keys(n).length},m.partition=function(n,t,r){t=x(t,r);var e=[],u=[];return m.each(n,function(n,r,i){(t(n,r,i)?e:u).push(n)}),[e,u]},m.first=m.head=m.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:m.initial(n,n.length-t)},m.initial=function(n,t,r){return l.call(n,0,Math.max(0,n.length-(null==t||r?1:t)))},m.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:m.rest(n,Math.max(0,n.length-t))},m.rest=m.tail=m.drop=function(n,t,r){return l.call(n,null==t||r?1:t)},m.compact=function(n){return m.filter(n,m.identity)};var S=function(n,t,r,e){for(var u=[],i=0,o=e||0,a=O(n);a>o;o++){var c=n[o];if(k(c)&&(m.isArray(c)||m.isArguments(c))){t||(c=S(c,t,r));var f=0,l=c.length;for(u.length+=l;l>f;)u[i++]=c[f++]}else r||(u[i++]=c)}return u};m.flatten=function(n,t){return S(n,t,!1)},m.without=function(n){return m.difference(n,l.call(arguments,1))},m.uniq=m.unique=function(n,t,r,e){m.isBoolean(t)||(e=r,r=t,t=!1),null!=r&&(r=x(r,e));for(var u=[],i=[],o=0,a=O(n);a>o;o++){var c=n[o],f=r?r(c,o,n):c;t?(o&&i===f||u.push(c),i=f):r?m.contains(i,f)||(i.push(f),u.push(c)):m.contains(u,c)||u.push(c)}return u},m.union=function(){return m.uniq(S(arguments,!0,!0))},m.intersection=function(n){for(var t=[],r=arguments.length,e=0,u=O(n);u>e;e++){var i=n[e];if(!m.contains(t,i)){for(var o=1;r>o&&m.contains(arguments[o],i);o++);o===r&&t.push(i)}}return t},m.difference=function(n){var t=S(arguments,!0,!0,1);return m.filter(n,function(n){return!m.contains(t,n)})},m.zip=function(){return m.unzip(arguments)},m.unzip=function(n){for(var t=n&&m.max(n,O).length||0,r=Array(t),e=0;t>e;e++)r[e]=m.pluck(n,e);return r},m.object=function(n,t){for(var r={},e=0,u=O(n);u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},m.findIndex=t(1),m.findLastIndex=t(-1),m.sortedIndex=function(n,t,r,e){r=x(r,e,1);for(var u=r(t),i=0,o=O(n);o>i;){var a=Math.floor((i+o)/2);r(n[a])<u?i=a+1:o=a}return i},m.indexOf=r(1,m.findIndex,m.sortedIndex),m.lastIndexOf=r(-1,m.findLastIndex),m.range=function(n,t,r){null==t&&(t=n||0,n=0),r=r||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=Array(e),i=0;e>i;i++,n+=r)u[i]=n;return u};var E=function(n,t,r,e,u){if(!(e instanceof t))return n.apply(r,u);var i=j(n.prototype),o=n.apply(i,u);return m.isObject(o)?o:i};m.bind=function(n,t){if(g&&n.bind===g)return g.apply(n,l.call(arguments,1));if(!m.isFunction(n))throw new TypeError("Bind must be called on a function");var r=l.call(arguments,2),e=function(){return E(n,e,t,this,r.concat(l.call(arguments)))};return e},m.partial=function(n){var t=l.call(arguments,1),r=function(){for(var e=0,u=t.length,i=Array(u),o=0;u>o;o++)i[o]=t[o]===m?arguments[e++]:t[o];for(;e<arguments.length;)i.push(arguments[e++]);return E(n,r,this,this,i)};return r},m.bindAll=function(n){var t,r,e=arguments.length;if(1>=e)throw new Error("bindAll must be passed function names");for(t=1;e>t;t++)r=arguments[t],n[r]=m.bind(n[r],n);return n},m.memoize=function(n,t){var r=function(e){var u=r.cache,i=""+(t?t.apply(this,arguments):e);return m.has(u,i)||(u[i]=n.apply(this,arguments)),u[i]};return r.cache={},r},m.delay=function(n,t){var r=l.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},m.defer=m.partial(m.delay,m,1),m.throttle=function(n,t,r){var e,u,i,o=null,a=0;r||(r={});var c=function(){a=r.leading===!1?0:m.now(),o=null,i=n.apply(e,u),o||(e=u=null)};return function(){var f=m.now();a||r.leading!==!1||(a=f);var l=t-(f-a);return e=this,u=arguments,0>=l||l>t?(o&&(clearTimeout(o),o=null),a=f,i=n.apply(e,u),o||(e=u=null)):o||r.trailing===!1||(o=setTimeout(c,l)),i}},m.debounce=function(n,t,r){var e,u,i,o,a,c=function(){var f=m.now()-o;t>f&&f>=0?e=setTimeout(c,t-f):(e=null,r||(a=n.apply(i,u),e||(i=u=null)))};return function(){i=this,u=arguments,o=m.now();var f=r&&!e;return e||(e=setTimeout(c,t)),f&&(a=n.apply(i,u),i=u=null),a}},m.wrap=function(n,t){return m.partial(t,n)},m.negate=function(n){return function(){return!n.apply(this,arguments)}},m.compose=function(){var n=arguments,t=n.length-1;return function(){for(var r=t,e=n[t].apply(this,arguments);r--;)e=n[r].call(this,e);return e}},m.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},m.before=function(n,t){var r;return function(){return--n>0&&(r=t.apply(this,arguments)),1>=n&&(t=null),r}},m.once=m.partial(m.before,2);var M=!{toString:null}.propertyIsEnumerable("toString"),I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];m.keys=function(n){if(!m.isObject(n))return[];if(v)return v(n);var t=[];for(var r in n)m.has(n,r)&&t.push(r);return M&&e(n,t),t},m.allKeys=function(n){if(!m.isObject(n))return[];var t=[];for(var r in n)t.push(r);return M&&e(n,t),t},m.values=function(n){for(var t=m.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},m.mapObject=function(n,t,r){t=x(t,r);for(var e,u=m.keys(n),i=u.length,o={},a=0;i>a;a++)e=u[a],o[e]=t(n[e],e,n);return o},m.pairs=function(n){for(var t=m.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];return e},m.invert=function(n){for(var t={},r=m.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},m.functions=m.methods=function(n){var t=[];for(var r in n)m.isFunction(n[r])&&t.push(r);return t.sort()},m.extend=_(m.allKeys),m.extendOwn=m.assign=_(m.keys),m.findKey=function(n,t,r){t=x(t,r);for(var e,u=m.keys(n),i=0,o=u.length;o>i;i++)if(e=u[i],t(n[e],e,n))return e},m.pick=function(n,t,r){var e,u,i={},o=n;if(null==o)return i;m.isFunction(t)?(u=m.allKeys(o),e=b(t,r)):(u=S(arguments,!1,!1,1),e=function(n,t,r){return t in r},o=Object(o));for(var a=0,c=u.length;c>a;a++){var f=u[a],l=o[f];e(l,f,o)&&(i[f]=l)}return i},m.omit=function(n,t,r){if(m.isFunction(t))t=m.negate(t);else{var e=m.map(S(arguments,!1,!1,1),String);t=function(n,t){return!m.contains(e,t)}}return m.pick(n,t,r)},m.defaults=_(m.allKeys,!0),m.create=function(n,t){var r=j(n);return t&&m.extendOwn(r,t),r},m.clone=function(n){return m.isObject(n)?m.isArray(n)?n.slice():m.extend({},n):n},m.tap=function(n,t){return t(n),n},m.isMatch=function(n,t){var r=m.keys(t),e=r.length;if(null==n)return!e;for(var u=Object(n),i=0;e>i;i++){var o=r[i];if(t[o]!==u[o]||!(o in u))return!1}return!0};var N=function(n,t,r,e){if(n===t)return 0!==n||1/n===1/t;if(null==n||null==t)return n===t;n instanceof m&&(n=n._wrapped),t instanceof m&&(t=t._wrapped);var u=s.call(n);if(u!==s.call(t))return!1;switch(u){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!==+n?+t!==+t:0===+n?1/+n===1/t:+n===+t;case"[object Date]":case"[object Boolean]":return+n===+t}var i="[object Array]"===u;if(!i){if("object"!=typeof n||"object"!=typeof t)return!1;var o=n.constructor,a=t.constructor;if(o!==a&&!(m.isFunction(o)&&o instanceof o&&m.isFunction(a)&&a instanceof a)&&"constructor"in n&&"constructor"in t)return!1}r=r||[],e=e||[];for(var c=r.length;c--;)if(r[c]===n)return e[c]===t;if(r.push(n),e.push(t),i){if(c=n.length,c!==t.length)return!1;for(;c--;)if(!N(n[c],t[c],r,e))return!1}else{var f,l=m.keys(n);if(c=l.length,m.keys(t).length!==c)return!1;for(;c--;)if(f=l[c],!m.has(t,f)||!N(n[f],t[f],r,e))return!1}return r.pop(),e.pop(),!0};m.isEqual=function(n,t){return N(n,t)},m.isEmpty=function(n){return null==n?!0:k(n)&&(m.isArray(n)||m.isString(n)||m.isArguments(n))?0===n.length:0===m.keys(n).length},m.isElement=function(n){return!(!n||1!==n.nodeType)},m.isArray=h||function(n){return"[object Array]"===s.call(n)},m.isObject=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n},m.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(n){m["is"+n]=function(t){return s.call(t)==="[object "+n+"]"}}),m.isArguments(arguments)||(m.isArguments=function(n){return m.has(n,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(m.isFunction=function(n){return"function"==typeof n||!1}),m.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},m.isNaN=function(n){return m.isNumber(n)&&n!==+n},m.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"===s.call(n)},m.isNull=function(n){return null===n},m.isUndefined=function(n){return n===void 0},m.has=function(n,t){return null!=n&&p.call(n,t)},m.noConflict=function(){return u._=i,this},m.identity=function(n){return n},m.constant=function(n){return function(){return n}},m.noop=function(){},m.property=w,m.propertyOf=function(n){return null==n?function(){}:function(t){return n[t]}},m.matcher=m.matches=function(n){return n=m.extendOwn({},n),function(t){return m.isMatch(t,n)}},m.times=function(n,t,r){var e=Array(Math.max(0,n));t=b(t,r,1);for(var u=0;n>u;u++)e[u]=t(u);return e},m.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},m.now=Date.now||function(){return(new Date).getTime()};var B={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},T=m.invert(B),R=function(n){var t=function(t){return n[t]},r="(?:"+m.keys(n).join("|")+")",e=RegExp(r),u=RegExp(r,"g");return function(n){return n=null==n?"":""+n,e.test(n)?n.replace(u,t):n}};m.escape=R(B),m.unescape=R(T),m.result=function(n,t,r){var e=null==n?void 0:n[t];return e===void 0&&(e=r),m.isFunction(e)?e.call(n):e};var q=0;m.uniqueId=function(n){var t=++q+"";return n?n+t:t},m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\u2028|\u2029/g,L=function(n){return"\\"+z[n]};m.template=function(n,t,r){!t&&r&&(t=r),t=m.defaults({},t,m.templateSettings);var e=RegExp([(t.escape||K).source,(t.interpolate||K).source,(t.evaluate||K).source].join("|")+"|$","g"),u=0,i="__p+='";n.replace(e,function(t,r,e,o,a){return i+=n.slice(u,a).replace(D,L),u=a+t.length,r?i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":e?i+="'+\n((__t=("+e+"))==null?'':__t)+\n'":o&&(i+="';\n"+o+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var o=new Function(t.variable||"obj","_",i)}catch(a){throw a.source=i,a}var c=function(n){return o.call(this,n,m)},f=t.variable||"obj";return c.source="function("+f+"){\n"+i+"}",c},m.chain=function(n){var t=m(n);return t._chain=!0,t};var P=function(n,t){return n._chain?m(t).chain():t};m.mixin=function(n){m.each(m.functions(n),function(t){var r=m[t]=n[t];m.prototype[t]=function(){var n=[this._wrapped];return f.apply(n,arguments),P(this,r.apply(m,n))}})},m.mixin(m),m.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=o[n];m.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==n&&"splice"!==n||0!==r.length||delete r[0],P(this,r)}}),m.each(["concat","join","slice"],function(n){var t=o[n];m.prototype[n]=function(){return P(this,t.apply(this._wrapped,arguments))}}),m.prototype.value=function(){return this._wrapped},m.prototype.valueOf=m.prototype.toJSON=m.prototype.value,m.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return m})}).call(this);
},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL3dhdGNoaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9jaHJvbW96b29tLmpzIiwianMvY3VzdG9tL0N1c3RvbUdlbm9tZS5qcyIsImpzL2N1c3RvbS9DdXN0b21HZW5vbWVzLmpzIiwianMvY3VzdG9tL0N1c3RvbVRyYWNrLmpzIiwianMvY3VzdG9tL0N1c3RvbVRyYWNrcy5qcyIsImpzL2N1c3RvbS9nZW5vbWUtZm9ybWF0cy9jaHJvbXNpemVzLmpzIiwianMvY3VzdG9tL2dlbm9tZS1mb3JtYXRzL2Zhc3RhLmpzIiwianMvY3VzdG9tL2dlbm9tZS1mb3JtYXRzL2dlbmJhbmsuanMiLCJqcy9jdXN0b20vZ2Vub21lLWZvcm1hdHMvdXRpbHMvdXRpbHMuanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvYmFtLmpzIiwianMvY3VzdG9tL3RyYWNrLXR5cGVzL2JlZC5qcyIsImpzL2N1c3RvbS90cmFjay10eXBlcy9iZWRncmFwaC5qcyIsImpzL2N1c3RvbS90cmFjay10eXBlcy9iaWdiZWQuanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvYmlnd2lnLmpzIiwianMvY3VzdG9tL3RyYWNrLXR5cGVzL2ZlYXR1cmV0YWJsZS5qcyIsImpzL2N1c3RvbS90cmFjay10eXBlcy91dGlscy9JbnRlcnZhbFRyZWUuanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvdXRpbHMvTGluZU1hc2suanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvdXRpbHMvUGFpcmVkSW50ZXJ2YWxUcmVlLmpzIiwianMvY3VzdG9tL3RyYWNrLXR5cGVzL3V0aWxzL1JlbW90ZVRyYWNrLmpzIiwianMvY3VzdG9tL3RyYWNrLXR5cGVzL3V0aWxzL1NvcnRlZExpc3QuanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvdXRpbHMvdXRpbHMuanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvdmNmdGFiaXguanMiLCJqcy9jdXN0b20vdHJhY2stdHlwZXMvd2lnZ2xlXzAuanMiLCJqcy9qcXVlcnkubWluLmpzIiwianMvdWkvanF1ZXJ5LXVpLmdlbm9icm93c2VyLmpzIiwianMvdWkvanF1ZXJ5LXVpLmdlbm9saW5lLmpzIiwianMvdWkvanF1ZXJ5LXVpLmdlbm90cmFjay5qcyIsImpzL3VpL2pxdWVyeS11aS5taW4uanMiLCJqcy91aS9qcXVlcnktdWkudG91Y2gtcHVuY2guanMiLCJqcy91aS9qcXVlcnkuZmFyYnRhc3RpYy5qcyIsImpzL3VpL2pxdWVyeS5taXNjLXBsdWdpbnMuanMiLCJqcy91aS9qcXVlcnkudGlwdGlwLmpzIiwianMvdWkvdXRpbHMuanMiLCJqcy91bmRlcnNjb3JlLm1pbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzlIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbnRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOVZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeFFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUM3VUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3pJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQzNRQTtBQUNBO0FBQ0E7QUFDQTs7QUNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0d0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL1dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzE3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMU5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyREE7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbi8vIFdlbGNvbWUgdG8gQ2hyb21vWm9vbSEgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuLy8gVGhpcyBpcyB0aGUgSmF2YVNjcmlwdCBlbnRyeSBwb2ludCB3aGljaCBpcyAgICAgLy9cbi8vIGJ1aWx0IGludG8gdGhlIGZpbmFsIGFwcGxpY2F0aW9uIGJ5IGJyb3dzZXJpZnkgIC8vXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuLy8gRm9yIGluZm9ybWF0aW9uIG9uIGluc3RhbGxpbmcsIHNlZSAuLi9SRUFETUUubWQgLy9cbi8vIChjKSAyMDE2IFRoZW9kb3JlIFBhaywgQUdQTCwgc2VlIC4uL0xJQ0VOU0UgICAgIC8vXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxucmVxdWlyZSgnLi9qcXVlcnkubWluLmpzJykod2luZG93KTtcbnZhciBqUXVlcnkgPSB3aW5kb3dbJyQnXSA9IHdpbmRvdy5qUXVlcnk7XG5cbnJlcXVpcmUoJy4vdWkvanF1ZXJ5LXVpLm1pbi5qcycpKGpRdWVyeSk7XG5yZXF1aXJlKCcuL3VpL2pxdWVyeS11aS50b3VjaC1wdW5jaC5qcycpKGpRdWVyeSk7XG5cbndpbmRvdy5fID0gcmVxdWlyZSgnLi91bmRlcnNjb3JlLm1pbi5qcycpO1xuXG5yZXF1aXJlKCcuL2N1c3RvbS9DdXN0b21UcmFja3MuanMnKSh3aW5kb3cpO1xucmVxdWlyZSgnLi9jdXN0b20vQ3VzdG9tR2Vub21lcy5qcycpKHdpbmRvdyk7XG5cbnJlcXVpcmUoJy4vdWkvanF1ZXJ5LXVpLmdlbm9icm93c2VyLmpzJykoalF1ZXJ5KTsiLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gQ3VzdG9tR2Vub21lIHJlcHJlc2VudHMgYSBnZW5vbWUgc3BlY2lmaWNhdGlvbiB0aGF0IGNhbiBwcm9kdWNlIG9wdGlvbnMgZm9yICQudWkuZ2Vub2Jyb3dzZXIgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZ2xvYmFsKSB7XG5cbnZhciBfID0gcmVxdWlyZSgnLi4vdW5kZXJzY29yZS5taW4uanMnKTtcblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi9nZW5vbWUtZm9ybWF0cy91dGlscy91dGlscy5qcycpLFxuICBkZWVwQ2xvbmUgPSB1dGlscy5kZWVwQ2xvbmUsXG4gIGxvZzEwID0gdXRpbHMubG9nMTAsXG4gIHJvdW5kVG9QbGFjZXMgPSB1dGlscy5yb3VuZFRvUGxhY2VzO1xuXG5mdW5jdGlvbiBDdXN0b21HZW5vbWUoZ2l2ZW5Gb3JtYXQsIG1ldGFkYXRhKSB7ICAgIFxuICAvLyBnaXZlbkZvcm1hdCA9IGZhbHNlIC0tPiB0aGlzIGlzIGFuIGVtcHR5IEN1c3RvbUdlbm9tZSB0aGF0IHdpbGwgYmUgaHlkcmF0ZWQgd2l0aCB2YWx1ZXMgZnJvbSBhIHNlcmlhbGl6ZWQgb2JqZWN0XG4gIGlmIChnaXZlbkZvcm1hdCA9PT0gZmFsc2UpIHsgcmV0dXJuOyB9IFxuICBcbiAgdGhpcy5fcGFyc2VkID0gZmFsc2U7XG4gIHRoaXMuX2Zvcm1hdCA9IChnaXZlbkZvcm1hdCAmJiBnaXZlbkZvcm1hdC50b0xvd2VyQ2FzZSgpKSB8fCBcImNocm9tc2l6ZXNcIjtcbiAgdmFyIGZvcm1hdCA9IHRoaXMuZm9ybWF0KCk7XG4gIGlmIChmb3JtYXQgPT09IG51bGwpIHsgdGhyb3cgbmV3IEVycm9yKFwiVW5zdXBwb3J0ZWQgZ2Vub21lIGZvcm1hdCAnXCIrZm9ybWF0K1wiJyBlbmNvdW50ZXJlZFwiKTsgfVxuICBcbiAgLy8gdGhpcy5vcHRzIGhvbGRzIGV2ZXJ5dGhpbmcgdGhhdCAkLnVpLmdlbm9icm93c2VyIHdpbGwgbmVlZCB0byBjb25zdHJ1Y3QgYSB2aWV3IChzZWUgQ3VzdG9tR2Vub21lLmRlZmF1bHRzIGJlbG93KVxuICAvLyBpdCBET0VTIE5PVCByZWxhdGUgdG8gXCJvcHRpb25zXCIgZm9yIHBhcnNpbmcsIG9yIGhvdyB0aGUgZ2Vub21lIGlzIGJlaW5nIGludGVycHJldGVkLCBvciBhbnl0aGluZyBsaWtlIHRoYXRcbiAgdGhpcy5vcHRzID0gXy5leHRlbmQoe30sIGRlZXBDbG9uZSh0aGlzLmNvbnN0cnVjdG9yLmRlZmF1bHRzKSwgZGVlcENsb25lKGZvcm1hdC5kZWZhdWx0cyB8fCB7fSkpO1xuICBcbiAgLy8gdGhpcy5tZXRhZGF0YSBob2xkcyBpbmZvcm1hdGlvbiBleHRlcm5hbCB0byB0aGUgcGFyc2VkIHRleHQgcGFzc2VkIGluIGZyb20gdGhlIGJyb3dzZXIgKGUuZy4gZmlsZW5hbWUsIHNvdXJjZSlcbiAgdGhpcy5tZXRhZGF0YSA9IG1ldGFkYXRhO1xuICBcbiAgLy8gdGhpcy5kYXRhIGhvbGRzIGFueXRoaW5nIGFkZGl0aW9uYWxseSBwYXJzZWQgZnJvbSB0aGUgZ2Vub21lIGZpbGUgKG1ldGFkYXRhLCByZWZlcmVuY2VzLCBldGMuKVxuICAvLyB0eXBpY2FsbHkgdGhpcyBpcyBhcnJhbmdlZCBwZXIgY29udGlnLCBpbiB0aGUgYXJyYW5nZW1lbnQgb2YgdGhpcy5kYXRhLmNvbnRpZ3NbaV0uIC4uLlxuICB0aGlzLmRhdGEgPSB7XG4gICAgc2VxdWVuY2U6IFwiXCIgLy8gdGhlIGZ1bGwgY29uY2F0ZW5hdGVkIHNlcXVlbmNlIGZvciBhbGwgY29udGlncyBpbiB0aGlzIGdlbm9tZSwgaWYgYXZhaWxhYmxlXG4gIH07XG4gIFxuICAvLyBjYW4gd2UgY2FsbCAuZ2V0U2VxdWVuY2Ugb24gdGhpcyBDdXN0b21HZW5vbWU/XG4gIHRoaXMuY2FuR2V0U2VxdWVuY2UgPSBmYWxzZTtcbiAgXG4gIGlmKGZvcm1hdC5pbml0KSB7IGZvcm1hdC5pbml0LmNhbGwodGhpcyk7IH1cbn1cblxuQ3VzdG9tR2Vub21lLmRlZmF1bHRzID0ge1xuICAvLyBUaGUgZm9sbG93aW5nIGtleXMgc2hvdWxkIGJlIG92ZXJyaWRkZW4gd2hpbGUgcGFyc2luZyB0aGUgZ2Vub21lIGZpbGVcbiAgZ2Vub21lOiAnX2JsYW5rJyxcbiAgc3BlY2llczogJ0JsYW5rIEdlbm9tZScsXG4gIGFzc2VtYmx5RGF0ZTogJycsXG4gIHRpbGVEaXI6IG51bGwsXG4gIG92ZXJ6b29tQnBwcHM6IFtdLFxuICBudHNCZWxvdzogWzEsIDAuMV0sXG4gIGF2YWlsVHJhY2tzOiBbXG4gICAge1xuICAgICAgZmg6IHt9LCAgICAgICAgLy8gXCJmaXhlZCBoZWlnaHRzXCIgYWJvdmUgd2hpY2ggYSBkZW5zaXR5IGlzIGZvcmNlZCB0byBkaXNwbGF5IGFib3ZlIGEgY2VydGFpbiB0cmFjayBoZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgIC8vICAgIGZvcm1hdHRlZCBsaWtlIHtcIjEuMDBlKzA1XCI6e1wiZGVuc2VcIjoxNX19XG4gICAgICBuOiBcInJ1bGVyXCIsICAgIC8vIHNob3J0IHVuaXF1ZSBuYW1lIGZvciB0aGUgdHJhY2tcbiAgICAgIHM6IFtcImRlbnNlXCJdLCAgLy8gcG9zc2libGUgZGVuc2l0aWVzIGZvciB0aWxlcywgZS5nLiBbXCJkZW5zZVwiLCBcInNxdWlzaFwiLCBcInBhY2tcIl1cbiAgICAgIGg6IDI1ICAgICAgICAgIC8vIHN0YXJ0aW5nIGhlaWdodCBpbiBweFxuICAgIH1cbiAgXSxcbiAgZ2Vub21lU2l6ZTogMCxcbiAgY2hyTGVuZ3Roczoge30sXG4gIGNock9yZGVyOiBbXSxcbiAgY2hyQmFuZHM6IG51bGwsXG4gIHRpbGVXaWR0aDogMTAwMCxcbiAgc3ViZGlyRm9yQnBwcHNVbmRlcjogMzMwLFxuICBpZGVvZ3JhbXNBYm92ZTogMTAwMCxcbiAgbWF4TnRSZXF1ZXN0OiAyMDAwMCxcbiAgdHJhY2tzOiBbe246IFwicnVsZXJcIn1dLFxuICB0cmFja0Rlc2M6IHtcbiAgICBydWxlcjoge1xuICAgICAgY2F0OiBcIk1hcHBpbmcgYW5kIFNlcXVlbmNpbmcgVHJhY2tzXCIsXG4gICAgICBzbTogXCJCYXNlIFBvc2l0aW9uXCJcbiAgICB9XG4gIH0sXG4gIC8vIFRoZXNlIGxhc3QgdGhyZWUgd2lsbCBiZSBvdmVycmlkZGVuIHVzaW5nIGtub3dsZWRnZSBvZiB0aGUgd2luZG93J3Mgd2lkdGhcbiAgYnBwcHM6IFtdLFxuICBicHBwTnVtYmVyc0JlbG93OiBbXSxcbiAgaW5pdFpvb206IG51bGxcbn07XG5cbkN1c3RvbUdlbm9tZS5mb3JtYXRzID0ge1xuICBjaHJvbXNpemVzOiByZXF1aXJlKCcuL2dlbm9tZS1mb3JtYXRzL2Nocm9tc2l6ZXMuanMnKSxcbiAgZmFzdGE6IHJlcXVpcmUoJy4vZ2Vub21lLWZvcm1hdHMvZmFzdGEuanMnKSxcbiAgZ2VuYmFuazogcmVxdWlyZSgnLi9nZW5vbWUtZm9ybWF0cy9nZW5iYW5rLmpzJyksXG4gIGVtYmw6IG51bGwgLy8gVE9ETy4gQmFzaWNhbGx5IGdlbmJhbmsgd2l0aCBleHRyYSBjb2x1bW5zLlxufVxuXG5DdXN0b21HZW5vbWUucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZm9ybWF0KCkucGFyc2UuYXBwbHkodGhpcywgXy50b0FycmF5KGFyZ3VtZW50cykpO1xuICB0aGlzLnNldEdlbm9tZVN0cmluZygpO1xuICB0aGlzLl9wYXJzZWQgPSB0cnVlO1xufTtcblxuQ3VzdG9tR2Vub21lLnByb3RvdHlwZS5mb3JtYXQgPSBmdW5jdGlvbihmb3JtYXQpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBpZiAoXy5pc1VuZGVmaW5lZChmb3JtYXQpKSB7IGZvcm1hdCA9IHNlbGYuX2Zvcm1hdDsgfVxuICB2YXIgRm9ybWF0V3JhcHBlciA9IGZ1bmN0aW9uKCkgeyBfLmV4dGVuZCh0aGlzLCBzZWxmLmNvbnN0cnVjdG9yLmZvcm1hdHNbZm9ybWF0XSk7IHJldHVybiB0aGlzOyB9O1xuICBGb3JtYXRXcmFwcGVyLnByb3RvdHlwZSA9IHNlbGY7XG4gIHJldHVybiBuZXcgRm9ybWF0V3JhcHBlcigpO1xufTtcblxuQ3VzdG9tR2Vub21lLnByb3RvdHlwZS5zZXRHZW5vbWVTdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNlbGYgPSB0aGlzLFxuICAgIG8gPSBzZWxmLm9wdHMsXG4gICAgZXhjZXB0aW9ucyA9IFsnZmlsZScsICdpZ2InLCAnYWNjJywgJ3VybCcsICd1Y3NjJ10sXG4gICAgZXhjZXB0aW9uID0gXy5maW5kKGV4Y2VwdGlvbnMsIGZ1bmN0aW9uKHYpIHsgcmV0dXJuICFfLmlzVW5kZWZpbmVkKHNlbGYubWV0YWRhdGFbdl0pOyB9KSxcbiAgICBwaWVjZXMgPSBbXTtcbiAgaWYgKGV4Y2VwdGlvbikgeyBvLmdlbm9tZSA9IGV4Y2VwdGlvbiArIFwiOlwiICsgc2VsZi5tZXRhZGF0YVtleGNlcHRpb25dOyB9XG4gIGVsc2Uge1xuICAgIHBpZWNlcyA9IFsnY3VzdG9tJyArIChzZWxmLm1ldGFkYXRhLm5hbWUgPyAnOicgKyBzZWxmLm1ldGFkYXRhLm5hbWUgOiAnJyldO1xuICAgIF8uZWFjaChvLmNock9yZGVyLCBmdW5jdGlvbihjaHIpIHtcbiAgICAgIHBpZWNlcy5wdXNoKGNociArICc6JyArIG8uY2hyTGVuZ3Roc1tjaHJdKTtcbiAgICB9KTtcbiAgICBvLmdlbm9tZSA9IHBpZWNlcy5qb2luKCd8Jyk7XG4gIH1cbn07XG5cbi8vIFNvbWUgb2YgdGhlIG9wdGlvbnMgZm9yICQudWkuZ2Vub2Jyb3dzZXIgKGFsbCByL3Qgem9vbSBsZXZlbHMpIG11c3QgYmUgc2V0IGJhc2VkIG9uIHRoZSB3aWR0aCBvZiB0aGUgd2luZG93XG4vLyAgIFRoZXkgYXJlIC5icHBwcywgLmJwcHBOdW1iZXJzQmVsb3csIGFuZCAuaW5pdFpvb21cbi8vICAgVGhleSBkbyBub3QgYWZmZWN0IGFueSBvZiB0aGUgb3RoZXIgb3B0aW9ucyBzZXQgZHVyaW5nIHBhcnNpbmcuXG4vL1xuLy8gd2luZG93T3B0cyBNVVNUIGluY2x1ZGUgYSBwcm9wZXJ0eSwgLndpZHRoLCB0aGF0IGlzIHRoZSB3aW5kb3cuaW5uZXJXaWR0aFxuQ3VzdG9tR2Vub21lLnByb3RvdHlwZS5zZXRCcHBwcyA9IGZ1bmN0aW9uKHdpbmRvd09wdHMpIHtcbiAgd2luZG93T3B0cyA9IHdpbmRvd09wdHMgfHwge307XG4gIFxuICB2YXIgbyA9IHRoaXMub3B0cyxcbiAgICB3aW5kb3dXaWR0aCA9ICh3aW5kb3dPcHRzLndpZHRoICogMC42KSB8fCAxMDAwLFxuICAgIGJwcHAgPSBNYXRoLnJvdW5kKG8uZ2Vub21lU2l6ZSAvIHdpbmRvd1dpZHRoKSxcbiAgICBsb3dlc3RCcHBwID0gd2luZG93T3B0cy5sb3dlc3RCcHBwIHx8IDAuMSxcbiAgICBtYXhCcHBwcyA9IDEwMCxcbiAgICBicHBwcyA9IFtdLCBpID0gMCwgbG9nO1xuICBcbiAgLy8gY29tcGFyYWJsZSB0byBwYXJ0IG9mIFVDU0NDbGllbnQjbWFrZV9jb25maWcgaW4gbGliL3Vjc2Nfc3RpdGNoLnJiXG4gIHdoaWxlIChicHBwID49IGxvd2VzdEJwcHAgJiYgaSA8IG1heEJwcHBzKSB7XG4gICAgYnBwcHMucHVzaChicHBwKTtcbiAgICBsb2cgPSByb3VuZFRvUGxhY2VzKGxvZzEwKGJwcHApLCA0KTtcbiAgICBicHBwID0gKE1hdGguY2VpbChsb2cpIC0gbG9nIDwgMC40ODEpID8gMy4zICogTWF0aC5wb3coMTAsIE1hdGguY2VpbChsb2cpIC0gMSkgOiBNYXRoLnBvdygxMCwgTWF0aC5mbG9vcihsb2cpKTtcbiAgICBpKys7XG4gIH1cbiAgby5icHBwcyA9IGJwcHBzO1xuICBvLmJwcHBOdW1iZXJzQmVsb3cgPSBicHBwcy5zbGljZSgwLCAyKTtcbiAgby5pbml0Wm9vbSA9IGJwcHBzWzBdO1xufTtcblxuLy8gQ29uc3RydWN0IGEgY29tcGxldGUgY29uZmlndXJhdGlvbiBmb3IgJC51aS5nZW5vYnJvd3NlciBiYXNlZCBvbiB0aGUgaW5mb3JtYXRpb24gcGFyc2VkIGZyb20gdGhlIGdlbm9tZSBmaWxlXG4vLyB3aGljaCBzaG91bGQgYmUgbW9zdGx5IGluIHRoaXMub3B0cywgZXhjZXB0aW5nIHRob3NlIHJlbGF0ZWQgdG8gem9vbSBsZXZlbHMsIHdoaWNoIGNhbiBiZSBzZXQgbm93LlxuLy8gKHNlZSBDdXN0b21HZW5vbWUuZGVmYXVsdHMgYWJvdmUgZm9yIHdoYXQgYSBiYXNlIGNvbmZpZ3VyYXRpb24gbG9va3MgbGlrZSlcbi8vXG4vLyB3aW5kb3dPcHRzIE1VU1QgaW5jbHVkZSBpbmNsdWRlIHRoZSBwcm9wZXJ0eSAud2lkdGggd2hpY2ggaXMgdGhlIHdpbmRvdy5pbm5lcldpZHRoXG5DdXN0b21HZW5vbWUucHJvdG90eXBlLm9wdGlvbnMgPSBmdW5jdGlvbih3aW5kb3dPcHRzKSB7XG4gIGlmICghdGhpcy5fcGFyc2VkKSB7IHRocm93IFwiQ2Fubm90IGdlbmVyYXRlIG9wdGlvbnMgYmVmb3JlIHBhcnNpbmcgdGhlIGdlbm9tZSBmaWxlXCI7IH1cbiAgdGhpcy5zZXRCcHBwcyh3aW5kb3dPcHRzKTtcbiAgdGhpcy5vcHRzLmN1c3RvbSA9IHRoaXM7ICAgLy8gc2FtZSBjb252ZW50aW9uIGFzIGN1c3RvbSB0cmFja3MgaW4gc2VsZi5hdmFpbFRyYWNrcyBpbiBjaHJvbW96b29tLmpzXG4gIHJldHVybiB0aGlzLm9wdHM7XG59O1xuXG4vLyBGZXRjaCB0aGUgc2VxdWVuY2UsIGlmIGF2YWlsYWJsZSwgYmV0d2VlbiBsZWZ0IGFuZCByaWdodCwgYW5kIG9wdGlvbmFsbHkgcGFzcyBpdCB0byB0aGUgY2FsbGJhY2suXG5DdXN0b21HZW5vbWUucHJvdG90eXBlLmdldFNlcXVlbmNlID0gZnVuY3Rpb24obGVmdCwgcmlnaHQsIGNhbGxiYWNrKSB7XG4gIHZhciBzZXEgPSB0aGlzLmRhdGEuc2VxdWVuY2Uuc3Vic3RyaW5nKGxlZnQgLSAxLCByaWdodCAtIDEpO1xuICByZXR1cm4gXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSA/IGNhbGxiYWNrKHNlcSkgOiBzZXE7IFxufTtcblxuQ3VzdG9tR2Vub21lLnByb3RvdHlwZS5nZXRTZXF1ZW5jZUFzeW5jID0gZnVuY3Rpb24oKSB7XG4gIGdsb2JhbC5DdXN0b21HZW5vbWVzLmFzeW5jKHRoaXMsICdnZXRTZXF1ZW5jZScsIGFyZ3VtZW50cywgW3RoaXMuaWRdKTtcbn07XG5cbnJldHVybiBDdXN0b21HZW5vbWU7XG5cbn07IiwibW9kdWxlLmV4cG9ydHMgPSAoZnVuY3Rpb24oZ2xvYmFsKXtcbiAgXG4gIHZhciBfID0gcmVxdWlyZSgnLi4vdW5kZXJzY29yZS5taW4uanMnKTtcbiAgaWYgKCFnbG9iYWwuQ3VzdG9tVHJhY2tzKSB7IHJlcXVpcmUoJy4vQ3VzdG9tVHJhY2tzLmpzJykoZ2xvYmFsKTsgfVxuICBcbiAgLy8gVGhlIGNsYXNzIHRoYXQgcmVwcmVzZW50cyBhIHNpbmd1bGFyIGN1c3RvbSBnZW5vbWUgb2JqZWN0XG4gIHZhciBDdXN0b21HZW5vbWUgPSByZXF1aXJlKCcuL0N1c3RvbUdlbm9tZScpKGdsb2JhbCk7XG4gIFxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vID0gQ3VzdG9tR2Vub21lcywgdGhlIG1vZHVsZSBleHBvcnRlZCB0byB0aGUgZ2xvYmFsIGVudmlyb25tZW50ID1cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvL1xuICAvLyBCcm9hZGx5IHNwZWFraW5nIHRoaXMgaXMgYSBmYWN0b3J5IGZvciBDdXN0b21HZW5vbWUgb2JqZWN0cyB0aGF0IGNhbiBkZWxlZ2F0ZSB0aGVcbiAgLy8gd29yayBvZiBwYXJzaW5nIHRvIGEgV2ViIFdvcmtlciB0aHJlYWQuXG4gIFxuICB2YXIgQ3VzdG9tR2Vub21lcyA9IHtcbiAgICBwYXJzZTogZnVuY3Rpb24odGV4dCwgbWV0YWRhdGEpIHtcbiAgICAgIG1ldGFkYXRhID0gbWV0YWRhdGEgfHwge307XG4gICAgICBpZiAoIW1ldGFkYXRhLmZvcm1hdCkgeyBtZXRhZGF0YS5mb3JtYXQgPSB0aGlzLmd1ZXNzRm9ybWF0KHRleHQpOyB9XG4gICAgICB2YXIgZ2Vub21lID0gbmV3IEN1c3RvbUdlbm9tZShtZXRhZGF0YS5mb3JtYXQsIG1ldGFkYXRhKTtcbiAgICAgIGdlbm9tZS5wYXJzZSh0ZXh0KTtcbiAgICAgIHJldHVybiBnZW5vbWU7XG4gICAgfSxcbiAgICBcbiAgICBibGFuazogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZ2Vub21lID0gbmV3IEN1c3RvbUdlbm9tZShcImNocm9tc2l6ZXNcIiwge3NwZWNpZXM6IFwiQmxhbmsgR2Vub21lXCJ9KTtcbiAgICAgIGdlbm9tZS5wYXJzZShcImJsYW5rXFx0NTAwMDBcIik7XG4gICAgICByZXR1cm4gZ2Vub21lO1xuICAgIH0sXG4gICAgXG4gICAgZ3Vlc3NGb3JtYXQ6IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgIGlmICh0ZXh0LnN1YnN0cmluZygwLCA1KSA9PSAnTE9DVVMnKSB7IHJldHVybiBcImdlbmJhbmtcIjsgfVxuICAgICAgaWYgKC9eW0EtWl17Mn0gezN9Ly50ZXN0KHRleHQpKSB7IHJldHVybiBcImVtYmxcIjsgfVxuICAgICAgaWYgKC9eWz47XS8udGVzdCh0ZXh0KSkgeyByZXR1cm4gXCJmYXN0YVwiOyB9XG4gICAgICAvLyBkZWZhdWx0IGlzIGZhc3RhXG4gICAgICByZXR1cm4gXCJmYXN0YVwiO1xuICAgIH0sXG4gICAgXG4gICAgZXJyb3I6IGZ1bmN0aW9uKGUpIHtcbiAgICAgIC8vIENhbiBiZSBvdmVycmlkZGVuIGJ5IGEgcGFyZW50IGxpYnJhcnkgdG8gaGFuZGxlIGVycm9ycyBtb3JlIGdyYWNlZnVsbHkuXG4gICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICB9LFxuICAgIFxuICAgIF93b3JrZXJTY3JpcHQ6ICdidWlsZC9DdXN0b21HZW5vbWVXb3JrZXIuanMnLFxuICAgIF9kaXNhYmxlV29ya2VyczogZmFsc2UsXG4gICAgd29ya2VyOiBnbG9iYWwuQ3VzdG9tVHJhY2tzLndvcmtlcixcbiAgICBcbiAgICBhc3luYzogZ2xvYmFsLkN1c3RvbVRyYWNrcy5hc3luYyxcbiAgICBcbiAgICBwYXJzZUFzeW5jOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuYXN5bmModGhpcywgJ3BhcnNlJywgYXJndW1lbnRzLCBbXSwgZnVuY3Rpb24oZ2Vub21lKSB7XG4gICAgICAgIC8vIFRoaXMgaGFzIGJlZW4gc2VyaWFsaXplZCwgc28gaXQgbXVzdCBiZSBoeWRyYXRlZCBpbnRvIGEgcmVhbCBDdXN0b21HZW5vbWUgb2JqZWN0LlxuICAgICAgICAvLyBXZSByZXBsYWNlIC5nZXRTZXF1ZW5jZSgpIHdpdGggYW4gYXN5bmNocm9ub3VzIHZlcnNpb24uXG4gICAgICAgIHJldHVybiBfLmV4dGVuZChuZXcgQ3VzdG9tR2Vub21lKGZhbHNlKSwgZ2Vub21lLCB7XG4gICAgICAgICAgZ2V0U2VxdWVuY2U6IGZ1bmN0aW9uKCkgeyBDdXN0b21HZW5vbWUucHJvdG90eXBlLmdldFNlcXVlbmNlQXN5bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcbiAgXG4gIGdsb2JhbC5DdXN0b21HZW5vbWVzID0gQ3VzdG9tR2Vub21lcztcbiAgXG59KTsiLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSBDdXN0b21UcmFjaywgYW4gb2JqZWN0IHJlcHJlc2VudGluZyBhIGN1c3RvbSB0cmFjayBhcyB1bmRlcnN0b29kIGJ5IFVDU0MuID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vL1xuLy8gVGhpcyBjbGFzcyAqZG9lcyogZGVwZW5kIG9uIGdsb2JhbCBvYmplY3RzIGFuZCB0aGVyZWZvcmUgbXVzdCBiZSByZXF1aXJlZCBhcyBhIFxuLy8gZnVuY3Rpb24gdGhhdCBpcyBleGVjdXRlZCBvbiB0aGUgZ2xvYmFsIG9iamVjdC5cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihnbG9iYWwpIHtcblxudmFyIF8gPSByZXF1aXJlKCcuLi91bmRlcnNjb3JlLm1pbi5qcycpO1xuXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuL3RyYWNrLXR5cGVzL3V0aWxzL3V0aWxzLmpzJyksXG4gIHBhcnNlSW50MTAgPSB1dGlscy5wYXJzZUludDEwO1xuXG5mdW5jdGlvbiBDdXN0b21UcmFjayhvcHRzLCBicm93c2VyT3B0cykge1xuICBpZiAoIW9wdHMpIHsgcmV0dXJuOyB9IC8vIFRoaXMgaXMgYW4gZW1wdHkgY3VzdG9tVHJhY2sgdGhhdCB3aWxsIGJlIGh5ZHJhdGVkIHdpdGggdmFsdWVzIGZyb20gYSBzZXJpYWxpemVkIG9iamVjdFxuICB0aGlzLl90eXBlID0gKG9wdHMudHlwZSAmJiBvcHRzLnR5cGUudG9Mb3dlckNhc2UoKSkgfHwgXCJiZWRcIjtcbiAgdmFyIHR5cGUgPSB0aGlzLnR5cGUoKTtcbiAgaWYgKHR5cGUgPT09IG51bGwpIHsgdGhyb3cgbmV3IEVycm9yKFwiVW5zdXBwb3J0ZWQgdHJhY2sgdHlwZSAnXCIrb3B0cy50eXBlK1wiJyBlbmNvdW50ZXJlZCBvbiBsaW5lIFwiICsgb3B0cy5saW5lTnVtKTsgfVxuICB0aGlzLm9wdHMgPSBfLmV4dGVuZCh7fSwgdGhpcy5jb25zdHJ1Y3Rvci5kZWZhdWx0cywgdHlwZS5kZWZhdWx0cyB8fCB7fSwgb3B0cyk7XG4gIF8uZXh0ZW5kKHRoaXMsIHtcbiAgICBicm93c2VyT3B0czogYnJvd3Nlck9wdHMsXG4gICAgc3RyZXRjaEhlaWdodDogZmFsc2UsXG4gICAgaGVpZ2h0czoge30sXG4gICAgc2l6ZXM6IFsnZGVuc2UnXSxcbiAgICBtYXBTaXplczogW10sXG4gICAgYXJlYXM6IHt9LFxuICAgIG5vQXJlYUxhYmVsczogZmFsc2UsXG4gICAgZXhwZWN0c1NlcXVlbmNlOiBmYWxzZVxuICB9KTtcbiAgdGhpcy5pbml0KCk7XG59XG5cbkN1c3RvbVRyYWNrLmRlZmF1bHRzID0ge1xuICBuYW1lOiAnVXNlciBUcmFjaycsXG4gIGRlc2NyaXB0aW9uOiAnVXNlciBTdXBwbGllZCBUcmFjaycsXG4gIGNvbG9yOiAnMCwwLDAnXG59O1xuXG5DdXN0b21UcmFjay50eXBlcyA9IHtcbiAgYmVkOiByZXF1aXJlKCcuL3RyYWNrLXR5cGVzL2JlZC5qcycpLFxuICBmZWF0dXJldGFibGU6IHJlcXVpcmUoJy4vdHJhY2stdHlwZXMvZmVhdHVyZXRhYmxlLmpzJyksXG4gIGJlZGdyYXBoOiByZXF1aXJlKCcuL3RyYWNrLXR5cGVzL2JlZGdyYXBoLmpzJyksXG4gIHdpZ2dsZV8wOiByZXF1aXJlKCcuL3RyYWNrLXR5cGVzL3dpZ2dsZV8wLmpzJyksXG4gIHZjZnRhYml4OiByZXF1aXJlKCcuL3RyYWNrLXR5cGVzL3ZjZnRhYml4LmpzJyksXG4gIGJpZ2JlZDogcmVxdWlyZSgnLi90cmFjay10eXBlcy9iaWdiZWQuanMnKSxcbiAgYmFtOiByZXF1aXJlKCcuL3RyYWNrLXR5cGVzL2JhbS5qcycpLFxuICBiaWd3aWc6IHJlcXVpcmUoJy4vdHJhY2stdHlwZXMvYmlnd2lnLmpzJylcbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9IGJlZERldGFpbCBmb3JtYXQ6IGh0dHBzOi8vZ2Vub21lLnVjc2MuZWR1L0ZBUS9GQVFmb3JtYXQuaHRtbCNmb3JtYXQxLjcgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gIFxuXG5DdXN0b21UcmFjay50eXBlcy5iZWRkZXRhaWwgPSBfLmNsb25lKEN1c3RvbVRyYWNrLnR5cGVzLmJlZCk7XG5DdXN0b21UcmFjay50eXBlcy5iZWRkZXRhaWwuZGVmYXVsdHMgPSBfLmV4dGVuZCh7fSwgQ3VzdG9tVHJhY2sudHlwZXMuYmVkZGV0YWlsLmRlZmF1bHRzLCB7ZGV0YWlsOiB0cnVlfSk7XG5cbi8vIFRoZXNlIGZ1bmN0aW9ucyBicmFuY2ggdG8gZGlmZmVyZW50IG1ldGhvZHMgZGVwZW5kaW5nIG9uIHRoZSAudHlwZSgpIG9mIHRoZSB0cmFja1xuXy5lYWNoKFsnaW5pdCcsICdwYXJzZScsICdyZW5kZXInLCAncmVuZGVyU2VxdWVuY2UnLCAncHJlcmVuZGVyJ10sIGZ1bmN0aW9uKGZuKSB7XG4gIEN1c3RvbVRyYWNrLnByb3RvdHlwZVtmbl0gPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgYXJncyA9IF8udG9BcnJheShhcmd1bWVudHMpLFxuICAgICAgdHlwZSA9IHRoaXMudHlwZSgpO1xuICAgIGlmICghdHlwZVtmbl0pIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgcmV0dXJuIHR5cGVbZm5dLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICB9XG59KTtcblxuQ3VzdG9tVHJhY2sucHJvdG90eXBlLmxvYWRPcHRzID0gZnVuY3Rpb24oJGRpYWxvZykge1xuICB2YXIgdHlwZSA9IHRoaXMudHlwZSgpLFxuICAgIG8gPSB0aGlzLm9wdHM7XG4gICRkaWFsb2cuZmluZCgnLmN1c3RvbS1vcHRzLWZvcm0nKS5oaWRlKCk7XG4gICRkaWFsb2cuZmluZCgnLmN1c3RvbS1vcHRzLWZvcm0uJyt0aGlzLl90eXBlKS5zaG93KCk7XG4gICRkaWFsb2cuZmluZCgnLmN1c3RvbS1uYW1lJykudGV4dChvLm5hbWUpO1xuICAkZGlhbG9nLmZpbmQoJy5jdXN0b20tZGVzYycpLnRleHQoby5kZXNjcmlwdGlvbik7XG4gICRkaWFsb2cuZmluZCgnLmN1c3RvbS1mb3JtYXQnKS50ZXh0KHRoaXMuX3R5cGUpO1xuICAkZGlhbG9nLmZpbmQoJ1tuYW1lPWNvbG9yXScpLnZhbChvLmNvbG9yKS5jaGFuZ2UoKTtcbiAgaWYgKHR5cGUubG9hZE9wdHMpIHsgdHlwZS5sb2FkT3B0cy5jYWxsKHRoaXMsICRkaWFsb2cpOyB9XG4gICRkaWFsb2cuZmluZCgnLmVuYWJsZXInKS5jaGFuZ2UoKTtcbn07XG5cbkN1c3RvbVRyYWNrLnByb3RvdHlwZS5zYXZlT3B0cyA9IGZ1bmN0aW9uKCRkaWFsb2cpIHtcbiAgdmFyIHR5cGUgPSB0aGlzLnR5cGUoKSxcbiAgICBvID0gdGhpcy5vcHRzO1xuICBvLmNvbG9yID0gJGRpYWxvZy5maW5kKCdbbmFtZT1jb2xvcl0nKS52YWwoKTtcbiAgaWYgKCF0aGlzLnZhbGlkYXRlQ29sb3Ioby5jb2xvcikpIHsgby5jb2xvciA9ICcwLDAsMCc7IH1cbiAgaWYgKHR5cGUuc2F2ZU9wdHMpIHsgdHlwZS5zYXZlT3B0cy5jYWxsKHRoaXMsICRkaWFsb2cpOyB9XG4gIHRoaXMuYXBwbHlPcHRzKCk7XG4gIGdsb2JhbC5DdXN0b21UcmFja3Mud29ya2VyKCkgJiYgdGhpcy5hcHBseU9wdHNBc3luYygpOyAvLyBBcHBseSB0aGUgY2hhbmdlcyB0byB0aGUgd29ya2VyIHRvbyFcbn07XG5cbkN1c3RvbVRyYWNrLnByb3RvdHlwZS5hcHBseU9wdHMgPSBmdW5jdGlvbihvcHRzKSB7XG4gIHZhciB0eXBlID0gdGhpcy50eXBlKCk7XG4gIGlmIChvcHRzKSB7IHRoaXMub3B0cyA9IG9wdHM7IH1cbiAgaWYgKHR5cGUuYXBwbHlPcHRzKSB7IHR5cGUuYXBwbHlPcHRzLmNhbGwodGhpcyk7IH1cbn07XG5cbkN1c3RvbVRyYWNrLnByb3RvdHlwZS5lcmFzZSA9IGZ1bmN0aW9uKGNhbnZhcykge1xuICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQgJiYgY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gIGlmIChjdHgpIHsgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOyB9XG59XG5cbkN1c3RvbVRyYWNrLnByb3RvdHlwZS50eXBlID0gZnVuY3Rpb24odHlwZSkge1xuICBpZiAoXy5pc1VuZGVmaW5lZCh0eXBlKSkgeyB0eXBlID0gdGhpcy5fdHlwZTsgfVxuICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50eXBlc1t0eXBlXSB8fCBudWxsO1xufTtcblxuQ3VzdG9tVHJhY2sucHJvdG90eXBlLndhcm4gPSBmdW5jdGlvbih3YXJuaW5nKSB7XG4gIGlmICh0aGlzLm9wdHMuc3RyaWN0KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKHdhcm5pbmcpO1xuICB9IGVsc2Uge1xuICAgIGlmICghdGhpcy53YXJuaW5ncykgeyB0aGlzLndhcm5pbmdzID0gW107IH1cbiAgICB0aGlzLndhcm5pbmdzLnB1c2god2FybmluZyk7XG4gIH1cbn07XG5cbkN1c3RvbVRyYWNrLnByb3RvdHlwZS5pc09uID0gZnVuY3Rpb24odmFsKSB7XG4gIHJldHVybiAvXihvbnx5ZXN8dHJ1ZXx0fHl8MSkkL2kudGVzdCh2YWwudG9TdHJpbmcoKSk7XG59O1xuXG5DdXN0b21UcmFjay5wcm90b3R5cGUuY2hyTGlzdCA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXRoaXMuX2Nockxpc3QpIHtcbiAgICB0aGlzLl9jaHJMaXN0ID0gXy5zb3J0QnkoXy5tYXAodGhpcy5icm93c2VyT3B0cy5jaHJQb3MsIGZ1bmN0aW9uKHBvcywgY2hyKSB7IHJldHVybiBbcG9zLCBjaHJdOyB9KSwgZnVuY3Rpb24odikgeyByZXR1cm4gdlswXTsgfSk7XG4gIH1cbiAgcmV0dXJuIHRoaXMuX2Nockxpc3Q7XG59XG5cbkN1c3RvbVRyYWNrLnByb3RvdHlwZS5jaHJBdCA9IGZ1bmN0aW9uKHBvcykge1xuICB2YXIgY2hyTGlzdCA9IHRoaXMuY2hyTGlzdCgpLFxuICAgIGNockluZGV4ID0gXy5zb3J0ZWRJbmRleChjaHJMaXN0LCBbcG9zXSwgZnVuY3Rpb24odikgeyByZXR1cm4gdlswXTsgfSksXG4gICAgY2hyID0gY2hySW5kZXggPiAwID8gY2hyTGlzdFtjaHJJbmRleCAtIDFdWzFdIDogbnVsbDtcbiAgcmV0dXJuIHtpOiBjaHJJbmRleCAtIDEsIGM6IGNociwgcDogcG9zIC0gdGhpcy5icm93c2VyT3B0cy5jaHJQb3NbY2hyXX07XG59O1xuXG5DdXN0b21UcmFjay5wcm90b3R5cGUuY2hyUmFuZ2UgPSBmdW5jdGlvbihzdGFydCwgZW5kKSB7XG4gIHZhciBjaHJMZW5ndGhzID0gdGhpcy5icm93c2VyT3B0cy5jaHJMZW5ndGhzLFxuICAgIHN0YXJ0Q2hyID0gdGhpcy5jaHJBdChzdGFydCksXG4gICAgZW5kQ2hyID0gdGhpcy5jaHJBdChlbmQpLFxuICAgIHJhbmdlO1xuICBpZiAoc3RhcnRDaHIuYyAmJiBzdGFydENoci5pID09PSBlbmRDaHIuaSkgeyByZXR1cm4gW3N0YXJ0Q2hyLmMgKyAnOicgKyBzdGFydENoci5wICsgJy0nICsgZW5kQ2hyLnBdOyB9XG4gIGVsc2Uge1xuICAgIHJhbmdlID0gXy5tYXAodGhpcy5jaHJMaXN0KCkuc2xpY2Uoc3RhcnRDaHIuaSArIDEsIGVuZENoci5pKSwgZnVuY3Rpb24odikge1xuICAgICAgcmV0dXJuIHZbMV0gKyAnOjEtJyArIGNockxlbmd0aHNbdlsxXV07XG4gICAgfSk7XG4gICAgc3RhcnRDaHIuYyAmJiByYW5nZS51bnNoaWZ0KHN0YXJ0Q2hyLmMgKyAnOicgKyBzdGFydENoci5wICsgJy0nICsgY2hyTGVuZ3Roc1tzdGFydENoci5jXSk7XG4gICAgZW5kQ2hyLmMgJiYgcmFuZ2UucHVzaChlbmRDaHIuYyArICc6MS0nICsgZW5kQ2hyLnApO1xuICAgIHJldHVybiByYW5nZTtcbiAgfVxufVxuXG5DdXN0b21UcmFjay5wcm90b3R5cGUucHJlcmVuZGVyQXN5bmMgPSBmdW5jdGlvbigpIHtcbiAgZ2xvYmFsLkN1c3RvbVRyYWNrcy5hc3luYyh0aGlzLCAncHJlcmVuZGVyJywgYXJndW1lbnRzLCBbdGhpcy5pZF0pO1xufTtcblxuQ3VzdG9tVHJhY2sucHJvdG90eXBlLmFwcGx5T3B0c0FzeW5jID0gZnVuY3Rpb24oKSB7XG4gIGdsb2JhbC5DdXN0b21UcmFja3MuYXN5bmModGhpcywgJ2FwcGx5T3B0cycsIFt0aGlzLm9wdHMsIGZ1bmN0aW9uKCl7fV0sIFt0aGlzLmlkXSk7XG59O1xuXG5DdXN0b21UcmFjay5wcm90b3R5cGUuYWpheERpciA9IGZ1bmN0aW9uKCkge1xuICAvLyBXZWIgV29ya2VycyBmZXRjaCBVUkxzIHJlbGF0aXZlIHRvIHRoZSBKUyBmaWxlIGl0c2VsZi5cbiAgcmV0dXJuIChnbG9iYWwuSFRNTERvY3VtZW50ID8gJycgOiAnLi4vJykgKyB0aGlzLmJyb3dzZXJPcHRzLmFqYXhEaXI7XG59O1xuXG5DdXN0b21UcmFjay5wcm90b3R5cGUucmdiVG9Ic2wgPSBmdW5jdGlvbihyLCBnLCBiKSB7XG4gIHIgLz0gMjU1LCBnIC89IDI1NSwgYiAvPSAyNTU7XG4gIHZhciBtYXggPSBNYXRoLm1heChyLCBnLCBiKSwgbWluID0gTWF0aC5taW4ociwgZywgYik7XG4gIHZhciBoLCBzLCBsID0gKG1heCArIG1pbikgLyAyO1xuXG4gIGlmIChtYXggPT0gbWluKSB7XG4gICAgaCA9IHMgPSAwOyAvLyBhY2hyb21hdGljXG4gIH0gZWxzZSB7XG4gICAgdmFyIGQgPSBtYXggLSBtaW47XG4gICAgcyA9IGwgPiAwLjUgPyBkIC8gKDIgLSBtYXggLSBtaW4pIDogZCAvIChtYXggKyBtaW4pO1xuICAgIHN3aXRjaChtYXgpe1xuICAgICAgY2FzZSByOiBoID0gKGcgLSBiKSAvIGQgKyAoZyA8IGIgPyA2IDogMCk7IGJyZWFrO1xuICAgICAgY2FzZSBnOiBoID0gKGIgLSByKSAvIGQgKyAyOyBicmVhaztcbiAgICAgIGNhc2UgYjogaCA9IChyIC0gZykgLyBkICsgNDsgYnJlYWs7XG4gICAgfVxuICAgIGggLz0gNjtcbiAgfVxuXG4gIHJldHVybiBbaCwgcywgbF07XG59XG5cbkN1c3RvbVRyYWNrLnByb3RvdHlwZS5oc2xUb1JnYiA9IGZ1bmN0aW9uKGgsIHMsIGwpIHtcbiAgdmFyIHIsIGcsIGI7XG5cbiAgaWYgKHMgPT0gMCkge1xuICAgIHIgPSBnID0gYiA9IGw7IC8vIGFjaHJvbWF0aWNcbiAgfSBlbHNlIHtcbiAgICBmdW5jdGlvbiBodWUycmdiKHAsIHEsIHQpIHtcbiAgICAgIGlmKHQgPCAwKSB0ICs9IDE7XG4gICAgICBpZih0ID4gMSkgdCAtPSAxO1xuICAgICAgaWYodCA8IDEvNikgcmV0dXJuIHAgKyAocSAtIHApICogNiAqIHQ7XG4gICAgICBpZih0IDwgMS8yKSByZXR1cm4gcTtcbiAgICAgIGlmKHQgPCAyLzMpIHJldHVybiBwICsgKHEgLSBwKSAqICgyLzMgLSB0KSAqIDY7XG4gICAgICByZXR1cm4gcDtcbiAgICB9XG5cbiAgICB2YXIgcSA9IGwgPCAwLjUgPyBsICogKDEgKyBzKSA6IGwgKyBzIC0gbCAqIHM7XG4gICAgdmFyIHAgPSAyICogbCAtIHE7XG4gICAgciA9IGh1ZTJyZ2IocCwgcSwgaCArIDEvMyk7XG4gICAgZyA9IGh1ZTJyZ2IocCwgcSwgaCk7XG4gICAgYiA9IGh1ZTJyZ2IocCwgcSwgaCAtIDEvMyk7XG4gIH1cblxuICByZXR1cm4gW3IgKiAyNTUsIGcgKiAyNTUsIGIgKiAyNTVdO1xufVxuXG5DdXN0b21UcmFjay5wcm90b3R5cGUudmFsaWRhdGVDb2xvciA9IGZ1bmN0aW9uKGNvbG9yKSB7XG4gIHZhciBtID0gY29sb3IubWF0Y2goLyhcXGQrKSwoXFxkKyksKFxcZCspLyk7XG4gIGlmICghbSkgeyByZXR1cm4gZmFsc2U7IH1cbiAgbS5zaGlmdCgpO1xuICByZXR1cm4gXy5hbGwoXy5tYXAobSwgcGFyc2VJbnQxMCksIGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHYgPj0wICYmIHYgPD0gMjU1OyB9KTtcbn1cblxucmV0dXJuIEN1c3RvbVRyYWNrO1xuXG59OyIsIm1vZHVsZS5leHBvcnRzID0gKGZ1bmN0aW9uKGdsb2JhbCl7XG4gIFxuICB2YXIgXyA9IHJlcXVpcmUoJy4uL3VuZGVyc2NvcmUubWluLmpzJyk7XG4gIFxuICAvLyBTb21lIHV0aWxpdHkgZnVuY3Rpb25zLlxuICB2YXIgdXRpbHMgPSByZXF1aXJlKCcuL3RyYWNrLXR5cGVzL3V0aWxzL3V0aWxzLmpzJyksXG4gICAgcGFyc2VEZWNsYXJhdGlvbkxpbmUgPSB1dGlscy5wYXJzZURlY2xhcmF0aW9uTGluZTtcbiAgXG4gIC8vIFRoZSBjbGFzcyB0aGF0IHJlcHJlc2VudHMgYSBzaW5ndWxhciBjdXN0b20gdHJhY2sgb2JqZWN0XG4gIHZhciBDdXN0b21UcmFjayA9IHJlcXVpcmUoJy4vQ3VzdG9tVHJhY2suanMnKShnbG9iYWwpO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyA9IEN1c3RvbVRyYWNrcywgdGhlIG1vZHVsZSB0aGF0IGlzIGV4cG9ydGVkIHRvIHRoZSBnbG9iYWwgZW52aXJvbm1lbnQuID1cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vXG4gIC8vIEJyb2FkbHkgc3BlYWtpbmcgdGhpcyBpcyBhIGZhY3RvcnkgZm9yIHBhcnNpbmcgZGF0YSBpbnRvIEN1c3RvbVRyYWNrIG9iamVjdHMsXG4gIC8vIGFuZCBpdCBjYW4gZGVsZWdhdGUgdGhpcyB3b3JrIHRvIGEgd29ya2VyIHRocmVhZC5cblxuICB2YXIgQ3VzdG9tVHJhY2tzID0ge1xuICAgIHBhcnNlOiBmdW5jdGlvbihjaHVua3MsIGJyb3dzZXJPcHRzKSB7XG4gICAgICB2YXIgY3VzdG9tVHJhY2tzID0gW10sXG4gICAgICAgIGRhdGEgPSBbXSxcbiAgICAgICAgdHJhY2ssIG9wdHMsIG07XG4gICAgICBcbiAgICAgIGlmICh0eXBlb2YgY2h1bmtzID09IFwic3RyaW5nXCIpIHsgY2h1bmtzID0gW2NodW5rc107IH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gcHVzaFRyYWNrKCkge1xuICAgICAgICBpZiAodHJhY2sucGFyc2UoZGF0YSkpIHsgY3VzdG9tVHJhY2tzLnB1c2godHJhY2spOyB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIGN1c3RvbVRyYWNrcy5icm93c2VyID0ge307XG4gICAgICBfLmVhY2goY2h1bmtzLCBmdW5jdGlvbih0ZXh0KSB7XG4gICAgICAgIF8uZWFjaCh0ZXh0LnNwbGl0KFwiXFxuXCIpLCBmdW5jdGlvbihsaW5lLCBsaW5lbm8pIHtcbiAgICAgICAgICBpZiAoL14jLy50ZXN0KGxpbmUpKSB7XG4gICAgICAgICAgICAvLyBjb21tZW50IGxpbmVcbiAgICAgICAgICB9IGVsc2UgaWYgKC9eYnJvd3NlclxccysvLnRlc3QobGluZSkpIHtcbiAgICAgICAgICAgIC8vIGJyb3dzZXIgbGluZXNcbiAgICAgICAgICAgIG0gPSBsaW5lLm1hdGNoKC9eYnJvd3NlclxccysoXFx3KylcXHMrKFxcUyopLyk7XG4gICAgICAgICAgICBpZiAoIW0pIHsgdGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IHBhcnNlIGJyb3dzZXIgbGluZSBmb3VuZCBhdCBsaW5lIFwiICsgKGxpbmVubyArIDEpKTsgfVxuICAgICAgICAgICAgY3VzdG9tVHJhY2tzLmJyb3dzZXJbbVsxXV0gPSBtWzJdO1xuICAgICAgICAgIH0gZWxzZSBpZiAoL150cmFja1xccysvaS50ZXN0KGxpbmUpKSB7XG4gICAgICAgICAgICBpZiAodHJhY2spIHsgcHVzaFRyYWNrKCk7IH1cbiAgICAgICAgICAgIG9wdHMgPSBwYXJzZURlY2xhcmF0aW9uTGluZShsaW5lLCAoL150cmFja1xccysvaSkpO1xuICAgICAgICAgICAgaWYgKCFvcHRzKSB7IHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBwYXJzZSB0cmFjayBsaW5lIGZvdW5kIGF0IGxpbmUgXCIgKyAobGluZW5vICsgMSkpOyB9XG4gICAgICAgICAgICBvcHRzLmxpbmVOdW0gPSBsaW5lbm8gKyAxO1xuICAgICAgICAgICAgdHJhY2sgPSBuZXcgQ3VzdG9tVHJhY2sob3B0cywgYnJvd3Nlck9wdHMpO1xuICAgICAgICAgICAgZGF0YSA9IFtdO1xuICAgICAgICAgIH0gZWxzZSBpZiAoL1xcUy8udGVzdChsaW5lKSkge1xuICAgICAgICAgICAgaWYgKCF0cmFjaykgeyB0aHJvdyBuZXcgRXJyb3IoXCJGb3VuZCBkYXRhIG9uIGxpbmUgXCIrKGxpbmVubysxKStcIiBidXQgbm8gcHJlY2VkaW5nIHRyYWNrIGRlZmluaXRpb25cIik7IH1cbiAgICAgICAgICAgIGRhdGEucHVzaChsaW5lKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICBpZiAodHJhY2spIHsgcHVzaFRyYWNrKCk7IH1cbiAgICAgIHJldHVybiBjdXN0b21UcmFja3M7XG4gICAgfSxcbiAgICBcbiAgICBwYXJzZURlY2xhcmF0aW9uTGluZTogcGFyc2VEZWNsYXJhdGlvbkxpbmUsXG4gICAgXG4gICAgZXJyb3I6IGZ1bmN0aW9uKGUpIHtcbiAgICAgIC8vIENhbiBiZSBvdmVycmlkZGVuIGJ5IGEgcGFyZW50IGxpYnJhcnkgdG8gaGFuZGxlIGVycm9ycyBtb3JlIGdyYWNlZnVsbHkuXG4gICAgICAvLyBOb3RlOiB0aGlzIGlzIG92ZXJyaWRkZW4gYnkgdWkuZ2Vub2Jyb3dzZXIgZHVyaW5nIFVJIHNldHVwLlxuICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgfSxcbiAgICBcbiAgICBfd29ya2VyU2NyaXB0OiAnYnVpbGQvQ3VzdG9tVHJhY2tXb3JrZXIuanMnLFxuICAgIC8vIE5PVEU6IFRvIHRlbXBvcmFyaWx5IGRpc2FibGUgV2ViIFdvcmtlciB1c2FnZSwgc2V0IHRoaXMgdG8gdHJ1ZS5cbiAgICBfZGlzYWJsZVdvcmtlcnM6IGZhbHNlLFxuICAgIFxuICAgIHdvcmtlcjogZnVuY3Rpb24oKSB7IFxuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBjYWxsYmFja3MgPSBbXTtcbiAgICAgIGlmICghc2VsZi5fd29ya2VyICYmIGdsb2JhbC5Xb3JrZXIpIHsgXG4gICAgICAgIHNlbGYuX3dvcmtlciA9IG5ldyBnbG9iYWwuV29ya2VyKHNlbGYuX3dvcmtlclNjcmlwdCk7XG4gICAgICAgIHNlbGYuX3dvcmtlci5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uKGUpIHsgc2VsZi5lcnJvcihlKTsgfSwgZmFsc2UpO1xuICAgICAgICBzZWxmLl93b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBpZiAoZS5kYXRhLmxvZykgeyBjb25zb2xlLmxvZyhKU09OLnBhcnNlKGUuZGF0YS5sb2cpKTsgcmV0dXJuOyB9XG4gICAgICAgICAgaWYgKGUuZGF0YS5lcnJvcikge1xuICAgICAgICAgICAgaWYgKGUuZGF0YS5pZCkgeyBjYWxsYmFja3NbZS5kYXRhLmlkXSA9IG51bGw7IH1cbiAgICAgICAgICAgIHNlbGYuZXJyb3IoSlNPTi5wYXJzZShlLmRhdGEuZXJyb3IpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FsbGJhY2tzW2UuZGF0YS5pZF0oSlNPTi5wYXJzZShlLmRhdGEucmV0KSk7XG4gICAgICAgICAgY2FsbGJhY2tzW2UuZGF0YS5pZF0gPSBudWxsO1xuICAgICAgICB9KTtcbiAgICAgICAgc2VsZi5fd29ya2VyLmNhbGwgPSBmdW5jdGlvbihvcCwgYXJncywgY2FsbGJhY2spIHtcbiAgICAgICAgICB2YXIgaWQgPSBjYWxsYmFja3MucHVzaChjYWxsYmFjaykgLSAxO1xuICAgICAgICAgIHRoaXMucG9zdE1lc3NhZ2Uoe29wOiBvcCwgaWQ6IGlkLCBhcmdzOiBhcmdzfSk7XG4gICAgICAgIH07XG4gICAgICAgIC8vIFRvIGhhdmUgdGhlIHdvcmtlciB0aHJvdyBlcnJvcnMgaW5zdGVhZCBvZiBwYXNzaW5nIHRoZW0gbmljZWx5IGJhY2ssIGNhbGwgdGhpcyB3aXRoIHRvZ2dsZT10cnVlXG4gICAgICAgIHNlbGYuX3dvcmtlci50aHJvd0Vycm9ycyA9IGZ1bmN0aW9uKHRvZ2dsZSkge1xuICAgICAgICAgIHRoaXMucG9zdE1lc3NhZ2Uoe29wOiAndGhyb3dFcnJvcnMnLCBhcmdzOiBbdG9nZ2xlXX0pO1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNlbGYuX2Rpc2FibGVXb3JrZXJzID8gbnVsbCA6IHNlbGYuX3dvcmtlcjtcbiAgICB9LFxuICAgIFxuICAgIGFzeW5jOiBmdW5jdGlvbihzZWxmLCBmbiwgYXJncywgYXN5bmNFeHRyYUFyZ3MsIHdyYXBwZXIpIHtcbiAgICAgIGFyZ3MgPSBfLnRvQXJyYXkoYXJncyk7XG4gICAgICB3cmFwcGVyID0gd3JhcHBlciB8fCBfLmlkZW50aXR5O1xuICAgICAgdmFyIGFyZ3NFeGNlcHRMYXN0T25lID0gXy5pbml0aWFsKGFyZ3MpLFxuICAgICAgICBjYWxsYmFjayA9IF8ubGFzdChhcmdzKSxcbiAgICAgICAgdyA9IHRoaXMud29ya2VyKCk7XG4gICAgICAvLyBGYWxsYmFjayBpZiB3ZWIgd29ya2VycyBhcmUgbm90IHN1cHBvcnRlZC5cbiAgICAgIC8vIFRoaXMgY291bGQgYWxzbyBiZSB0d2Vha2VkIHRvIG5vdCB1c2Ugd2ViIHdvcmtlcnMgd2hlbiB0aGVyZSB3b3VsZCBiZSBubyBwZXJmb3JtYW5jZSBnYWluO1xuICAgICAgLy8gICBhY3RpdmF0aW5nIHRoaXMgYnJhbmNoIGRpc2FibGVzIHdlYiB3b3JrZXJzIGVudGlyZWx5IGFuZCBldmVyeXRoaW5nIGhhcHBlbnMgc3luY2hyb25vdXNseS5cbiAgICAgIGlmICghdykgeyByZXR1cm4gY2FsbGJhY2soc2VsZltmbl0uYXBwbHkoc2VsZiwgYXJnc0V4Y2VwdExhc3RPbmUpKTsgfVxuICAgICAgQXJyYXkucHJvdG90eXBlLnVuc2hpZnQuYXBwbHkoYXJnc0V4Y2VwdExhc3RPbmUsIGFzeW5jRXh0cmFBcmdzKTtcbiAgICAgIHcuY2FsbChmbiwgYXJnc0V4Y2VwdExhc3RPbmUsIGZ1bmN0aW9uKHJldCkgeyBjYWxsYmFjayh3cmFwcGVyKHJldCkpOyB9KTtcbiAgICB9LFxuICAgIFxuICAgIHBhcnNlQXN5bmM6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5hc3luYyh0aGlzLCAncGFyc2UnLCBhcmd1bWVudHMsIFtdLCBmdW5jdGlvbih0cmFja3MpIHtcbiAgICAgICAgLy8gVGhlc2UgaGF2ZSBiZWVuIHNlcmlhbGl6ZWQsIHNvIHRoZXkgbXVzdCBiZSBoeWRyYXRlZCBpbnRvIHJlYWwgQ3VzdG9tVHJhY2sgb2JqZWN0cy5cbiAgICAgICAgLy8gV2UgcmVwbGFjZSAucHJlcmVuZGVyKCkgd2l0aCBhbiBhc3luY2hyb25vdXMgdmVyc2lvbi5cbiAgICAgICAgcmV0dXJuIF8ubWFwKHRyYWNrcywgZnVuY3Rpb24odCkge1xuICAgICAgICAgIHJldHVybiBfLmV4dGVuZChuZXcgQ3VzdG9tVHJhY2soKSwgdCwge1xuICAgICAgICAgICAgcHJlcmVuZGVyOiBmdW5jdGlvbigpIHsgQ3VzdG9tVHJhY2sucHJvdG90eXBlLnByZXJlbmRlckFzeW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgZ2xvYmFsLkN1c3RvbVRyYWNrcyA9IEN1c3RvbVRyYWNrcztcblxufSk7IiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gY2hyb20uc2l6ZXMgZm9ybWF0OiBodHRwOi8vd3d3LmJyb2FkaW5zdGl0dXRlLm9yZy9pZ3YvY2hyb21TaXplcyA9XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTm90ZTogd2UgYXJlIGV4dGVuZGluZyB0aGUgZ2VuZXJhbCB1c2Ugb2YgdGhpcyB0byBpbmNsdWRlIGRhdGEgbG9hZGVkIGZyb20gdGhlIGdlbm9tZS50eHQgYW5kIGFubm90cy54bWxcbi8vIGZpbGVzIG9mIGFuIElHQiBxdWlja2xvYWQgZGlyZWN0b3J5LFxuXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzL3V0aWxzLmpzJyksXG4gIHBhcnNlSW50MTAgPSB1dGlscy5wYXJzZUludDEwLFxuICBzdHJpcCA9IHV0aWxzLnN0cmlwLFxuICBvcHRzQXNUcmFja0xpbmUgPSB1dGlscy5vcHRzQXNUcmFja0xpbmU7XG5cbnZhciBDaHJvbVNpemVzRm9ybWF0ID0ge1xuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBtID0gc2VsZi5tZXRhZGF0YSxcbiAgICAgIG8gPSBzZWxmLm9wdHM7XG4gICAgby5zcGVjaWVzID0gbS5zcGVjaWVzIHx8ICdDdXN0b20gR2Vub21lJztcbiAgICBvLmFzc2VtYmx5RGF0ZSA9IG0uYXNzZW1ibHlEYXRlIHx8ICcnO1xuICAgIFxuICAgIC8vIFRPRE86IGlmIG1ldGFkYXRhIGFsc28gY29udGFpbnMgY3VzdG9tIHRyYWNrIGRhdGEsIGUuZy4gZnJvbSBhbm5vdHMueG1sXG4gICAgLy8gbXVzdCBjb252ZXJ0IHRoZW0gaW50byBpdGVtcyBmb3Igby5hdmFpbFRyYWNrcywgby50cmFja3MsIGFuZCBvLnRyYWNrRGVzY1xuICAgIC8vIFRoZSBvLmF2YWlsVHJhY2tzIGl0ZW1zIHNob3VsZCBjb250YWluIHtjdXN0b21EYXRhOiB0cmFja2xpbmVzfSB0byBiZSBwYXJzZWRcbiAgICBpZiAobS50cmFja3MpIHsgc2VsZi5mb3JtYXQoKS5jcmVhdGVUcmFja3MobS50cmFja3MpOyB9XG4gIH0sXG4gIFxuICBjcmVhdGVUcmFja3M6IGZ1bmN0aW9uKHRyYWNrcykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdHM7XG4gICAgICBcbiAgICBfLmVhY2godHJhY2tzLCBmdW5jdGlvbih0KSB7XG4gICAgICB2YXIgdHJhY2tPcHRzO1xuICAgICAgdC5saW5lcyA9IHQubGluZXMgfHwgW107XG4gICAgICB0cmFja09wdHMgPSAvXnRyYWNrXFxzKy9pLnRlc3QodC5saW5lc1swXSkgPyBnbG9iYWwuQ3VzdG9tVHJhY2tzLnBhcnNlRGVjbGFyYXRpb25MaW5lKHQubGluZXMuc2hpZnQoKSkgOiB7fTtcbiAgICAgIHQubGluZXMudW5zaGlmdCgndHJhY2sgJyArIG9wdHNBc1RyYWNrTGluZShfLmV4dGVuZCh0cmFja09wdHMsIHQub3B0cywge25hbWU6IHQubmFtZSwgdHlwZTogdC50eXBlfSkpICsgJ1xcbicpO1xuICAgICAgby5hdmFpbFRyYWNrcy5wdXNoKHtcbiAgICAgICAgZmg6IHt9LFxuICAgICAgICBuOiB0Lm5hbWUsXG4gICAgICAgIHM6IFsnZGVuc2UnLCAnc3F1aXNoJywgJ3BhY2snXSxcbiAgICAgICAgaDogMTUsXG4gICAgICAgIG06IFsncGFjayddLFxuICAgICAgICBjdXN0b21EYXRhOiB0LmxpbmVzXG4gICAgICB9KTtcbiAgICAgIG8udHJhY2tzLnB1c2goe246IHQubmFtZX0pO1xuICAgICAgby50cmFja0Rlc2NbdC5uYW1lXSA9IHtcbiAgICAgICAgY2F0OiBcIkZlYXR1cmUgVHJhY2tzXCIsXG4gICAgICAgIHNtOiB0Lm5hbWUsXG4gICAgICAgIGxnOiB0LmRlc2NyaXB0aW9uIHx8IHQubmFtZVxuICAgICAgfTtcbiAgICB9KTtcbiAgfSxcbiAgXG4gIHBhcnNlOiBmdW5jdGlvbih0ZXh0KSB7XG4gICAgdmFyIGxpbmVzID0gdGV4dC5zcGxpdChcIlxcblwiKSxcbiAgICAgIG8gPSB0aGlzLm9wdHM7XG4gICAgXy5lYWNoKGxpbmVzLCBmdW5jdGlvbihsaW5lLCBpKSB7XG4gICAgICB2YXIgY2hyc2l6ZSA9IHN0cmlwKGxpbmUpLnNwbGl0KC9cXHMrLywgMiksXG4gICAgICAgIGNociA9IGNocnNpemVbMF0sXG4gICAgICAgIHNpemUgPSBwYXJzZUludDEwKGNocnNpemVbMV0pO1xuICAgICAgaWYgKF8uaXNOYU4oc2l6ZSkpIHsgcmV0dXJuOyB9XG4gICAgICBvLmNock9yZGVyLnB1c2goY2hyKTtcbiAgICAgIG8uY2hyTGVuZ3Roc1tjaHJdID0gc2l6ZTtcbiAgICAgIG8uZ2Vub21lU2l6ZSArPSBzaXplO1xuICAgIH0pO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENocm9tU2l6ZXNGb3JtYXQ7IiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gRkFTVEEgZm9ybWF0OiBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ZBU1RBX2Zvcm1hdCA9XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzL3V0aWxzLmpzJyksXG4gIGVuc3VyZVVuaXF1ZSA9IHV0aWxzLmVuc3VyZVVuaXF1ZTtcblxudmFyIEZhc3RhRm9ybWF0ID0ge1xuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBtID0gc2VsZi5tZXRhZGF0YSxcbiAgICAgIG8gPSBzZWxmLm9wdHM7XG4gICAgICBcbiAgICBzZWxmLmRhdGEgPSB7fTtcbiAgfSxcbiAgXG4gIHBhcnNlOiBmdW5jdGlvbih0ZXh0KSB7XG4gICAgdmFyIGxpbmVzID0gdGV4dC5zcGxpdChcIlxcblwiKSxcbiAgICAgIHNlbGYgPSB0aGlzLFxuICAgICAgbyA9IHNlbGYub3B0cyxcbiAgICAgIGNociA9IG51bGwsXG4gICAgICB1bm5hbWVkQ291bnRlciA9IDEsXG4gICAgICBjaHJzZXEgPSBbXTtcbiAgICAgIFxuICAgIHNlbGYuZGF0YS5zZXF1ZW5jZSA9IFtdO1xuICAgIFxuICAgIF8uZWFjaChsaW5lcywgZnVuY3Rpb24obGluZSwgaSkge1xuICAgICAgdmFyIGNockxpbmUgPSBsaW5lLm1hdGNoKC9eWz47XSguKykvKSxcbiAgICAgICAgY2xlYW5lZExpbmUgPSBsaW5lLnJlcGxhY2UoL1xccysvZywgJycpO1xuICAgICAgaWYgKGNockxpbmUpIHtcbiAgICAgICAgY2hyID0gY2hyTGluZVsxXS5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJyk7XG4gICAgICAgIGlmICghY2hyLmxlbmd0aCkgeyBjaHIgPSBcInVubmFtZWRDaHJcIjsgfVxuICAgICAgICBjaHIgPSBlbnN1cmVVbmlxdWUoY2hyLCBvLmNockxlbmd0aHMpO1xuICAgICAgICBvLmNock9yZGVyLnB1c2goY2hyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGYuZGF0YS5zZXF1ZW5jZS5wdXNoKGNsZWFuZWRMaW5lKTtcbiAgICAgICAgby5jaHJMZW5ndGhzW2Nocl0gPSAoby5jaHJMZW5ndGhzW2Nocl0gfHwgMCkgKyBjbGVhbmVkTGluZS5sZW5ndGg7XG4gICAgICAgIG8uZ2Vub21lU2l6ZSArPSBjbGVhbmVkTGluZS5sZW5ndGg7XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5kYXRhLnNlcXVlbmNlID0gc2VsZi5kYXRhLnNlcXVlbmNlLmpvaW4oJycpO1xuICAgIHNlbGYuY2FuR2V0U2VxdWVuY2UgPSB0cnVlO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEZhc3RhRm9ybWF0OyIsIlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSBHZW5CYW5rIGZvcm1hdDogaHR0cDovL3d3dy5uY2JpLm5sbS5uaWguZ292L1NpdGVtYXAvc2FtcGxlcmVjb3JkLmh0bWwgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzL3V0aWxzLmpzJyksXG4gIHBhcnNlSW50MTAgPSB1dGlscy5wYXJzZUludDEwLFxuICBzdHJpcCA9IHV0aWxzLnN0cmlwLFxuICB0b3BUYWdzQXNBcnJheSA9IHV0aWxzLnRvcFRhZ3NBc0FycmF5LFxuICBzdWJUYWdzQXNBcnJheSA9IHV0aWxzLnN1YlRhZ3NBc0FycmF5LFxuICBmZXRjaEZpZWxkID0gdXRpbHMuZmV0Y2hGaWVsZCxcbiAgZ2V0VGFnID0gdXRpbHMuZ2V0VGFnLFxuICBlbnN1cmVVbmlxdWUgPSB1dGlscy5lbnN1cmVVbmlxdWU7XG5cbnZhciBHZW5CYW5rRm9ybWF0ID0ge1xuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAvLyBOb3RlIHRoYXQgd2UgY2FsbCBHZW5CYW5rIGZpZWxkIG5hbWVzIGxpa2UgXCJMT0NVU1wiLCBcIkRFRklOSVRJT05cIiwgZXRjLiB0YWdzIGluc3RlYWQgb2Yga2V5cy5cbiAgICAvLyBXZSBkbyB0aGlzIGJlY2F1c2U6IDEpIGNlcnRhaW4gZmllbGQgbmFtZXMgY2FuIGJlIHJlcGVhdGVkIChlLmcuIFJFRkVSRU5DRSkgd2hpY2ggaXMgbW9yZSBcbiAgICAvLyBldm9jYXRpdmUgb2YgXCJ0YWdzXCIgYXMgb3Bwb3NlZCB0byB0aGUgYmVoYXZpb3Igb2Yga2V5cyBpbiBhIGhhc2guICBBbHNvLCAyKSB0aGlzIGlzIHRoZVxuICAgIC8vIG5vbWVuY2xhdHVyZSBwaWNrZWQgYnkgQmlvUnVieS5cbiAgICBcbiAgICB0aGlzLnRhZ1NpemUgPSAxMjsgLy8gaG93IHdpZGUgdGhlIGNvbHVtbiBmb3IgdGFncyBpcyBpbiBhIEdlbkJhbmsgZmlsZVxuICAgIHRoaXMuZmVhdHVyZVRhZ1NpemUgPSAyMTsgLy8gaG93IHdpZGUgdGhlIGNvbHVtbiBmb3IgdGFncyBpcyBpbiB0aGUgZmVhdHVyZSB0YWJsZSBzZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZWUgc2VjdGlvbiA0LjEgb2YgaHR0cDovL3d3dy5pbnNkYy5vcmcvZmlsZXMvZmVhdHVyZV90YWJsZS5odG1sXG4gICAgXG4gICAgdGhpcy5kYXRhID0ge1xuICAgICAgY29udGlnczogW10sXG4gICAgICB0cmFja0xpbmVzOiB7XG4gICAgICAgIHNvdXJjZTogW10sXG4gICAgICAgIGdlbmVzOiBbXSxcbiAgICAgICAgb3RoZXI6IFtdXG4gICAgICB9XG4gICAgfTtcbiAgfSxcbiAgXG4gIHBhcnNlTG9jdXM6IGZ1bmN0aW9uKGNvbnRpZykge1xuICAgIHZhciBsb2N1c0xpbmUgPSBjb250aWcub3JpZy5sb2N1cztcbiAgICBpZiAobG9jdXNMaW5lKSB7XG4gICAgICBpZiAobG9jdXNMaW5lLmxlbmd0aCA+IDc1KSB7IC8vIGFmdGVyIFJlbCAxMjYuMFxuICAgICAgICBjb250aWcuZW50cnlJZCAgPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDEyLCAyOCkpO1xuICAgICAgICBjb250aWcubGVuZ3RoICAgPSBwYXJzZUludDEwKGxvY3VzTGluZS5zdWJzdHJpbmcoMjksIDQwKSk7XG4gICAgICAgIGNvbnRpZy5zdHJhbmQgICA9IHN0cmlwKGxvY3VzTGluZS5zdWJzdHJpbmcoNDQsIDQ3KSk7XG4gICAgICAgIGNvbnRpZy5uYXR5cGUgICA9IHN0cmlwKGxvY3VzTGluZS5zdWJzdHJpbmcoNDcsIDUzKSk7XG4gICAgICAgIGNvbnRpZy5jaXJjdWxhciA9IHN0cmlwKGxvY3VzTGluZS5zdWJzdHJpbmcoNTUsIDYzKSk7XG4gICAgICAgIGNvbnRpZy5kaXZpc2lvbiA9IHN0cmlwKGxvY3VzTGluZS5zdWJzdHJpbmcoNjMsIDY3KSk7XG4gICAgICAgIGNvbnRpZy5kYXRlICAgICA9IHN0cmlwKGxvY3VzTGluZS5zdWJzdHJpbmcoNjgsIDc5KSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250aWcuZW50cnlJZCAgPSBzdHJpcChsb2N1c0xpbmUuc3Vic3RyaW5nKDEyLCAyMikpO1xuICAgICAgICBjb250aWcubGVuZ3RoICAgPSBwYXJzZUludDEwKGxvY3VzTGluZS5zdWJzdHJpbmcoMjIsIDMwKSk7XG4gICAgICAgIGNvbnRpZy5zdHJhbmQgICA9IHN0cmlwKGxvY3VzTGluZS5zdWJzdHJpbmcoMzMsIDM2KSk7XG4gICAgICAgIGNvbnRpZy5uYXR5cGUgICA9IHN0cmlwKGxvY3VzTGluZS5zdWJzdHJpbmcoMzYsIDQwKSk7XG4gICAgICAgIGNvbnRpZy5jaXJjdWxhciA9IHN0cmlwKGxvY3VzTGluZS5zdWJzdHJpbmcoNDIsIDUyKSk7XG4gICAgICAgIGNvbnRpZy5kaXZpc2lvbiA9IHN0cmlwKGxvY3VzTGluZS5zdWJzdHJpbmcoNTIsIDU1KSk7XG4gICAgICAgIGNvbnRpZy5kYXRlICAgICA9IHN0cmlwKGxvY3VzTGluZS5zdWJzdHJpbmcoNjIsIDczKSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBcbiAgcGFyc2VIZWFkZXJGaWVsZHM6IGZ1bmN0aW9uKGNvbnRpZykge1xuICAgIHZhciB0YWdTaXplID0gdGhpcy50YWdTaXplLFxuICAgICAgaGVhZGVyRmllbGRzVG9QYXJzZSA9IHtcbiAgICAgICAgc2ltcGxlOiBbJ2RlZmluaXRpb24nLCAnYWNjZXNzaW9uJywgJ3ZlcnNpb24nXSxcbiAgICAgICAgZGVlcDogWydzb3VyY2UnXSAvLyBjb3VsZCBhZGQgcmVmZXJlbmNlcywgYnV0IHdlIGRvbid0IGNhcmUgYWJvdXQgdGhvc2UgaGVyZVxuICAgICAgfTtcbiAgICBcbiAgICAvLyBQYXJzZSBzaW1wbGUgZmllbGRzICh0YWcgLS0+IGNvbnRlbnQpXG4gICAgXy5lYWNoKGhlYWRlckZpZWxkc1RvUGFyc2Uuc2ltcGxlLCBmdW5jdGlvbih0YWcpIHtcbiAgICAgIGlmICghY29udGlnLm9yaWdbdGFnXSkgeyBjb250aWdbdGFnXSA9IG51bGw7IHJldHVybjsgfVxuICAgICAgY29udGlnW3RhZ10gPSBmZXRjaEZpZWxkKGNvbnRpZy5vcmlnW3RhZ10sIHRhZ1NpemUpO1xuICAgIH0pO1xuICAgIFxuICAgIC8vIFBhcnNlIHRhZ3MgdGhhdCBjYW4gcmVwZWF0IGFuZCBoYXZlIHN1YnRhZ3NcbiAgICBfLmVhY2goaGVhZGVyRmllbGRzVG9QYXJzZS5kZWVwLCBmdW5jdGlvbih0YWcpIHtcbiAgICAgIHZhciBkYXRhID0gW10sXG4gICAgICAgIGl0ZW1zO1xuICAgICAgaWYgKCFjb250aWcub3JpZ1t0YWddKSB7IGNvbnRpZ1t0YWddID0gbnVsbDsgcmV0dXJuOyB9XG4gICAgICBcbiAgICAgIGl0ZW1zID0gY29udGlnLm9yaWdbdGFnXS5yZXBsYWNlKC9cXG4oW0EtWmEtelxcL1xcKl0pL2csIFwiXFxuXFwwMDEkMVwiKS5zcGxpdChcIlxcMDAxXCIpO1xuICAgICAgXy5lYWNoKGl0ZW1zLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIHZhciBzdWJUYWdzID0gc3ViVGFnc0FzQXJyYXkoaXRlbSwgdGFnU2l6ZSksXG4gICAgICAgICAgaXRlbU5hbWUgPSBmZXRjaEZpZWxkKHN1YlRhZ3Muc2hpZnQoKSwgdGFnU2l6ZSksIFxuICAgICAgICAgIGl0ZW1EYXRhID0ge19uYW1lOiBpdGVtTmFtZX07XG4gICAgICAgIF8uZWFjaChzdWJUYWdzLCBmdW5jdGlvbihzdWJUYWdGaWVsZCkge1xuICAgICAgICAgIHZhciB0YWcgPSBnZXRUYWcoc3ViVGFnRmllbGQsIHRhZ1NpemUpO1xuICAgICAgICAgIGl0ZW1EYXRhW3RhZ10gPSBmZXRjaEZpZWxkKHN1YlRhZ0ZpZWxkLCB0YWdTaXplKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGRhdGEucHVzaChpdGVtRGF0YSk7XG4gICAgICB9KTtcbiAgICAgIGNvbnRpZ1t0YWddID0gZGF0YTtcbiAgICAgIFxuICAgIH0pO1xuICB9LFxuICBcbiAgcGFyc2VGZWF0dXJlVGFibGU6IGZ1bmN0aW9uKGNociwgY29udGlnRGF0YSkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIHRhZ1NpemUgPSBzZWxmLnRhZ1NpemUsXG4gICAgICBmZWF0dXJlVGFnU2l6ZSA9IHNlbGYuZmVhdHVyZVRhZ1NpemUsXG4gICAgICB0YWdzVG9Ta2lwID0gW1wiZmVhdHVyZXNcIl0sXG4gICAgICB0YWdzUmVsYXRlZFRvR2VuZXMgPSBbXCJjZHNcIiwgXCJnZW5lXCIsIFwibXJuYVwiLCBcImV4b25cIiwgXCJpbnRyb25cIl0sXG4gICAgICBjb250aWdMaW5lID0gXCJBQ0NFU1NJT04gICBcIiArIGNociArIFwiXFxuXCI7XG4gICAgaWYgKGNvbnRpZ0RhdGEub3JpZy5mZWF0dXJlcykge1xuICAgICAgdmFyIHN1YlRhZ3MgPSBzdWJUYWdzQXNBcnJheShjb250aWdEYXRhLm9yaWcuZmVhdHVyZXMsIHRhZ1NpemUpO1xuICAgICAgc2VsZi5kYXRhLnRyYWNrTGluZXMuc291cmNlLnB1c2goY29udGlnTGluZSk7XG4gICAgICBzZWxmLmRhdGEudHJhY2tMaW5lcy5nZW5lcy5wdXNoKGNvbnRpZ0xpbmUpO1xuICAgICAgc2VsZi5kYXRhLnRyYWNrTGluZXMub3RoZXIucHVzaChjb250aWdMaW5lKTtcbiAgICAgIF8uZWFjaChzdWJUYWdzLCBmdW5jdGlvbihzdWJUYWdGaWVsZCkge1xuICAgICAgICB2YXIgdGFnID0gZ2V0VGFnKHN1YlRhZ0ZpZWxkLCBmZWF0dXJlVGFnU2l6ZSk7XG4gICAgICAgIGlmICh0YWdzVG9Ta2lwLmluZGV4T2YodGFnKSAhPT0gLTEpIHsgcmV0dXJuOyB9XG4gICAgICAgIGVsc2UgaWYgKHRhZyA9PT0gXCJzb3VyY2VcIikgeyBzZWxmLmRhdGEudHJhY2tMaW5lcy5zb3VyY2UucHVzaChzdWJUYWdGaWVsZCk7IH1cbiAgICAgICAgZWxzZSBpZiAodGFnc1JlbGF0ZWRUb0dlbmVzLmluZGV4T2YodGFnKSAhPT0gLTEpIHsgc2VsZi5kYXRhLnRyYWNrTGluZXMuZ2VuZXMucHVzaChzdWJUYWdGaWVsZCk7ICB9XG4gICAgICAgIGVsc2UgeyBzZWxmLmRhdGEudHJhY2tMaW5lcy5vdGhlci5wdXNoKHN1YlRhZ0ZpZWxkKTsgfVxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICBcbiAgcGFyc2VTZXF1ZW5jZTogZnVuY3Rpb24oY29udGlnRGF0YSkge1xuICAgIGlmIChjb250aWdEYXRhLm9yaWcub3JpZ2luKSB7XG4gICAgICByZXR1cm4gY29udGlnRGF0YS5vcmlnLm9yaWdpbi5yZXBsYWNlKC9eb3JpZ2luLip8XFxuWyAwLTldezEwfXwgL2lnLCAnJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBBcnJheShjb250aWdEYXRhLmxlbmd0aCkuam9pbignbicpO1xuICAgIH1cbiAgfSxcbiAgXG4gIGNyZWF0ZVRyYWNrc0Zyb21GZWF0dXJlczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgbyA9IHNlbGYub3B0cyxcbiAgICAgIGNhdGVnb3J5VHVwbGVzID0gW1xuICAgICAgICBbXCJzb3VyY2VcIiwgXCJTb3VyY2VzXCIsIFwiUmVnaW9ucyBhbm5vdGF0ZWQgYnkgc291cmNlIG9yZ2FuaXNtIG9yIHNwZWNpbWVuXCJdLCBcbiAgICAgICAgW1wiZ2VuZXNcIiwgXCJHZW5lIGFubm90YXRpb25zXCIsIFwiQ0RTIGFuZCBnZW5lIGZlYXR1cmVzXCJdLCBcbiAgICAgICAgW1wib3RoZXJcIiwgXCJPdGhlciBhbm5vdGF0aW9uc1wiLCBcInRSTkFzIGFuZCBvdGhlciBmZWF0dXJlc1wiXVxuICAgICAgXTtcbiAgICBcbiAgICAvLyBGb3IgdGhlIGNhdGVnb3JpZXMgb2YgZmVhdHVyZXMsIGNyZWF0ZSBhcHByb3ByaWF0ZSBlbnRyaWVzIGluIG8uYXZhaWxUcmFja3MsIG8udHJhY2tzLCBhbmQgby50cmFja0Rlc2NcbiAgICAvLyBMZWF2ZSB0aGUgYWN0dWFsIGRhdGEgYXMgYXJyYXlzIG9mIGxpbmVzIHRoYXQgYXJlIGF0dGFjaGVkIGFzIC5jdXN0b21EYXRhIHRvIG8uYXZhaWxUcmFja3NcbiAgICAvLyBUaGV5IHdpbGwgYmUgcGFyc2VkIGxhdGVyIHZpYSBDdXN0b21UcmFja3MucGFyc2UuXG4gICAgXy5lYWNoKGNhdGVnb3J5VHVwbGVzLCBmdW5jdGlvbihjYXRlZ29yeVR1cGxlKSB7XG4gICAgICB2YXIgY2F0ZWdvcnkgPSBjYXRlZ29yeVR1cGxlWzBdLFxuICAgICAgICBsYWJlbCA9IGNhdGVnb3J5VHVwbGVbMV0sXG4gICAgICAgIGxvbmdMYWJlbCA9IGNhdGVnb3J5VHVwbGVbMl0sXG4gICAgICAgIHRyYWNrTGluZXMgPSBbXTtcbiAgICAgIGlmIChzZWxmLmRhdGEudHJhY2tMaW5lc1tjYXRlZ29yeV0ubGVuZ3RoID4gMCkge1xuICAgICAgICBzZWxmLmRhdGEudHJhY2tMaW5lc1tjYXRlZ29yeV0udW5zaGlmdCgndHJhY2sgdHlwZT1cImZlYXR1cmVUYWJsZVwiIG5hbWU9XCInICsgbGFiZWwgKyBcbiAgICAgICAgICAnXCIgY29sbGFwc2VCeUdlbmU9XCInICsgKGNhdGVnb3J5PT1cImdlbmVzXCIgPyAnb24nIDogJ29mZicpICsgJ1wiXFxuJyk7XG4gICAgICB9XG4gICAgICBvLmF2YWlsVHJhY2tzLnB1c2goe1xuICAgICAgICBmaDoge30sXG4gICAgICAgIG46IGNhdGVnb3J5LFxuICAgICAgICBzOiBbJ2RlbnNlJywgJ3NxdWlzaCcsICdwYWNrJ10sXG4gICAgICAgIGg6IDE1LFxuICAgICAgICBtOiBbJ3BhY2snXSxcbiAgICAgICAgY3VzdG9tRGF0YTogc2VsZi5kYXRhLnRyYWNrTGluZXNbY2F0ZWdvcnldXG4gICAgICB9KTtcbiAgICAgIG8udHJhY2tzLnB1c2goe246IGNhdGVnb3J5fSk7XG4gICAgICBvLnRyYWNrRGVzY1tjYXRlZ29yeV0gPSB7XG4gICAgICAgIGNhdDogXCJGZWF0dXJlIFRyYWNrc1wiLFxuICAgICAgICBzbTogbGFiZWwsXG4gICAgICAgIGxnOiBsb25nTGFiZWxcbiAgICAgIH07XG4gICAgfSk7XG4gIH0sXG4gIFxuICBwYXJzZTogZnVuY3Rpb24odGV4dCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdHMsXG4gICAgICBjb250aWdEZWxpbWl0ZXIgPSBcIlxcbi8vXFxuXCIsXG4gICAgICBjb250aWdzID0gdGV4dC5zcGxpdChjb250aWdEZWxpbWl0ZXIpLFxuICAgICAgZmlyc3RDb250aWcgPSBudWxsO1xuICAgIFxuICAgIHNlbGYuZGF0YS5zZXF1ZW5jZSA9IFtdO1xuICAgICAgXG4gICAgXy5lYWNoKGNvbnRpZ3MsIGZ1bmN0aW9uKGNvbnRpZykge1xuICAgICAgaWYgKCFzdHJpcChjb250aWcpLmxlbmd0aCkgeyByZXR1cm47IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgdmFyIGNvbnRpZ0RhdGEgPSB7b3JpZzoge319LFxuICAgICAgICBjaHIsIHNpemUsIGNvbnRpZ1NlcXVlbmNlO1xuICAgICAgXG4gICAgICAvLyBTcGxpdHMgb24gYW55IGxpbmVzIHdpdGggYSBjaGFyYWN0ZXIgaW4gdGhlIGZpcnN0IGNvbHVtblxuICAgICAgXy5lYWNoKHRvcFRhZ3NBc0FycmF5KGNvbnRpZyksIGZ1bmN0aW9uKGZpZWxkKSB7XG4gICAgICAgIHZhciB0YWcgPSBnZXRUYWcoZmllbGQsIHNlbGYudGFnU2l6ZSk7XG4gICAgICAgIGlmIChfLmlzVW5kZWZpbmVkKGNvbnRpZ0RhdGEub3JpZ1t0YWddKSkgeyBjb250aWdEYXRhLm9yaWdbdGFnXSA9IGZpZWxkOyB9XG4gICAgICAgIGVsc2UgeyBjb250aWdEYXRhLm9yaWdbdGFnXSArPSBmaWVsZDsgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHNlbGYuZGF0YS5jb250aWdzLnB1c2goY29udGlnRGF0YSk7XG4gICAgICBzZWxmLmZvcm1hdCgpLnBhcnNlTG9jdXMoY29udGlnRGF0YSk7XG4gICAgICBzZWxmLmZvcm1hdCgpLnBhcnNlSGVhZGVyRmllbGRzKGNvbnRpZ0RhdGEpO1xuICAgICAgY29udGlnU2VxdWVuY2UgPSBzZWxmLmZvcm1hdCgpLnBhcnNlU2VxdWVuY2UoY29udGlnRGF0YSk7XG4gICAgICBcbiAgICAgIGNociA9IGNvbnRpZ0RhdGEuYWNjZXNzaW9uICYmIGNvbnRpZ0RhdGEuYWNjZXNzaW9uICE9ICd1bmtub3duJyA/IGNvbnRpZ0RhdGEuYWNjZXNzaW9uIDogY29udGlnRGF0YS5lbnRyeUlkO1xuICAgICAgY2hyID0gZW5zdXJlVW5pcXVlKGNociwgby5jaHJMZW5ndGhzKTtcbiAgICAgIFxuICAgICAgaWYgKGNvbnRpZ0RhdGEubGVuZ3RoKSB7XG4gICAgICAgIHNpemUgPSBjb250aWdEYXRhLmxlbmd0aDtcbiAgICAgICAgaWYgKHNpemUgIT0gY29udGlnU2VxdWVuY2UubGVuZ3RoKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2VxdWVuY2UgZGF0YSBmb3IgY29udGlnIFwiK2NocitcIiBkb2VzIG5vdCBtYXRjaCBsZW5ndGggXCIrc2l6ZStcImJwIGZyb20gaGVhZGVyXCIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaXplID0gY29udGlnU2VxdWVuY2UubGVuZ3RoO1xuICAgICAgfVxuICAgICAgXG4gICAgICBvLmNock9yZGVyLnB1c2goY2hyKTtcbiAgICAgIG8uY2hyTGVuZ3Roc1tjaHJdID0gc2l6ZTtcbiAgICAgIG8uZ2Vub21lU2l6ZSArPSBzaXplO1xuICAgICAgXG4gICAgICBzZWxmLmZvcm1hdCgpLnBhcnNlRmVhdHVyZVRhYmxlKGNociwgY29udGlnRGF0YSk7XG4gICAgICBzZWxmLmRhdGEuc2VxdWVuY2UucHVzaChjb250aWdTZXF1ZW5jZSk7XG4gICAgICBcbiAgICAgIGZpcnN0Q29udGlnID0gZmlyc3RDb250aWcgfHwgY29udGlnRGF0YTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmRhdGEuc2VxdWVuY2UgPSBzZWxmLmRhdGEuc2VxdWVuY2Uuam9pbignJyk7XG4gICAgc2VsZi5jYW5HZXRTZXF1ZW5jZSA9IHRydWU7XG4gICAgc2VsZi5mb3JtYXQoKS5jcmVhdGVUcmFja3NGcm9tRmVhdHVyZXMoKTtcbiAgICBcbiAgICBvLnNwZWNpZXMgPSBmaXJzdENvbnRpZy5zb3VyY2UgPyBmaXJzdENvbnRpZy5zb3VyY2VbMF0ub3JnYW5pc20uc3BsaXQoXCJcXG5cIilbMF0gOiAnQ3VzdG9tIEdlbm9tZSc7XG4gICAgaWYgKGZpcnN0Q29udGlnLmRhdGUpIHsgby5hc3NlbWJseURhdGUgPSBmaXJzdENvbnRpZy5kYXRlOyB9XG4gIH1cbiAgXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdlbkJhbmtGb3JtYXQ7IiwidmFyIHRyYWNrVXRpbHMgPSByZXF1aXJlKCcuLi8uLi90cmFjay10eXBlcy91dGlscy91dGlscy5qcycpO1xuXG5tb2R1bGUuZXhwb3J0cy5wYXJzZUludDEwID0gdHJhY2tVdGlscy5wYXJzZUludDEwO1xuXG5tb2R1bGUuZXhwb3J0cy5kZWVwQ2xvbmUgPSBmdW5jdGlvbihvYmopIHsgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7IH1cblxubW9kdWxlLmV4cG9ydHMubG9nMTAgPSBmdW5jdGlvbih2YWwpIHsgcmV0dXJuIE1hdGgubG9nKHZhbCkgLyBNYXRoLkxOMTA7IH1cblxudmFyIHN0cmlwID0gbW9kdWxlLmV4cG9ydHMuc3RyaXAgPSB0cmFja1V0aWxzLnN0cmlwO1xuXG5tb2R1bGUuZXhwb3J0cy5yb3VuZFRvUGxhY2VzID0gZnVuY3Rpb24obnVtLCBkZWMpIHsgcmV0dXJuIE1hdGgucm91bmQobnVtICogTWF0aC5wb3coMTAsIGRlYykpIC8gTWF0aC5wb3coMTAsIGRlYyk7IH1cblxuLyoqKipcbiAqIFRoZXNlIGZ1bmN0aW9ucyBhcmUgY29tbW9uIHN1YnJvdXRpbmVzIGZvciBwYXJzaW5nIEdlbkJhbmsgYW5kIG90aGVyIGZvcm1hdHMgYmFzZWQgb24gY29sdW1uIHBvc2l0aW9uc1xuICoqKiovXG5cbi8vIFNwbGl0cyBhIG11bHRpbGluZSBzdHJpbmcgYmVmb3JlIHRoZSBsaW5lcyB0aGF0IGNvbnRhaW4gYSBjaGFyYWN0ZXIgaW4gdGhlIGZpcnN0IGNvbHVtblxuLy8gKGEgXCJ0b3AgdGFnXCIpIGluIGEgR2VuQmFuay1zdHlsZSB0ZXh0IGZpbGVcbm1vZHVsZS5leHBvcnRzLnRvcFRhZ3NBc0FycmF5ID0gZnVuY3Rpb24oZmllbGQpIHtcbiAgcmV0dXJuIGZpZWxkLnJlcGxhY2UoL1xcbihbQS1aYS16XFwvXFwqXSkvZywgXCJcXG5cXDAwMSQxXCIpLnNwbGl0KFwiXFwwMDFcIik7XG59XG5cbi8vIFNwbGl0cyBhIG11bHRpbGluZSBzdHJpbmcgYmVmb3JlIHRoZSBsaW5lcyB0aGF0IGNvbnRhaW4gYSBjaGFyYWN0ZXIgbm90IGluIHRoZSBmaXJzdCBjb2x1bW5cbi8vIGJ1dCB3aXRoaW4gdGhlIG5leHQgdGFnU2l6ZSBjb2x1bW5zLCB3aGljaCBpcyBhIFwic3ViIHRhZ1wiIGluIGEgR2VuQmFuay1zdHlsZSB0ZXh0IGZpbGVcbm1vZHVsZS5leHBvcnRzLnN1YlRhZ3NBc0FycmF5ID0gZnVuY3Rpb24oZmllbGQsIHRhZ1NpemUpIHtcbiAgaWYgKCFpc0Zpbml0ZSh0YWdTaXplKSB8fCB0YWdTaXplIDwgMikgeyB0aHJvdyBcImludmFsaWQgdGFnU2l6ZVwiOyB9XG4gIHZhciByZSA9IG5ldyBSZWdFeHAoXCJcXFxcbihcXFxcc3sxLFwiICsgKHRhZ1NpemUgLSAxKSArIFwifVxcXFxTKVwiLCBcImdcIik7XG4gIHJldHVybiBmaWVsZC5yZXBsYWNlKHJlLCBcIlxcblxcMDAxJDFcIikuc3BsaXQoXCJcXDAwMVwiKTtcbn1cblxuLy8gUmV0dXJucyBhIG5ldyBzdHJpbmcgd2l0aCB0aGUgZmlyc3QgdGFnU2l6ZSBjb2x1bW5zIGZyb20gZmllbGQgcmVtb3ZlZFxubW9kdWxlLmV4cG9ydHMuZmV0Y2hGaWVsZCA9IGZ1bmN0aW9uKGZpZWxkLCB0YWdTaXplKSB7XG4gIGlmICghaXNGaW5pdGUodGFnU2l6ZSkgfHwgdGFnU2l6ZSA8IDEpIHsgdGhyb3cgXCJpbnZhbGlkIHRhZ1NpemVcIjsgfVxuICB2YXIgcmUgPSBuZXcgUmVnRXhwKFwiKF58XFxcXG4pLnswLFwiICsgdGFnU2l6ZSArIFwifVwiLCBcImdcIik7XG4gIHJldHVybiBzdHJpcChmaWVsZC5yZXBsYWNlKHJlLCBcIiQxXCIpKTtcbn1cblxuLy8gR2V0cyBhIHRhZyBmcm9tIGEgZmllbGQgYnkgdHJpbW1pbmcgaXQgb3V0IG9mIHRoZSBmaXJzdCB0YWdTaXplIGNoYXJhY3RlcnMgb2YgdGhlIGZpZWxkXG5tb2R1bGUuZXhwb3J0cy5nZXRUYWcgPSBmdW5jdGlvbihmaWVsZCwgdGFnU2l6ZSkgeyBcbiAgaWYgKCFpc0Zpbml0ZSh0YWdTaXplKSB8fCB0YWdTaXplIDwgMSkgeyB0aHJvdyBcImludmFsaWQgdGFnU2l6ZVwiOyB9XG4gIHJldHVybiBzdHJpcChmaWVsZC5zdWJzdHJpbmcoMCwgdGFnU2l6ZSkudG9Mb3dlckNhc2UoKSk7XG59XG5cbi8qKioqXG4gKiBFbmQgR2VuQmFuayBhbmQgY29sdW1uLWJhc2VkIGZvcm1hdCBoZWxwZXJzXG4gKioqKi9cblxuLy8gR2l2ZW4gYSBoYXNoIGFuZCBhIHByZXN1bXB0aXZlIG5ldyBrZXksIGFwcGVuZHMgYSBjb3VudGVyIHRvIHRoZSBrZXkgdW50aWwgaXQgaXMgYWN0dWFsbHkgYW4gdW51c2VkIGtleVxubW9kdWxlLmV4cG9ydHMuZW5zdXJlVW5pcXVlID0gZnVuY3Rpb24oa2V5LCBoYXNoKSB7XG4gIHZhciBpID0gMSwga2V5Q2hlY2sgPSBrZXk7XG4gIHdoaWxlICh0eXBlb2YgaGFzaFtrZXlDaGVja10gIT0gJ3VuZGVmaW5lZCcpIHsga2V5Q2hlY2sgPSBrZXkgKyAnXycgKyBpKys7IH1cbiAgcmV0dXJuIGtleUNoZWNrO1xufVxuXG4vLyBHaXZlbiBhIGhhc2ggd2l0aCBvcHRpb24gbmFtZXMgYW5kIHZhbHVlcywgZm9ybWF0cyBpdCBpbiBCRUQgdHJhY2sgbGluZSBmb3JtYXQgKHNpbWlsYXIgdG8gSFRNTCBlbGVtZW50IGF0dHJpYnV0ZXMpXG5tb2R1bGUuZXhwb3J0cy5vcHRzQXNUcmFja0xpbmUgPSBmdW5jdGlvbihvcHRoYXNoKSB7XG4gIHJldHVybiBfLm1hcChvcHRoYXNoLCBmdW5jdGlvbih2LCBrKSB7IHJldHVybiBrICsgJz1cIicgKyB2LnRvU3RyaW5nKCkucmVwbGFjZSgvXCIvZywgJycpICsgJ1wiJzsgfSkuam9pbignICcpO1xufSIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9IEJBTSBmb3JtYXQ6IGh0dHBzOi8vc2FtdG9vbHMuZ2l0aHViLmlvL2h0cy1zcGVjcy9TQU12MS5wZGYgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy91dGlscy5qcycpLFxuICBmbG9vckhhY2sgPSB1dGlscy5mbG9vckhhY2ssXG4gIHBhcnNlSW50MTAgPSB1dGlscy5wYXJzZUludDEwLFxuICBkZWVwQ2xvbmUgPSB1dGlscy5kZWVwQ2xvbmU7XG52YXIgUGFpcmVkSW50ZXJ2YWxUcmVlID0gcmVxdWlyZSgnLi91dGlscy9QYWlyZWRJbnRlcnZhbFRyZWUuanMnKS5QYWlyZWRJbnRlcnZhbFRyZWU7XG52YXIgUmVtb3RlVHJhY2sgPSByZXF1aXJlKCcuL3V0aWxzL1JlbW90ZVRyYWNrLmpzJykuUmVtb3RlVHJhY2s7XG5cbnZhciBCYW1Gb3JtYXQgPSB7XG4gIGRlZmF1bHRzOiB7XG4gICAgY2hyb21vc29tZXM6ICcnLFxuICAgIGl0ZW1SZ2I6ICdvZmYnLFxuICAgIGNvbG9yOiAnMTg4LDE4OCwxODgnLFxuICAgIGNvbG9yQnlTdHJhbmQ6ICcnLFxuICAgIHVzZVNjb3JlOiAwLFxuICAgIGdyb3VwOiAndXNlcicsXG4gICAgcHJpb3JpdHk6ICd1c2VyJyxcbiAgICBvZmZzZXQ6IDAsXG4gICAgZGV0YWlsOiBmYWxzZSxcbiAgICB1cmw6ICcnLFxuICAgIGh0bWxVcmw6ICcnLFxuICAgIGRyYXdMaW1pdDoge3NxdWlzaDogMjAwMCwgcGFjazogMjAwMH0sXG4gICAgLy8gSWYgYSBudWNsZW90aWRlIGRpZmZlcnMgZnJvbSB0aGUgcmVmZXJlbmNlIHNlcXVlbmNlIGluIGdyZWF0ZXIgdGhhbiAyMCUgb2YgcXVhbGl0eSB3ZWlnaHRlZCByZWFkcywgXG4gICAgLy8gSUdWIGNvbG9ycyB0aGUgYmFyIGluIHByb3BvcnRpb24gdG8gdGhlIHJlYWQgY291bnQgb2YgZWFjaCBiYXNlOyB0aGUgZm9sbG93aW5nIGNoYW5nZXMgdGhhdCB0aHJlc2hvbGQgZm9yIGNocm9tb3pvb21cbiAgICBhbGxlbGVGcmVxVGhyZXNob2xkOiAwLjIsXG4gICAgb3B0aW1hbEZldGNoV2luZG93OiAwLFxuICAgIG1heEZldGNoV2luZG93OiAwLFxuICAgIC8vIFRoZSBmb2xsb3dpbmcgY2FuIGJlIFwiZW5zZW1ibF91Y3NjXCIgb3IgXCJ1Y3NjX2Vuc2VtYmxcIiB0byBhdHRlbXB0IGF1dG8tY3Jvc3NtYXBwaW5nIG9mIHJlZmVyZW5jZSBjb250aWcgbmFtZXNcbiAgICAvLyBiZXR3ZWVuIHRoZSB0d28gc2NoZW1lcywgd2hpY2ggSUdWIGRvZXMsIGJ1dCBpcyBhIHBlcmVubmlhbCBpc3N1ZTogaHR0cHM6Ly93d3cuYmlvc3RhcnMub3JnL3AvMTAwNjIvXG4gICAgLy8gSSBob3BlIG5vdCB0byBuZWVkIGFsbCB0aGUgbWFwcGluZ3MgaW4gaGVyZSBodHRwczovL2dpdGh1Yi5jb20vZHByeWFuNzkvQ2hyb21vc29tZU1hcHBpbmdzIGJ1dCBpdCBtYXkgYmUgbmVjZXNzYXJ5XG4gICAgY29udmVydENoclNjaGVtZTogXCJhdXRvXCIsXG4gICAgLy8gRHJhdyBwYWlyZWQgZW5kcyB3aXRoaW4gYSByYW5nZSBvZiBleHBlY3RlZCBpbnNlcnQgc2l6ZXMgYXMgYSBjb250aW51b3VzIGZlYXR1cmU/XG4gICAgLy8gU2VlIGh0dHBzOi8vd3d3LmJyb2FkaW5zdGl0dXRlLm9yZy9pZ3YvQWxpZ25tZW50RGF0YSNwYWlyZWQgZm9yIGhvdyB0aGlzIHdvcmtzXG4gICAgdmlld0FzUGFpcnM6IGZhbHNlXG4gIH0sXG4gIFxuICAvLyBUaGUgRkxBRyBjb2x1bW4gZm9yIEJBTS9TQU0gaXMgYSBjb21iaW5hdGlvbiBvZiBiaXR3aXNlIGZsYWdzXG4gIGZsYWdzOiB7XG4gICAgaXNSZWFkUGFpcmVkOiAweDEsXG4gICAgaXNSZWFkUHJvcGVybHlBbGlnbmVkOiAweDIsXG4gICAgaXNSZWFkVW5tYXBwZWQ6IDB4NCxcbiAgICBpc01hdGVVbm1hcHBlZDogMHg4LFxuICAgIHJlYWRTdHJhbmRSZXZlcnNlOiAweDEwLFxuICAgIG1hdGVTdHJhbmRSZXZlcnNlOiAweDIwLFxuICAgIGlzUmVhZEZpcnN0T2ZQYWlyOiAweDQwLFxuICAgIGlzUmVhZExhc3RPZlBhaXI6IDB4ODAsXG4gICAgaXNTZWNvbmRhcnlBbGlnbm1lbnQ6IDB4MTAwLFxuICAgIGlzUmVhZEZhaWxpbmdWZW5kb3JRQzogMHgyMDAsXG4gICAgaXNEdXBsaWNhdGVSZWFkOiAweDQwMCxcbiAgICBpc1N1cHBsZW1lbnRhcnlBbGlnbm1lbnQ6IDB4ODAwXG4gIH0sXG5cbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJyb3dzZXJDaHJzID0gXy5rZXlzKHRoaXMuYnJvd3Nlck9wdHMpO1xuICAgIGlmICghdGhpcy5vcHRzLmJpZ0RhdGFVcmwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlJlcXVpcmVkIHBhcmFtZXRlciBiaWdEYXRhVXJsIG5vdCBmb3VuZCBmb3IgQkFNIHRyYWNrIGF0IFwiICtcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLm9wdHMpICsgKHRoaXMub3B0cy5saW5lTnVtICsgMSkpO1xuICAgIH1cbiAgICB0aGlzLmJyb3dzZXJDaHJTY2hlbWUgPSB0aGlzLnR5cGUoXCJiYW1cIikuZ3Vlc3NDaHJTY2hlbWUoXy5rZXlzKHRoaXMuYnJvd3Nlck9wdHMuY2hyUG9zKSk7XG4gIH0sXG4gIFxuICAvLyBUT0RPOiBXZSBtdXN0IG5vdGUgdGhhdCB3aGVuIHdlIGNoYW5nZSBvcHRzLnZpZXdBc1BhaXJzLCB3ZSAqbmVlZCogdG8gdGhyb3cgb3V0IHRoaXMuZGF0YS5waWxldXAuXG4gIC8vIFRPRE86IElmIHRoZSBwYWlyaW5nIGludGVydmFsIGNoYW5nZWQsIHdlIHNob3VsZCB0b3NzIHRoZSBlbnRpcmUgY2FjaGUgYW5kIHJlc2V0IHRoZSBSZW1vdGVUcmFjayBiaW5zLFxuICAvLyAgICAgICAgIGFuZCBibG93IHVwIHRoZSBhcmVhSW5kZXguXG4gIGFwcGx5T3B0czogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wcmV2T3B0cyA9IGRlZXBDbG9uZSh0aGlzLm9wdHMpO1xuICB9LFxuICBcbiAgZ3Vlc3NDaHJTY2hlbWU6IGZ1bmN0aW9uKGNocnMpIHtcbiAgICBsaW1pdCA9IE1hdGgubWluKGNocnMubGVuZ3RoICogMC44LCAyMCk7XG4gICAgaWYgKF8uZmlsdGVyKGNocnMsIGZ1bmN0aW9uKGNocikgeyByZXR1cm4gKC9eY2hyLykudGVzdChjaHIpOyB9KS5sZW5ndGggPiBsaW1pdCkgeyByZXR1cm4gJ3Vjc2MnOyB9XG4gICAgaWYgKF8uZmlsdGVyKGNocnMsIGZ1bmN0aW9uKGNocikgeyByZXR1cm4gKC9eXFxkXFxkPyQvKS50ZXN0KGNocik7IH0pLmxlbmd0aCA+IGxpbWl0KSB7IHJldHVybiAnZW5zZW1ibCc7IH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcbiAgXG4gIHBhcnNlOiBmdW5jdGlvbihsaW5lcykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdHMsXG4gICAgICBtaWRkbGVpc2hQb3MgPSBzZWxmLmJyb3dzZXJPcHRzLmdlbm9tZVNpemUgLyAyLFxuICAgICAgY2FjaGUgPSBuZXcgUGFpcmVkSW50ZXJ2YWxUcmVlKGZsb29ySGFjayhtaWRkbGVpc2hQb3MpLCB7c3RhcnRLZXk6ICdzdGFydCcsIGVuZEtleTogJ2VuZCd9LCBcbiAgICAgICAgICB7c3RhcnRLZXk6ICd0ZW1wbGF0ZVN0YXJ0JywgZW5kS2V5OiAndGVtcGxhdGVFbmQnLCBwYWlyZWRMZW5ndGhLZXk6ICd0bGVuJywgcGFpcmluZ0tleTogJ3FuYW1lJ30pLFxuICAgICAgYWpheFVybCA9IHNlbGYuYWpheERpcigpICsgJ2JhbS5waHAnLFxuICAgICAgcmVtb3RlO1xuICAgIFxuICAgIHJlbW90ZSA9IG5ldyBSZW1vdGVUcmFjayhjYWNoZSwgZnVuY3Rpb24oc3RhcnQsIGVuZCwgc3RvcmVJbnRlcnZhbHMpIHtcbiAgICAgIHJhbmdlID0gc2VsZi5jaHJSYW5nZShzdGFydCwgZW5kKTtcbiAgICAgIC8vIENvbnZlcnQgYXV0b21hdGljYWxseSBiZXR3ZWVuIEVuc2VtYmwgc3R5bGUgMSwgMiwgMywgWCA8LS0+IFVDU0Mgc3R5bGUgY2hyMSwgY2hyMiwgY2hyMywgY2hyWCBhcyBjb25maWd1cmVkL2F1dG9kZXRlY3RlZFxuICAgICAgLy8gTm90ZSB0aGF0IGNock0gaXMgTk9UIGVxdWl2YWxlbnQgdG8gTVQgaHR0cHM6Ly93d3cuYmlvc3RhcnMub3JnL3AvMTIwMDQyLyMxMjAwNThcbiAgICAgIHN3aXRjaCAoby5jb252ZXJ0Q2hyU2NoZW1lID09IFwiYXV0b1wiID8gc2VsZi5kYXRhLmluZm8uY29udmVydENoclNjaGVtZSA6IG8uY29udmVydENoclNjaGVtZSkge1xuICAgICAgICBjYXNlICdlbnNlbWJsX3Vjc2MnOiByYW5nZSA9IF8ubWFwKHJhbmdlLCBmdW5jdGlvbihyKSB7IHJldHVybiByLnJlcGxhY2UoL15jaHIvLCAnJyk7IH0pOyBicmVhaztcbiAgICAgICAgY2FzZSAndWNzY19lbnNlbWJsJzogcmFuZ2UgPSBfLm1hcChyYW5nZSwgZnVuY3Rpb24ocikgeyByZXR1cm4gci5yZXBsYWNlKC9eKFxcZFxcZD98WCk6LywgJ2NociQxOicpOyB9KTsgYnJlYWs7XG4gICAgICB9XG4gICAgICAkLmFqYXgoYWpheFVybCwge1xuICAgICAgICBkYXRhOiB7cmFuZ2U6IHJhbmdlLCB1cmw6IHNlbGYub3B0cy5iaWdEYXRhVXJsfSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIHZhciBsaW5lcyA9IF8uZmlsdGVyKGRhdGEuc3BsaXQoJ1xcbicpLCBmdW5jdGlvbihsKSB7IHZhciBtID0gbC5tYXRjaCgvXFx0L2cpOyByZXR1cm4gbSAmJiBtLmxlbmd0aCA+PSAyOyB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBQYXJzZSB0aGUgU0FNIGZvcm1hdCBpbnRvIGludGVydmFscyB0aGF0IGNhbiBiZSBpbnNlcnRlZCBpbnRvIHRoZSBJbnRlcnZhbFRyZWUgY2FjaGVcbiAgICAgICAgICB2YXIgaW50ZXJ2YWxzID0gXy5tYXAobGluZXMsIGZ1bmN0aW9uKGwpIHsgcmV0dXJuIHNlbGYudHlwZSgnYmFtJykucGFyc2VMaW5lLmNhbGwoc2VsZiwgbCk7IH0pO1xuICAgICAgICAgIHN0b3JlSW50ZXJ2YWxzKGludGVydmFscyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZGF0YSA9IHtjYWNoZTogY2FjaGUsIHJlbW90ZTogcmVtb3RlLCBwaWxldXA6IHt9LCBpbmZvOiB7fX07XG4gICAgc2VsZi5oZWlnaHRzID0ge21heDogbnVsbCwgbWluOiAyNCwgc3RhcnQ6IDI0fTtcbiAgICBzZWxmLnNpemVzID0gWydkZW5zZScsICdzcXVpc2gnLCAncGFjayddO1xuICAgIHNlbGYubWFwU2l6ZXMgPSBbJ3BhY2snXTtcbiAgICBzZWxmLm5vQXJlYUxhYmVscyA9IHRydWU7XG4gICAgc2VsZi5leHBlY3RzU2VxdWVuY2UgPSB0cnVlO1xuICAgIHNlbGYucmVuZGVyU2VxdWVuY2VDYWxsYmFja3MgPSB7fTtcbiAgICBzZWxmLnByZXZPcHRzID0gZGVlcENsb25lKG8pOyAgLy8gdXNlZCB0byBkZXRlY3Qgd2hpY2ggZHJhd2luZyBvcHRpb25zIGhhdmUgYmVlbiBjaGFuZ2VkIGJ5IHRoZSB1c2VyXG4gICAgXG4gICAgLy8gR2V0IGdlbmVyYWwgaW5mbyBvbiB0aGUgYmFtIChlLmcuIGBzYW10b29scyBpZHhzdGF0c2AsIHVzZSBtYXBwZWQgcmVhZHMgcGVyIHJlZmVyZW5jZSBzZXF1ZW5jZVxuICAgIC8vIHRvIGVzdGltYXRlIG1heEZldGNoV2luZG93IGFuZCBvcHRpbWFsRmV0Y2hXaW5kb3csIGFuZCBzZXR1cCBiaW5uaW5nIG9uIHRoZSBSZW1vdGVUcmFjay5cbiAgICAkLmFqYXgoYWpheFVybCwge1xuICAgICAgZGF0YToge3VybDogby5iaWdEYXRhVXJsfSxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdmFyIG1hcHBlZFJlYWRzID0gMCxcbiAgICAgICAgICBtYXhJdGVtc1RvRHJhdyA9IF8ubWF4KF8udmFsdWVzKG8uZHJhd0xpbWl0KSksXG4gICAgICAgICAgYmFtQ2hycyA9IFtdLFxuICAgICAgICAgIGluZm9QYXJ0cyA9IGRhdGEuc3BsaXQoXCJcXG5cXG5cIiksXG4gICAgICAgICAgc2FtcGxlSW50ZXJ2YWxzLCBtZWFuSXRlbUxlbmd0aCwgY2hyU2NoZW1lLCBtZWFuSXRlbXNQZXJCcDtcbiAgICAgICAgXG4gICAgICAgIF8uZWFjaChpbmZvUGFydHNbMF0uc3BsaXQoXCJcXG5cIiksIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgICB2YXIgZmllbGRzID0gbGluZS5zcGxpdChcIlxcdFwiKSxcbiAgICAgICAgICAgIHJlYWRzTWFwcGVkVG9Db250aWcgPSBwYXJzZUludChmaWVsZHNbMl0sIDEwKTtcbiAgICAgICAgICBpZiAoZmllbGRzLmxlbmd0aCA9PSAxICYmIGZpZWxkc1swXSA9PSAnJykgeyByZXR1cm47IH0gLy8gYmxhbmsgbGluZVxuICAgICAgICAgIGJhbUNocnMucHVzaChmaWVsZHNbMF0pO1xuICAgICAgICAgIGlmIChfLmlzTmFOKHJlYWRzTWFwcGVkVG9Db250aWcpKSB7IHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgb3V0cHV0IGZvciBzYW10b29scyBpZHhzdGF0cyBvbiB0aGlzIEJBTSB0cmFjay5cIik7IH1cbiAgICAgICAgICBtYXBwZWRSZWFkcyArPSByZWFkc01hcHBlZFRvQ29udGlnO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHNlbGYuZGF0YS5pbmZvLmNoclNjaGVtZSA9IGNoclNjaGVtZSA9IHNlbGYudHlwZShcImJhbVwiKS5ndWVzc0NoclNjaGVtZShiYW1DaHJzKTtcbiAgICAgICAgaWYgKGNoclNjaGVtZSAmJiBzZWxmLmJyb3dzZXJDaHJTY2hlbWUpIHtcbiAgICAgICAgICBzZWxmLmRhdGEuaW5mby5jb252ZXJ0Q2hyU2NoZW1lID0gY2hyU2NoZW1lICE9IHNlbGYuYnJvd3NlckNoclNjaGVtZSA/IGNoclNjaGVtZSArICdfJyArIHNlbGYuYnJvd3NlckNoclNjaGVtZSA6IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNhbXBsZUludGVydmFscyA9IF8uY29tcGFjdChfLm1hcChpbmZvUGFydHNbMV0uc3BsaXQoXCJcXG5cIiksIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgICByZXR1cm4gc2VsZi50eXBlKCdiYW0nKS5wYXJzZUxpbmUuY2FsbChzZWxmLCBsaW5lKTtcbiAgICAgICAgfSkpO1xuICAgICAgICBpZiAoc2FtcGxlSW50ZXJ2YWxzLmxlbmd0aCkge1xuICAgICAgICAgIG1lYW5JdGVtTGVuZ3RoID0gXy5yZWR1Y2Uoc2FtcGxlSW50ZXJ2YWxzLCBmdW5jdGlvbihtZW1vLCBuZXh0KSB7IHJldHVybiBtZW1vICsgKG5leHQuZW5kIC0gbmV4dC5zdGFydCk7IH0sIDApO1xuICAgICAgICAgIG1lYW5JdGVtTGVuZ3RoID0gbWVhbkl0ZW1MZW5ndGggLyBzYW1wbGVJbnRlcnZhbHMubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKHNlbGYuYnJvd3Nlck9wdHMucG9zKTtcbiAgICAgICAgY29uc29sZS5sb2cobWVhbkl0ZW1MZW5ndGgpO1xuICAgICAgICAvLyBUT0RPOiBDYW4gZXN0aW1hdGUgaW5zZXJ0IHNpemVzIGZyb20gVExFTiAtIDIgKiAoZW5kIC0gc3RhcnQpLlxuICAgICAgICBcbiAgICAgICAgc2VsZi5kYXRhLmluZm8ubWVhbkl0ZW1zUGVyQnAgPSBtZWFuSXRlbXNQZXJCcCA9IG1hcHBlZFJlYWRzIC8gc2VsZi5icm93c2VyT3B0cy5nZW5vbWVTaXplO1xuICAgICAgICBzZWxmLmRhdGEuaW5mby5tZWFuSXRlbUxlbmd0aCA9IG1lYW5JdGVtTGVuZ3RoIHx8IDEwMDtcbiAgICAgICAgby5tYXhGZXRjaFdpbmRvdyA9IG1heEl0ZW1zVG9EcmF3IC8gbWVhbkl0ZW1zUGVyQnA7XG4gICAgICAgIG8ub3B0aW1hbEZldGNoV2luZG93ID0gTWF0aC5mbG9vcihvLm1heEZldGNoV2luZG93IC8gMik7XG4gICAgICAgIFxuICAgICAgICAvLyBUT0RPOiBXZSBzaG91bGQgZGVhY3RpdmF0ZSB0aGUgcGFpcmluZyBmdW5jdGlvbmFsaXR5IG9mIHRoZSBQYWlyZWRJbnRlcnZhbFRyZWUgXG4gICAgICAgIC8vICAgICAgIGlmIHdlIGRvbid0IHNlZSBhbnkgcGFpcmVkIHJlYWRzIGluIHRoaXMgQkFNLlxuICAgICAgICAvLyAgICAgICBJZiB0aGVyZSBpcyBwYWlyaW5nLCB3ZSBuZWVkIHRvIHRlbGwgdGhlIFBhaXJlZEludGVydmFsVHJlZSB3aGF0IHJhbmdlIG9mIGluc2VydCBzaXplc1xuICAgICAgICAvLyAgICAgICBzaG91bGQgdHJpZ2dlciBwYWlyaW5nLlxuICAgICAgICBzZWxmLmRhdGEuY2FjaGUuc2V0UGFpcmluZ0ludGVydmFsKDEwLCA1MDAwKTtcbiAgICAgICAgcmVtb3RlLnNldHVwQmlucyhzZWxmLmJyb3dzZXJPcHRzLmdlbm9tZVNpemUsIG8ub3B0aW1hbEZldGNoV2luZG93LCBvLm1heEZldGNoV2luZG93KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcbiAgXG4gIC8vIFNldHMgZmVhdHVyZS5mbGFnc1suLi5dIHRvIGEgaHVtYW4gaW50ZXJwcmV0YWJsZSB2ZXJzaW9uIG9mIGZlYXR1cmUuZmxhZyAoZXhwYW5kaW5nIHRoZSBiaXR3aXNlIGZsYWdzKVxuICBwYXJzZUZsYWdzOiBmdW5jdGlvbihmZWF0dXJlLCBsaW5lbm8pIHtcbiAgICBmZWF0dXJlLmZsYWdzID0ge307XG4gICAgXy5lYWNoKHRoaXMudHlwZSgnYmFtJykuZmxhZ3MsIGZ1bmN0aW9uKGJpdCwgZmxhZykge1xuICAgICAgZmVhdHVyZS5mbGFnc1tmbGFnXSA9ICEhKGZlYXR1cmUuZmxhZyAmIGJpdCk7XG4gICAgfSk7XG4gIH0sXG4gIFxuICAvLyBTZXRzIGZlYXR1cmUuYmxvY2tzIGFuZCBmZWF0dXJlLmVuZCBiYXNlZCBvbiBmZWF0dXJlLmNpZ2FyXG4gIC8vIFNlZSBzZWN0aW9uIDEuNCBvZiBodHRwczovL3NhbXRvb2xzLmdpdGh1Yi5pby9odHMtc3BlY3MvU0FNdjEucGRmIGZvciBhbiBleHBsYW5hdGlvbiBvZiBDSUdBUiBcbiAgcGFyc2VDaWdhcjogZnVuY3Rpb24oZmVhdHVyZSwgbGluZW5vKSB7ICAgICAgICBcbiAgICB2YXIgY2lnYXIgPSBmZWF0dXJlLmNpZ2FyLFxuICAgICAgc2VxID0gZmVhdHVyZS5zZXEgfHwgXCJcIixcbiAgICAgIHJlZkxlbiA9IDAsXG4gICAgICBzZXFQb3MgPSAwLFxuICAgICAgb3BlcmF0aW9ucywgbGVuZ3RocztcbiAgICBcbiAgICBmZWF0dXJlLmJsb2NrcyA9IFtdO1xuICAgIGZlYXR1cmUuaW5zZXJ0aW9ucyA9IFtdO1xuICAgIFxuICAgIG9wcyA9IGNpZ2FyLnNwbGl0KC9cXGQrLykuc2xpY2UoMSk7XG4gICAgbGVuZ3RocyA9IGNpZ2FyLnNwbGl0KC9bQS1aPV0vKS5zbGljZSgwLCAtMSk7XG4gICAgaWYgKG9wcy5sZW5ndGggIT0gbGVuZ3Rocy5sZW5ndGgpIHsgdGhpcy53YXJuKFwiSW52YWxpZCBDSUdBUiAnXCIgKyBjaWdhciArIFwiJyBmb3IgXCIgKyBmZWF0dXJlLmRlc2MpOyByZXR1cm47IH1cbiAgICBsZW5ndGhzID0gXy5tYXAobGVuZ3RocywgcGFyc2VJbnQxMCk7XG4gICAgXG4gICAgXy5lYWNoKG9wcywgZnVuY3Rpb24ob3AsIGkpIHtcbiAgICAgIHZhciBsZW4gPSBsZW5ndGhzW2ldLFxuICAgICAgICBibG9jaywgaW5zZXJ0aW9uO1xuICAgICAgaWYgKC9eW01YPV0kLy50ZXN0KG9wKSkge1xuICAgICAgICAvLyBBbGlnbm1lbnQgbWF0Y2gsIHNlcXVlbmNlIG1hdGNoLCBzZXF1ZW5jZSBtaXNtYXRjaFxuICAgICAgICBibG9jayA9IHtzdGFydDogZmVhdHVyZS5zdGFydCArIHJlZkxlbn07XG4gICAgICAgIGJsb2NrLmVuZCA9IGJsb2NrLnN0YXJ0ICsgbGVuO1xuICAgICAgICBibG9jay50eXBlID0gb3A7XG4gICAgICAgIGJsb2NrLnNlcSA9IHNlcS5zbGljZShzZXFQb3MsIHNlcVBvcyArIGxlbik7XG4gICAgICAgIGZlYXR1cmUuYmxvY2tzLnB1c2goYmxvY2spO1xuICAgICAgICByZWZMZW4gKz0gbGVuO1xuICAgICAgICBzZXFQb3MgKz0gbGVuO1xuICAgICAgfSBlbHNlIGlmICgvXltORF0kLy50ZXN0KG9wKSkge1xuICAgICAgICAvLyBTa2lwcGVkIHJlZmVyZW5jZSByZWdpb24sIGRlbGV0aW9uIGZyb20gcmVmZXJlbmNlXG4gICAgICAgIHJlZkxlbiArPSBsZW47XG4gICAgICB9IGVsc2UgaWYgKG9wID09ICdJJykge1xuICAgICAgICAvLyBJbnNlcnRpb25cbiAgICAgICAgaW5zZXJ0aW9uID0ge3N0YXJ0OiBmZWF0dXJlLnN0YXJ0ICsgcmVmTGVuLCBlbmQ6IGZlYXR1cmUuc3RhcnQgKyByZWZMZW59O1xuICAgICAgICBpbnNlcnRpb24uc2VxID0gc2VxLnNsaWNlKHNlcVBvcywgc2VxUG9zICsgbGVuKTtcbiAgICAgICAgZmVhdHVyZS5pbnNlcnRpb25zLnB1c2goaW5zZXJ0aW9uKTtcbiAgICAgICAgc2VxUG9zICs9IGxlbjtcbiAgICAgIH0gZWxzZSBpZiAob3AgPT0gJ1MnKSB7XG4gICAgICAgIC8vIFNvZnQgY2xpcHBpbmc7IHNpbXBseSBza2lwIHRoZXNlIGJhc2VzIGluIFNFUSwgcG9zaXRpb24gb24gcmVmZXJlbmNlIGlzIHVuY2hhbmdlZC5cbiAgICAgICAgc2VxUG9zICs9IGxlbjtcbiAgICAgIH1cbiAgICAgIC8vIFRoZSBvdGhlciB0d28gQ0lHQVIgb3BzLCBIIGFuZCBQLCBhcmUgbm90IHJlbGV2YW50IHRvIGRyYXdpbmcgYWxpZ25tZW50cy5cbiAgICB9KTtcbiAgICBcbiAgICBmZWF0dXJlLmVuZCA9IGZlYXR1cmUuc3RhcnQgKyByZWZMZW47XG4gIH0sXG4gIFxuICBwYXJzZUxpbmU6IGZ1bmN0aW9uKGxpbmUsIGxpbmVubykge1xuICAgIHZhciBvID0gdGhpcy5vcHRzLFxuICAgICAgY29scyA9IFsncW5hbWUnLCAnZmxhZycsICdybmFtZScsICdwb3MnLCAnbWFwcScsICdjaWdhcicsICdybmV4dCcsICdwbmV4dCcsICd0bGVuJywgJ3NlcScsICdxdWFsJ10sXG4gICAgICBmZWF0dXJlID0ge30sXG4gICAgICBmaWVsZHMgPSBsaW5lLnNwbGl0KFwiXFx0XCIpLFxuICAgICAgYXZhaWxGbGFncyA9IHRoaXMudHlwZSgnYmFtJykuZmxhZ3MsXG4gICAgICBjaHJQb3MsIGJsb2NrU2l6ZXM7XG4gICAgXG4gICAgXy5lYWNoKF8uZmlyc3QoZmllbGRzLCBjb2xzLmxlbmd0aCksIGZ1bmN0aW9uKHYsIGkpIHsgZmVhdHVyZVtjb2xzW2ldXSA9IHY7IH0pO1xuICAgIC8vIENvbnZlcnQgYXV0b21hdGljYWxseSBiZXR3ZWVuIEVuc2VtYmwgc3R5bGUgMSwgMiwgMywgWCA8LS0+IFVDU0Mgc3R5bGUgY2hyMSwgY2hyMiwgY2hyMywgY2hyWCBhcyBjb25maWd1cmVkL2F1dG9kZXRlY3RlZFxuICAgIC8vIE5vdGUgdGhhdCBjaHJNIGlzIE5PVCBlcXVpdmFsZW50IHRvIE1UIGh0dHBzOi8vd3d3LmJpb3N0YXJzLm9yZy9wLzEyMDA0Mi8jMTIwMDU4XG4gICAgc3dpdGNoIChvLmNvbnZlcnRDaHJTY2hlbWUgPT0gXCJhdXRvXCIgPyB0aGlzLmRhdGEuaW5mby5jb252ZXJ0Q2hyU2NoZW1lIDogby5jb252ZXJ0Q2hyU2NoZW1lKSB7XG4gICAgICBjYXNlICd1Y3NjX2Vuc2VtYmwnOiBmZWF0dXJlLnJuYW1lID0gZmVhdHVyZS5ybmFtZS5yZXBsYWNlKC9eY2hyLywgJycpOyBicmVhaztcbiAgICAgIGNhc2UgJ2Vuc2VtYmxfdWNzYyc6IGZlYXR1cmUucm5hbWUgPSAoL14oXFxkXFxkP3xYKSQvLnRlc3QoZmVhdHVyZS5ybmFtZSkgPyAnY2hyJyA6ICcnKSArIGZlYXR1cmUucm5hbWU7IGJyZWFrO1xuICAgIH1cbiAgICBmZWF0dXJlLm5hbWUgPSBmZWF0dXJlLnFuYW1lO1xuICAgIGZlYXR1cmUuZmxhZyA9IHBhcnNlSW50MTAoZmVhdHVyZS5mbGFnKTtcbiAgICBjaHJQb3MgPSB0aGlzLmJyb3dzZXJPcHRzLmNoclBvc1tmZWF0dXJlLnJuYW1lXTtcbiAgICBsaW5lbm8gPSBsaW5lbm8gfHwgMDtcbiAgICBcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChjaHJQb3MpKSB7XG4gICAgICB0aGlzLndhcm4oXCJJbnZhbGlkIFJOQU1FICdcIitmZWF0dXJlLnJuYW1lK1wiJyBhdCBsaW5lIFwiICsgKGxpbmVubyArIDEgKyB0aGlzLm9wdHMubGluZU51bSkpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmIChmZWF0dXJlLnBvcyA9PT0gJzAnIHx8ICFmZWF0dXJlLmNpZ2FyIHx8IGZlYXR1cmUuY2lnYXIgPT0gJyonIHx8IGZlYXR1cmUuZmxhZyAmIGF2YWlsRmxhZ3MuaXNSZWFkVW5tYXBwZWQpIHtcbiAgICAgIC8vIFVubWFwcGVkIHJlYWQuIFNpbmNlIHdlIGNhbid0IGRyYXcgdGhlc2UgYXQgYWxsLCB3ZSBkb24ndCBib3RoZXIgcGFyc2luZyB0aGVtIGZ1cnRoZXIuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgZmVhdHVyZS5zY29yZSA9IF8uaXNVbmRlZmluZWQoZmVhdHVyZS5zY29yZSkgPyAnPycgOiBmZWF0dXJlLnNjb3JlO1xuICAgICAgZmVhdHVyZS5zdGFydCA9IGNoclBvcyArIHBhcnNlSW50MTAoZmVhdHVyZS5wb3MpOyAgICAgICAgLy8gUE9TIGlzIDEtYmFzZWQsIGhlbmNlIG5vIGluY3JlbWVudCBhcyBmb3IgcGFyc2luZyBCRURcbiAgICAgIGZlYXR1cmUuZGVzYyA9IGZlYXR1cmUucW5hbWUgKyAnIGF0ICcgKyBmZWF0dXJlLnJuYW1lICsgJzonICsgZmVhdHVyZS5wb3M7XG4gICAgICBmZWF0dXJlLnRsZW4gPSBwYXJzZUludDEwKGZlYXR1cmUudGxlbik7XG4gICAgICB0aGlzLnR5cGUoJ2JhbScpLnBhcnNlRmxhZ3MuY2FsbCh0aGlzLCBmZWF0dXJlLCBsaW5lbm8pO1xuICAgICAgZmVhdHVyZS5zdHJhbmQgPSBmZWF0dXJlLmZsYWdzLnJlYWRTdHJhbmRSZXZlcnNlID8gJy0nIDogJysnO1xuICAgICAgdGhpcy50eXBlKCdiYW0nKS5wYXJzZUNpZ2FyLmNhbGwodGhpcywgZmVhdHVyZSwgbGluZW5vKTsgLy8gVGhpcyBhbHNvIHNldHMgLmVuZCBhcHByb3ByaWF0ZWx5XG4gICAgfVxuICAgIC8vIFdlIGhhdmUgdG8gY29tZSB1cCB3aXRoIHNvbWV0aGluZyB0aGF0IGlzIGEgdW5pcXVlIGxhYmVsIGZvciBldmVyeSBsaW5lIHRvIGRlZHVwZSByb3dzLlxuICAgIC8vIFRoZSBmb2xsb3dpbmcgaXMgdGVjaG5pY2FsbHkgbm90IGd1YXJhbnRlZWQgYnkgYSB2YWxpZCBCQU0gKGV2ZW4gYXQgR0FUSyBzdGFuZGFyZHMpLCBidXQgaXQncyB0aGUgYmVzdCBJIGdvdC5cbiAgICBmZWF0dXJlLmlkID0gW2ZlYXR1cmUucW5hbWUsIGZlYXR1cmUuZmxhZywgZmVhdHVyZS5ybmFtZSwgZmVhdHVyZS5wb3MsIGZlYXR1cmUuY2lnYXJdLmpvaW4oXCJcXHRcIik7XG4gICAgXG4gICAgcmV0dXJuIGZlYXR1cmU7XG4gIH0sXG4gIFxuICBwaWxldXA6IGZ1bmN0aW9uKGludGVydmFscywgc3RhcnQsIGVuZCkge1xuICAgIHZhciBwaWxldXAgPSB0aGlzLmRhdGEucGlsZXVwLFxuICAgICAgcG9zaXRpb25zVG9DYWxjdWxhdGUgPSB7fSxcbiAgICAgIG51bVBvc2l0aW9uc1RvQ2FsY3VsYXRlID0gMCxcbiAgICAgIGk7XG4gICAgXG4gICAgZm9yIChpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xuICAgICAgLy8gTm8gbmVlZCB0byBwaWxldXAgYWdhaW4gb24gYWxyZWFkeS1waWxlZC11cCBudWNsZW90aWRlIHBvc2l0aW9uc1xuICAgICAgaWYgKCFwaWxldXBbaV0pIHsgcG9zaXRpb25zVG9DYWxjdWxhdGVbaV0gPSB0cnVlOyBudW1Qb3NpdGlvbnNUb0NhbGN1bGF0ZSsrOyB9XG4gICAgfVxuICAgIGlmIChudW1Qb3NpdGlvbnNUb0NhbGN1bGF0ZSA9PT0gMCkgeyByZXR1cm47IH0gLy8gQWxsIHBvc2l0aW9ucyBhbHJlYWR5IHBpbGVkIHVwIVxuICAgIFxuICAgIF8uZWFjaChpbnRlcnZhbHMsIGZ1bmN0aW9uKGludGVydmFsKSB7XG4gICAgICB2YXIgYmxvY2tTZXRzID0gW2ludGVydmFsLmRhdGEuYmxvY2tzXTtcbiAgICAgIGlmIChpbnRlcnZhbC5kYXRhLmRyYXdBc01hdGVzICYmIGludGVydmFsLmRhdGEubWF0ZSkgeyBibG9ja1NldHMucHVzaChpbnRlcnZhbC5kYXRhLm1hdGUuYmxvY2tzKTsgfVxuICAgICAgXy5lYWNoKGJsb2NrU2V0cywgZnVuY3Rpb24oYmxvY2tzKSB7XG4gICAgICAgIF8uZWFjaChibG9ja3MsIGZ1bmN0aW9uKGJsb2NrKSB7XG4gICAgICAgICAgdmFyIG50LCBpO1xuICAgICAgICAgIGZvciAoaSA9IE1hdGgubWF4KGJsb2NrLnN0YXJ0LCBzdGFydCk7IGkgPCBNYXRoLm1pbihibG9jay5lbmQsIGVuZCk7IGkrKykge1xuICAgICAgICAgICAgaWYgKCFwb3NpdGlvbnNUb0NhbGN1bGF0ZVtpXSkgeyBjb250aW51ZTsgfVxuICAgICAgICAgICAgbnQgPSAoYmxvY2suc2VxW2kgLSBibG9jay5zdGFydF0gfHwgJycpLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICBwaWxldXBbaV0gPSBwaWxldXBbaV0gfHwge0E6IDAsIEM6IDAsIEc6IDAsIFQ6IDAsIE46IDAsIGNvdjogMH07XG4gICAgICAgICAgICBpZiAoL1tBQ1RHTl0vLnRlc3QobnQpKSB7IHBpbGV1cFtpXVtudF0gKz0gMTsgfVxuICAgICAgICAgICAgcGlsZXVwW2ldLmNvdiArPSAxO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcbiAgXG4gIGNvdmVyYWdlOiBmdW5jdGlvbihzdGFydCwgd2lkdGgsIGJwcHApIHtcbiAgICAvLyBDb21wYXJlIHdpdGggYmlubmluZyBvbiB0aGUgZmx5IGluIC50eXBlKCd3aWdnbGVfMCcpLnByZXJlbmRlciguLi4pXG4gICAgdmFyIGogPSBzdGFydCxcbiAgICAgIHZTY2FsZSA9IHRoaXMuZGF0YS5pbmZvLm1lYW5JdGVtc1BlckJwICogdGhpcy5kYXRhLmluZm8ubWVhbkl0ZW1MZW5ndGggKiAyLFxuICAgICAgY3VyciA9IHRoaXMuZGF0YS5waWxldXBbal0sXG4gICAgICBiYXJzID0gW10sXG4gICAgICBuZXh0LCBiaW4sIGk7XG4gICAgZm9yIChpID0gMDsgaSA8IHdpZHRoOyBpKyspIHtcbiAgICAgIGJpbiA9IGN1cnIgJiYgKGogKyAxID49IGkgKiBicHBwICsgc3RhcnQpID8gW2N1cnIuY292XSA6IFtdO1xuICAgICAgbmV4dCA9IHRoaXMuZGF0YS5waWxldXBbaiArIDFdO1xuICAgICAgd2hpbGUgKGogKyAxIDwgKGkgKyAxKSAqIGJwcHAgKyBzdGFydCAmJiBqICsgMiA+PSBpICogYnBwcCArIHN0YXJ0KSB7IFxuICAgICAgICBpZiAobmV4dCkgeyBiaW4ucHVzaChuZXh0LmNvdik7IH1cbiAgICAgICAgKytqO1xuICAgICAgICBjdXJyID0gbmV4dDtcbiAgICAgICAgbmV4dCA9IHRoaXMuZGF0YS5waWxldXBbaiArIDFdO1xuICAgICAgfVxuICAgICAgYmFycy5wdXNoKHV0aWxzLndpZ0JpbkZ1bmN0aW9ucy5tYXhpbXVtKGJpbikgLyB2U2NhbGUpO1xuICAgIH1cbiAgICByZXR1cm4gYmFycztcbiAgfSxcbiAgXG4gIGFsbGVsZXM6IGZ1bmN0aW9uKHN0YXJ0LCBzZXF1ZW5jZSwgYnBwcCkge1xuICAgIHZhciBwaWxldXAgPSB0aGlzLmRhdGEucGlsZXVwLFxuICAgICAgdlNjYWxlID0gdGhpcy5kYXRhLmluZm8ubWVhbkl0ZW1zUGVyQnAgKiB0aGlzLmRhdGEuaW5mby5tZWFuSXRlbUxlbmd0aCAqIDIsXG4gICAgICBhbGxlbGVGcmVxVGhyZXNob2xkID0gdGhpcy5vcHRzLmFsbGVsZUZyZXFUaHJlc2hvbGQsXG4gICAgICBhbGxlbGVTcGxpdHMgPSBbXSxcbiAgICAgIHNwbGl0LCByZWZOdCwgaSwgcGlsZXVwQXRQb3M7XG4gICAgICBcbiAgICBmb3IgKGkgPSAwOyBpIDwgc2VxdWVuY2UubGVuZ3RoOyBpKyspIHtcbiAgICAgIHJlZk50ID0gc2VxdWVuY2VbaV0udG9VcHBlckNhc2UoKTtcbiAgICAgIHBpbGV1cEF0UG9zID0gcGlsZXVwW3N0YXJ0ICsgaV07XG4gICAgICBpZiAocGlsZXVwQXRQb3MgJiYgcGlsZXVwQXRQb3MuY292ICYmIHBpbGV1cEF0UG9zW3JlZk50XSAvIHBpbGV1cEF0UG9zLmNvdiA8ICgxIC0gYWxsZWxlRnJlcVRocmVzaG9sZCkpIHtcbiAgICAgICAgc3BsaXQgPSB7XG4gICAgICAgICAgeDogaSAvIGJwcHAsXG4gICAgICAgICAgc3BsaXRzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBfLmVhY2goWydBJywgJ0MnLCAnRycsICdUJ10sIGZ1bmN0aW9uKG50KSB7XG4gICAgICAgICAgaWYgKHBpbGV1cEF0UG9zW250XSA+IDApIHsgc3BsaXQuc3BsaXRzLnB1c2goe250OiBudCwgaDogcGlsZXVwQXRQb3NbbnRdIC8gdlNjYWxlfSk7IH1cbiAgICAgICAgfSk7XG4gICAgICAgIGFsbGVsZVNwbGl0cy5wdXNoKHNwbGl0KTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGFsbGVsZVNwbGl0cztcbiAgfSxcbiAgXG4gIG1pc21hdGNoZXM6IGZ1bmN0aW9uKHN0YXJ0LCBzZXF1ZW5jZSwgYnBwcCwgaW50ZXJ2YWxzLCB3aWR0aCwgbGluZU51bSwgdmlld0FzUGFpcnMpIHtcbiAgICB2YXIgbWlzbWF0Y2hlcyA9IFtdLFxuICAgICAgdmlld0FzUGFpcnMgPSB0aGlzLm9wdHMudmlld0FzUGFpcnM7XG4gICAgc2VxdWVuY2UgPSBzZXF1ZW5jZS50b1VwcGVyQ2FzZSgpO1xuICAgIF8uZWFjaChpbnRlcnZhbHMsIGZ1bmN0aW9uKGludGVydmFsKSB7XG4gICAgICB2YXIgYmxvY2tTZXRzID0gW2ludGVydmFsLmRhdGEuYmxvY2tzXTtcbiAgICAgIGlmICh2aWV3QXNQYWlycyAmJiBpbnRlcnZhbC5kYXRhLmRyYXdBc01hdGVzICYmIGludGVydmFsLmRhdGEubWF0ZSkgeyBcbiAgICAgICAgYmxvY2tTZXRzLnB1c2goaW50ZXJ2YWwuZGF0YS5tYXRlLmJsb2Nrcyk7XG4gICAgICB9XG4gICAgICBfLmVhY2goYmxvY2tTZXRzLCBmdW5jdGlvbihibG9ja3MpIHtcbiAgICAgICAgXy5lYWNoKGJsb2NrcywgZnVuY3Rpb24oYmxvY2spIHtcbiAgICAgICAgICB2YXIgbGluZSA9IGxpbmVOdW0oaW50ZXJ2YWwuZGF0YSksXG4gICAgICAgICAgICBudCwgaSwgeDtcbiAgICAgICAgICBmb3IgKGkgPSBNYXRoLm1heChibG9jay5zdGFydCwgc3RhcnQpOyBpIDwgTWF0aC5taW4oYmxvY2suZW5kLCBzdGFydCArIHdpZHRoICogYnBwcCk7IGkrKykge1xuICAgICAgICAgICAgeCA9IChpIC0gc3RhcnQpIC8gYnBwcDtcbiAgICAgICAgICAgIG50ID0gKGJsb2NrLnNlcVtpIC0gYmxvY2suc3RhcnRdIHx8ICcnKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgaWYgKG50ICYmIG50ICE9IHNlcXVlbmNlW2kgLSBzdGFydF0gJiYgbGluZSkgeyBtaXNtYXRjaGVzLnB1c2goe3g6IHgsIG50OiBudCwgbGluZTogbGluZX0pOyB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiBtaXNtYXRjaGVzO1xuICB9LFxuXG4gIHByZXJlbmRlcjogZnVuY3Rpb24oc3RhcnQsIGVuZCwgZGVuc2l0eSwgcHJlY2FsYywgY2FsbGJhY2spIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICB3aWR0aCA9IHByZWNhbGMud2lkdGgsXG4gICAgICBzZXF1ZW5jZSA9IHByZWNhbGMuc2VxdWVuY2UsXG4gICAgICBkYXRhID0gc2VsZi5kYXRhLFxuICAgICAgdmlld0FzUGFpcnMgPSBzZWxmLm9wdHMudmlld0FzUGFpcnMsXG4gICAgICBzdGFydEtleSA9IHZpZXdBc1BhaXJzID8gJ3RlbXBsYXRlU3RhcnQnIDogJ3N0YXJ0JyxcbiAgICAgIGVuZEtleSA9IHZpZXdBc1BhaXJzID8gJ3RlbXBsYXRlRW5kJyA6ICdlbmQnLFxuICAgICAgYnBwcCA9IChlbmQgLSBzdGFydCkgLyB3aWR0aDtcbiAgICBcbiAgICBmdW5jdGlvbiBsaW5lTnVtKGQsIHNldFRvKSB7XG4gICAgICB2YXIga2V5ID0gYnBwcCArICdfJyArIGRlbnNpdHkgKyAnXycgKyAodmlld0FzUGFpcnMgPyAncCcgOiAndScpO1xuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHNldFRvKSkgeyBcbiAgICAgICAgaWYgKCFkLmxpbmUpIHsgZC5saW5lID0ge307IH1cbiAgICAgICAgcmV0dXJuIChkLmxpbmVba2V5XSA9IHNldFRvKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkLmxpbmUgJiYgZC5saW5lW2tleV07IFxuICAgIH1cbiAgICBcbiAgICAvLyBEb24ndCBldmVuIGF0dGVtcHQgdG8gZmV0Y2ggdGhlIGRhdGEgaWYgd2UgY2FuIHJlYXNvbmFibHkgZXN0aW1hdGUgdGhhdCB3ZSB3aWxsIGZldGNoIGFuIGluc2FuZSBhbW91bnQgb2Ygcm93cyBcbiAgICAvLyAoPjUwMCBhbGlnbm1lbnRzKSwgYXMgdGhpcyB3aWxsIG9ubHkgaG9sZCB1cCBvdGhlciByZXF1ZXN0cy5cbiAgICBpZiAoc2VsZi5vcHRzLm1heEZldGNoV2luZG93ICYmIChlbmQgLSBzdGFydCkgPiBzZWxmLm9wdHMubWF4RmV0Y2hXaW5kb3cpIHtcbiAgICAgIGNhbGxiYWNrKHt0b29NYW55OiB0cnVlfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZldGNoIGZyb20gdGhlIFJlbW90ZVRyYWNrIGFuZCBjYWxsIHRoZSBhYm92ZSB3aGVuIHRoZSBkYXRhIGlzIGF2YWlsYWJsZS5cbiAgICAgIHNlbGYuZGF0YS5yZW1vdGUuZmV0Y2hBc3luYyhzdGFydCwgZW5kLCB2aWV3QXNQYWlycywgZnVuY3Rpb24oaW50ZXJ2YWxzKSB7XG4gICAgICAgIHZhciBkcmF3U3BlYyA9IHtzZXF1ZW5jZTogISFzZXF1ZW5jZSwgd2lkdGg6IHdpZHRofSxcbiAgICAgICAgICBjYWxjUGl4SW50ZXJ2YWxNYXRlZCA9IG5ldyB1dGlscy5waXhJbnRlcnZhbENhbGN1bGF0b3Ioc3RhcnQsIHdpZHRoLCBicHBwLCA0LCBmYWxzZSwgc3RhcnRLZXksIGVuZEtleSksXG4gICAgICAgICAgY2FsY1BpeEludGVydmFsID0gbmV3IHV0aWxzLnBpeEludGVydmFsQ2FsY3VsYXRvcihzdGFydCwgd2lkdGgsIGJwcHAsIDQpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGludGVydmFscy50b29NYW55KSB7IHJldHVybiBjYWxsYmFjayhpbnRlcnZhbHMpOyB9XG5cbiAgICAgICAgaWYgKCFzZXF1ZW5jZSkge1xuICAgICAgICAgIC8vIEZpcnN0IGRyYXdpbmcgcGFzcywgd2l0aCBmZWF0dXJlcyB0aGF0IGRvbid0IGRlcGVuZCBvbiBzZXF1ZW5jZS5cbiAgICAgICAgICBzZWxmLnR5cGUoJ2JhbScpLnBpbGV1cC5jYWxsKHNlbGYsIGludGVydmFscywgc3RhcnQsIGVuZCk7XG4gICAgICAgICAgZHJhd1NwZWMubGF5b3V0ID0gc2VsZi50eXBlKCdiZWQnKS5zdGFja2VkTGF5b3V0LmNhbGwoc2VsZiwgaW50ZXJ2YWxzLCB3aWR0aCwgY2FsY1BpeEludGVydmFsTWF0ZWQsIGxpbmVOdW0pO1xuICAgICAgICAgIF8uZWFjaChkcmF3U3BlYy5sYXlvdXQsIGZ1bmN0aW9uKGxpbmVzKSB7XG4gICAgICAgICAgICBfLmVhY2gobGluZXMsIGZ1bmN0aW9uKGludGVydmFsKSB7XG4gICAgICAgICAgICAgIGludGVydmFsLmluc2VydGlvblB0cyA9IF8ubWFwKGludGVydmFsLmQuaW5zZXJ0aW9ucywgY2FsY1BpeEludGVydmFsKTtcbiAgICAgICAgICAgICAgaWYgKCF2aWV3QXNQYWlycykgeyByZXR1cm47IH1cbiAgICAgICAgICAgICAgaWYgKGludGVydmFsLmQuZHJhd0FzTWF0ZXMgJiYgaW50ZXJ2YWwuZC5tYXRlKSB7XG4gICAgICAgICAgICAgICAgaW50ZXJ2YWwubWF0ZUludHMgPSBfLm1hcChbaW50ZXJ2YWwuZCwgaW50ZXJ2YWwuZC5tYXRlXSwgY2FsY1BpeEludGVydmFsKTtcbiAgICAgICAgICAgICAgICBpbnRlcnZhbC5tYXRlQmxvY2tJbnRzID0gXy5tYXAoaW50ZXJ2YWwuZC5tYXRlLmJsb2NrcywgY2FsY1BpeEludGVydmFsKTtcbiAgICAgICAgICAgICAgICBpbnRlcnZhbC5tYXRlSW5zZXJ0aW9uUHRzID0gXy5tYXAoaW50ZXJ2YWwuZC5tYXRlLmluc2VydGlvblB0cywgY2FsY1BpeEludGVydmFsKTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbnRlcnZhbC5kLm1hdGVFeHBlY3RlZCkge1xuICAgICAgICAgICAgICAgIGludGVydmFsLm1hdGVJbnRzID0gW2NhbGNQaXhJbnRlcnZhbChpbnRlcnZhbCldO1xuICAgICAgICAgICAgICAgIGludGVydmFsLm1hdGVCbG9ja0ludHMgPSBbXTtcbiAgICAgICAgICAgICAgICBpbnRlcnZhbC5tYXRlSW5zZXJ0aW9uUHRzID0gW107XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGRyYXdTcGVjLmNvdmVyYWdlID0gc2VsZi50eXBlKCdiYW0nKS5jb3ZlcmFnZS5jYWxsKHNlbGYsIHN0YXJ0LCB3aWR0aCwgYnBwcCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gU2Vjb25kIGRyYXdpbmcgcGFzcywgdG8gZHJhdyB0aGluZ3MgdGhhdCBhcmUgZGVwZW5kZW50IG9uIHNlcXVlbmNlLCBsaWtlIG1pc21hdGNoZXMgKHBvdGVudGlhbCBTTlBzKS5cbiAgICAgICAgICBkcmF3U3BlYy5icHBwID0gYnBwcDsgIFxuICAgICAgICAgIC8vIEZpbmQgYWxsZWxlIHNwbGl0cyB3aXRoaW4gdGhlIGNvdmVyYWdlIGdyYXBoLlxuICAgICAgICAgIGRyYXdTcGVjLmFsbGVsZXMgPSBzZWxmLnR5cGUoJ2JhbScpLmFsbGVsZXMuY2FsbChzZWxmLCBzdGFydCwgc2VxdWVuY2UsIGJwcHApO1xuICAgICAgICAgIC8vIEZpbmQgbWlzbWF0Y2hlcyB3aXRoaW4gZWFjaCBhbGlnbmVkIGJsb2NrLlxuICAgICAgICAgIGRyYXdTcGVjLm1pc21hdGNoZXMgPSBzZWxmLnR5cGUoJ2JhbScpLm1pc21hdGNoZXMuY2FsbChzZWxmLCBzdGFydCwgc2VxdWVuY2UsIGJwcHAsIGludGVydmFscywgd2lkdGgsIGxpbmVOdW0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjYWxsYmFjayhkcmF3U3BlYyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIFxuICAvLyBzcGVjaWFsIGZvcm1hdHRlciBmb3IgY29udGVudCBpbiB0b29sdGlwcyBmb3IgZmVhdHVyZXNcbiAgdGlwVGlwRGF0YTogZnVuY3Rpb24oZGF0YSkge1xuICAgIHZhciBvID0gdGhpcy5vcHRzLFxuICAgICAgY29udGVudCA9IHt9LFxuICAgICAgZmlyc3RNYXRlID0gZGF0YS5kLFxuICAgICAgc2Vjb25kTWF0ZSA9IGRhdGEuZC5tYXRlLFxuICAgICAgbWF0ZUhlYWRlcnMgPSBbXCJ0aGlzIGFsaWdubWVudFwiLCBcIm1hdGUgcGFpciBhbGlnbm1lbnRcIl0sXG4gICAgICBsZWZ0TWF0ZSwgcmlnaHRNYXRlLCBwYWlyT3JpZW50YXRpb247XG4gICAgZnVuY3Rpb24geWVzTm8oYm9vbCkgeyByZXR1cm4gYm9vbCA/IFwieWVzXCIgOiBcIm5vXCI7IH1cbiAgICBmdW5jdGlvbiBhZGRBbGlnbmVkU2VnbWVudEluZm8oY29udGVudCwgc2VnLCBwcmVmaXgpIHtcbiAgICAgIHByZWZpeCA9IHByZWZpeCB8fCBcIlwiO1xuICAgICAgXy5lYWNoKHtcbiAgICAgICAgXCJwb3NpdGlvblwiOiBzZWcucm5hbWUgKyAnOicgKyBzZWcucG9zLFxuICAgICAgICBcImNpZ2FyXCI6IHNlZy5jaWdhcixcbiAgICAgICAgXCJyZWFkIHN0cmFuZFwiOiBzZWcuZmxhZ3MucmVhZFN0cmFuZFJldmVyc2UgPyAnKC0pJyA6ICcoKyknLFxuICAgICAgICBcIm1hcHBlZFwiOiB5ZXNObyghc2VnLmZsYWdzLmlzUmVhZFVubWFwcGVkKSxcbiAgICAgICAgXCJtYXAgcXVhbGl0eVwiOiBzZWcubWFwcSxcbiAgICAgICAgXCJzZWNvbmRhcnlcIjogeWVzTm8oc2VnLmZsYWdzLmlzU2Vjb25kYXJ5QWxpZ25tZW50KSxcbiAgICAgICAgXCJzdXBwbGVtZW50YXJ5XCI6IHllc05vKHNlZy5mbGFncy5pc1N1cHBsZW1lbnRhcnlBbGlnbm1lbnQpLFxuICAgICAgICBcImR1cGxpY2F0ZVwiOiB5ZXNObyhzZWcuZmxhZ3MuaXNEdXBsaWNhdGVSZWFkKSxcbiAgICAgICAgXCJmYWlsZWQgUUNcIjogeWVzTm8oc2VnLmZsYWdzLmlzUmVhZEZhaWxpbmdWZW5kb3JRQylcbiAgICAgIH0sIGZ1bmN0aW9uKHYsIGspIHsgY29udGVudFtwcmVmaXggKyBrXSA9IHY7IH0pO1xuICAgIH1cbiAgICBcbiAgICBpZiAoZGF0YS5kLm1hdGUgJiYgZGF0YS5kLm1hdGUuZmxhZ3MpIHtcbiAgICAgIGxlZnRNYXRlID0gZGF0YS5kLnN0YXJ0IDwgZGF0YS5kLm1hdGUuc3RhcnQgPyBkYXRhLmQgOiBkYXRhLmQubWF0ZTtcbiAgICAgIHJpZ2h0TWF0ZSA9IGRhdGEuZC5zdGFydCA8IGRhdGEuZC5tYXRlLnN0YXJ0ID8gZGF0YS5kLm1hdGUgOiBkYXRhLmQ7XG4gICAgICBwYWlyT3JpZW50YXRpb24gPSAobGVmdE1hdGUuZmxhZ3MucmVhZFN0cmFuZFJldmVyc2UgPyBcIlJcIiA6IFwiRlwiKSArIChsZWZ0TWF0ZS5mbGFncy5pc1JlYWRGaXJzdE9mUGFpciA/IFwiMVwiIDogXCIyXCIpO1xuICAgICAgcGFpck9yaWVudGF0aW9uICs9IChyaWdodE1hdGUuZmxhZ3MucmVhZFN0cmFuZFJldmVyc2UgPyBcIlJcIiA6IFwiRlwiKSArIChyaWdodE1hdGUuZmxhZ3MuaXNSZWFkTGFzdE9mUGFpciA/IFwiMlwiIDogXCIxXCIpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoby52aWV3QXNQYWlycyAmJiBkYXRhLmQuZHJhd0FzTWF0ZXMgJiYgZGF0YS5kLm1hdGUpIHtcbiAgICAgIGZpcnN0TWF0ZSA9IGxlZnRNYXRlO1xuICAgICAgc2Vjb25kTWF0ZSA9IHJpZ2h0TWF0ZTtcbiAgICAgIG1hdGVIZWFkZXJzID0gW1wibGVmdCBhbGlnbm1lbnRcIiwgXCJyaWdodCBhbGlnbm1lbnRcIl07XG4gICAgfVxuICAgIGlmIChzZWNvbmRNYXRlKSB7XG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQoZGF0YS5kLmluc2VydFNpemUpKSB7IGNvbnRlbnRbXCJpbnNlcnQgc2l6ZVwiXSA9IGRhdGEuZC5pbnNlcnRTaXplOyB9XG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQocGFpck9yaWVudGF0aW9uKSkgeyBjb250ZW50W1wicGFpciBvcmllbnRhdGlvblwiXSA9IHBhaXJPcmllbnRhdGlvbjsgfVxuICAgICAgY29udGVudFttYXRlSGVhZGVyc1swXV0gPSBcIi0tLVwiO1xuICAgICAgYWRkQWxpZ25lZFNlZ21lbnRJbmZvKGNvbnRlbnQsIGZpcnN0TWF0ZSk7XG4gICAgICBjb250ZW50W21hdGVIZWFkZXJzWzFdXSA9IFwiLS0tXCI7XG4gICAgICBhZGRBbGlnbmVkU2VnbWVudEluZm8oY29udGVudCwgc2Vjb25kTWF0ZSwgXCIgXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhZGRBbGlnbmVkU2VnbWVudEluZm8oY29udGVudCwgZGF0YS5kKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGNvbnRlbnQ7XG4gIH0sXG4gIFxuICAvLyBTZWUgaHR0cHM6Ly93d3cuYnJvYWRpbnN0aXR1dGUub3JnL2lndi9BbGlnbm1lbnREYXRhI2NvdmVyYWdlIGZvciBhbiBpZGVhIG9mIHdoYXQgd2UncmUgaW1pdGF0aW5nXG4gIGRyYXdDb3ZlcmFnZTogZnVuY3Rpb24oY3R4LCBjb3ZlcmFnZSwgaGVpZ2h0KSB7XG4gICAgXy5lYWNoKGNvdmVyYWdlLCBmdW5jdGlvbihkLCB4KSB7XG4gICAgICBpZiAoZCA9PT0gbnVsbCkgeyByZXR1cm47IH1cbiAgICAgIGN0eC5maWxsUmVjdCh4LCBNYXRoLm1heChoZWlnaHQgLSAoZCAqIGhlaWdodCksIDApLCAxLCBNYXRoLm1pbihkICogaGVpZ2h0LCBoZWlnaHQpKTtcbiAgICB9KTtcbiAgfSxcbiAgXG4gIGRyYXdTdHJhbmRJbmRpY2F0b3I6IGZ1bmN0aW9uKGN0eCwgeCwgYmxvY2tZLCBibG9ja0hlaWdodCwgeFNjYWxlLCBiaWdTdHlsZSkge1xuICAgIHZhciBwcmV2RmlsbFN0eWxlID0gY3R4LmZpbGxTdHlsZTtcbiAgICBpZiAoYmlnU3R5bGUpIHtcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgIGN0eC5tb3ZlVG8oeCAtICgyICogeFNjYWxlKSwgYmxvY2tZKTtcbiAgICAgIGN0eC5saW5lVG8oeCArICgzICogeFNjYWxlKSwgYmxvY2tZICsgYmxvY2tIZWlnaHQvMik7XG4gICAgICBjdHgubGluZVRvKHggLSAoMiAqIHhTY2FsZSksIGJsb2NrWSArIGJsb2NrSGVpZ2h0KTtcbiAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgIGN0eC5maWxsKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiKDE0MCwxNDAsMTQwKSc7XG4gICAgICBjdHguZmlsbFJlY3QoeCArICh4U2NhbGUgPiAwID8gLTIgOiAxKSwgYmxvY2tZLCAxLCBibG9ja0hlaWdodCk7XG4gICAgICBjdHguZmlsbFJlY3QoeCArICh4U2NhbGUgPiAwID8gLTEgOiAwKSwgYmxvY2tZICsgMSwgMSwgYmxvY2tIZWlnaHQgLSAyKTtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBwcmV2RmlsbFN0eWxlO1xuICAgIH1cbiAgfSxcbiAgXG4gIGRyYXdBbGlnbm1lbnQ6IGZ1bmN0aW9uKGN0eCwgd2lkdGgsIGRhdGEsIGksIGxpbmVIZWlnaHQpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBkcmF3TWF0ZXMgPSBkYXRhLm1hdGVJbnRzLFxuICAgICAgY29sb3IgPSBzZWxmLm9wdHMuY29sb3IsXG4gICAgICBsaW5lR2FwID0gbGluZUhlaWdodCA+IDYgPyAyIDogMCxcbiAgICAgIGJsb2NrWSA9IGkgKiBsaW5lSGVpZ2h0ICsgbGluZUdhcC8yLFxuICAgICAgYmxvY2tIZWlnaHQgPSBsaW5lSGVpZ2h0IC0gbGluZUdhcCxcbiAgICAgIGRlbGV0aW9uTGluZVdpZHRoID0gMixcbiAgICAgIGluc2VydGlvbkNhcmV0TGluZVdpZHRoID0gbGluZUhlaWdodCA+IDYgPyAyIDogMSxcbiAgICAgIGhhbGZIZWlnaHQgPSBNYXRoLnJvdW5kKDAuNSAqIGxpbmVIZWlnaHQpIC0gZGVsZXRpb25MaW5lV2lkdGggKiAwLjUsXG4gICAgICBibG9ja1NldHMgPSBbe2Jsb2NrSW50czogZGF0YS5ibG9ja0ludHMsIHN0cmFuZDogZGF0YS5kLnN0cmFuZH1dO1xuICAgIFxuICAgIC8vIEZvciBtYXRlIHBhaXJzLCB0aGUgZnVsbCBwaXhlbCBpbnRlcnZhbCByZXByZXNlbnRzIHRoZSBsaW5lIGxpbmtpbmcgdGhlIG1hdGVzXG4gICAgaWYgKGRyYXdNYXRlcykge1xuICAgICAgY3R4LmZpbGxTdHlsZSA9IGN0eC5zdHJva2VTdHlsZSA9IFwicmdiKFwiICsgY29sb3IgKyBcIilcIjtcbiAgICAgIGN0eC5maWxsUmVjdChkYXRhLnBJbnQueCwgaSAqIGxpbmVIZWlnaHQgKyBoYWxmSGVpZ2h0LCBkYXRhLnBJbnQudywgZGVsZXRpb25MaW5lV2lkdGgpO1xuICAgIH1cbiAgICBcbiAgICAvLyBEcmF3IHRoZSBsaW5lcyB0aGF0IHNob3cgdGhlIGZ1bGwgYWxpZ25tZW50IGZvciBlYWNoIHNlZ21lbnQsIGluY2x1ZGluZyBkZWxldGlvbnNcbiAgICBjdHguZmlsbFN0eWxlID0gY3R4LnN0cm9rZVN0eWxlID0gJ3JnYigwLDAsMCknO1xuICAgIF8uZWFjaChkcmF3TWF0ZXMgfHwgW2RhdGEucEludF0sIGZ1bmN0aW9uKHBJbnQpIHtcbiAgICAgIGlmIChwSW50LncgPD0gMCkgeyByZXR1cm47IH1cbiAgICAgIC8vIE5vdGUgdGhhdCB0aGUgXCItIDFcIiBiZWxvdyBmaXhlcyByb3VuZGluZyBpc3N1ZXMgYnV0IGdhbWJsZXMgb24gdGhlcmUgbmV2ZXIgYmVpbmcgYSBkZWxldGlvbiBhdCB0aGUgcmlnaHQgZWRnZVxuICAgICAgY3R4LmZpbGxSZWN0KHBJbnQueCwgaSAqIGxpbmVIZWlnaHQgKyBoYWxmSGVpZ2h0LCBwSW50LncgLSAxLCBkZWxldGlvbkxpbmVXaWR0aCk7XG4gICAgfSk7XG4gICAgXG4gICAgLy8gRmlyc3QsIGRldGVybWluZSBhbmQgc2V0IHRoZSBjb2xvciB3ZSB3aWxsIGJlIHVzaW5nXG4gICAgLy8gTm90ZSB0aGF0IHRoZSBkZWZhdWx0IGNvbG9yIHdhcyBhbHJlYWR5IHNldCBpbiBkcmF3U3BlY1xuICAgIGlmIChzZWxmLm9wdHMuYWx0Q29sb3IgJiYgZGF0YS5kLnN0cmFuZCA9PSAnLScpIHsgY29sb3IgPSBzZWxmLm9wdHMuYWx0Q29sb3I7IH1cbiAgICBjdHguZmlsbFN0eWxlID0gY3R4LnN0cm9rZVN0eWxlID0gXCJyZ2IoXCIgKyBjb2xvciArIFwiKVwiO1xuICAgIFxuICAgIC8vIERyYXcgdGhlIFttaXNdbWF0Y2ggKE0vWC89KSBibG9ja3NcbiAgICBpZiAoZHJhd01hdGVzICYmIGRhdGEuZC5tYXRlKSB7IGJsb2NrU2V0cy5wdXNoKHtibG9ja0ludHM6IGRhdGEubWF0ZUJsb2NrSW50cywgc3RyYW5kOiBkYXRhLmQubWF0ZS5zdHJhbmR9KTsgfVxuICAgIF8uZWFjaChibG9ja1NldHMsIGZ1bmN0aW9uKGJsb2NrU2V0KSB7XG4gICAgICB2YXIgc3RyYW5kID0gYmxvY2tTZXQuc3RyYW5kO1xuICAgICAgXy5lYWNoKGJsb2NrU2V0LmJsb2NrSW50cywgZnVuY3Rpb24oYkludCwgYmxvY2tOdW0pIHtcbiAgICAgIFxuICAgICAgICAvLyBTa2lwIGRyYXdpbmcgYmxvY2tzIHRoYXQgYXJlbid0IGluc2lkZSB0aGUgY2FudmFzXG4gICAgICAgIGlmIChiSW50LnggKyBiSW50LncgPCAwIHx8IGJJbnQueCA+IHdpZHRoKSB7IHJldHVybjsgfVxuICAgICAgXG4gICAgICAgIGlmIChibG9ja051bSA9PSAwICYmIGJsb2NrU2V0LnN0cmFuZCA9PSAnLScgJiYgIWJJbnQub1ByZXYpIHtcbiAgICAgICAgICBjdHguZmlsbFJlY3QoYkludC54ICsgMiwgYmxvY2tZLCBiSW50LncgLSAyLCBibG9ja0hlaWdodCk7XG4gICAgICAgICAgc2VsZi50eXBlKCdiYW0nKS5kcmF3U3RyYW5kSW5kaWNhdG9yLmNhbGwoc2VsZiwgY3R4LCBiSW50LngsIGJsb2NrWSwgYmxvY2tIZWlnaHQsIC0xLCBsaW5lSGVpZ2h0ID4gNik7XG4gICAgICAgIH0gZWxzZSBpZiAoYmxvY2tOdW0gPT0gYmxvY2tTZXQuYmxvY2tJbnRzLmxlbmd0aCAtIDEgJiYgYmxvY2tTZXQuc3RyYW5kID09ICcrJyAmJiAhYkludC5vTmV4dCkge1xuICAgICAgICAgIGN0eC5maWxsUmVjdChiSW50LngsIGJsb2NrWSwgYkludC53IC0gMiwgYmxvY2tIZWlnaHQpO1xuICAgICAgICAgIHNlbGYudHlwZSgnYmFtJykuZHJhd1N0cmFuZEluZGljYXRvci5jYWxsKHNlbGYsIGN0eCwgYkludC54ICsgYkludC53LCBibG9ja1ksIGJsb2NrSGVpZ2h0LCAxLCBsaW5lSGVpZ2h0ID4gNik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3R4LmZpbGxSZWN0KGJJbnQueCwgYmxvY2tZLCBiSW50LncsIGJsb2NrSGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgXG4gICAgLy8gRHJhdyBpbnNlcnRpb25zXG4gICAgY3R4LmZpbGxTdHlsZSA9IGN0eC5zdHJva2VTdHlsZSA9IFwicmdiKDExNCw0MSwyMTgpXCI7XG4gICAgXy5lYWNoKGRyYXdNYXRlcyA/IFtkYXRhLmluc2VydGlvblB0cywgZGF0YS5tYXRlSW5zZXJ0aW9uUHRzXSA6IFtkYXRhLmluc2VydGlvblB0c10sIGZ1bmN0aW9uKGluc2VydGlvblB0cykge1xuICAgICAgXy5lYWNoKGluc2VydGlvblB0cywgZnVuY3Rpb24oaW5zZXJ0KSB7XG4gICAgICAgIGlmIChpbnNlcnQueCArIGluc2VydC53IDwgMCB8fCBpbnNlcnQueCA+IHdpZHRoKSB7IHJldHVybjsgfVxuICAgICAgICBjdHguZmlsbFJlY3QoaW5zZXJ0LnggLSAxLCBpICogbGluZUhlaWdodCwgMiwgbGluZUhlaWdodCk7XG4gICAgICAgIGN0eC5maWxsUmVjdChpbnNlcnQueCAtIDIsIGkgKiBsaW5lSGVpZ2h0LCA0LCBpbnNlcnRpb25DYXJldExpbmVXaWR0aCk7XG4gICAgICAgIGN0eC5maWxsUmVjdChpbnNlcnQueCAtIDIsIChpICsgMSkgKiBsaW5lSGVpZ2h0IC0gaW5zZXJ0aW9uQ2FyZXRMaW5lV2lkdGgsIDQsIGluc2VydGlvbkNhcmV0TGluZVdpZHRoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LFxuICBcbiAgZHJhd0FsbGVsZXM6IGZ1bmN0aW9uKGN0eCwgYWxsZWxlcywgaGVpZ2h0LCBiYXJXaWR0aCkge1xuICAgIC8vIFNhbWUgY29sb3JzIGFzICQudWkuZ2Vub3RyYWNrLl9udFNlcXVlbmNlTG9hZCguLi4pIGJ1dCBjb3VsZCBiZSBjb25maWd1cmFibGU/XG4gICAgdmFyIGNvbG9ycyA9IHtBOiAnMjU1LDAsMCcsIFQ6ICcyNTUsMCwyNTUnLCBDOiAnMCwwLDI1NScsIEc6ICcwLDE4MCwwJ30sXG4gICAgICB5UG9zO1xuICAgIF8uZWFjaChhbGxlbGVzLCBmdW5jdGlvbihhbGxlbGVzRm9yUG9zaXRpb24pIHtcbiAgICAgIHlQb3MgPSBoZWlnaHQ7XG4gICAgICBfLmVhY2goYWxsZWxlc0ZvclBvc2l0aW9uLnNwbGl0cywgZnVuY3Rpb24oc3BsaXQpIHtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2IoJytjb2xvcnNbc3BsaXQubnRdKycpJztcbiAgICAgICAgY3R4LmZpbGxSZWN0KGFsbGVsZXNGb3JQb3NpdGlvbi54LCB5UG9zIC09IChzcGxpdC5oICogaGVpZ2h0KSwgTWF0aC5tYXgoYmFyV2lkdGgsIDEpLCBzcGxpdC5oICogaGVpZ2h0KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LFxuICBcbiAgZHJhd01pc21hdGNoOiBmdW5jdGlvbihjdHgsIG1pc21hdGNoLCBsaW5lT2Zmc2V0LCBsaW5lSGVpZ2h0LCBwcGJwKSB7XG4gICAgLy8gcHBicCA9PSBwaXhlbHMgcGVyIGJhc2UgcGFpciAoaW52ZXJzZSBvZiBicHBwKVxuICAgIC8vIFNhbWUgY29sb3JzIGFzICQudWkuZ2Vub3RyYWNrLl9udFNlcXVlbmNlTG9hZCguLi4pIGJ1dCBjb3VsZCBiZSBjb25maWd1cmFibGU/XG4gICAgdmFyIGNvbG9ycyA9IHtBOiAnMjU1LDAsMCcsIFQ6ICcyNTUsMCwyNTUnLCBDOiAnMCwwLDI1NScsIEc6ICcwLDE4MCwwJ30sXG4gICAgICBsaW5lR2FwID0gbGluZUhlaWdodCA+IDYgPyAyIDogMCxcbiAgICAgIHlQb3M7XG4gICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2IoJytjb2xvcnNbbWlzbWF0Y2gubnRdKycpJztcbiAgICBjdHguZmlsbFJlY3QobWlzbWF0Y2gueCwgKG1pc21hdGNoLmxpbmUgKyBsaW5lT2Zmc2V0KSAqIGxpbmVIZWlnaHQgKyBsaW5lR2FwIC8gMiwgTWF0aC5tYXgocHBicCwgMSksIGxpbmVIZWlnaHQgLSBsaW5lR2FwKTtcbiAgICAvLyBEbyB3ZSBoYXZlIHJvb20gdG8gcHJpbnQgYSB3aG9sZSBsZXR0ZXI/XG4gICAgaWYgKHBwYnAgPiA3ICYmIGxpbmVIZWlnaHQgPiAxMCkge1xuICAgICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2IoMjU1LDI1NSwyNTUpJztcbiAgICAgIGN0eC5maWxsVGV4dChtaXNtYXRjaC5udCwgbWlzbWF0Y2gueCArIHBwYnAgKiAwLjUsIChtaXNtYXRjaC5saW5lICsgbGluZU9mZnNldCArIDEpICogbGluZUhlaWdodCAtIGxpbmVHYXApO1xuICAgIH1cbiAgfSxcbiAgXG4gIGRyYXdTcGVjOiBmdW5jdGlvbihjYW52YXMsIGRyYXdTcGVjLCBkZW5zaXR5KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQgJiYgY2FudmFzLmdldENvbnRleHQoJzJkJyksXG4gICAgICB1cmxUZW1wbGF0ZSA9ICdqYXZhc2NyaXB0OnZvaWQoXCInK3NlbGYub3B0cy5uYW1lKyc6JCRcIiknLFxuICAgICAgZHJhd0xpbWl0ID0gc2VsZi5vcHRzLmRyYXdMaW1pdCAmJiBzZWxmLm9wdHMuZHJhd0xpbWl0W2RlbnNpdHldLFxuICAgICAgbGluZUhlaWdodCA9IGRlbnNpdHkgPT0gJ3BhY2snID8gMTQgOiA0LFxuICAgICAgY292SGVpZ2h0ID0gZGVuc2l0eSA9PSAnZGVuc2UnID8gMjQgOiAzOCxcbiAgICAgIGNvdk1hcmdpbiA9IDcsXG4gICAgICBsaW5lT2Zmc2V0ID0gKChjb3ZIZWlnaHQgKyBjb3ZNYXJnaW4pIC8gbGluZUhlaWdodCksIFxuICAgICAgY29sb3IgPSBzZWxmLm9wdHMuY29sb3IsXG4gICAgICBhcmVhcyA9IG51bGw7XG4gICAgICAgICAgICBcbiAgICBpZiAoIWN0eCkgeyB0aHJvdyBcIkNhbnZhcyBub3Qgc3VwcG9ydGVkXCI7IH1cbiAgICBcbiAgICBpZiAoIWRyYXdTcGVjLnNlcXVlbmNlKSB7XG4gICAgICAvLyBGaXJzdCBkcmF3aW5nIHBhc3MsIHdpdGggZmVhdHVyZXMgdGhhdCBkb24ndCBkZXBlbmQgb24gc2VxdWVuY2UuXG4gICAgICBcbiAgICAgIC8vIElmIG5lY2Vzc2FyeSwgaW5kaWNhdGUgdGhlcmUgd2FzIHRvbyBtdWNoIGRhdGEgdG8gbG9hZC9kcmF3IGFuZCB0aGF0IHRoZSB1c2VyIG5lZWRzIHRvIHpvb20gdG8gc2VlIG1vcmVcbiAgICAgIGlmIChkcmF3U3BlYy50b29NYW55IHx8IChkcmF3TGltaXQgJiYgZHJhd1NwZWMubGF5b3V0Lmxlbmd0aCA+IGRyYXdMaW1pdCkpIHsgXG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSAwO1xuICAgICAgICBjYW52YXMuY2xhc3NOYW1lID0gY2FudmFzLmNsYXNzTmFtZSArICcgdG9vLW1hbnknO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIE9ubHkgc3RvcmUgYXJlYXMgZm9yIHRoZSBcInBhY2tcIiBkZW5zaXR5LlxuICAgICAgLy8gV2UgaGF2ZSB0byBlbXB0eSB0aGlzIGZvciBldmVyeSByZW5kZXIsIGJlY2F1c2UgYXJlYXMgY2FuIGNoYW5nZSBpZiBCQU0gZGlzcGxheSBvcHRpb25zIGNoYW5nZS5cbiAgICAgIGlmIChkZW5zaXR5ID09ICdwYWNrJyAmJiAhc2VsZi5hcmVhc1tjYW52YXMuaWRdKSB7IGFyZWFzID0gc2VsZi5hcmVhc1tjYW52YXMuaWRdID0gW107IH1cbiAgICAgIC8vIFNldCB0aGUgZXhwZWN0ZWQgaGVpZ2h0IGZvciB0aGUgY2FudmFzICh0aGlzIGFsc28gZXJhc2VzIGl0KS5cbiAgICAgIGNhbnZhcy5oZWlnaHQgPSBjb3ZIZWlnaHQgKyAoKGRlbnNpdHkgPT0gJ2RlbnNlJykgPyAwIDogY292TWFyZ2luICsgZHJhd1NwZWMubGF5b3V0Lmxlbmd0aCAqIGxpbmVIZWlnaHQpO1xuICAgICAgXG4gICAgICAvLyBGaXJzdCBkcmF3IHRoZSBjb3ZlcmFnZSBncmFwaFxuICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiKDE1OSwxNTksMTU5KVwiO1xuICAgICAgc2VsZi50eXBlKCdiYW0nKS5kcmF3Q292ZXJhZ2UuY2FsbChzZWxmLCBjdHgsIGRyYXdTcGVjLmNvdmVyYWdlLCBjb3ZIZWlnaHQpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgLy8gTm93LCBkcmF3IGFsaWdubWVudHMgYmVsb3cgaXRcbiAgICAgIGlmIChkZW5zaXR5ICE9ICdkZW5zZScpIHtcbiAgICAgICAgLy8gQm9yZGVyIGJldHdlZW4gY292ZXJhZ2VcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiKDEwOSwxMDksMTA5KVwiO1xuICAgICAgICBjdHguZmlsbFJlY3QoMCwgY292SGVpZ2h0ICsgMSwgZHJhd1NwZWMud2lkdGgsIDEpOyBcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGN0eC5zdHJva2VTdHlsZSA9IFwicmdiKFwiK2NvbG9yK1wiKVwiO1xuICAgICAgICBcbiAgICAgICAgXy5lYWNoKGRyYXdTcGVjLmxheW91dCwgZnVuY3Rpb24obCwgaSkge1xuICAgICAgICAgIGkgKz0gbGluZU9mZnNldDsgLy8gaGFja2lzaCBtZXRob2QgZm9yIGxlYXZpbmcgc3BhY2UgYXQgdGhlIHRvcCBmb3IgdGhlIGNvdmVyYWdlIGdyYXBoXG4gICAgICAgICAgXy5lYWNoKGwsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIHNlbGYudHlwZSgnYmFtJykuZHJhd0FsaWdubWVudC5jYWxsKHNlbGYsIGN0eCwgZHJhd1NwZWMud2lkdGgsIGRhdGEsIGksIGxpbmVIZWlnaHQsIGRyYXdTcGVjLnZpZXdBc1BhaXJzKTtcbiAgICAgICAgICAgIHNlbGYudHlwZSgnYmVkJykuYWRkQXJlYS5jYWxsKHNlbGYsIGFyZWFzLCBkYXRhLCBpLCBsaW5lSGVpZ2h0LCB1cmxUZW1wbGF0ZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBTZWNvbmQgZHJhd2luZyBwYXNzLCB0byBkcmF3IHRoaW5ncyB0aGF0IGFyZSBkZXBlbmRlbnQgb24gc2VxdWVuY2U6XG4gICAgICAvLyAoMSkgYWxsZWxlIHNwbGl0cyBvdmVyIGNvdmVyYWdlXG4gICAgICBzZWxmLnR5cGUoJ2JhbScpLmRyYXdBbGxlbGVzLmNhbGwoc2VsZiwgY3R4LCBkcmF3U3BlYy5hbGxlbGVzLCBjb3ZIZWlnaHQsIDEgLyBkcmF3U3BlYy5icHBwKTtcbiAgICAgIC8vICgyKSBtaXNtYXRjaGVzIG92ZXIgdGhlIGFsaWdubWVudHNcbiAgICAgIGN0eC5mb250ID0gXCIxMnB4ICdNZW5sbycsJ0JpdHN0cmVhbSBWZXJhIFNhbnMgTW9ubycsJ0NvbnNvbGFzJywnTHVjaWRhIENvbnNvbGUnLG1vbm9zcGFjZVwiO1xuICAgICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInO1xuICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdiYXNlbGluZSc7XG4gICAgICBfLmVhY2goZHJhd1NwZWMubWlzbWF0Y2hlcywgZnVuY3Rpb24obWlzbWF0Y2gpIHtcbiAgICAgICAgc2VsZi50eXBlKCdiYW0nKS5kcmF3TWlzbWF0Y2guY2FsbChzZWxmLCBjdHgsIG1pc21hdGNoLCBsaW5lT2Zmc2V0LCBsaW5lSGVpZ2h0LCAxIC8gZHJhd1NwZWMuYnBwcCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKGNhbnZhcywgc3RhcnQsIGVuZCwgZGVuc2l0eSwgY2FsbGJhY2spIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5wcmVyZW5kZXIoc3RhcnQsIGVuZCwgZGVuc2l0eSwge3dpZHRoOiBjYW52YXMud2lkdGh9LCBmdW5jdGlvbihkcmF3U3BlYykge1xuICAgICAgdmFyIGNhbGxiYWNrS2V5ID0gc3RhcnQgKyAnLScgKyBlbmQgKyAnLScgKyBkZW5zaXR5O1xuICAgICAgc2VsZi50eXBlKCdiYW0nKS5kcmF3U3BlYy5jYWxsKHNlbGYsIGNhbnZhcywgZHJhd1NwZWMsIGRlbnNpdHkpO1xuICAgICAgXG4gICAgICAvLyBIYXZlIHdlIGJlZW4gd2FpdGluZyB0byBkcmF3IHNlcXVlbmNlIGRhdGEgdG9vPyBJZiBzbywgZG8gdGhhdCBub3csIHRvby5cbiAgICAgIGlmIChfLmlzRnVuY3Rpb24oc2VsZi5yZW5kZXJTZXF1ZW5jZUNhbGxiYWNrc1tjYWxsYmFja0tleV0pKSB7XG4gICAgICAgIHNlbGYucmVuZGVyU2VxdWVuY2VDYWxsYmFja3NbY2FsbGJhY2tLZXldKCk7XG4gICAgICAgIGRlbGV0ZSBzZWxmLnJlbmRlclNlcXVlbmNlQ2FsbGJhY2tzW2NhbGxiYWNrS2V5XTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKF8uaXNGdW5jdGlvbihjYWxsYmFjaykpIHsgY2FsbGJhY2soKTsgfVxuICAgIH0pO1xuICB9LFxuICBcbiAgcmVuZGVyU2VxdWVuY2U6IGZ1bmN0aW9uKGNhbnZhcywgc3RhcnQsIGVuZCwgZGVuc2l0eSwgc2VxdWVuY2UsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIFxuICAgIC8vIElmIHdlIHdlcmVuJ3QgYWJsZSB0byBmZXRjaCBzZXF1ZW5jZSBmb3Igc29tZSByZWFzb24sIHRoZXJlIGlzIG5vIHJlYXNvbiB0byBwcm9jZWVkLlxuICAgIGlmICghc2VxdWVuY2UpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICBmdW5jdGlvbiByZW5kZXJTZXF1ZW5jZUNhbGxiYWNrKCkge1xuICAgICAgc2VsZi5wcmVyZW5kZXIoc3RhcnQsIGVuZCwgZGVuc2l0eSwge3dpZHRoOiBjYW52YXMud2lkdGgsIHNlcXVlbmNlOiBzZXF1ZW5jZX0sIGZ1bmN0aW9uKGRyYXdTcGVjKSB7XG4gICAgICAgIHNlbGYudHlwZSgnYmFtJykuZHJhd1NwZWMuY2FsbChzZWxmLCBjYW52YXMsIGRyYXdTcGVjLCBkZW5zaXR5KTtcbiAgICAgICAgaWYgKF8uaXNGdW5jdGlvbihjYWxsYmFjaykpIHsgY2FsbGJhY2soKTsgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGlmIHRoZSBjYW52YXMgd2FzIGFscmVhZHkgcmVuZGVyZWQgKGJ5IGxhY2sgb2YgdGhlIGNsYXNzICd1bnJlbmRlcmVkJykuXG4gICAgLy8gSWYgeWVzLCBnbyBhaGVhZCBhbmQgZXhlY3V0ZSByZW5kZXJTZXF1ZW5jZUNhbGxiYWNrKCk7IGlmIG5vdCwgc2F2ZSBpdCBmb3IgbGF0ZXIuXG4gICAgaWYgKCgnICcgKyBjYW52YXMuY2xhc3NOYW1lICsgJyAnKS5pbmRleE9mKCcgdW5yZW5kZXJlZCAnKSA+IC0xKSB7XG4gICAgICBzZWxmLnJlbmRlclNlcXVlbmNlQ2FsbGJhY2tzW3N0YXJ0ICsgJy0nICsgZW5kICsgJy0nICsgZGVuc2l0eV0gPSByZW5kZXJTZXF1ZW5jZUNhbGxiYWNrO1xuICAgIH0gZWxzZSB7XG4gICAgICByZW5kZXJTZXF1ZW5jZUNhbGxiYWNrKCk7XG4gICAgfVxuICB9LFxuICBcbiAgbG9hZE9wdHM6IGZ1bmN0aW9uKCRkaWFsb2cpIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0cztcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPXZpZXdBc1BhaXJzXScpLmF0dHIoJ2NoZWNrZWQnLCAhIW8udmlld0FzUGFpcnMpO1xuICAgICRkaWFsb2cuZmluZCgnW25hbWU9Y29udmVydENoclNjaGVtZV0nKS52YWwoby5jb252ZXJ0Q2hyU2NoZW1lKS5jaGFuZ2UoKTtcbiAgfSxcblxuICBzYXZlT3B0czogZnVuY3Rpb24oJGRpYWxvZykge1xuICAgIHZhciBvID0gdGhpcy5vcHRzO1xuICAgIG8udmlld0FzUGFpcnMgPSAkZGlhbG9nLmZpbmQoJ1tuYW1lPXZpZXdBc1BhaXJzXScpLmlzKCc6Y2hlY2tlZCcpO1xuICAgIG8uY29udmVydENoclNjaGVtZSA9ICRkaWFsb2cuZmluZCgnW25hbWU9Y29udmVydENoclNjaGVtZV0nKS52YWwoKTtcbiAgICBcbiAgICAvLyBJZiBvLnZpZXdBc1BhaXJzIHdhcyBjaGFuZ2VkLCB3ZSAqbmVlZCogdG8gYmxvdyBhd2F5IHRoZSBnZW5vYnJvd3NlcidzIGFyZWFJbmRleCBcbiAgICAvLyBhbmQgb3VyIGxvY2FsbHkgY2FjaGVkIGFyZWFzLCBhcyBhbGwgdGhlIGFyZWFzIHdpbGwgY2hhbmdlLlxuICAgIGlmIChvLnZpZXdBc1BhaXJzICE9IHRoaXMucHJldk9wdHMudmlld0FzUGFpcnMpIHtcbiAgICAgIHRoaXMuYXJlYXMgPSB7fTtcbiAgICAgIGRlbGV0ZSAkZGlhbG9nLmRhdGEoJ2dlbm9icm93c2VyJykuZ2Vub2Jyb3dzZXIoJ2FyZWFJbmRleCcpWyRkaWFsb2cuZGF0YSgndHJhY2snKS5uXTtcbiAgICB9XG4gIH1cbiAgXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhbUZvcm1hdDsiLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSBCRUQgZm9ybWF0OiBodHRwOi8vZ2Vub21lLnVjc2MuZWR1L0ZBUS9GQVFmb3JtYXQuaHRtbCNmb3JtYXQxID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vL1xuLy8gYmVkRGV0YWlsIGlzIGEgdHJpdmlhbCBleHRlbnNpb24gb2YgQkVEIHRoYXQgaXMgZGVmaW5lZCBzZXBhcmF0ZWx5LFxuLy8gYWx0aG91Z2ggYSBCRUQgZmlsZSB3aXRoID4xMiBjb2x1bW5zIGlzIGFzc3VtZWQgdG8gYmUgYmVkRGV0YWlsIHRyYWNrIHJlZ2FyZGxlc3Mgb2YgdHlwZS5cblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy91dGlscy5qcycpLFxuICBmbG9vckhhY2sgPSB1dGlscy5mbG9vckhhY2ssXG4gIHBhcnNlSW50MTAgPSB1dGlscy5wYXJzZUludDEwO1xudmFyIEludGVydmFsVHJlZSA9IHJlcXVpcmUoJy4vdXRpbHMvSW50ZXJ2YWxUcmVlLmpzJykuSW50ZXJ2YWxUcmVlO1xudmFyIExpbmVNYXNrID0gcmVxdWlyZSgnLi91dGlscy9MaW5lTWFzay5qcycpLkxpbmVNYXNrO1xuXG4vLyBJbnRlbmRlZCB0byBiZSBsb2FkZWQgaW50byBDdXN0b21UcmFjay50eXBlcy5iZWRcbnZhciBCZWRGb3JtYXQgPSB7XG4gIGRlZmF1bHRzOiB7XG4gICAgaXRlbVJnYjogJ29mZicsXG4gICAgY29sb3JCeVN0cmFuZDogJycsXG4gICAgdXNlU2NvcmU6IDAsXG4gICAgZ3JvdXA6ICd1c2VyJyxcbiAgICBwcmlvcml0eTogJ3VzZXInLFxuICAgIG9mZnNldDogMCxcbiAgICBkZXRhaWw6IGZhbHNlLFxuICAgIHVybDogJycsXG4gICAgaHRtbFVybDogJycsXG4gICAgZHJhd0xpbWl0OiB7c3F1aXNoOiBudWxsLCBwYWNrOiBudWxsfVxuICB9LFxuICBcbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50eXBlKCkuaW5pdE9wdHMuY2FsbCh0aGlzKTtcbiAgfSxcbiAgXG4gIGluaXRPcHRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBhbHRDb2xvcnMgPSBzZWxmLm9wdHMuY29sb3JCeVN0cmFuZC5zcGxpdCgvXFxzKy8pLFxuICAgICAgdmFsaWRDb2xvckJ5U3RyYW5kID0gYWx0Q29sb3JzLmxlbmd0aCA+IDEgJiYgXy5hbGwoYWx0Q29sb3JzLCBzZWxmLnZhbGlkYXRlQ29sb3IpO1xuICAgIHNlbGYub3B0cy51c2VTY29yZSA9IHNlbGYuaXNPbihzZWxmLm9wdHMudXNlU2NvcmUpO1xuICAgIHNlbGYub3B0cy5pdGVtUmdiID0gc2VsZi5pc09uKHNlbGYub3B0cy5pdGVtUmdiKTtcbiAgICBpZiAoIXZhbGlkQ29sb3JCeVN0cmFuZCkgeyBzZWxmLm9wdHMuY29sb3JCeVN0cmFuZCA9ICcnOyBzZWxmLm9wdHMuYWx0Q29sb3IgPSBudWxsOyB9XG4gICAgZWxzZSB7IHNlbGYub3B0cy5hbHRDb2xvciA9IGFsdENvbG9yc1sxXTsgfVxuICB9LFxuXG4gIHBhcnNlTGluZTogZnVuY3Rpb24obGluZSwgbGluZW5vKSB7XG4gICAgdmFyIGNvbHMgPSBbJ2Nocm9tJywgJ2Nocm9tU3RhcnQnLCAnY2hyb21FbmQnLCAnbmFtZScsICdzY29yZScsICdzdHJhbmQnLCAndGhpY2tTdGFydCcsICd0aGlja0VuZCcsICdpdGVtUmdiJyxcbiAgICAgICdibG9ja0NvdW50JywgJ2Jsb2NrU2l6ZXMnLCAnYmxvY2tTdGFydHMnLCAnaWQnLCAnZGVzY3JpcHRpb24nXSxcbiAgICAgIGZlYXR1cmUgPSB7fSxcbiAgICAgIGZpZWxkcyA9IC9cXHQvLnRlc3QobGluZSkgPyBsaW5lLnNwbGl0KFwiXFx0XCIpIDogbGluZS5zcGxpdCgvXFxzKy8pLFxuICAgICAgY2hyUG9zLCBibG9ja1NpemVzO1xuICAgIFxuICAgIGlmICh0aGlzLm9wdHMuZGV0YWlsKSB7XG4gICAgICBjb2xzW2ZpZWxkcy5sZW5ndGggLSAyXSA9ICdpZCc7XG4gICAgICBjb2xzW2ZpZWxkcy5sZW5ndGggLSAxXSA9ICdkZXNjcmlwdGlvbic7XG4gICAgfVxuICAgIF8uZWFjaChmaWVsZHMsIGZ1bmN0aW9uKHYsIGkpIHsgZmVhdHVyZVtjb2xzW2ldXSA9IHY7IH0pO1xuICAgIGNoclBvcyA9IHRoaXMuYnJvd3Nlck9wdHMuY2hyUG9zW2ZlYXR1cmUuY2hyb21dO1xuICAgIGxpbmVubyA9IGxpbmVubyB8fCAwO1xuICAgIFxuICAgIGlmIChfLmlzVW5kZWZpbmVkKGNoclBvcykpIHsgXG4gICAgICB0aGlzLndhcm4oXCJJbnZhbGlkIGNocm9tb3NvbWUgJ1wiK2ZlYXR1cmUuY2hyb20rXCInIGF0IGxpbmUgXCIgKyAobGluZW5vICsgMSArIHRoaXMub3B0cy5saW5lTnVtKSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgZmVhdHVyZS5zY29yZSA9IF8uaXNVbmRlZmluZWQoZmVhdHVyZS5zY29yZSkgPyAnPycgOiBmZWF0dXJlLnNjb3JlO1xuICAgICAgZmVhdHVyZS5zdGFydCA9IGNoclBvcyArIHBhcnNlSW50MTAoZmVhdHVyZS5jaHJvbVN0YXJ0KSArIDE7XG4gICAgICBmZWF0dXJlLmVuZCA9IGNoclBvcyArIHBhcnNlSW50MTAoZmVhdHVyZS5jaHJvbUVuZCkgKyAxO1xuICAgICAgZmVhdHVyZS5ibG9ja3MgPSBudWxsO1xuICAgICAgLy8gZmFuY2llciBCRUQgZmVhdHVyZXMgdG8gZXhwcmVzcyBjb2RpbmcgcmVnaW9ucyBhbmQgZXhvbnMvaW50cm9uc1xuICAgICAgaWYgKC9eXFxkKyQvLnRlc3QoZmVhdHVyZS50aGlja1N0YXJ0KSAmJiAvXlxcZCskLy50ZXN0KGZlYXR1cmUudGhpY2tFbmQpKSB7XG4gICAgICAgIGZlYXR1cmUudGhpY2tTdGFydCA9IGNoclBvcyArIHBhcnNlSW50MTAoZmVhdHVyZS50aGlja1N0YXJ0KSArIDE7XG4gICAgICAgIGZlYXR1cmUudGhpY2tFbmQgPSBjaHJQb3MgKyBwYXJzZUludDEwKGZlYXR1cmUudGhpY2tFbmQpICsgMTtcbiAgICAgICAgaWYgKC9eXFxkKygsXFxkKikqJC8udGVzdChmZWF0dXJlLmJsb2NrU2l6ZXMpICYmIC9eXFxkKygsXFxkKikqJC8udGVzdChmZWF0dXJlLmJsb2NrU3RhcnRzKSkge1xuICAgICAgICAgIGZlYXR1cmUuYmxvY2tzID0gW107XG4gICAgICAgICAgYmxvY2tTaXplcyA9IGZlYXR1cmUuYmxvY2tTaXplcy5zcGxpdCgvLC8pO1xuICAgICAgICAgIF8uZWFjaChmZWF0dXJlLmJsb2NrU3RhcnRzLnNwbGl0KC8sLyksIGZ1bmN0aW9uKHN0YXJ0LCBpKSB7XG4gICAgICAgICAgICBpZiAoc3RhcnQgPT09ICcnKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgdmFyIGJsb2NrID0ge3N0YXJ0OiBmZWF0dXJlLnN0YXJ0ICsgcGFyc2VJbnQxMChzdGFydCl9O1xuICAgICAgICAgICAgYmxvY2suZW5kID0gYmxvY2suc3RhcnQgKyBwYXJzZUludDEwKGJsb2NrU2l6ZXNbaV0pO1xuICAgICAgICAgICAgZmVhdHVyZS5ibG9ja3MucHVzaChibG9jayk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZlYXR1cmUudGhpY2tTdGFydCA9IGZlYXR1cmUudGhpY2tFbmQgPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZmVhdHVyZTtcbiAgfSxcblxuICBwYXJzZTogZnVuY3Rpb24obGluZXMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBtaWRkbGVpc2hQb3MgPSBzZWxmLmJyb3dzZXJPcHRzLmdlbm9tZVNpemUgLyAyLFxuICAgICAgZGF0YSA9IG5ldyBJbnRlcnZhbFRyZWUoZmxvb3JIYWNrKG1pZGRsZWlzaFBvcyksIHtzdGFydEtleTogJ3N0YXJ0JywgZW5kS2V5OiAnZW5kJ30pO1xuICAgIF8uZWFjaChsaW5lcywgZnVuY3Rpb24obGluZSwgbGluZW5vKSB7XG4gICAgICB2YXIgZmVhdHVyZSA9IHNlbGYudHlwZSgpLnBhcnNlTGluZS5jYWxsKHNlbGYsIGxpbmUsIGxpbmVubyk7XG4gICAgICBpZiAoZmVhdHVyZSkgeyBkYXRhLmFkZChmZWF0dXJlKTsgfVxuICAgIH0pO1xuICAgIHNlbGYuZGF0YSA9IGRhdGE7XG4gICAgc2VsZi5oZWlnaHRzID0ge21heDogbnVsbCwgbWluOiAxNSwgc3RhcnQ6IDE1fTtcbiAgICBzZWxmLnNpemVzID0gWydkZW5zZScsICdzcXVpc2gnLCAncGFjayddO1xuICAgIHNlbGYubWFwU2l6ZXMgPSBbJ3BhY2snXTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcbiAgXG4gIHN0YWNrZWRMYXlvdXQ6IGZ1bmN0aW9uKGludGVydmFscywgd2lkdGgsIGNhbGNQaXhJbnRlcnZhbCwgbGluZU51bSkge1xuICAgIC8vIEEgbGluZU51bSBmdW5jdGlvbiBjYW4gYmUgcHJvdmlkZWQgd2hpY2ggY2FuIHNldC9yZXRyaWV2ZSB0aGUgbGluZSBvZiBhbHJlYWR5IHJlbmRlcmVkIGRhdGFwb2ludHNcbiAgICAvLyBzbyBhcyB0byBub3QgYnJlYWsgYSByYW5nZWQgZmVhdHVyZSB0aGF0IGV4dGVuZHMgb3ZlciBtdWx0aXBsZSB0aWxlcy5cbiAgICBsaW5lTnVtID0gXy5pc0Z1bmN0aW9uKGxpbmVOdW0pID8gbGluZU51bSA6IGZ1bmN0aW9uKCkgeyByZXR1cm47IH07XG4gICAgdmFyIGxpbmVzID0gW10sXG4gICAgICBtYXhFeGlzdGluZ0xpbmUgPSBfLm1heChfLm1hcChpbnRlcnZhbHMsIGZ1bmN0aW9uKHYpIHsgcmV0dXJuIGxpbmVOdW0odi5kYXRhKSB8fCAwOyB9KSkgKyAxLFxuICAgICAgc29ydGVkSW50ZXJ2YWxzID0gXy5zb3J0QnkoaW50ZXJ2YWxzLCBmdW5jdGlvbih2KSB7IHZhciBsbiA9IGxpbmVOdW0odi5kYXRhKTsgcmV0dXJuIF8uaXNVbmRlZmluZWQobG4pID8gMSA6IC1sbjsgfSk7XG4gICAgXG4gICAgd2hpbGUgKG1heEV4aXN0aW5nTGluZS0tPjApIHsgbGluZXMucHVzaChuZXcgTGluZU1hc2sod2lkdGgsIDUpKTsgfVxuICAgIF8uZWFjaChzb3J0ZWRJbnRlcnZhbHMsIGZ1bmN0aW9uKHYpIHtcbiAgICAgIHZhciBkID0gdi5kYXRhLFxuICAgICAgICBsbiA9IGxpbmVOdW0oZCksXG4gICAgICAgIHBJbnQgPSBjYWxjUGl4SW50ZXJ2YWwoZCksXG4gICAgICAgIHRoaWNrSW50ID0gZC50aGlja1N0YXJ0ICE9PSBudWxsICYmIGNhbGNQaXhJbnRlcnZhbCh7c3RhcnQ6IGQudGhpY2tTdGFydCwgZW5kOiBkLnRoaWNrRW5kfSksXG4gICAgICAgIGJsb2NrSW50cyA9IGQuYmxvY2tzICE9PSBudWxsICYmICBfLm1hcChkLmJsb2NrcywgY2FsY1BpeEludGVydmFsKSxcbiAgICAgICAgaSA9IDAsXG4gICAgICAgIGwgPSBsaW5lcy5sZW5ndGg7XG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQobG4pKSB7XG4gICAgICAgIGlmIChsaW5lc1tsbl0uY29uZmxpY3QocEludC50eCwgcEludC50dykpIHsgY29uc29sZS5sb2coXCJVbnJlc29sdmFibGUgTGluZU1hc2sgY29uZmxpY3QhXCIpOyB9XG4gICAgICAgIGxpbmVzW2xuXS5hZGQocEludC50eCwgcEludC50dywge3BJbnQ6IHBJbnQsIHRoaWNrSW50OiB0aGlja0ludCwgYmxvY2tJbnRzOiBibG9ja0ludHMsIGQ6IGR9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdoaWxlIChpIDwgbCAmJiBsaW5lc1tpXS5jb25mbGljdChwSW50LnR4LCBwSW50LnR3KSkgeyArK2k7IH1cbiAgICAgICAgaWYgKGkgPT0gbCkgeyBsaW5lcy5wdXNoKG5ldyBMaW5lTWFzayh3aWR0aCwgNSkpOyB9XG4gICAgICAgIGxpbmVOdW0oZCwgaSk7XG4gICAgICAgIGxpbmVzW2ldLmFkZChwSW50LnR4LCBwSW50LnR3LCB7cEludDogcEludCwgdGhpY2tJbnQ6IHRoaWNrSW50LCBibG9ja0ludHM6IGJsb2NrSW50cywgZDogZH0pO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBfLm1hcChsaW5lcywgZnVuY3Rpb24obCkgeyByZXR1cm4gXy5wbHVjayhsLml0ZW1zLCAnZGF0YScpOyB9KTtcbiAgfSxcbiAgXG4gIHByZXJlbmRlcjogZnVuY3Rpb24oc3RhcnQsIGVuZCwgZGVuc2l0eSwgcHJlY2FsYywgY2FsbGJhY2spIHtcbiAgICB2YXIgd2lkdGggPSBwcmVjYWxjLndpZHRoLFxuICAgICAgYnBwcCA9IChlbmQgLSBzdGFydCkgLyB3aWR0aCxcbiAgICAgIGludGVydmFscyA9IHRoaXMuZGF0YS5zZWFyY2goc3RhcnQsIGVuZCksXG4gICAgICBkcmF3U3BlYyA9IFtdLFxuICAgICAgY2FsY1BpeEludGVydmFsID0gbmV3IHV0aWxzLnBpeEludGVydmFsQ2FsY3VsYXRvcihzdGFydCwgd2lkdGgsIGJwcHAsIGRlbnNpdHk9PSdwYWNrJyk7XG4gICAgXG4gICAgZnVuY3Rpb24gbGluZU51bShkLCBzZXQpIHtcbiAgICAgIHZhciBrZXkgPSBicHBwICsgJ18nICsgZGVuc2l0eTtcbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZChzZXQpKSB7IFxuICAgICAgICBpZiAoIWQubGluZSkgeyBkLmxpbmUgPSB7fTsgfVxuICAgICAgICByZXR1cm4gKGQubGluZVtrZXldID0gc2V0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkLmxpbmUgJiYgZC5saW5lW2tleV07IFxuICAgIH1cbiAgICBcbiAgICBpZiAoZGVuc2l0eSA9PSAnZGVuc2UnKSB7XG4gICAgICBfLmVhY2goaW50ZXJ2YWxzLCBmdW5jdGlvbih2KSB7XG4gICAgICAgIHZhciBwSW50ID0gY2FsY1BpeEludGVydmFsKHYuZGF0YSk7XG4gICAgICAgIHBJbnQudiA9IHYuZGF0YS5zY29yZTtcbiAgICAgICAgZHJhd1NwZWMucHVzaChwSW50KTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBkcmF3U3BlYyA9IHtsYXlvdXQ6IHRoaXMudHlwZSgnYmVkJykuc3RhY2tlZExheW91dC5jYWxsKHRoaXMsIGludGVydmFscywgd2lkdGgsIGNhbGNQaXhJbnRlcnZhbCwgbGluZU51bSl9O1xuICAgICAgZHJhd1NwZWMud2lkdGggPSB3aWR0aDtcbiAgICB9XG4gICAgcmV0dXJuIF8uaXNGdW5jdGlvbihjYWxsYmFjaykgPyBjYWxsYmFjayhkcmF3U3BlYykgOiBkcmF3U3BlYztcbiAgfSxcbiAgXG4gIGFkZEFyZWE6IGZ1bmN0aW9uKGFyZWFzLCBkYXRhLCBpLCBsaW5lSGVpZ2h0LCB1cmxUZW1wbGF0ZSkge1xuICAgIHZhciB0aXBUaXBEYXRhID0ge30sXG4gICAgICB0aXBUaXBEYXRhQ2FsbGJhY2sgPSB0aGlzLnR5cGUoKS50aXBUaXBEYXRhO1xuICAgIGlmICghYXJlYXMpIHsgcmV0dXJuOyB9XG4gICAgaWYgKF8uaXNGdW5jdGlvbih0aXBUaXBEYXRhQ2FsbGJhY2spKSB7XG4gICAgICB0aXBUaXBEYXRhID0gdGlwVGlwRGF0YUNhbGxiYWNrLmNhbGwodGhpcywgZGF0YSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZChkYXRhLmQuZGVzY3JpcHRpb24pKSB7IHRpcFRpcERhdGEuZGVzY3JpcHRpb24gPSBkYXRhLmQuZGVzY3JpcHRpb247IH1cbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZChkYXRhLmQuc2NvcmUpKSB7IHRpcFRpcERhdGEuc2NvcmUgPSBkYXRhLmQuc2NvcmU7IH1cbiAgICAgIF8uZXh0ZW5kKHRpcFRpcERhdGEsIHtcbiAgICAgICAgcG9zaXRpb246IGRhdGEuZC5jaHJvbSArICc6JyArIGRhdGEuZC5jaHJvbVN0YXJ0LCBcbiAgICAgICAgc2l6ZTogZGF0YS5kLmNocm9tRW5kIC0gZGF0YS5kLmNocm9tU3RhcnRcbiAgICAgIH0pO1xuICAgICAgLy8gRGlzcGxheSB0aGUgSUQgY29sdW1uIChmcm9tIGJlZERldGFpbCksIHVubGVzcyBpdCBjb250YWlucyBhIHRhYiBjaGFyYWN0ZXIsIHdoaWNoIG1lYW5zIGl0IHdhcyBhdXRvZ2VuZXJhdGVkXG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQoZGF0YS5kLmlkKSAmJiAhKC9cXHQvKS50ZXN0KGRhdGEuZC5pZCkpIHsgdGlwVGlwRGF0YS5pZCA9IGRhdGEuZC5pZDsgfVxuICAgIH1cbiAgICBhcmVhcy5wdXNoKFtcbiAgICAgIGRhdGEucEludC54LCBpICogbGluZUhlaWdodCArIDEsIGRhdGEucEludC54ICsgZGF0YS5wSW50LncsIChpICsgMSkgKiBsaW5lSGVpZ2h0LCAvLyB4MSwgeDIsIHkxLCB5MlxuICAgICAgZGF0YS5kLm5hbWUgfHwgZGF0YS5kLmlkIHx8ICcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5hbWVcbiAgICAgIHVybFRlbXBsYXRlLnJlcGxhY2UoJyQkJywgXy5pc1VuZGVmaW5lZChkYXRhLmQuaWQpID8gZGF0YS5kLm5hbWUgOiBkYXRhLmQuaWQpLCAgICAvLyBocmVmXG4gICAgICBkYXRhLnBJbnQub1ByZXYsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWF0aW9uIGZyb20gcHJldmlvdXMgdGlsZT9cbiAgICAgIG51bGwsXG4gICAgICBudWxsLFxuICAgICAgdGlwVGlwRGF0YVxuICAgIF0pO1xuICB9LFxuICBcbiAgLy8gU2NhbGVzIGEgc2NvcmUgZnJvbSAwLTEwMDAgaW50byBhbiBhbHBoYSB2YWx1ZSBiZXR3ZWVuIDAuMiBhbmQgMS4wXG4gIGNhbGNBbHBoYTogZnVuY3Rpb24odmFsdWUpIHsgcmV0dXJuIE1hdGgubWF4KHZhbHVlLCAxNjYpLzEwMDA7IH0sXG4gIFxuICAvLyBTY2FsZXMgYSBzY29yZSBmcm9tIDAtMTAwMCBpbnRvIGEgY29sb3Igc2NhbGVkIGJldHdlZW4gI2NjY2NjYyBhbmQgbWF4IENvbG9yXG4gIGNhbGNHcmFkaWVudDogZnVuY3Rpb24obWF4Q29sb3IsIHZhbHVlKSB7XG4gICAgdmFyIG1pbkNvbG9yID0gWzIzMCwyMzAsMjMwXSxcbiAgICAgIHZhbHVlQ29sb3IgPSBbXTtcbiAgICBpZiAoIV8uaXNBcnJheShtYXhDb2xvcikpIHsgbWF4Q29sb3IgPSBfLm1hcChtYXhDb2xvci5zcGxpdCgnLCcpLCBwYXJzZUludDEwKTsgfVxuICAgIF8uZWFjaChtaW5Db2xvciwgZnVuY3Rpb24odiwgaSkgeyB2YWx1ZUNvbG9yW2ldID0gKHYgLSBtYXhDb2xvcltpXSkgKiAoKDEwMDAgLSB2YWx1ZSkgLyAxMDAwLjApICsgbWF4Q29sb3JbaV07IH0pO1xuICAgIHJldHVybiBfLm1hcCh2YWx1ZUNvbG9yLCBwYXJzZUludDEwKS5qb2luKCcsJyk7XG4gIH0sXG4gIFxuICBkcmF3QXJyb3dzOiBmdW5jdGlvbihjdHgsIGNhbnZhc1dpZHRoLCBsaW5lWSwgaGFsZkhlaWdodCwgc3RhcnRYLCBlbmRYLCBkaXJlY3Rpb24pIHtcbiAgICB2YXIgYXJyb3dIZWlnaHQgPSBNYXRoLm1pbihoYWxmSGVpZ2h0LCAzKSxcbiAgICAgIFgxLCBYMjtcbiAgICBzdGFydFggPSBNYXRoLm1heChzdGFydFgsIDApO1xuICAgIGVuZFggPSBNYXRoLm1pbihlbmRYLCBjYW52YXNXaWR0aCk7XG4gICAgaWYgKGVuZFggLSBzdGFydFggPCA1KSB7IHJldHVybjsgfSAvLyBjYW4ndCBkcmF3IGFycm93cyBpbiB0aGF0IG5hcnJvdyBvZiBhIHNwYWNlXG4gICAgaWYgKGRpcmVjdGlvbiAhPT0gJysnICYmIGRpcmVjdGlvbiAhPT0gJy0nKSB7IHJldHVybjsgfSAvLyBpbnZhbGlkIGRpcmVjdGlvblxuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAvLyBBbGwgdGhlIDAuNSdzIGhlcmUgYXJlIGR1ZSB0byA8Y2FudmFzPidzIHNvbWV3aGF0IHNpbGx5IGNvb3JkaW5hdGUgc3lzdGVtIFxuICAgIC8vIGh0dHA6Ly9kaXZlaW50b2h0bWw1LmluZm8vY2FudmFzLmh0bWwjcGl4ZWwtbWFkbmVzc1xuICAgIFgxID0gZGlyZWN0aW9uID09ICcrJyA/IDAuNSA6IGFycm93SGVpZ2h0ICsgMC41O1xuICAgIFgyID0gZGlyZWN0aW9uID09ICcrJyA/IGFycm93SGVpZ2h0ICsgMC41IDogMC41O1xuICAgIGZvciAodmFyIGkgPSBNYXRoLmZsb29yKHN0YXJ0WCkgKyAyOyBpIDwgZW5kWCAtIGFycm93SGVpZ2h0OyBpICs9IDcpIHtcbiAgICAgIGN0eC5tb3ZlVG8oaSArIFgxLCBsaW5lWSArIGhhbGZIZWlnaHQgLSBhcnJvd0hlaWdodCArIDAuNSk7XG4gICAgICBjdHgubGluZVRvKGkgKyBYMiwgbGluZVkgKyBoYWxmSGVpZ2h0ICsgMC41KTtcbiAgICAgIGN0eC5saW5lVG8oaSArIFgxLCBsaW5lWSArIGhhbGZIZWlnaHQgKyBhcnJvd0hlaWdodCArIDAuNSk7XG4gICAgfVxuICAgIGN0eC5zdHJva2UoKTtcbiAgfSxcbiAgXG4gIGRyYXdGZWF0dXJlOiBmdW5jdGlvbihjdHgsIHdpZHRoLCBkYXRhLCBpLCBsaW5lSGVpZ2h0KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgY29sb3IgPSBzZWxmLm9wdHMuY29sb3IsXG4gICAgICB5ID0gaSAqIGxpbmVIZWlnaHQsXG4gICAgICBoYWxmSGVpZ2h0ID0gTWF0aC5yb3VuZCgwLjUgKiAobGluZUhlaWdodCAtIDEpKSxcbiAgICAgIHF1YXJ0ZXJIZWlnaHQgPSBNYXRoLmNlaWwoMC4yNSAqIChsaW5lSGVpZ2h0IC0gMSkpLFxuICAgICAgbGluZUdhcCA9IGxpbmVIZWlnaHQgPiA2ID8gMiA6IDEsXG4gICAgICB0aGlja092ZXJsYXAgPSBudWxsLFxuICAgICAgcHJldkJJbnQgPSBudWxsO1xuICAgIFxuICAgIC8vIEZpcnN0LCBkZXRlcm1pbmUgYW5kIHNldCB0aGUgY29sb3Igd2Ugd2lsbCBiZSB1c2luZ1xuICAgIC8vIE5vdGUgdGhhdCB0aGUgZGVmYXVsdCBjb2xvciB3YXMgYWxyZWFkeSBzZXQgaW4gZHJhd1NwZWNcbiAgICBpZiAoc2VsZi5vcHRzLmFsdENvbG9yICYmIGRhdGEuZC5zdHJhbmQgPT0gJy0nKSB7IGNvbG9yID0gc2VsZi5vcHRzLmFsdENvbG9yOyB9XG4gICAgXG4gICAgaWYgKHNlbGYub3B0cy5pdGVtUmdiICYmIGRhdGEuZC5pdGVtUmdiICYmIHRoaXMudmFsaWRhdGVDb2xvcihkYXRhLmQuaXRlbVJnYikpIHsgY29sb3IgPSBkYXRhLmQuaXRlbVJnYjsgfVxuICAgIFxuICAgIGlmIChzZWxmLm9wdHMudXNlU2NvcmUpIHsgY29sb3IgPSBzZWxmLnR5cGUoJ2JlZCcpLmNhbGNHcmFkaWVudChjb2xvciwgZGF0YS5kLnNjb3JlKTsgfVxuICAgIFxuICAgIGlmIChzZWxmLm9wdHMuaXRlbVJnYiB8fCBzZWxmLm9wdHMuYWx0Q29sb3IgfHwgc2VsZi5vcHRzLnVzZVNjb3JlKSB7IGN0eC5maWxsU3R5bGUgPSBjdHguc3Ryb2tlU3R5bGUgPSBcInJnYihcIiArIGNvbG9yICsgXCIpXCI7IH1cbiAgICBcbiAgICBpZiAoZGF0YS50aGlja0ludCkge1xuICAgICAgLy8gVGhlIGNvZGluZyByZWdpb24gaXMgZHJhd24gYXMgYSB0aGlja2VyIGxpbmUgd2l0aGluIHRoZSBnZW5lXG4gICAgICBpZiAoZGF0YS5ibG9ja0ludHMpIHtcbiAgICAgICAgLy8gSWYgdGhlcmUgYXJlIGV4b25zIGFuZCBpbnRyb25zLCBkcmF3IHRoZSBpbnRyb25zIHdpdGggYSAxcHggbGluZVxuICAgICAgICBwcmV2QkludCA9IG51bGw7XG4gICAgICAgIGN0eC5maWxsUmVjdChkYXRhLnBJbnQueCwgeSArIGhhbGZIZWlnaHQsIGRhdGEucEludC53LCAxKTtcbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7XG4gICAgICAgIF8uZWFjaChkYXRhLmJsb2NrSW50cywgZnVuY3Rpb24oYkludCkge1xuICAgICAgICAgIGlmIChiSW50LnggKyBiSW50LncgPD0gd2lkdGggJiYgYkludC54ID49IDApIHtcbiAgICAgICAgICAgIGN0eC5maWxsUmVjdChiSW50LngsIHkgKyBoYWxmSGVpZ2h0IC0gcXVhcnRlckhlaWdodCArIDEsIGJJbnQudywgcXVhcnRlckhlaWdodCAqIDIgLSAxKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpY2tPdmVybGFwID0gdXRpbHMucGl4SW50ZXJ2YWxPdmVybGFwKGJJbnQsIGRhdGEudGhpY2tJbnQpO1xuICAgICAgICAgIGlmICh0aGlja092ZXJsYXApIHtcbiAgICAgICAgICAgIGN0eC5maWxsUmVjdCh0aGlja092ZXJsYXAueCwgeSArIDEsIHRoaWNrT3ZlcmxhcC53LCBsaW5lSGVpZ2h0IC0gbGluZUdhcCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBpbnRyb25zLCBhcnJvd3MgYXJlIGRyYXduIG9uIHRoZSBpbnRyb25zLCBub3QgdGhlIGV4b25zLi4uXG4gICAgICAgICAgaWYgKGRhdGEuZC5zdHJhbmQgJiYgcHJldkJJbnQpIHtcbiAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IFwicmdiKFwiICsgY29sb3IgKyBcIilcIjtcbiAgICAgICAgICAgIHNlbGYudHlwZSgnYmVkJykuZHJhd0Fycm93cyhjdHgsIHdpZHRoLCB5LCBoYWxmSGVpZ2h0LCBwcmV2QkludC54ICsgcHJldkJJbnQudywgYkludC54LCBkYXRhLmQuc3RyYW5kKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcHJldkJJbnQgPSBiSW50O1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gLi4udW5sZXNzIHRoZXJlIHdlcmUgbm8gaW50cm9ucy4gVGhlbiBpdCBpcyBkcmF3biBvbiB0aGUgY29kaW5nIHJlZ2lvbi5cbiAgICAgICAgaWYgKGRhdGEuYmxvY2tJbnRzLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gXCJ3aGl0ZVwiO1xuICAgICAgICAgIHNlbGYudHlwZSgnYmVkJykuZHJhd0Fycm93cyhjdHgsIHdpZHRoLCB5LCBoYWxmSGVpZ2h0LCBkYXRhLnRoaWNrSW50LngsIGRhdGEudGhpY2tJbnQueCArIGRhdGEudGhpY2tJbnQudywgZGF0YS5kLnN0cmFuZCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFdlIGhhdmUgYSBjb2RpbmcgcmVnaW9uIGJ1dCBubyBpbnRyb25zL2V4b25zXG4gICAgICAgIGN0eC5maWxsUmVjdChkYXRhLnBJbnQueCwgeSArIGhhbGZIZWlnaHQgLSBxdWFydGVySGVpZ2h0ICsgMSwgZGF0YS5wSW50LncsIHF1YXJ0ZXJIZWlnaHQgKiAyIC0gMSk7XG4gICAgICAgIGN0eC5maWxsUmVjdChkYXRhLnRoaWNrSW50LngsIHkgKyAxLCBkYXRhLnRoaWNrSW50LncsIGxpbmVIZWlnaHQgLSBsaW5lR2FwKTtcbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gXCJ3aGl0ZVwiO1xuICAgICAgICBzZWxmLnR5cGUoJ2JlZCcpLmRyYXdBcnJvd3MoY3R4LCB3aWR0aCwgeSwgaGFsZkhlaWdodCwgZGF0YS50aGlja0ludC54LCBkYXRhLnRoaWNrSW50LnggKyBkYXRhLnRoaWNrSW50LncsIGRhdGEuZC5zdHJhbmQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBOb3RoaW5nIGZhbmN5LiAgSXQncyBhIGJveC5cbiAgICAgIGN0eC5maWxsUmVjdChkYXRhLnBJbnQueCwgeSArIDEsIGRhdGEucEludC53LCBsaW5lSGVpZ2h0IC0gbGluZUdhcCk7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBcIndoaXRlXCI7XG4gICAgICBzZWxmLnR5cGUoJ2JlZCcpLmRyYXdBcnJvd3MoY3R4LCB3aWR0aCwgeSwgaGFsZkhlaWdodCwgZGF0YS5wSW50LngsIGRhdGEucEludC54ICsgZGF0YS5wSW50LncsIGRhdGEuZC5zdHJhbmQpO1xuICAgIH1cbiAgfSxcbiAgXG4gIGRyYXdTcGVjOiBmdW5jdGlvbihjYW52YXMsIGRyYXdTcGVjLCBkZW5zaXR5KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQgJiYgY2FudmFzLmdldENvbnRleHQoJzJkJyksXG4gICAgICB1cmxUZW1wbGF0ZSA9IHNlbGYub3B0cy51cmwgPyBzZWxmLm9wdHMudXJsIDogJ2phdmFzY3JpcHQ6dm9pZChcIicrc2VsZi5vcHRzLm5hbWUrJzokJFwiKScsXG4gICAgICBkcmF3TGltaXQgPSBzZWxmLm9wdHMuZHJhd0xpbWl0ICYmIHNlbGYub3B0cy5kcmF3TGltaXRbZGVuc2l0eV0sXG4gICAgICBsaW5lSGVpZ2h0ID0gZGVuc2l0eSA9PSAncGFjaycgPyAxNSA6IDYsXG4gICAgICBjb2xvciA9IHNlbGYub3B0cy5jb2xvcixcbiAgICAgIGFyZWFzID0gbnVsbDtcbiAgICBcbiAgICBpZiAoIWN0eCkgeyB0aHJvdyBcIkNhbnZhcyBub3Qgc3VwcG9ydGVkXCI7IH1cbiAgICAvLyBUT0RPOiBJIGRpc2FibGVkIHJlZ2VuZXJhdGluZyBhcmVhcyBoZXJlLCB3aGljaCBhc3N1bWVzIHRoYXQgbGluZU51bSByZW1haW5zIHN0YWJsZSBhY3Jvc3MgcmUtcmVuZGVycy4gU2hvdWxkIGNoZWNrIG9uIHRoaXMuXG4gICAgaWYgKGRlbnNpdHkgPT0gJ3BhY2snICYmICFzZWxmLmFyZWFzW2NhbnZhcy5pZF0pIHsgYXJlYXMgPSBzZWxmLmFyZWFzW2NhbnZhcy5pZF0gPSBbXTsgfVxuICAgIFxuICAgIGlmIChkZW5zaXR5ID09ICdkZW5zZScpIHtcbiAgICAgIGNhbnZhcy5oZWlnaHQgPSAxNTtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBcInJnYihcIitjb2xvcitcIilcIjtcbiAgICAgIF8uZWFjaChkcmF3U3BlYywgZnVuY3Rpb24ocEludCkge1xuICAgICAgICBpZiAoc2VsZi5vcHRzLnVzZVNjb3JlKSB7IGN0eC5maWxsU3R5bGUgPSBcInJnYmEoXCIrc2VsZi50eXBlKCdiZWQnKS5jYWxjR3JhZGllbnQoY29sb3IsIHBJbnQudikrXCIpXCI7IH1cbiAgICAgICAgY3R4LmZpbGxSZWN0KHBJbnQueCwgMSwgcEludC53LCAxMyk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKChkcmF3TGltaXQgJiYgZHJhd1NwZWMubGF5b3V0ICYmIGRyYXdTcGVjLmxheW91dC5sZW5ndGggPiBkcmF3TGltaXQpIHx8IGRyYXdTcGVjLnRvb01hbnkpIHsgXG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSAwO1xuICAgICAgICAvLyBUaGlzIGFwcGxpZXMgc3R5bGluZyB0aGF0IGluZGljYXRlcyB0aGVyZSB3YXMgdG9vIG11Y2ggZGF0YSB0byBsb2FkL2RyYXcgYW5kIHRoYXQgdGhlIHVzZXIgbmVlZHMgdG8gem9vbSB0byBzZWUgbW9yZVxuICAgICAgICBjYW52YXMuY2xhc3NOYW1lID0gY2FudmFzLmNsYXNzTmFtZSArICcgdG9vLW1hbnknO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjYW52YXMuaGVpZ2h0ID0gZHJhd1NwZWMubGF5b3V0Lmxlbmd0aCAqIGxpbmVIZWlnaHQ7XG4gICAgICBjdHguZmlsbFN0eWxlID0gY3R4LnN0cm9rZVN0eWxlID0gXCJyZ2IoXCIrY29sb3IrXCIpXCI7XG4gICAgICBfLmVhY2goZHJhd1NwZWMubGF5b3V0LCBmdW5jdGlvbihsLCBpKSB7XG4gICAgICAgIF8uZWFjaChsLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgc2VsZi50eXBlKCdiZWQnKS5kcmF3RmVhdHVyZS5jYWxsKHNlbGYsIGN0eCwgZHJhd1NwZWMud2lkdGgsIGRhdGEsIGksIGxpbmVIZWlnaHQpOyAgICAgICAgICAgICAgXG4gICAgICAgICAgc2VsZi50eXBlKCdiZWQnKS5hZGRBcmVhLmNhbGwoc2VsZiwgYXJlYXMsIGRhdGEsIGksIGxpbmVIZWlnaHQsIHVybFRlbXBsYXRlKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbihjYW52YXMsIHN0YXJ0LCBlbmQsIGRlbnNpdHksIGNhbGxiYWNrKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHNlbGYucHJlcmVuZGVyKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHt3aWR0aDogY2FudmFzLndpZHRofSwgZnVuY3Rpb24oZHJhd1NwZWMpIHtcbiAgICAgIHNlbGYudHlwZSgpLmRyYXdTcGVjLmNhbGwoc2VsZiwgY2FudmFzLCBkcmF3U3BlYywgZGVuc2l0eSk7XG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkgeyBjYWxsYmFjaygpOyB9XG4gICAgfSk7XG4gIH0sXG5cbiAgbG9hZE9wdHM6IGZ1bmN0aW9uKCRkaWFsb2cpIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0cyxcbiAgICAgIGNvbG9yQnlTdHJhbmRPbiA9IC9cXGQrLFxcZCssXFxkK1xccytcXGQrLFxcZCssXFxkKy8udGVzdChvLmNvbG9yQnlTdHJhbmQpLFxuICAgICAgY29sb3JCeVN0cmFuZCA9IGNvbG9yQnlTdHJhbmRPbiA/IG8uY29sb3JCeVN0cmFuZC5zcGxpdCgvXFxzKy8pWzFdIDogJzAsMCwwJztcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPWNvbG9yQnlTdHJhbmRPbl0nKS5hdHRyKCdjaGVja2VkJywgISFjb2xvckJ5U3RyYW5kT24pO1xuICAgICRkaWFsb2cuZmluZCgnW25hbWU9Y29sb3JCeVN0cmFuZF0nKS52YWwoY29sb3JCeVN0cmFuZCkuY2hhbmdlKCk7XG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT11c2VTY29yZV0nKS5hdHRyKCdjaGVja2VkJywgdGhpcy5pc09uKG8udXNlU2NvcmUpKTsgICAgXG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT11cmxdJykudmFsKG8udXJsKTtcbiAgfSxcbiAgXG4gIHNhdmVPcHRzOiBmdW5jdGlvbigkZGlhbG9nKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdHMsXG4gICAgICBjb2xvckJ5U3RyYW5kT24gPSAkZGlhbG9nLmZpbmQoJ1tuYW1lPWNvbG9yQnlTdHJhbmRPbl0nKS5pcygnOmNoZWNrZWQnKSxcbiAgICAgIGNvbG9yQnlTdHJhbmQgPSAkZGlhbG9nLmZpbmQoJ1tuYW1lPWNvbG9yQnlTdHJhbmRdJykudmFsKCksXG4gICAgICB2YWxpZENvbG9yQnlTdHJhbmQgPSB0aGlzLnZhbGlkYXRlQ29sb3IoY29sb3JCeVN0cmFuZCk7XG4gICAgby5jb2xvckJ5U3RyYW5kID0gY29sb3JCeVN0cmFuZE9uICYmIHZhbGlkQ29sb3JCeVN0cmFuZCA/IG8uY29sb3IgKyAnICcgKyBjb2xvckJ5U3RyYW5kIDogJyc7XG4gICAgby51c2VTY29yZSA9ICRkaWFsb2cuZmluZCgnW25hbWU9dXNlU2NvcmVdJykuaXMoJzpjaGVja2VkJykgPyAxIDogMDtcbiAgICBvLnVybCA9ICRkaWFsb2cuZmluZCgnW25hbWU9dXJsXScpLnZhbCgpO1xuICAgIHRoaXMudHlwZSgnYmVkJykuaW5pdE9wdHMuY2FsbCh0aGlzKTtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCZWRGb3JtYXQ7IiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSBiZWRHcmFwaCBmb3JtYXQ6IGh0dHA6Ly9nZW5vbWUudWNzYy5lZHUvZ29sZGVuUGF0aC9oZWxwL2JlZGdyYXBoLmh0bWwgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzL3V0aWxzLmpzJyksXG4gIHBhcnNlSW50MTAgPSB1dGlscy5wYXJzZUludDEwO1xuXG4vLyBJbnRlbmRlZCB0byBiZSBsb2FkZWQgaW50byBDdXN0b21UcmFjay50eXBlcy5iZWRncmFwaFxudmFyIEJlZEdyYXBoRm9ybWF0ID0ge1xuICBkZWZhdWx0czoge1xuICAgIGFsdENvbG9yOiAnJyxcbiAgICBwcmlvcml0eTogMTAwLFxuICAgIGF1dG9TY2FsZTogJ29uJyxcbiAgICBhbHdheXNaZXJvOiAnb2ZmJyxcbiAgICBncmlkRGVmYXVsdDogJ29mZicsXG4gICAgbWF4SGVpZ2h0UGl4ZWxzOiAnMTI4OjEyODoxNScsXG4gICAgZ3JhcGhUeXBlOiAnYmFyJyxcbiAgICB2aWV3TGltaXRzOiAnJyxcbiAgICB5TGluZU1hcms6IDAuMCxcbiAgICB5TGluZU9uT2ZmOiAnb2ZmJyxcbiAgICB3aW5kb3dpbmdGdW5jdGlvbjogJ21heGltdW0nLFxuICAgIHNtb290aGluZ1dpbmRvdzogJ29mZidcbiAgfSxcblxuICBpbml0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnd2lnZ2xlXzAnKS5pbml0LmNhbGwodGhpcyk7IH0sXG4gIFxuICBfYmluRnVuY3Rpb25zOiB1dGlscy53aWdCaW5GdW5jdGlvbnMsXG4gIFxuICBpbml0T3B0czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykuaW5pdE9wdHMuY2FsbCh0aGlzKTsgfSxcbiAgXG4gIGFwcGx5T3B0czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykuYXBwbHlPcHRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sXG4gIFxuICBwYXJzZTogZnVuY3Rpb24obGluZXMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBnZW5vbWVTaXplID0gdGhpcy5icm93c2VyT3B0cy5nZW5vbWVTaXplLFxuICAgICAgZGF0YSA9IHthbGw6IFtdfSxcbiAgICAgIG1vZGUsIG1vZGVPcHRzLCBjaHJQb3MsIG07XG4gICAgc2VsZi5yYW5nZSA9IHNlbGYuaXNPbih0aGlzLm9wdHMuYWx3YXlzWmVybykgPyBbMCwgMF0gOiBbSW5maW5pdHksIC1JbmZpbml0eV07XG4gIFxuICAgIF8uZWFjaChsaW5lcywgZnVuY3Rpb24obGluZSwgbGluZW5vKSB7XG4gICAgICB2YXIgY29scyA9IFsnY2hyb20nLCAnY2hyb21TdGFydCcsICdjaHJvbUVuZCcsICdkYXRhVmFsdWUnXSxcbiAgICAgICAgZGF0dW0gPSB7fSxcbiAgICAgICAgY2hyUG9zLCBzdGFydCwgZW5kLCB2YWw7XG4gICAgICBfLmVhY2gobGluZS5zcGxpdCgvXFxzKy8pLCBmdW5jdGlvbih2LCBpKSB7IGRhdHVtW2NvbHNbaV1dID0gdjsgfSk7XG4gICAgICBjaHJQb3MgPSBzZWxmLmJyb3dzZXJPcHRzLmNoclBvc1tkYXR1bS5jaHJvbV07XG4gICAgICBpZiAoXy5pc1VuZGVmaW5lZChjaHJQb3MpKSB7XG4gICAgICAgIHNlbGYud2FybihcIkludmFsaWQgY2hyb21vc29tZSBhdCBsaW5lIFwiICsgKGxpbmVubyArIDEgKyBzZWxmLm9wdHMubGluZU51bSkpO1xuICAgICAgfVxuICAgICAgc3RhcnQgPSBwYXJzZUludDEwKGRhdHVtLmNocm9tU3RhcnQpO1xuICAgICAgZW5kID0gcGFyc2VJbnQxMChkYXR1bS5jaHJvbUVuZCk7XG4gICAgICB2YWwgPSBwYXJzZUZsb2F0KGRhdHVtLmRhdGFWYWx1ZSk7XG4gICAgICBkYXRhLmFsbC5wdXNoKHtzdGFydDogY2hyUG9zICsgc3RhcnQsIGVuZDogY2hyUG9zICsgZW5kLCB2YWw6IHZhbH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHNlbGYudHlwZSgnd2lnZ2xlXzAnKS5maW5pc2hQYXJzZS5jYWxsKHNlbGYsIGRhdGEpO1xuICB9LFxuICBcbiAgaW5pdERyYXdTcGVjOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnd2lnZ2xlXzAnKS5pbml0RHJhd1NwZWMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSxcbiAgXG4gIGRyYXdCYXJzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnd2lnZ2xlXzAnKS5kcmF3QmFycy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9LFxuXG4gIHByZXJlbmRlcjogZnVuY3Rpb24oc3RhcnQsIGVuZCwgZGVuc2l0eSwgcHJlY2FsYywgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gdGhpcy50eXBlKCd3aWdnbGVfMCcpLnByZXJlbmRlci5jYWxsKHRoaXMsIHN0YXJ0LCBlbmQsIGRlbnNpdHksIHByZWNhbGMsIGNhbGxiYWNrKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKGNhbnZhcywgc3RhcnQsIGVuZCwgZGVuc2l0eSwgY2FsbGJhY2spIHtcbiAgICB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykucmVuZGVyLmNhbGwodGhpcywgY2FudmFzLCBzdGFydCwgZW5kLCBkZW5zaXR5LCBjYWxsYmFjayk7XG4gIH0sXG4gIFxuICBsb2FkT3B0czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykubG9hZE9wdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSxcbiAgXG4gIHNhdmVPcHRzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnd2lnZ2xlXzAnKS5zYXZlT3B0cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9XG4gIFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCZWRHcmFwaEZvcm1hdDsiLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gYmlnQmVkIGZvcm1hdDogaHR0cDovL2dlbm9tZS51Y3NjLmVkdS9nb2xkZW5QYXRoL2hlbHAvYmlnQmVkLmh0bWwgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMvdXRpbHMuanMnKSxcbiAgZmxvb3JIYWNrID0gdXRpbHMuZmxvb3JIYWNrO1xudmFyIEludGVydmFsVHJlZSA9IHJlcXVpcmUoJy4vdXRpbHMvSW50ZXJ2YWxUcmVlLmpzJykuSW50ZXJ2YWxUcmVlO1xudmFyIFJlbW90ZVRyYWNrID0gcmVxdWlyZSgnLi91dGlscy9SZW1vdGVUcmFjay5qcycpLlJlbW90ZVRyYWNrO1xuXG4vLyBJbnRlbmRlZCB0byBiZSBsb2FkZWQgaW50byBDdXN0b21UcmFjay50eXBlcy5iaWdiZWRcbnZhciBCaWdCZWRGb3JtYXQgPSB7XG4gIGRlZmF1bHRzOiB7XG4gICAgY2hyb21vc29tZXM6ICcnLFxuICAgIGl0ZW1SZ2I6ICdvZmYnLFxuICAgIGNvbG9yQnlTdHJhbmQ6ICcnLFxuICAgIHVzZVNjb3JlOiAwLFxuICAgIGdyb3VwOiAndXNlcicsXG4gICAgcHJpb3JpdHk6ICd1c2VyJyxcbiAgICBvZmZzZXQ6IDAsXG4gICAgZGV0YWlsOiBmYWxzZSxcbiAgICB1cmw6ICcnLFxuICAgIGh0bWxVcmw6ICcnLFxuICAgIGRyYXdMaW1pdDoge3NxdWlzaDogNTAwLCBwYWNrOiAxMDB9LFxuICAgIG1heEZldGNoV2luZG93OiAwXG4gIH0sXG5cbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLm9wdHMuYmlnRGF0YVVybCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUmVxdWlyZWQgcGFyYW1ldGVyIGJpZ0RhdGFVcmwgbm90IGZvdW5kIGZvciBiaWdCZWQgdHJhY2sgYXQgXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm9wdHMpICsgKHRoaXMub3B0cy5saW5lTnVtICsgMSkpO1xuICAgIH1cbiAgfSxcbiAgXG4gIHBhcnNlOiBmdW5jdGlvbihsaW5lcykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG1pZGRsZWlzaFBvcyA9IHNlbGYuYnJvd3Nlck9wdHMuZ2Vub21lU2l6ZSAvIDIsXG4gICAgICBjYWNoZSA9IG5ldyBJbnRlcnZhbFRyZWUoZmxvb3JIYWNrKG1pZGRsZWlzaFBvcyksIHtzdGFydEtleTogJ3N0YXJ0JywgZW5kS2V5OiAnZW5kJ30pLFxuICAgICAgYWpheFVybCA9IHNlbGYuYWpheERpcigpICsgJ2JpZ2JlZC5waHAnLFxuICAgICAgcmVtb3RlO1xuICAgIFxuICAgIHJlbW90ZSA9IG5ldyBSZW1vdGVUcmFjayhjYWNoZSwgZnVuY3Rpb24oc3RhcnQsIGVuZCwgc3RvcmVJbnRlcnZhbHMpIHtcbiAgICAgIHJhbmdlID0gc2VsZi5jaHJSYW5nZShzdGFydCwgZW5kKTtcbiAgICAgICQuYWpheChhamF4VXJsLCB7XG4gICAgICAgIGRhdGE6IHtyYW5nZTogcmFuZ2UsIHVybDogc2VsZi5vcHRzLmJpZ0RhdGFVcmwsIGRlbnNpdHk6ICdwYWNrJ30sXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICB2YXIgbGluZXMgPSBfLmZpbHRlcihkYXRhLnNwbGl0KCdcXG4nKSwgZnVuY3Rpb24obCkgeyB2YXIgbSA9IGwubWF0Y2goL1xcdC9nKTsgcmV0dXJuIG0gJiYgbS5sZW5ndGggPj0gMjsgfSk7XG4gICAgICAgICAgdmFyIGludGVydmFscyA9IF8ubWFwKGxpbmVzLCBmdW5jdGlvbihsKSB7IFxuICAgICAgICAgICAgdmFyIGl0dmwgPSBzZWxmLnR5cGUoJ2JlZCcpLnBhcnNlTGluZS5jYWxsKHNlbGYsIGwpOyBcbiAgICAgICAgICAgIC8vIFVzZSBCaW9QZXJsJ3MgQmlvOjpEQjpCaWdCZWQgc3RyYXRlZ3kgZm9yIGRlZHVwbGljYXRpbmcgcmUtZmV0Y2hlZCBpbnRlcnZhbHM6XG4gICAgICAgICAgICAvLyBcIkJlY2F1c2UgQkVEIGZpbGVzIGRvbid0IGFjdHVhbGx5IHVzZSBJRHMsIHRoZSBJRCBpcyBjb25zdHJ1Y3RlZCBmcm9tIHRoZSBmZWF0dXJlJ3MgbmFtZSAoaWYgYW55KSwgY2hyb21vc29tZSBjb29yZGluYXRlcywgc3RyYW5kIGFuZCBibG9jayBjb3VudC5cIlxuICAgICAgICAgICAgaWYgKF8uaXNVbmRlZmluZWQoaXR2bC5pZCkpIHtcbiAgICAgICAgICAgICAgaXR2bC5pZCA9IFtpdHZsLm5hbWUsIGl0dmwuY2hyb20sIGl0dmwuY2hyb21TdGFydCwgaXR2bC5jaHJvbUVuZCwgaXR2bC5zdHJhbmQsIGl0dmwuYmxvY2tDb3VudF0uam9pbihcIlxcdFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpdHZsO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHN0b3JlSW50ZXJ2YWxzKGludGVydmFscyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZGF0YSA9IHtjYWNoZTogY2FjaGUsIHJlbW90ZTogcmVtb3RlfTtcbiAgICBzZWxmLmhlaWdodHMgPSB7bWF4OiBudWxsLCBtaW46IDE1LCBzdGFydDogMTV9O1xuICAgIHNlbGYuc2l6ZXMgPSBbJ2RlbnNlJywgJ3NxdWlzaCcsICdwYWNrJ107XG4gICAgc2VsZi5tYXBTaXplcyA9IFsncGFjayddO1xuICAgIFxuICAgIC8vIEdldCBnZW5lcmFsIGluZm8gb24gdGhlIGJpZ0JlZCBhbmQgc2V0dXAgdGhlIGJpbm5pbmcgc2NoZW1lIGZvciB0aGUgUmVtb3RlVHJhY2tcbiAgICAkLmFqYXgoYWpheFVybCwge1xuICAgICAgZGF0YTogeyB1cmw6IHNlbGYub3B0cy5iaWdEYXRhVXJsIH0sXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIC8vIFNldCBtYXhGZXRjaFdpbmRvdyB0byBhdm9pZCBvdmVyZmV0Y2hpbmcgZGF0YS5cbiAgICAgICAgaWYgKCFzZWxmLm9wdHMubWF4RmV0Y2hXaW5kb3cpIHtcbiAgICAgICAgICB2YXIgbWVhbkl0ZW1zUGVyQnAgPSBkYXRhLml0ZW1Db3VudCAvIHNlbGYuYnJvd3Nlck9wdHMuZ2Vub21lU2l6ZSxcbiAgICAgICAgICAgIG1heEl0ZW1zVG9EcmF3ID0gXy5tYXgoXy52YWx1ZXMoc2VsZi5vcHRzLmRyYXdMaW1pdCkpO1xuICAgICAgICAgIHNlbGYub3B0cy5tYXhGZXRjaFdpbmRvdyA9IG1heEl0ZW1zVG9EcmF3IC8gbWVhbkl0ZW1zUGVyQnA7XG4gICAgICAgICAgc2VsZi5vcHRzLm9wdGltYWxGZXRjaFdpbmRvdyA9IE1hdGguZmxvb3Ioc2VsZi5vcHRzLm1heEZldGNoV2luZG93IC8gMyk7XG4gICAgICAgIH1cbiAgICAgICAgcmVtb3RlLnNldHVwQmlucyhzZWxmLmJyb3dzZXJPcHRzLmdlbm9tZVNpemUsIHNlbGYub3B0cy5vcHRpbWFsRmV0Y2hXaW5kb3csIHNlbGYub3B0cy5tYXhGZXRjaFdpbmRvdyk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgcHJlcmVuZGVyOiBmdW5jdGlvbihzdGFydCwgZW5kLCBkZW5zaXR5LCBwcmVjYWxjLCBjYWxsYmFjaykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIHdpZHRoID0gcHJlY2FsYy53aWR0aCxcbiAgICAgIGRhdGEgPSBzZWxmLmRhdGEsXG4gICAgICBicHBwID0gKGVuZCAtIHN0YXJ0KSAvIHdpZHRoLFxuICAgICAgcmFuZ2UgPSB0aGlzLmNoclJhbmdlKHN0YXJ0LCBlbmQpO1xuICAgIFxuICAgIGZ1bmN0aW9uIGxpbmVOdW0oZCwgc2V0VG8pIHtcbiAgICAgIHZhciBrZXkgPSBicHBwICsgJ18nICsgZGVuc2l0eTtcbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZChzZXRUbykpIHsgXG4gICAgICAgIGlmICghZC5saW5lKSB7IGQubGluZSA9IHt9OyB9XG4gICAgICAgIHJldHVybiAoZC5saW5lW2tleV0gPSBzZXRUbyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZC5saW5lICYmIGQubGluZVtrZXldOyBcbiAgICB9XG4gICAgXG4gICAgZnVuY3Rpb24gcGFyc2VEZW5zZURhdGEoZGF0YSkge1xuICAgICAgdmFyIGRyYXdTcGVjID0gW10sIFxuICAgICAgICBsaW5lcztcbiAgICAgIGxpbmVzID0gZGF0YS5zcGxpdCgvXFxzKy9nKTtcbiAgICAgIF8uZWFjaChsaW5lcywgZnVuY3Rpb24obGluZSwgeCkgeyBcbiAgICAgICAgaWYgKGxpbmUgIT0gJ24vYScgJiYgbGluZS5sZW5ndGgpIHsgZHJhd1NwZWMucHVzaCh7eDogeCwgdzogMSwgdjogcGFyc2VGbG9hdChsaW5lKSAqIDEwMDB9KTsgfSBcbiAgICAgIH0pO1xuICAgICAgY2FsbGJhY2soZHJhd1NwZWMpO1xuICAgIH1cbiAgICBcbiAgICAvLyBEb24ndCBldmVuIGF0dGVtcHQgdG8gZmV0Y2ggdGhlIGRhdGEgaWYgZGVuc2l0eSBpcyBub3QgJ2RlbnNlJyBhbmQgd2UgY2FuIHJlYXNvbmFibHlcbiAgICAvLyBlc3RpbWF0ZSB0aGF0IHdlIHdpbGwgZmV0Y2ggdG9vIG1hbnkgcm93cyAoPjUwMCBmZWF0dXJlcyksIGFzIHRoaXMgd2lsbCBvbmx5IGRlbGF5IG90aGVyIHJlcXVlc3RzLlxuICAgIGlmIChkZW5zaXR5ICE9ICdkZW5zZScgJiYgKGVuZCAtIHN0YXJ0KSA+IHNlbGYub3B0cy5tYXhGZXRjaFdpbmRvdykge1xuICAgICAgY2FsbGJhY2soe3Rvb01hbnk6IHRydWV9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGRlbnNpdHkgPT0gJ2RlbnNlJykge1xuICAgICAgICAkLmFqYXgoc2VsZi5hamF4RGlyKCkgKyAnYmlnYmVkLnBocCcsIHtcbiAgICAgICAgICBkYXRhOiB7cmFuZ2U6IHJhbmdlLCB1cmw6IHNlbGYub3B0cy5iaWdEYXRhVXJsLCB3aWR0aDogd2lkdGgsIGRlbnNpdHk6IGRlbnNpdHl9LFxuICAgICAgICAgIHN1Y2Nlc3M6IHBhcnNlRGVuc2VEYXRhXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZi5kYXRhLnJlbW90ZS5mZXRjaEFzeW5jKHN0YXJ0LCBlbmQsIGZ1bmN0aW9uKGludGVydmFscykge1xuICAgICAgICAgIHZhciBjYWxjUGl4SW50ZXJ2YWwsIGRyYXdTcGVjID0ge307XG4gICAgICAgICAgaWYgKGludGVydmFscy50b29NYW55KSB7IHJldHVybiBjYWxsYmFjayhpbnRlcnZhbHMpOyB9XG4gICAgICAgICAgY2FsY1BpeEludGVydmFsID0gbmV3IHV0aWxzLnBpeEludGVydmFsQ2FsY3VsYXRvcihzdGFydCwgd2lkdGgsIGJwcHAsIGRlbnNpdHkgPT0gJ3BhY2snKTtcbiAgICAgICAgICBkcmF3U3BlYy5sYXlvdXQgPSBzZWxmLnR5cGUoJ2JlZCcpLnN0YWNrZWRMYXlvdXQuY2FsbChzZWxmLCBpbnRlcnZhbHMsIHdpZHRoLCBjYWxjUGl4SW50ZXJ2YWwsIGxpbmVOdW0pO1xuICAgICAgICAgIGRyYXdTcGVjLndpZHRoID0gd2lkdGg7XG4gICAgICAgICAgY2FsbGJhY2soZHJhd1NwZWMpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbihjYW52YXMsIHN0YXJ0LCBlbmQsIGRlbnNpdHksIGNhbGxiYWNrKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHNlbGYucHJlcmVuZGVyKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHt3aWR0aDogY2FudmFzLndpZHRofSwgZnVuY3Rpb24oZHJhd1NwZWMpIHtcbiAgICAgIHNlbGYudHlwZSgnYmVkJykuZHJhd1NwZWMuY2FsbChzZWxmLCBjYW52YXMsIGRyYXdTcGVjLCBkZW5zaXR5KTtcbiAgICAgIGlmIChfLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7IGNhbGxiYWNrKCk7IH1cbiAgICB9KTtcbiAgfSxcbiAgXG4gIGxvYWRPcHRzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnYmVkJykubG9hZE9wdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSxcbiAgXG4gIHNhdmVPcHRzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnYmVkJykuc2F2ZU9wdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCaWdCZWRGb3JtYXQ7IiwiXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSBiaWdXaWcgZm9ybWF0OiBodHRwOi8vZ2Vub21lLnVjc2MuZWR1L2dvbGRlblBhdGgvaGVscC9iaWdXaWcuaHRtbCA9XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxudmFyIEJpZ1dpZ0Zvcm1hdCA9IHtcbiAgZGVmYXVsdHM6IHtcbiAgICBhbHRDb2xvcjogJzEyOCwxMjgsMTI4JyxcbiAgICBwcmlvcml0eTogMTAwLFxuICAgIGF1dG9TY2FsZTogJ29uJyxcbiAgICBhbHdheXNaZXJvOiAnb2ZmJyxcbiAgICBncmlkRGVmYXVsdDogJ29mZicsXG4gICAgbWF4SGVpZ2h0UGl4ZWxzOiAnMTI4OjEyODoxNScsXG4gICAgZ3JhcGhUeXBlOiAnYmFyJyxcbiAgICB2aWV3TGltaXRzOiAnJyxcbiAgICB5TGluZU1hcms6IDAuMCxcbiAgICB5TGluZU9uT2ZmOiAnb2ZmJyxcbiAgICB3aW5kb3dpbmdGdW5jdGlvbjogJ21heGltdW0nLFxuICAgIHNtb290aGluZ1dpbmRvdzogJ29mZidcbiAgfSxcblxuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMub3B0cy5iaWdEYXRhVXJsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSZXF1aXJlZCBwYXJhbWV0ZXIgYmlnRGF0YVVybCBub3QgZm91bmQgZm9yIGJpZ1dpZyB0cmFjayBhdCBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMub3B0cykgKyAodGhpcy5vcHRzLmxpbmVOdW0gKyAxKSk7XG4gICAgfVxuICAgIHRoaXMudHlwZSgnd2lnZ2xlXzAnKS5pbml0T3B0cy5jYWxsKHRoaXMpO1xuICB9LFxuICBcbiAgX2JpbkZ1bmN0aW9uczogeydtaW5pbXVtJzoxLCAnbWF4aW11bSc6MSwgJ21lYW4nOjEsICdtaW4nOjEsICdtYXgnOjEsICdzdGQnOjEsICdjb3ZlcmFnZSc6MX0sXG4gIFxuICBhcHBseU9wdHM6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy50eXBlKCd3aWdnbGVfMCcpLmFwcGx5T3B0cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9LFxuXG4gIHBhcnNlOiBmdW5jdGlvbihsaW5lcykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZWxmLnN0cmV0Y2hIZWlnaHQgPSB0cnVlO1xuICAgIHNlbGYucmFuZ2UgPSBzZWxmLmlzT24oc2VsZi5vcHRzLmFsd2F5c1plcm8pID8gWzAsIDBdIDogW0luZmluaXR5LCAtSW5maW5pdHldO1xuICAgICQuYWpheChzZWxmLmFqYXhEaXIoKSArICdiaWd3aWcucGhwJywge1xuICAgICAgZGF0YToge2luZm86IDEsIHVybDogdGhpcy5vcHRzLmJpZ0RhdGFVcmx9LFxuICAgICAgYXN5bmM6IGZhbHNlLCAgLy8gVGhpcyBpcyBjb29sIHNpbmNlIHBhcnNpbmcgbm9ybWFsbHkgaGFwcGVucyBpbiBhIFdlYiBXb3JrZXJcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdmFyIHJvd3MgPSBkYXRhLnNwbGl0KFwiXFxuXCIpO1xuICAgICAgICBfLmVhY2gocm93cywgZnVuY3Rpb24ocikge1xuICAgICAgICAgIHZhciBrZXl2YWwgPSByLnNwbGl0KCc6ICcpO1xuICAgICAgICAgIGlmIChrZXl2YWxbMF09PSdtaW4nKSB7IHNlbGYucmFuZ2VbMF0gPSBNYXRoLm1pbihwYXJzZUZsb2F0KGtleXZhbFsxXSksIHNlbGYucmFuZ2VbMF0pOyB9XG4gICAgICAgICAgaWYgKGtleXZhbFswXT09J21heCcpIHsgc2VsZi5yYW5nZVsxXSA9IE1hdGgubWF4KHBhcnNlRmxvYXQoa2V5dmFsWzFdKSwgc2VsZi5yYW5nZVsxXSk7IH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgc2VsZi50eXBlKCd3aWdnbGVfMCcpLmFwcGx5T3B0cy5hcHBseShzZWxmKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxuICBwcmVyZW5kZXI6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHByZWNhbGMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgd2lkdGggPSBwcmVjYWxjLndpZHRoLFxuICAgICAgY2hyUmFuZ2UgPSBzZWxmLmNoclJhbmdlKHN0YXJ0LCBlbmQpO1xuICBcbiAgICBmdW5jdGlvbiBzdWNjZXNzKGRhdGEpIHtcbiAgICAgIHZhciBkcmF3U3BlYyA9IHNlbGYudHlwZSgnd2lnZ2xlXzAnKS5pbml0RHJhd1NwZWMuY2FsbChzZWxmLCBwcmVjYWxjKSxcbiAgICAgICAgbGluZXMgPSBkYXRhLnNwbGl0KC9cXHMrL2cpO1xuICAgICAgXy5lYWNoKGxpbmVzLCBmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgIGlmIChsaW5lID09ICduL2EnKSB7IGRyYXdTcGVjLmJhcnMucHVzaChudWxsKTsgfVxuICAgICAgICBlbHNlIGlmIChsaW5lLmxlbmd0aCkgeyBkcmF3U3BlYy5iYXJzLnB1c2goKHBhcnNlRmxvYXQobGluZSkgLSBzZWxmLmRyYXdSYW5nZVswXSkgLyBkcmF3U3BlYy52U2NhbGUpOyB9XG4gICAgICB9KTtcbiAgICAgIGNhbGxiYWNrKGRyYXdTcGVjKTtcbiAgICB9XG4gIFxuICAgICQuYWpheChzZWxmLmFqYXhEaXIoKSArICdiaWd3aWcucGhwJywge1xuICAgICAgZGF0YToge3JhbmdlOiBjaHJSYW5nZSwgdXJsOiBzZWxmLm9wdHMuYmlnRGF0YVVybCwgd2lkdGg6IHdpZHRoLCB3aW5GdW5jOiBzZWxmLm9wdHMud2luZG93aW5nRnVuY3Rpb259LFxuICAgICAgc3VjY2Vzczogc3VjY2Vzc1xuICAgIH0pO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oY2FudmFzLCBzdGFydCwgZW5kLCBkZW5zaXR5LCBjYWxsYmFjaykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIGhlaWdodCA9IGNhbnZhcy5oZWlnaHQsXG4gICAgICB3aWR0aCA9IGNhbnZhcy53aWR0aCxcbiAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0ICYmIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIGlmICghY3R4KSB7IHRocm93IFwiQ2FudmFzIG5vdCBzdXBwb3J0ZWRcIjsgfVxuICAgIHNlbGYucHJlcmVuZGVyKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHt3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0fSwgZnVuY3Rpb24oZHJhd1NwZWMpIHtcbiAgICAgIHNlbGYudHlwZSgnd2lnZ2xlXzAnKS5kcmF3QmFycy5jYWxsKHNlbGYsIGN0eCwgZHJhd1NwZWMsIGhlaWdodCwgd2lkdGgpO1xuICAgICAgXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSAmJiBjYWxsYmFjaygpO1xuICAgIH0pO1xuICB9LFxuXG4gIGxvYWRPcHRzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnd2lnZ2xlXzAnKS5sb2FkT3B0cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9LFxuXG4gIHNhdmVPcHRzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnd2lnZ2xlXzAnKS5zYXZlT3B0cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJpZ1dpZ0Zvcm1hdDsiLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9IGZlYXR1cmVUYWJsZSBmb3JtYXQ6IGh0dHA6Ly93d3cuaW5zZGMub3JnL2ZpbGVzL2ZlYXR1cmVfdGFibGUuaHRtbCA9XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbnZhciBJbnRlcnZhbFRyZWUgPSByZXF1aXJlKCcuL3V0aWxzL0ludGVydmFsVHJlZS5qcycpLkludGVydmFsVHJlZTtcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMvdXRpbHMuanMnKSxcbiAgc3RyaXAgPSB1dGlscy5zdHJpcCxcbiAgZmxvb3JIYWNrID0gdXRpbHMuZmxvb3JIYWNrLFxuICBwYXJzZUludDEwID0gdXRpbHMucGFyc2VJbnQxMDtcblxuLy8gSW50ZW5kZWQgdG8gYmUgbG9hZGVkIGludG8gQ3VzdG9tVHJhY2sudHlwZXMuZmVhdHVyZXRhYmxlXG52YXIgRmVhdHVyZVRhYmxlRm9ybWF0ID0ge1xuICBkZWZhdWx0czoge1xuICAgIGNvbGxhcHNlQnlHZW5lOiAnb2ZmJyxcbiAgICBrZXlDb2x1bW5XaWR0aDogMjEsXG4gICAgaXRlbVJnYjogJ29mZicsXG4gICAgY29sb3JCeVN0cmFuZDogJycsXG4gICAgdXNlU2NvcmU6IDAsXG4gICAgZ3JvdXA6ICd1c2VyJyxcbiAgICBwcmlvcml0eTogJ3VzZXInLFxuICAgIG9mZnNldDogMCxcbiAgICB1cmw6ICcnLFxuICAgIGh0bWxVcmw6ICcnLFxuICAgIGRyYXdMaW1pdDoge3NxdWlzaDogbnVsbCwgcGFjazogbnVsbH1cbiAgfSxcbiAgXG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudHlwZSgnYmVkJykuaW5pdE9wdHMuY2FsbCh0aGlzKTtcbiAgICB0aGlzLm9wdHMuY29sbGFwc2VCeUdlbmUgPSB0aGlzLmlzT24odGhpcy5vcHRzLmNvbGxhcHNlQnlHZW5lKTtcbiAgICB0aGlzLmZlYXR1cmVUeXBlQ291bnRzID0ge307XG4gIH0sXG4gIFxuICAvLyBwYXJzZXMgb25lIGZlYXR1cmUga2V5ICsgbG9jYXRpb24vcXVhbGlmaWVycyByb3cgZnJvbSB0aGUgZmVhdHVyZSB0YWJsZVxuICBwYXJzZUVudHJ5OiBmdW5jdGlvbihjaHJvbSwgbGluZXMsIHN0YXJ0TGluZU5vKSB7XG4gICAgdmFyIGZlYXR1cmUgPSB7XG4gICAgICAgIGNocm9tOiBjaHJvbSxcbiAgICAgICAgc2NvcmU6ICc/JyxcbiAgICAgICAgYmxvY2tzOiBudWxsLFxuICAgICAgICBxdWFsaWZpZXJzOiB7fVxuICAgICAgfSxcbiAgICAgIGtleUNvbHVtbldpZHRoID0gdGhpcy5vcHRzLmtleUNvbHVtbldpZHRoLFxuICAgICAgcXVhbGlmaWVyID0gbnVsbCxcbiAgICAgIGZ1bGxMb2NhdGlvbiA9IFtdLFxuICAgICAgY29sbGFwc2VLZXlRdWFsaWZpZXJzID0gWydsb2N1c190YWcnLCAnZ2VuZScsICdkYl94cmVmJ10sXG4gICAgICBxdWFsaWZpZXJzVGhhdEFyZU5hbWVzID0gWydnZW5lJywgJ2xvY3VzX3RhZycsICdkYl94cmVmJ10sXG4gICAgICBSTkFUeXBlcyA9IFsncnJuYScsICd0cm5hJ10sXG4gICAgICBhbHNvVHJ5Rm9yUk5BVHlwZXMgPSBbJ3Byb2R1Y3QnXSxcbiAgICAgIGxvY2F0aW9uUG9zaXRpb25zLCBjaHJQb3MsIGJsb2NrU2l6ZXM7XG4gICAgXG4gICAgY2hyUG9zID0gdGhpcy5icm93c2VyT3B0cy5jaHJQb3NbY2hyb21dO1xuICAgIHN0YXJ0TGluZU5vID0gc3RhcnRMaW5lTm8gfHwgMDtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChjaHJQb3MpKSB7XG4gICAgICB0aGlzLndhcm4oXCJJbnZhbGlkIGNocm9tb3NvbWUgYXQgbGluZSBcIiArIChsaW5lbm8gKyAxICsgdGhpcy5vcHRzLmxpbmVOdW0pKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBcbiAgICAvLyBmaWxsIG91dCBmZWF0dXJlJ3Mga2V5cyB3aXRoIGluZm8gZnJvbSB0aGVzZSBsaW5lc1xuICAgIF8uZWFjaChsaW5lcywgZnVuY3Rpb24obGluZSwgbGluZW5vKSB7XG4gICAgICB2YXIga2V5ID0gbGluZS5zdWJzdHIoMCwga2V5Q29sdW1uV2lkdGgpLFxuICAgICAgICByZXN0T2ZMaW5lID0gbGluZS5zdWJzdHIoa2V5Q29sdW1uV2lkdGgpLFxuICAgICAgICBxdWFsaWZpZXJNYXRjaCA9IHJlc3RPZkxpbmUubWF0Y2goL15cXC8oXFx3KykoPT8pKC4qKS8pO1xuICAgICAgaWYgKGtleS5tYXRjaCgvXFx3LykpIHtcbiAgICAgICAgZmVhdHVyZS50eXBlID0gc3RyaXAoa2V5KTtcbiAgICAgICAgcXVhbGlmaWVyID0gbnVsbDtcbiAgICAgICAgZnVsbExvY2F0aW9uLnB1c2gocmVzdE9mTGluZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAocXVhbGlmaWVyTWF0Y2gpIHtcbiAgICAgICAgICBxdWFsaWZpZXIgPSBxdWFsaWZpZXJNYXRjaFsxXTtcbiAgICAgICAgICBpZiAoIWZlYXR1cmUucXVhbGlmaWVyc1txdWFsaWZpZXJdKSB7IGZlYXR1cmUucXVhbGlmaWVyc1txdWFsaWZpZXJdID0gW107IH1cbiAgICAgICAgICBmZWF0dXJlLnF1YWxpZmllcnNbcXVhbGlmaWVyXS5wdXNoKFtxdWFsaWZpZXJNYXRjaFsyXSA/IHF1YWxpZmllck1hdGNoWzNdIDogdHJ1ZV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChxdWFsaWZpZXIgIT09IG51bGwpIHsgXG4gICAgICAgICAgICBfLmxhc3QoZmVhdHVyZS5xdWFsaWZpZXJzW3F1YWxpZmllcl0pLnB1c2gocmVzdE9mTGluZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZ1bGxMb2NhdGlvbi5wdXNoKHJlc3RPZkxpbmUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIGZlYXR1cmUuZnVsbExvY2F0aW9uID0gZnVsbExvY2F0aW9uID0gZnVsbExvY2F0aW9uLmpvaW4oJycpO1xuICAgIGxvY2F0aW9uUG9zaXRpb25zID0gXy5tYXAoXy5maWx0ZXIoZnVsbExvY2F0aW9uLnNwbGl0KC9cXEQrLyksIF8uaWRlbnRpdHkpLCBwYXJzZUludDEwKTtcbiAgICBmZWF0dXJlLmNocm9tU3RhcnQgPSAgXy5taW4obG9jYXRpb25Qb3NpdGlvbnMpO1xuICAgIGZlYXR1cmUuY2hyb21FbmQgPSBfLm1heChsb2NhdGlvblBvc2l0aW9ucykgKyAxOyAvLyBGZWF0dXJlIHRhYmxlIHJhbmdlcyBhcmUgKmluY2x1c2l2ZSogb2YgdGhlIGVuZCBiYXNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNocm9tRW5kIGNvbHVtbnMgaW4gQkVEIGZvcm1hdCBhcmUgKm5vdCouXG4gICAgZmVhdHVyZS5zdGFydCA9IGNoclBvcyArIGZlYXR1cmUuY2hyb21TdGFydDtcbiAgICBmZWF0dXJlLmVuZCA9IGNoclBvcyArIGZlYXR1cmUuY2hyb21FbmQ7IFxuICAgIGZlYXR1cmUuc3RyYW5kID0gL2NvbXBsZW1lbnQvLnRlc3QoZnVsbExvY2F0aW9uKSA/IFwiLVwiIDogXCIrXCI7XG4gICAgXG4gICAgLy8gVW50aWwgd2UgbWVyZ2UgYnkgZ2VuZSBuYW1lLCB3ZSBkb24ndCBjYXJlIGFib3V0IHRoZXNlXG4gICAgZmVhdHVyZS50aGlja1N0YXJ0ID0gZmVhdHVyZS50aGlja0VuZCA9IG51bGw7XG4gICAgZmVhdHVyZS5ibG9ja3MgPSBudWxsO1xuICAgIFxuICAgIC8vIFBhcnNlIHRoZSBxdWFsaWZpZXJzIHByb3Blcmx5XG4gICAgXy5lYWNoKGZlYXR1cmUucXVhbGlmaWVycywgZnVuY3Rpb24odiwgaykge1xuICAgICAgXy5lYWNoKHYsIGZ1bmN0aW9uKGVudHJ5TGluZXMsIGkpIHtcbiAgICAgICAgdltpXSA9IHN0cmlwKGVudHJ5TGluZXMuam9pbignICcpKTtcbiAgICAgICAgaWYgKC9eXCJbXFxzXFxTXSpcIiQvLnRlc3QodltpXSkpIHtcbiAgICAgICAgICAvLyBEZXF1b3RlIGZyZWUgdGV4dFxuICAgICAgICAgIHZbaV0gPSB2W2ldLnJlcGxhY2UoL15cInxcIiQvZywgJycpLnJlcGxhY2UoL1wiXCIvZywgJ1wiJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy9pZiAodi5sZW5ndGggPT0gMSkgeyBmZWF0dXJlLnF1YWxpZmllcnNba10gPSB2WzBdOyB9XG4gICAgfSk7XG4gICAgXG4gICAgLy8gRmluZCBzb21ldGhpbmcgdGhhdCBjYW4gc2VydmUgYXMgYSBuYW1lXG4gICAgZmVhdHVyZS5uYW1lID0gZmVhdHVyZS50eXBlO1xuICAgIGlmIChfLmNvbnRhaW5zKFJOQVR5cGVzLCBmZWF0dXJlLnR5cGUudG9Mb3dlckNhc2UoKSkpIHsgXG4gICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShxdWFsaWZpZXJzVGhhdEFyZU5hbWVzLCBhbHNvVHJ5Rm9yUk5BVHlwZXMpOyBcbiAgICB9XG4gICAgXy5maW5kKHF1YWxpZmllcnNUaGF0QXJlTmFtZXMsIGZ1bmN0aW9uKGspIHtcbiAgICAgIGlmIChmZWF0dXJlLnF1YWxpZmllcnNba10gJiYgZmVhdHVyZS5xdWFsaWZpZXJzW2tdWzBdKSB7IHJldHVybiAoZmVhdHVyZS5uYW1lID0gZmVhdHVyZS5xdWFsaWZpZXJzW2tdWzBdKTsgfVxuICAgIH0pO1xuICAgIC8vIEluIHRoZSB3b3JzdCBjYXNlLCBhZGQgYSBjb3VudGVyIHRvIGRpc2FtYmlndWF0ZSBmZWF0dXJlcyBuYW1lZCBvbmx5IGJ5IHR5cGVcbiAgICBpZiAoZmVhdHVyZS5uYW1lID09IGZlYXR1cmUudHlwZSkge1xuICAgICAgaWYgKCF0aGlzLmZlYXR1cmVUeXBlQ291bnRzW2ZlYXR1cmUudHlwZV0pIHsgdGhpcy5mZWF0dXJlVHlwZUNvdW50c1tmZWF0dXJlLnR5cGVdID0gMTsgfVxuICAgICAgZmVhdHVyZS5uYW1lID0gZmVhdHVyZS5uYW1lICsgJ18nICsgdGhpcy5mZWF0dXJlVHlwZUNvdW50c1tmZWF0dXJlLnR5cGVdKys7XG4gICAgfVxuICAgIFxuICAgIC8vIEZpbmQgYSBrZXkgdGhhdCBpcyBhcHByb3ByaWF0ZSBmb3IgY29sbGFwc2luZ1xuICAgIGlmICh0aGlzLm9wdHMuY29sbGFwc2VCeUdlbmUpIHtcbiAgICAgIF8uZmluZChjb2xsYXBzZUtleVF1YWxpZmllcnMsIGZ1bmN0aW9uKGspIHtcbiAgICAgICAgaWYgKGZlYXR1cmUucXVhbGlmaWVyc1trXSAmJiBmZWF0dXJlLnF1YWxpZmllcnNba11bMF0pIHsgXG4gICAgICAgICAgcmV0dXJuIChmZWF0dXJlLl9jb2xsYXBzZUtleSA9IGZlYXR1cmUucXVhbGlmaWVyc1trXVswXSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZmVhdHVyZTtcbiAgfSxcbiAgXG4gIC8vIGNvbGxhcHNlcyBtdWx0aXBsZSBmZWF0dXJlcyB0aGF0IGFyZSBhYm91dCB0aGUgc2FtZSBnZW5lIGludG8gb25lIGRyYXdhYmxlIGZlYXR1cmVcbiAgY29sbGFwc2VGZWF0dXJlczogZnVuY3Rpb24oZmVhdHVyZXMpIHtcbiAgICB2YXIgY2hyUG9zID0gdGhpcy5icm93c2VyT3B0cy5jaHJQb3MsXG4gICAgICBwcmVmZXJyZWRUeXBlVG9NZXJnZUludG8gPSBbJ21ybmEnLCAnZ2VuZScsICdjZHMnXSxcbiAgICAgIHByZWZlcnJlZFR5cGVGb3JFeG9ucyA9IFsnZXhvbicsICdjZHMnXSxcbiAgICAgIG1lcmdlSW50byA9IGZlYXR1cmVzWzBdLFxuICAgICAgYmxvY2tzID0gW10sXG4gICAgICBmb3VuZFR5cGUsIGNkcywgZXhvbnM7XG4gICAgZm91bmRUeXBlID0gXy5maW5kKHByZWZlcnJlZFR5cGVUb01lcmdlSW50bywgZnVuY3Rpb24odHlwZSkge1xuICAgICAgdmFyIGZvdW5kID0gXy5maW5kKGZlYXR1cmVzLCBmdW5jdGlvbihmZWF0KSB7IHJldHVybiBmZWF0LnR5cGUudG9Mb3dlckNhc2UoKSA9PSB0eXBlOyB9KTtcbiAgICAgIGlmIChmb3VuZCkgeyBtZXJnZUludG8gPSBmb3VuZDsgcmV0dXJuIHRydWU7IH1cbiAgICB9KTtcbiAgICBcbiAgICAvLyBMb29rIGZvciBleG9ucyAoZXVrYXJ5b3RpYykgb3IgYSBDRFMgKHByb2thcnlvdGljKVxuICAgIF8uZmluZChwcmVmZXJyZWRUeXBlRm9yRXhvbnMsIGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgIGV4b25zID0gXy5zZWxlY3QoZmVhdHVyZXMsIGZ1bmN0aW9uKGZlYXQpIHsgcmV0dXJuIGZlYXQudHlwZS50b0xvd2VyQ2FzZSgpID09IHR5cGU7IH0pO1xuICAgICAgaWYgKGV4b25zLmxlbmd0aCkgeyByZXR1cm4gdHJ1ZTsgfVxuICAgIH0pO1xuICAgIGNkcyA9IF8uZmluZChmZWF0dXJlcywgZnVuY3Rpb24oZmVhdCkgeyByZXR1cm4gZmVhdC50eXBlLnRvTG93ZXJDYXNlKCkgPT0gXCJjZHNcIjsgfSk7XG4gICAgXG4gICAgXy5lYWNoKGV4b25zLCBmdW5jdGlvbihleG9uRmVhdHVyZSkge1xuICAgICAgZXhvbkZlYXR1cmUuZnVsbExvY2F0aW9uLnJlcGxhY2UoLyhcXGQrKVxcLlxcLls+PF0/KFxcZCspL2csIGZ1bmN0aW9uKGZ1bGxNYXRjaCwgc3RhcnQsIGVuZCkge1xuICAgICAgICBibG9ja3MucHVzaCh7XG4gICAgICAgICAgc3RhcnQ6IGNoclBvc1tleG9uRmVhdHVyZS5jaHJvbV0gKyBNYXRoLm1pbihzdGFydCwgZW5kKSwgXG4gICAgICAgICAgLy8gRmVhdHVyZSB0YWJsZSByYW5nZXMgYXJlICppbmNsdXNpdmUqIG9mIHRoZSBlbmQgYmFzZS5cbiAgICAgICAgICBlbmQ6IGNoclBvc1tleG9uRmVhdHVyZS5jaHJvbV0gKyAgTWF0aC5tYXgoc3RhcnQsIGVuZCkgKyAxXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgXG4gICAgLy8gQ29udmVydCBleG9ucyBhbmQgQ0RTIGludG8gYmxvY2tzLCB0aGlja1N0YXJ0IGFuZCB0aGlja0VuZCAoaW4gQkVEIHRlcm1pbm9sb2d5KVxuICAgIGlmIChibG9ja3MubGVuZ3RoKSB7IFxuICAgICAgbWVyZ2VJbnRvLmJsb2NrcyA9IF8uc29ydEJ5KGJsb2NrcywgZnVuY3Rpb24oYikgeyByZXR1cm4gYi5zdGFydDsgfSk7XG4gICAgICBtZXJnZUludG8udGhpY2tTdGFydCA9IGNkcyA/IGNkcy5zdGFydCA6IGZlYXR1cmUuc3RhcnQ7XG4gICAgICBtZXJnZUludG8udGhpY2tFbmQgPSBjZHMgPyBjZHMuZW5kIDogZmVhdHVyZS5lbmQ7XG4gICAgfVxuICAgIFxuICAgIC8vIGZpbmFsbHksIG1lcmdlIGFsbCB0aGUgcXVhbGlmaWVyc1xuICAgIF8uZWFjaChmZWF0dXJlcywgZnVuY3Rpb24oZmVhdCkge1xuICAgICAgaWYgKGZlYXQgPT09IG1lcmdlSW50bykgeyByZXR1cm47IH1cbiAgICAgIF8uZWFjaChmZWF0LnF1YWxpZmllcnMsIGZ1bmN0aW9uKHZhbHVlcywgaykge1xuICAgICAgICBpZiAoIW1lcmdlSW50by5xdWFsaWZpZXJzW2tdKSB7IG1lcmdlSW50by5xdWFsaWZpZXJzW2tdID0gW107IH1cbiAgICAgICAgXy5lYWNoKHZhbHVlcywgZnVuY3Rpb24odikge1xuICAgICAgICAgIGlmICghXy5jb250YWlucyhtZXJnZUludG8ucXVhbGlmaWVyc1trXSwgdikpIHsgbWVyZ2VJbnRvLnF1YWxpZmllcnNba10ucHVzaCh2KTsgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiBtZXJnZUludG87XG4gIH0sXG5cbiAgcGFyc2U6IGZ1bmN0aW9uKGxpbmVzKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgbyA9IHNlbGYub3B0cyxcbiAgICAgIG1pZGRsZWlzaFBvcyA9IHRoaXMuYnJvd3Nlck9wdHMuZ2Vub21lU2l6ZSAvIDIsXG4gICAgICBkYXRhID0gbmV3IEludGVydmFsVHJlZShmbG9vckhhY2sobWlkZGxlaXNoUG9zKSwge3N0YXJ0S2V5OiAnc3RhcnQnLCBlbmRLZXk6ICdlbmQnfSksXG4gICAgICBudW1MaW5lcyA9IGxpbmVzLmxlbmd0aCxcbiAgICAgIGNocm9tID0gbnVsbCxcbiAgICAgIGxhc3RFbnRyeVN0YXJ0ID0gbnVsbCxcbiAgICAgIGZlYXR1cmVzQnlDb2xsYXBzZUtleSA9IHt9LFxuICAgICAgZmVhdHVyZTtcbiAgICBcbiAgICBmdW5jdGlvbiBjb2xsZWN0TGFzdEVudHJ5KGxpbmVubykge1xuICAgICAgaWYgKGxhc3RFbnRyeVN0YXJ0ICE9PSBudWxsKSB7XG4gICAgICAgIGZlYXR1cmUgPSBzZWxmLnR5cGUoKS5wYXJzZUVudHJ5LmNhbGwoc2VsZiwgY2hyb20sIGxpbmVzLnNsaWNlKGxhc3RFbnRyeVN0YXJ0LCBsaW5lbm8pLCBsYXN0RW50cnlTdGFydCk7XG4gICAgICAgIGlmIChmZWF0dXJlKSB7IFxuICAgICAgICAgIGlmIChvLmNvbGxhcHNlQnlHZW5lKSB7XG4gICAgICAgICAgICBmZWF0dXJlc0J5Q29sbGFwc2VLZXlbZmVhdHVyZS5fY29sbGFwc2VLZXldID0gZmVhdHVyZXNCeUNvbGxhcHNlS2V5W2ZlYXR1cmUuX2NvbGxhcHNlS2V5XSB8fCBbXTtcbiAgICAgICAgICAgIGZlYXR1cmVzQnlDb2xsYXBzZUtleVtmZWF0dXJlLl9jb2xsYXBzZUtleV0ucHVzaChmZWF0dXJlKTtcbiAgICAgICAgICB9IGVsc2UgeyBkYXRhLmFkZChmZWF0dXJlKTsgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIENodW5rIHRoZSBsaW5lcyBpbnRvIGVudHJpZXMgYW5kIHBhcnNlIGVhY2ggb2YgdGhlbVxuICAgIF8uZWFjaChsaW5lcywgZnVuY3Rpb24obGluZSwgbGluZW5vKSB7XG4gICAgICBpZiAobGluZS5zdWJzdHIoMCwgMTIpID09IFwiQUNDRVNTSU9OICAgXCIpIHtcbiAgICAgICAgY29sbGVjdExhc3RFbnRyeShsaW5lbm8pO1xuICAgICAgICBjaHJvbSA9IGxpbmUuc3Vic3RyKDEyKTtcbiAgICAgICAgbGFzdEVudHJ5U3RhcnQgPSBudWxsO1xuICAgICAgfSBlbHNlIGlmIChjaHJvbSAhPT0gbnVsbCAmJiBsaW5lLnN1YnN0cig1LCAxKS5tYXRjaCgvXFx3LykpIHtcbiAgICAgICAgY29sbGVjdExhc3RFbnRyeShsaW5lbm8pO1xuICAgICAgICBsYXN0RW50cnlTdGFydCA9IGxpbmVubztcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBwYXJzZSB0aGUgbGFzdCBlbnRyeVxuICAgIGlmIChjaHJvbSAhPT0gbnVsbCkgeyBjb2xsZWN0TGFzdEVudHJ5KGxpbmVzLmxlbmd0aCk7IH1cbiAgICBcbiAgICBpZiAoby5jb2xsYXBzZUJ5R2VuZSkge1xuICAgICAgXy5lYWNoKGZlYXR1cmVzQnlDb2xsYXBzZUtleSwgZnVuY3Rpb24oZmVhdHVyZXMsIGdlbmUpIHtcbiAgICAgICAgZGF0YS5hZGQoc2VsZi50eXBlKCkuY29sbGFwc2VGZWF0dXJlcy5jYWxsKHNlbGYsIGZlYXR1cmVzKSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgc2VsZi5kYXRhID0gZGF0YTtcbiAgICBzZWxmLmhlaWdodHMgPSB7bWF4OiBudWxsLCBtaW46IDE1LCBzdGFydDogMTV9O1xuICAgIHNlbGYuc2l6ZXMgPSBbJ2RlbnNlJywgJ3NxdWlzaCcsICdwYWNrJ107XG4gICAgc2VsZi5tYXBTaXplcyA9IFsncGFjayddO1xuICAgIHJldHVybiB0cnVlO1xuICB9LFxuICBcbiAgLy8gc3BlY2lhbCBmb3JtYXR0ZXIgZm9yIGNvbnRlbnQgaW4gdG9vbHRpcHMgZm9yIGZlYXR1cmVzXG4gIHRpcFRpcERhdGE6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICB2YXIgcXVhbGlmaWVyc1RvQWJicmV2aWF0ZSA9IHt0cmFuc2xhdGlvbjogMX0sXG4gICAgICBjb250ZW50ID0ge1xuICAgICAgICB0eXBlOiBkYXRhLmQudHlwZSxcbiAgICAgICAgcG9zaXRpb246IGRhdGEuZC5jaHJvbSArICc6JyArIGRhdGEuZC5jaHJvbVN0YXJ0LCBcbiAgICAgICAgc2l6ZTogZGF0YS5kLmNocm9tRW5kIC0gZGF0YS5kLmNocm9tU3RhcnRcbiAgICAgIH07XG4gICAgaWYgKGRhdGEuZC5xdWFsaWZpZXJzLm5vdGUgJiYgZGF0YS5kLnF1YWxpZmllcnMubm90ZVswXSkgeyAgfVxuICAgIF8uZWFjaChkYXRhLmQucXVhbGlmaWVycywgZnVuY3Rpb24odiwgaykge1xuICAgICAgaWYgKGsgPT0gJ25vdGUnKSB7IGNvbnRlbnQuZGVzY3JpcHRpb24gPSB2LmpvaW4oJzsgJyk7IHJldHVybjsgfVxuICAgICAgY29udGVudFtrXSA9IHYuam9pbignOyAnKTtcbiAgICAgIGlmIChxdWFsaWZpZXJzVG9BYmJyZXZpYXRlW2tdICYmIGNvbnRlbnRba10ubGVuZ3RoID4gMjUpIHsgY29udGVudFtrXSA9IGNvbnRlbnRba10uc3Vic3RyKDAsIDI1KSArICcuLi4nOyB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGNvbnRlbnQ7XG4gIH0sXG4gIFxuICBwcmVyZW5kZXI6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGRlbnNpdHksIHByZWNhbGMsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHRoaXMudHlwZSgnYmVkJykucHJlcmVuZGVyLmNhbGwodGhpcywgc3RhcnQsIGVuZCwgZGVuc2l0eSwgcHJlY2FsYywgY2FsbGJhY2spO1xuICB9LFxuICBcbiAgZHJhd1NwZWM6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy50eXBlKCdiZWQnKS5kcmF3U3BlYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9LFxuICBcbiAgcmVuZGVyOiBmdW5jdGlvbihjYW52YXMsIHN0YXJ0LCBlbmQsIGRlbnNpdHksIGNhbGxiYWNrKSB7XG4gICAgdGhpcy50eXBlKCdiZWQnKS5yZW5kZXIuY2FsbCh0aGlzLCBjYW52YXMsIHN0YXJ0LCBlbmQsIGRlbnNpdHksIGNhbGxiYWNrKTtcbiAgfSxcbiAgXG4gIGxvYWRPcHRzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnYmVkJykubG9hZE9wdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSxcbiAgXG4gIHNhdmVPcHRzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHlwZSgnYmVkJykuc2F2ZU9wdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBGZWF0dXJlVGFibGVGb3JtYXQ7IiwiKGZ1bmN0aW9uKGV4cG9ydHMpe1xuICBcbnZhciBTb3J0ZWRMaXN0ID0gcmVxdWlyZSgnLi9Tb3J0ZWRMaXN0LmpzJykuU29ydGVkTGlzdDsgIFxuXG4vLyBUT0RPOiBiYWNrcG9ydCB0aGlzIGNvZGUgZm9yIEphdmFTY3JpcHQgMS41PyB1c2luZyB1bmRlcnNjb3JlLmpzXG4vKipcbiAqIEJ5IFNoaW4gU3V6dWtpLCBNSVQgbGljZW5zZVxuICogaHR0cHM6Ly9naXRodWIuY29tL3NoaW5vdXQvaW50ZXJ2YWwtdHJlZVxuICogSW50ZXJ2YWxUcmVlXG4gKlxuICogQHBhcmFtIChvYmplY3QpIGRhdGE6XG4gKiBAcGFyYW0gKG51bWJlcikgY2VudGVyOlxuICogQHBhcmFtIChvYmplY3QpIG9wdGlvbnM6XG4gKiAgIGNlbnRlcjpcbiAqXG4gKiovXG5mdW5jdGlvbiBJbnRlcnZhbFRyZWUoY2VudGVyLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7XG5cbiAgdGhpcy5zdGFydEtleSAgICAgPSBvcHRpb25zLnN0YXJ0S2V5IHx8IDA7IC8vIHN0YXJ0IGtleVxuICB0aGlzLmVuZEtleSAgICAgICA9IG9wdGlvbnMuZW5kS2V5ICAgfHwgMTsgLy8gZW5kIGtleVxuICB0aGlzLmludGVydmFsSGFzaCA9IHt9OyAgICAgICAgICAgICAgICAgICAgLy8gaWQgPT4gaW50ZXJ2YWwgb2JqZWN0XG4gIHRoaXMucG9pbnRUcmVlID0gbmV3IFNvcnRlZExpc3QoeyAgICAgICAgICAvLyBiLXRyZWUgb2Ygc3RhcnQsIGVuZCBwb2ludHMgXG4gICAgY29tcGFyZTogZnVuY3Rpb24oYSwgYikge1xuICAgICAgaWYgKGEgPT0gbnVsbCkgcmV0dXJuIC0xO1xuICAgICAgaWYgKGIgPT0gbnVsbCkgcmV0dXJuICAxO1xuICAgICAgdmFyIGMgPSBhWzBdLSBiWzBdO1xuICAgICAgcmV0dXJuIChjID4gMCkgPyAxIDogKGMgPT0gMCkgID8gMCA6IC0xO1xuICAgIH1cbiAgfSk7XG5cbiAgdGhpcy5fYXV0b0luY3JlbWVudCA9IDA7XG5cbiAgLy8gaW5kZXggb2YgdGhlIHJvb3Qgbm9kZVxuICBpZiAoIWNlbnRlciB8fCB0eXBlb2YgY2VudGVyICE9ICdudW1iZXInKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCd5b3UgbXVzdCBzcGVjaWZ5IGNlbnRlciBpbmRleCBhcyB0aGUgMm5kIGFyZ3VtZW50LicpO1xuICB9XG5cbiAgdGhpcy5yb290ID0gbmV3IE5vZGUoY2VudGVyLCB0aGlzKTtcbn1cblxuXG4vKipcbiAqIHB1YmxpYyBtZXRob2RzXG4gKiovXG5cblxuLyoqXG4gKiBhZGQgbmV3IHJhbmdlXG4gKiovXG5JbnRlcnZhbFRyZWUucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKGRhdGEsIGlkKSB7XG4gIGlmICh0aGlzLmNvbnRhaW5zKGlkKSkge1xuICAgIHRocm93IG5ldyBEdXBsaWNhdGVFcnJvcignaWQgJyArIGlkICsgJyBpcyBhbHJlYWR5IHJlZ2lzdGVyZWQuJyk7XG4gIH1cblxuICBpZiAoaWQgPT0gdW5kZWZpbmVkKSB7XG4gICAgd2hpbGUgKHRoaXMuaW50ZXJ2YWxIYXNoW3RoaXMuX2F1dG9JbmNyZW1lbnRdKSB7XG4gICAgICB0aGlzLl9hdXRvSW5jcmVtZW50Kys7XG4gICAgfVxuICAgIGlkID0gdGhpcy5fYXV0b0luY3JlbWVudDtcbiAgfVxuXG4gIHZhciBpdHZsID0gbmV3IEludGVydmFsKGRhdGEsIGlkLCB0aGlzLnN0YXJ0S2V5LCB0aGlzLmVuZEtleSk7XG4gIHRoaXMucG9pbnRUcmVlLmluc2VydChbaXR2bC5zdGFydCwgaWRdKTtcbiAgdGhpcy5wb2ludFRyZWUuaW5zZXJ0KFtpdHZsLmVuZCwgICBpZF0pO1xuICB0aGlzLmludGVydmFsSGFzaFtpZF0gPSBpdHZsO1xuICB0aGlzLl9hdXRvSW5jcmVtZW50Kys7XG4gIFxuICBfaW5zZXJ0LmNhbGwodGhpcywgdGhpcy5yb290LCBpdHZsKTtcbn07XG5cblxuLyoqXG4gKiBjaGVjayBpZiByYW5nZSBpcyBhbHJlYWR5IHByZXNlbnQsIGJhc2VkIG9uIGl0cyBpZFxuICoqL1xuSW50ZXJ2YWxUcmVlLnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uKGlkKSB7XG4gIHJldHVybiAhIXRoaXMuZ2V0KGlkKTtcbn1cblxuXG4vKipcbiAqIHJldHJpZXZlIGFuIGludGVydmFsIGJ5IGl0cyBpZDsgcmV0dXJucyBudWxsIGlmIGl0IGRvZXMgbm90IGV4aXN0XG4gKiovXG5JbnRlcnZhbFRyZWUucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKGlkKSB7XG4gIHJldHVybiB0aGlzLmludGVydmFsSGFzaFtpZF0gfHwgbnVsbDtcbn1cblxuXG4vKipcbiAqIGFkZCBuZXcgcmFuZ2Ugb25seSBpZiBpdCBpcyBuZXcsIGJhc2VkIG9uIHdoZXRoZXIgdGhlIGlkIHdhcyBhbHJlYWR5IHJlZ2lzdGVyZWRcbiAqKi9cbkludGVydmFsVHJlZS5wcm90b3R5cGUuYWRkSWZOZXcgPSBmdW5jdGlvbihkYXRhLCBpZCkge1xuICB0cnkge1xuICAgIHRoaXMuYWRkKGRhdGEsIGlkKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmIChlIGluc3RhbmNlb2YgRHVwbGljYXRlRXJyb3IpIHsgcmV0dXJuOyB9XG4gICAgdGhyb3cgZTtcbiAgfVxufVxuXG5cbi8qKlxuICogc2VhcmNoXG4gKlxuICogQHBhcmFtIChpbnRlZ2VyKSB2YWw6XG4gKiBAcmV0dXJuIChhcnJheSlcbiAqKi9cbkludGVydmFsVHJlZS5wcm90b3R5cGUuc2VhcmNoID0gZnVuY3Rpb24odmFsMSwgdmFsMikge1xuICB2YXIgcmV0ID0gW107XG4gIGlmICh0eXBlb2YgdmFsMSAhPSAnbnVtYmVyJykge1xuICAgIHRocm93IG5ldyBFcnJvcih2YWwxICsgJzogaW52YWxpZCBpbnB1dCcpO1xuICB9XG5cbiAgaWYgKHZhbDIgPT0gdW5kZWZpbmVkKSB7XG4gICAgX3BvaW50U2VhcmNoLmNhbGwodGhpcywgdGhpcy5yb290LCB2YWwxLCByZXQpO1xuICB9XG4gIGVsc2UgaWYgKHR5cGVvZiB2YWwyID09ICdudW1iZXInKSB7XG4gICAgX3JhbmdlU2VhcmNoLmNhbGwodGhpcywgdmFsMSwgdmFsMiwgcmV0KTtcbiAgfVxuICBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IodmFsMSArICcsJyArIHZhbDIgKyAnOiBpbnZhbGlkIGlucHV0Jyk7XG4gIH1cbiAgcmV0dXJuIHJldDtcbn07XG5cblxuLyoqXG4gKiByZW1vdmU6IFxuICoqL1xuSW50ZXJ2YWxUcmVlLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihpbnRlcnZhbF9pZCkge1xuICB0aHJvdyBcIi5yZW1vdmUoKSBpcyBjdXJyZW50bHkgdW5pbXBsZW1lbnRlZFwiO1xufTtcblxuXG5cbi8qKlxuICogcHJpdmF0ZSBtZXRob2RzXG4gKiovXG5cbi8vIHRoZSBzaGlmdC1yaWdodC1hbmQtZmlsbCBvcGVyYXRvciwgZXh0ZW5kZWQgYmV5b25kIHRoZSByYW5nZSBvZiBhbiBpbnQzMlxuZnVuY3Rpb24gX2JpdFNoaWZ0UmlnaHQobnVtKSB7XG4gIGlmIChudW0gPiAyMTQ3NDgzNjQ3IHx8IG51bSA8IC0yMTQ3NDgzNjQ4KSB7IHJldHVybiBNYXRoLmZsb29yKG51bSAvIDIpOyB9XG4gIHJldHVybiBudW0gPj4+IDE7XG59XG5cbi8qKlxuICogX2luc2VydFxuICoqL1xuZnVuY3Rpb24gX2luc2VydChub2RlLCBpdHZsKSB7XG4gIHdoaWxlICh0cnVlKSB7XG4gICAgaWYgKGl0dmwuZW5kIDwgbm9kZS5pZHgpIHtcbiAgICAgIGlmICghbm9kZS5sZWZ0KSB7XG4gICAgICAgIG5vZGUubGVmdCA9IG5ldyBOb2RlKF9iaXRTaGlmdFJpZ2h0KGl0dmwuc3RhcnQgKyBpdHZsLmVuZCksIHRoaXMpO1xuICAgICAgfVxuICAgICAgbm9kZSA9IG5vZGUubGVmdDtcbiAgICB9IGVsc2UgaWYgKG5vZGUuaWR4IDwgaXR2bC5zdGFydCkge1xuICAgICAgaWYgKCFub2RlLnJpZ2h0KSB7XG4gICAgICAgIG5vZGUucmlnaHQgPSBuZXcgTm9kZShfYml0U2hpZnRSaWdodChpdHZsLnN0YXJ0ICsgaXR2bC5lbmQpLCB0aGlzKTtcbiAgICAgIH1cbiAgICAgIG5vZGUgPSBub2RlLnJpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbm9kZS5pbnNlcnQoaXR2bCk7XG4gICAgfVxuICB9XG59XG5cblxuLyoqXG4gKiBfcG9pbnRTZWFyY2hcbiAqIEBwYXJhbSAoTm9kZSkgbm9kZVxuICogQHBhcmFtIChpbnRlZ2VyKSBpZHggXG4gKiBAcGFyYW0gKEFycmF5KSBhcnJcbiAqKi9cbmZ1bmN0aW9uIF9wb2ludFNlYXJjaChub2RlLCBpZHgsIGFycikge1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIGlmICghbm9kZSkgYnJlYWs7XG4gICAgaWYgKGlkeCA8IG5vZGUuaWR4KSB7XG4gICAgICBub2RlLnN0YXJ0cy5hcnIuZXZlcnkoZnVuY3Rpb24oaXR2bCkge1xuICAgICAgICB2YXIgYm9vbCA9IChpdHZsLnN0YXJ0IDw9IGlkeCk7XG4gICAgICAgIGlmIChib29sKSBhcnIucHVzaChpdHZsLnJlc3VsdCgpKTtcbiAgICAgICAgcmV0dXJuIGJvb2w7XG4gICAgICB9KTtcbiAgICAgIG5vZGUgPSBub2RlLmxlZnQ7XG4gICAgfSBlbHNlIGlmIChpZHggPiBub2RlLmlkeCkge1xuICAgICAgbm9kZS5lbmRzLmFyci5ldmVyeShmdW5jdGlvbihpdHZsKSB7XG4gICAgICAgIHZhciBib29sID0gKGl0dmwuZW5kID49IGlkeCk7XG4gICAgICAgIGlmIChib29sKSBhcnIucHVzaChpdHZsLnJlc3VsdCgpKTtcbiAgICAgICAgcmV0dXJuIGJvb2w7XG4gICAgICB9KTtcbiAgICAgIG5vZGUgPSBub2RlLnJpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICBub2RlLnN0YXJ0cy5hcnIubWFwKGZ1bmN0aW9uKGl0dmwpIHsgYXJyLnB1c2goaXR2bC5yZXN1bHQoKSkgfSk7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbn1cblxuXG5cbi8qKlxuICogX3JhbmdlU2VhcmNoXG4gKiBAcGFyYW0gKGludGVnZXIpIHN0YXJ0XG4gKiBAcGFyYW0gKGludGVnZXIpIGVuZFxuICogQHBhcmFtIChBcnJheSkgYXJyXG4gKiovXG5mdW5jdGlvbiBfcmFuZ2VTZWFyY2goc3RhcnQsIGVuZCwgYXJyKSB7XG4gIGlmIChlbmQgLSBzdGFydCA8PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdlbmQgbXVzdCBiZSBncmVhdGVyIHRoYW4gc3RhcnQuIHN0YXJ0OiAnICsgc3RhcnQgKyAnLCBlbmQ6ICcgKyBlbmQpO1xuICB9XG4gIHZhciByZXN1bHRIYXNoID0ge307XG5cbiAgdmFyIHdob2xlV3JhcHMgPSBbXTtcbiAgX3BvaW50U2VhcmNoLmNhbGwodGhpcywgdGhpcy5yb290LCBfYml0U2hpZnRSaWdodChzdGFydCArIGVuZCksIHdob2xlV3JhcHMsIHRydWUpO1xuXG4gIHdob2xlV3JhcHMuZm9yRWFjaChmdW5jdGlvbihyZXN1bHQpIHtcbiAgICByZXN1bHRIYXNoW3Jlc3VsdC5pZF0gPSB0cnVlO1xuICB9KTtcblxuXG4gIHZhciBpZHgxID0gdGhpcy5wb2ludFRyZWUuYnNlYXJjaChbc3RhcnQsIG51bGxdKTtcbiAgd2hpbGUgKGlkeDEgPj0gMCAmJiB0aGlzLnBvaW50VHJlZS5hcnJbaWR4MV1bMF0gPT0gc3RhcnQpIHtcbiAgICBpZHgxLS07XG4gIH1cblxuICB2YXIgaWR4MiA9IHRoaXMucG9pbnRUcmVlLmJzZWFyY2goW2VuZCwgICBudWxsXSk7XG4gIHZhciBsZW4gPSB0aGlzLnBvaW50VHJlZS5hcnIubGVuZ3RoIC0gMTtcbiAgd2hpbGUgKGlkeDIgPT0gLTEgfHwgKGlkeDIgPD0gbGVuICYmIHRoaXMucG9pbnRUcmVlLmFycltpZHgyXVswXSA8PSBlbmQpKSB7XG4gICAgaWR4MisrO1xuICB9XG5cbiAgdGhpcy5wb2ludFRyZWUuYXJyLnNsaWNlKGlkeDEgKyAxLCBpZHgyKS5mb3JFYWNoKGZ1bmN0aW9uKHBvaW50KSB7XG4gICAgdmFyIGlkID0gcG9pbnRbMV07XG4gICAgcmVzdWx0SGFzaFtpZF0gPSB0cnVlO1xuICB9LCB0aGlzKTtcblxuICBPYmplY3Qua2V5cyhyZXN1bHRIYXNoKS5mb3JFYWNoKGZ1bmN0aW9uKGlkKSB7XG4gICAgdmFyIGl0dmwgPSB0aGlzLmludGVydmFsSGFzaFtpZF07XG4gICAgYXJyLnB1c2goaXR2bC5yZXN1bHQoc3RhcnQsIGVuZCkpO1xuICB9LCB0aGlzKTtcblxufVxuXG5cblxuLyoqXG4gKiBzdWJjbGFzc2VzXG4gKiBcbiAqKi9cblxuXG4vKipcbiAqIE5vZGUgOiBwcm90b3R5cGUgb2YgZWFjaCBub2RlIGluIGEgaW50ZXJ2YWwgdHJlZVxuICogXG4gKiovXG5mdW5jdGlvbiBOb2RlKGlkeCkge1xuICB0aGlzLmlkeCA9IGlkeDtcbiAgdGhpcy5zdGFydHMgPSBuZXcgU29ydGVkTGlzdCh7XG4gICAgY29tcGFyZTogZnVuY3Rpb24oYSwgYikge1xuICAgICAgaWYgKGEgPT0gbnVsbCkgcmV0dXJuIC0xO1xuICAgICAgaWYgKGIgPT0gbnVsbCkgcmV0dXJuICAxO1xuICAgICAgdmFyIGMgPSBhLnN0YXJ0IC0gYi5zdGFydDtcbiAgICAgIHJldHVybiAoYyA+IDApID8gMSA6IChjID09IDApICA/IDAgOiAtMTtcbiAgICB9XG4gIH0pO1xuXG4gIHRoaXMuZW5kcyA9IG5ldyBTb3J0ZWRMaXN0KHtcbiAgICBjb21wYXJlOiBmdW5jdGlvbihhLCBiKSB7XG4gICAgICBpZiAoYSA9PSBudWxsKSByZXR1cm4gLTE7XG4gICAgICBpZiAoYiA9PSBudWxsKSByZXR1cm4gIDE7XG4gICAgICB2YXIgYyA9IGEuZW5kIC0gYi5lbmQ7XG4gICAgICByZXR1cm4gKGMgPCAwKSA/IDEgOiAoYyA9PSAwKSAgPyAwIDogLTE7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogaW5zZXJ0IGFuIEludGVydmFsIG9iamVjdCB0byB0aGlzIG5vZGVcbiAqKi9cbk5vZGUucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uKGludGVydmFsKSB7XG4gIHRoaXMuc3RhcnRzLmluc2VydChpbnRlcnZhbCk7XG4gIHRoaXMuZW5kcy5pbnNlcnQoaW50ZXJ2YWwpO1xufTtcblxuXG5cbi8qKlxuICogSW50ZXJ2YWwgOiBwcm90b3R5cGUgb2YgaW50ZXJ2YWwgaW5mb1xuICoqL1xuZnVuY3Rpb24gSW50ZXJ2YWwoZGF0YSwgaWQsIHMsIGUpIHtcbiAgdGhpcy5pZCAgICAgPSBpZDtcbiAgdGhpcy5zdGFydCAgPSBkYXRhW3NdO1xuICB0aGlzLmVuZCAgICA9IGRhdGFbZV07XG4gIHRoaXMuZGF0YSAgID0gZGF0YTtcblxuICBpZiAodHlwZW9mIHRoaXMuc3RhcnQgIT0gJ251bWJlcicgfHwgdHlwZW9mIHRoaXMuZW5kICE9ICdudW1iZXInKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzdGFydCwgZW5kIG11c3QgYmUgbnVtYmVyLiBzdGFydDogJyArIHRoaXMuc3RhcnQgKyAnLCBlbmQ6ICcgKyB0aGlzLmVuZCk7XG4gIH1cblxuICBpZiAoIHRoaXMuc3RhcnQgPj0gdGhpcy5lbmQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3N0YXJ0IG11c3QgYmUgc21hbGxlciB0aGFuIGVuZC4gc3RhcnQ6ICcgKyB0aGlzLnN0YXJ0ICsgJywgZW5kOiAnICsgdGhpcy5lbmQpO1xuICB9XG59XG5cbi8qKlxuICogZ2V0IHJlc3VsdCBvYmplY3RcbiAqKi9cbkludGVydmFsLnByb3RvdHlwZS5yZXN1bHQgPSBmdW5jdGlvbihzdGFydCwgZW5kKSB7XG4gIHZhciByZXQgPSB7XG4gICAgaWQgICA6IHRoaXMuaWQsXG4gICAgZGF0YSA6IHRoaXMuZGF0YVxuICB9O1xuICBpZiAodHlwZW9mIHN0YXJ0ID09ICdudW1iZXInICYmIHR5cGVvZiBlbmQgPT0gJ251bWJlcicpIHtcbiAgICAvKipcbiAgICAgKiBjYWxjIG92ZXJsYXBwaW5nIHJhdGVcbiAgICAgKiovXG4gICAgdmFyIGxlZnQgID0gTWF0aC5tYXgodGhpcy5zdGFydCwgc3RhcnQpO1xuICAgIHZhciByaWdodCA9IE1hdGgubWluKHRoaXMuZW5kLCAgIGVuZCk7XG4gICAgdmFyIGxhcExuID0gcmlnaHQgLSBsZWZ0O1xuICAgIHJldC5yYXRlMSA9IGxhcExuIC8gKGVuZCAtIHN0YXJ0KTtcbiAgICByZXQucmF0ZTIgPSBsYXBMbiAvICh0aGlzLmVuZCAtIHRoaXMuc3RhcnQpO1xuICB9XG4gIHJldHVybiByZXQ7XG59O1xuXG5mdW5jdGlvbiBEdXBsaWNhdGVFcnJvcihtZXNzYWdlKSB7XG4gICAgdGhpcy5uYW1lID0gJ0R1cGxpY2F0ZUVycm9yJztcbiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgIHRoaXMuc3RhY2sgPSAobmV3IEVycm9yKCkpLnN0YWNrO1xufVxuRHVwbGljYXRlRXJyb3IucHJvdG90eXBlID0gbmV3IEVycm9yO1xuXG5leHBvcnRzLkludGVydmFsVHJlZSA9IEludGVydmFsVHJlZTtcblxufSkobW9kdWxlICYmIG1vZHVsZS5leHBvcnRzIHx8IHRoaXMpOyIsIihmdW5jdGlvbihleHBvcnRzKXtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSBMaW5lTWFzazogQSAodmVyeSBjaGVhcCkgYWx0ZXJuYXRpdmUgdG8gSW50ZXJ2YWxUcmVlOiBhIHNtYWxsLCAxRCBwaXhlbCBidWZmZXIgb2Ygb2JqZWN0cy4gPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMuanMnKSxcbiAgZmxvb3JIYWNrID0gdXRpbHMuZmxvb3JIYWNrO1xuXG5mdW5jdGlvbiBMaW5lTWFzayh3aWR0aCwgZnVkZ2UpIHtcbiAgdGhpcy5mdWRnZSA9IGZ1ZGdlID0gKGZ1ZGdlIHx8IDEpO1xuICB0aGlzLml0ZW1zID0gW107XG4gIHRoaXMubGVuZ3RoID0gTWF0aC5jZWlsKHdpZHRoIC8gZnVkZ2UpO1xuICB0aGlzLm1hc2sgPSBnbG9iYWwuVWludDhBcnJheSA/IG5ldyBVaW50OEFycmF5KHRoaXMubGVuZ3RoKSA6IG5ldyBBcnJheSh0aGlzLmxlbmd0aCk7XG59XG5cbkxpbmVNYXNrLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbih4LCB3LCBkYXRhKSB7XG4gIHZhciB1cFRvID0gTWF0aC5jZWlsKCh4ICsgdykgLyB0aGlzLmZ1ZGdlKTtcbiAgdGhpcy5pdGVtcy5wdXNoKHt4OiB4LCB3OiB3LCBkYXRhOiBkYXRhfSk7XG4gIGZvciAodmFyIGkgPSBNYXRoLm1heChmbG9vckhhY2soeCAvIHRoaXMuZnVkZ2UpLCAwKTsgaSA8IE1hdGgubWluKHVwVG8sIHRoaXMubGVuZ3RoKTsgaSsrKSB7IHRoaXMubWFza1tpXSA9IDE7IH1cbn07XG5cbkxpbmVNYXNrLnByb3RvdHlwZS5jb25mbGljdCA9IGZ1bmN0aW9uKHgsIHcpIHtcbiAgdmFyIHVwVG8gPSBNYXRoLmNlaWwoKHggKyB3KSAvIHRoaXMuZnVkZ2UpO1xuICBmb3IgKHZhciBpID0gTWF0aC5tYXgoZmxvb3JIYWNrKHggLyB0aGlzLmZ1ZGdlKSwgMCk7IGkgPCBNYXRoLm1pbih1cFRvLCB0aGlzLmxlbmd0aCk7IGkrKykgeyBpZiAodGhpcy5tYXNrW2ldKSByZXR1cm4gdHJ1ZTsgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5leHBvcnRzLkxpbmVNYXNrID0gTGluZU1hc2s7XG5cbn0pKG1vZHVsZSAmJiBtb2R1bGUuZXhwb3J0cyB8fCB0aGlzKTsiLCIoZnVuY3Rpb24oZXhwb3J0cyl7XG4gIFxudmFyIEludGVydmFsVHJlZSA9IHJlcXVpcmUoJy4vSW50ZXJ2YWxUcmVlLmpzJykuSW50ZXJ2YWxUcmVlOyAgXG52YXIgXyA9IHJlcXVpcmUoJy4uLy4uLy4uL3VuZGVyc2NvcmUubWluLmpzJyk7XG52YXIgcGFyc2VJbnQxMCA9IHJlcXVpcmUoJy4vdXRpbHMuanMnKS5wYXJzZUludDEwO1xuXG52YXIgUEFJUklOR19DQU5OT1RfTUFURSA9IDAsXG4gIFBBSVJJTkdfTUFURV9PTkxZID0gMSxcbiAgUEFJUklOR19EUkFXX0FTX01BVEVTID0gMjtcblxuLy8gVE9ETzogYmFja3BvcnQgdGhpcyBjb2RlIGZvciBKYXZhU2NyaXB0IDEuNT8gdXNpbmcgdW5kZXJzY29yZS5qc1xuLyoqXG4gKiBXcmFwcyB0d28gb2YgU2hpbiBTdXp1a2kncyBJbnRlcnZhbFRyZWVzIHRvIHN0b3JlIGludGVydmFscyB0aGF0ICptYXkqXG4gKiBiZSBwYWlyZWQuXG4gKlxuICogQHNlZSBJbnRlcnZhbFRyZWUoKVxuICoqL1xuZnVuY3Rpb24gUGFpcmVkSW50ZXJ2YWxUcmVlKGNlbnRlciwgdW5wYWlyZWRPcHRpb25zLCBwYWlyZWRPcHRpb25zKSB7XG4gIHZhciBkZWZhdWx0T3B0aW9ucyA9IHtzdGFydEtleTogMCwgZW5kS2V5OiAxfTtcbiAgXG4gIHRoaXMudW5wYWlyZWQgPSBuZXcgSW50ZXJ2YWxUcmVlKGNlbnRlciwgdW5wYWlyZWRPcHRpb25zKTtcbiAgdGhpcy51bnBhaXJlZE9wdGlvbnMgPSBfLmV4dGVuZCh7fSwgZGVmYXVsdE9wdGlvbnMsIHVucGFpcmVkT3B0aW9ucyk7XG4gIFxuICB0aGlzLnBhaXJlZCA9IG5ldyBJbnRlcnZhbFRyZWUoY2VudGVyLCBwYWlyZWRPcHRpb25zKTtcbiAgdGhpcy5wYWlyZWRPcHRpb25zID0gXy5leHRlbmQoe3BhaXJpbmdLZXk6ICdxbmFtZScsIHBhaXJlZExlbmd0aEtleTogJ3RsZW4nfSwgZGVmYXVsdE9wdGlvbnMsIHBhaXJlZE9wdGlvbnMpO1xuICBpZiAodGhpcy5wYWlyZWRPcHRpb25zLnN0YXJ0S2V5ID09PSB0aGlzLnVucGFpcmVkT3B0aW9ucy5zdGFydEtleSkge1xuICAgIHRocm93IG5ldyBFcnJvcignc3RhcnRLZXkgZm9yIHVucGFpcmVkT3B0aW9ucyBhbmQgcGFpcmVkT3B0aW9ucyBtdXN0IGJlIGRpZmZlcmVudCBpbiBhIFBhaXJlZEludGVydmFsVHJlZScpO1xuICB9XG4gIGlmICh0aGlzLnBhaXJlZE9wdGlvbnMuZW5kS2V5ID09PSB0aGlzLnVucGFpcmVkT3B0aW9ucy5lbmRLZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2VuZEtleSBmb3IgdW5wYWlyZWRPcHRpb25zIGFuZCBwYWlyZWRPcHRpb25zIG11c3QgYmUgZGlmZmVyZW50IGluIGEgUGFpcmVkSW50ZXJ2YWxUcmVlJyk7XG4gIH1cbiAgXG4gIHRoaXMucGFpcmluZ0Rpc2FibGVkID0gZmFsc2U7XG4gIHRoaXMucGFpcmluZ01pbkRpc3RhbmNlID0gdGhpcy5wYWlyaW5nTWF4RGlzdGFuY2UgPSBudWxsO1xufVxuXG5cbi8qKlxuICogcHVibGljIG1ldGhvZHNcbiAqKi9cblxuXG4vKipcbiAqIERpc2FibGVzIHBhaXJpbmcuIEVmZmVjdGl2ZWx5IG1ha2VzIHRoaXMgZXF1aXZhbGVudCwgZXh0ZXJuYWxseSwgdG8gYW4gSW50ZXJ2YWxUcmVlLlxuICogVGhpcyBpcyB1c2VmdWwgaWYgd2UgZGlzY292ZXIgdGhhdCB0aGlzIGRhdGEgc291cmNlIGRvZXNuJ3QgY29udGFpbiBwYWlyZWQgcmVhZHMuXG4gKiovXG5QYWlyZWRJbnRlcnZhbFRyZWUucHJvdG90eXBlLmRpc2FibGVQYWlyaW5nID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMucGFpcmluZ0Rpc2FibGVkID0gdHJ1ZTtcbiAgdGhpcy5wYWlyZWQgPSB0aGlzLnVucGFpcmVkO1xufTtcblxuXG4vKipcbiAqIFNldCBhbiBpbnRlcnZhbCB3aXRoaW4gd2hpY2ggcGFpcmVkIG1hdGVzIHdpbGwgYmUgc2F2ZWQgYXMgYSBjb250aW51b3VzIGZlYXR1cmUgaW4gLnBhaXJlZFxuICpcbiAqIEBwYXJhbSAobnVtYmVyKSBtaW46IE1pbmltdW0gZGlzdGFuY2UsIGluIGJwXG4gKiBAcGFyYW0gKG51bWJlcikgbWF4OiBNYXhpbXVtIGRpc3RhbmNlLCBpbiBicFxuICoqL1xuUGFpcmVkSW50ZXJ2YWxUcmVlLnByb3RvdHlwZS5zZXRQYWlyaW5nSW50ZXJ2YWwgPSBmdW5jdGlvbihtaW4sIG1heCkge1xuICBpZiAodHlwZW9mIG1pbiAhPSAnbnVtYmVyJykgeyB0aHJvdyBuZXcgRXJyb3IoJ3lvdSBtdXN0IHNwZWNpZnkgbWluIGFzIHRoZSAxc3QgYXJndW1lbnQuJyk7IH1cbiAgaWYgKHR5cGVvZiBtYXggIT0gJ251bWJlcicpIHsgdGhyb3cgbmV3IEVycm9yKCd5b3UgbXVzdCBzcGVjaWZ5IG1heCBhcyB0aGUgMm5kIGFyZ3VtZW50LicpOyB9XG4gIGlmICh0aGlzLnBhaXJpbmdNaW5EaXN0YW5jZSAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgRXJyb3IoJ0NhbiBvbmx5IGJlIGNhbGxlZCBvbmNlLiBZb3UgY2FuXFwndCBjaGFuZ2UgdGhlIHBhaXJpbmcgaW50ZXJ2YWwuJyk7IH1cbiAgXG4gIHRoaXMucGFpcmluZ01pbkRpc3RhbmNlID0gbWluO1xuICB0aGlzLnBhaXJpbmdNYXhEaXN0YW5jZSA9IG1heDtcbn07XG5cblxuLyoqXG4gKiBhZGQgbmV3IHJhbmdlIG9ubHkgaWYgaXQgaXMgbmV3LCBiYXNlZCBvbiB3aGV0aGVyIHRoZSBpZCB3YXMgYWxyZWFkeSByZWdpc3RlcmVkXG4gKiovXG5QYWlyZWRJbnRlcnZhbFRyZWUucHJvdG90eXBlLmFkZElmTmV3ID0gZnVuY3Rpb24oZGF0YSwgaWQpIHtcbiAgdmFyIG1hdGVkID0gZmFsc2UsXG4gICAgaW5jcmVtZW50ID0gMCxcbiAgICB1bnBhaXJlZFN0YXJ0ID0gdGhpcy51bnBhaXJlZE9wdGlvbnMuc3RhcnRLZXksXG4gICAgdW5wYWlyZWRFbmQgPSB0aGlzLnVucGFpcmVkT3B0aW9ucy5lbmRLZXksXG4gICAgcGFpcmVkU3RhcnQgPSB0aGlzLnBhaXJlZE9wdGlvbnMuc3RhcnRLZXksXG4gICAgcGFpcmVkRW5kID0gdGhpcy5wYWlyZWRPcHRpb25zLmVuZEtleSxcbiAgICBwYWlyZWRMZW5ndGggPSBkYXRhW3RoaXMucGFpcmVkT3B0aW9ucy5wYWlyZWRMZW5ndGhLZXldLFxuICAgIHBhaXJpbmdTdGF0ZSA9IFBBSVJJTkdfQ0FOTk9UX01BVEUsXG4gICAgbmV3SWQsIHBvdGVudGlhbE1hdGU7XG4gIFxuICAvLyAudW5wYWlyZWQgY29udGFpbnMgZXZlcnkgYWxpZ25tZW50IGFzIGEgc2VwYXJhdGUgaW50ZXJ2YWwuXG4gIC8vIElmIGl0IGFscmVhZHkgY29udGFpbnMgdGhpcyBpZCwgd2UndmUgc2VlbiB0aGlzIHJlYWQgYmVmb3JlIGFuZCBzaG91bGQgZGlzcmVnYXJkLlxuICBpZiAodGhpcy51bnBhaXJlZC5jb250YWlucyhpZCkpIHsgcmV0dXJuOyB9XG4gIHRoaXMudW5wYWlyZWQuYWRkKGRhdGEsIGlkKTtcbiAgXG4gIC8vIC5wYWlyZWQgY29udGFpbnMgYWxpZ25tZW50cyB0aGF0IG1heSBiZSBtYXRlZCBpbnRvIG9uZSBpbnRlcnZhbCBpZiB0aGV5IGFyZSB3aXRoaW4gdGhlIHBhaXJpbmcgcmFuZ2VcbiAgaWYgKCF0aGlzLnBhaXJpbmdEaXNhYmxlZCAmJiBfZWxpZ2libGVGb3JQYWlyaW5nKHRoaXMsIGRhdGEpKSB7XG4gICAgaWYgKHRoaXMucGFpcmluZ01pbkRpc3RhbmNlID09PSBudWxsKSB7IFxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW4gb25seSBhZGQgcGFpcmVkIGRhdGEgYWZ0ZXIgdGhlIHBhaXJpbmcgaW50ZXJ2YWwgaGFzIGJlZW4gc2V0IScpO1xuICAgIH1cbiAgICBcbiAgICAvLyBpbnN0ZWFkIG9mIHN0b3JpbmcgdGhlbSB3aXRoIHRoZSBnaXZlbiBpZCwgdGhlIHBhaXJpbmdLZXkgKGZvciBCQU0sIFFOQU1FKSBpcyB1c2VkIGFzIHRoZSBpZC5cbiAgICAvLyBBcyBpbnRlcnZhbHMgYXJlIGFkZGVkLCB3ZSBjaGVjayBpZiBhIHJlYWQgd2l0aCB0aGUgc2FtZSBwYWlyaW5nS2V5IGFscmVhZHkgZXhpc3RzIGluIHRoZSAucGFpcmVkIEludGVydmFsVHJlZS5cbiAgICBuZXdJZCA9IGRhdGFbdGhpcy5wYWlyZWRPcHRpb25zLnBhaXJpbmdLZXldO1xuICAgIHBvdGVudGlhbE1hdGUgPSB0aGlzLnBhaXJlZC5nZXQobmV3SWQpO1xuICAgIFxuICAgIGlmIChwb3RlbnRpYWxNYXRlICE9PSBudWxsKSB7XG4gICAgICBwb3RlbnRpYWxNYXRlID0gcG90ZW50aWFsTWF0ZS5kYXRhO1xuICAgICAgcGFpcmluZ1N0YXRlID0gX3BhaXJpbmdTdGF0ZSh0aGlzLCBkYXRhLCBwb3RlbnRpYWxNYXRlKTtcbiAgICAgIC8vIEFyZSB0aGUgcmVhZHMgc3VpdGFibGUgZm9yIG1hdGluZz9cbiAgICAgIGlmIChwYWlyaW5nU3RhdGUgPT09IFBBSVJJTkdfRFJBV19BU19NQVRFUyB8fCBwYWlyaW5nU3RhdGUgPT09IFBBSVJJTkdfTUFURV9PTkxZKSB7XG4gICAgICAgIC8vIElmIHllczogbWF0ZSB0aGUgcmVhZHNcbiAgICAgICAgcG90ZW50aWFsTWF0ZS5tYXRlID0gZGF0YTtcbiAgICAgICAgLy8gSW4gdGhlIG90aGVyIGRpcmVjdGlvbiwgaGFzIHRvIGJlIGEgc2VsZWN0aXZlIHNoYWxsb3cgY29weSB0byBhdm9pZCBjaXJjdWxhciByZWZlcmVuY2VzLlxuICAgICAgICBkYXRhLm1hdGUgPSBfLmV4dGVuZCh7fSwgXy5vbWl0KHBvdGVudGlhbE1hdGUsIGZ1bmN0aW9uKHYsIGspIHsgcmV0dXJuIF8uaXNPYmplY3Qodil9KSk7XG4gICAgICAgIGRhdGEubWF0ZS5mbGFncyA9IF8uY2xvbmUocG90ZW50aWFsTWF0ZS5mbGFncyk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIEFyZSB0aGUgbWF0ZWQgcmVhZHMgd2l0aGluIGRyYXdhYmxlIHJhbmdlPyBJZiBzbywgc2ltcGx5IGZsYWcgdGhhdCB0aGV5IHNob3VsZCBiZSBkcmF3biB0b2dldGhlciwgYW5kIHRoZXkgd2lsbC5cbiAgICAvLyBBbHRlcm5hdGl2ZWx5LCBpZiB0aGUgcG90ZW50aWFsTWF0ZSBleHBlY3RlZCBhIG1hdGUsIHdlIHNob3VsZCBtYXRlIHRoZW0gYW55d2F5LlxuICAgIC8vIFRoZSBvbmx5IHJlYXNvbiB3ZSB3b3VsZG4ndCBnZXQgLmRyYXdBc01hdGVzIGlzIGlmIHRoZSBtYXRlIHdhcyBvbiB0aGUgdGhyZXNob2xkIG9mIHRoZSBpbnNlcnQgc2l6ZSByYW5nZS5cbiAgICBpZiAocGFpcmluZ1N0YXRlID09PSBQQUlSSU5HX0RSQVdfQVNfTUFURVMgfHwgKHBhaXJpbmdTdGF0ZSA9PT0gUEFJUklOR19NQVRFX09OTFkgJiYgcG90ZW50aWFsTWF0ZS5tYXRlRXhwZWN0ZWQpKSB7XG4gICAgICBkYXRhLmRyYXdBc01hdGVzID0gcG90ZW50aWFsTWF0ZS5kcmF3QXNNYXRlcyA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE90aGVyd2lzZSwgbmVlZCB0byBpbnNlcnQgdGhpcyByZWFkIGludG8gdGhpcy5wYWlyZWQgYXMgYSBzZXBhcmF0ZSByZWFkLlxuICAgICAgLy8gRW5zdXJlIHRoZSBpZCBpcyB1bmlxdWUgZmlyc3QuXG4gICAgICB3aGlsZSAodGhpcy5wYWlyZWQuY29udGFpbnMobmV3SWQpKSB7XG4gICAgICAgIG5ld0lkID0gbmV3SWQucmVwbGFjZSgvXFx0LiovLCAnJykgKyBcIlxcdFwiICsgKCsraW5jcmVtZW50KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZGF0YS5tYXRlRXhwZWN0ZWQgPSBfcGFpcmluZ1N0YXRlKHRoaXMsIGRhdGEpID09PSBQQUlSSU5HX0RSQVdfQVNfTUFURVM7XG4gICAgICAvLyBGSVhNRTogVGhlIGZvbGxvd2luZyBpcyBwZXJoYXBzIGEgYml0IHRvbyBzcGVjaWZpYyB0byBob3cgVExFTiBmb3IgQkFNIGZpbGVzIHdvcmtzOyBjb3VsZCBnZW5lcmFsaXplIGxhdGVyXG4gICAgICAvLyBXaGVuIGluc2VydGluZyBpbnRvIC5wYWlyZWQsIHRoZSBpbnRlcnZhbCdzIC5zdGFydCBhbmQgLmVuZCBzaG91bGRuJ3QgYmUgYmFzZWQgb24gUE9TIGFuZCB0aGUgQ0lHQVIgc3RyaW5nO1xuICAgICAgLy8gd2UgbXVzdCBhZGp1c3QgdGhlbSBmb3IgVExFTiwgaWYgaXQgaXMgbm9uemVybywgZGVwZW5kaW5nIG9uIGl0cyBzaWduLCBhbmQgc2V0IG5ldyBib3VuZHMgZm9yIHRoZSBpbnRlcnZhbC5cbiAgICAgIGlmIChkYXRhLm1hdGVFeHBlY3RlZCAmJiBwYWlyZWRMZW5ndGggPiAwKSB7XG4gICAgICAgIGRhdGFbcGFpcmVkU3RhcnRdID0gZGF0YVt1bnBhaXJlZFN0YXJ0XTtcbiAgICAgICAgZGF0YVtwYWlyZWRFbmRdID0gZGF0YVt1bnBhaXJlZFN0YXJ0XSArIHBhaXJlZExlbmd0aDtcbiAgICAgIH0gZWxzZSBpZiAoZGF0YS5tYXRlRXhwZWN0ZWQgJiYgcGFpcmVkTGVuZ3RoIDwgMCkge1xuICAgICAgICBkYXRhW3BhaXJlZEVuZF0gPSBkYXRhW3VucGFpcmVkRW5kXTtcbiAgICAgICAgZGF0YVtwYWlyZWRTdGFydF0gPSBkYXRhW3VucGFpcmVkRW5kXSArIHBhaXJlZExlbmd0aDtcbiAgICAgIH0gZWxzZSB7IC8vICFkYXRhLm1hdGVFeHBlY3RlZCB8fCBwYWlyZWRMZW5ndGggPT0gMFxuICAgICAgICBkYXRhW3BhaXJlZFN0YXJ0XSA9IGRhdGFbdW5wYWlyZWRTdGFydF07XG4gICAgICAgIGRhdGFbcGFpcmVkRW5kXSA9IGRhdGFbdW5wYWlyZWRFbmRdO1xuICAgICAgfVxuICAgICAgXG4gICAgICB0aGlzLnBhaXJlZC5hZGQoZGF0YSwgbmV3SWQpO1xuICAgIH1cbiAgfVxuXG59O1xuXG5cbi8qKlxuICogYWxpYXMgLmFkZCgpIHRvIC5hZGRJZk5ldygpXG4gKiovXG5QYWlyZWRJbnRlcnZhbFRyZWUucHJvdG90eXBlLmFkZCA9IFBhaXJlZEludGVydmFsVHJlZS5wcm90b3R5cGUuYWRkSWZOZXc7XG5cblxuLyoqXG4gKiBzZWFyY2hcbiAqXG4gKiBAcGFyYW0gKG51bWJlcikgdmFsOlxuICogQHJldHVybiAoYXJyYXkpXG4gKiovXG5QYWlyZWRJbnRlcnZhbFRyZWUucHJvdG90eXBlLnNlYXJjaCA9IGZ1bmN0aW9uKHZhbDEsIHZhbDIsIHBhaXJlZCkge1xuICBpZiAocGFpcmVkICYmICF0aGlzLnBhaXJpbmdEaXNhYmxlZCkge1xuICAgIHJldHVybiB0aGlzLnBhaXJlZC5zZWFyY2godmFsMSwgdmFsMik7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHRoaXMudW5wYWlyZWQuc2VhcmNoKHZhbDEsIHZhbDIpO1xuICB9XG59O1xuXG5cbi8qKlxuICogcmVtb3ZlOiB1bmltcGxlbWVudGVkIGZvciBub3dcbiAqKi9cblBhaXJlZEludGVydmFsVHJlZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oaW50ZXJ2YWxfaWQpIHtcbiAgdGhyb3cgXCIucmVtb3ZlKCkgaXMgY3VycmVudGx5IHVuaW1wbGVtZW50ZWRcIjtcbn07XG5cblxuLyoqXG4gKiBwcml2YXRlIG1ldGhvZHNcbiAqKi9cblxuLy8gQ2hlY2sgaWYgYW4gaXR2bCBpcyBlbGlnaWJsZSBmb3IgcGFpcmluZy4gXG4vLyBGb3Igbm93LCB0aGlzIG1lYW5zIHRoYXQgaWYgYW55IEZMQUcncyAweDEwMCBvciBoaWdoZXIgYXJlIHNldCwgd2UgdG90YWxseSBkaXNjYXJkIHRoaXMgYWxpZ25tZW50IGFuZCBpbnRlcnZhbC5cbi8vIEZJWE1FOiBUaGUgZm9sbG93aW5nIGlzIGVudGFuZ2xlZCB3aXRoIGJhbS5qcyBpbnRlcm5hbHM7IHBlcmhhcHMgYWxsb3cgdGhpcyB0byBiZSBnZW5lcmFsaXplZCwgb3ZlcnJpZGRlbixcbi8vICAgICAgICBvciBzZXQgYWxvbmdzaWRlIC5zZXRQYWlyaW5nSW50ZXJ2YWwoKVxuLy9cbi8vIEByZXR1cm4gKGJvb2xlYW4pXG5mdW5jdGlvbiBfZWxpZ2libGVGb3JQYWlyaW5nKHBhaXJlZEl0dmxUcmVlLCBpdHZsKSB7XG4gIHZhciBmbGFncyA9IGl0dmwuZmxhZ3M7XG4gIGlmIChmbGFncy5pc1NlY29uZGFyeUFsaWdubWVudCB8fCBmbGFncy5pc1JlYWRGYWlsaW5nVmVuZG9yUUMgfHwgZmxhZ3MuaXNEdXBsaWNhdGVSZWFkIHx8IGZsYWdzLmlzU3VwcGxlbWVudGFyeUFsaWdubWVudCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuLy8gQ2hlY2sgaWYgYW4gaXR2bCBhbmQgaXRzIHBvdGVudGlhbE1hdGUgYXJlIHdpdGhpbiB0aGUgcmlnaHQgZGlzdGFuY2UsIGFuZCBvcmllbnRhdGlvbiwgdG8gYmUgbWF0ZWQuXG4vLyBJZiBwb3RlbnRpYWxNYXRlIGlzbid0IGdpdmVuLCB0YWtlcyBhIGJlc3QgZ3Vlc3MgaWYgYSBtYXRlIGlzIGV4cGVjdGVkLCBnaXZlbiB0aGUgaW5mb3JtYXRpb24gaW4gaXR2bCBhbG9uZS5cbi8vIEZJWE1FOiBUaGUgZm9sbG93aW5nIGlzIGVudGFuZ2xlZCB3aXRoIGJhbS5qcyBpbnRlcm5hbHM7IHBlcmhhcHMgYWxsb3cgdGhpcyB0byBiZSBnZW5lcmFsaXplZCwgb3ZlcnJpZGRlbixcbi8vICAgICAgICBvciBzZXQgYWxvbmdzaWRlIC5zZXRQYWlyaW5nSW50ZXJ2YWwoKVxuLy8gXG4vLyBAcmV0dXJuIChudW1iZXIpXG5mdW5jdGlvbiBfcGFpcmluZ1N0YXRlKHBhaXJlZEl0dmxUcmVlLCBpdHZsLCBwb3RlbnRpYWxNYXRlKSB7XG4gIHZhciB0bGVuID0gaXR2bFtwYWlyZWRJdHZsVHJlZS5wYWlyZWRPcHRpb25zLnBhaXJlZExlbmd0aEtleV0sXG4gICAgaXR2bExlbmd0aCA9IGl0dmwuZW5kIC0gaXR2bC5zdGFydCxcbiAgICBpdHZsSXNMYXRlciwgaW5mZXJyZWRJbnNlcnRTaXplO1xuXG4gIGlmIChfLmlzVW5kZWZpbmVkKHBvdGVudGlhbE1hdGUpKSB7XG4gICAgLy8gQ3JlYXRlIHRoZSBtb3N0IHJlY2VwdGl2ZSBoeXBvdGhldGljYWwgbWF0ZSwgZ2l2ZW4gdGhlIGluZm9ybWF0aW9uIGluIGl0dmwuXG4gICAgcG90ZW50aWFsTWF0ZSA9IHtcbiAgICAgIF9tb2NrZWQ6IHRydWUsXG4gICAgICBmbGFnczoge1xuICAgICAgICBpc1JlYWRQYWlyZWQ6IHRydWUsXG4gICAgICAgIGlzUmVhZFByb3Blcmx5QWxpZ25lZDogdHJ1ZSxcbiAgICAgICAgaXNSZWFkRmlyc3RPZlBhaXI6IGl0dmwuZmxhZ3MuaXNSZWFkTGFzdE9mUGFpcixcbiAgICAgICAgaXNSZWFkTGFzdE9mUGFpcjogaXR2bC5mbGFncy5pc1JlYWRGaXJzdE9mUGFpclxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvLyBGaXJzdCBjaGVjayBhIHdob2xlIGhvc3Qgb2YgRkxBRydzLiBUbyBtYWtlIGEgbG9uZyBzdG9yeSBzaG9ydCwgd2UgZXhwZWN0IHBhaXJlZCBlbmRzIHRvIGJlIGVpdGhlclxuICAvLyA5OS0xNDcgb3IgMTYzLTgzLCBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgcmlnaHRtb3N0IG9yIGxlZnRtb3N0IHNlZ21lbnQgaXMgcHJpbWFyeS5cbiAgaWYgKCFpdHZsLmZsYWdzLmlzUmVhZFBhaXJlZCB8fCAhcG90ZW50aWFsTWF0ZS5mbGFncy5pc1JlYWRQYWlyZWQpIHsgcmV0dXJuIFBBSVJJTkdfQ0FOTk9UX01BVEU7IH1cbiAgaWYgKCFpdHZsLmZsYWdzLmlzUmVhZFByb3Blcmx5QWxpZ25lZCB8fCAhcG90ZW50aWFsTWF0ZS5mbGFncy5pc1JlYWRQcm9wZXJseUFsaWduZWQpIHsgcmV0dXJuIFBBSVJJTkdfQ0FOTk9UX01BVEU7IH1cbiAgaWYgKGl0dmwuZmxhZ3MuaXNSZWFkVW5tYXBwZWQgfHwgcG90ZW50aWFsTWF0ZS5mbGFncy5pc1JlYWRVbm1hcHBlZCkgeyByZXR1cm4gUEFJUklOR19DQU5OT1RfTUFURTsgfVxuICBpZiAoaXR2bC5mbGFncy5pc01hdGVVbm1hcHBlZCB8fCBwb3RlbnRpYWxNYXRlLmZsYWdzLmlzTWF0ZVVubWFwcGVkKSB7IHJldHVybiBQQUlSSU5HX0NBTk5PVF9NQVRFOyB9XG4gIGlmIChpdHZsLmZsYWdzLmlzUmVhZEZpcnN0T2ZQYWlyICYmICFwb3RlbnRpYWxNYXRlLmZsYWdzLmlzUmVhZExhc3RPZlBhaXIpIHsgcmV0dXJuIFBBSVJJTkdfQ0FOTk9UX01BVEU7IH1cbiAgaWYgKGl0dmwuZmxhZ3MuaXNSZWFkTGFzdE9mUGFpciAmJiAhcG90ZW50aWFsTWF0ZS5mbGFncy5pc1JlYWRGaXJzdE9mUGFpcikgeyByZXR1cm4gUEFJUklOR19DQU5OT1RfTUFURTsgfVxuICAgIFxuICBpZiAocG90ZW50aWFsTWF0ZS5fbW9ja2VkKSB7XG4gICAgXy5leHRlbmQocG90ZW50aWFsTWF0ZSwge1xuICAgICAgcm5hbWU6IGl0dmwucm5leHQgPT0gJz0nID8gaXR2bC5ybmFtZSA6IGl0dmwucm5leHQsXG4gICAgICBwb3M6IGl0dmwucG5leHQsXG4gICAgICBzdGFydDogaXR2bC5ybmV4dCA9PSAnPScgPyBwYXJzZUludDEwKGl0dmwucG5leHQpICsgKGl0dmwuc3RhcnQgLSBwYXJzZUludDEwKGl0dmwucG9zKSkgOiAwLFxuICAgICAgZW5kOiB0bGVuID4gMCA/IGl0dmwuc3RhcnQgKyB0bGVuIDogKHRsZW4gPCAwID8gaXR2bC5lbmQgKyB0bGVuICsgaXR2bExlbmd0aCA6IDApLFxuICAgICAgcm5leHQ6IGl0dmwucm5leHQgPT0gJz0nID8gJz0nIDogaXR2bC5ybmFtZSxcbiAgICAgIHBuZXh0OiBpdHZsLnBvc1xuICAgIH0pO1xuICB9XG4gIFxuICAvLyBDaGVjayB0aGF0IHRoZSBhbGlnbm1lbnRzIGFyZSBvbiB0aGUgc2FtZSByZWZlcmVuY2Ugc2VxdWVuY2VcbiAgaWYgKGl0dmwucm5leHQgIT0gJz0nIHx8IHBvdGVudGlhbE1hdGUucm5leHQgIT0gJz0nKSB7IFxuICAgIC8vIGFuZCBpZiBub3QsIGRvIHRoZSBjb29yZGluYXRlcyBtYXRjaCBhdCBhbGw/XG4gICAgaWYgKGl0dmwucm5leHQgIT0gcG90ZW50aWFsTWF0ZS5ybmFtZSB8fCBpdHZsLnJuZXh0ICE9IHBvdGVudGlhbE1hdGUucm5hbWUpIHsgcmV0dXJuIFBBSVJJTkdfQ0FOTk9UX01BVEU7IH1cbiAgICBpZiAoaXR2bC5wbmV4dCAhPSBwb3RlbnRpYWxNYXRlLnBvcyB8fCBpdHZsLnBvcyAhPSBwb3RlbnRpYWxNYXRlLnBuZXh0KSB7IHJldHVybiBQQUlSSU5HX0NBTk5PVF9NQVRFOyB9XG4gICAgcmV0dXJuIFBBSVJJTkdfTUFURV9PTkxZO1xuICB9XG4gIFxuICBpZiAocG90ZW50aWFsTWF0ZS5fbW9ja2VkKSB7XG4gICAgXy5leHRlbmQocG90ZW50aWFsTWF0ZS5mbGFncywge1xuICAgICAgcmVhZFN0cmFuZFJldmVyc2U6IGl0dmwuZmxhZ3MubWF0ZVN0cmFuZFJldmVyc2UsXG4gICAgICBtYXRlU3RyYW5kUmV2ZXJzZTogaXR2bC5mbGFncy5yZWFkU3RyYW5kUmV2ZXJzZVxuICAgIH0pO1xuICB9IFxuICBcbiAgaXR2bElzTGF0ZXIgPSBpdHZsLnN0YXJ0ID4gcG90ZW50aWFsTWF0ZS5zdGFydDtcbiAgaW5mZXJyZWRJbnNlcnRTaXplID0gaXR2bElzTGF0ZXIgPyBpdHZsLnN0YXJ0IC0gcG90ZW50aWFsTWF0ZS5lbmQgOiBwb3RlbnRpYWxNYXRlLnN0YXJ0IC0gaXR2bC5lbmQ7XG4gIFxuICAvLyBDaGVjayB0aGF0IHRoZSBhbGlnbm1lbnRzIGFyZSAtLT4gPC0tXG4gIGlmIChpdHZsSXNMYXRlcikge1xuICAgIGlmICghaXR2bC5mbGFncy5yZWFkU3RyYW5kUmV2ZXJzZSB8fCBpdHZsLmZsYWdzLm1hdGVTdHJhbmRSZXZlcnNlKSB7IHJldHVybiBQQUlSSU5HX01BVEVfT05MWTsgfVxuICAgIGlmIChwb3RlbnRpYWxNYXRlLmZsYWdzLnJlYWRTdHJhbmRSZXZlcnNlIHx8ICFwb3RlbnRpYWxNYXRlLmZsYWdzLm1hdGVTdHJhbmRSZXZlcnNlKSB7IHJldHVybiBQQUlSSU5HX01BVEVfT05MWTsgfVxuICB9IGVsc2Uge1xuICAgIGlmIChpdHZsLmZsYWdzLnJlYWRTdHJhbmRSZXZlcnNlIHx8ICFpdHZsLmZsYWdzLm1hdGVTdHJhbmRSZXZlcnNlKSB7IHJldHVybiBQQUlSSU5HX01BVEVfT05MWTsgfVxuICAgIGlmICghcG90ZW50aWFsTWF0ZS5mbGFncy5yZWFkU3RyYW5kUmV2ZXJzZSB8fCBwb3RlbnRpYWxNYXRlLmZsYWdzLm1hdGVTdHJhbmRSZXZlcnNlKSB7IHJldHVybiBQQUlSSU5HX01BVEVfT05MWTsgfVxuICB9XG4gIFxuICAvLyBDaGVjayB0aGF0IHRoZSBpbmZlcnJlZEluc2VydFNpemUgaXMgd2l0aGluIHRoZSBhY2NlcHRhYmxlIHJhbmdlLlxuICBpdHZsLmluc2VydFNpemUgPSBwb3RlbnRpYWxNYXRlLmluc2VydFNpemUgPSBpbmZlcnJlZEluc2VydFNpemU7XG4gIGlmIChpbmZlcnJlZEluc2VydFNpemUgPiB0aGlzLnBhaXJpbmdNYXhEaXN0YW5jZSB8fCBpbmZlcnJlZEluc2VydFNpemUgPCB0aGlzLnBhaXJpbmdNaW5EaXN0YW5jZSkgeyByZXR1cm4gUEFJUklOR19NQVRFX09OTFk7IH1cbiAgXG4gIHJldHVybiBQQUlSSU5HX0RSQVdfQVNfTUFURVM7XG59XG5cbmV4cG9ydHMuUGFpcmVkSW50ZXJ2YWxUcmVlID0gUGFpcmVkSW50ZXJ2YWxUcmVlO1xuXG59KShtb2R1bGUgJiYgbW9kdWxlLmV4cG9ydHMgfHwgdGhpcyk7IiwiKGZ1bmN0aW9uKGV4cG9ydHMpe1xuXG52YXIgXyA9IHJlcXVpcmUoJy4uLy4uLy4uL3VuZGVyc2NvcmUubWluLmpzJyk7XG5cbi8qKlxuICAqIFJlbW90ZVRyYWNrXG4gICpcbiAgKiBBIGhlbHBlciBjbGFzcyBidWlsdCBmb3IgY2FjaGluZyBkYXRhIGZldGNoZWQgZnJvbSBhIHJlbW90ZSB0cmFjayAoZGF0YSBhbGlnbmVkIHRvIGEgZ2Vub21lKS5cbiAgKiBUaGUgZ2Vub21lIGlzIGRpdmlkZWQgaW50byBiaW5zIG9mIG9wdGltYWxGZXRjaFdpbmRvdyBudHMsIGZvciBlYWNoIG9mIHdoaWNoIGRhdGEgd2lsbCBvbmx5IGJlIGZldGNoZWQgb25jZS5cbiAgKiBUbyBzZXR1cCB0aGUgYmlucywgY2FsbCAuc2V0dXBCaW5zKC4uLikgYWZ0ZXIgaW5pdGlhbGl6aW5nIHRoZSBjbGFzcy5cbiAgKlxuICAqIFRoZXJlIGlzIG9uZSBtYWluIHB1YmxpYyBtZXRob2QgZm9yIHRoaXMgY2xhc3M6IC5mZXRjaEFzeW5jKHN0YXJ0LCBlbmQsIGNhbGxiYWNrKVxuICAqIChGb3IgY29uc2lzdGVuY3kgd2l0aCBDdXN0b21UcmFja3MuanMsIGFsbCBgc3RhcnRgIGFuZCBgZW5kYCBwb3NpdGlvbnMgYXJlIDEtYmFzZWQsIG9yaWVudGVkIHRvXG4gICogdGhlIHN0YXJ0IG9mIHRoZSBnZW5vbWUsIGFuZCBpbnRlcnZhbHMgYXJlIHJpZ2h0LW9wZW4uKVxuICAqXG4gICogVGhpcyBtZXRob2Qgd2lsbCByZXF1ZXN0IGFuZCBjYWNoZSBkYXRhIGZvciB0aGUgZ2l2ZW4gaW50ZXJ2YWwgdGhhdCBpcyBub3QgYWxyZWFkeSBjYWNoZWQsIGFuZCBjYWxsIFxuICAqIGNhbGxiYWNrKGludGVydmFscykgYXMgc29vbiBhcyBkYXRhIGZvciBhbGwgaW50ZXJ2YWxzIGlzIGF2YWlsYWJsZS4gKElmIHRoZSBkYXRhIGlzIGFscmVhZHkgYXZhaWxhYmxlLCBcbiAgKiBpdCB3aWxsIGNhbGwgdGhlIGNhbGxiYWNrIGltbWVkaWF0ZWx5LilcbiAgKiovXG5cbnZhciBCSU5fTE9BRElORyA9IDEsXG4gIEJJTl9MT0FERUQgPSAyO1xuXG4vKipcbiAgKiBSZW1vdGVUcmFjayBjb25zdHJ1Y3Rvci5cbiAgKlxuICAqIE5vdGUgeW91IHN0aWxsIG11c3QgY2FsbCBgLnNldHVwQmlucyguLi4pYCBiZWZvcmUgdGhlIFJlbW90ZVRyYWNrIGlzIHJlYWR5IHRvIGZldGNoIGRhdGEuXG4gICpcbiAgKiBAcGFyYW0gKEludGVydmFsVHJlZSkgY2FjaGU6IEFuIGNhY2hlIHN0b3JlIHRoYXQgd2lsbCByZWNlaXZlIGludGVydmFscyBmZXRjaGVkIGZvciBlYWNoIGJpbi5cbiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3VsZCBiZSBhbiBJbnRlcnZhbFRyZWUgb3IgZXF1aXZhbGVudCwgdGhhdCBpbXBsZW1lbnRzIGAuYWRkSWZOZXcoLi4uKWAgYW5kIFxuICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYC5zZWFyY2goc3RhcnQsIGVuZClgIG1ldGhvZHMuIElmIGl0IGlzIGFuICpleHRlbnNpb24qIG9mIGFuIEludGVydmFsVHJlZSwgbm90ZSBcbiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBgZXh0cmFBcmdzYCBwYXJhbSBwZXJtaXR0ZWQgZm9yIGAuZmV0Y2hBc3luYygpYCwgd2hpY2ggYXJlIHBhc3NlZCBhbG9uZyBhcyBcbiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhIGFyZ3VtZW50cyB0byBgLnNlYXJjaCgpYC5cbiAgKiBAcGFyYW0gKGZ1bmN0aW9uKSBmZXRjaGVyOiBBIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgdG8gZmV0Y2ggZGF0YSBmb3IgZWFjaCBiaW4uXG4gICogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhpcyBmdW5jdGlvbiBzaG91bGQgdGFrZSB0aHJlZSBhcmd1bWVudHMsIGBzdGFydGAsIGBlbmRgLCBhbmQgYHN0b3JlSW50ZXJ2YWxzYC5cbiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgc3RhcnRgIGFuZCBgZW5kYCBhcmUgMS1iYXNlZCBnZW5vbWljIGNvb3JkaW5hdGVzIGZvcm1pbmcgYSByaWdodC1vcGVuIGludGVydmFsLlxuICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBzdG9yZUludGVydmFsc2AgaXMgYSBjYWxsYmFjayB0aGF0IGBmZXRjaGVyYCBNVVNUIGNhbGwgb24gdGhlIGFycmF5IG9mIGludGVydmFsc1xuICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uY2UgdGhleSBoYXZlIGJlZW4gZmV0Y2hlZCBmcm9tIHRoZSByZW1vdGUgZGF0YSBzb3VyY2UgYW5kIHBhcnNlZC5cbiAgKiBAc2VlIF9mZXRjaEJpbiBmb3IgaG93IGBmZXRjaGVyYCBpcyB1dGlsaXplZC5cbiAgKiovXG5mdW5jdGlvbiBSZW1vdGVUcmFjayhjYWNoZSwgZmV0Y2hlcikge1xuICBpZiAodHlwZW9mIGNhY2hlICE9ICdvYmplY3QnIHx8ICghY2FjaGUuYWRkSWZOZXcgJiYgKCFfLmtleXMoY2FjaGUpLmxlbmd0aCB8fCBjYWNoZVtfLmtleXMoY2FjaGUpWzBdXS5hZGRJZk5ldykpKSB7IFxuICAgIHRocm93IG5ldyBFcnJvcigneW91IG11c3Qgc3BlY2lmeSBhbiBJbnRlcnZhbFRyZWUgY2FjaGUsIG9yIGFuIG9iamVjdC9hcnJheSBjb250YWluaW5nIEludGVydmFsVHJlZXMsIGFzIHRoZSAxc3QgYXJndW1lbnQuJyk7IFxuICB9XG4gIGlmICh0eXBlb2YgZmV0Y2hlciAhPSAnZnVuY3Rpb24nKSB7IHRocm93IG5ldyBFcnJvcigneW91IG11c3Qgc3BlY2lmeSBhIGZldGNoZXIgZnVuY3Rpb24gYXMgdGhlIDJuZCBhcmd1bWVudC4nKTsgfVxuICBcbiAgdGhpcy5jYWNoZSA9IGNhY2hlO1xuICB0aGlzLmZldGNoZXIgPSBmZXRjaGVyO1xuICBcbiAgdGhpcy5jYWxsYmFja3MgPSBbXTtcbiAgdGhpcy5hZnRlckJpblNldHVwID0gW107XG4gIHRoaXMuYmluc0xvYWRlZCA9IG51bGw7XG59XG5cbi8qKlxuICogcHVibGljIG1ldGhvZHNcbiAqKi9cblxuLy8gU2V0dXAgdGhlIGJpbm5pbmcgc2NoZW1lIGZvciB0aGlzIFJlbW90ZVRyYWNrLiBUaGlzIGNhbiBvY2N1ciBhbnl0aW1lIGFmdGVyIGluaXRpYWxpemF0aW9uLCBhbmQgaW4gZmFjdCxcbi8vIGNhbiBvY2N1ciBhZnRlciBjYWxscyB0byBgLmZldGNoQXN5bmMoKWAgaGF2ZSBiZWVuIG1hZGUsIGluIHdoaWNoIGNhc2UgdGhleSB3aWxsIGJlIHdhaXRpbmcgb24gdGhpcyBtZXRob2Rcbi8vIHRvIGJlIGNhbGxlZCB0byBwcm9jZWVkLiBCdXQgaXQgTVVTVCBiZSBjYWxsZWQgYmVmb3JlIGRhdGEgd2lsbCBiZSByZWNlaXZlZCBieSBjYWxsYmFja3MgcGFzc2VkIHRvIFxuLy8gYC5mZXRjaEFzeW5jKClgLlxuUmVtb3RlVHJhY2sucHJvdG90eXBlLnNldHVwQmlucyA9IGZ1bmN0aW9uKGdlbm9tZVNpemUsIG9wdGltYWxGZXRjaFdpbmRvdywgbWF4RmV0Y2hXaW5kb3cpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBpZiAoc2VsZi5iaW5zTG9hZGVkKSB7IHRocm93IG5ldyBFcnJvcigneW91IGNhbm5vdCBydW4gc2V0dXBCaW5zIG1vcmUgdGhhbiBvbmNlLicpOyB9XG4gIGlmICh0eXBlb2YgZ2Vub21lU2l6ZSAhPSAnbnVtYmVyJykgeyB0aHJvdyBuZXcgRXJyb3IoJ3lvdSBtdXN0IHNwZWNpZnkgdGhlIGdlbm9tZVNpemUgYXMgdGhlIDFzdCBhcmd1bWVudC4nKTsgfVxuICBpZiAodHlwZW9mIG9wdGltYWxGZXRjaFdpbmRvdyAhPSAnbnVtYmVyJykgeyB0aHJvdyBuZXcgRXJyb3IoJ3lvdSBtdXN0IHNwZWNpZnkgb3B0aW1hbEZldGNoV2luZG93IGFzIHRoZSAybmQgYXJndW1lbnQuJyk7IH1cbiAgaWYgKHR5cGVvZiBtYXhGZXRjaFdpbmRvdyAhPSAnbnVtYmVyJykgeyB0aHJvdyBuZXcgRXJyb3IoJ3lvdSBtdXN0IHNwZWNpZnkgbWF4RmV0Y2hXaW5kb3cgYXMgdGhlIDNyZCBhcmd1bWVudC4nKTsgfVxuICBcbiAgc2VsZi5nZW5vbWVTaXplID0gZ2Vub21lU2l6ZTtcbiAgc2VsZi5vcHRpbWFsRmV0Y2hXaW5kb3cgPSBvcHRpbWFsRmV0Y2hXaW5kb3c7XG4gIHNlbGYubWF4RmV0Y2hXaW5kb3cgPSBtYXhGZXRjaFdpbmRvdztcbiAgXG4gIHNlbGYubnVtQmlucyA9IE1hdGguY2VpbChnZW5vbWVTaXplIC8gb3B0aW1hbEZldGNoV2luZG93KTtcbiAgc2VsZi5iaW5zTG9hZGVkID0ge307XG4gIFxuICAvLyBGaXJlIG9mZiByYW5nZXMgc2F2ZWQgdG8gYWZ0ZXJCaW5TZXR1cFxuICBfLmVhY2godGhpcy5hZnRlckJpblNldHVwLCBmdW5jdGlvbihyYW5nZSkge1xuICAgIHNlbGYuZmV0Y2hBc3luYyhyYW5nZS5zdGFydCwgcmFuZ2UuZW5kLCByYW5nZS5leHRyYUFyZ3MpO1xuICB9KTtcbiAgX2NsZWFyQ2FsbGJhY2tzRm9yVG9vQmlnSW50ZXJ2YWxzKHNlbGYpO1xufVxuXG5cbi8vIEZldGNoZXMgZGF0YSAoaWYgbmVjZXNzYXJ5KSBmb3IgdW5mZXRjaGVkIGJpbnMgb3ZlcmxhcHBpbmcgd2l0aCB0aGUgaW50ZXJ2YWwgZnJvbSBgc3RhcnRgIHRvIGBlbmRgLlxuLy8gVGhlbiwgcnVuIGBjYWxsYmFja2Agb24gYWxsIHN0b3JlZCBzdWJpbnRlcnZhbHMgdGhhdCBvdmVybGFwIHdpdGggdGhlIGludGVydmFsIGZyb20gYHN0YXJ0YCB0byBgZW5kYC5cbi8vIGBleHRyYUFyZ3NgIGlzIGFuICpvcHRpb25hbCogcGFyYW1ldGVyIHRoYXQgY2FuIGNvbnRhaW4gYXJndW1lbnRzIHBhc3NlZCB0byB0aGUgYC5zZWFyY2goKWAgZnVuY3Rpb24gb2YgdGhlIGNhY2hlLlxuLy9cbi8vIEBwYXJhbSAobnVtYmVyKSBzdGFydDogICAgICAgMS1iYXNlZCBnZW5vbWljIGNvb3JkaW5hdGUgdG8gc3RhcnQgZmV0Y2hpbmcgZnJvbVxuLy8gQHBhcmFtIChudW1iZXIpIGVuZDogICAgICAgICAxLWJhc2VkIGdlbm9taWMgY29vcmRpbmF0ZSAocmlnaHQtb3BlbikgdG8gc3RhcnQgZmV0Y2hpbmcgKnVudGlsKlxuLy8gQHBhcmFtIChBcnJheSkgW2V4dHJhQXJnc106ICBvcHRpb25hbCwgcGFzc2VkIGFsb25nIHRvIHRoZSBgLnNlYXJjaCgpYCBjYWxscyBvbiB0aGUgLmNhY2hlIGFzIGFyZ3VtZW50cyAzIGFuZCB1cDsgXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmhhcHMgdXNlZnVsIGlmIHRoZSAuY2FjaGUgaGFzIG92ZXJyaWRkZW4gdGhpcyBtZXRob2Rcbi8vIEBwYXJhbSAoZnVuY3Rpb24pIGNhbGxiYWNrOiAgQSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIG9uY2UgZGF0YSBpcyByZWFkeSBmb3IgdGhpcyBpbnRlcnZhbC4gV2lsbCBiZSBwYXNzZWRcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsIGludGVydmFsIGZlYXR1cmVzIHRoYXQgaGF2ZSBiZWVuIGZldGNoZWQgZm9yIHRoaXMgaW50ZXJ2YWwsIG9yIHt0b29NYW55OiB0cnVlfVxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBtb3JlIGRhdGEgd2FzIHJlcXVlc3RlZCB0aGFuIGNvdWxkIGJlIHJlYXNvbmFibHkgZmV0Y2hlZC5cblJlbW90ZVRyYWNrLnByb3RvdHlwZS5mZXRjaEFzeW5jID0gZnVuY3Rpb24oc3RhcnQsIGVuZCwgZXh0cmFBcmdzLCBjYWxsYmFjaykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIGlmIChfLmlzRnVuY3Rpb24oZXh0cmFBcmdzKSAmJiBfLmlzVW5kZWZpbmVkKGNhbGxiYWNrKSkgeyBjYWxsYmFjayA9IGV4dHJhQXJnczsgZXh0cmFBcmdzID0gdW5kZWZpbmVkOyB9XG4gIGlmICghc2VsZi5iaW5zTG9hZGVkKSB7XG4gICAgLy8gSWYgYmlucyAqYXJlbid0KiBzZXR1cCB5ZXQ6XG4gICAgLy8gU2F2ZSB0aGUgY2FsbGJhY2sgb250byB0aGUgcXVldWVcbiAgICBpZiAoXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkgeyBcbiAgICAgIHNlbGYuY2FsbGJhY2tzLnB1c2goe3N0YXJ0OiBzdGFydCwgZW5kOiBlbmQsIGV4dHJhQXJnczogZXh0cmFBcmdzLCBjYWxsYmFjazogY2FsbGJhY2t9KTsgXG4gICAgfVxuICAgIFxuICAgIC8vIFNhdmUgdGhpcyBmZXRjaCBmb3Igd2hlbiB0aGUgYmlucyBhcmUgbG9hZGVkXG4gICAgc2VsZi5hZnRlckJpblNldHVwLnB1c2goe3N0YXJ0OiBzdGFydCwgZW5kOiBlbmQsIGV4dHJhQXJnczogZXh0cmFBcmdzfSk7XG4gIH0gZWxzZSB7XG4gICAgLy8gSWYgYmlucyAqYXJlKiBzZXR1cCwgZmlyc3QgY2FsY3VsYXRlIHdoaWNoIGJpbnMgY29ycmVzcG9uZCB0byB0aGlzIGludGVydmFsLCBcbiAgICAvLyBhbmQgd2hhdCBzdGF0ZSB0aG9zZSBiaW5zIGFyZSBpblxuICAgIHZhciBiaW5zID0gX2Jpbk92ZXJsYXAoc2VsZiwgc3RhcnQsIGVuZCksXG4gICAgICBsb2FkZWRCaW5zID0gXy5maWx0ZXIoYmlucywgZnVuY3Rpb24oaSkgeyByZXR1cm4gc2VsZi5iaW5zTG9hZGVkW2ldID09PSBCSU5fTE9BREVEOyB9KSxcbiAgICAgIGJpbnNUb0ZldGNoID0gXy5maWx0ZXIoYmlucywgZnVuY3Rpb24oaSkgeyByZXR1cm4gIXNlbGYuYmluc0xvYWRlZFtpXTsgfSk7XG4gICAgXG4gICAgaWYgKGxvYWRlZEJpbnMubGVuZ3RoID09IGJpbnMubGVuZ3RoKSB7XG4gICAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IGxvYWRlZCBkYXRhIGZvciBhbGwgdGhlIGJpbnMgaW4gcXVlc3Rpb24sIHNob3J0LWNpcmN1aXQgYW5kIHJ1biB0aGUgY2FsbGJhY2sgbm93XG4gICAgICBleHRyYUFyZ3MgPSBfLmlzVW5kZWZpbmVkKGV4dHJhQXJncykgPyBbXSA6IGV4dHJhQXJncztcbiAgICAgIHJldHVybiBfLmlzRnVuY3Rpb24oY2FsbGJhY2spICYmIGNhbGxiYWNrKHNlbGYuY2FjaGUuc2VhcmNoLmFwcGx5KHNlbGYuY2FjaGUsIFtzdGFydCwgZW5kXS5jb25jYXQoZXh0cmFBcmdzKSkpO1xuICAgIH0gZWxzZSBpZiAoZW5kIC0gc3RhcnQgPiBzZWxmLm1heEZldGNoV2luZG93KSB7XG4gICAgICAvLyBlbHNlLCBpZiB0aGlzIGludGVydmFsIGlzIHRvbyBiaWcgKD4gbWF4RmV0Y2hXaW5kb3cpLCBmaXJlIHRoZSBjYWxsYmFjayByaWdodCBhd2F5IHdpdGgge3Rvb01hbnk6IHRydWV9XG4gICAgICByZXR1cm4gXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSAmJiBjYWxsYmFjayh7dG9vTWFueTogdHJ1ZX0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBlbHNlLCBwdXNoIHRoZSBjYWxsYmFjayBvbnRvIHRoZSBxdWV1ZVxuICAgIGlmIChfLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7IFxuICAgICAgc2VsZi5jYWxsYmFja3MucHVzaCh7c3RhcnQ6IHN0YXJ0LCBlbmQ6IGVuZCwgZXh0cmFBcmdzOiBleHRyYUFyZ3MsIGNhbGxiYWNrOiBjYWxsYmFja30pOyBcbiAgICB9XG4gICAgXG4gICAgLy8gdGhlbiBydW4gZmV0Y2hlcyBmb3IgdGhlIHVuZmV0Y2hlZCBiaW5zLCB3aGljaCBzaG91bGQgY2FsbCBfZmlyZUNhbGxiYWNrcyBhZnRlciB0aGV5IGNvbXBsZXRlLFxuICAgIC8vIHdoaWNoIHdpbGwgYXV0b21hdGljYWxseSBmaXJlIGNhbGxiYWNrcyBmcm9tIHRoZSBhYm92ZSBxdWV1ZSBhcyB0aGV5IGFjcXVpcmUgYWxsIG5lZWRlZCBkYXRhLlxuICAgIF8uZWFjaChiaW5zVG9GZXRjaCwgZnVuY3Rpb24oYmluSW5kZXgpIHtcbiAgICAgIF9mZXRjaEJpbihzZWxmLCBiaW5JbmRleCwgZnVuY3Rpb24oKSB7IF9maXJlQ2FsbGJhY2tzKHNlbGYpOyB9KTtcbiAgICB9KTtcbiAgfVxufVxuXG5cbi8qKlxuICogcHJpdmF0ZSBtZXRob2RzXG4gKiovXG5cbi8vIENhbGN1bGF0ZXMgd2hpY2ggYmlucyBvdmVybGFwIHdpdGggYW4gaW50ZXJ2YWwgZ2l2ZW4gYnkgYHN0YXJ0YCBhbmQgYGVuZGAuXG4vLyBgc3RhcnRgIGFuZCBgZW5kYCBhcmUgMS1iYXNlZCBjb29yZGluYXRlcyBmb3JtaW5nIGEgcmlnaHQtb3BlbiBpbnRlcnZhbC5cbmZ1bmN0aW9uIF9iaW5PdmVybGFwKHJlbW90ZVRyaywgc3RhcnQsIGVuZCkge1xuICBpZiAoIXJlbW90ZVRyay5iaW5zTG9hZGVkKSB7IHRocm93IG5ldyBFcnJvcigneW91IGNhbm5vdCBjYWxjdWxhdGUgYmluIG92ZXJsYXAgYmVmb3JlIHNldHVwQmlucyBpcyBjYWxsZWQuJyk7IH1cbiAgLy8gSW50ZXJuYWxseSwgZm9yIGFzc2lnbmluZyBjb29yZGluYXRlcyB0byBiaW5zLCB3ZSB1c2UgMC1iYXNlZCBjb29yZGluYXRlcyBmb3IgZWFzaWVyIGNhbGN1bGF0aW9ucy5cbiAgdmFyIHN0YXJ0QmluID0gTWF0aC5mbG9vcigoc3RhcnQgLSAxKSAvIHJlbW90ZVRyay5vcHRpbWFsRmV0Y2hXaW5kb3cpLFxuICAgIGVuZEJpbiA9IE1hdGguZmxvb3IoKGVuZCAtIDEpIC8gcmVtb3RlVHJrLm9wdGltYWxGZXRjaFdpbmRvdyk7XG4gIHJldHVybiBfLnJhbmdlKHN0YXJ0QmluLCBlbmRCaW4gKyAxKTtcbn1cblxuLy8gUnVucyB0aGUgZmV0Y2hlciBmdW5jdGlvbiBvbiBhIGdpdmVuIGJpbi5cbi8vIFRoZSBmZXRjaGVyIGZ1bmN0aW9uIGlzIG9ibGlnYXRlZCB0byBydW4gYSBjYWxsYmFjayBmdW5jdGlvbiBgc3RvcmVJbnRlcnZhbHNgLCBcbi8vICAgIHBhc3NlZCBhcyBpdHMgdGhpcmQgYXJndW1lbnQsIG9uIGEgc2V0IG9mIGludGVydmFscyB0aGF0IHdpbGwgYmUgaW5zZXJ0ZWQgaW50byB0aGUgXG4vLyAgICByZW1vdGVUcmsuY2FjaGUgSW50ZXJ2YWxUcmVlLlxuLy8gVGhlIGBzdG9yZUludGVydmFsc2AgZnVuY3Rpb24gbWF5IGFjY2VwdCBhIHNlY29uZCBhcmd1bWVudCBjYWxsZWQgYGNhY2hlSW5kZXhgLCBpbiBjYXNlXG4vLyAgICByZW1vdGVUcmsuY2FjaGUgaXMgYWN0dWFsbHkgYSBjb250YWluZXIgZm9yIG11bHRpcGxlIEludGVydmFsVHJlZXMsIGluZGljYXRpbmcgd2hpY2ggXG4vLyAgICBvbmUgdG8gc3RvcmUgaXQgaW4uXG4vLyBXZSB0aGVuIGNhbGwgdGhlIGBjYWxsYmFja2AgZ2l2ZW4gaGVyZSBhZnRlciB0aGF0IGlzIGNvbXBsZXRlLlxuZnVuY3Rpb24gX2ZldGNoQmluKHJlbW90ZVRyaywgYmluSW5kZXgsIGNhbGxiYWNrKSB7XG4gIHZhciBzdGFydCA9IGJpbkluZGV4ICogcmVtb3RlVHJrLm9wdGltYWxGZXRjaFdpbmRvdyArIDEsXG4gICAgZW5kID0gKGJpbkluZGV4ICsgMSkgKiByZW1vdGVUcmsub3B0aW1hbEZldGNoV2luZG93ICsgMTtcbiAgcmVtb3RlVHJrLmJpbnNMb2FkZWRbYmluSW5kZXhdID0gQklOX0xPQURJTkc7XG4gIHJlbW90ZVRyay5mZXRjaGVyKHN0YXJ0LCBlbmQsIGZ1bmN0aW9uIHN0b3JlSW50ZXJ2YWxzKGludGVydmFscykge1xuICAgIF8uZWFjaChpbnRlcnZhbHMsIGZ1bmN0aW9uKGludGVydmFsKSB7XG4gICAgICBpZiAoIWludGVydmFsKSB7IHJldHVybjsgfVxuICAgICAgcmVtb3RlVHJrLmNhY2hlLmFkZElmTmV3KGludGVydmFsLCBpbnRlcnZhbC5pZCk7XG4gICAgfSk7XG4gICAgcmVtb3RlVHJrLmJpbnNMb2FkZWRbYmluSW5kZXhdID0gQklOX0xPQURFRDtcbiAgICBfLmlzRnVuY3Rpb24oY2FsbGJhY2spICYmIGNhbGxiYWNrKCk7XG4gIH0pO1xufVxuXG4vLyBSdW5zIHRocm91Z2ggYWxsIHNhdmVkIGNhbGxiYWNrcyBhbmQgZmlyZXMgYW55IGNhbGxiYWNrcyB3aGVyZSBhbGwgdGhlIHJlcXVpcmVkIGRhdGEgaXMgcmVhZHlcbi8vIENhbGxiYWNrcyB0aGF0IGFyZSBmaXJlZCBhcmUgcmVtb3ZlZCBmcm9tIHRoZSBxdWV1ZS5cbmZ1bmN0aW9uIF9maXJlQ2FsbGJhY2tzKHJlbW90ZVRyaykge1xuICByZW1vdGVUcmsuY2FsbGJhY2tzID0gXy5maWx0ZXIocmVtb3RlVHJrLmNhbGxiYWNrcywgZnVuY3Rpb24oYWZ0ZXJMb2FkKSB7XG4gICAgdmFyIGNhbGxiYWNrID0gYWZ0ZXJMb2FkLmNhbGxiYWNrLFxuICAgICAgZXh0cmFBcmdzID0gXy5pc1VuZGVmaW5lZChhZnRlckxvYWQuZXh0cmFBcmdzKSA/IFtdIDogYWZ0ZXJMb2FkLmV4dHJhQXJncyxcbiAgICAgIGJpbnMsIHN0aWxsTG9hZGluZ0JpbnM7XG4gICAgICAgIFxuICAgIGlmIChhZnRlckxvYWQuZW5kIC0gYWZ0ZXJMb2FkLnN0YXJ0ID4gcmVtb3RlVHJrLm1heEZldGNoV2luZG93KSB7XG4gICAgICBjYWxsYmFjayh7dG9vTWFueTogdHJ1ZX0pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICBiaW5zID0gX2Jpbk92ZXJsYXAocmVtb3RlVHJrLCBhZnRlckxvYWQuc3RhcnQsIGFmdGVyTG9hZC5lbmQpO1xuICAgIHN0aWxsTG9hZGluZ0JpbnMgPSBfLmZpbHRlcihiaW5zLCBmdW5jdGlvbihpKSB7IHJldHVybiByZW1vdGVUcmsuYmluc0xvYWRlZFtpXSAhPT0gQklOX0xPQURFRDsgfSkubGVuZ3RoID4gMDtcbiAgICBpZiAoIXN0aWxsTG9hZGluZ0JpbnMpIHtcbiAgICAgIGNhbGxiYWNrKHJlbW90ZVRyay5jYWNoZS5zZWFyY2guYXBwbHkocmVtb3RlVHJrLmNhY2hlLCBbYWZ0ZXJMb2FkLnN0YXJ0LCBhZnRlckxvYWQuZW5kXS5jb25jYXQoZXh0cmFBcmdzKSkpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSk7XG59XG5cbi8vIFJ1bnMgdGhyb3VnaCBhbGwgc2F2ZWQgY2FsbGJhY2tzIGFuZCBmaXJlcyBhbnkgY2FsbGJhY2tzIGZvciB3aGljaCB3ZSB3b24ndCBsb2FkIGRhdGEgc2luY2UgdGhlIGFtb3VudFxuLy8gcmVxdWVzdGVkIGlzIHRvbyBsYXJnZS4gQ2FsbGJhY2tzIHRoYXQgYXJlIGZpcmVkIGFyZSByZW1vdmVkIGZyb20gdGhlIHF1ZXVlLlxuZnVuY3Rpb24gX2NsZWFyQ2FsbGJhY2tzRm9yVG9vQmlnSW50ZXJ2YWxzKHJlbW90ZVRyaykge1xuICByZW1vdGVUcmsuY2FsbGJhY2tzID0gXy5maWx0ZXIocmVtb3RlVHJrLmNhbGxiYWNrcywgZnVuY3Rpb24oYWZ0ZXJMb2FkKSB7XG4gICAgdmFyIGNhbGxiYWNrID0gYWZ0ZXJMb2FkLmNhbGxiYWNrO1xuICAgIGlmIChhZnRlckxvYWQuZW5kIC0gYWZ0ZXJMb2FkLnN0YXJ0ID4gcmVtb3RlVHJrLm1heEZldGNoV2luZG93KSB7XG4gICAgICBjYWxsYmFjayh7dG9vTWFueTogdHJ1ZX0pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSk7XG59XG5cblxuZXhwb3J0cy5SZW1vdGVUcmFjayA9IFJlbW90ZVRyYWNrO1xuXG59KShtb2R1bGUgJiYgbW9kdWxlLmV4cG9ydHMgfHwgdGhpcyk7IiwiKGZ1bmN0aW9uKGV4cG9ydHMpe1xuLy8gVE9ETzogYmFja3BvcnQgdGhpcyBjb2RlIGZvciBKYXZhU2NyaXB0IDEuNT8gdXNpbmcgdW5kZXJzY29yZS5qc1xuLyoqXG4gKiBCeSBTaGluIFN1enVraSwgTUlUIGxpY2Vuc2VcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9zaGlub3V0L1NvcnRlZExpc3RcbiAqXG4gKiBTb3J0ZWRMaXN0IDogY29uc3RydWN0b3JcbiAqIFxuICogQHBhcmFtIGFyciA6IEFycmF5IG9yIG51bGwgOiBhbiBhcnJheSB0byBzZXRcbiAqXG4gKiBAcGFyYW0gb3B0aW9ucyA6IG9iamVjdCAgb3IgbnVsbFxuICogICAgICAgICAoZnVuY3Rpb24pIGZpbHRlciAgOiBmaWx0ZXIgZnVuY3Rpb24gY2FsbGVkIGJlZm9yZSBpbnNlcnRpbmcgZGF0YS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhpcyByZWNlaXZlcyBhIHZhbHVlIGFuZCByZXR1cm5zIHRydWUgaWYgdGhlIHZhbHVlIGlzIHZhbGlkLlxuICpcbiAqICAgICAgICAgKGZ1bmN0aW9uKSBjb21wYXJlIDogZnVuY3Rpb24gdG8gY29tcGFyZSB0d28gdmFsdWVzLCBcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpY2ggaXMgdXNlZCBmb3Igc29ydGluZyBvcmRlci5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIHNhbWUgc2lnbmF0dXJlIGFzIEFycmF5LnByb3RvdHlwZS5zb3J0KGZuKS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gKiAgICAgICAgIChzdHJpbmcpICAgY29tcGFyZSA6IGlmIHlvdSdkIGxpa2UgdG8gc2V0IGEgY29tbW9uIGNvbXBhcmlzb24gZnVuY3Rpb24sXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlvdSBjYW4gc3BlY2lmeSBpdCBieSBzdHJpbmc6XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibnVtYmVyXCIgOiBjb21wYXJlcyBudW1iZXJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdHJpbmdcIiA6IGNvbXBhcmVzIHN0cmluZ1xuICovXG5mdW5jdGlvbiBTb3J0ZWRMaXN0KCkge1xuICB2YXIgYXJyICAgICA9IG51bGwsXG4gICAgICBvcHRpb25zID0ge30sXG4gICAgICBhcmdzICAgID0gYXJndW1lbnRzO1xuXG4gIFtcIjBcIixcIjFcIl0uZm9yRWFjaChmdW5jdGlvbihuKSB7XG4gICAgdmFyIHZhbCA9IGFyZ3Nbbl07XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkge1xuICAgICAgYXJyID0gdmFsO1xuICAgIH1cbiAgICBlbHNlIGlmICh2YWwgJiYgdHlwZW9mIHZhbCA9PSBcIm9iamVjdFwiKSB7XG4gICAgICBvcHRpb25zID0gdmFsO1xuICAgIH1cbiAgfSk7XG4gIHRoaXMuYXJyID0gW107XG5cbiAgW1wiZmlsdGVyXCIsIFwiY29tcGFyZVwiXS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnNba10gPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICB0aGlzW2tdID0gb3B0aW9uc1trXTtcbiAgICB9XG4gICAgZWxzZSBpZiAob3B0aW9uc1trXSAmJiBTb3J0ZWRMaXN0W2tdW29wdGlvbnNba11dKSB7XG4gICAgICB0aGlzW2tdID0gU29ydGVkTGlzdFtrXVtvcHRpb25zW2tdXTtcbiAgICB9XG4gIH0sIHRoaXMpO1xuICBpZiAoYXJyKSB0aGlzLm1hc3NJbnNlcnQoYXJyKTtcbn07XG5cbi8vIEJpbmFyeSBzZWFyY2ggZm9yIHRoZSBpbmRleCBvZiB0aGUgaXRlbSBlcXVhbCB0byBgdmFsYCwgb3IgaWYgbm8gc3VjaCBpdGVtIGV4aXN0cywgdGhlIG5leHQgbG93ZXIgaXRlbVxuLy8gVGhpcyBjYW4gYmUgLTEgaWYgYHZhbGAgaXMgbG93ZXIgdGhhbiB0aGUgbG93ZXN0IGl0ZW0gaW4gdGhlIFNvcnRlZExpc3RcblNvcnRlZExpc3QucHJvdG90eXBlLmJzZWFyY2ggPSBmdW5jdGlvbih2YWwpIHtcbiAgdmFyIG1wb3MsXG4gICAgICBzcG9zID0gMCxcbiAgICAgIGVwb3MgPSB0aGlzLmFyci5sZW5ndGg7XG4gIHdoaWxlIChlcG9zIC0gc3BvcyA+IDEpIHtcbiAgICBtcG9zID0gTWF0aC5mbG9vcigoc3BvcyArIGVwb3MpLzIpO1xuICAgIG12YWwgPSB0aGlzLmFyclttcG9zXTtcbiAgICBzd2l0Y2ggKHRoaXMuY29tcGFyZSh2YWwsIG12YWwpKSB7XG4gICAgY2FzZSAxICA6XG4gICAgZGVmYXVsdCA6XG4gICAgICBzcG9zID0gbXBvcztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgLTEgOlxuICAgICAgZXBvcyA9IG1wb3M7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDAgIDpcbiAgICAgIHJldHVybiBtcG9zO1xuICAgIH1cbiAgfVxuICByZXR1cm4gKHRoaXMuYXJyWzBdID09IG51bGwgfHwgc3BvcyA9PSAwICYmIHRoaXMuYXJyWzBdICE9IG51bGwgJiYgdGhpcy5jb21wYXJlKHRoaXMuYXJyWzBdLCB2YWwpID09IDEpID8gLTEgOiBzcG9zO1xufTtcblxuU29ydGVkTGlzdC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24ocG9zKSB7XG4gIHJldHVybiB0aGlzLmFycltwb3NdO1xufTtcblxuU29ydGVkTGlzdC5wcm90b3R5cGUudG9BcnJheSA9IGZ1bmN0aW9uKHBvcykge1xuICByZXR1cm4gdGhpcy5hcnIuc2xpY2UoKTtcbn07XG5cblNvcnRlZExpc3QucHJvdG90eXBlLnNsaWNlID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB0aGlzLmFyci5zbGljZS5hcHBseSh0aGlzLmFyciwgYXJndW1lbnRzKTtcbn1cblxuU29ydGVkTGlzdC5wcm90b3R5cGUuc2l6ZSA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5hcnIubGVuZ3RoO1xufTtcblxuU29ydGVkTGlzdC5wcm90b3R5cGUuaGVhZCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5hcnJbMF07XG59O1xuXG5Tb3J0ZWRMaXN0LnByb3RvdHlwZS50YWlsID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiAodGhpcy5hcnIubGVuZ3RoID09IDApID8gbnVsbCA6IHRoaXMuYXJyW3RoaXMuYXJyLmxlbmd0aCAtMV07XG59O1xuXG5Tb3J0ZWRMaXN0LnByb3RvdHlwZS5tYXNzSW5zZXJ0ID0gZnVuY3Rpb24oaXRlbXMpIHtcbiAgLy8gVGhpcyBsb29wIGF2b2lkcyBjYWxsIHN0YWNrIG92ZXJmbG93IGJlY2F1c2Ugb2YgdG9vIG1hbnkgYXJndW1lbnRzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpICs9IDQwOTYpIHtcbiAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseSh0aGlzLmFyciwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoaXRlbXMsIGksIGkgKyA0MDk2KSk7XG4gIH1cbiAgdGhpcy5hcnIuc29ydCh0aGlzLmNvbXBhcmUpO1xufVxuXG5Tb3J0ZWRMaXN0LnByb3RvdHlwZS5pbnNlcnQgPSBmdW5jdGlvbigpIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxMDApIHtcbiAgICAvLyAuYnNlYXJjaCArIC5zcGxpY2UgaXMgdG9vIGV4cGVuc2l2ZSB0byByZXBlYXQgZm9yIHNvIG1hbnkgZWxlbWVudHMuXG4gICAgLy8gTGV0J3MganVzdCBhcHBlbmQgdGhlbSBhbGwgdG8gdGhpcy5hcnIgYW5kIHJlc29ydC5cbiAgICB0aGlzLm1hc3NJbnNlcnQoYXJndW1lbnRzKTtcbiAgfSBlbHNlIHtcbiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGFyZ3VtZW50cywgZnVuY3Rpb24odmFsKSB7XG4gICAgICB2YXIgcG9zID0gdGhpcy5ic2VhcmNoKHZhbCk7XG4gICAgICBpZiAodGhpcy5maWx0ZXIodmFsLCBwb3MpKSB7XG4gICAgICAgIHRoaXMuYXJyLnNwbGljZShwb3MrMSwgMCwgdmFsKTtcbiAgICAgIH1cbiAgICB9LCB0aGlzKTtcbiAgfVxufTtcblxuU29ydGVkTGlzdC5wcm90b3R5cGUuZmlsdGVyID0gZnVuY3Rpb24odmFsLCBwb3MpIHtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5Tb3J0ZWRMaXN0LnByb3RvdHlwZS5hZGQgPSBTb3J0ZWRMaXN0LnByb3RvdHlwZS5pbnNlcnQ7XG5cblNvcnRlZExpc3QucHJvdG90eXBlW1wiZGVsZXRlXCJdID0gZnVuY3Rpb24ocG9zKSB7XG4gIHRoaXMuYXJyLnNwbGljZShwb3MsIDEpO1xufTtcblxuU29ydGVkTGlzdC5wcm90b3R5cGUucmVtb3ZlID0gU29ydGVkTGlzdC5wcm90b3R5cGVbXCJkZWxldGVcIl07XG5cblNvcnRlZExpc3QucHJvdG90eXBlLm1hc3NSZW1vdmUgPSBmdW5jdGlvbihzdGFydFBvcywgY291bnQpIHtcbiAgdGhpcy5hcnIuc3BsaWNlKHN0YXJ0UG9zLCBjb3VudCk7XG59O1xuXG4vKipcbiAqIGRlZmF1bHQgY29tcGFyZSBmdW5jdGlvbnMgXG4gKiovXG5Tb3J0ZWRMaXN0LmNvbXBhcmUgPSB7XG4gIFwibnVtYmVyXCI6IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICB2YXIgYyA9IGEgLSBiO1xuICAgIHJldHVybiAoYyA+IDApID8gMSA6IChjID09IDApICA/IDAgOiAtMTtcbiAgfSxcblxuICBcInN0cmluZ1wiOiBmdW5jdGlvbihhLCBiKSB7XG4gICAgcmV0dXJuIChhID4gYikgPyAxIDogKGEgPT0gYikgID8gMCA6IC0xO1xuICB9XG59O1xuXG5Tb3J0ZWRMaXN0LnByb3RvdHlwZS5jb21wYXJlID0gU29ydGVkTGlzdC5jb21wYXJlW1wibnVtYmVyXCJdO1xuXG5leHBvcnRzLlNvcnRlZExpc3QgPSBTb3J0ZWRMaXN0O1xuXG59KShtb2R1bGUgJiYgbW9kdWxlLmV4cG9ydHMgfHwgdGhpcyk7IiwidmFyIF8gPSByZXF1aXJlKCcuLi8uLi8uLi91bmRlcnNjb3JlLm1pbi5qcycpO1xuXG4vLyBQYXJzZSBhIHRyYWNrIGRlY2xhcmF0aW9uIGxpbmUsIHdoaWNoIGlzIGluIHRoZSBmb3JtYXQgb2Y6XG4vLyB0cmFjayBuYW1lPVwiYmxhaFwiIG9wdG5hbWUxPVwidmFsdWUxXCIgb3B0bmFtZTI9XCJ2YWx1ZTJcIiAuLi5cbi8vIGludG8gYSBoYXNoIG9mIG9wdGlvbnNcbm1vZHVsZS5leHBvcnRzLnBhcnNlRGVjbGFyYXRpb25MaW5lID0gZnVuY3Rpb24obGluZSwgc3RhcnQpIHtcbiAgdmFyIG9wdHMgPSB7fSwgb3B0bmFtZSA9ICcnLCB2YWx1ZSA9ICcnLCBzdGF0ZSA9ICdvcHRuYW1lJztcbiAgZnVuY3Rpb24gcHVzaFZhbHVlKHF1b3RpbmcpIHtcbiAgICBzdGF0ZSA9ICdvcHRuYW1lJztcbiAgICBvcHRzW29wdG5hbWUucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpXSA9IHZhbHVlO1xuICAgIG9wdG5hbWUgPSB2YWx1ZSA9ICcnO1xuICB9XG4gIGZvciAoaSA9IGxpbmUubWF0Y2goc3RhcnQpWzBdLmxlbmd0aDsgaSA8IGxpbmUubGVuZ3RoOyBpKyspIHtcbiAgICBjID0gbGluZVtpXTtcbiAgICBpZiAoc3RhdGUgPT0gJ29wdG5hbWUnKSB7XG4gICAgICBpZiAoYyA9PSAnPScpIHsgc3RhdGUgPSAnc3RhcnR2YWx1ZSc7IH1cbiAgICAgIGVsc2UgeyBvcHRuYW1lICs9IGM7IH1cbiAgICB9IGVsc2UgaWYgKHN0YXRlID09ICdzdGFydHZhbHVlJykge1xuICAgICAgaWYgKC8nfFwiLy50ZXN0KGMpKSB7IHN0YXRlID0gYzsgfVxuICAgICAgZWxzZSB7IHZhbHVlICs9IGM7IHN0YXRlID0gJ3ZhbHVlJzsgfVxuICAgIH0gZWxzZSBpZiAoc3RhdGUgPT0gJ3ZhbHVlJykge1xuICAgICAgaWYgKC9cXHMvLnRlc3QoYykpIHsgcHVzaFZhbHVlKCk7IH1cbiAgICAgIGVsc2UgeyB2YWx1ZSArPSBjOyB9XG4gICAgfSBlbHNlIGlmICgvJ3xcIi8udGVzdChzdGF0ZSkpIHtcbiAgICAgIGlmIChjID09IHN0YXRlKSB7IHB1c2hWYWx1ZShzdGF0ZSk7IH1cbiAgICAgIGVsc2UgeyB2YWx1ZSArPSBjOyB9XG4gICAgfVxuICB9XG4gIGlmIChzdGF0ZSA9PSAndmFsdWUnKSB7IHB1c2hWYWx1ZSgpOyB9XG4gIGlmIChzdGF0ZSAhPSAnb3B0bmFtZScpIHsgcmV0dXJuIGZhbHNlOyB9XG4gIHJldHVybiBvcHRzO1xufVxuXG4vLyBDb25zdHJ1Y3RzIGEgbWFwcGluZyBmdW5jdGlvbiB0aGF0IGNvbnZlcnRzIGJwIGludGVydmFscyBpbnRvIHBpeGVsIGludGVydmFscywgd2l0aCBvcHRpb25hbCBjYWxjdWxhdGlvbnMgZm9yIHRleHQgdG9vXG5tb2R1bGUuZXhwb3J0cy5waXhJbnRlcnZhbENhbGN1bGF0b3IgPSBmdW5jdGlvbihzdGFydCwgd2lkdGgsIGJwcHAsIHdpdGhUZXh0LCBuYW1lRnVuYywgc3RhcnRrZXksIGVuZGtleSkge1xuICBpZiAoIV8uaXNGdW5jdGlvbihuYW1lRnVuYykpIHsgbmFtZUZ1bmMgPSBmdW5jdGlvbihkKSB7IHJldHVybiBkLm5hbWUgfHwgJyc7IH07IH1cbiAgaWYgKF8uaXNVbmRlZmluZWQoc3RhcnRrZXkpKSB7IHN0YXJ0a2V5ID0gJ3N0YXJ0JzsgfVxuICBpZiAoXy5pc1VuZGVmaW5lZChlbmRrZXkpKSB7IGVuZGtleSA9ICdlbmQnOyB9XG4gIHJldHVybiBmdW5jdGlvbihkKSB7XG4gICAgdmFyIGl0dmxTdGFydCA9IF8uaXNVbmRlZmluZWQoZFtzdGFydGtleV0pID8gZC5zdGFydCA6IGRbc3RhcnRrZXldLFxuICAgICAgaXR2bEVuZCA9IF8uaXNVbmRlZmluZWQoZFtlbmRrZXldKSA/IGQuZW5kIDogZFtlbmRrZXldO1xuICAgIHZhciBwSW50ID0ge1xuICAgICAgeDogTWF0aC5yb3VuZCgoaXR2bFN0YXJ0IC0gc3RhcnQpIC8gYnBwcCksXG4gICAgICB3OiBNYXRoLnJvdW5kKChpdHZsRW5kIC0gaXR2bFN0YXJ0KSAvIGJwcHApICsgMSxcbiAgICAgIHQ6IDAsICAgICAgICAgIC8vIGNhbGN1bGF0ZWQgd2lkdGggb2YgdGV4dFxuICAgICAgb1ByZXY6IGZhbHNlLCAgLy8gb3ZlcmZsb3dzIGludG8gcHJldmlvdXMgdGlsZT9cbiAgICAgIG9OZXh0OiBmYWxzZSAgIC8vIG92ZXJmbG93cyBpbnRvIG5leHQgdGlsZT9cbiAgICB9O1xuICAgIHBJbnQudHggPSBwSW50Lng7XG4gICAgcEludC50dyA9IHBJbnQudztcbiAgICBpZiAocEludC54IDwgMCkgeyBwSW50LncgKz0gcEludC54OyBwSW50LnggPSAwOyBwSW50Lm9QcmV2ID0gdHJ1ZTsgfVxuICAgIGVsc2UgaWYgKHdpdGhUZXh0KSB7XG4gICAgICBwSW50LnQgPSBfLmlzTnVtYmVyKHdpdGhUZXh0KSA/IHdpdGhUZXh0IDogTWF0aC5taW4obmFtZUZ1bmMoZCkubGVuZ3RoICogMTAgKyAyLCBwSW50LngpO1xuICAgICAgcEludC50eCAtPSBwSW50LnQ7XG4gICAgICBwSW50LnR3ICs9IHBJbnQudDsgIFxuICAgIH1cbiAgICBpZiAocEludC54ICsgcEludC53ID4gd2lkdGgpIHsgcEludC53ID0gd2lkdGggLSBwSW50Lng7IHBJbnQub05leHQgPSB0cnVlOyB9XG4gICAgcmV0dXJuIHBJbnQ7XG4gIH07XG59O1xuXG4vLyBGb3IgdHdvIGdpdmVuIG9iamVjdHMgb2YgdGhlIGZvcm0ge3g6IDEsIHc6IDJ9IChwaXhlbCBpbnRlcnZhbHMpLCBkZXNjcmliZSB0aGUgb3ZlcmxhcC5cbi8vIFJldHVybnMgbnVsbCBpZiB0aGVyZSBpcyBubyBvdmVybGFwLlxubW9kdWxlLmV4cG9ydHMucGl4SW50ZXJ2YWxPdmVybGFwID0gZnVuY3Rpb24ocEludDEsIHBJbnQyKSB7XG4gIHZhciBvdmVybGFwID0ge30sXG4gICAgdG1wO1xuICBpZiAocEludDEueCA+IHBJbnQyLngpIHsgdG1wID0gcEludDI7IHBJbnQyID0gcEludDE7IHBJbnQxID0gdG1wOyB9ICAgICAgIC8vIHN3YXAgc28gdGhhdCBwSW50MSBpcyBhbHdheXMgbG93ZXJcbiAgaWYgKCFwSW50MS53IHx8ICFwSW50Mi53IHx8IHBJbnQxLnggKyBwSW50MS53IDwgcEludDIueCkgeyByZXR1cm4gbnVsbDsgfSAvLyBkZXRlY3Qgbm8tb3ZlcmxhcCBjb25kaXRpb25zXG4gIG92ZXJsYXAueCA9IHBJbnQyLng7XG4gIG92ZXJsYXAudyA9IE1hdGgubWluKHBJbnQxLncgLSBwSW50Mi54ICsgcEludDEueCwgcEludDIudyk7XG4gIHJldHVybiBvdmVybGFwO1xufTtcblxuLy8gQ29tbW9uIGZ1bmN0aW9ucyBmb3Igc3VtbWFyaXppbmcgZGF0YSBpbiBiaW5zIHdoaWxlIHBsb3R0aW5nIHdpZ2dsZSB0cmFja3Ncbm1vZHVsZS5leHBvcnRzLndpZ0JpbkZ1bmN0aW9ucyA9IHtcbiAgbWluaW11bTogZnVuY3Rpb24oYmluKSB7IHJldHVybiBiaW4ubGVuZ3RoID8gTWF0aC5taW4uYXBwbHkoTWF0aCwgYmluKSA6IDA7IH0sXG4gIG1lYW46IGZ1bmN0aW9uKGJpbikgeyByZXR1cm4gXy5yZWR1Y2UoYmluLCBmdW5jdGlvbihhLGIpIHsgcmV0dXJuIGEgKyBiOyB9LCAwKSAvIGJpbi5sZW5ndGg7IH0sXG4gIG1heGltdW06IGZ1bmN0aW9uKGJpbikgeyByZXR1cm4gYmluLmxlbmd0aCA/IE1hdGgubWF4LmFwcGx5KE1hdGgsIGJpbikgOiAwOyB9XG59O1xuXG4vLyBGYXN0ZXIgdGhhbiBNYXRoLmZsb29yIChodHRwOi8vd2ViZG9vZC5jb20vP3A9MjE5KVxubW9kdWxlLmV4cG9ydHMuZmxvb3JIYWNrID0gZnVuY3Rpb24obnVtKSB7IHJldHVybiAobnVtIDw8IDApIC0gKG51bSA8IDAgPyAxIDogMCk7IH1cblxuLy8gT3RoZXIgdGlueSBmdW5jdGlvbnMgdGhhdCB3ZSBuZWVkIGZvciBvZGRzIGFuZCBlbmRzLi4uXG5tb2R1bGUuZXhwb3J0cy5zdHJpcCA9IGZ1bmN0aW9uKHN0cikgeyByZXR1cm4gc3RyLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKTsgfVxubW9kdWxlLmV4cG9ydHMucGFyc2VJbnQxMCA9IGZ1bmN0aW9uKHZhbCkgeyByZXR1cm4gcGFyc2VJbnQodmFsLCAxMCk7IH1cbm1vZHVsZS5leHBvcnRzLmRlZXBDbG9uZSA9IGZ1bmN0aW9uKG9iaikgeyByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTsgfSIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9IHZjZlRhYml4IGZvcm1hdDogaHR0cDovL2dlbm9tZS51Y3NjLmVkdS9nb2xkZW5QYXRoL2hlbHAvdmNmLmh0bWwgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy91dGlscy5qcycpLFxuICBwYXJzZUludDEwID0gdXRpbHMucGFyc2VJbnQxMDtcblxuLy8gSW50ZW5kZWQgdG8gYmUgbG9hZGVkIGludG8gQ3VzdG9tVHJhY2sudHlwZXMudmNmdGFiaXhcbnZhciBWY2ZUYWJpeEZvcm1hdCA9IHtcbiAgZGVmYXVsdHM6IHtcbiAgICBwcmlvcml0eTogMTAwLFxuICAgIGRyYXdMaW1pdDoge3NxdWlzaDogNTAwLCBwYWNrOiAxMDB9LFxuICAgIG1heEZldGNoV2luZG93OiAxMDAwMDAsXG4gICAgY2hyb21vc29tZXM6ICcnXG4gIH0sXG5cbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLm9wdHMuYmlnRGF0YVVybCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUmVxdWlyZWQgcGFyYW1ldGVyIGJpZ0RhdGFVcmwgbm90IGZvdW5kIGZvciB2Y2ZUYWJpeCB0cmFjayBhdCBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMub3B0cykgKyAodGhpcy5vcHRzLmxpbmVOdW0gKyAxKSk7XG4gICAgfVxuICB9LFxuXG4gIHBhcnNlOiBmdW5jdGlvbihsaW5lcykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZWxmLmhlaWdodHMgPSB7bWF4OiBudWxsLCBtaW46IDE1LCBzdGFydDogMTV9O1xuICAgIHNlbGYuc2l6ZXMgPSBbJ2RlbnNlJywgJ3NxdWlzaCcsICdwYWNrJ107XG4gICAgc2VsZi5tYXBTaXplcyA9IFsncGFjayddO1xuICAgIC8vIFRPRE86IFNldCBtYXhGZXRjaFdpbmRvdyB1c2luZyBzb21lIGhldXJpc3RpYyBiYXNlZCBvbiBob3cgbWFueSBpdGVtcyBhcmUgaW4gdGhlIHRhYml4IGluZGV4XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgcHJlcmVuZGVyOiBmdW5jdGlvbihzdGFydCwgZW5kLCBkZW5zaXR5LCBwcmVjYWxjLCBjYWxsYmFjaykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIHdpZHRoID0gcHJlY2FsYy53aWR0aCxcbiAgICAgIGRhdGEgPSBzZWxmLmRhdGEsXG4gICAgICBicHBwID0gKGVuZCAtIHN0YXJ0KSAvIHdpZHRoLFxuICAgICAgcmFuZ2UgPSB0aGlzLmNoclJhbmdlKHN0YXJ0LCBlbmQpO1xuICAgIFxuICAgIGZ1bmN0aW9uIGxpbmVUb0ludGVydmFsKGxpbmUpIHtcbiAgICAgIHZhciBmaWVsZHMgPSBsaW5lLnNwbGl0KCdcXHQnKSwgZGF0YSA9IHt9LCBpbmZvID0ge307XG4gICAgICBpZiAoZmllbGRzWzddKSB7XG4gICAgICAgIF8uZWFjaChmaWVsZHNbN10uc3BsaXQoJzsnKSwgZnVuY3Rpb24obCkgeyBsID0gbC5zcGxpdCgnPScpOyBpZiAobC5sZW5ndGggPiAxKSB7IGluZm9bbFswXV0gPSBsWzFdOyB9IH0pO1xuICAgICAgfVxuICAgICAgZGF0YS5zdGFydCA9IHNlbGYuYnJvd3Nlck9wdHMuY2hyUG9zW2ZpZWxkc1swXV0gKyBwYXJzZUludDEwKGZpZWxkc1sxXSk7XG4gICAgICBkYXRhLmlkID0gZmllbGRzWzJdPT0nLicgPyAndmNmLScgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwMDApIDogZmllbGRzWzJdO1xuICAgICAgZGF0YS5lbmQgPSBkYXRhLnN0YXJ0ICsgMTtcbiAgICAgIGRhdGEucmVmID0gZmllbGRzWzNdO1xuICAgICAgZGF0YS5hbHQgPSBmaWVsZHNbNF07XG4gICAgICBkYXRhLnF1YWwgPSBwYXJzZUZsb2F0KGZpZWxkc1s1XSk7XG4gICAgICBkYXRhLmluZm8gPSBpbmZvO1xuICAgICAgcmV0dXJuIHtkYXRhOiBkYXRhfTtcbiAgICB9XG4gICAgZnVuY3Rpb24gbmFtZUZ1bmMoZmllbGRzKSB7XG4gICAgICB2YXIgcmVmID0gZmllbGRzLnJlZiB8fCAnJyxcbiAgICAgICAgYWx0ID0gZmllbGRzLmFsdCB8fCAnJztcbiAgICAgIHJldHVybiAocmVmLmxlbmd0aCA+IGFsdC5sZW5ndGggPyByZWYgOiBhbHQpIHx8ICcnO1xuICAgIH1cbiAgXG4gICAgZnVuY3Rpb24gc3VjY2VzcyhkYXRhKSB7XG4gICAgICB2YXIgZHJhd1NwZWMgPSBbXSxcbiAgICAgICAgbGluZXMgPSBfLmZpbHRlcihkYXRhLnNwbGl0KCdcXG4nKSwgZnVuY3Rpb24obCkgeyB2YXIgbSA9IGwubWF0Y2goL1xcdC9nKTsgcmV0dXJuIG0gJiYgbS5sZW5ndGggPiA4OyB9KSxcbiAgICAgICAgY2FsY1BpeEludGVydmFsID0gbmV3IHV0aWxzLnBpeEludGVydmFsQ2FsY3VsYXRvcihzdGFydCwgd2lkdGgsIGJwcHAsIGRlbnNpdHk9PSdwYWNrJywgbmFtZUZ1bmMpO1xuICAgICAgaWYgKGRlbnNpdHkgPT0gJ2RlbnNlJykge1xuICAgICAgICBfLmVhY2gobGluZXMsIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgICBkcmF3U3BlYy5wdXNoKGNhbGNQaXhJbnRlcnZhbChsaW5lVG9JbnRlcnZhbChsaW5lKS5kYXRhKSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZHJhd1NwZWMgPSB7bGF5b3V0OiBzZWxmLnR5cGUoJ2JlZCcpLnN0YWNrZWRMYXlvdXQoXy5tYXAobGluZXMsIGxpbmVUb0ludGVydmFsKSwgd2lkdGgsIGNhbGNQaXhJbnRlcnZhbCl9O1xuICAgICAgICBkcmF3U3BlYy53aWR0aCA9IHdpZHRoO1xuICAgICAgfVxuICAgICAgY2FsbGJhY2soZHJhd1NwZWMpO1xuICAgIH1cbiAgXG4gICAgLy8gRG9uJ3QgZXZlbiBhdHRlbXB0IHRvIGZldGNoIHRoZSBkYXRhIGlmIHdlIGNhbiByZWFzb25hYmx5IGVzdGltYXRlIHRoYXQgd2Ugd2lsbCBmZXRjaCB0b28gbXVjaCBkYXRhLCBhcyB0aGlzIHdpbGwgb25seSBkZWxheSBvdGhlciByZXF1ZXN0cy5cbiAgICAvLyBUT0RPOiBjYWNoZSByZXN1bHRzIHNvIHdlIGFyZW4ndCByZWZldGNoaW5nIHRoZSBzYW1lIHJlZ2lvbnMgb3ZlciBhbmQgb3ZlciBhZ2Fpbi5cbiAgICBpZiAoKGVuZCAtIHN0YXJ0KSA+IHNlbGYub3B0cy5tYXhGZXRjaFdpbmRvdykge1xuICAgICAgY2FsbGJhY2soe3Rvb01hbnk6IHRydWV9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgJC5hamF4KHRoaXMuYWpheERpcigpICsgJ3RhYml4LnBocCcsIHtcbiAgICAgICAgZGF0YToge3JhbmdlOiByYW5nZSwgdXJsOiB0aGlzLm9wdHMuYmlnRGF0YVVybH0sXG4gICAgICAgIHN1Y2Nlc3M6IHN1Y2Nlc3NcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKGNhbnZhcywgc3RhcnQsIGVuZCwgZGVuc2l0eSwgY2FsbGJhY2spIHtcbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQgJiYgY2FudmFzLmdldENvbnRleHQoJzJkJyksXG4gICAgICB1cmxUZW1wbGF0ZSA9IHRoaXMub3B0cy51cmwgPyB0aGlzLm9wdHMudXJsIDogJ2phdmFzY3JpcHQ6dm9pZChcIicrdGhpcy5vcHRzLm5hbWUrJzokJFwiKScsXG4gICAgICBsaW5lSGVpZ2h0ID0gZGVuc2l0eSA9PSAncGFjaycgPyAyNyA6IDYsXG4gICAgICBjb2xvcnMgPSB7YTonMjU1LDAsMCcsIHQ6JzI1NSwwLDI1NScsIGM6JzAsMCwyNTUnLCBnOicwLDI1NSwwJ30sXG4gICAgICBkcmF3TGltaXQgPSB0aGlzLm9wdHMuZHJhd0xpbWl0ICYmIHRoaXMub3B0cy5kcmF3TGltaXRbZGVuc2l0eV0sXG4gICAgICBhcmVhcyA9IG51bGw7XG4gICAgaWYgKCFjdHgpIHsgdGhyb3cgXCJDYW52YXMgbm90IHN1cHBvcnRlZFwiOyB9XG4gICAgaWYgKGRlbnNpdHkgPT0gJ3BhY2snKSB7IGFyZWFzID0gdGhpcy5hcmVhc1tjYW52YXMuaWRdID0gW107IH1cbiAgICBjdHguZmlsbFN0eWxlID0gXCJyZ2IoMCwwLDApXCI7XG4gICAgdGhpcy5wcmVyZW5kZXIoc3RhcnQsIGVuZCwgZGVuc2l0eSwge3dpZHRoOiBjYW52YXMud2lkdGh9LCBmdW5jdGlvbihkcmF3U3BlYykge1xuICAgICAgaWYgKChkcmF3TGltaXQgJiYgZHJhd1NwZWMubGVuZ3RoID4gZHJhd0xpbWl0KSB8fCBkcmF3U3BlYy50b29NYW55KSB7IFxuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gMDtcbiAgICAgICAgLy8gVGhpcyBhcHBsaWVzIHN0eWxpbmcgdGhhdCBpbmRpY2F0ZXMgdGhlcmUgd2FzIHRvbyBtdWNoIGRhdGEgdG8gbG9hZC9kcmF3IGFuZCB0aGF0IHRoZSB1c2VyIG5lZWRzIHRvIHpvb20gdG8gc2VlIG1vcmVcbiAgICAgICAgY2FudmFzLmNsYXNzTmFtZSA9IGNhbnZhcy5jbGFzc05hbWUgKyAnIHRvby1tYW55JztcbiAgICAgIH0gZWxzZSBpZiAoZGVuc2l0eSA9PSAnZGVuc2UnKSB7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSAxNTtcbiAgICAgICAgXy5lYWNoKGRyYXdTcGVjLCBmdW5jdGlvbihwSW50KSB7XG4gICAgICAgICAgY3R4LmZpbGxSZWN0KHBJbnQueCwgMSwgcEludC53LCAxMyk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGRyYXdTcGVjLmxheW91dC5sZW5ndGggKiBsaW5lSGVpZ2h0O1xuICAgICAgICBfLmVhY2goZHJhd1NwZWMubGF5b3V0LCBmdW5jdGlvbihsLCBpKSB7XG4gICAgICAgICAgXy5lYWNoKGwsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIHZhciBhbHRDb2xvciwgcmVmQ29sb3I7XG4gICAgICAgICAgICBpZiAoYXJlYXMpIHtcbiAgICAgICAgICAgICAgcmVmQ29sb3IgPSBjb2xvcnNbZGF0YS5kLnJlZi50b0xvd2VyQ2FzZSgpXSB8fCAnMjU1LDAsMCc7XG4gICAgICAgICAgICAgIGFsdENvbG9yID0gY29sb3JzW2RhdGEuZC5hbHQudG9Mb3dlckNhc2UoKV0gfHwgJzI1NSwwLDAnO1xuICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gXCJyZ2IoXCIgKyBhbHRDb2xvciArIFwiKVwiOyBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN0eC5maWxsUmVjdChkYXRhLnBJbnQueCwgaSAqIGxpbmVIZWlnaHQgKyAxLCBkYXRhLnBJbnQudywgbGluZUhlaWdodCAtIDEpO1xuICAgICAgICAgICAgaWYgKGFyZWFzKSB7XG4gICAgICAgICAgICAgIGFyZWFzLnB1c2goW1xuICAgICAgICAgICAgICAgIGRhdGEucEludC54LCBpICogbGluZUhlaWdodCArIDEsIGRhdGEucEludC54ICsgZGF0YS5wSW50LncsIChpICsgMSkgKiBsaW5lSGVpZ2h0LCAvL3gxLCB4MiwgeTEsIHkyXG4gICAgICAgICAgICAgICAgZGF0YS5kLnJlZiArICcgPiAnICsgZGF0YS5kLmFsdCwgLy8gdGl0bGVcbiAgICAgICAgICAgICAgICB1cmxUZW1wbGF0ZS5yZXBsYWNlKCckJCcsIGRhdGEuZC5pZCksIC8vIGhyZWZcbiAgICAgICAgICAgICAgICBkYXRhLnBJbnQub1ByZXYsIC8vIGNvbnRpbnVhdGlvbiBmcm9tIHByZXZpb3VzIHRpbGU/XG4gICAgICAgICAgICAgICAgYWx0Q29sb3IsIC8vIGxhYmVsIGNvbG9yXG4gICAgICAgICAgICAgICAgJzxzcGFuIHN0eWxlPVwiY29sb3I6IHJnYignICsgcmVmQ29sb3IgKyAnKVwiPicgKyBkYXRhLmQucmVmICsgJzwvc3Bhbj48YnIvPicgKyBkYXRhLmQuYWx0LCAvLyBsYWJlbFxuICAgICAgICAgICAgICAgIGRhdGEuZC5pbmZvXG4gICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChfLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7IGNhbGxiYWNrKCk7IH1cbiAgICB9KTtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBWY2ZUYWJpeEZvcm1hdDtcblxuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9IFdJRyBmb3JtYXQ6IGh0dHA6Ly9nZW5vbWUudWNzYy5lZHUvZ29sZGVuUGF0aC9oZWxwL3dpZ2dsZS5odG1sID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzL3V0aWxzLmpzJyksXG4gIHBhcnNlSW50MTAgPSB1dGlscy5wYXJzZUludDEwLFxuICBwYXJzZURlY2xhcmF0aW9uTGluZSA9IHV0aWxzLnBhcnNlRGVjbGFyYXRpb25MaW5lO1xudmFyIFNvcnRlZExpc3QgPSByZXF1aXJlKCcuL3V0aWxzL1NvcnRlZExpc3QuanMnKS5Tb3J0ZWRMaXN0O1xuXG4vLyBJbnRlbmRlZCB0byBiZSBsb2FkZWQgaW50byBDdXN0b21UcmFjay50eXBlcy53aWdnbGVfMFxudmFyIFdpZ2dsZUZvcm1hdCA9IHtcbiAgZGVmYXVsdHM6IHtcbiAgICBhbHRDb2xvcjogJycsXG4gICAgcHJpb3JpdHk6IDEwMCxcbiAgICBhdXRvU2NhbGU6ICdvbicsXG4gICAgYWx3YXlzWmVybzogJ29mZicsXG4gICAgZ3JpZERlZmF1bHQ6ICdvZmYnLFxuICAgIG1heEhlaWdodFBpeGVsczogJzEyODoxMjg6MTUnLFxuICAgIGdyYXBoVHlwZTogJ2JhcicsXG4gICAgdmlld0xpbWl0czogJycsXG4gICAgeUxpbmVNYXJrOiAwLjAsXG4gICAgeUxpbmVPbk9mZjogJ29mZicsXG4gICAgd2luZG93aW5nRnVuY3Rpb246ICdtYXhpbXVtJyxcbiAgICBzbW9vdGhpbmdXaW5kb3c6ICdvZmYnXG4gIH0sXG5cbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50eXBlKCkuaW5pdE9wdHMuY2FsbCh0aGlzKTtcbiAgfSxcbiAgXG4gIF9iaW5GdW5jdGlvbnM6IHV0aWxzLndpZ0JpbkZ1bmN0aW9ucyxcbiAgXG4gIGluaXRPcHRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0cyxcbiAgICAgIF9iaW5GdW5jdGlvbnMgPSB0aGlzLnR5cGUoKS5fYmluRnVuY3Rpb25zO1xuICAgIGlmICghdGhpcy52YWxpZGF0ZUNvbG9yKG8uYWx0Q29sb3IpKSB7IG8uYWx0Q29sb3IgPSAnJzsgfVxuICAgIG8udmlld0xpbWl0cyA9IF8ubWFwKG8udmlld0xpbWl0cy5zcGxpdCgnOicpLCBwYXJzZUZsb2F0KTtcbiAgICBvLm1heEhlaWdodFBpeGVscyA9IF8ubWFwKG8ubWF4SGVpZ2h0UGl4ZWxzLnNwbGl0KCc6JyksIHBhcnNlSW50MTApO1xuICAgIG8ueUxpbmVPbk9mZiA9IHRoaXMuaXNPbihvLnlMaW5lT25PZmYpO1xuICAgIG8ueUxpbmVNYXJrID0gcGFyc2VGbG9hdChvLnlMaW5lTWFyayk7XG4gICAgby5hdXRvU2NhbGUgPSB0aGlzLmlzT24oby5hdXRvU2NhbGUpO1xuICAgIGlmIChfYmluRnVuY3Rpb25zICYmICFfYmluRnVuY3Rpb25zW28ud2luZG93aW5nRnVuY3Rpb25dKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnZhbGlkIHdpbmRvd2luZ0Z1bmN0aW9uIGF0IGxpbmUgXCIgKyBvLmxpbmVOdW0pOyBcbiAgICB9XG4gICAgaWYgKF8uaXNOYU4oby55TGluZU1hcmspKSB7IG8ueUxpbmVNYXJrID0gMC4wOyB9XG4gIH0sXG4gIFxuICBhcHBseU9wdHM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdHM7XG4gICAgc2VsZi5kcmF3UmFuZ2UgPSBvLmF1dG9TY2FsZSB8fCBvLnZpZXdMaW1pdHMubGVuZ3RoIDwgMiA/IHNlbGYucmFuZ2UgOiBvLnZpZXdMaW1pdHM7XG4gICAgXy5lYWNoKHttYXg6IDAsIG1pbjogMiwgc3RhcnQ6IDF9LCBmdW5jdGlvbih2LCBrKSB7IHNlbGYuaGVpZ2h0c1trXSA9IG8ubWF4SGVpZ2h0UGl4ZWxzW3ZdOyB9KTtcbiAgICBpZiAoIW8uYWx0Q29sb3IpIHtcbiAgICAgIHZhciBoc2wgPSB0aGlzLnJnYlRvSHNsLmFwcGx5KHRoaXMsIG8uY29sb3Iuc3BsaXQoLyxcXHMqL2cpKTtcbiAgICAgIGhzbFswXSA9IGhzbFswXSArIDAuMDIgJSAxO1xuICAgICAgaHNsWzFdID0gaHNsWzFdICogMC43O1xuICAgICAgaHNsWzJdID0gMSAtICgxIC0gaHNsWzJdKSAqIDAuNztcbiAgICAgIHNlbGYuYWx0Q29sb3IgPSBfLm1hcCh0aGlzLmhzbFRvUmdiLmFwcGx5KHRoaXMsIGhzbCksIHBhcnNlSW50MTApLmpvaW4oJywnKTtcbiAgICB9XG4gIH0sXG5cbiAgcGFyc2U6IGZ1bmN0aW9uKGxpbmVzKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgZ2Vub21lU2l6ZSA9IHRoaXMuYnJvd3Nlck9wdHMuZ2Vub21lU2l6ZSxcbiAgICAgIGRhdGEgPSB7YWxsOiBbXX0sXG4gICAgICBtb2RlLCBtb2RlT3B0cywgY2hyUG9zLCBtO1xuICAgIHNlbGYucmFuZ2UgPSBzZWxmLmlzT24odGhpcy5vcHRzLmFsd2F5c1plcm8pID8gWzAsIDBdIDogW0luZmluaXR5LCAtSW5maW5pdHldO1xuICBcbiAgICBfLmVhY2gobGluZXMsIGZ1bmN0aW9uKGxpbmUsIGxpbmVubykge1xuICAgICAgdmFyIHZhbCwgc3RhcnQ7XG4gICAgICBcbiAgICAgIG0gPSBsaW5lLm1hdGNoKC9eKHZhcmlhYmxlfGZpeGVkKVN0ZXBcXHMrL2kpO1xuICAgICAgaWYgKG0pIHtcbiAgICAgICAgbW9kZSA9IG1bMV0udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgbW9kZU9wdHMgPSBwYXJzZURlY2xhcmF0aW9uTGluZShsaW5lLCAvXih2YXJpYWJsZXxmaXhlZClTdGVwXFxzKy9pKTtcbiAgICAgICAgbW9kZU9wdHMuc3RhcnQgPSBwYXJzZUludDEwKG1vZGVPcHRzLnN0YXJ0KTtcbiAgICAgICAgaWYgKG1vZGUgPT0gJ2ZpeGVkJyAmJiAoXy5pc05hTihtb2RlT3B0cy5zdGFydCkgfHwgIW1vZGVPcHRzLnN0YXJ0KSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImZpeGVkU3RlcCBhdCBsaW5lIFwiICsgKGxpbmVubyArIDEgKyBzZWxmLm9wdHMubGluZU51bSkgKyBcIiByZXF1aXJlIG5vbi16ZXJvIHN0YXJ0IHBhcmFtZXRlclwiKTsgXG4gICAgICAgIH1cbiAgICAgICAgbW9kZU9wdHMuc3RlcCA9IHBhcnNlSW50MTAobW9kZU9wdHMuc3RlcCk7XG4gICAgICAgIGlmIChtb2RlID09ICdmaXhlZCcgJiYgKF8uaXNOYU4obW9kZU9wdHMuc3RlcCkgfHwgIW1vZGVPcHRzLnN0ZXApKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZml4ZWRTdGVwIGF0IGxpbmUgXCIgKyAobGluZW5vICsgMSArIHNlbGYub3B0cy5saW5lTnVtKSArIFwiIHJlcXVpcmUgbm9uLXplcm8gc3RlcCBwYXJhbWV0ZXJcIik7IFxuICAgICAgICB9XG4gICAgICAgIG1vZGVPcHRzLnNwYW4gPSBwYXJzZUludDEwKG1vZGVPcHRzLnNwYW4pIHx8IDE7XG4gICAgICAgIGNoclBvcyA9IHNlbGYuYnJvd3Nlck9wdHMuY2hyUG9zW21vZGVPcHRzLmNocm9tXTtcbiAgICAgICAgaWYgKF8uaXNVbmRlZmluZWQoY2hyUG9zKSkge1xuICAgICAgICAgIHNlbGYud2FybihcIkludmFsaWQgY2hyb21vc29tZSBhdCBsaW5lIFwiICsgKGxpbmVubyArIDEgKyBzZWxmLm9wdHMubGluZU51bSkpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIW1vZGUpIHsgXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiV2lnZ2xlIGZvcm1hdCBhdCBcIiArIChsaW5lbm8gKyAxICsgc2VsZi5vcHRzLmxpbmVOdW0pICsgXCIgaGFzIG5vIHByZWNlZGluZyBtb2RlIGRlY2xhcmF0aW9uXCIpOyBcbiAgICAgICAgfSBlbHNlIGlmIChfLmlzVW5kZWZpbmVkKGNoclBvcykpIHtcbiAgICAgICAgICAvLyBpbnZhbGlkIGNocm9tb3NvbWVcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAobW9kZSA9PSAnZml4ZWQnKSB7XG4gICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGxpbmUpO1xuICAgICAgICAgICAgZGF0YS5hbGwucHVzaCh7c3RhcnQ6IGNoclBvcyArIG1vZGVPcHRzLnN0YXJ0LCBlbmQ6IGNoclBvcyArIG1vZGVPcHRzLnN0YXJ0ICsgbW9kZU9wdHMuc3BhbiwgdmFsOiB2YWx9KTtcbiAgICAgICAgICAgIG1vZGVPcHRzLnN0YXJ0ICs9IG1vZGVPcHRzLnN0ZXA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxpbmUgPSBsaW5lLnNwbGl0KC9cXHMrLyk7XG4gICAgICAgICAgICBpZiAobGluZS5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInZhcmlhYmxlU3RlcCBhdCBsaW5lIFwiICsgKGxpbmVubyArIDEgKyBzZWxmLm9wdHMubGluZU51bSkgKyBcIiByZXF1aXJlcyB0d28gdmFsdWVzIHBlciBsaW5lXCIpOyBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0YXJ0ID0gcGFyc2VJbnQxMChsaW5lWzBdKTtcbiAgICAgICAgICAgIHZhbCA9IHBhcnNlRmxvYXQobGluZVsxXSk7XG4gICAgICAgICAgICBkYXRhLmFsbC5wdXNoKHtzdGFydDogY2hyUG9zICsgc3RhcnQsIGVuZDogY2hyUG9zICsgc3RhcnQgKyBtb2RlT3B0cy5zcGFuLCB2YWw6IHZhbH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiBzZWxmLnR5cGUoKS5maW5pc2hQYXJzZS5jYWxsKHNlbGYsIGRhdGEpO1xuICB9LFxuICBcbiAgZmluaXNoUGFyc2U6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBiaW5GdW5jdGlvbiA9IHNlbGYudHlwZSgpLl9iaW5GdW5jdGlvbnNbc2VsZi5vcHRzLndpbmRvd2luZ0Z1bmN0aW9uXTtcbiAgICBpZiAoZGF0YS5hbGwubGVuZ3RoID4gMCkge1xuICAgICAgc2VsZi5yYW5nZVswXSA9IF8ubWluKGRhdGEuYWxsLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLnZhbDsgfSkudmFsO1xuICAgICAgc2VsZi5yYW5nZVsxXSA9IF8ubWF4KGRhdGEuYWxsLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLnZhbDsgfSkudmFsO1xuICAgIH1cbiAgICBkYXRhLmFsbCA9IG5ldyBTb3J0ZWRMaXN0KGRhdGEuYWxsLCB7XG4gICAgICBjb21wYXJlOiBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgIGlmIChhID09PSBudWxsKSByZXR1cm4gLTE7XG4gICAgICAgIGlmIChiID09PSBudWxsKSByZXR1cm4gIDE7XG4gICAgICAgIHZhciBjID0gYS5zdGFydCAtIGIuc3RhcnQ7XG4gICAgICAgIHJldHVybiAoYyA+IDApID8gMSA6IChjID09PSAwKSAgPyAwIDogLTE7XG4gICAgICB9XG4gICAgfSk7XG4gIFxuICAgIC8vIFByZS1vcHRpbWl6ZSBkYXRhIGZvciBoaWdoIGJwcHBzIGJ5IGRvd25zYW1wbGluZ1xuICAgIF8uZWFjaChzZWxmLmJyb3dzZXJPcHRzLmJwcHBzLCBmdW5jdGlvbihicHBwKSB7XG4gICAgICBpZiAoc2VsZi5icm93c2VyT3B0cy5nZW5vbWVTaXplIC8gYnBwcCA+IDEwMDAwMDApIHsgcmV0dXJuOyB9XG4gICAgICB2YXIgcGl4TGVuID0gTWF0aC5jZWlsKHNlbGYuYnJvd3Nlck9wdHMuZ2Vub21lU2l6ZSAvIGJwcHApLFxuICAgICAgICBkb3duc2FtcGxlZERhdGEgPSAoZGF0YVticHBwXSA9IChnbG9iYWwuRmxvYXQzMkFycmF5ID8gbmV3IEZsb2F0MzJBcnJheShwaXhMZW4pIDogbmV3IEFycmF5KHBpeExlbikpKSxcbiAgICAgICAgaiA9IDAsXG4gICAgICAgIGN1cnIgPSBkYXRhLmFsbC5nZXQoMCksXG4gICAgICAgIGJpbiwgbmV4dDtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGl4TGVuOyBpKyspIHtcbiAgICAgICAgYmluID0gY3VyciAmJiAoY3Vyci5zdGFydCA8PSBpICogYnBwcCAmJiBjdXJyLmVuZCA+IGkgKiBicHBwKSA/IFtjdXJyLnZhbF0gOiBbXTtcbiAgICAgICAgd2hpbGUgKChuZXh0ID0gZGF0YS5hbGwuZ2V0KGogKyAxKSkgJiYgbmV4dC5zdGFydCA8IChpICsgMSkgKiBicHBwICYmIG5leHQuZW5kID4gaSAqIGJwcHApIHsgXG4gICAgICAgICAgYmluLnB1c2gobmV4dC52YWwpOyArK2o7IGN1cnIgPSBuZXh0OyBcbiAgICAgICAgfVxuICAgICAgICBkb3duc2FtcGxlZERhdGFbaV0gPSBiaW5GdW5jdGlvbihiaW4pO1xuICAgICAgfVxuICAgICAgZGF0YS5fYmluRnVuY3Rpb24gPSBzZWxmLm9wdHMud2luZG93aW5nRnVuY3Rpb247XG4gICAgfSk7XG4gICAgc2VsZi5kYXRhID0gZGF0YTtcbiAgICBzZWxmLnN0cmV0Y2hIZWlnaHQgPSB0cnVlO1xuICAgIHNlbGYudHlwZSgnd2lnZ2xlXzAnKS5hcHBseU9wdHMuYXBwbHkoc2VsZik7XG4gICAgcmV0dXJuIHRydWU7IC8vIHN1Y2Nlc3MhXG4gIH0sXG4gIFxuICBpbml0RHJhd1NwZWM6IGZ1bmN0aW9uKHByZWNhbGMpIHtcbiAgICB2YXIgdlNjYWxlID0gKHRoaXMuZHJhd1JhbmdlWzFdIC0gdGhpcy5kcmF3UmFuZ2VbMF0pIC8gcHJlY2FsYy5oZWlnaHQsXG4gICAgICBkcmF3U3BlYyA9IHtcbiAgICAgICAgYmFyczogW10sXG4gICAgICAgIHZTY2FsZTogdlNjYWxlLFxuICAgICAgICB5TGluZTogdGhpcy5pc09uKHRoaXMub3B0cy55TGluZU9uT2ZmKSA/IE1hdGgucm91bmQoKHRoaXMub3B0cy55TGluZU1hcmsgLSB0aGlzLmRyYXdSYW5nZVswXSkgLyB2U2NhbGUpIDogbnVsbCwgXG4gICAgICAgIHplcm9MaW5lOiAtdGhpcy5kcmF3UmFuZ2VbMF0gLyB2U2NhbGVcbiAgICAgIH07XG4gICAgcmV0dXJuIGRyYXdTcGVjO1xuICB9LFxuXG4gIHByZXJlbmRlcjogZnVuY3Rpb24oc3RhcnQsIGVuZCwgZGVuc2l0eSwgcHJlY2FsYywgY2FsbGJhY2spIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBicHBwID0gKGVuZCAtIHN0YXJ0KSAvIHByZWNhbGMud2lkdGgsXG4gICAgICBkcmF3U3BlYyA9IHNlbGYudHlwZSgpLmluaXREcmF3U3BlYy5jYWxsKHNlbGYsIHByZWNhbGMpLFxuICAgICAgYmluRnVuY3Rpb24gPSBzZWxmLnR5cGUoKS5fYmluRnVuY3Rpb25zW3NlbGYub3B0cy53aW5kb3dpbmdGdW5jdGlvbl0sXG4gICAgICBkb3duc2FtcGxlZERhdGE7XG4gICAgaWYgKHNlbGYuZGF0YS5fYmluRnVuY3Rpb24gPT0gc2VsZi5vcHRzLndpbmRvd2luZ0Z1bmN0aW9uICYmIChkb3duc2FtcGxlZERhdGEgPSBzZWxmLmRhdGFbYnBwcF0pKSB7XG4gICAgICAvLyBXZSd2ZSBhbHJlYWR5IHByZS1vcHRpbWl6ZWQgZm9yIHRoaXMgYnBwcFxuICAgICAgZHJhd1NwZWMuYmFycyA9IF8ubWFwKF8ucmFuZ2UoKHN0YXJ0IC0gMSkgLyBicHBwLCAoZW5kIC0gMSkgLyBicHBwKSwgZnVuY3Rpb24oeEZyb21PcmlnaW4sIHgpIHtcbiAgICAgICAgcmV0dXJuICgoZG93bnNhbXBsZWREYXRhW3hGcm9tT3JpZ2luXSB8fCAwKSAtIHNlbGYuZHJhd1JhbmdlWzBdKSAvIGRyYXdTcGVjLnZTY2FsZTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBXZSBoYXZlIHRvIGRvIHRoZSBiaW5uaW5nIG9uIHRoZSBmbHlcbiAgICAgIHZhciBqID0gc2VsZi5kYXRhLmFsbC5ic2VhcmNoKHtzdGFydDogc3RhcnR9KSxcbiAgICAgICAgY3VyciA9IHNlbGYuZGF0YS5hbGwuZ2V0KGopLCBuZXh0LCBiaW47XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByZWNhbGMud2lkdGg7IGkrKykge1xuICAgICAgICBiaW4gPSBjdXJyICYmIChjdXJyLmVuZCA+PSBpICogYnBwcCArIHN0YXJ0KSA/IFtjdXJyLnZhbF0gOiBbXTtcbiAgICAgICAgd2hpbGUgKChuZXh0ID0gc2VsZi5kYXRhLmFsbC5nZXQoaiArIDEpKSAmJiBuZXh0LnN0YXJ0IDwgKGkgKyAxKSAqIGJwcHAgKyBzdGFydCAmJiBuZXh0LmVuZCA+PSBpICogYnBwcCArIHN0YXJ0KSB7IFxuICAgICAgICAgIGJpbi5wdXNoKG5leHQudmFsKTsgKytqOyBjdXJyID0gbmV4dDsgXG4gICAgICAgIH1cbiAgICAgICAgZHJhd1NwZWMuYmFycy5wdXNoKChiaW5GdW5jdGlvbihiaW4pIC0gc2VsZi5kcmF3UmFuZ2VbMF0pIC8gZHJhd1NwZWMudlNjYWxlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF8uaXNGdW5jdGlvbihjYWxsYmFjaykgPyBjYWxsYmFjayhkcmF3U3BlYykgOiBkcmF3U3BlYztcbiAgfSxcbiAgXG4gIGRyYXdCYXJzOiBmdW5jdGlvbihjdHgsIGRyYXdTcGVjLCBoZWlnaHQsIHdpZHRoKSB7XG4gICAgdmFyIHplcm9MaW5lID0gZHJhd1NwZWMuemVyb0xpbmUsIC8vIHBpeGVsIHBvc2l0aW9uIG9mIHRoZSBkYXRhIHZhbHVlIDBcbiAgICAgIGNvbG9yID0gXCJyZ2IoXCIrdGhpcy5vcHRzLmNvbG9yK1wiKVwiLFxuICAgICAgYWx0Q29sb3IgPSBcInJnYihcIisodGhpcy5vcHRzLmFsdENvbG9yIHx8IHRoaXMuYWx0Q29sb3IpK1wiKVwiLFxuICAgICAgcG9pbnRHcmFwaCA9IHRoaXMub3B0cy5ncmFwaFR5cGU9PT0ncG9pbnRzJztcbiAgICBcbiAgICBjdHguZmlsbFN0eWxlID0gY29sb3I7XG4gICAgXy5lYWNoKGRyYXdTcGVjLmJhcnMsIGZ1bmN0aW9uKGQsIHgpIHtcbiAgICAgIGlmIChkID09PSBudWxsKSB7IHJldHVybjsgfVxuICAgICAgZWxzZSBpZiAoZCA+IHplcm9MaW5lKSB7IFxuICAgICAgICBpZiAocG9pbnRHcmFwaCkgeyBjdHguZmlsbFJlY3QoeCwgaGVpZ2h0IC0gZCwgMSwgMSk7IH1cbiAgICAgICAgZWxzZSB7IGN0eC5maWxsUmVjdCh4LCBoZWlnaHQgLSBkLCAxLCB6ZXJvTGluZSA+IDAgPyAoZCAtIHplcm9MaW5lKSA6IGQpOyB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gYWx0Q29sb3I7XG4gICAgICAgIGlmIChwb2ludEdyYXBoKSB7IGN0eC5maWxsUmVjdCh4LCB6ZXJvTGluZSAtIGQgLSAxLCAxLCAxKTsgfSBcbiAgICAgICAgZWxzZSB7IGN0eC5maWxsUmVjdCh4LCBoZWlnaHQgLSB6ZXJvTGluZSwgMSwgemVyb0xpbmUgLSBkKTsgfVxuICAgICAgICBjdHguZmlsbFN0eWxlID0gY29sb3I7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKGRyYXdTcGVjLnlMaW5lICE9PSBudWxsKSB7XG4gICAgICBjdHguZmlsbFN0eWxlID0gXCJyZ2IoMCwwLDApXCI7XG4gICAgICBjdHguZmlsbFJlY3QoMCwgaGVpZ2h0IC0gZHJhd1NwZWMueUxpbmUsIHdpZHRoLCAxKTtcbiAgICB9XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbihjYW52YXMsIHN0YXJ0LCBlbmQsIGRlbnNpdHksIGNhbGxiYWNrKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgaGVpZ2h0ID0gY2FudmFzLmhlaWdodCxcbiAgICAgIHdpZHRoID0gY2FudmFzLndpZHRoLFxuICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQgJiYgY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgaWYgKCFjdHgpIHsgdGhyb3cgXCJDYW52YXMgbm90IHN1cHBvcnRlZFwiOyB9XG4gICAgc2VsZi5wcmVyZW5kZXIoc3RhcnQsIGVuZCwgZGVuc2l0eSwge3dpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHR9LCBmdW5jdGlvbihkcmF3U3BlYykge1xuICAgICAgc2VsZi50eXBlKCkuZHJhd0JhcnMuY2FsbChzZWxmLCBjdHgsIGRyYXdTcGVjLCBoZWlnaHQsIHdpZHRoKTtcbiAgICAgIGlmIChfLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7IGNhbGxiYWNrKCk7IH1cbiAgICB9KTtcbiAgfSxcbiAgXG4gIGxvYWRPcHRzOiBmdW5jdGlvbigkZGlhbG9nKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdHMsXG4gICAgICAkdmlld0xpbWl0cyA9ICRkaWFsb2cuZmluZCgnLnZpZXctbGltaXRzJyksXG4gICAgICAkbWF4SGVpZ2h0UGl4ZWxzID0gJGRpYWxvZy5maW5kKCcubWF4LWhlaWdodC1waXhlbHMnKSxcbiAgICAgIGFsdENvbG9yT24gPSB0aGlzLnZhbGlkYXRlQ29sb3Ioby5hbHRDb2xvcik7XG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT1hbHRDb2xvck9uXScpLmF0dHIoJ2NoZWNrZWQnLCBhbHRDb2xvck9uKS5jaGFuZ2UoKTtcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPWFsdENvbG9yXScpLnZhbChhbHRDb2xvck9uID8gby5hbHRDb2xvciA6JzEyOCwxMjgsMTI4JykuY2hhbmdlKCk7XG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT1hdXRvU2NhbGVdJykuYXR0cignY2hlY2tlZCcsICF0aGlzLmlzT24oby5hdXRvU2NhbGUpKS5jaGFuZ2UoKTtcbiAgICAkdmlld0xpbWl0cy5zbGlkZXIoXCJvcHRpb25cIiwgXCJtaW5cIiwgdGhpcy5yYW5nZVswXSk7XG4gICAgJHZpZXdMaW1pdHMuc2xpZGVyKFwib3B0aW9uXCIsIFwibWF4XCIsIHRoaXMucmFuZ2VbMV0pO1xuICAgICRkaWFsb2cuZmluZCgnW25hbWU9dmlld0xpbWl0c01pbl0nKS52YWwodGhpcy5kcmF3UmFuZ2VbMF0pLmNoYW5nZSgpO1xuICAgICRkaWFsb2cuZmluZCgnW25hbWU9dmlld0xpbWl0c01heF0nKS52YWwodGhpcy5kcmF3UmFuZ2VbMV0pLmNoYW5nZSgpO1xuICAgICRkaWFsb2cuZmluZCgnW25hbWU9eUxpbmVPbk9mZl0nKS5hdHRyKCdjaGVja2VkJywgdGhpcy5pc09uKG8ueUxpbmVPbk9mZikpLmNoYW5nZSgpO1xuICAgICRkaWFsb2cuZmluZCgnW25hbWU9eUxpbmVNYXJrXScpLnZhbChvLnlMaW5lTWFyaykuY2hhbmdlKCk7XG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT1ncmFwaFR5cGVdJykudmFsKG8uZ3JhcGhUeXBlKS5jaGFuZ2UoKTtcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPXdpbmRvd2luZ0Z1bmN0aW9uXScpLnZhbChvLndpbmRvd2luZ0Z1bmN0aW9uKS5jaGFuZ2UoKTtcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPW1heEhlaWdodFBpeGVsc09uXScpLmF0dHIoJ2NoZWNrZWQnLCBvLm1heEhlaWdodFBpeGVscy5sZW5ndGggPj0gMyk7XG4gICAgJGRpYWxvZy5maW5kKCdbbmFtZT1tYXhIZWlnaHRQaXhlbHNNaW5dJykudmFsKG8ubWF4SGVpZ2h0UGl4ZWxzWzJdKS5jaGFuZ2UoKTtcbiAgICAkZGlhbG9nLmZpbmQoJ1tuYW1lPW1heEhlaWdodFBpeGVsc01heF0nKS52YWwoby5tYXhIZWlnaHRQaXhlbHNbMF0pLmNoYW5nZSgpO1xuICB9LFxuICBcbiAgc2F2ZU9wdHM6IGZ1bmN0aW9uKCRkaWFsb2cpIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0cyxcbiAgICAgIGFsdENvbG9yT24gPSAkZGlhbG9nLmZpbmQoJ1tuYW1lPWFsdENvbG9yT25dJykuaXMoJzpjaGVja2VkJyksXG4gICAgICBtYXhIZWlnaHRQaXhlbHNPbiA9ICRkaWFsb2cuZmluZCgnW25hbWU9bWF4SGVpZ2h0UGl4ZWxzT25dJykuaXMoJzpjaGVja2VkJyksXG4gICAgICBtYXhIZWlnaHRQaXhlbHNNYXggPSAkZGlhbG9nLmZpbmQoJ1tuYW1lPW1heEhlaWdodFBpeGVsc01heF0nKS52YWwoKTtcbiAgICBvLmFsdENvbG9yID0gYWx0Q29sb3JPbiA/ICRkaWFsb2cuZmluZCgnW25hbWU9YWx0Q29sb3JdJykudmFsKCkgOiAnJztcbiAgICBvLmF1dG9TY2FsZSA9ICEkZGlhbG9nLmZpbmQoJ1tuYW1lPWF1dG9TY2FsZV0nKS5pcygnOmNoZWNrZWQnKTtcbiAgICBvLnZpZXdMaW1pdHMgPSAkZGlhbG9nLmZpbmQoJ1tuYW1lPXZpZXdMaW1pdHNNaW5dJykudmFsKCkgKyAnOicgKyAkZGlhbG9nLmZpbmQoJ1tuYW1lPXZpZXdMaW1pdHNNYXhdJykudmFsKCk7XG4gICAgby55TGluZU9uT2ZmID0gJGRpYWxvZy5maW5kKCdbbmFtZT15TGluZU9uT2ZmXScpLmlzKCc6Y2hlY2tlZCcpO1xuICAgIG8ueUxpbmVNYXJrID0gJGRpYWxvZy5maW5kKCdbbmFtZT15TGluZU1hcmtdJykudmFsKCk7XG4gICAgby5ncmFwaFR5cGUgPSAkZGlhbG9nLmZpbmQoJ1tuYW1lPWdyYXBoVHlwZV0nKS52YWwoKTtcbiAgICBvLndpbmRvd2luZ0Z1bmN0aW9uID0gJGRpYWxvZy5maW5kKCdbbmFtZT13aW5kb3dpbmdGdW5jdGlvbl0nKS52YWwoKTtcbiAgICBvLm1heEhlaWdodFBpeGVscyA9IG1heEhlaWdodFBpeGVsc09uID8gXG4gICAgICBbbWF4SGVpZ2h0UGl4ZWxzTWF4LCBtYXhIZWlnaHRQaXhlbHNNYXgsICRkaWFsb2cuZmluZCgnW25hbWU9bWF4SGVpZ2h0UGl4ZWxzTWluXScpLnZhbCgpXS5qb2luKCc6JykgOiAnJztcbiAgICB0aGlzLnR5cGUoJ3dpZ2dsZV8wJykuaW5pdE9wdHMuY2FsbCh0aGlzKTtcbiAgfVxuICBcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gV2lnZ2xlRm9ybWF0OyIsIi8qISBqUXVlcnkgdjEuNy4xIGpxdWVyeS5jb20gfCBqcXVlcnkub3JnL2xpY2Vuc2UgfCBtb2RpZmllZCB0byB1c2UgYnJvd3NlcmlmeS9ucG0gc3R5bGUgbW9kdWxlLmV4cG9ydHMgKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBjeShhKXtyZXR1cm4gZi5pc1dpbmRvdyhhKT9hOmEubm9kZVR5cGU9PT05P2EuZGVmYXVsdFZpZXd8fGEucGFyZW50V2luZG93OiExfWZ1bmN0aW9uIGN2KGEpe2lmKCFja1thXSl7dmFyIGI9Yy5ib2R5LGQ9ZihcIjxcIithK1wiPlwiKS5hcHBlbmRUbyhiKSxlPWQuY3NzKFwiZGlzcGxheVwiKTtkLnJlbW92ZSgpO2lmKGU9PT1cIm5vbmVcInx8ZT09PVwiXCIpe2NsfHwoY2w9Yy5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpLGNsLmZyYW1lQm9yZGVyPWNsLndpZHRoPWNsLmhlaWdodD0wKSxiLmFwcGVuZENoaWxkKGNsKTtpZighY218fCFjbC5jcmVhdGVFbGVtZW50KWNtPShjbC5jb250ZW50V2luZG93fHxjbC5jb250ZW50RG9jdW1lbnQpLmRvY3VtZW50LGNtLndyaXRlKChjLmNvbXBhdE1vZGU9PT1cIkNTUzFDb21wYXRcIj9cIjwhZG9jdHlwZSBodG1sPlwiOlwiXCIpK1wiPGh0bWw+PGJvZHk+XCIpLGNtLmNsb3NlKCk7ZD1jbS5jcmVhdGVFbGVtZW50KGEpLGNtLmJvZHkuYXBwZW5kQ2hpbGQoZCksZT1mLmNzcyhkLFwiZGlzcGxheVwiKSxiLnJlbW92ZUNoaWxkKGNsKX1ja1thXT1lfXJldHVybiBja1thXX1mdW5jdGlvbiBjdShhLGIpe3ZhciBjPXt9O2YuZWFjaChjcS5jb25jYXQuYXBwbHkoW10sY3Euc2xpY2UoMCxiKSksZnVuY3Rpb24oKXtjW3RoaXNdPWF9KTtyZXR1cm4gY31mdW5jdGlvbiBjdCgpe2NyPWJ9ZnVuY3Rpb24gY3MoKXtzZXRUaW1lb3V0KGN0LDApO3JldHVybiBjcj1mLm5vdygpfWZ1bmN0aW9uIGNqKCl7dHJ5e3JldHVybiBuZXcgYS5BY3RpdmVYT2JqZWN0KFwiTWljcm9zb2Z0LlhNTEhUVFBcIil9Y2F0Y2goYil7fX1mdW5jdGlvbiBjaSgpe3RyeXtyZXR1cm4gbmV3IGEuWE1MSHR0cFJlcXVlc3R9Y2F0Y2goYil7fX1mdW5jdGlvbiBjYyhhLGMpe2EuZGF0YUZpbHRlciYmKGM9YS5kYXRhRmlsdGVyKGMsYS5kYXRhVHlwZSkpO3ZhciBkPWEuZGF0YVR5cGVzLGU9e30sZyxoLGk9ZC5sZW5ndGgsaixrPWRbMF0sbCxtLG4sbyxwO2ZvcihnPTE7ZzxpO2crKyl7aWYoZz09PTEpZm9yKGggaW4gYS5jb252ZXJ0ZXJzKXR5cGVvZiBoPT1cInN0cmluZ1wiJiYoZVtoLnRvTG93ZXJDYXNlKCldPWEuY29udmVydGVyc1toXSk7bD1rLGs9ZFtnXTtpZihrPT09XCIqXCIpaz1sO2Vsc2UgaWYobCE9PVwiKlwiJiZsIT09ayl7bT1sK1wiIFwiK2ssbj1lW21dfHxlW1wiKiBcIitrXTtpZighbil7cD1iO2ZvcihvIGluIGUpe2o9by5zcGxpdChcIiBcIik7aWYoalswXT09PWx8fGpbMF09PT1cIipcIil7cD1lW2pbMV0rXCIgXCIra107aWYocCl7bz1lW29dLG89PT0hMD9uPXA6cD09PSEwJiYobj1vKTticmVha319fX0hbiYmIXAmJmYuZXJyb3IoXCJObyBjb252ZXJzaW9uIGZyb20gXCIrbS5yZXBsYWNlKFwiIFwiLFwiIHRvIFwiKSksbiE9PSEwJiYoYz1uP24oYyk6cChvKGMpKSl9fXJldHVybiBjfWZ1bmN0aW9uIGNiKGEsYyxkKXt2YXIgZT1hLmNvbnRlbnRzLGY9YS5kYXRhVHlwZXMsZz1hLnJlc3BvbnNlRmllbGRzLGgsaSxqLGs7Zm9yKGkgaW4gZylpIGluIGQmJihjW2dbaV1dPWRbaV0pO3doaWxlKGZbMF09PT1cIipcIilmLnNoaWZ0KCksaD09PWImJihoPWEubWltZVR5cGV8fGMuZ2V0UmVzcG9uc2VIZWFkZXIoXCJjb250ZW50LXR5cGVcIikpO2lmKGgpZm9yKGkgaW4gZSlpZihlW2ldJiZlW2ldLnRlc3QoaCkpe2YudW5zaGlmdChpKTticmVha31pZihmWzBdaW4gZClqPWZbMF07ZWxzZXtmb3IoaSBpbiBkKXtpZighZlswXXx8YS5jb252ZXJ0ZXJzW2krXCIgXCIrZlswXV0pe2o9aTticmVha31rfHwoaz1pKX1qPWp8fGt9aWYoail7aiE9PWZbMF0mJmYudW5zaGlmdChqKTtyZXR1cm4gZFtqXX19ZnVuY3Rpb24gY2EoYSxiLGMsZCl7aWYoZi5pc0FycmF5KGIpKWYuZWFjaChiLGZ1bmN0aW9uKGIsZSl7Y3x8YkUudGVzdChhKT9kKGEsZSk6Y2EoYStcIltcIisodHlwZW9mIGU9PVwib2JqZWN0XCJ8fGYuaXNBcnJheShlKT9iOlwiXCIpK1wiXVwiLGUsYyxkKX0pO2Vsc2UgaWYoIWMmJmIhPW51bGwmJnR5cGVvZiBiPT1cIm9iamVjdFwiKWZvcih2YXIgZSBpbiBiKWNhKGErXCJbXCIrZStcIl1cIixiW2VdLGMsZCk7ZWxzZSBkKGEsYil9ZnVuY3Rpb24gYl8oYSxjKXt2YXIgZCxlLGc9Zi5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnN8fHt9O2ZvcihkIGluIGMpY1tkXSE9PWImJigoZ1tkXT9hOmV8fChlPXt9KSlbZF09Y1tkXSk7ZSYmZi5leHRlbmQoITAsYSxlKX1mdW5jdGlvbiBiJChhLGMsZCxlLGYsZyl7Zj1mfHxjLmRhdGFUeXBlc1swXSxnPWd8fHt9LGdbZl09ITA7dmFyIGg9YVtmXSxpPTAsaj1oP2gubGVuZ3RoOjAsaz1hPT09YlQsbDtmb3IoO2k8aiYmKGt8fCFsKTtpKyspbD1oW2ldKGMsZCxlKSx0eXBlb2YgbD09XCJzdHJpbmdcIiYmKCFrfHxnW2xdP2w9YjooYy5kYXRhVHlwZXMudW5zaGlmdChsKSxsPWIkKGEsYyxkLGUsbCxnKSkpOyhrfHwhbCkmJiFnW1wiKlwiXSYmKGw9YiQoYSxjLGQsZSxcIipcIixnKSk7cmV0dXJuIGx9ZnVuY3Rpb24gYlooYSl7cmV0dXJuIGZ1bmN0aW9uKGIsYyl7dHlwZW9mIGIhPVwic3RyaW5nXCImJihjPWIsYj1cIipcIik7aWYoZi5pc0Z1bmN0aW9uKGMpKXt2YXIgZD1iLnRvTG93ZXJDYXNlKCkuc3BsaXQoYlApLGU9MCxnPWQubGVuZ3RoLGgsaSxqO2Zvcig7ZTxnO2UrKyloPWRbZV0saj0vXlxcKy8udGVzdChoKSxqJiYoaD1oLnN1YnN0cigxKXx8XCIqXCIpLGk9YVtoXT1hW2hdfHxbXSxpW2o/XCJ1bnNoaWZ0XCI6XCJwdXNoXCJdKGMpfX19ZnVuY3Rpb24gYkMoYSxiLGMpe3ZhciBkPWI9PT1cIndpZHRoXCI/YS5vZmZzZXRXaWR0aDphLm9mZnNldEhlaWdodCxlPWI9PT1cIndpZHRoXCI/Yng6YnksZz0wLGg9ZS5sZW5ndGg7aWYoZD4wKXtpZihjIT09XCJib3JkZXJcIilmb3IoO2c8aDtnKyspY3x8KGQtPXBhcnNlRmxvYXQoZi5jc3MoYSxcInBhZGRpbmdcIitlW2ddKSl8fDApLGM9PT1cIm1hcmdpblwiP2QrPXBhcnNlRmxvYXQoZi5jc3MoYSxjK2VbZ10pKXx8MDpkLT1wYXJzZUZsb2F0KGYuY3NzKGEsXCJib3JkZXJcIitlW2ddK1wiV2lkdGhcIikpfHwwO3JldHVybiBkK1wicHhcIn1kPWJ6KGEsYixiKTtpZihkPDB8fGQ9PW51bGwpZD1hLnN0eWxlW2JdfHwwO2Q9cGFyc2VGbG9hdChkKXx8MDtpZihjKWZvcig7ZzxoO2crKylkKz1wYXJzZUZsb2F0KGYuY3NzKGEsXCJwYWRkaW5nXCIrZVtnXSkpfHwwLGMhPT1cInBhZGRpbmdcIiYmKGQrPXBhcnNlRmxvYXQoZi5jc3MoYSxcImJvcmRlclwiK2VbZ10rXCJXaWR0aFwiKSl8fDApLGM9PT1cIm1hcmdpblwiJiYoZCs9cGFyc2VGbG9hdChmLmNzcyhhLGMrZVtnXSkpfHwwKTtyZXR1cm4gZCtcInB4XCJ9ZnVuY3Rpb24gYnAoYSxiKXtiLnNyYz9mLmFqYXgoe3VybDpiLnNyYyxhc3luYzohMSxkYXRhVHlwZTpcInNjcmlwdFwifSk6Zi5nbG9iYWxFdmFsKChiLnRleHR8fGIudGV4dENvbnRlbnR8fGIuaW5uZXJIVE1MfHxcIlwiKS5yZXBsYWNlKGJmLFwiLyokMCovXCIpKSxiLnBhcmVudE5vZGUmJmIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChiKX1mdW5jdGlvbiBibyhhKXt2YXIgYj1jLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7YmguYXBwZW5kQ2hpbGQoYiksYi5pbm5lckhUTUw9YS5vdXRlckhUTUw7cmV0dXJuIGIuZmlyc3RDaGlsZH1mdW5jdGlvbiBibihhKXt2YXIgYj0oYS5ub2RlTmFtZXx8XCJcIikudG9Mb3dlckNhc2UoKTtiPT09XCJpbnB1dFwiP2JtKGEpOmIhPT1cInNjcmlwdFwiJiZ0eXBlb2YgYS5nZXRFbGVtZW50c0J5VGFnTmFtZSE9XCJ1bmRlZmluZWRcIiYmZi5ncmVwKGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJpbnB1dFwiKSxibSl9ZnVuY3Rpb24gYm0oYSl7aWYoYS50eXBlPT09XCJjaGVja2JveFwifHxhLnR5cGU9PT1cInJhZGlvXCIpYS5kZWZhdWx0Q2hlY2tlZD1hLmNoZWNrZWR9ZnVuY3Rpb24gYmwoYSl7cmV0dXJuIHR5cGVvZiBhLmdldEVsZW1lbnRzQnlUYWdOYW1lIT1cInVuZGVmaW5lZFwiP2EuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpOnR5cGVvZiBhLnF1ZXJ5U2VsZWN0b3JBbGwhPVwidW5kZWZpbmVkXCI/YS5xdWVyeVNlbGVjdG9yQWxsKFwiKlwiKTpbXX1mdW5jdGlvbiBiayhhLGIpe3ZhciBjO2lmKGIubm9kZVR5cGU9PT0xKXtiLmNsZWFyQXR0cmlidXRlcyYmYi5jbGVhckF0dHJpYnV0ZXMoKSxiLm1lcmdlQXR0cmlidXRlcyYmYi5tZXJnZUF0dHJpYnV0ZXMoYSksYz1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7aWYoYz09PVwib2JqZWN0XCIpYi5vdXRlckhUTUw9YS5vdXRlckhUTUw7ZWxzZSBpZihjIT09XCJpbnB1dFwifHxhLnR5cGUhPT1cImNoZWNrYm94XCImJmEudHlwZSE9PVwicmFkaW9cIil7aWYoYz09PVwib3B0aW9uXCIpYi5zZWxlY3RlZD1hLmRlZmF1bHRTZWxlY3RlZDtlbHNlIGlmKGM9PT1cImlucHV0XCJ8fGM9PT1cInRleHRhcmVhXCIpYi5kZWZhdWx0VmFsdWU9YS5kZWZhdWx0VmFsdWV9ZWxzZSBhLmNoZWNrZWQmJihiLmRlZmF1bHRDaGVja2VkPWIuY2hlY2tlZD1hLmNoZWNrZWQpLGIudmFsdWUhPT1hLnZhbHVlJiYoYi52YWx1ZT1hLnZhbHVlKTtiLnJlbW92ZUF0dHJpYnV0ZShmLmV4cGFuZG8pfX1mdW5jdGlvbiBiaihhLGIpe2lmKGIubm9kZVR5cGU9PT0xJiYhIWYuaGFzRGF0YShhKSl7dmFyIGMsZCxlLGc9Zi5fZGF0YShhKSxoPWYuX2RhdGEoYixnKSxpPWcuZXZlbnRzO2lmKGkpe2RlbGV0ZSBoLmhhbmRsZSxoLmV2ZW50cz17fTtmb3IoYyBpbiBpKWZvcihkPTAsZT1pW2NdLmxlbmd0aDtkPGU7ZCsrKWYuZXZlbnQuYWRkKGIsYysoaVtjXVtkXS5uYW1lc3BhY2U/XCIuXCI6XCJcIikraVtjXVtkXS5uYW1lc3BhY2UsaVtjXVtkXSxpW2NdW2RdLmRhdGEpfWguZGF0YSYmKGguZGF0YT1mLmV4dGVuZCh7fSxoLmRhdGEpKX19ZnVuY3Rpb24gYmkoYSxiKXtyZXR1cm4gZi5ub2RlTmFtZShhLFwidGFibGVcIik/YS5nZXRFbGVtZW50c0J5VGFnTmFtZShcInRib2R5XCIpWzBdfHxhLmFwcGVuZENoaWxkKGEub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGJvZHlcIikpOmF9ZnVuY3Rpb24gVShhKXt2YXIgYj1WLnNwbGl0KFwifFwiKSxjPWEuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO2lmKGMuY3JlYXRlRWxlbWVudCl3aGlsZShiLmxlbmd0aCljLmNyZWF0ZUVsZW1lbnQoYi5wb3AoKSk7cmV0dXJuIGN9ZnVuY3Rpb24gVChhLGIsYyl7Yj1ifHwwO2lmKGYuaXNGdW5jdGlvbihiKSlyZXR1cm4gZi5ncmVwKGEsZnVuY3Rpb24oYSxkKXt2YXIgZT0hIWIuY2FsbChhLGQsYSk7cmV0dXJuIGU9PT1jfSk7aWYoYi5ub2RlVHlwZSlyZXR1cm4gZi5ncmVwKGEsZnVuY3Rpb24oYSxkKXtyZXR1cm4gYT09PWI9PT1jfSk7aWYodHlwZW9mIGI9PVwic3RyaW5nXCIpe3ZhciBkPWYuZ3JlcChhLGZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVUeXBlPT09MX0pO2lmKE8udGVzdChiKSlyZXR1cm4gZi5maWx0ZXIoYixkLCFjKTtiPWYuZmlsdGVyKGIsZCl9cmV0dXJuIGYuZ3JlcChhLGZ1bmN0aW9uKGEsZCl7cmV0dXJuIGYuaW5BcnJheShhLGIpPj0wPT09Y30pfWZ1bmN0aW9uIFMoYSl7cmV0dXJuIWF8fCFhLnBhcmVudE5vZGV8fGEucGFyZW50Tm9kZS5ub2RlVHlwZT09PTExfWZ1bmN0aW9uIEsoKXtyZXR1cm4hMH1mdW5jdGlvbiBKKCl7cmV0dXJuITF9ZnVuY3Rpb24gbihhLGIsYyl7dmFyIGQ9YitcImRlZmVyXCIsZT1iK1wicXVldWVcIixnPWIrXCJtYXJrXCIsaD1mLl9kYXRhKGEsZCk7aCYmKGM9PT1cInF1ZXVlXCJ8fCFmLl9kYXRhKGEsZSkpJiYoYz09PVwibWFya1wifHwhZi5fZGF0YShhLGcpKSYmc2V0VGltZW91dChmdW5jdGlvbigpeyFmLl9kYXRhKGEsZSkmJiFmLl9kYXRhKGEsZykmJihmLnJlbW92ZURhdGEoYSxkLCEwKSxoLmZpcmUoKSl9LDApfWZ1bmN0aW9uIG0oYSl7Zm9yKHZhciBiIGluIGEpe2lmKGI9PT1cImRhdGFcIiYmZi5pc0VtcHR5T2JqZWN0KGFbYl0pKWNvbnRpbnVlO2lmKGIhPT1cInRvSlNPTlwiKXJldHVybiExfXJldHVybiEwfWZ1bmN0aW9uIGwoYSxjLGQpe2lmKGQ9PT1iJiZhLm5vZGVUeXBlPT09MSl7dmFyIGU9XCJkYXRhLVwiK2MucmVwbGFjZShrLFwiLSQxXCIpLnRvTG93ZXJDYXNlKCk7ZD1hLmdldEF0dHJpYnV0ZShlKTtpZih0eXBlb2YgZD09XCJzdHJpbmdcIil7dHJ5e2Q9ZD09PVwidHJ1ZVwiPyEwOmQ9PT1cImZhbHNlXCI/ITE6ZD09PVwibnVsbFwiP251bGw6Zi5pc051bWVyaWMoZCk/cGFyc2VGbG9hdChkKTpqLnRlc3QoZCk/Zi5wYXJzZUpTT04oZCk6ZH1jYXRjaChnKXt9Zi5kYXRhKGEsYyxkKX1lbHNlIGQ9Yn1yZXR1cm4gZH1mdW5jdGlvbiBoKGEpe3ZhciBiPWdbYV09e30sYyxkO2E9YS5zcGxpdCgvXFxzKy8pO2ZvcihjPTAsZD1hLmxlbmd0aDtjPGQ7YysrKWJbYVtjXV09ITA7cmV0dXJuIGJ9dmFyIGM9YS5kb2N1bWVudCxkPWEubmF2aWdhdG9yLGU9YS5sb2NhdGlvbixmPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gSigpe2lmKCFlLmlzUmVhZHkpe3RyeXtjLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbChcImxlZnRcIil9Y2F0Y2goYSl7c2V0VGltZW91dChKLDEpO3JldHVybn1lLnJlYWR5KCl9fXZhciBlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBlLmZuLmluaXQoYSxiLGgpfSxmPWEualF1ZXJ5LGc9YS4kLGgsaT0vXig/OlteIzxdKig8W1xcd1xcV10rPilbXj5dKiR8IyhbXFx3XFwtXSopJCkvLGo9L1xcUy8saz0vXlxccysvLGw9L1xccyskLyxtPS9ePChcXHcrKVxccypcXC8/Pig/OjxcXC9cXDE+KT8kLyxuPS9eW1xcXSw6e31cXHNdKiQvLG89L1xcXFwoPzpbXCJcXFxcXFwvYmZucnRdfHVbMC05YS1mQS1GXXs0fSkvZyxwPS9cIlteXCJcXFxcXFxuXFxyXSpcInx0cnVlfGZhbHNlfG51bGx8LT9cXGQrKD86XFwuXFxkKik/KD86W2VFXVsrXFwtXT9cXGQrKT8vZyxxPS8oPzpefDp8LCkoPzpcXHMqXFxbKSsvZyxyPS8od2Via2l0KVsgXFwvXShbXFx3Ll0rKS8scz0vKG9wZXJhKSg/Oi4qdmVyc2lvbik/WyBcXC9dKFtcXHcuXSspLyx0PS8obXNpZSkgKFtcXHcuXSspLyx1PS8obW96aWxsYSkoPzouKj8gcnY6KFtcXHcuXSspKT8vLHY9Ly0oW2Etel18WzAtOV0pL2lnLHc9L14tbXMtLyx4PWZ1bmN0aW9uKGEsYil7cmV0dXJuKGIrXCJcIikudG9VcHBlckNhc2UoKX0seT1kLnVzZXJBZ2VudCx6LEEsQixDPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsRD1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LEU9QXJyYXkucHJvdG90eXBlLnB1c2gsRj1BcnJheS5wcm90b3R5cGUuc2xpY2UsRz1TdHJpbmcucHJvdG90eXBlLnRyaW0sSD1BcnJheS5wcm90b3R5cGUuaW5kZXhPZixJPXt9O2UuZm49ZS5wcm90b3R5cGU9e2NvbnN0cnVjdG9yOmUsaW5pdDpmdW5jdGlvbihhLGQsZil7dmFyIGcsaCxqLGs7aWYoIWEpcmV0dXJuIHRoaXM7aWYoYS5ub2RlVHlwZSl7dGhpcy5jb250ZXh0PXRoaXNbMF09YSx0aGlzLmxlbmd0aD0xO3JldHVybiB0aGlzfWlmKGE9PT1cImJvZHlcIiYmIWQmJmMuYm9keSl7dGhpcy5jb250ZXh0PWMsdGhpc1swXT1jLmJvZHksdGhpcy5zZWxlY3Rvcj1hLHRoaXMubGVuZ3RoPTE7cmV0dXJuIHRoaXN9aWYodHlwZW9mIGE9PVwic3RyaW5nXCIpe2EuY2hhckF0KDApIT09XCI8XCJ8fGEuY2hhckF0KGEubGVuZ3RoLTEpIT09XCI+XCJ8fGEubGVuZ3RoPDM/Zz1pLmV4ZWMoYSk6Zz1bbnVsbCxhLG51bGxdO2lmKGcmJihnWzFdfHwhZCkpe2lmKGdbMV0pe2Q9ZCBpbnN0YW5jZW9mIGU/ZFswXTpkLGs9ZD9kLm93bmVyRG9jdW1lbnR8fGQ6YyxqPW0uZXhlYyhhKSxqP2UuaXNQbGFpbk9iamVjdChkKT8oYT1bYy5jcmVhdGVFbGVtZW50KGpbMV0pXSxlLmZuLmF0dHIuY2FsbChhLGQsITApKTphPVtrLmNyZWF0ZUVsZW1lbnQoalsxXSldOihqPWUuYnVpbGRGcmFnbWVudChbZ1sxXV0sW2tdKSxhPShqLmNhY2hlYWJsZT9lLmNsb25lKGouZnJhZ21lbnQpOmouZnJhZ21lbnQpLmNoaWxkTm9kZXMpO3JldHVybiBlLm1lcmdlKHRoaXMsYSl9aD1jLmdldEVsZW1lbnRCeUlkKGdbMl0pO2lmKGgmJmgucGFyZW50Tm9kZSl7aWYoaC5pZCE9PWdbMl0pcmV0dXJuIGYuZmluZChhKTt0aGlzLmxlbmd0aD0xLHRoaXNbMF09aH10aGlzLmNvbnRleHQ9Yyx0aGlzLnNlbGVjdG9yPWE7cmV0dXJuIHRoaXN9cmV0dXJuIWR8fGQuanF1ZXJ5PyhkfHxmKS5maW5kKGEpOnRoaXMuY29uc3RydWN0b3IoZCkuZmluZChhKX1pZihlLmlzRnVuY3Rpb24oYSkpcmV0dXJuIGYucmVhZHkoYSk7YS5zZWxlY3RvciE9PWImJih0aGlzLnNlbGVjdG9yPWEuc2VsZWN0b3IsdGhpcy5jb250ZXh0PWEuY29udGV4dCk7cmV0dXJuIGUubWFrZUFycmF5KGEsdGhpcyl9LHNlbGVjdG9yOlwiXCIsanF1ZXJ5OlwiMS43LjFcIixsZW5ndGg6MCxzaXplOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubGVuZ3RofSx0b0FycmF5OmZ1bmN0aW9uKCl7cmV0dXJuIEYuY2FsbCh0aGlzLDApfSxnZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/dGhpcy50b0FycmF5KCk6YTwwP3RoaXNbdGhpcy5sZW5ndGgrYV06dGhpc1thXX0scHVzaFN0YWNrOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aGlzLmNvbnN0cnVjdG9yKCk7ZS5pc0FycmF5KGEpP0UuYXBwbHkoZCxhKTplLm1lcmdlKGQsYSksZC5wcmV2T2JqZWN0PXRoaXMsZC5jb250ZXh0PXRoaXMuY29udGV4dCxiPT09XCJmaW5kXCI/ZC5zZWxlY3Rvcj10aGlzLnNlbGVjdG9yKyh0aGlzLnNlbGVjdG9yP1wiIFwiOlwiXCIpK2M6YiYmKGQuc2VsZWN0b3I9dGhpcy5zZWxlY3RvcitcIi5cIitiK1wiKFwiK2MrXCIpXCIpO3JldHVybiBkfSxlYWNoOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGUuZWFjaCh0aGlzLGEsYil9LHJlYWR5OmZ1bmN0aW9uKGEpe2UuYmluZFJlYWR5KCksQS5hZGQoYSk7cmV0dXJuIHRoaXN9LGVxOmZ1bmN0aW9uKGEpe2E9K2E7cmV0dXJuIGE9PT0tMT90aGlzLnNsaWNlKGEpOnRoaXMuc2xpY2UoYSxhKzEpfSxmaXJzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKDApfSxsYXN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZXEoLTEpfSxzbGljZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLnB1c2hTdGFjayhGLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxcInNsaWNlXCIsRi5jYWxsKGFyZ3VtZW50cykuam9pbihcIixcIikpfSxtYXA6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGUubWFwKHRoaXMsZnVuY3Rpb24oYixjKXtyZXR1cm4gYS5jYWxsKGIsYyxiKX0pKX0sZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHJldk9iamVjdHx8dGhpcy5jb25zdHJ1Y3RvcihudWxsKX0scHVzaDpFLHNvcnQ6W10uc29ydCxzcGxpY2U6W10uc3BsaWNlfSxlLmZuLmluaXQucHJvdG90eXBlPWUuZm4sZS5leHRlbmQ9ZS5mbi5leHRlbmQ9ZnVuY3Rpb24oKXt2YXIgYSxjLGQsZixnLGgsaT1hcmd1bWVudHNbMF18fHt9LGo9MSxrPWFyZ3VtZW50cy5sZW5ndGgsbD0hMTt0eXBlb2YgaT09XCJib29sZWFuXCImJihsPWksaT1hcmd1bWVudHNbMV18fHt9LGo9MiksdHlwZW9mIGkhPVwib2JqZWN0XCImJiFlLmlzRnVuY3Rpb24oaSkmJihpPXt9KSxrPT09aiYmKGk9dGhpcywtLWopO2Zvcig7ajxrO2orKylpZigoYT1hcmd1bWVudHNbal0pIT1udWxsKWZvcihjIGluIGEpe2Q9aVtjXSxmPWFbY107aWYoaT09PWYpY29udGludWU7bCYmZiYmKGUuaXNQbGFpbk9iamVjdChmKXx8KGc9ZS5pc0FycmF5KGYpKSk/KGc/KGc9ITEsaD1kJiZlLmlzQXJyYXkoZCk/ZDpbXSk6aD1kJiZlLmlzUGxhaW5PYmplY3QoZCk/ZDp7fSxpW2NdPWUuZXh0ZW5kKGwsaCxmKSk6ZiE9PWImJihpW2NdPWYpfXJldHVybiBpfSxlLmV4dGVuZCh7bm9Db25mbGljdDpmdW5jdGlvbihiKXthLiQ9PT1lJiYoYS4kPWcpLGImJmEualF1ZXJ5PT09ZSYmKGEualF1ZXJ5PWYpO3JldHVybiBlfSxpc1JlYWR5OiExLHJlYWR5V2FpdDoxLGhvbGRSZWFkeTpmdW5jdGlvbihhKXthP2UucmVhZHlXYWl0Kys6ZS5yZWFkeSghMCl9LHJlYWR5OmZ1bmN0aW9uKGEpe2lmKGE9PT0hMCYmIS0tZS5yZWFkeVdhaXR8fGEhPT0hMCYmIWUuaXNSZWFkeSl7aWYoIWMuYm9keSlyZXR1cm4gc2V0VGltZW91dChlLnJlYWR5LDEpO2UuaXNSZWFkeT0hMDtpZihhIT09ITAmJi0tZS5yZWFkeVdhaXQ+MClyZXR1cm47QS5maXJlV2l0aChjLFtlXSksZS5mbi50cmlnZ2VyJiZlKGMpLnRyaWdnZXIoXCJyZWFkeVwiKS5vZmYoXCJyZWFkeVwiKX19LGJpbmRSZWFkeTpmdW5jdGlvbigpe2lmKCFBKXtBPWUuQ2FsbGJhY2tzKFwib25jZSBtZW1vcnlcIik7aWYoYy5yZWFkeVN0YXRlPT09XCJjb21wbGV0ZVwiKXJldHVybiBzZXRUaW1lb3V0KGUucmVhZHksMSk7aWYoYy5hZGRFdmVudExpc3RlbmVyKWMuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIixCLCExKSxhLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsZS5yZWFkeSwhMSk7ZWxzZSBpZihjLmF0dGFjaEV2ZW50KXtjLmF0dGFjaEV2ZW50KFwib25yZWFkeXN0YXRlY2hhbmdlXCIsQiksYS5hdHRhY2hFdmVudChcIm9ubG9hZFwiLGUucmVhZHkpO3ZhciBiPSExO3RyeXtiPWEuZnJhbWVFbGVtZW50PT1udWxsfWNhdGNoKGQpe31jLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCYmYiYmSigpfX19LGlzRnVuY3Rpb246ZnVuY3Rpb24oYSl7cmV0dXJuIGUudHlwZShhKT09PVwiZnVuY3Rpb25cIn0saXNBcnJheTpBcnJheS5pc0FycmF5fHxmdW5jdGlvbihhKXtyZXR1cm4gZS50eXBlKGEpPT09XCJhcnJheVwifSxpc1dpbmRvdzpmdW5jdGlvbihhKXtyZXR1cm4gYSYmdHlwZW9mIGE9PVwib2JqZWN0XCImJlwic2V0SW50ZXJ2YWxcImluIGF9LGlzTnVtZXJpYzpmdW5jdGlvbihhKXtyZXR1cm4haXNOYU4ocGFyc2VGbG9hdChhKSkmJmlzRmluaXRlKGEpfSx0eXBlOmZ1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsP1N0cmluZyhhKTpJW0MuY2FsbChhKV18fFwib2JqZWN0XCJ9LGlzUGxhaW5PYmplY3Q6ZnVuY3Rpb24oYSl7aWYoIWF8fGUudHlwZShhKSE9PVwib2JqZWN0XCJ8fGEubm9kZVR5cGV8fGUuaXNXaW5kb3coYSkpcmV0dXJuITE7dHJ5e2lmKGEuY29uc3RydWN0b3ImJiFELmNhbGwoYSxcImNvbnN0cnVjdG9yXCIpJiYhRC5jYWxsKGEuY29uc3RydWN0b3IucHJvdG90eXBlLFwiaXNQcm90b3R5cGVPZlwiKSlyZXR1cm4hMX1jYXRjaChjKXtyZXR1cm4hMX12YXIgZDtmb3IoZCBpbiBhKTtyZXR1cm4gZD09PWJ8fEQuY2FsbChhLGQpfSxpc0VtcHR5T2JqZWN0OmZ1bmN0aW9uKGEpe2Zvcih2YXIgYiBpbiBhKXJldHVybiExO3JldHVybiEwfSxlcnJvcjpmdW5jdGlvbihhKXt0aHJvdyBuZXcgRXJyb3IoYSl9LHBhcnNlSlNPTjpmdW5jdGlvbihiKXtpZih0eXBlb2YgYiE9XCJzdHJpbmdcInx8IWIpcmV0dXJuIG51bGw7Yj1lLnRyaW0oYik7aWYoYS5KU09OJiZhLkpTT04ucGFyc2UpcmV0dXJuIGEuSlNPTi5wYXJzZShiKTtpZihuLnRlc3QoYi5yZXBsYWNlKG8sXCJAXCIpLnJlcGxhY2UocCxcIl1cIikucmVwbGFjZShxLFwiXCIpKSlyZXR1cm4obmV3IEZ1bmN0aW9uKFwicmV0dXJuIFwiK2IpKSgpO2UuZXJyb3IoXCJJbnZhbGlkIEpTT046IFwiK2IpfSxwYXJzZVhNTDpmdW5jdGlvbihjKXt2YXIgZCxmO3RyeXthLkRPTVBhcnNlcj8oZj1uZXcgRE9NUGFyc2VyLGQ9Zi5wYXJzZUZyb21TdHJpbmcoYyxcInRleHQveG1sXCIpKTooZD1uZXcgQWN0aXZlWE9iamVjdChcIk1pY3Jvc29mdC5YTUxET01cIiksZC5hc3luYz1cImZhbHNlXCIsZC5sb2FkWE1MKGMpKX1jYXRjaChnKXtkPWJ9KCFkfHwhZC5kb2N1bWVudEVsZW1lbnR8fGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJwYXJzZXJlcnJvclwiKS5sZW5ndGgpJiZlLmVycm9yKFwiSW52YWxpZCBYTUw6IFwiK2MpO3JldHVybiBkfSxub29wOmZ1bmN0aW9uKCl7fSxnbG9iYWxFdmFsOmZ1bmN0aW9uKGIpe2ImJmoudGVzdChiKSYmKGEuZXhlY1NjcmlwdHx8ZnVuY3Rpb24oYil7YS5ldmFsLmNhbGwoYSxiKX0pKGIpfSxjYW1lbENhc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSh3LFwibXMtXCIpLnJlcGxhY2Uodix4KX0sbm9kZU5hbWU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5ub2RlTmFtZSYmYS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpPT09Yi50b1VwcGVyQ2FzZSgpfSxlYWNoOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZixnPTAsaD1hLmxlbmd0aCxpPWg9PT1ifHxlLmlzRnVuY3Rpb24oYSk7aWYoZCl7aWYoaSl7Zm9yKGYgaW4gYSlpZihjLmFwcGx5KGFbZl0sZCk9PT0hMSlicmVha31lbHNlIGZvcig7ZzxoOylpZihjLmFwcGx5KGFbZysrXSxkKT09PSExKWJyZWFrfWVsc2UgaWYoaSl7Zm9yKGYgaW4gYSlpZihjLmNhbGwoYVtmXSxmLGFbZl0pPT09ITEpYnJlYWt9ZWxzZSBmb3IoO2c8aDspaWYoYy5jYWxsKGFbZ10sZyxhW2crK10pPT09ITEpYnJlYWs7cmV0dXJuIGF9LHRyaW06Rz9mdW5jdGlvbihhKXtyZXR1cm4gYT09bnVsbD9cIlwiOkcuY2FsbChhKX06ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/XCJcIjooYStcIlwiKS5yZXBsYWNlKGssXCJcIikucmVwbGFjZShsLFwiXCIpfSxtYWtlQXJyYXk6ZnVuY3Rpb24oYSxiKXt2YXIgYz1ifHxbXTtpZihhIT1udWxsKXt2YXIgZD1lLnR5cGUoYSk7YS5sZW5ndGg9PW51bGx8fGQ9PT1cInN0cmluZ1wifHxkPT09XCJmdW5jdGlvblwifHxkPT09XCJyZWdleHBcInx8ZS5pc1dpbmRvdyhhKT9FLmNhbGwoYyxhKTplLm1lcmdlKGMsYSl9cmV0dXJuIGN9LGluQXJyYXk6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkO2lmKGIpe2lmKEgpcmV0dXJuIEguY2FsbChiLGEsYyk7ZD1iLmxlbmd0aCxjPWM/YzwwP01hdGgubWF4KDAsZCtjKTpjOjA7Zm9yKDtjPGQ7YysrKWlmKGMgaW4gYiYmYltjXT09PWEpcmV0dXJuIGN9cmV0dXJuLTF9LG1lcmdlOmZ1bmN0aW9uKGEsYyl7dmFyIGQ9YS5sZW5ndGgsZT0wO2lmKHR5cGVvZiBjLmxlbmd0aD09XCJudW1iZXJcIilmb3IodmFyIGY9Yy5sZW5ndGg7ZTxmO2UrKylhW2QrK109Y1tlXTtlbHNlIHdoaWxlKGNbZV0hPT1iKWFbZCsrXT1jW2UrK107YS5sZW5ndGg9ZDtyZXR1cm4gYX0sZ3JlcDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9W10sZTtjPSEhYztmb3IodmFyIGY9MCxnPWEubGVuZ3RoO2Y8ZztmKyspZT0hIWIoYVtmXSxmKSxjIT09ZSYmZC5wdXNoKGFbZl0pO3JldHVybiBkfSxtYXA6ZnVuY3Rpb24oYSxjLGQpe3ZhciBmLGcsaD1bXSxpPTAsaj1hLmxlbmd0aCxrPWEgaW5zdGFuY2VvZiBlfHxqIT09YiYmdHlwZW9mIGo9PVwibnVtYmVyXCImJihqPjAmJmFbMF0mJmFbai0xXXx8aj09PTB8fGUuaXNBcnJheShhKSk7aWYoaylmb3IoO2k8ajtpKyspZj1jKGFbaV0saSxkKSxmIT1udWxsJiYoaFtoLmxlbmd0aF09Zik7ZWxzZSBmb3IoZyBpbiBhKWY9YyhhW2ddLGcsZCksZiE9bnVsbCYmKGhbaC5sZW5ndGhdPWYpO3JldHVybiBoLmNvbmNhdC5hcHBseShbXSxoKX0sZ3VpZDoxLHByb3h5OmZ1bmN0aW9uKGEsYyl7aWYodHlwZW9mIGM9PVwic3RyaW5nXCIpe3ZhciBkPWFbY107Yz1hLGE9ZH1pZighZS5pc0Z1bmN0aW9uKGEpKXJldHVybiBiO3ZhciBmPUYuY2FsbChhcmd1bWVudHMsMiksZz1mdW5jdGlvbigpe3JldHVybiBhLmFwcGx5KGMsZi5jb25jYXQoRi5jYWxsKGFyZ3VtZW50cykpKX07Zy5ndWlkPWEuZ3VpZD1hLmd1aWR8fGcuZ3VpZHx8ZS5ndWlkKys7cmV0dXJuIGd9LGFjY2VzczpmdW5jdGlvbihhLGMsZCxmLGcsaCl7dmFyIGk9YS5sZW5ndGg7aWYodHlwZW9mIGM9PVwib2JqZWN0XCIpe2Zvcih2YXIgaiBpbiBjKWUuYWNjZXNzKGEsaixjW2pdLGYsZyxkKTtyZXR1cm4gYX1pZihkIT09Yil7Zj0haCYmZiYmZS5pc0Z1bmN0aW9uKGQpO2Zvcih2YXIgaz0wO2s8aTtrKyspZyhhW2tdLGMsZj9kLmNhbGwoYVtrXSxrLGcoYVtrXSxjKSk6ZCxoKTtyZXR1cm4gYX1yZXR1cm4gaT9nKGFbMF0sYyk6Yn0sbm93OmZ1bmN0aW9uKCl7cmV0dXJuKG5ldyBEYXRlKS5nZXRUaW1lKCl9LHVhTWF0Y2g6ZnVuY3Rpb24oYSl7YT1hLnRvTG93ZXJDYXNlKCk7dmFyIGI9ci5leGVjKGEpfHxzLmV4ZWMoYSl8fHQuZXhlYyhhKXx8YS5pbmRleE9mKFwiY29tcGF0aWJsZVwiKTwwJiZ1LmV4ZWMoYSl8fFtdO3JldHVybnticm93c2VyOmJbMV18fFwiXCIsdmVyc2lvbjpiWzJdfHxcIjBcIn19LHN1YjpmdW5jdGlvbigpe2Z1bmN0aW9uIGEoYixjKXtyZXR1cm4gbmV3IGEuZm4uaW5pdChiLGMpfWUuZXh0ZW5kKCEwLGEsdGhpcyksYS5zdXBlcmNsYXNzPXRoaXMsYS5mbj1hLnByb3RvdHlwZT10aGlzKCksYS5mbi5jb25zdHJ1Y3Rvcj1hLGEuc3ViPXRoaXMuc3ViLGEuZm4uaW5pdD1mdW5jdGlvbihkLGYpe2YmJmYgaW5zdGFuY2VvZiBlJiYhKGYgaW5zdGFuY2VvZiBhKSYmKGY9YShmKSk7cmV0dXJuIGUuZm4uaW5pdC5jYWxsKHRoaXMsZCxmLGIpfSxhLmZuLmluaXQucHJvdG90eXBlPWEuZm47dmFyIGI9YShjKTtyZXR1cm4gYX0sYnJvd3Nlcjp7fX0pLGUuZWFjaChcIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3RcIi5zcGxpdChcIiBcIiksZnVuY3Rpb24oYSxiKXtJW1wiW29iamVjdCBcIitiK1wiXVwiXT1iLnRvTG93ZXJDYXNlKCl9KSx6PWUudWFNYXRjaCh5KSx6LmJyb3dzZXImJihlLmJyb3dzZXJbei5icm93c2VyXT0hMCxlLmJyb3dzZXIudmVyc2lvbj16LnZlcnNpb24pLGUuYnJvd3Nlci53ZWJraXQmJihlLmJyb3dzZXIuc2FmYXJpPSEwKSxqLnRlc3QoXCLCoFwiKSYmKGs9L15bXFxzXFx4QTBdKy8sbD0vW1xcc1xceEEwXSskLyksaD1lKGMpLGMuYWRkRXZlbnRMaXN0ZW5lcj9CPWZ1bmN0aW9uKCl7Yy5yZW1vdmVFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLEIsITEpLGUucmVhZHkoKX06Yy5hdHRhY2hFdmVudCYmKEI9ZnVuY3Rpb24oKXtjLnJlYWR5U3RhdGU9PT1cImNvbXBsZXRlXCImJihjLmRldGFjaEV2ZW50KFwib25yZWFkeXN0YXRlY2hhbmdlXCIsQiksZS5yZWFkeSgpKX0pO3JldHVybiBlfSgpLGc9e307Zi5DYWxsYmFja3M9ZnVuY3Rpb24oYSl7YT1hP2dbYV18fGgoYSk6e307dmFyIGM9W10sZD1bXSxlLGksaixrLGwsbT1mdW5jdGlvbihiKXt2YXIgZCxlLGcsaCxpO2ZvcihkPTAsZT1iLmxlbmd0aDtkPGU7ZCsrKWc9YltkXSxoPWYudHlwZShnKSxoPT09XCJhcnJheVwiP20oZyk6aD09PVwiZnVuY3Rpb25cIiYmKCFhLnVuaXF1ZXx8IW8uaGFzKGcpKSYmYy5wdXNoKGcpfSxuPWZ1bmN0aW9uKGIsZil7Zj1mfHxbXSxlPSFhLm1lbW9yeXx8W2IsZl0saT0hMCxsPWp8fDAsaj0wLGs9Yy5sZW5ndGg7Zm9yKDtjJiZsPGs7bCsrKWlmKGNbbF0uYXBwbHkoYixmKT09PSExJiZhLnN0b3BPbkZhbHNlKXtlPSEwO2JyZWFrfWk9ITEsYyYmKGEub25jZT9lPT09ITA/by5kaXNhYmxlKCk6Yz1bXTpkJiZkLmxlbmd0aCYmKGU9ZC5zaGlmdCgpLG8uZmlyZVdpdGgoZVswXSxlWzFdKSkpfSxvPXthZGQ6ZnVuY3Rpb24oKXtpZihjKXt2YXIgYT1jLmxlbmd0aDttKGFyZ3VtZW50cyksaT9rPWMubGVuZ3RoOmUmJmUhPT0hMCYmKGo9YSxuKGVbMF0sZVsxXSkpfXJldHVybiB0aGlzfSxyZW1vdmU6ZnVuY3Rpb24oKXtpZihjKXt2YXIgYj1hcmd1bWVudHMsZD0wLGU9Yi5sZW5ndGg7Zm9yKDtkPGU7ZCsrKWZvcih2YXIgZj0wO2Y8Yy5sZW5ndGg7ZisrKWlmKGJbZF09PT1jW2ZdKXtpJiZmPD1rJiYoay0tLGY8PWwmJmwtLSksYy5zcGxpY2UoZi0tLDEpO2lmKGEudW5pcXVlKWJyZWFrfX1yZXR1cm4gdGhpc30saGFzOmZ1bmN0aW9uKGEpe2lmKGMpe3ZhciBiPTAsZD1jLmxlbmd0aDtmb3IoO2I8ZDtiKyspaWYoYT09PWNbYl0pcmV0dXJuITB9cmV0dXJuITF9LGVtcHR5OmZ1bmN0aW9uKCl7Yz1bXTtyZXR1cm4gdGhpc30sZGlzYWJsZTpmdW5jdGlvbigpe2M9ZD1lPWI7cmV0dXJuIHRoaXN9LGRpc2FibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIWN9LGxvY2s6ZnVuY3Rpb24oKXtkPWIsKCFlfHxlPT09ITApJiZvLmRpc2FibGUoKTtyZXR1cm4gdGhpc30sbG9ja2VkOmZ1bmN0aW9uKCl7cmV0dXJuIWR9LGZpcmVXaXRoOmZ1bmN0aW9uKGIsYyl7ZCYmKGk/YS5vbmNlfHxkLnB1c2goW2IsY10pOighYS5vbmNlfHwhZSkmJm4oYixjKSk7cmV0dXJuIHRoaXN9LGZpcmU6ZnVuY3Rpb24oKXtvLmZpcmVXaXRoKHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gdGhpc30sZmlyZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIWV9fTtyZXR1cm4gb307dmFyIGk9W10uc2xpY2U7Zi5leHRlbmQoe0RlZmVycmVkOmZ1bmN0aW9uKGEpe3ZhciBiPWYuQ2FsbGJhY2tzKFwib25jZSBtZW1vcnlcIiksYz1mLkNhbGxiYWNrcyhcIm9uY2UgbWVtb3J5XCIpLGQ9Zi5DYWxsYmFja3MoXCJtZW1vcnlcIiksZT1cInBlbmRpbmdcIixnPXtyZXNvbHZlOmIscmVqZWN0OmMsbm90aWZ5OmR9LGg9e2RvbmU6Yi5hZGQsZmFpbDpjLmFkZCxwcm9ncmVzczpkLmFkZCxzdGF0ZTpmdW5jdGlvbigpe3JldHVybiBlfSxpc1Jlc29sdmVkOmIuZmlyZWQsaXNSZWplY3RlZDpjLmZpcmVkLHRoZW46ZnVuY3Rpb24oYSxiLGMpe2kuZG9uZShhKS5mYWlsKGIpLnByb2dyZXNzKGMpO3JldHVybiB0aGlzfSxhbHdheXM6ZnVuY3Rpb24oKXtpLmRvbmUuYXBwbHkoaSxhcmd1bWVudHMpLmZhaWwuYXBwbHkoaSxhcmd1bWVudHMpO3JldHVybiB0aGlzfSxwaXBlOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5EZWZlcnJlZChmdW5jdGlvbihkKXtmLmVhY2goe2RvbmU6W2EsXCJyZXNvbHZlXCJdLGZhaWw6W2IsXCJyZWplY3RcIl0scHJvZ3Jlc3M6W2MsXCJub3RpZnlcIl19LGZ1bmN0aW9uKGEsYil7dmFyIGM9YlswXSxlPWJbMV0sZztmLmlzRnVuY3Rpb24oYyk/aVthXShmdW5jdGlvbigpe2c9Yy5hcHBseSh0aGlzLGFyZ3VtZW50cyksZyYmZi5pc0Z1bmN0aW9uKGcucHJvbWlzZSk/Zy5wcm9taXNlKCkudGhlbihkLnJlc29sdmUsZC5yZWplY3QsZC5ub3RpZnkpOmRbZStcIldpdGhcIl0odGhpcz09PWk/ZDp0aGlzLFtnXSl9KTppW2FdKGRbZV0pfSl9KS5wcm9taXNlKCl9LHByb21pc2U6ZnVuY3Rpb24oYSl7aWYoYT09bnVsbClhPWg7ZWxzZSBmb3IodmFyIGIgaW4gaClhW2JdPWhbYl07cmV0dXJuIGF9fSxpPWgucHJvbWlzZSh7fSksajtmb3IoaiBpbiBnKWlbal09Z1tqXS5maXJlLGlbaitcIldpdGhcIl09Z1tqXS5maXJlV2l0aDtpLmRvbmUoZnVuY3Rpb24oKXtlPVwicmVzb2x2ZWRcIn0sYy5kaXNhYmxlLGQubG9jaykuZmFpbChmdW5jdGlvbigpe2U9XCJyZWplY3RlZFwifSxiLmRpc2FibGUsZC5sb2NrKSxhJiZhLmNhbGwoaSxpKTtyZXR1cm4gaX0sd2hlbjpmdW5jdGlvbihhKXtmdW5jdGlvbiBtKGEpe3JldHVybiBmdW5jdGlvbihiKXtlW2FdPWFyZ3VtZW50cy5sZW5ndGg+MT9pLmNhbGwoYXJndW1lbnRzLDApOmIsai5ub3RpZnlXaXRoKGssZSl9fWZ1bmN0aW9uIGwoYSl7cmV0dXJuIGZ1bmN0aW9uKGMpe2JbYV09YXJndW1lbnRzLmxlbmd0aD4xP2kuY2FsbChhcmd1bWVudHMsMCk6YywtLWd8fGoucmVzb2x2ZVdpdGgoaixiKX19dmFyIGI9aS5jYWxsKGFyZ3VtZW50cywwKSxjPTAsZD1iLmxlbmd0aCxlPUFycmF5KGQpLGc9ZCxoPWQsaj1kPD0xJiZhJiZmLmlzRnVuY3Rpb24oYS5wcm9taXNlKT9hOmYuRGVmZXJyZWQoKSxrPWoucHJvbWlzZSgpO2lmKGQ+MSl7Zm9yKDtjPGQ7YysrKWJbY10mJmJbY10ucHJvbWlzZSYmZi5pc0Z1bmN0aW9uKGJbY10ucHJvbWlzZSk/YltjXS5wcm9taXNlKCkudGhlbihsKGMpLGoucmVqZWN0LG0oYykpOi0tZztnfHxqLnJlc29sdmVXaXRoKGosYil9ZWxzZSBqIT09YSYmai5yZXNvbHZlV2l0aChqLGQ/W2FdOltdKTtyZXR1cm4ga319KSxmLnN1cHBvcnQ9ZnVuY3Rpb24oKXt2YXIgYixkLGUsZyxoLGksaixrLGwsbSxuLG8scCxxPWMuY3JlYXRlRWxlbWVudChcImRpdlwiKSxyPWMuZG9jdW1lbnRFbGVtZW50O3Euc2V0QXR0cmlidXRlKFwiY2xhc3NOYW1lXCIsXCJ0XCIpLHEuaW5uZXJIVE1MPVwiICAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJyBzdHlsZT0ndG9wOjFweDtmbG9hdDpsZWZ0O29wYWNpdHk6LjU1Oyc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz5cIixkPXEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpLGU9cS5nZXRFbGVtZW50c0J5VGFnTmFtZShcImFcIilbMF07aWYoIWR8fCFkLmxlbmd0aHx8IWUpcmV0dXJue307Zz1jLmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIiksaD1nLmFwcGVuZENoaWxkKGMuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKSksaT1xLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaW5wdXRcIilbMF0sYj17bGVhZGluZ1doaXRlc3BhY2U6cS5maXJzdENoaWxkLm5vZGVUeXBlPT09Myx0Ym9keTohcS5nZXRFbGVtZW50c0J5VGFnTmFtZShcInRib2R5XCIpLmxlbmd0aCxodG1sU2VyaWFsaXplOiEhcS5nZXRFbGVtZW50c0J5VGFnTmFtZShcImxpbmtcIikubGVuZ3RoLHN0eWxlOi90b3AvLnRlc3QoZS5nZXRBdHRyaWJ1dGUoXCJzdHlsZVwiKSksaHJlZk5vcm1hbGl6ZWQ6ZS5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpPT09XCIvYVwiLG9wYWNpdHk6L14wLjU1Ly50ZXN0KGUuc3R5bGUub3BhY2l0eSksY3NzRmxvYXQ6ISFlLnN0eWxlLmNzc0Zsb2F0LGNoZWNrT246aS52YWx1ZT09PVwib25cIixvcHRTZWxlY3RlZDpoLnNlbGVjdGVkLGdldFNldEF0dHJpYnV0ZTpxLmNsYXNzTmFtZSE9PVwidFwiLGVuY3R5cGU6ISFjLmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpLmVuY3R5cGUsaHRtbDVDbG9uZTpjLmNyZWF0ZUVsZW1lbnQoXCJuYXZcIikuY2xvbmVOb2RlKCEwKS5vdXRlckhUTUwhPT1cIjw6bmF2PjwvOm5hdj5cIixzdWJtaXRCdWJibGVzOiEwLGNoYW5nZUJ1YmJsZXM6ITAsZm9jdXNpbkJ1YmJsZXM6ITEsZGVsZXRlRXhwYW5kbzohMCxub0Nsb25lRXZlbnQ6ITAsaW5saW5lQmxvY2tOZWVkc0xheW91dDohMSxzaHJpbmtXcmFwQmxvY2tzOiExLHJlbGlhYmxlTWFyZ2luUmlnaHQ6ITB9LGkuY2hlY2tlZD0hMCxiLm5vQ2xvbmVDaGVja2VkPWkuY2xvbmVOb2RlKCEwKS5jaGVja2VkLGcuZGlzYWJsZWQ9ITAsYi5vcHREaXNhYmxlZD0haC5kaXNhYmxlZDt0cnl7ZGVsZXRlIHEudGVzdH1jYXRjaChzKXtiLmRlbGV0ZUV4cGFuZG89ITF9IXEuYWRkRXZlbnRMaXN0ZW5lciYmcS5hdHRhY2hFdmVudCYmcS5maXJlRXZlbnQmJihxLmF0dGFjaEV2ZW50KFwib25jbGlja1wiLGZ1bmN0aW9uKCl7Yi5ub0Nsb25lRXZlbnQ9ITF9KSxxLmNsb25lTm9kZSghMCkuZmlyZUV2ZW50KFwib25jbGlja1wiKSksaT1jLmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKSxpLnZhbHVlPVwidFwiLGkuc2V0QXR0cmlidXRlKFwidHlwZVwiLFwicmFkaW9cIiksYi5yYWRpb1ZhbHVlPWkudmFsdWU9PT1cInRcIixpLnNldEF0dHJpYnV0ZShcImNoZWNrZWRcIixcImNoZWNrZWRcIikscS5hcHBlbmRDaGlsZChpKSxrPWMuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLGsuYXBwZW5kQ2hpbGQocS5sYXN0Q2hpbGQpLGIuY2hlY2tDbG9uZT1rLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCxiLmFwcGVuZENoZWNrZWQ9aS5jaGVja2VkLGsucmVtb3ZlQ2hpbGQoaSksay5hcHBlbmRDaGlsZChxKSxxLmlubmVySFRNTD1cIlwiLGEuZ2V0Q29tcHV0ZWRTdHlsZSYmKGo9Yy5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGouc3R5bGUud2lkdGg9XCIwXCIsai5zdHlsZS5tYXJnaW5SaWdodD1cIjBcIixxLnN0eWxlLndpZHRoPVwiMnB4XCIscS5hcHBlbmRDaGlsZChqKSxiLnJlbGlhYmxlTWFyZ2luUmlnaHQ9KHBhcnNlSW50KChhLmdldENvbXB1dGVkU3R5bGUoaixudWxsKXx8e21hcmdpblJpZ2h0OjB9KS5tYXJnaW5SaWdodCwxMCl8fDApPT09MCk7aWYocS5hdHRhY2hFdmVudClmb3IobyBpbntzdWJtaXQ6MSxjaGFuZ2U6MSxmb2N1c2luOjF9KW49XCJvblwiK28scD1uIGluIHEscHx8KHEuc2V0QXR0cmlidXRlKG4sXCJyZXR1cm47XCIpLHA9dHlwZW9mIHFbbl09PVwiZnVuY3Rpb25cIiksYltvK1wiQnViYmxlc1wiXT1wO2sucmVtb3ZlQ2hpbGQocSksaz1nPWg9aj1xPWk9bnVsbCxmKGZ1bmN0aW9uKCl7dmFyIGEsZCxlLGcsaCxpLGosayxtLG4sbyxyPWMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJib2R5XCIpWzBdOyFyfHwoaj0xLGs9XCJwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7d2lkdGg6MXB4O2hlaWdodDoxcHg7bWFyZ2luOjA7XCIsbT1cInZpc2liaWxpdHk6aGlkZGVuO2JvcmRlcjowO1wiLG49XCJzdHlsZT0nXCIraytcImJvcmRlcjo1cHggc29saWQgIzAwMDtwYWRkaW5nOjA7J1wiLG89XCI8ZGl2IFwiK24rXCI+PGRpdj48L2Rpdj48L2Rpdj5cIitcIjx0YWJsZSBcIituK1wiIGNlbGxwYWRkaW5nPScwJyBjZWxsc3BhY2luZz0nMCc+XCIrXCI8dHI+PHRkPjwvdGQ+PC90cj48L3RhYmxlPlwiLGE9Yy5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGEuc3R5bGUuY3NzVGV4dD1tK1wid2lkdGg6MDtoZWlnaHQ6MDtwb3NpdGlvbjpzdGF0aWM7dG9wOjA7bWFyZ2luLXRvcDpcIitqK1wicHhcIixyLmluc2VydEJlZm9yZShhLHIuZmlyc3RDaGlsZCkscT1jLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksYS5hcHBlbmRDaGlsZChxKSxxLmlubmVySFRNTD1cIjx0YWJsZT48dHI+PHRkIHN0eWxlPSdwYWRkaW5nOjA7Ym9yZGVyOjA7ZGlzcGxheTpub25lJz48L3RkPjx0ZD50PC90ZD48L3RyPjwvdGFibGU+XCIsbD1xLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwidGRcIikscD1sWzBdLm9mZnNldEhlaWdodD09PTAsbFswXS5zdHlsZS5kaXNwbGF5PVwiXCIsbFsxXS5zdHlsZS5kaXNwbGF5PVwibm9uZVwiLGIucmVsaWFibGVIaWRkZW5PZmZzZXRzPXAmJmxbMF0ub2Zmc2V0SGVpZ2h0PT09MCxxLmlubmVySFRNTD1cIlwiLHEuc3R5bGUud2lkdGg9cS5zdHlsZS5wYWRkaW5nTGVmdD1cIjFweFwiLGYuYm94TW9kZWw9Yi5ib3hNb2RlbD1xLm9mZnNldFdpZHRoPT09Mix0eXBlb2YgcS5zdHlsZS56b29tIT1cInVuZGVmaW5lZFwiJiYocS5zdHlsZS5kaXNwbGF5PVwiaW5saW5lXCIscS5zdHlsZS56b29tPTEsYi5pbmxpbmVCbG9ja05lZWRzTGF5b3V0PXEub2Zmc2V0V2lkdGg9PT0yLHEuc3R5bGUuZGlzcGxheT1cIlwiLHEuaW5uZXJIVE1MPVwiPGRpdiBzdHlsZT0nd2lkdGg6NHB4Oyc+PC9kaXY+XCIsYi5zaHJpbmtXcmFwQmxvY2tzPXEub2Zmc2V0V2lkdGghPT0yKSxxLnN0eWxlLmNzc1RleHQ9ayttLHEuaW5uZXJIVE1MPW8sZD1xLmZpcnN0Q2hpbGQsZT1kLmZpcnN0Q2hpbGQsaD1kLm5leHRTaWJsaW5nLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZCxpPXtkb2VzTm90QWRkQm9yZGVyOmUub2Zmc2V0VG9wIT09NSxkb2VzQWRkQm9yZGVyRm9yVGFibGVBbmRDZWxsczpoLm9mZnNldFRvcD09PTV9LGUuc3R5bGUucG9zaXRpb249XCJmaXhlZFwiLGUuc3R5bGUudG9wPVwiMjBweFwiLGkuZml4ZWRQb3NpdGlvbj1lLm9mZnNldFRvcD09PTIwfHxlLm9mZnNldFRvcD09PTE1LGUuc3R5bGUucG9zaXRpb249ZS5zdHlsZS50b3A9XCJcIixkLnN0eWxlLm92ZXJmbG93PVwiaGlkZGVuXCIsZC5zdHlsZS5wb3NpdGlvbj1cInJlbGF0aXZlXCIsaS5zdWJ0cmFjdHNCb3JkZXJGb3JPdmVyZmxvd05vdFZpc2libGU9ZS5vZmZzZXRUb3A9PT0tNSxpLmRvZXNOb3RJbmNsdWRlTWFyZ2luSW5Cb2R5T2Zmc2V0PXIub2Zmc2V0VG9wIT09aixyLnJlbW92ZUNoaWxkKGEpLHE9YT1udWxsLGYuZXh0ZW5kKGIsaSkpfSk7cmV0dXJuIGJ9KCk7dmFyIGo9L14oPzpcXHsuKlxcfXxcXFsuKlxcXSkkLyxrPS8oW0EtWl0pL2c7Zi5leHRlbmQoe2NhY2hlOnt9LHV1aWQ6MCxleHBhbmRvOlwialF1ZXJ5XCIrKGYuZm4uanF1ZXJ5K01hdGgucmFuZG9tKCkpLnJlcGxhY2UoL1xcRC9nLFwiXCIpLG5vRGF0YTp7ZW1iZWQ6ITAsb2JqZWN0OlwiY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwXCIsYXBwbGV0OiEwfSxoYXNEYXRhOmZ1bmN0aW9uKGEpe2E9YS5ub2RlVHlwZT9mLmNhY2hlW2FbZi5leHBhbmRvXV06YVtmLmV4cGFuZG9dO3JldHVybiEhYSYmIW0oYSl9LGRhdGE6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoISFmLmFjY2VwdERhdGEoYSkpe3ZhciBnLGgsaSxqPWYuZXhwYW5kbyxrPXR5cGVvZiBjPT1cInN0cmluZ1wiLGw9YS5ub2RlVHlwZSxtPWw/Zi5jYWNoZTphLG49bD9hW2pdOmFbal0mJmosbz1jPT09XCJldmVudHNcIjtpZigoIW58fCFtW25dfHwhbyYmIWUmJiFtW25dLmRhdGEpJiZrJiZkPT09YilyZXR1cm47bnx8KGw/YVtqXT1uPSsrZi51dWlkOm49aiksbVtuXXx8KG1bbl09e30sbHx8KG1bbl0udG9KU09OPWYubm9vcCkpO2lmKHR5cGVvZiBjPT1cIm9iamVjdFwifHx0eXBlb2YgYz09XCJmdW5jdGlvblwiKWU/bVtuXT1mLmV4dGVuZChtW25dLGMpOm1bbl0uZGF0YT1mLmV4dGVuZChtW25dLmRhdGEsYyk7Zz1oPW1bbl0sZXx8KGguZGF0YXx8KGguZGF0YT17fSksaD1oLmRhdGEpLGQhPT1iJiYoaFtmLmNhbWVsQ2FzZShjKV09ZCk7aWYobyYmIWhbY10pcmV0dXJuIGcuZXZlbnRzO2s/KGk9aFtjXSxpPT1udWxsJiYoaT1oW2YuY2FtZWxDYXNlKGMpXSkpOmk9aDtyZXR1cm4gaX19LHJlbW92ZURhdGE6ZnVuY3Rpb24oYSxiLGMpe2lmKCEhZi5hY2NlcHREYXRhKGEpKXt2YXIgZCxlLGcsaD1mLmV4cGFuZG8saT1hLm5vZGVUeXBlLGo9aT9mLmNhY2hlOmEsaz1pP2FbaF06aDtpZighaltrXSlyZXR1cm47aWYoYil7ZD1jP2pba106altrXS5kYXRhO2lmKGQpe2YuaXNBcnJheShiKXx8KGIgaW4gZD9iPVtiXTooYj1mLmNhbWVsQ2FzZShiKSxiIGluIGQ/Yj1bYl06Yj1iLnNwbGl0KFwiIFwiKSkpO2ZvcihlPTAsZz1iLmxlbmd0aDtlPGc7ZSsrKWRlbGV0ZSBkW2JbZV1dO2lmKCEoYz9tOmYuaXNFbXB0eU9iamVjdCkoZCkpcmV0dXJufX1pZighYyl7ZGVsZXRlIGpba10uZGF0YTtpZighbShqW2tdKSlyZXR1cm59Zi5zdXBwb3J0LmRlbGV0ZUV4cGFuZG98fCFqLnNldEludGVydmFsP2RlbGV0ZSBqW2tdOmpba109bnVsbCxpJiYoZi5zdXBwb3J0LmRlbGV0ZUV4cGFuZG8/ZGVsZXRlIGFbaF06YS5yZW1vdmVBdHRyaWJ1dGU/YS5yZW1vdmVBdHRyaWJ1dGUoaCk6YVtoXT1udWxsKX19LF9kYXRhOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5kYXRhKGEsYixjLCEwKX0sYWNjZXB0RGF0YTpmdW5jdGlvbihhKXtpZihhLm5vZGVOYW1lKXt2YXIgYj1mLm5vRGF0YVthLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldO2lmKGIpcmV0dXJuIGIhPT0hMCYmYS5nZXRBdHRyaWJ1dGUoXCJjbGFzc2lkXCIpPT09Yn1yZXR1cm4hMH19KSxmLmZuLmV4dGVuZCh7ZGF0YTpmdW5jdGlvbihhLGMpe3ZhciBkLGUsZyxoPW51bGw7aWYodHlwZW9mIGE9PVwidW5kZWZpbmVkXCIpe2lmKHRoaXMubGVuZ3RoKXtoPWYuZGF0YSh0aGlzWzBdKTtpZih0aGlzWzBdLm5vZGVUeXBlPT09MSYmIWYuX2RhdGEodGhpc1swXSxcInBhcnNlZEF0dHJzXCIpKXtlPXRoaXNbMF0uYXR0cmlidXRlcztmb3IodmFyIGk9MCxqPWUubGVuZ3RoO2k8ajtpKyspZz1lW2ldLm5hbWUsZy5pbmRleE9mKFwiZGF0YS1cIik9PT0wJiYoZz1mLmNhbWVsQ2FzZShnLnN1YnN0cmluZyg1KSksbCh0aGlzWzBdLGcsaFtnXSkpO2YuX2RhdGEodGhpc1swXSxcInBhcnNlZEF0dHJzXCIsITApfX1yZXR1cm4gaH1pZih0eXBlb2YgYT09XCJvYmplY3RcIilyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5kYXRhKHRoaXMsYSl9KTtkPWEuc3BsaXQoXCIuXCIpLGRbMV09ZFsxXT9cIi5cIitkWzFdOlwiXCI7aWYoYz09PWIpe2g9dGhpcy50cmlnZ2VySGFuZGxlcihcImdldERhdGFcIitkWzFdK1wiIVwiLFtkWzBdXSksaD09PWImJnRoaXMubGVuZ3RoJiYoaD1mLmRhdGEodGhpc1swXSxhKSxoPWwodGhpc1swXSxhLGgpKTtyZXR1cm4gaD09PWImJmRbMV0/dGhpcy5kYXRhKGRbMF0pOmh9cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWYodGhpcyksZT1bZFswXSxjXTtiLnRyaWdnZXJIYW5kbGVyKFwic2V0RGF0YVwiK2RbMV0rXCIhXCIsZSksZi5kYXRhKHRoaXMsYSxjKSxiLnRyaWdnZXJIYW5kbGVyKFwiY2hhbmdlRGF0YVwiK2RbMV0rXCIhXCIsZSl9KX0scmVtb3ZlRGF0YTpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5yZW1vdmVEYXRhKHRoaXMsYSl9KX19KSxmLmV4dGVuZCh7X21hcms6ZnVuY3Rpb24oYSxiKXthJiYoYj0oYnx8XCJmeFwiKStcIm1hcmtcIixmLl9kYXRhKGEsYiwoZi5fZGF0YShhLGIpfHwwKSsxKSl9LF91bm1hcms6ZnVuY3Rpb24oYSxiLGMpe2EhPT0hMCYmKGM9YixiPWEsYT0hMSk7aWYoYil7Yz1jfHxcImZ4XCI7dmFyIGQ9YytcIm1hcmtcIixlPWE/MDooZi5fZGF0YShiLGQpfHwxKS0xO2U/Zi5fZGF0YShiLGQsZSk6KGYucmVtb3ZlRGF0YShiLGQsITApLG4oYixjLFwibWFya1wiKSl9fSxxdWV1ZTpmdW5jdGlvbihhLGIsYyl7dmFyIGQ7aWYoYSl7Yj0oYnx8XCJmeFwiKStcInF1ZXVlXCIsZD1mLl9kYXRhKGEsYiksYyYmKCFkfHxmLmlzQXJyYXkoYyk/ZD1mLl9kYXRhKGEsYixmLm1ha2VBcnJheShjKSk6ZC5wdXNoKGMpKTtyZXR1cm4gZHx8W119fSxkZXF1ZXVlOmZ1bmN0aW9uKGEsYil7Yj1ifHxcImZ4XCI7dmFyIGM9Zi5xdWV1ZShhLGIpLGQ9Yy5zaGlmdCgpLGU9e307ZD09PVwiaW5wcm9ncmVzc1wiJiYoZD1jLnNoaWZ0KCkpLGQmJihiPT09XCJmeFwiJiZjLnVuc2hpZnQoXCJpbnByb2dyZXNzXCIpLGYuX2RhdGEoYSxiK1wiLnJ1blwiLGUpLGQuY2FsbChhLGZ1bmN0aW9uKCl7Zi5kZXF1ZXVlKGEsYil9LGUpKSxjLmxlbmd0aHx8KGYucmVtb3ZlRGF0YShhLGIrXCJxdWV1ZSBcIitiK1wiLnJ1blwiLCEwKSxuKGEsYixcInF1ZXVlXCIpKX19KSxmLmZuLmV4dGVuZCh7cXVldWU6ZnVuY3Rpb24oYSxjKXt0eXBlb2YgYSE9XCJzdHJpbmdcIiYmKGM9YSxhPVwiZnhcIik7aWYoYz09PWIpcmV0dXJuIGYucXVldWUodGhpc1swXSxhKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9Zi5xdWV1ZSh0aGlzLGEsYyk7YT09PVwiZnhcIiYmYlswXSE9PVwiaW5wcm9ncmVzc1wiJiZmLmRlcXVldWUodGhpcyxhKX0pfSxkZXF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmRlcXVldWUodGhpcyxhKX0pfSxkZWxheTpmdW5jdGlvbihhLGIpe2E9Zi5meD9mLmZ4LnNwZWVkc1thXXx8YTphLGI9Ynx8XCJmeFwiO3JldHVybiB0aGlzLnF1ZXVlKGIsZnVuY3Rpb24oYixjKXt2YXIgZD1zZXRUaW1lb3V0KGIsYSk7Yy5zdG9wPWZ1bmN0aW9uKCl7Y2xlYXJUaW1lb3V0KGQpfX0pfSxjbGVhclF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGF8fFwiZnhcIixbXSl9LHByb21pc2U6ZnVuY3Rpb24oYSxjKXtmdW5jdGlvbiBtKCl7LS1ofHxkLnJlc29sdmVXaXRoKGUsW2VdKX10eXBlb2YgYSE9XCJzdHJpbmdcIiYmKGM9YSxhPWIpLGE9YXx8XCJmeFwiO3ZhciBkPWYuRGVmZXJyZWQoKSxlPXRoaXMsZz1lLmxlbmd0aCxoPTEsaT1hK1wiZGVmZXJcIixqPWErXCJxdWV1ZVwiLGs9YStcIm1hcmtcIixsO3doaWxlKGctLSlpZihsPWYuZGF0YShlW2ddLGksYiwhMCl8fChmLmRhdGEoZVtnXSxqLGIsITApfHxmLmRhdGEoZVtnXSxrLGIsITApKSYmZi5kYXRhKGVbZ10saSxmLkNhbGxiYWNrcyhcIm9uY2UgbWVtb3J5XCIpLCEwKSloKyssbC5hZGQobSk7bSgpO3JldHVybiBkLnByb21pc2UoKX19KTt2YXIgbz0vW1xcblxcdFxccl0vZyxwPS9cXHMrLyxxPS9cXHIvZyxyPS9eKD86YnV0dG9ufGlucHV0KSQvaSxzPS9eKD86YnV0dG9ufGlucHV0fG9iamVjdHxzZWxlY3R8dGV4dGFyZWEpJC9pLHQ9L15hKD86cmVhKT8kL2ksdT0vXig/OmF1dG9mb2N1c3xhdXRvcGxheXxhc3luY3xjaGVja2VkfGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkfHNlbGVjdGVkKSQvaSx2PWYuc3VwcG9ydC5nZXRTZXRBdHRyaWJ1dGUsdyx4LHk7Zi5mbi5leHRlbmQoe2F0dHI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZi5hY2Nlc3ModGhpcyxhLGIsITAsZi5hdHRyKX0scmVtb3ZlQXR0cjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5yZW1vdmVBdHRyKHRoaXMsYSl9KX0scHJvcDpmdW5jdGlvbihhLGIpe3JldHVybiBmLmFjY2Vzcyh0aGlzLGEsYiwhMCxmLnByb3ApfSxyZW1vdmVQcm9wOmZ1bmN0aW9uKGEpe2E9Zi5wcm9wRml4W2FdfHxhO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt0cnl7dGhpc1thXT1iLGRlbGV0ZSB0aGlzW2FdfWNhdGNoKGMpe319KX0sYWRkQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGUsZyxoLGk7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS5hZGRDbGFzcyhhLmNhbGwodGhpcyxiLHRoaXMuY2xhc3NOYW1lKSl9KTtpZihhJiZ0eXBlb2YgYT09XCJzdHJpbmdcIil7Yj1hLnNwbGl0KHApO2ZvcihjPTAsZD10aGlzLmxlbmd0aDtjPGQ7YysrKXtlPXRoaXNbY107aWYoZS5ub2RlVHlwZT09PTEpaWYoIWUuY2xhc3NOYW1lJiZiLmxlbmd0aD09PTEpZS5jbGFzc05hbWU9YTtlbHNle2c9XCIgXCIrZS5jbGFzc05hbWUrXCIgXCI7Zm9yKGg9MCxpPWIubGVuZ3RoO2g8aTtoKyspfmcuaW5kZXhPZihcIiBcIitiW2hdK1wiIFwiKXx8KGcrPWJbaF0rXCIgXCIpO2UuY2xhc3NOYW1lPWYudHJpbShnKX19fXJldHVybiB0aGlzfSxyZW1vdmVDbGFzczpmdW5jdGlvbihhKXt2YXIgYyxkLGUsZyxoLGksajtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLnJlbW92ZUNsYXNzKGEuY2FsbCh0aGlzLGIsdGhpcy5jbGFzc05hbWUpKX0pO2lmKGEmJnR5cGVvZiBhPT1cInN0cmluZ1wifHxhPT09Yil7Yz0oYXx8XCJcIikuc3BsaXQocCk7Zm9yKGQ9MCxlPXRoaXMubGVuZ3RoO2Q8ZTtkKyspe2c9dGhpc1tkXTtpZihnLm5vZGVUeXBlPT09MSYmZy5jbGFzc05hbWUpaWYoYSl7aD0oXCIgXCIrZy5jbGFzc05hbWUrXCIgXCIpLnJlcGxhY2UobyxcIiBcIik7Zm9yKGk9MCxqPWMubGVuZ3RoO2k8ajtpKyspaD1oLnJlcGxhY2UoXCIgXCIrY1tpXStcIiBcIixcIiBcIik7Zy5jbGFzc05hbWU9Zi50cmltKGgpfWVsc2UgZy5jbGFzc05hbWU9XCJcIn19cmV0dXJuIHRoaXN9LHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGEsZD10eXBlb2YgYj09XCJib29sZWFuXCI7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYyl7Zih0aGlzKS50b2dnbGVDbGFzcyhhLmNhbGwodGhpcyxjLHRoaXMuY2xhc3NOYW1lLGIpLGIpfSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2lmKGM9PT1cInN0cmluZ1wiKXt2YXIgZSxnPTAsaD1mKHRoaXMpLGk9YixqPWEuc3BsaXQocCk7d2hpbGUoZT1qW2crK10paT1kP2k6IWguaGFzQ2xhc3MoZSksaFtpP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKGUpfWVsc2UgaWYoYz09PVwidW5kZWZpbmVkXCJ8fGM9PT1cImJvb2xlYW5cIil0aGlzLmNsYXNzTmFtZSYmZi5fZGF0YSh0aGlzLFwiX19jbGFzc05hbWVfX1wiLHRoaXMuY2xhc3NOYW1lKSx0aGlzLmNsYXNzTmFtZT10aGlzLmNsYXNzTmFtZXx8YT09PSExP1wiXCI6Zi5fZGF0YSh0aGlzLFwiX19jbGFzc05hbWVfX1wiKXx8XCJcIn0pfSxoYXNDbGFzczpmdW5jdGlvbihhKXt2YXIgYj1cIiBcIithK1wiIFwiLGM9MCxkPXRoaXMubGVuZ3RoO2Zvcig7YzxkO2MrKylpZih0aGlzW2NdLm5vZGVUeXBlPT09MSYmKFwiIFwiK3RoaXNbY10uY2xhc3NOYW1lK1wiIFwiKS5yZXBsYWNlKG8sXCIgXCIpLmluZGV4T2YoYik+LTEpcmV0dXJuITA7cmV0dXJuITF9LHZhbDpmdW5jdGlvbihhKXt2YXIgYyxkLGUsZz10aGlzWzBdO3tpZighIWFyZ3VtZW50cy5sZW5ndGgpe2U9Zi5pc0Z1bmN0aW9uKGEpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZCl7dmFyIGc9Zih0aGlzKSxoO2lmKHRoaXMubm9kZVR5cGU9PT0xKXtlP2g9YS5jYWxsKHRoaXMsZCxnLnZhbCgpKTpoPWEsaD09bnVsbD9oPVwiXCI6dHlwZW9mIGg9PVwibnVtYmVyXCI/aCs9XCJcIjpmLmlzQXJyYXkoaCkmJihoPWYubWFwKGgsZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/XCJcIjphK1wiXCJ9KSksYz1mLnZhbEhvb2tzW3RoaXMubm9kZU5hbWUudG9Mb3dlckNhc2UoKV18fGYudmFsSG9va3NbdGhpcy50eXBlXTtpZighY3x8IShcInNldFwiaW4gYyl8fGMuc2V0KHRoaXMsaCxcInZhbHVlXCIpPT09Yil0aGlzLnZhbHVlPWh9fSl9aWYoZyl7Yz1mLnZhbEhvb2tzW2cubm9kZU5hbWUudG9Mb3dlckNhc2UoKV18fGYudmFsSG9va3NbZy50eXBlXTtpZihjJiZcImdldFwiaW4gYyYmKGQ9Yy5nZXQoZyxcInZhbHVlXCIpKSE9PWIpcmV0dXJuIGQ7ZD1nLnZhbHVlO3JldHVybiB0eXBlb2YgZD09XCJzdHJpbmdcIj9kLnJlcGxhY2UocSxcIlwiKTpkPT1udWxsP1wiXCI6ZH19fX0pLGYuZXh0ZW5kKHt2YWxIb29rczp7b3B0aW9uOntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5hdHRyaWJ1dGVzLnZhbHVlO3JldHVybiFifHxiLnNwZWNpZmllZD9hLnZhbHVlOmEudGV4dH19LHNlbGVjdDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiLGMsZCxlLGc9YS5zZWxlY3RlZEluZGV4LGg9W10saT1hLm9wdGlvbnMsaj1hLnR5cGU9PT1cInNlbGVjdC1vbmVcIjtpZihnPDApcmV0dXJuIG51bGw7Yz1qP2c6MCxkPWo/ZysxOmkubGVuZ3RoO2Zvcig7YzxkO2MrKyl7ZT1pW2NdO2lmKGUuc2VsZWN0ZWQmJihmLnN1cHBvcnQub3B0RGlzYWJsZWQ/IWUuZGlzYWJsZWQ6ZS5nZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKT09PW51bGwpJiYoIWUucGFyZW50Tm9kZS5kaXNhYmxlZHx8IWYubm9kZU5hbWUoZS5wYXJlbnROb2RlLFwib3B0Z3JvdXBcIikpKXtiPWYoZSkudmFsKCk7aWYoailyZXR1cm4gYjtoLnB1c2goYil9fWlmKGomJiFoLmxlbmd0aCYmaS5sZW5ndGgpcmV0dXJuIGYoaVtnXSkudmFsKCk7cmV0dXJuIGh9LHNldDpmdW5jdGlvbihhLGIpe3ZhciBjPWYubWFrZUFycmF5KGIpO2YoYSkuZmluZChcIm9wdGlvblwiKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5zZWxlY3RlZD1mLmluQXJyYXkoZih0aGlzKS52YWwoKSxjKT49MH0pLGMubGVuZ3RofHwoYS5zZWxlY3RlZEluZGV4PS0xKTtyZXR1cm4gY319fSxhdHRyRm46e3ZhbDohMCxjc3M6ITAsaHRtbDohMCx0ZXh0OiEwLGRhdGE6ITAsd2lkdGg6ITAsaGVpZ2h0OiEwLG9mZnNldDohMH0sYXR0cjpmdW5jdGlvbihhLGMsZCxlKXt2YXIgZyxoLGksaj1hLm5vZGVUeXBlO2lmKCEhYSYmaiE9PTMmJmohPT04JiZqIT09Mil7aWYoZSYmYyBpbiBmLmF0dHJGbilyZXR1cm4gZihhKVtjXShkKTtpZih0eXBlb2YgYS5nZXRBdHRyaWJ1dGU9PVwidW5kZWZpbmVkXCIpcmV0dXJuIGYucHJvcChhLGMsZCk7aT1qIT09MXx8IWYuaXNYTUxEb2MoYSksaSYmKGM9Yy50b0xvd2VyQ2FzZSgpLGg9Zi5hdHRySG9va3NbY118fCh1LnRlc3QoYyk/eDp3KSk7aWYoZCE9PWIpe2lmKGQ9PT1udWxsKXtmLnJlbW92ZUF0dHIoYSxjKTtyZXR1cm59aWYoaCYmXCJzZXRcImluIGgmJmkmJihnPWguc2V0KGEsZCxjKSkhPT1iKXJldHVybiBnO2Euc2V0QXR0cmlidXRlKGMsXCJcIitkKTtyZXR1cm4gZH1pZihoJiZcImdldFwiaW4gaCYmaSYmKGc9aC5nZXQoYSxjKSkhPT1udWxsKXJldHVybiBnO2c9YS5nZXRBdHRyaWJ1dGUoYyk7cmV0dXJuIGc9PT1udWxsP2I6Z319LHJlbW92ZUF0dHI6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZyxoPTA7aWYoYiYmYS5ub2RlVHlwZT09PTEpe2Q9Yi50b0xvd2VyQ2FzZSgpLnNwbGl0KHApLGc9ZC5sZW5ndGg7Zm9yKDtoPGc7aCsrKWU9ZFtoXSxlJiYoYz1mLnByb3BGaXhbZV18fGUsZi5hdHRyKGEsZSxcIlwiKSxhLnJlbW92ZUF0dHJpYnV0ZSh2P2U6YyksdS50ZXN0KGUpJiZjIGluIGEmJihhW2NdPSExKSl9fSxhdHRySG9va3M6e3R5cGU6e3NldDpmdW5jdGlvbihhLGIpe2lmKHIudGVzdChhLm5vZGVOYW1lKSYmYS5wYXJlbnROb2RlKWYuZXJyb3IoXCJ0eXBlIHByb3BlcnR5IGNhbid0IGJlIGNoYW5nZWRcIik7ZWxzZSBpZighZi5zdXBwb3J0LnJhZGlvVmFsdWUmJmI9PT1cInJhZGlvXCImJmYubm9kZU5hbWUoYSxcImlucHV0XCIpKXt2YXIgYz1hLnZhbHVlO2Euc2V0QXR0cmlidXRlKFwidHlwZVwiLGIpLGMmJihhLnZhbHVlPWMpO3JldHVybiBifX19LHZhbHVlOntnZXQ6ZnVuY3Rpb24oYSxiKXtpZih3JiZmLm5vZGVOYW1lKGEsXCJidXR0b25cIikpcmV0dXJuIHcuZ2V0KGEsYik7cmV0dXJuIGIgaW4gYT9hLnZhbHVlOm51bGx9LHNldDpmdW5jdGlvbihhLGIsYyl7aWYodyYmZi5ub2RlTmFtZShhLFwiYnV0dG9uXCIpKXJldHVybiB3LnNldChhLGIsYyk7YS52YWx1ZT1ifX19LHByb3BGaXg6e3RhYmluZGV4OlwidGFiSW5kZXhcIixyZWFkb25seTpcInJlYWRPbmx5XCIsXCJmb3JcIjpcImh0bWxGb3JcIixcImNsYXNzXCI6XCJjbGFzc05hbWVcIixtYXhsZW5ndGg6XCJtYXhMZW5ndGhcIixjZWxsc3BhY2luZzpcImNlbGxTcGFjaW5nXCIsY2VsbHBhZGRpbmc6XCJjZWxsUGFkZGluZ1wiLHJvd3NwYW46XCJyb3dTcGFuXCIsY29sc3BhbjpcImNvbFNwYW5cIix1c2VtYXA6XCJ1c2VNYXBcIixmcmFtZWJvcmRlcjpcImZyYW1lQm9yZGVyXCIsY29udGVudGVkaXRhYmxlOlwiY29udGVudEVkaXRhYmxlXCJ9LHByb3A6ZnVuY3Rpb24oYSxjLGQpe3ZhciBlLGcsaCxpPWEubm9kZVR5cGU7aWYoISFhJiZpIT09MyYmaSE9PTgmJmkhPT0yKXtoPWkhPT0xfHwhZi5pc1hNTERvYyhhKSxoJiYoYz1mLnByb3BGaXhbY118fGMsZz1mLnByb3BIb29rc1tjXSk7cmV0dXJuIGQhPT1iP2cmJlwic2V0XCJpbiBnJiYoZT1nLnNldChhLGQsYykpIT09Yj9lOmFbY109ZDpnJiZcImdldFwiaW4gZyYmKGU9Zy5nZXQoYSxjKSkhPT1udWxsP2U6YVtjXX19LHByb3BIb29rczp7dGFiSW5kZXg6e2dldDpmdW5jdGlvbihhKXt2YXIgYz1hLmdldEF0dHJpYnV0ZU5vZGUoXCJ0YWJpbmRleFwiKTtyZXR1cm4gYyYmYy5zcGVjaWZpZWQ/cGFyc2VJbnQoYy52YWx1ZSwxMCk6cy50ZXN0KGEubm9kZU5hbWUpfHx0LnRlc3QoYS5ub2RlTmFtZSkmJmEuaHJlZj8wOmJ9fX19KSxmLmF0dHJIb29rcy50YWJpbmRleD1mLnByb3BIb29rcy50YWJJbmRleCx4PXtnZXQ6ZnVuY3Rpb24oYSxjKXt2YXIgZCxlPWYucHJvcChhLGMpO3JldHVybiBlPT09ITB8fHR5cGVvZiBlIT1cImJvb2xlYW5cIiYmKGQ9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpKSYmZC5ub2RlVmFsdWUhPT0hMT9jLnRvTG93ZXJDYXNlKCk6Yn0sc2V0OmZ1bmN0aW9uKGEsYixjKXt2YXIgZDtiPT09ITE/Zi5yZW1vdmVBdHRyKGEsYyk6KGQ9Zi5wcm9wRml4W2NdfHxjLGQgaW4gYSYmKGFbZF09ITApLGEuc2V0QXR0cmlidXRlKGMsYy50b0xvd2VyQ2FzZSgpKSk7cmV0dXJuIGN9fSx2fHwoeT17bmFtZTohMCxpZDohMH0sdz1mLnZhbEhvb2tzLmJ1dHRvbj17Z2V0OmZ1bmN0aW9uKGEsYyl7dmFyIGQ7ZD1hLmdldEF0dHJpYnV0ZU5vZGUoYyk7cmV0dXJuIGQmJih5W2NdP2Qubm9kZVZhbHVlIT09XCJcIjpkLnNwZWNpZmllZCk/ZC5ub2RlVmFsdWU6Yn0sc2V0OmZ1bmN0aW9uKGEsYixkKXt2YXIgZT1hLmdldEF0dHJpYnV0ZU5vZGUoZCk7ZXx8KGU9Yy5jcmVhdGVBdHRyaWJ1dGUoZCksYS5zZXRBdHRyaWJ1dGVOb2RlKGUpKTtyZXR1cm4gZS5ub2RlVmFsdWU9YitcIlwifX0sZi5hdHRySG9va3MudGFiaW5kZXguc2V0PXcuc2V0LGYuZWFjaChbXCJ3aWR0aFwiLFwiaGVpZ2h0XCJdLGZ1bmN0aW9uKGEsYil7Zi5hdHRySG9va3NbYl09Zi5leHRlbmQoZi5hdHRySG9va3NbYl0se3NldDpmdW5jdGlvbihhLGMpe2lmKGM9PT1cIlwiKXthLnNldEF0dHJpYnV0ZShiLFwiYXV0b1wiKTtyZXR1cm4gY319fSl9KSxmLmF0dHJIb29rcy5jb250ZW50ZWRpdGFibGU9e2dldDp3LmdldCxzZXQ6ZnVuY3Rpb24oYSxiLGMpe2I9PT1cIlwiJiYoYj1cImZhbHNlXCIpLHcuc2V0KGEsYixjKX19KSxmLnN1cHBvcnQuaHJlZk5vcm1hbGl6ZWR8fGYuZWFjaChbXCJocmVmXCIsXCJzcmNcIixcIndpZHRoXCIsXCJoZWlnaHRcIl0sZnVuY3Rpb24oYSxjKXtmLmF0dHJIb29rc1tjXT1mLmV4dGVuZChmLmF0dHJIb29rc1tjXSx7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBkPWEuZ2V0QXR0cmlidXRlKGMsMik7cmV0dXJuIGQ9PT1udWxsP2I6ZH19KX0pLGYuc3VwcG9ydC5zdHlsZXx8KGYuYXR0ckhvb2tzLnN0eWxlPXtnZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuc3R5bGUuY3NzVGV4dC50b0xvd2VyQ2FzZSgpfHxifSxzZXQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5zdHlsZS5jc3NUZXh0PVwiXCIrYn19KSxmLnN1cHBvcnQub3B0U2VsZWN0ZWR8fChmLnByb3BIb29rcy5zZWxlY3RlZD1mLmV4dGVuZChmLnByb3BIb29rcy5zZWxlY3RlZCx7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiPWEucGFyZW50Tm9kZTtiJiYoYi5zZWxlY3RlZEluZGV4LGIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgpO3JldHVybiBudWxsfX0pKSxmLnN1cHBvcnQuZW5jdHlwZXx8KGYucHJvcEZpeC5lbmN0eXBlPVwiZW5jb2RpbmdcIiksZi5zdXBwb3J0LmNoZWNrT258fGYuZWFjaChbXCJyYWRpb1wiLFwiY2hlY2tib3hcIl0sZnVuY3Rpb24oKXtmLnZhbEhvb2tzW3RoaXNdPXtnZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZ2V0QXR0cmlidXRlKFwidmFsdWVcIik9PT1udWxsP1wib25cIjphLnZhbHVlfX19KSxmLmVhY2goW1wicmFkaW9cIixcImNoZWNrYm94XCJdLGZ1bmN0aW9uKCl7Zi52YWxIb29rc1t0aGlzXT1mLmV4dGVuZChmLnZhbEhvb2tzW3RoaXNdLHtzZXQ6ZnVuY3Rpb24oYSxiKXtpZihmLmlzQXJyYXkoYikpcmV0dXJuIGEuY2hlY2tlZD1mLmluQXJyYXkoZihhKS52YWwoKSxiKT49MH19KX0pO3ZhciB6PS9eKD86dGV4dGFyZWF8aW5wdXR8c2VsZWN0KSQvaSxBPS9eKFteXFwuXSopPyg/OlxcLiguKykpPyQvLEI9L1xcYmhvdmVyKFxcLlxcUyspP1xcYi8sQz0vXmtleS8sRD0vXig/Om1vdXNlfGNvbnRleHRtZW51KXxjbGljay8sRT0vXig/OmZvY3VzaW5mb2N1c3xmb2N1c291dGJsdXIpJC8sRj0vXihcXHcqKSg/OiMoW1xcd1xcLV0rKSk/KD86XFwuKFtcXHdcXC1dKykpPyQvLEc9ZnVuY3Rpb24oYSl7dmFyIGI9Ri5leGVjKGEpO2ImJihiWzFdPShiWzFdfHxcIlwiKS50b0xvd2VyQ2FzZSgpLGJbM109YlszXSYmbmV3IFJlZ0V4cChcIig/Ol58XFxcXHMpXCIrYlszXStcIig/OlxcXFxzfCQpXCIpKTtyZXR1cm4gYn0sSD1mdW5jdGlvbihhLGIpe3ZhciBjPWEuYXR0cmlidXRlc3x8e307cmV0dXJuKCFiWzFdfHxhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iWzFdKSYmKCFiWzJdfHwoYy5pZHx8e30pLnZhbHVlPT09YlsyXSkmJighYlszXXx8YlszXS50ZXN0KChjW1wiY2xhc3NcIl18fHt9KS52YWx1ZSkpfSxJPWZ1bmN0aW9uKGEpe3JldHVybiBmLmV2ZW50LnNwZWNpYWwuaG92ZXI/YTphLnJlcGxhY2UoQixcIm1vdXNlZW50ZXIkMSBtb3VzZWxlYXZlJDFcIil9O1xuZi5ldmVudD17YWRkOmZ1bmN0aW9uKGEsYyxkLGUsZyl7dmFyIGgsaSxqLGssbCxtLG4sbyxwLHEscixzO2lmKCEoYS5ub2RlVHlwZT09PTN8fGEubm9kZVR5cGU9PT04fHwhY3x8IWR8fCEoaD1mLl9kYXRhKGEpKSkpe2QuaGFuZGxlciYmKHA9ZCxkPXAuaGFuZGxlciksZC5ndWlkfHwoZC5ndWlkPWYuZ3VpZCsrKSxqPWguZXZlbnRzLGp8fChoLmV2ZW50cz1qPXt9KSxpPWguaGFuZGxlLGl8fChoLmhhbmRsZT1pPWZ1bmN0aW9uKGEpe3JldHVybiB0eXBlb2YgZiE9XCJ1bmRlZmluZWRcIiYmKCFhfHxmLmV2ZW50LnRyaWdnZXJlZCE9PWEudHlwZSk/Zi5ldmVudC5kaXNwYXRjaC5hcHBseShpLmVsZW0sYXJndW1lbnRzKTpifSxpLmVsZW09YSksYz1mLnRyaW0oSShjKSkuc3BsaXQoXCIgXCIpO2ZvcihrPTA7azxjLmxlbmd0aDtrKyspe2w9QS5leGVjKGNba10pfHxbXSxtPWxbMV0sbj0obFsyXXx8XCJcIikuc3BsaXQoXCIuXCIpLnNvcnQoKSxzPWYuZXZlbnQuc3BlY2lhbFttXXx8e30sbT0oZz9zLmRlbGVnYXRlVHlwZTpzLmJpbmRUeXBlKXx8bSxzPWYuZXZlbnQuc3BlY2lhbFttXXx8e30sbz1mLmV4dGVuZCh7dHlwZTptLG9yaWdUeXBlOmxbMV0sZGF0YTplLGhhbmRsZXI6ZCxndWlkOmQuZ3VpZCxzZWxlY3RvcjpnLHF1aWNrOkcoZyksbmFtZXNwYWNlOm4uam9pbihcIi5cIil9LHApLHI9alttXTtpZighcil7cj1qW21dPVtdLHIuZGVsZWdhdGVDb3VudD0wO2lmKCFzLnNldHVwfHxzLnNldHVwLmNhbGwoYSxlLG4saSk9PT0hMSlhLmFkZEV2ZW50TGlzdGVuZXI/YS5hZGRFdmVudExpc3RlbmVyKG0saSwhMSk6YS5hdHRhY2hFdmVudCYmYS5hdHRhY2hFdmVudChcIm9uXCIrbSxpKX1zLmFkZCYmKHMuYWRkLmNhbGwoYSxvKSxvLmhhbmRsZXIuZ3VpZHx8KG8uaGFuZGxlci5ndWlkPWQuZ3VpZCkpLGc/ci5zcGxpY2Uoci5kZWxlZ2F0ZUNvdW50KyssMCxvKTpyLnB1c2gobyksZi5ldmVudC5nbG9iYWxbbV09ITB9YT1udWxsfX0sZ2xvYmFsOnt9LHJlbW92ZTpmdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBnPWYuaGFzRGF0YShhKSYmZi5fZGF0YShhKSxoLGksaixrLGwsbSxuLG8scCxxLHIscztpZighIWcmJiEhKG89Zy5ldmVudHMpKXtiPWYudHJpbShJKGJ8fFwiXCIpKS5zcGxpdChcIiBcIik7Zm9yKGg9MDtoPGIubGVuZ3RoO2grKyl7aT1BLmV4ZWMoYltoXSl8fFtdLGo9az1pWzFdLGw9aVsyXTtpZighail7Zm9yKGogaW4gbylmLmV2ZW50LnJlbW92ZShhLGorYltoXSxjLGQsITApO2NvbnRpbnVlfXA9Zi5ldmVudC5zcGVjaWFsW2pdfHx7fSxqPShkP3AuZGVsZWdhdGVUeXBlOnAuYmluZFR5cGUpfHxqLHI9b1tqXXx8W10sbT1yLmxlbmd0aCxsPWw/bmV3IFJlZ0V4cChcIihefFxcXFwuKVwiK2wuc3BsaXQoXCIuXCIpLnNvcnQoKS5qb2luKFwiXFxcXC4oPzouKlxcXFwuKT9cIikrXCIoXFxcXC58JClcIik6bnVsbDtmb3Iobj0wO248ci5sZW5ndGg7bisrKXM9cltuXSwoZXx8az09PXMub3JpZ1R5cGUpJiYoIWN8fGMuZ3VpZD09PXMuZ3VpZCkmJighbHx8bC50ZXN0KHMubmFtZXNwYWNlKSkmJighZHx8ZD09PXMuc2VsZWN0b3J8fGQ9PT1cIioqXCImJnMuc2VsZWN0b3IpJiYoci5zcGxpY2Uobi0tLDEpLHMuc2VsZWN0b3ImJnIuZGVsZWdhdGVDb3VudC0tLHAucmVtb3ZlJiZwLnJlbW92ZS5jYWxsKGEscykpO3IubGVuZ3RoPT09MCYmbSE9PXIubGVuZ3RoJiYoKCFwLnRlYXJkb3dufHxwLnRlYXJkb3duLmNhbGwoYSxsKT09PSExKSYmZi5yZW1vdmVFdmVudChhLGosZy5oYW5kbGUpLGRlbGV0ZSBvW2pdKX1mLmlzRW1wdHlPYmplY3QobykmJihxPWcuaGFuZGxlLHEmJihxLmVsZW09bnVsbCksZi5yZW1vdmVEYXRhKGEsW1wiZXZlbnRzXCIsXCJoYW5kbGVcIl0sITApKX19LGN1c3RvbUV2ZW50OntnZXREYXRhOiEwLHNldERhdGE6ITAsY2hhbmdlRGF0YTohMH0sdHJpZ2dlcjpmdW5jdGlvbihjLGQsZSxnKXtpZighZXx8ZS5ub2RlVHlwZSE9PTMmJmUubm9kZVR5cGUhPT04KXt2YXIgaD1jLnR5cGV8fGMsaT1bXSxqLGssbCxtLG4sbyxwLHEscixzO2lmKEUudGVzdChoK2YuZXZlbnQudHJpZ2dlcmVkKSlyZXR1cm47aC5pbmRleE9mKFwiIVwiKT49MCYmKGg9aC5zbGljZSgwLC0xKSxrPSEwKSxoLmluZGV4T2YoXCIuXCIpPj0wJiYoaT1oLnNwbGl0KFwiLlwiKSxoPWkuc2hpZnQoKSxpLnNvcnQoKSk7aWYoKCFlfHxmLmV2ZW50LmN1c3RvbUV2ZW50W2hdKSYmIWYuZXZlbnQuZ2xvYmFsW2hdKXJldHVybjtjPXR5cGVvZiBjPT1cIm9iamVjdFwiP2NbZi5leHBhbmRvXT9jOm5ldyBmLkV2ZW50KGgsYyk6bmV3IGYuRXZlbnQoaCksYy50eXBlPWgsYy5pc1RyaWdnZXI9ITAsYy5leGNsdXNpdmU9ayxjLm5hbWVzcGFjZT1pLmpvaW4oXCIuXCIpLGMubmFtZXNwYWNlX3JlPWMubmFtZXNwYWNlP25ldyBSZWdFeHAoXCIoXnxcXFxcLilcIitpLmpvaW4oXCJcXFxcLig/Oi4qXFxcXC4pP1wiKStcIihcXFxcLnwkKVwiKTpudWxsLG89aC5pbmRleE9mKFwiOlwiKTwwP1wib25cIitoOlwiXCI7aWYoIWUpe2o9Zi5jYWNoZTtmb3IobCBpbiBqKWpbbF0uZXZlbnRzJiZqW2xdLmV2ZW50c1toXSYmZi5ldmVudC50cmlnZ2VyKGMsZCxqW2xdLmhhbmRsZS5lbGVtLCEwKTtyZXR1cm59Yy5yZXN1bHQ9YixjLnRhcmdldHx8KGMudGFyZ2V0PWUpLGQ9ZCE9bnVsbD9mLm1ha2VBcnJheShkKTpbXSxkLnVuc2hpZnQoYykscD1mLmV2ZW50LnNwZWNpYWxbaF18fHt9O2lmKHAudHJpZ2dlciYmcC50cmlnZ2VyLmFwcGx5KGUsZCk9PT0hMSlyZXR1cm47cj1bW2UscC5iaW5kVHlwZXx8aF1dO2lmKCFnJiYhcC5ub0J1YmJsZSYmIWYuaXNXaW5kb3coZSkpe3M9cC5kZWxlZ2F0ZVR5cGV8fGgsbT1FLnRlc3QocytoKT9lOmUucGFyZW50Tm9kZSxuPW51bGw7Zm9yKDttO209bS5wYXJlbnROb2RlKXIucHVzaChbbSxzXSksbj1tO24mJm49PT1lLm93bmVyRG9jdW1lbnQmJnIucHVzaChbbi5kZWZhdWx0Vmlld3x8bi5wYXJlbnRXaW5kb3d8fGEsc10pfWZvcihsPTA7bDxyLmxlbmd0aCYmIWMuaXNQcm9wYWdhdGlvblN0b3BwZWQoKTtsKyspbT1yW2xdWzBdLGMudHlwZT1yW2xdWzFdLHE9KGYuX2RhdGEobSxcImV2ZW50c1wiKXx8e30pW2MudHlwZV0mJmYuX2RhdGEobSxcImhhbmRsZVwiKSxxJiZxLmFwcGx5KG0sZCkscT1vJiZtW29dLHEmJmYuYWNjZXB0RGF0YShtKSYmcS5hcHBseShtLGQpPT09ITEmJmMucHJldmVudERlZmF1bHQoKTtjLnR5cGU9aCwhZyYmIWMuaXNEZWZhdWx0UHJldmVudGVkKCkmJighcC5fZGVmYXVsdHx8cC5fZGVmYXVsdC5hcHBseShlLm93bmVyRG9jdW1lbnQsZCk9PT0hMSkmJihoIT09XCJjbGlja1wifHwhZi5ub2RlTmFtZShlLFwiYVwiKSkmJmYuYWNjZXB0RGF0YShlKSYmbyYmZVtoXSYmKGghPT1cImZvY3VzXCImJmghPT1cImJsdXJcInx8Yy50YXJnZXQub2Zmc2V0V2lkdGghPT0wKSYmIWYuaXNXaW5kb3coZSkmJihuPWVbb10sbiYmKGVbb109bnVsbCksZi5ldmVudC50cmlnZ2VyZWQ9aCxlW2hdKCksZi5ldmVudC50cmlnZ2VyZWQ9YixuJiYoZVtvXT1uKSk7cmV0dXJuIGMucmVzdWx0fX0sZGlzcGF0Y2g6ZnVuY3Rpb24oYyl7Yz1mLmV2ZW50LmZpeChjfHxhLmV2ZW50KTt2YXIgZD0oZi5fZGF0YSh0aGlzLFwiZXZlbnRzXCIpfHx7fSlbYy50eXBlXXx8W10sZT1kLmRlbGVnYXRlQ291bnQsZz1bXS5zbGljZS5jYWxsKGFyZ3VtZW50cywwKSxoPSFjLmV4Y2x1c2l2ZSYmIWMubmFtZXNwYWNlLGk9W10saixrLGwsbSxuLG8scCxxLHIscyx0O2dbMF09YyxjLmRlbGVnYXRlVGFyZ2V0PXRoaXM7aWYoZSYmIWMudGFyZ2V0LmRpc2FibGVkJiYoIWMuYnV0dG9ufHxjLnR5cGUhPT1cImNsaWNrXCIpKXttPWYodGhpcyksbS5jb250ZXh0PXRoaXMub3duZXJEb2N1bWVudHx8dGhpcztmb3IobD1jLnRhcmdldDtsIT10aGlzO2w9bC5wYXJlbnROb2RlfHx0aGlzKXtvPXt9LHE9W10sbVswXT1sO2ZvcihqPTA7ajxlO2orKylyPWRbal0scz1yLnNlbGVjdG9yLG9bc109PT1iJiYob1tzXT1yLnF1aWNrP0gobCxyLnF1aWNrKTptLmlzKHMpKSxvW3NdJiZxLnB1c2gocik7cS5sZW5ndGgmJmkucHVzaCh7ZWxlbTpsLG1hdGNoZXM6cX0pfX1kLmxlbmd0aD5lJiZpLnB1c2goe2VsZW06dGhpcyxtYXRjaGVzOmQuc2xpY2UoZSl9KTtmb3Ioaj0wO2o8aS5sZW5ndGgmJiFjLmlzUHJvcGFnYXRpb25TdG9wcGVkKCk7aisrKXtwPWlbal0sYy5jdXJyZW50VGFyZ2V0PXAuZWxlbTtmb3Ioaz0wO2s8cC5tYXRjaGVzLmxlbmd0aCYmIWMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKTtrKyspe3I9cC5tYXRjaGVzW2tdO2lmKGh8fCFjLm5hbWVzcGFjZSYmIXIubmFtZXNwYWNlfHxjLm5hbWVzcGFjZV9yZSYmYy5uYW1lc3BhY2VfcmUudGVzdChyLm5hbWVzcGFjZSkpYy5kYXRhPXIuZGF0YSxjLmhhbmRsZU9iaj1yLG49KChmLmV2ZW50LnNwZWNpYWxbci5vcmlnVHlwZV18fHt9KS5oYW5kbGV8fHIuaGFuZGxlcikuYXBwbHkocC5lbGVtLGcpLG4hPT1iJiYoYy5yZXN1bHQ9bixuPT09ITEmJihjLnByZXZlbnREZWZhdWx0KCksYy5zdG9wUHJvcGFnYXRpb24oKSkpfX1yZXR1cm4gYy5yZXN1bHR9LHByb3BzOlwiYXR0ckNoYW5nZSBhdHRyTmFtZSByZWxhdGVkTm9kZSBzcmNFbGVtZW50IGFsdEtleSBidWJibGVzIGNhbmNlbGFibGUgY3RybEtleSBjdXJyZW50VGFyZ2V0IGV2ZW50UGhhc2UgbWV0YUtleSByZWxhdGVkVGFyZ2V0IHNoaWZ0S2V5IHRhcmdldCB0aW1lU3RhbXAgdmlldyB3aGljaFwiLnNwbGl0KFwiIFwiKSxmaXhIb29rczp7fSxrZXlIb29rczp7cHJvcHM6XCJjaGFyIGNoYXJDb2RlIGtleSBrZXlDb2RlXCIuc3BsaXQoXCIgXCIpLGZpbHRlcjpmdW5jdGlvbihhLGIpe2Eud2hpY2g9PW51bGwmJihhLndoaWNoPWIuY2hhckNvZGUhPW51bGw/Yi5jaGFyQ29kZTpiLmtleUNvZGUpO3JldHVybiBhfX0sbW91c2VIb29rczp7cHJvcHM6XCJidXR0b24gYnV0dG9ucyBjbGllbnRYIGNsaWVudFkgZnJvbUVsZW1lbnQgb2Zmc2V0WCBvZmZzZXRZIHBhZ2VYIHBhZ2VZIHNjcmVlblggc2NyZWVuWSB0b0VsZW1lbnRcIi5zcGxpdChcIiBcIiksZmlsdGVyOmZ1bmN0aW9uKGEsZCl7dmFyIGUsZixnLGg9ZC5idXR0b24saT1kLmZyb21FbGVtZW50O2EucGFnZVg9PW51bGwmJmQuY2xpZW50WCE9bnVsbCYmKGU9YS50YXJnZXQub3duZXJEb2N1bWVudHx8YyxmPWUuZG9jdW1lbnRFbGVtZW50LGc9ZS5ib2R5LGEucGFnZVg9ZC5jbGllbnRYKyhmJiZmLnNjcm9sbExlZnR8fGcmJmcuc2Nyb2xsTGVmdHx8MCktKGYmJmYuY2xpZW50TGVmdHx8ZyYmZy5jbGllbnRMZWZ0fHwwKSxhLnBhZ2VZPWQuY2xpZW50WSsoZiYmZi5zY3JvbGxUb3B8fGcmJmcuc2Nyb2xsVG9wfHwwKS0oZiYmZi5jbGllbnRUb3B8fGcmJmcuY2xpZW50VG9wfHwwKSksIWEucmVsYXRlZFRhcmdldCYmaSYmKGEucmVsYXRlZFRhcmdldD1pPT09YS50YXJnZXQ/ZC50b0VsZW1lbnQ6aSksIWEud2hpY2gmJmghPT1iJiYoYS53aGljaD1oJjE/MTpoJjI/MzpoJjQ/MjowKTtyZXR1cm4gYX19LGZpeDpmdW5jdGlvbihhKXtpZihhW2YuZXhwYW5kb10pcmV0dXJuIGE7dmFyIGQsZSxnPWEsaD1mLmV2ZW50LmZpeEhvb2tzW2EudHlwZV18fHt9LGk9aC5wcm9wcz90aGlzLnByb3BzLmNvbmNhdChoLnByb3BzKTp0aGlzLnByb3BzO2E9Zi5FdmVudChnKTtmb3IoZD1pLmxlbmd0aDtkOyllPWlbLS1kXSxhW2VdPWdbZV07YS50YXJnZXR8fChhLnRhcmdldD1nLnNyY0VsZW1lbnR8fGMpLGEudGFyZ2V0Lm5vZGVUeXBlPT09MyYmKGEudGFyZ2V0PWEudGFyZ2V0LnBhcmVudE5vZGUpLGEubWV0YUtleT09PWImJihhLm1ldGFLZXk9YS5jdHJsS2V5KTtyZXR1cm4gaC5maWx0ZXI/aC5maWx0ZXIoYSxnKTphfSxzcGVjaWFsOntyZWFkeTp7c2V0dXA6Zi5iaW5kUmVhZHl9LGxvYWQ6e25vQnViYmxlOiEwfSxmb2N1czp7ZGVsZWdhdGVUeXBlOlwiZm9jdXNpblwifSxibHVyOntkZWxlZ2F0ZVR5cGU6XCJmb2N1c291dFwifSxiZWZvcmV1bmxvYWQ6e3NldHVwOmZ1bmN0aW9uKGEsYixjKXtmLmlzV2luZG93KHRoaXMpJiYodGhpcy5vbmJlZm9yZXVubG9hZD1jKX0sdGVhcmRvd246ZnVuY3Rpb24oYSxiKXt0aGlzLm9uYmVmb3JldW5sb2FkPT09YiYmKHRoaXMub25iZWZvcmV1bmxvYWQ9bnVsbCl9fX0sc2ltdWxhdGU6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9Zi5leHRlbmQobmV3IGYuRXZlbnQsYyx7dHlwZTphLGlzU2ltdWxhdGVkOiEwLG9yaWdpbmFsRXZlbnQ6e319KTtkP2YuZXZlbnQudHJpZ2dlcihlLG51bGwsYik6Zi5ldmVudC5kaXNwYXRjaC5jYWxsKGIsZSksZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmYy5wcmV2ZW50RGVmYXVsdCgpfX0sZi5ldmVudC5oYW5kbGU9Zi5ldmVudC5kaXNwYXRjaCxmLnJlbW92ZUV2ZW50PWMucmVtb3ZlRXZlbnRMaXN0ZW5lcj9mdW5jdGlvbihhLGIsYyl7YS5yZW1vdmVFdmVudExpc3RlbmVyJiZhLnJlbW92ZUV2ZW50TGlzdGVuZXIoYixjLCExKX06ZnVuY3Rpb24oYSxiLGMpe2EuZGV0YWNoRXZlbnQmJmEuZGV0YWNoRXZlbnQoXCJvblwiK2IsYyl9LGYuRXZlbnQ9ZnVuY3Rpb24oYSxiKXtpZighKHRoaXMgaW5zdGFuY2VvZiBmLkV2ZW50KSlyZXR1cm4gbmV3IGYuRXZlbnQoYSxiKTthJiZhLnR5cGU/KHRoaXMub3JpZ2luYWxFdmVudD1hLHRoaXMudHlwZT1hLnR5cGUsdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9YS5kZWZhdWx0UHJldmVudGVkfHxhLnJldHVyblZhbHVlPT09ITF8fGEuZ2V0UHJldmVudERlZmF1bHQmJmEuZ2V0UHJldmVudERlZmF1bHQoKT9LOkopOnRoaXMudHlwZT1hLGImJmYuZXh0ZW5kKHRoaXMsYiksdGhpcy50aW1lU3RhbXA9YSYmYS50aW1lU3RhbXB8fGYubm93KCksdGhpc1tmLmV4cGFuZG9dPSEwfSxmLkV2ZW50LnByb3RvdHlwZT17cHJldmVudERlZmF1bHQ6ZnVuY3Rpb24oKXt0aGlzLmlzRGVmYXVsdFByZXZlbnRlZD1LO3ZhciBhPXRoaXMub3JpZ2luYWxFdmVudDshYXx8KGEucHJldmVudERlZmF1bHQ/YS5wcmV2ZW50RGVmYXVsdCgpOmEucmV0dXJuVmFsdWU9ITEpfSxzdG9wUHJvcGFnYXRpb246ZnVuY3Rpb24oKXt0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkPUs7dmFyIGE9dGhpcy5vcmlnaW5hbEV2ZW50OyFhfHwoYS5zdG9wUHJvcGFnYXRpb24mJmEuc3RvcFByb3BhZ2F0aW9uKCksYS5jYW5jZWxCdWJibGU9ITApfSxzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb246ZnVuY3Rpb24oKXt0aGlzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkPUssdGhpcy5zdG9wUHJvcGFnYXRpb24oKX0saXNEZWZhdWx0UHJldmVudGVkOkosaXNQcm9wYWdhdGlvblN0b3BwZWQ6Sixpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDpKfSxmLmVhY2goe21vdXNlZW50ZXI6XCJtb3VzZW92ZXJcIixtb3VzZWxlYXZlOlwibW91c2VvdXRcIn0sZnVuY3Rpb24oYSxiKXtmLmV2ZW50LnNwZWNpYWxbYV09e2RlbGVnYXRlVHlwZTpiLGJpbmRUeXBlOmIsaGFuZGxlOmZ1bmN0aW9uKGEpe3ZhciBjPXRoaXMsZD1hLnJlbGF0ZWRUYXJnZXQsZT1hLmhhbmRsZU9iaixnPWUuc2VsZWN0b3IsaDtpZighZHx8ZCE9PWMmJiFmLmNvbnRhaW5zKGMsZCkpYS50eXBlPWUub3JpZ1R5cGUsaD1lLmhhbmRsZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpLGEudHlwZT1iO3JldHVybiBofX19KSxmLnN1cHBvcnQuc3VibWl0QnViYmxlc3x8KGYuZXZlbnQuc3BlY2lhbC5zdWJtaXQ9e3NldHVwOmZ1bmN0aW9uKCl7aWYoZi5ub2RlTmFtZSh0aGlzLFwiZm9ybVwiKSlyZXR1cm4hMTtmLmV2ZW50LmFkZCh0aGlzLFwiY2xpY2suX3N1Ym1pdCBrZXlwcmVzcy5fc3VibWl0XCIsZnVuY3Rpb24oYSl7dmFyIGM9YS50YXJnZXQsZD1mLm5vZGVOYW1lKGMsXCJpbnB1dFwiKXx8Zi5ub2RlTmFtZShjLFwiYnV0dG9uXCIpP2MuZm9ybTpiO2QmJiFkLl9zdWJtaXRfYXR0YWNoZWQmJihmLmV2ZW50LmFkZChkLFwic3VibWl0Ll9zdWJtaXRcIixmdW5jdGlvbihhKXt0aGlzLnBhcmVudE5vZGUmJiFhLmlzVHJpZ2dlciYmZi5ldmVudC5zaW11bGF0ZShcInN1Ym1pdFwiLHRoaXMucGFyZW50Tm9kZSxhLCEwKX0pLGQuX3N1Ym1pdF9hdHRhY2hlZD0hMCl9KX0sdGVhcmRvd246ZnVuY3Rpb24oKXtpZihmLm5vZGVOYW1lKHRoaXMsXCJmb3JtXCIpKXJldHVybiExO2YuZXZlbnQucmVtb3ZlKHRoaXMsXCIuX3N1Ym1pdFwiKX19KSxmLnN1cHBvcnQuY2hhbmdlQnViYmxlc3x8KGYuZXZlbnQuc3BlY2lhbC5jaGFuZ2U9e3NldHVwOmZ1bmN0aW9uKCl7aWYoei50ZXN0KHRoaXMubm9kZU5hbWUpKXtpZih0aGlzLnR5cGU9PT1cImNoZWNrYm94XCJ8fHRoaXMudHlwZT09PVwicmFkaW9cIilmLmV2ZW50LmFkZCh0aGlzLFwicHJvcGVydHljaGFuZ2UuX2NoYW5nZVwiLGZ1bmN0aW9uKGEpe2Eub3JpZ2luYWxFdmVudC5wcm9wZXJ0eU5hbWU9PT1cImNoZWNrZWRcIiYmKHRoaXMuX2p1c3RfY2hhbmdlZD0hMCl9KSxmLmV2ZW50LmFkZCh0aGlzLFwiY2xpY2suX2NoYW5nZVwiLGZ1bmN0aW9uKGEpe3RoaXMuX2p1c3RfY2hhbmdlZCYmIWEuaXNUcmlnZ2VyJiYodGhpcy5fanVzdF9jaGFuZ2VkPSExLGYuZXZlbnQuc2ltdWxhdGUoXCJjaGFuZ2VcIix0aGlzLGEsITApKX0pO3JldHVybiExfWYuZXZlbnQuYWRkKHRoaXMsXCJiZWZvcmVhY3RpdmF0ZS5fY2hhbmdlXCIsZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQ7ei50ZXN0KGIubm9kZU5hbWUpJiYhYi5fY2hhbmdlX2F0dGFjaGVkJiYoZi5ldmVudC5hZGQoYixcImNoYW5nZS5fY2hhbmdlXCIsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlJiYhYS5pc1NpbXVsYXRlZCYmIWEuaXNUcmlnZ2VyJiZmLmV2ZW50LnNpbXVsYXRlKFwiY2hhbmdlXCIsdGhpcy5wYXJlbnROb2RlLGEsITApfSksYi5fY2hhbmdlX2F0dGFjaGVkPSEwKX0pfSxoYW5kbGU6ZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQ7aWYodGhpcyE9PWJ8fGEuaXNTaW11bGF0ZWR8fGEuaXNUcmlnZ2VyfHxiLnR5cGUhPT1cInJhZGlvXCImJmIudHlwZSE9PVwiY2hlY2tib3hcIilyZXR1cm4gYS5oYW5kbGVPYmouaGFuZGxlci5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7Zi5ldmVudC5yZW1vdmUodGhpcyxcIi5fY2hhbmdlXCIpO3JldHVybiB6LnRlc3QodGhpcy5ub2RlTmFtZSl9fSksZi5zdXBwb3J0LmZvY3VzaW5CdWJibGVzfHxmLmVhY2goe2ZvY3VzOlwiZm9jdXNpblwiLGJsdXI6XCJmb2N1c291dFwifSxmdW5jdGlvbihhLGIpe3ZhciBkPTAsZT1mdW5jdGlvbihhKXtmLmV2ZW50LnNpbXVsYXRlKGIsYS50YXJnZXQsZi5ldmVudC5maXgoYSksITApfTtmLmV2ZW50LnNwZWNpYWxbYl09e3NldHVwOmZ1bmN0aW9uKCl7ZCsrPT09MCYmYy5hZGRFdmVudExpc3RlbmVyKGEsZSwhMCl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7LS1kPT09MCYmYy5yZW1vdmVFdmVudExpc3RlbmVyKGEsZSwhMCl9fX0pLGYuZm4uZXh0ZW5kKHtvbjpmdW5jdGlvbihhLGMsZCxlLGcpe3ZhciBoLGk7aWYodHlwZW9mIGE9PVwib2JqZWN0XCIpe3R5cGVvZiBjIT1cInN0cmluZ1wiJiYoZD1jLGM9Yik7Zm9yKGkgaW4gYSl0aGlzLm9uKGksYyxkLGFbaV0sZyk7cmV0dXJuIHRoaXN9ZD09bnVsbCYmZT09bnVsbD8oZT1jLGQ9Yz1iKTplPT1udWxsJiYodHlwZW9mIGM9PVwic3RyaW5nXCI/KGU9ZCxkPWIpOihlPWQsZD1jLGM9YikpO2lmKGU9PT0hMSllPUo7ZWxzZSBpZighZSlyZXR1cm4gdGhpcztnPT09MSYmKGg9ZSxlPWZ1bmN0aW9uKGEpe2YoKS5vZmYoYSk7cmV0dXJuIGguYXBwbHkodGhpcyxhcmd1bWVudHMpfSxlLmd1aWQ9aC5ndWlkfHwoaC5ndWlkPWYuZ3VpZCsrKSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YuZXZlbnQuYWRkKHRoaXMsYSxlLGQsYyl9KX0sb25lOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLm9uLmNhbGwodGhpcyxhLGIsYyxkLDEpfSxvZmY6ZnVuY3Rpb24oYSxjLGQpe2lmKGEmJmEucHJldmVudERlZmF1bHQmJmEuaGFuZGxlT2JqKXt2YXIgZT1hLmhhbmRsZU9iajtmKGEuZGVsZWdhdGVUYXJnZXQpLm9mZihlLm5hbWVzcGFjZT9lLnR5cGUrXCIuXCIrZS5uYW1lc3BhY2U6ZS50eXBlLGUuc2VsZWN0b3IsZS5oYW5kbGVyKTtyZXR1cm4gdGhpc31pZih0eXBlb2YgYT09XCJvYmplY3RcIil7Zm9yKHZhciBnIGluIGEpdGhpcy5vZmYoZyxjLGFbZ10pO3JldHVybiB0aGlzfWlmKGM9PT0hMXx8dHlwZW9mIGM9PVwiZnVuY3Rpb25cIilkPWMsYz1iO2Q9PT0hMSYmKGQ9Sik7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YuZXZlbnQucmVtb3ZlKHRoaXMsYSxkLGMpfSl9LGJpbmQ6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiB0aGlzLm9uKGEsbnVsbCxiLGMpfSx1bmJpbmQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5vZmYoYSxudWxsLGIpfSxsaXZlOmZ1bmN0aW9uKGEsYixjKXtmKHRoaXMuY29udGV4dCkub24oYSx0aGlzLnNlbGVjdG9yLGIsYyk7cmV0dXJuIHRoaXN9LGRpZTpmdW5jdGlvbihhLGIpe2YodGhpcy5jb250ZXh0KS5vZmYoYSx0aGlzLnNlbGVjdG9yfHxcIioqXCIsYik7cmV0dXJuIHRoaXN9LGRlbGVnYXRlOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLm9uKGIsYSxjLGQpfSx1bmRlbGVnYXRlOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD09MT90aGlzLm9mZihhLFwiKipcIik6dGhpcy5vZmYoYixhLGMpfSx0cmlnZ2VyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YuZXZlbnQudHJpZ2dlcihhLGIsdGhpcyl9KX0sdHJpZ2dlckhhbmRsZXI6ZnVuY3Rpb24oYSxiKXtpZih0aGlzWzBdKXJldHVybiBmLmV2ZW50LnRyaWdnZXIoYSxiLHRoaXNbMF0sITApfSx0b2dnbGU6ZnVuY3Rpb24oYSl7dmFyIGI9YXJndW1lbnRzLGM9YS5ndWlkfHxmLmd1aWQrKyxkPTAsZT1mdW5jdGlvbihjKXt2YXIgZT0oZi5fZGF0YSh0aGlzLFwibGFzdFRvZ2dsZVwiK2EuZ3VpZCl8fDApJWQ7Zi5fZGF0YSh0aGlzLFwibGFzdFRvZ2dsZVwiK2EuZ3VpZCxlKzEpLGMucHJldmVudERlZmF1bHQoKTtyZXR1cm4gYltlXS5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fCExfTtlLmd1aWQ9Yzt3aGlsZShkPGIubGVuZ3RoKWJbZCsrXS5ndWlkPWM7cmV0dXJuIHRoaXMuY2xpY2soZSl9LGhvdmVyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMubW91c2VlbnRlcihhKS5tb3VzZWxlYXZlKGJ8fGEpfX0pLGYuZWFjaChcImJsdXIgZm9jdXMgZm9jdXNpbiBmb2N1c291dCBsb2FkIHJlc2l6ZSBzY3JvbGwgdW5sb2FkIGNsaWNrIGRibGNsaWNrIG1vdXNlZG93biBtb3VzZXVwIG1vdXNlbW92ZSBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2VlbnRlciBtb3VzZWxlYXZlIGNoYW5nZSBzZWxlY3Qgc3VibWl0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgZXJyb3IgY29udGV4dG1lbnVcIi5zcGxpdChcIiBcIiksZnVuY3Rpb24oYSxiKXtmLmZuW2JdPWZ1bmN0aW9uKGEsYyl7Yz09bnVsbCYmKGM9YSxhPW51bGwpO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPjA/dGhpcy5vbihiLG51bGwsYSxjKTp0aGlzLnRyaWdnZXIoYil9LGYuYXR0ckZuJiYoZi5hdHRyRm5bYl09ITApLEMudGVzdChiKSYmKGYuZXZlbnQuZml4SG9va3NbYl09Zi5ldmVudC5rZXlIb29rcyksRC50ZXN0KGIpJiYoZi5ldmVudC5maXhIb29rc1tiXT1mLmV2ZW50Lm1vdXNlSG9va3MpfSksZnVuY3Rpb24oKXtmdW5jdGlvbiB4KGEsYixjLGUsZixnKXtmb3IodmFyIGg9MCxpPWUubGVuZ3RoO2g8aTtoKyspe3ZhciBqPWVbaF07aWYoail7dmFyIGs9ITE7aj1qW2FdO3doaWxlKGope2lmKGpbZF09PT1jKXtrPWVbai5zaXpzZXRdO2JyZWFrfWlmKGoubm9kZVR5cGU9PT0xKXtnfHwoaltkXT1jLGouc2l6c2V0PWgpO2lmKHR5cGVvZiBiIT1cInN0cmluZ1wiKXtpZihqPT09Yil7az0hMDticmVha319ZWxzZSBpZihtLmZpbHRlcihiLFtqXSkubGVuZ3RoPjApe2s9ajticmVha319aj1qW2FdfWVbaF09a319fWZ1bmN0aW9uIHcoYSxiLGMsZSxmLGcpe2Zvcih2YXIgaD0wLGk9ZS5sZW5ndGg7aDxpO2grKyl7dmFyIGo9ZVtoXTtpZihqKXt2YXIgaz0hMTtqPWpbYV07d2hpbGUoail7aWYoaltkXT09PWMpe2s9ZVtqLnNpenNldF07YnJlYWt9ai5ub2RlVHlwZT09PTEmJiFnJiYoaltkXT1jLGouc2l6c2V0PWgpO2lmKGoubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWIpe2s9ajticmVha31qPWpbYV19ZVtoXT1rfX19dmFyIGE9LygoPzpcXCgoPzpcXChbXigpXStcXCl8W14oKV0rKStcXCl8XFxbKD86XFxbW15cXFtcXF1dKlxcXXxbJ1wiXVteJ1wiXSpbJ1wiXXxbXlxcW1xcXSdcIl0rKStcXF18XFxcXC58W14gPit+LChcXFtcXFxcXSspK3xbPit+XSkoXFxzKixcXHMqKT8oKD86LnxcXHJ8XFxuKSopL2csZD1cInNpemNhY2hlXCIrKE1hdGgucmFuZG9tKCkrXCJcIikucmVwbGFjZShcIi5cIixcIlwiKSxlPTAsZz1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLGg9ITEsaT0hMCxqPS9cXFxcL2csaz0vXFxyXFxuL2csbD0vXFxXLztbMCwwXS5zb3J0KGZ1bmN0aW9uKCl7aT0hMTtyZXR1cm4gMH0pO3ZhciBtPWZ1bmN0aW9uKGIsZCxlLGYpe2U9ZXx8W10sZD1kfHxjO3ZhciBoPWQ7aWYoZC5ub2RlVHlwZSE9PTEmJmQubm9kZVR5cGUhPT05KXJldHVybltdO2lmKCFifHx0eXBlb2YgYiE9XCJzdHJpbmdcIilyZXR1cm4gZTt2YXIgaSxqLGssbCxuLHEscix0LHU9ITAsdj1tLmlzWE1MKGQpLHc9W10seD1iO2Rve2EuZXhlYyhcIlwiKSxpPWEuZXhlYyh4KTtpZihpKXt4PWlbM10sdy5wdXNoKGlbMV0pO2lmKGlbMl0pe2w9aVszXTticmVha319fXdoaWxlKGkpO2lmKHcubGVuZ3RoPjEmJnAuZXhlYyhiKSlpZih3Lmxlbmd0aD09PTImJm8ucmVsYXRpdmVbd1swXV0paj15KHdbMF0rd1sxXSxkLGYpO2Vsc2V7aj1vLnJlbGF0aXZlW3dbMF1dP1tkXTptKHcuc2hpZnQoKSxkKTt3aGlsZSh3Lmxlbmd0aCliPXcuc2hpZnQoKSxvLnJlbGF0aXZlW2JdJiYoYis9dy5zaGlmdCgpKSxqPXkoYixqLGYpfWVsc2V7IWYmJncubGVuZ3RoPjEmJmQubm9kZVR5cGU9PT05JiYhdiYmby5tYXRjaC5JRC50ZXN0KHdbMF0pJiYhby5tYXRjaC5JRC50ZXN0KHdbdy5sZW5ndGgtMV0pJiYobj1tLmZpbmQody5zaGlmdCgpLGQsdiksZD1uLmV4cHI/bS5maWx0ZXIobi5leHByLG4uc2V0KVswXTpuLnNldFswXSk7aWYoZCl7bj1mP3tleHByOncucG9wKCksc2V0OnMoZil9Om0uZmluZCh3LnBvcCgpLHcubGVuZ3RoPT09MSYmKHdbMF09PT1cIn5cInx8d1swXT09PVwiK1wiKSYmZC5wYXJlbnROb2RlP2QucGFyZW50Tm9kZTpkLHYpLGo9bi5leHByP20uZmlsdGVyKG4uZXhwcixuLnNldCk6bi5zZXQsdy5sZW5ndGg+MD9rPXMoaik6dT0hMTt3aGlsZSh3Lmxlbmd0aClxPXcucG9wKCkscj1xLG8ucmVsYXRpdmVbcV0/cj13LnBvcCgpOnE9XCJcIixyPT1udWxsJiYocj1kKSxvLnJlbGF0aXZlW3FdKGsscix2KX1lbHNlIGs9dz1bXX1rfHwoaz1qKSxrfHxtLmVycm9yKHF8fGIpO2lmKGcuY2FsbChrKT09PVwiW29iamVjdCBBcnJheV1cIilpZighdSllLnB1c2guYXBwbHkoZSxrKTtlbHNlIGlmKGQmJmQubm9kZVR5cGU9PT0xKWZvcih0PTA7a1t0XSE9bnVsbDt0Kyspa1t0XSYmKGtbdF09PT0hMHx8a1t0XS5ub2RlVHlwZT09PTEmJm0uY29udGFpbnMoZCxrW3RdKSkmJmUucHVzaChqW3RdKTtlbHNlIGZvcih0PTA7a1t0XSE9bnVsbDt0Kyspa1t0XSYma1t0XS5ub2RlVHlwZT09PTEmJmUucHVzaChqW3RdKTtlbHNlIHMoayxlKTtsJiYobShsLGgsZSxmKSxtLnVuaXF1ZVNvcnQoZSkpO3JldHVybiBlfTttLnVuaXF1ZVNvcnQ9ZnVuY3Rpb24oYSl7aWYodSl7aD1pLGEuc29ydCh1KTtpZihoKWZvcih2YXIgYj0xO2I8YS5sZW5ndGg7YisrKWFbYl09PT1hW2ItMV0mJmEuc3BsaWNlKGItLSwxKX1yZXR1cm4gYX0sbS5tYXRjaGVzPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG0oYSxudWxsLG51bGwsYil9LG0ubWF0Y2hlc1NlbGVjdG9yPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG0oYixudWxsLG51bGwsW2FdKS5sZW5ndGg+MH0sbS5maW5kPWZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlLGYsZyxoLGk7aWYoIWEpcmV0dXJuW107Zm9yKGU9MCxmPW8ub3JkZXIubGVuZ3RoO2U8ZjtlKyspe2g9by5vcmRlcltlXTtpZihnPW8ubGVmdE1hdGNoW2hdLmV4ZWMoYSkpe2k9Z1sxXSxnLnNwbGljZSgxLDEpO2lmKGkuc3Vic3RyKGkubGVuZ3RoLTEpIT09XCJcXFxcXCIpe2dbMV09KGdbMV18fFwiXCIpLnJlcGxhY2UoaixcIlwiKSxkPW8uZmluZFtoXShnLGIsYyk7aWYoZCE9bnVsbCl7YT1hLnJlcGxhY2Uoby5tYXRjaFtoXSxcIlwiKTticmVha319fX1kfHwoZD10eXBlb2YgYi5nZXRFbGVtZW50c0J5VGFnTmFtZSE9XCJ1bmRlZmluZWRcIj9iLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKTpbXSk7cmV0dXJue3NldDpkLGV4cHI6YX19LG0uZmlsdGVyPWZ1bmN0aW9uKGEsYyxkLGUpe3ZhciBmLGcsaCxpLGosayxsLG4scCxxPWEscj1bXSxzPWMsdD1jJiZjWzBdJiZtLmlzWE1MKGNbMF0pO3doaWxlKGEmJmMubGVuZ3RoKXtmb3IoaCBpbiBvLmZpbHRlcilpZigoZj1vLmxlZnRNYXRjaFtoXS5leGVjKGEpKSE9bnVsbCYmZlsyXSl7az1vLmZpbHRlcltoXSxsPWZbMV0sZz0hMSxmLnNwbGljZSgxLDEpO2lmKGwuc3Vic3RyKGwubGVuZ3RoLTEpPT09XCJcXFxcXCIpY29udGludWU7cz09PXImJihyPVtdKTtpZihvLnByZUZpbHRlcltoXSl7Zj1vLnByZUZpbHRlcltoXShmLHMsZCxyLGUsdCk7aWYoIWYpZz1pPSEwO2Vsc2UgaWYoZj09PSEwKWNvbnRpbnVlfWlmKGYpZm9yKG49MDsoaj1zW25dKSE9bnVsbDtuKyspaiYmKGk9ayhqLGYsbixzKSxwPWVeaSxkJiZpIT1udWxsP3A/Zz0hMDpzW25dPSExOnAmJihyLnB1c2goaiksZz0hMCkpO2lmKGkhPT1iKXtkfHwocz1yKSxhPWEucmVwbGFjZShvLm1hdGNoW2hdLFwiXCIpO2lmKCFnKXJldHVybltdO2JyZWFrfX1pZihhPT09cSlpZihnPT1udWxsKW0uZXJyb3IoYSk7ZWxzZSBicmVhaztxPWF9cmV0dXJuIHN9LG0uZXJyb3I9ZnVuY3Rpb24oYSl7dGhyb3cgbmV3IEVycm9yKFwiU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogXCIrYSl9O3ZhciBuPW0uZ2V0VGV4dD1mdW5jdGlvbihhKXt2YXIgYixjLGQ9YS5ub2RlVHlwZSxlPVwiXCI7aWYoZCl7aWYoZD09PTF8fGQ9PT05KXtpZih0eXBlb2YgYS50ZXh0Q29udGVudD09XCJzdHJpbmdcIilyZXR1cm4gYS50ZXh0Q29udGVudDtpZih0eXBlb2YgYS5pbm5lclRleHQ9PVwic3RyaW5nXCIpcmV0dXJuIGEuaW5uZXJUZXh0LnJlcGxhY2UoayxcIlwiKTtmb3IoYT1hLmZpcnN0Q2hpbGQ7YTthPWEubmV4dFNpYmxpbmcpZSs9bihhKX1lbHNlIGlmKGQ9PT0zfHxkPT09NClyZXR1cm4gYS5ub2RlVmFsdWV9ZWxzZSBmb3IoYj0wO2M9YVtiXTtiKyspYy5ub2RlVHlwZSE9PTgmJihlKz1uKGMpKTtyZXR1cm4gZX0sbz1tLnNlbGVjdG9ycz17b3JkZXI6W1wiSURcIixcIk5BTUVcIixcIlRBR1wiXSxtYXRjaDp7SUQ6LyMoKD86W1xcd1xcdTAwYzAtXFx1RkZGRlxcLV18XFxcXC4pKykvLENMQVNTOi9cXC4oKD86W1xcd1xcdTAwYzAtXFx1RkZGRlxcLV18XFxcXC4pKykvLE5BTUU6L1xcW25hbWU9WydcIl0qKCg/OltcXHdcXHUwMGMwLVxcdUZGRkZcXC1dfFxcXFwuKSspWydcIl0qXFxdLyxBVFRSOi9cXFtcXHMqKCg/OltcXHdcXHUwMGMwLVxcdUZGRkZcXC1dfFxcXFwuKSspXFxzKig/OihcXFM/PSlcXHMqKD86KFsnXCJdKSguKj8pXFwzfCgjPyg/OltcXHdcXHUwMGMwLVxcdUZGRkZcXC1dfFxcXFwuKSopfCl8KVxccypcXF0vLFRBRzovXigoPzpbXFx3XFx1MDBjMC1cXHVGRkZGXFwqXFwtXXxcXFxcLikrKS8sQ0hJTEQ6Lzoob25seXxudGh8bGFzdHxmaXJzdCktY2hpbGQoPzpcXChcXHMqKGV2ZW58b2RkfCg/OlsrXFwtXT9cXGQrfCg/OlsrXFwtXT9cXGQqKT9uXFxzKig/OlsrXFwtXVxccypcXGQrKT8pKVxccypcXCkpPy8sUE9TOi86KG50aHxlcXxndHxsdHxmaXJzdHxsYXN0fGV2ZW58b2RkKSg/OlxcKChcXGQqKVxcKSk/KD89W15cXC1dfCQpLyxQU0VVRE86LzooKD86W1xcd1xcdTAwYzAtXFx1RkZGRlxcLV18XFxcXC4pKykoPzpcXCgoWydcIl0/KSgoPzpcXChbXlxcKV0rXFwpfFteXFwoXFwpXSopKylcXDJcXCkpPy99LGxlZnRNYXRjaDp7fSxhdHRyTWFwOntcImNsYXNzXCI6XCJjbGFzc05hbWVcIixcImZvclwiOlwiaHRtbEZvclwifSxhdHRySGFuZGxlOntocmVmOmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZShcImhyZWZcIil9LHR5cGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZ2V0QXR0cmlidXRlKFwidHlwZVwiKX19LHJlbGF0aXZlOntcIitcIjpmdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBiPT1cInN0cmluZ1wiLGQ9YyYmIWwudGVzdChiKSxlPWMmJiFkO2QmJihiPWIudG9Mb3dlckNhc2UoKSk7Zm9yKHZhciBmPTAsZz1hLmxlbmd0aCxoO2Y8ZztmKyspaWYoaD1hW2ZdKXt3aGlsZSgoaD1oLnByZXZpb3VzU2libGluZykmJmgubm9kZVR5cGUhPT0xKTthW2ZdPWV8fGgmJmgubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWI/aHx8ITE6aD09PWJ9ZSYmbS5maWx0ZXIoYixhLCEwKX0sXCI+XCI6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkPXR5cGVvZiBiPT1cInN0cmluZ1wiLGU9MCxmPWEubGVuZ3RoO2lmKGQmJiFsLnRlc3QoYikpe2I9Yi50b0xvd2VyQ2FzZSgpO2Zvcig7ZTxmO2UrKyl7Yz1hW2VdO2lmKGMpe3ZhciBnPWMucGFyZW50Tm9kZTthW2VdPWcubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWI/ZzohMX19fWVsc2V7Zm9yKDtlPGY7ZSsrKWM9YVtlXSxjJiYoYVtlXT1kP2MucGFyZW50Tm9kZTpjLnBhcmVudE5vZGU9PT1iKTtkJiZtLmZpbHRlcihiLGEsITApfX0sXCJcIjpmdW5jdGlvbihhLGIsYyl7dmFyIGQsZj1lKyssZz14O3R5cGVvZiBiPT1cInN0cmluZ1wiJiYhbC50ZXN0KGIpJiYoYj1iLnRvTG93ZXJDYXNlKCksZD1iLGc9dyksZyhcInBhcmVudE5vZGVcIixiLGYsYSxkLGMpfSxcIn5cIjpmdW5jdGlvbihhLGIsYyl7dmFyIGQsZj1lKyssZz14O3R5cGVvZiBiPT1cInN0cmluZ1wiJiYhbC50ZXN0KGIpJiYoYj1iLnRvTG93ZXJDYXNlKCksZD1iLGc9dyksZyhcInByZXZpb3VzU2libGluZ1wiLGIsZixhLGQsYyl9fSxmaW5kOntJRDpmdW5jdGlvbihhLGIsYyl7aWYodHlwZW9mIGIuZ2V0RWxlbWVudEJ5SWQhPVwidW5kZWZpbmVkXCImJiFjKXt2YXIgZD1iLmdldEVsZW1lbnRCeUlkKGFbMV0pO3JldHVybiBkJiZkLnBhcmVudE5vZGU/W2RdOltdfX0sTkFNRTpmdW5jdGlvbihhLGIpe2lmKHR5cGVvZiBiLmdldEVsZW1lbnRzQnlOYW1lIT1cInVuZGVmaW5lZFwiKXt2YXIgYz1bXSxkPWIuZ2V0RWxlbWVudHNCeU5hbWUoYVsxXSk7Zm9yKHZhciBlPTAsZj1kLmxlbmd0aDtlPGY7ZSsrKWRbZV0uZ2V0QXR0cmlidXRlKFwibmFtZVwiKT09PWFbMV0mJmMucHVzaChkW2VdKTtyZXR1cm4gYy5sZW5ndGg9PT0wP251bGw6Y319LFRBRzpmdW5jdGlvbihhLGIpe2lmKHR5cGVvZiBiLmdldEVsZW1lbnRzQnlUYWdOYW1lIT1cInVuZGVmaW5lZFwiKXJldHVybiBiLmdldEVsZW1lbnRzQnlUYWdOYW1lKGFbMV0pfX0scHJlRmlsdGVyOntDTEFTUzpmdW5jdGlvbihhLGIsYyxkLGUsZil7YT1cIiBcIithWzFdLnJlcGxhY2UoaixcIlwiKStcIiBcIjtpZihmKXJldHVybiBhO2Zvcih2YXIgZz0wLGg7KGg9YltnXSkhPW51bGw7ZysrKWgmJihlXihoLmNsYXNzTmFtZSYmKFwiIFwiK2guY2xhc3NOYW1lK1wiIFwiKS5yZXBsYWNlKC9bXFx0XFxuXFxyXS9nLFwiIFwiKS5pbmRleE9mKGEpPj0wKT9jfHxkLnB1c2goaCk6YyYmKGJbZ109ITEpKTtyZXR1cm4hMX0sSUQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGFbMV0ucmVwbGFjZShqLFwiXCIpfSxUQUc6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYVsxXS5yZXBsYWNlKGosXCJcIikudG9Mb3dlckNhc2UoKX0sQ0hJTEQ6ZnVuY3Rpb24oYSl7aWYoYVsxXT09PVwibnRoXCIpe2FbMl18fG0uZXJyb3IoYVswXSksYVsyXT1hWzJdLnJlcGxhY2UoL15cXCt8XFxzKi9nLFwiXCIpO3ZhciBiPS8oLT8pKFxcZCopKD86bihbK1xcLV0/XFxkKikpPy8uZXhlYyhhWzJdPT09XCJldmVuXCImJlwiMm5cInx8YVsyXT09PVwib2RkXCImJlwiMm4rMVwifHwhL1xcRC8udGVzdChhWzJdKSYmXCIwbitcIithWzJdfHxhWzJdKTthWzJdPWJbMV0rKGJbMl18fDEpLTAsYVszXT1iWzNdLTB9ZWxzZSBhWzJdJiZtLmVycm9yKGFbMF0pO2FbMF09ZSsrO3JldHVybiBhfSxBVFRSOmZ1bmN0aW9uKGEsYixjLGQsZSxmKXt2YXIgZz1hWzFdPWFbMV0ucmVwbGFjZShqLFwiXCIpOyFmJiZvLmF0dHJNYXBbZ10mJihhWzFdPW8uYXR0ck1hcFtnXSksYVs0XT0oYVs0XXx8YVs1XXx8XCJcIikucmVwbGFjZShqLFwiXCIpLGFbMl09PT1cIn49XCImJihhWzRdPVwiIFwiK2FbNF0rXCIgXCIpO3JldHVybiBhfSxQU0VVRE86ZnVuY3Rpb24oYixjLGQsZSxmKXtpZihiWzFdPT09XCJub3RcIilpZigoYS5leGVjKGJbM10pfHxcIlwiKS5sZW5ndGg+MXx8L15cXHcvLnRlc3QoYlszXSkpYlszXT1tKGJbM10sbnVsbCxudWxsLGMpO2Vsc2V7dmFyIGc9bS5maWx0ZXIoYlszXSxjLGQsITBeZik7ZHx8ZS5wdXNoLmFwcGx5KGUsZyk7cmV0dXJuITF9ZWxzZSBpZihvLm1hdGNoLlBPUy50ZXN0KGJbMF0pfHxvLm1hdGNoLkNISUxELnRlc3QoYlswXSkpcmV0dXJuITA7cmV0dXJuIGJ9LFBPUzpmdW5jdGlvbihhKXthLnVuc2hpZnQoITApO3JldHVybiBhfX0sZmlsdGVyczp7ZW5hYmxlZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5kaXNhYmxlZD09PSExJiZhLnR5cGUhPT1cImhpZGRlblwifSxkaXNhYmxlZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5kaXNhYmxlZD09PSEwfSxjaGVja2VkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmNoZWNrZWQ9PT0hMH0sc2VsZWN0ZWQ6ZnVuY3Rpb24oYSl7YS5wYXJlbnROb2RlJiZhLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDtyZXR1cm4gYS5zZWxlY3RlZD09PSEwfSxwYXJlbnQ6ZnVuY3Rpb24oYSl7cmV0dXJuISFhLmZpcnN0Q2hpbGR9LGVtcHR5OmZ1bmN0aW9uKGEpe3JldHVybiFhLmZpcnN0Q2hpbGR9LGhhczpmdW5jdGlvbihhLGIsYyl7cmV0dXJuISFtKGNbM10sYSkubGVuZ3RofSxoZWFkZXI6ZnVuY3Rpb24oYSl7cmV0dXJuL2hcXGQvaS50ZXN0KGEubm9kZU5hbWUpfSx0ZXh0OmZ1bmN0aW9uKGEpe3ZhciBiPWEuZ2V0QXR0cmlidXRlKFwidHlwZVwiKSxjPWEudHlwZTtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09XCJpbnB1dFwiJiZcInRleHRcIj09PWMmJihiPT09Y3x8Yj09PW51bGwpfSxyYWRpbzpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09XCJpbnB1dFwiJiZcInJhZGlvXCI9PT1hLnR5cGV9LGNoZWNrYm94OmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1cImlucHV0XCImJlwiY2hlY2tib3hcIj09PWEudHlwZX0sZmlsZTpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09XCJpbnB1dFwiJiZcImZpbGVcIj09PWEudHlwZX0scGFzc3dvcmQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PVwiaW5wdXRcIiYmXCJwYXNzd29yZFwiPT09YS50eXBlfSxzdWJtaXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybihiPT09XCJpbnB1dFwifHxiPT09XCJidXR0b25cIikmJlwic3VibWl0XCI9PT1hLnR5cGV9LGltYWdlOmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1cImlucHV0XCImJlwiaW1hZ2VcIj09PWEudHlwZX0scmVzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybihiPT09XCJpbnB1dFwifHxiPT09XCJidXR0b25cIikmJlwicmVzZXRcIj09PWEudHlwZX0sYnV0dG9uOmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4gYj09PVwiaW5wdXRcIiYmXCJidXR0b25cIj09PWEudHlwZXx8Yj09PVwiYnV0dG9uXCJ9LGlucHV0OmZ1bmN0aW9uKGEpe3JldHVybi9pbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uL2kudGVzdChhLm5vZGVOYW1lKX0sZm9jdXM6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1hLm93bmVyRG9jdW1lbnQuYWN0aXZlRWxlbWVudH19LHNldEZpbHRlcnM6e2ZpcnN0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGI9PT0wfSxsYXN0OmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiBiPT09ZC5sZW5ndGgtMX0sZXZlbjpmdW5jdGlvbihhLGIpe3JldHVybiBiJTI9PT0wfSxvZGQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYiUyPT09MX0sbHQ6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiPGNbM10tMH0sZ3Q6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiPmNbM10tMH0sbnRoOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gY1szXS0wPT09Yn0sZXE6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjWzNdLTA9PT1ifX0sZmlsdGVyOntQU0VVRE86ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9YlsxXSxmPW8uZmlsdGVyc1tlXTtpZihmKXJldHVybiBmKGEsYyxiLGQpO2lmKGU9PT1cImNvbnRhaW5zXCIpcmV0dXJuKGEudGV4dENvbnRlbnR8fGEuaW5uZXJUZXh0fHxuKFthXSl8fFwiXCIpLmluZGV4T2YoYlszXSk+PTA7aWYoZT09PVwibm90XCIpe3ZhciBnPWJbM107Zm9yKHZhciBoPTAsaT1nLmxlbmd0aDtoPGk7aCsrKWlmKGdbaF09PT1hKXJldHVybiExO3JldHVybiEwfW0uZXJyb3IoZSl9LENISUxEOmZ1bmN0aW9uKGEsYil7dmFyIGMsZSxmLGcsaCxpLGosaz1iWzFdLGw9YTtzd2l0Y2goayl7Y2FzZVwib25seVwiOmNhc2VcImZpcnN0XCI6d2hpbGUobD1sLnByZXZpb3VzU2libGluZylpZihsLm5vZGVUeXBlPT09MSlyZXR1cm4hMTtpZihrPT09XCJmaXJzdFwiKXJldHVybiEwO2w9YTtjYXNlXCJsYXN0XCI6d2hpbGUobD1sLm5leHRTaWJsaW5nKWlmKGwubm9kZVR5cGU9PT0xKXJldHVybiExO3JldHVybiEwO2Nhc2VcIm50aFwiOmM9YlsyXSxlPWJbM107aWYoYz09PTEmJmU9PT0wKXJldHVybiEwO2Y9YlswXSxnPWEucGFyZW50Tm9kZTtpZihnJiYoZ1tkXSE9PWZ8fCFhLm5vZGVJbmRleCkpe2k9MDtmb3IobD1nLmZpcnN0Q2hpbGQ7bDtsPWwubmV4dFNpYmxpbmcpbC5ub2RlVHlwZT09PTEmJihsLm5vZGVJbmRleD0rK2kpO2dbZF09Zn1qPWEubm9kZUluZGV4LWU7cmV0dXJuIGM9PT0wP2o9PT0wOmolYz09PTAmJmovYz49MH19LElEOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEubm9kZVR5cGU9PT0xJiZhLmdldEF0dHJpYnV0ZShcImlkXCIpPT09Yn0sVEFHOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGI9PT1cIipcIiYmYS5ub2RlVHlwZT09PTF8fCEhYS5ub2RlTmFtZSYmYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09Yn0sQ0xBU1M6ZnVuY3Rpb24oYSxiKXtyZXR1cm4oXCIgXCIrKGEuY2xhc3NOYW1lfHxhLmdldEF0dHJpYnV0ZShcImNsYXNzXCIpKStcIiBcIikuaW5kZXhPZihiKT4tMX0sQVRUUjpmdW5jdGlvbihhLGIpe3ZhciBjPWJbMV0sZD1tLmF0dHI/bS5hdHRyKGEsYyk6by5hdHRySGFuZGxlW2NdP28uYXR0ckhhbmRsZVtjXShhKTphW2NdIT1udWxsP2FbY106YS5nZXRBdHRyaWJ1dGUoYyksZT1kK1wiXCIsZj1iWzJdLGc9Yls0XTtyZXR1cm4gZD09bnVsbD9mPT09XCIhPVwiOiFmJiZtLmF0dHI/ZCE9bnVsbDpmPT09XCI9XCI/ZT09PWc6Zj09PVwiKj1cIj9lLmluZGV4T2YoZyk+PTA6Zj09PVwifj1cIj8oXCIgXCIrZStcIiBcIikuaW5kZXhPZihnKT49MDpnP2Y9PT1cIiE9XCI/ZSE9PWc6Zj09PVwiXj1cIj9lLmluZGV4T2YoZyk9PT0wOmY9PT1cIiQ9XCI/ZS5zdWJzdHIoZS5sZW5ndGgtZy5sZW5ndGgpPT09ZzpmPT09XCJ8PVwiP2U9PT1nfHxlLnN1YnN0cigwLGcubGVuZ3RoKzEpPT09ZytcIi1cIjohMTplJiZkIT09ITF9LFBPUzpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1iWzJdLGY9by5zZXRGaWx0ZXJzW2VdO2lmKGYpcmV0dXJuIGYoYSxjLGIsZCl9fX0scD1vLm1hdGNoLlBPUyxxPWZ1bmN0aW9uKGEsYil7cmV0dXJuXCJcXFxcXCIrKGItMCsxKX07Zm9yKHZhciByIGluIG8ubWF0Y2gpby5tYXRjaFtyXT1uZXcgUmVnRXhwKG8ubWF0Y2hbcl0uc291cmNlKy8oPyFbXlxcW10qXFxdKSg/IVteXFwoXSpcXCkpLy5zb3VyY2UpLG8ubGVmdE1hdGNoW3JdPW5ldyBSZWdFeHAoLyheKD86LnxcXHJ8XFxuKSo/KS8uc291cmNlK28ubWF0Y2hbcl0uc291cmNlLnJlcGxhY2UoL1xcXFwoXFxkKykvZyxxKSk7dmFyIHM9ZnVuY3Rpb24oYSxiKXthPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGEsMCk7aWYoYil7Yi5wdXNoLmFwcGx5KGIsYSk7cmV0dXJuIGJ9cmV0dXJuIGF9O3RyeXtBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChjLmRvY3VtZW50RWxlbWVudC5jaGlsZE5vZGVzLDApWzBdLm5vZGVUeXBlfWNhdGNoKHQpe3M9ZnVuY3Rpb24oYSxiKXt2YXIgYz0wLGQ9Ynx8W107aWYoZy5jYWxsKGEpPT09XCJbb2JqZWN0IEFycmF5XVwiKUFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGQsYSk7ZWxzZSBpZih0eXBlb2YgYS5sZW5ndGg9PVwibnVtYmVyXCIpZm9yKHZhciBlPWEubGVuZ3RoO2M8ZTtjKyspZC5wdXNoKGFbY10pO2Vsc2UgZm9yKDthW2NdO2MrKylkLnB1c2goYVtjXSk7cmV0dXJuIGR9fXZhciB1LHY7Yy5kb2N1bWVudEVsZW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24/dT1mdW5jdGlvbihhLGIpe2lmKGE9PT1iKXtoPSEwO3JldHVybiAwfWlmKCFhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9ufHwhYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbilyZXR1cm4gYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj8tMToxO3JldHVybiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpJjQ/LTE6MX06KHU9ZnVuY3Rpb24oYSxiKXtpZihhPT09Yil7aD0hMDtyZXR1cm4gMH1pZihhLnNvdXJjZUluZGV4JiZiLnNvdXJjZUluZGV4KXJldHVybiBhLnNvdXJjZUluZGV4LWIuc291cmNlSW5kZXg7dmFyIGMsZCxlPVtdLGY9W10sZz1hLnBhcmVudE5vZGUsaT1iLnBhcmVudE5vZGUsaj1nO2lmKGc9PT1pKXJldHVybiB2KGEsYik7aWYoIWcpcmV0dXJuLTE7aWYoIWkpcmV0dXJuIDE7d2hpbGUoaillLnVuc2hpZnQoaiksaj1qLnBhcmVudE5vZGU7aj1pO3doaWxlKGopZi51bnNoaWZ0KGopLGo9ai5wYXJlbnROb2RlO2M9ZS5sZW5ndGgsZD1mLmxlbmd0aDtmb3IodmFyIGs9MDtrPGMmJms8ZDtrKyspaWYoZVtrXSE9PWZba10pcmV0dXJuIHYoZVtrXSxmW2tdKTtyZXR1cm4gaz09PWM/dihhLGZba10sLTEpOnYoZVtrXSxiLDEpfSx2PWZ1bmN0aW9uKGEsYixjKXtpZihhPT09YilyZXR1cm4gYzt2YXIgZD1hLm5leHRTaWJsaW5nO3doaWxlKGQpe2lmKGQ9PT1iKXJldHVybi0xO2Q9ZC5uZXh0U2libGluZ31yZXR1cm4gMX0pLGZ1bmN0aW9uKCl7dmFyIGE9Yy5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGQ9XCJzY3JpcHRcIisobmV3IERhdGUpLmdldFRpbWUoKSxlPWMuZG9jdW1lbnRFbGVtZW50O2EuaW5uZXJIVE1MPVwiPGEgbmFtZT0nXCIrZCtcIicvPlwiLGUuaW5zZXJ0QmVmb3JlKGEsZS5maXJzdENoaWxkKSxjLmdldEVsZW1lbnRCeUlkKGQpJiYoby5maW5kLklEPWZ1bmN0aW9uKGEsYyxkKXtpZih0eXBlb2YgYy5nZXRFbGVtZW50QnlJZCE9XCJ1bmRlZmluZWRcIiYmIWQpe3ZhciBlPWMuZ2V0RWxlbWVudEJ5SWQoYVsxXSk7cmV0dXJuIGU/ZS5pZD09PWFbMV18fHR5cGVvZiBlLmdldEF0dHJpYnV0ZU5vZGUhPVwidW5kZWZpbmVkXCImJmUuZ2V0QXR0cmlidXRlTm9kZShcImlkXCIpLm5vZGVWYWx1ZT09PWFbMV0/W2VdOmI6W119fSxvLmZpbHRlci5JRD1mdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBhLmdldEF0dHJpYnV0ZU5vZGUhPVwidW5kZWZpbmVkXCImJmEuZ2V0QXR0cmlidXRlTm9kZShcImlkXCIpO3JldHVybiBhLm5vZGVUeXBlPT09MSYmYyYmYy5ub2RlVmFsdWU9PT1ifSksZS5yZW1vdmVDaGlsZChhKSxlPWE9bnVsbH0oKSxmdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudChcImRpdlwiKTthLmFwcGVuZENoaWxkKGMuY3JlYXRlQ29tbWVudChcIlwiKSksYS5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIikubGVuZ3RoPjAmJihvLmZpbmQuVEFHPWZ1bmN0aW9uKGEsYil7dmFyIGM9Yi5nZXRFbGVtZW50c0J5VGFnTmFtZShhWzFdKTtpZihhWzFdPT09XCIqXCIpe3ZhciBkPVtdO2Zvcih2YXIgZT0wO2NbZV07ZSsrKWNbZV0ubm9kZVR5cGU9PT0xJiZkLnB1c2goY1tlXSk7Yz1kfXJldHVybiBjfSksYS5pbm5lckhUTUw9XCI8YSBocmVmPScjJz48L2E+XCIsYS5maXJzdENoaWxkJiZ0eXBlb2YgYS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSE9XCJ1bmRlZmluZWRcIiYmYS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZShcImhyZWZcIikhPT1cIiNcIiYmKG8uYXR0ckhhbmRsZS5ocmVmPWZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZShcImhyZWZcIiwyKX0pLGE9bnVsbH0oKSxjLnF1ZXJ5U2VsZWN0b3JBbGwmJmZ1bmN0aW9uKCl7dmFyIGE9bSxiPWMuY3JlYXRlRWxlbWVudChcImRpdlwiKSxkPVwiX19zaXp6bGVfX1wiO2IuaW5uZXJIVE1MPVwiPHAgY2xhc3M9J1RFU1QnPjwvcD5cIjtpZighYi5xdWVyeVNlbGVjdG9yQWxsfHxiLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuVEVTVFwiKS5sZW5ndGghPT0wKXttPWZ1bmN0aW9uKGIsZSxmLGcpe2U9ZXx8YztpZighZyYmIW0uaXNYTUwoZSkpe3ZhciBoPS9eKFxcdyskKXxeXFwuKFtcXHdcXC1dKyQpfF4jKFtcXHdcXC1dKyQpLy5leGVjKGIpO2lmKGgmJihlLm5vZGVUeXBlPT09MXx8ZS5ub2RlVHlwZT09PTkpKXtpZihoWzFdKXJldHVybiBzKGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYiksZik7aWYoaFsyXSYmby5maW5kLkNMQVNTJiZlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpcmV0dXJuIHMoZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGhbMl0pLGYpfWlmKGUubm9kZVR5cGU9PT05KXtpZihiPT09XCJib2R5XCImJmUuYm9keSlyZXR1cm4gcyhbZS5ib2R5XSxmKTtpZihoJiZoWzNdKXt2YXIgaT1lLmdldEVsZW1lbnRCeUlkKGhbM10pO2lmKCFpfHwhaS5wYXJlbnROb2RlKXJldHVybiBzKFtdLGYpO2lmKGkuaWQ9PT1oWzNdKXJldHVybiBzKFtpXSxmKX10cnl7cmV0dXJuIHMoZS5xdWVyeVNlbGVjdG9yQWxsKGIpLGYpfWNhdGNoKGope319ZWxzZSBpZihlLm5vZGVUeXBlPT09MSYmZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIT09XCJvYmplY3RcIil7dmFyIGs9ZSxsPWUuZ2V0QXR0cmlidXRlKFwiaWRcIiksbj1sfHxkLHA9ZS5wYXJlbnROb2RlLHE9L15cXHMqWyt+XS8udGVzdChiKTtsP249bi5yZXBsYWNlKC8nL2csXCJcXFxcJCZcIik6ZS5zZXRBdHRyaWJ1dGUoXCJpZFwiLG4pLHEmJnAmJihlPWUucGFyZW50Tm9kZSk7dHJ5e2lmKCFxfHxwKXJldHVybiBzKGUucXVlcnlTZWxlY3RvckFsbChcIltpZD0nXCIrbitcIiddIFwiK2IpLGYpfWNhdGNoKHIpe31maW5hbGx5e2x8fGsucmVtb3ZlQXR0cmlidXRlKFwiaWRcIil9fX1yZXR1cm4gYShiLGUsZixnKX07Zm9yKHZhciBlIGluIGEpbVtlXT1hW2VdO2I9bnVsbH19KCksZnVuY3Rpb24oKXt2YXIgYT1jLmRvY3VtZW50RWxlbWVudCxiPWEubWF0Y2hlc1NlbGVjdG9yfHxhLm1vek1hdGNoZXNTZWxlY3Rvcnx8YS53ZWJraXRNYXRjaGVzU2VsZWN0b3J8fGEubXNNYXRjaGVzU2VsZWN0b3I7aWYoYil7dmFyIGQ9IWIuY2FsbChjLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksXCJkaXZcIiksZT0hMTt0cnl7Yi5jYWxsKGMuZG9jdW1lbnRFbGVtZW50LFwiW3Rlc3QhPScnXTpzaXp6bGVcIil9Y2F0Y2goZil7ZT0hMH1tLm1hdGNoZXNTZWxlY3Rvcj1mdW5jdGlvbihhLGMpe2M9Yy5yZXBsYWNlKC9cXD1cXHMqKFteJ1wiXFxdXSopXFxzKlxcXS9nLFwiPSckMSddXCIpO2lmKCFtLmlzWE1MKGEpKXRyeXtpZihlfHwhby5tYXRjaC5QU0VVRE8udGVzdChjKSYmIS8hPS8udGVzdChjKSl7dmFyIGY9Yi5jYWxsKGEsYyk7aWYoZnx8IWR8fGEuZG9jdW1lbnQmJmEuZG9jdW1lbnQubm9kZVR5cGUhPT0xMSlyZXR1cm4gZn19Y2F0Y2goZyl7fXJldHVybiBtKGMsbnVsbCxudWxsLFthXSkubGVuZ3RoPjB9fX0oKSxmdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudChcImRpdlwiKTthLmlubmVySFRNTD1cIjxkaXYgY2xhc3M9J3Rlc3QgZSc+PC9kaXY+PGRpdiBjbGFzcz0ndGVzdCc+PC9kaXY+XCI7aWYoISFhLmdldEVsZW1lbnRzQnlDbGFzc05hbWUmJmEuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImVcIikubGVuZ3RoIT09MCl7YS5sYXN0Q2hpbGQuY2xhc3NOYW1lPVwiZVwiO2lmKGEuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImVcIikubGVuZ3RoPT09MSlyZXR1cm47by5vcmRlci5zcGxpY2UoMSwwLFwiQ0xBU1NcIiksby5maW5kLkNMQVNTPWZ1bmN0aW9uKGEsYixjKXtpZih0eXBlb2YgYi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lIT1cInVuZGVmaW5lZFwiJiYhYylyZXR1cm4gYi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGFbMV0pfSxhPW51bGx9fSgpLGMuZG9jdW1lbnRFbGVtZW50LmNvbnRhaW5zP20uY29udGFpbnM9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYSE9PWImJihhLmNvbnRhaW5zP2EuY29udGFpbnMoYik6ITApfTpjLmRvY3VtZW50RWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9tLmNvbnRhaW5zPWZ1bmN0aW9uKGEsYil7cmV0dXJuISEoYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSYxNil9Om0uY29udGFpbnM9ZnVuY3Rpb24oKXtyZXR1cm4hMX0sbS5pc1hNTD1mdW5jdGlvbihhKXt2YXIgYj0oYT9hLm93bmVyRG9jdW1lbnR8fGE6MCkuZG9jdW1lbnRFbGVtZW50O3JldHVybiBiP2Iubm9kZU5hbWUhPT1cIkhUTUxcIjohMX07dmFyIHk9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGU9W10sZj1cIlwiLGc9Yi5ub2RlVHlwZT9bYl06Yjt3aGlsZShkPW8ubWF0Y2guUFNFVURPLmV4ZWMoYSkpZis9ZFswXSxhPWEucmVwbGFjZShvLm1hdGNoLlBTRVVETyxcIlwiKTthPW8ucmVsYXRpdmVbYV0/YStcIipcIjphO2Zvcih2YXIgaD0wLGk9Zy5sZW5ndGg7aDxpO2grKyltKGEsZ1toXSxlLGMpO3JldHVybiBtLmZpbHRlcihmLGUpfTttLmF0dHI9Zi5hdHRyLG0uc2VsZWN0b3JzLmF0dHJNYXA9e30sZi5maW5kPW0sZi5leHByPW0uc2VsZWN0b3JzLGYuZXhwcltcIjpcIl09Zi5leHByLmZpbHRlcnMsZi51bmlxdWU9bS51bmlxdWVTb3J0LGYudGV4dD1tLmdldFRleHQsZi5pc1hNTERvYz1tLmlzWE1MLGYuY29udGFpbnM9bS5jb250YWluc30oKTt2YXIgTD0vVW50aWwkLyxNPS9eKD86cGFyZW50c3xwcmV2VW50aWx8cHJldkFsbCkvLE49LywvLE89L14uW146I1xcW1xcLixdKiQvLFA9QXJyYXkucHJvdG90eXBlLnNsaWNlLFE9Zi5leHByLm1hdGNoLlBPUyxSPXtjaGlsZHJlbjohMCxjb250ZW50czohMCxuZXh0OiEwLHByZXY6ITB9O2YuZm4uZXh0ZW5kKHtmaW5kOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMsYyxkO2lmKHR5cGVvZiBhIT1cInN0cmluZ1wiKXJldHVybiBmKGEpLmZpbHRlcihmdW5jdGlvbigpe2ZvcihjPTAsZD1iLmxlbmd0aDtjPGQ7YysrKWlmKGYuY29udGFpbnMoYltjXSx0aGlzKSlyZXR1cm4hMH0pO3ZhciBlPXRoaXMucHVzaFN0YWNrKFwiXCIsXCJmaW5kXCIsYSksZyxoLGk7Zm9yKGM9MCxkPXRoaXMubGVuZ3RoO2M8ZDtjKyspe2c9ZS5sZW5ndGgsZi5maW5kKGEsdGhpc1tjXSxlKTtpZihjPjApZm9yKGg9ZztoPGUubGVuZ3RoO2grKylmb3IoaT0wO2k8ZztpKyspaWYoZVtpXT09PWVbaF0pe2Uuc3BsaWNlKGgtLSwxKTticmVha319cmV0dXJuIGV9LGhhczpmdW5jdGlvbihhKXt2YXIgYj1mKGEpO3JldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpe2Zvcih2YXIgYT0wLGM9Yi5sZW5ndGg7YTxjO2ErKylpZihmLmNvbnRhaW5zKHRoaXMsYlthXSkpcmV0dXJuITB9KX0sbm90OmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayhUKHRoaXMsYSwhMSksXCJub3RcIixhKX0sZmlsdGVyOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayhUKHRoaXMsYSwhMCksXCJmaWx0ZXJcIixhKX0saXM6ZnVuY3Rpb24oYSl7cmV0dXJuISFhJiYodHlwZW9mIGE9PVwic3RyaW5nXCI/US50ZXN0KGEpP2YoYSx0aGlzLmNvbnRleHQpLmluZGV4KHRoaXNbMF0pPj0wOmYuZmlsdGVyKGEsdGhpcykubGVuZ3RoPjA6dGhpcy5maWx0ZXIoYSkubGVuZ3RoPjApfSxjbG9zZXN0OmZ1bmN0aW9uKGEsYil7dmFyIGM9W10sZCxlLGc9dGhpc1swXTtpZihmLmlzQXJyYXkoYSkpe3ZhciBoPTE7d2hpbGUoZyYmZy5vd25lckRvY3VtZW50JiZnIT09Yil7Zm9yKGQ9MDtkPGEubGVuZ3RoO2QrKylmKGcpLmlzKGFbZF0pJiZjLnB1c2goe3NlbGVjdG9yOmFbZF0sZWxlbTpnLGxldmVsOmh9KTtnPWcucGFyZW50Tm9kZSxoKyt9cmV0dXJuIGN9dmFyIGk9US50ZXN0KGEpfHx0eXBlb2YgYSE9XCJzdHJpbmdcIj9mKGEsYnx8dGhpcy5jb250ZXh0KTowO2ZvcihkPTAsZT10aGlzLmxlbmd0aDtkPGU7ZCsrKXtnPXRoaXNbZF07d2hpbGUoZyl7aWYoaT9pLmluZGV4KGcpPi0xOmYuZmluZC5tYXRjaGVzU2VsZWN0b3IoZyxhKSl7Yy5wdXNoKGcpO2JyZWFrfWc9Zy5wYXJlbnROb2RlO2lmKCFnfHwhZy5vd25lckRvY3VtZW50fHxnPT09Ynx8Zy5ub2RlVHlwZT09PTExKWJyZWFrfX1jPWMubGVuZ3RoPjE/Zi51bmlxdWUoYyk6YztyZXR1cm4gdGhpcy5wdXNoU3RhY2soYyxcImNsb3Nlc3RcIixhKX0saW5kZXg6ZnVuY3Rpb24oYSl7aWYoIWEpcmV0dXJuIHRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZT90aGlzLnByZXZBbGwoKS5sZW5ndGg6LTE7aWYodHlwZW9mIGE9PVwic3RyaW5nXCIpcmV0dXJuIGYuaW5BcnJheSh0aGlzWzBdLGYoYSkpO3JldHVybiBmLmluQXJyYXkoYS5qcXVlcnk/YVswXTphLHRoaXMpfSxhZGQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz10eXBlb2YgYT09XCJzdHJpbmdcIj9mKGEsYik6Zi5tYWtlQXJyYXkoYSYmYS5ub2RlVHlwZT9bYV06YSksZD1mLm1lcmdlKHRoaXMuZ2V0KCksYyk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKFMoY1swXSl8fFMoZFswXSk/ZDpmLnVuaXF1ZShkKSl9LGFuZFNlbGY6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hZGQodGhpcy5wcmV2T2JqZWN0KX19KSxmLmVhY2goe3BhcmVudDpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7cmV0dXJuIGImJmIubm9kZVR5cGUhPT0xMT9iOm51bGx9LHBhcmVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIGYuZGlyKGEsXCJwYXJlbnROb2RlXCIpfSxwYXJlbnRzVW50aWw6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmLmRpcihhLFwicGFyZW50Tm9kZVwiLGMpfSxuZXh0OmZ1bmN0aW9uKGEpe3JldHVybiBmLm50aChhLDIsXCJuZXh0U2libGluZ1wiKX0scHJldjpmdW5jdGlvbihhKXtyZXR1cm4gZi5udGgoYSwyLFwicHJldmlvdXNTaWJsaW5nXCIpfSxuZXh0QWxsOmZ1bmN0aW9uKGEpe3JldHVybiBmLmRpcihhLFwibmV4dFNpYmxpbmdcIil9LHByZXZBbGw6ZnVuY3Rpb24oYSl7cmV0dXJuIGYuZGlyKGEsXCJwcmV2aW91c1NpYmxpbmdcIil9LG5leHRVbnRpbDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZGlyKGEsXCJuZXh0U2libGluZ1wiLGMpfSxwcmV2VW50aWw6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmLmRpcihhLFwicHJldmlvdXNTaWJsaW5nXCIsYyl9LHNpYmxpbmdzOmZ1bmN0aW9uKGEpe3JldHVybiBmLnNpYmxpbmcoYS5wYXJlbnROb2RlLmZpcnN0Q2hpbGQsYSl9LGNoaWxkcmVuOmZ1bmN0aW9uKGEpe3JldHVybiBmLnNpYmxpbmcoYS5maXJzdENoaWxkKX0sY29udGVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIGYubm9kZU5hbWUoYSxcImlmcmFtZVwiKT9hLmNvbnRlbnREb2N1bWVudHx8YS5jb250ZW50V2luZG93LmRvY3VtZW50OmYubWFrZUFycmF5KGEuY2hpbGROb2Rlcyl9fSxmdW5jdGlvbihhLGIpe2YuZm5bYV09ZnVuY3Rpb24oYyxkKXt2YXIgZT1mLm1hcCh0aGlzLGIsYyk7TC50ZXN0KGEpfHwoZD1jKSxkJiZ0eXBlb2YgZD09XCJzdHJpbmdcIiYmKGU9Zi5maWx0ZXIoZCxlKSksZT10aGlzLmxlbmd0aD4xJiYhUlthXT9mLnVuaXF1ZShlKTplLCh0aGlzLmxlbmd0aD4xfHxOLnRlc3QoZCkpJiZNLnRlc3QoYSkmJihlPWUucmV2ZXJzZSgpKTtyZXR1cm4gdGhpcy5wdXNoU3RhY2soZSxhLFAuY2FsbChhcmd1bWVudHMpLmpvaW4oXCIsXCIpKX19KSxmLmV4dGVuZCh7ZmlsdGVyOmZ1bmN0aW9uKGEsYixjKXtjJiYoYT1cIjpub3QoXCIrYStcIilcIik7cmV0dXJuIGIubGVuZ3RoPT09MT9mLmZpbmQubWF0Y2hlc1NlbGVjdG9yKGJbMF0sYSk/W2JbMF1dOltdOmYuZmluZC5tYXRjaGVzKGEsYil9LGRpcjpmdW5jdGlvbihhLGMsZCl7dmFyIGU9W10sZz1hW2NdO3doaWxlKGcmJmcubm9kZVR5cGUhPT05JiYoZD09PWJ8fGcubm9kZVR5cGUhPT0xfHwhZihnKS5pcyhkKSkpZy5ub2RlVHlwZT09PTEmJmUucHVzaChnKSxnPWdbY107cmV0dXJuIGV9LG50aDpmdW5jdGlvbihhLGIsYyxkKXtiPWJ8fDE7dmFyIGU9MDtmb3IoO2E7YT1hW2NdKWlmKGEubm9kZVR5cGU9PT0xJiYrK2U9PT1iKWJyZWFrO3JldHVybiBhfSxzaWJsaW5nOmZ1bmN0aW9uKGEsYil7dmFyIGM9W107Zm9yKDthO2E9YS5uZXh0U2libGluZylhLm5vZGVUeXBlPT09MSYmYSE9PWImJmMucHVzaChhKTtyZXR1cm4gY319KTt2YXIgVj1cImFiYnJ8YXJ0aWNsZXxhc2lkZXxhdWRpb3xjYW52YXN8ZGF0YWxpc3R8ZGV0YWlsc3xmaWdjYXB0aW9ufGZpZ3VyZXxmb290ZXJ8aGVhZGVyfGhncm91cHxtYXJrfG1ldGVyfG5hdnxvdXRwdXR8cHJvZ3Jlc3N8c2VjdGlvbnxzdW1tYXJ5fHRpbWV8dmlkZW9cIixXPS8galF1ZXJ5XFxkKz1cIig/OlxcZCt8bnVsbClcIi9nLFg9L15cXHMrLyxZPS88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcXHc6XSspW14+XSopXFwvPi9pZyxaPS88KFtcXHc6XSspLywkPS88dGJvZHkvaSxfPS88fCYjP1xcdys7LyxiYT0vPCg/OnNjcmlwdHxzdHlsZSkvaSxiYj0vPCg/OnNjcmlwdHxvYmplY3R8ZW1iZWR8b3B0aW9ufHN0eWxlKS9pLGJjPW5ldyBSZWdFeHAoXCI8KD86XCIrVitcIilcIixcImlcIiksYmQ9L2NoZWNrZWRcXHMqKD86W149XXw9XFxzKi5jaGVja2VkLikvaSxiZT0vXFwvKGphdmF8ZWNtYSlzY3JpcHQvaSxiZj0vXlxccyo8ISg/OlxcW0NEQVRBXFxbfFxcLVxcLSkvLGJnPXtvcHRpb246WzEsXCI8c2VsZWN0IG11bHRpcGxlPSdtdWx0aXBsZSc+XCIsXCI8L3NlbGVjdD5cIl0sbGVnZW5kOlsxLFwiPGZpZWxkc2V0PlwiLFwiPC9maWVsZHNldD5cIl0sdGhlYWQ6WzEsXCI8dGFibGU+XCIsXCI8L3RhYmxlPlwiXSx0cjpbMixcIjx0YWJsZT48dGJvZHk+XCIsXCI8L3Rib2R5PjwvdGFibGU+XCJdLHRkOlszLFwiPHRhYmxlPjx0Ym9keT48dHI+XCIsXCI8L3RyPjwvdGJvZHk+PC90YWJsZT5cIl0sY29sOlsyLFwiPHRhYmxlPjx0Ym9keT48L3Rib2R5Pjxjb2xncm91cD5cIixcIjwvY29sZ3JvdXA+PC90YWJsZT5cIl0sYXJlYTpbMSxcIjxtYXA+XCIsXCI8L21hcD5cIl0sX2RlZmF1bHQ6WzAsXCJcIixcIlwiXX0sYmg9VShjKTtiZy5vcHRncm91cD1iZy5vcHRpb24sYmcudGJvZHk9YmcudGZvb3Q9YmcuY29sZ3JvdXA9YmcuY2FwdGlvbj1iZy50aGVhZCxiZy50aD1iZy50ZCxmLnN1cHBvcnQuaHRtbFNlcmlhbGl6ZXx8KGJnLl9kZWZhdWx0PVsxLFwiZGl2PGRpdj5cIixcIjwvZGl2PlwiXSksZi5mbi5leHRlbmQoe3RleHQ6ZnVuY3Rpb24oYSl7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7dmFyIGM9Zih0aGlzKTtjLnRleHQoYS5jYWxsKHRoaXMsYixjLnRleHQoKSkpfSk7aWYodHlwZW9mIGEhPVwib2JqZWN0XCImJmEhPT1iKXJldHVybiB0aGlzLmVtcHR5KCkuYXBwZW5kKCh0aGlzWzBdJiZ0aGlzWzBdLm93bmVyRG9jdW1lbnR8fGMpLmNyZWF0ZVRleHROb2RlKGEpKTtyZXR1cm4gZi50ZXh0KHRoaXMpfSx3cmFwQWxsOmZ1bmN0aW9uKGEpe2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe2YodGhpcykud3JhcEFsbChhLmNhbGwodGhpcyxiKSl9KTtpZih0aGlzWzBdKXt2YXIgYj1mKGEsdGhpc1swXS5vd25lckRvY3VtZW50KS5lcSgwKS5jbG9uZSghMCk7dGhpc1swXS5wYXJlbnROb2RlJiZiLmluc2VydEJlZm9yZSh0aGlzWzBdKSxiLm1hcChmdW5jdGlvbigpe3ZhciBhPXRoaXM7d2hpbGUoYS5maXJzdENoaWxkJiZhLmZpcnN0Q2hpbGQubm9kZVR5cGU9PT0xKWE9YS5maXJzdENoaWxkO3JldHVybiBhfSkuYXBwZW5kKHRoaXMpfXJldHVybiB0aGlzfSx3cmFwSW5uZXI6ZnVuY3Rpb24oYSl7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS53cmFwSW5uZXIoYS5jYWxsKHRoaXMsYikpfSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWYodGhpcyksYz1iLmNvbnRlbnRzKCk7Yy5sZW5ndGg/Yy53cmFwQWxsKGEpOmIuYXBwZW5kKGEpfSl9LHdyYXA6ZnVuY3Rpb24oYSl7dmFyIGI9Zi5pc0Z1bmN0aW9uKGEpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYyl7Zih0aGlzKS53cmFwQWxsKGI/YS5jYWxsKHRoaXMsYyk6YSl9KX0sdW53cmFwOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucGFyZW50KCkuZWFjaChmdW5jdGlvbigpe2Yubm9kZU5hbWUodGhpcyxcImJvZHlcIil8fGYodGhpcykucmVwbGFjZVdpdGgodGhpcy5jaGlsZE5vZGVzKX0pLmVuZCgpfSxhcHBlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITAsZnVuY3Rpb24oYSl7dGhpcy5ub2RlVHlwZT09PTEmJnRoaXMuYXBwZW5kQ2hpbGQoYSl9KX0scHJlcGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMCxmdW5jdGlvbihhKXt0aGlzLm5vZGVUeXBlPT09MSYmdGhpcy5pbnNlcnRCZWZvcmUoYSx0aGlzLmZpcnN0Q2hpbGQpfSl9LGJlZm9yZTpmdW5jdGlvbigpe2lmKHRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZSlyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITEsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLHRoaXMpfSk7aWYoYXJndW1lbnRzLmxlbmd0aCl7dmFyIGE9Zi5jbGVhbihhcmd1bWVudHMpO2EucHVzaC5hcHBseShhLHRoaXMudG9BcnJheSgpKTtyZXR1cm4gdGhpcy5wdXNoU3RhY2soYSxcImJlZm9yZVwiLGFyZ3VtZW50cyl9fSxhZnRlcjpmdW5jdGlvbigpe2lmKHRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZSlyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITEsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLHRoaXMubmV4dFNpYmxpbmcpfSk7aWYoYXJndW1lbnRzLmxlbmd0aCl7dmFyIGE9dGhpcy5wdXNoU3RhY2sodGhpcyxcImFmdGVyXCIsYXJndW1lbnRzKTthLnB1c2guYXBwbHkoYSxmLmNsZWFuKGFyZ3VtZW50cykpO3JldHVybiBhfX0scmVtb3ZlOmZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPTAsZDsoZD10aGlzW2NdKSE9bnVsbDtjKyspaWYoIWF8fGYuZmlsdGVyKGEsW2RdKS5sZW5ndGgpIWImJmQubm9kZVR5cGU9PT0xJiYoZi5jbGVhbkRhdGEoZC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIikpLGYuY2xlYW5EYXRhKFtkXSkpLGQucGFyZW50Tm9kZSYmZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGQpO3JldHVybiB0aGlzfSxlbXB0eTpmdW5jdGlvbigpXG57Zm9yKHZhciBhPTAsYjsoYj10aGlzW2FdKSE9bnVsbDthKyspe2Iubm9kZVR5cGU9PT0xJiZmLmNsZWFuRGF0YShiLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKSk7d2hpbGUoYi5maXJzdENoaWxkKWIucmVtb3ZlQ2hpbGQoYi5maXJzdENoaWxkKX1yZXR1cm4gdGhpc30sY2xvbmU6ZnVuY3Rpb24oYSxiKXthPWE9PW51bGw/ITE6YSxiPWI9PW51bGw/YTpiO3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3JldHVybiBmLmNsb25lKHRoaXMsYSxiKX0pfSxodG1sOmZ1bmN0aW9uKGEpe2lmKGE9PT1iKXJldHVybiB0aGlzWzBdJiZ0aGlzWzBdLm5vZGVUeXBlPT09MT90aGlzWzBdLmlubmVySFRNTC5yZXBsYWNlKFcsXCJcIik6bnVsbDtpZih0eXBlb2YgYT09XCJzdHJpbmdcIiYmIWJhLnRlc3QoYSkmJihmLnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2V8fCFYLnRlc3QoYSkpJiYhYmdbKFouZXhlYyhhKXx8W1wiXCIsXCJcIl0pWzFdLnRvTG93ZXJDYXNlKCldKXthPWEucmVwbGFjZShZLFwiPCQxPjwvJDI+XCIpO3RyeXtmb3IodmFyIGM9MCxkPXRoaXMubGVuZ3RoO2M8ZDtjKyspdGhpc1tjXS5ub2RlVHlwZT09PTEmJihmLmNsZWFuRGF0YSh0aGlzW2NdLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKSksdGhpc1tjXS5pbm5lckhUTUw9YSl9Y2F0Y2goZSl7dGhpcy5lbXB0eSgpLmFwcGVuZChhKX19ZWxzZSBmLmlzRnVuY3Rpb24oYSk/dGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWYodGhpcyk7Yy5odG1sKGEuY2FsbCh0aGlzLGIsYy5odG1sKCkpKX0pOnRoaXMuZW1wdHkoKS5hcHBlbmQoYSk7cmV0dXJuIHRoaXN9LHJlcGxhY2VXaXRoOmZ1bmN0aW9uKGEpe2lmKHRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZSl7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7dmFyIGM9Zih0aGlzKSxkPWMuaHRtbCgpO2MucmVwbGFjZVdpdGgoYS5jYWxsKHRoaXMsYixkKSl9KTt0eXBlb2YgYSE9XCJzdHJpbmdcIiYmKGE9ZihhKS5kZXRhY2goKSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPXRoaXMubmV4dFNpYmxpbmcsYz10aGlzLnBhcmVudE5vZGU7Zih0aGlzKS5yZW1vdmUoKSxiP2YoYikuYmVmb3JlKGEpOmYoYykuYXBwZW5kKGEpfSl9cmV0dXJuIHRoaXMubGVuZ3RoP3RoaXMucHVzaFN0YWNrKGYoZi5pc0Z1bmN0aW9uKGEpP2EoKTphKSxcInJlcGxhY2VXaXRoXCIsYSk6dGhpc30sZGV0YWNoOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnJlbW92ZShhLCEwKX0sZG9tTWFuaXA6ZnVuY3Rpb24oYSxjLGQpe3ZhciBlLGcsaCxpLGo9YVswXSxrPVtdO2lmKCFmLnN1cHBvcnQuY2hlY2tDbG9uZSYmYXJndW1lbnRzLmxlbmd0aD09PTMmJnR5cGVvZiBqPT1cInN0cmluZ1wiJiZiZC50ZXN0KGopKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmKHRoaXMpLmRvbU1hbmlwKGEsYyxkLCEwKX0pO2lmKGYuaXNGdW5jdGlvbihqKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGUpe3ZhciBnPWYodGhpcyk7YVswXT1qLmNhbGwodGhpcyxlLGM/Zy5odG1sKCk6YiksZy5kb21NYW5pcChhLGMsZCl9KTtpZih0aGlzWzBdKXtpPWomJmoucGFyZW50Tm9kZSxmLnN1cHBvcnQucGFyZW50Tm9kZSYmaSYmaS5ub2RlVHlwZT09PTExJiZpLmNoaWxkTm9kZXMubGVuZ3RoPT09dGhpcy5sZW5ndGg/ZT17ZnJhZ21lbnQ6aX06ZT1mLmJ1aWxkRnJhZ21lbnQoYSx0aGlzLGspLGg9ZS5mcmFnbWVudCxoLmNoaWxkTm9kZXMubGVuZ3RoPT09MT9nPWg9aC5maXJzdENoaWxkOmc9aC5maXJzdENoaWxkO2lmKGcpe2M9YyYmZi5ub2RlTmFtZShnLFwidHJcIik7Zm9yKHZhciBsPTAsbT10aGlzLmxlbmd0aCxuPW0tMTtsPG07bCsrKWQuY2FsbChjP2JpKHRoaXNbbF0sZyk6dGhpc1tsXSxlLmNhY2hlYWJsZXx8bT4xJiZsPG4/Zi5jbG9uZShoLCEwLCEwKTpoKX1rLmxlbmd0aCYmZi5lYWNoKGssYnApfXJldHVybiB0aGlzfX0pLGYuYnVpbGRGcmFnbWVudD1mdW5jdGlvbihhLGIsZCl7dmFyIGUsZyxoLGksaj1hWzBdO2ImJmJbMF0mJihpPWJbMF0ub3duZXJEb2N1bWVudHx8YlswXSksaS5jcmVhdGVEb2N1bWVudEZyYWdtZW50fHwoaT1jKSxhLmxlbmd0aD09PTEmJnR5cGVvZiBqPT1cInN0cmluZ1wiJiZqLmxlbmd0aDw1MTImJmk9PT1jJiZqLmNoYXJBdCgwKT09PVwiPFwiJiYhYmIudGVzdChqKSYmKGYuc3VwcG9ydC5jaGVja0Nsb25lfHwhYmQudGVzdChqKSkmJihmLnN1cHBvcnQuaHRtbDVDbG9uZXx8IWJjLnRlc3QoaikpJiYoZz0hMCxoPWYuZnJhZ21lbnRzW2pdLGgmJmghPT0xJiYoZT1oKSksZXx8KGU9aS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksZi5jbGVhbihhLGksZSxkKSksZyYmKGYuZnJhZ21lbnRzW2pdPWg/ZToxKTtyZXR1cm57ZnJhZ21lbnQ6ZSxjYWNoZWFibGU6Z319LGYuZnJhZ21lbnRzPXt9LGYuZWFjaCh7YXBwZW5kVG86XCJhcHBlbmRcIixwcmVwZW5kVG86XCJwcmVwZW5kXCIsaW5zZXJ0QmVmb3JlOlwiYmVmb3JlXCIsaW5zZXJ0QWZ0ZXI6XCJhZnRlclwiLHJlcGxhY2VBbGw6XCJyZXBsYWNlV2l0aFwifSxmdW5jdGlvbihhLGIpe2YuZm5bYV09ZnVuY3Rpb24oYyl7dmFyIGQ9W10sZT1mKGMpLGc9dGhpcy5sZW5ndGg9PT0xJiZ0aGlzWzBdLnBhcmVudE5vZGU7aWYoZyYmZy5ub2RlVHlwZT09PTExJiZnLmNoaWxkTm9kZXMubGVuZ3RoPT09MSYmZS5sZW5ndGg9PT0xKXtlW2JdKHRoaXNbMF0pO3JldHVybiB0aGlzfWZvcih2YXIgaD0wLGk9ZS5sZW5ndGg7aDxpO2grKyl7dmFyIGo9KGg+MD90aGlzLmNsb25lKCEwKTp0aGlzKS5nZXQoKTtmKGVbaF0pW2JdKGopLGQ9ZC5jb25jYXQoail9cmV0dXJuIHRoaXMucHVzaFN0YWNrKGQsYSxlLnNlbGVjdG9yKX19KSxmLmV4dGVuZCh7Y2xvbmU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGUsZyxoPWYuc3VwcG9ydC5odG1sNUNsb25lfHwhYmMudGVzdChcIjxcIithLm5vZGVOYW1lKT9hLmNsb25lTm9kZSghMCk6Ym8oYSk7aWYoKCFmLnN1cHBvcnQubm9DbG9uZUV2ZW50fHwhZi5zdXBwb3J0Lm5vQ2xvbmVDaGVja2VkKSYmKGEubm9kZVR5cGU9PT0xfHxhLm5vZGVUeXBlPT09MTEpJiYhZi5pc1hNTERvYyhhKSl7YmsoYSxoKSxkPWJsKGEpLGU9YmwoaCk7Zm9yKGc9MDtkW2ddOysrZyllW2ddJiZiayhkW2ddLGVbZ10pfWlmKGIpe2JqKGEsaCk7aWYoYyl7ZD1ibChhKSxlPWJsKGgpO2ZvcihnPTA7ZFtnXTsrK2cpYmooZFtnXSxlW2ddKX19ZD1lPW51bGw7cmV0dXJuIGh9LGNsZWFuOmZ1bmN0aW9uKGEsYixkLGUpe3ZhciBnO2I9Ynx8Yyx0eXBlb2YgYi5jcmVhdGVFbGVtZW50PT1cInVuZGVmaW5lZFwiJiYoYj1iLm93bmVyRG9jdW1lbnR8fGJbMF0mJmJbMF0ub3duZXJEb2N1bWVudHx8Yyk7dmFyIGg9W10saTtmb3IodmFyIGo9MCxrOyhrPWFbal0pIT1udWxsO2orKyl7dHlwZW9mIGs9PVwibnVtYmVyXCImJihrKz1cIlwiKTtpZighayljb250aW51ZTtpZih0eXBlb2Ygaz09XCJzdHJpbmdcIilpZighXy50ZXN0KGspKWs9Yi5jcmVhdGVUZXh0Tm9kZShrKTtlbHNle2s9ay5yZXBsYWNlKFksXCI8JDE+PC8kMj5cIik7dmFyIGw9KFouZXhlYyhrKXx8W1wiXCIsXCJcIl0pWzFdLnRvTG93ZXJDYXNlKCksbT1iZ1tsXXx8YmcuX2RlZmF1bHQsbj1tWzBdLG89Yi5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO2I9PT1jP2JoLmFwcGVuZENoaWxkKG8pOlUoYikuYXBwZW5kQ2hpbGQobyksby5pbm5lckhUTUw9bVsxXStrK21bMl07d2hpbGUobi0tKW89by5sYXN0Q2hpbGQ7aWYoIWYuc3VwcG9ydC50Ym9keSl7dmFyIHA9JC50ZXN0KGspLHE9bD09PVwidGFibGVcIiYmIXA/by5maXJzdENoaWxkJiZvLmZpcnN0Q2hpbGQuY2hpbGROb2RlczptWzFdPT09XCI8dGFibGU+XCImJiFwP28uY2hpbGROb2RlczpbXTtmb3IoaT1xLmxlbmd0aC0xO2k+PTA7LS1pKWYubm9kZU5hbWUocVtpXSxcInRib2R5XCIpJiYhcVtpXS5jaGlsZE5vZGVzLmxlbmd0aCYmcVtpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHFbaV0pfSFmLnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UmJlgudGVzdChrKSYmby5pbnNlcnRCZWZvcmUoYi5jcmVhdGVUZXh0Tm9kZShYLmV4ZWMoaylbMF0pLG8uZmlyc3RDaGlsZCksaz1vLmNoaWxkTm9kZXN9dmFyIHI7aWYoIWYuc3VwcG9ydC5hcHBlbmRDaGVja2VkKWlmKGtbMF0mJnR5cGVvZiAocj1rLmxlbmd0aCk9PVwibnVtYmVyXCIpZm9yKGk9MDtpPHI7aSsrKWJuKGtbaV0pO2Vsc2UgYm4oayk7ay5ub2RlVHlwZT9oLnB1c2goayk6aD1mLm1lcmdlKGgsayl9aWYoZCl7Zz1mdW5jdGlvbihhKXtyZXR1cm4hYS50eXBlfHxiZS50ZXN0KGEudHlwZSl9O2ZvcihqPTA7aFtqXTtqKyspaWYoZSYmZi5ub2RlTmFtZShoW2pdLFwic2NyaXB0XCIpJiYoIWhbal0udHlwZXx8aFtqXS50eXBlLnRvTG93ZXJDYXNlKCk9PT1cInRleHQvamF2YXNjcmlwdFwiKSllLnB1c2goaFtqXS5wYXJlbnROb2RlP2hbal0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChoW2pdKTpoW2pdKTtlbHNle2lmKGhbal0ubm9kZVR5cGU9PT0xKXt2YXIgcz1mLmdyZXAoaFtqXS5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKSxnKTtoLnNwbGljZS5hcHBseShoLFtqKzEsMF0uY29uY2F0KHMpKX1kLmFwcGVuZENoaWxkKGhbal0pfX1yZXR1cm4gaH0sY2xlYW5EYXRhOmZ1bmN0aW9uKGEpe3ZhciBiLGMsZD1mLmNhY2hlLGU9Zi5ldmVudC5zcGVjaWFsLGc9Zi5zdXBwb3J0LmRlbGV0ZUV4cGFuZG87Zm9yKHZhciBoPTAsaTsoaT1hW2hdKSE9bnVsbDtoKyspe2lmKGkubm9kZU5hbWUmJmYubm9EYXRhW2kubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0pY29udGludWU7Yz1pW2YuZXhwYW5kb107aWYoYyl7Yj1kW2NdO2lmKGImJmIuZXZlbnRzKXtmb3IodmFyIGogaW4gYi5ldmVudHMpZVtqXT9mLmV2ZW50LnJlbW92ZShpLGopOmYucmVtb3ZlRXZlbnQoaSxqLGIuaGFuZGxlKTtiLmhhbmRsZSYmKGIuaGFuZGxlLmVsZW09bnVsbCl9Zz9kZWxldGUgaVtmLmV4cGFuZG9dOmkucmVtb3ZlQXR0cmlidXRlJiZpLnJlbW92ZUF0dHJpYnV0ZShmLmV4cGFuZG8pLGRlbGV0ZSBkW2NdfX19fSk7dmFyIGJxPS9hbHBoYVxcKFteKV0qXFwpL2ksYnI9L29wYWNpdHk9KFteKV0qKS8sYnM9LyhbQS1aXXxebXMpL2csYnQ9L14tP1xcZCsoPzpweCk/JC9pLGJ1PS9eLT9cXGQvLGJ2PS9eKFtcXC0rXSk9KFtcXC0rLlxcZGVdKykvLGJ3PXtwb3NpdGlvbjpcImFic29sdXRlXCIsdmlzaWJpbGl0eTpcImhpZGRlblwiLGRpc3BsYXk6XCJibG9ja1wifSxieD1bXCJMZWZ0XCIsXCJSaWdodFwiXSxieT1bXCJUb3BcIixcIkJvdHRvbVwiXSxieixiQSxiQjtmLmZuLmNzcz1mdW5jdGlvbihhLGMpe2lmKGFyZ3VtZW50cy5sZW5ndGg9PT0yJiZjPT09YilyZXR1cm4gdGhpcztyZXR1cm4gZi5hY2Nlc3ModGhpcyxhLGMsITAsZnVuY3Rpb24oYSxjLGQpe3JldHVybiBkIT09Yj9mLnN0eWxlKGEsYyxkKTpmLmNzcyhhLGMpfSl9LGYuZXh0ZW5kKHtjc3NIb29rczp7b3BhY2l0eTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYoYil7dmFyIGM9YnooYSxcIm9wYWNpdHlcIixcIm9wYWNpdHlcIik7cmV0dXJuIGM9PT1cIlwiP1wiMVwiOmN9cmV0dXJuIGEuc3R5bGUub3BhY2l0eX19fSxjc3NOdW1iZXI6e2ZpbGxPcGFjaXR5OiEwLGZvbnRXZWlnaHQ6ITAsbGluZUhlaWdodDohMCxvcGFjaXR5OiEwLG9ycGhhbnM6ITAsd2lkb3dzOiEwLHpJbmRleDohMCx6b29tOiEwfSxjc3NQcm9wczp7XCJmbG9hdFwiOmYuc3VwcG9ydC5jc3NGbG9hdD9cImNzc0Zsb2F0XCI6XCJzdHlsZUZsb2F0XCJ9LHN0eWxlOmZ1bmN0aW9uKGEsYyxkLGUpe2lmKCEhYSYmYS5ub2RlVHlwZSE9PTMmJmEubm9kZVR5cGUhPT04JiYhIWEuc3R5bGUpe3ZhciBnLGgsaT1mLmNhbWVsQ2FzZShjKSxqPWEuc3R5bGUsaz1mLmNzc0hvb2tzW2ldO2M9Zi5jc3NQcm9wc1tpXXx8aTtpZihkPT09Yil7aWYoayYmXCJnZXRcImluIGsmJihnPWsuZ2V0KGEsITEsZSkpIT09YilyZXR1cm4gZztyZXR1cm4galtjXX1oPXR5cGVvZiBkLGg9PT1cInN0cmluZ1wiJiYoZz1idi5leGVjKGQpKSYmKGQ9KyhnWzFdKzEpKitnWzJdK3BhcnNlRmxvYXQoZi5jc3MoYSxjKSksaD1cIm51bWJlclwiKTtpZihkPT1udWxsfHxoPT09XCJudW1iZXJcIiYmaXNOYU4oZCkpcmV0dXJuO2g9PT1cIm51bWJlclwiJiYhZi5jc3NOdW1iZXJbaV0mJihkKz1cInB4XCIpO2lmKCFrfHwhKFwic2V0XCJpbiBrKXx8KGQ9ay5zZXQoYSxkKSkhPT1iKXRyeXtqW2NdPWR9Y2F0Y2gobCl7fX19LGNzczpmdW5jdGlvbihhLGMsZCl7dmFyIGUsZztjPWYuY2FtZWxDYXNlKGMpLGc9Zi5jc3NIb29rc1tjXSxjPWYuY3NzUHJvcHNbY118fGMsYz09PVwiY3NzRmxvYXRcIiYmKGM9XCJmbG9hdFwiKTtpZihnJiZcImdldFwiaW4gZyYmKGU9Zy5nZXQoYSwhMCxkKSkhPT1iKXJldHVybiBlO2lmKGJ6KXJldHVybiBieihhLGMpfSxzd2FwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD17fTtmb3IodmFyIGUgaW4gYilkW2VdPWEuc3R5bGVbZV0sYS5zdHlsZVtlXT1iW2VdO2MuY2FsbChhKTtmb3IoZSBpbiBiKWEuc3R5bGVbZV09ZFtlXX19KSxmLmN1ckNTUz1mLmNzcyxmLmVhY2goW1wiaGVpZ2h0XCIsXCJ3aWR0aFwiXSxmdW5jdGlvbihhLGIpe2YuY3NzSG9va3NbYl09e2dldDpmdW5jdGlvbihhLGMsZCl7dmFyIGU7aWYoYyl7aWYoYS5vZmZzZXRXaWR0aCE9PTApcmV0dXJuIGJDKGEsYixkKTtmLnN3YXAoYSxidyxmdW5jdGlvbigpe2U9YkMoYSxiLGQpfSk7cmV0dXJuIGV9fSxzZXQ6ZnVuY3Rpb24oYSxiKXtpZighYnQudGVzdChiKSlyZXR1cm4gYjtiPXBhcnNlRmxvYXQoYik7aWYoYj49MClyZXR1cm4gYitcInB4XCJ9fX0pLGYuc3VwcG9ydC5vcGFjaXR5fHwoZi5jc3NIb29rcy5vcGFjaXR5PXtnZXQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYnIudGVzdCgoYiYmYS5jdXJyZW50U3R5bGU/YS5jdXJyZW50U3R5bGUuZmlsdGVyOmEuc3R5bGUuZmlsdGVyKXx8XCJcIik/cGFyc2VGbG9hdChSZWdFeHAuJDEpLzEwMCtcIlwiOmI/XCIxXCI6XCJcIn0sc2V0OmZ1bmN0aW9uKGEsYil7dmFyIGM9YS5zdHlsZSxkPWEuY3VycmVudFN0eWxlLGU9Zi5pc051bWVyaWMoYik/XCJhbHBoYShvcGFjaXR5PVwiK2IqMTAwK1wiKVwiOlwiXCIsZz1kJiZkLmZpbHRlcnx8Yy5maWx0ZXJ8fFwiXCI7Yy56b29tPTE7aWYoYj49MSYmZi50cmltKGcucmVwbGFjZShicSxcIlwiKSk9PT1cIlwiKXtjLnJlbW92ZUF0dHJpYnV0ZShcImZpbHRlclwiKTtpZihkJiYhZC5maWx0ZXIpcmV0dXJufWMuZmlsdGVyPWJxLnRlc3QoZyk/Zy5yZXBsYWNlKGJxLGUpOmcrXCIgXCIrZX19KSxmKGZ1bmN0aW9uKCl7Zi5zdXBwb3J0LnJlbGlhYmxlTWFyZ2luUmlnaHR8fChmLmNzc0hvb2tzLm1hcmdpblJpZ2h0PXtnZXQ6ZnVuY3Rpb24oYSxiKXt2YXIgYztmLnN3YXAoYSx7ZGlzcGxheTpcImlubGluZS1ibG9ja1wifSxmdW5jdGlvbigpe2I/Yz1ieihhLFwibWFyZ2luLXJpZ2h0XCIsXCJtYXJnaW5SaWdodFwiKTpjPWEuc3R5bGUubWFyZ2luUmlnaHR9KTtyZXR1cm4gY319KX0pLGMuZGVmYXVsdFZpZXcmJmMuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSYmKGJBPWZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlO2I9Yi5yZXBsYWNlKGJzLFwiLSQxXCIpLnRvTG93ZXJDYXNlKCksKGQ9YS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3KSYmKGU9ZC5nZXRDb21wdXRlZFN0eWxlKGEsbnVsbCkpJiYoYz1lLmdldFByb3BlcnR5VmFsdWUoYiksYz09PVwiXCImJiFmLmNvbnRhaW5zKGEub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsYSkmJihjPWYuc3R5bGUoYSxiKSkpO3JldHVybiBjfSksYy5kb2N1bWVudEVsZW1lbnQuY3VycmVudFN0eWxlJiYoYkI9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZj1hLmN1cnJlbnRTdHlsZSYmYS5jdXJyZW50U3R5bGVbYl0sZz1hLnN0eWxlO2Y9PT1udWxsJiZnJiYoZT1nW2JdKSYmKGY9ZSksIWJ0LnRlc3QoZikmJmJ1LnRlc3QoZikmJihjPWcubGVmdCxkPWEucnVudGltZVN0eWxlJiZhLnJ1bnRpbWVTdHlsZS5sZWZ0LGQmJihhLnJ1bnRpbWVTdHlsZS5sZWZ0PWEuY3VycmVudFN0eWxlLmxlZnQpLGcubGVmdD1iPT09XCJmb250U2l6ZVwiP1wiMWVtXCI6Znx8MCxmPWcucGl4ZWxMZWZ0K1wicHhcIixnLmxlZnQ9YyxkJiYoYS5ydW50aW1lU3R5bGUubGVmdD1kKSk7cmV0dXJuIGY9PT1cIlwiP1wiYXV0b1wiOmZ9KSxiej1iQXx8YkIsZi5leHByJiZmLmV4cHIuZmlsdGVycyYmKGYuZXhwci5maWx0ZXJzLmhpZGRlbj1mdW5jdGlvbihhKXt2YXIgYj1hLm9mZnNldFdpZHRoLGM9YS5vZmZzZXRIZWlnaHQ7cmV0dXJuIGI9PT0wJiZjPT09MHx8IWYuc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMmJihhLnN0eWxlJiZhLnN0eWxlLmRpc3BsYXl8fGYuY3NzKGEsXCJkaXNwbGF5XCIpKT09PVwibm9uZVwifSxmLmV4cHIuZmlsdGVycy52aXNpYmxlPWZ1bmN0aW9uKGEpe3JldHVybiFmLmV4cHIuZmlsdGVycy5oaWRkZW4oYSl9KTt2YXIgYkQ9LyUyMC9nLGJFPS9cXFtcXF0kLyxiRj0vXFxyP1xcbi9nLGJHPS8jLiokLyxiSD0vXiguKj8pOlsgXFx0XSooW15cXHJcXG5dKilcXHI/JC9tZyxiST0vXig/OmNvbG9yfGRhdGV8ZGF0ZXRpbWV8ZGF0ZXRpbWUtbG9jYWx8ZW1haWx8aGlkZGVufG1vbnRofG51bWJlcnxwYXNzd29yZHxyYW5nZXxzZWFyY2h8dGVsfHRleHR8dGltZXx1cmx8d2VlaykkL2ksYko9L14oPzphYm91dHxhcHB8YXBwXFwtc3RvcmFnZXwuK1xcLWV4dGVuc2lvbnxmaWxlfHJlc3x3aWRnZXQpOiQvLGJLPS9eKD86R0VUfEhFQUQpJC8sYkw9L15cXC9cXC8vLGJNPS9cXD8vLGJOPS88c2NyaXB0XFxiW148XSooPzooPyE8XFwvc2NyaXB0Pik8W148XSopKjxcXC9zY3JpcHQ+L2dpLGJPPS9eKD86c2VsZWN0fHRleHRhcmVhKS9pLGJQPS9cXHMrLyxiUT0vKFs/Jl0pXz1bXiZdKi8sYlI9L14oW1xcd1xcK1xcLlxcLV0rOikoPzpcXC9cXC8oW15cXC8/IzpdKikoPzo6KFxcZCspKT8pPy8sYlM9Zi5mbi5sb2FkLGJUPXt9LGJVPXt9LGJWLGJXLGJYPVtcIiovXCJdK1tcIipcIl07dHJ5e2JWPWUuaHJlZn1jYXRjaChiWSl7YlY9Yy5jcmVhdGVFbGVtZW50KFwiYVwiKSxiVi5ocmVmPVwiXCIsYlY9YlYuaHJlZn1iVz1iUi5leGVjKGJWLnRvTG93ZXJDYXNlKCkpfHxbXSxmLmZuLmV4dGVuZCh7bG9hZDpmdW5jdGlvbihhLGMsZCl7aWYodHlwZW9mIGEhPVwic3RyaW5nXCImJmJTKXJldHVybiBiUy5hcHBseSh0aGlzLGFyZ3VtZW50cyk7aWYoIXRoaXMubGVuZ3RoKXJldHVybiB0aGlzO3ZhciBlPWEuaW5kZXhPZihcIiBcIik7aWYoZT49MCl7dmFyIGc9YS5zbGljZShlLGEubGVuZ3RoKTthPWEuc2xpY2UoMCxlKX12YXIgaD1cIkdFVFwiO2MmJihmLmlzRnVuY3Rpb24oYyk/KGQ9YyxjPWIpOnR5cGVvZiBjPT1cIm9iamVjdFwiJiYoYz1mLnBhcmFtKGMsZi5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWwpLGg9XCJQT1NUXCIpKTt2YXIgaT10aGlzO2YuYWpheCh7dXJsOmEsdHlwZTpoLGRhdGFUeXBlOlwiaHRtbFwiLGRhdGE6Yyxjb21wbGV0ZTpmdW5jdGlvbihhLGIsYyl7Yz1hLnJlc3BvbnNlVGV4dCxhLmlzUmVzb2x2ZWQoKSYmKGEuZG9uZShmdW5jdGlvbihhKXtjPWF9KSxpLmh0bWwoZz9mKFwiPGRpdj5cIikuYXBwZW5kKGMucmVwbGFjZShiTixcIlwiKSkuZmluZChnKTpjKSksZCYmaS5lYWNoKGQsW2MsYixhXSl9fSk7cmV0dXJuIHRoaXN9LHNlcmlhbGl6ZTpmdW5jdGlvbigpe3JldHVybiBmLnBhcmFtKHRoaXMuc2VyaWFsaXplQXJyYXkoKSl9LHNlcmlhbGl6ZUFycmF5OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWxlbWVudHM/Zi5tYWtlQXJyYXkodGhpcy5lbGVtZW50cyk6dGhpc30pLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiB0aGlzLm5hbWUmJiF0aGlzLmRpc2FibGVkJiYodGhpcy5jaGVja2VkfHxiTy50ZXN0KHRoaXMubm9kZU5hbWUpfHxiSS50ZXN0KHRoaXMudHlwZSkpfSkubWFwKGZ1bmN0aW9uKGEsYil7dmFyIGM9Zih0aGlzKS52YWwoKTtyZXR1cm4gYz09bnVsbD9udWxsOmYuaXNBcnJheShjKT9mLm1hcChjLGZ1bmN0aW9uKGEsYyl7cmV0dXJue25hbWU6Yi5uYW1lLHZhbHVlOmEucmVwbGFjZShiRixcIlxcclxcblwiKX19KTp7bmFtZTpiLm5hbWUsdmFsdWU6Yy5yZXBsYWNlKGJGLFwiXFxyXFxuXCIpfX0pLmdldCgpfX0pLGYuZWFjaChcImFqYXhTdGFydCBhamF4U3RvcCBhamF4Q29tcGxldGUgYWpheEVycm9yIGFqYXhTdWNjZXNzIGFqYXhTZW5kXCIuc3BsaXQoXCIgXCIpLGZ1bmN0aW9uKGEsYil7Zi5mbltiXT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5vbihiLGEpfX0pLGYuZWFjaChbXCJnZXRcIixcInBvc3RcIl0sZnVuY3Rpb24oYSxjKXtmW2NdPWZ1bmN0aW9uKGEsZCxlLGcpe2YuaXNGdW5jdGlvbihkKSYmKGc9Z3x8ZSxlPWQsZD1iKTtyZXR1cm4gZi5hamF4KHt0eXBlOmMsdXJsOmEsZGF0YTpkLHN1Y2Nlc3M6ZSxkYXRhVHlwZTpnfSl9fSksZi5leHRlbmQoe2dldFNjcmlwdDpmdW5jdGlvbihhLGMpe3JldHVybiBmLmdldChhLGIsYyxcInNjcmlwdFwiKX0sZ2V0SlNPTjpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZ2V0KGEsYixjLFwianNvblwiKX0sYWpheFNldHVwOmZ1bmN0aW9uKGEsYil7Yj9iXyhhLGYuYWpheFNldHRpbmdzKTooYj1hLGE9Zi5hamF4U2V0dGluZ3MpLGJfKGEsYik7cmV0dXJuIGF9LGFqYXhTZXR0aW5nczp7dXJsOmJWLGlzTG9jYWw6YkoudGVzdChiV1sxXSksZ2xvYmFsOiEwLHR5cGU6XCJHRVRcIixjb250ZW50VHlwZTpcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLHByb2Nlc3NEYXRhOiEwLGFzeW5jOiEwLGFjY2VwdHM6e3htbDpcImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWxcIixodG1sOlwidGV4dC9odG1sXCIsdGV4dDpcInRleHQvcGxhaW5cIixqc29uOlwiYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0XCIsXCIqXCI6Ylh9LGNvbnRlbnRzOnt4bWw6L3htbC8saHRtbDovaHRtbC8sanNvbjovanNvbi99LHJlc3BvbnNlRmllbGRzOnt4bWw6XCJyZXNwb25zZVhNTFwiLHRleHQ6XCJyZXNwb25zZVRleHRcIn0sY29udmVydGVyczp7XCIqIHRleHRcIjphLlN0cmluZyxcInRleHQgaHRtbFwiOiEwLFwidGV4dCBqc29uXCI6Zi5wYXJzZUpTT04sXCJ0ZXh0IHhtbFwiOmYucGFyc2VYTUx9LGZsYXRPcHRpb25zOntjb250ZXh0OiEwLHVybDohMH19LGFqYXhQcmVmaWx0ZXI6YlooYlQpLGFqYXhUcmFuc3BvcnQ6YlooYlUpLGFqYXg6ZnVuY3Rpb24oYSxjKXtmdW5jdGlvbiB3KGEsYyxsLG0pe2lmKHMhPT0yKXtzPTIscSYmY2xlYXJUaW1lb3V0KHEpLHA9YixuPW18fFwiXCIsdi5yZWFkeVN0YXRlPWE+MD80OjA7dmFyIG8scix1LHc9Yyx4PWw/Y2IoZCx2LGwpOmIseSx6O2lmKGE+PTIwMCYmYTwzMDB8fGE9PT0zMDQpe2lmKGQuaWZNb2RpZmllZCl7aWYoeT12LmdldFJlc3BvbnNlSGVhZGVyKFwiTGFzdC1Nb2RpZmllZFwiKSlmLmxhc3RNb2RpZmllZFtrXT15O2lmKHo9di5nZXRSZXNwb25zZUhlYWRlcihcIkV0YWdcIikpZi5ldGFnW2tdPXp9aWYoYT09PTMwNCl3PVwibm90bW9kaWZpZWRcIixvPSEwO2Vsc2UgdHJ5e3I9Y2MoZCx4KSx3PVwic3VjY2Vzc1wiLG89ITB9Y2F0Y2goQSl7dz1cInBhcnNlcmVycm9yXCIsdT1BfX1lbHNle3U9dztpZighd3x8YSl3PVwiZXJyb3JcIixhPDAmJihhPTApfXYuc3RhdHVzPWEsdi5zdGF0dXNUZXh0PVwiXCIrKGN8fHcpLG8/aC5yZXNvbHZlV2l0aChlLFtyLHcsdl0pOmgucmVqZWN0V2l0aChlLFt2LHcsdV0pLHYuc3RhdHVzQ29kZShqKSxqPWIsdCYmZy50cmlnZ2VyKFwiYWpheFwiKyhvP1wiU3VjY2Vzc1wiOlwiRXJyb3JcIiksW3YsZCxvP3I6dV0pLGkuZmlyZVdpdGgoZSxbdix3XSksdCYmKGcudHJpZ2dlcihcImFqYXhDb21wbGV0ZVwiLFt2LGRdKSwtLWYuYWN0aXZlfHxmLmV2ZW50LnRyaWdnZXIoXCJhamF4U3RvcFwiKSl9fXR5cGVvZiBhPT1cIm9iamVjdFwiJiYoYz1hLGE9YiksYz1jfHx7fTt2YXIgZD1mLmFqYXhTZXR1cCh7fSxjKSxlPWQuY29udGV4dHx8ZCxnPWUhPT1kJiYoZS5ub2RlVHlwZXx8ZSBpbnN0YW5jZW9mIGYpP2YoZSk6Zi5ldmVudCxoPWYuRGVmZXJyZWQoKSxpPWYuQ2FsbGJhY2tzKFwib25jZSBtZW1vcnlcIiksaj1kLnN0YXR1c0NvZGV8fHt9LGssbD17fSxtPXt9LG4sbyxwLHEscixzPTAsdCx1LHY9e3JlYWR5U3RhdGU6MCxzZXRSZXF1ZXN0SGVhZGVyOmZ1bmN0aW9uKGEsYil7aWYoIXMpe3ZhciBjPWEudG9Mb3dlckNhc2UoKTthPW1bY109bVtjXXx8YSxsW2FdPWJ9cmV0dXJuIHRoaXN9LGdldEFsbFJlc3BvbnNlSGVhZGVyczpmdW5jdGlvbigpe3JldHVybiBzPT09Mj9uOm51bGx9LGdldFJlc3BvbnNlSGVhZGVyOmZ1bmN0aW9uKGEpe3ZhciBjO2lmKHM9PT0yKXtpZighbyl7bz17fTt3aGlsZShjPWJILmV4ZWMobikpb1tjWzFdLnRvTG93ZXJDYXNlKCldPWNbMl19Yz1vW2EudG9Mb3dlckNhc2UoKV19cmV0dXJuIGM9PT1iP251bGw6Y30sb3ZlcnJpZGVNaW1lVHlwZTpmdW5jdGlvbihhKXtzfHwoZC5taW1lVHlwZT1hKTtyZXR1cm4gdGhpc30sYWJvcnQ6ZnVuY3Rpb24oYSl7YT1hfHxcImFib3J0XCIscCYmcC5hYm9ydChhKSx3KDAsYSk7cmV0dXJuIHRoaXN9fTtoLnByb21pc2Uodiksdi5zdWNjZXNzPXYuZG9uZSx2LmVycm9yPXYuZmFpbCx2LmNvbXBsZXRlPWkuYWRkLHYuc3RhdHVzQ29kZT1mdW5jdGlvbihhKXtpZihhKXt2YXIgYjtpZihzPDIpZm9yKGIgaW4gYSlqW2JdPVtqW2JdLGFbYl1dO2Vsc2UgYj1hW3Yuc3RhdHVzXSx2LnRoZW4oYixiKX1yZXR1cm4gdGhpc30sZC51cmw9KChhfHxkLnVybCkrXCJcIikucmVwbGFjZShiRyxcIlwiKS5yZXBsYWNlKGJMLGJXWzFdK1wiLy9cIiksZC5kYXRhVHlwZXM9Zi50cmltKGQuZGF0YVR5cGV8fFwiKlwiKS50b0xvd2VyQ2FzZSgpLnNwbGl0KGJQKSxkLmNyb3NzRG9tYWluPT1udWxsJiYocj1iUi5leGVjKGQudXJsLnRvTG93ZXJDYXNlKCkpLGQuY3Jvc3NEb21haW49ISghcnx8clsxXT09YldbMV0mJnJbMl09PWJXWzJdJiYoclszXXx8KHJbMV09PT1cImh0dHA6XCI/ODA6NDQzKSk9PShiV1szXXx8KGJXWzFdPT09XCJodHRwOlwiPzgwOjQ0MykpKSksZC5kYXRhJiZkLnByb2Nlc3NEYXRhJiZ0eXBlb2YgZC5kYXRhIT1cInN0cmluZ1wiJiYoZC5kYXRhPWYucGFyYW0oZC5kYXRhLGQudHJhZGl0aW9uYWwpKSxiJChiVCxkLGMsdik7aWYocz09PTIpcmV0dXJuITE7dD1kLmdsb2JhbCxkLnR5cGU9ZC50eXBlLnRvVXBwZXJDYXNlKCksZC5oYXNDb250ZW50PSFiSy50ZXN0KGQudHlwZSksdCYmZi5hY3RpdmUrKz09PTAmJmYuZXZlbnQudHJpZ2dlcihcImFqYXhTdGFydFwiKTtpZighZC5oYXNDb250ZW50KXtkLmRhdGEmJihkLnVybCs9KGJNLnRlc3QoZC51cmwpP1wiJlwiOlwiP1wiKStkLmRhdGEsZGVsZXRlIGQuZGF0YSksaz1kLnVybDtpZihkLmNhY2hlPT09ITEpe3ZhciB4PWYubm93KCkseT1kLnVybC5yZXBsYWNlKGJRLFwiJDFfPVwiK3gpO2QudXJsPXkrKHk9PT1kLnVybD8oYk0udGVzdChkLnVybCk/XCImXCI6XCI/XCIpK1wiXz1cIit4OlwiXCIpfX0oZC5kYXRhJiZkLmhhc0NvbnRlbnQmJmQuY29udGVudFR5cGUhPT0hMXx8Yy5jb250ZW50VHlwZSkmJnYuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLGQuY29udGVudFR5cGUpLGQuaWZNb2RpZmllZCYmKGs9a3x8ZC51cmwsZi5sYXN0TW9kaWZpZWRba10mJnYuc2V0UmVxdWVzdEhlYWRlcihcIklmLU1vZGlmaWVkLVNpbmNlXCIsZi5sYXN0TW9kaWZpZWRba10pLGYuZXRhZ1trXSYmdi5zZXRSZXF1ZXN0SGVhZGVyKFwiSWYtTm9uZS1NYXRjaFwiLGYuZXRhZ1trXSkpLHYuc2V0UmVxdWVzdEhlYWRlcihcIkFjY2VwdFwiLGQuZGF0YVR5cGVzWzBdJiZkLmFjY2VwdHNbZC5kYXRhVHlwZXNbMF1dP2QuYWNjZXB0c1tkLmRhdGFUeXBlc1swXV0rKGQuZGF0YVR5cGVzWzBdIT09XCIqXCI/XCIsIFwiK2JYK1wiOyBxPTAuMDFcIjpcIlwiKTpkLmFjY2VwdHNbXCIqXCJdKTtmb3IodSBpbiBkLmhlYWRlcnMpdi5zZXRSZXF1ZXN0SGVhZGVyKHUsZC5oZWFkZXJzW3VdKTtpZihkLmJlZm9yZVNlbmQmJihkLmJlZm9yZVNlbmQuY2FsbChlLHYsZCk9PT0hMXx8cz09PTIpKXt2LmFib3J0KCk7cmV0dXJuITF9Zm9yKHUgaW57c3VjY2VzczoxLGVycm9yOjEsY29tcGxldGU6MX0pdlt1XShkW3VdKTtwPWIkKGJVLGQsYyx2KTtpZighcCl3KC0xLFwiTm8gVHJhbnNwb3J0XCIpO2Vsc2V7di5yZWFkeVN0YXRlPTEsdCYmZy50cmlnZ2VyKFwiYWpheFNlbmRcIixbdixkXSksZC5hc3luYyYmZC50aW1lb3V0PjAmJihxPXNldFRpbWVvdXQoZnVuY3Rpb24oKXt2LmFib3J0KFwidGltZW91dFwiKX0sZC50aW1lb3V0KSk7dHJ5e3M9MSxwLnNlbmQobCx3KX1jYXRjaCh6KXtpZihzPDIpdygtMSx6KTtlbHNlIHRocm93IHp9fXJldHVybiB2fSxwYXJhbTpmdW5jdGlvbihhLGMpe3ZhciBkPVtdLGU9ZnVuY3Rpb24oYSxiKXtiPWYuaXNGdW5jdGlvbihiKT9iKCk6YixkW2QubGVuZ3RoXT1lbmNvZGVVUklDb21wb25lbnQoYSkrXCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGIpfTtjPT09YiYmKGM9Zi5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWwpO2lmKGYuaXNBcnJheShhKXx8YS5qcXVlcnkmJiFmLmlzUGxhaW5PYmplY3QoYSkpZi5lYWNoKGEsZnVuY3Rpb24oKXtlKHRoaXMubmFtZSx0aGlzLnZhbHVlKX0pO2Vsc2UgZm9yKHZhciBnIGluIGEpY2EoZyxhW2ddLGMsZSk7cmV0dXJuIGQuam9pbihcIiZcIikucmVwbGFjZShiRCxcIitcIil9fSksZi5leHRlbmQoe2FjdGl2ZTowLGxhc3RNb2RpZmllZDp7fSxldGFnOnt9fSk7dmFyIGNkPWYubm93KCksY2U9LyhcXD0pXFw/KCZ8JCl8XFw/XFw/L2k7Zi5hamF4U2V0dXAoe2pzb25wOlwiY2FsbGJhY2tcIixqc29ucENhbGxiYWNrOmZ1bmN0aW9uKCl7cmV0dXJuIGYuZXhwYW5kbytcIl9cIitjZCsrfX0pLGYuYWpheFByZWZpbHRlcihcImpzb24ganNvbnBcIixmdW5jdGlvbihiLGMsZCl7dmFyIGU9Yi5jb250ZW50VHlwZT09PVwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCImJnR5cGVvZiBiLmRhdGE9PVwic3RyaW5nXCI7aWYoYi5kYXRhVHlwZXNbMF09PT1cImpzb25wXCJ8fGIuanNvbnAhPT0hMSYmKGNlLnRlc3QoYi51cmwpfHxlJiZjZS50ZXN0KGIuZGF0YSkpKXt2YXIgZyxoPWIuanNvbnBDYWxsYmFjaz1mLmlzRnVuY3Rpb24oYi5qc29ucENhbGxiYWNrKT9iLmpzb25wQ2FsbGJhY2soKTpiLmpzb25wQ2FsbGJhY2ssaT1hW2hdLGo9Yi51cmwsaz1iLmRhdGEsbD1cIiQxXCIraCtcIiQyXCI7Yi5qc29ucCE9PSExJiYoaj1qLnJlcGxhY2UoY2UsbCksYi51cmw9PT1qJiYoZSYmKGs9ay5yZXBsYWNlKGNlLGwpKSxiLmRhdGE9PT1rJiYoais9KC9cXD8vLnRlc3Qoaik/XCImXCI6XCI/XCIpK2IuanNvbnArXCI9XCIraCkpKSxiLnVybD1qLGIuZGF0YT1rLGFbaF09ZnVuY3Rpb24oYSl7Zz1bYV19LGQuYWx3YXlzKGZ1bmN0aW9uKCl7YVtoXT1pLGcmJmYuaXNGdW5jdGlvbihpKSYmYVtoXShnWzBdKX0pLGIuY29udmVydGVyc1tcInNjcmlwdCBqc29uXCJdPWZ1bmN0aW9uKCl7Z3x8Zi5lcnJvcihoK1wiIHdhcyBub3QgY2FsbGVkXCIpO3JldHVybiBnWzBdfSxiLmRhdGFUeXBlc1swXT1cImpzb25cIjtyZXR1cm5cInNjcmlwdFwifX0pLGYuYWpheFNldHVwKHthY2NlcHRzOntzY3JpcHQ6XCJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdFwifSxjb250ZW50czp7c2NyaXB0Oi9qYXZhc2NyaXB0fGVjbWFzY3JpcHQvfSxjb252ZXJ0ZXJzOntcInRleHQgc2NyaXB0XCI6ZnVuY3Rpb24oYSl7Zi5nbG9iYWxFdmFsKGEpO3JldHVybiBhfX19KSxmLmFqYXhQcmVmaWx0ZXIoXCJzY3JpcHRcIixmdW5jdGlvbihhKXthLmNhY2hlPT09YiYmKGEuY2FjaGU9ITEpLGEuY3Jvc3NEb21haW4mJihhLnR5cGU9XCJHRVRcIixhLmdsb2JhbD0hMSl9KSxmLmFqYXhUcmFuc3BvcnQoXCJzY3JpcHRcIixmdW5jdGlvbihhKXtpZihhLmNyb3NzRG9tYWluKXt2YXIgZCxlPWMuaGVhZHx8Yy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF18fGMuZG9jdW1lbnRFbGVtZW50O3JldHVybntzZW5kOmZ1bmN0aW9uKGYsZyl7ZD1jLmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIiksZC5hc3luYz1cImFzeW5jXCIsYS5zY3JpcHRDaGFyc2V0JiYoZC5jaGFyc2V0PWEuc2NyaXB0Q2hhcnNldCksZC5zcmM9YS51cmwsZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oYSxjKXtpZihjfHwhZC5yZWFkeVN0YXRlfHwvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KGQucmVhZHlTdGF0ZSkpZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCxlJiZkLnBhcmVudE5vZGUmJmUucmVtb3ZlQ2hpbGQoZCksZD1iLGN8fGcoMjAwLFwic3VjY2Vzc1wiKX0sZS5pbnNlcnRCZWZvcmUoZCxlLmZpcnN0Q2hpbGQpfSxhYm9ydDpmdW5jdGlvbigpe2QmJmQub25sb2FkKDAsMSl9fX19KTt2YXIgY2Y9YS5BY3RpdmVYT2JqZWN0P2Z1bmN0aW9uKCl7Zm9yKHZhciBhIGluIGNoKWNoW2FdKDAsMSl9OiExLGNnPTAsY2g7Zi5hamF4U2V0dGluZ3MueGhyPWEuQWN0aXZlWE9iamVjdD9mdW5jdGlvbigpe3JldHVybiF0aGlzLmlzTG9jYWwmJmNpKCl8fGNqKCl9OmNpLGZ1bmN0aW9uKGEpe2YuZXh0ZW5kKGYuc3VwcG9ydCx7YWpheDohIWEsY29yczohIWEmJlwid2l0aENyZWRlbnRpYWxzXCJpbiBhfSl9KGYuYWpheFNldHRpbmdzLnhocigpKSxmLnN1cHBvcnQuYWpheCYmZi5hamF4VHJhbnNwb3J0KGZ1bmN0aW9uKGMpe2lmKCFjLmNyb3NzRG9tYWlufHxmLnN1cHBvcnQuY29ycyl7dmFyIGQ7cmV0dXJue3NlbmQ6ZnVuY3Rpb24oZSxnKXt2YXIgaD1jLnhocigpLGksajtjLnVzZXJuYW1lP2gub3BlbihjLnR5cGUsYy51cmwsYy5hc3luYyxjLnVzZXJuYW1lLGMucGFzc3dvcmQpOmgub3BlbihjLnR5cGUsYy51cmwsYy5hc3luYyk7aWYoYy54aHJGaWVsZHMpZm9yKGogaW4gYy54aHJGaWVsZHMpaFtqXT1jLnhockZpZWxkc1tqXTtjLm1pbWVUeXBlJiZoLm92ZXJyaWRlTWltZVR5cGUmJmgub3ZlcnJpZGVNaW1lVHlwZShjLm1pbWVUeXBlKSwhYy5jcm9zc0RvbWFpbiYmIWVbXCJYLVJlcXVlc3RlZC1XaXRoXCJdJiYoZVtcIlgtUmVxdWVzdGVkLVdpdGhcIl09XCJYTUxIdHRwUmVxdWVzdFwiKTt0cnl7Zm9yKGogaW4gZSloLnNldFJlcXVlc3RIZWFkZXIoaixlW2pdKX1jYXRjaChrKXt9aC5zZW5kKGMuaGFzQ29udGVudCYmYy5kYXRhfHxudWxsKSxkPWZ1bmN0aW9uKGEsZSl7dmFyIGosayxsLG0sbjt0cnl7aWYoZCYmKGV8fGgucmVhZHlTdGF0ZT09PTQpKXtkPWIsaSYmKGgub25yZWFkeXN0YXRlY2hhbmdlPWYubm9vcCxjZiYmZGVsZXRlIGNoW2ldKTtpZihlKWgucmVhZHlTdGF0ZSE9PTQmJmguYWJvcnQoKTtlbHNle2o9aC5zdGF0dXMsbD1oLmdldEFsbFJlc3BvbnNlSGVhZGVycygpLG09e30sbj1oLnJlc3BvbnNlWE1MLG4mJm4uZG9jdW1lbnRFbGVtZW50JiYobS54bWw9biksbS50ZXh0PWgucmVzcG9uc2VUZXh0O3RyeXtrPWguc3RhdHVzVGV4dH1jYXRjaChvKXtrPVwiXCJ9IWomJmMuaXNMb2NhbCYmIWMuY3Jvc3NEb21haW4/aj1tLnRleHQ/MjAwOjQwNDpqPT09MTIyMyYmKGo9MjA0KX19fWNhdGNoKHApe2V8fGcoLTEscCl9bSYmZyhqLGssbSxsKX0sIWMuYXN5bmN8fGgucmVhZHlTdGF0ZT09PTQ/ZCgpOihpPSsrY2csY2YmJihjaHx8KGNoPXt9LGYoYSkudW5sb2FkKGNmKSksY2hbaV09ZCksaC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZCl9LGFib3J0OmZ1bmN0aW9uKCl7ZCYmZCgwLDEpfX19fSk7dmFyIGNrPXt9LGNsLGNtLGNuPS9eKD86dG9nZ2xlfHNob3d8aGlkZSkkLyxjbz0vXihbK1xcLV09KT8oW1xcZCsuXFwtXSspKFthLXolXSopJC9pLGNwLGNxPVtbXCJoZWlnaHRcIixcIm1hcmdpblRvcFwiLFwibWFyZ2luQm90dG9tXCIsXCJwYWRkaW5nVG9wXCIsXCJwYWRkaW5nQm90dG9tXCJdLFtcIndpZHRoXCIsXCJtYXJnaW5MZWZ0XCIsXCJtYXJnaW5SaWdodFwiLFwicGFkZGluZ0xlZnRcIixcInBhZGRpbmdSaWdodFwiXSxbXCJvcGFjaXR5XCJdXSxjcjtmLmZuLmV4dGVuZCh7c2hvdzpmdW5jdGlvbihhLGIsYyl7dmFyIGQsZTtpZihhfHxhPT09MClyZXR1cm4gdGhpcy5hbmltYXRlKGN1KFwic2hvd1wiLDMpLGEsYixjKTtmb3IodmFyIGc9MCxoPXRoaXMubGVuZ3RoO2c8aDtnKyspZD10aGlzW2ddLGQuc3R5bGUmJihlPWQuc3R5bGUuZGlzcGxheSwhZi5fZGF0YShkLFwib2xkZGlzcGxheVwiKSYmZT09PVwibm9uZVwiJiYoZT1kLnN0eWxlLmRpc3BsYXk9XCJcIiksZT09PVwiXCImJmYuY3NzKGQsXCJkaXNwbGF5XCIpPT09XCJub25lXCImJmYuX2RhdGEoZCxcIm9sZGRpc3BsYXlcIixjdihkLm5vZGVOYW1lKSkpO2ZvcihnPTA7ZzxoO2crKyl7ZD10aGlzW2ddO2lmKGQuc3R5bGUpe2U9ZC5zdHlsZS5kaXNwbGF5O2lmKGU9PT1cIlwifHxlPT09XCJub25lXCIpZC5zdHlsZS5kaXNwbGF5PWYuX2RhdGEoZCxcIm9sZGRpc3BsYXlcIil8fFwiXCJ9fXJldHVybiB0aGlzfSxoaWRlOmZ1bmN0aW9uKGEsYixjKXtpZihhfHxhPT09MClyZXR1cm4gdGhpcy5hbmltYXRlKGN1KFwiaGlkZVwiLDMpLGEsYixjKTt2YXIgZCxlLGc9MCxoPXRoaXMubGVuZ3RoO2Zvcig7ZzxoO2crKylkPXRoaXNbZ10sZC5zdHlsZSYmKGU9Zi5jc3MoZCxcImRpc3BsYXlcIiksZSE9PVwibm9uZVwiJiYhZi5fZGF0YShkLFwib2xkZGlzcGxheVwiKSYmZi5fZGF0YShkLFwib2xkZGlzcGxheVwiLGUpKTtmb3IoZz0wO2c8aDtnKyspdGhpc1tnXS5zdHlsZSYmKHRoaXNbZ10uc3R5bGUuZGlzcGxheT1cIm5vbmVcIik7cmV0dXJuIHRoaXN9LF90b2dnbGU6Zi5mbi50b2dnbGUsdG9nZ2xlOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD10eXBlb2YgYT09XCJib29sZWFuXCI7Zi5pc0Z1bmN0aW9uKGEpJiZmLmlzRnVuY3Rpb24oYik/dGhpcy5fdG9nZ2xlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTphPT1udWxsfHxkP3RoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWQ/YTpmKHRoaXMpLmlzKFwiOmhpZGRlblwiKTtmKHRoaXMpW2I/XCJzaG93XCI6XCJoaWRlXCJdKCl9KTp0aGlzLmFuaW1hdGUoY3UoXCJ0b2dnbGVcIiwzKSxhLGIsYyk7cmV0dXJuIHRoaXN9LGZhZGVUbzpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5maWx0ZXIoXCI6aGlkZGVuXCIpLmNzcyhcIm9wYWNpdHlcIiwwKS5zaG93KCkuZW5kKCkuYW5pbWF0ZSh7b3BhY2l0eTpifSxhLGMsZCl9LGFuaW1hdGU6ZnVuY3Rpb24oYSxiLGMsZCl7ZnVuY3Rpb24gZygpe2UucXVldWU9PT0hMSYmZi5fbWFyayh0aGlzKTt2YXIgYj1mLmV4dGVuZCh7fSxlKSxjPXRoaXMubm9kZVR5cGU9PT0xLGQ9YyYmZih0aGlzKS5pcyhcIjpoaWRkZW5cIiksZyxoLGksaixrLGwsbSxuLG87Yi5hbmltYXRlZFByb3BlcnRpZXM9e307Zm9yKGkgaW4gYSl7Zz1mLmNhbWVsQ2FzZShpKSxpIT09ZyYmKGFbZ109YVtpXSxkZWxldGUgYVtpXSksaD1hW2ddLGYuaXNBcnJheShoKT8oYi5hbmltYXRlZFByb3BlcnRpZXNbZ109aFsxXSxoPWFbZ109aFswXSk6Yi5hbmltYXRlZFByb3BlcnRpZXNbZ109Yi5zcGVjaWFsRWFzaW5nJiZiLnNwZWNpYWxFYXNpbmdbZ118fGIuZWFzaW5nfHxcInN3aW5nXCI7aWYoaD09PVwiaGlkZVwiJiZkfHxoPT09XCJzaG93XCImJiFkKXJldHVybiBiLmNvbXBsZXRlLmNhbGwodGhpcyk7YyYmKGc9PT1cImhlaWdodFwifHxnPT09XCJ3aWR0aFwiKSYmKGIub3ZlcmZsb3c9W3RoaXMuc3R5bGUub3ZlcmZsb3csdGhpcy5zdHlsZS5vdmVyZmxvd1gsdGhpcy5zdHlsZS5vdmVyZmxvd1ldLGYuY3NzKHRoaXMsXCJkaXNwbGF5XCIpPT09XCJpbmxpbmVcIiYmZi5jc3ModGhpcyxcImZsb2F0XCIpPT09XCJub25lXCImJighZi5zdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXR8fGN2KHRoaXMubm9kZU5hbWUpPT09XCJpbmxpbmVcIj90aGlzLnN0eWxlLmRpc3BsYXk9XCJpbmxpbmUtYmxvY2tcIjp0aGlzLnN0eWxlLnpvb209MSkpfWIub3ZlcmZsb3chPW51bGwmJih0aGlzLnN0eWxlLm92ZXJmbG93PVwiaGlkZGVuXCIpO2ZvcihpIGluIGEpaj1uZXcgZi5meCh0aGlzLGIsaSksaD1hW2ldLGNuLnRlc3QoaCk/KG89Zi5fZGF0YSh0aGlzLFwidG9nZ2xlXCIraSl8fChoPT09XCJ0b2dnbGVcIj9kP1wic2hvd1wiOlwiaGlkZVwiOjApLG8/KGYuX2RhdGEodGhpcyxcInRvZ2dsZVwiK2ksbz09PVwic2hvd1wiP1wiaGlkZVwiOlwic2hvd1wiKSxqW29dKCkpOmpbaF0oKSk6KGs9Y28uZXhlYyhoKSxsPWouY3VyKCksaz8obT1wYXJzZUZsb2F0KGtbMl0pLG49a1szXXx8KGYuY3NzTnVtYmVyW2ldP1wiXCI6XCJweFwiKSxuIT09XCJweFwiJiYoZi5zdHlsZSh0aGlzLGksKG18fDEpK24pLGw9KG18fDEpL2ouY3VyKCkqbCxmLnN0eWxlKHRoaXMsaSxsK24pKSxrWzFdJiYobT0oa1sxXT09PVwiLT1cIj8tMToxKSptK2wpLGouY3VzdG9tKGwsbSxuKSk6ai5jdXN0b20obCxoLFwiXCIpKTtyZXR1cm4hMH12YXIgZT1mLnNwZWVkKGIsYyxkKTtpZihmLmlzRW1wdHlPYmplY3QoYSkpcmV0dXJuIHRoaXMuZWFjaChlLmNvbXBsZXRlLFshMV0pO2E9Zi5leHRlbmQoe30sYSk7cmV0dXJuIGUucXVldWU9PT0hMT90aGlzLmVhY2goZyk6dGhpcy5xdWV1ZShlLnF1ZXVlLGcpfSxzdG9wOmZ1bmN0aW9uKGEsYyxkKXt0eXBlb2YgYSE9XCJzdHJpbmdcIiYmKGQ9YyxjPWEsYT1iKSxjJiZhIT09ITEmJnRoaXMucXVldWUoYXx8XCJmeFwiLFtdKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gaChhLGIsYyl7dmFyIGU9YltjXTtmLnJlbW92ZURhdGEoYSxjLCEwKSxlLnN0b3AoZCl9dmFyIGIsYz0hMSxlPWYudGltZXJzLGc9Zi5fZGF0YSh0aGlzKTtkfHxmLl91bm1hcmsoITAsdGhpcyk7aWYoYT09bnVsbClmb3IoYiBpbiBnKWdbYl0mJmdbYl0uc3RvcCYmYi5pbmRleE9mKFwiLnJ1blwiKT09PWIubGVuZ3RoLTQmJmgodGhpcyxnLGIpO2Vsc2UgZ1tiPWErXCIucnVuXCJdJiZnW2JdLnN0b3AmJmgodGhpcyxnLGIpO2ZvcihiPWUubGVuZ3RoO2ItLTspZVtiXS5lbGVtPT09dGhpcyYmKGE9PW51bGx8fGVbYl0ucXVldWU9PT1hKSYmKGQ/ZVtiXSghMCk6ZVtiXS5zYXZlU3RhdGUoKSxjPSEwLGUuc3BsaWNlKGIsMSkpOyghZHx8IWMpJiZmLmRlcXVldWUodGhpcyxhKX0pfX0pLGYuZWFjaCh7c2xpZGVEb3duOmN1KFwic2hvd1wiLDEpLHNsaWRlVXA6Y3UoXCJoaWRlXCIsMSksc2xpZGVUb2dnbGU6Y3UoXCJ0b2dnbGVcIiwxKSxmYWRlSW46e29wYWNpdHk6XCJzaG93XCJ9LGZhZGVPdXQ6e29wYWNpdHk6XCJoaWRlXCJ9LGZhZGVUb2dnbGU6e29wYWNpdHk6XCJ0b2dnbGVcIn19LGZ1bmN0aW9uKGEsYil7Zi5mblthXT1mdW5jdGlvbihhLGMsZCl7cmV0dXJuIHRoaXMuYW5pbWF0ZShiLGEsYyxkKX19KSxmLmV4dGVuZCh7c3BlZWQ6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWEmJnR5cGVvZiBhPT1cIm9iamVjdFwiP2YuZXh0ZW5kKHt9LGEpOntjb21wbGV0ZTpjfHwhYyYmYnx8Zi5pc0Z1bmN0aW9uKGEpJiZhLGR1cmF0aW9uOmEsZWFzaW5nOmMmJmJ8fGImJiFmLmlzRnVuY3Rpb24oYikmJmJ9O2QuZHVyYXRpb249Zi5meC5vZmY/MDp0eXBlb2YgZC5kdXJhdGlvbj09XCJudW1iZXJcIj9kLmR1cmF0aW9uOmQuZHVyYXRpb24gaW4gZi5meC5zcGVlZHM/Zi5meC5zcGVlZHNbZC5kdXJhdGlvbl06Zi5meC5zcGVlZHMuX2RlZmF1bHQ7aWYoZC5xdWV1ZT09bnVsbHx8ZC5xdWV1ZT09PSEwKWQucXVldWU9XCJmeFwiO2Qub2xkPWQuY29tcGxldGUsZC5jb21wbGV0ZT1mdW5jdGlvbihhKXtmLmlzRnVuY3Rpb24oZC5vbGQpJiZkLm9sZC5jYWxsKHRoaXMpLGQucXVldWU/Zi5kZXF1ZXVlKHRoaXMsZC5xdWV1ZSk6YSE9PSExJiZmLl91bm1hcmsodGhpcyl9O3JldHVybiBkfSxlYXNpbmc6e2xpbmVhcjpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gYytkKmF9LHN3aW5nOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybigtTWF0aC5jb3MoYSpNYXRoLlBJKS8yKy41KSpkK2N9fSx0aW1lcnM6W10sZng6ZnVuY3Rpb24oYSxiLGMpe3RoaXMub3B0aW9ucz1iLHRoaXMuZWxlbT1hLHRoaXMucHJvcD1jLGIub3JpZz1iLm9yaWd8fHt9fX0pLGYuZngucHJvdG90eXBlPXt1cGRhdGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuc3RlcCYmdGhpcy5vcHRpb25zLnN0ZXAuY2FsbCh0aGlzLmVsZW0sdGhpcy5ub3csdGhpcyksKGYuZnguc3RlcFt0aGlzLnByb3BdfHxmLmZ4LnN0ZXAuX2RlZmF1bHQpKHRoaXMpfSxjdXI6ZnVuY3Rpb24oKXtpZih0aGlzLmVsZW1bdGhpcy5wcm9wXSE9bnVsbCYmKCF0aGlzLmVsZW0uc3R5bGV8fHRoaXMuZWxlbS5zdHlsZVt0aGlzLnByb3BdPT1udWxsKSlyZXR1cm4gdGhpcy5lbGVtW3RoaXMucHJvcF07dmFyIGEsYj1mLmNzcyh0aGlzLmVsZW0sdGhpcy5wcm9wKTtyZXR1cm4gaXNOYU4oYT1wYXJzZUZsb2F0KGIpKT8hYnx8Yj09PVwiYXV0b1wiPzA6YjphfSxjdXN0b206ZnVuY3Rpb24oYSxjLGQpe2Z1bmN0aW9uIGgoYSl7cmV0dXJuIGUuc3RlcChhKX12YXIgZT10aGlzLGc9Zi5meDt0aGlzLnN0YXJ0VGltZT1jcnx8Y3MoKSx0aGlzLmVuZD1jLHRoaXMubm93PXRoaXMuc3RhcnQ9YSx0aGlzLnBvcz10aGlzLnN0YXRlPTAsdGhpcy51bml0PWR8fHRoaXMudW5pdHx8KGYuY3NzTnVtYmVyW3RoaXMucHJvcF0/XCJcIjpcInB4XCIpLGgucXVldWU9dGhpcy5vcHRpb25zLnF1ZXVlLGguZWxlbT10aGlzLmVsZW0saC5zYXZlU3RhdGU9ZnVuY3Rpb24oKXtlLm9wdGlvbnMuaGlkZSYmZi5fZGF0YShlLmVsZW0sXCJmeHNob3dcIitlLnByb3ApPT09YiYmZi5fZGF0YShlLmVsZW0sXCJmeHNob3dcIitlLnByb3AsZS5zdGFydCl9LGgoKSYmZi50aW1lcnMucHVzaChoKSYmIWNwJiYoY3A9c2V0SW50ZXJ2YWwoZy50aWNrLGcuaW50ZXJ2YWwpKX0sc2hvdzpmdW5jdGlvbigpe3ZhciBhPWYuX2RhdGEodGhpcy5lbGVtLFwiZnhzaG93XCIrdGhpcy5wcm9wKTt0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdPWF8fGYuc3R5bGUodGhpcy5lbGVtLHRoaXMucHJvcCksdGhpcy5vcHRpb25zLnNob3c9ITAsYSE9PWI/dGhpcy5jdXN0b20odGhpcy5jdXIoKSxhKTp0aGlzLmN1c3RvbSh0aGlzLnByb3A9PT1cIndpZHRoXCJ8fHRoaXMucHJvcD09PVwiaGVpZ2h0XCI/MTowLHRoaXMuY3VyKCkpLGYodGhpcy5lbGVtKS5zaG93KCl9LGhpZGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdPWYuX2RhdGEodGhpcy5lbGVtLFwiZnhzaG93XCIrdGhpcy5wcm9wKXx8Zi5zdHlsZSh0aGlzLmVsZW0sdGhpcy5wcm9wKSx0aGlzLm9wdGlvbnMuaGlkZT0hMCx0aGlzLmN1c3RvbSh0aGlzLmN1cigpLDApfSxzdGVwOmZ1bmN0aW9uKGEpe3ZhciBiLGMsZCxlPWNyfHxjcygpLGc9ITAsaD10aGlzLmVsZW0saT10aGlzLm9wdGlvbnM7aWYoYXx8ZT49aS5kdXJhdGlvbit0aGlzLnN0YXJ0VGltZSl7dGhpcy5ub3c9dGhpcy5lbmQsdGhpcy5wb3M9dGhpcy5zdGF0ZT0xLHRoaXMudXBkYXRlKCksaS5hbmltYXRlZFByb3BlcnRpZXNbdGhpcy5wcm9wXT0hMDtmb3IoYiBpbiBpLmFuaW1hdGVkUHJvcGVydGllcylpLmFuaW1hdGVkUHJvcGVydGllc1tiXSE9PSEwJiYoZz0hMSk7aWYoZyl7aS5vdmVyZmxvdyE9bnVsbCYmIWYuc3VwcG9ydC5zaHJpbmtXcmFwQmxvY2tzJiZmLmVhY2goW1wiXCIsXCJYXCIsXCJZXCJdLGZ1bmN0aW9uKGEsYil7aC5zdHlsZVtcIm92ZXJmbG93XCIrYl09aS5vdmVyZmxvd1thXX0pLGkuaGlkZSYmZihoKS5oaWRlKCk7aWYoaS5oaWRlfHxpLnNob3cpZm9yKGIgaW4gaS5hbmltYXRlZFByb3BlcnRpZXMpZi5zdHlsZShoLGIsaS5vcmlnW2JdKSxmLnJlbW92ZURhdGEoaCxcImZ4c2hvd1wiK2IsITApLGYucmVtb3ZlRGF0YShoLFwidG9nZ2xlXCIrYiwhMCk7ZD1pLmNvbXBsZXRlLGQmJihpLmNvbXBsZXRlPSExLGQuY2FsbChoKSl9cmV0dXJuITF9aS5kdXJhdGlvbj09SW5maW5pdHk/dGhpcy5ub3c9ZTooYz1lLXRoaXMuc3RhcnRUaW1lLHRoaXMuc3RhdGU9Yy9pLmR1cmF0aW9uLHRoaXMucG9zPWYuZWFzaW5nW2kuYW5pbWF0ZWRQcm9wZXJ0aWVzW3RoaXMucHJvcF1dKHRoaXMuc3RhdGUsYywwLDEsaS5kdXJhdGlvbiksdGhpcy5ub3c9dGhpcy5zdGFydCsodGhpcy5lbmQtdGhpcy5zdGFydCkqdGhpcy5wb3MpLHRoaXMudXBkYXRlKCk7cmV0dXJuITB9fSxmLmV4dGVuZChmLmZ4LHt0aWNrOmZ1bmN0aW9uKCl7dmFyIGEsYj1mLnRpbWVycyxjPTA7Zm9yKDtjPGIubGVuZ3RoO2MrKylhPWJbY10sIWEoKSYmYltjXT09PWEmJmIuc3BsaWNlKGMtLSwxKTtiLmxlbmd0aHx8Zi5meC5zdG9wKCl9LGludGVydmFsOjEzLHN0b3A6ZnVuY3Rpb24oKXtjbGVhckludGVydmFsKGNwKSxjcD1udWxsfSxzcGVlZHM6e3Nsb3c6NjAwLGZhc3Q6MjAwLF9kZWZhdWx0OjQwMH0sc3RlcDp7b3BhY2l0eTpmdW5jdGlvbihhKXtmLnN0eWxlKGEuZWxlbSxcIm9wYWNpdHlcIixhLm5vdyl9LF9kZWZhdWx0OmZ1bmN0aW9uKGEpe2EuZWxlbS5zdHlsZSYmYS5lbGVtLnN0eWxlW2EucHJvcF0hPW51bGw/YS5lbGVtLnN0eWxlW2EucHJvcF09YS5ub3crYS51bml0OmEuZWxlbVthLnByb3BdPWEubm93fX19KSxmLmVhY2goW1wid2lkdGhcIixcImhlaWdodFwiXSxmdW5jdGlvbihhLGIpe2YuZnguc3RlcFtiXT1mdW5jdGlvbihhKXtmLnN0eWxlKGEuZWxlbSxiLE1hdGgubWF4KDAsYS5ub3cpK2EudW5pdCl9fSksZi5leHByJiZmLmV4cHIuZmlsdGVycyYmKGYuZXhwci5maWx0ZXJzLmFuaW1hdGVkPWZ1bmN0aW9uKGEpe3JldHVybiBmLmdyZXAoZi50aW1lcnMsZnVuY3Rpb24oYil7cmV0dXJuIGE9PT1iLmVsZW19KS5sZW5ndGh9KTt2YXIgY3c9L150KD86YWJsZXxkfGgpJC9pLGN4PS9eKD86Ym9keXxodG1sKSQvaTtcImdldEJvdW5kaW5nQ2xpZW50UmVjdFwiaW4gYy5kb2N1bWVudEVsZW1lbnQ/Zi5mbi5vZmZzZXQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXSxjO2lmKGEpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmLm9mZnNldC5zZXRPZmZzZXQodGhpcyxhLGIpfSk7aWYoIWJ8fCFiLm93bmVyRG9jdW1lbnQpcmV0dXJuIG51bGw7aWYoYj09PWIub3duZXJEb2N1bWVudC5ib2R5KXJldHVybiBmLm9mZnNldC5ib2R5T2Zmc2V0KGIpO3RyeXtjPWIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCl9Y2F0Y2goZCl7fXZhciBlPWIub3duZXJEb2N1bWVudCxnPWUuZG9jdW1lbnRFbGVtZW50O2lmKCFjfHwhZi5jb250YWlucyhnLGIpKXJldHVybiBjP3t0b3A6Yy50b3AsbGVmdDpjLmxlZnR9Ont0b3A6MCxsZWZ0OjB9O3ZhciBoPWUuYm9keSxpPWN5KGUpLGo9Zy5jbGllbnRUb3B8fGguY2xpZW50VG9wfHwwLGs9Zy5jbGllbnRMZWZ0fHxoLmNsaWVudExlZnR8fDAsbD1pLnBhZ2VZT2Zmc2V0fHxmLnN1cHBvcnQuYm94TW9kZWwmJmcuc2Nyb2xsVG9wfHxoLnNjcm9sbFRvcCxtPWkucGFnZVhPZmZzZXR8fGYuc3VwcG9ydC5ib3hNb2RlbCYmZy5zY3JvbGxMZWZ0fHxoLnNjcm9sbExlZnQsbj1jLnRvcCtsLWosbz1jLmxlZnQrbS1rO3JldHVybnt0b3A6bixsZWZ0Om99fTpmLmZuLm9mZnNldD1mdW5jdGlvbihhKXt2YXIgYj10aGlzWzBdO2lmKGEpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmLm9mZnNldC5zZXRPZmZzZXQodGhpcyxhLGIpfSk7aWYoIWJ8fCFiLm93bmVyRG9jdW1lbnQpcmV0dXJuIG51bGw7aWYoYj09PWIub3duZXJEb2N1bWVudC5ib2R5KXJldHVybiBmLm9mZnNldC5ib2R5T2Zmc2V0KGIpO3ZhciBjLGQ9Yi5vZmZzZXRQYXJlbnQsZT1iLGc9Yi5vd25lckRvY3VtZW50LGg9Zy5kb2N1bWVudEVsZW1lbnQsaT1nLmJvZHksaj1nLmRlZmF1bHRWaWV3LGs9aj9qLmdldENvbXB1dGVkU3R5bGUoYixudWxsKTpiLmN1cnJlbnRTdHlsZSxsPWIub2Zmc2V0VG9wLG09Yi5vZmZzZXRMZWZ0O3doaWxlKChiPWIucGFyZW50Tm9kZSkmJmIhPT1pJiZiIT09aCl7aWYoZi5zdXBwb3J0LmZpeGVkUG9zaXRpb24mJmsucG9zaXRpb249PT1cImZpeGVkXCIpYnJlYWs7Yz1qP2ouZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpOmIuY3VycmVudFN0eWxlLGwtPWIuc2Nyb2xsVG9wLG0tPWIuc2Nyb2xsTGVmdCxiPT09ZCYmKGwrPWIub2Zmc2V0VG9wLG0rPWIub2Zmc2V0TGVmdCxmLnN1cHBvcnQuZG9lc05vdEFkZEJvcmRlciYmKCFmLnN1cHBvcnQuZG9lc0FkZEJvcmRlckZvclRhYmxlQW5kQ2VsbHN8fCFjdy50ZXN0KGIubm9kZU5hbWUpKSYmKGwrPXBhcnNlRmxvYXQoYy5ib3JkZXJUb3BXaWR0aCl8fDAsbSs9cGFyc2VGbG9hdChjLmJvcmRlckxlZnRXaWR0aCl8fDApLGU9ZCxkPWIub2Zmc2V0UGFyZW50KSxmLnN1cHBvcnQuc3VidHJhY3RzQm9yZGVyRm9yT3ZlcmZsb3dOb3RWaXNpYmxlJiZjLm92ZXJmbG93IT09XCJ2aXNpYmxlXCImJihsKz1wYXJzZUZsb2F0KGMuYm9yZGVyVG9wV2lkdGgpfHwwLG0rPXBhcnNlRmxvYXQoYy5ib3JkZXJMZWZ0V2lkdGgpfHwwKSxrPWN9aWYoay5wb3NpdGlvbj09PVwicmVsYXRpdmVcInx8ay5wb3NpdGlvbj09PVwic3RhdGljXCIpbCs9aS5vZmZzZXRUb3AsbSs9aS5vZmZzZXRMZWZ0O2Yuc3VwcG9ydC5maXhlZFBvc2l0aW9uJiZrLnBvc2l0aW9uPT09XCJmaXhlZFwiJiYobCs9TWF0aC5tYXgoaC5zY3JvbGxUb3AsaS5zY3JvbGxUb3ApLG0rPU1hdGgubWF4KGguc2Nyb2xsTGVmdCxpLnNjcm9sbExlZnQpKTtyZXR1cm57dG9wOmwsbGVmdDptfX0sZi5vZmZzZXQ9e2JvZHlPZmZzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5vZmZzZXRUb3AsYz1hLm9mZnNldExlZnQ7Zi5zdXBwb3J0LmRvZXNOb3RJbmNsdWRlTWFyZ2luSW5Cb2R5T2Zmc2V0JiYoYis9cGFyc2VGbG9hdChmLmNzcyhhLFwibWFyZ2luVG9wXCIpKXx8MCxjKz1wYXJzZUZsb2F0KGYuY3NzKGEsXCJtYXJnaW5MZWZ0XCIpKXx8MCk7cmV0dXJue3RvcDpiLGxlZnQ6Y319LHNldE9mZnNldDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9Zi5jc3MoYSxcInBvc2l0aW9uXCIpO2Q9PT1cInN0YXRpY1wiJiYoYS5zdHlsZS5wb3NpdGlvbj1cInJlbGF0aXZlXCIpO3ZhciBlPWYoYSksZz1lLm9mZnNldCgpLGg9Zi5jc3MoYSxcInRvcFwiKSxpPWYuY3NzKGEsXCJsZWZ0XCIpLGo9KGQ9PT1cImFic29sdXRlXCJ8fGQ9PT1cImZpeGVkXCIpJiZmLmluQXJyYXkoXCJhdXRvXCIsW2gsaV0pPi0xLGs9e30sbD17fSxtLG47aj8obD1lLnBvc2l0aW9uKCksbT1sLnRvcCxuPWwubGVmdCk6KG09cGFyc2VGbG9hdChoKXx8MCxuPXBhcnNlRmxvYXQoaSl8fDApLGYuaXNGdW5jdGlvbihiKSYmKGI9Yi5jYWxsKGEsYyxnKSksYi50b3AhPW51bGwmJihrLnRvcD1iLnRvcC1nLnRvcCttKSxiLmxlZnQhPW51bGwmJihrLmxlZnQ9Yi5sZWZ0LWcubGVmdCtuKSxcInVzaW5nXCJpbiBiP2IudXNpbmcuY2FsbChhLGspOmUuY3NzKGspfX0sZi5mbi5leHRlbmQoe3Bvc2l0aW9uOmZ1bmN0aW9uKCl7aWYoIXRoaXNbMF0pcmV0dXJuIG51bGw7dmFyIGE9dGhpc1swXSxiPXRoaXMub2Zmc2V0UGFyZW50KCksYz10aGlzLm9mZnNldCgpLGQ9Y3gudGVzdChiWzBdLm5vZGVOYW1lKT97dG9wOjAsbGVmdDowfTpiLm9mZnNldCgpO2MudG9wLT1wYXJzZUZsb2F0KGYuY3NzKGEsXCJtYXJnaW5Ub3BcIikpfHwwLGMubGVmdC09cGFyc2VGbG9hdChmLmNzcyhhLFwibWFyZ2luTGVmdFwiKSl8fDAsZC50b3ArPXBhcnNlRmxvYXQoZi5jc3MoYlswXSxcImJvcmRlclRvcFdpZHRoXCIpKXx8MCxkLmxlZnQrPXBhcnNlRmxvYXQoZi5jc3MoYlswXSxcImJvcmRlckxlZnRXaWR0aFwiKSl8fDA7cmV0dXJue3RvcDpjLnRvcC1kLnRvcCxsZWZ0OmMubGVmdC1kLmxlZnR9fSxvZmZzZXRQYXJlbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9mZnNldFBhcmVudHx8Yy5ib2R5O3doaWxlKGEmJiFjeC50ZXN0KGEubm9kZU5hbWUpJiZmLmNzcyhhLFwicG9zaXRpb25cIik9PT1cInN0YXRpY1wiKWE9YS5vZmZzZXRQYXJlbnQ7cmV0dXJuIGF9KX19KSxmLmVhY2goW1wiTGVmdFwiLFwiVG9wXCJdLGZ1bmN0aW9uKGEsYyl7dmFyIGQ9XCJzY3JvbGxcIitjO2YuZm5bZF09ZnVuY3Rpb24oYyl7dmFyIGUsZztpZihjPT09Yil7ZT10aGlzWzBdO2lmKCFlKXJldHVybiBudWxsO2c9Y3koZSk7cmV0dXJuIGc/XCJwYWdlWE9mZnNldFwiaW4gZz9nW2E/XCJwYWdlWU9mZnNldFwiOlwicGFnZVhPZmZzZXRcIl06Zi5zdXBwb3J0LmJveE1vZGVsJiZnLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFtkXXx8Zy5kb2N1bWVudC5ib2R5W2RdOmVbZF19cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2c9Y3kodGhpcyksZz9nLnNjcm9sbFRvKGE/ZihnKS5zY3JvbGxMZWZ0KCk6YyxhP2M6ZihnKS5zY3JvbGxUb3AoKSk6dGhpc1tkXT1jfSl9fSksZi5lYWNoKFtcIkhlaWdodFwiLFwiV2lkdGhcIl0sZnVuY3Rpb24oYSxjKXt2YXIgZD1jLnRvTG93ZXJDYXNlKCk7Zi5mbltcImlubmVyXCIrY109ZnVuY3Rpb24oKXt2YXIgYT10aGlzWzBdO3JldHVybiBhP2Euc3R5bGU/cGFyc2VGbG9hdChmLmNzcyhhLGQsXCJwYWRkaW5nXCIpKTp0aGlzW2RdKCk6bnVsbH0sZi5mbltcIm91dGVyXCIrY109ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXTtyZXR1cm4gYj9iLnN0eWxlP3BhcnNlRmxvYXQoZi5jc3MoYixkLGE/XCJtYXJnaW5cIjpcImJvcmRlclwiKSk6dGhpc1tkXSgpOm51bGx9LGYuZm5bZF09ZnVuY3Rpb24oYSl7dmFyIGU9dGhpc1swXTtpZighZSlyZXR1cm4gYT09bnVsbD9udWxsOnRoaXM7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7dmFyIGM9Zih0aGlzKTtjW2RdKGEuY2FsbCh0aGlzLGIsY1tkXSgpKSl9KTtpZihmLmlzV2luZG93KGUpKXt2YXIgZz1lLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFtcImNsaWVudFwiK2NdLGg9ZS5kb2N1bWVudC5ib2R5O3JldHVybiBlLmRvY3VtZW50LmNvbXBhdE1vZGU9PT1cIkNTUzFDb21wYXRcIiYmZ3x8aCYmaFtcImNsaWVudFwiK2NdfHxnfWlmKGUubm9kZVR5cGU9PT05KXJldHVybiBNYXRoLm1heChlLmRvY3VtZW50RWxlbWVudFtcImNsaWVudFwiK2NdLGUuYm9keVtcInNjcm9sbFwiK2NdLGUuZG9jdW1lbnRFbGVtZW50W1wic2Nyb2xsXCIrY10sZS5ib2R5W1wib2Zmc2V0XCIrY10sZS5kb2N1bWVudEVsZW1lbnRbXCJvZmZzZXRcIitjXSk7aWYoYT09PWIpe3ZhciBpPWYuY3NzKGUsZCksaj1wYXJzZUZsb2F0KGkpO3JldHVybiBmLmlzTnVtZXJpYyhqKT9qOml9cmV0dXJuIHRoaXMuY3NzKGQsdHlwZW9mIGE9PVwic3RyaW5nXCI/YTphK1wicHhcIil9fSksYS5qUXVlcnk9YS4kPWYsdHlwZW9mIGRlZmluZT09XCJmdW5jdGlvblwiJiZkZWZpbmUuYW1kJiZkZWZpbmUuYW1kLmpRdWVyeSYmZGVmaW5lKFwianF1ZXJ5XCIsW10sZnVuY3Rpb24oKXtyZXR1cm4gZn0pfTsiLCJtb2R1bGUuZXhwb3J0cyA9IChmdW5jdGlvbigkKXtcblxuICByZXF1aXJlKCcuL2pxdWVyeS5taXNjLXBsdWdpbnMuanMnKSgkKTtcbiAgcmVxdWlyZSgnLi9qcXVlcnkudGlwdGlwLmpzJykoJCk7ICBcbiAgcmVxdWlyZSgnLi9qcXVlcnkuZmFyYnRhc3RpYy5qcycpKCQpO1xuICBcbiAgdmFyIF8gPSByZXF1aXJlKCcuLi91bmRlcnNjb3JlLm1pbi5qcycpO1xuICAvLyBTdW0gZWxlbWVudHMgb2YgYW4gYXJyYXlcbiAgXy5zdW0gPSBmdW5jdGlvbihhcnIpIHsgcmV0dXJuIF8ucmVkdWNlKGFyciwgZnVuY3Rpb24obWVtbywgbmV4dCkgeyByZXR1cm4gbWVtbyArIG5leHQ7IH0sIDApOyB9XG5cbiAgdmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy5qcycpKCQpLFxuICAgIGNsYXNzRnJpZW5kbHkgPSB1dGlscy5jbGFzc0ZyaWVuZGx5LFxuICAgIGZwcyA9IHV0aWxzLmZwcyxcbiAgICBiYXNlbmFtZSA9IHV0aWxzLmJhc2VuYW1lLFxuICAgIGZsb29ySGFjayA9IHV0aWxzLmZsb29ySGFjayxcbiAgICBkZWNvZGVTYWZlT2N0ZXRzID0gdXRpbHMuZGVjb2RlU2FmZU9jdGV0cyxcbiAgICByZWdFeHBRdW90ZSA9IHV0aWxzLnJlZ0V4cFF1b3RlO1xuXG4gIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAvL1xuICAvLyBXZSBoYXZlIHRocmVlIHdpZGdldHMgdGhhdCBhcmUgYnVpbHQgb24gdGhlIGpRdWVyeSBVSSAkLndpZGdldCBmcmFtZXdvcmtcbiAgLy8gICAgMSkgJC51aS5nZW5vYnJvd3NlclxuICAvLyAgICAyKSAkLnVpLmdlbm9saW5lXG4gIC8vICAgIDMpICQudWkuZ2Vub3RyYWNrXG4gIC8vXG4gIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIHJlcXVpcmUoJy4vanF1ZXJ5LXVpLmdlbm9saW5lLmpzJykoJCk7XG4gIHJlcXVpcmUoJy4vanF1ZXJ5LXVpLmdlbm90cmFjay5qcycpKCQpO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyA9ICQudWkuZ2Vub2Jyb3dzZXIgaXMgdGhlIGNlbnRyYWwgd2lkZ2V0IHRoYXQgY29vcmRpbmF0ZXMgdGhlIGZyb250LWVuZCBvZiBjaHJvbW96b29tID1cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgJC53aWRnZXQoJ3VpLmdlbm9icm93c2VyJywge1xuXG4gICAgLy8gRGVmYXVsdCBvcHRpb25zIHRoYXQgYXJlIG92ZXJyaWRkZW4gYnkgdGhlIGdlbm9tZSBKU09OIGNvbmZpZ3VyYXRpb24gd2hlbiB0aGlzIHdpZGdldCBpcyBpbnN0YW50aWF0ZWRcbiAgICBvcHRpb25zOiB7XG4gICAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgICBiZXR3ZWVuTGluZXM6IDIwLFxuICAgICAgdGlsZVdpZHRoOiAxMDAwLFxuICAgICAgZ2Vub21lOiAnaGcxOCcsXG4gICAgICBnZW5vbWVTaXplOiAzMDgwNDE5NDgwLFxuICAgICAgc2lkZUJhcldpZHRoOiAxMDAsXG4gICAgICB0cmFja3M6IFtcbiAgICAgICAge246J3J1bGVyJywgaDo1MCwgczpbJ2RlbnNlJ119XG4gICAgICBdLFxuICAgICAgY2hyT3JkZXI6IFtdLFxuICAgICAgY2hyTGVuZ3Roczoge30sXG4gICAgICBjaHJCYW5kczogW10sXG4gICAgICBhdmFpbFRyYWNrczogW10sXG4gICAgICB0aWxlRGlyOiAnby8nLFxuICAgICAgYWpheERpcjogJ3BocC8nLFxuICAgICAgYnBwcHM6IFsyLjllNV0sXG4gICAgICBvdmVyem9vbUJwcHBzOiBbXSxcbiAgICAgIGluaXRab29tOiAyLjllNSxcbiAgICAgIGlkZW9ncmFtc0Fib3ZlOiAzLjNlNCxcbiAgICAgIGJwcHBOdW1iZXJzQmVsb3c6IFszLjNlNCwgMy4zZTNdLFxuICAgICAgbnRzQmVsb3c6IFsxLCAwLjFdLFxuICAgICAgbmF2QmFyOiAnI25hdmJhcicsXG4gICAgICBmb290ZXJCYXI6ICcjZm9vdGVyYmFyJyxcbiAgICAgIHpvb21TbGlkZXI6ICcjem9vbScsXG4gICAgICB6b29tQnRuczogWycjem9vbS1pbicsICcjem9vbS1vdXQnXSxcbiAgICAgIHRyYWNrUGlja2VyOiBbJyN0cmFja3MnLCAnI3RyYWNrLXBpY2tlcicsICcjY3VzdG9tLXRyYWNrcycsICcjY3VzdG9tLXBpY2tlciddLFxuICAgICAganVtcDogWycjbG9jJywgJyNqdW1wJywgJyNsb2MtcGlja2VyJ10sXG4gICAgICBnZW5vbWVQaWNrZXI6IFsnI2dlbm9tZScsICcjZ2Vub21lLXBpY2tlciddLFxuICAgICAgbGluZU1vZGU6ICcjbGluZS1tb2RlJyxcbiAgICAgIGxpbmtpbmc6IFsnI2xpbmtpbmcnLCAnI2xpbmstcGlja2VyJ10sXG4gICAgICBvdmVybGF5OiBbJyNvdmVybGF5JywgJyNvdmVybGF5LW1lc3NhZ2UnXSxcbiAgICAgIGxpbmVGaXhEdXJhdGlvbjogNTAwLFxuICAgICAgcmV0aWNPcGFjaXR5OiAwLjgsXG4gICAgICB2ZXJ0aWNhbERyYWdEZWFkWm9uZTogMTIsXG4gICAgICBtYXhOdFJlcXVlc3Q6IDIwMDAwLFxuICAgICAgYm91bmNlTWFyZ2luOiAwLjIsXG4gICAgICBkaWFsb2dzOiBbJyNjdXN0b20tZGlhbG9nJywgJyNxdWlja3N0YXJ0JywgJyNhYm91dCcsICcjb2xkLW1zaWUnLCAnI2Nocm9tLXNpemVzLWRpYWxvZycsICcjY3VzdG9tLWdlbm9tZS1kaWFsb2cnLCAnI2JpbmFyaWVzLXdhcm5pbmctZGlhbG9nJ10sXG4gICAgICB1Y3NjVVJMOiAnaHR0cDovL2dlbm9tZS51Y3NjLmVkdS9jZ2ktYmluL2hnVHJhY2tzJyxcbiAgICAgIHRyYWNrRGVzY1VSTDogJ2h0dHA6Ly9nZW5vbWUudWNzYy5lZHUvY2dpLWJpbi9oZ1RyYWNrVWknLFxuICAgICAgYnBwcEZvcm1hdDogZnVuY3Rpb24oYnBwcCkgeyByZXR1cm4gYnBwcC50b0V4cG9uZW50aWFsKDIpLnJlcGxhY2UoLyhcXCt8LSkoXFxkKSQvLCAnJDEwJDInKTsgfSxcbiAgICAgIHVzZUNhbnZhc1RpY2tzOiB0cnVlLFxuICAgICAgc2F2YWJsZVBhcmFtczoge3Nlc3Npb246IFsncG9zaXRpb24nLCAndHJhY2tzJ10sIHBlcnNpc3RlbnQ6IFsnbW9kZSddfVxuICAgICAgLy8sc25hcFpvb206IHRydWVcbiAgICAgIC8vLHNuYXBab29tQWZ0ZXI6IDIwMFxuICAgIH0sXG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vID0gVGhlIGZvbGxvd2luZyBfaW5pdCBmdW5jdGlvbnMgaGFuZGxlIGluc3RhbnRpYXRpb24tcmVsYXRlZCB0YXNrcyA9XG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgIC8vIENhbGxlZCBhdXRvbWF0aWNhbGx5IHdoZW4gd2lkZ2V0IGlzIGluc3RhbnRpYXRlZFxuICAgIF9pbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsIFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zO1xuICAgICAgXG4gICAgICAvLyBTZXR1cCBpbnRlcm5hbCB2YXJpYWJsZXNcbiAgICAgIHNlbGYuX2luaXRJbnN0YW5jZVZhcnMoKTtcbiAgICAgIFxuICAgICAgLy8gSW5pdGlhbGl6ZSBzb21lIG9mIHRoZSBuYXZiYXIgd2lkZ2V0c1xuICAgICAgc2VsZi4kc2xpZGVyID0gc2VsZi5faW5pdFNsaWRlcigpO1xuICAgICAgc2VsZi4kdHJhY2tQaWNrZXIgPSBzZWxmLl9pbml0VHJhY2tQaWNrZXIoKTtcbiAgICAgIHNlbGYuJGN1c3RvbVRyYWNrcyA9IHNlbGYuX2luaXRDdXN0b21UcmFja3MoKTtcbiAgICAgIHNlbGYuJGxpbmtzID0gc2VsZi5faW5pdExpbmtpbmcoKTtcbiAgICAgIFxuICAgICAgLy8gRGVib3VuY2Ugc29tZSBvZiB0aGUgaGFuZGxlciBmdW5jdGlvbnM7IHRoaXMgcHJldmVudHMgaXQgZnJvbSBmaXJpbmcgbW9yZSB0aGFuIG9uY2UgcGVyIFggbWlsbGlzZWNvbmRzXG4gICAgICAvLyBUaGlzIGN1dHMgZG93biBvbiB0aGUgbG9hZCBvZiBzb21lIG9mIHRoZSBtb3JlIGV4cGVuc2l2ZSBhY3Rpb25zXG4gICAgICBzZWxmLl9maW5pc2hab29tRGVib3VuY2VkID0gXy5kZWJvdW5jZShzZWxmLl9maW5pc2hab29tRGVib3VuY2VkLCBvLnNuYXBab29tQWZ0ZXIgfHwgNTAwKTtcbiAgICAgIHNlbGYuX3VwZGF0ZVJldGljbGVEZWJvdW5jZWQgPSBfLmRlYm91bmNlKHNlbGYuX3VwZGF0ZVJldGljbGUsIG8uc25hcFpvb21BZnRlciB8fCA1MDApO1xuICAgICAgc2VsZi5fbm9ybWFsaXplUG9zRGVib3VuY2VkID0gXy5kZWJvdW5jZShzZWxmLm5vcm1hbGl6ZVBvcywgMjAwKTtcbiAgICAgIHNlbGYuX2ZpeFpvb21lZFRyYWNrRGVib3VuY2VkID0gXy5kZWJvdW5jZShzZWxmLl9maXhab29tZWRUcmFja0RlYm91bmNlZCwgNTAwKTtcbiAgICAgIHNlbGYuX2ZpeENsaWNrQXJlYXNEZWJvdW5jZWQgPSBfLmRlYm91bmNlKHNlbGYuX2ZpeENsaWNrQXJlYXNEZWJvdW5jZWQsIDUwMCk7XG4gICAgICBzZWxmLl9zYXZlUGFyYW1zRGVib3VuY2VkID0gXy5kZWJvdW5jZShzZWxmLl9zYXZlUGFyYW1zRGVib3VuY2VkLCA1MDApO1xuICAgICAgXG4gICAgICAvLyBCaW5kIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgd2luZG93IGFuZCBtYWluIHdpZGdldHNcbiAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oZSwgY2FsbGJhY2spIHsgXG4gICAgICAgIGlmICh0aGlzID09IGUudGFyZ2V0KSB7XG4gICAgICAgICAgc2VsZi5fd2lkdGggPSAkZWxlbS53aWR0aCgpO1xuICAgICAgICAgIHNlbGYuX2ZpeE51bUxpbmVzKG51bGwsIHtkdXJhdGlvbjogMCwgY29tcGxldGU6IGNhbGxiYWNrfSk7XG4gICAgICAgICAgJChvLm5hdkJhcikudG9nZ2xlQ2xhc3MoJ25hcnJvdycsIHNlbGYuX3dpZHRoIDwgOTUwKS5maW5kKCcucGlja2VyJykudHJpZ2dlcigncmVtYXhoZWlnaHQnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAkKGRvY3VtZW50LmJvZHkpLmJpbmQoJ0RPTU1vdXNlU2Nyb2xsIG1vdXNld2hlZWwnLCBfLmJpbmQoc2VsZi5fcmVjdlpvb20sIHNlbGYpKTtcbiAgICAgICQoby56b29tQnRuc1swXSkuY2xpY2soZnVuY3Rpb24oKSB7IGRlbGV0ZSBzZWxmLmNlbnRlcmVkT247IHNlbGYuX2FuaW1hdGVab29tKHRydWUsIDEwMDApOyB9KTtcbiAgICAgICQoby56b29tQnRuc1sxXSkuY2xpY2soZnVuY3Rpb24oKSB7IGRlbGV0ZSBzZWxmLmNlbnRlcmVkT247IHNlbGYuX2FuaW1hdGVab29tKGZhbHNlLCAxMDAwKTsgfSk7XG4gICAgICAkZWxlbS5tb3VzZWVudGVyKGZ1bmN0aW9uKCkgeyBzZWxmLnNob3dSZXRpY2xlKCdtb3VzZUFyZWEnLCBmYWxzZSk7IH0pO1xuICAgICAgJGVsZW0ubW91c2VsZWF2ZShmdW5jdGlvbigpIHsgc2VsZi5zaG93UmV0aWNsZSgnbW91c2VBcmVhJywgdHJ1ZSk7IH0pO1xuICAgICAgJChvLmxpbmVNb2RlKS5idXR0b25zZXQoKS5jbGljayhmdW5jdGlvbigpIHsgc2VsZi5fZml4TnVtTGluZXMoc2VsZi5jZW50cmFsTGluZSk7IH0pO1xuICAgICAgJChvLmxpbmVNb2RlKS5maW5kKCdpbnB1dCxhJykuZm9jdXMoZnVuY3Rpb24oKSB7IHZhciAkdCA9ICQodGhpcyk7IF8uZGVmZXIoZnVuY3Rpb24oKSB7ICR0LmJsdXIoKTsgfSk7IH0pO1xuICAgICAgJGVsZW0uYmluZCgndHJhY2tsb2FkJywgXy5iaW5kKHNlbGYuX3JlY3ZUcmFja0xvYWQsIHNlbGYpKTtcbiAgICAgICQod2luZG93KS5iaW5kKCdwb3BzdGF0ZScsIGZ1bmN0aW9uKCkgeyBzZWxmLl9pbml0RnJvbVBhcmFtcyhudWxsLCB0cnVlKTsgfSk7XG4gICAgICBcbiAgICAgIC8vIEluaXRpYWxpemUgdGhlIGZvb3RlciwgdGhlIHNlYXJjaCBiYXIsIGhvdGtleXMsIHRoZSBBSkFYIHByb3h5LCBtb2JpbGUgaW50ZXJhY3Rpb25zLCBJRSBmaXhlc1xuICAgICAgLy8gRmluYWxseSwgYXBwbHkgcGFyYW1zIGZyb20gZWl0aGVyIHRoZSBVUkwgb3IgdGhlIHNlc3Npb24gc3RhdGVcbiAgICAgIHNlbGYuX2luaXRGb290ZXIoKTtcbiAgICAgIHNlbGYuX2luaXRKdW1wKCk7XG4gICAgICBzZWxmLl9pbml0SG90a2V5cygpO1xuICAgICAgc2VsZi5faW5pdEFqYXgoKTtcbiAgICAgIHNlbGYuX2luaXRNb2JpbGVGZWF0dXJlcygpO1xuICAgICAgaWYgKCQuYnJvd3Nlci5tc2llKSB7IHNlbGYuX2luaXRJRUZpeGVzKCk7IH1cbiAgICAgICQod2luZG93KS50cmlnZ2VyKCdyZXNpemUnLCBmdW5jdGlvbigpIHsgc2VsZi5faW5pdEZyb21QYXJhbXMobnVsbCwgdHJ1ZSk7IH0pO1xuICAgIH0sXG4gICAgXG4gICAgLy8gQ2FsbGVkIHdoZW4gYSBuZXcgb3B0aW9ucyBvYmplY3QgaXMgcGFzc2VkIGluLCB0eXBpY2FsbHkgYWZ0ZXIgYSBjdXN0b20gZ2Vub21lIGlzIGxvYWRlZFxuICAgIF9zZXRPcHRpb25zOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgICRlbGVtID0gc2VsZi5lbGVtZW50LFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICB0cmFja3NUb1BhcnNlLFxuICAgICAgICBmaW5pc2hTZXR1cEFmdGVyUGFyc2luZyxcbiAgICAgICAgJG92ZXJsYXkgPSAkKG8ub3ZlcmxheVswXSksXG4gICAgICAgICRvdmVybGF5TWVzc2FnZSA9ICQoby5vdmVybGF5WzFdKSxcbiAgICAgICAgbmV4dERpcmVjdGl2ZXMgPSBfLmV4dGVuZCh7fSwgc2VsZi5fbmV4dERpcmVjdGl2ZXMpO1xuICAgICAgc2VsZi5fcmVzZXRDdXN0b21UcmFja3MoKTtcbiAgICAgIHNlbGYuX3JlbW92ZUxpbmVzKHNlbGYuJGxpbmVzLmxlbmd0aCwge2R1cmF0aW9uOiAwfSk7XG5cbiAgICAgIG8gPSBfLmV4dGVuZChzZWxmLm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgXG4gICAgICBzZWxmLl9pbml0SW5zdGFuY2VWYXJzKCk7XG4gICAgICBcbiAgICAgIHRyYWNrc1RvUGFyc2UgPSBfLmZpbHRlcihvLmF2YWlsVHJhY2tzLCBmdW5jdGlvbih0KSB7IHJldHVybiB0LmN1c3RvbURhdGE7IH0pO1xuICAgICAgLy8gYSBzdWJzZXQgb2Ygb3B0aW9ucyB0aGF0IEN1c3RvbVRyYWNrcyBuZWVkcyB0byBwYXJzZSB0cmFja3NcbiAgICAgIGZ1bmN0aW9uIGJyb3dzZXJPcHRzKCkge1xuICAgICAgICB2YXIgcG9zID0gbmV4dERpcmVjdGl2ZXMucG9zaXRpb24gJiYgc2VsZi5ub3JtYWxpemVQb3MobmV4dERpcmVjdGl2ZXMucG9zaXRpb24sIHRydWUpO1xuICAgICAgICBwb3MgPSBwb3MgPyBwb3MucG9zIDogc2VsZi5wb3M7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYnBwcHM6IG8uYnBwcHMsXG4gICAgICAgICAgY2hyUG9zOiBzZWxmLmNoclBvcyxcbiAgICAgICAgICBwb3M6IHBvcyxcbiAgICAgICAgICBjaHJMZW5ndGhzOiBvLmNockxlbmd0aHMsXG4gICAgICAgICAgZ2Vub21lU2l6ZTogby5nZW5vbWVTaXplLFxuICAgICAgICAgIGFqYXhEaXI6IG8uYWpheERpclxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBmaW5pc2hTZXR1cCgpIHtcbiAgICAgICAgXy5lYWNoKG8udHJhY2tzLCBmdW5jdGlvbih0KXsgXG4gICAgICAgICAgJC5leHRlbmQodCwgc2VsZi5hdmFpbFRyYWNrc1t0Lm5dKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBzZWxmLiRzbGlkZXIgPSBzZWxmLl9pbml0U2xpZGVyKCk7XG4gICAgICAgIHNlbGYuJHRyYWNrUGlja2VyID0gc2VsZi5faW5pdFRyYWNrUGlja2VyKCk7XG4gICAgICAgIHNlbGYuX3VwZGF0ZUdlbm9tZXMoKTtcbiAgICAgIFxuICAgICAgICAkb3ZlcmxheS5hZGQoJG92ZXJsYXlNZXNzYWdlKS5oaWRlKCk7XG4gICAgICAgICQod2luZG93KS50cmlnZ2VyKCdyZXNpemUnLCBmdW5jdGlvbigpIHsgXG4gICAgICAgICAgc2VsZi5fbmV4dERpcmVjdGl2ZXMgPSB7fTtcbiAgICAgICAgICBpZiAoXy5rZXlzKG5leHREaXJlY3RpdmVzKS5sZW5ndGgpIHsgc2VsZi5faW5pdEZyb21QYXJhbXMobmV4dERpcmVjdGl2ZXMpOyB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAodHJhY2tzVG9QYXJzZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZpbmlzaFNldHVwQWZ0ZXJQYXJzaW5nID0gXy5hZnRlcih0cmFja3NUb1BhcnNlLmxlbmd0aCwgZmluaXNoU2V0dXApO1xuICAgICAgICBfLmVhY2godHJhY2tzVG9QYXJzZSwgZnVuY3Rpb24odCkge1xuICAgICAgICAgIEN1c3RvbVRyYWNrcy5wYXJzZUFzeW5jKHQuY3VzdG9tRGF0YSwgYnJvd3Nlck9wdHMoKSwgZnVuY3Rpb24oY3VzdG9tVHJhY2tzKSB7XG4gICAgICAgICAgICB2YXIgY3VzdG9tVHJhY2sgPSBjdXN0b21UcmFja3NbMF07IC8vIHQuY3VzdG9tRGF0YSBzaG91bGQgb25seSBjb250YWluIGRhdGEgZm9yIG9uZSB0cmFja1xuICAgICAgICAgICAgXy5lYWNoKG8uYnBwcHMsIGZ1bmN0aW9uKGJwcHApIHsgXG4gICAgICAgICAgICAgIHNlbGYuYXZhaWxUcmFja3NbdC5uXS5maFtvLmJwcHBGb3JtYXQoYnBwcCldID0ge2RlbnNlOiBjdXN0b21UcmFjay5oZWlnaHRzLm1pbn07IFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzZWxmLmF2YWlsVHJhY2tzW3Qubl0uY3VzdG9tID0gdC5jdXN0b20gPSBjdXN0b21UcmFjaztcbiAgICAgICAgICAgIGZpbmlzaFNldHVwQWZ0ZXJQYXJzaW5nKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHsgZmluaXNoU2V0dXAoKTsgfVxuICAgIH0sXG4gICAgXG4gICAgX2luaXRJbnN0YW5jZVZhcnM6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgcCA9IDA7XG4gICAgICAgIFxuICAgICAgLy8gU2V0dXAgaW50ZXJuYWwgdmFyaWFibGVzIHJlbGF0ZWQgdG8gY2hyb21vc29tZSBiYW5kcywgbGVuZ3RocywgYW5kIGF2YWlsYWJsZSB0cmFja3NcbiAgICAgIHNlbGYuY2hyUG9zID0ge307XG4gICAgICBvLmNockxhYmVscyA9IFtdO1xuICAgICAgXy5lYWNoKG8uY2hyT3JkZXIsIGZ1bmN0aW9uKHYsIGkpeyBcbiAgICAgICAgby5jaHJMYWJlbHMucHVzaCh7cDogcCwgbjogdiwgdzogby5jaHJMZW5ndGhzW3ZdfSk7IHNlbGYuY2hyUG9zW3ZdID0gcDsgcCArPSBvLmNockxlbmd0aHNbdl07XG4gICAgICB9KTtcbiAgICAgIG8uY2hyTGFiZWxzLnB1c2goe3A6IHAsIG46ICcnLCBlbmQ6IHRydWV9KTsgLy8gb25lIG1vcmUgbGFiZWwgZm9yIHRoZSBlbmQgb2YgdGhlIGxhc3QgY2hyb21vc29tZVxuICAgICAgXy5lYWNoKG8uY2hyQmFuZHMsIGZ1bmN0aW9uKHYpeyB2WzVdID0gdlsxXTsgdlsxXSArPSBzZWxmLmNoclBvc1t2WzBdXTsgdlsyXSArPSBzZWxmLmNoclBvc1t2WzBdXTsgfSk7XG4gICAgICBvLmNockJhbmRzID0gby5jaHJCYW5kcyAmJiBfLnNvcnRCeShvLmNockJhbmRzLCBmdW5jdGlvbih2KSB7IHJldHVybiBfLmluZGV4T2Yoby5jaHJPcmRlciwgdlswXSkgKiBvLmdlbm9tZVNpemUgKyB2WzFdOyB9KTtcbiAgICAgIHNlbGYuYXZhaWxUcmFja3MgPSB7fTtcbiAgICAgIHNlbGYuZGVmYXVsdFRyYWNrcyA9IFtdO1xuICAgICAgXy5lYWNoKG8uYXZhaWxUcmFja3MsIGZ1bmN0aW9uKHYpIHsgc2VsZi5hdmFpbFRyYWNrc1t2Lm5dID0gJC5leHRlbmQoe30sIHYsIHtvaDogdi5ofSk7IH0pO1xuICAgICAgXy5lYWNoKG8udHJhY2tzLCBmdW5jdGlvbih0KXsgXG4gICAgICAgICQuZXh0ZW5kKHQsIHNlbGYuYXZhaWxUcmFja3NbdC5uXSk7XG4gICAgICAgIHNlbGYuZGVmYXVsdFRyYWNrcy5wdXNoKHtuOiB0Lm4sIGg6IHQuaH0pO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFNldHVwIHJlbWFpbmluZyBpbnRlcm5hbCB2YXJpYWJsZXNcbiAgICAgIHNlbGYuJGxpbmVzID0gJGVsZW0uY2hpbGRyZW4oJy5icm93c2VyLWxpbmUnKTtcbiAgICAgIHNlbGYucG9zID0gMTsgLy8gdGhpcyBpcyB0aGUgYnAgcG9zaXRpb24gb2YgdGhlIGxlZnQgc2lkZSBvZiB0aGUgdG9wIGxpbmVcbiAgICAgIHNlbGYuYnBwcCA9IG8uaW5pdFpvb207XG4gICAgICBzZWxmLl9kZW5zaXR5T3JkZXIgPSB7fTtcbiAgICAgIHNlbGYuX2RlbnNpdHlPcmRlckZvciA9IHt9O1xuICAgICAgc2VsZi5fYXJlYUluZGV4ID0ge307XG4gICAgICBzZWxmLl9hcmVhSG92ZXIgPSBudWxsO1xuICAgICAgc2VsZi5fdGlsZUZpeGluZ0VuYWJsZWQgPSB0cnVlO1xuICAgICAgc2VsZi5fc2hvd1JldGljbGUgPSB7bW91c2VBcmVhOiBmYWxzZSwgZHJhZ2dpbmc6IGZhbHNlLCBob3RLZXlzOiBmYWxzZX07XG4gICAgICBzZWxmLl9kZWZhdWx0TGluZU1vZGUgPSAkKG8ubGluZU1vZGUpLmZpbmQoJzpjaGVja2VkJykudmFsKCk7XG4gICAgICBzZWxmLl9kbmEgPSB7fTtcbiAgICB9LFxuICAgIFxuICAgIF9pbml0U2xpZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgIGlmICghby5vdmVyem9vbUJwcHBzKSB7IG8ub3Zlcnpvb21CcHBwcyA9IFtdOyB9XG4gICAgICBcbiAgICAgIHZhciAkc2xpZGVyID0gJChvLnpvb21TbGlkZXIpLFxuICAgICAgICBudW1CcHBwcyA9IG8uYnBwcHMubGVuZ3RoICsgby5vdmVyem9vbUJwcHBzLmxlbmd0aCxcbiAgICAgICAgc2xpZGVyV2lkdGggPSAobnVtQnBwcHMgLSAxKSAqIDEwLFxuICAgICAgICBzbGlkZXJCcHBwcyA9IChzZWxmLnNsaWRlckJwcHBzID0gby5icHBwcy5jb25jYXQoby5vdmVyem9vbUJwcHBzKSksXG4gICAgICAgIHByZXZWYWxzID0gW10sXG4gICAgICAgICR0aWNrcztcbiAgICAgIFxuICAgICAgZnVuY3Rpb24gc3RhcnQoZSwgdWkpIHsgZGVsZXRlIHNlbGYuY2VudGVyZWRPbjsgfTtcbiAgICAgIGZ1bmN0aW9uIHNsaWRlKGUsIHVpKSB7XG4gICAgICAgIHZhciBpZHggPSBmbG9vckhhY2sodWkudmFsdWUpLFxuICAgICAgICAgIGZyYWMgPSB1aS52YWx1ZSAtIGlkeCxcbiAgICAgICAgICB6b29tLCBrO1xuICAgICAgICAvLyBVc2luZyB0aGUgYXJyb3cga2V5cyB3aXRoIHRoZSBzbGlkZXIgZm9jdXNlZCBzaG91bGQgYW5pbWF0ZSBiZXR3ZWVuIG9wdGltYWwgbGV2ZWxzXG4gICAgICAgIGlmIChlLm9yaWdpbmFsRXZlbnQgJiYgZS5vcmlnaW5hbEV2ZW50LnR5cGU9PVwia2V5ZG93blwiICYmIChrID0gZS5vcmlnaW5hbEV2ZW50LmtleUNvZGUpKSB7XG4gICAgICAgICAgaWYgKGsgPj0gMzcgJiYgayA8PSA0MCkgeyBzZWxmLl9hbmltYXRlWm9vbShrID09IDM4IHx8IGsgPT0gMzksIDEwMDApOyByZXR1cm47IH1cbiAgICAgICAgfVxuICAgICAgICBwcmV2VmFscyA9IHByZXZWYWxzLmNvbmNhdChbdWkudmFsdWVdKS5zbGljZSgtMik7XG4gICAgICAgIGlmIChmcmFjID09PSAwLjApIHsgc2VsZi5fem9vbShzbGlkZXJCcHBwc1tpZHhdKTsgfVxuICAgICAgICBlbHNlIHsgc2VsZi5fem9vbSgoc2xpZGVyQnBwcHNbaWR4ICsgMV0gLSBzbGlkZXJCcHBwc1tpZHhdKSAqIGZyYWMgKyBzbGlkZXJCcHBwc1tpZHhdKTsgfVxuICAgICAgfTtcbiAgICAgIGZ1bmN0aW9uIHN0b3AoZSwgdWkpIHtcbiAgICAgICAgaWYgKGUub3JpZ2luYWxFdmVudCAmJiBlLm9yaWdpbmFsRXZlbnQudHlwZT09XCJrZXl1cFwiKSB7IHJldHVybjsgfVxuICAgICAgICB2YXIgZGlyZWN0aW9uID0gcHJldlZhbHNbMF0gPCB1aS52YWx1ZTtcbiAgICAgICAgby5zbmFwWm9vbUFmdGVyICYmIF8uZGVmZXIoZnVuY3Rpb24oKSB7IHNlbGYuX2FuaW1hdGVab29tKGRpcmVjdGlvbik7IH0pO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgJHNsaWRlci5wYXJlbnQoKS5jaGlsZHJlbignLnRpY2tzJykucmVtb3ZlKCk7XG4gICAgICAkdGlja3MgPSAkKCc8ZGl2IGNsYXNzPVwidGlja3NcIi8+JykuYXBwZW5kVG8oJHNsaWRlci5wYXJlbnQoKSk7XG4gICAgICAkdGlja3MuaHRtbChuZXcgQXJyYXkobnVtQnBwcHMgKyAxKS5qb2luKCc8ZGl2IGNsYXNzPVwidGlja1wiLz4nKSk7XG4gICAgICBcbiAgICAgIGlmICgkc2xpZGVyLmhhc0NsYXNzKCd1aS1zbGlkZXInKSkgeyAkc2xpZGVyLnNsaWRlcignZGVzdHJveScpOyB9XG4gICAgICAkc2xpZGVyLnBhcmVudCgpLndpZHRoKHNsaWRlcldpZHRoKTtcbiAgICAgIHJldHVybiAkc2xpZGVyLndpZHRoKHNsaWRlcldpZHRoKS5zbGlkZXIoe1xuICAgICAgICBtaW46IDAsXG4gICAgICAgIG1heDogbnVtQnBwcHMgLSAxLFxuICAgICAgICBzdGVwOiAwLjAyLFxuICAgICAgICB2YWx1ZTogXy5pbmRleE9mKHNsaWRlckJwcHBzLCBvLmluaXRab29tKSxcbiAgICAgICAgc2xpZGU6IHNsaWRlLFxuICAgICAgICBjaGFuZ2U6IHNsaWRlLFxuICAgICAgICBzdGFydDogc3RhcnQsXG4gICAgICAgIHN0b3A6IHN0b3BcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgXG4gICAgLy8gVXRpbGl0eSBmdW5jdGlvbiB0byBhIGJpbmQgYSBidXR0b24gdG8gdG9nZ2xpbmcgdmlzaWJpbGl0eSBvZiBhIHNsaWRlLW91dCBtZW51LCBjYWxsZWQgYSBcInBpY2tlclwiXG4gICAgLy8gU2FmZSB0byBjYWxsIG11bHRpcGxlIHRpbWVzLlxuICAgIF9jcmVhdGVQaWNrZXI6IGZ1bmN0aW9uKCRidG4sICRwaWNrZXIsICRkb25lKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgICRlbGVtID0gJChzZWxmLmVsZW1lbnQpLFxuICAgICAgICBjbG9zZVBpY2tlciA9IGZ1bmN0aW9uKCkgeyAkcGlja2VyLnNsaWRlVXAoMTAwKTsgfTtcbiAgICAgICRwaWNrZXIudW5iaW5kKCdyZW1heGhlaWdodC5nZW5vYnJvd3NlcicpLmJpbmQoJ3JlbWF4aGVpZ2h0Lmdlbm9icm93c2VyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkdWwgPSAkKHRoaXMpLmNoaWxkcmVuKCd1bCcpLFxuICAgICAgICAgIHZpc2libGUgPSAkKHRoaXMpLmlzKCc6dmlzaWJsZScpLFxuICAgICAgICAgIGZvcm1MaW5lSGVpZ2h0cztcbiAgICAgICAgaWYgKCF2aXNpYmxlKSB7ICQodGhpcykuc2hvdygpOyB9IC8vIGNhbid0IG1ha2UgbWVhc3VyZW1lbnRzIHdoaWxlIGhpZGRlblxuICAgICAgICBmb3JtTGluZUhlaWdodHMgPSBfLm1hcCgkdWwubmV4dEFsbCgpLCBmdW5jdGlvbihlbCkgeyBcbiAgICAgICAgICByZXR1cm4gTWF0aC5tYXgoJChlbCkub3V0ZXJIZWlnaHQoKSwgJChlbCkuZmluZCgndGV4dGFyZWEnKS5vdXRlckhlaWdodCgpKTsgXG4gICAgICAgIH0pO1xuICAgICAgICAkdWwuY3NzKCdtYXgtaGVpZ2h0JywgJGVsZW0ub3V0ZXJIZWlnaHQoKSAtIF8uc3VtKGZvcm1MaW5lSGVpZ2h0cykpO1xuICAgICAgICBpZiAoIXZpc2libGUpIHsgJCh0aGlzKS5oaWRlKCk7IH1cbiAgICAgIH0pO1xuICAgICAgJGJ0bi51bmJpbmQoJ2NsaWNrLmdlbm9icm93c2VyJykuYmluZCgnY2xpY2suZ2Vub2Jyb3dzZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCEkcGlja2VyLmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgJCgnYm9keScpLmJpbmQoJ21vdXNlZG93bi5waWNrZXInLCBmdW5jdGlvbihlKSB7IFxuICAgICAgICAgICAgaWYgKCQoZS50YXJnZXQpLmNsb3Nlc3QoJHBpY2tlci5hZGQoJGJ0bikpLmxlbmd0aCkgeyByZXR1cm47IH1cbiAgICAgICAgICAgIGNsb3NlUGlja2VyKCk7XG4gICAgICAgICAgICAkKCdib2R5JykudW5iaW5kKCdtb3VzZWRvd24ucGlja2VyJyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKCRidG4uaXMoJ2EudWktYnV0dG9uJykpIHsgJGJ0bi5hZGRDbGFzcygndWktc3RhdGUtYWN0aXZlJyk7IH1cbiAgICAgICAgICAkcGlja2VyLnRyaWdnZXIoJ3JlbWF4aGVpZ2h0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgJHBpY2tlci5zbGlkZVRvZ2dsZSgxMDApO1xuICAgICAgfSk7XG4gICAgICBpZiAoJGRvbmUpIHsgJGRvbmUudW5iaW5kKCdjbGljay5nZW5vYnJvd3NlcicpLmJpbmQoJ2NsaWNrLmdlbm9icm93c2VyJywgY2xvc2VQaWNrZXIpOyB9XG4gICAgICByZXR1cm4gJHBpY2tlci51bmJpbmQoJ2Nsb3NlLmdlbm9icm93c2VyJykuYmluZCgnY2xvc2UuZ2Vub2Jyb3dzZXInLCBjbG9zZVBpY2tlcik7XG4gICAgfSxcbiAgICBcbiAgICBfaW5pdEZvb3RlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgICRlbGVtID0gc2VsZi5lbGVtZW50LFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICAkZm9vdCA9ICQoby5mb290ZXJCYXIpLFxuICAgICAgICAkZ2Vub21lID0gJChvLmdlbm9tZVBpY2tlclswXSksXG4gICAgICAgICRnZW5vbWVQaWNrZXIgPSAkKG8uZ2Vub21lUGlja2VyWzFdKSxcbiAgICAgICAgJHVsID0gJCgnPHVsLz4nKS5hcHBlbmRUbygkZ2Vub21lUGlja2VyKSxcbiAgICAgICAgJHRpdGxlID0gJGdlbm9tZS5maW5kKCcudGl0bGUnKSxcbiAgICAgICAgJHRvZ2dsZUJ0biA9ICRnZW5vbWUuY2hpbGRyZW4oJ2lucHV0JykuZXEoMCksXG4gICAgICAgIHNwZWNpZXNQYXJlbnRoZXRpY2FsID0gby5zcGVjaWVzLm1hdGNoKC9cXCgoLispXFwpLyksXG4gICAgICAgICRiaW5hcnlXYXJuaW5nRGlhbG9nID0gJChvLmRpYWxvZ3NbNl0pLFxuICAgICAgICAkYTtcbiAgICAgIFxuICAgICAgJHVsLmFwcGVuZCgnPGxpIGNsYXNzPVwiZGl2aWRlclwiLz4nKVxuICAgICAgJGEgPSAkKCc8YSBjbGFzcz1cImNsaWNrYWJsZVwiLz4nKS5hdHRyKCdocmVmJywgby5kaWFsb2dzWzRdKS5hcHBlbmRUbygkKCc8bGkgY2xhc3M9XCJjaG9pY2VcIi8+JykuYXBwZW5kVG8oJHVsKSk7XG4gICAgICAkKCc8c3BhbiBjbGFzcz1cIm5hbWVcIi8+JykudGV4dCgnTW9yZSBnZW5vbWVzXFx1MjAyNicpLmFwcGVuZFRvKCRhKTtcbiAgICAgICQoJzxzcGFuIGNsYXNzPVwibG9uZy1kZXNjXCIvPicpLnRleHQoJ0ZldGNoIG9yIHNwZWNpZnkgY2hyb20gc2l6ZXMnKS5hcHBlbmRUbygkYSk7XG4gICAgICAkdWwuYXBwZW5kKCc8bGkgY2xhc3M9XCJkaXZpZGVyXCIvPicpXG4gICAgICAkYSA9ICQoJzxhIGNsYXNzPVwiY2xpY2thYmxlXCIvPicpLmF0dHIoJ2hyZWYnLCBvLmRpYWxvZ3NbNV0pLmFwcGVuZFRvKCQoJzxsaSBjbGFzcz1cImNob2ljZVwiLz4nKS5hcHBlbmRUbygkdWwpKTtcbiAgICAgICQoJzxzcGFuIGNsYXNzPVwibmFtZVwiLz4nKS50ZXh0KCdMb2FkIGZyb20gZmlsZSBvciBVUkxcXHUyMDI2JykuYXBwZW5kVG8oJGEpO1xuICAgICAgJCgnPHNwYW4gY2xhc3M9XCJsb25nLWRlc2NcIi8+JykudGV4dCgnaW4gR2VuQmFuaywgRkFTVEEsIG9yIEVNQkwgZm9ybWF0JykuYXBwZW5kVG8oJGEpO1xuICAgICAgXG4gICAgICAkZ2Vub21lLmZpbmQoJy5jbGlja2FibGUnKS5ob3ZlcihmdW5jdGlvbigpIHsgJCh0aGlzKS5hZGRDbGFzcygnaG92ZXInKTsgfSwgZnVuY3Rpb24oKSB7ICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hvdmVyJyk7IH0pO1xuICAgICAgc2VsZi5fdXBkYXRlR2Vub21lcygpO1xuXG4gICAgICBzZWxmLl9jcmVhdGVQaWNrZXIoJHRvZ2dsZUJ0biwgJGdlbm9tZVBpY2tlcik7XG4gICAgICBcbiAgICAgIC8vIFNldHVwIHRoZSBkaWFsb2dzIHRoYXQgYXBwZWFyIHVwb24gY2xpY2tpbmcgZm9vdGVyYmFyIGxpbmtzXG4gICAgICBfLmVhY2goby5kaWFsb2dzLCBmdW5jdGlvbihpZCkge1xuICAgICAgICB2YXIgJGRpYWxvZyA9ICQoaWQpLmNsb3Nlc3QoJy51aS1kaWFsb2cnKTtcbiAgICAgICAgZnVuY3Rpb24gb3BlbkRpYWxvZygpIHsgXG4gICAgICAgICAgJCgnLnVpLWRpYWxvZycpLmhpZGUoKTtcbiAgICAgICAgICAkZGlhbG9nLmFkZENsYXNzKCd2aXNpYmxlJykuc2hvdygpO1xuICAgICAgICAgICRkaWFsb2cuZmluZCgnYVtocmVmXj1cImh0dHA6Ly9cIl0sYVtocmVmXj1cImh0dHBzOi8vXCJdJykuYXR0cigndGFyZ2V0JywgJ19ibGFuaycpO1xuICAgICAgICAgICRkaWFsb2cuY3NzKCd0b3AnLCBNYXRoLm1heCgoJGVsZW0ucGFyZW50KCkuaW5uZXJIZWlnaHQoKSAtICRkaWFsb2cub3V0ZXJIZWlnaHQoKSkgKiAwLjUsIDMwKSk7XG4gICAgICAgIH07XG4gICAgICAgICRkaWFsb2cuYmluZCgnb3Blbi5nZW5vYnJvd3NlcicsIG9wZW5EaWFsb2cpO1xuICAgICAgICAkZm9vdC5maW5kKCdhW2hyZWY9JytpZCsnXScpLmNsaWNrKGZ1bmN0aW9uKCkgeyAkZGlhbG9nLnRyaWdnZXIoJ29wZW4uZ2Vub2Jyb3dzZXInKTsgfSk7XG4gICAgICAgICRkaWFsb2cuZmluZCgnLnVpLWRpYWxvZy1idXR0b25wYW5lIGJ1dHRvbicpLmJ1dHRvbigpLm5vdCgnLmRvbnQtY2xvc2UnKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgICAkZGlhbG9nLmZhZGVPdXQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgc2VsZi5faW5pdEN1c3RvbUdlbm9tZURpYWxvZ3MoKTtcbiAgICAgIFxuICAgICAgLy8gU2hvdyB0aGUgcXVpY2tzdGFydCBzY3JlZW4gaWYgdGhlIHVzZXIgaGFzIG5ldmVyIGJlZW4gaGVyZSBiZWZvcmUgYW5kIHRoZSB2aWV3cG9ydCBpcyBiaWcgZW5vdWdoIHRvIHNob3cgaXRcbiAgICAgIGlmICgkLmNvb2tpZSgnZGInKT09PW51bGwgJiYgJCh3aW5kb3cpLndpZHRoKCkgPiA2MDAgJiYgJCh3aW5kb3cpLmhlaWdodCgpID4gNDIwKSB7IFxuICAgICAgICAkZm9vdC5maW5kKCdhW2hyZWY9XCInK28uZGlhbG9nc1sxXSsnXCJdJykuY2xpY2soKTtcbiAgICAgIH1cbiAgICAgIC8vIFNob3cgdGhlIHVuaW5zdGFsbGVkIGJpbmFyaWVzIHdhcm5pbmcsIGlmIGl0IHdhcyB3cml0dGVuIGludG8gdGhlIHBhZ2VcbiAgICAgIGlmICgkYmluYXJ5V2FybmluZ0RpYWxvZy5sZW5ndGgpIHsgJGJpbmFyeVdhcm5pbmdEaWFsb2cudHJpZ2dlcignb3Blbi5nZW5vYnJvd3NlcicpOyB9XG4gICAgfSxcbiAgICAgICAgXG4gICAgX2luaXRUcmFja1BpY2tlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgIGQgPSBvLnRyYWNrRGVzYyxcbiAgICAgICAgJHRvZ2dsZUJ0biA9ICQoby50cmFja1BpY2tlclswXSksXG4gICAgICAgICR0cmFja1BpY2tlciA9ICQoby50cmFja1BpY2tlclsxXSkuZW1wdHkoKSxcbiAgICAgICAgJHVsID0gJCgnPHVsLz4nKS5hcHBlbmRUbygkdHJhY2tQaWNrZXIpLFxuICAgICAgICAkZGl2ID0gJCgnPGRpdiBjbGFzcz1cImJ1dHRvbi1saW5lXCIvPicpLmFwcGVuZFRvKCR0cmFja1BpY2tlciksXG4gICAgICAgICRyZXNldCA9ICQoJzxpbnB1dCB0eXBlPVwiYnV0dG9uXCIgbmFtZT1cInJlc2V0XCIgdmFsdWU9XCJyZXNldFwiLz4nKS5hcHBlbmRUbygkZGl2KSxcbiAgICAgICAgJGIgPSAkKCc8aW5wdXQgdHlwZT1cImJ1dHRvblwiIG5hbWU9XCJkb25lXCIgdmFsdWU9XCJkb25lXCIvPicpLmFwcGVuZFRvKCRkaXYpO1xuICAgICAgXy5lYWNoKHNlbGYuYXZhaWxUcmFja3MsIGZ1bmN0aW9uKHQsIG4pIHtcbiAgICAgICAgLy8gVE9ETzogVGhpcyBuZWVkcyB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIHRyYWRpdGlvbmFsIGltYWdlIHRyYWNrcyBhbmQgY3VzdG9tIHRyYWNrcyBicm91Z2h0IGluXG4gICAgICAgIC8vICAgICAgIGJ5IGN1c3RvbSBnZW5vbWVzLiBUaGUgbGF0dGVyIHNob3VsZCBoYXZlIGFuIG9wdGlvbnMgZGlhbG9nIGFuZCBkb3dubG9hZCBsaW5rcyBpbnN0ZWFkIG9mIFwibW9yZSBpbmZvXCIuXG4gICAgICAgIHZhciAkbCA9ICQoJzxsYWJlbCBjbGFzcz1cImNsaWNrYWJsZVwiLz4nKS5hcHBlbmRUbygkKCc8bGkgY2xhc3M9XCJjaG9pY2VcIi8+JykuYXBwZW5kVG8oJHVsKSksXG4gICAgICAgICAgJGMgPSAkKCc8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIvPicpLmF0dHIoJ25hbWUnLCBuKS5wcmVwZW5kVG8oJGwpLFxuICAgICAgICAgICRkID0gJCgnPGRpdiBjbGFzcz1cImRlc2NcIj48L2Rpdj4nKS5hcHBlbmRUbygkbCksXG4gICAgICAgICAgaHJlZiA9IG8udHJhY2tEZXNjVVJMICsgJz9kYj0nICsgby5nZW5vbWUgKyAnJmc9JyArIG4gKyAnI1RSQUNLX0hUTUwnLFxuICAgICAgICAgICRhID0gZFtuXS5sZyA/ICQoJzxhIGNsYXNzPVwibW9yZVwiIHRhcmdldD1cIl9ibGFua1wiPm1vcmUgaW5mbyZoZWxsaXA7PC9hPicpLmF0dHIoJ2hyZWYnLCBocmVmKSA6ICcnO1xuICAgICAgICAkKCc8aDMvPicpLmFkZENsYXNzKCduYW1lJykudGV4dChkW25dLnNtKS5hcHBlbmQoJGEpLmFwcGVuZFRvKCRkKTtcbiAgICAgICAgaWYgKGRbbl0ubGcpIHsgJCgnPHAvPicpLmFkZENsYXNzKCdsb25nLWRlc2MnKS50ZXh0KGRbbl0ubGcpLmFwcGVuZFRvKCRkKTsgfVxuICAgICAgICBpZiAoXy5maW5kKG8udHJhY2tzLCBmdW5jdGlvbih0cmspIHsgcmV0dXJuIHRyay5uPT1uOyB9KSkgeyAkYy5hdHRyKCdjaGVja2VkJywgdHJ1ZSk7IH1cbiAgICAgICAgJGwuYmluZCgnY2xpY2snLCBmdW5jdGlvbihlKSB7IGlmICgkKGUudGFyZ2V0KS5pcygnYScpKSB7IGUuc3RvcFByb3BhZ2F0aW9uKCk7IH19KTtcbiAgICAgICAgJGwuYXR0cigndGl0bGUnLCBuKTtcbiAgICAgICAgJGwuaG92ZXIoZnVuY3Rpb24oKSB7ICQodGhpcykuYWRkQ2xhc3MoJ2hvdmVyJyk7IH0sIGZ1bmN0aW9uKCkgeyAkKHRoaXMpLnJlbW92ZUNsYXNzKCdob3ZlcicpOyB9KTtcbiAgICAgICAgJGMuYmluZCgnY2hhbmdlJywgXy5iaW5kKHNlbGYuX2ZpeFRyYWNrcywgc2VsZikpO1xuICAgICAgfSk7XG4gICAgICBpZiAoby50cmFja3MubGVuZ3RoID09PSAxKSB7ICR1bC5maW5kKCdpbnB1dFtuYW1lPScrby50cmFja3NbMF0ubisnXScpLmF0dHIoJ2Rpc2FibGVkJywgdHJ1ZSk7IH1cbiAgICAgICRyZXNldC5jbGljayhmdW5jdGlvbihlKSB7IHNlbGYuX3Jlc2V0VG9EZWZhdWx0VHJhY2tzKCk7IH0pO1xuICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZVBpY2tlcigkdG9nZ2xlQnRuLCAkdHJhY2tQaWNrZXIsICRiKS5oaWRlKCk7XG4gICAgfSxcbiAgICBcbiAgICBfaW5pdEN1c3RvbVRyYWNrczogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgICRlbGVtID0gc2VsZi5lbGVtZW50LFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICBmaWxlSW5wdXRIVE1MID0gJzxpbnB1dCB0eXBlPVwiZmlsZVwiIG5hbWU9XCJjdXN0b21GaWxlXCIvPicsXG4gICAgICAgIHVybElucHV0SFRNTCA9ICc8aW5wdXQgdHlwZT1cInVybFwiIG5hbWU9XCJjdXN0b21VcmxcIiBjbGFzcz1cInVybFwiLz48aW5wdXQgdHlwZT1cImJ1dHRvblwiIG5hbWU9XCJjdXN0b21VcmxHZXRcIiB2YWx1ZT1cImdvIVwiLz4nLFxuICAgICAgICAkdG9nZ2xlQnRuID0gJChvLnRyYWNrUGlja2VyWzJdKSxcbiAgICAgICAgJHBpY2tlciA9ICQoby50cmFja1BpY2tlclszXSkuaGlkZSgpLFxuICAgICAgICAkdWwgPSAkKCc8dWwvPicpLnByZXBlbmRUbygkcGlja2VyKSxcbiAgICAgICAgJGFkZCA9ICRwaWNrZXIuZmluZCgnLmZvcm0tbGluZScpLmZpcnN0KCksXG4gICAgICAgICRvdmVybGF5ID0gJChvLm92ZXJsYXlbMF0pLFxuICAgICAgICAkb3ZlcmxheU1lc3NhZ2UgPSAkKG8ub3ZlcmxheVsxXSksXG4gICAgICAgICR1cmxJbnB1dCwgJHVybEdldCwgJGRpdiwgJGIsICRyZXNldDtcbiAgICAgIFxuICAgICAgZnVuY3Rpb24gYnJvd3Nlck9wdHMoKSB7XG4gICAgICAgIHZhciBuZXh0RGlyZWN0aXZlcyA9IF8uZXh0ZW5kKHt9LCBzZWxmLl9uZXh0RGlyZWN0aXZlcyksXG4gICAgICAgICAgcG9zID0gbmV4dERpcmVjdGl2ZXMucG9zaXRpb24gJiYgc2VsZi5ub3JtYWxpemVQb3MobmV4dERpcmVjdGl2ZXMucG9zaXRpb24sIHRydWUpO1xuICAgICAgICBwb3MgPSBwb3MgPyBwb3MucG9zIDogc2VsZi5wb3M7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYnBwcHM6IG8uYnBwcHMsXG4gICAgICAgICAgY2hyUG9zOiBzZWxmLmNoclBvcyxcbiAgICAgICAgICBwb3M6IHBvcyxcbiAgICAgICAgICBjaHJMZW5ndGhzOiBvLmNockxlbmd0aHMsXG4gICAgICAgICAgZ2Vub21lU2l6ZTogby5nZW5vbWVTaXplLFxuICAgICAgICAgIGFqYXhEaXI6IG8uYWpheERpclxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgXG4gICAgICBzZWxmLl9jdXN0b21UcmFja1VybHMgPSB7XG4gICAgICAgIHJlcXVlc3RlZDogW10sXG4gICAgICAgIHByb2Nlc3Npbmc6IFtdLFxuICAgICAgICBsb2FkZWQ6IFtdXG4gICAgICB9O1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBjdXN0b21UcmFja0Vycm9yKGUpIHtcbiAgICAgICAgJHBpY2tlci5maW5kKCcuc3Bpbm5lcicpLmhpZGUoKTtcbiAgICAgICAgdmFyIG1zZyA9IGUubWVzc2FnZS5yZXBsYWNlKC9eVW5jYXVnaHQgRXJyb3I6IC8sICcnKTtcbiAgICAgICAgYWxlcnQoJ1NvcnJ5LCBhbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBhZGRpbmcgdGhpcyBjdXN0b20gdHJhY2sgZmlsZTpcXG5cXG4nICsgbXNnKTtcbiAgICAgICAgLy8gVE9ETzogcmVwbGFjZSB0aGlzIHdpdGggc29tZXRoaW5nIG1vcmUgZnJpZW5kbHkuXG4gICAgICAgIHJlcGxhY2VGaWxlSW5wdXQoKTsgXG4gICAgICB9XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIGNsb3NlUGlja2VyKCkgeyAkcGlja2VyLnNsaWRlVXAoMTAwKTsgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBoYW5kbGVGaWxlU2VsZWN0KGUpIHtcbiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCksXG4gICAgICAgICAgJGFkZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5mb3JtLWxpbmUnKSxcbiAgICAgICAgICAkc3Bpbm5lciA9ICRhZGQuZmluZCgnLnNwaW5uZXInKS5zaG93KCk7XG4gICAgICAgIGlmIChlLnRhcmdldC5maWxlcy5sZW5ndGgpIHtcbiAgICAgICAgICByZWFkZXIub25sb2FkID0gKGZ1bmN0aW9uKGYpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihldikge1xuICAgICAgICAgICAgICBDdXN0b21UcmFja3MucGFyc2VBc3luYyhldi50YXJnZXQucmVzdWx0LCBicm93c2VyT3B0cygpLCBmdW5jdGlvbih0cmFja3MpIHtcbiAgICAgICAgICAgICAgICAkc3Bpbm5lci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5fYWRkQ3VzdG9tVHJhY2tzKGYubmFtZSwgdHJhY2tzKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pKGUudGFyZ2V0LmZpbGVzWzBdKTtcbiAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChlLnRhcmdldC5maWxlc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVwbGFjZUZpbGVJbnB1dCgpO1xuICAgICAgfVxuICAgICAgaWYgKHdpbmRvdy5GaWxlICYmIHdpbmRvdy5GaWxlUmVhZGVyICYmIHdpbmRvdy5GaWxlTGlzdCkge1xuICAgICAgICAkYWRkLmZpbmQoJ2xhYmVsJykuaHRtbChmaWxlSW5wdXRIVE1MKTtcbiAgICAgICAgJGFkZC5maW5kKCdbbmFtZT1jdXN0b21GaWxlXScpLmNoYW5nZShoYW5kbGVGaWxlU2VsZWN0KTtcbiAgICAgICAgJGFkZCA9ICRhZGQubmV4dEFsbCgnLmZvcm0tbGluZScpLmZpcnN0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkYWRkLnJlbW92ZSgpO1xuICAgICAgICAkcGlja2VyLmZpbmQoJy5oZWxwLWxpbmUnKS5maXJzdCgpLnJlbW92ZSgpO1xuICAgICAgICAkYWRkID0gJHBpY2tlci5maW5kKCcuZm9ybS1saW5lJykuZmlyc3QoKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gcmVwbGFjZUZpbGVJbnB1dCgpIHtcbiAgICAgICAgXy5kZWZlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAkcGlja2VyLmZpbmQoJ1tuYW1lPWN1c3RvbUZpbGVdJykucmVwbGFjZVdpdGgoZmlsZUlucHV0SFRNTCk7XG4gICAgICAgICAgJHBpY2tlci5maW5kKCdbbmFtZT1jdXN0b21GaWxlXScpLmNoYW5nZShoYW5kbGVGaWxlU2VsZWN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIGhhbmRsZVBhc3RlZERhdGEoZSkge1xuICAgICAgICB2YXIgJGFkZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5mb3JtLWxpbmUnKSxcbiAgICAgICAgICAkc3Bpbm5lciA9ICRhZGQuZmluZCgnLnNwaW5uZXInKS5zaG93KCk7XG4gICAgICAgIEN1c3RvbVRyYWNrcy5wYXJzZUFzeW5jKCRhZGQuZmluZCgndGV4dGFyZWEnKS52YWwoKSwgYnJvd3Nlck9wdHMoKSwgZnVuY3Rpb24odHJhY2tzKSB7XG4gICAgICAgICAgJHNwaW5uZXIuaGlkZSgpO1xuICAgICAgICAgIHNlbGYuX2FkZEN1c3RvbVRyYWNrcyhfLnVuaXF1ZUlkKCdwYXN0ZWRfZGF0YV8nKSwgdHJhY2tzKTtcbiAgICAgICAgICAkYWRkLmZpbmQoJ3RleHRhcmVhJykudmFsKCcnKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBwYXN0ZUFyZWFGb2N1cyhlKSB7XG4gICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksIGhlaWdodCA9ICR0aGlzLmhlaWdodCgpO1xuICAgICAgICBpZiAoISR0aGlzLmRhdGEoJ29yaWdIZWlnaHQnKSkgeyAkdGhpcy5kYXRhKCdvcmlnSGVpZ2h0JywgJHRoaXMuaGVpZ2h0KCkpOyB9XG4gICAgICAgICR0aGlzLmFuaW1hdGUoe2hlaWdodDogMTIwfSwgMjAwLCAnZWFzZUluT3V0UXVhcnQnKTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIHBhc3RlQXJlYUJsdXIoZSkgeyAkKHRoaXMpLmFuaW1hdGUoe2hlaWdodDogJCh0aGlzKS5kYXRhKCdvcmlnSGVpZ2h0Jyl9LCAyMDAsICdlYXNlSW5PdXRRdWFydCcpOyB9XG4gICAgICAkYWRkLmZpbmQoJ1tuYW1lPWN1c3RvbVBhc3RlQWRkXScpLmNsaWNrKGhhbmRsZVBhc3RlZERhdGEpO1xuICAgICAgJGFkZC5maW5kKCd0ZXh0YXJlYScpLmZvY3VzKHBhc3RlQXJlYUZvY3VzKS5ibHVyKHBhc3RlQXJlYUJsdXIpO1xuICAgICAgJGFkZCA9ICRhZGQubmV4dEFsbCgnLmZvcm0tbGluZScpLmZpcnN0KCk7XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIGhhbmRsZVVybFNlbGVjdChlKSB7XG4gICAgICAgIHZhciAkYWRkID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLmZvcm0tbGluZScpLFxuICAgICAgICAgICRzcGlubmVyID0gJGFkZC5maW5kKCcuc3Bpbm5lcicpLFxuICAgICAgICAgICR1cmwgPSAkYWRkLmZpbmQoJ1tuYW1lPWN1c3RvbVVybF0nKSxcbiAgICAgICAgICB1cmwgPSAkLnRyaW0oJHVybC52YWwoKSk7XG4gICAgICAgIGlmICghdXJsLmxlbmd0aCkgeyByZXR1cm47IH1cbiAgICAgICAgJHNwaW5uZXIuc2hvdygpO1xuICAgICAgICBzZWxmLl9jdXN0b21UcmFja1VybHMucmVxdWVzdGVkID0gXy53aXRob3V0KHNlbGYuX2N1c3RvbVRyYWNrVXJscy5yZXF1ZXN0ZWQsIHVybCk7XG4gICAgICAgIHNlbGYuX2N1c3RvbVRyYWNrVXJscy5wcm9jZXNzaW5nID0gXy51bmlvbihzZWxmLl9jdXN0b21UcmFja1VybHMucHJvY2Vzc2luZywgW3VybF0pO1xuICAgICAgICAkLmFqYXgodXJsLCB7XG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgQ3VzdG9tVHJhY2tzLnBhcnNlQXN5bmMoZGF0YSwgYnJvd3Nlck9wdHMoKSwgZnVuY3Rpb24odHJhY2tzKSB7XG4gICAgICAgICAgICAgICRzcGlubmVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgJHVybC52YWwoJycpO1xuICAgICAgICAgICAgICBzZWxmLl9jdXN0b21UcmFja1VybHMubG9hZGVkID0gXy51bmlvbihzZWxmLl9jdXN0b21UcmFja1VybHMubG9hZGVkLCBbdXJsXSk7XG4gICAgICAgICAgICAgIHNlbGYuX2FkZEN1c3RvbVRyYWNrcyhiYXNlbmFtZSh1cmwpLCB0cmFja3MsIHVybCk7XG4gICAgICAgICAgICAgICRvdmVybGF5LmFkZCgkb3ZlcmxheU1lc3NhZ2UpLmZhZGVPdXQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHJvZ3Jlc3M6IGZ1bmN0aW9uKGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgIHZhciAkcHJvZ3Jlc3MgPSAkb3ZlcmxheU1lc3NhZ2UuZmluZCgnLnVpLXByb2dyZXNzYmFyJyk7XG4gICAgICAgICAgICBpZiAoISRwcm9ncmVzcy5sZW5ndGgpIHsgJHByb2dyZXNzID0gJCgnPGRpdi8+JykuYXBwZW5kVG8oJG92ZXJsYXlNZXNzYWdlKS5wcm9ncmVzc2JhcigpOyB9XG4gICAgICAgICAgICAkcHJvZ3Jlc3MucHJvZ3Jlc3NiYXIoJ3ZhbHVlJywgbG9hZGVkL3RvdGFsICogMTAwKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRvdmVybGF5LmhpZGUoKTtcbiAgICAgICAgICAgICRvdmVybGF5TWVzc2FnZS5oaWRlKCk7XG4gICAgICAgICAgICBjdXN0b21UcmFja0Vycm9yKHttZXNzYWdlOiBcIk5vIHZhbGlkIGN1c3RvbSB0cmFjayBkYXRhIHdhcyBmb3VuZCBhdCB0aGlzIFVSTC5cIn0pOyBcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgJGFkZC5maW5kKCdsYWJlbCcpLmh0bWwodXJsSW5wdXRIVE1MKTtcbiAgICAgICRhZGQuZmluZCgnW25hbWU9Y3VzdG9tVXJsR2V0XScpLmNsaWNrKGhhbmRsZVVybFNlbGVjdCk7XG4gICAgICAkYWRkLmZpbmQoJ1tuYW1lPWN1c3RvbVVybF0nKS5iaW5kKCdrZXlkb3duJywgZnVuY3Rpb24oZSkgeyBpZiAoZS53aGljaD09MTMpIHsgaGFuZGxlVXJsU2VsZWN0KGUpOyB9IH0pO1xuICAgICAgXG4gICAgICAvLyBSZWRlZmluZSB0aGUgQ3VzdG9tVHJhY2tzIGVycm9yIGhhbmRsZXIgc28gdGhlIHVzZXIgY2FuIHNlZSBwYXJzZSBlcnJvcnMgZm9yIHRoZWlyIGN1c3RvbSB0cmFjayhzKS5cbiAgICAgIEN1c3RvbVRyYWNrcy5lcnJvciA9IGN1c3RvbVRyYWNrRXJyb3I7XG4gICAgICBcbiAgICAgICRkaXYgPSAkKCc8ZGl2IGNsYXNzPVwiYnV0dG9uLWxpbmVcIi8+JykuYXBwZW5kVG8oJHBpY2tlcik7XG4gICAgICAkcmVzZXQgPSAkKCc8aW5wdXQgdHlwZT1cImJ1dHRvblwiIG5hbWU9XCJyZXNldFwiIHZhbHVlPVwicmVzZXRcIi8+JykuYXBwZW5kVG8oJGRpdik7XG4gICAgICAkYiA9ICQoJzxpbnB1dCB0eXBlPVwiYnV0dG9uXCIgbmFtZT1cImRvbmVcIiB2YWx1ZT1cImRvbmVcIi8+JykuYXBwZW5kVG8oJGRpdik7XG4gICAgICAkcmVzZXQuY2xpY2soZnVuY3Rpb24oZSkgeyBzZWxmLl9yZXNldEN1c3RvbVRyYWNrcygpOyB9KTtcblxuICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZVBpY2tlcigkdG9nZ2xlQnRuLCAkcGlja2VyLCAkYik7XG4gICAgfSxcbiAgICBcbiAgICBfaW5pdExpbmtpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICAkbGlua0J0biA9ICQoby5saW5raW5nWzBdKSxcbiAgICAgICAgJGxpbmtQaWNrZXIgPSAkKG8ubGlua2luZ1sxXSksXG4gICAgICAgICR1cmwgPSAkbGlua1BpY2tlci5maW5kKCcudXJsJyk7XG4gICAgICAkbGlua0J0bi5idXR0b24oKS5jbGljayhmdW5jdGlvbihlKSB7IF8uZGVmZXIoZnVuY3Rpb24gKCkgeyAkdXJsLnNlbGVjdCgpLmZvY3VzKCk7IH0pOyByZXR1cm4gZmFsc2U7IH0pO1xuICAgICAgc2VsZi5fY3JlYXRlUGlja2VyKCRsaW5rQnRuLCAkbGlua1BpY2tlcik7XG4gICAgfSxcbiAgICBcbiAgICBfaW5pdEp1bXA6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICAkbG9jID0gICQoby5qdW1wWzBdKSxcbiAgICAgICAgJGp1bXAgPSAkKG8uanVtcFsxXSk7XG4gICAgICBzZWxmLiRjaG9pY2VzID0gJChvLmp1bXBbMl0pLmhpZGUoKTtcbiAgICAgIGZ1bmN0aW9uIGp1bXBUb1N1Ym1pdCgpIHtcbiAgICAgICAgdmFyICRzdWdnZXN0ID0gc2VsZi4kY2hvaWNlcy5maW5kKCcuZm9jdXMnKTtcbiAgICAgICAgaWYgKCRzdWdnZXN0Lmxlbmd0aCkgeyAkc3VnZ2VzdC5jbGljaygpOyB9XG4gICAgICAgIGVsc2UgeyBzZWxmLmp1bXBUbygkbG9jLnZhbCgpKTsgfVxuICAgICAgfVxuICAgICAgJGp1bXAuY2xpY2soanVtcFRvU3VibWl0KTtcbiAgICAgICRsb2Mua2V5ZG93bihmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChlLndoaWNoID09IDEzKSB7IGp1bXBUb1N1Ym1pdCgpOyB9XG4gICAgICAgIGVsc2UgaWYgKGUud2hpY2ggPT0gNDApIHsgXG4gICAgICAgICAgc2VsZi4kY2hvaWNlcy5maW5kKCcuZm9jdXMnKS5uZXh0QWxsKCcuY2hvaWNlJykuZXEoMCkudHJpZ2dlcignZmFrZWZvY3VzJyk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gMzgpIHsgXG4gICAgICAgICAgc2VsZi4kY2hvaWNlcy5maW5kKCcuZm9jdXMnKS5wcmV2QWxsKCcuY2hvaWNlJykuZXEoMCkudHJpZ2dlcignZmFrZWZvY3VzJyk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlbGYuX25vcm1hbGl6ZVBvc0RlYm91bmNlZCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgICRsb2Mua2V5dXAoZnVuY3Rpb24oZSkgeyBfLmRlZmVyKGZ1bmN0aW9uKCkgeyAoJGxvYy52YWwoKT09PScnKSAmJiBzZWxmLl9zZWFyY2hGb3IoJycpOyB9KTsgfSk7XG4gICAgfSxcbiAgICBcbiAgICBfaW5pdEhvdGtleXM6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgICAgbW90aW9uT3B0cyA9IHtkaXI6IDB9LFxuICAgICAgICBsID0gNTAwLFxuICAgICAgICBzaGlmdEV2ZXJ5dGhpbmcgPSAnc2hpZnQrZG93biBzaGlmdCtzIHNoaWZ0K3VwIHNoaWZ0K3cgc2hpZnQrbGVmdCBzaGlmdCthIHNoaWZ0K3JpZ2h0IHNoaWZ0K2QnLFxuICAgICAgICBtb3Rpb25JbnRlcnZhbDtcbiAgICAgIHNlbGYuX2tleWVkT2Zmc2V0ID0gMDtcbiAgICAgIC8vIHF1YWRyYXRpYyBtb3Rpb24gd2l0aCBhbiB1cHBlciBib3VuZCBvbiB0aGUgdmVsb2NpdHkgYWZ0ZXIgbCBtaWxsaXNlY29uZHNcbiAgICAgIGZ1bmN0aW9uIHgodCkgeyByZXR1cm4gKHQgPiBsID8gMiAqIGwgKiB0IC0gbCAqIGwgOiB0ICogdCkgLyAxNTAwOyB9XG4gICAgICBmdW5jdGlvbiBtb3Rpb24oKSB7XG4gICAgICAgIHZhciBub3cgPSAobmV3IERhdGUpLmdldFRpbWUoKSxcbiAgICAgICAgICBkZWx0YVkgPSBtb3Rpb25PcHRzLmRpciAqIHgobm93IC0gbW90aW9uT3B0cy5zdGFydCkgLSBtb3Rpb25PcHRzLnByZXY7XG4gICAgICAgIHNlbGYuX2tleWVkT2Zmc2V0IC09IGRlbHRhWTtcbiAgICAgICAgc2VsZi5fcG9zKHNlbGYucG9zIC0gZGVsdGFZICogc2VsZi5icHBwKTsgXG4gICAgICAgIG1vdGlvbk9wdHMucHJldiArPSBkZWx0YVk7XG4gICAgICB9O1xuICAgICAgJChkb2N1bWVudCkuYmluZCgna2V5ZG93bicsICd1cCBkb3duIGxlZnQgcmlnaHQgdyBzIGEgZCAnK3NoaWZ0RXZlcnl0aGluZywgZnVuY3Rpb24oKSB7IFxuICAgICAgICBzZWxmLnNob3dSZXRpY2xlKCdob3RLZXlzJywgdHJ1ZSk7XG4gICAgICAgICQudGlwVGlwLmhpZGUoKTtcbiAgICAgICAgJGVsZW0ub25lKCdtb3VzZW1vdmUnLCBmdW5jdGlvbigpIHsgc2VsZi5zaG93UmV0aWNsZSgnaG90S2V5cycsIGZhbHNlKTsgfSk7XG4gICAgICB9KTtcbiAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ2tleWRvd24nLCAnZG93biBzIHVwIHcnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciBkaXIgPSBlLndoaWNoID09IDQwIHx8IGUud2hpY2ggPT0gODMgPyAxIDogLTE7IC8vIGRvd249PjQwLCBzPT44M1xuICAgICAgICBpZiAoJChvLmxpbmVNb2RlKS5maW5kKCdpbnB1dDpjaGVja2VkJykudmFsKCkgPT0gJ3NpbmdsZScpIHtcbiAgICAgICAgICBkZWxldGUgc2VsZi5jZW50ZXJlZE9uO1xuICAgICAgICAgIHNlbGYuX2FuaW1hdGVab29tKGRpciA9PSAtMSwgMTAwMCk7IHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWxmLl9rZXllZE9mZnNldCArPSBkaXIgKiBzZWxmLmxpbmVXaWR0aCgpO1xuICAgICAgICAgIHNlbGYuX3BvcyhzZWxmLnBvcyArIGRpciAqIHNlbGYuYnBXaWR0aCgpKTtcbiAgICAgICAgICBzZWxmLmJvdW5jZUNoZWNrKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgJChkb2N1bWVudCkuYmluZCgna2V5ZG93bicsICdsZWZ0IGEgcmlnaHQgZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdmFyIGRpciA9IGUud2hpY2ggPT0gMzcgfHwgZS53aGljaCA9PSA2NSA/IDEgOiAtMSwgLy8gbGVmdD0+MzcsIGE9PjY1XG4gICAgICAgICAgbm93ID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7XG4gICAgICAgIGlmIChtb3Rpb25PcHRzLmRpciA9PSBkaXIpIHsgcmV0dXJuOyB9XG4gICAgICAgIGNsZWFySW50ZXJ2YWwobW90aW9uSW50ZXJ2YWwpO1xuICAgICAgICBtb3Rpb25PcHRzID0ge2RpcjogZGlyLCBzdGFydDogbm93LCBwcmV2OiAwfTtcbiAgICAgICAgbW90aW9uSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChtb3Rpb24sIDEzKTsgLy8gYmFzZWQgb2ZmIG9mIGpRdWVyeSdzIC5hbmltYXRlIGludGVydmFsXG4gICAgICB9KTtcbiAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ2tleXVwJywgJ2xlZnQgYSByaWdodCBkJywgZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgZGlyID0gZS53aGljaCA9PSAzNyB8fCBlLndoaWNoID09IDY1ID8gMSA6IC0xO1xuICAgICAgICBpZiAobW90aW9uT3B0cy5kaXIgPT0gZGlyKSB7IGNsZWFySW50ZXJ2YWwobW90aW9uSW50ZXJ2YWwpOyBzZWxmLmJvdW5jZUNoZWNrKCk7IG1vdGlvbk9wdHMuZGlyID0gMDsgfVxuICAgICAgfSk7XG4gICAgICAkKGRvY3VtZW50KS5iaW5kKCdrZXlkb3duJywgc2hpZnRFdmVyeXRoaW5nLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGRlbGV0ZSBzZWxmLmNlbnRlcmVkT247XG4gICAgICAgIHNlbGYuX2FuaW1hdGVab29tKF8uaW5jbHVkZShbMzgsIDg3LCAzOSwgNjhdLCBlLndoaWNoKSwgMTAwMCk7IC8vIHVwPT4zOCwgdz0+ODcsIHJpZ2h0PT4zOSwgZD0+NjhcbiAgICAgIH0pO1xuICAgICAgJChkb2N1bWVudCkuYmluZCgna2V5ZG93bicsICdlc2MnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciAkcGlja2VycyA9ICQoby50cmFja1BpY2tlclsxXSArICcsJyArIG8udHJhY2tQaWNrZXJbM10pO1xuICAgICAgICAkcGlja2Vycy5lYWNoKGZ1bmN0aW9uKCkgeyBpZiAoJCh0aGlzKS5pcygnOnZpc2libGUnKSkgJCh0aGlzKS5maW5kKCdpbnB1dFtuYW1lPWRvbmVdJykuY2xpY2soKTsgfSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIFxuICAgIF9pbml0QWpheDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICAgIC8vIHByb3h5IGV4dGVybmFsIFVSTHMgdGhyb3VnaCBvdXIgbG9jYWwgQUpBWCBwcm94eVxuICAgICAgJC5hamF4ID0gKGZ1bmN0aW9uKF9hamF4KXtcbiAgICAgICAgdmFyIHByb3RvY29sID0gbG9jYXRpb24ucHJvdG9jb2wsXG4gICAgICAgICAgaG9zdG5hbWUgPSBsb2NhdGlvbi5ob3N0bmFtZSxcbiAgICAgICAgICBleFJlZ2V4ID0gUmVnRXhwKHByb3RvY29sICsgJy8vJyArIGhvc3RuYW1lKSxcbiAgICAgICAgICBwcm94eVVSTCA9IG9wdGlvbnMuYWpheERpciArICdwcm94eS5waHAnO1xuXG4gICAgICAgIGZ1bmN0aW9uIGlzRXh0ZXJuYWwodXJsKSB7XG4gICAgICAgICAgcmV0dXJuICFleFJlZ2V4LnRlc3QodXJsKSAmJiAoLzpcXC9cXC8vKS50ZXN0KHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZnVuY3Rpb24odXJsLCBvKSB7XG4gICAgICAgICAgaWYgKCB0eXBlb2YgdXJsID09PSBcIm9iamVjdFwiICkge1xuICAgICAgICAgICAgbyA9IHVybDtcbiAgICAgICAgICAgIHVybCA9IG8udXJsO1xuICAgICAgICAgIH0gZWxzZSB7IG8udXJsID0gdXJsOyB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gY2FwdHVyZSBhbmQgZm9yd2FyZCBwcm9ncmVzcyBldmVudHMgZnJvbSBYSFIncyB0byBvLnByb2dyZXNzIGNhbGxiYWNrXG4gICAgICAgICAgby54aHIgPSAoZnVuY3Rpb24oX3hocil7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHZhciB4aHIgPSBfLmlzRnVuY3Rpb24oX3hocikgPyBfeGhyKCkgOiBuZXcgd2luZG93LlhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHZhciB0b3RhbCA9IGUubGVuZ3RoQ29tcHV0YWJsZSA/IGUudG90YWwgOiB4aHIuZ2V0UmVzcG9uc2VIZWFkZXIoJ1gtQ29udGVudC1MZW5ndGgnKTtcbiAgICAgICAgICAgICAgICBpZiAodG90YWwgJiYgXy5pc0Z1bmN0aW9uKG8ucHJvZ3Jlc3MpKSB7XG4gICAgICAgICAgICAgICAgICBvLnByb2dyZXNzLmNhbGwodGhpcywgZS5sb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sIGZhbHNlKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHhocjtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSkoby54aHIpO1xuXG4gICAgICAgICAgaWYgKCAoL2dldC9pLnRlc3Qoby50eXBlKSB8fCAhby50eXBlKSAmJiAhL2pzb24vaS50ZXN0KG8uZGF0YVR5cGUpICYmIGlzRXh0ZXJuYWwodXJsKSApIHtcbiAgICAgICAgICAgIC8vIE1hbmlwdWxhdGUgb3B0aW9ucyBzbyB0aGF0IEFKQVggcmVxdWVzdCBnZXRzIHNlbnQgdG8gb3VyIHByb3h5XG4gICAgICAgICAgICBvLnVybCA9IHByb3h5VVJMO1xuICAgICAgICAgICAgby5kYXRhVHlwZSA9ICd0ZXh0JztcbiAgICAgICAgICAgIG8uZGF0YSA9IHtcbiAgICAgICAgICAgICAgdXJsOiB1cmwgKyAoby5kYXRhID8gKC9cXD8vLnRlc3QodXJsKSA/ICcmJyA6ICc/JykgKyBqUXVlcnkucGFyYW0oby5kYXRhKSA6ICcnKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gU2luY2UgaXQncyBhIEpTT05QIHJlcXVlc3RcbiAgICAgICAgICAgIC8vIGNvbXBsZXRlID09PSBzdWNjZXNzXG4gICAgICAgICAgICBpZiAoIW8uc3VjY2VzcyAmJiBvLmNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgIG8uc3VjY2VzcyA9IG8uY29tcGxldGU7XG4gICAgICAgICAgICAgIGRlbGV0ZSBvLmNvbXBsZXRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgby5zdWNjZXNzID0gKGZ1bmN0aW9uKF9zdWNjZXNzKXtcbiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3N1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgIC8vIEZha2UgWEhSIGNhbGxiYWNrLlxuICAgICAgICAgICAgICAgICAgX3N1Y2Nlc3MuY2FsbCh0aGlzLCBkYXRhLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pKG8uc3VjY2Vzcyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfYWpheC5jYWxsKHRoaXMsIG8pO1xuICAgICAgICB9O1xuICAgICAgfSkoJC5hamF4KTtcbiAgICB9LFxuICAgIFxuICAgIF9pbml0TW9iaWxlRmVhdHVyZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICAkZWxlbXMgPSBzZWxmLmVsZW1lbnQuYWRkKG8ubmF2QmFyKS5hZGQoby5mb290ZXJCYXIpO1xuICAgICAgXG4gICAgICAkKHdpbmRvdykuYmluZCgnb3JpZW50YXRpb25jaGFuZ2UnLCBmdW5jdGlvbigpIHsgJCh3aW5kb3cpLnJlc2l6ZSgpOyB9KTtcbiAgICAgIFxuICAgICAgaWYgKCEkLnN1cHBvcnQudG91Y2gpIHsgcmV0dXJuOyB9XG4gICAgICAkZWxlbXMuYWRkQ2xhc3MoJ21vYmlsZScpO1xuICAgICAgXG4gICAgICB2YXIgY2FjaGVkUGFnZVhzID0ge30sIHByZXZQaW5jaFdpZHRoID0gbnVsbCwgdG91Y2hUYXJnZXQsIGNlbnRlciwgcGluY2hXaWR0aDtcbiAgICAgIGZ1bmN0aW9uIGdldFBhZ2VYKGUsIGlkZW50aWZpZXIpIHtcbiAgICAgICAgdmFyIHBhZ2VYLCBjaGFuZ2VkID0gXy5maW5kKGUuY2hhbmdlZFRvdWNoZXMsIGZ1bmN0aW9uKHQpIHsgcmV0dXJuIHQuaWRlbnRpZmllciA9PSBpZGVudGlmaWVyOyB9KTtcbiAgICAgICAgaWYgKGNoYW5nZWQpIHsgcGFnZVggPSBjaGFuZ2VkLnBhZ2VYOyB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChjYWNoZWRQYWdlWHNbaWRlbnRpZmllcl0pKSB7IHBhZ2VYID0gY2FjaGVkUGFnZVhzW2lkZW50aWZpZXJdOyB9XG4gICAgICAgICAgZWxzZSB7IHBhZ2VYID0gXy5maW5kKGUudG91Y2hlcywgZnVuY3Rpb24odCkgeyByZXR1cm4gdC5pZGVudGlmaWVyID09IGlkZW50aWZpZXI7IH0pLnBhZ2VYOyB9XG4gICAgICAgIH1cbiAgICAgICAgY2FjaGVkUGFnZVhzW2lkZW50aWZpZXJdID0gcGFnZVg7XG4gICAgICAgIHJldHVybiBwYWdlWDtcbiAgICAgIH1cbiAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ3RvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciBkcmFnQ29udFRvdWNoID0gXy5maW5kKGUub3JpZ2luYWxFdmVudC50b3VjaGVzLCBmdW5jdGlvbih0KSB7IHJldHVybiAkKHQudGFyZ2V0KS5jbG9zZXN0KCcuZHJhZy1jb250JykubGVuZ3RoID4gMDsgfSk7XG4gICAgICAgIGlmIChkcmFnQ29udFRvdWNoKSB7IHRvdWNoVGFyZ2V0ID0gJChkcmFnQ29udFRvdWNoLnRhcmdldCkuY2xvc2VzdCgnLmRyYWctY29udCcpOyB9XG4gICAgICB9KTtcbiAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ3RvdWNobW92ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdmFyIG9lID0gZS5vcmlnaW5hbEV2ZW50O1xuICAgICAgICAvLyBJZiBub3RoaW5nIHN0YXJ0ZWQgd2l0aGluIGEgZHJhZ2dhYmxlIHRyYWNrIGFyZWEsIHdlIGRvbid0IGNhcmUgYWJvdXQgdGhpcyBldmVudFxuICAgICAgICBpZiAoIXRvdWNoVGFyZ2V0KSB7IHJldHVybjsgfVxuICAgICAgICAvLyBXZSdyZSBvbmx5IGhhbmRsaW5nIHBpbmNoIGV2ZW50cyBoZXJlXG4gICAgICAgIGlmIChvZS50b3VjaGVzLmxlbmd0aCAhPSAyKSB7IHJldHVybjsgfVxuICAgICAgICBpZiAoY2VudGVyID09PSBudWxsKSB7XG4gICAgICAgICAgY2VudGVyID0gKG9lLnRvdWNoZXNbMF0ucGFnZVggKyBvZS50b3VjaGVzWzFdLnBhZ2VYKSAqIDAuNTtcbiAgICAgICAgfVxuICAgICAgICBwaW5jaFdpZHRoID0gTWF0aC5hYnMoZ2V0UGFnZVgob2UsIG9lLnRvdWNoZXNbMF0uaWRlbnRpZmllcikgLSBnZXRQYWdlWChvZSwgb2UudG91Y2hlc1sxXS5pZGVudGlmaWVyKSk7XG4gICAgICAgIGlmIChwcmV2UGluY2hXaWR0aCkge1xuICAgICAgICAgIHZhciBkZWx0YSA9IChwaW5jaFdpZHRoIC8gcHJldlBpbmNoV2lkdGggLSAxKSAqIDUwLCBcbiAgICAgICAgICAgIC8vIFRPRE86IGRlbHRhIGNvdWxkIHByb2JhYmx5IGJlIHR3ZWFrZWQgdG8gcHJvdml1ZGUgcGVyZmVjdCBwb3NpdGlvbmFsIHpvb21pbmdcbiAgICAgICAgICAgIGZha2VFdmVudCA9IHt0YXJnZXQ6IHRvdWNoVGFyZ2V0LCBvcmlnaW5hbEV2ZW50OiB7c3JjRWxlbWVudDogdG91Y2hUYXJnZXQsIHBhZ2VYOiBjZW50ZXJ9fTtcbiAgICAgICAgICAvLyBTaW11bGF0ZSB0aGUgZXF1aXZhbGVudCBtb3VzZXdoZWVsIGV2ZW50XG4gICAgICAgICAgc2VsZi5fcmVjdlpvb20oZmFrZUV2ZW50LCBkZWx0YSk7XG4gICAgICAgIH1cbiAgICAgICAgcHJldlBpbmNoV2lkdGggPSBwaW5jaFdpZHRoO1xuICAgICAgfSk7XG4gICAgICAkKGRvY3VtZW50KS5iaW5kKCd0b3VjaGVuZCcsIGZ1bmN0aW9uKGUpIHsgY2FjaGVkUGFnZVhzID0ge307IHByZXZQaW5jaFdpZHRoID0gdG91Y2hUYXJnZXQgPSBjZW50ZXIgPSBudWxsOyB9KTtcblxuICAgICAgJChvLmxpbmVNb2RlKS5maW5kKCdpbnB1dFt2YWx1ZT1zaW5nbGVdJykuYXR0cignY2hlY2tlZCcsIHRydWUpO1xuICAgIH0sXG4gICAgXG4gICAgX2luaXRJRUZpeGVzOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGVsZW1zID0gc2VsZi5lbGVtZW50LmFkZChvLm5hdkJhcik7XG4gICAgICAkZWxlbXMuYWRkQ2xhc3MoJ21zaWUnKTtcbiAgICAgICQoby56b29tU2xpZGVyKS5wYXJlbnQoKS5maW5kKCcudGljaycpLmxhc3QoKS5hZGRDbGFzcygnbGFzdCcpO1xuICAgICAgJChvLnRyYWNrUGlja2VyWzNdKS5maW5kKCd0ZXh0YXJlYS5wYXN0ZScpLmNzcygnd2hpdGUtc3BhY2UnLCAncHJlLXdyYXAnKS5hdHRyKCd3cmFwJywgJ29mZicpO1xuICAgICAgXG4gICAgICBpZiAocGFyc2VGbG9hdCgkLmJyb3dzZXIudmVyc2lvbikgPj0gOS4wKSB7IHJldHVybjsgfVxuICAgICAgLy8gU3R1ZmYgZm9yIG9sZCBNU0lFJ3MgKDwgTVNJRSA5KVxuICAgICAgLy8gU2hvdyB0aGUgd2FybmluZyBkaWFsb2dcbiAgICAgICQoby5mb290ZXJCYXIpLmZpbmQoJ2FbaHJlZj1cIiNvbGQtbXNpZVwiXScpLmNsaWNrKCk7XG4gICAgICAvLyBEaXNhYmxlIG11bHRpbGluZSBtb2RlXG4gICAgICAkKG8ubGluZU1vZGUpLmZpbmQoJ2lucHV0W3ZhbHVlPXNpbmdsZV0nKS5hdHRyKCdjaGVja2VkJywgdHJ1ZSk7XG4gICAgICAvLyBPbGQgSUUncyBoYXZlIGlzc3VlcyB3aXRoIGNyZWF0aW5nIG5ldyB0YWJzIHdoZW4gY2xpY2tpbmcgZmVhdHVyZXNcbiAgICAgIHNlbGYuZWxlbWVudC5jbGljayhmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciAkYSA9ICQoZS50YXJnZXQpO1xuICAgICAgICBpZiAoZS50YXJnZXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PSAnYScgJiYgJGEuaGFzQ2xhc3MoJ2FyZWEnKSkge1xuICAgICAgICAgIHZhciBocmVmID0gJGEuYXR0cignaHJlZicpO1xuICAgICAgICAgIGlmIChocmVmKSB7IHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gaHJlZjsgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgIFxuICAgIF9pbml0Q3VzdG9tVHJhY2tEaWFsb2c6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICAkZGlhbG9nID0gJChvLmRpYWxvZ3NbMF0pLmNsb3Nlc3QoJy51aS1kaWFsb2cnKTtcbiAgICAgIFxuICAgICAgJGRpYWxvZy5kYXRhKCdnZW5vYnJvd3NlcicsIHNlbGYuZWxlbWVudCk7XG4gICAgICAkZGlhbG9nLmZpbmQoJy5oaWRkZW4nKS5oaWRlKCk7XG4gICAgICAkZGlhbG9nLmZpbmQoJy5zaG93Jykuc2hvdygpO1xuICAgICAgXG4gICAgICBpZiAoJGRpYWxvZy5oYXNDbGFzcygnaW5pdGlhbGl6ZWQnKSkgeyByZXR1cm47IH0gLy8gVGhlIGZvbGxvd2luZyBvbmx5IG5lZWRzIHRvIGJlIGluaXRpYWxpemVkIG9uY2VcbiAgICAgIFxuICAgICAgJGRpYWxvZy5iaW5kKCdvcGVuLmdlbm9icm93c2VyJywgZnVuY3Rpb24oKSB7IHNlbGYuJGN1c3RvbVRyYWNrcy50cmlnZ2VyKCdjbG9zZS5nZW5vYnJvd3NlcicpOyB9KTtcbiAgICAgICRkaWFsb2cuZmluZCgnLnJhbmdlLXNsaWRlcicpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkbWluID0gJCh0aGlzKS5wcmV2KCdpbnB1dCcpLFxuICAgICAgICAgICRtYXggPSAkKHRoaXMpLm5leHQoJ2lucHV0JyksXG4gICAgICAgICAgbWluID0gcGFyc2VGbG9hdCgkbWluLnZhbCgpKSxcbiAgICAgICAgICBtYXggPSBwYXJzZUZsb2F0KCRtYXgudmFsKCkpLFxuICAgICAgICAgICRzbGlkZXIgPSAkKHRoaXMpO1xuICAgICAgICAkc2xpZGVyLnNsaWRlcih7XG4gICAgICAgICAgcmFuZ2U6IHRydWUsXG4gICAgICAgICAgbWluOiBtaW4sXG4gICAgICAgICAgbWF4OiBtYXgsXG4gICAgICAgICAgdmFsdWVzOiBbbWluLCBtYXhdLFxuICAgICAgICAgIHNsaWRlOiBmdW5jdGlvbihldmVudCwgdWkpIHtcbiAgICAgICAgICAgICRtaW4udmFsKHVpLnZhbHVlc1swXSk7XG4gICAgICAgICAgICAkbWF4LnZhbCh1aS52YWx1ZXNbMV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgICRtaW4uY2hhbmdlKGZ1bmN0aW9uKCkgeyAkc2xpZGVyLnNsaWRlcigndmFsdWUnLCAkKHRoaXMpLnZhbCgpKTsgfSk7XG4gICAgICAgICRtYXguY2hhbmdlKGZ1bmN0aW9uKCkgeyAkc2xpZGVyLnNsaWRlcigndmFsdWVzJywgWyRzbGlkZXIuc2xpZGVyKCd2YWx1ZXMnKVswXSwgJCh0aGlzKS52YWwoKV0pOyB9KTtcbiAgICAgIH0pO1xuICAgICAgJGRpYWxvZy5maW5kKCcuY29sb3InKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSxcbiAgICAgICAgICAkcCA9ICQoJzxkaXYgY2xhc3M9XCJjb2xvci1waWNrZXIgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWJvdHRvbSBzaGFkb3dcIj48L2Rpdj4nKS5pbnNlcnRBZnRlcigkaW5wdXQpO1xuICAgICAgICAkcC5mYXJidGFzdGljKHRoaXMpO1xuICAgICAgICAkaW5wdXQuZm9jdXMoZnVuY3Rpb24oKSB7ICRwLnNob3coMjAwKTsgfSk7XG4gICAgICAgICRpbnB1dC5ibHVyKGZ1bmN0aW9uKCkgeyAkcC5oaWRlKDIwMCk7IH0pO1xuICAgICAgICAkcC5oaWRlKCk7XG4gICAgICAgICQoJzxpbnB1dCB0eXBlPVwiYnV0dG9uXCIgdmFsdWU9XCJkb25lXCI+JykuYXBwZW5kVG8oJHApLmNsaWNrKGZ1bmN0aW9uKCkgeyAkaW5wdXQuYmx1cigpOyB9KTtcbiAgICAgIH0pO1xuICAgICAgJGRpYWxvZy5maW5kKCcuZW5hYmxlcicpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpO1xuICAgICAgICAkaW5wdXQuY2hhbmdlKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciB2YWx1ZSA9ICRpbnB1dC5pcygnOmNoZWNrZWQnKTtcbiAgICAgICAgICAkaW5wdXQuc2libGluZ3MoJ1t0eXBlPXRleHRdJykuYXR0cignZGlzYWJsZWQnLCAhdmFsdWUpLnRvZ2dsZUNsYXNzKCdkaXNhYmxlZCcsICF2YWx1ZSk7XG4gICAgICAgICAgJGlucHV0LnNpYmxpbmdzKCcucmFuZ2Utc2xpZGVyJykuc2xpZGVyKHZhbHVlID8gJ2VuYWJsZScgOiAnZGlzYWJsZScpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgJGRpYWxvZy5maW5kKCdbbmFtZT1zYXZlXScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdHJrID0gJGRpYWxvZy5kYXRhKCd0cmFjaycpO1xuICAgICAgICB0cmsuY3VzdG9tLnNhdmVPcHRzKCRkaWFsb2cpO1xuICAgICAgICBzZWxmLiRsaW5lcy5maW5kKCcuYnJvd3Nlci10cmFjay0nK3Ryay5uKycgLnRpbGUtY3VzdG9tIGNhbnZhcycpLnRyaWdnZXIoJ2VyYXNlJykudHJpZ2dlcigncmVuZGVyJyk7XG4gICAgICAgICRkaWFsb2cuZGF0YSgndHJhY2snLCBmYWxzZSk7XG4gICAgICB9KTtcbiAgICAgICRkaWFsb2cuZmluZCgnW25hbWU9ZGVsZXRlXScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAkKHRoaXMpLmhpZGUoKTtcbiAgICAgICAgJGRpYWxvZy5maW5kKCcuZGVsZXRlLWNvbmZpcm0nKS5mYWRlSW4oKTtcbiAgICAgIH0pO1xuICAgICAgJGRpYWxvZy5maW5kKCdbbmFtZT1yZWFsbHlfZGVsZXRlXScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdG5hbWUgPSAkZGlhbG9nLmRhdGEoJ3RyYWNrJykubjtcbiAgICAgICAgc2VsZi5fcmVtb3ZlQ3VzdG9tVHJhY2sodG5hbWUpO1xuICAgICAgICAkZGlhbG9nLmRhdGEoJ3RyYWNrJywgZmFsc2UpO1xuICAgICAgfSk7XG4gICAgICAkZGlhbG9nLmFkZENsYXNzKCdpbml0aWFsaXplZCcpO1xuICAgIH0sXG4gICAgXG4gICAgX2luaXRDaHJvbVNpemVzRGlhbG9nOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cgPSAkKG8uZGlhbG9nc1s0XSkuY2xvc2VzdCgnLnVpLWRpYWxvZycpO1xuICAgICAgICBcbiAgICAgIHNlbGYuX2lnYlF1aWNrbG9hZERhdGEgPSBzZWxmLl9pZ2JRdWlja2xvYWREYXRhIHx8IHt9O1xuICAgICAgICBcbiAgICAgIGZ1bmN0aW9uIGZpbHRlckdlbm9tZUxpc3QoZSkge1xuICAgICAgICB2YXIgc2VhcmNoVGVybXMgPSBfLm1hcCgkKHRoaXMpLnZhbCgpLnNwbGl0KC9cXHMrLyksIGZ1bmN0aW9uKHQpIHsgcmV0dXJuIHQudG9Mb3dlckNhc2UoKTsgfSksXG4gICAgICAgICAgJGxpc3QgPSAkKGUuZGF0YS5saXN0KTtcbiAgICAgICAgc2VhcmNoVGVybXMgPSBfLnJlamVjdChzZWFyY2hUZXJtcywgZnVuY3Rpb24odCkgeyB0ID09ICcnOyB9KTtcbiAgICAgICAgJGxpc3QuY2hpbGRyZW4oJ29wdGlvbicpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIHYgPSAkKHRoaXMpLnRleHQoKS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgdGVybXNGb3VuZCA9IF8ucmVkdWNlKHNlYXJjaFRlcm1zLCBmdW5jdGlvbihtZW1vLCB0KXsgcmV0dXJuIG1lbW8gKyAodi5pbmRleE9mKHQpICE9PSAtMSA/IDEgOiAwKTsgfSwgMCk7XG4gICAgICAgICAgaWYgKHNlYXJjaFRlcm1zLmxlbmd0aCA9PSAwIHx8IHRlcm1zRm91bmQgPT0gc2VhcmNoVGVybXMubGVuZ3RoKSB7ICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOyB9XG4gICAgICAgICAgZWxzZSB7ICQodGhpcykuYWRkQ2xhc3MoJ2hpZGRlbicpOyB9XG4gICAgICAgIH0pO1xuICAgICAgICAkbGlzdC5zY3JvbGxUb3AoMCkudmFsKCRsaXN0LmNoaWxkcmVuKCdvcHRpb246bm90KC5oaWRkZW4pJykuZXEoMCkudmFsKCkpLmNoYW5nZSgpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBsb2FkZWRDaHJvbVNpemVzKGRhdGEsICRwYW5lbCkge1xuICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCcuY29udGlncy1sb2FkaW5nJykuc3RvcCgpLmZhZGVPdXQoKTtcbiAgICAgICAgaWYgKGRhdGEuZXJyb3IpIHtcbiAgICAgICAgICAkcGFuZWwuZmluZCgnLnNraXBwZWQtbnVtJykudGV4dChkYXRhLnNraXBwZWQpO1xuICAgICAgICAgICRwYW5lbC5maW5kKCcudWktc3RhdGUtZXJyb3InKS5mYWRlSW4oKS5jaGlsZHJlbignLmNvbnRpZy1sb2FkLWVycm9yJykuc2hvdygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPWNocm9tc2l6ZXNdJykudmFsKGRhdGEuY2hyb21zaXplcyk7XG4gICAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9bmFtZV0nKS52YWwoZGF0YS5kYik7XG4gICAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZGF0YSgnZ2Vub21lTWV0YWRhdGEnLCBkYXRhKTtcbiAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1zYXZlXScpLmJ1dHRvbignZW5hYmxlJykuYWRkQ2xhc3MoJ2dsb3dpbmcnKTtcbiAgICAgICAgICBpZiAoZGF0YS5za2lwcGVkKSB7XG4gICAgICAgICAgICAkcGFuZWwuZmluZCgnLnNraXBwZWQtbnVtJykudGV4dChkYXRhLnNraXBwZWQpO1xuICAgICAgICAgICAgJHBhbmVsLmZpbmQoJy51aS1zdGF0ZS1lcnJvcicpLmZhZGVJbigpLmNoaWxkcmVuKCcuc2tpcHBlZC13YXJuaW5nJykuc2hvdygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAkY2hyb21TaXplc0RpYWxvZy5iaW5kKCdvcGVuLmdlbm9icm93c2VyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkZ2Vub21lTGlzdCA9ICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPXVjc2NHZW5vbWVdJyksXG4gICAgICAgICAgJGlnYkRpcnMgPSAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1pZ2JEaXJzXScpLFxuICAgICAgICAgICRpZ2JMaXN0ID0gJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9aWdiR2Vub21lXScpLFxuICAgICAgICAgICRuZXdJZ2JEaXIgPSAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1uZXdJZ2JEaXJdJylcbiAgICAgICAgICAkbG9hZElnYkJ0biA9ICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPWxvYWRJZ2JEaXJdJyksXG4gICAgICAgICAgJGNhbmNlbExvYWRJZ2JCdG4gPSAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1jYW5jZWxMb2FkSWdiRGlyXScpO1xuICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1maWx0ZXJVY3NjR2Vub21lXScpLnNlbGVjdCgpO1xuICAgICAgICAkKG8uZ2Vub21lUGlja2VyWzFdKS50cmlnZ2VyKCdjbG9zZS5nZW5vYnJvd3NlcicpO1xuICAgICAgICBpZiAoJGNocm9tU2l6ZXNEaWFsb2cuaGFzQ2xhc3MoJ2luaXRpYWxpemVkJykpIHsgcmV0dXJuOyB9XG4gICAgICAgIFxuICAgICAgICAvLyB0aGUgZm9sbG93aW5nIG9ubHkgcnVucyBvbmNlLCB0byBpbml0aWFsaXplIHRoaXMgZGlhbG9nJ3MgVUlcbiAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnLmFjY29yZGlvbicpLmFjY29yZGlvbih7aGVpZ2h0U3R5bGU6ICdjb250ZW50J30pO1xuICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1zYXZlXScpLmJ1dHRvbignZGlzYWJsZScpO1xuICAgICAgICBcbiAgICAgICAgLy8gbG9hZHMgdGhlIGluaXRpYWwgbGlzdHMgb2YgYXZhaWxhYmxlIGdlbm9tZXMgZnJvbSBVQ1NDICYgSUdCIFF1aWNrbG9hZCBkaXJlY3Rvcmllc1xuICAgICAgICAkLmFqYXgoby5hamF4RGlyKydjaHJvbXNpemVzLnBocCcsIHtcbiAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICRnZW5vbWVMaXN0LmVtcHR5KCkucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcbiAgICAgICAgICAgIF8uZWFjaChkYXRhLCBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgICAgIHZhciAkb3B0aW9uID0gJCgnPG9wdGlvbi8+JykudGV4dCh2LnNwZWNpZXMgKyAnICgnICsgdi5uYW1lICsgJykgJyArIHYuYXNzZW1ibHlEYXRlKTtcbiAgICAgICAgICAgICAgJG9wdGlvbi52YWwodi5uYW1lKS5kYXRhKCdtZXRhZGF0YScsIHYpLmFwcGVuZFRvKCRnZW5vbWVMaXN0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgICQuYWpheChvLmFqYXhEaXIrJ2lnYi5waHAnLCB7XG4gICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICB2YXIgZmlyc3REaXI7XG4gICAgICAgICAgICAkaWdiRGlycy5jaGlsZHJlbigpLmVxKDApLnJlbW92ZSgpO1xuICAgICAgICAgICAgXy5lYWNoKGRhdGEsIGZ1bmN0aW9uKHYsIGspIHtcbiAgICAgICAgICAgICAgZmlyc3REaXIgPSBmaXJzdERpciB8fCBrO1xuICAgICAgICAgICAgICAkKCc8b3B0aW9uLz4nKS50ZXh0KGspLnZhbChrKS5pbnNlcnRCZWZvcmUoJGlnYkRpcnMuY2hpbGRyZW4oKS5sYXN0KCkpO1xuICAgICAgICAgICAgICBzZWxmLl9pZ2JRdWlja2xvYWREYXRhW2tdID0gdjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGlnYkRpcnMudmFsKGZpcnN0RGlyKS5jaGFuZ2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gaW1wbGVtZW50cyBmaWx0ZXJpbmcgYnkga2V5d29yZFxuICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1maWx0ZXJVY3NjR2Vub21lXScpLmJpbmQoJ2tleXVwIGNoYW5nZScsIHtsaXN0OiAkZ2Vub21lTGlzdH0sIGZpbHRlckdlbm9tZUxpc3QpO1xuICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1maWx0ZXJJZ2JHZW5vbWVdJykuYmluZCgna2V5dXAgY2hhbmdlJywge2xpc3Q6ICRpZ2JMaXN0fSwgZmlsdGVyR2Vub21lTGlzdCk7XG4gICAgICAgIFxuICAgICAgICAvLyBsb2FkIHRoZSBjaHJvbSBzaXplcyBkYXRhIHdoZW4gc2VsZWN0aW5nIGEgVUNTQyBnZW5vbWVcbiAgICAgICAgJGdlbm9tZUxpc3QuYmluZCgnY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIGRiID0gJCh0aGlzKS52YWwoKSxcbiAgICAgICAgICAgICR1Y3NjT3B0aW9ucyA9ICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJy51Y3NjLW9wdGlvbnMnKTtcbiAgICAgICAgICBpZiAoIWRiKSB7IHJldHVybjsgfVxuICAgICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPXNhdmVdJykuYnV0dG9uKCdkaXNhYmxlJykucmVtb3ZlQ2xhc3MoJ2dsb3dpbmcnKTtcbiAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCcuY29udGlncy1sb2FkaW5nJykuc2hvdygpO1xuICAgICAgICAgICR1Y3NjT3B0aW9ucy5maW5kKCcudWktc3RhdGUtZXJyb3IsIC5jb250aWctbG9hZC1lcnJvciwgLnNraXBwZWQtd2FybmluZycpLmhpZGUoKTtcbiAgICAgICAgICAkLmFqYXgoby5hamF4RGlyKydjaHJvbXNpemVzLnBocCcsIHtcbiAgICAgICAgICAgIGRhdGE6IHsgZGI6IGRiLCBsaW1pdDogJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9bGltaXRdJykudmFsKCkgfSxcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7IGxvYWRlZENocm9tU2l6ZXMoZGF0YSwgJHVjc2NPcHRpb25zKTsgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9bGltaXRdJykuY2hhbmdlKGZ1bmN0aW9uKCkgeyAkZ2Vub21lTGlzdC5jaGFuZ2UoKTsgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBsb2FkIHRoZSBjb250ZW50cy50eHQgb2YgYW4gSUdCIFF1aWNrbG9hZCBkaXJlY3Rvcnkgd2hlbiBzZWxlY3RpbmcgaXRzIFVSTFxuICAgICAgICAkaWdiRGlycy5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgICBpZiAoJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnLmlnYi1kaXJzJykuaXMoJzpoaWRkZW4nKSkgeyAkY2FuY2VsTG9hZElnYkJ0bi5jbGljaygpOyB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gU2hvdyB0aGUgYWRkIFVSTCBpbnB1dCBib3hcbiAgICAgICAgICBpZiAodXJsID09ICcnKSB7XG4gICAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCcuaWdiLWRpcnMnKS5zbGlkZVVwKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCcuYWRkLWlnYi1kaXInKS5zbGlkZURvd24oKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZUxpc3QodXJsKSB7XG4gICAgICAgICAgICAkaWdiTGlzdC5lbXB0eSgpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgICAgICBfLmVhY2goc2VsZi5faWdiUXVpY2tsb2FkRGF0YVt1cmxdLCBmdW5jdGlvbih2LCBrKSB7XG4gICAgICAgICAgICAgICQoJzxvcHRpb24vPicpLnRleHQodikudmFsKHVybCArICcvJyArIGspLmFwcGVuZFRvKCRpZ2JMaXN0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoc2VsZi5faWdiUXVpY2tsb2FkRGF0YVt1cmxdKSB7IHBvcHVsYXRlTGlzdCh1cmwpOyB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkaWdiTGlzdC5lbXB0eSgpLmFwcGVuZCgnPG9wdGlvbj5sb2FkaW5nLi4uPC9vcHRpb24+JykuYWRkQ2xhc3MoJ2xvYWRpbmcnKTtcbiAgICAgICAgICAgICQuYWpheChvLmFqYXhEaXIrJ2lnYi5waHAnLCB7XG4gICAgICAgICAgICAgIGRhdGE6IHsgdXJsOiB1cmwsIGxpbWl0OiAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1pZ2JsaW1pdF0nKS52YWwoKSB9LFxuICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgXy5leHRlbmQoc2VsZi5faWdiUXVpY2tsb2FkRGF0YSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgcG9wdWxhdGVMaXN0KHVybCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBVSSBmb3IgYWRkaW5nIElHQiBRdWlja2xvYWQgZGlyZWN0b3JpZXNcbiAgICAgICAgJGxvYWRJZ2JCdG4uY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIHVybCA9ICRuZXdJZ2JEaXIudmFsKCkucmVwbGFjZSgvXFwvJC8sICcnKTtcbiAgICAgICAgICAkKCc8b3B0aW9uLz4nKS50ZXh0KHVybCkudmFsKHVybCkuaW5zZXJ0QmVmb3JlKCRpZ2JEaXJzLmNoaWxkcmVuKCkubGFzdCgpKTtcbiAgICAgICAgICAkaWdiRGlycy52YWwodXJsKS5jaGFuZ2UoKTtcbiAgICAgICAgfSk7XG4gICAgICAgICRjYW5jZWxMb2FkSWdiQnRuLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICRuZXdJZ2JEaXIudmFsKCcnKTtcbiAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCcuYWRkLWlnYi1kaXInKS5zbGlkZVVwKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnLmlnYi1kaXJzJykuc2xpZGVEb3duKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gVE9ETzogbG9hZCBhbiBJR0IgUXVpY2tsb2FkIGdlbm9tZSdzIGRhdGEgd2hlbiBzZWxlY3RpbmcgaXQgZnJvbSB0aGUgbGlzdFxuICAgICAgICAkaWdiTGlzdC5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS52YWwoKSxcbiAgICAgICAgICAgICRpZ2JPcHRpb25zID0gJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnLmlnYi1vcHRpb25zJyk7XG4gICAgICAgICAgaWYgKCF1cmwpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9c2F2ZV0nKS5idXR0b24oJ2Rpc2FibGUnKS5yZW1vdmVDbGFzcygnZ2xvd2luZycpO1xuICAgICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJy5jb250aWdzLWxvYWRpbmcnKS5zaG93KCk7XG4gICAgICAgICAgJGlnYk9wdGlvbnMuZmluZCgnLnVpLXN0YXRlLWVycm9yLCAuY29udGlnLWxvYWQtZXJyb3IsIC5za2lwcGVkLXdhcm5pbmcnKS5oaWRlKCk7XG4gICAgICAgICAgJC5hamF4KG8uYWpheERpcisnaWdiLnBocCcsIHtcbiAgICAgICAgICAgIGRhdGE6IHsgdXJsOiB1cmwsIGxpbWl0OiAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1pZ2JsaW1pdF0nKS52YWwoKSB9LFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHsgbG9hZGVkQ2hyb21TaXplcyhkYXRhLCAkaWdiT3B0aW9ucyk7IH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5hZGRDbGFzcygnaW5pdGlhbGl6ZWQnKTtcbiAgICAgIH0pO1xuICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9Y2hyb21zaXplc10nKS5vbmUoJ2ZvY3VzJywgZnVuY3Rpb24oKSB7IFxuICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLnJlbW92ZUNsYXNzKCdwbGFjZWhvbGRlcicpO1xuICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1zYXZlXScpLmJ1dHRvbignZW5hYmxlJyk7XG4gICAgICAgIF8uZGVmZXIoZnVuY3Rpb24oKSB7ICR0aGlzLnNlbGVjdCgpOyB9KTtcbiAgICAgIH0pO1xuICAgICAgJGNocm9tU2l6ZXNEaWFsb2cuZmluZCgnW25hbWU9c2F2ZV0nKS5jbGljayhmdW5jdGlvbihlLCBjaG9zZSkgeyBcbiAgICAgICAgdmFyIG1ldGFkYXRhID0geyBmb3JtYXQ6ICdjaHJvbXNpemVzJyB9LFxuICAgICAgICAgIHJlbW90ZU1ldGFkYXRhID0gJGNocm9tU2l6ZXNEaWFsb2cuZGF0YSgnZ2Vub21lTWV0YWRhdGEnKSxcbiAgICAgICAgICBhY3RpdmVBY2NvcmRpb24gPSAkY2hyb21TaXplc0RpYWxvZy5maW5kKCcudWktYWNjb3JkaW9uJykuYWNjb3JkaW9uKCdvcHRpb24nLCAnYWN0aXZlJyksXG4gICAgICAgICAgY2hvc2VXaGF0U291cmNlID0gWyd1Y3NjJywgJ2lnYicsICdjaHJvbXNpemVzJ10sXG4gICAgICAgICAgb3JpZ01ldGFkYXRhLCAkb3JpZ09wdGlvbiwgZ2Vub21lO1xuICAgICAgICBjaG9zZSA9IGNob3NlIHx8IGNob3NlV2hhdFNvdXJjZVthY3RpdmVBY2NvcmRpb25dO1xuICAgICAgICBpZiAoY2hvc2UgPT0gJ3Vjc2MnIHx8IGNob3NlID09ICdpZ2InKSB7XG4gICAgICAgICAgLy8gVGhpcyBpcyBhbiB1bmFsdGVyZWQgc2V0IG9mIGNocm9tb3NvbWUgc2l6ZXMgcHVsbGVkIGZyb20gVUNTQ1xuICAgICAgICAgIGNocm9tU2l6ZXMgPSByZW1vdGVNZXRhZGF0YS5jaHJvbXNpemVzO1xuICAgICAgICAgIG1ldGFkYXRhLm5hbWUgPSByZW1vdGVNZXRhZGF0YS5kYjtcbiAgICAgICAgICBtZXRhZGF0YS50cmFja3MgPSByZW1vdGVNZXRhZGF0YS50cmFja3M7XG4gICAgICAgICAgb3JpZ01ldGFkYXRhID0gcmVtb3RlTWV0YWRhdGE7XG4gICAgICAgICAgaWYgKGNob3NlID09ICd1Y3NjJykge1xuICAgICAgICAgICAgJG9yaWdPcHRpb24gPSAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT11Y3NjR2Vub21lXSA+IG9wdGlvblt2YWx1ZT0nK21ldGFkYXRhLm5hbWUrJ10nKTtcbiAgICAgICAgICAgIGlmICghcmVtb3RlTWV0YWRhdGEuc3BlY2llcykgeyBvcmlnTWV0YWRhdGEgPSAkb3JpZ09wdGlvbi5kYXRhKCdtZXRhZGF0YScpOyB9XG4gICAgICAgICAgICBtZXRhZGF0YS51Y3NjID0gbWV0YWRhdGEubmFtZSArICc6JyArIHJlbW90ZU1ldGFkYXRhLmxpbWl0O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBmaW5kIHNvbWUgd2F5IHRvIGdldCB0aGUgb3RoZXIgbWV0YWRhdGEvY3VzdG9tIHRyYWNrIGRhdGEgZnJvbSBhbm5vdHMueG1sIGludG8gbWV0YWRhdGFcbiAgICAgICAgICAgIG1ldGFkYXRhLmlnYiA9IHJlbW90ZU1ldGFkYXRhLmxpbWl0ICsgJzonICsgbWV0YWRhdGEubmFtZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbWV0YWRhdGEuc3BlY2llcyA9IG9yaWdNZXRhZGF0YS5zcGVjaWVzO1xuICAgICAgICAgIG1ldGFkYXRhLmFzc2VtYmx5RGF0ZSA9IG9yaWdNZXRhZGF0YS5hc3NlbWJseURhdGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2hyb21TaXplcyA9ICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPWNocm9tc2l6ZXNdJykudmFsKCk7XG4gICAgICAgICAgbWV0YWRhdGEubmFtZSA9ICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPW5hbWVdJykudmFsKCk7XG4gICAgICAgIH1cbiAgICAgICAgQ3VzdG9tR2Vub21lcy5wYXJzZUFzeW5jKGNocm9tU2l6ZXMsIG1ldGFkYXRhLCBmdW5jdGlvbihnZW5vbWUpIHtcbiAgICAgICAgICBzZWxmLl9zZXRPcHRpb25zKGdlbm9tZS5vcHRpb25zKHsgd2lkdGg6IHNlbGYubGluZVdpZHRoKCkgKiBzZWxmLiRsaW5lcy5sZW5ndGggfSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgXG4gICAgX2luaXRDdXN0b21HZW5vbWVEaWFsb2dzOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGdlbm9tZURpYWxvZyA9ICQoby5kaWFsb2dzWzVdKS5jbG9zZXN0KCcudWktZGlhbG9nJyksXG4gICAgICAgICRhZGQgPSAkZ2Vub21lRGlhbG9nLmZpbmQoJy5mb3JtLWxpbmUnKS5maXJzdCgpLFxuICAgICAgICAkb3ZlcmxheSA9ICQoby5vdmVybGF5WzBdKSxcbiAgICAgICAgJG92ZXJsYXlNZXNzYWdlID0gJChvLm92ZXJsYXlbMV0pLFxuICAgICAgICBmaWxlSW5wdXRIVE1MID0gJzxpbnB1dCB0eXBlPVwiZmlsZVwiIG5hbWU9XCJnZW5vbWVGaWxlXCIvPicsXG4gICAgICAgIHVybElucHV0SFRNTCA9ICc8aW5wdXQgdHlwZT1cInVybFwiIG5hbWU9XCJnZW5vbWVVcmxcIiBjbGFzcz1cInVybFwiLz4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCB0eXBlPVwiYnV0dG9uXCIgbmFtZT1cImdlbm9tZVVybEdldFwiIHZhbHVlPVwiTG9hZFwiLz4nO1xuICAgICAgXG4gICAgICBzZWxmLl9pbml0Q2hyb21TaXplc0RpYWxvZygpO1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBjdXN0b21HZW5vbWVFcnJvcihlKSB7XG4gICAgICAgICRnZW5vbWVEaWFsb2cuZmluZCgnLnNwaW5uZXInKS5oaWRlKCk7XG4gICAgICAgIHZhciBtc2cgPSBlLm1lc3NhZ2UucmVwbGFjZSgvXlVuY2F1Z2h0IEVycm9yOiAvLCAnJyk7XG4gICAgICAgIGFsZXJ0KCdTb3JyeSwgYW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgYWRkaW5nIHRoaXMgY3VzdG9tIGdlbm9tZSBmaWxlOlxcblxcbicgKyBtc2cpO1xuICAgICAgICAvLyBUT0RPOiByZXBsYWNlIHRoaXMgd2l0aCBzb21ldGhpbmcgbW9yZSBmcmllbmRseS5cbiAgICAgICAgcmVwbGFjZUZpbGVJbnB1dCgpOyBcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gaGFuZGxlRmlsZVNlbGVjdChlKSB7XG4gICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpLFxuICAgICAgICAgICRhZGQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcuZm9ybS1saW5lJyksXG4gICAgICAgICAgJHNwaW5uZXIgPSAkYWRkLmZpbmQoJy5zcGlubmVyJykuc2hvdygpO1xuICAgICAgICAgIFxuICAgICAgICAkb3ZlcmxheS5zaG93KCk7XG4gICAgICAgICRvdmVybGF5TWVzc2FnZS5zaG93KCkudGV4dCgnTG9hZGluZyBjdXN0b20gZ2Vub21lLi4uJyk7XG4gICAgICAgIFxuICAgICAgICBpZiAoZS50YXJnZXQuZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChmdW5jdGlvbihmKSB7XG4gICAgICAgICAgICB2YXIgbWV0YWRhdGEgPSB7IGZpbGU6IGYubmFtZSB9LFxuICAgICAgICAgICAgICBnZW5vbWU7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICAgICAgQ3VzdG9tR2Vub21lcy5wYXJzZUFzeW5jKGV2LnRhcmdldC5yZXN1bHQsIG1ldGFkYXRhLCBmdW5jdGlvbihnZW5vbWUpIHtcbiAgICAgICAgICAgICAgICBzZWxmLl9zZXRPcHRpb25zKGdlbm9tZS5vcHRpb25zKHsgd2lkdGg6IHNlbGYubGluZVdpZHRoKCkgKiBzZWxmLiRsaW5lcy5sZW5ndGggfSkpO1xuICAgICAgICAgICAgICAgICRzcGlubmVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAkZ2Vub21lRGlhbG9nLmZhZGVPdXQoKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pKGUudGFyZ2V0LmZpbGVzWzBdKTtcbiAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChlLnRhcmdldC5maWxlc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVwbGFjZUZpbGVJbnB1dCgpO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gcmVwbGFjZUZpbGVJbnB1dCgpIHtcbiAgICAgICAgXy5kZWZlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAkZ2Vub21lRGlhbG9nLmZpbmQoJ1tuYW1lPWdlbm9tZUZpbGVdJykucmVwbGFjZVdpdGgoZmlsZUlucHV0SFRNTCk7XG4gICAgICAgICAgJGdlbm9tZURpYWxvZy5maW5kKCdbbmFtZT1nZW5vbWVGaWxlXScpLmNoYW5nZShoYW5kbGVGaWxlU2VsZWN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAod2luZG93LkZpbGUgJiYgd2luZG93LkZpbGVSZWFkZXIgJiYgd2luZG93LkZpbGVMaXN0KSB7XG4gICAgICAgICRhZGQuZmluZCgnbGFiZWwnKS5odG1sKGZpbGVJbnB1dEhUTUwpO1xuICAgICAgICAkYWRkLmZpbmQoJ1tuYW1lPWdlbm9tZUZpbGVdJykuY2hhbmdlKGhhbmRsZUZpbGVTZWxlY3QpO1xuICAgICAgICAkYWRkID0gJGFkZC5uZXh0QWxsKCcuZm9ybS1saW5lJykuZmlyc3QoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRhZGQucmVtb3ZlKCk7XG4gICAgICAgICRnZW5vbWVEaWFsb2cuZmluZCgnLmhlbHAtbGluZScpLmZpcnN0KCkucmVtb3ZlKCk7XG4gICAgICAgICRhZGQgPSAkcGlja2VyLmZpbmQoJy5mb3JtLWxpbmUnKS5maXJzdCgpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBoYW5kbGVQYXN0ZWREYXRhKGUpIHtcbiAgICAgICAgdmFyICRhZGQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcuZm9ybS1saW5lJyksXG4gICAgICAgICAgJHNwaW5uZXIgPSAkYWRkLmZpbmQoJy5zcGlubmVyJykuc2hvdygpO1xuICAgICAgICAkb3ZlcmxheS5zaG93KCk7XG4gICAgICAgICRvdmVybGF5TWVzc2FnZS5zaG93KCkudGV4dCgnTG9hZGluZyBjdXN0b20gZ2Vub21lLi4uJyk7XG4gICAgICAgIEN1c3RvbUdlbm9tZXMucGFyc2VBc3luYygkYWRkLmZpbmQoJ3RleHRhcmVhJykudmFsKCksIHsgZmlsZTogXCJfcGFzdGVkX2RhdGFcIiB9LCBmdW5jdGlvbihnZW5vbWUpIHtcbiAgICAgICAgICBzZWxmLl9zZXRPcHRpb25zKGdlbm9tZS5vcHRpb25zKHsgd2lkdGg6IHNlbGYubGluZVdpZHRoKCkgKiBzZWxmLiRsaW5lcy5sZW5ndGggfSkpO1xuICAgICAgICAgICRzcGlubmVyLmhpZGUoKTtcbiAgICAgICAgICAkZ2Vub21lRGlhbG9nLmZhZGVPdXQoKTtcbiAgICAgICAgICAkYWRkLmZpbmQoJ3RleHRhcmVhJykudmFsKCcnKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAkYWRkLmZpbmQoJ1tuYW1lPWN1c3RvbUdlbm9tZVBhc3RlQWRkXScpLmNsaWNrKGhhbmRsZVBhc3RlZERhdGEpO1xuICAgICAgJGFkZCA9ICRhZGQubmV4dEFsbCgnLmZvcm0tbGluZScpLmZpcnN0KCk7XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIGhhbmRsZVVybFNlbGVjdChlKSB7XG4gICAgICAgIHZhciAkYWRkID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLmZvcm0tbGluZScpLFxuICAgICAgICAgICRzcGlubmVyID0gJGFkZC5maW5kKCcuc3Bpbm5lcicpLFxuICAgICAgICAgICR1cmwgPSAkYWRkLmZpbmQoJ1tuYW1lPWdlbm9tZVVybF0nKSxcbiAgICAgICAgICB1cmwgPSAkLnRyaW0oJHVybC52YWwoKSk7XG4gICAgICAgIGlmICghdXJsLmxlbmd0aCkgeyByZXR1cm47IH1cbiAgICAgICAgJHNwaW5uZXIuc2hvdygpO1xuICAgICAgICAkb3ZlcmxheS5zaG93KCk7XG4gICAgICAgICRvdmVybGF5TWVzc2FnZS5zaG93KCkudGV4dCgnTG9hZGluZyBjdXN0b20gZ2Vub21lLi4uJyk7XG4gICAgICAgICQuYWpheCh1cmwsIHtcbiAgICAgICAgICBkYXRhVHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgQ3VzdG9tR2Vub21lcy5wYXJzZUFzeW5jKGRhdGEsIHt1cmw6IHVybH0sIGZ1bmN0aW9uKGdlbm9tZSkge1xuICAgICAgICAgICAgICBzZWxmLl9zZXRPcHRpb25zKGdlbm9tZS5vcHRpb25zKHsgd2lkdGg6IHNlbGYubGluZVdpZHRoKCkgKiBzZWxmLiRsaW5lcy5sZW5ndGggfSkpO1xuICAgICAgICAgICAgICAkc3Bpbm5lci5oaWRlKCk7XG4gICAgICAgICAgICAgICR1cmwudmFsKCcnKTtcbiAgICAgICAgICAgICAgJGdlbm9tZURpYWxvZy5mYWRlT3V0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHByb2dyZXNzOiBmdW5jdGlvbihsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICB2YXIgJHByb2dyZXNzID0gJG92ZXJsYXlNZXNzYWdlLmZpbmQoJy51aS1wcm9ncmVzc2JhcicpO1xuICAgICAgICAgICAgaWYgKCEkcHJvZ3Jlc3MubGVuZ3RoKSB7ICRwcm9ncmVzcyA9ICQoJzxkaXYvPicpLmFwcGVuZFRvKCRvdmVybGF5TWVzc2FnZSkucHJvZ3Jlc3NiYXIoKTsgfVxuICAgICAgICAgICAgJHByb2dyZXNzLnByb2dyZXNzYmFyKCd2YWx1ZScsIGxvYWRlZC90b3RhbCAqIDEwMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkb3ZlcmxheS5oaWRlKCk7XG4gICAgICAgICAgICAkb3ZlcmxheU1lc3NhZ2UuaGlkZSgpO1xuICAgICAgICAgICAgY3VzdG9tR2Vub21lRXJyb3Ioe21lc3NhZ2U6IFwiTm8gdmFsaWQgY3VzdG9tIHRyYWNrIGRhdGEgd2FzIGZvdW5kIGF0IHRoaXMgVVJMLlwifSk7IFxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAkYWRkLmZpbmQoJ2xhYmVsJykuaHRtbCh1cmxJbnB1dEhUTUwpO1xuICAgICAgJGFkZC5maW5kKCdbbmFtZT1nZW5vbWVVcmxHZXRdJykuY2xpY2soaGFuZGxlVXJsU2VsZWN0KTtcbiAgICAgICRhZGQuZmluZCgnW25hbWU9Z2Vub21lVXJsXScpLmJpbmQoJ2tleWRvd24nLCBmdW5jdGlvbihlKSB7IGlmIChlLndoaWNoPT0xMykgeyBoYW5kbGVVcmxTZWxlY3QoZSk7IH0gfSk7XG4gICAgfSxcbiAgICBcbiAgICBfaW5pdEZyb21QYXJhbXM6IGZ1bmN0aW9uKHBhcmFtcywgc3VwcHJlc3NSZXBlYXQpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsXG4gICAgICAgICRvdmVybGF5ID0gJChvLm92ZXJsYXlbMF0pLFxuICAgICAgICAkb3ZlcmxheU1lc3NhZ2UgPSAkKG8ub3ZlcmxheVsxXSksXG4gICAgICAgICRjdXN0b21QaWNrZXIgPSAkKG8udHJhY2tQaWNrZXJbM10pLFxuICAgICAgICAkZ2Vub21lRGlhbG9nID0gJChvLmRpYWxvZ3NbNV0pLmNsb3Nlc3QoJy51aS1kaWFsb2cnKSxcbiAgICAgICAgJGNocm9tU2l6ZXNEaWFsb2cgPSAkKG8uZGlhbG9nc1s0XSkuY2xvc2VzdCgnLnVpLWRpYWxvZycpLFxuICAgICAgICAkdHJhY2tVcmxJbnB1dCA9ICRjdXN0b21QaWNrZXIuZmluZCgnW25hbWU9Y3VzdG9tVXJsXScpLFxuICAgICAgICAkdHJhY2tVcmxHZXQgPSAkY3VzdG9tUGlja2VyLmZpbmQoJ1tuYW1lPWN1c3RvbVVybEdldF0nKSxcbiAgICAgICAgJGdlbm9tZVVybElucHV0ID0gJGdlbm9tZURpYWxvZy5maW5kKCdbbmFtZT1nZW5vbWVVcmxdJyksXG4gICAgICAgICRnZW5vbWVVcmxHZXQgPSAkZ2Vub21lRGlhbG9nLmZpbmQoJ1tuYW1lPWdlbm9tZVVybEdldF0nKSxcbiAgICAgICAgcmVtb3RlR2Vub21lU2V0dGluZ3MgPSB7XG4gICAgICAgICAgdWNzYzogeyB1cmw6ICdjaHJvbXNpemVzLnBocCcsIG1lc3NhZ2VUZXh0OiAnZnJvbSBVQ1NDJyB9LFxuICAgICAgICAgIGlnYjogeyB1cmw6ICdpZ2IucGhwJywgbWVzc2FnZVRleHQ6ICd2aWEgSUdCIFF1aWNrbG9hZCcgfVxuICAgICAgICB9LFxuICAgICAgICBzZXNzaW9uVmFycyA9IHt9LFxuICAgICAgICBjdXN0b21UcmFja3NBcnJheSwgY3VzdG9tR2Vub21lUGllY2VzLCBjdXN0b21HZW5vbWVTb3VyY2UsIGN1c3RvbUdlbm9tZU5hbWUsIGNocm9tU2l6ZXMsIHRyYWNrU3BlYywgXG4gICAgICAgICAgcmVtb3RlLCByZW1vdGVQYXJhbXM7XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIHBlcnNpc3RlbnRDb29raWUoaywgdikgeyAkLmNvb2tpZShrLCB2LCB7ZXhwaXJlczogNjB9KTsgfVxuICAgICAgZnVuY3Rpb24gcmVtb3ZlQ29va2llKGspIHsgJC5jb29raWUoaywgbnVsbCk7IH1cbiAgICAgIHBlcnNpc3RlbnRDb29raWUoJ2RiJywgby5nZW5vbWUpO1xuICAgICAgc2VsZi5zdG9yYWdlID0ge1xuICAgICAgICBzZXNzaW9uOiB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UgfHwge3NldEl0ZW06ICQuY29va2llLCBnZXRJdGVtOiAkLmNvb2tpZSwgcmVtb3ZlSXRlbTogcmVtb3ZlQ29va2llfSxcbiAgICAgICAgcGVyc2lzdGVudDogd2luZG93LmxvY2FsU3RvcmFnZSB8fCB7c2V0SXRlbTogcGVyc2lzdGVudENvb2tpZSwgZ2V0SXRlbTogJC5jb29raWUsIHJlbW92ZUl0ZW06IHJlbW92ZUNvb2tpZX1cbiAgICAgIH07XG4gICAgICBfLmVhY2goby5zYXZhYmxlUGFyYW1zLCBmdW5jdGlvbihrZXlzLCBkZXN0KSB7XG4gICAgICAgIF8uZWFjaChrZXlzLCBmdW5jdGlvbihrKSB7XG4gICAgICAgICAgdmFyIHYgPSBzZWxmLnN0b3JhZ2VbZGVzdF0uZ2V0SXRlbSgoZGVzdCAhPSAncGVyc2lzdGVudCcgPyBvLmdlbm9tZSArICcuJyA6ICcnKSArIGspOyBcbiAgICAgICAgICBpZiAodiAhPT0gbnVsbCkgeyBzZXNzaW9uVmFyc1trXSA9IHY7IH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBfLmV4dGVuZCh7fSwgc2Vzc2lvblZhcnMsICQudXJsUGFyYW1zKCkpO1xuICAgICAgICAgICAgXG4gICAgICBpZiAoc3VwcHJlc3NSZXBlYXQgJiYgc2VsZi5fbGFzdFBhcmFtcyAmJiBfLmlzRXF1YWwoc2VsZi5fbGFzdFBhcmFtcywgcGFyYW1zKSkgeyByZXR1cm47IH1cbiAgICAgIHNlbGYuX2xhc3RQYXJhbXMgPSBfLmNsb25lKHBhcmFtcyk7XG4gICAgICBcbiAgICAgIGN1c3RvbVRyYWNrc0FycmF5ID0gXy5jb21wYWN0KFtdLmNvbmNhdChwYXJhbXMuY3VzdG9tVHJhY2tzKSksXG4gICAgICBzZWxmLl9jdXN0b21UcmFja1VybHMucmVxdWVzdGVkID0gXy51bmlvbihzZWxmLl9jdXN0b21UcmFja1VybHMucmVxdWVzdGVkLCBjdXN0b21UcmFja3NBcnJheSk7XG4gICAgICB2YXIgdW5wcm9jZXNzZWRVcmxzID0gXy5kaWZmZXJlbmNlKHNlbGYuX2N1c3RvbVRyYWNrVXJscy5yZXF1ZXN0ZWQsIHNlbGYuX2N1c3RvbVRyYWNrVXJscy5wcm9jZXNzaW5nKTtcbiAgICAgIFxuICAgICAgLy8gV2UgbmVlZCB0byBsb2FkIGEgY3VzdG9tIGdlbm9tZVxuICAgICAgaWYgKHBhcmFtcy5kYiAhPSBvLmdlbm9tZSkge1xuICAgICAgICBjdXN0b21HZW5vbWVQaWVjZXMgPSAocGFyYW1zLmRiIHx8ICcnKS5zcGxpdCgnOicpO1xuICAgICAgICBjdXN0b21HZW5vbWVTb3VyY2UgPSBjdXN0b21HZW5vbWVQaWVjZXNbMF07XG4gICAgICAgIHJlbW90ZSA9IHJlbW90ZUdlbm9tZVNldHRpbmdzW2N1c3RvbUdlbm9tZVNvdXJjZV07XG4gICAgICAgIGlmIChjdXN0b21HZW5vbWVTb3VyY2UgPT0gJ3VybCcpIHsgICAvLyBJdCdzIGEgVVJMIHRvIGEgZnVsbCBnZW5vbWUgZmlsZVxuICAgICAgICAgICRnZW5vbWVVcmxJbnB1dC52YWwoY3VzdG9tR2Vub21lUGllY2VzLnNsaWNlKDEpLmpvaW4oJzonKSk7XG4gICAgICAgICAgJGdlbm9tZVVybEdldC5jbGljaygpO1xuICAgICAgICAgIHNlbGYuX25leHREaXJlY3RpdmVzID0gcGFyYW1zO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIGlmIChyZW1vdGUpIHtcbiAgICAgICAgICAvLyBJdCdzIGEgZ2Vub21lIHN0b3JlZCBhdCBVQ1NDIG9yIGluIGFuIElHQiBRdWlja2xvYWQgZGlyZWN0b3J5XG4gICAgICAgICAgJG92ZXJsYXkuc2hvdygpO1xuICAgICAgICAgICRvdmVybGF5TWVzc2FnZS5zaG93KCkudGV4dCgnTG9hZGluZyBnZW5vbWUgJyArIHJlbW90ZS5tZXNzYWdlVGV4dCArICcuLi4nKTtcbiAgICAgICAgICBpZiAoY3VzdG9tR2Vub21lU291cmNlID09ICd1Y3NjJykge1xuICAgICAgICAgICAgcmVtb3RlUGFyYW1zID0geyBkYjogY3VzdG9tR2Vub21lUGllY2VzWzFdLCBsaW1pdDogY3VzdG9tR2Vub21lUGllY2VzWzJdLCBtZXRhOiAxIH07XG4gICAgICAgICAgfSBlbHNlIHsgLy8gY3VzdG9tR2Vub21lU291cmNlID09ICdpZ2InXG4gICAgICAgICAgICByZW1vdGVQYXJhbXMgPSB7IHVybDogY3VzdG9tR2Vub21lUGllY2VzLnNsaWNlKDIpLmpvaW4oJzonKSwgbGltaXQ6IGN1c3RvbUdlbm9tZVBpZWNlc1sxXSB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAkLmFqYXgoby5hamF4RGlyICsgcmVtb3RlLnVybCwge1xuICAgICAgICAgICAgZGF0YTogcmVtb3RlUGFyYW1zLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgaWYgKGRhdGEuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAkb3ZlcmxheU1lc3NhZ2UudGV4dCgnRXJyb3IgbG9hZGluZyBnZW5vbWUgZGF0YSAnICsgcmVtb3RlLm1lc3NhZ2VUZXh0KTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5kYXRhKCdnZW5vbWVNZXRhZGF0YScsIGRhdGEpO1xuICAgICAgICAgICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPXNhdmVdJykudHJpZ2dlcignY2xpY2snLCBbY3VzdG9tR2Vub21lU291cmNlXSk7XG4gICAgICAgICAgICAgICAgc2VsZi5fbmV4dERpcmVjdGl2ZXMgPSBwYXJhbXM7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSBpZiAoKC9eY3VzdG9tWzp8XS8pLnRlc3QocGFyYW1zLmRiKSkgeyAgIC8vIEl0J3MgYSBjdXN0b20gY2hyb20uc2l6ZXNcbiAgICAgICAgICBjaHJvbVNpemVzID0gcGFyYW1zLmRiLnJlcGxhY2UoL15bXnxdK1xcfC8sICcnKS5yZXBsYWNlKC86L2csIFwiXFx0XCIpLnJlcGxhY2UoL1xcfC9nLCBcIlxcblwiKTtcbiAgICAgICAgICAkY2hyb21TaXplc0RpYWxvZy5maW5kKCdbbmFtZT1jaHJvbXNpemVzXScpLnZhbChjaHJvbVNpemVzKTtcbiAgICAgICAgICBjdXN0b21HZW5vbWVOYW1lID0gKHBhcmFtcy5kYls2XSA9PSAnOicpID8gcGFyYW1zLmRiLnN1YnN0cmluZyg3KS5yZXBsYWNlKC9cXHwuKi8sICcnKSA6ICcnO1xuICAgICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPW5hbWVdJykudmFsKGN1c3RvbUdlbm9tZU5hbWUpO1xuICAgICAgICAgICRjaHJvbVNpemVzRGlhbG9nLmZpbmQoJ1tuYW1lPXNhdmVdJykudHJpZ2dlcignY2xpY2snLCBbJ2Nocm9tc2l6ZXMnXSk7XG4gICAgICAgICAgc2VsZi5fbmV4dERpcmVjdGl2ZXMgPSBwYXJhbXM7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIElmIHRoZXJlIGFyZSBjdXN0b20gdHJhY2sgVVJMcyBzb21ld2hlcmUgaW4gdGhlIHBhcmFtZXRlcnMgdGhhdCBoYXZlIG5vdCBiZWVuIHByb2Nlc3NlZCB5ZXRcbiAgICAgIC8vIHRoZXkgbmVlZCB0byBiZSBsb2FkZWQgYmVmb3JlIHdlIGNhbiBtYWtlIHNlbnNlIG9mIHRoZSByZXN0IG9mIHRoZSBwYXJhbXNcbiAgICAgIGlmICh1bnByb2Nlc3NlZFVybHMubGVuZ3RoKSB7XG4gICAgICAgICRvdmVybGF5LnNob3coKTtcbiAgICAgICAgJG92ZXJsYXlNZXNzYWdlLnNob3coKS50ZXh0KCdMb2FkaW5nIGN1c3RvbSB0cmFjay4uLicpO1xuICAgICAgICAkdHJhY2tVcmxJbnB1dC52YWwodW5wcm9jZXNzZWRVcmxzWzBdKTsgJHRyYWNrVXJsR2V0LmNsaWNrKCk7XG4gICAgICAgIC8vIFRoaXMgc2hvdWxkIGhhdmUgYWRkZWQgdGhlIFVSTCB0byBzZWxmLl9jdXN0b21UcmFja1VybHMucHJvY2Vzc2luZywgc28gaXQgd2lsbCBub3QgYmUgc3VibWl0dGVkIGFnYWluXG4gICAgICAgIHNlbGYuX25leHREaXJlY3RpdmVzID0gcGFyYW1zO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHBhcmFtcy5tb2RlKSB7ICQoby5saW5lTW9kZSkuZmluZCgnW3ZhbHVlPVwiJytwYXJhbXMubW9kZSsnXCJdJykuY2xpY2soKTsgfVxuICAgICAgICBpZiAocGFyYW1zLnRyYWNrcykge1xuICAgICAgICAgIHRyYWNrU3BlYyA9IF8ubWFwKHBhcmFtcy50cmFja3Muc3BsaXQoJ3wnKSwgZnVuY3Rpb24odikgeyBcbiAgICAgICAgICAgIHZhciBzcGxpdCA9IHYuc3BsaXQoJzonKSwgdHJrID0ge246IHNwbGl0WzBdfTtcbiAgICAgICAgICAgIGlmIChzcGxpdC5sZW5ndGggPiAxICYmICgvXlxcZCskLy50ZXN0KHNwbGl0WzFdKSkpIHsgdHJrLmggPSBwYXJzZUludChzcGxpdFsxXSwgMTApOyB9XG4gICAgICAgICAgICByZXR1cm4gdHJrOyBcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzZWxmLl9maXhUcmFja3Moe30sIHRyYWNrU3BlYyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhcmFtcy5wb3NpdGlvbikgeyBzZWxmLmp1bXBUbyhwYXJhbXMucG9zaXRpb24pOyB9XG4gICAgICB9XG4gICAgfSxcbiAgICBcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gPSBUaGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBjb29yZGluYXRlIHRoZSBkaXNwbGF5IG9mIGJyb3dzZXIgbGluZXMgKCQudWkuZ2Vub2xpbmUncykgPVxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBcbiAgICAvLyBGaXggdGhlIG51bWJlciBvZiBsaW5lcyBkaXNwbGF5ZWQgdmVydGljYWxseSwgc2hpZnRpbmcgYW5kIHVuc2hpZnRpbmcgbGluZXMgdG8gZmlsbCB0aGUgdmVydGljYWwgc3BhY2VcbiAgICAvLyBZb3UgY2FuIHNwZWNpZnkgdGhlIGxpbmUgaW5kZXggdG8gaG9sZFN0ZWFkeSAoa2VlcCBpbiByb3VnaGx5IHRoZSBzYW1lIHBsYWNlKSwgYW5kIGFuaW1PcHRzIGZvciB0aGUgYW5pbWF0aW9uXG4gICAgX2ZpeE51bUxpbmVzOiBmdW5jdGlvbihob2xkU3RlYWR5LCBhbmltT3B0cykge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCwgXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgIGF2YWlsSGVpZ2h0ID0gJGVsZW0uaW5uZXJIZWlnaHQoKSxcbiAgICAgICAgbGluZUhlaWdodCA9IHNlbGYuX2xpbmVIZWlnaHQoKSxcbiAgICAgICAgbnVtTGluZXMgPSBzZWxmLiRsaW5lcy5sZW5ndGgsXG4gICAgICAgIGZvcmNlT25lTGluZSA9ICQoby5saW5lTW9kZSkuZmluZCgnOmNoZWNrZWQnKS52YWwoKSA9PSAnc2luZ2xlJyxcbiAgICAgICAgbmV3TnVtTGluZXMgPSBmb3JjZU9uZUxpbmUgPyAxIDogTWF0aC5tYXgoZmxvb3JIYWNrKGF2YWlsSGVpZ2h0IC8gbGluZUhlaWdodCksIDEpLFxuICAgICAgICBleHRyYVNwYWNlID0gYXZhaWxIZWlnaHQgLSAobmV3TnVtTGluZXMgKiBsaW5lSGVpZ2h0KSxcbiAgICAgICAgZXh0cmFMaW5lSGVpZ2h0ID0gZXh0cmFTcGFjZSA+IDAgPyBsaW5lSGVpZ2h0ICsgZXh0cmFTcGFjZSAvIG5ld051bUxpbmVzIDogbGluZUhlaWdodCxcbiAgICAgICAgZXh0cmFUb3BNYXJnaW4gPSBuZXdOdW1MaW5lcyA9PT0gMSA/IE1hdGgubWF4KChhdmFpbEhlaWdodCAtIGxpbmVIZWlnaHQpIC8gMi4wLCAwKSA6IDAsXG4gICAgICAgIHVuU2hpZnRMaW5lcyA9IDAsIHB1c2hMaW5lcyA9IDAsXG4gICAgICAgIGRlc3RJbmRleCwgY3VyclRvcDtcbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZChob2xkU3RlYWR5KSAmJiBob2xkU3RlYWR5ICE9PSBudWxsKSB7XG4gICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChob2xkU3RlYWR5LnNoaWZ0KSkge1xuICAgICAgICAgIHVuU2hpZnRMaW5lcyA9IC1ob2xkU3RlYWR5LnNoaWZ0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGN1cnJUb3AgPSBzZWxmLiRsaW5lcy5lcShob2xkU3RlYWR5KS5wb3NpdGlvbigpLnRvcDtcbiAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UgdGhlIHJlc2l6aW5nIG9mIHRoZSBjZW50cmFsIGxpbmU6IGl0IG11c3Qgc3RheSB0aGUgY2VudHJhbCBsaW5lXG4gICAgICAgICAgaWYgKGhvbGRTdGVhZHkgPT0gdGhpcy5jZW50cmFsTGluZSkgeyBkZXN0SW5kZXggPSBNYXRoLmNlaWwobmV3TnVtTGluZXMgLyAyKSAtIDE7IH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGRlc3RJbmRleCA9IF8ubWluKF8ucmFuZ2UobmV3TnVtTGluZXMpLCBmdW5jdGlvbihpKSB7IFxuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoaSAqIGV4dHJhTGluZUhlaWdodCArIGV4dHJhVG9wTWFyZ2luIC0gY3VyclRvcCk7IFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHVuU2hpZnRMaW5lcyA9IGRlc3RJbmRleCAtIGhvbGRTdGVhZHk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHB1c2hMaW5lcyA9IG5ld051bUxpbmVzIC0gbnVtTGluZXMgLSB1blNoaWZ0TGluZXM7XG4gICAgICB1blNoaWZ0TGluZXMgPiAwID8gc2VsZi5fYWRkTGluZXMoLXVuU2hpZnRMaW5lcykgOiBzZWxmLl9yZW1vdmVMaW5lcyh1blNoaWZ0TGluZXMsIGFuaW1PcHRzKTtcbiAgICAgIHB1c2hMaW5lcyA+IDAgPyBzZWxmLl9hZGRMaW5lcyhwdXNoTGluZXMpIDogc2VsZi5fcmVtb3ZlTGluZXMoLXB1c2hMaW5lcywgYW5pbU9wdHMpO1xuICAgICAgc2VsZi5jZW50cmFsTGluZSA9IE1hdGguY2VpbChuZXdOdW1MaW5lcyAvIDIpIC0gMTtcbiAgICAgIHNlbGYuX3BvcyhzZWxmLnBvcyAtIHVuU2hpZnRMaW5lcyAqIHNlbGYuYnBXaWR0aCgpKTtcbiAgICAgIC8vIE9ubHkgZmlyZSBhIGNvbXBsZXRpb24gY2FsbGJhY2sgb25jZSBmb3IgdGhlIHdob2xlIGJyb3dzZXJcbiAgICAgIGlmIChhbmltT3B0cyAmJiBhbmltT3B0cy5jb21wbGV0ZSkgeyBhbmltT3B0cy5jb21wbGV0ZSA9IF8uYWZ0ZXIoc2VsZi4kbGluZXMubGVuZ3RoLCBhbmltT3B0cy5jb21wbGV0ZSk7IH1cbiAgICAgIHNlbGYuJGxpbmVzLmVhY2goZnVuY3Rpb24oaSkge1xuICAgICAgICB2YXIgbmV3VG9wID0gaSAqIGV4dHJhTGluZUhlaWdodCArIGV4dHJhVG9wTWFyZ2luO1xuICAgICAgICAkKHRoaXMpLmRhdGEoJ25hdHVyYWxUb3AnLCBuZXdUb3ApO1xuICAgICAgICBpZiAoaG9sZFN0ZWFkeSAmJiBob2xkU3RlYWR5LmV4Y2VwdEZvciA9PSB0aGlzKSB7IHJldHVybjsgfVxuICAgICAgICAkKHRoaXMpLmFuaW1hdGUoe3RvcDogbmV3VG9wfSwgJC5leHRlbmQoe1xuICAgICAgICAgIGR1cmF0aW9uOiBvLmxpbmVGaXhEdXJhdGlvbixcbiAgICAgICAgICBxdWV1ZTogZmFsc2UsXG4gICAgICAgICAgZWFzaW5nOiAnZWFzZUluT3V0UXVhcnQnXG4gICAgICAgIH0sIGFuaW1PcHRzKSk7XG4gICAgICB9KTtcbiAgICAgIHNlbGYuX3VwZGF0ZVJldGljbGUobnVsbCwgYW5pbU9wdHMpO1xuICAgIH0sXG4gICAgXG4gICAgLy8gQSBzaG9ydGN1dCB0aGF0IHB1c2hlcyB0aGUgbGluZXMgaW4gdGhlIGRpc3BsYXkgdXAgb3IgZG93blxuICAgIHNoaWZ0TGluZXM6IGZ1bmN0aW9uKG51bSwgZXhjZXB0Rm9yLCBhbmltT3B0cykgeyB0aGlzLl9maXhOdW1MaW5lcyh7c2hpZnQ6IG51bSwgZXhjZXB0Rm9yOiBleGNlcHRGb3J9LCBhbmltT3B0cyk7IH0sXG4gICAgXG4gICAgLy8gQWRkIG51bSBsaW5lcyB0byB0aGUgYnJvd3NlcjsgdGhleSBiZWdpbiBvZmZzY3JlZW4gYW5kIG11c3QgYmUgbW92ZWQgaW50byB2aWV3XG4gICAgLy8gcG9zaXRpdmUgbnVtIGFkZHMgdG8gdGhlIGVuZDsgbmVnYXRpdmUgbnVtIGFkZHMgdG8gdGhlIGJlZ2lubmluZ1xuICAgIF9hZGRMaW5lczogZnVuY3Rpb24obnVtKSB7XG4gICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgYnBXaWR0aCA9IHRoaXMuYnBXaWR0aCgpLFxuICAgICAgICBvcmlnaW4gPSB0aGlzLnBvcyArIChudW0gPiAwID8gdGhpcy4kbGluZXMubGVuZ3RoICogYnBXaWR0aCA6IC1icFdpZHRoKSxcbiAgICAgICAgYnBTdGVwID0gbnVtID4gMCA/IGJwV2lkdGggOiAtYnBXaWR0aCxcbiAgICAgICAgLy8gQ2FuJ3QgdXNlIG5vcm1hbCAudW5zaGlmdCgpIG9uIGEgalF1ZXJ5IG9iamVjdCwgaXQgb25seSBoYXMgc3BsaWNlLlxuICAgICAgICBvcHMgPSBudW0gPiAwID8gWydhcHBlbmRUbycsIGZ1bmN0aW9uKHgpe3RoaXMucHVzaCh4KTt9XSA6IFsncHJlcGVuZFRvJywgZnVuY3Rpb24oeCl7dGhpcy5zcGxpY2UoMCwwLHgpO31dLFxuICAgICAgICBzZXRUb3AgPSBudW0gPiAwID8gJCh3aW5kb3cpLmlubmVySGVpZ2h0KCkgKyBvLmJldHdlZW5MaW5lcyA6IC10aGlzLl9saW5lSGVpZ2h0KCksXG4gICAgICAgICRsaW5lLCBuZXdPcHRzO1xuICAgICAgbnVtID0gTWF0aC5hYnMobnVtKTtcbiAgICAgIHdoaWxlIChudW0tLT4wKSB7XG4gICAgICAgICRsaW5lID0gJCgnPGRpdiBjbGFzcz1cImJyb3dzZXItbGluZVwiPjwvZGl2PicpW29wc1swXV0odGhpcy5lbGVtZW50KTtcbiAgICAgICAgbmV3T3B0cyA9ICQuZXh0ZW5kKHt9LCBvLCB7YnJvd3NlcjogdGhpcy5lbGVtZW50LCBvcmlnaW46IG9yaWdpbn0pO1xuICAgICAgICBvcHNbMV0uY2FsbCh0aGlzLiRsaW5lcywgJGxpbmUuZ2V0KDApKTtcbiAgICAgICAgJGxpbmUuY3NzKCd0b3AnLCBzZXRUb3ApLmdlbm9saW5lKG5ld09wdHMpO1xuICAgICAgICBvcmlnaW4gKz0gYnBTdGVwO1xuICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLy8gUmVtb3ZlIG51bSBsaW5lcyB0byB0aGUgYnJvd3NlcjsgdGhleSBmYWRlIG91dCBhbmQgYXJlIGRlbGV0ZWQgZnJvbSB0aGUgRE9NXG4gICAgLy8gcG9zaXRpdmUgbnVtIHJlbW92ZXMgZnJvbSB0aGUgZW5kOyBuZWdhdGl2ZSBudW0gcmVtb3ZlcyBmcm9tIHRoZSBiZWdpbm5pbmdcbiAgICBfcmVtb3ZlTGluZXM6IGZ1bmN0aW9uKG51bSwgYW5pbU9wdHMpIHtcbiAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgICBicFdpZHRoID0gdGhpcy5icFdpZHRoKCksXG4gICAgICAgIGR1cmF0aW9uID0gYW5pbU9wdHMgJiYgIV8uaXNVbmRlZmluZWQoYW5pbU9wdHMuZHVyYXRpb24pID8gYW5pbU9wdHMuZHVyYXRpb24gOiBvLmxpbmVGaXhEdXJhdGlvbixcbiAgICAgICAgaW5kZXggPSBudW0gPiAwID8gLTEgOiAwLFxuICAgICAgICAvLyBXZSBjYW4ndCB1c2Ugbm9ybWFsIC5wb3AoKSBhbmQgLnNoaWZ0KCkgb24gYSBqUXVlcnkgb2JqZWN0LCBpdCBvbmx5IGhhcyBzcGxpY2UuXG4gICAgICAgIHBvcE9yU2hpZnQgPSBudW0gPiAwID8gXG4gICAgICAgICAgZnVuY3Rpb24oJGEpeyAkYS5zcGxpY2UoJGEubGVuZ3RoLTEsMSk7IH0gOiBmdW5jdGlvbigkYSl7ICRhLnNwbGljZSgwLDEpOyB9O1xuICAgICAgbnVtID0gTWF0aC5hYnMobnVtKTtcbiAgICAgIHdoaWxlIChudW0tLT4wKSB7XG4gICAgICAgIGlmIChkdXJhdGlvbiA+IDApIHtcbiAgICAgICAgICB0aGlzLiRsaW5lcy5lcShpbmRleCkuZmFkZU91dChkdXJhdGlvbiwgZnVuY3Rpb24oKSB7ICQodGhpcykucmVtb3ZlKCk7IH0pO1xuICAgICAgICB9IGVsc2UgeyB0aGlzLiRsaW5lcy5lcShpbmRleCkucmVtb3ZlKCk7IH1cbiAgICAgICAgcG9wT3JTaGlmdCh0aGlzLiRsaW5lcyk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcbiAgICAvLyBSZXR1cm5zIHRoZSBlbGVtZW50cyB0aGF0IGNvbnRhaW4gZWFjaCBsaW5lIG9mIHRoZSBkaXNwbGF5XG4gICAgbGluZXM6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy4kbGluZXM7IH0sXG4gICAgXG4gICAgLy8gUmV0dXJucyB0aGUgZXhwZWN0ZWQgd2lkdGgsIGluIHBpeGVscywgb2YgZWFjaCBsaW5lXG4gICAgbGluZVdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuX3dpZHRoIC0gdGhpcy5vcHRpb25zLnNpZGVCYXJXaWR0aDsgfSxcbiAgICBcbiAgICAvLyBSZXR1cm5zIHRoZSBleHBlY3RlZCBoZWlnaHQsIGluIHBpeGVscywgb2YgZWFjaCBsaW5lXG4gICAgX2xpbmVIZWlnaHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICByZXR1cm4gby5iZXR3ZWVuTGluZXMgKyBfLnJlZHVjZShvLnRyYWNrcywgZnVuY3Rpb24odCwgdSkgeyByZXR1cm4ge2g6dC5oICsgdS5ofTsgfSkuaDtcbiAgICB9LFxuICAgIFxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gPSBUaGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBjb29yZGluYXRlIHRoZSB0cmFja3MgKCQudWkuZ2Vub3RyYWNrJ3MpIGRpc3BsYXllZCB3aXRoaW4gZWFjaCBsaW5lID1cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFxuICAgIC8vIFJldHVybnMgdGhlIGN1cnJlbnQgYXJyYXkgb2YgdHJhY2tzLCB3aXRoIGFsbCBhc3NvY2lhdGVkIG9wdGlvbnMsIHRoYXQgYXJlIHN1cHBvc2VkIHRvIGJlIGRpc3BsYXllZFxuICAgIHRyYWNrczogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLm9wdGlvbnMudHJhY2tzOyB9LFxuICAgIFxuICAgIC8vIEVuc3VyZXMgYWxsIGxpbmVzIGhhdmUgdGhlIHJpZ2h0IHRyYWNrcywgYXMgc3BlY2lmaWVkIGJ5IHRoZSBjaGVja2JveGVzIGluIHRoZSB0cmFjayBwaWNrZXJzIG9yIHRoZSB0cmFja1NwZWNcbiAgICBfZml4VHJhY2tzOiBmdW5jdGlvbihhbmltT3B0cywgdHJhY2tTcGVjKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgICRlbGVtID0gc2VsZi5lbGVtZW50LFxuICAgICAgICBuZXdUcmFja3MgPSBbXSxcbiAgICAgICAgcHJldlRyYWNrcyA9IFtdLFxuICAgICAgICBwcmV2UG9zID0gc2VsZi5wb3MgKyBzZWxmLl9yZXRpY0RlbHRhKCksXG4gICAgICAgIGV4dGVybmFsVHJhY2tTcGVjID0gISF0cmFja1NwZWM7XG4gICAgICBcbiAgICAgIC8vIFN5bmMgdGhlIHRyYWNrU3BlYyB3aXRoIHRoZSBjaGVja2JveGVzIGluIHRoZSB0cmFjayBwaWNrZXJzXG4gICAgICAvLyBJZiB0cmFja1NwZWMgd2FzIG5vdCBwcm92aWRlZCwgdGhpcyBzaW1wbHkgcmV0cmlldmVzIG9uZSBmcm9tIHRoZSBzdGF0ZSBvZiB0aGUgY2hlY2tib3hlc1xuICAgICAgdHJhY2tTcGVjID0gc2VsZi5fdHJhY2tTcGVjKHRyYWNrU3BlYyk7XG4gICAgICBuZXdUcmFja3MgPSBfLnBsdWNrKHRyYWNrU3BlYywgJ24nKTtcbiAgICAgIFxuICAgICAgLy8gRmlyc3QgcmVtb3ZlIGFueSB0cmFja3MgdGhhdCBhcmUgbm90IGluIHRoZSBuZXcgc2V0XG4gICAgICBvLnRyYWNrcyA9IF8uZmlsdGVyKG8udHJhY2tzLCBmdW5jdGlvbih0KSB7XG4gICAgICAgIHZhciBpID0gXy5pbmRleE9mKG5ld1RyYWNrcywgdC5uKTtcbiAgICAgICAgaWYgKGkgIT09IC0xKSB7IFxuICAgICAgICAgIHByZXZUcmFja3MucHVzaCh0Lm4pO1xuICAgICAgICAgIC8vIFJlc2l6ZSBleGlzdGluZyB0cmFja3MgaWYgYSBuZXcgaGVpZ2h0IGlzIHNwZWNpZmllZFxuICAgICAgICAgIGlmICh0cmFja1NwZWNbaV0uaCkgeyBzZWxmLl9yZXNpemVUcmFjayh0Lm4sIHRyYWNrU3BlY1tpXS5oLCBmYWxzZSwgZmFsc2UpOyB9XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gTm93LCBhZGQgYW55IHRyYWNrcyB0aGF0IGFyZSBpbiB0aGUgbmV3IHNldCBidXQgYXJlbid0IGluIHRoZSBvbGQgc2V0XG4gICAgICBfLmVhY2gobmV3VHJhY2tzLCBmdW5jdGlvbihuYW1lLCBpKSB7XG4gICAgICAgIHZhciBzcGVjID0gdHJhY2tTcGVjW2ldO1xuICAgICAgICBpZiAoIV8uaW5jbHVkZShwcmV2VHJhY2tzLCBuYW1lKSkgeyBvLnRyYWNrcy5zcGxpY2UoaSwgMCwgJC5leHRlbmQoe30sIHNlbGYuYXZhaWxUcmFja3NbbmFtZV0sIHNwZWMuaCA/IHtoOiBzcGVjLmh9IDoge30pKTsgfSBcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBzZWxmLiRsaW5lcy5nZW5vbGluZSgnZml4VHJhY2tzJyk7XG4gICAgICBzZWxmLl9maXhOdW1MaW5lcygwLCBhbmltT3B0cyk7XG4gICAgICBpZiAocHJldlBvcyA8IG8uZ2Vub21lU2l6ZSAmJiBwcmV2UG9zID4gMCAmJiAoIWFuaW1PcHRzIHx8ICFhbmltT3B0cy5jb21wbGV0ZSkpIHsgc2VsZi5qdW1wVG8ocHJldlBvcyk7IH1cbiAgICAgIGlmICghZXh0ZXJuYWxUcmFja1NwZWMpIHsgdGhpcy5fc2F2ZVBhcmFtc0RlYm91bmNlZCgpOyB9XG4gICAgfSxcbiAgICBcbiAgICAvLyBSZXNpemUgYSB0cmFjayB0byBhIHBhcnRpY3VsYXIgaGVpZ2h0LCBmaXhpbmcgdGhlIGxpbmUgbGF5b3V0IGFmdGVyd2FyZCB1bmxlc3MgZml4TnVtTGluZXNIb2xkaW5nU3RlYWR5IGlzIGZhbHNlLFxuICAgIC8vIFNldCBhbmltQ2FsbGJhY2sgdG8gdHJ1ZSB0byBhbmltYXRlIHdpdGggbm8gY2FsbGJhY2ssIGEgZnVuY3Rpb24gdG8gcHJvdmlkZSBhIGNhbGxiYWNrLCBvciBmYWxzZSBmb3Igbm8gYW5pbWF0aW9uLlxuICAgIF9yZXNpemVUcmFjazogZnVuY3Rpb24obmFtZSwgaGVpZ2h0LCBmaXhOdW1MaW5lc0hvbGRpbmdTdGVhZHksIGFuaW1DYWxsYmFjaykge1xuICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICRlbGVtID0gdGhpcy5lbGVtZW50LFxuICAgICAgICB0cmsgPSBfLmZpbmQoby50cmFja3MsIGZ1bmN0aW9uKHQpIHsgcmV0dXJuIHQubiA9PSBuYW1lOyB9KSxcbiAgICAgICAgJGxpbmVzID0gdGhpcy4kbGluZXMsXG4gICAgICAgICR0cmFja3MgPSAkbGluZXMuZmluZCgnLmJyb3dzZXItdHJhY2stJytuYW1lKTtcbiAgICAgIGFuaW1DYWxsYmFjayA9IF8uaXNGdW5jdGlvbihhbmltQ2FsbGJhY2spID8gXy5hZnRlcigkdHJhY2tzLmxlbmd0aCwgYW5pbUNhbGxiYWNrKSA6IGFuaW1DYWxsYmFjaztcbiAgICAgIHRyay5oID0gaGVpZ2h0O1xuICAgICAgJHRyYWNrcy5nZW5vdHJhY2soJ3Jlc2l6ZScsIGhlaWdodCwgYW5pbUNhbGxiYWNrKTtcbiAgICAgIGlmIChmaXhOdW1MaW5lc0hvbGRpbmdTdGVhZHkgIT09IGZhbHNlKSB7IHRoaXMuX2ZpeE51bUxpbmVzKGZpeE51bUxpbmVzSG9sZGluZ1N0ZWFkeSk7IH1cbiAgICAgICRsaW5lcy5nZW5vbGluZSgnZml4Rmlyc3RMYWJlbCcsIHRydWUpO1xuICAgIH0sXG4gICAgXG4gICAgLy8gU3luY3MgYSBsaXN0IG9mIHRyYWNrcyAod2l0aCBoZWlnaHRzKSwgdGhlIHRyYWNrU3BlYywgd2l0aCB0aGUgY2hlY2tib3hlcyBpbiB0aGUgdHJhY2sgcGlja2Vyc1xuICAgIF90cmFja1NwZWM6IGZ1bmN0aW9uKHRyYWNrU3BlYykge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAkY2hlY2tib3hlcyA9IHNlbGYuJHRyYWNrUGlja2VyLmZpbmQoJzpjaGVja2JveCcpLmFkZChzZWxmLiRjdXN0b21UcmFja3MuZmluZCgnOmNoZWNrYm94JykpO1xuICAgICAgaWYgKCF0cmFja1NwZWMgfHwgIV8uaXNBcnJheSh0cmFja1NwZWMpIHx8ICF0cmFja1NwZWMubGVuZ3RoKSB7XG4gICAgICAgIHRyYWNrU3BlYyA9IFtdO1xuICAgICAgICAkY2hlY2tib3hlcy5maWx0ZXIoJzpjaGVja2VkJykuZWFjaChmdW5jdGlvbigpIHsgdHJhY2tTcGVjLnB1c2goe246ICQodGhpcykuYXR0cignbmFtZScpfSk7IH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ2xlYW51cCBleHRlcm5hbCB0cmFja1NwZWNzOiBmb3Igbm93LCBkaXNhbGxvdyBkdXBlcywgYW5kIG1ha2Ugc3VyZSBhbGwgdHJhY2tzIGFjdHVhbGx5IGV4aXN0XG4gICAgICAgIHRyYWNrU3BlYyA9IF8udW5pcShfLmZpbHRlcih0cmFja1NwZWMsIGZ1bmN0aW9uKHQpIHsgcmV0dXJuIHNlbGYuYXZhaWxUcmFja3NbdC5uXTsgfSksIGZ1bmN0aW9uKHQpIHsgcmV0dXJuIHQubjsgfSk7XG4gICAgICAgICRjaGVja2JveGVzLmF0dHIoJ2NoZWNrZWQnLCBmYWxzZSk7XG4gICAgICAgIF8uZWFjaCh0cmFja1NwZWMsIGZ1bmN0aW9uKHQpIHsgJGNoZWNrYm94ZXMuZmlsdGVyKCdbbmFtZT1cIicrdC5uKydcIl0nKS5hdHRyKCdjaGVja2VkJywgdHJ1ZSk7IH0pO1xuICAgICAgfVxuICAgICAgLy8gaWYgdGhlcmUgaXMgb25seSBvbmUgbmV3VHJhY2ssIGRpc2FibGUgdGhlIGNoZWNrYm94IHNvIHRoZXJlIGFyZSBhbHdheXMg4omlMSB0cmFja3NcbiAgICAgIGlmICh0cmFja1NwZWMubGVuZ3RoID09PSAxKSB7ICRjaGVja2JveGVzLmZpbHRlcignOmNoZWNrZWQnKS5hdHRyKCdkaXNhYmxlZCcsIHRydWUpOyB9XG4gICAgICBlbHNlIHsgJGNoZWNrYm94ZXMuYXR0cignZGlzYWJsZWQnLCBmYWxzZSk7IH1cbiAgICAgIHJldHVybiB0cmFja1NwZWM7XG4gICAgfSxcbiAgICBcbiAgICAvLyBSZXNldHMgdG8gdGhlIGRlZmF1bHQgc2V0IG9mIHRyYWNrc1xuICAgIF9yZXNldFRvRGVmYXVsdFRyYWNrczogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLl9maXhUcmFja3MoZmFsc2UsIHRoaXMuZGVmYXVsdFRyYWNrcyk7XG4gICAgICB0aGlzLl9zYXZlUGFyYW1zRGVib3VuY2VkKCk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBBZnRlciBhIGN1c3RvbSB0cmFjayBmaWxlIGlzIHBhcnNlZCwgdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgdG8gYWRkIHRoZW0gdG8gdGhlIGN1c3RvbSB0cmFjayBwaWNrZXIgYW5kIGVhY2hcbiAgICAvLyBicm93c2VyIGxpbmU7IHRoZXkgYXJlIGFsc28gaW5zZXJ0ZWQgaW4gc2VsZi5hdmFpbFRyYWNrcyBqdXN0IGxpa2UgXCJub3JtYWxcIiB0cmFja3NcbiAgICBfYWRkQ3VzdG9tVHJhY2tzOiBmdW5jdGlvbihmbmFtZSwgY3VzdG9tVHJhY2tzLCB1cmwpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgJHVsID0gJChvLnRyYWNrUGlja2VyWzNdKS5jaGlsZHJlbigndWwnKS5lcSgwKSxcbiAgICAgICAgZCA9IG8udHJhY2tEZXNjLFxuICAgICAgICBicm93c2VyRGlyZWN0aXZlcyA9IF8uZXh0ZW5kKHt9LCBjdXN0b21UcmFja3MuYnJvd3Nlciwgc2VsZi5fbmV4dERpcmVjdGl2ZXMgfHwge30pLFxuICAgICAgICB3YXJuaW5ncyA9IFtdLFxuICAgICAgICBjdXN0b21UcmFja05hbWVzID0gXy5tYXAoY3VzdG9tVHJhY2tzLCBmdW5jdGlvbih0LCBpKSB7IHJldHVybiBjbGFzc0ZyaWVuZGx5KCdfJytmbmFtZSsnXycrKHQub3B0cy5uYW1lIHx8IGkpKTsgfSksXG4gICAgICAgIG5ld1RyYWNrcyA9IF8uZmlsdGVyKGN1c3RvbVRyYWNrTmFtZXMsIGZ1bmN0aW9uKG4pIHsgcmV0dXJuICFzZWxmLmF2YWlsVHJhY2tzW25dIH0pLFxuICAgICAgICBuZXh0RGlyZWN0aXZlc0luY2x1ZGVPbmVOZXdUcmFjayA9IHNlbGYuX25leHREaXJlY3RpdmVzICYmIHNlbGYuX25leHREaXJlY3RpdmVzLnRyYWNrcyAmJlxuICAgICAgICAgICEhXy5maW5kKHNlbGYuX25leHREaXJlY3RpdmVzLnRyYWNrcy5zcGxpdCgnfCcpLCBmdW5jdGlvbih2KSB7IHJldHVybiBfLmNvbnRhaW5zKG5ld1RyYWNrcywgdi5zcGxpdCgnOicpWzBdKTsgfSk7XG4gICAgICBcbiAgICAgIF8uZWFjaChjdXN0b21UcmFja3MsIGZ1bmN0aW9uKHQsIGkpIHtcbiAgICAgICAgdmFyIG4gPSBjdXN0b21UcmFja05hbWVzW2ldLFxuICAgICAgICAgIG5ld1RyYWNrID0gIXNlbGYuYXZhaWxUcmFja3Nbbl0sXG4gICAgICAgICAgJGxpLCAkbCwgJGMsICRkLCAkbztcbiAgICAgICAgaWYgKG5ld1RyYWNrKSB7XG4gICAgICAgICAgJGxpID0gJCgnPGxpIGNsYXNzPVwiY2hvaWNlXCIvPicpLmFwcGVuZFRvKCR1bCk7XG4gICAgICAgICAgJGwgPSAkKCc8bGFiZWwgY2xhc3M9XCJjbGlja2FibGVcIi8+JykuYXBwZW5kVG8oJGxpKTtcbiAgICAgICAgICAkYyA9ICQoJzxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBjaGVja2VkPVwiY2hlY2tlZFwiLz4nKS5hdHRyKCduYW1lJywgbikucHJlcGVuZFRvKCRsKTtcbiAgICAgICAgICAkZCA9ICQoJzxkaXYgY2xhc3M9XCJkZXNjXCI+PC9kaXY+JykuYXBwZW5kVG8oJGwpO1xuICAgICAgICAgICRvID0gJCgnPGJ1dHRvbiBjbGFzcz1cIm9wdHNcIj48aW1nIHNyYz1cImNzcy9nZWFyLnBuZ1wiIGFsdD1cImdlYXJcIiAvPjwvYnV0dG9uPicpLmFwcGVuZFRvKCRsaSksXG4gICAgICAgICAgJGwuaG92ZXIoZnVuY3Rpb24oKSB7ICQodGhpcykuYWRkQ2xhc3MoJ2hvdmVyJyk7IH0sIGZ1bmN0aW9uKCkgeyAkKHRoaXMpLnJlbW92ZUNsYXNzKCdob3ZlcicpOyB9KTtcbiAgICAgICAgICAkbC5hdHRyKCd0aXRsZScsIG4pO1xuICAgICAgICAgICRjLmJpbmQoJ2NoYW5nZScsIF8uYmluZChzZWxmLl9maXhUcmFja3MsIHNlbGYpKTtcbiAgICAgICAgICAkby5idXR0b24oKS5jbGljayhfLmJpbmQoc2VsZi5fZWRpdEN1c3RvbVRyYWNrLCBzZWxmLCBuKSk7XG4gICAgICAgICAgJCgnPGgzIGNsYXNzPVwibmFtZVwiLz48cCBjbGFzcz1cImxvbmctZGVzY1wiLz4nKS5hcHBlbmRUbygkZCk7XG4gICAgICAgICAgLy8gSWYgdHJhY2sgc2V0dGluZ3MgYXJlIHRvIGJlIGFwcGxpZWQsIGVuc3VyZSBhbnkgbmV3IGN1c3RvbSB0cmFja3MgYXJlIGFkZGVkIHRvIHRoZW1cbiAgICAgICAgICAvLyBUaGlzIHByZXZlbnRzIG5ldyB0cmFja3MgZnJvbSBiZWluZyBhZGRlZCBhbmQgdGhlbiBpbW1lZGlhdGVseSBoaWRkZW4gKGNvbmZ1c2luZylcbiAgICAgICAgICAvLyAtLSBPbmUgZXhjZXB0aW9uISBJZiBzZWxmLl9uZXh0RGlyZWN0aXZlcyBjb250YWluIGF0IGxlYXN0IG9uZSB0cmFjayBuYW1lXG4gICAgICAgICAgLy8gICAgYW1vbmcgdGhlIG5ldyB0cmFja3MgdG8gYmUgYWRkZWQsIGRvIG5vdCBkbyB0aGlzLCB3ZSB0aGVuIGFzc3VtZSB0aGV5IGFyZSBvdmVycmlkaW5nLlxuICAgICAgICAgIGlmIChicm93c2VyRGlyZWN0aXZlcy50cmFja3MgJiYgIW5leHREaXJlY3RpdmVzSW5jbHVkZU9uZU5ld1RyYWNrKSB7XG4gICAgICAgICAgICBpZiAoIV8uZmluZChicm93c2VyRGlyZWN0aXZlcy50cmFja3Muc3BsaXQoJ3wnKSwgZnVuY3Rpb24odikgeyByZXR1cm4gdi5zcGxpdCgnOicpWzBdID09IG47IH0pKSB7XG4gICAgICAgICAgICAgIGJyb3dzZXJEaXJlY3RpdmVzLnRyYWNrcyArPSAnfCcgKyBuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHsgJGQgPSAkdWwuZmluZCgnW25hbWU9JytuKyddJykucGFyZW50KCkuY2hpbGRyZW4oJy5kZXNjJyk7IH1cbiAgICAgICAgaWYgKHVybCkgeyB0LnVybCA9IHVybDsgfVxuICAgICAgICAvLyBUT0RPOiBpZiB0aGUgdHJhY2sgaXMgbm90IG5ldywgaW5mb3JtIHRoYXQgaXRzIGRhdGEgd2FzIHJlcGxhY2VkIHdpdGggdGhlIG5ldyB0cmFjayBpbmZvcm1hdGlvblxuICAgICAgICBzZWxmLmF2YWlsVHJhY2tzW25dID0ge1xuICAgICAgICAgIGZoOiB7XCIwLjFcIjoge2RlbnNlOiB0LmhlaWdodHMuc3RhcnR9fSxcbiAgICAgICAgICBuOiBuLFxuICAgICAgICAgIGg6IHQuaGVpZ2h0cy5zdGFydCxcbiAgICAgICAgICBzOiB0LnNpemVzLFxuICAgICAgICAgIG06IHQubWFwU2l6ZXMsXG4gICAgICAgICAgY3VzdG9tOiB0XG4gICAgICAgIH07XG4gICAgICAgIF8uZWFjaChvLmJwcHBzLCBmdW5jdGlvbihicHBwKSB7IHNlbGYuYXZhaWxUcmFja3Nbbl0uZmhbby5icHBwRm9ybWF0KGJwcHApXSA9IHtkZW5zZTogdC5oZWlnaHRzLm1pbn07IH0pO1xuICAgICAgICBkW25dID0ge1xuICAgICAgICAgIGNhdDogZm5hbWUsXG4gICAgICAgICAgbGc6IHQub3B0cy5kZXNjcmlwdGlvbiB8fCB0Lm9wdHMubmFtZSB8fCBuLCBcbiAgICAgICAgICBzbTogdC5vcHRzLm5hbWUgfHwgblxuICAgICAgICB9O1xuICAgICAgICAkZC5jaGlsZHJlbignaDMubmFtZScpLnRleHQoZFtuXS5zbSk7XG4gICAgICAgICRkLmNoaWxkcmVuKCdwLmxvbmctZGVzYycpLnRleHQoZFtuXS5sZyAmJiBkW25dLmxnICE9IGRbbl0uc20gPyBkW25dLmxnIDogZm5hbWUpO1xuICAgICAgICBpZiAodC53YXJuaW5ncykgeyB3YXJuaW5ncy5wdXNoLmFwcGx5KHdhcm5pbmdzLCB0Lndhcm5pbmdzKTsgfVxuICAgICAgfSk7XG4gICAgICBpZiAod2FybmluZ3MubGVuZ3RoKSB7XG4gICAgICAgIC8vIFRPRE86IERpc3BsYXkgd2FybmluZ3MgZnJvbSBjdXN0b20gdHJhY2sgcGFyc2luZyB0byB0aGUgdXNlclxuICAgICAgICBjb25zb2xlLmxvZyh3YXJuaW5ncyk7XG4gICAgICB9XG4gICAgICBzZWxmLl9maXhUcmFja3Moe2NvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gSWYgYnJvd3NlciBkaXJlY3RpdmVzIHdlcmUgaW5jbHVkZWQsIHdlIG5lZWQgdG8gb2JleSB0aGVtLlxuICAgICAgICBzZWxmLl9uZXh0RGlyZWN0aXZlcyA9IHt9O1xuICAgICAgICAvLyBSaWdodCBub3cgb25seSBwb3NpdGlvbiBpcyBzdXBwb3J0ZWQuXG4gICAgICAgIC8vIFRPRE86IG90aGVyIGJyb3dzZXIgZGlyZWN0aXZlcyBhdCBodHRwOi8vZ2Vub21lLnVjc2MuZWR1L2dvbGRlblBhdGgvaGVscC9oZ1RyYWNrc0hlbHAuaHRtbCNsaW5lc1xuICAgICAgICBpZiAoXy5rZXlzKGJyb3dzZXJEaXJlY3RpdmVzKS5sZW5ndGgpIHsgc2VsZi5faW5pdEZyb21QYXJhbXMoYnJvd3NlckRpcmVjdGl2ZXMpOyB9XG4gICAgICB9fSk7IFxuICAgIH0sXG4gICAgXG4gICAgLy8gT3BlbnMgYSBkaWFsb2cgdG8gZWRpdCB0aGUgb3B0aW9ucyBmb3IgYSBjdXN0b20gdHJhY2suXG4gICAgX2VkaXRDdXN0b21UcmFjazogZnVuY3Rpb24obikge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICAkZGlhbG9nID0gJChvLmRpYWxvZ3NbMF0pLmNsb3Nlc3QoJy51aS1kaWFsb2cnKSxcbiAgICAgICAgdHJrID0gc2VsZi5hdmFpbFRyYWNrc1tuXTtcbiAgICAgICAgXG4gICAgICBzZWxmLl9pbml0Q3VzdG9tVHJhY2tEaWFsb2coKTtcbiAgICAgIHRyay5jdXN0b20ubG9hZE9wdHMoJGRpYWxvZyk7XG4gICAgICAkZGlhbG9nLmRhdGEoJ3RyYWNrJywgdHJrKTtcbiAgICAgICRkaWFsb2cudHJpZ2dlcignb3BlbicpO1xuICAgIH0sXG4gICAgXG4gICAgLy8gUmVtb3ZlcyBhIGN1c3RvbSB0cmFja3MuXG4gICAgX3JlbW92ZUN1c3RvbVRyYWNrOiBmdW5jdGlvbih0bmFtZSkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAkbGkgPSAkKHNlbGYub3B0aW9ucy50cmFja1BpY2tlclszXSkuZmluZCgnaW5wdXRbbmFtZT1cIicrdG5hbWUrJ1wiXScpLmNsb3Nlc3QoJ2xpJyksXG4gICAgICAgIHVybCA9IHNlbGYuYXZhaWxUcmFja3NbdG5hbWVdLmN1c3RvbS51cmw7XG4gICAgICBkZWxldGUgc2VsZi5hdmFpbFRyYWNrc1t0bmFtZV07XG4gICAgICAkbGkucmVtb3ZlKCk7XG4gICAgICAvLyBSZW1vdmUgdXJsIGZyb20gbGlzdCBvZiBsb2FkZWQgVVJMcyBpZiB0aGVyZSBhcmUgbm8gb3RoZXIgdHJhY2tzIHRoYXQgd2VyZSBsb2FkZWQgZnJvbSBpdFxuICAgICAgaWYgKHVybCAmJiAhXy5maW5kKHNlbGYuYXZhaWxUcmFja3MsIGZ1bmN0aW9uKHRyaykgeyByZXR1cm4gdHJrLmN1c3RvbSAmJiB0cmsuY3VzdG9tLnVybCA9PSB1cmw7IH0pKSB7XG4gICAgICAgIHNlbGYuX2N1c3RvbVRyYWNrVXJscy5sb2FkZWQgPSBfLmRpZmZlcmVuY2Uoc2VsZi5fY3VzdG9tVHJhY2tVcmxzLmxvYWRlZCwgW3VybF0pO1xuICAgICAgfVxuICAgICAgc2VsZi5fZml4VHJhY2tzKCk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBSZW1vdmVzIGFsbCBjdXN0b20gdHJhY2tzLlxuICAgIF9yZXNldEN1c3RvbVRyYWNrczogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgICRsaXMgPSAkKHNlbGYub3B0aW9ucy50cmFja1BpY2tlclszXSkuY2hpbGRyZW4oJ3VsJykuY2hpbGRyZW4oKTtcbiAgICAgICRsaXMuZmluZCgnOmNoZWNrYm94JykuZWFjaChmdW5jdGlvbigpIHsgZGVsZXRlIHNlbGYuYXZhaWxUcmFja3NbJCh0aGlzKS5hdHRyKCduYW1lJyldOyB9KTtcbiAgICAgICRsaXMucmVtb3ZlKCk7XG4gICAgICBzZWxmLl9jdXN0b21UcmFja1VybHMubG9hZGVkID0gW107XG4gICAgICBzZWxmLl9maXhUcmFja3MoKTtcbiAgICB9LFxuICAgIFxuICAgIC8vIERldGVybWluZSBmb3IgYSBnaXZlbiB0cmFjayBhbmQgaGVpZ2h0IHdoYXQgZGVuc2l0eSBpcyBvcHRpbWFsIGZvciBkaXNwbGF5XG4gICAgZGVuc2l0eU9yZGVyOiBmdW5jdGlvbih0cmFjaywgaGVpZ2h0LCBicHBwcywgZm9yY2UpIHtcbiAgICAgIGlmIChfLmlzVW5kZWZpbmVkKGhlaWdodCkgfHwgXy5pc1VuZGVmaW5lZChicHBwcykpIHsgcmV0dXJuIHRoaXMuX2RlbnNpdHlPcmRlclt0cmFja10gfHwgbnVsbDsgfVxuICAgICAgLy8gVE9ETzogdGhpcyBuZWVkcyB0d2Vha2luZy4uLiBtYXliZSBvbiB0aGUgZGVib3VuY2VkIHZlcnNpb24sIGV4Y2x1ZGUgb2ZmLXNjcmVlbiB0aWxlcz9cbiAgICAgIHZhciBzZWxmID0gdGhpcywgXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgICRlbGVtID0gc2VsZi5lbGVtZW50LFxuICAgICAgICB0ID0gdGhpcy5hdmFpbFRyYWNrc1t0cmFja10sXG4gICAgICAgIGJhc2UgPSBfLmZpbmQodC5zLCBmdW5jdGlvbih2KSB7IHJldHVybiAhXy5pc0FycmF5KHYpOyB9KSxcbiAgICAgICAgZml4ZWRIZWlnaHRzID0gdC5maFticHBwcy50b3BGb3JtYXR0ZWRdIHx8IChfLmtleXModC5maCkubGVuZ3RoICYmIHQuZmhbXy5sYXN0KF8ua2V5cyh0LmZoKSldKSB8fCB7fSxcbiAgICAgICAgYmFzZUhlaWdodCA9IGZpeGVkSGVpZ2h0c1tiYXNlXSB8fCAxNSxcbiAgICAgICAgb3JkZXJGb3IgPSBoZWlnaHQgKyBcInxcIiArIGJwcHBzLnRvcEZvcm1hdHRlZCxcbiAgICAgICAgcHJldk9yZGVyID0gc2VsZi5fZGVuc2l0eU9yZGVyW3Qubl0sXG4gICAgICAgIHByZXZPcmRlckZvciA9IHNlbGYuX2RlbnNpdHlPcmRlckZvclt0Lm5dLFxuICAgICAgICAkdW5yZW5kZXJlZEN1c3RvbSA9ICQoJy5icm93c2VyLXRyYWNrLScrdC5uKycgY2FudmFzLnRkYXRhLnVucmVuZGVyZWQnKSxcbiAgICAgICAgZm9yY2VBdCA9IHt9LCAvL3twYWNrOiBbMjAwLCAtMl0sIGZ1bGw6IFsyMDAsIC0zXX0sICAvLyBUaGlzIGlzIGNhdXNpbmcgdG9vIG11Y2ggdGhyYXNoaW5nIHdpdGggaGVhdnkgY3VzdG9tIHRyYWNrc1xuICAgICAgICBvcmRlciA9IHt9LCBoZWlnaHRzID0gW10sIGkgPSAwLCBvcHRpbXVtO1xuICAgICAgaWYgKHByZXZPcmRlckZvciAmJiBwcmV2T3JkZXJGb3IgPT0gb3JkZXJGb3IgJiYgIWZvcmNlKSB7IHJldHVybjsgfVxuICAgICAgaWYgKCR1bnJlbmRlcmVkQ3VzdG9tLmxlbmd0aCkge1xuICAgICAgICAvLyBBbGwgY3VzdG9tIHRyYWNrcyBzaG91bGQgYmUgcmVuZGVyZWQgYmVmb3JlIHJlb3JkZXJpbmcgdGhlIGRlbnNpdGllcy4gIERlZmVyIHRoaXMgY2FsY3VsYXRpb24gdW50aWwgdGhlbi5cbiAgICAgICAgcmV0dXJuICR1bnJlbmRlcmVkQ3VzdG9tLnRyaWdnZXIoJ3JlbmRlcicsIF8uYWZ0ZXIoJHVucmVuZGVyZWRDdXN0b20ubGVuZ3RoLCBmdW5jdGlvbigpIHsgXG4gICAgICAgICAgc2VsZi5kZW5zaXR5T3JkZXIodHJhY2ssIGhlaWdodCwgYnBwcHMpOyBcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgICAgLy8gQWx3YXlzIHNob3cgdGhlIGJhc2UgZGVuc2l0eSB3aGVuIHdpdGhpbiAzcHggb2YgdGhlIGJhc2VIZWlnaHQgKHRoZSBpbml0aWFsIGhlaWdodClcbiAgICAgIGlmIChoZWlnaHQgPD0gYmFzZUhlaWdodCArIDMpIHtcbiAgICAgICAgb3JkZXJbYmFzZV0gPSAwO1xuICAgICAgICBfLmVhY2godC5zLCBmdW5jdGlvbihkKSB7IGlmIChfLmlzQXJyYXkoZCkpIHsgb3JkZXJbZFswXV0gPSArK2k7IH0gfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBPdGhlcndpc2UsIG9yZGVyIHRoZSBkZW5zaXRpZXMgYnkgdGhlaXIgdGlsZXMnIG1heCBoZWlnaHQncyBwcm94aW1pdHkgdG8gdGhlIHRyYWNrIGhlaWdodFxuICAgICAgICAvLyB3aXRoIGEgM3ggYmlhcyB0b3dhcmQgc2hvd2luZyB0aGUgdGFsbGVyIGRlbnNpdHlcbiAgICAgICAgXy5lYWNoKHQucywgZnVuY3Rpb24oZCkge1xuICAgICAgICAgIGlmIChfLmlzQXJyYXkoZCkpIHsgZCA9IGRbMF07IH1cbiAgICAgICAgICBpZiAoZml4ZWRIZWlnaHRzW2RdKSB7IHJldHVybiBoZWlnaHRzLnB1c2goW2QsIGZpeGVkSGVpZ2h0c1tkXV0pOyB9XG4gICAgICAgICAgdmFyICRpbWdzID0gJCgnLmJyb3dzZXItdHJhY2stJyt0Lm4rJz4uYnBwcC0nK2NsYXNzRnJpZW5kbHkoYnBwcHMudG9wKSsnPi50ZGF0YS5kZW5zLScrZCk7XG4gICAgICAgICAgaWYgKCRpbWdzLmZpbmQoJy5sb2FkaW5nJykubGVuZ3RoID4gMCkgeyBvcmRlckZvciA9IG51bGw7IH1cbiAgICAgICAgICB2YXIgaCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsICRpbWdzLm1hcChmdW5jdGlvbigpIHsgXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5uYXR1cmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0OyBcbiAgICAgICAgICB9KS5nZXQoKSk7XG4gICAgICAgICAgaGVpZ2h0cy5wdXNoKFtkLCBoXSk7XG4gICAgICAgIH0pO1xuICAgICAgICBoZWlnaHRzID0gXy5tYXAoaGVpZ2h0cywgZnVuY3Rpb24odiwgaSkge1xuICAgICAgICAgIHZhciBkZWx0YVk7XG4gICAgICAgICAgdlsyXSA9IHZbMV0gPT0gMDtcbiAgICAgICAgICB2WzFdID0gdlsyXSA/IDEwMDAwMDAgOiB2WzFdOyAgICAgIC8vIGVmZmVjdGl2ZWx5LCBuZXZlciBzaG93IDAgaGVpZ2h0IHRpbGVzXG4gICAgICAgICAgZGVsdGFZID0gaGVpZ2h0IC0gdlsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgd2hlcmUgdGhlIDN4IGJpYXMgdG93YXJkIHRoZSB0YWxsZXIgZGVuc2l0eSBpcyBpbnNlcnRlZFxuICAgICAgICAgIHZbMV0gPSAoZm9yY2VBdFt2WzBdXSAmJiBoZWlnaHQgPiBmb3JjZUF0W3ZbMF1dWzBdKSA/IGZvcmNlQXRbdlswXV1bMV0gOiAoZGVsdGFZID4gMCA/IGRlbHRhWSAqIDMgOiAtZGVsdGFZKTtcbiAgICAgICAgICB2WzFdIC09IGkgKiAwLjE7ICAgICAgICAgICAgICAgICAgIC8vIG1hcmdpbmFsbHkgcHJpb3JpdGl6ZSBtb3JlIGRldGFpbGVkIHRyYWNrcyBpbiB0aGUgZXZlbnQgb2YgdGllc1xuICAgICAgICAgIHJldHVybiB2OyBcbiAgICAgICAgfSk7XG4gICAgICAgIGhlaWdodHMuc29ydChmdW5jdGlvbihhLCBiKXsgcmV0dXJuIGFbMV0gLSBiWzFdOyB9KTtcbiAgICAgICAgXy5lYWNoKGhlaWdodHMsIGZ1bmN0aW9uKHYpIHsgb3JkZXJbdlswXV0gPSArK2k7IH0pO1xuICAgICAgICAvLyBVbmxlc3MgYWxsIG9mIHRoZSBvdGhlciBkZW5zaXRpZXMgd2VyZSAwIGhlaWdodCB0aWxlcywgbWFrZSB0aGUgYmFzZSBkZW5zaXR5IGxhc3QgcHJpb3JpdHkuXG4gICAgICAgIGlmIChoZWlnaHRzLmxlbmd0aCAtIF8uY29tcGFjdChfLnBsdWNrKGhlaWdodHMsICcyJykpLmxlbmd0aCA+IDEpIHsgb3JkZXJbYmFzZV0gPSArK2k7IH1cbiAgICAgIH1cbiAgICAgIHNlbGYuX2RlbnNpdHlPcmRlclt0Lm5dID0gb3JkZXI7XG4gICAgICBzZWxmLl9kZW5zaXR5T3JkZXJGb3JbdC5uXSA9IG9yZGVyRm9yO1xuICAgICAgaWYgKHByZXZPcmRlciAmJiAhXy5pc0VxdWFsKG9yZGVyLCBwcmV2T3JkZXIpKSB7IFxuICAgICAgICAkZWxlbS5maW5kKCcuYnJvd3Nlci10cmFjay0nK3QubikuZ2Vub3RyYWNrKCd1cGRhdGVEZW5zaXR5Jyk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyA9IFRoZXNlIGFyZSBuYXZpZ2F0aW9uYWwgZnVuY3Rpb25zOyB0aGV5IGhhbmRsZSBtb3ZlbWVudCwgem9vbWluZywgcG9zaXRpb24gY2FsY3VsYXRpb25zLCBldGMuID1cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgIC8vIFJldHVybnMgdGhlIGV4cGVjdGVkIHdpZHRoLCBpbiBiYXNlIHBhaXJzLCBvZiBlYWNoIGxpbmVcbiAgICBicFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMubGluZVdpZHRoKCkgKiB0aGlzLmJwcHA7IH0sXG4gICAgXG4gICAgLy8gUmV0dXJucyB0aGUgY2hyb21vc29tZSB0aGF0IGNvbnRhaW5zIHRoZSBnaXZlbiBhYnNvbHV0ZSBicCBwb3NpdGlvblxuICAgIGNockF0OiBmdW5jdGlvbihwb3MpIHtcbiAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgICBjaHJJbmRleCA9IF8uc29ydGVkSW5kZXgoby5jaHJMYWJlbHMsIHtwOiBwb3N9LCBmdW5jdGlvbih2KSB7IHJldHVybiB2LnA7IH0pO1xuICAgICAgcmV0dXJuIGNockluZGV4ID4gMCA/IG8uY2hyTGFiZWxzW2NockluZGV4IC0gMV0gOiBudWxsO1xuICAgIH0sXG4gICAgXG4gICAgLy8gVHVybnMgYSBzdHJpbmcgbGlrZSBcImNoclg6MTI1MTJcIiBpbnRvIGFuIGJwIHBvc2l0aW9uIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBnZW5vbWVcbiAgICBub3JtYWxpemVQb3M6IGZ1bmN0aW9uKHBvcywgZm9yY2VmdWwpIHtcbiAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zLCBcbiAgICAgICAgcmV0ID0ge30sIFxuICAgICAgICBtYXRjaGVzLCBlbmQ7XG4gICAgICAgIFxuICAgICAgcmV0LnBvcyA9ICQudHJpbShfLmlzVW5kZWZpbmVkKHBvcykgPyAkKG8uanVtcFswXSkudmFsKCkgOiBwb3MpO1xuICAgICAgaWYgKHJldC5wb3MgPT09ICcnKSB7IHRoaXMuX3NlYXJjaEZvcignJyk7IHJldHVybiBudWxsOyB9XG4gICAgICBcbiAgICAgIG1hdGNoZXMgPSByZXQucG9zLm1hdGNoKC9eKFthLXpdK1teOl0qKSg6KFxcZCspKChbLUBdKShcXGQrKFxcLlxcZCspPykpPyk/L2kpO1xuICAgICAgLy8gRG9lcyB0aGUgcG9zaXRpb24gc3RyaW5nIGhhdmUgYSBjb2xvbiBpbiBpdD8gSWYgc28sIHdlIHRyeSB0byBwYXJzZSBpdCBhcyBhIGJwIHBvc2l0aW9uXG4gICAgICBpZiAobWF0Y2hlcyAmJiBtYXRjaGVzWzFdKSB7XG4gICAgICAgIHZhciBjaHIgPSBfLmZpbmQoby5jaHJMYWJlbHMsIGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHYubiA9PT0gbWF0Y2hlc1sxXTsgfSk7XG4gICAgICAgIC8vIElmIHRoaXMgZGlkbid0IG1hdGNoIGEgcmVhbCBjaHJvbW9zb21lIG5hbWUsIHVzZSB0aGUgZmlyc3QsIGJ5IGRlZmF1bHQuXG4gICAgICAgIGlmICghY2hyKSB7IGNociA9IF8uZmlyc3Qoby5jaHJMYWJlbHMpOyB9XG4gICAgICAgIHRoaXMuX3NlYXJjaEZvcignJywgZm9yY2VmdWwpO1xuICAgICAgICByZXQucG9zID0gY2hyLnAgKyBwYXJzZUludChtYXRjaGVzWzNdIHx8ICcxJywgMTApO1xuICAgICAgICBpZiAobWF0Y2hlc1s1XSA9PSAnLScpIHtcbiAgICAgICAgICAvLyBBbGxvdyByYW5nZXMsIGUuZy4gY2hyWDoxMjUxMi0xMjYzMFxuICAgICAgICAgIGVuZCA9IGNoci5wICsgcGFyc2VJbnQobWF0Y2hlc1s2XSwgMTApO1xuICAgICAgICAgIGlmIChlbmQgPiByZXQucG9zKSB7XG4gICAgICAgICAgICByZXQuYnBwcCA9IChlbmQgLSByZXQucG9zKSAvICh0aGlzLmxpbmVXaWR0aCgpIC0gby5zaWRlQmFyV2lkdGgpO1xuICAgICAgICAgICAgLy8gRmluZCB0aGUgbmVhcmVzdCBvcHRpbWFsIHpvb20gbGV2ZWwgb24gdGhlIHNsaWRlciB0aGF0IGZ1bGx5IGVuY29tcGFzc2VzIHRoZSByYW5nZS5cbiAgICAgICAgICAgIHJldC5icHBwID0gXy5maW5kKHRoaXMuc2xpZGVyQnBwcHMucmV2ZXJzZSgpLCBmdW5jdGlvbih2KSB7IHJldHVybiB2ID49IHJldC5icHBwOyB9KSB8fCBfLmxhc3QodGhpcy5zbGlkZXJCcHBwcyk7XG4gICAgICAgICAgICB0aGlzLnNsaWRlckJwcHBzLnJldmVyc2UoKTsgLy8gLnJldmVyc2UoKSBpcyBkZXN0cnVjdGl2ZSBpbiBKUyAtXy1cbiAgICAgICAgICAgIHJldC5wb3MgKz0gZmxvb3JIYWNrKChlbmQgLSByZXQucG9zKSAvIDIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChtYXRjaGVzWzVdID09ICdAJykge1xuICAgICAgICAgIC8vIG9yIHNwZWNpZnlpbmcgYnBwcCBkaXJlY3RseSwgZS5nLiBjaHJYOjEyNTEyQDEwMFxuICAgICAgICAgIHJldC5icHBwID0gcGFyc2VGbG9hdChtYXRjaGVzWzZdKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHsgXG4gICAgICAgIHBvcyA9IHBhcnNlSW50KHJldC5wb3MsIDEwKTtcbiAgICAgICAgaWYgKF8uaXNOYU4ocG9zKSkge1xuICAgICAgICAgIHRoaXMuX3NlYXJjaEZvcihyZXQucG9zLCBmb3JjZWZ1bCk7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0LnBvcyA9IHBvcztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHJldDtcbiAgICB9LFxuICAgIFxuICAgIC8vIERpc3BsYXlzIHRoZSBzZWFyY2ggZHJvcGRvd24gd2hlcmUgdGhlIHVzZXIgY2FuIHNlbGVjdCBmcm9tIGZlYXR1cmVzIHRoYXQgbWF0Y2ggdGhlIHF1ZXJ5XG4gICAgX3NlYXJjaEZvcjogZnVuY3Rpb24oc2VhcmNoLCBmb3JjZWZ1bCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudDtcbiAgICAgIGZ1bmN0aW9uIGhpbGl0ZSh0ZXh0LCBzZWFyY2hGb3IpIHtcbiAgICAgICAgcmV0dXJuIHRleHQucmVwbGFjZShuZXcgUmVnRXhwKHJlZ0V4cFF1b3RlKHNlYXJjaEZvciksIFwiZ2lcIiksICc8c3BhbiBjbGFzcz1cImhpbGl0ZVwiPicrc2VhcmNoRm9yKyc8L3NwYW4+Jyk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBjcmVhdGVDaG9pY2UoYywgY2F0KSB7XG4gICAgICAgIHZhciAkYyA9ICQoJzxkaXYgY2xhc3M9XCJjaG9pY2VcIi8+Jyk7XG4gICAgICAgICQoJzxoMyBjbGFzcz1cIm5hbWVcIi8+JykuaHRtbChoaWxpdGUoYy5uYW1lLCBzZWFyY2gpKS5hcHBlbmRUbygkYyk7XG4gICAgICAgICQoJzxwIGNsYXNzPVwibG9uZy1kZXNjXCIvPicpLmh0bWwoaGlsaXRlKGMuZGVzYywgc2VhcmNoKSkuYXBwZW5kVG8oJGMpO1xuICAgICAgICAkYy5iaW5kKCdmYWtlZm9jdXMnLCBmdW5jdGlvbigpIHsgJCh0aGlzKS5hZGRDbGFzcygnZm9jdXMnKTsgJCh0aGlzKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdmb2N1cycpOyB9KTtcbiAgICAgICAgJGMuYmluZCgnZmFrZWJsdXInLCBmdW5jdGlvbigpIHsgJCh0aGlzKS5yZW1vdmVDbGFzcygnZm9jdXMnKTsgfSk7XG4gICAgICAgICRjLm1vdXNlb3ZlcihmdW5jdGlvbigpIHsgJCh0aGlzKS50cmlnZ2VyKCdmYWtlZm9jdXMnKTsgfSk7XG4gICAgICAgICRjLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBtLCBwaWNrZWQgPSAobSA9IGMuZGVzYy5tYXRjaCgvXlxcKCguKylcXCkvKSkgPyBtWzFdLnRvTG93ZXJDYXNlKCkgOiBjLm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAkKCdib2R5JykudW5iaW5kKCdtb3VzZWRvd24uc2VhcmNoJyk7XG4gICAgICAgICAgc2VsZi4kdHJhY2tQaWNrZXIuZmluZCgnaW5wdXRbbmFtZT0nK2NhdC50cmFjaysnXScpLmF0dHIoJ2NoZWNrZWQnLCB0cnVlKTtcbiAgICAgICAgICBzZWxmLnRpbGVGaXhpbmdFbmFibGVkKGZhbHNlKTtcbiAgICAgICAgICBzZWxmLl9maXhUcmFja3Moe2R1cmF0aW9uOiAwLCBjb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyBUaGlzIGNhbGxiYWNrIG1heGltaXplcyB0aGUgdHJhY2sgdGhhdCBjb250YWluZWQgdGhlIGZlYXR1cmUgY2xpY2tlZCwgYW5kIGZsYXNoZXMgdGhlIGZlYXR1cmUuXG4gICAgICAgICAgICAvLyBGbGFzaGluZyB0aGUgY2xpY2tlZCBmZWF0dXJlIGlzIHRyaWNreSBiZWNhdXNlIGV2ZXJ5dGhpbmcgaXMgbG9hZGluZyBhdCBkaWZmZXJlbnQgdGltZXMuXG4gICAgICAgICAgICB2YXIgJG1heGltaXplVHJhY2sgPSBzZWxmLiRsaW5lcy5lcShzZWxmLmNlbnRyYWxMaW5lKS5maW5kKCcuYnJvd3Nlci10cmFjay0nK2NhdC50cmFjaykuZXEoMCk7XG4gICAgICAgICAgICAkbWF4aW1pemVUcmFjay5vbmUoJ3RyYWNrbG9hZCcsIGZ1bmN0aW9uKGUsIGJwcHBzKSB7XG4gICAgICAgICAgICAgIHZhciAkaW1ncyA9IHNlbGYuJGxpbmVzLmZpbmQoJy5icHBwLScrY2xhc3NGcmllbmRseShicHBwcy50b3ApKycgLnRkYXRhLmRlbnMtcGFjaycpO1xuICAgICAgICAgICAgICBtYXhIZWlnaHQgPSA1ICsgTWF0aC5tYXguYXBwbHkoTWF0aCwgJGltZ3MubWFwKGZ1bmN0aW9uKCkgeyBcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uYXR1cmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuICAgICAgICAgICAgICB9KS5nZXQoKSk7XG4gICAgICAgICAgICAgIC8vIEFmdGVyIHRoZSB0cmFjayBpcyByZXNpemVkLCBmbGFzaCBhbGwgdGhlIGZlYXR1cmVzIHRoYXQgd2VyZSBhZGRlZCB0byBvdXIgdG9kby1saXN0XG4gICAgICAgICAgICAgIHNlbGYuX3Jlc2l6ZVRyYWNrKGNhdC50cmFjaywgbWF4SGVpZ2h0LCBzZWxmLmNlbnRyYWxMaW5lLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgJHN0aWxsTG9hZGluZyA9IHNlbGYuJGxpbmVzLmZpbmQoJy5icm93c2VyLXRyYWNrLScrY2F0LnRyYWNrKS5oYXMoJy5hcmVhcy1sb2FkaW5nJyk7XG4gICAgICAgICAgICAgICAgJGVsZW0uZmluZCgnLmJyb3dzZXItdHJhY2snKS5nZW5vdHJhY2soJ3VwZGF0ZURlbnNpdHknKTtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBmbGFzaCgpIHsgc2VsZi5hcmVhSG92ZXIoW2NhdC50cmFjaywgYnBwcHMudG9wLCBcInBhY2tcIiwgXCJuYW1lXCIsIHBpY2tlZF0sIFwiRkxBU0hNRVwiKTsgfTtcbiAgICAgICAgICAgICAgICAvLyBGSVhNRTogdGhpcyBpcyBwcmV0dHkgcmlja2V0eVxuICAgICAgICAgICAgICAgIGlmICghJHN0aWxsTG9hZGluZy5sZW5ndGgpIHsgZmxhc2goKTsgfVxuICAgICAgICAgICAgICAgIGVsc2UgeyAkc3RpbGxMb2FkaW5nLm9uZSgnYXJlYWxvYWQnLCBfLmFmdGVyKCRzdGlsbExvYWRpbmcubGVuZ3RoLCBmbGFzaCkpOyB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uKCl7IHNlbGYudGlsZUZpeGluZ0VuYWJsZWQodHJ1ZSk7ICRlbGVtLmZpbmQoJy5icm93c2VyLXRyYWNrLScrY2F0LnRyYWNrKS5nZW5vdHJhY2soJ2ZpeENsaWNrQXJlYXMnKTsgfSk7XG4gICAgICAgICAgfX0pO1xuICAgICAgICAgIHNlbGYuanVtcFRvKGMucG9zKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7IFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuICRjO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gaGlkZUNob2ljZXMoKSB7IHNlbGYuJGNob2ljZXMuZmluZCgnLmNob2ljZScpLnRyaWdnZXIoJ2Zha2VibHVyJyk7IHNlbGYuJGNob2ljZXMuaGlkZSgpOyB9XG4gICAgICBcbiAgICAgIGlmIChzZWFyY2g9PT0nJykgeyByZXR1cm4gaGlkZUNob2ljZXMoKTsgfVxuICAgICAgaWYgKHNlYXJjaD09PXNlbGYucHJldlNlYXJjaCAmJiAhZm9yY2VmdWwpIHsgcmV0dXJuOyB9XG4gICAgICBzZWxmLiRjaG9pY2VzLmVtcHR5KCkuYWRkQ2xhc3MoJ2xvYWRpbmcnKS5yZW1vdmVDbGFzcygnbm8tcmVzdWx0cycpLnNsaWRlRG93bigpO1xuICAgICAgJCgnYm9keScpLmJpbmQoJ21vdXNlZG93bi5zZWFyY2gnLCBmdW5jdGlvbihlKSB7IFxuICAgICAgICBpZiAoISQoZS50YXJnZXQpLmNsb3Nlc3Qoc2VsZi4kY2hvaWNlcykubGVuZ3RoKSB7IGhpZGVDaG9pY2VzKCk7IH1cbiAgICAgICAgJCgnYm9keScpLnVuYmluZCgnbW91c2Vkb3duLnNlYXJjaCcpO1xuICAgICAgfSk7XG4gICAgICBpZiAoc2VsZi5jdXJyZW50U2VhcmNoKSB7IHNlbGYuY3VycmVudFNlYXJjaC5hYm9ydCgpOyB9XG4gICAgICBcbiAgICAgIHNlbGYucHJldlNlYXJjaCA9IHNlYXJjaDtcbiAgICAgIHNlbGYuY3VycmVudFNlYXJjaCA9ICQuYWpheChvLmFqYXhEaXIrJ3NlYXJjaC5waHAnLCB7XG4gICAgICAgIGRhdGE6IHtwb3NpdGlvbjogc2VhcmNoLCBkYjogby5nZW5vbWV9LFxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgc2VsZi4kY2hvaWNlcy5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xuICAgICAgICAgIGlmIChkYXRhWydnb3RvJ10pIHsgc2VsZi5qdW1wVG8oZGF0YVsnZ290byddKTsgcmV0dXJuOyB9XG4gICAgICAgICAgaWYgKCFkYXRhLmNhdGVnb3JpZXMgfHwgZGF0YS5jYXRlZ29yaWVzLmxlbmd0aD09PTApIHsgc2VsZi4kY2hvaWNlcy5hZGRDbGFzcygnbm8tcmVzdWx0cycpOyByZXR1cm47IH1cbiAgICAgICAgICB2YXIgbnVtQ2F0ZWdvcmllcyA9IF8ua2V5cyhkYXRhLmNhdGVnb3JpZXMpLmxlbmd0aCxcbiAgICAgICAgICAgIGNob2ljZXNQZXJDYXRlZ29yeSA9IE1hdGgubWF4KE1hdGguY2VpbCgxMiAvIG51bUNhdGVnb3JpZXMpLCAzKTtcbiAgICAgICAgICBfLmVhY2goZGF0YS5jYXRlZ29yaWVzLCBmdW5jdGlvbihjYXQsIGNhdG5hbWUpIHtcbiAgICAgICAgICAgICQoJzxkaXYgY2xhc3M9XCJjaG9pY2UtY2F0ZWdvcnlcIi8+JykudGV4dChjYXRuYW1lKS5hcHBlbmRUbyhzZWxmLiRjaG9pY2VzKTtcbiAgICAgICAgICAgIF8uZWFjaChjYXQuY2hvaWNlcy5zbGljZSgwLCBjaG9pY2VzUGVyQ2F0ZWdvcnkpLCBmdW5jdGlvbihjKSB7XG4gICAgICAgICAgICAgIHZhciAkYyA9IGNyZWF0ZUNob2ljZShjLCBjYXQpLmFwcGVuZFRvKHNlbGYuJGNob2ljZXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc2VsZi4kY2hvaWNlcy5maW5kKCcuY2hvaWNlJykuZXEoMCkudHJpZ2dlcignZmFrZWZvY3VzJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgICAgIFxuICAgIC8vIHB1YmxpYyAoaW5kaXJlY3QpIHNldHRlciBmb3IgdGhpcy5wb3M7IGNlbnRlcnMgdGhlIHJldGljbGUgb24gcmV0aWNQb3NcbiAgICBqdW1wVG86IGZ1bmN0aW9uKHJldGljUG9zKSB7XG4gICAgICB2YXIgZGVzdCA9IHRoaXMubm9ybWFsaXplUG9zKHJldGljUG9zLCB0cnVlKTtcbiAgICAgIGlmIChkZXN0ICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMuJGNob2ljZXMuaGlkZSgpLmVtcHR5KCk7XG4gICAgICAgIGlmIChkZXN0LmJwcHApIHtcbiAgICAgICAgICB0aGlzLnBvcyA9IGRlc3QucG9zIC0gdGhpcy5fcmV0aWNEZWx0YSgpO1xuICAgICAgICAgIHRoaXMuem9vbShkZXN0LmJwcHApOyBcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLl9wb3MoZGVzdC5wb3MgLSB0aGlzLl9yZXRpY0RlbHRhKCkpO1xuICAgICAgICB9XG4gICAgICAgICQodGhpcy5vcHRpb25zLmp1bXBbMF0pLmJsdXIoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIC8vIHByaXZhdGUgc2V0dGVyIGZvciB0aGlzLnBvcyB0aGF0IHVwZGF0ZXMgdGhlIFVJIGFjY29yZGluZ2x5LlxuICAgIC8vIGZvcmNlUmVwb3MgdXN1YWxseSBtZWFucyBhIHpvb20gaGFwcGVuZWQsIHdoaWNoIHJlcXVpcmVzIHRoYXQgdGhlIHRpbGVzIGFyZSByZXBvc2l0aW9uZWQgd2l0aGluIHRoZSB0cmFja3MuXG4gICAgX3BvczogZnVuY3Rpb24ocG9zLCBleGNlcHRGb3IsIGZvcmNlUmVwb3MpIHtcbiAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgICBicFdpZHRoID0gdGhpcy5icFdpZHRoKCksXG4gICAgICAgIHJkID0gdGhpcy5fcmV0aWNEZWx0YSgpO1xuICAgICAgZXhjZXB0Rm9yID0gJChleGNlcHRGb3IpLmdldCgwKTtcbiAgICAgIHBvcyA9IF8uaXNVbmRlZmluZWQocG9zKSA/IHRoaXMucG9zIDogcG9zO1xuICAgICAgdGhpcy5wb3MgPSBwb3M7XG4gICAgICB0aGlzLiRsaW5lcy5lYWNoKGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgaWYgKHRoaXMgPT0gZXhjZXB0Rm9yKSB7IHJldHVybjsgfVxuICAgICAgICAkKHRoaXMpLmdlbm9saW5lKCdqdW1wVG8nLCBwb3MgKyBpICogYnBXaWR0aCwgZm9yY2VSZXBvcyk7IFxuICAgICAgfSk7XG4gICAgICBpZiAoZm9yY2VSZXBvcykgeyB0aGlzLl9maXhab29tZWRUcmFja0RlYm91bmNlZCgpOyB9XG4gICAgICB0aGlzLl9maXhDbGlja0FyZWFzRGVib3VuY2VkKCk7XG4gICAgICB0aGlzLl9zYXZlUGFyYW1zRGVib3VuY2VkKCk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBSZXR1cm5zIHRoZSBwb3NpdGlvbiAoaW4gYmFzZXBhaXJzKSBjbG9zZXN0IHRvIHRoZSBtb3VzZSBjdXJzb3JcbiAgICBfcG9zQXRNb3VzZTogZnVuY3Rpb24oZSkge1xuICAgICAgdmFyICRsaW5lID0gJChlLnNyY0VsZW1lbnQgfHwgZS5vcmlnaW5hbFRhcmdldCkuY2xvc2VzdCgnLmJyb3dzZXItbGluZScpO1xuICAgICAgaWYgKCEkbGluZS5sZW5ndGgpIHsgcmV0dXJuIG51bGw7IH1cbiAgICAgIHJldHVybiAoZS5wYWdlWCAtIHRoaXMub3B0aW9ucy5zaWRlQmFyV2lkdGgpICogdGhpcy5icHBwICsgJGxpbmUuZ2Vub2xpbmUoJ2dldFBvcycpO1xuICAgIH0sXG4gICAgXG4gICAgLy8gcHVibGljIGdldHRlci9zZXR0ZXIgZm9yIHRoaXMuYnBwcCB0aGF0IHVwZGF0ZXMgdGhlIFVJLiAgSWYgZHVyYXRpb24gaXMgc3BlY2lmaWVkLCBhbmltYXRlcyB0aGUgY2hhbmdlIGluIHpvb20uXG4gICAgem9vbTogZnVuY3Rpb24oem9vbSwgY2VudGVyZWRPbiwgZHVyYXRpb24pIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucztcbiAgICAgIFxuICAgICAgZnVuY3Rpb24gc2xpZGVyVmFsdWUoem9vbSkge1xuICAgICAgICB2YXIgcmV0ID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLnNsaWRlckJwcHBzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIGJwcHAgPSBzZWxmLnNsaWRlckJwcHBzW2ldO1xuICAgICAgICAgIGlmICh6b29tID4gYnBwcCkge1xuICAgICAgICAgICAgdmFyIGZyYWMgPSB6b29tIC0gYnBwcDtcbiAgICAgICAgICAgIHJldHVybiByZXQgKyAoMS4wIC0gZnJhYyAvIChzZWxmLnNsaWRlckJwcHBzW3JldF0gLSBzZWxmLnNsaWRlckJwcHBzW2ldKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldCA9IGk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHpvb20pKSB7XG4gICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChjZW50ZXJlZE9uKSAmJiBjZW50ZXJlZE9uICE9PSBudWxsKSB7IHRoaXMuY2VudGVyZWRPbiA9IGNlbnRlcmVkT247IH1cbiAgICAgICAgZWxzZSB7IGRlbGV0ZSB0aGlzLmNlbnRlcmVkT247IH1cbiAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKGR1cmF0aW9uKSkge1xuICAgICAgICAgIHRoaXMuX2FuaW1hdGVab29tKF8uaXNCb29sZWFuKHpvb20pID8gem9vbSA6IHNsaWRlclZhbHVlKHpvb20pLCBkdXJhdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy4kc2xpZGVyLnNsaWRlcigndmFsdWUnLCBzbGlkZXJWYWx1ZSh6b29tKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmJwcHA7IFxuICAgIH0sXG4gICAgXG4gICAgLy8gcHJpdmF0ZSBzZXR0ZXIgZm9yIHRoaXMuYnBwcDsgZG9lcyBub3QgdXBkYXRlIHRoZSBzbGlkZXItLXVzZWQgaW50ZXJuYWxseSBieSBpdC5cbiAgICBfem9vbTogZnVuY3Rpb24oem9vbSwgY2VudGVyZWRPbikge1xuICAgICAgY2VudGVyZWRPbiA9IGNlbnRlcmVkT24gfHwgdGhpcy5jZW50ZXJlZE9uIHx8ICh0aGlzLnBvcyArIHRoaXMuX3JldGljRGVsdGEoKSk7XG4gICAgICB2YXIgcG9zID0gY2VudGVyZWRPbiAtIChjZW50ZXJlZE9uIC0gdGhpcy5wb3MpIC8gKHRoaXMuYnBwcCAvIHpvb20pO1xuICAgICAgdGhpcy5icHBwID0gem9vbTtcbiAgICAgIHZhciBub3cgPSAobmV3IERhdGUpLmdldFRpbWUoKTtcbiAgICAgIHRoaXMuX3Bvcyhwb3MsIG51bGwsIHRydWUpO1xuICAgICAgZnBzKFwiWk9PTVwiLCAobmV3IERhdGUpLmdldFRpbWUoKSAtIG5vdywgdGhpcy5icHBwKTtcbiAgICAgIHRoaXMuX3VwZGF0ZVJldGljbGUoY2VudGVyZWRPbik7XG4gICAgfSxcbiAgICBcbiAgICAvLyBJZiBcInRvXCIgaXMgYm9vbGVhbiwgdHJ1ZSB3aWxsIHJhaXNlIHRoZSBzbGlkZXIgb25lIHN0ZXAgYW5kIGZhbHNlIHdpbGwgbG93ZXIgaXQgb25lIHN0ZXAuXG4gICAgX2FuaW1hdGVab29tOiBmdW5jdGlvbih0bywgZHVyYXRpb24pIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgJHNsaWRlciA9ICQoc2VsZi5vcHRpb25zLnpvb21TbGlkZXIpLFxuICAgICAgICBmcm9tID0gJHNsaWRlci5zbGlkZXIoJ3ZhbHVlJyk7XG4gICAgICBpZiAoXy5pc0Jvb2xlYW4odG8pKSB7IHRvID0gTWF0aFt0byA/ICdjZWlsJyA6ICdmbG9vciddKGZyb20gKyAodG8gPyAwLjAwMSA6IC0wLjAwMSkpOyB9XG4gICAgICAkc2xpZGVyLmNzcygndGV4dC1pbmRlbnQnLCAwKS5hbmltYXRlKHt0ZXh0SW5kZW50OiAxfSwge1xuICAgICAgICBxdWV1ZTogZmFsc2UsXG4gICAgICAgIHN0ZXA6IGZ1bmN0aW9uKGkpIHsgJHNsaWRlci5zbGlkZXIoJ3ZhbHVlJywgKHRvIC0gZnJvbSkgKiBpICsgZnJvbSk7IH0sXG4gICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpIHsgc2VsZi5ib3VuY2VDaGVjaygpOyB9LFxuICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24gfHwgMTUwXG4gICAgICB9KTtcbiAgICB9LFxuICAgIFxuICAgIC8vIEJvdW5jZSBvZmYgZWRnZXMgaWYgd2UgYXJlIHRvd2FyZCB0aGUgbWFyZ2lucyBvZiB0aGUgZ2Vub21lXG4gICAgYm91bmNlQ2hlY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgICAgYnBXaWR0aCA9IHRoaXMuYnBXaWR0aCgpLFxuICAgICAgICBwb3MgPSBzZWxmLnBvcyxcbiAgICAgICAgbnVtTGluZXMgPSBzZWxmLmxpbmVzKCkubGVuZ3RoLFxuICAgICAgICBtYXJnaW5zID0gWygtbnVtTGluZXMgKyBvLmJvdW5jZU1hcmdpbikgKiBicFdpZHRoLCBvLmdlbm9tZVNpemUgLSBvLmJvdW5jZU1hcmdpbiAqIGJwV2lkdGhdLFxuICAgICAgICBvdXRzaWRlR2Vub21lUmFuZ2UgPSBwb3MgPCBtYXJnaW5zWzBdIHx8IHBvcyA+IG1hcmdpbnNbMV07XG4gICAgICBcbiAgICAgIGlmIChvdXRzaWRlR2Vub21lUmFuZ2UgJiYgIXNlbGYuX2JvdW5jaW5nKSB7XG4gICAgICAgICRlbGVtLmZpbmQoJy5kcmFnLWNvbnQnKS5zdG9wKHRydWUpOyAvLyBTdG9wIGFueSBjdXJyZW50IGluZXJ0aWFsIHNjcm9sbGluZ1xuICAgICAgICBzZWxmLmJvdW5jZVRvKF8ubWluKG1hcmdpbnMsIGZ1bmN0aW9uKG1hcmcpIHsgcmV0dXJuIE1hdGguYWJzKG1hcmcgLSBwb3MpOyB9KSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcbiAgICAvLyBBbmltYXRlcyBhIFwiYm91bmNlXCIgZnJvbSB0aGUgY3VycmVudCBicm93c2VyIHBvc2l0aW9uIHRvIHRhcmdldFBvc1xuICAgIGJvdW5jZVRvOiBmdW5jdGlvbih0YXJnZXRQb3MsIGNhbGxiYWNrKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgICRlbGVtID0gc2VsZi5lbGVtZW50LFxuICAgICAgICB6b29tID0gc2VsZi56b29tKCksXG4gICAgICAgIHBvcyA9IHNlbGYucG9zLFxuICAgICAgICBuYXR1cmFsRnJlcSA9IDAuMDMsXG4gICAgICAgIHZJbml0ID0gJGVsZW0uZGF0YSgndmVsb2NpdHknKSB8fCAwLFxuICAgICAgICBkZWx0YVhJbml0ID0gKHRhcmdldFBvcyAtIHBvcykgLyB6b29tO1xuICAgICAgICBib3VuY2VTdGFydCA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpO1xuICAgICAgICBcbiAgICAgICRlbGVtLmNzcygndGV4dC1pbmRlbnQnLCAxKTtcbiAgICAgIHNlbGYuX2JvdW5jaW5nID0gdHJ1ZTtcbiAgICAgICRlbGVtLmFuaW1hdGUoe3RleHRJbmRlbnQ6IDB9LCB7XG4gICAgICAgIHF1ZXVlOiBmYWxzZSxcbiAgICAgICAgZHVyYXRpb246IDUwMCwgLy8gVE9ETzogc29tZSBiZXR0ZXIgd2F5IG9mIGFwcHJveGltYXRpbmcgdGhpcyBiYXNlZCBvbiBkYW1wZW5lZCBzcHJpbmcgbW90aW9uLlxuICAgICAgICBzdGVwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgbmV3VGltZSA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpLFxuICAgICAgICAgICAgZGVsdGFUID0gbmV3VGltZSAtIGJvdW5jZVN0YXJ0LFxuICAgICAgICAgICAgLy8gc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRGFtcGluZyNDcml0aWNhbF9kYW1waW5nXy4yOC5DRS5CNl8uM0RfMS4yOVxuICAgICAgICAgICAgbmV3RGVsdGFYID0gKGRlbHRhWEluaXQgKyAodkluaXQgKyBuYXR1cmFsRnJlcSAqIGRlbHRhWEluaXQpICogZGVsdGFUKSAqIE1hdGguZXhwKC1uYXR1cmFsRnJlcSAqIGRlbHRhVCk7XG4gICAgICAgICAgc2VsZi5fcG9zKHBvcyArIChkZWx0YVhJbml0IC0gbmV3RGVsdGFYKSAqIHpvb20pO1xuICAgICAgICB9LFxuICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7IHNlbGYuX2JvdW5jaW5nID0gZmFsc2U7IF8uaXNGdW5jdGlvbihjYWxsYmFjaykgJiYgY2FsbGJhY2soKTsgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyA9IFRoZSBmb2xsb3dpbmcgZnVuY3Rpb25zIGhhbmRsZSBvciBhc3Npc3QgZXZlbnRzIHNlbnQgZnJvbSBzdWItd2lkZ2V0cywgbGlrZSB0aGUgbGluZXMgb3IgdHJhY2tzID1cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBcbiAgICAvLyBSZXR1cm5zIHRoZSBkaXN0YW5jZSBsZWZ0IG9yIHJpZ2h0LCBpbiBwaXhlbHMsIHRoYXQgdGhlIGxpbmVzIGhhdmUgYmVlbiBzaGlmdGVkIGJ5IHRoZSBsYXN0IGtleXByZXNzXG4gICAga2V5ZWRPZmZzZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5fa2V5ZWRPZmZzZXQ7IH0sXG4gICAgXG4gICAgLy8gRml4aW5nIHRpbGVzIGNhbiBiZSB0ZW1wb3JhcmlseSBkaXNhYmxlZCBhbmQgcmUtZW5hYmxlZCB3aXRoIHRoaXMgZnVuY3Rpb25cbiAgICB0aWxlRml4aW5nRW5hYmxlZDogZnVuY3Rpb24oc2V0KSB7XG4gICAgICB0aGlzLl90aWxlRml4aW5nRW5hYmxlZCA9ICghXy5pc1VuZGVmaW5lZChzZXQpID8gISFzZXQgOiB0aGlzLl90aWxlRml4aW5nRW5hYmxlZCk7XG4gICAgICBpZiAoc2V0KSB7IHRoaXMuJGxpbmVzLmdlbm9saW5lKCdmaXhUcmFja1RpbGVzJywgdHJ1ZSk7IH1cbiAgICAgIHJldHVybiB0aGlzLl90aWxlRml4aW5nRW5hYmxlZDsgXG4gICAgfSxcbiAgICBcbiAgICAvLyBIYW5kbGUgYSBkcmFnIGV2ZW50IG9uIG9uZSBvZiB0aGUgbGluZXMsIHByb3BhZ2F0aW5nIGl0cyBtb3Rpb24gdG8gdGhlIG90aGVyIGxpbmVzXG4gICAgcmVjdkRyYWc6IGZ1bmN0aW9uKCRzcmMsIGxpbmVQb3MpIHtcbiAgICAgIHZhciBsaW5lSW5kZXggPSB0aGlzLiRsaW5lcy5pbmRleCgkc3JjKSxcbiAgICAgICAgcG9zID0gbGluZVBvcyAtIGxpbmVJbmRleCAqIHRoaXMuYnBXaWR0aCgpO1xuICAgICAgdmFyIG5vdyA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpO1xuICAgICAgdGhpcy5fcG9zKHBvcywgJHNyYyk7XG4gICAgICBmcHMoXCJNT1ZFXCIsIChuZXcgRGF0ZSkuZ2V0VGltZSgpIC0gbm93LCB0aGlzLmJwcHApO1xuICAgIH0sXG4gICAgXG4gICAgLy8gSGFuZGxlIGEgdHJhY2sgcmVzaXplIGV2ZW50IG9uIG9uZSBvZiB0aGUgbGluZXMsIHByb3BhZ2F0aW5nIGl0cyBjaGFuZ2VzIHRvIHRoZSBvdGhlciBsaW5lcyBhbmQgZml4aW5nIHRoZSBsYXlvdXRcbiAgICByZWN2VHJhY2tSZXNpemU6IGZ1bmN0aW9uKCRzcmMsIG5hbWUsIGhlaWdodCwgY2FsbGJhY2spIHtcbiAgICAgIHZhciBob2xkU3RlYWR5ID0gJHNyYyAmJiB0aGlzLiRsaW5lcy5pbmRleCgkc3JjKTtcbiAgICAgIHRoaXMuX3Jlc2l6ZVRyYWNrKG5hbWUsIGhlaWdodCwgaG9sZFN0ZWFkeSwgXy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSA/IGNhbGxiYWNrIDogdHJ1ZSk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBIYW5kbGUgYSB0cmFjayByZW9yZGVyIGFjdGlvbiBvbiBvbmUgb2YgdGhlIGxpbmVzLCBwcm9wYWdhdGluZyBpdHMgY2hhbmdlcyB0byB0aGUgb3RoZXIgbGluZXNcbiAgICAvLyBuZXdPcmRlciBpcyBhbiBhcnJheSBtYXBwaW5nIG9sZEluZGV4ID0+IG5ld0luZGV4XG4gICAgcmVjdlNvcnQ6IGZ1bmN0aW9uKCRzcmMsIG5ld09yZGVyKSB7XG4gICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgIF8uZWFjaChvLnRyYWNrcywgZnVuY3Rpb24odiwgaSkgeyB2Ll9pID0gaTsgfSk7XG4gICAgICBvLnRyYWNrcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIG5ld09yZGVyW2EuX2ldIC0gbmV3T3JkZXJbYi5faV07IH0pO1xuICAgICAgXy5lYWNoKG8udHJhY2tzLCBmdW5jdGlvbih2LCBpKSB7IGRlbGV0ZSB2Ll9pOyB9KTtcbiAgICAgIHRoaXMuJGxpbmVzLm5vdCgkc3JjKS5nZW5vbGluZSgnZml4VHJhY2tzJykuZ2Vub2xpbmUoJ2ZpeFRyYWNrVGlsZXMnKTtcbiAgICB9LFxuICAgIFxuICAgIC8vIEhhbmRsZSBhIG1vdXNld2hlZWwgZXZlbnQgb24gb25lIG9mIHRoZSBsaW5lcywgcHJvcGFnYXRpbmcgaXRzIGNoYW5nZXMgdG8gYWxsIGxpbmVzLlxuICAgIF9yZWN2Wm9vbTogZnVuY3Rpb24oZSwgbWFudWFsRGVsdGEpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgZCA9IFttYW51YWxEZWx0YSwgZS5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGFZLCBlLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSwgXG4gICAgICAgICAgZS5vcmlnaW5hbEV2ZW50LmF4aXMgPT0gMiAmJiAtZS5vcmlnaW5hbEV2ZW50LmRldGFpbF0sXG4gICAgICAgIHVzZXJBZ2VudCA9IG5hdmlnYXRvciAmJiBuYXZpZ2F0b3IudXNlckFnZW50LFxuICAgICAgICBhZGp1c3QgPSBbWygvY2hyb21lL2kpLCAwLjA2XSwgWygvc2FmYXJpL2kpLCAwLjAzXSwgWygvb3BlcmF8bXNpZS9pKSwgMC4wMV1dO1xuICAgICAgICBcbiAgICAgIC8vIFlvdSBjYW4gc2Nyb2xsIHRoZSB0cmFjayBwaWNrZXJzLCBzZWxlY3QgYm94ZXMsIGFuZCB0ZXh0YXJlYXNcbiAgICAgIGlmICgkKGUudGFyZ2V0KS5jbG9zZXN0KCcucGlja2VyLHNlbGVjdCx0ZXh0YXJlYScpLmxlbmd0aCkgeyByZXR1cm47IH1cbiAgICAgIFxuICAgICAgc2VsZi5lbGVtZW50LmZpbmQoJy5kcmFnLWNvbnQnKS5zdG9wKCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RvcCBhbnkgY3VycmVudCBpbmVydGlhbCBzY3JvbGxpbmdcbiAgICAgIGlmIChfLmlzVW5kZWZpbmVkKHNlbGYuX3doZWVsRGVsdGEpKSB7IHNlbGYuX3doZWVsRGVsdGEgPSAwOyB9XG4gICAgICAkLnRpcFRpcC5oaWRlKCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIaWRlIGFueSB0aXBUaXBzIHNob3dpbmdcbiAgICAgIGQgPSBfLnJlamVjdChkLCBfLmlzVW5kZWZpbmVkKS5zaGlmdCgpO1xuICAgICAgc2VsZi5jZW50ZXJlZE9uID0gc2VsZi5fcG9zQXRNb3VzZShlLm9yaWdpbmFsRXZlbnQpO1xuICAgICAgXG4gICAgICAvLyBtb3VzZXdoZWVsaW5nIGlzIG1vcmUgcGVyZm9ybWFudCAoZXNwIGluIFNhZmFyaSkgaWYgaXQgYWxsIHRoZSBldmVudHMgZmlyZSBvbiBhIHNpbmdsZSBlbGVtZW50XG4gICAgICAvLyB3aGljaCBpcyB3aHkgd2UgdGhyb3cgYSBcInNoaWVsZFwiIGVsZW1lbnQgaW4gZnJvbnQgb2YgYWxsIHRoZSBicm93c2VyIGxpbmVzIGR1cmluZyB6b29tcyB0byBjYXB0dXJlIHRoZSBldmVudHNcbiAgICAgIC8vIEZJWE1FOiBJcyB0aGlzIHN0aWxsIG5lZWRlZD8gU2FmYXJpIGhhcyBwb3NzaWJseSBmaXhlZCB0aGlzP1xuICAgICAgLy8gc2VsZi5saW5lcygpLmdlbm9saW5lKCd0b2dnbGVab29tU2hpZWxkJywgdHJ1ZSk7ICAgICAgICAgICAgICAgIFxuICAgICAgXG4gICAgICBpZiAoZCAmJiBzZWxmLmNlbnRlcmVkT24gIT09IG51bGwpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gc2VsZi4kc2xpZGVyLnNsaWRlcigndmFsdWUnKSxcbiAgICAgICAgICBkZWx0YSA9IChvLnNuYXBab29tID8gKHNlbGYuX3doZWVsRGVsdGEgKz0gZCkgOiBkKSAvIDIwO1xuICAgICAgICBpZiAodXNlckFnZW50ICYmIF8uaXNVbmRlZmluZWQobWFudWFsRGVsdGEpKSB7IFxuICAgICAgICAgIF8uZmluZChhZGp1c3QsIGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHZbMF0udGVzdCh1c2VyQWdlbnQpICYmIChkZWx0YSAqPSB2WzFdKTsgfSk7IFxuICAgICAgICB9IGVsc2UgaWYgKGUub3JpZ2luYWxFdmVudC53aGVlbERlbHRhWSkgeyBkZWx0YSAqPSAwLjA1OyB9XG4gICAgICAgIGlmIChvLnNuYXBab29tKSB7XG4gICAgICAgICAgaWYgKE1hdGguYWJzKGRlbHRhKSA+IDEuMikgeyBcbiAgICAgICAgICAgIHNlbGYuX2FuaW1hdGVab29tKGRlbHRhID4gMCwgMTAwMCk7XG4gICAgICAgICAgICBzZWxmLl93aGVlbERlbHRhID0gMDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7IHNlbGYuJHNsaWRlci5zbGlkZXIoJ3ZhbHVlJywgdmFsdWUgKyBkZWx0YSk7IH1cbiAgICAgICAgc2VsZi5fZmluaXNoWm9vbURlYm91bmNlZChkZWx0YSA+IDApO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gZmFsc2U7IC8vIGRpc2FibGUgc2Nyb2xsaW5nIG9mIHRoZSBkb2N1bWVudFxuICAgIH0sXG4gICAgXG4gICAgLy8gVGhpcyBpcyBmaXJlZCBzaG9ydGx5IGFmdGVyIHRyYWNrcyBiZWxpZXZlIHRoYXQgYWxsIGltYWdlcyBoYXZlIGxvYWRlZC5cbiAgICAvLyBXZSByZWNhbGN1bGF0ZSB0aGUgZGVuc2l0eSBvcmRlciBvZiB0cmFja3MsIGFuZCBmaXggdGhlIG9yYW5nZSBjbGlwIGluZGljYXRvcnMuXG4gICAgX3JlY3ZUcmFja0xvYWQ6IGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsXG4gICAgICAgICR0cmsgPSAkKGUudGFyZ2V0KSxcbiAgICAgICAgdCA9ICR0cmsuZ2Vub3RyYWNrKCdvcHRpb24nLCAndHJhY2snKTtcbiAgICAgIFxuICAgICAgLy8gVGhpcyBoYW5kbGVyIGlzIG1hbnVhbGx5IGRlYm91bmNlZCBieSAxMDBtcywgc2VwYXJhdGVseSBwZXIgdHJhY2suXG4gICAgICBzZWxmLl90cmFja0xvYWRUaW1lcnMgPSBzZWxmLl90cmFja0xvYWRUaW1lcnMgfHwge307XG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc2VsZi5fdHJhY2tMb2FkVGltZXJzW3Qubl0pKSB7IGNsZWFyVGltZW91dChzZWxmLl90cmFja0xvYWRUaW1lcnNbdC5uXSk7IH1cbiAgICAgIHNlbGYuX3RyYWNrTG9hZFRpbWVyc1t0Lm5dID0gc2V0VGltZW91dChfLmJpbmQoZnVuY3Rpb24oJHRyaywgdCkge1xuICAgICAgICAvLyB3ZSBoYXZlIG5ldyBpbWFnZSBkYXRhLCBzbyAqZm9yY2UqIHJlY2FsY3VsYXRpb24gb2YgdGhlIGRlbnNpdHlPcmRlclxuICAgICAgICBzZWxmLmRlbnNpdHlPcmRlcih0Lm4sIHQuaCwgJHRyay5nZW5vdHJhY2soJ2JwcHBzJyksIHRydWUpO1xuICAgICAgICAkZWxlbS5maW5kKCcuYnJvd3Nlci10cmFjay0nK3QubikuZ2Vub3RyYWNrKCdmaXhDbGlwcGVkJyk7XG4gICAgICB9LCBzZWxmLCAkdHJrLCB0KSwgMTAwKTtcbiAgICB9LFxuICAgIFxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gPSBUaGVzZSBmdW5jdGlvbnMgbWFuaXB1bGF0ZSB0aGUgdGFuayByZXRpY2xlID1cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFxuICAgIC8vIFJldHVybnMgdGhlIG9mZnNldCBvZiB0aGUgcmV0aWNsZSwgaW4gYmFzZXBhaXJzLCBmcm9tIHRoZSBwb3NpdGlvbiBvZiB0aGUgYnJvd3NlclxuICAgIC8vIHdoaWNoIGlzIGRlc2lnbmF0ZWQgYXMgdGhlIGJhc2VwYWlyIGF0IHRoZSBsZWZ0IGVkZ2Ugb2YgdGhlIHRvcG1vc3QgbGluZVxuICAgIF9yZXRpY0RlbHRhOiBmdW5jdGlvbihsaW5lKSB7XG4gICAgICBsaW5lID0gXy5pc1VuZGVmaW5lZChsaW5lKSA/IHRoaXMuY2VudHJhbExpbmUgOiBsaW5lO1xuICAgICAgdmFyIGJwV2lkdGggPSB0aGlzLmJwV2lkdGgoKTtcbiAgICAgIHJldHVybiAobGluZSArIDAuNSkgKiBicFdpZHRoIC0gdGhpcy5vcHRpb25zLnNpZGVCYXJXaWR0aCAqIDAuNSAqIHRoaXMuYnBwcDtcbiAgICB9LFxuXG4gICAgLy8gQ2hhbmdlIHRoZSBwb3NpdGlvbiBhbmQgd2lkdGggb2YgdGhlIHJldGljbGVcbiAgICBfdXBkYXRlUmV0aWNsZTogZnVuY3Rpb24oY2VudGVyZWRPbiwgYW5pbU9wdHMpIHtcbiAgICAgIHZhciAkZWxlbSA9IHRoaXMuZWxlbWVudCxcbiAgICAgICAgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgYnBXaWR0aCA9IHRoaXMuYnBXaWR0aCgpLFxuICAgICAgICB6b29tID0gdGhpcy5icHBwLFxuICAgICAgICBsaW5lSW5kZXggPSBfLmlzTnVtYmVyKGNlbnRlcmVkT24pID8gZmxvb3JIYWNrKChjZW50ZXJlZE9uIC0gdGhpcy5wb3MpIC8gYnBXaWR0aCkgOiB0aGlzLmNlbnRyYWxMaW5lLFxuICAgICAgICBuZXh0Wm9vbXMgPSB0aGlzLnNsaWRlckJwcHBzLnNsaWNlKE1hdGguY2VpbCh0aGlzLiRzbGlkZXIuc2xpZGVyKCd2YWx1ZScpICsgMC4wMDEpKSxcbiAgICAgICAgJGxpbmUgPSB0aGlzLiRsaW5lcy5lcShsaW5lSW5kZXgpLFxuICAgICAgICBkdXJhdGlvbiA9IGFuaW1PcHRzICYmICFfLmlzVW5kZWZpbmVkKGFuaW1PcHRzLmR1cmF0aW9uKSA/IGFuaW1PcHRzLmR1cmF0aW9uIDogMjAwO1xuICAgICAgZnVuY3Rpb24gaGlkZSgkcmV0aWNzLCBkKSB7XG4gICAgICAgIGQgPSBkIHx8IGR1cmF0aW9uO1xuICAgICAgICAkcmV0aWNzLmFuaW1hdGUoe29wYWNpdHk6IDB9LCB7IGR1cmF0aW9uOiBkLCBjb21wbGV0ZTogZnVuY3Rpb24oKSB7ICQodGhpcykuYWRkQ2xhc3MoJ2hpZGRlbicpOyB9IH0pO1xuICAgICAgfVxuICAgICAgaWYgKCFuZXh0Wm9vbXMubGVuZ3RoKSB7IG5leHRab29tcyA9IHRoaXMuc2xpZGVyQnBwcHMuc2xpY2UoLTEpOyB9XG4gICAgICBpZiAoXy5pc1VuZGVmaW5lZChjZW50ZXJlZE9uKSkge1xuICAgICAgICBpZiAoIV8uYW55KHRoaXMuX3Nob3dSZXRpY2xlKSkgeyByZXR1cm4gaGlkZSgkZWxlbS5maW5kKCcucmV0aWM6bm90KC5oaWRkZW4pJykpOyB9XG4gICAgICAgICRsaW5lLmZpbmQoJy5yZXRpYy5oaWRkZW4nKS5hbmltYXRlKHtvcGFjaXR5OiBvLnJldGljT3BhY2l0eX0sIHtcbiAgICAgICAgICBkdXJhdGlvbjogMjAwLCBcbiAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7ICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOyB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGxpbmUuZmluZCgnLnJldGljJykuY3NzKCdvcGFjaXR5Jywgby5yZXRpY09wYWNpdHkpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcbiAgICAgICAgdGhpcy5fdXBkYXRlUmV0aWNsZURlYm91bmNlZCgpO1xuICAgICAgfVxuICAgICAgJGxpbmUuZ2Vub2xpbmUoJ3NldFJldGljbGUnLCBuZXh0Wm9vbXMsIGNlbnRlcmVkT24pO1xuICAgICAgaGlkZSh0aGlzLiRsaW5lcy5ub3QoJGxpbmUuZ2V0KDApKS5maW5kKCcucmV0aWM6bm90KC5oaWRkZW4pJyksIDApO1xuICAgIH0sXG4gICAgXG4gICAgLy8gRGlzcGxheSB0aGUgcmV0aWNsZSBmb3Igb25lIG9mIHNldmVyYWwgcG9zc2libGUgcmVhc29ucyAoc2V0IHRoZW0gYXMgdHJ1ZSBvciBmYWxzZSlcbiAgICAvLyBUaGUgcmV0aWNsZSB3aWxsIGJlIHNob3duIGlmIGFueSBvZiB0aGUgcmVhc29ucyBhcHBseVxuICAgIHNob3dSZXRpY2xlOiBmdW5jdGlvbih3aHksIHZhbCkge1xuICAgICAgdGhpcy5fc2hvd1JldGljbGVbd2h5XSA9IHZhbDtcbiAgICAgIHRoaXMuX3VwZGF0ZVJldGljbGUoKTtcbiAgICB9LFxuICAgIFxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vID0gVGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgYXJlIGRlYm91bmNlZDsgdGhleSB1cGRhdGUgdGhlIGRpc3BsYXkgYWZ0ZXIgYSByZXBlYXRlZCBldmVudCBjb25jbHVkZXMgPVxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFxuICAgIC8vIEFmdGVyIGEgc2hvcnQgZGVsYXksIGEgem9vbSBhY3Rpb24gY2FuIGJlIFwic25hcHBlZFwiIHRvIHRoZSBuZWFyZXN0IG9wdGltYWwgbGV2ZWxcbiAgICAvLyBOT1RFOiBUaGlzIGlzIF8uZGVib3VuY2UnZCBpbiBpbml0KClcbiAgICBfZmluaXNoWm9vbURlYm91bmNlZDogZnVuY3Rpb24oZGlyZWN0aW9uKSB7XG4gICAgICB0aGlzLmJvdW5jZUNoZWNrKCk7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnNuYXBab29tQWZ0ZXIgJiYgIXRoaXMub3B0aW9ucy5zbmFwWm9vbSkgeyB0aGlzLl9hbmltYXRlWm9vbShkaXJlY3Rpb24pOyB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnNuYXBab29tKSB7IHNlbGYuX3doZWVsRGVsdGEgPSAwOyB9XG4gICAgICB0aGlzLmxpbmVzKCkuZ2Vub2xpbmUoJ3RvZ2dsZVpvb21TaGllbGQnLCBmYWxzZSk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBFdmVyeXRpbWUgd2Ugem9vbSBpbiBvbiBhIGxpbmUsIHdlIGhhdmUgdG8gcmVjYWxjdWxhdGUgdGhlIGRlbnNpdHkgb3JkZXIgb2YgdHJhY2tzLFxuICAgIC8vIGFuZCByZWRyYXcgdGhlIHRpY2sgbWFya3Mgb24gdGhlIHJ1bGVyIHRyYWNrLlxuICAgIC8vIE5PVEU6IFRoaXMgaXMgXy5kZWJvdW5jZSdkIGluIF9pbml0KClcbiAgICBfZml4Wm9vbWVkVHJhY2tEZWJvdW5jZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudDtcbiAgICAgIF8uZWFjaChvLnRyYWNrcywgZnVuY3Rpb24odCkge1xuICAgICAgICBzZWxmLmRlbnNpdHlPcmRlcih0Lm4sIHQuaCwgJGVsZW0uZmluZCgnLmJyb3dzZXItdHJhY2stJyt0Lm4pLmdlbm90cmFjaygnYnBwcHMnKSk7XG4gICAgICAgICRlbGVtLmZpbmQoJy5icm93c2VyLXRyYWNrLScrdC5uKS5nZW5vdHJhY2soJ3JlZHJhd0NhbnZhc1RpY2tzJyk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIFxuICAgIC8vIFJlbWVtYmVycyB0aGUgZ2VuZXJhbCBsYXlvdXQgJiBwb3NpdGlvbiBvZiB0aGUgYnJvd3NlciBmb3IgdGhlIG5leHQgdGltZSBpdCBpcyBvcGVuZWRcbiAgICAvLyBOT1RFOiBUaGlzIGlzIF8uZGVib3VuY2UnZCBpbiBfaW5pdCgpXG4gICAgX3NhdmVQYXJhbXNEZWJvdW5jZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBwb3MgPSBzZWxmLnBvcyxcbiAgICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgICAgcmQgPSBzZWxmLl9yZXRpY0RlbHRhKCksXG4gICAgICAgIGNociA9IHNlbGYuY2hyQXQocG9zICsgcmQpIHx8IG8uY2hyTGFiZWxzWzBdLFxuICAgICAgICB6b29tRm9ybWF0dGVkID0gc2VsZi5icHBwLnRvUHJlY2lzaW9uKE1hdGgubWF4KGZsb29ySGFjayhzZWxmLmJwcHApLnRvU3RyaW5nKCkubGVuZ3RoLCA2KSksXG4gICAgICAgIHN0YXRlID0ge3Bvc2l0aW9uOiBjaHIubiArICc6JyArIE1hdGgucm91bmQocG9zICsgcmQgLSBjaHIucCkgKyAnQCcgKyB6b29tRm9ybWF0dGVkfSxcbiAgICAgICAgbGluZU1vZGUgPSAkKG8ubGluZU1vZGUpLmZpbmQoJzpjaGVja2VkJykudmFsKCksXG4gICAgICAgICRsaW5rUGlja2VyID0gJChvLmxpbmtpbmdbMV0pLFxuICAgICAgICAkdXJsID0gJGxpbmtQaWNrZXIuZmluZCgnLnVybCcpLFxuICAgICAgICAkdWNzY0xpbmsgPSAkbGlua1BpY2tlci5maW5kKCdhW25hbWU9dWNzY10nKSxcbiAgICAgICAgdXJsLCBzdGFydCwgZW5kLCB1Y3NjUGFyYW1zO1xuICAgICAgc3RhdGUudHJhY2tzID0gXy5tYXAoby50cmFja3MsIGZ1bmN0aW9uKHQpIHsgcmV0dXJuIHQubiArICc6JyArIHQuaDsgfSkuam9pbignfCcpO1xuICAgICAgc3RhdGUuY3VzdG9tVHJhY2tzID0gc2VsZi5fY3VzdG9tVHJhY2tVcmxzLmxvYWRlZDtcbiAgICAgIGlmIChsaW5lTW9kZSAhPSBzZWxmLl9kZWZhdWx0TGluZU1vZGUpIHsgc3RhdGUubW9kZSA9IGxpbmVNb2RlOyB9XG4gICAgICBcbiAgICAgIC8vICQucGFyYW0oey4uLn0sIHRydWUpIC0tPiBkb24ndCBhZGQgW10gdG8gYXJyYXkgcGFyYW1zXG4gICAgICB1cmwgPSAnPycgKyBkZWNvZGVTYWZlT2N0ZXRzKCQucGFyYW0oXy5leHRlbmQoe2RiOiBvLmdlbm9tZX0sIHN0YXRlKSwgdHJ1ZSkpO1xuICAgICAgLy8gSWYgdGhlIEhUTUw1IGhpc3RvcnkgQVBJIGlzIGltcGxlbWVudGVkLCBzYXZlIHRoZSBzdGF0ZSB0byB0aGUgVVJMIGJhciBhZnRlciB0aGUgZmlyc3QgY2hhbmdlXG4gICAgICBpZiAod2luZG93Lmhpc3RvcnkgJiYgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlICYmIHNlbGYuc3RhdGUpIHtcbiAgICAgICAgdmFyIG5vdyA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpLFxuICAgICAgICAgIGhpc3RvcnlGbiA9IG5vdyAtIChzZWxmLl9oaXN0TGFzdFJlcGxhY2VkIHx8IDApID4gMjAwMDAgPyAncHVzaFN0YXRlJyA6ICdyZXBsYWNlU3RhdGUnO1xuICAgICAgICB3aW5kb3cuaGlzdG9yeVtoaXN0b3J5Rm5dKHt9LCB3aW5kb3cuZG9jdW1lbnQudGl0bGUsIHVybCk7XG4gICAgICAgIHNlbGYuX2hpc3RMYXN0UmVwbGFjZWQgPSAobmV3IERhdGUpLmdldFRpbWUoKTtcbiAgICAgIH1cbiAgICAgICR1cmwudmFsKHdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoL1xcPy4qJC8sICcnKSArIHVybCk7XG4gICAgICBcbiAgICAgIC8vIEFsc28gbWFrZSBhIFVSTCB0byB0aGUgZXF1aXZhbGVudCB2aWV3IGluIFVDU0NcbiAgICAgIGlmICghby5jdXN0b20gfHwgKC9edWNzYzovKS50ZXN0KG8uZ2Vub21lKSkge1xuICAgICAgICBzdGFydCA9IE1hdGgubWF4KE1hdGgucm91bmQocG9zIC0gY2hyLnApLCAxKTtcbiAgICAgICAgZW5kID0gTWF0aC5taW4oTWF0aC5yb3VuZChwb3MgLSBjaHIucCArIHNlbGYuYnBXaWR0aCgpICogc2VsZi4kbGluZXMubGVuZ3RoKSwgby5jaHJMZW5ndGhzW2Noci5uXSk7XG4gICAgICAgIHVjc2NQYXJhbXMgPSB7ZGI6IG8uZ2Vub21lLnJlcGxhY2UoL151Y3NjOnw6XFxkKyQvZywgJycpLCBwb3NpdGlvbjogY2hyLm4gKyAnOicgKyBzdGFydCArICctJyArIGVuZH07XG4gICAgICAgIF8uZWFjaChvLnRyYWNrcywgZnVuY3Rpb24odCkgeyBcbiAgICAgICAgICB2YXIgZGVuc2l0eU9yZGVyQXNBcnJheSA9IF8ubWFwKHNlbGYuZGVuc2l0eU9yZGVyKHQubiksIGZ1bmN0aW9uKHYsaykgeyByZXR1cm4gW2ssdl07IH0pLFxuICAgICAgICAgICAgdG9wRGVuc2l0eSA9IF8ubWluKGRlbnNpdHlPcmRlckFzQXJyYXksIGZ1bmN0aW9uKHApIHsgcmV0dXJuIHBbMV07IH0pO1xuICAgICAgICAgIGlmICh0b3BEZW5zaXR5KSB7IHVjc2NQYXJhbXNbdC5uXSA9IHRvcERlbnNpdHlbMF07IH1cbiAgICAgICAgfSk7XG4gICAgICAgICR1Y3NjTGluay5jbG9zZXN0KCcuZm9ybS1saW5lJykuc2hvdygpO1xuICAgICAgICAkdWNzY0xpbmsuYXR0cignaHJlZicsIG8udWNzY1VSTCArICc/JyArICQucGFyYW0odWNzY1BhcmFtcykpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHVjc2NMaW5rLmNsb3Nlc3QoJy5mb3JtLWxpbmUnKS5oaWRlKCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFNhdmUgc3RhdGUgaW4gbG9jYWxTdG9yYWdlLCBzZXNzaW9uU3RvcmFnZSwgYW5kICQuY29va2llIGFzIGFwcHJvcHJpYXRlXG4gICAgICBzZWxmLnN0YXRlID0gc3RhdGU7XG4gICAgICBzZWxmLnN0b3JhZ2UgJiYgXy5lYWNoKG8uc2F2YWJsZVBhcmFtcywgZnVuY3Rpb24oa2V5cywgZGVzdCkge1xuICAgICAgICBfLmVhY2goa2V5cywgZnVuY3Rpb24oaykge1xuICAgICAgICAgIHZhciBmdWxsS2V5ID0gKGRlc3QgIT0gJ3BlcnNpc3RlbnQnID8gby5nZW5vbWUgKyAnLicgOiAnJykgKyBrO1xuICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChzdGF0ZVtrXSkpIHsgXG4gICAgICAgICAgICBzZWxmLnN0b3JhZ2VbZGVzdF0uc2V0SXRlbShmdWxsS2V5LCBzdGF0ZVtrXSk7IFxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZWxmLnN0b3JhZ2VbZGVzdF0ucmVtb3ZlSXRlbShmdWxsS2V5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gPSBUaGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBjb29yZGluYXRlIHRoZSBjbGljayBhcmVhcyB0aGF0IGFwcGVhciB3aGVuIGhvdmVyaW5nIG92ZXIgdGlsZXMgPVxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBcbiAgICAvLyBFdmVyeXRpbWUgd2UgbW92ZSB0aGUgYnJvd3Nlciwgd2UgaGF2ZSB0byBmZXRjaCBuZXcgY2xpY2sgYXJlYSBkYXRhLlxuICAgIC8vIE5PVEU6IFRoaXMgaXMgXy5kZWJvdW5jZSdkIGluIF9pbml0KClcbiAgICBfZml4Q2xpY2tBcmVhc0RlYm91bmNlZDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsIFxuICAgICAgICBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudDtcbiAgICAgIF8uZWFjaChvLnRyYWNrcywgZnVuY3Rpb24odCkge1xuICAgICAgICAkZWxlbS5maW5kKCcuYnJvd3Nlci10cmFjay0nK3QubikuZ2Vub3RyYWNrKCdmaXhDbGlja0FyZWFzJyk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIFxuICAgIC8vIEFyZWFzIGFyZSBzdG9yZWQgaW4gYSBnbG9iYWwgaW5kZXgsIHNvIHRoYXQgbW91c2luZyBvdmVyIGFuIGFyZWEgaW4gb25lIHRpbGUgY2FuIHJldHJpZXZlXG4gICAgLy8gYXJlYXMgd2l0aCBhIHNpbWlsYXIgbmFtZS9ocmVmSGFzaCB0aGF0IG11c3QgYWxzbyBiZSBoaWdobGlnaHRlZC4gIFRoaXMgZnVuY3Rpb24gcmVjZWl2ZXNcbiAgICAvLyBpbmZvcm1hdGlvbiBhYm91dCBhIGN1cnJlbnQgaG92ZXIgZXZlbnQgYW5kIGNyZWF0ZXMgdGhlIGFwcHJvcHJpYXRlIGhpZ2hsaWdodGVkIGFuY2hvcnNcbiAgICAvLyB3aXRoaW4gdGhlIGNvcnJlY3QgdGlsZXMuIFxuICAgIGFyZWFIb3ZlcjogZnVuY3Rpb24oa2V5cywgdGFyZ2V0KSB7XG4gICAgICB2YXIgJGVsZW0gPSB0aGlzLmVsZW1lbnQ7XG4gICAgICBpZiAoXy5pc1VuZGVmaW5lZChrZXlzKSkgeyByZXR1cm4gdGhpcy5fYXJlYUhvdmVyOyB9XG4gICAgICAkZWxlbS5maW5kKCcuYXJlYS5yZWN0JykucmVtb3ZlKCk7XG4gICAgICAkZWxlbS5maW5kKCcuYXJlYS5sYWJlbC5ob3ZlcicpLnJlbW92ZUNsYXNzKCdob3ZlcicpO1xuICAgICAgaWYgKCFrZXlzKSB7ICQudGlwVGlwLmhpZGUoKTsgcmV0dXJuICh0aGlzLl9hcmVhSG92ZXIgPSBmYWxzZSk7IH1cbiAgICAgIGlmIChrZXlzLmxlbmd0aCAhPSA1KSB7IHRocm93ICdub3QgZW5vdWdoIGxldmVscyB0byB0cmF2ZXJzZSBpbmRleCc7IH1cbiAgICAgIHZhciBhcmVhSW5kaWNlcyA9IHRoaXMuX2FyZWFJbmRleDtcbiAgICAgIC8vIGtleXMgaXMgdXNlZCB0byB0cmF2ZXJzZSB0aGUgZmlyc3QgNSBsZXZlbHMgb2YgdGhlIGFyZWFJbmRleCwgd2hpY2ggaXMgb3JnYW5pemVkIGFzIGZvbGxvd3M6XG4gICAgICAvLyBhcmVhSW5kZXhbdHJhY2tdW2JwcHBdW2RlbnNpdHldW1wiaHJlZkhhc2hcInxcIm5hbWVcIl1baHJlZkhhc2h8bmFtZV1bdGlsZUlkXVtsb2NhbEFyZWFJZF0gPSB0cnVlXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGsgPSBrZXlzW2ldO1xuICAgICAgICBpZiAoIWFyZWFJbmRpY2VzW2tdKSB7IGFyZWFJbmRpY2VzID0gZmFsc2U7IGJyZWFrOyB9XG4gICAgICAgIGFyZWFJbmRpY2VzID0gYXJlYUluZGljZXNba107XG4gICAgICB9XG4gICAgICBpZiAoYXJlYUluZGljZXMpIHtcbiAgICAgICAgXy5lYWNoKGFyZWFJbmRpY2VzLCBmdW5jdGlvbihsb2NhbEFyZWFJZHMsIHRpbGVJZCkge1xuICAgICAgICAgIHZhciAkdCA9ICQoJyMnK3RpbGVJZCksXG4gICAgICAgICAgICAkdGRhdGEgPSAkdC5jaGlsZHJlbignLnRkYXRhLmRlbnMtJytrZXlzWzJdKSxcbiAgICAgICAgICAgICR0cmFjaywgYXJlYXM7XG4gICAgICAgICAgaWYgKCEkdC5sZW5ndGggfHwgIShhcmVhcyA9ICR0ZGF0YS5kYXRhKCdhcmVhcycpKSkgeyByZXR1cm47IH1cbiAgICAgICAgICAkdHJhY2sgPSAkdC5wYXJlbnQoKTtcbiAgICAgICAgICBfLmVhY2gobG9jYWxBcmVhSWRzLCBmdW5jdGlvbihkdW1teSwgaWQpIHtcbiAgICAgICAgICAgIHZhciBhcmVhID0gYXJlYXNbaWRdLFxuICAgICAgICAgICAgICBmbGFncyA9IHt9O1xuICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gXCJGTEFTSE1FXCIpIHsgZmxhZ3MuZmxhc2htZSA9IHRydWU7IH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBmbGFncy5ob3ZlciA9IHRydWU7XG4gICAgICAgICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0ID09IHRpbGVJZCArICcuJyArIGlkKSB7IGZsYWdzLnRpcFRpcEFjdGl2YXRlZCA9IHRydWU7IH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICR0cmFjay5nZW5vdHJhY2soJ21ha2VBbmNob3InLCAkdCwgYXJlYSwgJHRkYXRhLmRhdGEoJ2JwcHAnKSwgJHRkYXRhLmRhdGEoJ2RlbnNpdHknKSwgZmxhZ3MpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGtleXNbM109PSdocmVmSGFzaCcpIHtcbiAgICAgICAgICAvLyBBbHNvIGhpZ2hsaWdodCBhbnkgZXhpc3RpbmcgLmFyZWEncyAoZS5nLiBsYWJlbHMgb24gY3VzdG9tIHRyYWNrcylcbiAgICAgICAgICAkZWxlbS5maW5kKCcuYnJvd3Nlci10cmFjay0nK2tleXNbMF0rJz4uYnBwcC0nK2NsYXNzRnJpZW5kbHkoa2V5c1sxXSkrJz4uZGVucy0nK2tleXNbMl0rJy5ocmVmLWhhc2gtJytrZXlzWzRdKS5hZGRDbGFzcygnaG92ZXInKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHsgdGhyb3cgJ3NvbWV0aGluZyB3ZW50IHdyb25nIHdoaWxlIHJ1bm5pbmcgdGhyb3VnaCB0aGUgYXJlYUluZGV4JzsgfVxuICAgICAgcmV0dXJuICh0aGlzLl9hcmVhSG92ZXIgPSBrZXlzWzBdICsgJy4nICsga2V5c1szXSArICcuJyArIGtleXNbNF0pO1xuICAgIH0sXG4gICAgXG4gICAgLy8gUmV0dXJuIHRoZSBhcmVhIGluZGV4OyBvdGhlciB3aWRnZXRzIGNhbiBhY2Nlc3MgaXQgZGlyZWN0bHlcbiAgICBhcmVhSW5kZXg6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5fYXJlYUluZGV4OyB9LFxuICAgIFxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gPSBNaXNjZWxsYW5lb3VzIGZ1bmN0aW9ucyB0aGF0IGRpZG4ndCBmaXQgZWxzZXdoZXJlID1cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFxuICAgIC8vIEZldGNoZXMgRE5BIGZyb20gdGhlIEFKQVggc2VydmljZSBmb3IgYSBwYXJ0aWN1bGFyIGJwIHJhbmdlIGFuZCBzZW5kcyBpdCBvZmYgdG8gdGhlIGNhbGxiYWNrIGZ1bmN0aW9uXG4gICAgZ2V0RE5BOiBmdW5jdGlvbihsZWZ0LCByaWdodCwgY2FsbGJhY2ssIGV4dHJhRGF0YSkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgICBjaHVua1NpemUgPSBvLm1heE50UmVxdWVzdDtcbiAgICAgIGlmICghdGhpcy5fZG5hQ2FsbGJhY2tzKSB7IHRoaXMuX2RuYUNhbGxiYWNrcyA9IFtdOyB9XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIGxvYWRlZEZyb21BamF4KGRhdGEsIHN0YXR1c0NvZGUsIGpxWEhSKSB7XG4gICAgICAgIHNlbGYuX2RuYVtqcVhIUi5fc10gPSBkYXRhLnNlcTtcbiAgICAgICAgY2hlY2tDYWxsYmFja3MoKTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGFqYXhMb2FkRE5BKCkge1xuICAgICAgICB2YXIgc2xvdHMgPSBlbXB0eUNhY2hlU2xvdHMoc2VsZi5wb3MsIHNlbGYucG9zICsgc2VsZi5icFdpZHRoKCkgKiBzZWxmLiRsaW5lcy5sZW5ndGgpO1xuICAgICAgICBfLmVhY2goc2xvdHMsIGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgICB2YXIgYWpheE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBkYXRhOiB7ZGI6IG8uZ2Vub21lLCBsZWZ0OiBzICogY2h1bmtTaXplICsgMSwgcmlnaHQ6IChzICsgMSkgKiBjaHVua1NpemUgKyAxfSxcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICBzdWNjZXNzOiBsb2FkZWRGcm9tQWpheCxcbiAgICAgICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uKGpxWEhSKSB7IGpxWEhSLl9zID0gczsgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYgKG8uY3VzdG9tKSB7XG4gICAgICAgICAgICBhamF4T3B0aW9ucy50eXBlID0gXCJQT1NUXCI7XG4gICAgICAgICAgICBhamF4T3B0aW9ucy5kYXRhLmNocl9vcmRlciA9IEpTT04uc3RyaW5naWZ5KG8uY2hyT3JkZXIpO1xuICAgICAgICAgICAgYWpheE9wdGlvbnMuZGF0YS5jaHJfbGVuZ3RocyA9IEpTT04uc3RyaW5naWZ5KG8uY2hyTGVuZ3Rocyk7XG4gICAgICAgICAgfVxuICAgICAgICAgICQuYWpheChvLmFqYXhEaXIgKyAnZG5hLnBocCcsIGFqYXhPcHRpb25zKTtcbiAgICAgICAgICBzZWxmLl9kbmFbc10gPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBlbXB0eUNhY2hlU2xvdHMobGVmdCwgcmlnaHQpIHtcbiAgICAgICAgLy8gY29udmVydCAxLWJhc2VkIHBvc2l0aW9ucyB0byAwLWJhc2VkXG4gICAgICAgIGxlZnQgPSBNYXRoLm1heChsZWZ0IC0gMSwgMSk7XG4gICAgICAgIHJpZ2h0ID0gTWF0aC5taW4ocmlnaHQgLSAxLCBvLmdlbm9tZVNpemUpO1xuICAgICAgICB2YXIgaSA9IE1hdGguZmxvb3IobGVmdCAvIGNodW5rU2l6ZSksXG4gICAgICAgICAgZW5kID0gTWF0aC5mbG9vcihyaWdodCAvIGNodW5rU2l6ZSksXG4gICAgICAgICAgc2xvdHMgPSBbXTtcbiAgICAgICAgd2hpbGUgKGkgPD0gZW5kKSB7IGlmIChfLmlzVW5kZWZpbmVkKHNlbGYuX2RuYVtpXSkpIHsgc2xvdHMucHVzaChpKTsgfSBpKys7IH1cbiAgICAgICAgcmV0dXJuIHNsb3RzO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gZ2V0RnJvbUNhY2hlKGxlZnQsIHJpZ2h0KSB7XG4gICAgICAgIGxlZnQtLTsgcmlnaHQtLTsgLy8gY29udmVydCAxLWJhc2VkIHBvc2l0aW9ucyB0byAwLWJhc2VkXG4gICAgICAgIHZhciBpID0gTWF0aC5mbG9vcihsZWZ0IC8gY2h1bmtTaXplKSxcbiAgICAgICAgICBlbmQgPSBNYXRoLmZsb29yKHJpZ2h0IC8gY2h1bmtTaXplKSxcbiAgICAgICAgICBzZWdzID0gW10sIHNlZywgc3RhcnQ7XG4gICAgICAgIHdoaWxlIChpIDw9IGVuZCkge1xuICAgICAgICAgIHNlZyA9IHNlbGYuX2RuYVtpXTtcbiAgICAgICAgICBzdGFydCA9IE1hdGgubWF4KGxlZnQgLSBpICogY2h1bmtTaXplLCAwKTtcbiAgICAgICAgICBpZiAoIXNlZykgeyByZXR1cm4gbnVsbDsgfVxuICAgICAgICAgIHNlZ3MucHVzaChzZWcuc3Vic3RyKHN0YXJ0LCBpPT1lbmQgPyAocmlnaHQgLSBlbmQgKiBjaHVua1NpemUgLSBzdGFydCkgOiB1bmRlZmluZWQpKTtcbiAgICAgICAgICBpKys7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNlZ3Muam9pbignJyk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBjaGVja0NhbGxiYWNrcygpIHtcbiAgICAgICAgc2VsZi5fZG5hQ2FsbGJhY2tzID0gXy5maWx0ZXIoc2VsZi5fZG5hQ2FsbGJhY2tzLCBmdW5jdGlvbihjKSB7XG4gICAgICAgICAgdmFyIGRuYSA9IGdldEZyb21DYWNoZShjLmxlZnQsIGMucmlnaHQpO1xuICAgICAgICAgIGlmIChkbmEgIT09IG51bGwpIHsgYy5mbihkbmEsIGMuZXh0cmFEYXRhKTsgcmV0dXJuIGZhbHNlOyB9XG4gICAgICAgICAgZWxzZSB7IHJldHVybiB0cnVlOyB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICB2YXIgZG5hO1xuICAgICAgaWYgKG8uY3VzdG9tICYmIG8uY3VzdG9tLmNhbkdldFNlcXVlbmNlKSB7XG4gICAgICAgIG8uY3VzdG9tLmdldFNlcXVlbmNlKGxlZnQsIHJpZ2h0LCBmdW5jdGlvbihkbmEpIHsgY2FsbGJhY2soZG5hLCBleHRyYURhdGEpOyB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG5hID0gZ2V0RnJvbUNhY2hlKGxlZnQsIHJpZ2h0KTtcbiAgICAgIH1cbiAgICAgIGlmIChkbmEgIT09IG51bGwpIHsgY2FsbGJhY2soZG5hLCBleHRyYURhdGEpOyB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5fZG5hQ2FsbGJhY2tzLnB1c2goe2xlZnQ6IGxlZnQsIHJpZ2h0OiByaWdodCwgZm46IGNhbGxiYWNrLCBleHRyYURhdGE6IGV4dHJhRGF0YX0pO1xuICAgICAgICBhamF4TG9hZEROQSgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLy8gVXBkYXRlcyB0aGUgdGV4dCBmb3IgdGhlIGdlbm9tZSBzcGVjaWVzIGFuZCBkZXNjcmlwdGlvbiBpbiB0aGUgd2luZG93IHRpdGxlIGFuZCBmb290ZXJcbiAgICBfdXBkYXRlR2Vub21lczogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAgICRnZW5vbWUgPSAkKG8uZ2Vub21lUGlja2VyWzBdKSxcbiAgICAgICAgJHRpdGxlID0gJGdlbm9tZS5maW5kKCcudGl0bGUnKSxcbiAgICAgICAgc3BlY2llc1BhcmVudGhldGljYWwgPSBvLnNwZWNpZXMubWF0Y2goL1xcKCguKylcXCkvKSxcbiAgICAgICAgJGxpID0gJGdlbm9tZS5maW5kKCdsaS5kaXZpZGVyJykuZXEoMCkuc2hvdygpO1xuICAgICAgXG4gICAgICBzZWxmLl9kZWZhdWx0VGl0bGUgPSBzZWxmLl9kZWZhdWx0VGl0bGUgfHwgd2luZG93LmRvY3VtZW50LnRpdGxlO1xuICAgICAgd2luZG93LmRvY3VtZW50LnRpdGxlID0gby5zcGVjaWVzICsgJyAtICcgKyBzZWxmLl9kZWZhdWx0VGl0bGU7XG4gICAgICAkdGl0bGUudGV4dChvLnNwZWNpZXMucmVwbGFjZSgvXFxzK1xcKC4qJC8sICcnKSkuYXR0cigndGl0bGUnLCBvLnNwZWNpZXMpO1xuICAgICAgaWYgKHNwZWNpZXNQYXJlbnRoZXRpY2FsKSB7ICQoJzxlbSBjbGFzcz1cInBhcmVudGhcIiAvPicpLnRleHQoJywgJyArIHNwZWNpZXNQYXJlbnRoZXRpY2FsWzFdKS5hcHBlbmRUbygkdGl0bGUpOyB9XG4gICAgICAkZ2Vub21lLmZpbmQoJy5kZXNjcmlwdGlvbicpLnRleHQoby5hc3NlbWJseURhdGUgKyAnICgnICsgby5nZW5vbWUucmVwbGFjZSgvXFx8LiokLywgJycpICsgJyknKTtcbiAgICAgIFxuICAgICAgLy8gRmlsbCB0aGUgZ2Vub21lIHBpY2tlciB3aXRoIGF2YWlsYWJsZSBjb25maWd1cmVkIGdlbm9tZXNcbiAgICAgICRnZW5vbWUuZmluZCgnLmNob2ljZS5nZW5vbWUtY2hvaWNlJykucmVtb3ZlKCk7XG4gICAgICBfLmVhY2goby5nZW5vbWVzLCBmdW5jdGlvbih2LCBrKSB7XG4gICAgICAgIGlmICgvXl8vLnRlc3QoaykgfHwgayA9PSBvLmdlbm9tZSkgeyByZXR1cm47IH1cbiAgICAgICAgdmFyICRhID0gJCgnPGEgY2xhc3M9XCJjbGlja2FibGVcIi8+JykuYXR0cignaHJlZicsICcuLz9kYj0nK2spO1xuICAgICAgICAkYS5hcHBlbmRUbygkKCc8bGkgY2xhc3M9XCJjaG9pY2UgZ2Vub21lLWNob2ljZVwiLz4nKS5pbnNlcnRCZWZvcmUoJGxpKSk7XG4gICAgICAgICQoJzxzcGFuIGNsYXNzPVwibmFtZVwiLz4nKS50ZXh0KHYuc3BlY2llcykuYXBwZW5kVG8oJGEpO1xuICAgICAgICAkKCc8c3BhbiBjbGFzcz1cImxvbmctZGVzY1wiLz4nKS50ZXh0KHYuYXNzZW1ibHlEYXRlICsgJyAoJyArIGsgKyAnKScpLmFwcGVuZFRvKCRhKTtcbiAgICAgICAgJGEuaG92ZXIoZnVuY3Rpb24oKSB7ICQodGhpcykuYWRkQ2xhc3MoJ2hvdmVyJyk7IH0sIGZ1bmN0aW9uKCkgeyAkKHRoaXMpLnJlbW92ZUNsYXNzKCdob3ZlcicpOyB9KTtcbiAgICAgIH0pO1xuICAgICAgaWYgKCRnZW5vbWUuZmluZCgnLmNob2ljZS5nZW5vbWUtY2hvaWNlJykubGVuZ3RoID09IDApIHsgJGxpLmhpZGUoKTsgfVxuICAgIH1cbiAgICBcbiAgfSk7XG5cbn0pO1xuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPSBFYWNoIGxpbmUgb2YgdGhlICQudWkuZ2Vub2Jyb3dzZXIgaXMgbWFuYWdlZCBieSBhICQudWkuZ2Vub2xpbmUgPVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCQpIHtcblxuJC53aWRnZXQoJ3VpLmdlbm9saW5lJywge1xuXG4gIC8vIERlZmF1bHQgb3B0aW9ucyB0aGF0IGNhbiBiZSBvdmVycmlkZGVuXG4gIG9wdGlvbnM6IHtcbiAgICBkaXNhYmxlZDogZmFsc2VcbiAgfSxcblxuICAvLyBDYWxsZWQgYXV0b21hdGljYWxseSB3aGVuIHdpZGdldCBpcyBpbnN0YW50aWF0ZWRcbiAgX2luaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciAkZWxlbSA9IHRoaXMuZWxlbWVudCwgXG4gICAgICBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgaHRtbDtcbiAgICB0aGlzLnBvcyA9IHBhcnNlSW50KG8ub3JpZ2luLCAxMCkgfHwgMDtcbiAgICB0aGlzLiRzaWRlID0gJCgnPGRpdiBjbGFzcz1cInNpZGUtY29udFwiLz4nKS5hcHBlbmRUbygkZWxlbSk7XG4gICAgdGhpcy4kZmlyc3RMYWJlbCA9ICQoJzxkaXYgY2xhc3M9XCJmaXJzdC1sYWJlbFwiLz4nKS5hcHBlbmRUbygkZWxlbSk7XG4gICAgdGhpcy4kdHJhY2tDb250ID0gJCgnPGRpdiBjbGFzcz1cInRyYWNrLWNvbnRcIi8+JykuYXBwZW5kVG8oJGVsZW0pO1xuICAgIHRoaXMuJGNvbnQgPSAkKCc8ZGl2IGNsYXNzPVwiZHJhZy1jb250XCIvPicpLmFwcGVuZFRvKHRoaXMuJHRyYWNrQ29udCk7XG4gICAgdGhpcy4kcmV0aWMgPSAkKCc8ZGl2IGNsYXNzPVwicmV0aWMgaGlkZGVuXCIvPicpLmFwcGVuZFRvKCRlbGVtKTtcbiAgICB0aGlzLiRpbmRpY2VzID0gJCgnPGRpdiBjbGFzcz1cImluZGljZXNcIi8+JykuYXBwZW5kVG8oJGVsZW0pO1xuICAgIHRoaXMuJHpvb21zaGllbGQgPSAkKCc8ZGl2IGNsYXNzPVwiem9vbS1zaGllbGQgaGlkZGVuXCIvPicpLmFwcGVuZFRvKCRlbGVtKTtcbiAgICB0aGlzLmNlbnRlcmVkT24gPSBudWxsOyAvLyBmb3IgdGhlIHJldGljbGVcbiAgICBcbiAgICBodG1sID0gJzxkaXYgY2xhc3M9XCJjIG53XCIvPjxkaXYgY2xhc3M9XCJjIG5lXCIvPjxkaXYgY2xhc3M9XCJjIHN3XCIvPidcbiAgICAgICsgJzxkaXYgY2xhc3M9XCJjIHNlXCIvPjxkaXYgY2xhc3M9XCJ2IG5cIi8+PGRpdiBjbGFzcz1cInYgc1wiLz48ZGl2IGNsYXNzPVwiaW5uZXItcmV0aWNcIj4nXG4gICAgICArICc8ZGl2IGNsYXNzPVwiYyBud1wiLz48ZGl2IGNsYXNzPVwiYyBuZVwiLz48ZGl2IGNsYXNzPVwiYyBzd1wiLz48ZGl2IGNsYXNzPVwiYyBzZVwiLz48L2Rpdj4nO1xuICAgICQoaHRtbCkuYXBwZW5kVG8odGhpcy4kcmV0aWMpO1xuICAgIGh0bWwgPSAnPGRpdiBjbGFzcz1cInN0YXJ0XCI+PC9kaXY+PGRpdiBjbGFzcz1cImVuZFwiPjwvZGl2Pic7XG4gICAgJChodG1sKS5hcHBlbmRUbyh0aGlzLiRpbmRpY2VzKTtcbiAgICBcbiAgICB0aGlzLl9pbml0Q29udERyYWdnYWJsZSgpO1xuICAgIHRoaXMuX2luaXRTaWRlU29ydGFibGUoKTtcbiAgICB0aGlzLiR0cmFja0NvbnQuYmluZCgnZGJsY2xpY2snLCB7c2VsZjogdGhpc30sIHRoaXMuX3JlY3ZEb3VibGVDbGljayk7XG4gICAgJGVsZW0uYWRkQ2xhc3MoJ3NoYWRvdycpO1xuICAgIHRoaXMuZml4VHJhY2tzKCk7XG4gICAgdGhpcy5qdW1wVG8odGhpcy5wb3MpO1xuICB9LFxuICBcbiAgX2luaXRDb250RHJhZ2dhYmxlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsICRlbGVtID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zLCBcbiAgICAgIGRyYWdFdmVudHMgPSBbXSxcbiAgICAgIGluaXRLZXllZE9mZnNldCA9IDAsXG4gICAgICBzbmFwcGluZ1RvQW5pbWF0aW9uID0ge30sXG4gICAgICBmdWRnZSxcbiAgICAgIGxpbmVKdW1wLFxuICAgICAgdG9wT2Zmc2V0cyxcbiAgICAgIHNuYXBwaW5nVG8sXG4gICAgICBzbmFwcGluZ1RvSW50ZXJ2YWw7XG4gICAgZnVuY3Rpb24gc25hcHBpbmdUb01vdGlvbigpIHtcbiAgICAgIHZhciBkdCA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpIC0gc25hcHBpbmdUb0FuaW1hdGlvbi5zdGFydCxcbiAgICAgICAgcHJvcG9ydGlvbiA9IE1hdGgubWluKGR0IC8gby5saW5lRml4RHVyYXRpb24sIDEpO1xuICAgICAgc25hcHBpbmdUbyA9ICgxIC0gTWF0aC5wb3coMSAtIHByb3BvcnRpb24sIDQpKSAqIChzbmFwcGluZ1RvQW5pbWF0aW9uLnRvIC0gc25hcHBpbmdUb0FuaW1hdGlvbi5mcm9tKSArIHNuYXBwaW5nVG9BbmltYXRpb24uZnJvbTtcbiAgICAgIHVwZGF0ZUxpbmVUb3AoKTtcbiAgICAgIGlmIChwcm9wb3J0aW9uID09IDEpIHsgY2xlYXJJbnRlcnZhbChzbmFwcGluZ1RvSW50ZXJ2YWwpOyB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIGFuaW1hdGVTbmFwKCkge1xuICAgICAgc25hcHBpbmdUb0FuaW1hdGlvbiA9IHtmcm9tOiBzbmFwcGluZ1RvLCB0bzogJGVsZW0uZGF0YSgnbmF0dXJhbFRvcCcpLCBzdGFydDogKG5ldyBEYXRlKS5nZXRUaW1lKCl9O1xuICAgICAgY2xlYXJJbnRlcnZhbChzbmFwcGluZ1RvSW50ZXJ2YWwpO1xuICAgICAgc25hcHBpbmdUb0ludGVydmFsID0gc2V0SW50ZXJ2YWwoc25hcHBpbmdUb01vdGlvbiwgMTMpO1xuICAgIH1cbiAgICBmdW5jdGlvbiB1cGRhdGVMaW5lVG9wKHRvcCkge1xuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHRvcCkpIHsgc25hcHBpbmdUb0FuaW1hdGlvbi50b3AgPSB0b3A7IH1cbiAgICAgIHZhciBzbmFwT2Zmc2V0ID0gKHNuYXBwaW5nVG9BbmltYXRpb24udG9wIC0gdG9wT2Zmc2V0cy50b3AgLSB0b3BPZmZzZXRzLmNsaWNrIC0gc25hcHBpbmdUbyksXG4gICAgICAgIGRlYWRab25lID0gby52ZXJ0aWNhbERyYWdEZWFkWm9uZSAvIDIsXG4gICAgICAgIHNuYXBPZmZzZXRTcXVhc2hlZCA9IE1hdGguYWJzKHNuYXBPZmZzZXQpID4gZGVhZFpvbmUgPyBzbmFwT2Zmc2V0ICsgKHNuYXBPZmZzZXQgPiAwID8gLWRlYWRab25lIDogZGVhZFpvbmUpIDogMCxcbiAgICAgIC8vIEZpcnN0IGFwcGx5IGEgZmxhdCBkZWFkIHpvbmUgYXJvdW5kIHRoZSB6ZXJvIHBvaW50XG4gICAgICAgIGN1cnZlZCA9IDQwIC8gKDEgKyBNYXRoLmV4cCgwLjEgKiBzbmFwT2Zmc2V0U3F1YXNoZWQpKSAtIDIwICsgc25hcE9mZnNldFNxdWFzaGVkO1xuICAgICAgLy8gVGhlbiB1c2UgYSBsb2dpc3RpYyBmdW5jdGlvbiB0cmFuc2Zvcm1lZCB0byBhc3ltcHRvdGljYWxseSBhcHByb2FjaCBhIHNsb3BlIG9mIDFcbiAgICAgIGlmICh0b3BPZmZzZXRzLmxlbmd0aCA+IDEpIHsgJGVsZW0uY3NzKCd0b3AnLCBzbmFwcGluZ1RvICsgY3VydmVkKTsgfVxuICAgIH1cbiAgICBmdW5jdGlvbiB1cGRhdGVQb3MobGVmdCwgdG9wKSB7XG4gICAgICB2YXIgbmV3SnVtcCA9IGxpbmVKdW1wLCBcbiAgICAgICAgem9vbSA9IG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignem9vbScpO1xuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHRvcCkpIHtcbiAgICAgICAgXy5lYWNoKHRvcE9mZnNldHMsIGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICBpZiAobmV3SnVtcCA9PSBsaW5lSnVtcCAmJiB2WzFdID4gbGluZUp1bXAgJiYgdG9wIDwgdlswXSArIGZ1ZGdlKSB7IG5ld0p1bXAgPSB2WzFdOyB9XG4gICAgICAgICAgaWYgKHZbMV0gPCBsaW5lSnVtcCAmJiB0b3AgPiB2WzBdIC0gZnVkZ2UpIHsgbmV3SnVtcCA9IHZbMV07IH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChuZXdKdW1wICE9IGxpbmVKdW1wKSB7XG4gICAgICAgICAgby5icm93c2VyLmdlbm9icm93c2VyKCdzaGlmdExpbmVzJywgbmV3SnVtcCAtIGxpbmVKdW1wLCAkZWxlbS5nZXQoMCkpO1xuICAgICAgICAgIGFuaW1hdGVTbmFwKCk7XG4gICAgICAgICAgc2VsZi5maXhUcmFja1RpbGVzKCk7IFxuICAgICAgICAgIGxpbmVKdW1wID0gbmV3SnVtcDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgc2VsZi5wb3MgPSBvLm9yaWdpbiAtIGxlZnQgKiB6b29tO1xuICAgICAgdXBkYXRlTGluZVRvcCh0b3ApO1xuICAgICAgc2VsZi5maXhGaXJzdExhYmVsKCk7XG4gICAgICBzZWxmLmZpeEluZGljZXMoKTtcbiAgICAgIG8uYnJvd3Nlci5nZW5vYnJvd3NlcigncmVjdkRyYWcnLCAkZWxlbSwgc2VsZi5wb3MpO1xuICAgIH07XG4gICAgXG4gICAgc2VsZi4kY29udC5tb3VzZWRvd24oZnVuY3Rpb24oKSB7XG4gICAgICBvLmJyb3dzZXIuZmluZCgnLmRyYWctY29udCcpLnN0b3AoKTsgLy8gU3RvcCBhbnkgY3VycmVudCBpbmVydGlhbCBzY3JvbGxpbmcgaW1tZWRpYXRlbHkgb24gbW91c2Vkb3duXG4gICAgfSlcbiAgICBzZWxmLiRjb250LmRyYWdnYWJsZSh7XG4gICAgICBheGlzOiAneCcsXG4gICAgICBjdXJzb3I6ICcnLFxuICAgICAgY2FuY2VsOiAnLm50cyw6aW5wdXQsb3B0aW9uJyxcbiAgICAgIHN0YXJ0OiBmdW5jdGlvbihlKSB7IFxuICAgICAgICB2YXIgd2lkdGggPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2xpbmVXaWR0aCcpLFxuICAgICAgICAgICRsaW5lcyA9ICBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2xpbmVzJykucmVtb3ZlQ2xhc3MoJ2xhc3QtcmVzaXplZCcpLFxuICAgICAgICAgIGxpbmVJbmRleCA9ICRsaW5lcy5pbmRleCgkZWxlbS5nZXQoMCkpO1xuICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ2RyYWdnaW5nJyk7XG4gICAgICAgICRlbGVtLmFkZENsYXNzKCdsYXN0LXJlc2l6ZWQnKTtcbiAgICAgICAgbGluZUp1bXAgPSAwO1xuICAgICAgICB0b3BPZmZzZXRzID0gW107XG4gICAgICAgIGZ1ZGdlID0gKHNlbGYubGluZUhlaWdodCgpICsgby5iZXR3ZWVuTGluZXMpICogMC4zO1xuICAgICAgICBzbmFwcGluZ1RvID0gJGVsZW0uZGF0YSgnbmF0dXJhbFRvcCcpO1xuICAgICAgICBzbmFwcGluZ1RvQW5pbWF0aW9uID0ge307XG4gICAgICAgIHRvcE9mZnNldHMuY2xpY2sgPSBlLm9yaWdpbmFsRXZlbnQucGFnZVkgLSAkZWxlbS5vZmZzZXQoKS50b3A7XG4gICAgICAgIF8uZWFjaCgkbGluZXMsIGZ1bmN0aW9uKHYsIGkpIHtcbiAgICAgICAgICB2YXIgdG9wID0gJCh2KS5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgaWYgKGkgPT0gMCkgeyB0b3BPZmZzZXRzLnRvcCA9IHRvcDsgfVxuICAgICAgICAgIHRvcE9mZnNldHMucHVzaChbdG9wICsgdG9wT2Zmc2V0cy5jbGljaywgbGluZUluZGV4IC0gaV0pOyBcbiAgICAgICAgfSk7XG4gICAgICAgIG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignc2hvd1JldGljbGUnLCAnZHJhZ2dpbmcnLCB0cnVlKTtcbiAgICAgICAgJC50aXBUaXAuaGlkZSgpO1xuICAgICAgfSxcbiAgICAgIGRyYWc6IGZ1bmN0aW9uKGUsIHVpKSB7XG4gICAgICAgIHZhciBvZSA9IGUub3JpZ2luYWxFdmVudCwgbm93ID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7XG4gICAgICAgIHVwZGF0ZVBvcyh1aS5wb3NpdGlvbi5sZWZ0LCBvZS5wYWdlWSk7XG4gICAgICAgIGRyYWdFdmVudHMucHVzaCh7dDogbm93LCB4OiBvZS5wYWdlWH0pO1xuICAgICAgICB3aGlsZSAoZHJhZ0V2ZW50c1swXS50IDwgbm93IC0gMjUwKSB7IGRyYWdFdmVudHMuc2hpZnQoKTsgfVxuICAgICAgfSxcbiAgICAgIHN0b3A6IGZ1bmN0aW9uKGUsIHVpKSB7XG4gICAgICAgIHZhciB4ID0gZS5vcmlnaW5hbEV2ZW50LnBhZ2VYLCBcbiAgICAgICAgICBub3cgPSAobmV3IERhdGUpLmdldFRpbWUoKSxcbiAgICAgICAgICAvLyB0aGUgc2Vjb25kIHRvIGxhc3QgZHJhZ0V2ZW50IHNlZW1zIHRvIGJlIHRoZSBtb3N0IGluZm9ybWF0aXZlIGZvciB2ZWxvY2l0eS5cbiAgICAgICAgICBkcmFnRXZlbnQgPSBkcmFnRXZlbnRzLnNsaWNlKC0yLC0xKS5wb3AoKSwgXG4gICAgICAgICAgZHQgPSBkcmFnRXZlbnQgJiYgKG5vdyAtIGRyYWdFdmVudC50KSxcbiAgICAgICAgICB2SW5pdCA9IGRyYWdFdmVudCAmJiAoeCAtIGRyYWdFdmVudC54KSAvIGR0LFxuICAgICAgICAgIHBlcmZlY3RQYWdlWSA9IChfLmlzVW5kZWZpbmVkKHNuYXBwaW5nVG9BbmltYXRpb24udG8pID8gJGVsZW0uZGF0YSgnbmF0dXJhbFRvcCcpIDogc25hcHBpbmdUb0FuaW1hdGlvbi50bykgXG4gICAgICAgICAgICArIHRvcE9mZnNldHMudG9wICsgdG9wT2Zmc2V0cy5jbGljaztcbiAgICAgICAgc2VsZi5maXhUcmFja1RpbGVzKCk7XG4gICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnZHJhZ2dpbmcnKTtcbiAgICAgICAgdXBkYXRlTGluZVRvcChwZXJmZWN0UGFnZVkpO1xuICAgICAgICBpbml0S2V5ZWRPZmZzZXQgPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2tleWVkT2Zmc2V0Jyk7XG4gICAgICAgIG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignc2hvd1JldGljbGUnLCAnZHJhZ2dpbmcnLCBmYWxzZSk7XG4gICAgICAgIGlmIChNYXRoLmFicyh2SW5pdCkgPiAwLjEpIHtcbiAgICAgICAgICB2YXIgeEluaXQgPSB1aS5wb3NpdGlvbi5sZWZ0LCBkZWNlbCA9IHZJbml0ID4gMCA/IDAuMDAxIDogLTAuMDAxLCBsYXN0UmVmcmVzaCA9IDA7ICAgICAgICAgICAgXG4gICAgICAgICAgc2VsZi4kY29udC5jc3MoJ3RleHQtaW5kZW50JywgMSk7XG4gICAgICAgICAgc2VsZi4kY29udC5hbmltYXRlKHt0ZXh0SW5kZW50OiAwfSwge1xuICAgICAgICAgICAgcXVldWU6IGZhbHNlLFxuICAgICAgICAgICAgZHVyYXRpb246IE1hdGguYWJzKHZJbml0IC8gZGVjZWwpLFxuICAgICAgICAgICAgc3RlcDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHZhciBuZXdUaW1lID0gKG5ldyBEYXRlKS5nZXRUaW1lKCksXG4gICAgICAgICAgICAgICAgZGVsdGFUID0gbmV3VGltZSAtIG5vdyxcbiAgICAgICAgICAgICAgICAvLyBhbGxvdyB0aGUga2V5Ym9hcmQgdG8gc2hpZnQgdGhlIHBvc2l0aW9uICpkdXJpbmcqIGluZXJ0aWFsIHNjcm9sbHNcbiAgICAgICAgICAgICAgICBrZXllZE9mZnNldCA9IG8uYnJvd3Nlci5nZW5vYnJvd3Nlcigna2V5ZWRPZmZzZXQnKSxcbiAgICAgICAgICAgICAgICBkZWx0YUwgPSAodkluaXQqZGVsdGFUKSAtICgwLjUqZGVjZWwqZGVsdGFUKmRlbHRhVCkgKyBpbml0S2V5ZWRPZmZzZXQgLSBrZXllZE9mZnNldDtcbiAgICAgICAgICAgICAgICBsZWZ0ID0geEluaXQgKyBkZWx0YUw7XG4gICAgICAgICAgICAgIC8vIHN0b3JlIHRoZSB2ZWxvY2l0eSBvbiB0aGUgYnJvd3NlciBlbGVtZW50IHNvIGl0IGNhbiBjYXRjaCB0aGUgdGhyb3cgaWYgYSBib3VuY2UgaXMgbmVlZGVkXG4gICAgICAgICAgICAgIG8uYnJvd3Nlci5kYXRhKCd2ZWxvY2l0eScsIHZJbml0IC0gZGVjZWwgKiBkZWx0YVQpO1xuICAgICAgICAgICAgICAvLyBmb3IgdGhvc2UgbG9vb25nIGluZXJ0aWFsIHNjcm9sbHMsIGtlZXAgdGhlIHRpbGVzIGNvbWluZ1xuICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoZGVsdGFMIC0gbGFzdFJlZnJlc2gpID4gMTAwMCkgeyBsYXN0UmVmcmVzaCA9IGRlbHRhTDsgc2VsZi5maXhUcmFja1RpbGVzKCk7IH1cbiAgICAgICAgICAgICAgc2VsZi4kY29udC5jc3MoJ2xlZnQnLCBsZWZ0KTtcbiAgICAgICAgICAgICAgdXBkYXRlUG9zKGxlZnQpO1xuICAgICAgICAgICAgICBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2JvdW5jZUNoZWNrJyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkgeyBcbiAgICAgICAgICAgICAgc2VsZi5maXhUcmFja1RpbGVzKCk7IFxuICAgICAgICAgICAgICBvLmJyb3dzZXIuZGF0YSgndmVsb2NpdHknLCAwKTtcbiAgICAgICAgICAgICAgby5icm93c2VyLmdlbm9icm93c2VyKCdib3VuY2VDaGVjaycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlbGYuZml4VHJhY2tUaWxlcygpO1xuICAgICAgICAgIG8uYnJvd3Nlci5nZW5vYnJvd3NlcignYm91bmNlQ2hlY2snKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICBcbiAgX2luaXRTaWRlU29ydGFibGU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudDtcbiAgICB0aGlzLiRzaWRlLnNvcnRhYmxlKHtcbiAgICAgIGF4aXM6ICd5JyxcbiAgICAgIHBsYWNlaG9sZGVyOiAnc2lkZSBwbGFjZWhvbGRlciBpbnNldC1zaGFkb3cnLFxuICAgICAgZm9yY2VQbGFjZWhvbGRlclNpemU6IHRydWUsXG4gICAgICBhcHBlbmRUbzogJyMnICsgby5icm93c2VyLmF0dHIoJ2lkJyksXG4gICAgICBoYW5kbGU6ICcuc3VidHJhY2stY29udCcsXG4gICAgICBoZWxwZXI6ICdjbG9uZScsXG4gICAgICBzdGFydDogZnVuY3Rpb24oKSB7IFxuICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ2RyYWdnaW5nJyk7XG4gICAgICAgIHNlbGYuJGNvbnQuY2hpbGRyZW4oJy5icm93c2VyLXRyYWNrJykuZWFjaChmdW5jdGlvbihpKSB7ICQodGhpcykuZGF0YSgnb2xkSW5kZXgnLCBpKTsgfSk7XG4gICAgICB9LFxuICAgICAgc3RvcDogZnVuY3Rpb24oKSB7ICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnZHJhZ2dpbmcnKTsgfSxcbiAgICAgIGNoYW5nZTogZnVuY3Rpb24oZSwgdWkpIHtcbiAgICAgICAgc2VsZi4kY29udC5jaGlsZHJlbignLmJyb3dzZXItdHJhY2snKS5zb3J0RWxlbWVudHMoZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgIGEgPSAkKGEpLmdlbm90cmFjaygnc2lkZScpO1xuICAgICAgICAgIGEgPSBzZWxmLiRzaWRlLmNoaWxkcmVuKCcuc2lkZScpLmluZGV4KGEuaXModWkuaXRlbSkgPyB1aS5wbGFjZWhvbGRlciA6IGEpO1xuICAgICAgICAgIGIgPSAkKGIpLmdlbm90cmFjaygnc2lkZScpO1xuICAgICAgICAgIGIgPSBzZWxmLiRzaWRlLmNoaWxkcmVuKCcuc2lkZScpLmluZGV4KGIuaXModWkuaXRlbSkgPyB1aS5wbGFjZWhvbGRlciA6IGIpO1xuICAgICAgICAgIHJldHVybiBhIC0gYjtcbiAgICAgICAgfSk7XG4gICAgICAgIHNlbGYuZml4Rmlyc3RMYWJlbCh0cnVlKTtcbiAgICAgIH0sXG4gICAgICB1cGRhdGU6IGZ1bmN0aW9uKGUsIHVpKSB7XG4gICAgICAgIHZhciBuZXdPcmRlciA9IFtdO1xuICAgICAgICBzZWxmLiRjb250LmNoaWxkcmVuKCcuYnJvd3Nlci10cmFjaycpLmVhY2goZnVuY3Rpb24oaSkgeyBuZXdPcmRlclskKHRoaXMpLmRhdGEoJ29sZEluZGV4JyldID0gaTsgfSk7XG4gICAgICAgIG8uYnJvd3Nlci5nZW5vYnJvd3NlcigncmVjdlNvcnQnLCAkZWxlbSwgbmV3T3JkZXIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICBcbiAgZml4VHJhY2tzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgJGVsZW0gPSB0aGlzLmVsZW1lbnQsIFxuICAgICAgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICR0ID0gdGhpcy4kY29udC5jaGlsZHJlbignLmJyb3dzZXItdHJhY2snKS5maXJzdCgpLFxuICAgICAgdHJhY2tzID0gby5icm93c2VyLmdlbm9icm93c2VyKCd0cmFja3MnKSxcbiAgICAgICR1O1xuICAgIGlmICghJHQubGVuZ3RoKSB7ICR0ID0gdGhpcy5fYWRkVHJhY2sodHJhY2tzWzBdLCAwKTsgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHJhY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgdHJhY2sgPSB0cmFja3NbaV07XG4gICAgICBpZiAoJHQuaGFzQ2xhc3MoJ2Jyb3dzZXItdHJhY2stJyArIHRyYWNrLm4pKSB7ICR0ID0gJHQubmV4dCgpOyB9XG4gICAgICBlbHNlIHsgdGhpcy5fYWRkVHJhY2sodHJhY2ssICR0KTsgfVxuICAgIH1cbiAgICBkbyB7ICR1ID0gJHQ7ICR0ID0gJHQubmV4dCgpOyAkdS5nZW5vdHJhY2soJ3NpZGUnKS5yZW1vdmUoKTsgJHUucmVtb3ZlKCk7IH0gd2hpbGUgKCR0Lmxlbmd0aCk7XG4gICAgdGhpcy4kc2lkZS5zb3J0YWJsZSgncmVmcmVzaCcpO1xuICAgIHRoaXMuZml4Rmlyc3RMYWJlbCh0cnVlKTtcbiAgfSxcbiAgXG4gIGp1bXBUbzogZnVuY3Rpb24ocG9zLCBmb3JjZVJlcG9zKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICB6b29tID0gby5icm93c2VyLmdlbm9icm93c2VyKCd6b29tJyksXG4gICAgICBsZWZ0ID0gKG8ub3JpZ2luIC0gcG9zKSAvIHpvb207XG4gICAgLy8gTW96aWxsYSBnZXRzIGFnZ3JhdmF0ZWQgYnkgQ1NTIGxlbmd0aHMgb3V0c2lkZSBvZiDCsTEuMGU3OyBPcGVyYSBnZXRzIGFnZ3JhdmF0ZWQgc29tZXdoZXJlIG91dHNpZGUgb2YgwrExLjBlNlxuICAgIGlmIChsZWZ0ID4gMS4wZSs2IHx8IGxlZnQgPCAtMS4wZSs2KSB7IG8ub3JpZ2luID0gcG9zOyBsZWZ0ID0gMDsgZm9yY2VSZXBvcyA9IHRydWU7IH1cbiAgICB0aGlzLnBvcyA9IHBvcztcbiAgICB0aGlzLiRjb250LmNzcygnbGVmdCcsIGxlZnQpO1xuICAgIHRoaXMuZml4VHJhY2tUaWxlcyhmb3JjZVJlcG9zKTtcbiAgICB0aGlzLmZpeEZpcnN0TGFiZWwoKTtcbiAgICB0aGlzLmZpeEluZGljZXMoKTtcbiAgfSxcbiAgXG4gIGZpeFRyYWNrVGlsZXM6IGZ1bmN0aW9uKGZvcmNlUmVwb3MpIHtcbiAgICB0aGlzLiRjb250LmNoaWxkcmVuKCcuYnJvd3Nlci10cmFjaycpLmdlbm90cmFjaygnZml4VGlsZXMnLCBmb3JjZVJlcG9zKTtcbiAgfSxcbiAgXG4gIGdldFBvczogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMucG9zO1xuICB9LFxuICBcbiAgX2FkZFRyYWNrOiBmdW5jdGlvbih0cmFjaywgcG9zKSB7XG4gICAgdmFyICRlbGVtID0gdGhpcy5lbGVtZW50LFxuICAgICAgJHRyayA9ICQoJzxkaXYgY2xhc3M9XCJicm93c2VyLXRyYWNrXCI+PC9kaXY+Jyk7XG4gICAgaWYgKCFwb3MgfHwgIXBvcy5sZW5ndGgpIHsgJHRya1twb3MgPT09IDAgPyAncHJlcGVuZFRvJyA6ICdhcHBlbmRUbyddKHRoaXMuJGNvbnQpOyB9XG4gICAgZWxzZSB7IFxuICAgICAgaWYgKF8uaXNOdW1iZXIocG9zKSkgeyBwb3MgPSB0aGlzLiRjb250LmNoaWxkcmVuKCcuYnJvd3Nlci10cmFjaycpLmVxKHBvcyk7IH1cbiAgICAgICR0cmsuaW5zZXJ0QmVmb3JlKHBvcyk7IFxuICAgIH1cbiAgICBwb3MgPSB0aGlzLiRjb250LmNoaWxkcmVuKCcuYnJvd3Nlci10cmFjaycpLmluZGV4KCR0cmsuZ2V0KDApKTtcbiAgICB2YXIgJHNpZGUgPSAkKCc8ZGl2IGNsYXNzPVwic2lkZVwiLz4nKSwgJHNpZGVzID0gdGhpcy4kc2lkZS5jaGlsZHJlbignLnNpZGUnKTtcbiAgICBpZiAocG9zICYmICRzaWRlcy5sZW5ndGgpIHsgJHNpZGUuaW5zZXJ0QWZ0ZXIoJHNpZGVzLmVxKHBvcyAtIDEpKTsgfVxuICAgIGVsc2UgeyAkc2lkZS5wcmVwZW5kVG8odGhpcy4kc2lkZSk7IH1cbiAgICByZXR1cm4gJHRyay5nZW5vdHJhY2soJC5leHRlbmQoe30sIHRoaXMub3B0aW9ucywge3RyYWNrOiB0cmFjaywgbGluZTogJGVsZW0sIHNpZGU6ICRzaWRlfSkpO1xuICB9LFxuICBcbiAgX2xpbmVIZWlnaHQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBvID0gdGhpcy5vcHRpb25zLCB0cmFja3MgPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3RyYWNrcycpO1xuICAgIHJldHVybiBfLnJlZHVjZSh0cmFja3MsIGZ1bmN0aW9uKHQsIHUpIHsgcmV0dXJuIHtoOnQuaCArIHUuaH07IH0pLmg7XG4gIH0sXG4gIFxuICBsaW5lSGVpZ2h0OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fbGluZUhlaWdodCgpO1xuICB9LFxuICBcbiAgZml4Rmlyc3RMYWJlbDogZnVuY3Rpb24obm9Ib3Jpek1vdGlvbikge1xuICAgIHZhciBzZWxmID0gdGhpcywgJGVsZW0gPSBzZWxmLmVsZW1lbnQsIG8gPSBzZWxmLm9wdGlvbnM7XG4gICAgaWYgKCFzZWxmLiRmaXJzdExhYmVsKSB7IHJldHVybjsgfVxuICAgIGlmICgkZWxlbS5nZXQoMCkgIT0gby5icm93c2VyLmdlbm9icm93c2VyKCdsaW5lcycpLmdldCgwKSkgeyBcbiAgICAgIHNlbGYuJGZpcnN0TGFiZWwuYWRkQ2xhc3MoJ29jY2x1ZGVkJyk7XG4gICAgICAkZWxlbS5maW5kKCcuYnJvd3Nlci10cmFjay1ydWxlciAubGFiZWwnKS5yZW1vdmVDbGFzcygnb2NjbHVkZWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKG5vSG9yaXpNb3Rpb24gPT09IHRydWUpIHtcbiAgICAgIHZhciAkcnVsZXIgPSAkZWxlbS5maW5kKCcuYnJvd3Nlci10cmFjay1ydWxlcicpO1xuICAgICAgaWYgKCEkcnVsZXIubGVuZ3RoKSB7IHRoaXMuJGZpcnN0TGFiZWwuYWRkQ2xhc3MoJ25vLXJ1bGVyJyk7IH1cbiAgICAgIGVsc2UgeyB0aGlzLiRmaXJzdExhYmVsLnJlbW92ZUNsYXNzKCduby1ydWxlcicpLmNzcygndG9wJywgJHJ1bGVyLnBvc2l0aW9uKCkudG9wKTsgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBIb3Jpem9udGFsIG1vdGlvbiBtZWFucyB3ZSBtYXkgaGF2ZSB0byBmaXggdGhlIGNvbnRlbnQgYW5kIG9jY2x1c2lvbiBvZiB0aGUgbGFiZWwuXG4gICAgdmFyIGxhYmVsID0gby5icm93c2VyLmdlbm9icm93c2VyKCdjaHJBdCcsIHNlbGYucG9zKSwgb2Zmc2V0TGVmdCwgd2lkdGg7XG4gICAgJGVsZW0uZmluZCgnLmJyb3dzZXItdHJhY2stcnVsZXIgLmxhYmVsJykucmVtb3ZlQ2xhc3MoJ29jY2x1ZGVkJyk7XG4gICAgaWYgKGxhYmVsPT09bnVsbCkgeyBzZWxmLiRmaXJzdExhYmVsLmFkZENsYXNzKCdvY2NsdWRlZCcpOyByZXR1cm47IH0gLy8gV2UgYXJlIGJlaGluZCBjaHIxLlxuICAgIHNlbGYuJGZpcnN0TGFiZWwudGV4dChsYWJlbC5uKS5yZW1vdmVDbGFzcygnb2NjbHVkZWQnKTtcbiAgICBvZmZzZXRMZWZ0ID0gc2VsZi4kZmlyc3RMYWJlbC5vZmZzZXQoKS5sZWZ0O1xuICAgIHdpZHRoID0gc2VsZi4kZmlyc3RMYWJlbC53aWR0aCgpO1xuICAgICRlbGVtLmZpbmQoJy5icm93c2VyLXRyYWNrLXJ1bGVyIC5sYWJlbCcpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgdGhpc0xlZnQgPSAkKHRoaXMpLm9mZnNldCgpLmxlZnQsIHRoaXNXaWR0aCA9ICQodGhpcykud2lkdGgoKTtcbiAgICAgIGlmICh0aGlzTGVmdCArIHRoaXNXaWR0aCA+IG9mZnNldExlZnQgJiYgdGhpc0xlZnQgPCBvZmZzZXRMZWZ0ICsgd2lkdGgpIHsgXG4gICAgICAgIHNlbGYuJGZpcnN0TGFiZWwuYWRkQ2xhc3MoJ29jY2x1ZGVkJyk7XG4gICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ29jY2x1ZGVkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIFxuICBmaXhJbmRpY2VzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgIHBvcyA9IHRoaXMucG9zLFxuICAgICAgYnBXaWR0aCA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignYnBXaWR0aCcpLFxuICAgICAgem9vbSA9IG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignem9vbScpLFxuICAgICAgZWxlbSA9IHRoaXMuZWxlbWVudC5nZXQoMCksXG4gICAgICBtdWx0aXBsZUxpbmVzID0gby5icm93c2VyLmdlbm9icm93c2VyKCdsaW5lcycpLmxlbmd0aCA+IDEsXG4gICAgICByZXRpY1BvcyA9IHRoaXMuY2VudGVyZWRPbiA9PT0gbnVsbCA/IHRoaXMucG9zICsgMC41ICogKGJwV2lkdGggLSBvLnNpZGVCYXJXaWR0aCAqIHpvb20pIDogdGhpcy5jZW50ZXJlZE9uLFxuICAgICAgY2hyU3RhcnQsIGNockVuZCwgY2hyUmV0aWM7XG4gICAgICBcbiAgICBpZiAoZWxlbSA9PSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2xpbmVzJykuZ2V0KDApKSB7XG4gICAgICBjaHJTdGFydCA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignY2hyQXQnLCBwb3MpIHx8IG8uY2hyTGFiZWxzWzBdO1xuICAgICAgdGhpcy4kaW5kaWNlcy5jaGlsZHJlbignLnN0YXJ0JykudGV4dCgobXVsdGlwbGVMaW5lcyA/IGNoclN0YXJ0Lm4gKyAnOicgOiAnJykgKyBNYXRoLmZsb29yKHBvcyAtIGNoclN0YXJ0LnApKTtcbiAgICB9IGVsc2UgeyB0aGlzLiRpbmRpY2VzLmNoaWxkcmVuKCcuc3RhcnQnKS5lbXB0eSgpOyB9XG4gICAgXG4gICAgaWYgKGVsZW0gPT0gby5icm93c2VyLmdlbm9icm93c2VyKCdsaW5lcycpLmxhc3QoKS5nZXQoMCkpIHtcbiAgICAgIGNockVuZCA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignY2hyQXQnLCBwb3MgKyBicFdpZHRoKSB8fCBvLmNockxhYmVsc1swXTtcbiAgICAgIHRoaXMuJGluZGljZXMuY2hpbGRyZW4oJy5lbmQnKS50ZXh0KChtdWx0aXBsZUxpbmVzID8gY2hyRW5kLm4gKyAnOicgOiAnJykgKyBNYXRoLmNlaWwocG9zICsgYnBXaWR0aCAtIGNockVuZC5wKSk7XG4gICAgfSBlbHNlIHsgdGhpcy4kaW5kaWNlcy5jaGlsZHJlbignLmVuZCcpLmVtcHR5KCk7IH1cbiAgICBcbiAgICBjaHJSZXRpYyA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignY2hyQXQnLCByZXRpY1BvcykgfHwgby5jaHJMYWJlbHNbMF07XG4gICAgdGhpcy4kcmV0aWMuY2hpbGRyZW4oJy5uJykudGV4dCgobXVsdGlwbGVMaW5lcyA/IGNoclJldGljLm4gKyAnOicgOiAnJykgKyBNYXRoLmZsb29yKHJldGljUG9zIC0gY2hyUmV0aWMucCkpO1xuICB9LFxuICBcbiAgc2V0UmV0aWNsZTogZnVuY3Rpb24obmV4dFpvb21zLCBjZW50ZXJlZE9uKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICB6b29tID0gby5icm93c2VyLmdlbm9icm93c2VyKCd6b29tJyksXG4gICAgICBsaW5lV2lkdGggPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2xpbmVXaWR0aCcpLFxuICAgICAgYnBXaWR0aCA9IGxpbmVXaWR0aCAqIHpvb20sXG4gICAgICB3aWR0aDEgPSBuZXh0Wm9vbXNbMF0gLyB6b29tICogbGluZVdpZHRoLFxuICAgICAgJGlubmVyUmV0aWMgPSB0aGlzLiRyZXRpYy5jaGlsZHJlbignLmlubmVyLXJldGljJyksXG4gICAgICBvcGFjaXR5ID0gbmV4dFpvb21zWzFdID8gTWF0aC5taW4oMiAtIDIgKiB3aWR0aDEgLyBsaW5lV2lkdGgsIDEpIDogMSxcbiAgICAgIG5vQ2VudGVyZWRPbiA9IF8uaXNVbmRlZmluZWQoY2VudGVyZWRPbikgfHwgY2VudGVyZWRPbiA9PT0gbnVsbCxcbiAgICAgIGxlZnQgPSBub0NlbnRlcmVkT24gPyAnNTAlJyA6IChjZW50ZXJlZE9uIC0gdGhpcy5wb3MpIC8gem9vbSArIG8uc2lkZUJhcldpZHRoO1xuICAgIHRoaXMuJHJldGljLmNzcygnd2lkdGgnLCB3aWR0aDEpLmNzcygnbWFyZ2luLWxlZnQnLCAtd2lkdGgxICogMC41KTtcbiAgICB0aGlzLiRyZXRpYy5jaGlsZHJlbignLmMnKS5jc3MoJ29wYWNpdHknLCBvcGFjaXR5KTtcbiAgICBpZiAobmV4dFpvb21zWzFdKSB7XG4gICAgICB2YXIgd2lkdGgyID0gbmV4dFpvb21zWzFdIC8gem9vbSAqIGxpbmVXaWR0aDtcbiAgICAgICRpbm5lclJldGljLnNob3coKS5jc3MoJ3dpZHRoJywgd2lkdGgyKS5jc3MoJ21hcmdpbi1sZWZ0JywgLXdpZHRoMiAqIDAuNSk7XG4gICAgICAkaW5uZXJSZXRpYy5jc3MoJ29wYWNpdHknLCAxIC0gb3BhY2l0eSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRpbm5lclJldGljLmhpZGUoKTtcbiAgICB9XG4gICAgdGhpcy4kcmV0aWMuY3NzKCdsZWZ0JywgbGVmdCk7XG4gICAgdGhpcy5jZW50ZXJlZE9uID0gbm9DZW50ZXJlZE9uID8gbnVsbCA6IGNlbnRlcmVkT247XG4gIH0sXG4gIFxuICBfcmVjdkRvdWJsZUNsaWNrOiBmdW5jdGlvbihlKSB7XG4gICAgdmFyIHNlbGYgPSBlLmRhdGEuc2VsZixcbiAgICAgICRicm93c2VyID0gc2VsZi5vcHRpb25zLmJyb3dzZXIsXG4gICAgICB6b29tID0gJGJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3pvb20nKSxcbiAgICAgIG9mZnNldCA9ICQoc2VsZi4kdHJhY2tDb250KS5vZmZzZXQoKSxcbiAgICAgIG9mZnNldExlZnQgPSAoZS5wYWdlWCArIDgpIC0gb2Zmc2V0LmxlZnQ7IC8vIGNvbXBlbnNhdGluZyBmb3IgdGhlIGNlbnRlciBvZiB0aGUgY3Vyc29yP1xuICAgICRicm93c2VyLmdlbm9icm93c2VyKCd6b29tJywgIWUuc2hpZnRLZXksIHNlbGYucG9zICsgKG9mZnNldExlZnQgKiB6b29tKSwgMTAwMCk7XG4gIH0sXG4gIFxuICB0b2dnbGVab29tU2hpZWxkOiBmdW5jdGlvbihzaG93KSB7XG4gICAgdGhpcy4kem9vbXNoaWVsZC50b2dnbGVDbGFzcygnaGlkZGVuJywgIXNob3cpO1xuICB9XG4gIFxufSk7XG5cbn07IiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gRWFjaCB0cmFjayB3aXRoaW4gYSAkLnVpLmdlbm9saW5lIGlzIG1hbmFnZWQgYnkgYSAkLnVpLmdlbm90cmFjayA9XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCQpIHtcblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy5qcycpKCQpLFxuICBwYWQgPSB1dGlscy5wYWQsXG4gIGNsYXNzRnJpZW5kbHkgPSB1dGlscy5jbGFzc0ZyaWVuZGx5LFxuICBzaG9ydEhhc2ggPSB1dGlscy5zaG9ydEhhc2gsXG4gIGZsb29ySGFjayA9IHV0aWxzLmZsb29ySGFjaztcblxuJC53aWRnZXQoJ3VpLmdlbm90cmFjaycsIHtcbiAgXG4gIC8vIERlZmF1bHQgb3B0aW9ucyB0aGF0IGNhbiBiZSBvdmVycmlkZGVuXG4gIG9wdGlvbnM6IHtcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgbGluZTogbnVsbCwgICAgICAgLy8gbXVzdCBiZSBzcGVjaWZpZWQgb24gaW5zdGFudGlhdGlvblxuICAgIHNpZGU6IG51bGwgICAgICAgIC8vIG11c3QgYmUgc3BlY2lmaWVkIG9uIGluc3RhbnRpYXRpb25cbiAgfSxcbiAgXG4gIC8vIENhbGxlZCBhdXRvbWF0aWNhbGx5IHdoZW4gd2lkZ2V0IGlzIGluc3RhbnRpYXRlZFxuICBfaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgJGVsZW0gPSB0aGlzLmVsZW1lbnQsIFxuICAgICAgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgIGJwcHBzO1xuICAgIGlmICghby5saW5lKSB7IHRocm93IFwiQ2Fubm90IGluc3RhbnRpYXRlIHVpLmdlbm90cmFjayB3aXRob3V0IHNwZWNpZnlpbmcgJ2xpbmUnIG9wdGlvblwiOyB9XG4gICAgaWYgKCFvLnNpZGUpIHsgdGhyb3cgXCJDYW5ub3QgaW5zdGFudGlhdGUgdWkuZ2Vub3RyYWNrIHdpdGhvdXQgc3BlY2lmeWluZyAnc2lkZScgb3B0aW9uXCI7IH1cbiAgICBzZWxmLnJ1bGVyID0gby50cmFjay5uID09ICdydWxlcic7XG4gICAgc2VsZi5zbGlkZXJCcHBwcyA9IG8uYnBwcHMuY29uY2F0KG8ub3Zlcnpvb21CcHBwcyk7XG4gICAgc2VsZi50aWxlTG9hZENvdW50ZXIgPSBzZWxmLmFyZWFMb2FkQ291bnRlciA9IDA7XG4gICAgc2VsZi5jdXN0b20gPSAhIW8udHJhY2suY3VzdG9tO1xuICAgIHNlbGYuYmlydGggPSAobmV3IERhdGUpLmdldFRpbWUoKTtcbiAgICBzZWxmLiRzaWRlID0gJChvLnNpZGUpLmFwcGVuZCgnPGRpdiBjbGFzcz1cInN1YnRyYWNrLWNvbnRcIi8+Jyk7XG4gICAgJGVsZW0uYWRkQ2xhc3MoJ2Jyb3dzZXItdHJhY2stJytvLnRyYWNrLm4pLnRvZ2dsZUNsYXNzKCduby1pZGVvZ3JhbXMnLCBzZWxmLnJ1bGVyICYmICFvLmNockJhbmRzKTtcbiAgICBzZWxmLl9uZWFyZXN0QnBwcHMoby5icm93c2VyLmdlbm9icm93c2VyKCd6b29tJykpO1xuICAgIC8vIElmIHRoZSB0cmFjayBoYXMgbXVsdGlwbGUgZGVuc2l0aWVzLCBvciBpdHMgc2luZ2xlIGRlbnNpdHkgaGFzIG11bHRpcGxlIGZpeGVkIGhlaWdodHMsXG4gICAgLy8gbWFrZSB0aGUgc2lkZWJhciByZXNpemFibGVcbiAgICBzZWxmLl9pbml0U2lkZVJlc2l6YWJsZSgpO1xuICAgIHNlbGYuX2F2YWlsRGVuc2l0aWVzKCk7XG4gICAgc2VsZi5sb2FkaW5nQ291bnRlciA9IDA7XG4gICAgJGVsZW0uYXR0cignaWQnLCBzZWxmLnVuaXFJZCA9ICQudW5pcUlkKCd0cmsnKSk7XG4gICAgc2VsZi5yZXNpemUoby50cmFjay5oKTtcbiAgICBzZWxmLnVwZGF0ZURlbnNpdHkoKTtcbiAgfSxcbiAgXG4gIF9pbml0U2lkZVJlc2l6YWJsZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgJGVsZW0gPSB0aGlzLmVsZW1lbnQsXG4gICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgYkYgPSBzZWxmLl9icHBwRm9ybWF0KG8uYnBwcHNbMF0pLFxuICAgICAgZmlyc3RGaXhlZEhlaWdodCA9IF8udW5pcShfLnBsdWNrKG8udHJhY2suZmgsIF8uZmxhdHRlbihvLnRyYWNrLnMpWzBdKSksXG4gICAgICBwYWRkaW5nQm9yZGVyc1kgPSBzZWxmLiRzaWRlLm91dGVySGVpZ2h0KCkgLSBzZWxmLiRzaWRlLmhlaWdodCgpLFxuICAgICAgbWluSGVpZ2h0ID0gKHNlbGYuY3VzdG9tID8gby50cmFjay5jdXN0b20uaGVpZ2h0cy5taW4gOiBNYXRoLm1pbihfLm1pbihvLnRyYWNrLmZoW2JGXSksIDMyKSkgLSBwYWRkaW5nQm9yZGVyc1ksXG4gICAgICAkbGluZXNCZWxvdywgJGg7XG4gICAgdmFyIG9wdHMgPSB7XG4gICAgICBoYW5kbGVzOiAncycsIFxuICAgICAgbWluSGVpZ2h0OiBtaW5IZWlnaHQsXG4gICAgICBzdGFydDogZnVuY3Rpb24oZSwgdWkpIHtcbiAgICAgICAgdmFyIGJwcHAgPSBzZWxmLmJwcHBzKCkudG9wLFxuICAgICAgICAgIGZpeGVkSGVpZ2h0cyA9IG8udHJhY2suZmhbc2VsZi5fYnBwcEZvcm1hdChicHBwKV0sXG4gICAgICAgICAgY3VzdG9tSGVpZ2h0cyA9IG8udHJhY2suY3VzdG9tICYmIG8udHJhY2suY3VzdG9tLmhlaWdodHM7XG4gICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygncm93LXJlc2l6aW5nJyk7XG4gICAgICAgIGlmICghc2VsZi5ydWxlciAmJiAhc2VsZi5jdXN0b20pIHtcbiAgICAgICAgICB2YXIgJGltZ3MgPSAkKCcuYnJvd3Nlci10cmFjay0nK28udHJhY2subisnPi5icHBwLScrY2xhc3NGcmllbmRseShicHBwKSsnIGltZy50ZGF0YScpLFxuICAgICAgICAgICAgbWF4SGVpZ2h0ID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgJGltZ3MubWFwKGZ1bmN0aW9uKCkgeyBcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmF0dXJhbEhlaWdodCB8fCB0aGlzLmhlaWdodDsgXG4gICAgICAgICAgICB9KS5nZXQoKSk7XG4gICAgICAgICAgJCh0aGlzKS5yZXNpemFibGUoJ29wdGlvbicsICdtYXhIZWlnaHQnLCBNYXRoLm1heChtYXhIZWlnaHQgKiAxLjIsIHVpLm9yaWdpbmFsU2l6ZS5oZWlnaHQsIDE4KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGYuY3VzdG9tKSB7XG4gICAgICAgICAgaWYgKGN1c3RvbUhlaWdodHMubWF4KSB7ICQodGhpcykucmVzaXphYmxlKCdvcHRpb24nLCAnbWF4SGVpZ2h0JywgY3VzdG9tSGVpZ2h0cy5tYXggLSBwYWRkaW5nQm9yZGVyc1kpOyB9XG4gICAgICAgICAgaWYgKGN1c3RvbUhlaWdodHMubWluKSB7ICQodGhpcykucmVzaXphYmxlKCdvcHRpb24nLCAnbWluSGVpZ2h0JywgY3VzdG9tSGVpZ2h0cy5taW4gLSBwYWRkaW5nQm9yZGVyc1kpOyB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzZWxmLnJ1bGVyKSB7XG4gICAgICAgICAgc2VsZi5zbmFwcyA9IGZpeGVkSGVpZ2h0cyAmJiBfLm1hcChmaXhlZEhlaWdodHMsIGZ1bmN0aW9uKHYsIGspIHsgcmV0dXJuIGs9PSdkZW5zZScgPyB2IDogdiArIDE7IH0pO1xuICAgICAgICAgIGlmIChzZWxmLnNuYXBzKSB7IHNlbGYuc25hcHMuYWx3YXlzID0gZml4ZWRIZWlnaHRzICYmICEhKGZpeGVkSGVpZ2h0cy5wYWNrIHx8IGZpeGVkSGVpZ2h0cy5mdWxsKTsgfVxuICAgICAgICB9XG4gICAgICAgIG8uYnJvd3Nlci5maW5kKCcuYnJvd3Nlci1saW5lJykucmVtb3ZlQ2xhc3MoJ2xhc3QtcmVzaXplZCcpO1xuICAgICAgICBvLmxpbmUuYWRkQ2xhc3MoJ2xhc3QtcmVzaXplZCcpO1xuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdyZXNpemluZy1zaWRlJyk7XG4gICAgICAgICRsaW5lc0JlbG93ID0gby5saW5lLm5leHRBbGwoKS5lYWNoKGZ1bmN0aW9uKCkgeyAkKHRoaXMpLmRhdGEoJ29yaWdUb3AnLCAkKHRoaXMpLnBvc2l0aW9uKCkudG9wKTsgfSk7XG4gICAgICB9LFxuICAgICAgcmVzaXplOiBmdW5jdGlvbihlLCB1aSkge1xuICAgICAgICB2YXIgaGVpZ2h0ID0gc2VsZi4kc2lkZS5vdXRlckhlaWdodCgpOyAvLyBmb3Igc29tZSByZWFzb24gdWkuc2l6ZS5oZWlnaHQgaXMgYWx3YXlzIGJlaGluZCBieSAxIGZyYW1lXG4gICAgICAgIGlmIChzZWxmLnNuYXBzICYmICh1aS5zaXplLmhlaWdodCA8IF8ubWF4KHNlbGYuc25hcHMpIHx8IHNlbGYuc25hcHMuYWx3YXlzKSkge1xuICAgICAgICAgIGhlaWdodCA9IF8ubWluKHNlbGYuc25hcHMsIGZ1bmN0aW9uKHYpIHsgcmV0dXJuIE1hdGguYWJzKHYgLSB1aS5zaXplLmhlaWdodCk7IH0pO1xuICAgICAgICAgIHNlbGYuJHNpZGUub3V0ZXJIZWlnaHQoaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBvLmxpbmUuZ2Vub2xpbmUoJ2ZpeEZpcnN0TGFiZWwnLCB0cnVlKTtcbiAgICAgICAgc2VsZi5fcmVzaXplKGhlaWdodCk7XG4gICAgICAgICRsaW5lc0JlbG93LmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJCh0aGlzKS5jc3MoJ3RvcCcsICQodGhpcykuZGF0YSgnb3JpZ1RvcCcpICsgaGVpZ2h0IC0gdWkub3JpZ2luYWxTaXplLmhlaWdodCk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIHN0b3A6IGZ1bmN0aW9uKGUsIHVpKSB7XG4gICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygncm93LXJlc2l6aW5nJyk7XG4gICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ3Jlc2l6aW5nLXNpZGUnKTtcbiAgICAgICAgJCh0aGlzKS5jc3MoJ3dpZHRoJywgJycpO1xuICAgICAgICBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3JlY3ZUcmFja1Jlc2l6ZScsIG8ubGluZSwgby50cmFjay5uLCBzZWxmLiRzaWRlLm91dGVySGVpZ2h0KCkpOyBcbiAgICAgIH1cbiAgICB9O1xuICAgIGlmIChzZWxmLnJ1bGVyKSB7IG9wdHMubWF4SGVpZ2h0ID0gby50cmFjay5vaCAtIHBhZGRpbmdCb3JkZXJzWTsgfVxuICAgIHNlbGYuJHNpZGUucmVzaXphYmxlKG9wdHMpO1xuICAgICRoID0gc2VsZi4kc2lkZS5maW5kKCcudWktcmVzaXphYmxlLWhhbmRsZScpO1xuICAgICRoLmhvdmVyKGZ1bmN0aW9uKCkgeyAkKHRoaXMpLmFkZENsYXNzKCdob3ZlcicpOyB9LCBmdW5jdGlvbigpIHsgJCh0aGlzKS5yZW1vdmVDbGFzcygnaG92ZXInKTsgfSk7XG4gIH0sXG4gIFxuICBzaWRlOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuJHNpZGU7IH0sXG4gIFxuICBfZml4U2lkZTogZnVuY3Rpb24oZGVuc2l0eSwgYnBwcCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgIG4gPSBvLnRyYWNrLm4sXG4gICAgICAkY29udCA9IHNlbGYuJHNpZGUuY2hpbGRyZW4oJy5zdWJ0cmFjay1jb250JyksXG4gICAgICB0cmFja0Rlc2MgPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ29wdGlvbicsICd0cmFja0Rlc2MnKSwgLy8gYWx3YXlzIHVzZSB0aGUgbGF0ZXN0IHZhbHVlcyBmcm9tIHRoZSBicm93c2VyXG4gICAgICBkZW5zQnBwcE1lbW8gPSBbZGVuc2l0eSwgYnBwcF0uam9pbignfCcpLFxuICAgICAgJHRvb01hbnlEYXRhV2FybmluZyA9IHNlbGYuJHNpZGUuY2hpbGRyZW4oJy50b28tbWFueS13YXJuaW5nJyksIFxuICAgICAgZGVucywgdGV4dCwgaDtcbiAgICBpZiAoJGNvbnQuZGF0YSgnZGVuc0JwcHAnKSA9PT0gZGVuc0JwcHBNZW1vKSB7IHJldHVybjsgfVxuICAgICRjb250LmVtcHR5KCk7XG4gICAgaWYgKGRlbnMgPSB0cmFja0Rlc2Nbbl0gJiYgdHJhY2tEZXNjW25dLmRlbnMgJiYgdHJhY2tEZXNjW25dLmRlbnNbZGVuc2l0eV0pIHtcbiAgICAgIGlmIChkZW5zWzBdWzBdID09PSAwKSB7XG4gICAgICAgIC8vIExhYmVscyBjaGFuZ2UgZm9yIGNlcnRhaW4gYnBwcCBsZXZlbHNcbiAgICAgICAgZGVucyA9IChkZW5zW18uc29ydGVkSW5kZXgoZGVucywgW2JwcHBdLCBmdW5jdGlvbih2KSB7IHJldHVybiB2WzBdOyB9KSAtIDFdIHx8IGRlbnNbMF0pLnNsaWNlKDEpO1xuICAgICAgfVxuICAgICAgLy8gQXBwbHkgdGhlIGFwcHJvcHJpYXRlIHN1YnRyYWNrIGxhYmVscyBmb3IgY2VydGFpbiBicHBwIGxldmVsc1xuICAgICAgXy5lYWNoKGRlbnMsIGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgdiA9IF8uaXNBcnJheSh2KSA/IHYgOiBbdl07XG4gICAgICAgIGggPSB2WzFdIHx8IDE1O1xuICAgICAgICAkKCc8ZGl2IGNsYXNzPVwic3VidHJhY2tcIi8+JykuY3NzKHtoZWlnaHQ6IGgsIGxpbmVIZWlnaHQ6IGgrJ3B4J30pLmh0bWwodlswXSkuYXBwZW5kVG8oJGNvbnQpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRleHQgPSAodHJhY2tEZXNjW25dICYmIHRyYWNrRGVzY1tuXS5zbSkgfHwgby50cmFjay5uO1xuICAgICAgaCA9IG8udHJhY2suaDtcbiAgICAgICRjb250LmFwcGVuZCgkKCc8ZGl2IGNsYXNzPVwic3VidHJhY2sgdW5zaXplZFwiLz4nKS50ZXh0KHRleHQpKTtcbiAgICB9XG4gICAgJGNvbnQuZGF0YSgnZGVuc0JwcHAnLCBkZW5zQnBwcE1lbW8pO1xuICB9LFxuICBcbiAgLy8gcHVibGljIHJlc2l6ZSBmdW5jdGlvbiB0aGF0IHVwZGF0ZXMgdGhlIGVudGlyZSBVSSBhY2NvcmRpbmdseS5cbiAgcmVzaXplOiBmdW5jdGlvbihoZWlnaHQsIGFuaW1DYWxsYmFjaykge1xuICAgIHZhciBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgcGFkZGluZ0JvcmRlcnNZID0gdGhpcy4kc2lkZS5vdXRlckhlaWdodCgpIC0gdGhpcy4kc2lkZS5oZWlnaHQoKTtcbiAgICAvLyBjYW4gcGFzcyBjYWxsYmFjaz09dHJ1ZSB0byBhbmltYXRlIHdpdGhvdXQgYSBjYWxsYmFja1xuICAgIGlmICghXy5pc0Z1bmN0aW9uKGFuaW1DYWxsYmFjaykgJiYgYW5pbUNhbGxiYWNrKSB7IGFuaW1DYWxsYmFjayA9IGZ1bmN0aW9uKCkge307IH1cbiAgICB0aGlzLl9yZXNpemUoaGVpZ2h0LCBhbmltQ2FsbGJhY2spO1xuICAgIGlmIChhbmltQ2FsbGJhY2spIHsgdGhpcy4kc2lkZS5hbmltYXRlKHtoZWlnaHQ6IGhlaWdodCAtIHBhZGRpbmdCb3JkZXJzWX0sIG8ubGluZUZpeER1cmF0aW9uKTsgfVxuICAgIGVsc2UgeyB0aGlzLiRzaWRlLm91dGVySGVpZ2h0KGhlaWdodCk7IH1cbiAgfSxcbiAgXG4gIC8vIGludGVybmFsIHJlc2l6ZSBoYW5kbGVyLCB1c2VkIGJ5IHRoZSByZXNpemFibGUgc2lkZSBoYW5kbGUsIGRvZXMgbm90IHVwZGF0ZSB0aGUgc2lkZSBoZWlnaHQuXG4gIF9yZXNpemU6IGZ1bmN0aW9uKGhlaWdodCwgY2FsbGJhY2spIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICRlbGVtID0gdGhpcy5lbGVtZW50LFxuICAgICAgYnBwcHMgPSB0aGlzLmJwcHBzKCk7XG4gICAgaWYgKHRoaXMucnVsZXIpIHtcbiAgICAgIGlmIChoZWlnaHQgPCB0aGlzLiRzaWRlLnJlc2l6YWJsZSgnb3B0aW9uJywgJ21pbkhlaWdodCcpICsgMykgeyAkZWxlbS5hZGRDbGFzcygncnVsZXItY29sbGFwc2VkJyk7IH1cbiAgICAgIGVsc2UgeyAkZWxlbS5yZW1vdmVDbGFzcygncnVsZXItY29sbGFwc2VkJyk7IH1cbiAgICB9XG4gICAgby50cmFjay5oID0gaGVpZ2h0O1xuICAgIG8uYnJvd3Nlci5nZW5vYnJvd3NlcignZGVuc2l0eU9yZGVyJywgby50cmFjay5uLCBoZWlnaHQsIGJwcHBzKTtcbiAgICB0aGlzLmZpeFRpbGVzKCk7XG4gICAgdGhpcy5maXhDbGlwcGVkKCk7XG4gICAgaWYgKF8uaXNGdW5jdGlvbihjYWxsYmFjaykpIHsgXG4gICAgICB0aGlzLmVsZW1lbnQuYW5pbWF0ZSh7aGVpZ2h0OiBoZWlnaHR9LCBvLmxpbmVGaXhEdXJhdGlvbiwgY2FsbGJhY2spLmNzcygnb3ZlcmZsb3cnLCAndmlzaWJsZScpOyBcbiAgICB9IGVsc2UgeyB0aGlzLmVsZW1lbnQuaGVpZ2h0KGhlaWdodCk7IH1cbiAgfSxcbiAgXG4gIF9hdmFpbERlbnNpdGllczogZnVuY3Rpb24oYnBwcCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdGlvbnM7XG4gICAgc2VsZi5hdmFpbERlbnNpdGllcyA9IHt9O1xuICAgIF8uZWFjaChvLmJwcHBzLCBmdW5jdGlvbihicHBwKSB7XG4gICAgICB2YXIgZGVuc2l0aWVzID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG8udHJhY2sucy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgdiA9IG8udHJhY2suc1tpXTtcbiAgICAgICAgaWYgKCFfLmlzQXJyYXkodikpIHsgdiA9IFt2XTsgfVxuICAgICAgICBpZiAodlsxXSAmJiBicHBwID4gdlsxXSkgeyBjb250aW51ZTsgfVxuICAgICAgICBpZiAodlsyXSAmJiBicHBwIDw9IHZbMl0pIHsgY29udGludWU7IH1cbiAgICAgICAgZGVuc2l0aWVzLnB1c2godlswXSk7XG4gICAgICB9XG4gICAgICBzZWxmLmF2YWlsRGVuc2l0aWVzW2JwcHBdID0gZGVuc2l0aWVzO1xuICAgIH0pO1xuICAgIHJldHVybiBzZWxmLmF2YWlsRGVuc2l0aWVzO1xuICB9LFxuICBcbiAgX2Jlc3REZW5zaXR5OiBmdW5jdGlvbihicHBwKSB7XG4gICAgdmFyIGRlbnNpdGllcyA9IHRoaXMuYXZhaWxEZW5zaXRpZXNbYnBwcF0sXG4gICAgICBkZW5zaXR5T3JkZXIgPSB0aGlzLm9wdGlvbnMuYnJvd3Nlci5nZW5vYnJvd3NlcignZGVuc2l0eU9yZGVyJywgdGhpcy5vcHRpb25zLnRyYWNrLm4pO1xuICAgIHJldHVybiBfLm1pbihkZW5zaXRpZXMsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGRlbnNpdHlPcmRlcltkXTsgfSlcbiAgfSxcbiAgXG4gIHVwZGF0ZURlbnNpdHk6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgIHRvcEJwcHAgPSBzZWxmLmJwcHBzKCkudG9wO1xuICAgIHZhciBiZXN0RGVuc2l0eSA9IHNlbGYuX2Jlc3REZW5zaXR5KHRvcEJwcHApO1xuICAgIC8vIEZpeCBzaWRlIGxhYmVscyAoZS5nLiBmb3Igc3VidHJhY2tzKSBmb3IgdGhlIGJlc3QgZGVuc2l0eVxuICAgIHNlbGYuX2ZpeFNpZGUoYmVzdERlbnNpdHksIHRvcEJwcHApO1xuICAgIC8vIFNldCB0aGUgYmVzdCBkZW5zaXR5IGFuZCB0cmlnZ2VyIGV2ZW50cyBvbiB0aGVzZSB0aWxlc1xuICAgICRlbGVtLmZpbmQoJy50aWxlLWZ1bGwnKS5jaGlsZHJlbignLnRkYXRhLC5hcmVhLmxhYmVsJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksXG4gICAgICAgIGlzQmVzdCA9ICR0aGlzLmhhc0NsYXNzKCdkZW5zLScrYmVzdERlbnNpdHkpO1xuICAgICAgJHRoaXMudG9nZ2xlQ2xhc3MoJ2RlbnMtYmVzdCcsIGlzQmVzdCk7XG4gICAgICBpZiAoaXNCZXN0KSB7ICR0aGlzLnRyaWdnZXIoJ2Jlc3REZW5zaXR5Jyk7IH1cbiAgICB9KTtcbiAgICAvLyBJZiB0aGUgdG9vLW1hbnkgY2xhc3Mgd2FzIHNldCBvbiB0aWxlcywgd2UgY291bGRuJ3QgZHJhdy9sb2FkIHNvbWUgY3VzdG9tIGRhdGEgYmVjYXVzZSB0aGVyZSdzIHRvbyBtdWNoIG9mIGl0LlxuICAgIC8vIEFkZCBhIGNsYXNzIHRvIHRoaXMgdHJhY2sgdG8gc2hvdyB3YXJuaW5ncyBhYm91dCB0aGlzIHRvIHRoZSB1c2VyLlxuICAgIC8vIEZpbmFsbHksIGZpeCBjbGlwcGluZyBpbmRpY2F0b3JzXG4gICAgc2VsZi5maXhDbGlwcGVkKCk7XG4gIH0sXG4gIFxuICBfbmVhcmVzdEJwcHBzOiBmdW5jdGlvbih6b29tKSB7XG4gICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsIFxuICAgICAgYnBwcHMgPSB7IG5lYXJlc3Q6IFtvLmJwcHBzWzBdXSwgY2FjaGU6IFtdLCB0b3A6IG8uYnBwcHNbMF0gfSxcbiAgICAgIHBvc3NpYmxlQnBwcHMgPSB0aGlzLnJ1bGVyID8gdGhpcy5zbGlkZXJCcHBwcyA6IG8uYnBwcHMsXG4gICAgICBsID0gcG9zc2libGVCcHBwcy5sZW5ndGgsXG4gICAgICBmb3VuZCA9IGZhbHNlLFxuICAgICAgc2hyaW5rYWJsZVdpbmRvdywgZ2V0TmV4dDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgdmFyIHpvb21EaWZmID0gem9vbSAtIHBvc3NpYmxlQnBwcHNbaV07XG4gICAgICBpZiAoem9vbURpZmYgPiAwKSB7XG4gICAgICAgIHNocmlua2FibGVXaW5kb3cgPSAocG9zc2libGVCcHBwc1tpICsgMV0gfHwgcG9zc2libGVCcHBwc1tpXSAvIDMpO1xuICAgICAgICBnZXROZXh0ID0gMCArICh6b29tRGlmZiA8IHNocmlua2FibGVXaW5kb3cpO1xuICAgICAgICBicHBwcy5uZWFyZXN0ID0gcG9zc2libGVCcHBwcy5zbGljZShNYXRoLm1heChpIC0gMiArIGdldE5leHQsIDApLCBpICsgZ2V0TmV4dCk7XG4gICAgICAgIGlmIChnZXROZXh0KSB7IGJwcHBzLmNhY2hlID0gW2ZhbHNlLCB6b29tRGlmZiA+IHNocmlua2FibGVXaW5kb3cgLyAyXTsgfVxuICAgICAgICBicHBwcy50b3AgPSBicHBwcy5jYWNoZVsxXSA/IGJwcHBzLm5lYXJlc3RbMF0gOiBicHBwcy5uZWFyZXN0LnNsaWNlKC0xKVswXTtcbiAgICAgICAgZm91bmQgPSB0cnVlOyBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFmb3VuZCkge1xuICAgICAgYnBwcHMubmVhcmVzdCA9IHBvc3NpYmxlQnBwcHMuc2xpY2UoLTIpO1xuICAgICAgYnBwcHMudG9wID0gcG9zc2libGVCcHBwcy5zbGljZSgtMSlbMF07XG4gICAgfVxuICAgIGlmICh0aGlzLnJ1bGVyICYmIHpvb20gPD0gby5pZGVvZ3JhbXNBYm92ZSkge1xuICAgICAgYnBwcHMubmVhcmVzdCA9IGJwcHBzLm5lYXJlc3Quc2xpY2UoLTEpO1xuICAgIH1cbiAgICBicHBwcy50b3BGb3JtYXR0ZWQgPSB0aGlzLl9icHBwRm9ybWF0KGJwcHBzLnRvcCk7XG4gICAgcmV0dXJuICh0aGlzLl9icHBwcyA9IGJwcHBzKTtcbiAgfSxcbiAgXG4gIGJwcHBzOiBmdW5jdGlvbihmb3JjZVJlY2FsYykge1xuICAgIHZhciB6b29tID0gdGhpcy5vcHRpb25zLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3pvb20nKTtcbiAgICByZXR1cm4gKGZvcmNlUmVjYWxjIHx8ICF0aGlzLl9icHBwcykgPyB0aGlzLl9uZWFyZXN0QnBwcHMoem9vbSkgOiB0aGlzLl9icHBwcztcbiAgfSxcbiAgXG4gIGZpeFRpbGVzOiBmdW5jdGlvbihmb3JjZVJlcG9zKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsIFxuICAgICAgbyA9IHNlbGYub3B0aW9ucztcbiAgICBpZiAoIW8uYnJvd3Nlci5nZW5vYnJvd3NlcigndGlsZUZpeGluZ0VuYWJsZWQnKSkgeyByZXR1cm47IH1cbiAgICB2YXIgcG9zID0gby5saW5lLmdlbm9saW5lKCdnZXRQb3MnKSxcbiAgICAgIHpvb20gPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3pvb20nKSxcbiAgICAgIGF2YWlsV2lkdGggPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2xpbmVXaWR0aCcpLFxuICAgICAgYWxsVGlsZXNOZWVkZWQgPSBbXSxcbiAgICAgIHByZXZUb3AgPSB0aGlzLl9icHBwcyAmJiB0aGlzLl9icHBwcy50b3AsXG4gICAgICBicHBwcyA9IHRoaXMuYnBwcHMoZm9yY2VSZXBvcyksXG4gICAgICAkbm90TmVlZGVkO1xuICAgIF8uZWFjaChicHBwcy5uZWFyZXN0LCBmdW5jdGlvbihicHBwLCBpKSB7XG4gICAgICB2YXIgYnBQZXJUaWxlID0gby50aWxlV2lkdGggKiBicHBwLFxuICAgICAgICB0aWxlSWQgPSBmbG9vckhhY2soKHBvcyAtIGF2YWlsV2lkdGggKiBicHBwICogKGJwcHBzLmNhY2hlW2ldID8gMCA6IDEpKSAvIGJwUGVyVGlsZSkgKiBicFBlclRpbGUgKyAxLFxuICAgICAgICB0aWxlc05lZWRlZCA9IFt0aWxlSWRdLFxuICAgICAgICByaWdodE1hcmdpbiA9IHBvcyArIChicHBwcy5jYWNoZVtpXSA/IDEgOiAyKSAqIGF2YWlsV2lkdGggKiBicHBwLFxuICAgICAgICBiZXN0RGVuc2l0eSA9IHNlbGYuX2Jlc3REZW5zaXR5KGJwcHApO1xuICAgICAgd2hpbGUgKCh0aWxlSWQgKz0gYnBQZXJUaWxlKSA8IHJpZ2h0TWFyZ2luKSB7IHRpbGVzTmVlZGVkLnB1c2godGlsZUlkKTsgfVxuICAgICAgXy5lYWNoKHRpbGVzTmVlZGVkLCBmdW5jdGlvbih0aWxlSWQpIHtcbiAgICAgICAgdmFyIHJlcG9zID0gZmFsc2UsICR0ID0gJCgnIycgKyBzZWxmLl90aWxlSWQodGlsZUlkLCBicHBwKSk7XG4gICAgICAgIGlmICghJHQubGVuZ3RoKSB7IFxuICAgICAgICAgICR0ID0gc2VsZi5fYWRkVGlsZSh0aWxlSWQsIGJwcHAsIGJlc3REZW5zaXR5LCBicHBwcy5jYWNoZVtpXSk7IFxuICAgICAgICAgIHJlcG9zID0gdHJ1ZTsgXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFicHBwcy5jYWNoZVtpXSkgeyBzZWxmLl9zaG93VGlsZSgkdCk7IH1cbiAgICAgICAgaWYgKHJlcG9zIHx8IGZvcmNlUmVwb3MpIHsgc2VsZi5fcmVwb3NUaWxlKCR0LCB0aWxlSWQsIHpvb20sIGJwcHApOyB9XG4gICAgICAgIGFsbFRpbGVzTmVlZGVkLnB1c2goJHQuZ2V0KDApKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgICRub3ROZWVkZWQgPSAkZWxlbS5jaGlsZHJlbignLnRpbGUnKS5ub3QoYWxsVGlsZXNOZWVkZWQpO1xuICAgIHNlbGYudGlsZUxvYWRDb3VudGVyIC09ICRub3ROZWVkZWQuY2hpbGRyZW4oJy5sb2FkaW5nJykubGVuZ3RoO1xuICAgICRub3ROZWVkZWQucmVtb3ZlKCk7XG4gICAgaWYgKHByZXZUb3AgJiYgcHJldlRvcCAhPSBicHBwcy50b3ApIHsgc2VsZi51cGRhdGVEZW5zaXR5KCk7IH1cbiAgICB0aGlzLl9maXhMYWJlbHMoZm9yY2VSZXBvcyk7XG4gICAgdGhpcy5fZml4U2lkZUNsaXBwZWQoKTtcbiAgfSxcbiAgXG4gIF9zZXRJbWdEaW1zOiBmdW5jdGlvbihlKSB7XG4gICAgLy8gTk9URTogdGhpcyBpcyBvbmx5IHVzZWQgYXMgYm91bmQgdG8gYSB0aWxlIDxpbWc+J3Mgb25Mb2FkISBTZWUgX2FkZFRpbGVcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBoID0gdGhpcy5uYXR1cmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuLy8gICAgICBpZiAodGhpcy5uYXR1cmFsSGVpZ2h0ID09IDEpIHsgXy5kZWZlcihmdW5jdGlvbigpIHsgY29uc29sZS5sb2coc2VsZi5uYXR1cmFsSGVpZ2h0KTsgfSkgfSAvLyBGSVhNRTogdGhpcyBpcyBzb21ldGltZXMgZXJyb25lb3VzbHkgMXB4XG4gICAgJCh0aGlzKS5jc3MoJ2hlaWdodCcsIGgpLmNzcygnd2lkdGgnLCAnMTAwJScpO1xuICB9LFxuICBcbiAgX3RyYWNrTG9hZEZpcmU6IGZ1bmN0aW9uKGUpIHtcbiAgICAvLyBOT1RFOiB0aGlzIGlzIG9ubHkgdXNlZCBhcyBib3VuZCB0byBhIHRpbGUgPGltZz4ncyBvbkxvYWQhIFNlZSBfYWRkVGlsZVxuICAgIHZhciBzZWxmID0gZS5kYXRhLnNlbGYsXG4gICAgICB0cmFja0ggPSBzZWxmLm9wdGlvbnMudHJhY2suaCxcbiAgICAgICR0ID0gZS5kYXRhLnRpbGUsXG4gICAgICBoID0gdGhpcy5uYXR1cmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcbiAgICBpZiAoZS5kYXRhLmlzQmVzdCAmJiBlLnR5cGUgIT0gJ2Vycm9yJykgeyBcbiAgICAgICR0LmFkZENsYXNzKCd0aWxlLWxvYWRlZCcpO1xuICAgICAgaWYgKGggPiB0cmFja0gpIHsgJHQuYWRkQ2xhc3MoJ2NsaXBwZWQnKTsgfVxuICAgICAgaWYgKCFlLmRhdGEuY2FjaGVkKSB7IHNlbGYuX3Nob3dUaWxlKCR0KTsgfVxuICAgIH1cbiAgICAvLyBlLmRhdGEuc2VsZi5hdmFpbERlbnNpdGllc1ticHBwXSA9IF8ud2l0aG91dChkZW5zaXRpZXMsIGRlbnNpdHkpOyAvLyBGSVhNRSwgaG93IHRvIGtub2NrIG91dCB0cmFja3MgdGhhdCBkb24ndCBsb2FkP1xuICAgIGlmICgtLXNlbGYudGlsZUxvYWRDb3VudGVyID09PSAwKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKCd0cmFja2xvYWQnLCBzZWxmLmJwcHBzKCkpOyB9O1xuICB9LFxuICBcbiAgX2FkZFRpbGU6IGZ1bmN0aW9uKHRpbGVJZCwgYnBwcCwgYmVzdERlbnNpdHksIGNhY2hlZCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgICRkID0gJC5taygnZGl2JykuYXR0cignY2xhc3MnLCAndGlsZScpLFxuICAgICAgYnBQZXJUaWxlID0gby50aWxlV2lkdGggKiBicHBwLFxuICAgICAgc3BlY2lhbCA9IHNlbGYuX3NwZWNpYWxUaWxlKHRpbGVJZCwgYnBwcCksXG4gICAgICBkZW5zaXRpZXMgPSBzZWxmLmF2YWlsRGVuc2l0aWVzW2JwcHBdLFxuICAgICAgJHRpbGVCZWZvcmUgPSAkKCcjJyArIHNlbGYuX3RpbGVJZCh0aWxlSWQgLSBicFBlclRpbGUsIGJwcHApKTtcbiAgICBpZiAoJHRpbGVCZWZvcmUubGVuZ3RoKSB7ICRkLmluc2VydEFmdGVyKCR0aWxlQmVmb3JlKTsgfVxuICAgIGVsc2UgeyAkZC5wcmVwZW5kVG8oc2VsZi5lbGVtZW50KSB9O1xuICAgICRkLmF0dHIoJ2lkJywgc2VsZi5fdGlsZUlkKHRpbGVJZCwgYnBwcCkpLmRhdGEoe3pJbmRleDogXy5pbmRleE9mKHNlbGYuc2xpZGVyQnBwcHMsIGJwcHApLCB0aWxlSWQ6IHRpbGVJZH0pO1xuICAgIGlmICgkLnN1cHBvcnQudG91Y2gpIHsgc2VsZi5fdGlsZVRvdWNoRXZlbnRzKCRkKTsgfVxuICAgIGVsc2UgeyAkZC5tb3VzZW1vdmUoe3NlbGY6IHNlbGZ9LCBzZWxmLl90aWxlTW91c2VNb3ZlKS5tb3VzZW91dCh7c2VsZjogc2VsZn0sIHNlbGYuX3RpbGVNb3VzZU91dCk7IH1cbiAgICBpZiAoc3BlY2lhbCkge1xuICAgICAgaWYgKHNwZWNpYWwuYmxhbmspIHsgJGQuYWRkQ2xhc3MoJ3RpbGUtYmxhbmsnKS5hZGRDbGFzcygndGlsZS1vZmYtJyArIChzcGVjaWFsLmxlZnQgPyAnbCcgOiAncicpKTsgfVxuICAgICAgZWxzZSBpZiAoc3BlY2lhbC5jdXN0b20pIHsgc2VsZi5fY3VzdG9tVGlsZSgkZCwgdGlsZUlkLCBicHBwLCBiZXN0RGVuc2l0eSk7IH1cbiAgICAgIGVsc2UgeyBzZWxmLl9ydWxlclRpbGUoJGQsIHRpbGVJZCwgYnBwcCk7IH0gLy8gc3BlY2lhbC5ydWxlciA9PT0gdHJ1ZVxuICAgICAgcmV0dXJuICRkO1xuICAgIH1cbiAgICAkZC5hZGRDbGFzcygndGlsZS1mdWxsIGJwcHAtJytjbGFzc0ZyaWVuZGx5KGJwcHApKTtcbiAgICBfLmVhY2goZGVuc2l0aWVzLCBmdW5jdGlvbihkZW5zaXR5KSB7XG4gICAgICB2YXIgdGlsZVNyYyA9IHNlbGYuX3RpbGVTcmModGlsZUlkLCBicHBwLCBkZW5zaXR5KSwgXG4gICAgICAgIGZpeGVkSGVpZ2h0ID0gby50cmFjay5maFt0aWxlU3JjLmJwcHBGb3JtYXRdICYmIG8udHJhY2suZmhbdGlsZVNyYy5icHBwRm9ybWF0XVtkZW5zaXR5XSxcbiAgICAgICAgJGk7XG4gICAgICBpZiAoZml4ZWRIZWlnaHQpIHtcbiAgICAgICAgJGkgPSAkLm1rKCdpbWcnKS5hZGRDbGFzcygndGRhdGEgbG9hZGluZyBkZW5zLScrZGVuc2l0eSkuY3NzKCd3aWR0aCcsICcxMDAlJykuY3NzKCdoZWlnaHQnLCBmaXhlZEhlaWdodCk7XG4gICAgICAgICRkLmFwcGVuZCgkaSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkaSA9ICQubWsoJ2ltZycpLmFkZENsYXNzKCd0ZGF0YSBsb2FkaW5nIGRlbnMtJytkZW5zaXR5KS5iaW5kKCdsb2FkJywgc2VsZi5fc2V0SW1nRGltcyk7XG4gICAgICAgICRkLmFwcGVuZCgkaSk7XG4gICAgICB9XG4gICAgICBzZWxmLnRpbGVMb2FkQ291bnRlcisrO1xuICAgICAgJGkuYmluZCgnbG9hZCBlcnJvcicsIHtzZWxmOiBzZWxmLCB0aWxlOiAkZCwgaXNCZXN0OiBkZW5zaXR5PT1iZXN0RGVuc2l0eSwgY2FjaGVkOiBjYWNoZWR9LCBzZWxmLl90cmFja0xvYWRGaXJlKTtcbiAgICAgICRpLnRvZ2dsZUNsYXNzKCdkZW5zLWJlc3QnLCBkZW5zaXR5ID09IGJlc3REZW5zaXR5KTtcbiAgICAgIGlmIChvLnRyYWNrLm0gJiYgXy5pbmNsdWRlKG8udHJhY2subSwgZGVuc2l0eSkpIHsgJGkuYWRkQ2xhc3MoJ25vLWFyZWFzJyk7IH1cbiAgICAgIFxuICAgICAgJGkuYXR0cignc3JjJywgby50aWxlRGlyICsgdGlsZVNyYy5mdWxsKTtcbiAgICB9KTtcbiAgICByZXR1cm4gJGQ7XG4gIH0sXG4gIFxuICAvLyBTaG93cyBvcmFuZ2UgY2xpcHBpbmcgaW5kaWNhdG9ycyBpZiBhbnkgb2YgdGhlIGJlc3QgZGVuc2l0eSB0aWxlcyBoYXZlIGRhdGEgY3V0IG9mZiBhdCB0aGUgYm90dG9tXG4gIGZpeENsaXBwZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciAkZWxlbSA9IHRoaXMuZWxlbWVudCxcbiAgICAgIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICBzaWRlQ2xpcHBlZCA9IGZhbHNlO1xuICAgICRlbGVtLmZpbmQoJy50aWxlLWZ1bGwnKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyICR0ID0gJCh0aGlzKSxcbiAgICAgICAgYmVzdCA9ICR0LmNoaWxkcmVuKCcudGRhdGEuZGVucy1iZXN0Om5vdCgubG9hZGluZyk6bm90KC5zdHJldGNoLWhlaWdodCknKS5nZXQoMCksXG4gICAgICAgIGggPSBiZXN0ICYmIChiZXN0Lm5hdHVyYWxIZWlnaHQgfHwgYmVzdC5oZWlnaHQpIHx8IDAsXG4gICAgICAgIGNsaXBwZWQgPSBoID4gby50cmFjay5oO1xuICAgICAgJHQudG9nZ2xlQ2xhc3MoJ2NsaXBwZWQnLCBjbGlwcGVkKTtcbiAgICB9KTtcbiAgICB0aGlzLl9maXhTaWRlQ2xpcHBlZCgpO1xuICB9LFxuICBcbiAgX2ZpeFNpZGVDbGlwcGVkOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgYnBwcHMgPSB0aGlzLmJwcHBzKCksXG4gICAgICBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgcG9zID0gby5saW5lLmdlbm9saW5lKCdnZXRQb3MnKSxcbiAgICAgIHpvb20gPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ3pvb20nKSxcbiAgICAgIGJwV2lkdGggPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2JwV2lkdGgnKSxcbiAgICAgIHRpbGVCcFdpZHRoID0gYnBwcHMudG9wICogby50aWxlV2lkdGgsXG4gICAgICBjbGlwcGVkID0gZmFsc2U7XG4gICAgdGhpcy5lbGVtZW50LmNoaWxkcmVuKCcuY2xpcHBlZC5icHBwLScrY2xhc3NGcmllbmRseShicHBwcy50b3ApKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHRpbGVJZCA9ICQodGhpcykuZGF0YSgndGlsZUlkJyk7XG4gICAgICBpZiAodGlsZUlkID4gcG9zIC0gdGlsZUJwV2lkdGggJiYgdGlsZUlkIDwgcG9zICsgYnBXaWR0aCkgeyBjbGlwcGVkID0gdHJ1ZTsgcmV0dXJuIGZhbHNlOyB9XG4gICAgfSk7XG4gICAgdGhpcy4kc2lkZS50b2dnbGVDbGFzcygnY2xpcHBlZCcsIGNsaXBwZWQpO1xuICB9LFxuICBcbiAgX3RpbGVUb3VjaEV2ZW50czogZnVuY3Rpb24oJHRpbGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgJHRpbGUuYmluZCgndG91Y2hzdGFydCcsIHtzZWxmOiBzZWxmfSwgZnVuY3Rpb24oZSkge1xuICAgICAgaWYgKGUub3JpZ2luYWxFdmVudC50b3VjaGVzLmxlbmd0aCA+IDEpIHsgcmV0dXJuOyB9XG4gICAgICBlLnBhZ2VYID0gZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVg7XG4gICAgICBlLnBhZ2VZID0gZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVk7XG4gICAgICBzZWxmLl90aWxlTW91c2VNb3ZlLmNhbGwodGhpcywgZSk7XG4gICAgfSk7XG4gIH0sXG4gIFxuICBfdGlsZU1vdXNlTW92ZTogZnVuY3Rpb24oZSkge1xuICAgIHZhciAkdGFyZyA9ICQoZS50YXJnZXQpLFxuICAgICAgJHRkYXRhID0gJHRhcmcuY2xvc2VzdCgnLnRkYXRhJyksXG4gICAgICBzZWxmID0gZS5kYXRhLnNlbGYsXG4gICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgcHJldiA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignYXJlYUhvdmVyJyksXG4gICAgICBhcmVhcywgcmF0aW8sIGJwcHA7XG4gICAgaWYgKCEkdGRhdGEubGVuZ3RoIHx8ICEkdGRhdGEuaGFzQ2xhc3MoJ2RlbnMtYmVzdCcpIHx8ICEoYXJlYXMgPSAkdGRhdGEuZGF0YSgnYXJlYXMnKSkpIHtcbiAgICAgIGlmICghJHRhcmcuaXMoJy5hcmVhJykpIHsgby5icm93c2VyLmdlbm9icm93c2VyKCdhcmVhSG92ZXInLCBmYWxzZSk7IH1cbiAgICAgIHJldHVybjsgXG4gICAgfVxuICAgIGJwcHAgPSAkdGRhdGEuZGF0YSgnYnBwcCcpO1xuICAgIHJhdGlvID0gYnBwcCAvIG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignem9vbScpO1xuICAgIHZhciBvZmZzZXQgPSAkKHRoaXMpLm9mZnNldCgpLFxuICAgICAgeCA9IGUucGFnZVggLSBvZmZzZXQubGVmdCxcbiAgICAgIHkgPSBlLnBhZ2VZIC0gb2Zmc2V0LnRvcDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZWFzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgdiA9IGFyZWFzW2ldLCBhcmVhSWQ7XG4gICAgICBpZiAoeCA+IHZbMF0gKiByYXRpbyAmJiB4IDwgdlsyXSAqIHJhdGlvICYmIHkgPiB2WzFdICYmIHkgPCB2WzNdKSB7XG4gICAgICAgIGlmIChvLnRyYWNrLm4gKyAnLmhyZWZIYXNoLicgKyB2LmhyZWZIYXNoICE9PSBwcmV2KSB7XG4gICAgICAgICAgYXJlYUlkID0gJCh0aGlzKS5hdHRyKCdpZCcpICsgJy4nICsgaTtcbiAgICAgICAgICBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2FyZWFIb3ZlcicsIFtvLnRyYWNrLm4sIGJwcHAsICR0ZGF0YS5kYXRhKCdkZW5zaXR5JyksICdocmVmSGFzaCcsIHYuaHJlZkhhc2hdLCBhcmVhSWQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCEkdGFyZy5pcygnLmFyZWEnKSkgeyBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2FyZWFIb3ZlcicsIGZhbHNlKTsgfVxuICAgIHJldHVybjtcbiAgfSxcbiAgXG4gIF90aWxlTW91c2VPdXQ6IGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgJHRhcmcgPSAkKGUudGFyZ2V0KSxcbiAgICAgICR0ZGF0YSA9ICR0YXJnLmNsb3Nlc3QoJy50ZGF0YScpLFxuICAgICAgc2VsZiA9IGUuZGF0YS5zZWxmLFxuICAgICAgJHJlbFRhcmdldCA9ICQoZS5yZWxhdGVkVGFyZ2V0KTtcbiAgICBpZiAoISR0ZGF0YS5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgaWYgKCEkcmVsVGFyZ2V0LmlzKCcudGlsZScpICYmICEkcmVsVGFyZ2V0LmNsb3Nlc3QoJy50aWxlJykubGVuZ3RoKSB7IHNlbGYub3B0aW9ucy5icm93c2VyLmdlbm9icm93c2VyKCdhcmVhSG92ZXInLCBmYWxzZSk7IH1cbiAgfSxcbiAgXG4gIF9hcmVhTW91c2VPdmVyOiBmdW5jdGlvbihlKSB7XG4gICAgdmFyIGQgPSBlLmRhdGEsXG4gICAgICBvID0gZC5zZWxmLm9wdGlvbnM7XG4gICAgby5icm93c2VyLmdlbm9icm93c2VyKCdhcmVhSG92ZXInLCBbby50cmFjay5uLCBkLmJwcHAsIGQuZGVuc2l0eSwgJ2hyZWZIYXNoJywgZC5ocmVmSGFzaF0sIGQuYXJlYUlkKTtcbiAgfSxcbiAgXG4gIGZpeENsaWNrQXJlYXM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCxcbiAgICAgIG5lYXJlc3QgPSB0aGlzLmJwcHBzKCkubmVhcmVzdCxcbiAgICAgIGRlbnNpdHlPcmRlciA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignZGVuc2l0eU9yZGVyJywgby50cmFjay5uKTtcbiAgICBpZiAoIW8udHJhY2subSB8fCAhby50cmFjay5tLmxlbmd0aCkgeyByZXR1cm47IH1cbiAgICBfLmVhY2goby50cmFjay5tLCBmdW5jdGlvbihkZW5zaXR5KSB7XG4gICAgICBfLmVhY2gobmVhcmVzdCwgZnVuY3Rpb24oYnBwcCkge1xuICAgICAgICB2YXIgZGVuc2l0aWVzID0gc2VsZi5hdmFpbERlbnNpdGllc1ticHBwXSxcbiAgICAgICAgICBiZXN0RGVuc2l0eSA9IHNlbGYuX2Jlc3REZW5zaXR5KGJwcHApO1xuICAgICAgICBpZiAoIV8uaW5jbHVkZShkZW5zaXRpZXMsIGRlbnNpdHkpKSB7IHJldHVybjsgfVxuICAgICAgICAkZWxlbS5maW5kKCcuYnBwcC0nK2NsYXNzRnJpZW5kbHkoYnBwcCkrJyAudGRhdGEuZGVucy0nK2RlbnNpdHkrJy5uby1hcmVhcycpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICBzZWxmLl9hZGRDbGlja2FibGVBcmVhcyh0aGlzLCBicHBwLCBkZW5zaXR5LCBiZXN0RGVuc2l0eSk7XG4gICAgICAgIH0pLnJlbW92ZUNsYXNzKCduby1hcmVhcycpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG4gIFxuICBfYXJlYVRpcFRpcEVudGVyOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgIHZhciBzZWxmID0gJCh0aGlzKS5kYXRhKCdnZW5vdHJhY2snKSxcbiAgICAgIGhyZWYgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKSxcbiAgICAgIHRpcHRpcERhdGEgPSAkKHRoaXMpLmRhdGEoJ3RpcHRpcERhdGEnKSxcbiAgICAgIG9sZFRpdGxlID0gJCh0aGlzKS5kYXRhKCd0aXRsZScpO1xuICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ2RyYWdnaW5nJykpIHsgcmV0dXJuIGNhbGxiYWNrKGZhbHNlKTsgfVxuICAgIGZ1bmN0aW9uIGNyZWF0ZVRpcFRpcEh0bWwoZGF0YSkge1xuICAgICAgdmFyICR0aXBUaXBEaXYgPSAkKCc8ZGl2Lz4nKSxcbiAgICAgICAgJG5hbWUgPSAkKCc8ZGl2IGNsYXNzPVwibmFtZVwiLz4nKS5hcHBlbmRUbygkdGlwVGlwRGl2KSxcbiAgICAgICAgJHRhYmxlID0gJCgnPHRhYmxlLz4nKS5hcHBlbmRUbygkdGlwVGlwRGl2KSxcbiAgICAgICAgJHRib2R5ID0gJCgnPHRib2R5Lz4nKS5hcHBlbmRUbygkdGFibGUpLFxuICAgICAgICAkcHJldkRlc2NUcjtcbiAgICAgIF8uZWFjaChkYXRhLCBmdW5jdGlvbih2LCBrKSB7XG4gICAgICAgIHZhciAkdHI7XG4gICAgICAgIGlmICgvXmRlc2NyaXB0aW9uJHxedHlwZSR8cmVmc2VxIHN1bW1hcnkvaS50ZXN0KGspKSB7XG4gICAgICAgICAgJHByZXZEZXNjVHIgPSAkdGJvZHkuY2hpbGRyZW4oJy5kZXNjJyk7XG4gICAgICAgICAgaWYgKCRwcmV2RGVzY1RyLmxlbmd0aCkgeyAkdHIgPSAkKCc8dHIgY2xhc3M9XCJkZXNjXCIvPicpLmluc2VydEFmdGVyKCRwcmV2RGVzY1RyKTsgfVxuICAgICAgICAgIGVsc2UgeyAkdHIgPSAkKCc8dHIgY2xhc3M9XCJkZXNjXCIvPicpLnByZXBlbmRUbygkdGJvZHkpOyB9XG4gICAgICAgICAgaWYgKHYubGVuZ3RoID4gMzAwKSB7IHYgPSB2LnN1YnN0cigwLCAzMDApLnJlcGxhY2UoL1xccytcXFMrJC8sICcnKSArICcuLi4nOyB9XG4gICAgICAgICAgJCgnPHRkIGNvbHNwYW49XCIyXCIvPicpLnRleHQodikuYXBwZW5kVG8oJHRyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkdHIgPSAkKCc8dHIvPicpLmFwcGVuZFRvKCR0Ym9keSk7XG4gICAgICAgICAgaWYgKHYgPT0gJy0tLScpIHtcbiAgICAgICAgICAgICQoJzx0ZCBjb2xzcGFuPVwiMlwiIGNsYXNzPVwiZmllbGRzLWhlYWRlclwiLz4nKS50ZXh0KGspLmFwcGVuZFRvKCR0cik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoJzx0ZCBjbGFzcz1cImZpZWxkXCIgd2lkdGg9XCI0NSVcIi8+JykudGV4dChrKS5hcHBlbmRUbygkdHIpO1xuICAgICAgICAgICAgJCgnPHRkIGNsYXNzPVwidmFsdWVcIiB3aWR0aD1cIjU1JVwiLz4nKS50ZXh0KHYpLmFwcGVuZFRvKCR0cik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmIChvbGRUaXRsZSkgeyAkbmFtZS50ZXh0KG9sZFRpdGxlKTsgfVxuICAgICAgY2FsbGJhY2soJHRpcFRpcERpdik7XG4gICAgfVxuICAgIGlmICh0aXB0aXBEYXRhKSB7XG4gICAgICBjcmVhdGVUaXBUaXBIdG1sKHRpcHRpcERhdGEpO1xuICAgIH0gZWxzZSBpZiAoL15odHRwcz86XFwvXFwvLy50ZXN0KGhyZWYpKSB7XG4gICAgICAkLmFqYXgoc2VsZi5vcHRpb25zLmFqYXhEaXIgKyAndG9vbHRpcC5waHAnLCB7XG4gICAgICAgIGRhdGE6IHt1cmw6IGhyZWZ9LFxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICBzdWNjZXNzOiBjcmVhdGVUaXBUaXBIdG1sXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIFxuICBtYWtlQW5jaG9yOiBmdW5jdGlvbigkdGlsZSwgYXJlYSwgYnBwcCwgZGVuc2l0eSwgZmxhZ3MpIHtcbiAgICB2YXIgYmVzdERlbnNpdHkgPSB0aGlzLl9iZXN0RGVuc2l0eShicHBwKSxcbiAgICAgIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICBjdXN0b20gPSBvLnRyYWNrLmN1c3RvbSxcbiAgICAgIGRlZmF1bHRDb2xvciA9IChjdXN0b20gJiYgY3VzdG9tLm9wdHMuY29sb3IpIHx8ICcwLDAsMCcsXG4gICAgICB0aXBUaXBPcHRpb25zID0ge1xuICAgICAgICBhc3luYzogdHJ1ZSwgZGVsYXk6IDQwMCxcbiAgICAgICAgZW50ZXI6IHRoaXMuX2FyZWFUaXBUaXBFbnRlclxuICAgICAgfSxcbiAgICAgIGhhc2ggPSBzaG9ydEhhc2goYXJlYVs1XSksXG4gICAgICBzY2FsZVRvUGN0ID0gMTAwIC8gby50aWxlV2lkdGgsXG4gICAgICAkYSA9ICQubWsoJ2EnKS5hZGRDbGFzcygnYXJlYSBkZW5zLScrZGVuc2l0eSsnIGhyZWYtaGFzaC0nK2hhc2gpLmF0dHIoJ3RpdGxlJywgYXJlYVs0XSk7XG4gICAgJGEuYXR0cignaHJlZicsIChjdXN0b20gPyAnJyA6IHRoaXMuYmFzZVVSTCkgKyBhcmVhWzVdKS5hdHRyKCd0YXJnZXQnLCAnX2JsYW5rJyk7XG4gICAgJGEuY3NzKHt0b3A6IGFyZWFbMV0sIGhlaWdodDogYXJlYVszXSAtIGFyZWFbMV0gLSAyfSk7XG4gICAgaWYgKGZsYWdzLmxhYmVsKSB7IFxuICAgICAgJGEuY3NzKHtyaWdodDogKDEwMCAtIGFyZWFbMF0gKiBzY2FsZVRvUGN0KSArICclJywgY29sb3I6ICdyZ2IoJyArIChhcmVhWzddIHx8IGRlZmF1bHRDb2xvcikgKyAnKSd9KS5hZGRDbGFzcygnbGFiZWwnKTtcbiAgICAgIGlmIChhcmVhWzhdKSB7ICRhLmh0bWwoYXJlYVs4XSkgfSBlbHNlIHsgJGEudGV4dChhcmVhWzRdKTsgfVxuICAgICAgJGEubW91c2VvdmVyKHtzZWxmOiB0aGlzLCBicHBwOiBicHBwLCBkZW5zaXR5OiBkZW5zaXR5LCBocmVmSGFzaDogaGFzaCwgYXJlYUlkOiAkdGlsZS5hdHRyKCdpZCcpICsgJy4nICsgZmxhZ3MuaX0sIHRoaXMuX2FyZWFNb3VzZU92ZXIpO1xuICAgIH0gZWxzZSB7IFxuICAgICAgJGEuYWRkQ2xhc3MoJ3JlY3QnKS5jc3Moe2xlZnQ6IChhcmVhWzBdICogc2NhbGVUb1BjdCkgKyAnJScsIHdpZHRoOiAoKGFyZWFbMl0gLSBhcmVhWzBdKSAqIHNjYWxlVG9QY3QpICsgJyUnfSk7XG4gICAgICBpZiAoZmxhZ3MuZmxhc2htZSkge1xuICAgICAgICAkYS5hZGRDbGFzcygnZmxhc2hpbmcnKS5lZmZlY3QoXCJwdWxzYXRlXCIsIHt0aW1lczogMn0sIDEwMDAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICQodGhpcykuZmFkZU91dCgzMDAsIGZ1bmN0aW9uKCkgeyAkKHRoaXMpLnJlbW92ZUNsYXNzKCdmbGFzaGluZycpOyB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoZmxhZ3MuaG92ZXIpIHsgJGEuYWRkQ2xhc3MoJ2hvdmVyJyk7IH1cbiAgICAgIGlmIChmbGFncy50aXBUaXBBY3RpdmF0ZWQpIHsgdGlwVGlwT3B0aW9ucy5zdGFydEFjdGl2YXRlZCA9IHRydWU7IH1cbiAgICB9XG4gICAgJGEuZGF0YSgnZ2Vub3RyYWNrJywgdGhpcykudGlwVGlwKHRpcFRpcE9wdGlvbnMpO1xuICAgIGlmIChhcmVhWzldKSB7ICRhLmRhdGEoJ3RpcHRpcERhdGEnLCBhcmVhWzldKTsgfVxuICAgIHJldHVybiAkYS5kYXRhKCdocmVmSGFzaCcsIGhhc2gpLnRvZ2dsZUNsYXNzKCdkZW5zLWJlc3QnLCBkZW5zaXR5ID09IGJlc3REZW5zaXR5KS5hcHBlbmRUbygkdGlsZSk7XG4gIH0sXG4gIFxuICBfYXJlYURhdGFGZXRjaDogZnVuY3Rpb24oZSkge1xuICAgICQuYWpheChlLmRhdGEuc3JjICsgJy5qc29uJywge1xuICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgIHN1Y2Nlc3M6IGUuZGF0YS5zdWNjZXNzLFxuICAgICAgYmVmb3JlU2VuZDogZS5kYXRhLmJlZm9yZVNlbmRcbiAgICB9KTtcbiAgfSxcbiAgXG4gIF9hcmVhRGF0YUxvYWQ6IGZ1bmN0aW9uKGRhdGEsIHN0YXR1c1RleHQsIGpxWEhSKSB7XG4gICAgLy8gTk9URTogdGhpcyBpcyB1c2VkIGFzIGFuIEFKQVggY2FsbGJhY2ssIHNvIHRoaXMvc2VsZiBtdXN0IGJlIHJlb2J0YWluZWQgZnJvbSB0aGUganFYSFIgb2JqZWN0XG4gICAgdmFyIG8gPSBqcVhIUi5fc2VsZi5vcHRpb25zLFxuICAgICAgJHRpbGUgPSAkKGpxWEhSLl9hcHBlbmRUbyksXG4gICAgICB0aWxlSWQgPSAkdGlsZS5hdHRyKCdpZCcpLFxuICAgICAgJHRkYXRhID0gJHRpbGUuY2hpbGRyZW4oJy50ZGF0YS5kZW5zLScranFYSFIuX2RlbnNpdHkpO1xuICAgIFxuICAgIGZ1bmN0aW9uIGNyZWF0ZUFyZWFzKGUpIHtcbiAgICAgIF8uZWFjaCgkdGRhdGEuZGF0YSgnYXJlYXMnKSwgZnVuY3Rpb24odiwgaSkge1xuICAgICAgICAvLyBXZSBoYXZlIHRvIG1ha2UgdGhlIGxhYmVsIDxhPidzIGZvciBjdXN0b20gdHJhY2tzXG4gICAgICAgIGlmIChqcVhIUi5fY3VzdG9tICYmICF2WzZdKSB7XG4gICAgICAgICAganFYSFIuX3NlbGYubWFrZUFuY2hvcigkdGlsZSwgdiwganFYSFIuX2JwcHAsIGpxWEhSLl9kZW5zaXR5LCB7bGFiZWw6ICFqcVhIUi5fY3VzdG9tLm5vQXJlYUxhYmVscywgaTogaX0pOyBcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICBcbiAgICAvLyBBcmVhcyBhcmUgc3RvcmVkIGluIGEgZ2xvYmFsIGluZGV4LCBzbyB0aGF0IG1vdXNpbmcgb3ZlciBhbiBhcmVhIGluIG9uZSB0aWxlIGNhbiByZXRyaWV2ZVxuICAgIC8vIGFyZWFzIHdpdGggYSBzaW1pbGFyIG5hbWUvaHJlZkhhc2ggdGhhdCBtdXN0IGFsc28gYmUgaGlnaGxpZ2h0ZWQuIFxuICAgIC8vIFNlZSAkLnVpLmdlbm9icm93c2VyJ3MgLmFyZWFIb3ZlcigpIGZvciBob3cgaXQgaXMgdHJhdmVyc2VkIGR1cmluZyBtb3VzZW92ZXIuXG4gICAgLy8gQWRkIHRvIGdsb2JhbCBhcmVhIGluZGV4OiBhcmVhSW5kZXhbdHJhY2tdW2JwcHBdW2RlbnNpdHldW1wiaHJlZkhhc2hcInxcIm5hbWVcIl1baHJlZkhhc2h8bmFtZV1bdGlsZUlkXVtpXSA9IHRydWVcbiAgICAvLyBGSVhNRTogdGhlIGdsb2JhbCBhcmVhIGluZGV4IGNhbiBnZXQgdmVyeSBiaWcgb3ZlciB0aW1lOyBhcyBvZiBub3csIGl0IGlzIG5ldmVyIHBydW5lZC5cbiAgICBfLmVhY2goZGF0YSwgZnVuY3Rpb24odiwgaSkge1xuICAgICAgdmFyIGluZGV4ID0ganFYSFIuX2FyZWFJbmRleCxcbiAgICAgICAga2V5cyA9IFtvLnRyYWNrLm4sIGpxWEhSLl9icHBwLCBqcVhIUi5fZGVuc2l0eV0sXG4gICAgICAgIGluZGV4QnkgPSB7aHJlZkhhc2g6IHNob3J0SGFzaCh2WzVdIHx8ICcnKSwgbmFtZTogKHZbNF0gfHwgJycpLnRvTG93ZXJDYXNlKCl9O1xuICAgICAgdi5ocmVmSGFzaCA9IGluZGV4QnkuaHJlZkhhc2g7XG4gICAgICBfLmVhY2goa2V5cywgZnVuY3Rpb24oaykge1xuICAgICAgICBpZiAoIWluZGV4W2tdKSB7IGluZGV4W2tdID0ge307IH1cbiAgICAgICAgaW5kZXggPSBpbmRleFtrXTtcbiAgICAgIH0pO1xuICAgICAgaWYgKCFpbmRleC5ocmVmSGFzaCkgeyBpbmRleC5ocmVmSGFzaCA9IHt9OyBpbmRleC5uYW1lID0ge307IH1cbiAgICAgIF8uZWFjaChbJ2hyZWZIYXNoJywgJ25hbWUnXSwgZnVuY3Rpb24oYnkpIHtcbiAgICAgICAgdmFyIGtleSA9IGluZGV4QnlbYnldO1xuICAgICAgICBpZiAoIWluZGV4W2J5XVtrZXldKSB7IGluZGV4W2J5XVtrZXldID0ge307IH1cbiAgICAgICAgaWYgKCFpbmRleFtieV1ba2V5XVt0aWxlSWRdKSB7IGluZGV4W2J5XVtrZXldW3RpbGVJZF0gPSB7fTsgfVxuICAgICAgICBpbmRleFtieV1ba2V5XVt0aWxlSWRdW2ldID0gdHJ1ZTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgICR0ZGF0YS5kYXRhKCdhcmVhcycsIGRhdGEpLmRhdGEoJ2JwcHAnLCBqcVhIUi5fYnBwcCkuZGF0YSgnZGVuc2l0eScsIGpxWEhSLl9kZW5zaXR5KS5yZW1vdmVDbGFzcygnYXJlYXMtbG9hZGluZycpO1xuICAgIFxuICAgIGlmIChqcVhIUi5fY3VzdG9tKSB7XG4gICAgICAkdGRhdGEub25lKCdiZXN0RGVuc2l0eScsIGNyZWF0ZUFyZWFzKTtcbiAgICAgIGlmIChqcVhIUi5fZGVuc2l0eSA9PSBqcVhIUi5fYmVzdERlbnNpdHkpIHsgJHRkYXRhLnRyaWdnZXIoJ2Jlc3REZW5zaXR5Jyk7IH1cbiAgICB9XG4gICAgaWYgKC0tanFYSFIuX3NlbGYuYXJlYUxvYWRDb3VudGVyID09PSAwKSB7ICQoanFYSFIuX3NlbGYuZWxlbWVudCkudHJpZ2dlcignYXJlYWxvYWQnLCBqcVhIUi5fYmVzdERlbnNpdHkpOyB9O1xuICB9LFxuICBcbiAgX2FkZENsaWNrYWJsZUFyZWFzOiBmdW5jdGlvbih0ZGF0YUVsZW0sIGJwcHAsIGRlbnNpdHksIGJlc3REZW5zaXR5KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgIHRhZ05hbWUgPSB0ZGF0YUVsZW0udGFnTmFtZS50b0xvd2VyQ2FzZSgpLFxuICAgICAgJHRkYXRhID0gJCh0ZGF0YUVsZW0pLFxuICAgICAgYXJlYURhdGEsIGVkYXRhO1xuICAgIHNlbGYuYXJlYUxvYWRDb3VudGVyKys7XG4gICAgJHRkYXRhLmFkZENsYXNzKCdhcmVhcy1sb2FkaW5nJyk7XG4gICAgc2VsZi5iYXNlVVJMID0gc2VsZi5iYXNlVVJMIHx8IG8udWNzY1VSTC5yZXBsYWNlKC9bXlxcL10rJC8sICcnKTtcbiAgICBmdW5jdGlvbiBiZWZvcmVTZW5kKGpxWEhSKSB7IFxuICAgICAgJC5leHRlbmQoanFYSFIsIHtcbiAgICAgICAgX2FwcGVuZFRvOiB0ZGF0YUVsZW0ucGFyZW50Tm9kZSxcbiAgICAgICAgX3NlbGY6IHNlbGYsXG4gICAgICAgIF9icHBwOiBicHBwLFxuICAgICAgICBfYmVzdERlbnNpdHk6IGJlc3REZW5zaXR5LFxuICAgICAgICBfZGVuc2l0eTogZGVuc2l0eSxcbiAgICAgICAgX2FyZWFJbmRleDogby5icm93c2VyLmdlbm9icm93c2VyKCdhcmVhSW5kZXgnKVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIGlmICh0YWdOYW1lID09ICdpbWcnKSB7XG4gICAgICAvLyBUT0RPOiBtYWtlIHRoaXMgYWJvcnRhYmxlLCBmb3Igd2hlbiBmaXhUaWxlcyhmb3JjZVJlcG9zPXRydWUpIGlzIGNhbGxlZCBiZWZvcmUgaXQgZmluaXNoZXMhXG4gICAgICBlZGF0YSA9IHtzcmM6IHRkYXRhRWxlbS5zcmMsIHN1Y2Nlc3M6IHNlbGYuX2FyZWFEYXRhTG9hZCwgYmVmb3JlU2VuZDogYmVmb3JlU2VuZH07XG4gICAgICBpZiAoZGVuc2l0eT09YmVzdERlbnNpdHkpIHsgc2VsZi5fYXJlYURhdGFGZXRjaCh7ZGF0YTogZWRhdGF9KTsgfVxuICAgICAgZWxzZSB7ICR0ZGF0YS5vbmUoJ2Jlc3REZW5zaXR5JywgZWRhdGEsIHNlbGYuX2FyZWFEYXRhRmV0Y2gpOyB9XG4gICAgfSBlbHNlIGlmICh0YWdOYW1lID09ICdjYW52YXMnICYmIG8udHJhY2suY3VzdG9tLmFyZWFzICYmIChhcmVhRGF0YSA9IG8udHJhY2suY3VzdG9tLmFyZWFzW3RkYXRhRWxlbS5pZF0pKSB7XG4gICAgICAvLyBGb3IgPGNhbnZhcz4gdGlsZXMgb24gY3VzdG9tIHRyYWNrcywgd2Ugc2hvdWxkIGFscmVhZHkgaGF2ZSB0aGlzIGluZm8gaW4gby50cmFjay5jdXN0b20uYXJlYXNcbiAgICAgIG1vY2tKcVhIUiA9IHtfY3VzdG9tOiBvLnRyYWNrLmN1c3RvbX07XG4gICAgICBiZWZvcmVTZW5kKG1vY2tKcVhIUik7XG4gICAgICBzZWxmLl9hcmVhRGF0YUxvYWQoYXJlYURhdGEsICcnLCBtb2NrSnFYSFIpO1xuICAgIH0gZWxzZSB7IFxuICAgICAgc2VsZi5hcmVhTG9hZENvdW50ZXItLTtcbiAgICAgICQodGRhdGFFbGVtKS5yZW1vdmVDbGFzcygnYXJlYXMtbG9hZGluZycpO1xuICAgIH1cbiAgfSxcbiAgXG4gIF9zaG93VGlsZTogZnVuY3Rpb24oJHQpIHtcbiAgICAkdC5hZGRDbGFzcygndGlsZS1zaG93JykuY3NzKCd6LWluZGV4JywgJHQuZGF0YSgnekluZGV4JykpO1xuICB9LFxuICBcbiAgX3JlcG9zVGlsZTogZnVuY3Rpb24oJHRpbGUsIHRpbGVJZCwgem9vbSwgYnBwcCkge1xuICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgICR0aWxlLmNzcygnbGVmdCcsICh0aWxlSWQgLSBvLmxpbmUuZ2Vub2xpbmUoJ29wdGlvbicsICdvcmlnaW4nKSkgLyB6b29tKTtcbiAgICAkdGlsZS5jc3MoJ3dpZHRoJywgTWF0aC5jZWlsKG8udGlsZVdpZHRoICogYnBwcCAvIHpvb20pKTtcbiAgICBcbiAgICBpZiAodGhpcy5ydWxlciAmJiBicHBwIDw9IG8ubnRzQmVsb3dbMF0pIHtcbiAgICAgICR0aWxlLmZpbmQoJ3N2ZycpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB3aWR0aCA9ICR0aWxlLndpZHRoKCkgKyAncHgnO1xuICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwid2lkdGhcIiwgd2lkdGgpO1xuICAgICAgICB0aGlzLmZpcnN0Q2hpbGQuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJ5XCIsIFwiMTFcIik7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIFxuICBfc3BlY2lhbFRpbGU6IGZ1bmN0aW9uKHRpbGVJZCwgYnBwcCkge1xuICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgIGlmICh0aWxlSWQgPCAwIHx8IHRpbGVJZCA+IG8uZ2Vub21lU2l6ZSkgeyByZXR1cm4ge2JsYW5rOiB0cnVlLCBsZWZ0OiB0aWxlSWQgPCAwfTsgfVxuICAgIGlmIChvLnRyYWNrLmN1c3RvbSkgeyByZXR1cm4ge2N1c3RvbTogdHJ1ZX07IH1cbiAgICBpZiAodGhpcy5ydWxlciAmJiAoYnBwcCA8PSBvLmlkZW9ncmFtc0Fib3ZlIHx8ICFvLmNockJhbmRzKSkgeyByZXR1cm4ge3J1bGVyOiB0cnVlfTsgfVxuICB9LFxuICBcbiAgX3RpbGVTcmM6IGZ1bmN0aW9uKHRpbGVJZCwgYnBwcCwgZGVuc2l0eSkge1xuICAgIHZhciBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgYkYgPSB0aGlzLl9icHBwRm9ybWF0KGJwcHApLFxuICAgICAgaW1nTmFtZSA9IHBhZCh0aWxlSWQsIDEwKSArICcucG5nJztcbiAgICBpZiAoYnBwcCA8IG8uc3ViZGlyRm9yQnBwcHNVbmRlcikgeyBpbWdOYW1lID0gaW1nTmFtZS5zdWJzdHIoMCwgNCkgKyAnLycgKyBpbWdOYW1lLnN1YnN0cig0KTsgfVxuICAgIHZhciByZXQgPSB7XG4gICAgICBmdWxsOiB0aGlzLnJ1bGVyID8gJ2lkZW9ncmFtcy8nK2JGKycvJytpbWdOYW1lIDogby50cmFjay5uKycvJytiRisnXycrZGVuc2l0eSsnLycraW1nTmFtZSxcbiAgICAgIGJwcHBGb3JtYXQ6IGJGXG4gICAgfTtcbiAgICByZXR1cm4gcmV0O1xuICB9LFxuICBcbiAgX2JwcHBGb3JtYXQ6IGZ1bmN0aW9uKGJwcHApIHsgcmV0dXJuIHRoaXMub3B0aW9ucy5icHBwRm9ybWF0KGJwcHApOyB9LFxuICBcbiAgX3RpbGVJZDogZnVuY3Rpb24odGlsZUlkLCBicHBwKSB7IFxuICAgIHJldHVybiB0aGlzLnVuaXFJZCArICctdGlsZS0nICsgYnBwcC50b1N0cmluZygpLnJlcGxhY2UoJy4nLCAnLScpICsgJy0nICsgdGlsZUlkO1xuICB9LFxuICBcbiAgX2ZpeExhYmVsczogZnVuY3Rpb24oZm9yY2VSZXBvcykge1xuICAgIGlmICghdGhpcy5ydWxlcikgeyByZXR1cm47IH1cbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgJGVsZW0gPSBzZWxmLmVsZW1lbnQsXG4gICAgICBhdmFpbFdpZHRoID0gby5icm93c2VyLmdlbm9icm93c2VyKCdsaW5lV2lkdGgnKSxcbiAgICAgIHBvcyA9IG8ubGluZS5nZW5vbGluZSgnZ2V0UG9zJyksXG4gICAgICB6b29tID0gby5icm93c2VyLmdlbm9icm93c2VyKCd6b29tJyksXG4gICAgICBsZWZ0TWFyZyA9IHBvcyAtIGF2YWlsV2lkdGggKiB6b29tICogMC41LFxuICAgICAgcmlnaHRNYXJnID0gcG9zICsgMS41ICogYXZhaWxXaWR0aCAqIHpvb20sXG4gICAgICBicHBwcyA9IHRoaXMuYnBwcHMoKSxcbiAgICAgIGxhYmVsc05lZWRlZCA9IF8uZmlsdGVyKG8uY2hyTGFiZWxzLCBmdW5jdGlvbih2KSB7IHJldHVybiB2LnAgPiBsZWZ0TWFyZyAmJiB2LnAgPCByaWdodE1hcmc7IH0pLFxuICAgICAgbGFiZWxFbGVtZW50cyA9IFtdO1xuICAgIF8uZWFjaChsYWJlbHNOZWVkZWQsIGZ1bmN0aW9uKHYpIHtcbiAgICAgIHZhciByZXBvcyA9IGZhbHNlLCAkbCA9ICRlbGVtLmNoaWxkcmVuKCcubGFiZWwtJyArIHYucCk7XG4gICAgICBpZiAoISRsLmxlbmd0aCkgeyAkbCA9IHNlbGYuX2FkZExhYmVsKHYsIHpvb20pOyByZXBvcyA9IHRydWU7IH1cbiAgICAgIGlmIChyZXBvcyB8fCBmb3JjZVJlcG9zKSB7IHNlbGYuX3JlcG9zTGFiZWwoJGwsIHYsIHpvb20pOyB9XG4gICAgICBsYWJlbEVsZW1lbnRzLnB1c2goJGwuZ2V0KDApKTtcbiAgICB9KTtcbiAgICAkZWxlbS5jaGlsZHJlbignLmxhYmVsJykubm90KGxhYmVsRWxlbWVudHMpLnJlbW92ZSgpO1xuICAgIFxuICAgIGlmIChvLmNockJhbmRzICYmIHpvb20gPD0gby5pZGVvZ3JhbXNBYm92ZSkge1xuICAgICAgdmFyIGZpcnN0QmFuZEluZGV4ID0gXy5zb3J0ZWRJbmRleChvLmNockJhbmRzLCBbMCwgMCwgbGVmdE1hcmddLCBmdW5jdGlvbih2KSB7IHJldHVybiB2WzJdOyB9KSxcbiAgICAgICAgbGFzdEJhbmRJbmRleCA9IF8uc29ydGVkSW5kZXgoby5jaHJCYW5kcywgWzAsIHJpZ2h0TWFyZ10sIGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHZbMV07IH0pLFxuICAgICAgICBiYW5kc05lZWRlZCA9IG8uY2hyQmFuZHMuc2xpY2UoZmlyc3RCYW5kSW5kZXgsIGxhc3RCYW5kSW5kZXgpLFxuICAgICAgICBiYW5kRWxlbWVudHMgPSBbXTtcbiAgICAgIF8uZWFjaChiYW5kc05lZWRlZCwgZnVuY3Rpb24odikge1xuICAgICAgICB2YXIgcmVwb3MgPSBmYWxzZSwgJGIgPSAkKCcjJyArIHNlbGYuX3RpbGVJZCh2WzFdLCAnYmFuZCcpKTtcbiAgICAgICAgaWYgKCEkYi5sZW5ndGgpIHsgJGIgPSBzZWxmLl9hZGRCYW5kKHYsIHpvb20pOyByZXBvcyA9IHRydWU7IH1cbiAgICAgICAgaWYgKHJlcG9zIHx8IGZvcmNlUmVwb3MpIHsgc2VsZi5fcmVwb3NCYW5kKCRiLCB2LCB6b29tKTsgfVxuICAgICAgICBiYW5kRWxlbWVudHMucHVzaCgkYi5nZXQoMCkpO1xuICAgICAgfSk7XG4gICAgICAkZWxlbS5jaGlsZHJlbignLmJhbmQnKS5ub3QoYmFuZEVsZW1lbnRzKS5yZW1vdmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGVsZW0uY2hpbGRyZW4oJy5iYW5kJykucmVtb3ZlKCk7XG4gICAgfVxuICB9LFxuICBcbiAgX3J1bGVyVGlsZTogZnVuY3Rpb24oJHQsIHRpbGVJZCwgYnBwcCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIG8gPSBzZWxmLm9wdGlvbnMsXG4gICAgICBicFBlclRpbGUgPSBicHBwICogby50aWxlV2lkdGgsXG4gICAgICB6b29tID0gby5icm93c2VyLmdlbm9icm93c2VyKCd6b29tJyk7XG4gICAgJHQuYWRkQ2xhc3MoJ3RpbGUtcnVsZXIgYnBwcC0nK2NsYXNzRnJpZW5kbHkoYnBwcCkpLmRhdGEoJ2JwcHAnLCBicHBwKTtcbiAgICBcbiAgICBzZWxmLl9kcmF3Q2FudmFzVGlja3MoJHQsIHRpbGVJZCwgYnBwcCwgem9vbSk7XG4gICAgXG4gICAgaWYgKGJwcHAgPD0gby5udHNCZWxvd1swXSkge1xuICAgICAgdmFyIHNob3dOdFRleHQgPSBicHBwIDw9IG8ubnRzQmVsb3dbMV0sXG4gICAgICAgIGNhbnZhc0hlaWdodCA9IChzaG93TnRUZXh0ID8gMTIgOiAzKSArIChvLmNockJhbmRzID8gMSA6IDApLCAvLyB3aXRoIGJhbmRzLCB3ZSBuZWVkIGFuIGV4dHJhIHBpeGVsXG4gICAgICAgIGNhbnZhc0F0dHJzID0ge3dpZHRoOiBvLnRpbGVXaWR0aCwgaGVpZ2h0OiBjYW52YXNIZWlnaHQsIFwiY2xhc3NcIjogXCJudGRhdGFcIn07XG4gICAgICAkdC5hZGRDbGFzcygndGlsZS1udGRhdGEgdGlsZS1sb2FkZWQnKTtcbiAgICAgICR0LnRvZ2dsZUNsYXNzKG8uY2hyQmFuZHMgPyAndGlsZS1vdmVybGF5LW50ZGF0YScgOiAndGlsZS1iaWctbnRkYXRhJywgc2hvd050VGV4dCk7XG4gICAgICBpZiAoby5jaHJCYW5kcyAmJiBzaG93TnRUZXh0KSB7ICR0LmRhdGEoJ3pJbmRleCcsIDEwMSk7IH0gLy8gaWYgd2UgaGF2ZSBiYW5kcywgZHJhdyBpdCBvbiB0b3Agb2YgdGhlIGJhbmRzLlxuICAgICAgby5icm93c2VyLmdlbm9icm93c2VyKCdnZXRETkEnLCB0aWxlSWQsIHRpbGVJZCArIGJwUGVyVGlsZSwgc2VsZi5fbnRTZXF1ZW5jZUxvYWQsIHtcbiAgICAgICAgX2M6ICQubWsoJ2NhbnZhcycpLmF0dHIoY2FudmFzQXR0cnMpLmNzcygnaGVpZ2h0JywgY2FudmFzSGVpZ2h0KS5hcHBlbmRUbygkdCksXG4gICAgICAgIF9kOiBzaG93TnRUZXh0ICYmICQubWsoJ2RpdicpLmFkZENsYXNzKCdudHMnKS5hcHBlbmRUbygkdCksXG4gICAgICAgIF93OiBNYXRoLmNlaWwoby50aWxlV2lkdGggKiBicHBwIC8gem9vbSksXG4gICAgICAgIF9zZWxmOiBzZWxmXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIFxuICBfZHJhd0NhbnZhc1RpY2tzOiBmdW5jdGlvbigkdCwgdGlsZUlkLCBicHBwLCB6b29tKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgbyA9IHNlbGYub3B0aW9ucyxcbiAgICAgIGNociA9IG8uYnJvd3Nlci5nZW5vYnJvd3NlcignY2hyQXQnLCB0aWxlSWQpLFxuICAgICAgYnBQZXJUaWxlID0gYnBwcCAqIG8udGlsZVdpZHRoLFxuICAgICAgc2NhbGUgPSBNYXRoLnJvdW5kKE1hdGgubG9nKGJwUGVyVGlsZSAvIDEwKS9NYXRoLmxvZygxMCkqMiksXG4gICAgICB0b29Mb25nID0gdGlsZUlkLnRvU3RyaW5nKCkubGVuZ3RoID4gOCAmJiBzY2FsZSA8IDYsXG4gICAgICBzdGVwID0gc2NhbGUgJSAyID8gKHRvb0xvbmcgPyA1IDogMikgKiBNYXRoLnBvdygxMCwgZmxvb3JIYWNrKHNjYWxlLzIpKSA6IE1hdGgucG93KDEwLCBzY2FsZS8yKSxcbiAgICAgIG1ham9yU3RlcCA9IHNjYWxlICUgMiA/ICh0b29Mb25nID8gW3N0ZXAgKiAyLCBzdGVwICogMl0gOiBbc3RlcCAqIDUsIHN0ZXAgKiA1XSkgOiBbc3RlcCAqIDUsIHN0ZXAgKiAxMF0sXG4gICAgICBzdGFydCA9IGZsb29ySGFjaygodGlsZUlkIC0gY2hyLnApIC8gc3RlcCkgKiBzdGVwICsgc3RlcCxcbiAgICAgIG5ld0NocjtcbiAgICBcbiAgICBpZiAoYnBwcCA8PSBvLmJwcHBOdW1iZXJzQmVsb3dbMF0pIHtcbiAgICAgICR0LnRvZ2dsZUNsYXNzKCd0aWxlLWhhbGZ3YXknLCBicHBwID09IG8uYnBwcE51bWJlcnNCZWxvd1swXSk7XG4gICAgICAkdC50b2dnbGVDbGFzcygndGlsZS1sb2FkZWQnLCBicHBwIDw9IG8uYnBwcE51bWJlcnNCZWxvd1sxXSk7XG4gICAgICBpZiAoby51c2VDYW52YXNUaWNrcykge1xuICAgICAgICAvLyBUaGlzIG1heSBhbGxldmlhdGUgc29tZSBvZiB0aGUgZXhjZXNzaXZlIGVsZW1lbnQgY3JlYXRpb24gdGhhdCBvY2N1cnMgd2l0aCB0aGUgSFRNTCBtZXRob2RcbiAgICAgICAgc3RhcnQgLT0gc3RlcDtcbiAgICAgICAgdmFyIG9mZnNldEZvck50VGV4dCA9ICFvLmNockJhbmRzICYmIGJwcHAgPD0gby5udHNCZWxvd1sxXSxcbiAgICAgICAgICBjYW52YXNIZWlnaHQgPSBvLmNockJhbmRzID8gMjMgOiAob2Zmc2V0Rm9yTnRUZXh0ID8gMTIgOiAyMyksXG4gICAgICAgICAgY2FudmFzV2lkdGggPSBicHBwIC8gem9vbSAqIG8udGlsZVdpZHRoLFxuICAgICAgICAgICRvbGRDID0gJHQuY2hpbGRyZW4oJ2NhbnZhcy50aWNrcycpLFxuICAgICAgICAgIGNhbnZhc0F0dHJzID0ge3dpZHRoOiBjYW52YXNXaWR0aCwgaGVpZ2h0OiBjYW52YXNIZWlnaHQsIFwiY2xhc3NcIjogXCJ0aWNrc1wiICsgKCRvbGRDLmxlbmd0aCA/ICcgaGlkZGVuJyA6ICcnKX0sXG4gICAgICAgICAgJGMgPSAkLm1rKCdjYW52YXMnKS5jc3MoJ2hlaWdodCcsIGNhbnZhc0hlaWdodCkucHJlcGVuZFRvKCR0KSxcbiAgICAgICAgICBjdHggPSAkYy5nZXQoMCkuZ2V0Q29udGV4dCAmJiAkYy5nZXQoMCkuZ2V0Q29udGV4dCgnMmQnKSxcbiAgICAgICAgICB0ZXh0WSA9IG8uY2hyQmFuZHMgPyAxNiA6IChvZmZzZXRGb3JOdFRleHQgPyAxMCA6IDE2KSxcbiAgICAgICAgICBkZWZhdWx0Rm9udCA9IFwiMTFweCAnTHVjaWRhIEdyYW5kZScsVGFob21hLEFyaWFsLExpYmVyYXRpb24gU2FucyxGcmVlU2FucyxzYW5zLXNlcmlmXCI7XG4gICAgICAgIGlmICgkLmJyb3dzZXIub3BlcmEpIHsgZGVmYXVsdEZvbnQgPSBcIjEycHggQXJpYWwsc2Fucy1zZXJpZlwiOyB9IC8vIE9wZXJhIGNhbiBvbmx5IHJlbmRlciBBcmlhbCBkZWNlbnRseSBvbiBjYW52YXNcbiAgICAgICAgaWYgKCFjdHgpIHsgcmV0dXJuOyB9XG4gICAgICAgICRjLmF0dHIoY2FudmFzQXR0cnMpO1xuICAgICAgICBjdHguZm9udCA9IGRlZmF1bHRGb250O1xuICAgICAgICBmb3IgKHZhciB0ID0gc3RhcnQ7IHQgKyBjaHIucCA8IHRpbGVJZCArIGJwcHAgKiBvLnRpbGVXaWR0aCArIHN0ZXA7IHQgKz0gc3RlcCkge1xuICAgICAgICAgIGlmICh0ID4gby5jaHJMZW5ndGhzW2Noci5uXSkge1xuICAgICAgICAgICAgbmV3Q2hyID0gby5icm93c2VyLmdlbm9icm93c2VyKCdjaHJBdCcsIGNoci5wICsgdCk7XG4gICAgICAgICAgICBpZiAoY2hyID09PSBuZXdDaHIpIHsgYnJlYWs7IH0gLy8gb2ZmIHRoZSBlbmQgb2YgdGhlIGxhc3QgY2hyb21vc29tZVxuICAgICAgICAgICAgdCA9IDA7XG4gICAgICAgICAgICBjaHIgPSBuZXdDaHI7XG4gICAgICAgICAgICBjb250aW51ZTsgLy8gdGhlIGxhYmVsIGZvciAwIGlzIG5ldmVyIHNob3duXG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciB1bml0ID0gXy5maW5kKFtbMTAwMDAwMCwgJ20nXSwgWzEwMDAsICdrJ10sIFsxLCAnJ11dLCBmdW5jdGlvbih2KSB7IHJldHVybiB2WzBdIDw9IHN0ZXA7IH0pLFxuICAgICAgICAgICAgbWFqb3IgPSBmbG9vckhhY2sodCAvIG1ham9yU3RlcFsxXSksXG4gICAgICAgICAgICBtaW5vciA9ICh0IC8gdW5pdFswXSkudG9TdHJpbmcoKS5zdWJzdHIobWFqb3IgPiAwID8gbWFqb3IudG9TdHJpbmcoKS5sZW5ndGggOiAwKSxcbiAgICAgICAgICAgIGlzTWFqb3IgPSAhKHQgJSBtYWpvclN0ZXBbMF0pLFxuICAgICAgICAgICAgeCA9ICgodCArIGNoci5wIC0gdGlsZUlkICsgMC41KSAvIGJwUGVyVGlsZSAqIGNhbnZhc1dpZHRoKTtcbiAgICAgICAgICBpZiAoaXNNYWpvcikge1xuICAgICAgICAgICAgY3R4LmZvbnQgPSBcImJvbGQgXCIgKyBkZWZhdWx0Rm9udDtcbiAgICAgICAgICAgIGlmIChtYWpvcikge1xuICAgICAgICAgICAgICBjdHgudGV4dEFsaWduID0gJ2VuZCc7XG4gICAgICAgICAgICAgIGN0eC5maWxsVGV4dChtYWpvciwgeCAtIDEsIHRleHRZKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnc3RhcnQnO1xuICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHgsIG9mZnNldEZvck50VGV4dCA/IDEgOiAzLCAxLCAxOSk7IFxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyM2NjY2NjYnO1xuICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHgsIG9mZnNldEZvck50VGV4dCA/IDEgOiA3LCAxLCAxNCk7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMwMDAwMDAnO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdHguZmlsbFRleHQobWlub3IgKyAoaXNNYWpvciA/IHVuaXRbMV0gOiAnJyksIHggKyAyLCB0ZXh0WSk7XG4gICAgICAgICAgaWYgKGlzTWFqb3IpIHsgY3R4LmZvbnQgPSBkZWZhdWx0Rm9udDsgfVxuICAgICAgICB9XG4gICAgICAgIGlmICgkb2xkQy5sZW5ndGgpIHsgXG4gICAgICAgICAgJG9sZEMuYWRkQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAgICRjLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyAkb2xkQy5yZW1vdmUoKTsgfSwgMTAwMCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZ1bmN0aW9uIGdob3N0aWZ5KHRleHQpIHtcbiAgICAgICAgICB0ZXh0ID0gdGV4dC50b1N0cmluZygpO1xuICAgICAgICAgIHJldHVybiB0ZXh0O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmb3IgKHZhciB0ID0gc3RhcnQ7IHQgKyBjaHIucCA8IHRpbGVJZCArIGJwcHAgKiBvLnRpbGVXaWR0aDsgdCArPSBzdGVwKSB7XG4gICAgICAgICAgaWYgKHQgPiBvLmNockxlbmd0aHNbY2hyLm5dKSB7XG4gICAgICAgICAgICBuZXdDaHIgPSBvLmJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2NockF0JywgY2hyLnAgKyB0KTtcbiAgICAgICAgICAgIGlmIChjaHIgPT09IG5ld0NocikgeyBicmVhazsgfSAvLyBvZmYgdGhlIGVuZCBvZiB0aGUgbGFzdCBjaHJvbW9zb21lXG4gICAgICAgICAgICB0ID0gMDtcbiAgICAgICAgICAgIGNociA9IG5ld0NocjtcbiAgICAgICAgICAgIGNvbnRpbnVlOyAvLyB0aGUgbGFiZWwgZm9yIDAgaXMgbmV2ZXIgc2hvd25cbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHVuaXQgPSBfLmZpbmQoW1sxMDAwMDAwLCAnbSddLCBbMTAwMCwgJ2snXSwgWzEsICcnXV0sIGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHZbMF0gPD0gc3RlcDsgfSksXG4gICAgICAgICAgICBtYWpvciA9IGZsb29ySGFjayh0IC8gbWFqb3JTdGVwWzFdKSxcbiAgICAgICAgICAgIG1pbm9yID0gKHQgLyB1bml0WzBdKS50b1N0cmluZygpLnN1YnN0cihtYWpvciA+IDAgPyBtYWpvci50b1N0cmluZygpLmxlbmd0aCA6IDApLFxuICAgICAgICAgICAgaXNNYWpvciA9ICEodCAlIG1ham9yU3RlcFswXSksXG4gICAgICAgICAgICB0aWNrSFRNTCA9ICc8ZGl2IGNsYXNzPVwidGljaycgKyAoaXNNYWpvciA/ICcgbWFqb3JcIj4nICsgZ2hvc3RpZnkobWFqb3IgPyBtYWpvciA6ICcnKSA6ICdcIj4nKSArIFxuICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJtaW5vclwiPicgKyBnaG9zdGlmeShtaW5vciArIChpc01ham9yID8gdW5pdFsxXSA6ICcnKSkgKyAnPC9zcGFuPjwvZGl2PicsXG4gICAgICAgICAgICAkdGljayA9ICQodGlja0hUTUwpLmFwcGVuZFRvKCR0KTtcbiAgICAgICAgICAkdGljay5jc3MoJ3JpZ2h0JywgKCgxIC0gKHQgKyBjaHIucCAtIHRpbGVJZCArIDAuNSkgLyBicFBlclRpbGUpICogMTAwKSsnJScpOyAvLyBUaGUgMC41IGNlbnRlcnMgaXQgb3ZlciB0aGUgYmFzZS5cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgXG4gIHJlZHJhd0NhbnZhc1RpY2tzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAkZWxlbSA9IHNlbGYuZWxlbWVudCwgXG4gICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgem9vbSA9IG8uYnJvd3Nlci5nZW5vYnJvd3Nlcignem9vbScpO1xuICAgICRlbGVtLmNoaWxkcmVuKCcudGlsZS1ydWxlcicpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgJHQgPSAkKHRoaXMpO1xuICAgICAgc2VsZi5fZHJhd0NhbnZhc1RpY2tzKCR0LCAkdC5kYXRhKCd0aWxlSWQnKSwgJHQuZGF0YSgnYnBwcCcpLCB6b29tKTtcbiAgICB9KTtcbiAgfSxcbiAgXG4gIF9udFNlcXVlbmNlTG9hZDogZnVuY3Rpb24oZG5hLCBleHRyYURhdGEpIHtcbiAgICBpZiAoIWRuYSkgeyByZXR1cm47IH1cbiAgICB2YXIgbyA9IGV4dHJhRGF0YS5fc2VsZi5vcHRpb25zLFxuICAgICAgJGQgPSBleHRyYURhdGEuX2QsXG4gICAgICBsID0gZG5hLmxlbmd0aCxcbiAgICAgIHBwYnAgPSBvLnRpbGVXaWR0aCAvIGwsIC8vIHBpeGVscyBwZXIgYnBcbiAgICAgIGNvbG9ycyA9IHthOicyNTUsMCwwJywgdDonMjU1LDAsMjU1JywgYzonMCwwLDI1NScsIGc6JzAsMTgwLDAnfSxcbiAgICAgIGNhbnZhcywgaGVpZ2h0LCBjdHgsIG50O1xuICAgIGlmICgkZCkge1xuICAgICAgdmFyICRzdmcgPSAkLm1rKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJzdmdcIikuYXR0cih7XG4gICAgICAgIHZlcnNpb246IFwiMS4yXCIsXG4gICAgICAgIGJhc2VQcm9maWxlOiBcInRpbnlcIixcbiAgICAgICAgaGVpZ2h0OiAnMTRweCcsXG4gICAgICAgIHdpZHRoOiAoJGQuY2xvc2VzdCgnLnRpbGUnKS53aWR0aCgpIHx8IGV4dHJhRGF0YS5fdykgKyAncHgnXG4gICAgICB9KTtcbiAgICAgICRkLmFwcGVuZCgkc3ZnKTtcbiAgICAgICQubWsoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCBcInRleHRcIikuYXR0cih7XG4gICAgICAgIHg6IF8ubWFwKF8ucmFuZ2UobCksIGZ1bmN0aW9uKHgpIHsgcmV0dXJuIHggLyBsICogMTAwOyB9KS5qb2luKCclICcpICsgJyUnLFxuICAgICAgICB5OiAxMSxcbiAgICAgICAgZmlsbDogJyNGRkZGRkYnXG4gICAgICB9KS50ZXh0KGRuYSkuYXBwZW5kVG8oJHN2Zyk7XG4gICAgfVxuICAgIGNhbnZhcyA9IGV4dHJhRGF0YS5fYyAmJiBleHRyYURhdGEuX2MuZ2V0KDApO1xuICAgIGhlaWdodCA9IGNhbnZhcy5oZWlnaHQ7XG4gICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQgJiYgY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgaWYgKCFjdHgpIHsgcmV0dXJuOyB9XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsOyBpKyspIHtcbiAgICAgIG50ID0gZG5hLnN1YnN0cihpLCAxKTtcbiAgICAgIGlmIChudCA9PSAnLScpIHsgY29udGludWU7IH1cbiAgICAgIGN0eC5maWxsU3R5bGUgPSBcInJnYihcIiArIGNvbG9yc1tudC50b0xvd2VyQ2FzZSgpXSArIFwiKVwiO1xuICAgICAgY3R4LmZpbGxSZWN0KGkgKiBwcGJwLCAwLCBwcGJwLCBoZWlnaHQpO1xuICAgIH1cbiAgfSxcbiAgXG4gIF9hZGRMYWJlbDogZnVuY3Rpb24obGFiZWwsIHpvb20pIHtcbiAgICB2YXIgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICRsID0gJC5taygnZGl2JykuYWRkQ2xhc3MoJ2xhYmVsIGxhYmVsLScrbGFiZWwucCksXG4gICAgICAkbHQgPSAkLm1rKCdkaXYnKS5hZGRDbGFzcygnbGFiZWwtdGV4dCcpLnByZXBlbmRUbygkbCkudGV4dChsYWJlbC5uLnJlcGxhY2UoL15jaHIvLCcnKSk7XG4gICAgaWYgKGxhYmVsLm4uaW5kZXhPZignY2hyJykgPT09IDApIHsgJGx0LnByZXBlbmQoJzxzcGFuIGNsYXNzPVwiY2hyXCI+Y2hyPC9zcGFuPicpOyB9XG4gICAgJGwucHJlcGVuZCgnPHNwYW4gY2xhc3M9XCJzdGFydC1saW5lXCI+PC9zcGFuPicpO1xuICAgIGlmIChsYWJlbC5lbmQgPT09IHRydWUpIHsgJGwuYWRkQ2xhc3MoJ2xhYmVsLWVuZCcpOyB9XG4gICAgLy8kbC5jc3MoJ3otaW5kZXgnLCAyMDAgKyBsYWJlbC5pKTtcbiAgICByZXR1cm4gJGwuYXBwZW5kVG8odGhpcy5lbGVtZW50KTtcbiAgfSxcbiAgXG4gIF9yZXBvc0xhYmVsOiBmdW5jdGlvbigkbCwgbGFiZWwsIHpvb20pIHsgIFxuICAgIC8vIGNvbnN0cmFpbiB3aWR0aCBvZiBsYWJlbCBzbyBpdCBkb2Vzbid0IHJ1biBvdmVyIGludG8gdGhlIG5leHQgb25lXG4gICAgLy8gbWF4LXdpZHRoIGRvZXNuJ3QgaW5jbHVkZSBwYWRkaW5nICg1cHgpXG4gICAgaWYgKGxhYmVsLmVuZCAhPT0gdHJ1ZSkgeyAkbC5jaGlsZHJlbignLmxhYmVsLXRleHQnKS5jc3MoJ21heC13aWR0aCcsIE1hdGgubWF4KGxhYmVsLncgLyB6b29tIC0gNSwgMCkpOyB9XG4gICAgLy8gYCsgMWAgLS0+IGNvbnZlcnQgMC1iYXNlZCBwb3NpdGlvbmluZ1xuICAgIC8vIGAtIDFgIC0tPiBsYWJlbCBpcyBvZmZzZXQgMXB4IHRvIGxlZnQgdG8gY29tcGVuc2F0ZSBmb3IgdGhlIDJweCB3aWR0aCBvZiB0aGUgcmVkIGluZGljYXRvciBsaW5lXG4gICAgJGwuY3NzKCdsZWZ0JywgKGxhYmVsLnAgKyAxIC0gdGhpcy5vcHRpb25zLmxpbmUuZ2Vub2xpbmUoJ29wdGlvbicsICdvcmlnaW4nKSkgLyB6b29tIC0gMSk7XG4gIH0sXG4gIFxuICBfYWRkQmFuZDogZnVuY3Rpb24oYmFuZCwgem9vbSkge1xuICAgIHZhciBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgJGIgPSAkKCc8ZGl2IGNsYXNzPVwiYmFuZCBiYW5kLScrYmFuZFs0XSsnIGJhbmQtJytiYW5kWzNdLnN1YnN0cigwLDEpKydcIi8+Jyk7XG4gICAgJGIuYXR0cignaWQnLCB0aGlzLl90aWxlSWQoYmFuZFsxXSwgJ2JhbmQnKSk7XG4gICAgaWYgKGJhbmRbNV0gPT09IDApIHsgJGIucHJlcGVuZCgnPGRpdiBjbGFzcz1cImNoci1zdGFydFwiLz4nKTsgfVxuICAgICRiLmFwcGVuZCgkKCc8ZGl2IGNsYXNzPVwiYmFuZC1uYW1lXCIvPicpLnRleHQoYmFuZFswXS5zdWJzdHIoMykgKyBiYW5kWzNdKSk7XG4gICAgcmV0dXJuICRiLmFwcGVuZFRvKHRoaXMuZWxlbWVudCk7XG4gIH0sXG4gIFxuICBfcmVwb3NCYW5kOiBmdW5jdGlvbigkYiwgYmFuZCwgem9vbSkgeyBcbiAgICB2YXIgbyA9IHRoaXMub3B0aW9ucywgXG4gICAgICBwcm9wID0gYmFuZFs0XSA9PSAnYWNlbicgPyAoL15wLy50ZXN0KGJhbmRbM10pID8gJ2JvcmRlci1sZWZ0LXdpZHRoJyA6ICdib3JkZXItcmlnaHQtd2lkdGgnKTogJ3dpZHRoJztcbiAgICAkYi5jc3MoJ2xlZnQnLCAoYmFuZFsxXSAtIG8ubGluZS5nZW5vbGluZSgnb3B0aW9uJywgJ29yaWdpbicpKSAvIHpvb20pO1xuICAgICRiLmNzcyhwcm9wLCAoYmFuZFsyXSAtIGJhbmRbMV0pIC8gem9vbSArIDEpOyBcbiAgfSxcbiAgXG4gIF9jdXN0b21UaWxlUmVuZGVyOiBmdW5jdGlvbihlLCBjYWxsYmFjaykge1xuICAgIHZhciBjYW52YXMgPSB0aGlzLFxuICAgICAgJGNhbnZhcyA9ICQodGhpcyksXG4gICAgICBkID0gZS5kYXRhLFxuICAgICAgYnJvd3NlciA9IGQuc2VsZi5vcHRpb25zLmJyb3dzZXI7XG4gICAgZnVuY3Rpb24gcHVzaENhbGxiYWNrKCkgeyBfLmlzRnVuY3Rpb24oY2FsbGJhY2spICYmICRjYW52YXMuZGF0YSgncmVuZGVyaW5nQ2FsbGJhY2tzJykucHVzaChjYWxsYmFjayk7IH1cbiAgICBpZiAoJGNhbnZhcy5kYXRhKCdyZW5kZXJpbmcnKSA9PT0gdHJ1ZSkgeyBwdXNoQ2FsbGJhY2soKTsgcmV0dXJuOyB9XG4gICAgJGNhbnZhcy5kYXRhKCdyZW5kZXJpbmcnLCB0cnVlKTtcbiAgICAkY2FudmFzLmRhdGEoJ3JlbmRlcmluZ0NhbGxiYWNrcycsIFtdKTtcbiAgICBwdXNoQ2FsbGJhY2soKTtcbiAgICBkLmN1c3RvbS5yZW5kZXIoY2FudmFzLCBkLnN0YXJ0LCBkLmVuZCwgZC5kZW5zaXR5LCBmdW5jdGlvbigpIHtcbiAgICAgICRjYW52YXMuY3NzKCd3aWR0aCcsICcxMDAlJykuY3NzKCdoZWlnaHQnLCBkLmN1c3RvbS5zdHJldGNoSGVpZ2h0ID8gJzEwMCUnIDogY2FudmFzLmhlaWdodCk7XG4gICAgICAkY2FudmFzLnRvZ2dsZUNsYXNzKCdzdHJldGNoLWhlaWdodCcsIGQuY3VzdG9tLnN0cmV0Y2hIZWlnaHQpO1xuICAgICAgJGNhbnZhcy5yZW1vdmVDbGFzcygndW5yZW5kZXJlZCcpLmFkZENsYXNzKCduby1hcmVhcycpO1xuICAgICAgZC5zZWxmLmZpeENsaWNrQXJlYXMoKTtcbiAgICAgIC8vIElmIHRoZSB0b28tbWFueSBjbGFzcyB3YXMgc2V0LCB3ZSBjb3VsZG4ndCBkcmF3L2xvYWQgdGhlIGRhdGEgYXQgdGhpcyBkZW5zaXR5IGJlY2F1c2UgdGhlcmUncyB0b28gbXVjaCBvZiBpdFxuICAgICAgLy8gSWYgdGhpcyBpcyBhdCBcInNxdWlzaFwiIGRlbnNpdHksIHdlIGFsc28gYWRkIHRoZSBjbGFzcyB0byBwYXJlbnQgPGRpdj4gdG8gdGVsbCB0aGUgdXNlciB0aGF0IHNoZSBuZWVkcyB0byB6b29tXG4gICAgICBpZiAoJGNhbnZhcy5oYXNDbGFzcygndG9vLW1hbnknKSkgeyAkY2FudmFzLnBhcmVudCgpLmFkZENsYXNzKCd0b28tbWFueScpOyB9XG4gICAgICBpZiAoJGNhbnZhcy5oYXNDbGFzcygndG9vLW1hbnknKSAmJiBkLmRlbnNpdHkgPT0gJ2RlbnNlJykgeyAkY2FudmFzLnBhcmVudCgpLmFkZENsYXNzKCd0b28tbWFueS1mb3ItZGVuc2UnKTsgfVxuICAgICAgXy5lYWNoKCRjYW52YXMuZGF0YSgncmVuZGVyaW5nQ2FsbGJhY2tzJyksIGZ1bmN0aW9uKGYpIHsgZigpOyB9KTtcbiAgICAgICRjYW52YXMuZGF0YSgncmVuZGVyaW5nJywgZmFsc2UpO1xuICAgIH0pO1xuICAgIGlmIChkLmN1c3RvbS5leHBlY3RzU2VxdWVuY2UgJiYgKGQuZW5kIC0gZC5zdGFydCkgPCBicm93c2VyLmdlbm9icm93c2VyKCdvcHRpb24nLCAnbWF4TnRSZXF1ZXN0JykpIHtcbiAgICAgIGJyb3dzZXIuZ2Vub2Jyb3dzZXIoJ2dldEROQScsIGQuc3RhcnQsIGQuZW5kLCBmdW5jdGlvbihzZXF1ZW5jZSkge1xuICAgICAgICBkLmN1c3RvbS5yZW5kZXJTZXF1ZW5jZShjYW52YXMsIGQuc3RhcnQsIGQuZW5kLCBkLmRlbnNpdHksIHNlcXVlbmNlLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAvLyBUT0RPOiBtYXkgbmVlZCB0byBkLnNlbGYuZml4Q2xpY2tBcmVhcygpIGFnYWluIGlmIC5yZW5kZXJTZXF1ZW5jZSBhZGRlZCBhcmVhcz9cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIFxuICBfY3VzdG9tVGlsZTogZnVuY3Rpb24oJHQsIHRpbGVJZCwgYnBwcCwgYmVzdERlbnNpdHkpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBvID0gc2VsZi5vcHRpb25zLFxuICAgICAgYnBQZXJUaWxlID0gYnBwcCAqIG8udGlsZVdpZHRoLFxuICAgICAgZW5kID0gdGlsZUlkICsgYnBQZXJUaWxlO1xuICAgICR0LmFkZENsYXNzKCd0aWxlLWN1c3RvbSB0aWxlLWZ1bGwgdGlsZS1sb2FkZWQgYnBwcC0nK2NsYXNzRnJpZW5kbHkoYnBwcCkpO1xuICAgIF8uZWFjaChvLnRyYWNrLnMsIGZ1bmN0aW9uKGRlbnNpdHkpIHtcbiAgICAgIHZhciBjYW52YXNIVE1MID0gJzxjYW52YXMgd2lkdGg9XCInK28udGlsZVdpZHRoKydcIiBoZWlnaHQ9XCInK28udHJhY2suaCsnXCIgY2xhc3M9XCJ0ZGF0YSB1bnJlbmRlcmVkIGRlbnMtJytkZW5zaXR5KydcIiAnXG4gICAgICAgICAgKyAnaWQ9XCJjYW52YXMtJytzZWxmLl90aWxlSWQodGlsZUlkLCBicHBwKSsnLScrZGVuc2l0eSsnXCI+PC9jYW52YXM+JyxcbiAgICAgICAgJGMgPSAkKGNhbnZhc0hUTUwpLmFwcGVuZFRvKCR0KTtcbiAgICAgICRjLmJpbmQoJ3JlbmRlcicsIHtzdGFydDogdGlsZUlkLCBlbmQ6IGVuZCwgZGVuc2l0eTogZGVuc2l0eSwgc2VsZjogc2VsZiwgY3VzdG9tOiBvLnRyYWNrLmN1c3RvbX0sIHNlbGYuX2N1c3RvbVRpbGVSZW5kZXIpO1xuICAgICAgJGMuYmluZCgnZXJhc2UnLCBmdW5jdGlvbigpIHsgby50cmFjay5jdXN0b20uZXJhc2UoJGMuZ2V0KDApKTsgJGMuYWRkQ2xhc3MoJ3VucmVuZGVyZWQnKTsgfSk7XG4gICAgICBpZiAoZGVuc2l0eT09YmVzdERlbnNpdHkpIHsgJGMuYWRkQ2xhc3MoJ2RlbnMtYmVzdCcpLnRyaWdnZXIoJ3JlbmRlcicpOyB9XG4gICAgfSk7XG4gIH1cbiAgXG59KTtcblxufTsiLCIvKiFcbiAqIGpRdWVyeSBVSSAxLjguMTZcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1VJXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oalF1ZXJ5KSB7XG4oZnVuY3Rpb24oYSxkKXtmdW5jdGlvbiBjKGgsZyl7dmFyIGk9aC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmKFwiYXJlYVwiPT09aSl7Zz1oLnBhcmVudE5vZGU7aT1nLm5hbWU7aWYoIWguaHJlZnx8IWl8fGcubm9kZU5hbWUudG9Mb3dlckNhc2UoKSE9PVwibWFwXCIpcmV0dXJuIGZhbHNlO2g9YShcImltZ1t1c2VtYXA9I1wiK2krXCJdXCIpWzBdO3JldHVybiEhaCYmZShoKX1yZXR1cm4oL2lucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0Ly50ZXN0KGkpPyFoLmRpc2FibGVkOlwiYVwiPT1pP2guaHJlZnx8ZzpnKSYmZShoKX1mdW5jdGlvbiBlKGgpe3JldHVybiFhKGgpLnBhcmVudHMoKS5hbmRTZWxmKCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIGEuY3VyQ1NTKHRoaXMsXCJ2aXNpYmlsaXR5XCIpPT09XCJoaWRkZW5cInx8YS5leHByLmZpbHRlcnMuaGlkZGVuKHRoaXMpfSkubGVuZ3RofWEudWk9YS51aXx8e307aWYoIWEudWkudmVyc2lvbil7YS5leHRlbmQoYS51aSx7dmVyc2lvbjpcIjEuOC4xNlwiLFxua2V5Q29kZTp7QUxUOjE4LEJBQ0tTUEFDRTo4LENBUFNfTE9DSzoyMCxDT01NQToxODgsQ09NTUFORDo5MSxDT01NQU5EX0xFRlQ6OTEsQ09NTUFORF9SSUdIVDo5MyxDT05UUk9MOjE3LERFTEVURTo0NixET1dOOjQwLEVORDozNSxFTlRFUjoxMyxFU0NBUEU6MjcsSE9NRTozNixJTlNFUlQ6NDUsTEVGVDozNyxNRU5VOjkzLE5VTVBBRF9BREQ6MTA3LE5VTVBBRF9ERUNJTUFMOjExMCxOVU1QQURfRElWSURFOjExMSxOVU1QQURfRU5URVI6MTA4LE5VTVBBRF9NVUxUSVBMWToxMDYsTlVNUEFEX1NVQlRSQUNUOjEwOSxQQUdFX0RPV046MzQsUEFHRV9VUDozMyxQRVJJT0Q6MTkwLFJJR0hUOjM5LFNISUZUOjE2LFNQQUNFOjMyLFRBQjo5LFVQOjM4LFdJTkRPV1M6OTF9fSk7YS5mbi5leHRlbmQoe3Byb3BBdHRyOmEuZm4ucHJvcHx8YS5mbi5hdHRyLF9mb2N1czphLmZuLmZvY3VzLGZvY3VzOmZ1bmN0aW9uKGgsZyl7cmV0dXJuIHR5cGVvZiBoPT09XCJudW1iZXJcIj90aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgaT1cbnRoaXM7c2V0VGltZW91dChmdW5jdGlvbigpe2EoaSkuZm9jdXMoKTtnJiZnLmNhbGwoaSl9LGgpfSk6dGhpcy5fZm9jdXMuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxzY3JvbGxQYXJlbnQ6ZnVuY3Rpb24oKXt2YXIgaDtoPWEuYnJvd3Nlci5tc2llJiYvKHN0YXRpY3xyZWxhdGl2ZSkvLnRlc3QodGhpcy5jc3MoXCJwb3NpdGlvblwiKSl8fC9hYnNvbHV0ZS8udGVzdCh0aGlzLmNzcyhcInBvc2l0aW9uXCIpKT90aGlzLnBhcmVudHMoKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4vKHJlbGF0aXZlfGFic29sdXRlfGZpeGVkKS8udGVzdChhLmN1ckNTUyh0aGlzLFwicG9zaXRpb25cIiwxKSkmJi8oYXV0b3xzY3JvbGwpLy50ZXN0KGEuY3VyQ1NTKHRoaXMsXCJvdmVyZmxvd1wiLDEpK2EuY3VyQ1NTKHRoaXMsXCJvdmVyZmxvdy15XCIsMSkrYS5jdXJDU1ModGhpcyxcIm92ZXJmbG93LXhcIiwxKSl9KS5lcSgwKTp0aGlzLnBhcmVudHMoKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4vKGF1dG98c2Nyb2xsKS8udGVzdChhLmN1ckNTUyh0aGlzLFxuXCJvdmVyZmxvd1wiLDEpK2EuY3VyQ1NTKHRoaXMsXCJvdmVyZmxvdy15XCIsMSkrYS5jdXJDU1ModGhpcyxcIm92ZXJmbG93LXhcIiwxKSl9KS5lcSgwKTtyZXR1cm4vZml4ZWQvLnRlc3QodGhpcy5jc3MoXCJwb3NpdGlvblwiKSl8fCFoLmxlbmd0aD9hKGRvY3VtZW50KTpofSx6SW5kZXg6ZnVuY3Rpb24oaCl7aWYoaCE9PWQpcmV0dXJuIHRoaXMuY3NzKFwiekluZGV4XCIsaCk7aWYodGhpcy5sZW5ndGgpe2g9YSh0aGlzWzBdKTtmb3IodmFyIGc7aC5sZW5ndGgmJmhbMF0hPT1kb2N1bWVudDspe2c9aC5jc3MoXCJwb3NpdGlvblwiKTtpZihnPT09XCJhYnNvbHV0ZVwifHxnPT09XCJyZWxhdGl2ZVwifHxnPT09XCJmaXhlZFwiKXtnPXBhcnNlSW50KGguY3NzKFwiekluZGV4XCIpLDEwKTtpZighaXNOYU4oZykmJmchPT0wKXJldHVybiBnfWg9aC5wYXJlbnQoKX19cmV0dXJuIDB9LGRpc2FibGVTZWxlY3Rpb246ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5iaW5kKChhLnN1cHBvcnQuc2VsZWN0c3RhcnQ/XCJzZWxlY3RzdGFydFwiOlxuXCJtb3VzZWRvd25cIikrXCIudWktZGlzYWJsZVNlbGVjdGlvblwiLGZ1bmN0aW9uKGgpe2gucHJldmVudERlZmF1bHQoKX0pfSxlbmFibGVTZWxlY3Rpb246ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy51bmJpbmQoXCIudWktZGlzYWJsZVNlbGVjdGlvblwiKX19KTthLmVhY2goW1wiV2lkdGhcIixcIkhlaWdodFwiXSxmdW5jdGlvbihoLGcpe2Z1bmN0aW9uIGkobCxvLG4sayl7YS5lYWNoKGIsZnVuY3Rpb24oKXtvLT1wYXJzZUZsb2F0KGEuY3VyQ1NTKGwsXCJwYWRkaW5nXCIrdGhpcyx0cnVlKSl8fDA7aWYobilvLT1wYXJzZUZsb2F0KGEuY3VyQ1NTKGwsXCJib3JkZXJcIit0aGlzK1wiV2lkdGhcIix0cnVlKSl8fDA7aWYoaylvLT1wYXJzZUZsb2F0KGEuY3VyQ1NTKGwsXCJtYXJnaW5cIit0aGlzLHRydWUpKXx8MH0pO3JldHVybiBvfXZhciBiPWc9PT1cIldpZHRoXCI/W1wiTGVmdFwiLFwiUmlnaHRcIl06W1wiVG9wXCIsXCJCb3R0b21cIl0sZj1nLnRvTG93ZXJDYXNlKCksaj17aW5uZXJXaWR0aDphLmZuLmlubmVyV2lkdGgsaW5uZXJIZWlnaHQ6YS5mbi5pbm5lckhlaWdodCxcbm91dGVyV2lkdGg6YS5mbi5vdXRlcldpZHRoLG91dGVySGVpZ2h0OmEuZm4ub3V0ZXJIZWlnaHR9O2EuZm5bXCJpbm5lclwiK2ddPWZ1bmN0aW9uKGwpe2lmKGw9PT1kKXJldHVybiBqW1wiaW5uZXJcIitnXS5jYWxsKHRoaXMpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXthKHRoaXMpLmNzcyhmLGkodGhpcyxsKStcInB4XCIpfSl9O2EuZm5bXCJvdXRlclwiK2ddPWZ1bmN0aW9uKGwsbyl7aWYodHlwZW9mIGwhPT1cIm51bWJlclwiKXJldHVybiBqW1wib3V0ZXJcIitnXS5jYWxsKHRoaXMsbCk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2EodGhpcykuY3NzKGYsaSh0aGlzLGwsdHJ1ZSxvKStcInB4XCIpfSl9fSk7YS5leHRlbmQoYS5leHByW1wiOlwiXSx7ZGF0YTpmdW5jdGlvbihoLGcsaSl7cmV0dXJuISFhLmRhdGEoaCxpWzNdKX0sZm9jdXNhYmxlOmZ1bmN0aW9uKGgpe3JldHVybiBjKGgsIWlzTmFOKGEuYXR0cihoLFwidGFiaW5kZXhcIikpKX0sdGFiYmFibGU6ZnVuY3Rpb24oaCl7dmFyIGc9YS5hdHRyKGgsXG5cInRhYmluZGV4XCIpLGk9aXNOYU4oZyk7cmV0dXJuKGl8fGc+PTApJiZjKGgsIWkpfX0pO2EoZnVuY3Rpb24oKXt2YXIgaD1kb2N1bWVudC5ib2R5LGc9aC5hcHBlbmRDaGlsZChnPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIikpO2EuZXh0ZW5kKGcuc3R5bGUse21pbkhlaWdodDpcIjEwMHB4XCIsaGVpZ2h0OlwiYXV0b1wiLHBhZGRpbmc6MCxib3JkZXJXaWR0aDowfSk7YS5zdXBwb3J0Lm1pbkhlaWdodD1nLm9mZnNldEhlaWdodD09PTEwMDthLnN1cHBvcnQuc2VsZWN0c3RhcnQ9XCJvbnNlbGVjdHN0YXJ0XCJpbiBnO2gucmVtb3ZlQ2hpbGQoZykuc3R5bGUuZGlzcGxheT1cIm5vbmVcIn0pO2EuZXh0ZW5kKGEudWkse3BsdWdpbjp7YWRkOmZ1bmN0aW9uKGgsZyxpKXtoPWEudWlbaF0ucHJvdG90eXBlO2Zvcih2YXIgYiBpbiBpKXtoLnBsdWdpbnNbYl09aC5wbHVnaW5zW2JdfHxbXTtoLnBsdWdpbnNbYl0ucHVzaChbZyxpW2JdXSl9fSxjYWxsOmZ1bmN0aW9uKGgsZyxpKXtpZigoZz1oLnBsdWdpbnNbZ10pJiZcbmguZWxlbWVudFswXS5wYXJlbnROb2RlKWZvcih2YXIgYj0wO2I8Zy5sZW5ndGg7YisrKWgub3B0aW9uc1tnW2JdWzBdXSYmZ1tiXVsxXS5hcHBseShoLmVsZW1lbnQsaSl9fSxjb250YWluczpmdW5jdGlvbihoLGcpe3JldHVybiBkb2N1bWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9oLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGcpJjE2OmghPT1nJiZoLmNvbnRhaW5zKGcpfSxoYXNTY3JvbGw6ZnVuY3Rpb24oaCxnKXtpZihhKGgpLmNzcyhcIm92ZXJmbG93XCIpPT09XCJoaWRkZW5cIilyZXR1cm4gZmFsc2U7Zz1nJiZnPT09XCJsZWZ0XCI/XCJzY3JvbGxMZWZ0XCI6XCJzY3JvbGxUb3BcIjt2YXIgaT1mYWxzZTtpZihoW2ddPjApcmV0dXJuIHRydWU7aFtnXT0xO2k9aFtnXT4wO2hbZ109MDtyZXR1cm4gaX0saXNPdmVyQXhpczpmdW5jdGlvbihoLGcsaSl7cmV0dXJuIGg+ZyYmaDxnK2l9LGlzT3ZlcjpmdW5jdGlvbihoLGcsaSxiLGYsail7cmV0dXJuIGEudWkuaXNPdmVyQXhpcyhoLGksZikmJlxuYS51aS5pc092ZXJBeGlzKGcsYixqKX19KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEsZCl7aWYoYS5jbGVhbkRhdGEpe3ZhciBjPWEuY2xlYW5EYXRhO2EuY2xlYW5EYXRhPWZ1bmN0aW9uKGgpe2Zvcih2YXIgZz0wLGk7KGk9aFtnXSkhPW51bGw7ZysrKXRyeXthKGkpLnRyaWdnZXJIYW5kbGVyKFwicmVtb3ZlXCIpfWNhdGNoKGIpe31jKGgpfX1lbHNle3ZhciBlPWEuZm4ucmVtb3ZlO2EuZm4ucmVtb3ZlPWZ1bmN0aW9uKGgsZyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2lmKCFnKWlmKCFofHxhLmZpbHRlcihoLFt0aGlzXSkubGVuZ3RoKWEoXCIqXCIsdGhpcykuYWRkKFt0aGlzXSkuZWFjaChmdW5jdGlvbigpe3RyeXthKHRoaXMpLnRyaWdnZXJIYW5kbGVyKFwicmVtb3ZlXCIpfWNhdGNoKGkpe319KTtyZXR1cm4gZS5jYWxsKGEodGhpcyksaCxnKX0pfX1hLndpZGdldD1mdW5jdGlvbihoLGcsaSl7dmFyIGI9aC5zcGxpdChcIi5cIilbMF0sZjtoPWguc3BsaXQoXCIuXCIpWzFdO2Y9YitcIi1cIitoO2lmKCFpKXtpPWc7Zz1hLldpZGdldH1hLmV4cHJbXCI6XCJdW2ZdPVxuZnVuY3Rpb24oail7cmV0dXJuISFhLmRhdGEoaixoKX07YVtiXT1hW2JdfHx7fTthW2JdW2hdPWZ1bmN0aW9uKGosbCl7YXJndW1lbnRzLmxlbmd0aCYmdGhpcy5fY3JlYXRlV2lkZ2V0KGosbCl9O2c9bmV3IGc7Zy5vcHRpb25zPWEuZXh0ZW5kKHRydWUse30sZy5vcHRpb25zKTthW2JdW2hdLnByb3RvdHlwZT1hLmV4dGVuZCh0cnVlLGcse25hbWVzcGFjZTpiLHdpZGdldE5hbWU6aCx3aWRnZXRFdmVudFByZWZpeDphW2JdW2hdLnByb3RvdHlwZS53aWRnZXRFdmVudFByZWZpeHx8aCx3aWRnZXRCYXNlQ2xhc3M6Zn0saSk7YS53aWRnZXQuYnJpZGdlKGgsYVtiXVtoXSl9O2Eud2lkZ2V0LmJyaWRnZT1mdW5jdGlvbihoLGcpe2EuZm5baF09ZnVuY3Rpb24oaSl7dmFyIGI9dHlwZW9mIGk9PT1cInN0cmluZ1wiLGY9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpLGo9dGhpcztpPSFiJiZmLmxlbmd0aD9hLmV4dGVuZC5hcHBseShudWxsLFt0cnVlLGldLmNvbmNhdChmKSk6XG5pO2lmKGImJmkuY2hhckF0KDApPT09XCJfXCIpcmV0dXJuIGo7Yj90aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgbD1hLmRhdGEodGhpcyxoKSxvPWwmJmEuaXNGdW5jdGlvbihsW2ldKT9sW2ldLmFwcGx5KGwsZik6bDtpZihvIT09bCYmbyE9PWQpe2o9bztyZXR1cm4gZmFsc2V9fSk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGw9YS5kYXRhKHRoaXMsaCk7bD9sLm9wdGlvbihpfHx7fSkuX2luaXQoKTphLmRhdGEodGhpcyxoLG5ldyBnKGksdGhpcykpfSk7cmV0dXJuIGp9fTthLldpZGdldD1mdW5jdGlvbihoLGcpe2FyZ3VtZW50cy5sZW5ndGgmJnRoaXMuX2NyZWF0ZVdpZGdldChoLGcpfTthLldpZGdldC5wcm90b3R5cGU9e3dpZGdldE5hbWU6XCJ3aWRnZXRcIix3aWRnZXRFdmVudFByZWZpeDpcIlwiLG9wdGlvbnM6e2Rpc2FibGVkOmZhbHNlfSxfY3JlYXRlV2lkZ2V0OmZ1bmN0aW9uKGgsZyl7YS5kYXRhKGcsdGhpcy53aWRnZXROYW1lLHRoaXMpO3RoaXMuZWxlbWVudD1hKGcpO3RoaXMub3B0aW9ucz1cbmEuZXh0ZW5kKHRydWUse30sdGhpcy5vcHRpb25zLHRoaXMuX2dldENyZWF0ZU9wdGlvbnMoKSxoKTt2YXIgaT10aGlzO3RoaXMuZWxlbWVudC5iaW5kKFwicmVtb3ZlLlwiK3RoaXMud2lkZ2V0TmFtZSxmdW5jdGlvbigpe2kuZGVzdHJveSgpfSk7dGhpcy5fY3JlYXRlKCk7dGhpcy5fdHJpZ2dlcihcImNyZWF0ZVwiKTt0aGlzLl9pbml0KCl9LF9nZXRDcmVhdGVPcHRpb25zOmZ1bmN0aW9uKCl7cmV0dXJuIGEubWV0YWRhdGEmJmEubWV0YWRhdGEuZ2V0KHRoaXMuZWxlbWVudFswXSlbdGhpcy53aWRnZXROYW1lXX0sX2NyZWF0ZTpmdW5jdGlvbigpe30sX2luaXQ6ZnVuY3Rpb24oKXt9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQudW5iaW5kKFwiLlwiK3RoaXMud2lkZ2V0TmFtZSkucmVtb3ZlRGF0YSh0aGlzLndpZGdldE5hbWUpO3RoaXMud2lkZ2V0KCkudW5iaW5kKFwiLlwiK3RoaXMud2lkZ2V0TmFtZSkucmVtb3ZlQXR0cihcImFyaWEtZGlzYWJsZWRcIikucmVtb3ZlQ2xhc3ModGhpcy53aWRnZXRCYXNlQ2xhc3MrXG5cIi1kaXNhYmxlZCB1aS1zdGF0ZS1kaXNhYmxlZFwiKX0sd2lkZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWxlbWVudH0sb3B0aW9uOmZ1bmN0aW9uKGgsZyl7dmFyIGk9aDtpZihhcmd1bWVudHMubGVuZ3RoPT09MClyZXR1cm4gYS5leHRlbmQoe30sdGhpcy5vcHRpb25zKTtpZih0eXBlb2YgaD09PVwic3RyaW5nXCIpe2lmKGc9PT1kKXJldHVybiB0aGlzLm9wdGlvbnNbaF07aT17fTtpW2hdPWd9dGhpcy5fc2V0T3B0aW9ucyhpKTtyZXR1cm4gdGhpc30sX3NldE9wdGlvbnM6ZnVuY3Rpb24oaCl7dmFyIGc9dGhpczthLmVhY2goaCxmdW5jdGlvbihpLGIpe2cuX3NldE9wdGlvbihpLGIpfSk7cmV0dXJuIHRoaXN9LF9zZXRPcHRpb246ZnVuY3Rpb24oaCxnKXt0aGlzLm9wdGlvbnNbaF09ZztpZihoPT09XCJkaXNhYmxlZFwiKXRoaXMud2lkZ2V0KClbZz9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXSh0aGlzLndpZGdldEJhc2VDbGFzcytcIi1kaXNhYmxlZCB1aS1zdGF0ZS1kaXNhYmxlZFwiKS5hdHRyKFwiYXJpYS1kaXNhYmxlZFwiLFxuZyk7cmV0dXJuIHRoaXN9LGVuYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zZXRPcHRpb24oXCJkaXNhYmxlZFwiLGZhbHNlKX0sZGlzYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zZXRPcHRpb24oXCJkaXNhYmxlZFwiLHRydWUpfSxfdHJpZ2dlcjpmdW5jdGlvbihoLGcsaSl7dmFyIGI9dGhpcy5vcHRpb25zW2hdO2c9YS5FdmVudChnKTtnLnR5cGU9KGg9PT10aGlzLndpZGdldEV2ZW50UHJlZml4P2g6dGhpcy53aWRnZXRFdmVudFByZWZpeCtoKS50b0xvd2VyQ2FzZSgpO2k9aXx8e307aWYoZy5vcmlnaW5hbEV2ZW50KXtoPWEuZXZlbnQucHJvcHMubGVuZ3RoO2Zvcih2YXIgZjtoOyl7Zj1hLmV2ZW50LnByb3BzWy0taF07Z1tmXT1nLm9yaWdpbmFsRXZlbnRbZl19fXRoaXMuZWxlbWVudC50cmlnZ2VyKGcsaSk7cmV0dXJuIShhLmlzRnVuY3Rpb24oYikmJmIuY2FsbCh0aGlzLmVsZW1lbnRbMF0sZyxpKT09PWZhbHNlfHxnLmlzRGVmYXVsdFByZXZlbnRlZCgpKX19fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXt2YXIgZD1mYWxzZTthKGRvY3VtZW50KS5tb3VzZXVwKGZ1bmN0aW9uKCl7ZD1mYWxzZX0pO2Eud2lkZ2V0KFwidWkubW91c2VcIix7b3B0aW9uczp7Y2FuY2VsOlwiOmlucHV0LG9wdGlvblwiLGRpc3RhbmNlOjEsZGVsYXk6MH0sX21vdXNlSW5pdDpmdW5jdGlvbigpe3ZhciBjPXRoaXM7dGhpcy5lbGVtZW50LmJpbmQoXCJtb3VzZWRvd24uXCIrdGhpcy53aWRnZXROYW1lLGZ1bmN0aW9uKGUpe3JldHVybiBjLl9tb3VzZURvd24oZSl9KS5iaW5kKFwiY2xpY2suXCIrdGhpcy53aWRnZXROYW1lLGZ1bmN0aW9uKGUpe2lmKHRydWU9PT1hLmRhdGEoZS50YXJnZXQsYy53aWRnZXROYW1lK1wiLnByZXZlbnRDbGlja0V2ZW50XCIpKXthLnJlbW92ZURhdGEoZS50YXJnZXQsYy53aWRnZXROYW1lK1wiLnByZXZlbnRDbGlja0V2ZW50XCIpO2Uuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7cmV0dXJuIGZhbHNlfX0pO3RoaXMuc3RhcnRlZD1mYWxzZX0sX21vdXNlRGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC51bmJpbmQoXCIuXCIrXG50aGlzLndpZGdldE5hbWUpfSxfbW91c2VEb3duOmZ1bmN0aW9uKGMpe2lmKCFkKXt0aGlzLl9tb3VzZVN0YXJ0ZWQmJnRoaXMuX21vdXNlVXAoYyk7dGhpcy5fbW91c2VEb3duRXZlbnQ9Yzt2YXIgZT10aGlzLGg9Yy53aGljaD09MSxnPXR5cGVvZiB0aGlzLm9wdGlvbnMuY2FuY2VsPT1cInN0cmluZ1wiJiZjLnRhcmdldC5ub2RlTmFtZT9hKGMudGFyZ2V0KS5jbG9zZXN0KHRoaXMub3B0aW9ucy5jYW5jZWwpLmxlbmd0aDpmYWxzZTtpZighaHx8Z3x8IXRoaXMuX21vdXNlQ2FwdHVyZShjKSlyZXR1cm4gdHJ1ZTt0aGlzLm1vdXNlRGVsYXlNZXQ9IXRoaXMub3B0aW9ucy5kZWxheTtpZighdGhpcy5tb3VzZURlbGF5TWV0KXRoaXMuX21vdXNlRGVsYXlUaW1lcj1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZS5tb3VzZURlbGF5TWV0PXRydWV9LHRoaXMub3B0aW9ucy5kZWxheSk7aWYodGhpcy5fbW91c2VEaXN0YW5jZU1ldChjKSYmdGhpcy5fbW91c2VEZWxheU1ldChjKSl7dGhpcy5fbW91c2VTdGFydGVkPVxudGhpcy5fbW91c2VTdGFydChjKSE9PWZhbHNlO2lmKCF0aGlzLl9tb3VzZVN0YXJ0ZWQpe2MucHJldmVudERlZmF1bHQoKTtyZXR1cm4gdHJ1ZX19dHJ1ZT09PWEuZGF0YShjLnRhcmdldCx0aGlzLndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIikmJmEucmVtb3ZlRGF0YShjLnRhcmdldCx0aGlzLndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIik7dGhpcy5fbW91c2VNb3ZlRGVsZWdhdGU9ZnVuY3Rpb24oaSl7cmV0dXJuIGUuX21vdXNlTW92ZShpKX07dGhpcy5fbW91c2VVcERlbGVnYXRlPWZ1bmN0aW9uKGkpe3JldHVybiBlLl9tb3VzZVVwKGkpfTthKGRvY3VtZW50KS5iaW5kKFwibW91c2Vtb3ZlLlwiK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSkuYmluZChcIm1vdXNldXAuXCIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSk7Yy5wcmV2ZW50RGVmYXVsdCgpO3JldHVybiBkPXRydWV9fSxfbW91c2VNb3ZlOmZ1bmN0aW9uKGMpe2lmKGEuYnJvd3Nlci5tc2llJiZcbiEoZG9jdW1lbnQuZG9jdW1lbnRNb2RlPj05KSYmIWMuYnV0dG9uKXJldHVybiB0aGlzLl9tb3VzZVVwKGMpO2lmKHRoaXMuX21vdXNlU3RhcnRlZCl7dGhpcy5fbW91c2VEcmFnKGMpO3JldHVybiBjLnByZXZlbnREZWZhdWx0KCl9aWYodGhpcy5fbW91c2VEaXN0YW5jZU1ldChjKSYmdGhpcy5fbW91c2VEZWxheU1ldChjKSkodGhpcy5fbW91c2VTdGFydGVkPXRoaXMuX21vdXNlU3RhcnQodGhpcy5fbW91c2VEb3duRXZlbnQsYykhPT1mYWxzZSk/dGhpcy5fbW91c2VEcmFnKGMpOnRoaXMuX21vdXNlVXAoYyk7cmV0dXJuIXRoaXMuX21vdXNlU3RhcnRlZH0sX21vdXNlVXA6ZnVuY3Rpb24oYyl7YShkb2N1bWVudCkudW5iaW5kKFwibW91c2Vtb3ZlLlwiK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSkudW5iaW5kKFwibW91c2V1cC5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VVcERlbGVnYXRlKTtpZih0aGlzLl9tb3VzZVN0YXJ0ZWQpe3RoaXMuX21vdXNlU3RhcnRlZD1cbmZhbHNlO2MudGFyZ2V0PT10aGlzLl9tb3VzZURvd25FdmVudC50YXJnZXQmJmEuZGF0YShjLnRhcmdldCx0aGlzLndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIix0cnVlKTt0aGlzLl9tb3VzZVN0b3AoYyl9cmV0dXJuIGZhbHNlfSxfbW91c2VEaXN0YW5jZU1ldDpmdW5jdGlvbihjKXtyZXR1cm4gTWF0aC5tYXgoTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVgtYy5wYWdlWCksTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVktYy5wYWdlWSkpPj10aGlzLm9wdGlvbnMuZGlzdGFuY2V9LF9tb3VzZURlbGF5TWV0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubW91c2VEZWxheU1ldH0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oKXt9LF9tb3VzZURyYWc6ZnVuY3Rpb24oKXt9LF9tb3VzZVN0b3A6ZnVuY3Rpb24oKXt9LF9tb3VzZUNhcHR1cmU6ZnVuY3Rpb24oKXtyZXR1cm4gdHJ1ZX19KX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS53aWRnZXQoXCJ1aS5kcmFnZ2FibGVcIixhLnVpLm1vdXNlLHt3aWRnZXRFdmVudFByZWZpeDpcImRyYWdcIixvcHRpb25zOnthZGRDbGFzc2VzOnRydWUsYXBwZW5kVG86XCJwYXJlbnRcIixheGlzOmZhbHNlLGNvbm5lY3RUb1NvcnRhYmxlOmZhbHNlLGNvbnRhaW5tZW50OmZhbHNlLGN1cnNvcjpcImF1dG9cIixjdXJzb3JBdDpmYWxzZSxncmlkOmZhbHNlLGhhbmRsZTpmYWxzZSxoZWxwZXI6XCJvcmlnaW5hbFwiLGlmcmFtZUZpeDpmYWxzZSxvcGFjaXR5OmZhbHNlLHJlZnJlc2hQb3NpdGlvbnM6ZmFsc2UscmV2ZXJ0OmZhbHNlLHJldmVydER1cmF0aW9uOjUwMCxzY29wZTpcImRlZmF1bHRcIixzY3JvbGw6dHJ1ZSxzY3JvbGxTZW5zaXRpdml0eToyMCxzY3JvbGxTcGVlZDoyMCxzbmFwOmZhbHNlLHNuYXBNb2RlOlwiYm90aFwiLHNuYXBUb2xlcmFuY2U6MjAsc3RhY2s6ZmFsc2UsekluZGV4OmZhbHNlfSxfY3JlYXRlOmZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLmhlbHBlcj09XG5cIm9yaWdpbmFsXCImJiEvXig/OnJ8YXxmKS8udGVzdCh0aGlzLmVsZW1lbnQuY3NzKFwicG9zaXRpb25cIikpKXRoaXMuZWxlbWVudFswXS5zdHlsZS5wb3NpdGlvbj1cInJlbGF0aXZlXCI7dGhpcy5vcHRpb25zLmFkZENsYXNzZXMmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWRyYWdnYWJsZVwiKTt0aGlzLm9wdGlvbnMuZGlzYWJsZWQmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWRyYWdnYWJsZS1kaXNhYmxlZFwiKTt0aGlzLl9tb3VzZUluaXQoKX0sZGVzdHJveTpmdW5jdGlvbigpe2lmKHRoaXMuZWxlbWVudC5kYXRhKFwiZHJhZ2dhYmxlXCIpKXt0aGlzLmVsZW1lbnQucmVtb3ZlRGF0YShcImRyYWdnYWJsZVwiKS51bmJpbmQoXCIuZHJhZ2dhYmxlXCIpLnJlbW92ZUNsYXNzKFwidWktZHJhZ2dhYmxlIHVpLWRyYWdnYWJsZS1kcmFnZ2luZyB1aS1kcmFnZ2FibGUtZGlzYWJsZWRcIik7dGhpcy5fbW91c2VEZXN0cm95KCk7cmV0dXJuIHRoaXN9fSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKGQpe3ZhciBjPVxudGhpcy5vcHRpb25zO2lmKHRoaXMuaGVscGVyfHxjLmRpc2FibGVkfHxhKGQudGFyZ2V0KS5pcyhcIi51aS1yZXNpemFibGUtaGFuZGxlXCIpKXJldHVybiBmYWxzZTt0aGlzLmhhbmRsZT10aGlzLl9nZXRIYW5kbGUoZCk7aWYoIXRoaXMuaGFuZGxlKXJldHVybiBmYWxzZTtpZihjLmlmcmFtZUZpeClhKGMuaWZyYW1lRml4PT09dHJ1ZT9cImlmcmFtZVwiOmMuaWZyYW1lRml4KS5lYWNoKGZ1bmN0aW9uKCl7YSgnPGRpdiBjbGFzcz1cInVpLWRyYWdnYWJsZS1pZnJhbWVGaXhcIiBzdHlsZT1cImJhY2tncm91bmQ6ICNmZmY7XCI+PC9kaXY+JykuY3NzKHt3aWR0aDp0aGlzLm9mZnNldFdpZHRoK1wicHhcIixoZWlnaHQ6dGhpcy5vZmZzZXRIZWlnaHQrXCJweFwiLHBvc2l0aW9uOlwiYWJzb2x1dGVcIixvcGFjaXR5OlwiMC4wMDFcIix6SW5kZXg6MUUzfSkuY3NzKGEodGhpcykub2Zmc2V0KCkpLmFwcGVuZFRvKFwiYm9keVwiKX0pO3JldHVybiB0cnVlfSxfbW91c2VTdGFydDpmdW5jdGlvbihkKXt2YXIgYz10aGlzLm9wdGlvbnM7XG50aGlzLmhlbHBlcj10aGlzLl9jcmVhdGVIZWxwZXIoZCk7dGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpO2lmKGEudWkuZGRtYW5hZ2VyKWEudWkuZGRtYW5hZ2VyLmN1cnJlbnQ9dGhpczt0aGlzLl9jYWNoZU1hcmdpbnMoKTt0aGlzLmNzc1Bvc2l0aW9uPXRoaXMuaGVscGVyLmNzcyhcInBvc2l0aW9uXCIpO3RoaXMuc2Nyb2xsUGFyZW50PXRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCgpO3RoaXMub2Zmc2V0PXRoaXMucG9zaXRpb25BYnM9dGhpcy5lbGVtZW50Lm9mZnNldCgpO3RoaXMub2Zmc2V0PXt0b3A6dGhpcy5vZmZzZXQudG9wLXRoaXMubWFyZ2lucy50b3AsbGVmdDp0aGlzLm9mZnNldC5sZWZ0LXRoaXMubWFyZ2lucy5sZWZ0fTthLmV4dGVuZCh0aGlzLm9mZnNldCx7Y2xpY2s6e2xlZnQ6ZC5wYWdlWC10aGlzLm9mZnNldC5sZWZ0LHRvcDpkLnBhZ2VZLXRoaXMub2Zmc2V0LnRvcH0scGFyZW50OnRoaXMuX2dldFBhcmVudE9mZnNldCgpLHJlbGF0aXZlOnRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCl9KTtcbnRoaXMub3JpZ2luYWxQb3NpdGlvbj10aGlzLnBvc2l0aW9uPXRoaXMuX2dlbmVyYXRlUG9zaXRpb24oZCk7dGhpcy5vcmlnaW5hbFBhZ2VYPWQucGFnZVg7dGhpcy5vcmlnaW5hbFBhZ2VZPWQucGFnZVk7Yy5jdXJzb3JBdCYmdGhpcy5fYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcihjLmN1cnNvckF0KTtjLmNvbnRhaW5tZW50JiZ0aGlzLl9zZXRDb250YWlubWVudCgpO2lmKHRoaXMuX3RyaWdnZXIoXCJzdGFydFwiLGQpPT09ZmFsc2Upe3RoaXMuX2NsZWFyKCk7cmV0dXJuIGZhbHNlfXRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKTthLnVpLmRkbWFuYWdlciYmIWMuZHJvcEJlaGF2aW91ciYmYS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModGhpcyxkKTt0aGlzLmhlbHBlci5hZGRDbGFzcyhcInVpLWRyYWdnYWJsZS1kcmFnZ2luZ1wiKTt0aGlzLl9tb3VzZURyYWcoZCx0cnVlKTthLnVpLmRkbWFuYWdlciYmYS51aS5kZG1hbmFnZXIuZHJhZ1N0YXJ0KHRoaXMsZCk7cmV0dXJuIHRydWV9LFxuX21vdXNlRHJhZzpmdW5jdGlvbihkLGMpe3RoaXMucG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbihkKTt0aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKFwiYWJzb2x1dGVcIik7aWYoIWMpe2M9dGhpcy5fdWlIYXNoKCk7aWYodGhpcy5fdHJpZ2dlcihcImRyYWdcIixkLGMpPT09ZmFsc2Upe3RoaXMuX21vdXNlVXAoe30pO3JldHVybiBmYWxzZX10aGlzLnBvc2l0aW9uPWMucG9zaXRpb259aWYoIXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLm9wdGlvbnMuYXhpcyE9XCJ5XCIpdGhpcy5oZWxwZXJbMF0uc3R5bGUubGVmdD10aGlzLnBvc2l0aW9uLmxlZnQrXCJweFwiO2lmKCF0aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5vcHRpb25zLmF4aXMhPVwieFwiKXRoaXMuaGVscGVyWzBdLnN0eWxlLnRvcD10aGlzLnBvc2l0aW9uLnRvcCtcInB4XCI7YS51aS5kZG1hbmFnZXImJmEudWkuZGRtYW5hZ2VyLmRyYWcodGhpcyxkKTtyZXR1cm4gZmFsc2V9LF9tb3VzZVN0b3A6ZnVuY3Rpb24oZCl7dmFyIGM9XG5mYWxzZTtpZihhLnVpLmRkbWFuYWdlciYmIXRoaXMub3B0aW9ucy5kcm9wQmVoYXZpb3VyKWM9YS51aS5kZG1hbmFnZXIuZHJvcCh0aGlzLGQpO2lmKHRoaXMuZHJvcHBlZCl7Yz10aGlzLmRyb3BwZWQ7dGhpcy5kcm9wcGVkPWZhbHNlfWlmKCghdGhpcy5lbGVtZW50WzBdfHwhdGhpcy5lbGVtZW50WzBdLnBhcmVudE5vZGUpJiZ0aGlzLm9wdGlvbnMuaGVscGVyPT1cIm9yaWdpbmFsXCIpcmV0dXJuIGZhbHNlO2lmKHRoaXMub3B0aW9ucy5yZXZlcnQ9PVwiaW52YWxpZFwiJiYhY3x8dGhpcy5vcHRpb25zLnJldmVydD09XCJ2YWxpZFwiJiZjfHx0aGlzLm9wdGlvbnMucmV2ZXJ0PT09dHJ1ZXx8YS5pc0Z1bmN0aW9uKHRoaXMub3B0aW9ucy5yZXZlcnQpJiZ0aGlzLm9wdGlvbnMucmV2ZXJ0LmNhbGwodGhpcy5lbGVtZW50LGMpKXt2YXIgZT10aGlzO2EodGhpcy5oZWxwZXIpLmFuaW1hdGUodGhpcy5vcmlnaW5hbFBvc2l0aW9uLHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnREdXJhdGlvbixcbjEwKSxmdW5jdGlvbigpe2UuX3RyaWdnZXIoXCJzdG9wXCIsZCkhPT1mYWxzZSYmZS5fY2xlYXIoKX0pfWVsc2UgdGhpcy5fdHJpZ2dlcihcInN0b3BcIixkKSE9PWZhbHNlJiZ0aGlzLl9jbGVhcigpO3JldHVybiBmYWxzZX0sX21vdXNlVXA6ZnVuY3Rpb24oZCl7dGhpcy5vcHRpb25zLmlmcmFtZUZpeD09PXRydWUmJmEoXCJkaXYudWktZHJhZ2dhYmxlLWlmcmFtZUZpeFwiKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMpfSk7YS51aS5kZG1hbmFnZXImJmEudWkuZGRtYW5hZ2VyLmRyYWdTdG9wKHRoaXMsZCk7cmV0dXJuIGEudWkubW91c2UucHJvdG90eXBlLl9tb3VzZVVwLmNhbGwodGhpcyxkKX0sY2FuY2VsOmZ1bmN0aW9uKCl7dGhpcy5oZWxwZXIuaXMoXCIudWktZHJhZ2dhYmxlLWRyYWdnaW5nXCIpP3RoaXMuX21vdXNlVXAoe30pOnRoaXMuX2NsZWFyKCk7cmV0dXJuIHRoaXN9LF9nZXRIYW5kbGU6ZnVuY3Rpb24oZCl7dmFyIGM9IXRoaXMub3B0aW9ucy5oYW5kbGV8fFxuIWEodGhpcy5vcHRpb25zLmhhbmRsZSx0aGlzLmVsZW1lbnQpLmxlbmd0aD90cnVlOmZhbHNlO2EodGhpcy5vcHRpb25zLmhhbmRsZSx0aGlzLmVsZW1lbnQpLmZpbmQoXCIqXCIpLmFuZFNlbGYoKS5lYWNoKGZ1bmN0aW9uKCl7aWYodGhpcz09ZC50YXJnZXQpYz10cnVlfSk7cmV0dXJuIGN9LF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24oZCl7dmFyIGM9dGhpcy5vcHRpb25zO2Q9YS5pc0Z1bmN0aW9uKGMuaGVscGVyKT9hKGMuaGVscGVyLmFwcGx5KHRoaXMuZWxlbWVudFswXSxbZF0pKTpjLmhlbHBlcj09XCJjbG9uZVwiP3RoaXMuZWxlbWVudC5jbG9uZSgpLnJlbW92ZUF0dHIoXCJpZFwiKTp0aGlzLmVsZW1lbnQ7ZC5wYXJlbnRzKFwiYm9keVwiKS5sZW5ndGh8fGQuYXBwZW5kVG8oYy5hcHBlbmRUbz09XCJwYXJlbnRcIj90aGlzLmVsZW1lbnRbMF0ucGFyZW50Tm9kZTpjLmFwcGVuZFRvKTtkWzBdIT10aGlzLmVsZW1lbnRbMF0mJiEvKGZpeGVkfGFic29sdXRlKS8udGVzdChkLmNzcyhcInBvc2l0aW9uXCIpKSYmXG5kLmNzcyhcInBvc2l0aW9uXCIsXCJhYnNvbHV0ZVwiKTtyZXR1cm4gZH0sX2FkanVzdE9mZnNldEZyb21IZWxwZXI6ZnVuY3Rpb24oZCl7aWYodHlwZW9mIGQ9PVwic3RyaW5nXCIpZD1kLnNwbGl0KFwiIFwiKTtpZihhLmlzQXJyYXkoZCkpZD17bGVmdDorZFswXSx0b3A6K2RbMV18fDB9O2lmKFwibGVmdFwiaW4gZCl0aGlzLm9mZnNldC5jbGljay5sZWZ0PWQubGVmdCt0aGlzLm1hcmdpbnMubGVmdDtpZihcInJpZ2h0XCJpbiBkKXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC1kLnJpZ2h0K3RoaXMubWFyZ2lucy5sZWZ0O2lmKFwidG9wXCJpbiBkKXRoaXMub2Zmc2V0LmNsaWNrLnRvcD1kLnRvcCt0aGlzLm1hcmdpbnMudG9wO2lmKFwiYm90dG9tXCJpbiBkKXRoaXMub2Zmc2V0LmNsaWNrLnRvcD10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC1kLmJvdHRvbSt0aGlzLm1hcmdpbnMudG9wfSxfZ2V0UGFyZW50T2Zmc2V0OmZ1bmN0aW9uKCl7dGhpcy5vZmZzZXRQYXJlbnQ9XG50aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTt2YXIgZD10aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTtpZih0aGlzLmNzc1Bvc2l0aW9uPT1cImFic29sdXRlXCImJnRoaXMuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmYS51aS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSkpe2QubGVmdCs9dGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpO2QudG9wKz10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKX1pZih0aGlzLm9mZnNldFBhcmVudFswXT09ZG9jdW1lbnQuYm9keXx8dGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZSYmdGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpPT1cImh0bWxcIiYmYS5icm93c2VyLm1zaWUpZD17dG9wOjAsbGVmdDowfTtyZXR1cm57dG9wOmQudG9wKyhwYXJzZUludCh0aGlzLm9mZnNldFBhcmVudC5jc3MoXCJib3JkZXJUb3BXaWR0aFwiKSwxMCl8fDApLGxlZnQ6ZC5sZWZ0KyhwYXJzZUludCh0aGlzLm9mZnNldFBhcmVudC5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksXG4xMCl8fDApfX0sX2dldFJlbGF0aXZlT2Zmc2V0OmZ1bmN0aW9uKCl7aWYodGhpcy5jc3NQb3NpdGlvbj09XCJyZWxhdGl2ZVwiKXt2YXIgZD10aGlzLmVsZW1lbnQucG9zaXRpb24oKTtyZXR1cm57dG9wOmQudG9wLShwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoXCJ0b3BcIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSxsZWZ0OmQubGVmdC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKFwibGVmdFwiKSwxMCl8fDApK3RoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKX19ZWxzZSByZXR1cm57dG9wOjAsbGVmdDowfX0sX2NhY2hlTWFyZ2luczpmdW5jdGlvbigpe3RoaXMubWFyZ2lucz17bGVmdDpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKFwibWFyZ2luTGVmdFwiKSwxMCl8fDAsdG9wOnBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoXCJtYXJnaW5Ub3BcIiksMTApfHwwLHJpZ2h0OnBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoXCJtYXJnaW5SaWdodFwiKSwxMCl8fDAsYm90dG9tOnBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoXCJtYXJnaW5Cb3R0b21cIiksXG4xMCl8fDB9fSxfY2FjaGVIZWxwZXJQcm9wb3J0aW9uczpmdW5jdGlvbigpe3RoaXMuaGVscGVyUHJvcG9ydGlvbnM9e3dpZHRoOnRoaXMuaGVscGVyLm91dGVyV2lkdGgoKSxoZWlnaHQ6dGhpcy5oZWxwZXIub3V0ZXJIZWlnaHQoKX19LF9zZXRDb250YWlubWVudDpmdW5jdGlvbigpe3ZhciBkPXRoaXMub3B0aW9ucztpZihkLmNvbnRhaW5tZW50PT1cInBhcmVudFwiKWQuY29udGFpbm1lbnQ9dGhpcy5oZWxwZXJbMF0ucGFyZW50Tm9kZTtpZihkLmNvbnRhaW5tZW50PT1cImRvY3VtZW50XCJ8fGQuY29udGFpbm1lbnQ9PVwid2luZG93XCIpdGhpcy5jb250YWlubWVudD1bZC5jb250YWlubWVudD09XCJkb2N1bWVudFwiPzA6YSh3aW5kb3cpLnNjcm9sbExlZnQoKS10aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LGQuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcIj8wOmEod2luZG93KS5zY3JvbGxUb3AoKS10aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcCxcbihkLmNvbnRhaW5tZW50PT1cImRvY3VtZW50XCI/MDphKHdpbmRvdykuc2Nyb2xsTGVmdCgpKSthKGQuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcIj9kb2N1bWVudDp3aW5kb3cpLndpZHRoKCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdCwoZC5jb250YWlubWVudD09XCJkb2N1bWVudFwiPzA6YSh3aW5kb3cpLnNjcm9sbFRvcCgpKSsoYShkLmNvbnRhaW5tZW50PT1cImRvY3VtZW50XCI/ZG9jdW1lbnQ6d2luZG93KS5oZWlnaHQoKXx8ZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcF07aWYoIS9eKGRvY3VtZW50fHdpbmRvd3xwYXJlbnQpJC8udGVzdChkLmNvbnRhaW5tZW50KSYmZC5jb250YWlubWVudC5jb25zdHJ1Y3RvciE9QXJyYXkpe2Q9YShkLmNvbnRhaW5tZW50KTt2YXIgYz1kWzBdO2lmKGMpe2Qub2Zmc2V0KCk7dmFyIGU9YShjKS5jc3MoXCJvdmVyZmxvd1wiKSE9XG5cImhpZGRlblwiO3RoaXMuY29udGFpbm1lbnQ9WyhwYXJzZUludChhKGMpLmNzcyhcImJvcmRlckxlZnRXaWR0aFwiKSwxMCl8fDApKyhwYXJzZUludChhKGMpLmNzcyhcInBhZGRpbmdMZWZ0XCIpLDEwKXx8MCksKHBhcnNlSW50KGEoYykuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKSsocGFyc2VJbnQoYShjKS5jc3MoXCJwYWRkaW5nVG9wXCIpLDEwKXx8MCksKGU/TWF0aC5tYXgoYy5zY3JvbGxXaWR0aCxjLm9mZnNldFdpZHRoKTpjLm9mZnNldFdpZHRoKS0ocGFyc2VJbnQoYShjKS5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKS0ocGFyc2VJbnQoYShjKS5jc3MoXCJwYWRkaW5nUmlnaHRcIiksMTApfHwwKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LXRoaXMubWFyZ2lucy5yaWdodCwoZT9NYXRoLm1heChjLnNjcm9sbEhlaWdodCxjLm9mZnNldEhlaWdodCk6Yy5vZmZzZXRIZWlnaHQpLShwYXJzZUludChhKGMpLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLFxuMTApfHwwKS0ocGFyc2VJbnQoYShjKS5jc3MoXCJwYWRkaW5nQm90dG9tXCIpLDEwKXx8MCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcC10aGlzLm1hcmdpbnMuYm90dG9tXTt0aGlzLnJlbGF0aXZlX2NvbnRhaW5lcj1kfX1lbHNlIGlmKGQuY29udGFpbm1lbnQuY29uc3RydWN0b3I9PUFycmF5KXRoaXMuY29udGFpbm1lbnQ9ZC5jb250YWlubWVudH0sX2NvbnZlcnRQb3NpdGlvblRvOmZ1bmN0aW9uKGQsYyl7aWYoIWMpYz10aGlzLnBvc2l0aW9uO2Q9ZD09XCJhYnNvbHV0ZVwiPzE6LTE7dmFyIGU9dGhpcy5jc3NQb3NpdGlvbj09XCJhYnNvbHV0ZVwiJiYhKHRoaXMuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmYS51aS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSkpP3RoaXMub2Zmc2V0UGFyZW50OnRoaXMuc2Nyb2xsUGFyZW50LGg9LyhodG1sfGJvZHkpL2kudGVzdChlWzBdLnRhZ05hbWUpO3JldHVybnt0b3A6Yy50b3ArXG50aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AqZCt0aGlzLm9mZnNldC5wYXJlbnQudG9wKmQtKGEuYnJvd3Nlci5zYWZhcmkmJmEuYnJvd3Nlci52ZXJzaW9uPDUyNiYmdGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPzA6KHRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCk6aD8wOmUuc2Nyb2xsVG9wKCkpKmQpLGxlZnQ6Yy5sZWZ0K3RoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQqZCt0aGlzLm9mZnNldC5wYXJlbnQubGVmdCpkLShhLmJyb3dzZXIuc2FmYXJpJiZhLmJyb3dzZXIudmVyc2lvbjw1MjYmJnRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8wOih0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTpoPzA6ZS5zY3JvbGxMZWZ0KCkpKmQpfX0sX2dlbmVyYXRlUG9zaXRpb246ZnVuY3Rpb24oZCl7dmFyIGM9dGhpcy5vcHRpb25zLGU9dGhpcy5jc3NQb3NpdGlvbj09XCJhYnNvbHV0ZVwiJiZcbiEodGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZhLnVpLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSk/dGhpcy5vZmZzZXRQYXJlbnQ6dGhpcy5zY3JvbGxQYXJlbnQsaD0vKGh0bWx8Ym9keSkvaS50ZXN0KGVbMF0udGFnTmFtZSksZz1kLnBhZ2VYLGk9ZC5wYWdlWTtpZih0aGlzLm9yaWdpbmFsUG9zaXRpb24pe3ZhciBiO2lmKHRoaXMuY29udGFpbm1lbnQpe2lmKHRoaXMucmVsYXRpdmVfY29udGFpbmVyKXtiPXRoaXMucmVsYXRpdmVfY29udGFpbmVyLm9mZnNldCgpO2I9W3RoaXMuY29udGFpbm1lbnRbMF0rYi5sZWZ0LHRoaXMuY29udGFpbm1lbnRbMV0rYi50b3AsdGhpcy5jb250YWlubWVudFsyXStiLmxlZnQsdGhpcy5jb250YWlubWVudFszXStiLnRvcF19ZWxzZSBiPXRoaXMuY29udGFpbm1lbnQ7aWYoZC5wYWdlWC10aGlzLm9mZnNldC5jbGljay5sZWZ0PGJbMF0pZz1iWzBdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQ7XG5pZihkLnBhZ2VZLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDxiWzFdKWk9YlsxXSt0aGlzLm9mZnNldC5jbGljay50b3A7aWYoZC5wYWdlWC10aGlzLm9mZnNldC5jbGljay5sZWZ0PmJbMl0pZz1iWzJdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQ7aWYoZC5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A+YlszXSlpPWJbM10rdGhpcy5vZmZzZXQuY2xpY2sudG9wfWlmKGMuZ3JpZCl7aT1jLmdyaWRbMV0/dGhpcy5vcmlnaW5hbFBhZ2VZK01hdGgucm91bmQoKGktdGhpcy5vcmlnaW5hbFBhZ2VZKS9jLmdyaWRbMV0pKmMuZ3JpZFsxXTp0aGlzLm9yaWdpbmFsUGFnZVk7aT1iPyEoaS10aGlzLm9mZnNldC5jbGljay50b3A8YlsxXXx8aS10aGlzLm9mZnNldC5jbGljay50b3A+YlszXSk/aTohKGktdGhpcy5vZmZzZXQuY2xpY2sudG9wPGJbMV0pP2ktYy5ncmlkWzFdOmkrYy5ncmlkWzFdOmk7Zz1jLmdyaWRbMF0/dGhpcy5vcmlnaW5hbFBhZ2VYK01hdGgucm91bmQoKGctdGhpcy5vcmlnaW5hbFBhZ2VYKS9cbmMuZ3JpZFswXSkqYy5ncmlkWzBdOnRoaXMub3JpZ2luYWxQYWdlWDtnPWI/IShnLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ8YlswXXx8Zy10aGlzLm9mZnNldC5jbGljay5sZWZ0PmJbMl0pP2c6IShnLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ8YlswXSk/Zy1jLmdyaWRbMF06ZytjLmdyaWRbMF06Z319cmV0dXJue3RvcDppLXRoaXMub2Zmc2V0LmNsaWNrLnRvcC10aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcCsoYS5icm93c2VyLnNhZmFyaSYmYS5icm93c2VyLnZlcnNpb248NTI2JiZ0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/MDp0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpOmg/MDplLnNjcm9sbFRvcCgpKSxsZWZ0OmctdGhpcy5vZmZzZXQuY2xpY2subGVmdC10aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0KyhhLmJyb3dzZXIuc2FmYXJpJiZhLmJyb3dzZXIudmVyc2lvbjxcbjUyNiYmdGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPzA6dGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk6aD8wOmUuc2Nyb2xsTGVmdCgpKX19LF9jbGVhcjpmdW5jdGlvbigpe3RoaXMuaGVscGVyLnJlbW92ZUNsYXNzKFwidWktZHJhZ2dhYmxlLWRyYWdnaW5nXCIpO3RoaXMuaGVscGVyWzBdIT10aGlzLmVsZW1lbnRbMF0mJiF0aGlzLmNhbmNlbEhlbHBlclJlbW92YWwmJnRoaXMuaGVscGVyLnJlbW92ZSgpO3RoaXMuaGVscGVyPW51bGw7dGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsPWZhbHNlfSxfdHJpZ2dlcjpmdW5jdGlvbihkLGMsZSl7ZT1lfHx0aGlzLl91aUhhc2goKTthLnVpLnBsdWdpbi5jYWxsKHRoaXMsZCxbYyxlXSk7aWYoZD09XCJkcmFnXCIpdGhpcy5wb3NpdGlvbkFicz10aGlzLl9jb252ZXJ0UG9zaXRpb25UbyhcImFic29sdXRlXCIpO3JldHVybiBhLldpZGdldC5wcm90b3R5cGUuX3RyaWdnZXIuY2FsbCh0aGlzLGQsYyxcbmUpfSxwbHVnaW5zOnt9LF91aUhhc2g6ZnVuY3Rpb24oKXtyZXR1cm57aGVscGVyOnRoaXMuaGVscGVyLHBvc2l0aW9uOnRoaXMucG9zaXRpb24sb3JpZ2luYWxQb3NpdGlvbjp0aGlzLm9yaWdpbmFsUG9zaXRpb24sb2Zmc2V0OnRoaXMucG9zaXRpb25BYnN9fX0pO2EuZXh0ZW5kKGEudWkuZHJhZ2dhYmxlLHt2ZXJzaW9uOlwiMS44LjE2XCJ9KTthLnVpLnBsdWdpbi5hZGQoXCJkcmFnZ2FibGVcIixcImNvbm5lY3RUb1NvcnRhYmxlXCIse3N0YXJ0OmZ1bmN0aW9uKGQsYyl7dmFyIGU9YSh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLGg9ZS5vcHRpb25zLGc9YS5leHRlbmQoe30sYyx7aXRlbTplLmVsZW1lbnR9KTtlLnNvcnRhYmxlcz1bXTthKGguY29ubmVjdFRvU29ydGFibGUpLmVhY2goZnVuY3Rpb24oKXt2YXIgaT1hLmRhdGEodGhpcyxcInNvcnRhYmxlXCIpO2lmKGkmJiFpLm9wdGlvbnMuZGlzYWJsZWQpe2Uuc29ydGFibGVzLnB1c2goe2luc3RhbmNlOmksc2hvdWxkUmV2ZXJ0Omkub3B0aW9ucy5yZXZlcnR9KTtcbmkucmVmcmVzaFBvc2l0aW9ucygpO2kuX3RyaWdnZXIoXCJhY3RpdmF0ZVwiLGQsZyl9fSl9LHN0b3A6ZnVuY3Rpb24oZCxjKXt2YXIgZT1hKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIiksaD1hLmV4dGVuZCh7fSxjLHtpdGVtOmUuZWxlbWVudH0pO2EuZWFjaChlLnNvcnRhYmxlcyxmdW5jdGlvbigpe2lmKHRoaXMuaW5zdGFuY2UuaXNPdmVyKXt0aGlzLmluc3RhbmNlLmlzT3Zlcj0wO2UuY2FuY2VsSGVscGVyUmVtb3ZhbD10cnVlO3RoaXMuaW5zdGFuY2UuY2FuY2VsSGVscGVyUmVtb3ZhbD1mYWxzZTtpZih0aGlzLnNob3VsZFJldmVydCl0aGlzLmluc3RhbmNlLm9wdGlvbnMucmV2ZXJ0PXRydWU7dGhpcy5pbnN0YW5jZS5fbW91c2VTdG9wKGQpO3RoaXMuaW5zdGFuY2Uub3B0aW9ucy5oZWxwZXI9dGhpcy5pbnN0YW5jZS5vcHRpb25zLl9oZWxwZXI7ZS5vcHRpb25zLmhlbHBlcj09XCJvcmlnaW5hbFwiJiZ0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtLmNzcyh7dG9wOlwiYXV0b1wiLGxlZnQ6XCJhdXRvXCJ9KX1lbHNle3RoaXMuaW5zdGFuY2UuY2FuY2VsSGVscGVyUmVtb3ZhbD1cbmZhbHNlO3RoaXMuaW5zdGFuY2UuX3RyaWdnZXIoXCJkZWFjdGl2YXRlXCIsZCxoKX19KX0sZHJhZzpmdW5jdGlvbihkLGMpe3ZhciBlPWEodGhpcykuZGF0YShcImRyYWdnYWJsZVwiKSxoPXRoaXM7YS5lYWNoKGUuc29ydGFibGVzLGZ1bmN0aW9uKCl7dGhpcy5pbnN0YW5jZS5wb3NpdGlvbkFicz1lLnBvc2l0aW9uQWJzO3RoaXMuaW5zdGFuY2UuaGVscGVyUHJvcG9ydGlvbnM9ZS5oZWxwZXJQcm9wb3J0aW9uczt0aGlzLmluc3RhbmNlLm9mZnNldC5jbGljaz1lLm9mZnNldC5jbGljaztpZih0aGlzLmluc3RhbmNlLl9pbnRlcnNlY3RzV2l0aCh0aGlzLmluc3RhbmNlLmNvbnRhaW5lckNhY2hlKSl7aWYoIXRoaXMuaW5zdGFuY2UuaXNPdmVyKXt0aGlzLmluc3RhbmNlLmlzT3Zlcj0xO3RoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW09YShoKS5jbG9uZSgpLnJlbW92ZUF0dHIoXCJpZFwiKS5hcHBlbmRUbyh0aGlzLmluc3RhbmNlLmVsZW1lbnQpLmRhdGEoXCJzb3J0YWJsZS1pdGVtXCIsdHJ1ZSk7XG50aGlzLmluc3RhbmNlLm9wdGlvbnMuX2hlbHBlcj10aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyO3RoaXMuaW5zdGFuY2Uub3B0aW9ucy5oZWxwZXI9ZnVuY3Rpb24oKXtyZXR1cm4gYy5oZWxwZXJbMF19O2QudGFyZ2V0PXRoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW1bMF07dGhpcy5pbnN0YW5jZS5fbW91c2VDYXB0dXJlKGQsdHJ1ZSk7dGhpcy5pbnN0YW5jZS5fbW91c2VTdGFydChkLHRydWUsdHJ1ZSk7dGhpcy5pbnN0YW5jZS5vZmZzZXQuY2xpY2sudG9wPWUub2Zmc2V0LmNsaWNrLnRvcDt0aGlzLmluc3RhbmNlLm9mZnNldC5jbGljay5sZWZ0PWUub2Zmc2V0LmNsaWNrLmxlZnQ7dGhpcy5pbnN0YW5jZS5vZmZzZXQucGFyZW50LmxlZnQtPWUub2Zmc2V0LnBhcmVudC5sZWZ0LXRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC5sZWZ0O3RoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC50b3AtPWUub2Zmc2V0LnBhcmVudC50b3AtdGhpcy5pbnN0YW5jZS5vZmZzZXQucGFyZW50LnRvcDtcbmUuX3RyaWdnZXIoXCJ0b1NvcnRhYmxlXCIsZCk7ZS5kcm9wcGVkPXRoaXMuaW5zdGFuY2UuZWxlbWVudDtlLmN1cnJlbnRJdGVtPWUuZWxlbWVudDt0aGlzLmluc3RhbmNlLmZyb21PdXRzaWRlPWV9dGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbSYmdGhpcy5pbnN0YW5jZS5fbW91c2VEcmFnKGQpfWVsc2UgaWYodGhpcy5pbnN0YW5jZS5pc092ZXIpe3RoaXMuaW5zdGFuY2UuaXNPdmVyPTA7dGhpcy5pbnN0YW5jZS5jYW5jZWxIZWxwZXJSZW1vdmFsPXRydWU7dGhpcy5pbnN0YW5jZS5vcHRpb25zLnJldmVydD1mYWxzZTt0aGlzLmluc3RhbmNlLl90cmlnZ2VyKFwib3V0XCIsZCx0aGlzLmluc3RhbmNlLl91aUhhc2godGhpcy5pbnN0YW5jZSkpO3RoaXMuaW5zdGFuY2UuX21vdXNlU3RvcChkLHRydWUpO3RoaXMuaW5zdGFuY2Uub3B0aW9ucy5oZWxwZXI9dGhpcy5pbnN0YW5jZS5vcHRpb25zLl9oZWxwZXI7dGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbS5yZW1vdmUoKTt0aGlzLmluc3RhbmNlLnBsYWNlaG9sZGVyJiZcbnRoaXMuaW5zdGFuY2UucGxhY2Vob2xkZXIucmVtb3ZlKCk7ZS5fdHJpZ2dlcihcImZyb21Tb3J0YWJsZVwiLGQpO2UuZHJvcHBlZD1mYWxzZX19KX19KTthLnVpLnBsdWdpbi5hZGQoXCJkcmFnZ2FibGVcIixcImN1cnNvclwiLHtzdGFydDpmdW5jdGlvbigpe3ZhciBkPWEoXCJib2R5XCIpLGM9YSh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLm9wdGlvbnM7aWYoZC5jc3MoXCJjdXJzb3JcIikpYy5fY3Vyc29yPWQuY3NzKFwiY3Vyc29yXCIpO2QuY3NzKFwiY3Vyc29yXCIsYy5jdXJzb3IpfSxzdG9wOmZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLm9wdGlvbnM7ZC5fY3Vyc29yJiZhKFwiYm9keVwiKS5jc3MoXCJjdXJzb3JcIixkLl9jdXJzb3IpfX0pO2EudWkucGx1Z2luLmFkZChcImRyYWdnYWJsZVwiLFwib3BhY2l0eVwiLHtzdGFydDpmdW5jdGlvbihkLGMpe2Q9YShjLmhlbHBlcik7Yz1hKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIikub3B0aW9ucztpZihkLmNzcyhcIm9wYWNpdHlcIikpYy5fb3BhY2l0eT1cbmQuY3NzKFwib3BhY2l0eVwiKTtkLmNzcyhcIm9wYWNpdHlcIixjLm9wYWNpdHkpfSxzdG9wOmZ1bmN0aW9uKGQsYyl7ZD1hKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIikub3B0aW9ucztkLl9vcGFjaXR5JiZhKGMuaGVscGVyKS5jc3MoXCJvcGFjaXR5XCIsZC5fb3BhY2l0eSl9fSk7YS51aS5wbHVnaW4uYWRkKFwiZHJhZ2dhYmxlXCIsXCJzY3JvbGxcIix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIik7aWYoZC5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZkLnNjcm9sbFBhcmVudFswXS50YWdOYW1lIT1cIkhUTUxcIilkLm92ZXJmbG93T2Zmc2V0PWQuc2Nyb2xsUGFyZW50Lm9mZnNldCgpfSxkcmFnOmZ1bmN0aW9uKGQpe3ZhciBjPWEodGhpcykuZGF0YShcImRyYWdnYWJsZVwiKSxlPWMub3B0aW9ucyxoPWZhbHNlO2lmKGMuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmYy5zY3JvbGxQYXJlbnRbMF0udGFnTmFtZSE9XCJIVE1MXCIpe2lmKCFlLmF4aXN8fGUuYXhpcyE9XG5cInhcIilpZihjLm92ZXJmbG93T2Zmc2V0LnRvcCtjLnNjcm9sbFBhcmVudFswXS5vZmZzZXRIZWlnaHQtZC5wYWdlWTxlLnNjcm9sbFNlbnNpdGl2aXR5KWMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1oPWMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCtlLnNjcm9sbFNwZWVkO2Vsc2UgaWYoZC5wYWdlWS1jLm92ZXJmbG93T2Zmc2V0LnRvcDxlLnNjcm9sbFNlbnNpdGl2aXR5KWMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1oPWMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcC1lLnNjcm9sbFNwZWVkO2lmKCFlLmF4aXN8fGUuYXhpcyE9XCJ5XCIpaWYoYy5vdmVyZmxvd09mZnNldC5sZWZ0K2Muc2Nyb2xsUGFyZW50WzBdLm9mZnNldFdpZHRoLWQucGFnZVg8ZS5zY3JvbGxTZW5zaXRpdml0eSljLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0PWg9Yy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdCtlLnNjcm9sbFNwZWVkO2Vsc2UgaWYoZC5wYWdlWC1jLm92ZXJmbG93T2Zmc2V0LmxlZnQ8XG5lLnNjcm9sbFNlbnNpdGl2aXR5KWMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQ9aD1jLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0LWUuc2Nyb2xsU3BlZWR9ZWxzZXtpZighZS5heGlzfHxlLmF4aXMhPVwieFwiKWlmKGQucGFnZVktYShkb2N1bWVudCkuc2Nyb2xsVG9wKCk8ZS5zY3JvbGxTZW5zaXRpdml0eSloPWEoZG9jdW1lbnQpLnNjcm9sbFRvcChhKGRvY3VtZW50KS5zY3JvbGxUb3AoKS1lLnNjcm9sbFNwZWVkKTtlbHNlIGlmKGEod2luZG93KS5oZWlnaHQoKS0oZC5wYWdlWS1hKGRvY3VtZW50KS5zY3JvbGxUb3AoKSk8ZS5zY3JvbGxTZW5zaXRpdml0eSloPWEoZG9jdW1lbnQpLnNjcm9sbFRvcChhKGRvY3VtZW50KS5zY3JvbGxUb3AoKStlLnNjcm9sbFNwZWVkKTtpZighZS5heGlzfHxlLmF4aXMhPVwieVwiKWlmKGQucGFnZVgtYShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpPGUuc2Nyb2xsU2Vuc2l0aXZpdHkpaD1hKGRvY3VtZW50KS5zY3JvbGxMZWZ0KGEoZG9jdW1lbnQpLnNjcm9sbExlZnQoKS1cbmUuc2Nyb2xsU3BlZWQpO2Vsc2UgaWYoYSh3aW5kb3cpLndpZHRoKCktKGQucGFnZVgtYShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpKTxlLnNjcm9sbFNlbnNpdGl2aXR5KWg9YShkb2N1bWVudCkuc2Nyb2xsTGVmdChhKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkrZS5zY3JvbGxTcGVlZCl9aCE9PWZhbHNlJiZhLnVpLmRkbWFuYWdlciYmIWUuZHJvcEJlaGF2aW91ciYmYS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoYyxkKX19KTthLnVpLnBsdWdpbi5hZGQoXCJkcmFnZ2FibGVcIixcInNuYXBcIix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIiksYz1kLm9wdGlvbnM7ZC5zbmFwRWxlbWVudHM9W107YShjLnNuYXAuY29uc3RydWN0b3IhPVN0cmluZz9jLnNuYXAuaXRlbXN8fFwiOmRhdGEoZHJhZ2dhYmxlKVwiOmMuc25hcCkuZWFjaChmdW5jdGlvbigpe3ZhciBlPWEodGhpcyksaD1lLm9mZnNldCgpO3RoaXMhPWQuZWxlbWVudFswXSYmZC5zbmFwRWxlbWVudHMucHVzaCh7aXRlbTp0aGlzLFxud2lkdGg6ZS5vdXRlcldpZHRoKCksaGVpZ2h0OmUub3V0ZXJIZWlnaHQoKSx0b3A6aC50b3AsbGVmdDpoLmxlZnR9KX0pfSxkcmFnOmZ1bmN0aW9uKGQsYyl7Zm9yKHZhciBlPWEodGhpcykuZGF0YShcImRyYWdnYWJsZVwiKSxoPWUub3B0aW9ucyxnPWguc25hcFRvbGVyYW5jZSxpPWMub2Zmc2V0LmxlZnQsYj1pK2UuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsZj1jLm9mZnNldC50b3Asaj1mK2UuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LGw9ZS5zbmFwRWxlbWVudHMubGVuZ3RoLTE7bD49MDtsLS0pe3ZhciBvPWUuc25hcEVsZW1lbnRzW2xdLmxlZnQsbj1vK2Uuc25hcEVsZW1lbnRzW2xdLndpZHRoLGs9ZS5zbmFwRWxlbWVudHNbbF0udG9wLG09aytlLnNuYXBFbGVtZW50c1tsXS5oZWlnaHQ7aWYoby1nPGkmJmk8bitnJiZrLWc8ZiYmZjxtK2d8fG8tZzxpJiZpPG4rZyYmay1nPGomJmo8bStnfHxvLWc8YiYmYjxuK2cmJmstZzxmJiZmPG0rZ3x8by1nPGImJmI8bitnJiZrLWc8aiYmXG5qPG0rZyl7aWYoaC5zbmFwTW9kZSE9XCJpbm5lclwiKXt2YXIgcD1NYXRoLmFicyhrLWopPD1nLHE9TWF0aC5hYnMobS1mKTw9ZyxzPU1hdGguYWJzKG8tYik8PWcscj1NYXRoLmFicyhuLWkpPD1nO2lmKHApYy5wb3NpdGlvbi50b3A9ZS5fY29udmVydFBvc2l0aW9uVG8oXCJyZWxhdGl2ZVwiLHt0b3A6ay1lLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxsZWZ0OjB9KS50b3AtZS5tYXJnaW5zLnRvcDtpZihxKWMucG9zaXRpb24udG9wPWUuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOm0sbGVmdDowfSkudG9wLWUubWFyZ2lucy50b3A7aWYocyljLnBvc2l0aW9uLmxlZnQ9ZS5fY29udmVydFBvc2l0aW9uVG8oXCJyZWxhdGl2ZVwiLHt0b3A6MCxsZWZ0Om8tZS5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aH0pLmxlZnQtZS5tYXJnaW5zLmxlZnQ7aWYociljLnBvc2l0aW9uLmxlZnQ9ZS5fY29udmVydFBvc2l0aW9uVG8oXCJyZWxhdGl2ZVwiLHt0b3A6MCxsZWZ0Om59KS5sZWZ0LWUubWFyZ2lucy5sZWZ0fXZhciB1PVxucHx8cXx8c3x8cjtpZihoLnNuYXBNb2RlIT1cIm91dGVyXCIpe3A9TWF0aC5hYnMoay1mKTw9ZztxPU1hdGguYWJzKG0taik8PWc7cz1NYXRoLmFicyhvLWkpPD1nO3I9TWF0aC5hYnMobi1iKTw9ZztpZihwKWMucG9zaXRpb24udG9wPWUuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOmssbGVmdDowfSkudG9wLWUubWFyZ2lucy50b3A7aWYocSljLnBvc2l0aW9uLnRvcD1lLl9jb252ZXJ0UG9zaXRpb25UbyhcInJlbGF0aXZlXCIse3RvcDptLWUuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LGxlZnQ6MH0pLnRvcC1lLm1hcmdpbnMudG9wO2lmKHMpYy5wb3NpdGlvbi5sZWZ0PWUuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOjAsbGVmdDpvfSkubGVmdC1lLm1hcmdpbnMubGVmdDtpZihyKWMucG9zaXRpb24ubGVmdD1lLl9jb252ZXJ0UG9zaXRpb25UbyhcInJlbGF0aXZlXCIse3RvcDowLGxlZnQ6bi1lLmhlbHBlclByb3BvcnRpb25zLndpZHRofSkubGVmdC1lLm1hcmdpbnMubGVmdH1pZighZS5zbmFwRWxlbWVudHNbbF0uc25hcHBpbmcmJlxuKHB8fHF8fHN8fHJ8fHUpKWUub3B0aW9ucy5zbmFwLnNuYXAmJmUub3B0aW9ucy5zbmFwLnNuYXAuY2FsbChlLmVsZW1lbnQsZCxhLmV4dGVuZChlLl91aUhhc2goKSx7c25hcEl0ZW06ZS5zbmFwRWxlbWVudHNbbF0uaXRlbX0pKTtlLnNuYXBFbGVtZW50c1tsXS5zbmFwcGluZz1wfHxxfHxzfHxyfHx1fWVsc2V7ZS5zbmFwRWxlbWVudHNbbF0uc25hcHBpbmcmJmUub3B0aW9ucy5zbmFwLnJlbGVhc2UmJmUub3B0aW9ucy5zbmFwLnJlbGVhc2UuY2FsbChlLmVsZW1lbnQsZCxhLmV4dGVuZChlLl91aUhhc2goKSx7c25hcEl0ZW06ZS5zbmFwRWxlbWVudHNbbF0uaXRlbX0pKTtlLnNuYXBFbGVtZW50c1tsXS5zbmFwcGluZz1mYWxzZX19fX0pO2EudWkucGx1Z2luLmFkZChcImRyYWdnYWJsZVwiLFwic3RhY2tcIix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIikub3B0aW9ucztkPWEubWFrZUFycmF5KGEoZC5zdGFjaykpLnNvcnQoZnVuY3Rpb24oZSxoKXtyZXR1cm4ocGFyc2VJbnQoYShlKS5jc3MoXCJ6SW5kZXhcIiksXG4xMCl8fDApLShwYXJzZUludChhKGgpLmNzcyhcInpJbmRleFwiKSwxMCl8fDApfSk7aWYoZC5sZW5ndGgpe3ZhciBjPXBhcnNlSW50KGRbMF0uc3R5bGUuekluZGV4KXx8MDthKGQpLmVhY2goZnVuY3Rpb24oZSl7dGhpcy5zdHlsZS56SW5kZXg9YytlfSk7dGhpc1swXS5zdHlsZS56SW5kZXg9YytkLmxlbmd0aH19fSk7YS51aS5wbHVnaW4uYWRkKFwiZHJhZ2dhYmxlXCIsXCJ6SW5kZXhcIix7c3RhcnQ6ZnVuY3Rpb24oZCxjKXtkPWEoYy5oZWxwZXIpO2M9YSh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLm9wdGlvbnM7aWYoZC5jc3MoXCJ6SW5kZXhcIikpYy5fekluZGV4PWQuY3NzKFwiekluZGV4XCIpO2QuY3NzKFwiekluZGV4XCIsYy56SW5kZXgpfSxzdG9wOmZ1bmN0aW9uKGQsYyl7ZD1hKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIikub3B0aW9ucztkLl96SW5kZXgmJmEoYy5oZWxwZXIpLmNzcyhcInpJbmRleFwiLGQuX3pJbmRleCl9fSl9KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2Eud2lkZ2V0KFwidWkuZHJvcHBhYmxlXCIse3dpZGdldEV2ZW50UHJlZml4OlwiZHJvcFwiLG9wdGlvbnM6e2FjY2VwdDpcIipcIixhY3RpdmVDbGFzczpmYWxzZSxhZGRDbGFzc2VzOnRydWUsZ3JlZWR5OmZhbHNlLGhvdmVyQ2xhc3M6ZmFsc2Usc2NvcGU6XCJkZWZhdWx0XCIsdG9sZXJhbmNlOlwiaW50ZXJzZWN0XCJ9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgZD10aGlzLm9wdGlvbnMsYz1kLmFjY2VwdDt0aGlzLmlzb3Zlcj0wO3RoaXMuaXNvdXQ9MTt0aGlzLmFjY2VwdD1hLmlzRnVuY3Rpb24oYyk/YzpmdW5jdGlvbihlKXtyZXR1cm4gZS5pcyhjKX07dGhpcy5wcm9wb3J0aW9ucz17d2lkdGg6dGhpcy5lbGVtZW50WzBdLm9mZnNldFdpZHRoLGhlaWdodDp0aGlzLmVsZW1lbnRbMF0ub2Zmc2V0SGVpZ2h0fTthLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Quc2NvcGVdPWEudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbZC5zY29wZV18fFtdO2EudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbZC5zY29wZV0ucHVzaCh0aGlzKTtcbmQuYWRkQ2xhc3NlcyYmdGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktZHJvcHBhYmxlXCIpfSxkZXN0cm95OmZ1bmN0aW9uKCl7Zm9yKHZhciBkPWEudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdGhpcy5vcHRpb25zLnNjb3BlXSxjPTA7YzxkLmxlbmd0aDtjKyspZFtjXT09dGhpcyYmZC5zcGxpY2UoYywxKTt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1kcm9wcGFibGUgdWktZHJvcHBhYmxlLWRpc2FibGVkXCIpLnJlbW92ZURhdGEoXCJkcm9wcGFibGVcIikudW5iaW5kKFwiLmRyb3BwYWJsZVwiKTtyZXR1cm4gdGhpc30sX3NldE9wdGlvbjpmdW5jdGlvbihkLGMpe2lmKGQ9PVwiYWNjZXB0XCIpdGhpcy5hY2NlcHQ9YS5pc0Z1bmN0aW9uKGMpP2M6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuaXMoYyl9O2EuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sX2FjdGl2YXRlOmZ1bmN0aW9uKGQpe3ZhciBjPWEudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7dGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzJiZcbnRoaXMuZWxlbWVudC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MpO2MmJnRoaXMuX3RyaWdnZXIoXCJhY3RpdmF0ZVwiLGQsdGhpcy51aShjKSl9LF9kZWFjdGl2YXRlOmZ1bmN0aW9uKGQpe3ZhciBjPWEudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7dGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzJiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzKTtjJiZ0aGlzLl90cmlnZ2VyKFwiZGVhY3RpdmF0ZVwiLGQsdGhpcy51aShjKSl9LF9vdmVyOmZ1bmN0aW9uKGQpe3ZhciBjPWEudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7aWYoISghY3x8KGMuY3VycmVudEl0ZW18fGMuZWxlbWVudClbMF09PXRoaXMuZWxlbWVudFswXSkpaWYodGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sYy5jdXJyZW50SXRlbXx8Yy5lbGVtZW50KSl7dGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyk7XG50aGlzLl90cmlnZ2VyKFwib3ZlclwiLGQsdGhpcy51aShjKSl9fSxfb3V0OmZ1bmN0aW9uKGQpe3ZhciBjPWEudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7aWYoISghY3x8KGMuY3VycmVudEl0ZW18fGMuZWxlbWVudClbMF09PXRoaXMuZWxlbWVudFswXSkpaWYodGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sYy5jdXJyZW50SXRlbXx8Yy5lbGVtZW50KSl7dGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MmJnRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyk7dGhpcy5fdHJpZ2dlcihcIm91dFwiLGQsdGhpcy51aShjKSl9fSxfZHJvcDpmdW5jdGlvbihkLGMpe3ZhciBlPWN8fGEudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7aWYoIWV8fChlLmN1cnJlbnRJdGVtfHxlLmVsZW1lbnQpWzBdPT10aGlzLmVsZW1lbnRbMF0pcmV0dXJuIGZhbHNlO3ZhciBoPWZhbHNlO3RoaXMuZWxlbWVudC5maW5kKFwiOmRhdGEoZHJvcHBhYmxlKVwiKS5ub3QoXCIudWktZHJhZ2dhYmxlLWRyYWdnaW5nXCIpLmVhY2goZnVuY3Rpb24oKXt2YXIgZz1cbmEuZGF0YSh0aGlzLFwiZHJvcHBhYmxlXCIpO2lmKGcub3B0aW9ucy5ncmVlZHkmJiFnLm9wdGlvbnMuZGlzYWJsZWQmJmcub3B0aW9ucy5zY29wZT09ZS5vcHRpb25zLnNjb3BlJiZnLmFjY2VwdC5jYWxsKGcuZWxlbWVudFswXSxlLmN1cnJlbnRJdGVtfHxlLmVsZW1lbnQpJiZhLnVpLmludGVyc2VjdChlLGEuZXh0ZW5kKGcse29mZnNldDpnLmVsZW1lbnQub2Zmc2V0KCl9KSxnLm9wdGlvbnMudG9sZXJhbmNlKSl7aD10cnVlO3JldHVybiBmYWxzZX19KTtpZihoKXJldHVybiBmYWxzZTtpZih0aGlzLmFjY2VwdC5jYWxsKHRoaXMuZWxlbWVudFswXSxlLmN1cnJlbnRJdGVtfHxlLmVsZW1lbnQpKXt0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MmJnRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MpO3RoaXMub3B0aW9ucy5ob3ZlckNsYXNzJiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpO3RoaXMuX3RyaWdnZXIoXCJkcm9wXCIsXG5kLHRoaXMudWkoZSkpO3JldHVybiB0aGlzLmVsZW1lbnR9cmV0dXJuIGZhbHNlfSx1aTpmdW5jdGlvbihkKXtyZXR1cm57ZHJhZ2dhYmxlOmQuY3VycmVudEl0ZW18fGQuZWxlbWVudCxoZWxwZXI6ZC5oZWxwZXIscG9zaXRpb246ZC5wb3NpdGlvbixvZmZzZXQ6ZC5wb3NpdGlvbkFic319fSk7YS5leHRlbmQoYS51aS5kcm9wcGFibGUse3ZlcnNpb246XCIxLjguMTZcIn0pO2EudWkuaW50ZXJzZWN0PWZ1bmN0aW9uKGQsYyxlKXtpZighYy5vZmZzZXQpcmV0dXJuIGZhbHNlO3ZhciBoPShkLnBvc2l0aW9uQWJzfHxkLnBvc2l0aW9uLmFic29sdXRlKS5sZWZ0LGc9aCtkLmhlbHBlclByb3BvcnRpb25zLndpZHRoLGk9KGQucG9zaXRpb25BYnN8fGQucG9zaXRpb24uYWJzb2x1dGUpLnRvcCxiPWkrZC5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsZj1jLm9mZnNldC5sZWZ0LGo9ZitjLnByb3BvcnRpb25zLndpZHRoLGw9Yy5vZmZzZXQudG9wLG89bCtjLnByb3BvcnRpb25zLmhlaWdodDtcbnN3aXRjaChlKXtjYXNlIFwiZml0XCI6cmV0dXJuIGY8PWgmJmc8PWomJmw8PWkmJmI8PW87Y2FzZSBcImludGVyc2VjdFwiOnJldHVybiBmPGgrZC5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC8yJiZnLWQuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgvMjxqJiZsPGkrZC5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQvMiYmYi1kLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC8yPG87Y2FzZSBcInBvaW50ZXJcIjpyZXR1cm4gYS51aS5pc092ZXIoKGQucG9zaXRpb25BYnN8fGQucG9zaXRpb24uYWJzb2x1dGUpLnRvcCsoZC5jbGlja09mZnNldHx8ZC5vZmZzZXQuY2xpY2spLnRvcCwoZC5wb3NpdGlvbkFic3x8ZC5wb3NpdGlvbi5hYnNvbHV0ZSkubGVmdCsoZC5jbGlja09mZnNldHx8ZC5vZmZzZXQuY2xpY2spLmxlZnQsbCxmLGMucHJvcG9ydGlvbnMuaGVpZ2h0LGMucHJvcG9ydGlvbnMud2lkdGgpO2Nhc2UgXCJ0b3VjaFwiOnJldHVybihpPj1sJiZpPD1vfHxiPj1sJiZiPD1vfHxpPGwmJmI+bykmJihoPj1cbmYmJmg8PWp8fGc+PWYmJmc8PWp8fGg8ZiYmZz5qKTtkZWZhdWx0OnJldHVybiBmYWxzZX19O2EudWkuZGRtYW5hZ2VyPXtjdXJyZW50Om51bGwsZHJvcHBhYmxlczp7XCJkZWZhdWx0XCI6W119LHByZXBhcmVPZmZzZXRzOmZ1bmN0aW9uKGQsYyl7dmFyIGU9YS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1tkLm9wdGlvbnMuc2NvcGVdfHxbXSxoPWM/Yy50eXBlOm51bGwsZz0oZC5jdXJyZW50SXRlbXx8ZC5lbGVtZW50KS5maW5kKFwiOmRhdGEoZHJvcHBhYmxlKVwiKS5hbmRTZWxmKCksaT0wO2E6Zm9yKDtpPGUubGVuZ3RoO2krKylpZighKGVbaV0ub3B0aW9ucy5kaXNhYmxlZHx8ZCYmIWVbaV0uYWNjZXB0LmNhbGwoZVtpXS5lbGVtZW50WzBdLGQuY3VycmVudEl0ZW18fGQuZWxlbWVudCkpKXtmb3IodmFyIGI9MDtiPGcubGVuZ3RoO2IrKylpZihnW2JdPT1lW2ldLmVsZW1lbnRbMF0pe2VbaV0ucHJvcG9ydGlvbnMuaGVpZ2h0PTA7Y29udGludWUgYX1lW2ldLnZpc2libGU9ZVtpXS5lbGVtZW50LmNzcyhcImRpc3BsYXlcIikhPVxuXCJub25lXCI7aWYoZVtpXS52aXNpYmxlKXtoPT1cIm1vdXNlZG93blwiJiZlW2ldLl9hY3RpdmF0ZS5jYWxsKGVbaV0sYyk7ZVtpXS5vZmZzZXQ9ZVtpXS5lbGVtZW50Lm9mZnNldCgpO2VbaV0ucHJvcG9ydGlvbnM9e3dpZHRoOmVbaV0uZWxlbWVudFswXS5vZmZzZXRXaWR0aCxoZWlnaHQ6ZVtpXS5lbGVtZW50WzBdLm9mZnNldEhlaWdodH19fX0sZHJvcDpmdW5jdGlvbihkLGMpe3ZhciBlPWZhbHNlO2EuZWFjaChhLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Qub3B0aW9ucy5zY29wZV18fFtdLGZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zKXtpZighdGhpcy5vcHRpb25zLmRpc2FibGVkJiZ0aGlzLnZpc2libGUmJmEudWkuaW50ZXJzZWN0KGQsdGhpcyx0aGlzLm9wdGlvbnMudG9sZXJhbmNlKSllPWV8fHRoaXMuX2Ryb3AuY2FsbCh0aGlzLGMpO2lmKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQmJnRoaXMudmlzaWJsZSYmdGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sZC5jdXJyZW50SXRlbXx8XG5kLmVsZW1lbnQpKXt0aGlzLmlzb3V0PTE7dGhpcy5pc292ZXI9MDt0aGlzLl9kZWFjdGl2YXRlLmNhbGwodGhpcyxjKX19fSk7cmV0dXJuIGV9LGRyYWdTdGFydDpmdW5jdGlvbihkLGMpe2QuZWxlbWVudC5wYXJlbnRzKFwiOm5vdChib2R5LGh0bWwpXCIpLmJpbmQoXCJzY3JvbGwuZHJvcHBhYmxlXCIsZnVuY3Rpb24oKXtkLm9wdGlvbnMucmVmcmVzaFBvc2l0aW9uc3x8YS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoZCxjKX0pfSxkcmFnOmZ1bmN0aW9uKGQsYyl7ZC5vcHRpb25zLnJlZnJlc2hQb3NpdGlvbnMmJmEudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKGQsYyk7YS5lYWNoKGEudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbZC5vcHRpb25zLnNjb3BlXXx8W10sZnVuY3Rpb24oKXtpZighKHRoaXMub3B0aW9ucy5kaXNhYmxlZHx8dGhpcy5ncmVlZHlDaGlsZHx8IXRoaXMudmlzaWJsZSkpe3ZhciBlPWEudWkuaW50ZXJzZWN0KGQsdGhpcyx0aGlzLm9wdGlvbnMudG9sZXJhbmNlKTtcbmlmKGU9IWUmJnRoaXMuaXNvdmVyPT0xP1wiaXNvdXRcIjplJiZ0aGlzLmlzb3Zlcj09MD9cImlzb3ZlclwiOm51bGwpe3ZhciBoO2lmKHRoaXMub3B0aW9ucy5ncmVlZHkpe3ZhciBnPXRoaXMuZWxlbWVudC5wYXJlbnRzKFwiOmRhdGEoZHJvcHBhYmxlKTplcSgwKVwiKTtpZihnLmxlbmd0aCl7aD1hLmRhdGEoZ1swXSxcImRyb3BwYWJsZVwiKTtoLmdyZWVkeUNoaWxkPWU9PVwiaXNvdmVyXCI/MTowfX1pZihoJiZlPT1cImlzb3ZlclwiKXtoLmlzb3Zlcj0wO2guaXNvdXQ9MTtoLl9vdXQuY2FsbChoLGMpfXRoaXNbZV09MTt0aGlzW2U9PVwiaXNvdXRcIj9cImlzb3ZlclwiOlwiaXNvdXRcIl09MDt0aGlzW2U9PVwiaXNvdmVyXCI/XCJfb3ZlclwiOlwiX291dFwiXS5jYWxsKHRoaXMsYyk7aWYoaCYmZT09XCJpc291dFwiKXtoLmlzb3V0PTA7aC5pc292ZXI9MTtoLl9vdmVyLmNhbGwoaCxjKX19fX0pfSxkcmFnU3RvcDpmdW5jdGlvbihkLGMpe2QuZWxlbWVudC5wYXJlbnRzKFwiOm5vdChib2R5LGh0bWwpXCIpLnVuYmluZChcInNjcm9sbC5kcm9wcGFibGVcIik7XG5kLm9wdGlvbnMucmVmcmVzaFBvc2l0aW9uc3x8YS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoZCxjKX19fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLndpZGdldChcInVpLnJlc2l6YWJsZVwiLGEudWkubW91c2Use3dpZGdldEV2ZW50UHJlZml4OlwicmVzaXplXCIsb3B0aW9uczp7YWxzb1Jlc2l6ZTpmYWxzZSxhbmltYXRlOmZhbHNlLGFuaW1hdGVEdXJhdGlvbjpcInNsb3dcIixhbmltYXRlRWFzaW5nOlwic3dpbmdcIixhc3BlY3RSYXRpbzpmYWxzZSxhdXRvSGlkZTpmYWxzZSxjb250YWlubWVudDpmYWxzZSxnaG9zdDpmYWxzZSxncmlkOmZhbHNlLGhhbmRsZXM6XCJlLHMsc2VcIixoZWxwZXI6ZmFsc2UsbWF4SGVpZ2h0Om51bGwsbWF4V2lkdGg6bnVsbCxtaW5IZWlnaHQ6MTAsbWluV2lkdGg6MTAsekluZGV4OjFFM30sX2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMsaD10aGlzLm9wdGlvbnM7dGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktcmVzaXphYmxlXCIpO2EuZXh0ZW5kKHRoaXMse19hc3BlY3RSYXRpbzohIWguYXNwZWN0UmF0aW8sYXNwZWN0UmF0aW86aC5hc3BlY3RSYXRpbyxvcmlnaW5hbEVsZW1lbnQ6dGhpcy5lbGVtZW50LFxuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHM6W10sX2hlbHBlcjpoLmhlbHBlcnx8aC5naG9zdHx8aC5hbmltYXRlP2guaGVscGVyfHxcInVpLXJlc2l6YWJsZS1oZWxwZXJcIjpudWxsfSk7aWYodGhpcy5lbGVtZW50WzBdLm5vZGVOYW1lLm1hdGNoKC9jYW52YXN8dGV4dGFyZWF8aW5wdXR8c2VsZWN0fGJ1dHRvbnxpbWcvaSkpey9yZWxhdGl2ZS8udGVzdCh0aGlzLmVsZW1lbnQuY3NzKFwicG9zaXRpb25cIikpJiZhLmJyb3dzZXIub3BlcmEmJnRoaXMuZWxlbWVudC5jc3Moe3Bvc2l0aW9uOlwicmVsYXRpdmVcIix0b3A6XCJhdXRvXCIsbGVmdDpcImF1dG9cIn0pO3RoaXMuZWxlbWVudC53cmFwKGEoJzxkaXYgY2xhc3M9XCJ1aS13cmFwcGVyXCIgc3R5bGU9XCJvdmVyZmxvdzogaGlkZGVuO1wiPjwvZGl2PicpLmNzcyh7cG9zaXRpb246dGhpcy5lbGVtZW50LmNzcyhcInBvc2l0aW9uXCIpLHdpZHRoOnRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCksaGVpZ2h0OnRoaXMuZWxlbWVudC5vdXRlckhlaWdodCgpLFxudG9wOnRoaXMuZWxlbWVudC5jc3MoXCJ0b3BcIiksbGVmdDp0aGlzLmVsZW1lbnQuY3NzKFwibGVmdFwiKX0pKTt0aGlzLmVsZW1lbnQ9dGhpcy5lbGVtZW50LnBhcmVudCgpLmRhdGEoXCJyZXNpemFibGVcIix0aGlzLmVsZW1lbnQuZGF0YShcInJlc2l6YWJsZVwiKSk7dGhpcy5lbGVtZW50SXNXcmFwcGVyPXRydWU7dGhpcy5lbGVtZW50LmNzcyh7bWFyZ2luTGVmdDp0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoXCJtYXJnaW5MZWZ0XCIpLG1hcmdpblRvcDp0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoXCJtYXJnaW5Ub3BcIiksbWFyZ2luUmlnaHQ6dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKFwibWFyZ2luUmlnaHRcIiksbWFyZ2luQm90dG9tOnRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyhcIm1hcmdpbkJvdHRvbVwiKX0pO3RoaXMub3JpZ2luYWxFbGVtZW50LmNzcyh7bWFyZ2luTGVmdDowLG1hcmdpblRvcDowLG1hcmdpblJpZ2h0OjAsbWFyZ2luQm90dG9tOjB9KTt0aGlzLm9yaWdpbmFsUmVzaXplU3R5bGU9XG50aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoXCJyZXNpemVcIik7dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKFwicmVzaXplXCIsXCJub25lXCIpO3RoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMucHVzaCh0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3Moe3Bvc2l0aW9uOlwic3RhdGljXCIsem9vbToxLGRpc3BsYXk6XCJibG9ja1wifSkpO3RoaXMub3JpZ2luYWxFbGVtZW50LmNzcyh7bWFyZ2luOnRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyhcIm1hcmdpblwiKX0pO3RoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCl9dGhpcy5oYW5kbGVzPWguaGFuZGxlc3x8KCFhKFwiLnVpLXJlc2l6YWJsZS1oYW5kbGVcIix0aGlzLmVsZW1lbnQpLmxlbmd0aD9cImUscyxzZVwiOntuOlwiLnVpLXJlc2l6YWJsZS1uXCIsZTpcIi51aS1yZXNpemFibGUtZVwiLHM6XCIudWktcmVzaXphYmxlLXNcIix3OlwiLnVpLXJlc2l6YWJsZS13XCIsc2U6XCIudWktcmVzaXphYmxlLXNlXCIsc3c6XCIudWktcmVzaXphYmxlLXN3XCIsbmU6XCIudWktcmVzaXphYmxlLW5lXCIsXG5udzpcIi51aS1yZXNpemFibGUtbndcIn0pO2lmKHRoaXMuaGFuZGxlcy5jb25zdHJ1Y3Rvcj09U3RyaW5nKXtpZih0aGlzLmhhbmRsZXM9PVwiYWxsXCIpdGhpcy5oYW5kbGVzPVwibixlLHMsdyxzZSxzdyxuZSxud1wiO3ZhciBnPXRoaXMuaGFuZGxlcy5zcGxpdChcIixcIik7dGhpcy5oYW5kbGVzPXt9O2Zvcih2YXIgaT0wO2k8Zy5sZW5ndGg7aSsrKXt2YXIgYj1hLnRyaW0oZ1tpXSksZj1hKCc8ZGl2IGNsYXNzPVwidWktcmVzaXphYmxlLWhhbmRsZSAnKyhcInVpLXJlc2l6YWJsZS1cIitiKSsnXCI+PC9kaXY+Jyk7L3N3fHNlfG5lfG53Ly50ZXN0KGIpJiZmLmNzcyh7ekluZGV4OisraC56SW5kZXh9KTtcInNlXCI9PWImJmYuYWRkQ2xhc3MoXCJ1aS1pY29uIHVpLWljb24tZ3JpcHNtYWxsLWRpYWdvbmFsLXNlXCIpO3RoaXMuaGFuZGxlc1tiXT1cIi51aS1yZXNpemFibGUtXCIrYjt0aGlzLmVsZW1lbnQuYXBwZW5kKGYpfX10aGlzLl9yZW5kZXJBeGlzPWZ1bmN0aW9uKGope2o9anx8dGhpcy5lbGVtZW50O2Zvcih2YXIgbCBpbiB0aGlzLmhhbmRsZXMpe2lmKHRoaXMuaGFuZGxlc1tsXS5jb25zdHJ1Y3Rvcj09XG5TdHJpbmcpdGhpcy5oYW5kbGVzW2xdPWEodGhpcy5oYW5kbGVzW2xdLHRoaXMuZWxlbWVudCkuc2hvdygpO2lmKHRoaXMuZWxlbWVudElzV3JhcHBlciYmdGhpcy5vcmlnaW5hbEVsZW1lbnRbMF0ubm9kZU5hbWUubWF0Y2goL3RleHRhcmVhfGlucHV0fHNlbGVjdHxidXR0b24vaSkpe3ZhciBvPWEodGhpcy5oYW5kbGVzW2xdLHRoaXMuZWxlbWVudCksbj0wO249L3N3fG5lfG53fHNlfG58cy8udGVzdChsKT9vLm91dGVySGVpZ2h0KCk6by5vdXRlcldpZHRoKCk7bz1bXCJwYWRkaW5nXCIsL25lfG53fG4vLnRlc3QobCk/XCJUb3BcIjovc2V8c3d8cy8udGVzdChsKT9cIkJvdHRvbVwiOi9eZSQvLnRlc3QobCk/XCJSaWdodFwiOlwiTGVmdFwiXS5qb2luKFwiXCIpO2ouY3NzKG8sbik7dGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemUoKX1hKHRoaXMuaGFuZGxlc1tsXSl9fTt0aGlzLl9yZW5kZXJBeGlzKHRoaXMuZWxlbWVudCk7dGhpcy5faGFuZGxlcz1hKFwiLnVpLXJlc2l6YWJsZS1oYW5kbGVcIix0aGlzLmVsZW1lbnQpLmRpc2FibGVTZWxlY3Rpb24oKTtcbnRoaXMuX2hhbmRsZXMubW91c2VvdmVyKGZ1bmN0aW9uKCl7aWYoIWUucmVzaXppbmcpe2lmKHRoaXMuY2xhc3NOYW1lKXZhciBqPXRoaXMuY2xhc3NOYW1lLm1hdGNoKC91aS1yZXNpemFibGUtKHNlfHN3fG5lfG53fG58ZXxzfHcpL2kpO2UuYXhpcz1qJiZqWzFdP2pbMV06XCJzZVwifX0pO2lmKGguYXV0b0hpZGUpe3RoaXMuX2hhbmRsZXMuaGlkZSgpO2EodGhpcy5lbGVtZW50KS5hZGRDbGFzcyhcInVpLXJlc2l6YWJsZS1hdXRvaGlkZVwiKS5ob3ZlcihmdW5jdGlvbigpe2lmKCFoLmRpc2FibGVkKXthKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktcmVzaXphYmxlLWF1dG9oaWRlXCIpO2UuX2hhbmRsZXMuc2hvdygpfX0sZnVuY3Rpb24oKXtpZighaC5kaXNhYmxlZClpZighZS5yZXNpemluZyl7YSh0aGlzKS5hZGRDbGFzcyhcInVpLXJlc2l6YWJsZS1hdXRvaGlkZVwiKTtlLl9oYW5kbGVzLmhpZGUoKX19KX10aGlzLl9tb3VzZUluaXQoKX0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuX21vdXNlRGVzdHJveSgpO1xudmFyIGU9ZnVuY3Rpb24oZyl7YShnKS5yZW1vdmVDbGFzcyhcInVpLXJlc2l6YWJsZSB1aS1yZXNpemFibGUtZGlzYWJsZWQgdWktcmVzaXphYmxlLXJlc2l6aW5nXCIpLnJlbW92ZURhdGEoXCJyZXNpemFibGVcIikudW5iaW5kKFwiLnJlc2l6YWJsZVwiKS5maW5kKFwiLnVpLXJlc2l6YWJsZS1oYW5kbGVcIikucmVtb3ZlKCl9O2lmKHRoaXMuZWxlbWVudElzV3JhcHBlcil7ZSh0aGlzLmVsZW1lbnQpO3ZhciBoPXRoaXMuZWxlbWVudDtoLmFmdGVyKHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyh7cG9zaXRpb246aC5jc3MoXCJwb3NpdGlvblwiKSx3aWR0aDpoLm91dGVyV2lkdGgoKSxoZWlnaHQ6aC5vdXRlckhlaWdodCgpLHRvcDpoLmNzcyhcInRvcFwiKSxsZWZ0OmguY3NzKFwibGVmdFwiKX0pKS5yZW1vdmUoKX10aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoXCJyZXNpemVcIix0aGlzLm9yaWdpbmFsUmVzaXplU3R5bGUpO2UodGhpcy5vcmlnaW5hbEVsZW1lbnQpO3JldHVybiB0aGlzfSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKGUpe3ZhciBoPVxuZmFsc2U7Zm9yKHZhciBnIGluIHRoaXMuaGFuZGxlcylpZihhKHRoaXMuaGFuZGxlc1tnXSlbMF09PWUudGFyZ2V0KWg9dHJ1ZTtyZXR1cm4hdGhpcy5vcHRpb25zLmRpc2FibGVkJiZofSxfbW91c2VTdGFydDpmdW5jdGlvbihlKXt2YXIgaD10aGlzLm9wdGlvbnMsZz10aGlzLmVsZW1lbnQucG9zaXRpb24oKSxpPXRoaXMuZWxlbWVudDt0aGlzLnJlc2l6aW5nPXRydWU7dGhpcy5kb2N1bWVudFNjcm9sbD17dG9wOmEoZG9jdW1lbnQpLnNjcm9sbFRvcCgpLGxlZnQ6YShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpfTtpZihpLmlzKFwiLnVpLWRyYWdnYWJsZVwiKXx8L2Fic29sdXRlLy50ZXN0KGkuY3NzKFwicG9zaXRpb25cIikpKWkuY3NzKHtwb3NpdGlvbjpcImFic29sdXRlXCIsdG9wOmcudG9wLGxlZnQ6Zy5sZWZ0fSk7YS5icm93c2VyLm9wZXJhJiYvcmVsYXRpdmUvLnRlc3QoaS5jc3MoXCJwb3NpdGlvblwiKSkmJmkuY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCIsdG9wOlwiYXV0b1wiLGxlZnQ6XCJhdXRvXCJ9KTtcbnRoaXMuX3JlbmRlclByb3h5KCk7Zz1kKHRoaXMuaGVscGVyLmNzcyhcImxlZnRcIikpO3ZhciBiPWQodGhpcy5oZWxwZXIuY3NzKFwidG9wXCIpKTtpZihoLmNvbnRhaW5tZW50KXtnKz1hKGguY29udGFpbm1lbnQpLnNjcm9sbExlZnQoKXx8MDtiKz1hKGguY29udGFpbm1lbnQpLnNjcm9sbFRvcCgpfHwwfXRoaXMub2Zmc2V0PXRoaXMuaGVscGVyLm9mZnNldCgpO3RoaXMucG9zaXRpb249e2xlZnQ6Zyx0b3A6Yn07dGhpcy5zaXplPXRoaXMuX2hlbHBlcj97d2lkdGg6aS5vdXRlcldpZHRoKCksaGVpZ2h0Omkub3V0ZXJIZWlnaHQoKX06e3dpZHRoOmkud2lkdGgoKSxoZWlnaHQ6aS5oZWlnaHQoKX07dGhpcy5vcmlnaW5hbFNpemU9dGhpcy5faGVscGVyP3t3aWR0aDppLm91dGVyV2lkdGgoKSxoZWlnaHQ6aS5vdXRlckhlaWdodCgpfTp7d2lkdGg6aS53aWR0aCgpLGhlaWdodDppLmhlaWdodCgpfTt0aGlzLm9yaWdpbmFsUG9zaXRpb249e2xlZnQ6Zyx0b3A6Yn07dGhpcy5zaXplRGlmZj1cbnt3aWR0aDppLm91dGVyV2lkdGgoKS1pLndpZHRoKCksaGVpZ2h0Omkub3V0ZXJIZWlnaHQoKS1pLmhlaWdodCgpfTt0aGlzLm9yaWdpbmFsTW91c2VQb3NpdGlvbj17bGVmdDplLnBhZ2VYLHRvcDplLnBhZ2VZfTt0aGlzLmFzcGVjdFJhdGlvPXR5cGVvZiBoLmFzcGVjdFJhdGlvPT1cIm51bWJlclwiP2guYXNwZWN0UmF0aW86dGhpcy5vcmlnaW5hbFNpemUud2lkdGgvdGhpcy5vcmlnaW5hbFNpemUuaGVpZ2h0fHwxO2g9YShcIi51aS1yZXNpemFibGUtXCIrdGhpcy5heGlzKS5jc3MoXCJjdXJzb3JcIik7YShcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIsaD09XCJhdXRvXCI/dGhpcy5heGlzK1wiLXJlc2l6ZVwiOmgpO2kuYWRkQ2xhc3MoXCJ1aS1yZXNpemFibGUtcmVzaXppbmdcIik7dGhpcy5fcHJvcGFnYXRlKFwic3RhcnRcIixlKTtyZXR1cm4gdHJ1ZX0sX21vdXNlRHJhZzpmdW5jdGlvbihlKXt2YXIgaD10aGlzLmhlbHBlcixnPXRoaXMub3JpZ2luYWxNb3VzZVBvc2l0aW9uLGk9dGhpcy5fY2hhbmdlW3RoaXMuYXhpc107XG5pZighaSlyZXR1cm4gZmFsc2U7Zz1pLmFwcGx5KHRoaXMsW2UsZS5wYWdlWC1nLmxlZnR8fDAsZS5wYWdlWS1nLnRvcHx8MF0pO3RoaXMuX3VwZGF0ZVZpcnR1YWxCb3VuZGFyaWVzKGUuc2hpZnRLZXkpO2lmKHRoaXMuX2FzcGVjdFJhdGlvfHxlLnNoaWZ0S2V5KWc9dGhpcy5fdXBkYXRlUmF0aW8oZyxlKTtnPXRoaXMuX3Jlc3BlY3RTaXplKGcsZSk7dGhpcy5fcHJvcGFnYXRlKFwicmVzaXplXCIsZSk7aC5jc3Moe3RvcDp0aGlzLnBvc2l0aW9uLnRvcCtcInB4XCIsbGVmdDp0aGlzLnBvc2l0aW9uLmxlZnQrXCJweFwiLHdpZHRoOnRoaXMuc2l6ZS53aWR0aCtcInB4XCIsaGVpZ2h0OnRoaXMuc2l6ZS5oZWlnaHQrXCJweFwifSk7IXRoaXMuX2hlbHBlciYmdGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cy5sZW5ndGgmJnRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCk7dGhpcy5fdXBkYXRlQ2FjaGUoZyk7dGhpcy5fdHJpZ2dlcihcInJlc2l6ZVwiLGUsdGhpcy51aSgpKTtyZXR1cm4gZmFsc2V9LFxuX21vdXNlU3RvcDpmdW5jdGlvbihlKXt0aGlzLnJlc2l6aW5nPWZhbHNlO3ZhciBoPXRoaXMub3B0aW9ucyxnPXRoaXM7aWYodGhpcy5faGVscGVyKXt2YXIgaT10aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLGI9aS5sZW5ndGgmJi90ZXh0YXJlYS9pLnRlc3QoaVswXS5ub2RlTmFtZSk7aT1iJiZhLnVpLmhhc1Njcm9sbChpWzBdLFwibGVmdFwiKT8wOmcuc2l6ZURpZmYuaGVpZ2h0O2I9Yj8wOmcuc2l6ZURpZmYud2lkdGg7Yj17d2lkdGg6Zy5oZWxwZXIud2lkdGgoKS1iLGhlaWdodDpnLmhlbHBlci5oZWlnaHQoKS1pfTtpPXBhcnNlSW50KGcuZWxlbWVudC5jc3MoXCJsZWZ0XCIpLDEwKSsoZy5wb3NpdGlvbi5sZWZ0LWcub3JpZ2luYWxQb3NpdGlvbi5sZWZ0KXx8bnVsbDt2YXIgZj1wYXJzZUludChnLmVsZW1lbnQuY3NzKFwidG9wXCIpLDEwKSsoZy5wb3NpdGlvbi50b3AtZy5vcmlnaW5hbFBvc2l0aW9uLnRvcCl8fG51bGw7aC5hbmltYXRlfHx0aGlzLmVsZW1lbnQuY3NzKGEuZXh0ZW5kKGIsXG57dG9wOmYsbGVmdDppfSkpO2cuaGVscGVyLmhlaWdodChnLnNpemUuaGVpZ2h0KTtnLmhlbHBlci53aWR0aChnLnNpemUud2lkdGgpO3RoaXMuX2hlbHBlciYmIWguYW5pbWF0ZSYmdGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemUoKX1hKFwiYm9keVwiKS5jc3MoXCJjdXJzb3JcIixcImF1dG9cIik7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktcmVzaXphYmxlLXJlc2l6aW5nXCIpO3RoaXMuX3Byb3BhZ2F0ZShcInN0b3BcIixlKTt0aGlzLl9oZWxwZXImJnRoaXMuaGVscGVyLnJlbW92ZSgpO3JldHVybiBmYWxzZX0sX3VwZGF0ZVZpcnR1YWxCb3VuZGFyaWVzOmZ1bmN0aW9uKGUpe3ZhciBoPXRoaXMub3B0aW9ucyxnLGksYjtoPXttaW5XaWR0aDpjKGgubWluV2lkdGgpP2gubWluV2lkdGg6MCxtYXhXaWR0aDpjKGgubWF4V2lkdGgpP2gubWF4V2lkdGg6SW5maW5pdHksbWluSGVpZ2h0OmMoaC5taW5IZWlnaHQpP2gubWluSGVpZ2h0OjAsbWF4SGVpZ2h0OmMoaC5tYXhIZWlnaHQpP2gubWF4SGVpZ2h0OlxuSW5maW5pdHl9O2lmKHRoaXMuX2FzcGVjdFJhdGlvfHxlKXtlPWgubWluSGVpZ2h0KnRoaXMuYXNwZWN0UmF0aW87aT1oLm1pbldpZHRoL3RoaXMuYXNwZWN0UmF0aW87Zz1oLm1heEhlaWdodCp0aGlzLmFzcGVjdFJhdGlvO2I9aC5tYXhXaWR0aC90aGlzLmFzcGVjdFJhdGlvO2lmKGU+aC5taW5XaWR0aCloLm1pbldpZHRoPWU7aWYoaT5oLm1pbkhlaWdodCloLm1pbkhlaWdodD1pO2lmKGc8aC5tYXhXaWR0aCloLm1heFdpZHRoPWc7aWYoYjxoLm1heEhlaWdodCloLm1heEhlaWdodD1ifXRoaXMuX3ZCb3VuZGFyaWVzPWh9LF91cGRhdGVDYWNoZTpmdW5jdGlvbihlKXt0aGlzLm9mZnNldD10aGlzLmhlbHBlci5vZmZzZXQoKTtpZihjKGUubGVmdCkpdGhpcy5wb3NpdGlvbi5sZWZ0PWUubGVmdDtpZihjKGUudG9wKSl0aGlzLnBvc2l0aW9uLnRvcD1lLnRvcDtpZihjKGUuaGVpZ2h0KSl0aGlzLnNpemUuaGVpZ2h0PWUuaGVpZ2h0O2lmKGMoZS53aWR0aCkpdGhpcy5zaXplLndpZHRoPVxuZS53aWR0aH0sX3VwZGF0ZVJhdGlvOmZ1bmN0aW9uKGUpe3ZhciBoPXRoaXMucG9zaXRpb24sZz10aGlzLnNpemUsaT10aGlzLmF4aXM7aWYoYyhlLmhlaWdodCkpZS53aWR0aD1lLmhlaWdodCp0aGlzLmFzcGVjdFJhdGlvO2Vsc2UgaWYoYyhlLndpZHRoKSllLmhlaWdodD1lLndpZHRoL3RoaXMuYXNwZWN0UmF0aW87aWYoaT09XCJzd1wiKXtlLmxlZnQ9aC5sZWZ0KyhnLndpZHRoLWUud2lkdGgpO2UudG9wPW51bGx9aWYoaT09XCJud1wiKXtlLnRvcD1oLnRvcCsoZy5oZWlnaHQtZS5oZWlnaHQpO2UubGVmdD1oLmxlZnQrKGcud2lkdGgtZS53aWR0aCl9cmV0dXJuIGV9LF9yZXNwZWN0U2l6ZTpmdW5jdGlvbihlKXt2YXIgaD10aGlzLl92Qm91bmRhcmllcyxnPXRoaXMuYXhpcyxpPWMoZS53aWR0aCkmJmgubWF4V2lkdGgmJmgubWF4V2lkdGg8ZS53aWR0aCxiPWMoZS5oZWlnaHQpJiZoLm1heEhlaWdodCYmaC5tYXhIZWlnaHQ8ZS5oZWlnaHQsZj1jKGUud2lkdGgpJiZoLm1pbldpZHRoJiZcbmgubWluV2lkdGg+ZS53aWR0aCxqPWMoZS5oZWlnaHQpJiZoLm1pbkhlaWdodCYmaC5taW5IZWlnaHQ+ZS5oZWlnaHQ7aWYoZillLndpZHRoPWgubWluV2lkdGg7aWYoaillLmhlaWdodD1oLm1pbkhlaWdodDtpZihpKWUud2lkdGg9aC5tYXhXaWR0aDtpZihiKWUuaGVpZ2h0PWgubWF4SGVpZ2h0O3ZhciBsPXRoaXMub3JpZ2luYWxQb3NpdGlvbi5sZWZ0K3RoaXMub3JpZ2luYWxTaXplLndpZHRoLG89dGhpcy5wb3NpdGlvbi50b3ArdGhpcy5zaXplLmhlaWdodCxuPS9zd3xud3x3Ly50ZXN0KGcpO2c9L253fG5lfG4vLnRlc3QoZyk7aWYoZiYmbillLmxlZnQ9bC1oLm1pbldpZHRoO2lmKGkmJm4pZS5sZWZ0PWwtaC5tYXhXaWR0aDtpZihqJiZnKWUudG9wPW8taC5taW5IZWlnaHQ7aWYoYiYmZyllLnRvcD1vLWgubWF4SGVpZ2h0O2lmKChoPSFlLndpZHRoJiYhZS5oZWlnaHQpJiYhZS5sZWZ0JiZlLnRvcCllLnRvcD1udWxsO2Vsc2UgaWYoaCYmIWUudG9wJiZlLmxlZnQpZS5sZWZ0PVxubnVsbDtyZXR1cm4gZX0sX3Byb3BvcnRpb25hbGx5UmVzaXplOmZ1bmN0aW9uKCl7aWYodGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cy5sZW5ndGgpZm9yKHZhciBlPXRoaXMuaGVscGVyfHx0aGlzLmVsZW1lbnQsaD0wO2g8dGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cy5sZW5ndGg7aCsrKXt2YXIgZz10aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzW2hdO2lmKCF0aGlzLmJvcmRlckRpZil7dmFyIGk9W2cuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksZy5jc3MoXCJib3JkZXJSaWdodFdpZHRoXCIpLGcuY3NzKFwiYm9yZGVyQm90dG9tV2lkdGhcIiksZy5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIildLGI9W2cuY3NzKFwicGFkZGluZ1RvcFwiKSxnLmNzcyhcInBhZGRpbmdSaWdodFwiKSxnLmNzcyhcInBhZGRpbmdCb3R0b21cIiksZy5jc3MoXCJwYWRkaW5nTGVmdFwiKV07dGhpcy5ib3JkZXJEaWY9YS5tYXAoaSxmdW5jdGlvbihmLGope2Y9cGFyc2VJbnQoZiwxMCl8fFxuMDtqPXBhcnNlSW50KGJbal0sMTApfHwwO3JldHVybiBmK2p9KX1hLmJyb3dzZXIubXNpZSYmKGEoZSkuaXMoXCI6aGlkZGVuXCIpfHxhKGUpLnBhcmVudHMoXCI6aGlkZGVuXCIpLmxlbmd0aCl8fGcuY3NzKHtoZWlnaHQ6ZS5oZWlnaHQoKS10aGlzLmJvcmRlckRpZlswXS10aGlzLmJvcmRlckRpZlsyXXx8MCx3aWR0aDplLndpZHRoKCktdGhpcy5ib3JkZXJEaWZbMV0tdGhpcy5ib3JkZXJEaWZbM118fDB9KX19LF9yZW5kZXJQcm94eTpmdW5jdGlvbigpe3ZhciBlPXRoaXMub3B0aW9uczt0aGlzLmVsZW1lbnRPZmZzZXQ9dGhpcy5lbGVtZW50Lm9mZnNldCgpO2lmKHRoaXMuX2hlbHBlcil7dGhpcy5oZWxwZXI9dGhpcy5oZWxwZXJ8fGEoJzxkaXYgc3R5bGU9XCJvdmVyZmxvdzpoaWRkZW47XCI+PC9kaXY+Jyk7dmFyIGg9YS5icm93c2VyLm1zaWUmJmEuYnJvd3Nlci52ZXJzaW9uPDcsZz1oPzE6MDtoPWg/MjotMTt0aGlzLmhlbHBlci5hZGRDbGFzcyh0aGlzLl9oZWxwZXIpLmNzcyh7d2lkdGg6dGhpcy5lbGVtZW50Lm91dGVyV2lkdGgoKStcbmgsaGVpZ2h0OnRoaXMuZWxlbWVudC5vdXRlckhlaWdodCgpK2gscG9zaXRpb246XCJhYnNvbHV0ZVwiLGxlZnQ6dGhpcy5lbGVtZW50T2Zmc2V0LmxlZnQtZytcInB4XCIsdG9wOnRoaXMuZWxlbWVudE9mZnNldC50b3AtZytcInB4XCIsekluZGV4OisrZS56SW5kZXh9KTt0aGlzLmhlbHBlci5hcHBlbmRUbyhcImJvZHlcIikuZGlzYWJsZVNlbGVjdGlvbigpfWVsc2UgdGhpcy5oZWxwZXI9dGhpcy5lbGVtZW50fSxfY2hhbmdlOntlOmZ1bmN0aW9uKGUsaCl7cmV0dXJue3dpZHRoOnRoaXMub3JpZ2luYWxTaXplLndpZHRoK2h9fSx3OmZ1bmN0aW9uKGUsaCl7cmV0dXJue2xlZnQ6dGhpcy5vcmlnaW5hbFBvc2l0aW9uLmxlZnQraCx3aWR0aDp0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aC1ofX0sbjpmdW5jdGlvbihlLGgsZyl7cmV0dXJue3RvcDp0aGlzLm9yaWdpbmFsUG9zaXRpb24udG9wK2csaGVpZ2h0OnRoaXMub3JpZ2luYWxTaXplLmhlaWdodC1nfX0sczpmdW5jdGlvbihlLGgsZyl7cmV0dXJue2hlaWdodDp0aGlzLm9yaWdpbmFsU2l6ZS5oZWlnaHQrXG5nfX0sc2U6ZnVuY3Rpb24oZSxoLGcpe3JldHVybiBhLmV4dGVuZCh0aGlzLl9jaGFuZ2Uucy5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5fY2hhbmdlLmUuYXBwbHkodGhpcyxbZSxoLGddKSl9LHN3OmZ1bmN0aW9uKGUsaCxnKXtyZXR1cm4gYS5leHRlbmQodGhpcy5fY2hhbmdlLnMuYXBwbHkodGhpcyxhcmd1bWVudHMpLHRoaXMuX2NoYW5nZS53LmFwcGx5KHRoaXMsW2UsaCxnXSkpfSxuZTpmdW5jdGlvbihlLGgsZyl7cmV0dXJuIGEuZXh0ZW5kKHRoaXMuX2NoYW5nZS5uLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0aGlzLl9jaGFuZ2UuZS5hcHBseSh0aGlzLFtlLGgsZ10pKX0sbnc6ZnVuY3Rpb24oZSxoLGcpe3JldHVybiBhLmV4dGVuZCh0aGlzLl9jaGFuZ2Uubi5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5fY2hhbmdlLncuYXBwbHkodGhpcyxbZSxoLGddKSl9fSxfcHJvcGFnYXRlOmZ1bmN0aW9uKGUsaCl7YS51aS5wbHVnaW4uY2FsbCh0aGlzLGUsW2gsdGhpcy51aSgpXSk7XG5lIT1cInJlc2l6ZVwiJiZ0aGlzLl90cmlnZ2VyKGUsaCx0aGlzLnVpKCkpfSxwbHVnaW5zOnt9LHVpOmZ1bmN0aW9uKCl7cmV0dXJue29yaWdpbmFsRWxlbWVudDp0aGlzLm9yaWdpbmFsRWxlbWVudCxlbGVtZW50OnRoaXMuZWxlbWVudCxoZWxwZXI6dGhpcy5oZWxwZXIscG9zaXRpb246dGhpcy5wb3NpdGlvbixzaXplOnRoaXMuc2l6ZSxvcmlnaW5hbFNpemU6dGhpcy5vcmlnaW5hbFNpemUsb3JpZ2luYWxQb3NpdGlvbjp0aGlzLm9yaWdpbmFsUG9zaXRpb259fX0pO2EuZXh0ZW5kKGEudWkucmVzaXphYmxlLHt2ZXJzaW9uOlwiMS44LjE2XCJ9KTthLnVpLnBsdWdpbi5hZGQoXCJyZXNpemFibGVcIixcImFsc29SZXNpemVcIix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgZT1hKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIikub3B0aW9ucyxoPWZ1bmN0aW9uKGcpe2EoZykuZWFjaChmdW5jdGlvbigpe3ZhciBpPWEodGhpcyk7aS5kYXRhKFwicmVzaXphYmxlLWFsc29yZXNpemVcIix7d2lkdGg6cGFyc2VJbnQoaS53aWR0aCgpLFxuMTApLGhlaWdodDpwYXJzZUludChpLmhlaWdodCgpLDEwKSxsZWZ0OnBhcnNlSW50KGkuY3NzKFwibGVmdFwiKSwxMCksdG9wOnBhcnNlSW50KGkuY3NzKFwidG9wXCIpLDEwKSxwb3NpdGlvbjppLmNzcyhcInBvc2l0aW9uXCIpfSl9KX07aWYodHlwZW9mIGUuYWxzb1Jlc2l6ZT09XCJvYmplY3RcIiYmIWUuYWxzb1Jlc2l6ZS5wYXJlbnROb2RlKWlmKGUuYWxzb1Jlc2l6ZS5sZW5ndGgpe2UuYWxzb1Jlc2l6ZT1lLmFsc29SZXNpemVbMF07aChlLmFsc29SZXNpemUpfWVsc2UgYS5lYWNoKGUuYWxzb1Jlc2l6ZSxmdW5jdGlvbihnKXtoKGcpfSk7ZWxzZSBoKGUuYWxzb1Jlc2l6ZSl9LHJlc2l6ZTpmdW5jdGlvbihlLGgpe3ZhciBnPWEodGhpcykuZGF0YShcInJlc2l6YWJsZVwiKTtlPWcub3B0aW9uczt2YXIgaT1nLm9yaWdpbmFsU2l6ZSxiPWcub3JpZ2luYWxQb3NpdGlvbixmPXtoZWlnaHQ6Zy5zaXplLmhlaWdodC1pLmhlaWdodHx8MCx3aWR0aDpnLnNpemUud2lkdGgtaS53aWR0aHx8MCx0b3A6Zy5wb3NpdGlvbi50b3AtXG5iLnRvcHx8MCxsZWZ0OmcucG9zaXRpb24ubGVmdC1iLmxlZnR8fDB9LGo9ZnVuY3Rpb24obCxvKXthKGwpLmVhY2goZnVuY3Rpb24oKXt2YXIgbj1hKHRoaXMpLGs9YSh0aGlzKS5kYXRhKFwicmVzaXphYmxlLWFsc29yZXNpemVcIiksbT17fSxwPW8mJm8ubGVuZ3RoP286bi5wYXJlbnRzKGgub3JpZ2luYWxFbGVtZW50WzBdKS5sZW5ndGg/W1wid2lkdGhcIixcImhlaWdodFwiXTpbXCJ3aWR0aFwiLFwiaGVpZ2h0XCIsXCJ0b3BcIixcImxlZnRcIl07YS5lYWNoKHAsZnVuY3Rpb24ocSxzKXtpZigocT0oa1tzXXx8MCkrKGZbc118fDApKSYmcT49MCltW3NdPXF8fG51bGx9KTtpZihhLmJyb3dzZXIub3BlcmEmJi9yZWxhdGl2ZS8udGVzdChuLmNzcyhcInBvc2l0aW9uXCIpKSl7Zy5fcmV2ZXJ0VG9SZWxhdGl2ZVBvc2l0aW9uPXRydWU7bi5jc3Moe3Bvc2l0aW9uOlwiYWJzb2x1dGVcIix0b3A6XCJhdXRvXCIsbGVmdDpcImF1dG9cIn0pfW4uY3NzKG0pfSl9O3R5cGVvZiBlLmFsc29SZXNpemU9PVwib2JqZWN0XCImJiFlLmFsc29SZXNpemUubm9kZVR5cGU/XG5hLmVhY2goZS5hbHNvUmVzaXplLGZ1bmN0aW9uKGwsbyl7aihsLG8pfSk6aihlLmFsc29SZXNpemUpfSxzdG9wOmZ1bmN0aW9uKCl7dmFyIGU9YSh0aGlzKS5kYXRhKFwicmVzaXphYmxlXCIpLGg9ZS5vcHRpb25zLGc9ZnVuY3Rpb24oaSl7YShpKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9YSh0aGlzKTtiLmNzcyh7cG9zaXRpb246Yi5kYXRhKFwicmVzaXphYmxlLWFsc29yZXNpemVcIikucG9zaXRpb259KX0pfTtpZihlLl9yZXZlcnRUb1JlbGF0aXZlUG9zaXRpb24pe2UuX3JldmVydFRvUmVsYXRpdmVQb3NpdGlvbj1mYWxzZTt0eXBlb2YgaC5hbHNvUmVzaXplPT1cIm9iamVjdFwiJiYhaC5hbHNvUmVzaXplLm5vZGVUeXBlP2EuZWFjaChoLmFsc29SZXNpemUsZnVuY3Rpb24oaSl7ZyhpKX0pOmcoaC5hbHNvUmVzaXplKX1hKHRoaXMpLnJlbW92ZURhdGEoXCJyZXNpemFibGUtYWxzb3Jlc2l6ZVwiKX19KTthLnVpLnBsdWdpbi5hZGQoXCJyZXNpemFibGVcIixcImFuaW1hdGVcIix7c3RvcDpmdW5jdGlvbihlKXt2YXIgaD1cbmEodGhpcykuZGF0YShcInJlc2l6YWJsZVwiKSxnPWgub3B0aW9ucyxpPWguX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMsYj1pLmxlbmd0aCYmL3RleHRhcmVhL2kudGVzdChpWzBdLm5vZGVOYW1lKSxmPWImJmEudWkuaGFzU2Nyb2xsKGlbMF0sXCJsZWZ0XCIpPzA6aC5zaXplRGlmZi5oZWlnaHQ7Yj17d2lkdGg6aC5zaXplLndpZHRoLShiPzA6aC5zaXplRGlmZi53aWR0aCksaGVpZ2h0Omguc2l6ZS5oZWlnaHQtZn07Zj1wYXJzZUludChoLmVsZW1lbnQuY3NzKFwibGVmdFwiKSwxMCkrKGgucG9zaXRpb24ubGVmdC1oLm9yaWdpbmFsUG9zaXRpb24ubGVmdCl8fG51bGw7dmFyIGo9cGFyc2VJbnQoaC5lbGVtZW50LmNzcyhcInRvcFwiKSwxMCkrKGgucG9zaXRpb24udG9wLWgub3JpZ2luYWxQb3NpdGlvbi50b3ApfHxudWxsO2guZWxlbWVudC5hbmltYXRlKGEuZXh0ZW5kKGIsaiYmZj97dG9wOmosbGVmdDpmfTp7fSkse2R1cmF0aW9uOmcuYW5pbWF0ZUR1cmF0aW9uLGVhc2luZzpnLmFuaW1hdGVFYXNpbmcsXG5zdGVwOmZ1bmN0aW9uKCl7dmFyIGw9e3dpZHRoOnBhcnNlSW50KGguZWxlbWVudC5jc3MoXCJ3aWR0aFwiKSwxMCksaGVpZ2h0OnBhcnNlSW50KGguZWxlbWVudC5jc3MoXCJoZWlnaHRcIiksMTApLHRvcDpwYXJzZUludChoLmVsZW1lbnQuY3NzKFwidG9wXCIpLDEwKSxsZWZ0OnBhcnNlSW50KGguZWxlbWVudC5jc3MoXCJsZWZ0XCIpLDEwKX07aSYmaS5sZW5ndGgmJmEoaVswXSkuY3NzKHt3aWR0aDpsLndpZHRoLGhlaWdodDpsLmhlaWdodH0pO2guX3VwZGF0ZUNhY2hlKGwpO2guX3Byb3BhZ2F0ZShcInJlc2l6ZVwiLGUpfX0pfX0pO2EudWkucGx1Z2luLmFkZChcInJlc2l6YWJsZVwiLFwiY29udGFpbm1lbnRcIix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgZT1hKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIiksaD1lLmVsZW1lbnQsZz1lLm9wdGlvbnMuY29udGFpbm1lbnQ7aWYoaD1nIGluc3RhbmNlb2YgYT9nLmdldCgwKTovcGFyZW50Ly50ZXN0KGcpP2gucGFyZW50KCkuZ2V0KDApOmcpe2UuY29udGFpbmVyRWxlbWVudD1cbmEoaCk7aWYoL2RvY3VtZW50Ly50ZXN0KGcpfHxnPT1kb2N1bWVudCl7ZS5jb250YWluZXJPZmZzZXQ9e2xlZnQ6MCx0b3A6MH07ZS5jb250YWluZXJQb3NpdGlvbj17bGVmdDowLHRvcDowfTtlLnBhcmVudERhdGE9e2VsZW1lbnQ6YShkb2N1bWVudCksbGVmdDowLHRvcDowLHdpZHRoOmEoZG9jdW1lbnQpLndpZHRoKCksaGVpZ2h0OmEoZG9jdW1lbnQpLmhlaWdodCgpfHxkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0fX1lbHNle3ZhciBpPWEoaCksYj1bXTthKFtcIlRvcFwiLFwiUmlnaHRcIixcIkxlZnRcIixcIkJvdHRvbVwiXSkuZWFjaChmdW5jdGlvbihsLG8pe2JbbF09ZChpLmNzcyhcInBhZGRpbmdcIitvKSl9KTtlLmNvbnRhaW5lck9mZnNldD1pLm9mZnNldCgpO2UuY29udGFpbmVyUG9zaXRpb249aS5wb3NpdGlvbigpO2UuY29udGFpbmVyU2l6ZT17aGVpZ2h0OmkuaW5uZXJIZWlnaHQoKS1iWzNdLHdpZHRoOmkuaW5uZXJXaWR0aCgpLWJbMV19O2c9ZS5jb250YWluZXJPZmZzZXQ7XG52YXIgZj1lLmNvbnRhaW5lclNpemUuaGVpZ2h0LGo9ZS5jb250YWluZXJTaXplLndpZHRoO2o9YS51aS5oYXNTY3JvbGwoaCxcImxlZnRcIik/aC5zY3JvbGxXaWR0aDpqO2Y9YS51aS5oYXNTY3JvbGwoaCk/aC5zY3JvbGxIZWlnaHQ6ZjtlLnBhcmVudERhdGE9e2VsZW1lbnQ6aCxsZWZ0OmcubGVmdCx0b3A6Zy50b3Asd2lkdGg6aixoZWlnaHQ6Zn19fX0scmVzaXplOmZ1bmN0aW9uKGUpe3ZhciBoPWEodGhpcykuZGF0YShcInJlc2l6YWJsZVwiKSxnPWgub3B0aW9ucyxpPWguY29udGFpbmVyT2Zmc2V0LGI9aC5wb3NpdGlvbjtlPWguX2FzcGVjdFJhdGlvfHxlLnNoaWZ0S2V5O3ZhciBmPXt0b3A6MCxsZWZ0OjB9LGo9aC5jb250YWluZXJFbGVtZW50O2lmKGpbMF0hPWRvY3VtZW50JiYvc3RhdGljLy50ZXN0KGouY3NzKFwicG9zaXRpb25cIikpKWY9aTtpZihiLmxlZnQ8KGguX2hlbHBlcj9pLmxlZnQ6MCkpe2guc2l6ZS53aWR0aCs9aC5faGVscGVyP2gucG9zaXRpb24ubGVmdC1pLmxlZnQ6XG5oLnBvc2l0aW9uLmxlZnQtZi5sZWZ0O2lmKGUpaC5zaXplLmhlaWdodD1oLnNpemUud2lkdGgvZy5hc3BlY3RSYXRpbztoLnBvc2l0aW9uLmxlZnQ9Zy5oZWxwZXI/aS5sZWZ0OjB9aWYoYi50b3A8KGguX2hlbHBlcj9pLnRvcDowKSl7aC5zaXplLmhlaWdodCs9aC5faGVscGVyP2gucG9zaXRpb24udG9wLWkudG9wOmgucG9zaXRpb24udG9wO2lmKGUpaC5zaXplLndpZHRoPWguc2l6ZS5oZWlnaHQqZy5hc3BlY3RSYXRpbztoLnBvc2l0aW9uLnRvcD1oLl9oZWxwZXI/aS50b3A6MH1oLm9mZnNldC5sZWZ0PWgucGFyZW50RGF0YS5sZWZ0K2gucG9zaXRpb24ubGVmdDtoLm9mZnNldC50b3A9aC5wYXJlbnREYXRhLnRvcCtoLnBvc2l0aW9uLnRvcDtnPU1hdGguYWJzKChoLl9oZWxwZXI/aC5vZmZzZXQubGVmdC1mLmxlZnQ6aC5vZmZzZXQubGVmdC1mLmxlZnQpK2guc2l6ZURpZmYud2lkdGgpO2k9TWF0aC5hYnMoKGguX2hlbHBlcj9oLm9mZnNldC50b3AtZi50b3A6aC5vZmZzZXQudG9wLVxuaS50b3ApK2guc2l6ZURpZmYuaGVpZ2h0KTtiPWguY29udGFpbmVyRWxlbWVudC5nZXQoMCk9PWguZWxlbWVudC5wYXJlbnQoKS5nZXQoMCk7Zj0vcmVsYXRpdmV8YWJzb2x1dGUvLnRlc3QoaC5jb250YWluZXJFbGVtZW50LmNzcyhcInBvc2l0aW9uXCIpKTtpZihiJiZmKWctPWgucGFyZW50RGF0YS5sZWZ0O2lmKGcraC5zaXplLndpZHRoPj1oLnBhcmVudERhdGEud2lkdGgpe2guc2l6ZS53aWR0aD1oLnBhcmVudERhdGEud2lkdGgtZztpZihlKWguc2l6ZS5oZWlnaHQ9aC5zaXplLndpZHRoL2guYXNwZWN0UmF0aW99aWYoaStoLnNpemUuaGVpZ2h0Pj1oLnBhcmVudERhdGEuaGVpZ2h0KXtoLnNpemUuaGVpZ2h0PWgucGFyZW50RGF0YS5oZWlnaHQtaTtpZihlKWguc2l6ZS53aWR0aD1oLnNpemUuaGVpZ2h0KmguYXNwZWN0UmF0aW99fSxzdG9wOmZ1bmN0aW9uKCl7dmFyIGU9YSh0aGlzKS5kYXRhKFwicmVzaXphYmxlXCIpLGg9ZS5vcHRpb25zLGc9ZS5jb250YWluZXJPZmZzZXQsaT1lLmNvbnRhaW5lclBvc2l0aW9uLFxuYj1lLmNvbnRhaW5lckVsZW1lbnQsZj1hKGUuaGVscGVyKSxqPWYub2Zmc2V0KCksbD1mLm91dGVyV2lkdGgoKS1lLnNpemVEaWZmLndpZHRoO2Y9Zi5vdXRlckhlaWdodCgpLWUuc2l6ZURpZmYuaGVpZ2h0O2UuX2hlbHBlciYmIWguYW5pbWF0ZSYmL3JlbGF0aXZlLy50ZXN0KGIuY3NzKFwicG9zaXRpb25cIikpJiZhKHRoaXMpLmNzcyh7bGVmdDpqLmxlZnQtaS5sZWZ0LWcubGVmdCx3aWR0aDpsLGhlaWdodDpmfSk7ZS5faGVscGVyJiYhaC5hbmltYXRlJiYvc3RhdGljLy50ZXN0KGIuY3NzKFwicG9zaXRpb25cIikpJiZhKHRoaXMpLmNzcyh7bGVmdDpqLmxlZnQtaS5sZWZ0LWcubGVmdCx3aWR0aDpsLGhlaWdodDpmfSl9fSk7YS51aS5wbHVnaW4uYWRkKFwicmVzaXphYmxlXCIsXCJnaG9zdFwiLHtzdGFydDpmdW5jdGlvbigpe3ZhciBlPWEodGhpcykuZGF0YShcInJlc2l6YWJsZVwiKSxoPWUub3B0aW9ucyxnPWUuc2l6ZTtlLmdob3N0PWUub3JpZ2luYWxFbGVtZW50LmNsb25lKCk7ZS5naG9zdC5jc3Moe29wYWNpdHk6MC4yNSxcbmRpc3BsYXk6XCJibG9ja1wiLHBvc2l0aW9uOlwicmVsYXRpdmVcIixoZWlnaHQ6Zy5oZWlnaHQsd2lkdGg6Zy53aWR0aCxtYXJnaW46MCxsZWZ0OjAsdG9wOjB9KS5hZGRDbGFzcyhcInVpLXJlc2l6YWJsZS1naG9zdFwiKS5hZGRDbGFzcyh0eXBlb2YgaC5naG9zdD09XCJzdHJpbmdcIj9oLmdob3N0OlwiXCIpO2UuZ2hvc3QuYXBwZW5kVG8oZS5oZWxwZXIpfSxyZXNpemU6ZnVuY3Rpb24oKXt2YXIgZT1hKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIik7ZS5naG9zdCYmZS5naG9zdC5jc3Moe3Bvc2l0aW9uOlwicmVsYXRpdmVcIixoZWlnaHQ6ZS5zaXplLmhlaWdodCx3aWR0aDplLnNpemUud2lkdGh9KX0sc3RvcDpmdW5jdGlvbigpe3ZhciBlPWEodGhpcykuZGF0YShcInJlc2l6YWJsZVwiKTtlLmdob3N0JiZlLmhlbHBlciYmZS5oZWxwZXIuZ2V0KDApLnJlbW92ZUNoaWxkKGUuZ2hvc3QuZ2V0KDApKX19KTthLnVpLnBsdWdpbi5hZGQoXCJyZXNpemFibGVcIixcImdyaWRcIix7cmVzaXplOmZ1bmN0aW9uKCl7dmFyIGU9XG5hKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIiksaD1lLm9wdGlvbnMsZz1lLnNpemUsaT1lLm9yaWdpbmFsU2l6ZSxiPWUub3JpZ2luYWxQb3NpdGlvbixmPWUuYXhpcztoLmdyaWQ9dHlwZW9mIGguZ3JpZD09XCJudW1iZXJcIj9baC5ncmlkLGguZ3JpZF06aC5ncmlkO3ZhciBqPU1hdGgucm91bmQoKGcud2lkdGgtaS53aWR0aCkvKGguZ3JpZFswXXx8MSkpKihoLmdyaWRbMF18fDEpO2g9TWF0aC5yb3VuZCgoZy5oZWlnaHQtaS5oZWlnaHQpLyhoLmdyaWRbMV18fDEpKSooaC5ncmlkWzFdfHwxKTtpZigvXihzZXxzfGUpJC8udGVzdChmKSl7ZS5zaXplLndpZHRoPWkud2lkdGgrajtlLnNpemUuaGVpZ2h0PWkuaGVpZ2h0K2h9ZWxzZSBpZigvXihuZSkkLy50ZXN0KGYpKXtlLnNpemUud2lkdGg9aS53aWR0aCtqO2Uuc2l6ZS5oZWlnaHQ9aS5oZWlnaHQraDtlLnBvc2l0aW9uLnRvcD1iLnRvcC1ofWVsc2V7aWYoL14oc3cpJC8udGVzdChmKSl7ZS5zaXplLndpZHRoPWkud2lkdGgrajtlLnNpemUuaGVpZ2h0PVxuaS5oZWlnaHQraH1lbHNle2Uuc2l6ZS53aWR0aD1pLndpZHRoK2o7ZS5zaXplLmhlaWdodD1pLmhlaWdodCtoO2UucG9zaXRpb24udG9wPWIudG9wLWh9ZS5wb3NpdGlvbi5sZWZ0PWIubGVmdC1qfX19KTt2YXIgZD1mdW5jdGlvbihlKXtyZXR1cm4gcGFyc2VJbnQoZSwxMCl8fDB9LGM9ZnVuY3Rpb24oZSl7cmV0dXJuIWlzTmFOKHBhcnNlSW50KGUsMTApKX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2Eud2lkZ2V0KFwidWkuc2VsZWN0YWJsZVwiLGEudWkubW91c2Use29wdGlvbnM6e2FwcGVuZFRvOlwiYm9keVwiLGF1dG9SZWZyZXNoOnRydWUsZGlzdGFuY2U6MCxmaWx0ZXI6XCIqXCIsdG9sZXJhbmNlOlwidG91Y2hcIn0sX2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBkPXRoaXM7dGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktc2VsZWN0YWJsZVwiKTt0aGlzLmRyYWdnZWQ9ZmFsc2U7dmFyIGM7dGhpcy5yZWZyZXNoPWZ1bmN0aW9uKCl7Yz1hKGQub3B0aW9ucy5maWx0ZXIsZC5lbGVtZW50WzBdKTtjLmVhY2goZnVuY3Rpb24oKXt2YXIgZT1hKHRoaXMpLGg9ZS5vZmZzZXQoKTthLmRhdGEodGhpcyxcInNlbGVjdGFibGUtaXRlbVwiLHtlbGVtZW50OnRoaXMsJGVsZW1lbnQ6ZSxsZWZ0OmgubGVmdCx0b3A6aC50b3AscmlnaHQ6aC5sZWZ0K2Uub3V0ZXJXaWR0aCgpLGJvdHRvbTpoLnRvcCtlLm91dGVySGVpZ2h0KCksc3RhcnRzZWxlY3RlZDpmYWxzZSxzZWxlY3RlZDplLmhhc0NsYXNzKFwidWktc2VsZWN0ZWRcIiksXG5zZWxlY3Rpbmc6ZS5oYXNDbGFzcyhcInVpLXNlbGVjdGluZ1wiKSx1bnNlbGVjdGluZzplLmhhc0NsYXNzKFwidWktdW5zZWxlY3RpbmdcIil9KX0pfTt0aGlzLnJlZnJlc2goKTt0aGlzLnNlbGVjdGVlcz1jLmFkZENsYXNzKFwidWktc2VsZWN0ZWVcIik7dGhpcy5fbW91c2VJbml0KCk7dGhpcy5oZWxwZXI9YShcIjxkaXYgY2xhc3M9J3VpLXNlbGVjdGFibGUtaGVscGVyJz48L2Rpdj5cIil9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLnNlbGVjdGVlcy5yZW1vdmVDbGFzcyhcInVpLXNlbGVjdGVlXCIpLnJlbW92ZURhdGEoXCJzZWxlY3RhYmxlLWl0ZW1cIik7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc2VsZWN0YWJsZSB1aS1zZWxlY3RhYmxlLWRpc2FibGVkXCIpLnJlbW92ZURhdGEoXCJzZWxlY3RhYmxlXCIpLnVuYmluZChcIi5zZWxlY3RhYmxlXCIpO3RoaXMuX21vdXNlRGVzdHJveSgpO3JldHVybiB0aGlzfSxfbW91c2VTdGFydDpmdW5jdGlvbihkKXt2YXIgYz10aGlzO3RoaXMub3Bvcz1bZC5wYWdlWCxcbmQucGFnZVldO2lmKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQpe3ZhciBlPXRoaXMub3B0aW9uczt0aGlzLnNlbGVjdGVlcz1hKGUuZmlsdGVyLHRoaXMuZWxlbWVudFswXSk7dGhpcy5fdHJpZ2dlcihcInN0YXJ0XCIsZCk7YShlLmFwcGVuZFRvKS5hcHBlbmQodGhpcy5oZWxwZXIpO3RoaXMuaGVscGVyLmNzcyh7bGVmdDpkLmNsaWVudFgsdG9wOmQuY2xpZW50WSx3aWR0aDowLGhlaWdodDowfSk7ZS5hdXRvUmVmcmVzaCYmdGhpcy5yZWZyZXNoKCk7dGhpcy5zZWxlY3RlZXMuZmlsdGVyKFwiLnVpLXNlbGVjdGVkXCIpLmVhY2goZnVuY3Rpb24oKXt2YXIgaD1hLmRhdGEodGhpcyxcInNlbGVjdGFibGUtaXRlbVwiKTtoLnN0YXJ0c2VsZWN0ZWQ9dHJ1ZTtpZighZC5tZXRhS2V5KXtoLiRlbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc2VsZWN0ZWRcIik7aC5zZWxlY3RlZD1mYWxzZTtoLiRlbGVtZW50LmFkZENsYXNzKFwidWktdW5zZWxlY3RpbmdcIik7aC51bnNlbGVjdGluZz10cnVlO2MuX3RyaWdnZXIoXCJ1bnNlbGVjdGluZ1wiLFxuZCx7dW5zZWxlY3Rpbmc6aC5lbGVtZW50fSl9fSk7YShkLnRhcmdldCkucGFyZW50cygpLmFuZFNlbGYoKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGg9YS5kYXRhKHRoaXMsXCJzZWxlY3RhYmxlLWl0ZW1cIik7aWYoaCl7dmFyIGc9IWQubWV0YUtleXx8IWguJGVsZW1lbnQuaGFzQ2xhc3MoXCJ1aS1zZWxlY3RlZFwiKTtoLiRlbGVtZW50LnJlbW92ZUNsYXNzKGc/XCJ1aS11bnNlbGVjdGluZ1wiOlwidWktc2VsZWN0ZWRcIikuYWRkQ2xhc3MoZz9cInVpLXNlbGVjdGluZ1wiOlwidWktdW5zZWxlY3RpbmdcIik7aC51bnNlbGVjdGluZz0hZztoLnNlbGVjdGluZz1nOyhoLnNlbGVjdGVkPWcpP2MuX3RyaWdnZXIoXCJzZWxlY3RpbmdcIixkLHtzZWxlY3Rpbmc6aC5lbGVtZW50fSk6Yy5fdHJpZ2dlcihcInVuc2VsZWN0aW5nXCIsZCx7dW5zZWxlY3Rpbmc6aC5lbGVtZW50fSk7cmV0dXJuIGZhbHNlfX0pfX0sX21vdXNlRHJhZzpmdW5jdGlvbihkKXt2YXIgYz10aGlzO3RoaXMuZHJhZ2dlZD10cnVlO2lmKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQpe3ZhciBlPVxudGhpcy5vcHRpb25zLGg9dGhpcy5vcG9zWzBdLGc9dGhpcy5vcG9zWzFdLGk9ZC5wYWdlWCxiPWQucGFnZVk7aWYoaD5pKXt2YXIgZj1pO2k9aDtoPWZ9aWYoZz5iKXtmPWI7Yj1nO2c9Zn10aGlzLmhlbHBlci5jc3Moe2xlZnQ6aCx0b3A6Zyx3aWR0aDppLWgsaGVpZ2h0OmItZ30pO3RoaXMuc2VsZWN0ZWVzLmVhY2goZnVuY3Rpb24oKXt2YXIgaj1hLmRhdGEodGhpcyxcInNlbGVjdGFibGUtaXRlbVwiKTtpZighKCFqfHxqLmVsZW1lbnQ9PWMuZWxlbWVudFswXSkpe3ZhciBsPWZhbHNlO2lmKGUudG9sZXJhbmNlPT1cInRvdWNoXCIpbD0hKGoubGVmdD5pfHxqLnJpZ2h0PGh8fGoudG9wPmJ8fGouYm90dG9tPGcpO2Vsc2UgaWYoZS50b2xlcmFuY2U9PVwiZml0XCIpbD1qLmxlZnQ+aCYmai5yaWdodDxpJiZqLnRvcD5nJiZqLmJvdHRvbTxiO2lmKGwpe2lmKGouc2VsZWN0ZWQpe2ouJGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zZWxlY3RlZFwiKTtqLnNlbGVjdGVkPWZhbHNlfWlmKGoudW5zZWxlY3Rpbmcpe2ouJGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS11bnNlbGVjdGluZ1wiKTtcbmoudW5zZWxlY3Rpbmc9ZmFsc2V9aWYoIWouc2VsZWN0aW5nKXtqLiRlbGVtZW50LmFkZENsYXNzKFwidWktc2VsZWN0aW5nXCIpO2ouc2VsZWN0aW5nPXRydWU7Yy5fdHJpZ2dlcihcInNlbGVjdGluZ1wiLGQse3NlbGVjdGluZzpqLmVsZW1lbnR9KX19ZWxzZXtpZihqLnNlbGVjdGluZylpZihkLm1ldGFLZXkmJmouc3RhcnRzZWxlY3RlZCl7ai4kZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXNlbGVjdGluZ1wiKTtqLnNlbGVjdGluZz1mYWxzZTtqLiRlbGVtZW50LmFkZENsYXNzKFwidWktc2VsZWN0ZWRcIik7ai5zZWxlY3RlZD10cnVlfWVsc2V7ai4kZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXNlbGVjdGluZ1wiKTtqLnNlbGVjdGluZz1mYWxzZTtpZihqLnN0YXJ0c2VsZWN0ZWQpe2ouJGVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS11bnNlbGVjdGluZ1wiKTtqLnVuc2VsZWN0aW5nPXRydWV9Yy5fdHJpZ2dlcihcInVuc2VsZWN0aW5nXCIsZCx7dW5zZWxlY3Rpbmc6ai5lbGVtZW50fSl9aWYoai5zZWxlY3RlZClpZighZC5tZXRhS2V5JiZcbiFqLnN0YXJ0c2VsZWN0ZWQpe2ouJGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zZWxlY3RlZFwiKTtqLnNlbGVjdGVkPWZhbHNlO2ouJGVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS11bnNlbGVjdGluZ1wiKTtqLnVuc2VsZWN0aW5nPXRydWU7Yy5fdHJpZ2dlcihcInVuc2VsZWN0aW5nXCIsZCx7dW5zZWxlY3Rpbmc6ai5lbGVtZW50fSl9fX19KTtyZXR1cm4gZmFsc2V9fSxfbW91c2VTdG9wOmZ1bmN0aW9uKGQpe3ZhciBjPXRoaXM7dGhpcy5kcmFnZ2VkPWZhbHNlO2EoXCIudWktdW5zZWxlY3RpbmdcIix0aGlzLmVsZW1lbnRbMF0pLmVhY2goZnVuY3Rpb24oKXt2YXIgZT1hLmRhdGEodGhpcyxcInNlbGVjdGFibGUtaXRlbVwiKTtlLiRlbGVtZW50LnJlbW92ZUNsYXNzKFwidWktdW5zZWxlY3RpbmdcIik7ZS51bnNlbGVjdGluZz1mYWxzZTtlLnN0YXJ0c2VsZWN0ZWQ9ZmFsc2U7Yy5fdHJpZ2dlcihcInVuc2VsZWN0ZWRcIixkLHt1bnNlbGVjdGVkOmUuZWxlbWVudH0pfSk7YShcIi51aS1zZWxlY3RpbmdcIix0aGlzLmVsZW1lbnRbMF0pLmVhY2goZnVuY3Rpb24oKXt2YXIgZT1cbmEuZGF0YSh0aGlzLFwic2VsZWN0YWJsZS1pdGVtXCIpO2UuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zZWxlY3RpbmdcIikuYWRkQ2xhc3MoXCJ1aS1zZWxlY3RlZFwiKTtlLnNlbGVjdGluZz1mYWxzZTtlLnNlbGVjdGVkPXRydWU7ZS5zdGFydHNlbGVjdGVkPXRydWU7Yy5fdHJpZ2dlcihcInNlbGVjdGVkXCIsZCx7c2VsZWN0ZWQ6ZS5lbGVtZW50fSl9KTt0aGlzLl90cmlnZ2VyKFwic3RvcFwiLGQpO3RoaXMuaGVscGVyLnJlbW92ZSgpO3JldHVybiBmYWxzZX19KTthLmV4dGVuZChhLnVpLnNlbGVjdGFibGUse3ZlcnNpb246XCIxLjguMTZcIn0pfSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLndpZGdldChcInVpLnNvcnRhYmxlXCIsYS51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6XCJzb3J0XCIsb3B0aW9uczp7YXBwZW5kVG86XCJwYXJlbnRcIixheGlzOmZhbHNlLGNvbm5lY3RXaXRoOmZhbHNlLGNvbnRhaW5tZW50OmZhbHNlLGN1cnNvcjpcImF1dG9cIixjdXJzb3JBdDpmYWxzZSxkcm9wT25FbXB0eTp0cnVlLGZvcmNlUGxhY2Vob2xkZXJTaXplOmZhbHNlLGZvcmNlSGVscGVyU2l6ZTpmYWxzZSxncmlkOmZhbHNlLGhhbmRsZTpmYWxzZSxoZWxwZXI6XCJvcmlnaW5hbFwiLGl0ZW1zOlwiPiAqXCIsb3BhY2l0eTpmYWxzZSxwbGFjZWhvbGRlcjpmYWxzZSxyZXZlcnQ6ZmFsc2Usc2Nyb2xsOnRydWUsc2Nyb2xsU2Vuc2l0aXZpdHk6MjAsc2Nyb2xsU3BlZWQ6MjAsc2NvcGU6XCJkZWZhdWx0XCIsdG9sZXJhbmNlOlwiaW50ZXJzZWN0XCIsekluZGV4OjFFM30sX2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBkPXRoaXMub3B0aW9uczt0aGlzLmNvbnRhaW5lckNhY2hlPXt9O3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLXNvcnRhYmxlXCIpO1xudGhpcy5yZWZyZXNoKCk7dGhpcy5mbG9hdGluZz10aGlzLml0ZW1zLmxlbmd0aD9kLmF4aXM9PT1cInhcInx8L2xlZnR8cmlnaHQvLnRlc3QodGhpcy5pdGVtc1swXS5pdGVtLmNzcyhcImZsb2F0XCIpKXx8L2lubGluZXx0YWJsZS1jZWxsLy50ZXN0KHRoaXMuaXRlbXNbMF0uaXRlbS5jc3MoXCJkaXNwbGF5XCIpKTpmYWxzZTt0aGlzLm9mZnNldD10aGlzLmVsZW1lbnQub2Zmc2V0KCk7dGhpcy5fbW91c2VJbml0KCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZSB1aS1zb3J0YWJsZS1kaXNhYmxlZFwiKS5yZW1vdmVEYXRhKFwic29ydGFibGVcIikudW5iaW5kKFwiLnNvcnRhYmxlXCIpO3RoaXMuX21vdXNlRGVzdHJveSgpO2Zvcih2YXIgZD10aGlzLml0ZW1zLmxlbmd0aC0xO2Q+PTA7ZC0tKXRoaXMuaXRlbXNbZF0uaXRlbS5yZW1vdmVEYXRhKFwic29ydGFibGUtaXRlbVwiKTtyZXR1cm4gdGhpc30sX3NldE9wdGlvbjpmdW5jdGlvbihkLGMpe2lmKGQ9PT1cblwiZGlzYWJsZWRcIil7dGhpcy5vcHRpb25zW2RdPWM7dGhpcy53aWRnZXQoKVtjP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwidWktc29ydGFibGUtZGlzYWJsZWRcIil9ZWxzZSBhLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LF9tb3VzZUNhcHR1cmU6ZnVuY3Rpb24oZCxjKXtpZih0aGlzLnJldmVydGluZylyZXR1cm4gZmFsc2U7aWYodGhpcy5vcHRpb25zLmRpc2FibGVkfHx0aGlzLm9wdGlvbnMudHlwZT09XCJzdGF0aWNcIilyZXR1cm4gZmFsc2U7dGhpcy5fcmVmcmVzaEl0ZW1zKGQpO3ZhciBlPW51bGwsaD10aGlzO2EoZC50YXJnZXQpLnBhcmVudHMoKS5lYWNoKGZ1bmN0aW9uKCl7aWYoYS5kYXRhKHRoaXMsXCJzb3J0YWJsZS1pdGVtXCIpPT1oKXtlPWEodGhpcyk7cmV0dXJuIGZhbHNlfX0pO2lmKGEuZGF0YShkLnRhcmdldCxcInNvcnRhYmxlLWl0ZW1cIik9PWgpZT1hKGQudGFyZ2V0KTtpZighZSlyZXR1cm4gZmFsc2U7aWYodGhpcy5vcHRpb25zLmhhbmRsZSYmXG4hYyl7dmFyIGc9ZmFsc2U7YSh0aGlzLm9wdGlvbnMuaGFuZGxlLGUpLmZpbmQoXCIqXCIpLmFuZFNlbGYoKS5lYWNoKGZ1bmN0aW9uKCl7aWYodGhpcz09ZC50YXJnZXQpZz10cnVlfSk7aWYoIWcpcmV0dXJuIGZhbHNlfXRoaXMuY3VycmVudEl0ZW09ZTt0aGlzLl9yZW1vdmVDdXJyZW50c0Zyb21JdGVtcygpO3JldHVybiB0cnVlfSxfbW91c2VTdGFydDpmdW5jdGlvbihkLGMsZSl7Yz10aGlzLm9wdGlvbnM7dmFyIGg9dGhpczt0aGlzLmN1cnJlbnRDb250YWluZXI9dGhpczt0aGlzLnJlZnJlc2hQb3NpdGlvbnMoKTt0aGlzLmhlbHBlcj10aGlzLl9jcmVhdGVIZWxwZXIoZCk7dGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpO3RoaXMuX2NhY2hlTWFyZ2lucygpO3RoaXMuc2Nyb2xsUGFyZW50PXRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCgpO3RoaXMub2Zmc2V0PXRoaXMuY3VycmVudEl0ZW0ub2Zmc2V0KCk7dGhpcy5vZmZzZXQ9e3RvcDp0aGlzLm9mZnNldC50b3AtdGhpcy5tYXJnaW5zLnRvcCxcbmxlZnQ6dGhpcy5vZmZzZXQubGVmdC10aGlzLm1hcmdpbnMubGVmdH07dGhpcy5oZWxwZXIuY3NzKFwicG9zaXRpb25cIixcImFic29sdXRlXCIpO3RoaXMuY3NzUG9zaXRpb249dGhpcy5oZWxwZXIuY3NzKFwicG9zaXRpb25cIik7YS5leHRlbmQodGhpcy5vZmZzZXQse2NsaWNrOntsZWZ0OmQucGFnZVgtdGhpcy5vZmZzZXQubGVmdCx0b3A6ZC5wYWdlWS10aGlzLm9mZnNldC50b3B9LHBhcmVudDp0aGlzLl9nZXRQYXJlbnRPZmZzZXQoKSxyZWxhdGl2ZTp0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpfSk7dGhpcy5vcmlnaW5hbFBvc2l0aW9uPXRoaXMuX2dlbmVyYXRlUG9zaXRpb24oZCk7dGhpcy5vcmlnaW5hbFBhZ2VYPWQucGFnZVg7dGhpcy5vcmlnaW5hbFBhZ2VZPWQucGFnZVk7Yy5jdXJzb3JBdCYmdGhpcy5fYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcihjLmN1cnNvckF0KTt0aGlzLmRvbVBvc2l0aW9uPXtwcmV2OnRoaXMuY3VycmVudEl0ZW0ucHJldigpWzBdLHBhcmVudDp0aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpWzBdfTtcbnRoaXMuaGVscGVyWzBdIT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLmN1cnJlbnRJdGVtLmhpZGUoKTt0aGlzLl9jcmVhdGVQbGFjZWhvbGRlcigpO2MuY29udGFpbm1lbnQmJnRoaXMuX3NldENvbnRhaW5tZW50KCk7aWYoYy5jdXJzb3Ipe2lmKGEoXCJib2R5XCIpLmNzcyhcImN1cnNvclwiKSl0aGlzLl9zdG9yZWRDdXJzb3I9YShcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIpO2EoXCJib2R5XCIpLmNzcyhcImN1cnNvclwiLGMuY3Vyc29yKX1pZihjLm9wYWNpdHkpe2lmKHRoaXMuaGVscGVyLmNzcyhcIm9wYWNpdHlcIikpdGhpcy5fc3RvcmVkT3BhY2l0eT10aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIpO3RoaXMuaGVscGVyLmNzcyhcIm9wYWNpdHlcIixjLm9wYWNpdHkpfWlmKGMuekluZGV4KXtpZih0aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIikpdGhpcy5fc3RvcmVkWkluZGV4PXRoaXMuaGVscGVyLmNzcyhcInpJbmRleFwiKTt0aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIixjLnpJbmRleCl9aWYodGhpcy5zY3JvbGxQYXJlbnRbMF0hPVxuZG9jdW1lbnQmJnRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUhPVwiSFRNTFwiKXRoaXMub3ZlcmZsb3dPZmZzZXQ9dGhpcy5zY3JvbGxQYXJlbnQub2Zmc2V0KCk7dGhpcy5fdHJpZ2dlcihcInN0YXJ0XCIsZCx0aGlzLl91aUhhc2goKSk7dGhpcy5fcHJlc2VydmVIZWxwZXJQcm9wb3J0aW9uc3x8dGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpO2lmKCFlKWZvcihlPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtlPj0wO2UtLSl0aGlzLmNvbnRhaW5lcnNbZV0uX3RyaWdnZXIoXCJhY3RpdmF0ZVwiLGQsaC5fdWlIYXNoKHRoaXMpKTtpZihhLnVpLmRkbWFuYWdlcilhLnVpLmRkbWFuYWdlci5jdXJyZW50PXRoaXM7YS51aS5kZG1hbmFnZXImJiFjLmRyb3BCZWhhdmlvdXImJmEudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsZCk7dGhpcy5kcmFnZ2luZz10cnVlO3RoaXMuaGVscGVyLmFkZENsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpO3RoaXMuX21vdXNlRHJhZyhkKTtcbnJldHVybiB0cnVlfSxfbW91c2VEcmFnOmZ1bmN0aW9uKGQpe3RoaXMucG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbihkKTt0aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKFwiYWJzb2x1dGVcIik7aWYoIXRoaXMubGFzdFBvc2l0aW9uQWJzKXRoaXMubGFzdFBvc2l0aW9uQWJzPXRoaXMucG9zaXRpb25BYnM7aWYodGhpcy5vcHRpb25zLnNjcm9sbCl7dmFyIGM9dGhpcy5vcHRpb25zLGU9ZmFsc2U7aWYodGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZ0aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lIT1cIkhUTUxcIil7aWYodGhpcy5vdmVyZmxvd09mZnNldC50b3ArdGhpcy5zY3JvbGxQYXJlbnRbMF0ub2Zmc2V0SGVpZ2h0LWQucGFnZVk8Yy5zY3JvbGxTZW5zaXRpdml0eSl0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3A9ZT10aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3ArYy5zY3JvbGxTcGVlZDtlbHNlIGlmKGQucGFnZVktdGhpcy5vdmVyZmxvd09mZnNldC50b3A8XG5jLnNjcm9sbFNlbnNpdGl2aXR5KXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1lPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcC1jLnNjcm9sbFNwZWVkO2lmKHRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdCt0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aC1kLnBhZ2VYPGMuc2Nyb2xsU2Vuc2l0aXZpdHkpdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1lPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQrYy5zY3JvbGxTcGVlZDtlbHNlIGlmKGQucGFnZVgtdGhpcy5vdmVyZmxvd09mZnNldC5sZWZ0PGMuc2Nyb2xsU2Vuc2l0aXZpdHkpdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1lPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQtYy5zY3JvbGxTcGVlZH1lbHNle2lmKGQucGFnZVktYShkb2N1bWVudCkuc2Nyb2xsVG9wKCk8Yy5zY3JvbGxTZW5zaXRpdml0eSllPWEoZG9jdW1lbnQpLnNjcm9sbFRvcChhKGRvY3VtZW50KS5zY3JvbGxUb3AoKS1cbmMuc2Nyb2xsU3BlZWQpO2Vsc2UgaWYoYSh3aW5kb3cpLmhlaWdodCgpLShkLnBhZ2VZLWEoZG9jdW1lbnQpLnNjcm9sbFRvcCgpKTxjLnNjcm9sbFNlbnNpdGl2aXR5KWU9YShkb2N1bWVudCkuc2Nyb2xsVG9wKGEoZG9jdW1lbnQpLnNjcm9sbFRvcCgpK2Muc2Nyb2xsU3BlZWQpO2lmKGQucGFnZVgtYShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpPGMuc2Nyb2xsU2Vuc2l0aXZpdHkpZT1hKGRvY3VtZW50KS5zY3JvbGxMZWZ0KGEoZG9jdW1lbnQpLnNjcm9sbExlZnQoKS1jLnNjcm9sbFNwZWVkKTtlbHNlIGlmKGEod2luZG93KS53aWR0aCgpLShkLnBhZ2VYLWEoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSk8Yy5zY3JvbGxTZW5zaXRpdml0eSllPWEoZG9jdW1lbnQpLnNjcm9sbExlZnQoYShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpK2Muc2Nyb2xsU3BlZWQpfWUhPT1mYWxzZSYmYS51aS5kZG1hbmFnZXImJiFjLmRyb3BCZWhhdmlvdXImJmEudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsXG5kKX10aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKFwiYWJzb2x1dGVcIik7aWYoIXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLm9wdGlvbnMuYXhpcyE9XCJ5XCIpdGhpcy5oZWxwZXJbMF0uc3R5bGUubGVmdD10aGlzLnBvc2l0aW9uLmxlZnQrXCJweFwiO2lmKCF0aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5vcHRpb25zLmF4aXMhPVwieFwiKXRoaXMuaGVscGVyWzBdLnN0eWxlLnRvcD10aGlzLnBvc2l0aW9uLnRvcCtcInB4XCI7Zm9yKGM9dGhpcy5pdGVtcy5sZW5ndGgtMTtjPj0wO2MtLSl7ZT10aGlzLml0ZW1zW2NdO3ZhciBoPWUuaXRlbVswXSxnPXRoaXMuX2ludGVyc2VjdHNXaXRoUG9pbnRlcihlKTtpZihnKWlmKGghPXRoaXMuY3VycmVudEl0ZW1bMF0mJnRoaXMucGxhY2Vob2xkZXJbZz09MT9cIm5leHRcIjpcInByZXZcIl0oKVswXSE9aCYmIWEudWkuY29udGFpbnModGhpcy5wbGFjZWhvbGRlclswXSxoKSYmKHRoaXMub3B0aW9ucy50eXBlPT1cInNlbWktZHluYW1pY1wiPyFhLnVpLmNvbnRhaW5zKHRoaXMuZWxlbWVudFswXSxcbmgpOnRydWUpKXt0aGlzLmRpcmVjdGlvbj1nPT0xP1wiZG93blwiOlwidXBcIjtpZih0aGlzLm9wdGlvbnMudG9sZXJhbmNlPT1cInBvaW50ZXJcInx8dGhpcy5faW50ZXJzZWN0c1dpdGhTaWRlcyhlKSl0aGlzLl9yZWFycmFuZ2UoZCxlKTtlbHNlIGJyZWFrO3RoaXMuX3RyaWdnZXIoXCJjaGFuZ2VcIixkLHRoaXMuX3VpSGFzaCgpKTticmVha319dGhpcy5fY29udGFjdENvbnRhaW5lcnMoZCk7YS51aS5kZG1hbmFnZXImJmEudWkuZGRtYW5hZ2VyLmRyYWcodGhpcyxkKTt0aGlzLl90cmlnZ2VyKFwic29ydFwiLGQsdGhpcy5fdWlIYXNoKCkpO3RoaXMubGFzdFBvc2l0aW9uQWJzPXRoaXMucG9zaXRpb25BYnM7cmV0dXJuIGZhbHNlfSxfbW91c2VTdG9wOmZ1bmN0aW9uKGQsYyl7aWYoZCl7YS51aS5kZG1hbmFnZXImJiF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91ciYmYS51aS5kZG1hbmFnZXIuZHJvcCh0aGlzLGQpO2lmKHRoaXMub3B0aW9ucy5yZXZlcnQpe3ZhciBlPXRoaXM7Yz1lLnBsYWNlaG9sZGVyLm9mZnNldCgpO1xuZS5yZXZlcnRpbmc9dHJ1ZTthKHRoaXMuaGVscGVyKS5hbmltYXRlKHtsZWZ0OmMubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdC1lLm1hcmdpbnMubGVmdCsodGhpcy5vZmZzZXRQYXJlbnRbMF09PWRvY3VtZW50LmJvZHk/MDp0aGlzLm9mZnNldFBhcmVudFswXS5zY3JvbGxMZWZ0KSx0b3A6Yy50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcC1lLm1hcmdpbnMudG9wKyh0aGlzLm9mZnNldFBhcmVudFswXT09ZG9jdW1lbnQuYm9keT8wOnRoaXMub2Zmc2V0UGFyZW50WzBdLnNjcm9sbFRvcCl9LHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnQsMTApfHw1MDAsZnVuY3Rpb24oKXtlLl9jbGVhcihkKX0pfWVsc2UgdGhpcy5fY2xlYXIoZCxjKTtyZXR1cm4gZmFsc2V9fSxjYW5jZWw6ZnVuY3Rpb24oKXt2YXIgZD10aGlzO2lmKHRoaXMuZHJhZ2dpbmcpe3RoaXMuX21vdXNlVXAoe3RhcmdldDpudWxsfSk7dGhpcy5vcHRpb25zLmhlbHBlcj09XCJvcmlnaW5hbFwiP3RoaXMuY3VycmVudEl0ZW0uY3NzKHRoaXMuX3N0b3JlZENTUykucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIik6XG50aGlzLmN1cnJlbnRJdGVtLnNob3coKTtmb3IodmFyIGM9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2M+PTA7Yy0tKXt0aGlzLmNvbnRhaW5lcnNbY10uX3RyaWdnZXIoXCJkZWFjdGl2YXRlXCIsbnVsbCxkLl91aUhhc2godGhpcykpO2lmKHRoaXMuY29udGFpbmVyc1tjXS5jb250YWluZXJDYWNoZS5vdmVyKXt0aGlzLmNvbnRhaW5lcnNbY10uX3RyaWdnZXIoXCJvdXRcIixudWxsLGQuX3VpSGFzaCh0aGlzKSk7dGhpcy5jb250YWluZXJzW2NdLmNvbnRhaW5lckNhY2hlLm92ZXI9MH19fWlmKHRoaXMucGxhY2Vob2xkZXIpe3RoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZSYmdGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pO3RoaXMub3B0aW9ucy5oZWxwZXIhPVwib3JpZ2luYWxcIiYmdGhpcy5oZWxwZXImJnRoaXMuaGVscGVyWzBdLnBhcmVudE5vZGUmJnRoaXMuaGVscGVyLnJlbW92ZSgpO2EuZXh0ZW5kKHRoaXMse2hlbHBlcjpudWxsLFxuZHJhZ2dpbmc6ZmFsc2UscmV2ZXJ0aW5nOmZhbHNlLF9ub0ZpbmFsU29ydDpudWxsfSk7dGhpcy5kb21Qb3NpdGlvbi5wcmV2P2EodGhpcy5kb21Qb3NpdGlvbi5wcmV2KS5hZnRlcih0aGlzLmN1cnJlbnRJdGVtKTphKHRoaXMuZG9tUG9zaXRpb24ucGFyZW50KS5wcmVwZW5kKHRoaXMuY3VycmVudEl0ZW0pfXJldHVybiB0aGlzfSxzZXJpYWxpemU6ZnVuY3Rpb24oZCl7dmFyIGM9dGhpcy5fZ2V0SXRlbXNBc2pRdWVyeShkJiZkLmNvbm5lY3RlZCksZT1bXTtkPWR8fHt9O2EoYykuZWFjaChmdW5jdGlvbigpe3ZhciBoPShhKGQuaXRlbXx8dGhpcykuYXR0cihkLmF0dHJpYnV0ZXx8XCJpZFwiKXx8XCJcIikubWF0Y2goZC5leHByZXNzaW9ufHwvKC4rKVstPV9dKC4rKS8pO2lmKGgpZS5wdXNoKChkLmtleXx8aFsxXStcIltdXCIpK1wiPVwiKyhkLmtleSYmZC5leHByZXNzaW9uP2hbMV06aFsyXSkpfSk7IWUubGVuZ3RoJiZkLmtleSYmZS5wdXNoKGQua2V5K1wiPVwiKTtyZXR1cm4gZS5qb2luKFwiJlwiKX0sXG50b0FycmF5OmZ1bmN0aW9uKGQpe3ZhciBjPXRoaXMuX2dldEl0ZW1zQXNqUXVlcnkoZCYmZC5jb25uZWN0ZWQpLGU9W107ZD1kfHx7fTtjLmVhY2goZnVuY3Rpb24oKXtlLnB1c2goYShkLml0ZW18fHRoaXMpLmF0dHIoZC5hdHRyaWJ1dGV8fFwiaWRcIil8fFwiXCIpfSk7cmV0dXJuIGV9LF9pbnRlcnNlY3RzV2l0aDpmdW5jdGlvbihkKXt2YXIgYz10aGlzLnBvc2l0aW9uQWJzLmxlZnQsZT1jK3RoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsaD10aGlzLnBvc2l0aW9uQWJzLnRvcCxnPWgrdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsaT1kLmxlZnQsYj1pK2Qud2lkdGgsZj1kLnRvcCxqPWYrZC5oZWlnaHQsbD10aGlzLm9mZnNldC5jbGljay50b3Asbz10aGlzLm9mZnNldC5jbGljay5sZWZ0O2w9aCtsPmYmJmgrbDxqJiZjK28+aSYmYytvPGI7cmV0dXJuIHRoaXMub3B0aW9ucy50b2xlcmFuY2U9PVwicG9pbnRlclwifHx0aGlzLm9wdGlvbnMuZm9yY2VQb2ludGVyRm9yQ29udGFpbmVyc3x8XG50aGlzLm9wdGlvbnMudG9sZXJhbmNlIT1cInBvaW50ZXJcIiYmdGhpcy5oZWxwZXJQcm9wb3J0aW9uc1t0aGlzLmZsb2F0aW5nP1wid2lkdGhcIjpcImhlaWdodFwiXT5kW3RoaXMuZmxvYXRpbmc/XCJ3aWR0aFwiOlwiaGVpZ2h0XCJdP2w6aTxjK3RoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgvMiYmZS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLzI8YiYmZjxoK3RoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LzImJmctdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQvMjxqfSxfaW50ZXJzZWN0c1dpdGhQb2ludGVyOmZ1bmN0aW9uKGQpe3ZhciBjPWEudWkuaXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLnRvcCt0aGlzLm9mZnNldC5jbGljay50b3AsZC50b3AsZC5oZWlnaHQpO2Q9YS51aS5pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCt0aGlzLm9mZnNldC5jbGljay5sZWZ0LGQubGVmdCxkLndpZHRoKTtjPWMmJmQ7ZD10aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKTtcbnZhciBlPXRoaXMuX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uKCk7aWYoIWMpcmV0dXJuIGZhbHNlO3JldHVybiB0aGlzLmZsb2F0aW5nP2UmJmU9PVwicmlnaHRcInx8ZD09XCJkb3duXCI/MjoxOmQmJihkPT1cImRvd25cIj8yOjEpfSxfaW50ZXJzZWN0c1dpdGhTaWRlczpmdW5jdGlvbihkKXt2YXIgYz1hLnVpLmlzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy50b3ArdGhpcy5vZmZzZXQuY2xpY2sudG9wLGQudG9wK2QuaGVpZ2h0LzIsZC5oZWlnaHQpO2Q9YS51aS5pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCt0aGlzLm9mZnNldC5jbGljay5sZWZ0LGQubGVmdCtkLndpZHRoLzIsZC53aWR0aCk7dmFyIGU9dGhpcy5fZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uKCksaD10aGlzLl9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbigpO3JldHVybiB0aGlzLmZsb2F0aW5nJiZoP2g9PVwicmlnaHRcIiYmZHx8aD09XCJsZWZ0XCImJiFkOmUmJihlPT1cImRvd25cIiYmY3x8ZT09XCJ1cFwiJiYhYyl9LFxuX2dldERyYWdWZXJ0aWNhbERpcmVjdGlvbjpmdW5jdGlvbigpe3ZhciBkPXRoaXMucG9zaXRpb25BYnMudG9wLXRoaXMubGFzdFBvc2l0aW9uQWJzLnRvcDtyZXR1cm4gZCE9MCYmKGQ+MD9cImRvd25cIjpcInVwXCIpfSxfZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb246ZnVuY3Rpb24oKXt2YXIgZD10aGlzLnBvc2l0aW9uQWJzLmxlZnQtdGhpcy5sYXN0UG9zaXRpb25BYnMubGVmdDtyZXR1cm4gZCE9MCYmKGQ+MD9cInJpZ2h0XCI6XCJsZWZ0XCIpfSxyZWZyZXNoOmZ1bmN0aW9uKGQpe3RoaXMuX3JlZnJlc2hJdGVtcyhkKTt0aGlzLnJlZnJlc2hQb3NpdGlvbnMoKTtyZXR1cm4gdGhpc30sX2Nvbm5lY3RXaXRoOmZ1bmN0aW9uKCl7dmFyIGQ9dGhpcy5vcHRpb25zO3JldHVybiBkLmNvbm5lY3RXaXRoLmNvbnN0cnVjdG9yPT1TdHJpbmc/W2QuY29ubmVjdFdpdGhdOmQuY29ubmVjdFdpdGh9LF9nZXRJdGVtc0FzalF1ZXJ5OmZ1bmN0aW9uKGQpe3ZhciBjPVtdLGU9W10saD10aGlzLl9jb25uZWN0V2l0aCgpO1xuaWYoaCYmZClmb3IoZD1oLmxlbmd0aC0xO2Q+PTA7ZC0tKWZvcih2YXIgZz1hKGhbZF0pLGk9Zy5sZW5ndGgtMTtpPj0wO2ktLSl7dmFyIGI9YS5kYXRhKGdbaV0sXCJzb3J0YWJsZVwiKTtpZihiJiZiIT10aGlzJiYhYi5vcHRpb25zLmRpc2FibGVkKWUucHVzaChbYS5pc0Z1bmN0aW9uKGIub3B0aW9ucy5pdGVtcyk/Yi5vcHRpb25zLml0ZW1zLmNhbGwoYi5lbGVtZW50KTphKGIub3B0aW9ucy5pdGVtcyxiLmVsZW1lbnQpLm5vdChcIi51aS1zb3J0YWJsZS1oZWxwZXJcIikubm90KFwiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyXCIpLGJdKX1lLnB1c2goW2EuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMuaXRlbXMpP3RoaXMub3B0aW9ucy5pdGVtcy5jYWxsKHRoaXMuZWxlbWVudCxudWxsLHtvcHRpb25zOnRoaXMub3B0aW9ucyxpdGVtOnRoaXMuY3VycmVudEl0ZW19KTphKHRoaXMub3B0aW9ucy5pdGVtcyx0aGlzLmVsZW1lbnQpLm5vdChcIi51aS1zb3J0YWJsZS1oZWxwZXJcIikubm90KFwiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyXCIpLFxudGhpc10pO2ZvcihkPWUubGVuZ3RoLTE7ZD49MDtkLS0pZVtkXVswXS5lYWNoKGZ1bmN0aW9uKCl7Yy5wdXNoKHRoaXMpfSk7cmV0dXJuIGEoYyl9LF9yZW1vdmVDdXJyZW50c0Zyb21JdGVtczpmdW5jdGlvbigpe2Zvcih2YXIgZD10aGlzLmN1cnJlbnRJdGVtLmZpbmQoXCI6ZGF0YShzb3J0YWJsZS1pdGVtKVwiKSxjPTA7Yzx0aGlzLml0ZW1zLmxlbmd0aDtjKyspZm9yKHZhciBlPTA7ZTxkLmxlbmd0aDtlKyspZFtlXT09dGhpcy5pdGVtc1tjXS5pdGVtWzBdJiZ0aGlzLml0ZW1zLnNwbGljZShjLDEpfSxfcmVmcmVzaEl0ZW1zOmZ1bmN0aW9uKGQpe3RoaXMuaXRlbXM9W107dGhpcy5jb250YWluZXJzPVt0aGlzXTt2YXIgYz10aGlzLml0ZW1zLGU9W1thLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKT90aGlzLm9wdGlvbnMuaXRlbXMuY2FsbCh0aGlzLmVsZW1lbnRbMF0sZCx7aXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6YSh0aGlzLm9wdGlvbnMuaXRlbXMsdGhpcy5lbGVtZW50KSxcbnRoaXNdXSxoPXRoaXMuX2Nvbm5lY3RXaXRoKCk7aWYoaClmb3IodmFyIGc9aC5sZW5ndGgtMTtnPj0wO2ctLSlmb3IodmFyIGk9YShoW2ddKSxiPWkubGVuZ3RoLTE7Yj49MDtiLS0pe3ZhciBmPWEuZGF0YShpW2JdLFwic29ydGFibGVcIik7aWYoZiYmZiE9dGhpcyYmIWYub3B0aW9ucy5kaXNhYmxlZCl7ZS5wdXNoKFthLmlzRnVuY3Rpb24oZi5vcHRpb25zLml0ZW1zKT9mLm9wdGlvbnMuaXRlbXMuY2FsbChmLmVsZW1lbnRbMF0sZCx7aXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6YShmLm9wdGlvbnMuaXRlbXMsZi5lbGVtZW50KSxmXSk7dGhpcy5jb250YWluZXJzLnB1c2goZil9fWZvcihnPWUubGVuZ3RoLTE7Zz49MDtnLS0pe2Q9ZVtnXVsxXTtoPWVbZ11bMF07Yj0wO2ZvcihpPWgubGVuZ3RoO2I8aTtiKyspe2Y9YShoW2JdKTtmLmRhdGEoXCJzb3J0YWJsZS1pdGVtXCIsZCk7Yy5wdXNoKHtpdGVtOmYsaW5zdGFuY2U6ZCx3aWR0aDowLGhlaWdodDowLGxlZnQ6MCx0b3A6MH0pfX19LHJlZnJlc2hQb3NpdGlvbnM6ZnVuY3Rpb24oZCl7aWYodGhpcy5vZmZzZXRQYXJlbnQmJlxudGhpcy5oZWxwZXIpdGhpcy5vZmZzZXQucGFyZW50PXRoaXMuX2dldFBhcmVudE9mZnNldCgpO2Zvcih2YXIgYz10aGlzLml0ZW1zLmxlbmd0aC0xO2M+PTA7Yy0tKXt2YXIgZT10aGlzLml0ZW1zW2NdO2lmKCEoZS5pbnN0YW5jZSE9dGhpcy5jdXJyZW50Q29udGFpbmVyJiZ0aGlzLmN1cnJlbnRDb250YWluZXImJmUuaXRlbVswXSE9dGhpcy5jdXJyZW50SXRlbVswXSkpe3ZhciBoPXRoaXMub3B0aW9ucy50b2xlcmFuY2VFbGVtZW50P2EodGhpcy5vcHRpb25zLnRvbGVyYW5jZUVsZW1lbnQsZS5pdGVtKTplLml0ZW07aWYoIWQpe2Uud2lkdGg9aC5vdXRlcldpZHRoKCk7ZS5oZWlnaHQ9aC5vdXRlckhlaWdodCgpfWg9aC5vZmZzZXQoKTtlLmxlZnQ9aC5sZWZ0O2UudG9wPWgudG9wfX1pZih0aGlzLm9wdGlvbnMuY3VzdG9tJiZ0aGlzLm9wdGlvbnMuY3VzdG9tLnJlZnJlc2hDb250YWluZXJzKXRoaXMub3B0aW9ucy5jdXN0b20ucmVmcmVzaENvbnRhaW5lcnMuY2FsbCh0aGlzKTtlbHNlIGZvcihjPVxudGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2M+PTA7Yy0tKXtoPXRoaXMuY29udGFpbmVyc1tjXS5lbGVtZW50Lm9mZnNldCgpO3RoaXMuY29udGFpbmVyc1tjXS5jb250YWluZXJDYWNoZS5sZWZ0PWgubGVmdDt0aGlzLmNvbnRhaW5lcnNbY10uY29udGFpbmVyQ2FjaGUudG9wPWgudG9wO3RoaXMuY29udGFpbmVyc1tjXS5jb250YWluZXJDYWNoZS53aWR0aD10aGlzLmNvbnRhaW5lcnNbY10uZWxlbWVudC5vdXRlcldpZHRoKCk7dGhpcy5jb250YWluZXJzW2NdLmNvbnRhaW5lckNhY2hlLmhlaWdodD10aGlzLmNvbnRhaW5lcnNbY10uZWxlbWVudC5vdXRlckhlaWdodCgpfXJldHVybiB0aGlzfSxfY3JlYXRlUGxhY2Vob2xkZXI6ZnVuY3Rpb24oZCl7dmFyIGM9ZHx8dGhpcyxlPWMub3B0aW9ucztpZighZS5wbGFjZWhvbGRlcnx8ZS5wbGFjZWhvbGRlci5jb25zdHJ1Y3Rvcj09U3RyaW5nKXt2YXIgaD1lLnBsYWNlaG9sZGVyO2UucGxhY2Vob2xkZXI9e2VsZW1lbnQ6ZnVuY3Rpb24oKXt2YXIgZz1cbmEoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChjLmN1cnJlbnRJdGVtWzBdLm5vZGVOYW1lKSkuYWRkQ2xhc3MoaHx8Yy5jdXJyZW50SXRlbVswXS5jbGFzc05hbWUrXCIgdWktc29ydGFibGUtcGxhY2Vob2xkZXJcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIilbMF07aWYoIWgpZy5zdHlsZS52aXNpYmlsaXR5PVwiaGlkZGVuXCI7cmV0dXJuIGd9LHVwZGF0ZTpmdW5jdGlvbihnLGkpe2lmKCEoaCYmIWUuZm9yY2VQbGFjZWhvbGRlclNpemUpKXtpLmhlaWdodCgpfHxpLmhlaWdodChjLmN1cnJlbnRJdGVtLmlubmVySGVpZ2h0KCktcGFyc2VJbnQoYy5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nVG9wXCIpfHwwLDEwKS1wYXJzZUludChjLmN1cnJlbnRJdGVtLmNzcyhcInBhZGRpbmdCb3R0b21cIil8fDAsMTApKTtpLndpZHRoKCl8fGkud2lkdGgoYy5jdXJyZW50SXRlbS5pbm5lcldpZHRoKCktcGFyc2VJbnQoYy5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nTGVmdFwiKXx8MCwxMCktcGFyc2VJbnQoYy5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nUmlnaHRcIil8fFxuMCwxMCkpfX19fWMucGxhY2Vob2xkZXI9YShlLnBsYWNlaG9sZGVyLmVsZW1lbnQuY2FsbChjLmVsZW1lbnQsYy5jdXJyZW50SXRlbSkpO2MuY3VycmVudEl0ZW0uYWZ0ZXIoYy5wbGFjZWhvbGRlcik7ZS5wbGFjZWhvbGRlci51cGRhdGUoYyxjLnBsYWNlaG9sZGVyKX0sX2NvbnRhY3RDb250YWluZXJzOmZ1bmN0aW9uKGQpe2Zvcih2YXIgYz1udWxsLGU9bnVsbCxoPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtoPj0wO2gtLSlpZighYS51aS5jb250YWlucyh0aGlzLmN1cnJlbnRJdGVtWzBdLHRoaXMuY29udGFpbmVyc1toXS5lbGVtZW50WzBdKSlpZih0aGlzLl9pbnRlcnNlY3RzV2l0aCh0aGlzLmNvbnRhaW5lcnNbaF0uY29udGFpbmVyQ2FjaGUpKXtpZighKGMmJmEudWkuY29udGFpbnModGhpcy5jb250YWluZXJzW2hdLmVsZW1lbnRbMF0sYy5lbGVtZW50WzBdKSkpe2M9dGhpcy5jb250YWluZXJzW2hdO2U9aH19ZWxzZSBpZih0aGlzLmNvbnRhaW5lcnNbaF0uY29udGFpbmVyQ2FjaGUub3Zlcil7dGhpcy5jb250YWluZXJzW2hdLl90cmlnZ2VyKFwib3V0XCIsXG5kLHRoaXMuX3VpSGFzaCh0aGlzKSk7dGhpcy5jb250YWluZXJzW2hdLmNvbnRhaW5lckNhY2hlLm92ZXI9MH1pZihjKWlmKHRoaXMuY29udGFpbmVycy5sZW5ndGg9PT0xKXt0aGlzLmNvbnRhaW5lcnNbZV0uX3RyaWdnZXIoXCJvdmVyXCIsZCx0aGlzLl91aUhhc2godGhpcykpO3RoaXMuY29udGFpbmVyc1tlXS5jb250YWluZXJDYWNoZS5vdmVyPTF9ZWxzZSBpZih0aGlzLmN1cnJlbnRDb250YWluZXIhPXRoaXMuY29udGFpbmVyc1tlXSl7Yz0xRTQ7aD1udWxsO2Zvcih2YXIgZz10aGlzLnBvc2l0aW9uQWJzW3RoaXMuY29udGFpbmVyc1tlXS5mbG9hdGluZz9cImxlZnRcIjpcInRvcFwiXSxpPXRoaXMuaXRlbXMubGVuZ3RoLTE7aT49MDtpLS0paWYoYS51aS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbZV0uZWxlbWVudFswXSx0aGlzLml0ZW1zW2ldLml0ZW1bMF0pKXt2YXIgYj10aGlzLml0ZW1zW2ldW3RoaXMuY29udGFpbmVyc1tlXS5mbG9hdGluZz9cImxlZnRcIjpcInRvcFwiXTtpZihNYXRoLmFicyhiLVxuZyk8Yyl7Yz1NYXRoLmFicyhiLWcpO2g9dGhpcy5pdGVtc1tpXX19aWYoaHx8dGhpcy5vcHRpb25zLmRyb3BPbkVtcHR5KXt0aGlzLmN1cnJlbnRDb250YWluZXI9dGhpcy5jb250YWluZXJzW2VdO2g/dGhpcy5fcmVhcnJhbmdlKGQsaCxudWxsLHRydWUpOnRoaXMuX3JlYXJyYW5nZShkLG51bGwsdGhpcy5jb250YWluZXJzW2VdLmVsZW1lbnQsdHJ1ZSk7dGhpcy5fdHJpZ2dlcihcImNoYW5nZVwiLGQsdGhpcy5fdWlIYXNoKCkpO3RoaXMuY29udGFpbmVyc1tlXS5fdHJpZ2dlcihcImNoYW5nZVwiLGQsdGhpcy5fdWlIYXNoKHRoaXMpKTt0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIudXBkYXRlKHRoaXMuY3VycmVudENvbnRhaW5lcix0aGlzLnBsYWNlaG9sZGVyKTt0aGlzLmNvbnRhaW5lcnNbZV0uX3RyaWdnZXIoXCJvdmVyXCIsZCx0aGlzLl91aUhhc2godGhpcykpO3RoaXMuY29udGFpbmVyc1tlXS5jb250YWluZXJDYWNoZS5vdmVyPTF9fX0sX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbihkKXt2YXIgYz1cbnRoaXMub3B0aW9ucztkPWEuaXNGdW5jdGlvbihjLmhlbHBlcik/YShjLmhlbHBlci5hcHBseSh0aGlzLmVsZW1lbnRbMF0sW2QsdGhpcy5jdXJyZW50SXRlbV0pKTpjLmhlbHBlcj09XCJjbG9uZVwiP3RoaXMuY3VycmVudEl0ZW0uY2xvbmUoKTp0aGlzLmN1cnJlbnRJdGVtO2QucGFyZW50cyhcImJvZHlcIikubGVuZ3RofHxhKGMuYXBwZW5kVG8hPVwicGFyZW50XCI/Yy5hcHBlbmRUbzp0aGlzLmN1cnJlbnRJdGVtWzBdLnBhcmVudE5vZGUpWzBdLmFwcGVuZENoaWxkKGRbMF0pO2lmKGRbMF09PXRoaXMuY3VycmVudEl0ZW1bMF0pdGhpcy5fc3RvcmVkQ1NTPXt3aWR0aDp0aGlzLmN1cnJlbnRJdGVtWzBdLnN0eWxlLndpZHRoLGhlaWdodDp0aGlzLmN1cnJlbnRJdGVtWzBdLnN0eWxlLmhlaWdodCxwb3NpdGlvbjp0aGlzLmN1cnJlbnRJdGVtLmNzcyhcInBvc2l0aW9uXCIpLHRvcDp0aGlzLmN1cnJlbnRJdGVtLmNzcyhcInRvcFwiKSxsZWZ0OnRoaXMuY3VycmVudEl0ZW0uY3NzKFwibGVmdFwiKX07aWYoZFswXS5zdHlsZS53aWR0aD09XG5cIlwifHxjLmZvcmNlSGVscGVyU2l6ZSlkLndpZHRoKHRoaXMuY3VycmVudEl0ZW0ud2lkdGgoKSk7aWYoZFswXS5zdHlsZS5oZWlnaHQ9PVwiXCJ8fGMuZm9yY2VIZWxwZXJTaXplKWQuaGVpZ2h0KHRoaXMuY3VycmVudEl0ZW0uaGVpZ2h0KCkpO3JldHVybiBkfSxfYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcjpmdW5jdGlvbihkKXtpZih0eXBlb2YgZD09XCJzdHJpbmdcIilkPWQuc3BsaXQoXCIgXCIpO2lmKGEuaXNBcnJheShkKSlkPXtsZWZ0OitkWzBdLHRvcDorZFsxXXx8MH07aWYoXCJsZWZ0XCJpbiBkKXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9ZC5sZWZ0K3RoaXMubWFyZ2lucy5sZWZ0O2lmKFwicmlnaHRcImluIGQpdGhpcy5vZmZzZXQuY2xpY2subGVmdD10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLWQucmlnaHQrdGhpcy5tYXJnaW5zLmxlZnQ7aWYoXCJ0b3BcImluIGQpdGhpcy5vZmZzZXQuY2xpY2sudG9wPWQudG9wK3RoaXMubWFyZ2lucy50b3A7aWYoXCJib3R0b21cImluIGQpdGhpcy5vZmZzZXQuY2xpY2sudG9wPVxudGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtZC5ib3R0b20rdGhpcy5tYXJnaW5zLnRvcH0sX2dldFBhcmVudE9mZnNldDpmdW5jdGlvbigpe3RoaXMub2Zmc2V0UGFyZW50PXRoaXMuaGVscGVyLm9mZnNldFBhcmVudCgpO3ZhciBkPXRoaXMub2Zmc2V0UGFyZW50Lm9mZnNldCgpO2lmKHRoaXMuY3NzUG9zaXRpb249PVwiYWJzb2x1dGVcIiYmdGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZhLnVpLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSl7ZC5sZWZ0Kz10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk7ZC50b3ArPXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpfWlmKHRoaXMub2Zmc2V0UGFyZW50WzBdPT1kb2N1bWVudC5ib2R5fHx0aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lJiZ0aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCk9PVwiaHRtbFwiJiZhLmJyb3dzZXIubXNpZSlkPVxue3RvcDowLGxlZnQ6MH07cmV0dXJue3RvcDpkLnRvcCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKSxsZWZ0OmQubGVmdCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCl9fSxfZ2V0UmVsYXRpdmVPZmZzZXQ6ZnVuY3Rpb24oKXtpZih0aGlzLmNzc1Bvc2l0aW9uPT1cInJlbGF0aXZlXCIpe3ZhciBkPXRoaXMuY3VycmVudEl0ZW0ucG9zaXRpb24oKTtyZXR1cm57dG9wOmQudG9wLShwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoXCJ0b3BcIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSxsZWZ0OmQubGVmdC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKFwibGVmdFwiKSwxMCl8fDApK3RoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKX19ZWxzZSByZXR1cm57dG9wOjAsbGVmdDowfX0sX2NhY2hlTWFyZ2luczpmdW5jdGlvbigpe3RoaXMubWFyZ2lucz17bGVmdDpwYXJzZUludCh0aGlzLmN1cnJlbnRJdGVtLmNzcyhcIm1hcmdpbkxlZnRcIiksXG4xMCl8fDAsdG9wOnBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKFwibWFyZ2luVG9wXCIpLDEwKXx8MH19LF9jYWNoZUhlbHBlclByb3BvcnRpb25zOmZ1bmN0aW9uKCl7dGhpcy5oZWxwZXJQcm9wb3J0aW9ucz17d2lkdGg6dGhpcy5oZWxwZXIub3V0ZXJXaWR0aCgpLGhlaWdodDp0aGlzLmhlbHBlci5vdXRlckhlaWdodCgpfX0sX3NldENvbnRhaW5tZW50OmZ1bmN0aW9uKCl7dmFyIGQ9dGhpcy5vcHRpb25zO2lmKGQuY29udGFpbm1lbnQ9PVwicGFyZW50XCIpZC5jb250YWlubWVudD10aGlzLmhlbHBlclswXS5wYXJlbnROb2RlO2lmKGQuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcInx8ZC5jb250YWlubWVudD09XCJ3aW5kb3dcIil0aGlzLmNvbnRhaW5tZW50PVswLXRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQtdGhpcy5vZmZzZXQucGFyZW50LmxlZnQsMC10aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcCxhKGQuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcIj9cbmRvY3VtZW50OndpbmRvdykud2lkdGgoKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LChhKGQuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcIj9kb2N1bWVudDp3aW5kb3cpLmhlaWdodCgpfHxkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wXTtpZighL14oZG9jdW1lbnR8d2luZG93fHBhcmVudCkkLy50ZXN0KGQuY29udGFpbm1lbnQpKXt2YXIgYz1hKGQuY29udGFpbm1lbnQpWzBdO2Q9YShkLmNvbnRhaW5tZW50KS5vZmZzZXQoKTt2YXIgZT1hKGMpLmNzcyhcIm92ZXJmbG93XCIpIT1cImhpZGRlblwiO3RoaXMuY29udGFpbm1lbnQ9W2QubGVmdCsocGFyc2VJbnQoYShjKS5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKSsocGFyc2VJbnQoYShjKS5jc3MoXCJwYWRkaW5nTGVmdFwiKSwxMCl8fDApLXRoaXMubWFyZ2lucy5sZWZ0LGQudG9wKyhwYXJzZUludChhKGMpLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLFxuMTApfHwwKSsocGFyc2VJbnQoYShjKS5jc3MoXCJwYWRkaW5nVG9wXCIpLDEwKXx8MCktdGhpcy5tYXJnaW5zLnRvcCxkLmxlZnQrKGU/TWF0aC5tYXgoYy5zY3JvbGxXaWR0aCxjLm9mZnNldFdpZHRoKTpjLm9mZnNldFdpZHRoKS0ocGFyc2VJbnQoYShjKS5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKS0ocGFyc2VJbnQoYShjKS5jc3MoXCJwYWRkaW5nUmlnaHRcIiksMTApfHwwKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LGQudG9wKyhlP01hdGgubWF4KGMuc2Nyb2xsSGVpZ2h0LGMub2Zmc2V0SGVpZ2h0KTpjLm9mZnNldEhlaWdodCktKHBhcnNlSW50KGEoYykuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKS0ocGFyc2VJbnQoYShjKS5jc3MoXCJwYWRkaW5nQm90dG9tXCIpLDEwKXx8MCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcF19fSxfY29udmVydFBvc2l0aW9uVG86ZnVuY3Rpb24oZCxjKXtpZighYyljPVxudGhpcy5wb3NpdGlvbjtkPWQ9PVwiYWJzb2x1dGVcIj8xOi0xO3ZhciBlPXRoaXMuY3NzUG9zaXRpb249PVwiYWJzb2x1dGVcIiYmISh0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmEudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKT90aGlzLm9mZnNldFBhcmVudDp0aGlzLnNjcm9sbFBhcmVudCxoPS8oaHRtbHxib2R5KS9pLnRlc3QoZVswXS50YWdOYW1lKTtyZXR1cm57dG9wOmMudG9wK3RoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcCpkK3RoaXMub2Zmc2V0LnBhcmVudC50b3AqZC0oYS5icm93c2VyLnNhZmFyaSYmdGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPzA6KHRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCk6aD8wOmUuc2Nyb2xsVG9wKCkpKmQpLGxlZnQ6Yy5sZWZ0K3RoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQqZCt0aGlzLm9mZnNldC5wYXJlbnQubGVmdCpkLShhLmJyb3dzZXIuc2FmYXJpJiZcbnRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8wOih0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTpoPzA6ZS5zY3JvbGxMZWZ0KCkpKmQpfX0sX2dlbmVyYXRlUG9zaXRpb246ZnVuY3Rpb24oZCl7dmFyIGM9dGhpcy5vcHRpb25zLGU9dGhpcy5jc3NQb3NpdGlvbj09XCJhYnNvbHV0ZVwiJiYhKHRoaXMuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmYS51aS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSkpP3RoaXMub2Zmc2V0UGFyZW50OnRoaXMuc2Nyb2xsUGFyZW50LGg9LyhodG1sfGJvZHkpL2kudGVzdChlWzBdLnRhZ05hbWUpO2lmKHRoaXMuY3NzUG9zaXRpb249PVwicmVsYXRpdmVcIiYmISh0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJnRoaXMuc2Nyb2xsUGFyZW50WzBdIT10aGlzLm9mZnNldFBhcmVudFswXSkpdGhpcy5vZmZzZXQucmVsYXRpdmU9dGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKTtcbnZhciBnPWQucGFnZVgsaT1kLnBhZ2VZO2lmKHRoaXMub3JpZ2luYWxQb3NpdGlvbil7aWYodGhpcy5jb250YWlubWVudCl7aWYoZC5wYWdlWC10aGlzLm9mZnNldC5jbGljay5sZWZ0PHRoaXMuY29udGFpbm1lbnRbMF0pZz10aGlzLmNvbnRhaW5tZW50WzBdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQ7aWYoZC5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A8dGhpcy5jb250YWlubWVudFsxXSlpPXRoaXMuY29udGFpbm1lbnRbMV0rdGhpcy5vZmZzZXQuY2xpY2sudG9wO2lmKGQucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdD50aGlzLmNvbnRhaW5tZW50WzJdKWc9dGhpcy5jb250YWlubWVudFsyXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0O2lmKGQucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPnRoaXMuY29udGFpbm1lbnRbM10paT10aGlzLmNvbnRhaW5tZW50WzNdK3RoaXMub2Zmc2V0LmNsaWNrLnRvcH1pZihjLmdyaWQpe2k9dGhpcy5vcmlnaW5hbFBhZ2VZK01hdGgucm91bmQoKGktXG50aGlzLm9yaWdpbmFsUGFnZVkpL2MuZ3JpZFsxXSkqYy5ncmlkWzFdO2k9dGhpcy5jb250YWlubWVudD8hKGktdGhpcy5vZmZzZXQuY2xpY2sudG9wPHRoaXMuY29udGFpbm1lbnRbMV18fGktdGhpcy5vZmZzZXQuY2xpY2sudG9wPnRoaXMuY29udGFpbm1lbnRbM10pP2k6IShpLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDx0aGlzLmNvbnRhaW5tZW50WzFdKT9pLWMuZ3JpZFsxXTppK2MuZ3JpZFsxXTppO2c9dGhpcy5vcmlnaW5hbFBhZ2VYK01hdGgucm91bmQoKGctdGhpcy5vcmlnaW5hbFBhZ2VYKS9jLmdyaWRbMF0pKmMuZ3JpZFswXTtnPXRoaXMuY29udGFpbm1lbnQ/IShnLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ8dGhpcy5jb250YWlubWVudFswXXx8Zy10aGlzLm9mZnNldC5jbGljay5sZWZ0PnRoaXMuY29udGFpbm1lbnRbMl0pP2c6IShnLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ8dGhpcy5jb250YWlubWVudFswXSk/Zy1jLmdyaWRbMF06ZytjLmdyaWRbMF06Z319cmV0dXJue3RvcDppLVxudGhpcy5vZmZzZXQuY2xpY2sudG9wLXRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wKyhhLmJyb3dzZXIuc2FmYXJpJiZ0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/MDp0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpOmg/MDplLnNjcm9sbFRvcCgpKSxsZWZ0OmctdGhpcy5vZmZzZXQuY2xpY2subGVmdC10aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0KyhhLmJyb3dzZXIuc2FmYXJpJiZ0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/MDp0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTpoPzA6ZS5zY3JvbGxMZWZ0KCkpfX0sX3JlYXJyYW5nZTpmdW5jdGlvbihkLGMsZSxoKXtlP2VbMF0uYXBwZW5kQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSk6Yy5pdGVtWzBdLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMucGxhY2Vob2xkZXJbMF0sXG50aGlzLmRpcmVjdGlvbj09XCJkb3duXCI/Yy5pdGVtWzBdOmMuaXRlbVswXS5uZXh0U2libGluZyk7dGhpcy5jb3VudGVyPXRoaXMuY291bnRlcj8rK3RoaXMuY291bnRlcjoxO3ZhciBnPXRoaXMsaT10aGlzLmNvdW50ZXI7d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXtpPT1nLmNvdW50ZXImJmcucmVmcmVzaFBvc2l0aW9ucyghaCl9LDApfSxfY2xlYXI6ZnVuY3Rpb24oZCxjKXt0aGlzLnJldmVydGluZz1mYWxzZTt2YXIgZT1bXTshdGhpcy5fbm9GaW5hbFNvcnQmJnRoaXMuY3VycmVudEl0ZW0ucGFyZW50KCkubGVuZ3RoJiZ0aGlzLnBsYWNlaG9sZGVyLmJlZm9yZSh0aGlzLmN1cnJlbnRJdGVtKTt0aGlzLl9ub0ZpbmFsU29ydD1udWxsO2lmKHRoaXMuaGVscGVyWzBdPT10aGlzLmN1cnJlbnRJdGVtWzBdKXtmb3IodmFyIGggaW4gdGhpcy5fc3RvcmVkQ1NTKWlmKHRoaXMuX3N0b3JlZENTU1toXT09XCJhdXRvXCJ8fHRoaXMuX3N0b3JlZENTU1toXT09XCJzdGF0aWNcIil0aGlzLl9zdG9yZWRDU1NbaF09XG5cIlwiO3RoaXMuY3VycmVudEl0ZW0uY3NzKHRoaXMuX3N0b3JlZENTUykucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIil9ZWxzZSB0aGlzLmN1cnJlbnRJdGVtLnNob3coKTt0aGlzLmZyb21PdXRzaWRlJiYhYyYmZS5wdXNoKGZ1bmN0aW9uKGcpe3RoaXMuX3RyaWdnZXIoXCJyZWNlaXZlXCIsZyx0aGlzLl91aUhhc2godGhpcy5mcm9tT3V0c2lkZSkpfSk7aWYoKHRoaXMuZnJvbU91dHNpZGV8fHRoaXMuZG9tUG9zaXRpb24ucHJldiE9dGhpcy5jdXJyZW50SXRlbS5wcmV2KCkubm90KFwiLnVpLXNvcnRhYmxlLWhlbHBlclwiKVswXXx8dGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQhPXRoaXMuY3VycmVudEl0ZW0ucGFyZW50KClbMF0pJiYhYyllLnB1c2goZnVuY3Rpb24oZyl7dGhpcy5fdHJpZ2dlcihcInVwZGF0ZVwiLGcsdGhpcy5fdWlIYXNoKCkpfSk7aWYoIWEudWkuY29udGFpbnModGhpcy5lbGVtZW50WzBdLHRoaXMuY3VycmVudEl0ZW1bMF0pKXtjfHxlLnB1c2goZnVuY3Rpb24oZyl7dGhpcy5fdHJpZ2dlcihcInJlbW92ZVwiLFxuZyx0aGlzLl91aUhhc2goKSl9KTtmb3IoaD10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7aD49MDtoLS0paWYoYS51aS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbaF0uZWxlbWVudFswXSx0aGlzLmN1cnJlbnRJdGVtWzBdKSYmIWMpe2UucHVzaChmdW5jdGlvbihnKXtyZXR1cm4gZnVuY3Rpb24oaSl7Zy5fdHJpZ2dlcihcInJlY2VpdmVcIixpLHRoaXMuX3VpSGFzaCh0aGlzKSl9fS5jYWxsKHRoaXMsdGhpcy5jb250YWluZXJzW2hdKSk7ZS5wdXNoKGZ1bmN0aW9uKGcpe3JldHVybiBmdW5jdGlvbihpKXtnLl90cmlnZ2VyKFwidXBkYXRlXCIsaSx0aGlzLl91aUhhc2godGhpcykpfX0uY2FsbCh0aGlzLHRoaXMuY29udGFpbmVyc1toXSkpfX1mb3IoaD10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7aD49MDtoLS0pe2N8fGUucHVzaChmdW5jdGlvbihnKXtyZXR1cm4gZnVuY3Rpb24oaSl7Zy5fdHJpZ2dlcihcImRlYWN0aXZhdGVcIixpLHRoaXMuX3VpSGFzaCh0aGlzKSl9fS5jYWxsKHRoaXMsXG50aGlzLmNvbnRhaW5lcnNbaF0pKTtpZih0aGlzLmNvbnRhaW5lcnNbaF0uY29udGFpbmVyQ2FjaGUub3Zlcil7ZS5wdXNoKGZ1bmN0aW9uKGcpe3JldHVybiBmdW5jdGlvbihpKXtnLl90cmlnZ2VyKFwib3V0XCIsaSx0aGlzLl91aUhhc2godGhpcykpfX0uY2FsbCh0aGlzLHRoaXMuY29udGFpbmVyc1toXSkpO3RoaXMuY29udGFpbmVyc1toXS5jb250YWluZXJDYWNoZS5vdmVyPTB9fXRoaXMuX3N0b3JlZEN1cnNvciYmYShcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIsdGhpcy5fc3RvcmVkQ3Vyc29yKTt0aGlzLl9zdG9yZWRPcGFjaXR5JiZ0aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIsdGhpcy5fc3RvcmVkT3BhY2l0eSk7aWYodGhpcy5fc3RvcmVkWkluZGV4KXRoaXMuaGVscGVyLmNzcyhcInpJbmRleFwiLHRoaXMuX3N0b3JlZFpJbmRleD09XCJhdXRvXCI/XCJcIjp0aGlzLl9zdG9yZWRaSW5kZXgpO3RoaXMuZHJhZ2dpbmc9ZmFsc2U7aWYodGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsKXtpZighYyl7dGhpcy5fdHJpZ2dlcihcImJlZm9yZVN0b3BcIixcbmQsdGhpcy5fdWlIYXNoKCkpO2ZvcihoPTA7aDxlLmxlbmd0aDtoKyspZVtoXS5jYWxsKHRoaXMsZCk7dGhpcy5fdHJpZ2dlcihcInN0b3BcIixkLHRoaXMuX3VpSGFzaCgpKX1yZXR1cm4gZmFsc2V9Y3x8dGhpcy5fdHJpZ2dlcihcImJlZm9yZVN0b3BcIixkLHRoaXMuX3VpSGFzaCgpKTt0aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSk7dGhpcy5oZWxwZXJbMF0hPXRoaXMuY3VycmVudEl0ZW1bMF0mJnRoaXMuaGVscGVyLnJlbW92ZSgpO3RoaXMuaGVscGVyPW51bGw7aWYoIWMpe2ZvcihoPTA7aDxlLmxlbmd0aDtoKyspZVtoXS5jYWxsKHRoaXMsZCk7dGhpcy5fdHJpZ2dlcihcInN0b3BcIixkLHRoaXMuX3VpSGFzaCgpKX10aGlzLmZyb21PdXRzaWRlPWZhbHNlO3JldHVybiB0cnVlfSxfdHJpZ2dlcjpmdW5jdGlvbigpe2EuV2lkZ2V0LnByb3RvdHlwZS5fdHJpZ2dlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk9PT1mYWxzZSYmdGhpcy5jYW5jZWwoKX0sXG5fdWlIYXNoOmZ1bmN0aW9uKGQpe3ZhciBjPWR8fHRoaXM7cmV0dXJue2hlbHBlcjpjLmhlbHBlcixwbGFjZWhvbGRlcjpjLnBsYWNlaG9sZGVyfHxhKFtdKSxwb3NpdGlvbjpjLnBvc2l0aW9uLG9yaWdpbmFsUG9zaXRpb246Yy5vcmlnaW5hbFBvc2l0aW9uLG9mZnNldDpjLnBvc2l0aW9uQWJzLGl0ZW06Yy5jdXJyZW50SXRlbSxzZW5kZXI6ZD9kLmVsZW1lbnQ6bnVsbH19fSk7YS5leHRlbmQoYS51aS5zb3J0YWJsZSx7dmVyc2lvbjpcIjEuOC4xNlwifSl9KShqUXVlcnkpO1xualF1ZXJ5LmVmZmVjdHN8fGZ1bmN0aW9uKGEsZCl7ZnVuY3Rpb24gYyhuKXt2YXIgaztpZihuJiZuLmNvbnN0cnVjdG9yPT1BcnJheSYmbi5sZW5ndGg9PTMpcmV0dXJuIG47aWYoaz0vcmdiXFwoXFxzKihbMC05XXsxLDN9KVxccyosXFxzKihbMC05XXsxLDN9KVxccyosXFxzKihbMC05XXsxLDN9KVxccypcXCkvLmV4ZWMobikpcmV0dXJuW3BhcnNlSW50KGtbMV0sMTApLHBhcnNlSW50KGtbMl0sMTApLHBhcnNlSW50KGtbM10sMTApXTtpZihrPS9yZ2JcXChcXHMqKFswLTldKyg/OlxcLlswLTldKyk/KVxcJVxccyosXFxzKihbMC05XSsoPzpcXC5bMC05XSspPylcXCVcXHMqLFxccyooWzAtOV0rKD86XFwuWzAtOV0rKT8pXFwlXFxzKlxcKS8uZXhlYyhuKSlyZXR1cm5bcGFyc2VGbG9hdChrWzFdKSoyLjU1LHBhcnNlRmxvYXQoa1syXSkqMi41NSxwYXJzZUZsb2F0KGtbM10pKjIuNTVdO2lmKGs9LyMoW2EtZkEtRjAtOV17Mn0pKFthLWZBLUYwLTldezJ9KShbYS1mQS1GMC05XXsyfSkvLmV4ZWMobikpcmV0dXJuW3BhcnNlSW50KGtbMV0sXG4xNikscGFyc2VJbnQoa1syXSwxNikscGFyc2VJbnQoa1szXSwxNildO2lmKGs9LyMoW2EtZkEtRjAtOV0pKFthLWZBLUYwLTldKShbYS1mQS1GMC05XSkvLmV4ZWMobikpcmV0dXJuW3BhcnNlSW50KGtbMV0ra1sxXSwxNikscGFyc2VJbnQoa1syXStrWzJdLDE2KSxwYXJzZUludChrWzNdK2tbM10sMTYpXTtpZigvcmdiYVxcKDAsIDAsIDAsIDBcXCkvLmV4ZWMobikpcmV0dXJuIGoudHJhbnNwYXJlbnQ7cmV0dXJuIGpbYS50cmltKG4pLnRvTG93ZXJDYXNlKCldfWZ1bmN0aW9uIGUobixrKXt2YXIgbTtkb3ttPWEuY3VyQ1NTKG4sayk7aWYobSE9XCJcIiYmbSE9XCJ0cmFuc3BhcmVudFwifHxhLm5vZGVOYW1lKG4sXCJib2R5XCIpKWJyZWFrO2s9XCJiYWNrZ3JvdW5kQ29sb3JcIn13aGlsZShuPW4ucGFyZW50Tm9kZSk7cmV0dXJuIGMobSl9ZnVuY3Rpb24gaCgpe3ZhciBuPWRvY3VtZW50LmRlZmF1bHRWaWV3P2RvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUodGhpcyxudWxsKTp0aGlzLmN1cnJlbnRTdHlsZSxcbms9e30sbSxwO2lmKG4mJm4ubGVuZ3RoJiZuWzBdJiZuW25bMF1dKWZvcih2YXIgcT1uLmxlbmd0aDtxLS07KXttPW5bcV07aWYodHlwZW9mIG5bbV09PVwic3RyaW5nXCIpe3A9bS5yZXBsYWNlKC9cXC0oXFx3KS9nLGZ1bmN0aW9uKHMscil7cmV0dXJuIHIudG9VcHBlckNhc2UoKX0pO2tbcF09blttXX19ZWxzZSBmb3IobSBpbiBuKWlmKHR5cGVvZiBuW21dPT09XCJzdHJpbmdcIilrW21dPW5bbV07cmV0dXJuIGt9ZnVuY3Rpb24gZyhuKXt2YXIgayxtO2ZvcihrIGluIG4pe209bltrXTtpZihtPT1udWxsfHxhLmlzRnVuY3Rpb24obSl8fGsgaW4gb3x8L3Njcm9sbGJhci8udGVzdChrKXx8IS9jb2xvci9pLnRlc3QoaykmJmlzTmFOKHBhcnNlRmxvYXQobSkpKWRlbGV0ZSBuW2tdfXJldHVybiBufWZ1bmN0aW9uIGkobixrKXt2YXIgbT17XzowfSxwO2ZvcihwIGluIGspaWYobltwXSE9a1twXSltW3BdPWtbcF07cmV0dXJuIG19ZnVuY3Rpb24gYihuLGssbSxwKXtpZih0eXBlb2Ygbj09XCJvYmplY3RcIil7cD1cbms7bT1udWxsO2s9bjtuPWsuZWZmZWN0fWlmKGEuaXNGdW5jdGlvbihrKSl7cD1rO209bnVsbDtrPXt9fWlmKHR5cGVvZiBrPT1cIm51bWJlclwifHxhLmZ4LnNwZWVkc1trXSl7cD1tO209aztrPXt9fWlmKGEuaXNGdW5jdGlvbihtKSl7cD1tO209bnVsbH1rPWt8fHt9O209bXx8ay5kdXJhdGlvbjttPWEuZngub2ZmPzA6dHlwZW9mIG09PVwibnVtYmVyXCI/bTptIGluIGEuZnguc3BlZWRzP2EuZnguc3BlZWRzW21dOmEuZnguc3BlZWRzLl9kZWZhdWx0O3A9cHx8ay5jb21wbGV0ZTtyZXR1cm5bbixrLG0scF19ZnVuY3Rpb24gZihuKXtpZighbnx8dHlwZW9mIG49PT1cIm51bWJlclwifHxhLmZ4LnNwZWVkc1tuXSlyZXR1cm4gdHJ1ZTtpZih0eXBlb2Ygbj09PVwic3RyaW5nXCImJiFhLmVmZmVjdHNbbl0pcmV0dXJuIHRydWU7cmV0dXJuIGZhbHNlfWEuZWZmZWN0cz17fTthLmVhY2goW1wiYmFja2dyb3VuZENvbG9yXCIsXCJib3JkZXJCb3R0b21Db2xvclwiLFwiYm9yZGVyTGVmdENvbG9yXCIsXCJib3JkZXJSaWdodENvbG9yXCIsXG5cImJvcmRlclRvcENvbG9yXCIsXCJib3JkZXJDb2xvclwiLFwiY29sb3JcIixcIm91dGxpbmVDb2xvclwiXSxmdW5jdGlvbihuLGspe2EuZnguc3RlcFtrXT1mdW5jdGlvbihtKXtpZighbS5jb2xvckluaXQpe20uc3RhcnQ9ZShtLmVsZW0sayk7bS5lbmQ9YyhtLmVuZCk7bS5jb2xvckluaXQ9dHJ1ZX1tLmVsZW0uc3R5bGVba109XCJyZ2IoXCIrTWF0aC5tYXgoTWF0aC5taW4ocGFyc2VJbnQobS5wb3MqKG0uZW5kWzBdLW0uc3RhcnRbMF0pK20uc3RhcnRbMF0sMTApLDI1NSksMCkrXCIsXCIrTWF0aC5tYXgoTWF0aC5taW4ocGFyc2VJbnQobS5wb3MqKG0uZW5kWzFdLW0uc3RhcnRbMV0pK20uc3RhcnRbMV0sMTApLDI1NSksMCkrXCIsXCIrTWF0aC5tYXgoTWF0aC5taW4ocGFyc2VJbnQobS5wb3MqKG0uZW5kWzJdLW0uc3RhcnRbMl0pK20uc3RhcnRbMl0sMTApLDI1NSksMCkrXCIpXCJ9fSk7dmFyIGo9e2FxdWE6WzAsMjU1LDI1NV0sYXp1cmU6WzI0MCwyNTUsMjU1XSxiZWlnZTpbMjQ1LDI0NSwyMjBdLGJsYWNrOlswLFxuMCwwXSxibHVlOlswLDAsMjU1XSxicm93bjpbMTY1LDQyLDQyXSxjeWFuOlswLDI1NSwyNTVdLGRhcmtibHVlOlswLDAsMTM5XSxkYXJrY3lhbjpbMCwxMzksMTM5XSxkYXJrZ3JleTpbMTY5LDE2OSwxNjldLGRhcmtncmVlbjpbMCwxMDAsMF0sZGFya2toYWtpOlsxODksMTgzLDEwN10sZGFya21hZ2VudGE6WzEzOSwwLDEzOV0sZGFya29saXZlZ3JlZW46Wzg1LDEwNyw0N10sZGFya29yYW5nZTpbMjU1LDE0MCwwXSxkYXJrb3JjaGlkOlsxNTMsNTAsMjA0XSxkYXJrcmVkOlsxMzksMCwwXSxkYXJrc2FsbW9uOlsyMzMsMTUwLDEyMl0sZGFya3Zpb2xldDpbMTQ4LDAsMjExXSxmdWNoc2lhOlsyNTUsMCwyNTVdLGdvbGQ6WzI1NSwyMTUsMF0sZ3JlZW46WzAsMTI4LDBdLGluZGlnbzpbNzUsMCwxMzBdLGtoYWtpOlsyNDAsMjMwLDE0MF0sbGlnaHRibHVlOlsxNzMsMjE2LDIzMF0sbGlnaHRjeWFuOlsyMjQsMjU1LDI1NV0sbGlnaHRncmVlbjpbMTQ0LDIzOCwxNDRdLGxpZ2h0Z3JleTpbMjExLFxuMjExLDIxMV0sbGlnaHRwaW5rOlsyNTUsMTgyLDE5M10sbGlnaHR5ZWxsb3c6WzI1NSwyNTUsMjI0XSxsaW1lOlswLDI1NSwwXSxtYWdlbnRhOlsyNTUsMCwyNTVdLG1hcm9vbjpbMTI4LDAsMF0sbmF2eTpbMCwwLDEyOF0sb2xpdmU6WzEyOCwxMjgsMF0sb3JhbmdlOlsyNTUsMTY1LDBdLHBpbms6WzI1NSwxOTIsMjAzXSxwdXJwbGU6WzEyOCwwLDEyOF0sdmlvbGV0OlsxMjgsMCwxMjhdLHJlZDpbMjU1LDAsMF0sc2lsdmVyOlsxOTIsMTkyLDE5Ml0sd2hpdGU6WzI1NSwyNTUsMjU1XSx5ZWxsb3c6WzI1NSwyNTUsMF0sdHJhbnNwYXJlbnQ6WzI1NSwyNTUsMjU1XX0sbD1bXCJhZGRcIixcInJlbW92ZVwiLFwidG9nZ2xlXCJdLG89e2JvcmRlcjoxLGJvcmRlckJvdHRvbToxLGJvcmRlckNvbG9yOjEsYm9yZGVyTGVmdDoxLGJvcmRlclJpZ2h0OjEsYm9yZGVyVG9wOjEsYm9yZGVyV2lkdGg6MSxtYXJnaW46MSxwYWRkaW5nOjF9O2EuZWZmZWN0cy5hbmltYXRlQ2xhc3M9ZnVuY3Rpb24obixrLG0sXG5wKXtpZihhLmlzRnVuY3Rpb24obSkpe3A9bTttPW51bGx9cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgcT1hKHRoaXMpLHM9cS5hdHRyKFwic3R5bGVcIil8fFwiIFwiLHI9ZyhoLmNhbGwodGhpcykpLHUsdj1xLmF0dHIoXCJjbGFzc1wiKTthLmVhY2gobCxmdW5jdGlvbih3LHgpe25beF0mJnFbeCtcIkNsYXNzXCJdKG5beF0pfSk7dT1nKGguY2FsbCh0aGlzKSk7cS5hdHRyKFwiY2xhc3NcIix2KTtxLmFuaW1hdGUoaShyLHUpLHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjprLGVhc2luZzptLGNvbXBsZXRlOmZ1bmN0aW9uKCl7YS5lYWNoKGwsZnVuY3Rpb24odyx4KXtuW3hdJiZxW3grXCJDbGFzc1wiXShuW3hdKX0pO2lmKHR5cGVvZiBxLmF0dHIoXCJzdHlsZVwiKT09XCJvYmplY3RcIil7cS5hdHRyKFwic3R5bGVcIikuY3NzVGV4dD1cIlwiO3EuYXR0cihcInN0eWxlXCIpLmNzc1RleHQ9c31lbHNlIHEuYXR0cihcInN0eWxlXCIscyk7cCYmcC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7YS5kZXF1ZXVlKHRoaXMpfX0pfSl9O1xuYS5mbi5leHRlbmQoe19hZGRDbGFzczphLmZuLmFkZENsYXNzLGFkZENsYXNzOmZ1bmN0aW9uKG4sayxtLHApe3JldHVybiBrP2EuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxbe2FkZDpufSxrLG0scF0pOnRoaXMuX2FkZENsYXNzKG4pfSxfcmVtb3ZlQ2xhc3M6YS5mbi5yZW1vdmVDbGFzcyxyZW1vdmVDbGFzczpmdW5jdGlvbihuLGssbSxwKXtyZXR1cm4gaz9hLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmFwcGx5KHRoaXMsW3tyZW1vdmU6bn0sayxtLHBdKTp0aGlzLl9yZW1vdmVDbGFzcyhuKX0sX3RvZ2dsZUNsYXNzOmEuZm4udG9nZ2xlQ2xhc3MsdG9nZ2xlQ2xhc3M6ZnVuY3Rpb24obixrLG0scCxxKXtyZXR1cm4gdHlwZW9mIGs9PVwiYm9vbGVhblwifHxrPT09ZD9tP2EuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxbaz97YWRkOm59OntyZW1vdmU6bn0sbSxwLHFdKTp0aGlzLl90b2dnbGVDbGFzcyhuLGspOmEuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxcblt7dG9nZ2xlOm59LGssbSxwXSl9LHN3aXRjaENsYXNzOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuIGEuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxbe2FkZDprLHJlbW92ZTpufSxtLHAscV0pfX0pO2EuZXh0ZW5kKGEuZWZmZWN0cyx7dmVyc2lvbjpcIjEuOC4xNlwiLHNhdmU6ZnVuY3Rpb24obixrKXtmb3IodmFyIG09MDttPGsubGVuZ3RoO20rKylrW21dIT09bnVsbCYmbi5kYXRhKFwiZWMuc3RvcmFnZS5cIitrW21dLG5bMF0uc3R5bGVba1ttXV0pfSxyZXN0b3JlOmZ1bmN0aW9uKG4sayl7Zm9yKHZhciBtPTA7bTxrLmxlbmd0aDttKyspa1ttXSE9PW51bGwmJm4uY3NzKGtbbV0sbi5kYXRhKFwiZWMuc3RvcmFnZS5cIitrW21dKSl9LHNldE1vZGU6ZnVuY3Rpb24obixrKXtpZihrPT1cInRvZ2dsZVwiKWs9bi5pcyhcIjpoaWRkZW5cIik/XCJzaG93XCI6XCJoaWRlXCI7cmV0dXJuIGt9LGdldEJhc2VsaW5lOmZ1bmN0aW9uKG4sayl7dmFyIG07c3dpdGNoKG5bMF0pe2Nhc2UgXCJ0b3BcIjptPVxuMDticmVhaztjYXNlIFwibWlkZGxlXCI6bT0wLjU7YnJlYWs7Y2FzZSBcImJvdHRvbVwiOm09MTticmVhaztkZWZhdWx0Om09blswXS9rLmhlaWdodH1zd2l0Y2goblsxXSl7Y2FzZSBcImxlZnRcIjpuPTA7YnJlYWs7Y2FzZSBcImNlbnRlclwiOm49MC41O2JyZWFrO2Nhc2UgXCJyaWdodFwiOm49MTticmVhaztkZWZhdWx0Om49blsxXS9rLndpZHRofXJldHVybnt4Om4seTptfX0sY3JlYXRlV3JhcHBlcjpmdW5jdGlvbihuKXtpZihuLnBhcmVudCgpLmlzKFwiLnVpLWVmZmVjdHMtd3JhcHBlclwiKSlyZXR1cm4gbi5wYXJlbnQoKTt2YXIgaz17d2lkdGg6bi5vdXRlcldpZHRoKHRydWUpLGhlaWdodDpuLm91dGVySGVpZ2h0KHRydWUpLFwiZmxvYXRcIjpuLmNzcyhcImZsb2F0XCIpfSxtPWEoXCI8ZGl2PjwvZGl2PlwiKS5hZGRDbGFzcyhcInVpLWVmZmVjdHMtd3JhcHBlclwiKS5jc3Moe2ZvbnRTaXplOlwiMTAwJVwiLGJhY2tncm91bmQ6XCJ0cmFuc3BhcmVudFwiLGJvcmRlcjpcIm5vbmVcIixtYXJnaW46MCxwYWRkaW5nOjB9KSxcbnA9ZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtuLndyYXAobSk7aWYoblswXT09PXB8fGEuY29udGFpbnMoblswXSxwKSlhKHApLmZvY3VzKCk7bT1uLnBhcmVudCgpO2lmKG4uY3NzKFwicG9zaXRpb25cIik9PVwic3RhdGljXCIpe20uY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCJ9KTtuLmNzcyh7cG9zaXRpb246XCJyZWxhdGl2ZVwifSl9ZWxzZXthLmV4dGVuZChrLHtwb3NpdGlvbjpuLmNzcyhcInBvc2l0aW9uXCIpLHpJbmRleDpuLmNzcyhcInotaW5kZXhcIil9KTthLmVhY2goW1widG9wXCIsXCJsZWZ0XCIsXCJib3R0b21cIixcInJpZ2h0XCJdLGZ1bmN0aW9uKHEscyl7a1tzXT1uLmNzcyhzKTtpZihpc05hTihwYXJzZUludChrW3NdLDEwKSkpa1tzXT1cImF1dG9cIn0pO24uY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCIsdG9wOjAsbGVmdDowLHJpZ2h0OlwiYXV0b1wiLGJvdHRvbTpcImF1dG9cIn0pfXJldHVybiBtLmNzcyhrKS5zaG93KCl9LHJlbW92ZVdyYXBwZXI6ZnVuY3Rpb24obil7dmFyIGssbT1kb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuaWYobi5wYXJlbnQoKS5pcyhcIi51aS1lZmZlY3RzLXdyYXBwZXJcIikpe2s9bi5wYXJlbnQoKS5yZXBsYWNlV2l0aChuKTtpZihuWzBdPT09bXx8YS5jb250YWlucyhuWzBdLG0pKWEobSkuZm9jdXMoKTtyZXR1cm4ga31yZXR1cm4gbn0sc2V0VHJhbnNpdGlvbjpmdW5jdGlvbihuLGssbSxwKXtwPXB8fHt9O2EuZWFjaChrLGZ1bmN0aW9uKHEscyl7dW5pdD1uLmNzc1VuaXQocyk7aWYodW5pdFswXT4wKXBbc109dW5pdFswXSptK3VuaXRbMV19KTtyZXR1cm4gcH19KTthLmZuLmV4dGVuZCh7ZWZmZWN0OmZ1bmN0aW9uKG4pe3ZhciBrPWIuYXBwbHkodGhpcyxhcmd1bWVudHMpLG09e29wdGlvbnM6a1sxXSxkdXJhdGlvbjprWzJdLGNhbGxiYWNrOmtbM119O2s9bS5vcHRpb25zLm1vZGU7dmFyIHA9YS5lZmZlY3RzW25dO2lmKGEuZngub2ZmfHwhcClyZXR1cm4gaz90aGlzW2tdKG0uZHVyYXRpb24sbS5jYWxsYmFjayk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7bS5jYWxsYmFjayYmbS5jYWxsYmFjay5jYWxsKHRoaXMpfSk7XG5yZXR1cm4gcC5jYWxsKHRoaXMsbSl9LF9zaG93OmEuZm4uc2hvdyxzaG93OmZ1bmN0aW9uKG4pe2lmKGYobikpcmV0dXJuIHRoaXMuX3Nob3cuYXBwbHkodGhpcyxhcmd1bWVudHMpO2Vsc2V7dmFyIGs9Yi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7a1sxXS5tb2RlPVwic2hvd1wiO3JldHVybiB0aGlzLmVmZmVjdC5hcHBseSh0aGlzLGspfX0sX2hpZGU6YS5mbi5oaWRlLGhpZGU6ZnVuY3Rpb24obil7aWYoZihuKSlyZXR1cm4gdGhpcy5faGlkZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7ZWxzZXt2YXIgaz1iLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtrWzFdLm1vZGU9XCJoaWRlXCI7cmV0dXJuIHRoaXMuZWZmZWN0LmFwcGx5KHRoaXMsayl9fSxfX3RvZ2dsZTphLmZuLnRvZ2dsZSx0b2dnbGU6ZnVuY3Rpb24obil7aWYoZihuKXx8dHlwZW9mIG49PT1cImJvb2xlYW5cInx8YS5pc0Z1bmN0aW9uKG4pKXJldHVybiB0aGlzLl9fdG9nZ2xlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtlbHNle3ZhciBrPWIuYXBwbHkodGhpcyxcbmFyZ3VtZW50cyk7a1sxXS5tb2RlPVwidG9nZ2xlXCI7cmV0dXJuIHRoaXMuZWZmZWN0LmFwcGx5KHRoaXMsayl9fSxjc3NVbml0OmZ1bmN0aW9uKG4pe3ZhciBrPXRoaXMuY3NzKG4pLG09W107YS5lYWNoKFtcImVtXCIsXCJweFwiLFwiJVwiLFwicHRcIl0sZnVuY3Rpb24ocCxxKXtpZihrLmluZGV4T2YocSk+MCltPVtwYXJzZUZsb2F0KGspLHFdfSk7cmV0dXJuIG19fSk7YS5lYXNpbmcuanN3aW5nPWEuZWFzaW5nLnN3aW5nO2EuZXh0ZW5kKGEuZWFzaW5nLHtkZWY6XCJlYXNlT3V0UXVhZFwiLHN3aW5nOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuIGEuZWFzaW5nW2EuZWFzaW5nLmRlZl0obixrLG0scCxxKX0sZWFzZUluUXVhZDpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybiBwKihrLz1xKSprK219LGVhc2VPdXRRdWFkOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuLXAqKGsvPXEpKihrLTIpK219LGVhc2VJbk91dFF1YWQ6ZnVuY3Rpb24obixrLG0scCxxKXtpZigoay89cS8yKTwxKXJldHVybiBwL1xuMiprKmsrbTtyZXR1cm4tcC8yKigtLWsqKGstMiktMSkrbX0sZWFzZUluQ3ViaWM6ZnVuY3Rpb24obixrLG0scCxxKXtyZXR1cm4gcCooay89cSkqayprK219LGVhc2VPdXRDdWJpYzpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybiBwKigoaz1rL3EtMSkqayprKzEpK219LGVhc2VJbk91dEN1YmljOmZ1bmN0aW9uKG4sayxtLHAscSl7aWYoKGsvPXEvMik8MSlyZXR1cm4gcC8yKmsqayprK207cmV0dXJuIHAvMiooKGstPTIpKmsqaysyKSttfSxlYXNlSW5RdWFydDpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybiBwKihrLz1xKSprKmsqayttfSxlYXNlT3V0UXVhcnQ6ZnVuY3Rpb24obixrLG0scCxxKXtyZXR1cm4tcCooKGs9ay9xLTEpKmsqayprLTEpK219LGVhc2VJbk91dFF1YXJ0OmZ1bmN0aW9uKG4sayxtLHAscSl7aWYoKGsvPXEvMik8MSlyZXR1cm4gcC8yKmsqayprKmsrbTtyZXR1cm4tcC8yKigoay09MikqayprKmstMikrbX0sZWFzZUluUXVpbnQ6ZnVuY3Rpb24obixrLG0sXG5wLHEpe3JldHVybiBwKihrLz1xKSprKmsqayprK219LGVhc2VPdXRRdWludDpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybiBwKigoaz1rL3EtMSkqayprKmsqaysxKSttfSxlYXNlSW5PdXRRdWludDpmdW5jdGlvbihuLGssbSxwLHEpe2lmKChrLz1xLzIpPDEpcmV0dXJuIHAvMiprKmsqayprKmsrbTtyZXR1cm4gcC8yKigoay09MikqayprKmsqaysyKSttfSxlYXNlSW5TaW5lOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuLXAqTWF0aC5jb3Moay9xKihNYXRoLlBJLzIpKStwK219LGVhc2VPdXRTaW5lOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuIHAqTWF0aC5zaW4oay9xKihNYXRoLlBJLzIpKSttfSxlYXNlSW5PdXRTaW5lOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuLXAvMiooTWF0aC5jb3MoTWF0aC5QSSprL3EpLTEpK219LGVhc2VJbkV4cG86ZnVuY3Rpb24obixrLG0scCxxKXtyZXR1cm4gaz09MD9tOnAqTWF0aC5wb3coMiwxMCooay9xLTEpKSttfSxlYXNlT3V0RXhwbzpmdW5jdGlvbihuLFxuayxtLHAscSl7cmV0dXJuIGs9PXE/bStwOnAqKC1NYXRoLnBvdygyLC0xMCprL3EpKzEpK219LGVhc2VJbk91dEV4cG86ZnVuY3Rpb24obixrLG0scCxxKXtpZihrPT0wKXJldHVybiBtO2lmKGs9PXEpcmV0dXJuIG0rcDtpZigoay89cS8yKTwxKXJldHVybiBwLzIqTWF0aC5wb3coMiwxMCooay0xKSkrbTtyZXR1cm4gcC8yKigtTWF0aC5wb3coMiwtMTAqLS1rKSsyKSttfSxlYXNlSW5DaXJjOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuLXAqKE1hdGguc3FydCgxLShrLz1xKSprKS0xKSttfSxlYXNlT3V0Q2lyYzpmdW5jdGlvbihuLGssbSxwLHEpe3JldHVybiBwKk1hdGguc3FydCgxLShrPWsvcS0xKSprKSttfSxlYXNlSW5PdXRDaXJjOmZ1bmN0aW9uKG4sayxtLHAscSl7aWYoKGsvPXEvMik8MSlyZXR1cm4tcC8yKihNYXRoLnNxcnQoMS1rKmspLTEpK207cmV0dXJuIHAvMiooTWF0aC5zcXJ0KDEtKGstPTIpKmspKzEpK219LGVhc2VJbkVsYXN0aWM6ZnVuY3Rpb24obixrLG0sXG5wLHEpe249MS43MDE1ODt2YXIgcz0wLHI9cDtpZihrPT0wKXJldHVybiBtO2lmKChrLz1xKT09MSlyZXR1cm4gbStwO3N8fChzPXEqMC4zKTtpZihyPE1hdGguYWJzKHApKXtyPXA7bj1zLzR9ZWxzZSBuPXMvKDIqTWF0aC5QSSkqTWF0aC5hc2luKHAvcik7cmV0dXJuLShyKk1hdGgucG93KDIsMTAqKGstPTEpKSpNYXRoLnNpbigoaypxLW4pKjIqTWF0aC5QSS9zKSkrbX0sZWFzZU91dEVsYXN0aWM6ZnVuY3Rpb24obixrLG0scCxxKXtuPTEuNzAxNTg7dmFyIHM9MCxyPXA7aWYoaz09MClyZXR1cm4gbTtpZigoay89cSk9PTEpcmV0dXJuIG0rcDtzfHwocz1xKjAuMyk7aWYocjxNYXRoLmFicyhwKSl7cj1wO249cy80fWVsc2Ugbj1zLygyKk1hdGguUEkpKk1hdGguYXNpbihwL3IpO3JldHVybiByKk1hdGgucG93KDIsLTEwKmspKk1hdGguc2luKChrKnEtbikqMipNYXRoLlBJL3MpK3ArbX0sZWFzZUluT3V0RWxhc3RpYzpmdW5jdGlvbihuLGssbSxwLHEpe249MS43MDE1ODt2YXIgcz1cbjAscj1wO2lmKGs9PTApcmV0dXJuIG07aWYoKGsvPXEvMik9PTIpcmV0dXJuIG0rcDtzfHwocz1xKjAuMyoxLjUpO2lmKHI8TWF0aC5hYnMocCkpe3I9cDtuPXMvNH1lbHNlIG49cy8oMipNYXRoLlBJKSpNYXRoLmFzaW4ocC9yKTtpZihrPDEpcmV0dXJuLTAuNSpyKk1hdGgucG93KDIsMTAqKGstPTEpKSpNYXRoLnNpbigoaypxLW4pKjIqTWF0aC5QSS9zKSttO3JldHVybiByKk1hdGgucG93KDIsLTEwKihrLT0xKSkqTWF0aC5zaW4oKGsqcS1uKSoyKk1hdGguUEkvcykqMC41K3ArbX0sZWFzZUluQmFjazpmdW5jdGlvbihuLGssbSxwLHEscyl7aWYocz09ZClzPTEuNzAxNTg7cmV0dXJuIHAqKGsvPXEpKmsqKChzKzEpKmstcykrbX0sZWFzZU91dEJhY2s6ZnVuY3Rpb24obixrLG0scCxxLHMpe2lmKHM9PWQpcz0xLjcwMTU4O3JldHVybiBwKigoaz1rL3EtMSkqayooKHMrMSkqaytzKSsxKSttfSxlYXNlSW5PdXRCYWNrOmZ1bmN0aW9uKG4sayxtLHAscSxzKXtpZihzPT1kKXM9MS43MDE1ODtcbmlmKChrLz1xLzIpPDEpcmV0dXJuIHAvMiprKmsqKCgocyo9MS41MjUpKzEpKmstcykrbTtyZXR1cm4gcC8yKigoay09MikqayooKChzKj0xLjUyNSkrMSkqaytzKSsyKSttfSxlYXNlSW5Cb3VuY2U6ZnVuY3Rpb24obixrLG0scCxxKXtyZXR1cm4gcC1hLmVhc2luZy5lYXNlT3V0Qm91bmNlKG4scS1rLDAscCxxKSttfSxlYXNlT3V0Qm91bmNlOmZ1bmN0aW9uKG4sayxtLHAscSl7cmV0dXJuKGsvPXEpPDEvMi43NT9wKjcuNTYyNSprKmsrbTprPDIvMi43NT9wKig3LjU2MjUqKGstPTEuNS8yLjc1KSprKzAuNzUpK206azwyLjUvMi43NT9wKig3LjU2MjUqKGstPTIuMjUvMi43NSkqayswLjkzNzUpK206cCooNy41NjI1KihrLT0yLjYyNS8yLjc1KSprKzAuOTg0Mzc1KSttfSxlYXNlSW5PdXRCb3VuY2U6ZnVuY3Rpb24obixrLG0scCxxKXtpZihrPHEvMilyZXR1cm4gYS5lYXNpbmcuZWFzZUluQm91bmNlKG4sayoyLDAscCxxKSowLjUrbTtyZXR1cm4gYS5lYXNpbmcuZWFzZU91dEJvdW5jZShuLFxuayoyLXEsMCxwLHEpKjAuNStwKjAuNSttfX0pfShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EuZWZmZWN0cy5ibGluZD1mdW5jdGlvbihkKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZT1bXCJwb3NpdGlvblwiLFwidG9wXCIsXCJib3R0b21cIixcImxlZnRcIixcInJpZ2h0XCJdLGg9YS5lZmZlY3RzLnNldE1vZGUoYyxkLm9wdGlvbnMubW9kZXx8XCJoaWRlXCIpLGc9ZC5vcHRpb25zLmRpcmVjdGlvbnx8XCJ2ZXJ0aWNhbFwiO2EuZWZmZWN0cy5zYXZlKGMsZSk7Yy5zaG93KCk7dmFyIGk9YS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYykuY3NzKHtvdmVyZmxvdzpcImhpZGRlblwifSksYj1nPT1cInZlcnRpY2FsXCI/XCJoZWlnaHRcIjpcIndpZHRoXCI7Zz1nPT1cInZlcnRpY2FsXCI/aS5oZWlnaHQoKTppLndpZHRoKCk7aD09XCJzaG93XCImJmkuY3NzKGIsMCk7dmFyIGY9e307ZltiXT1oPT1cInNob3dcIj9nOjA7aS5hbmltYXRlKGYsZC5kdXJhdGlvbixkLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7aD09XCJoaWRlXCImJmMuaGlkZSgpO2EuZWZmZWN0cy5yZXN0b3JlKGMsXG5lKTthLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihjKTtkLmNhbGxiYWNrJiZkLmNhbGxiYWNrLmFwcGx5KGNbMF0sYXJndW1lbnRzKTtjLmRlcXVldWUoKX0pfSl9fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLmVmZmVjdHMuYm91bmNlPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxlPVtcInBvc2l0aW9uXCIsXCJ0b3BcIixcImJvdHRvbVwiLFwibGVmdFwiLFwicmlnaHRcIl0saD1hLmVmZmVjdHMuc2V0TW9kZShjLGQub3B0aW9ucy5tb2RlfHxcImVmZmVjdFwiKSxnPWQub3B0aW9ucy5kaXJlY3Rpb258fFwidXBcIixpPWQub3B0aW9ucy5kaXN0YW5jZXx8MjAsYj1kLm9wdGlvbnMudGltZXN8fDUsZj1kLmR1cmF0aW9ufHwyNTA7L3Nob3d8aGlkZS8udGVzdChoKSYmZS5wdXNoKFwib3BhY2l0eVwiKTthLmVmZmVjdHMuc2F2ZShjLGUpO2Muc2hvdygpO2EuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpO3ZhciBqPWc9PVwidXBcInx8Zz09XCJkb3duXCI/XCJ0b3BcIjpcImxlZnRcIjtnPWc9PVwidXBcInx8Zz09XCJsZWZ0XCI/XCJwb3NcIjpcIm5lZ1wiO2k9ZC5vcHRpb25zLmRpc3RhbmNlfHwoaj09XCJ0b3BcIj9jLm91dGVySGVpZ2h0KHttYXJnaW46dHJ1ZX0pLzM6Yy5vdXRlcldpZHRoKHttYXJnaW46dHJ1ZX0pL1xuMyk7aWYoaD09XCJzaG93XCIpYy5jc3MoXCJvcGFjaXR5XCIsMCkuY3NzKGosZz09XCJwb3NcIj8taTppKTtpZihoPT1cImhpZGVcIilpLz1iKjI7aCE9XCJoaWRlXCImJmItLTtpZihoPT1cInNob3dcIil7dmFyIGw9e29wYWNpdHk6MX07bFtqXT0oZz09XCJwb3NcIj9cIis9XCI6XCItPVwiKStpO2MuYW5pbWF0ZShsLGYvMixkLm9wdGlvbnMuZWFzaW5nKTtpLz0yO2ItLX1mb3IobD0wO2w8YjtsKyspe3ZhciBvPXt9LG49e307b1tqXT0oZz09XCJwb3NcIj9cIi09XCI6XCIrPVwiKStpO25bal09KGc9PVwicG9zXCI/XCIrPVwiOlwiLT1cIikraTtjLmFuaW1hdGUobyxmLzIsZC5vcHRpb25zLmVhc2luZykuYW5pbWF0ZShuLGYvMixkLm9wdGlvbnMuZWFzaW5nKTtpPWg9PVwiaGlkZVwiP2kqMjppLzJ9aWYoaD09XCJoaWRlXCIpe2w9e29wYWNpdHk6MH07bFtqXT0oZz09XCJwb3NcIj9cIi09XCI6XCIrPVwiKStpO2MuYW5pbWF0ZShsLGYvMixkLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7Yy5oaWRlKCk7YS5lZmZlY3RzLnJlc3RvcmUoYyxlKTthLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihjKTtcbmQuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpfSl9ZWxzZXtvPXt9O249e307b1tqXT0oZz09XCJwb3NcIj9cIi09XCI6XCIrPVwiKStpO25bal09KGc9PVwicG9zXCI/XCIrPVwiOlwiLT1cIikraTtjLmFuaW1hdGUobyxmLzIsZC5vcHRpb25zLmVhc2luZykuYW5pbWF0ZShuLGYvMixkLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7YS5lZmZlY3RzLnJlc3RvcmUoYyxlKTthLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihjKTtkLmNhbGxiYWNrJiZkLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pfWMucXVldWUoXCJmeFwiLGZ1bmN0aW9uKCl7Yy5kZXF1ZXVlKCl9KTtjLmRlcXVldWUoKX0pfX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS5lZmZlY3RzLmNsaXA9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGU9W1wicG9zaXRpb25cIixcInRvcFwiLFwiYm90dG9tXCIsXCJsZWZ0XCIsXCJyaWdodFwiLFwiaGVpZ2h0XCIsXCJ3aWR0aFwiXSxoPWEuZWZmZWN0cy5zZXRNb2RlKGMsZC5vcHRpb25zLm1vZGV8fFwiaGlkZVwiKSxnPWQub3B0aW9ucy5kaXJlY3Rpb258fFwidmVydGljYWxcIjthLmVmZmVjdHMuc2F2ZShjLGUpO2Muc2hvdygpO3ZhciBpPWEuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpLmNzcyh7b3ZlcmZsb3c6XCJoaWRkZW5cIn0pO2k9Y1swXS50YWdOYW1lPT1cIklNR1wiP2k6Yzt2YXIgYj17c2l6ZTpnPT1cInZlcnRpY2FsXCI/XCJoZWlnaHRcIjpcIndpZHRoXCIscG9zaXRpb246Zz09XCJ2ZXJ0aWNhbFwiP1widG9wXCI6XCJsZWZ0XCJ9O2c9Zz09XCJ2ZXJ0aWNhbFwiP2kuaGVpZ2h0KCk6aS53aWR0aCgpO2lmKGg9PVwic2hvd1wiKXtpLmNzcyhiLnNpemUsMCk7aS5jc3MoYi5wb3NpdGlvbixcbmcvMil9dmFyIGY9e307ZltiLnNpemVdPWg9PVwic2hvd1wiP2c6MDtmW2IucG9zaXRpb25dPWg9PVwic2hvd1wiPzA6Zy8yO2kuYW5pbWF0ZShmLHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpkLmR1cmF0aW9uLGVhc2luZzpkLm9wdGlvbnMuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7aD09XCJoaWRlXCImJmMuaGlkZSgpO2EuZWZmZWN0cy5yZXN0b3JlKGMsZSk7YS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyk7ZC5jYWxsYmFjayYmZC5jYWxsYmFjay5hcHBseShjWzBdLGFyZ3VtZW50cyk7Yy5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EuZWZmZWN0cy5kcm9wPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxlPVtcInBvc2l0aW9uXCIsXCJ0b3BcIixcImJvdHRvbVwiLFwibGVmdFwiLFwicmlnaHRcIixcIm9wYWNpdHlcIl0saD1hLmVmZmVjdHMuc2V0TW9kZShjLGQub3B0aW9ucy5tb2RlfHxcImhpZGVcIiksZz1kLm9wdGlvbnMuZGlyZWN0aW9ufHxcImxlZnRcIjthLmVmZmVjdHMuc2F2ZShjLGUpO2Muc2hvdygpO2EuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpO3ZhciBpPWc9PVwidXBcInx8Zz09XCJkb3duXCI/XCJ0b3BcIjpcImxlZnRcIjtnPWc9PVwidXBcInx8Zz09XCJsZWZ0XCI/XCJwb3NcIjpcIm5lZ1wiO3ZhciBiPWQub3B0aW9ucy5kaXN0YW5jZXx8KGk9PVwidG9wXCI/Yy5vdXRlckhlaWdodCh7bWFyZ2luOnRydWV9KS8yOmMub3V0ZXJXaWR0aCh7bWFyZ2luOnRydWV9KS8yKTtpZihoPT1cInNob3dcIiljLmNzcyhcIm9wYWNpdHlcIiwwKS5jc3MoaSxnPT1cInBvc1wiPy1iOmIpO3ZhciBmPXtvcGFjaXR5Omg9PVxuXCJzaG93XCI/MTowfTtmW2ldPShoPT1cInNob3dcIj9nPT1cInBvc1wiP1wiKz1cIjpcIi09XCI6Zz09XCJwb3NcIj9cIi09XCI6XCIrPVwiKStiO2MuYW5pbWF0ZShmLHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpkLmR1cmF0aW9uLGVhc2luZzpkLm9wdGlvbnMuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7aD09XCJoaWRlXCImJmMuaGlkZSgpO2EuZWZmZWN0cy5yZXN0b3JlKGMsZSk7YS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyk7ZC5jYWxsYmFjayYmZC5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Yy5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EuZWZmZWN0cy5leHBsb2RlPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9ZC5vcHRpb25zLnBpZWNlcz9NYXRoLnJvdW5kKE1hdGguc3FydChkLm9wdGlvbnMucGllY2VzKSk6MyxlPWQub3B0aW9ucy5waWVjZXM/TWF0aC5yb3VuZChNYXRoLnNxcnQoZC5vcHRpb25zLnBpZWNlcykpOjM7ZC5vcHRpb25zLm1vZGU9ZC5vcHRpb25zLm1vZGU9PVwidG9nZ2xlXCI/YSh0aGlzKS5pcyhcIjp2aXNpYmxlXCIpP1wiaGlkZVwiOlwic2hvd1wiOmQub3B0aW9ucy5tb2RlO3ZhciBoPWEodGhpcykuc2hvdygpLmNzcyhcInZpc2liaWxpdHlcIixcImhpZGRlblwiKSxnPWgub2Zmc2V0KCk7Zy50b3AtPXBhcnNlSW50KGguY3NzKFwibWFyZ2luVG9wXCIpLDEwKXx8MDtnLmxlZnQtPXBhcnNlSW50KGguY3NzKFwibWFyZ2luTGVmdFwiKSwxMCl8fDA7Zm9yKHZhciBpPWgub3V0ZXJXaWR0aCh0cnVlKSxiPWgub3V0ZXJIZWlnaHQodHJ1ZSksZj0wO2Y8YztmKyspZm9yKHZhciBqPVxuMDtqPGU7aisrKWguY2xvbmUoKS5hcHBlbmRUbyhcImJvZHlcIikud3JhcChcIjxkaXY+PC9kaXY+XCIpLmNzcyh7cG9zaXRpb246XCJhYnNvbHV0ZVwiLHZpc2liaWxpdHk6XCJ2aXNpYmxlXCIsbGVmdDotaiooaS9lKSx0b3A6LWYqKGIvYyl9KS5wYXJlbnQoKS5hZGRDbGFzcyhcInVpLWVmZmVjdHMtZXhwbG9kZVwiKS5jc3Moe3Bvc2l0aW9uOlwiYWJzb2x1dGVcIixvdmVyZmxvdzpcImhpZGRlblwiLHdpZHRoOmkvZSxoZWlnaHQ6Yi9jLGxlZnQ6Zy5sZWZ0K2oqKGkvZSkrKGQub3B0aW9ucy5tb2RlPT1cInNob3dcIj8oai1NYXRoLmZsb29yKGUvMikpKihpL2UpOjApLHRvcDpnLnRvcCtmKihiL2MpKyhkLm9wdGlvbnMubW9kZT09XCJzaG93XCI/KGYtTWF0aC5mbG9vcihjLzIpKSooYi9jKTowKSxvcGFjaXR5OmQub3B0aW9ucy5tb2RlPT1cInNob3dcIj8wOjF9KS5hbmltYXRlKHtsZWZ0OmcubGVmdCtqKihpL2UpKyhkLm9wdGlvbnMubW9kZT09XCJzaG93XCI/MDooai1NYXRoLmZsb29yKGUvMikpKihpL2UpKSx0b3A6Zy50b3ArXG5mKihiL2MpKyhkLm9wdGlvbnMubW9kZT09XCJzaG93XCI/MDooZi1NYXRoLmZsb29yKGMvMikpKihiL2MpKSxvcGFjaXR5OmQub3B0aW9ucy5tb2RlPT1cInNob3dcIj8xOjB9LGQuZHVyYXRpb258fDUwMCk7c2V0VGltZW91dChmdW5jdGlvbigpe2Qub3B0aW9ucy5tb2RlPT1cInNob3dcIj9oLmNzcyh7dmlzaWJpbGl0eTpcInZpc2libGVcIn0pOmguY3NzKHt2aXNpYmlsaXR5OlwidmlzaWJsZVwifSkuaGlkZSgpO2QuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkoaFswXSk7aC5kZXF1ZXVlKCk7YShcImRpdi51aS1lZmZlY3RzLWV4cGxvZGVcIikucmVtb3ZlKCl9LGQuZHVyYXRpb258fDUwMCl9KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EuZWZmZWN0cy5mYWRlPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxlPWEuZWZmZWN0cy5zZXRNb2RlKGMsZC5vcHRpb25zLm1vZGV8fFwiaGlkZVwiKTtjLmFuaW1hdGUoe29wYWNpdHk6ZX0se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmQuZHVyYXRpb24sZWFzaW5nOmQub3B0aW9ucy5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXtkLmNhbGxiYWNrJiZkLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtjLmRlcXVldWUoKX19KX0pfX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS5lZmZlY3RzLmZvbGQ9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGU9W1wicG9zaXRpb25cIixcInRvcFwiLFwiYm90dG9tXCIsXCJsZWZ0XCIsXCJyaWdodFwiXSxoPWEuZWZmZWN0cy5zZXRNb2RlKGMsZC5vcHRpb25zLm1vZGV8fFwiaGlkZVwiKSxnPWQub3B0aW9ucy5zaXplfHwxNSxpPSEhZC5vcHRpb25zLmhvcml6Rmlyc3QsYj1kLmR1cmF0aW9uP2QuZHVyYXRpb24vMjphLmZ4LnNwZWVkcy5fZGVmYXVsdC8yO2EuZWZmZWN0cy5zYXZlKGMsZSk7Yy5zaG93KCk7dmFyIGY9YS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYykuY3NzKHtvdmVyZmxvdzpcImhpZGRlblwifSksaj1oPT1cInNob3dcIiE9aSxsPWo/W1wid2lkdGhcIixcImhlaWdodFwiXTpbXCJoZWlnaHRcIixcIndpZHRoXCJdO2o9aj9bZi53aWR0aCgpLGYuaGVpZ2h0KCldOltmLmhlaWdodCgpLGYud2lkdGgoKV07dmFyIG89LyhbMC05XSspJS8uZXhlYyhnKTtpZihvKWc9cGFyc2VJbnQob1sxXSxcbjEwKS8xMDAqaltoPT1cImhpZGVcIj8wOjFdO2lmKGg9PVwic2hvd1wiKWYuY3NzKGk/e2hlaWdodDowLHdpZHRoOmd9OntoZWlnaHQ6Zyx3aWR0aDowfSk7aT17fTtvPXt9O2lbbFswXV09aD09XCJzaG93XCI/alswXTpnO29bbFsxXV09aD09XCJzaG93XCI/alsxXTowO2YuYW5pbWF0ZShpLGIsZC5vcHRpb25zLmVhc2luZykuYW5pbWF0ZShvLGIsZC5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2g9PVwiaGlkZVwiJiZjLmhpZGUoKTthLmVmZmVjdHMucmVzdG9yZShjLGUpO2EuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGMpO2QuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkoY1swXSxhcmd1bWVudHMpO2MuZGVxdWV1ZSgpfSl9KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EuZWZmZWN0cy5oaWdobGlnaHQ9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGU9W1wiYmFja2dyb3VuZEltYWdlXCIsXCJiYWNrZ3JvdW5kQ29sb3JcIixcIm9wYWNpdHlcIl0saD1hLmVmZmVjdHMuc2V0TW9kZShjLGQub3B0aW9ucy5tb2RlfHxcInNob3dcIiksZz17YmFja2dyb3VuZENvbG9yOmMuY3NzKFwiYmFja2dyb3VuZENvbG9yXCIpfTtpZihoPT1cImhpZGVcIilnLm9wYWNpdHk9MDthLmVmZmVjdHMuc2F2ZShjLGUpO2Muc2hvdygpLmNzcyh7YmFja2dyb3VuZEltYWdlOlwibm9uZVwiLGJhY2tncm91bmRDb2xvcjpkLm9wdGlvbnMuY29sb3J8fFwiI2ZmZmY5OVwifSkuYW5pbWF0ZShnLHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpkLmR1cmF0aW9uLGVhc2luZzpkLm9wdGlvbnMuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7aD09XCJoaWRlXCImJmMuaGlkZSgpO2EuZWZmZWN0cy5yZXN0b3JlKGMsZSk7aD09XCJzaG93XCImJiFhLnN1cHBvcnQub3BhY2l0eSYmXG50aGlzLnN0eWxlLnJlbW92ZUF0dHJpYnV0ZShcImZpbHRlclwiKTtkLmNhbGxiYWNrJiZkLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtjLmRlcXVldWUoKX19KX0pfX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS5lZmZlY3RzLnB1bHNhdGU9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGU9YS5lZmZlY3RzLnNldE1vZGUoYyxkLm9wdGlvbnMubW9kZXx8XCJzaG93XCIpO3RpbWVzPShkLm9wdGlvbnMudGltZXN8fDUpKjItMTtkdXJhdGlvbj1kLmR1cmF0aW9uP2QuZHVyYXRpb24vMjphLmZ4LnNwZWVkcy5fZGVmYXVsdC8yO2lzVmlzaWJsZT1jLmlzKFwiOnZpc2libGVcIik7YW5pbWF0ZVRvPTA7aWYoIWlzVmlzaWJsZSl7Yy5jc3MoXCJvcGFjaXR5XCIsMCkuc2hvdygpO2FuaW1hdGVUbz0xfWlmKGU9PVwiaGlkZVwiJiZpc1Zpc2libGV8fGU9PVwic2hvd1wiJiYhaXNWaXNpYmxlKXRpbWVzLS07Zm9yKGU9MDtlPHRpbWVzO2UrKyl7Yy5hbmltYXRlKHtvcGFjaXR5OmFuaW1hdGVUb30sZHVyYXRpb24sZC5vcHRpb25zLmVhc2luZyk7YW5pbWF0ZVRvPShhbmltYXRlVG8rMSklMn1jLmFuaW1hdGUoe29wYWNpdHk6YW5pbWF0ZVRvfSxkdXJhdGlvbixcbmQub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXthbmltYXRlVG89PTAmJmMuaGlkZSgpO2QuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpfSk7Yy5xdWV1ZShcImZ4XCIsZnVuY3Rpb24oKXtjLmRlcXVldWUoKX0pLmRlcXVldWUoKX0pfX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS5lZmZlY3RzLnB1ZmY9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGU9YS5lZmZlY3RzLnNldE1vZGUoYyxkLm9wdGlvbnMubW9kZXx8XCJoaWRlXCIpLGg9cGFyc2VJbnQoZC5vcHRpb25zLnBlcmNlbnQsMTApfHwxNTAsZz1oLzEwMCxpPXtoZWlnaHQ6Yy5oZWlnaHQoKSx3aWR0aDpjLndpZHRoKCl9O2EuZXh0ZW5kKGQub3B0aW9ucyx7ZmFkZTp0cnVlLG1vZGU6ZSxwZXJjZW50OmU9PVwiaGlkZVwiP2g6MTAwLGZyb206ZT09XCJoaWRlXCI/aTp7aGVpZ2h0OmkuaGVpZ2h0Kmcsd2lkdGg6aS53aWR0aCpnfX0pO2MuZWZmZWN0KFwic2NhbGVcIixkLm9wdGlvbnMsZC5kdXJhdGlvbixkLmNhbGxiYWNrKTtjLmRlcXVldWUoKX0pfTthLmVmZmVjdHMuc2NhbGU9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGU9YS5leHRlbmQodHJ1ZSx7fSxkLm9wdGlvbnMpLGg9YS5lZmZlY3RzLnNldE1vZGUoYyxcbmQub3B0aW9ucy5tb2RlfHxcImVmZmVjdFwiKSxnPXBhcnNlSW50KGQub3B0aW9ucy5wZXJjZW50LDEwKXx8KHBhcnNlSW50KGQub3B0aW9ucy5wZXJjZW50LDEwKT09MD8wOmg9PVwiaGlkZVwiPzA6MTAwKSxpPWQub3B0aW9ucy5kaXJlY3Rpb258fFwiYm90aFwiLGI9ZC5vcHRpb25zLm9yaWdpbjtpZihoIT1cImVmZmVjdFwiKXtlLm9yaWdpbj1ifHxbXCJtaWRkbGVcIixcImNlbnRlclwiXTtlLnJlc3RvcmU9dHJ1ZX1iPXtoZWlnaHQ6Yy5oZWlnaHQoKSx3aWR0aDpjLndpZHRoKCl9O2MuZnJvbT1kLm9wdGlvbnMuZnJvbXx8KGg9PVwic2hvd1wiP3toZWlnaHQ6MCx3aWR0aDowfTpiKTtnPXt5OmkhPVwiaG9yaXpvbnRhbFwiP2cvMTAwOjEseDppIT1cInZlcnRpY2FsXCI/Zy8xMDA6MX07Yy50bz17aGVpZ2h0OmIuaGVpZ2h0KmcueSx3aWR0aDpiLndpZHRoKmcueH07aWYoZC5vcHRpb25zLmZhZGUpe2lmKGg9PVwic2hvd1wiKXtjLmZyb20ub3BhY2l0eT0wO2MudG8ub3BhY2l0eT0xfWlmKGg9PVwiaGlkZVwiKXtjLmZyb20ub3BhY2l0eT1cbjE7Yy50by5vcGFjaXR5PTB9fWUuZnJvbT1jLmZyb207ZS50bz1jLnRvO2UubW9kZT1oO2MuZWZmZWN0KFwic2l6ZVwiLGUsZC5kdXJhdGlvbixkLmNhbGxiYWNrKTtjLmRlcXVldWUoKX0pfTthLmVmZmVjdHMuc2l6ZT1mdW5jdGlvbihkKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZT1bXCJwb3NpdGlvblwiLFwidG9wXCIsXCJib3R0b21cIixcImxlZnRcIixcInJpZ2h0XCIsXCJ3aWR0aFwiLFwiaGVpZ2h0XCIsXCJvdmVyZmxvd1wiLFwib3BhY2l0eVwiXSxoPVtcInBvc2l0aW9uXCIsXCJ0b3BcIixcImJvdHRvbVwiLFwibGVmdFwiLFwicmlnaHRcIixcIm92ZXJmbG93XCIsXCJvcGFjaXR5XCJdLGc9W1wid2lkdGhcIixcImhlaWdodFwiLFwib3ZlcmZsb3dcIl0saT1bXCJmb250U2l6ZVwiXSxiPVtcImJvcmRlclRvcFdpZHRoXCIsXCJib3JkZXJCb3R0b21XaWR0aFwiLFwicGFkZGluZ1RvcFwiLFwicGFkZGluZ0JvdHRvbVwiXSxmPVtcImJvcmRlckxlZnRXaWR0aFwiLFwiYm9yZGVyUmlnaHRXaWR0aFwiLFwicGFkZGluZ0xlZnRcIixcInBhZGRpbmdSaWdodFwiXSxcbmo9YS5lZmZlY3RzLnNldE1vZGUoYyxkLm9wdGlvbnMubW9kZXx8XCJlZmZlY3RcIiksbD1kLm9wdGlvbnMucmVzdG9yZXx8ZmFsc2Usbz1kLm9wdGlvbnMuc2NhbGV8fFwiYm90aFwiLG49ZC5vcHRpb25zLm9yaWdpbixrPXtoZWlnaHQ6Yy5oZWlnaHQoKSx3aWR0aDpjLndpZHRoKCl9O2MuZnJvbT1kLm9wdGlvbnMuZnJvbXx8aztjLnRvPWQub3B0aW9ucy50b3x8aztpZihuKXtuPWEuZWZmZWN0cy5nZXRCYXNlbGluZShuLGspO2MuZnJvbS50b3A9KGsuaGVpZ2h0LWMuZnJvbS5oZWlnaHQpKm4ueTtjLmZyb20ubGVmdD0oay53aWR0aC1jLmZyb20ud2lkdGgpKm4ueDtjLnRvLnRvcD0oay5oZWlnaHQtYy50by5oZWlnaHQpKm4ueTtjLnRvLmxlZnQ9KGsud2lkdGgtYy50by53aWR0aCkqbi54fXZhciBtPXtmcm9tOnt5OmMuZnJvbS5oZWlnaHQvay5oZWlnaHQseDpjLmZyb20ud2lkdGgvay53aWR0aH0sdG86e3k6Yy50by5oZWlnaHQvay5oZWlnaHQseDpjLnRvLndpZHRoL2sud2lkdGh9fTtcbmlmKG89PVwiYm94XCJ8fG89PVwiYm90aFwiKXtpZihtLmZyb20ueSE9bS50by55KXtlPWUuY29uY2F0KGIpO2MuZnJvbT1hLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjLGIsbS5mcm9tLnksYy5mcm9tKTtjLnRvPWEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGMsYixtLnRvLnksYy50byl9aWYobS5mcm9tLnghPW0udG8ueCl7ZT1lLmNvbmNhdChmKTtjLmZyb209YS5lZmZlY3RzLnNldFRyYW5zaXRpb24oYyxmLG0uZnJvbS54LGMuZnJvbSk7Yy50bz1hLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjLGYsbS50by54LGMudG8pfX1pZihvPT1cImNvbnRlbnRcInx8bz09XCJib3RoXCIpaWYobS5mcm9tLnkhPW0udG8ueSl7ZT1lLmNvbmNhdChpKTtjLmZyb209YS5lZmZlY3RzLnNldFRyYW5zaXRpb24oYyxpLG0uZnJvbS55LGMuZnJvbSk7Yy50bz1hLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjLGksbS50by55LGMudG8pfWEuZWZmZWN0cy5zYXZlKGMsbD9lOmgpO2Muc2hvdygpO2EuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpO1xuYy5jc3MoXCJvdmVyZmxvd1wiLFwiaGlkZGVuXCIpLmNzcyhjLmZyb20pO2lmKG89PVwiY29udGVudFwifHxvPT1cImJvdGhcIil7Yj1iLmNvbmNhdChbXCJtYXJnaW5Ub3BcIixcIm1hcmdpbkJvdHRvbVwiXSkuY29uY2F0KGkpO2Y9Zi5jb25jYXQoW1wibWFyZ2luTGVmdFwiLFwibWFyZ2luUmlnaHRcIl0pO2c9ZS5jb25jYXQoYikuY29uY2F0KGYpO2MuZmluZChcIipbd2lkdGhdXCIpLmVhY2goZnVuY3Rpb24oKXtjaGlsZD1hKHRoaXMpO2wmJmEuZWZmZWN0cy5zYXZlKGNoaWxkLGcpO3ZhciBwPXtoZWlnaHQ6Y2hpbGQuaGVpZ2h0KCksd2lkdGg6Y2hpbGQud2lkdGgoKX07Y2hpbGQuZnJvbT17aGVpZ2h0OnAuaGVpZ2h0Km0uZnJvbS55LHdpZHRoOnAud2lkdGgqbS5mcm9tLnh9O2NoaWxkLnRvPXtoZWlnaHQ6cC5oZWlnaHQqbS50by55LHdpZHRoOnAud2lkdGgqbS50by54fTtpZihtLmZyb20ueSE9bS50by55KXtjaGlsZC5mcm9tPWEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGNoaWxkLGIsbS5mcm9tLnksY2hpbGQuZnJvbSk7XG5jaGlsZC50bz1hLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjaGlsZCxiLG0udG8ueSxjaGlsZC50byl9aWYobS5mcm9tLnghPW0udG8ueCl7Y2hpbGQuZnJvbT1hLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjaGlsZCxmLG0uZnJvbS54LGNoaWxkLmZyb20pO2NoaWxkLnRvPWEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGNoaWxkLGYsbS50by54LGNoaWxkLnRvKX1jaGlsZC5jc3MoY2hpbGQuZnJvbSk7Y2hpbGQuYW5pbWF0ZShjaGlsZC50byxkLmR1cmF0aW9uLGQub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXtsJiZhLmVmZmVjdHMucmVzdG9yZShjaGlsZCxnKX0pfSl9Yy5hbmltYXRlKGMudG8se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmQuZHVyYXRpb24sZWFzaW5nOmQub3B0aW9ucy5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXtjLnRvLm9wYWNpdHk9PT0wJiZjLmNzcyhcIm9wYWNpdHlcIixjLmZyb20ub3BhY2l0eSk7aj09XCJoaWRlXCImJmMuaGlkZSgpO2EuZWZmZWN0cy5yZXN0b3JlKGMsXG5sP2U6aCk7YS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyk7ZC5jYWxsYmFjayYmZC5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Yy5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EuZWZmZWN0cy5zaGFrZT1mdW5jdGlvbihkKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZT1bXCJwb3NpdGlvblwiLFwidG9wXCIsXCJib3R0b21cIixcImxlZnRcIixcInJpZ2h0XCJdO2EuZWZmZWN0cy5zZXRNb2RlKGMsZC5vcHRpb25zLm1vZGV8fFwiZWZmZWN0XCIpO3ZhciBoPWQub3B0aW9ucy5kaXJlY3Rpb258fFwibGVmdFwiLGc9ZC5vcHRpb25zLmRpc3RhbmNlfHwyMCxpPWQub3B0aW9ucy50aW1lc3x8MyxiPWQuZHVyYXRpb258fGQub3B0aW9ucy5kdXJhdGlvbnx8MTQwO2EuZWZmZWN0cy5zYXZlKGMsZSk7Yy5zaG93KCk7YS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYyk7dmFyIGY9aD09XCJ1cFwifHxoPT1cImRvd25cIj9cInRvcFwiOlwibGVmdFwiLGo9aD09XCJ1cFwifHxoPT1cImxlZnRcIj9cInBvc1wiOlwibmVnXCI7aD17fTt2YXIgbD17fSxvPXt9O2hbZl09KGo9PVwicG9zXCI/XCItPVwiOlwiKz1cIikrZztsW2ZdPShqPT1cInBvc1wiP1wiKz1cIjpcIi09XCIpK2cqMjtvW2ZdPVxuKGo9PVwicG9zXCI/XCItPVwiOlwiKz1cIikrZyoyO2MuYW5pbWF0ZShoLGIsZC5vcHRpb25zLmVhc2luZyk7Zm9yKGc9MTtnPGk7ZysrKWMuYW5pbWF0ZShsLGIsZC5vcHRpb25zLmVhc2luZykuYW5pbWF0ZShvLGIsZC5vcHRpb25zLmVhc2luZyk7Yy5hbmltYXRlKGwsYixkLm9wdGlvbnMuZWFzaW5nKS5hbmltYXRlKGgsYi8yLGQub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXthLmVmZmVjdHMucmVzdG9yZShjLGUpO2EuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGMpO2QuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpfSk7Yy5xdWV1ZShcImZ4XCIsZnVuY3Rpb24oKXtjLmRlcXVldWUoKX0pO2MuZGVxdWV1ZSgpfSl9fSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLmVmZmVjdHMuc2xpZGU9ZnVuY3Rpb24oZCl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGU9W1wicG9zaXRpb25cIixcInRvcFwiLFwiYm90dG9tXCIsXCJsZWZ0XCIsXCJyaWdodFwiXSxoPWEuZWZmZWN0cy5zZXRNb2RlKGMsZC5vcHRpb25zLm1vZGV8fFwic2hvd1wiKSxnPWQub3B0aW9ucy5kaXJlY3Rpb258fFwibGVmdFwiO2EuZWZmZWN0cy5zYXZlKGMsZSk7Yy5zaG93KCk7YS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYykuY3NzKHtvdmVyZmxvdzpcImhpZGRlblwifSk7dmFyIGk9Zz09XCJ1cFwifHxnPT1cImRvd25cIj9cInRvcFwiOlwibGVmdFwiO2c9Zz09XCJ1cFwifHxnPT1cImxlZnRcIj9cInBvc1wiOlwibmVnXCI7dmFyIGI9ZC5vcHRpb25zLmRpc3RhbmNlfHwoaT09XCJ0b3BcIj9jLm91dGVySGVpZ2h0KHttYXJnaW46dHJ1ZX0pOmMub3V0ZXJXaWR0aCh7bWFyZ2luOnRydWV9KSk7aWYoaD09XCJzaG93XCIpYy5jc3MoaSxnPT1cInBvc1wiP2lzTmFOKGIpP1wiLVwiK2I6LWI6Yik7XG52YXIgZj17fTtmW2ldPShoPT1cInNob3dcIj9nPT1cInBvc1wiP1wiKz1cIjpcIi09XCI6Zz09XCJwb3NcIj9cIi09XCI6XCIrPVwiKStiO2MuYW5pbWF0ZShmLHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpkLmR1cmF0aW9uLGVhc2luZzpkLm9wdGlvbnMuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7aD09XCJoaWRlXCImJmMuaGlkZSgpO2EuZWZmZWN0cy5yZXN0b3JlKGMsZSk7YS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyk7ZC5jYWxsYmFjayYmZC5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Yy5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EuZWZmZWN0cy50cmFuc2Zlcj1mdW5jdGlvbihkKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZT1hKGQub3B0aW9ucy50byksaD1lLm9mZnNldCgpO2U9e3RvcDpoLnRvcCxsZWZ0OmgubGVmdCxoZWlnaHQ6ZS5pbm5lckhlaWdodCgpLHdpZHRoOmUuaW5uZXJXaWR0aCgpfTtoPWMub2Zmc2V0KCk7dmFyIGc9YSgnPGRpdiBjbGFzcz1cInVpLWVmZmVjdHMtdHJhbnNmZXJcIj48L2Rpdj4nKS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KS5hZGRDbGFzcyhkLm9wdGlvbnMuY2xhc3NOYW1lKS5jc3Moe3RvcDpoLnRvcCxsZWZ0OmgubGVmdCxoZWlnaHQ6Yy5pbm5lckhlaWdodCgpLHdpZHRoOmMuaW5uZXJXaWR0aCgpLHBvc2l0aW9uOlwiYWJzb2x1dGVcIn0pLmFuaW1hdGUoZSxkLmR1cmF0aW9uLGQub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXtnLnJlbW92ZSgpO2QuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkoY1swXSxhcmd1bWVudHMpO1xuYy5kZXF1ZXVlKCl9KX0pfX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS53aWRnZXQoXCJ1aS5hY2NvcmRpb25cIix7b3B0aW9uczp7YWN0aXZlOjAsYW5pbWF0ZWQ6XCJzbGlkZVwiLGF1dG9IZWlnaHQ6dHJ1ZSxjbGVhclN0eWxlOmZhbHNlLGNvbGxhcHNpYmxlOmZhbHNlLGV2ZW50OlwiY2xpY2tcIixmaWxsU3BhY2U6ZmFsc2UsaGVhZGVyOlwiPiBsaSA+IDpmaXJzdC1jaGlsZCw+IDpub3QobGkpOmV2ZW5cIixpY29uczp7aGVhZGVyOlwidWktaWNvbi10cmlhbmdsZS0xLWVcIixoZWFkZXJTZWxlY3RlZDpcInVpLWljb24tdHJpYW5nbGUtMS1zXCJ9LG5hdmlnYXRpb246ZmFsc2UsbmF2aWdhdGlvbkZpbHRlcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmhyZWYudG9Mb3dlckNhc2UoKT09PWxvY2F0aW9uLmhyZWYudG9Mb3dlckNhc2UoKX19LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgZD10aGlzLGM9ZC5vcHRpb25zO2QucnVubmluZz0wO2QuZWxlbWVudC5hZGRDbGFzcyhcInVpLWFjY29yZGlvbiB1aS13aWRnZXQgdWktaGVscGVyLXJlc2V0XCIpLmNoaWxkcmVuKFwibGlcIikuYWRkQ2xhc3MoXCJ1aS1hY2NvcmRpb24tbGktZml4XCIpO2QuaGVhZGVycz1cbmQuZWxlbWVudC5maW5kKGMuaGVhZGVyKS5hZGRDbGFzcyhcInVpLWFjY29yZGlvbi1oZWFkZXIgdWktaGVscGVyLXJlc2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbFwiKS5iaW5kKFwibW91c2VlbnRlci5hY2NvcmRpb25cIixmdW5jdGlvbigpe2MuZGlzYWJsZWR8fGEodGhpcykuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX0pLmJpbmQoXCJtb3VzZWxlYXZlLmFjY29yZGlvblwiLGZ1bmN0aW9uKCl7Yy5kaXNhYmxlZHx8YSh0aGlzKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpfSkuYmluZChcImZvY3VzLmFjY29yZGlvblwiLGZ1bmN0aW9uKCl7Yy5kaXNhYmxlZHx8YSh0aGlzKS5hZGRDbGFzcyhcInVpLXN0YXRlLWZvY3VzXCIpfSkuYmluZChcImJsdXIuYWNjb3JkaW9uXCIsZnVuY3Rpb24oKXtjLmRpc2FibGVkfHxhKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9KTtkLmhlYWRlcnMubmV4dCgpLmFkZENsYXNzKFwidWktYWNjb3JkaW9uLWNvbnRlbnQgdWktaGVscGVyLXJlc2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b21cIik7XG5pZihjLm5hdmlnYXRpb24pe3ZhciBlPWQuZWxlbWVudC5maW5kKFwiYVwiKS5maWx0ZXIoYy5uYXZpZ2F0aW9uRmlsdGVyKS5lcSgwKTtpZihlLmxlbmd0aCl7dmFyIGg9ZS5jbG9zZXN0KFwiLnVpLWFjY29yZGlvbi1oZWFkZXJcIik7ZC5hY3RpdmU9aC5sZW5ndGg/aDplLmNsb3Nlc3QoXCIudWktYWNjb3JkaW9uLWNvbnRlbnRcIikucHJldigpfX1kLmFjdGl2ZT1kLl9maW5kQWN0aXZlKGQuYWN0aXZlfHxjLmFjdGl2ZSkuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLXN0YXRlLWFjdGl2ZVwiKS50b2dnbGVDbGFzcyhcInVpLWNvcm5lci1hbGxcIikudG9nZ2xlQ2xhc3MoXCJ1aS1jb3JuZXItdG9wXCIpO2QuYWN0aXZlLm5leHQoKS5hZGRDbGFzcyhcInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZVwiKTtkLl9jcmVhdGVJY29ucygpO2QucmVzaXplKCk7ZC5lbGVtZW50LmF0dHIoXCJyb2xlXCIsXCJ0YWJsaXN0XCIpO2QuaGVhZGVycy5hdHRyKFwicm9sZVwiLFwidGFiXCIpLmJpbmQoXCJrZXlkb3duLmFjY29yZGlvblwiLFxuZnVuY3Rpb24oZyl7cmV0dXJuIGQuX2tleWRvd24oZyl9KS5uZXh0KCkuYXR0cihcInJvbGVcIixcInRhYnBhbmVsXCIpO2QuaGVhZGVycy5ub3QoZC5hY3RpdmV8fFwiXCIpLmF0dHIoe1wiYXJpYS1leHBhbmRlZFwiOlwiZmFsc2VcIixcImFyaWEtc2VsZWN0ZWRcIjpcImZhbHNlXCIsdGFiSW5kZXg6LTF9KS5uZXh0KCkuaGlkZSgpO2QuYWN0aXZlLmxlbmd0aD9kLmFjdGl2ZS5hdHRyKHtcImFyaWEtZXhwYW5kZWRcIjpcInRydWVcIixcImFyaWEtc2VsZWN0ZWRcIjpcInRydWVcIix0YWJJbmRleDowfSk6ZC5oZWFkZXJzLmVxKDApLmF0dHIoXCJ0YWJJbmRleFwiLDApO2EuYnJvd3Nlci5zYWZhcml8fGQuaGVhZGVycy5maW5kKFwiYVwiKS5hdHRyKFwidGFiSW5kZXhcIiwtMSk7Yy5ldmVudCYmZC5oZWFkZXJzLmJpbmQoYy5ldmVudC5zcGxpdChcIiBcIikuam9pbihcIi5hY2NvcmRpb24gXCIpK1wiLmFjY29yZGlvblwiLGZ1bmN0aW9uKGcpe2QuX2NsaWNrSGFuZGxlci5jYWxsKGQsZyx0aGlzKTtnLnByZXZlbnREZWZhdWx0KCl9KX0sX2NyZWF0ZUljb25zOmZ1bmN0aW9uKCl7dmFyIGQ9XG50aGlzLm9wdGlvbnM7aWYoZC5pY29ucyl7YShcIjxzcGFuPjwvc3Bhbj5cIikuYWRkQ2xhc3MoXCJ1aS1pY29uIFwiK2QuaWNvbnMuaGVhZGVyKS5wcmVwZW5kVG8odGhpcy5oZWFkZXJzKTt0aGlzLmFjdGl2ZS5jaGlsZHJlbihcIi51aS1pY29uXCIpLnRvZ2dsZUNsYXNzKGQuaWNvbnMuaGVhZGVyKS50b2dnbGVDbGFzcyhkLmljb25zLmhlYWRlclNlbGVjdGVkKTt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1hY2NvcmRpb24taWNvbnNcIil9fSxfZGVzdHJveUljb25zOmZ1bmN0aW9uKCl7dGhpcy5oZWFkZXJzLmNoaWxkcmVuKFwiLnVpLWljb25cIikucmVtb3ZlKCk7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktYWNjb3JkaW9uLWljb25zXCIpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dmFyIGQ9dGhpcy5vcHRpb25zO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLWFjY29yZGlvbiB1aS13aWRnZXQgdWktaGVscGVyLXJlc2V0XCIpLnJlbW92ZUF0dHIoXCJyb2xlXCIpO3RoaXMuaGVhZGVycy51bmJpbmQoXCIuYWNjb3JkaW9uXCIpLnJlbW92ZUNsYXNzKFwidWktYWNjb3JkaW9uLWhlYWRlciB1aS1hY2NvcmRpb24tZGlzYWJsZWQgdWktaGVscGVyLXJlc2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1hY3RpdmUgdWktc3RhdGUtZGlzYWJsZWQgdWktY29ybmVyLXRvcFwiKS5yZW1vdmVBdHRyKFwicm9sZVwiKS5yZW1vdmVBdHRyKFwiYXJpYS1leHBhbmRlZFwiKS5yZW1vdmVBdHRyKFwiYXJpYS1zZWxlY3RlZFwiKS5yZW1vdmVBdHRyKFwidGFiSW5kZXhcIik7XG50aGlzLmhlYWRlcnMuZmluZChcImFcIikucmVtb3ZlQXR0cihcInRhYkluZGV4XCIpO3RoaXMuX2Rlc3Ryb3lJY29ucygpO3ZhciBjPXRoaXMuaGVhZGVycy5uZXh0KCkuY3NzKFwiZGlzcGxheVwiLFwiXCIpLnJlbW92ZUF0dHIoXCJyb2xlXCIpLnJlbW92ZUNsYXNzKFwidWktaGVscGVyLXJlc2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20gdWktYWNjb3JkaW9uLWNvbnRlbnQgdWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlIHVpLWFjY29yZGlvbi1kaXNhYmxlZCB1aS1zdGF0ZS1kaXNhYmxlZFwiKTtpZihkLmF1dG9IZWlnaHR8fGQuZmlsbEhlaWdodCljLmNzcyhcImhlaWdodFwiLFwiXCIpO3JldHVybiBhLldpZGdldC5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGQsYyl7YS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpO2Q9PVwiYWN0aXZlXCImJnRoaXMuYWN0aXZhdGUoYyk7aWYoZD09XCJpY29uc1wiKXt0aGlzLl9kZXN0cm95SWNvbnMoKTtcbmMmJnRoaXMuX2NyZWF0ZUljb25zKCl9aWYoZD09XCJkaXNhYmxlZFwiKXRoaXMuaGVhZGVycy5hZGQodGhpcy5oZWFkZXJzLm5leHQoKSlbYz9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcInVpLWFjY29yZGlvbi1kaXNhYmxlZCB1aS1zdGF0ZS1kaXNhYmxlZFwiKX0sX2tleWRvd246ZnVuY3Rpb24oZCl7aWYoISh0aGlzLm9wdGlvbnMuZGlzYWJsZWR8fGQuYWx0S2V5fHxkLmN0cmxLZXkpKXt2YXIgYz1hLnVpLmtleUNvZGUsZT10aGlzLmhlYWRlcnMubGVuZ3RoLGg9dGhpcy5oZWFkZXJzLmluZGV4KGQudGFyZ2V0KSxnPWZhbHNlO3N3aXRjaChkLmtleUNvZGUpe2Nhc2UgYy5SSUdIVDpjYXNlIGMuRE9XTjpnPXRoaXMuaGVhZGVyc1soaCsxKSVlXTticmVhaztjYXNlIGMuTEVGVDpjYXNlIGMuVVA6Zz10aGlzLmhlYWRlcnNbKGgtMStlKSVlXTticmVhaztjYXNlIGMuU1BBQ0U6Y2FzZSBjLkVOVEVSOnRoaXMuX2NsaWNrSGFuZGxlcih7dGFyZ2V0OmQudGFyZ2V0fSxkLnRhcmdldCk7XG5kLnByZXZlbnREZWZhdWx0KCl9aWYoZyl7YShkLnRhcmdldCkuYXR0cihcInRhYkluZGV4XCIsLTEpO2EoZykuYXR0cihcInRhYkluZGV4XCIsMCk7Zy5mb2N1cygpO3JldHVybiBmYWxzZX1yZXR1cm4gdHJ1ZX19LHJlc2l6ZTpmdW5jdGlvbigpe3ZhciBkPXRoaXMub3B0aW9ucyxjO2lmKGQuZmlsbFNwYWNlKXtpZihhLmJyb3dzZXIubXNpZSl7dmFyIGU9dGhpcy5lbGVtZW50LnBhcmVudCgpLmNzcyhcIm92ZXJmbG93XCIpO3RoaXMuZWxlbWVudC5wYXJlbnQoKS5jc3MoXCJvdmVyZmxvd1wiLFwiaGlkZGVuXCIpfWM9dGhpcy5lbGVtZW50LnBhcmVudCgpLmhlaWdodCgpO2EuYnJvd3Nlci5tc2llJiZ0aGlzLmVsZW1lbnQucGFyZW50KCkuY3NzKFwib3ZlcmZsb3dcIixlKTt0aGlzLmhlYWRlcnMuZWFjaChmdW5jdGlvbigpe2MtPWEodGhpcykub3V0ZXJIZWlnaHQodHJ1ZSl9KTt0aGlzLmhlYWRlcnMubmV4dCgpLmVhY2goZnVuY3Rpb24oKXthKHRoaXMpLmhlaWdodChNYXRoLm1heCgwLGMtYSh0aGlzKS5pbm5lckhlaWdodCgpK1xuYSh0aGlzKS5oZWlnaHQoKSkpfSkuY3NzKFwib3ZlcmZsb3dcIixcImF1dG9cIil9ZWxzZSBpZihkLmF1dG9IZWlnaHQpe2M9MDt0aGlzLmhlYWRlcnMubmV4dCgpLmVhY2goZnVuY3Rpb24oKXtjPU1hdGgubWF4KGMsYSh0aGlzKS5oZWlnaHQoXCJcIikuaGVpZ2h0KCkpfSkuaGVpZ2h0KGMpfXJldHVybiB0aGlzfSxhY3RpdmF0ZTpmdW5jdGlvbihkKXt0aGlzLm9wdGlvbnMuYWN0aXZlPWQ7ZD10aGlzLl9maW5kQWN0aXZlKGQpWzBdO3RoaXMuX2NsaWNrSGFuZGxlcih7dGFyZ2V0OmR9LGQpO3JldHVybiB0aGlzfSxfZmluZEFjdGl2ZTpmdW5jdGlvbihkKXtyZXR1cm4gZD90eXBlb2YgZD09PVwibnVtYmVyXCI/dGhpcy5oZWFkZXJzLmZpbHRlcihcIjplcShcIitkK1wiKVwiKTp0aGlzLmhlYWRlcnMubm90KHRoaXMuaGVhZGVycy5ub3QoZCkpOmQ9PT1mYWxzZT9hKFtdKTp0aGlzLmhlYWRlcnMuZmlsdGVyKFwiOmVxKDApXCIpfSxfY2xpY2tIYW5kbGVyOmZ1bmN0aW9uKGQsYyl7dmFyIGU9dGhpcy5vcHRpb25zO1xuaWYoIWUuZGlzYWJsZWQpaWYoZC50YXJnZXQpe2Q9YShkLmN1cnJlbnRUYXJnZXR8fGMpO2M9ZFswXT09PXRoaXMuYWN0aXZlWzBdO2UuYWN0aXZlPWUuY29sbGFwc2libGUmJmM/ZmFsc2U6dGhpcy5oZWFkZXJzLmluZGV4KGQpO2lmKCEodGhpcy5ydW5uaW5nfHwhZS5jb2xsYXBzaWJsZSYmYykpe3ZhciBoPXRoaXMuYWN0aXZlO2Y9ZC5uZXh0KCk7aT10aGlzLmFjdGl2ZS5uZXh0KCk7Yj17b3B0aW9uczplLG5ld0hlYWRlcjpjJiZlLmNvbGxhcHNpYmxlP2EoW10pOmQsb2xkSGVhZGVyOnRoaXMuYWN0aXZlLG5ld0NvbnRlbnQ6YyYmZS5jb2xsYXBzaWJsZT9hKFtdKTpmLG9sZENvbnRlbnQ6aX07dmFyIGc9dGhpcy5oZWFkZXJzLmluZGV4KHRoaXMuYWN0aXZlWzBdKT50aGlzLmhlYWRlcnMuaW5kZXgoZFswXSk7dGhpcy5hY3RpdmU9Yz9hKFtdKTpkO3RoaXMuX3RvZ2dsZShmLGksYixjLGcpO2gucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmUgdWktY29ybmVyLXRvcFwiKS5hZGRDbGFzcyhcInVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbFwiKS5jaGlsZHJlbihcIi51aS1pY29uXCIpLnJlbW92ZUNsYXNzKGUuaWNvbnMuaGVhZGVyU2VsZWN0ZWQpLmFkZENsYXNzKGUuaWNvbnMuaGVhZGVyKTtcbmlmKCFjKXtkLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsXCIpLmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlIHVpLWNvcm5lci10b3BcIikuY2hpbGRyZW4oXCIudWktaWNvblwiKS5yZW1vdmVDbGFzcyhlLmljb25zLmhlYWRlcikuYWRkQ2xhc3MoZS5pY29ucy5oZWFkZXJTZWxlY3RlZCk7ZC5uZXh0KCkuYWRkQ2xhc3MoXCJ1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmVcIil9fX1lbHNlIGlmKGUuY29sbGFwc2libGUpe3RoaXMuYWN0aXZlLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlIHVpLWNvcm5lci10b3BcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGxcIikuY2hpbGRyZW4oXCIudWktaWNvblwiKS5yZW1vdmVDbGFzcyhlLmljb25zLmhlYWRlclNlbGVjdGVkKS5hZGRDbGFzcyhlLmljb25zLmhlYWRlcik7dGhpcy5hY3RpdmUubmV4dCgpLmFkZENsYXNzKFwidWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlXCIpO3ZhciBpPXRoaXMuYWN0aXZlLm5leHQoKSxcbmI9e29wdGlvbnM6ZSxuZXdIZWFkZXI6YShbXSksb2xkSGVhZGVyOmUuYWN0aXZlLG5ld0NvbnRlbnQ6YShbXSksb2xkQ29udGVudDppfSxmPXRoaXMuYWN0aXZlPWEoW10pO3RoaXMuX3RvZ2dsZShmLGksYil9fSxfdG9nZ2xlOmZ1bmN0aW9uKGQsYyxlLGgsZyl7dmFyIGk9dGhpcyxiPWkub3B0aW9ucztpLnRvU2hvdz1kO2kudG9IaWRlPWM7aS5kYXRhPWU7dmFyIGY9ZnVuY3Rpb24oKXtpZihpKXJldHVybiBpLl9jb21wbGV0ZWQuYXBwbHkoaSxhcmd1bWVudHMpfTtpLl90cmlnZ2VyKFwiY2hhbmdlc3RhcnRcIixudWxsLGkuZGF0YSk7aS5ydW5uaW5nPWMuc2l6ZSgpPT09MD9kLnNpemUoKTpjLnNpemUoKTtpZihiLmFuaW1hdGVkKXtlPXt9O2U9Yi5jb2xsYXBzaWJsZSYmaD97dG9TaG93OmEoW10pLHRvSGlkZTpjLGNvbXBsZXRlOmYsZG93bjpnLGF1dG9IZWlnaHQ6Yi5hdXRvSGVpZ2h0fHxiLmZpbGxTcGFjZX06e3RvU2hvdzpkLHRvSGlkZTpjLGNvbXBsZXRlOmYsZG93bjpnLGF1dG9IZWlnaHQ6Yi5hdXRvSGVpZ2h0fHxcbmIuZmlsbFNwYWNlfTtpZighYi5wcm94aWVkKWIucHJveGllZD1iLmFuaW1hdGVkO2lmKCFiLnByb3hpZWREdXJhdGlvbiliLnByb3hpZWREdXJhdGlvbj1iLmR1cmF0aW9uO2IuYW5pbWF0ZWQ9YS5pc0Z1bmN0aW9uKGIucHJveGllZCk/Yi5wcm94aWVkKGUpOmIucHJveGllZDtiLmR1cmF0aW9uPWEuaXNGdW5jdGlvbihiLnByb3hpZWREdXJhdGlvbik/Yi5wcm94aWVkRHVyYXRpb24oZSk6Yi5wcm94aWVkRHVyYXRpb247aD1hLnVpLmFjY29yZGlvbi5hbmltYXRpb25zO3ZhciBqPWIuZHVyYXRpb24sbD1iLmFuaW1hdGVkO2lmKGwmJiFoW2xdJiYhYS5lYXNpbmdbbF0pbD1cInNsaWRlXCI7aFtsXXx8KGhbbF09ZnVuY3Rpb24obyl7dGhpcy5zbGlkZShvLHtlYXNpbmc6bCxkdXJhdGlvbjpqfHw3MDB9KX0pO2hbbF0oZSl9ZWxzZXtpZihiLmNvbGxhcHNpYmxlJiZoKWQudG9nZ2xlKCk7ZWxzZXtjLmhpZGUoKTtkLnNob3coKX1mKHRydWUpfWMucHJldigpLmF0dHIoe1wiYXJpYS1leHBhbmRlZFwiOlwiZmFsc2VcIixcblwiYXJpYS1zZWxlY3RlZFwiOlwiZmFsc2VcIix0YWJJbmRleDotMX0pLmJsdXIoKTtkLnByZXYoKS5hdHRyKHtcImFyaWEtZXhwYW5kZWRcIjpcInRydWVcIixcImFyaWEtc2VsZWN0ZWRcIjpcInRydWVcIix0YWJJbmRleDowfSkuZm9jdXMoKX0sX2NvbXBsZXRlZDpmdW5jdGlvbihkKXt0aGlzLnJ1bm5pbmc9ZD8wOi0tdGhpcy5ydW5uaW5nO2lmKCF0aGlzLnJ1bm5pbmcpe3RoaXMub3B0aW9ucy5jbGVhclN0eWxlJiZ0aGlzLnRvU2hvdy5hZGQodGhpcy50b0hpZGUpLmNzcyh7aGVpZ2h0OlwiXCIsb3ZlcmZsb3c6XCJcIn0pO3RoaXMudG9IaWRlLnJlbW92ZUNsYXNzKFwidWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlXCIpO2lmKHRoaXMudG9IaWRlLmxlbmd0aCl0aGlzLnRvSGlkZS5wYXJlbnQoKVswXS5jbGFzc05hbWU9dGhpcy50b0hpZGUucGFyZW50KClbMF0uY2xhc3NOYW1lO3RoaXMuX3RyaWdnZXIoXCJjaGFuZ2VcIixudWxsLHRoaXMuZGF0YSl9fX0pO2EuZXh0ZW5kKGEudWkuYWNjb3JkaW9uLHt2ZXJzaW9uOlwiMS44LjE2XCIsXG5hbmltYXRpb25zOntzbGlkZTpmdW5jdGlvbihkLGMpe2Q9YS5leHRlbmQoe2Vhc2luZzpcInN3aW5nXCIsZHVyYXRpb246MzAwfSxkLGMpO2lmKGQudG9IaWRlLnNpemUoKSlpZihkLnRvU2hvdy5zaXplKCkpe3ZhciBlPWQudG9TaG93LmNzcyhcIm92ZXJmbG93XCIpLGg9MCxnPXt9LGk9e30sYjtjPWQudG9TaG93O2I9Y1swXS5zdHlsZS53aWR0aDtjLndpZHRoKHBhcnNlSW50KGMucGFyZW50KCkud2lkdGgoKSwxMCktcGFyc2VJbnQoYy5jc3MoXCJwYWRkaW5nTGVmdFwiKSwxMCktcGFyc2VJbnQoYy5jc3MoXCJwYWRkaW5nUmlnaHRcIiksMTApLShwYXJzZUludChjLmNzcyhcImJvcmRlckxlZnRXaWR0aFwiKSwxMCl8fDApLShwYXJzZUludChjLmNzcyhcImJvcmRlclJpZ2h0V2lkdGhcIiksMTApfHwwKSk7YS5lYWNoKFtcImhlaWdodFwiLFwicGFkZGluZ1RvcFwiLFwicGFkZGluZ0JvdHRvbVwiXSxmdW5jdGlvbihmLGope2lbal09XCJoaWRlXCI7Zj0oXCJcIithLmNzcyhkLnRvU2hvd1swXSxqKSkubWF0Y2goL14oW1xcZCstLl0rKSguKikkLyk7XG5nW2pdPXt2YWx1ZTpmWzFdLHVuaXQ6ZlsyXXx8XCJweFwifX0pO2QudG9TaG93LmNzcyh7aGVpZ2h0OjAsb3ZlcmZsb3c6XCJoaWRkZW5cIn0pLnNob3coKTtkLnRvSGlkZS5maWx0ZXIoXCI6aGlkZGVuXCIpLmVhY2goZC5jb21wbGV0ZSkuZW5kKCkuZmlsdGVyKFwiOnZpc2libGVcIikuYW5pbWF0ZShpLHtzdGVwOmZ1bmN0aW9uKGYsail7aWYoai5wcm9wPT1cImhlaWdodFwiKWg9ai5lbmQtai5zdGFydD09PTA/MDooai5ub3ctai5zdGFydCkvKGouZW5kLWouc3RhcnQpO2QudG9TaG93WzBdLnN0eWxlW2oucHJvcF09aCpnW2oucHJvcF0udmFsdWUrZ1tqLnByb3BdLnVuaXR9LGR1cmF0aW9uOmQuZHVyYXRpb24sZWFzaW5nOmQuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7ZC5hdXRvSGVpZ2h0fHxkLnRvU2hvdy5jc3MoXCJoZWlnaHRcIixcIlwiKTtkLnRvU2hvdy5jc3Moe3dpZHRoOmIsb3ZlcmZsb3c6ZX0pO2QuY29tcGxldGUoKX19KX1lbHNlIGQudG9IaWRlLmFuaW1hdGUoe2hlaWdodDpcImhpZGVcIixcbnBhZGRpbmdUb3A6XCJoaWRlXCIscGFkZGluZ0JvdHRvbTpcImhpZGVcIn0sZCk7ZWxzZSBkLnRvU2hvdy5hbmltYXRlKHtoZWlnaHQ6XCJzaG93XCIscGFkZGluZ1RvcDpcInNob3dcIixwYWRkaW5nQm90dG9tOlwic2hvd1wifSxkKX0sYm91bmNlc2xpZGU6ZnVuY3Rpb24oZCl7dGhpcy5zbGlkZShkLHtlYXNpbmc6ZC5kb3duP1wiZWFzZU91dEJvdW5jZVwiOlwic3dpbmdcIixkdXJhdGlvbjpkLmRvd24/MUUzOjIwMH0pfX19KX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7dmFyIGQ9MDthLndpZGdldChcInVpLmF1dG9jb21wbGV0ZVwiLHtvcHRpb25zOnthcHBlbmRUbzpcImJvZHlcIixhdXRvRm9jdXM6ZmFsc2UsZGVsYXk6MzAwLG1pbkxlbmd0aDoxLHBvc2l0aW9uOntteTpcImxlZnQgdG9wXCIsYXQ6XCJsZWZ0IGJvdHRvbVwiLGNvbGxpc2lvbjpcIm5vbmVcIn0sc291cmNlOm51bGx9LHBlbmRpbmc6MCxfY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIGM9dGhpcyxlPXRoaXMuZWxlbWVudFswXS5vd25lckRvY3VtZW50LGg7dGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktYXV0b2NvbXBsZXRlLWlucHV0XCIpLmF0dHIoXCJhdXRvY29tcGxldGVcIixcIm9mZlwiKS5hdHRyKHtyb2xlOlwidGV4dGJveFwiLFwiYXJpYS1hdXRvY29tcGxldGVcIjpcImxpc3RcIixcImFyaWEtaGFzcG9wdXBcIjpcInRydWVcIn0pLmJpbmQoXCJrZXlkb3duLmF1dG9jb21wbGV0ZVwiLGZ1bmN0aW9uKGcpe2lmKCEoYy5vcHRpb25zLmRpc2FibGVkfHxjLmVsZW1lbnQucHJvcEF0dHIoXCJyZWFkT25seVwiKSkpe2g9XG5mYWxzZTt2YXIgaT1hLnVpLmtleUNvZGU7c3dpdGNoKGcua2V5Q29kZSl7Y2FzZSBpLlBBR0VfVVA6Yy5fbW92ZShcInByZXZpb3VzUGFnZVwiLGcpO2JyZWFrO2Nhc2UgaS5QQUdFX0RPV046Yy5fbW92ZShcIm5leHRQYWdlXCIsZyk7YnJlYWs7Y2FzZSBpLlVQOmMuX21vdmUoXCJwcmV2aW91c1wiLGcpO2cucHJldmVudERlZmF1bHQoKTticmVhaztjYXNlIGkuRE9XTjpjLl9tb3ZlKFwibmV4dFwiLGcpO2cucHJldmVudERlZmF1bHQoKTticmVhaztjYXNlIGkuRU5URVI6Y2FzZSBpLk5VTVBBRF9FTlRFUjppZihjLm1lbnUuYWN0aXZlKXtoPXRydWU7Zy5wcmV2ZW50RGVmYXVsdCgpfWNhc2UgaS5UQUI6aWYoIWMubWVudS5hY3RpdmUpcmV0dXJuO2MubWVudS5zZWxlY3QoZyk7YnJlYWs7Y2FzZSBpLkVTQ0FQRTpjLmVsZW1lbnQudmFsKGMudGVybSk7Yy5jbG9zZShnKTticmVhaztkZWZhdWx0OmNsZWFyVGltZW91dChjLnNlYXJjaGluZyk7Yy5zZWFyY2hpbmc9c2V0VGltZW91dChmdW5jdGlvbigpe2lmKGMudGVybSE9XG5jLmVsZW1lbnQudmFsKCkpe2Muc2VsZWN0ZWRJdGVtPW51bGw7Yy5zZWFyY2gobnVsbCxnKX19LGMub3B0aW9ucy5kZWxheSk7YnJlYWt9fX0pLmJpbmQoXCJrZXlwcmVzcy5hdXRvY29tcGxldGVcIixmdW5jdGlvbihnKXtpZihoKXtoPWZhbHNlO2cucHJldmVudERlZmF1bHQoKX19KS5iaW5kKFwiZm9jdXMuYXV0b2NvbXBsZXRlXCIsZnVuY3Rpb24oKXtpZighYy5vcHRpb25zLmRpc2FibGVkKXtjLnNlbGVjdGVkSXRlbT1udWxsO2MucHJldmlvdXM9Yy5lbGVtZW50LnZhbCgpfX0pLmJpbmQoXCJibHVyLmF1dG9jb21wbGV0ZVwiLGZ1bmN0aW9uKGcpe2lmKCFjLm9wdGlvbnMuZGlzYWJsZWQpe2NsZWFyVGltZW91dChjLnNlYXJjaGluZyk7Yy5jbG9zaW5nPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtjLmNsb3NlKGcpO2MuX2NoYW5nZShnKX0sMTUwKX19KTt0aGlzLl9pbml0U291cmNlKCk7dGhpcy5yZXNwb25zZT1mdW5jdGlvbigpe3JldHVybiBjLl9yZXNwb25zZS5hcHBseShjLGFyZ3VtZW50cyl9O1xudGhpcy5tZW51PWEoXCI8dWw+PC91bD5cIikuYWRkQ2xhc3MoXCJ1aS1hdXRvY29tcGxldGVcIikuYXBwZW5kVG8oYSh0aGlzLm9wdGlvbnMuYXBwZW5kVG98fFwiYm9keVwiLGUpWzBdKS5tb3VzZWRvd24oZnVuY3Rpb24oZyl7dmFyIGk9Yy5tZW51LmVsZW1lbnRbMF07YShnLnRhcmdldCkuY2xvc2VzdChcIi51aS1tZW51LWl0ZW1cIikubGVuZ3RofHxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YShkb2N1bWVudCkub25lKFwibW91c2Vkb3duXCIsZnVuY3Rpb24oYil7Yi50YXJnZXQhPT1jLmVsZW1lbnRbMF0mJmIudGFyZ2V0IT09aSYmIWEudWkuY29udGFpbnMoaSxiLnRhcmdldCkmJmMuY2xvc2UoKX0pfSwxKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Y2xlYXJUaW1lb3V0KGMuY2xvc2luZyl9LDEzKX0pLm1lbnUoe2ZvY3VzOmZ1bmN0aW9uKGcsaSl7aT1pLml0ZW0uZGF0YShcIml0ZW0uYXV0b2NvbXBsZXRlXCIpO2ZhbHNlIT09Yy5fdHJpZ2dlcihcImZvY3VzXCIsZyx7aXRlbTppfSkmJi9ea2V5Ly50ZXN0KGcub3JpZ2luYWxFdmVudC50eXBlKSYmXG5jLmVsZW1lbnQudmFsKGkudmFsdWUpfSxzZWxlY3RlZDpmdW5jdGlvbihnLGkpe3ZhciBiPWkuaXRlbS5kYXRhKFwiaXRlbS5hdXRvY29tcGxldGVcIiksZj1jLnByZXZpb3VzO2lmKGMuZWxlbWVudFswXSE9PWUuYWN0aXZlRWxlbWVudCl7Yy5lbGVtZW50LmZvY3VzKCk7Yy5wcmV2aW91cz1mO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtjLnByZXZpb3VzPWY7Yy5zZWxlY3RlZEl0ZW09Yn0sMSl9ZmFsc2UhPT1jLl90cmlnZ2VyKFwic2VsZWN0XCIsZyx7aXRlbTpifSkmJmMuZWxlbWVudC52YWwoYi52YWx1ZSk7Yy50ZXJtPWMuZWxlbWVudC52YWwoKTtjLmNsb3NlKGcpO2Muc2VsZWN0ZWRJdGVtPWJ9LGJsdXI6ZnVuY3Rpb24oKXtjLm1lbnUuZWxlbWVudC5pcyhcIjp2aXNpYmxlXCIpJiZjLmVsZW1lbnQudmFsKCkhPT1jLnRlcm0mJmMuZWxlbWVudC52YWwoYy50ZXJtKX19KS56SW5kZXgodGhpcy5lbGVtZW50LnpJbmRleCgpKzEpLmNzcyh7dG9wOjAsbGVmdDowfSkuaGlkZSgpLmRhdGEoXCJtZW51XCIpO1xuYS5mbi5iZ2lmcmFtZSYmdGhpcy5tZW51LmVsZW1lbnQuYmdpZnJhbWUoKX0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLWF1dG9jb21wbGV0ZS1pbnB1dFwiKS5yZW1vdmVBdHRyKFwiYXV0b2NvbXBsZXRlXCIpLnJlbW92ZUF0dHIoXCJyb2xlXCIpLnJlbW92ZUF0dHIoXCJhcmlhLWF1dG9jb21wbGV0ZVwiKS5yZW1vdmVBdHRyKFwiYXJpYS1oYXNwb3B1cFwiKTt0aGlzLm1lbnUuZWxlbWVudC5yZW1vdmUoKTthLldpZGdldC5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGMsZSl7YS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpO2M9PT1cInNvdXJjZVwiJiZ0aGlzLl9pbml0U291cmNlKCk7aWYoYz09PVwiYXBwZW5kVG9cIil0aGlzLm1lbnUuZWxlbWVudC5hcHBlbmRUbyhhKGV8fFwiYm9keVwiLHRoaXMuZWxlbWVudFswXS5vd25lckRvY3VtZW50KVswXSk7Yz09PVwiZGlzYWJsZWRcIiYmXG5lJiZ0aGlzLnhociYmdGhpcy54aHIuYWJvcnQoKX0sX2luaXRTb3VyY2U6ZnVuY3Rpb24oKXt2YXIgYz10aGlzLGUsaDtpZihhLmlzQXJyYXkodGhpcy5vcHRpb25zLnNvdXJjZSkpe2U9dGhpcy5vcHRpb25zLnNvdXJjZTt0aGlzLnNvdXJjZT1mdW5jdGlvbihnLGkpe2koYS51aS5hdXRvY29tcGxldGUuZmlsdGVyKGUsZy50ZXJtKSl9fWVsc2UgaWYodHlwZW9mIHRoaXMub3B0aW9ucy5zb3VyY2U9PT1cInN0cmluZ1wiKXtoPXRoaXMub3B0aW9ucy5zb3VyY2U7dGhpcy5zb3VyY2U9ZnVuY3Rpb24oZyxpKXtjLnhociYmYy54aHIuYWJvcnQoKTtjLnhocj1hLmFqYXgoe3VybDpoLGRhdGE6ZyxkYXRhVHlwZTpcImpzb25cIixhdXRvY29tcGxldGVSZXF1ZXN0OisrZCxzdWNjZXNzOmZ1bmN0aW9uKGIpe3RoaXMuYXV0b2NvbXBsZXRlUmVxdWVzdD09PWQmJmkoYil9LGVycm9yOmZ1bmN0aW9uKCl7dGhpcy5hdXRvY29tcGxldGVSZXF1ZXN0PT09ZCYmaShbXSl9fSl9fWVsc2UgdGhpcy5zb3VyY2U9XG50aGlzLm9wdGlvbnMuc291cmNlfSxzZWFyY2g6ZnVuY3Rpb24oYyxlKXtjPWMhPW51bGw/Yzp0aGlzLmVsZW1lbnQudmFsKCk7dGhpcy50ZXJtPXRoaXMuZWxlbWVudC52YWwoKTtpZihjLmxlbmd0aDx0aGlzLm9wdGlvbnMubWluTGVuZ3RoKXJldHVybiB0aGlzLmNsb3NlKGUpO2NsZWFyVGltZW91dCh0aGlzLmNsb3NpbmcpO2lmKHRoaXMuX3RyaWdnZXIoXCJzZWFyY2hcIixlKSE9PWZhbHNlKXJldHVybiB0aGlzLl9zZWFyY2goYyl9LF9zZWFyY2g6ZnVuY3Rpb24oYyl7dGhpcy5wZW5kaW5nKys7dGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktYXV0b2NvbXBsZXRlLWxvYWRpbmdcIik7dGhpcy5zb3VyY2Uoe3Rlcm06Y30sdGhpcy5yZXNwb25zZSl9LF9yZXNwb25zZTpmdW5jdGlvbihjKXtpZighdGhpcy5vcHRpb25zLmRpc2FibGVkJiZjJiZjLmxlbmd0aCl7Yz10aGlzLl9ub3JtYWxpemUoYyk7dGhpcy5fc3VnZ2VzdChjKTt0aGlzLl90cmlnZ2VyKFwib3BlblwiKX1lbHNlIHRoaXMuY2xvc2UoKTtcbnRoaXMucGVuZGluZy0tO3RoaXMucGVuZGluZ3x8dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktYXV0b2NvbXBsZXRlLWxvYWRpbmdcIil9LGNsb3NlOmZ1bmN0aW9uKGMpe2NsZWFyVGltZW91dCh0aGlzLmNsb3NpbmcpO2lmKHRoaXMubWVudS5lbGVtZW50LmlzKFwiOnZpc2libGVcIikpe3RoaXMubWVudS5lbGVtZW50LmhpZGUoKTt0aGlzLm1lbnUuZGVhY3RpdmF0ZSgpO3RoaXMuX3RyaWdnZXIoXCJjbG9zZVwiLGMpfX0sX2NoYW5nZTpmdW5jdGlvbihjKXt0aGlzLnByZXZpb3VzIT09dGhpcy5lbGVtZW50LnZhbCgpJiZ0aGlzLl90cmlnZ2VyKFwiY2hhbmdlXCIsYyx7aXRlbTp0aGlzLnNlbGVjdGVkSXRlbX0pfSxfbm9ybWFsaXplOmZ1bmN0aW9uKGMpe2lmKGMubGVuZ3RoJiZjWzBdLmxhYmVsJiZjWzBdLnZhbHVlKXJldHVybiBjO3JldHVybiBhLm1hcChjLGZ1bmN0aW9uKGUpe2lmKHR5cGVvZiBlPT09XCJzdHJpbmdcIilyZXR1cm57bGFiZWw6ZSx2YWx1ZTplfTtyZXR1cm4gYS5leHRlbmQoe2xhYmVsOmUubGFiZWx8fFxuZS52YWx1ZSx2YWx1ZTplLnZhbHVlfHxlLmxhYmVsfSxlKX0pfSxfc3VnZ2VzdDpmdW5jdGlvbihjKXt2YXIgZT10aGlzLm1lbnUuZWxlbWVudC5lbXB0eSgpLnpJbmRleCh0aGlzLmVsZW1lbnQuekluZGV4KCkrMSk7dGhpcy5fcmVuZGVyTWVudShlLGMpO3RoaXMubWVudS5kZWFjdGl2YXRlKCk7dGhpcy5tZW51LnJlZnJlc2goKTtlLnNob3coKTt0aGlzLl9yZXNpemVNZW51KCk7ZS5wb3NpdGlvbihhLmV4dGVuZCh7b2Y6dGhpcy5lbGVtZW50fSx0aGlzLm9wdGlvbnMucG9zaXRpb24pKTt0aGlzLm9wdGlvbnMuYXV0b0ZvY3VzJiZ0aGlzLm1lbnUubmV4dChuZXcgYS5FdmVudChcIm1vdXNlb3ZlclwiKSl9LF9yZXNpemVNZW51OmZ1bmN0aW9uKCl7dmFyIGM9dGhpcy5tZW51LmVsZW1lbnQ7Yy5vdXRlcldpZHRoKE1hdGgubWF4KGMud2lkdGgoXCJcIikub3V0ZXJXaWR0aCgpLHRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCkpKX0sX3JlbmRlck1lbnU6ZnVuY3Rpb24oYyxlKXt2YXIgaD10aGlzO1xuYS5lYWNoKGUsZnVuY3Rpb24oZyxpKXtoLl9yZW5kZXJJdGVtKGMsaSl9KX0sX3JlbmRlckl0ZW06ZnVuY3Rpb24oYyxlKXtyZXR1cm4gYShcIjxsaT48L2xpPlwiKS5kYXRhKFwiaXRlbS5hdXRvY29tcGxldGVcIixlKS5hcHBlbmQoYShcIjxhPjwvYT5cIikudGV4dChlLmxhYmVsKSkuYXBwZW5kVG8oYyl9LF9tb3ZlOmZ1bmN0aW9uKGMsZSl7aWYodGhpcy5tZW51LmVsZW1lbnQuaXMoXCI6dmlzaWJsZVwiKSlpZih0aGlzLm1lbnUuZmlyc3QoKSYmL15wcmV2aW91cy8udGVzdChjKXx8dGhpcy5tZW51Lmxhc3QoKSYmL15uZXh0Ly50ZXN0KGMpKXt0aGlzLmVsZW1lbnQudmFsKHRoaXMudGVybSk7dGhpcy5tZW51LmRlYWN0aXZhdGUoKX1lbHNlIHRoaXMubWVudVtjXShlKTtlbHNlIHRoaXMuc2VhcmNoKG51bGwsZSl9LHdpZGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1lbnUuZWxlbWVudH19KTthLmV4dGVuZChhLnVpLmF1dG9jb21wbGV0ZSx7ZXNjYXBlUmVnZXg6ZnVuY3Rpb24oYyl7cmV0dXJuIGMucmVwbGFjZSgvWy1bXFxde30oKSorPy4sXFxcXF4kfCNcXHNdL2csXG5cIlxcXFwkJlwiKX0sZmlsdGVyOmZ1bmN0aW9uKGMsZSl7dmFyIGg9bmV3IFJlZ0V4cChhLnVpLmF1dG9jb21wbGV0ZS5lc2NhcGVSZWdleChlKSxcImlcIik7cmV0dXJuIGEuZ3JlcChjLGZ1bmN0aW9uKGcpe3JldHVybiBoLnRlc3QoZy5sYWJlbHx8Zy52YWx1ZXx8Zyl9KX19KX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSl7YS53aWRnZXQoXCJ1aS5tZW51XCIse19jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgZD10aGlzO3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLW1lbnUgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGxcIikuYXR0cih7cm9sZTpcImxpc3Rib3hcIixcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiOlwidWktYWN0aXZlLW1lbnVpdGVtXCJ9KS5jbGljayhmdW5jdGlvbihjKXtpZihhKGMudGFyZ2V0KS5jbG9zZXN0KFwiLnVpLW1lbnUtaXRlbSBhXCIpLmxlbmd0aCl7Yy5wcmV2ZW50RGVmYXVsdCgpO2Quc2VsZWN0KGMpfX0pO3RoaXMucmVmcmVzaCgpfSxyZWZyZXNoOmZ1bmN0aW9uKCl7dmFyIGQ9dGhpczt0aGlzLmVsZW1lbnQuY2hpbGRyZW4oXCJsaTpub3QoLnVpLW1lbnUtaXRlbSk6aGFzKGEpXCIpLmFkZENsYXNzKFwidWktbWVudS1pdGVtXCIpLmF0dHIoXCJyb2xlXCIsXCJtZW51aXRlbVwiKS5jaGlsZHJlbihcImFcIikuYWRkQ2xhc3MoXCJ1aS1jb3JuZXItYWxsXCIpLmF0dHIoXCJ0YWJpbmRleFwiLFxuLTEpLm1vdXNlZW50ZXIoZnVuY3Rpb24oYyl7ZC5hY3RpdmF0ZShjLGEodGhpcykucGFyZW50KCkpfSkubW91c2VsZWF2ZShmdW5jdGlvbigpe2QuZGVhY3RpdmF0ZSgpfSl9LGFjdGl2YXRlOmZ1bmN0aW9uKGQsYyl7dGhpcy5kZWFjdGl2YXRlKCk7aWYodGhpcy5oYXNTY3JvbGwoKSl7dmFyIGU9Yy5vZmZzZXQoKS50b3AtdGhpcy5lbGVtZW50Lm9mZnNldCgpLnRvcCxoPXRoaXMuZWxlbWVudC5zY3JvbGxUb3AoKSxnPXRoaXMuZWxlbWVudC5oZWlnaHQoKTtpZihlPDApdGhpcy5lbGVtZW50LnNjcm9sbFRvcChoK2UpO2Vsc2UgZT49ZyYmdGhpcy5lbGVtZW50LnNjcm9sbFRvcChoK2UtZytjLmhlaWdodCgpKX10aGlzLmFjdGl2ZT1jLmVxKDApLmNoaWxkcmVuKFwiYVwiKS5hZGRDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpLmF0dHIoXCJpZFwiLFwidWktYWN0aXZlLW1lbnVpdGVtXCIpLmVuZCgpO3RoaXMuX3RyaWdnZXIoXCJmb2N1c1wiLGQse2l0ZW06Y30pfSxkZWFjdGl2YXRlOmZ1bmN0aW9uKCl7aWYodGhpcy5hY3RpdmUpe3RoaXMuYWN0aXZlLmNoaWxkcmVuKFwiYVwiKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpLnJlbW92ZUF0dHIoXCJpZFwiKTtcbnRoaXMuX3RyaWdnZXIoXCJibHVyXCIpO3RoaXMuYWN0aXZlPW51bGx9fSxuZXh0OmZ1bmN0aW9uKGQpe3RoaXMubW92ZShcIm5leHRcIixcIi51aS1tZW51LWl0ZW06Zmlyc3RcIixkKX0scHJldmlvdXM6ZnVuY3Rpb24oZCl7dGhpcy5tb3ZlKFwicHJldlwiLFwiLnVpLW1lbnUtaXRlbTpsYXN0XCIsZCl9LGZpcnN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYWN0aXZlJiYhdGhpcy5hY3RpdmUucHJldkFsbChcIi51aS1tZW51LWl0ZW1cIikubGVuZ3RofSxsYXN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYWN0aXZlJiYhdGhpcy5hY3RpdmUubmV4dEFsbChcIi51aS1tZW51LWl0ZW1cIikubGVuZ3RofSxtb3ZlOmZ1bmN0aW9uKGQsYyxlKXtpZih0aGlzLmFjdGl2ZSl7ZD10aGlzLmFjdGl2ZVtkK1wiQWxsXCJdKFwiLnVpLW1lbnUtaXRlbVwiKS5lcSgwKTtkLmxlbmd0aD90aGlzLmFjdGl2YXRlKGUsZCk6dGhpcy5hY3RpdmF0ZShlLHRoaXMuZWxlbWVudC5jaGlsZHJlbihjKSl9ZWxzZSB0aGlzLmFjdGl2YXRlKGUsXG50aGlzLmVsZW1lbnQuY2hpbGRyZW4oYykpfSxuZXh0UGFnZTpmdW5jdGlvbihkKXtpZih0aGlzLmhhc1Njcm9sbCgpKWlmKCF0aGlzLmFjdGl2ZXx8dGhpcy5sYXN0KCkpdGhpcy5hY3RpdmF0ZShkLHRoaXMuZWxlbWVudC5jaGlsZHJlbihcIi51aS1tZW51LWl0ZW06Zmlyc3RcIikpO2Vsc2V7dmFyIGM9dGhpcy5hY3RpdmUub2Zmc2V0KCkudG9wLGU9dGhpcy5lbGVtZW50LmhlaWdodCgpLGg9dGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLnVpLW1lbnUtaXRlbVwiKS5maWx0ZXIoZnVuY3Rpb24oKXt2YXIgZz1hKHRoaXMpLm9mZnNldCgpLnRvcC1jLWUrYSh0aGlzKS5oZWlnaHQoKTtyZXR1cm4gZzwxMCYmZz4tMTB9KTtoLmxlbmd0aHx8KGg9dGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLnVpLW1lbnUtaXRlbTpsYXN0XCIpKTt0aGlzLmFjdGl2YXRlKGQsaCl9ZWxzZSB0aGlzLmFjdGl2YXRlKGQsdGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLnVpLW1lbnUtaXRlbVwiKS5maWx0ZXIoIXRoaXMuYWN0aXZlfHxcbnRoaXMubGFzdCgpP1wiOmZpcnN0XCI6XCI6bGFzdFwiKSl9LHByZXZpb3VzUGFnZTpmdW5jdGlvbihkKXtpZih0aGlzLmhhc1Njcm9sbCgpKWlmKCF0aGlzLmFjdGl2ZXx8dGhpcy5maXJzdCgpKXRoaXMuYWN0aXZhdGUoZCx0aGlzLmVsZW1lbnQuY2hpbGRyZW4oXCIudWktbWVudS1pdGVtOmxhc3RcIikpO2Vsc2V7dmFyIGM9dGhpcy5hY3RpdmUub2Zmc2V0KCkudG9wLGU9dGhpcy5lbGVtZW50LmhlaWdodCgpO3Jlc3VsdD10aGlzLmVsZW1lbnQuY2hpbGRyZW4oXCIudWktbWVudS1pdGVtXCIpLmZpbHRlcihmdW5jdGlvbigpe3ZhciBoPWEodGhpcykub2Zmc2V0KCkudG9wLWMrZS1hKHRoaXMpLmhlaWdodCgpO3JldHVybiBoPDEwJiZoPi0xMH0pO3Jlc3VsdC5sZW5ndGh8fChyZXN1bHQ9dGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLnVpLW1lbnUtaXRlbTpmaXJzdFwiKSk7dGhpcy5hY3RpdmF0ZShkLHJlc3VsdCl9ZWxzZSB0aGlzLmFjdGl2YXRlKGQsdGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLnVpLW1lbnUtaXRlbVwiKS5maWx0ZXIoIXRoaXMuYWN0aXZlfHxcbnRoaXMuZmlyc3QoKT9cIjpsYXN0XCI6XCI6Zmlyc3RcIikpfSxoYXNTY3JvbGw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbGVtZW50LmhlaWdodCgpPHRoaXMuZWxlbWVudFthLmZuLnByb3A/XCJwcm9wXCI6XCJhdHRyXCJdKFwic2Nyb2xsSGVpZ2h0XCIpfSxzZWxlY3Q6ZnVuY3Rpb24oZCl7dGhpcy5fdHJpZ2dlcihcInNlbGVjdGVkXCIsZCx7aXRlbTp0aGlzLmFjdGl2ZX0pfX0pfSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXt2YXIgZCxjLGUsaCxnPWZ1bmN0aW9uKCl7dmFyIGI9YSh0aGlzKS5maW5kKFwiOnVpLWJ1dHRvblwiKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yi5idXR0b24oXCJyZWZyZXNoXCIpfSwxKX0saT1mdW5jdGlvbihiKXt2YXIgZj1iLm5hbWUsaj1iLmZvcm0sbD1hKFtdKTtpZihmKWw9aj9hKGopLmZpbmQoXCJbbmFtZT0nXCIrZitcIiddXCIpOmEoXCJbbmFtZT0nXCIrZitcIiddXCIsYi5vd25lckRvY3VtZW50KS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5mb3JtfSk7cmV0dXJuIGx9O2Eud2lkZ2V0KFwidWkuYnV0dG9uXCIse29wdGlvbnM6e2Rpc2FibGVkOm51bGwsdGV4dDp0cnVlLGxhYmVsOm51bGwsaWNvbnM6e3ByaW1hcnk6bnVsbCxzZWNvbmRhcnk6bnVsbH19LF9jcmVhdGU6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQuY2xvc2VzdChcImZvcm1cIikudW5iaW5kKFwicmVzZXQuYnV0dG9uXCIpLmJpbmQoXCJyZXNldC5idXR0b25cIixnKTtpZih0eXBlb2YgdGhpcy5vcHRpb25zLmRpc2FibGVkIT09XG5cImJvb2xlYW5cIil0aGlzLm9wdGlvbnMuZGlzYWJsZWQ9dGhpcy5lbGVtZW50LnByb3BBdHRyKFwiZGlzYWJsZWRcIik7dGhpcy5fZGV0ZXJtaW5lQnV0dG9uVHlwZSgpO3RoaXMuaGFzVGl0bGU9ISF0aGlzLmJ1dHRvbkVsZW1lbnQuYXR0cihcInRpdGxlXCIpO3ZhciBiPXRoaXMsZj10aGlzLm9wdGlvbnMsaj10aGlzLnR5cGU9PT1cImNoZWNrYm94XCJ8fHRoaXMudHlwZT09PVwicmFkaW9cIixsPVwidWktc3RhdGUtaG92ZXJcIisoIWo/XCIgdWktc3RhdGUtYWN0aXZlXCI6XCJcIik7aWYoZi5sYWJlbD09PW51bGwpZi5sYWJlbD10aGlzLmJ1dHRvbkVsZW1lbnQuaHRtbCgpO2lmKHRoaXMuZWxlbWVudC5pcyhcIjpkaXNhYmxlZFwiKSlmLmRpc2FibGVkPXRydWU7dGhpcy5idXR0b25FbGVtZW50LmFkZENsYXNzKFwidWktYnV0dG9uIHVpLXdpZGdldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGxcIikuYXR0cihcInJvbGVcIixcImJ1dHRvblwiKS5iaW5kKFwibW91c2VlbnRlci5idXR0b25cIixmdW5jdGlvbigpe2lmKCFmLmRpc2FibGVkKXthKHRoaXMpLmFkZENsYXNzKFwidWktc3RhdGUtaG92ZXJcIik7XG50aGlzPT09ZCYmYSh0aGlzKS5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKX19KS5iaW5kKFwibW91c2VsZWF2ZS5idXR0b25cIixmdW5jdGlvbigpe2YuZGlzYWJsZWR8fGEodGhpcykucmVtb3ZlQ2xhc3MobCl9KS5iaW5kKFwiY2xpY2suYnV0dG9uXCIsZnVuY3Rpb24obyl7aWYoZi5kaXNhYmxlZCl7by5wcmV2ZW50RGVmYXVsdCgpO28uc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCl9fSk7dGhpcy5lbGVtZW50LmJpbmQoXCJmb2N1cy5idXR0b25cIixmdW5jdGlvbigpe2IuYnV0dG9uRWxlbWVudC5hZGRDbGFzcyhcInVpLXN0YXRlLWZvY3VzXCIpfSkuYmluZChcImJsdXIuYnV0dG9uXCIsZnVuY3Rpb24oKXtiLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX0pO2lmKGope3RoaXMuZWxlbWVudC5iaW5kKFwiY2hhbmdlLmJ1dHRvblwiLGZ1bmN0aW9uKCl7aHx8Yi5yZWZyZXNoKCl9KTt0aGlzLmJ1dHRvbkVsZW1lbnQuYmluZChcIm1vdXNlZG93bi5idXR0b25cIixmdW5jdGlvbihvKXtpZighZi5kaXNhYmxlZCl7aD1cbmZhbHNlO2M9by5wYWdlWDtlPW8ucGFnZVl9fSkuYmluZChcIm1vdXNldXAuYnV0dG9uXCIsZnVuY3Rpb24obyl7aWYoIWYuZGlzYWJsZWQpaWYoYyE9PW8ucGFnZVh8fGUhPT1vLnBhZ2VZKWg9dHJ1ZX0pfWlmKHRoaXMudHlwZT09PVwiY2hlY2tib3hcIil0aGlzLmJ1dHRvbkVsZW1lbnQuYmluZChcImNsaWNrLmJ1dHRvblwiLGZ1bmN0aW9uKCl7aWYoZi5kaXNhYmxlZHx8aClyZXR1cm4gZmFsc2U7YSh0aGlzKS50b2dnbGVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKTtiLmJ1dHRvbkVsZW1lbnQuYXR0cihcImFyaWEtcHJlc3NlZFwiLGIuZWxlbWVudFswXS5jaGVja2VkKX0pO2Vsc2UgaWYodGhpcy50eXBlPT09XCJyYWRpb1wiKXRoaXMuYnV0dG9uRWxlbWVudC5iaW5kKFwiY2xpY2suYnV0dG9uXCIsZnVuY3Rpb24oKXtpZihmLmRpc2FibGVkfHxoKXJldHVybiBmYWxzZTthKHRoaXMpLmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpO2IuYnV0dG9uRWxlbWVudC5hdHRyKFwiYXJpYS1wcmVzc2VkXCIsXCJ0cnVlXCIpO1xudmFyIG89Yi5lbGVtZW50WzBdO2kobykubm90KG8pLm1hcChmdW5jdGlvbigpe3JldHVybiBhKHRoaXMpLmJ1dHRvbihcIndpZGdldFwiKVswXX0pLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpLmF0dHIoXCJhcmlhLXByZXNzZWRcIixcImZhbHNlXCIpfSk7ZWxzZXt0aGlzLmJ1dHRvbkVsZW1lbnQuYmluZChcIm1vdXNlZG93bi5idXR0b25cIixmdW5jdGlvbigpe2lmKGYuZGlzYWJsZWQpcmV0dXJuIGZhbHNlO2EodGhpcykuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIik7ZD10aGlzO2EoZG9jdW1lbnQpLm9uZShcIm1vdXNldXBcIixmdW5jdGlvbigpe2Q9bnVsbH0pfSkuYmluZChcIm1vdXNldXAuYnV0dG9uXCIsZnVuY3Rpb24oKXtpZihmLmRpc2FibGVkKXJldHVybiBmYWxzZTthKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpfSkuYmluZChcImtleWRvd24uYnV0dG9uXCIsZnVuY3Rpb24obyl7aWYoZi5kaXNhYmxlZClyZXR1cm4gZmFsc2U7aWYoby5rZXlDb2RlPT1hLnVpLmtleUNvZGUuU1BBQ0V8fFxuby5rZXlDb2RlPT1hLnVpLmtleUNvZGUuRU5URVIpYSh0aGlzKS5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKX0pLmJpbmQoXCJrZXl1cC5idXR0b25cIixmdW5jdGlvbigpe2EodGhpcykucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIil9KTt0aGlzLmJ1dHRvbkVsZW1lbnQuaXMoXCJhXCIpJiZ0aGlzLmJ1dHRvbkVsZW1lbnQua2V5dXAoZnVuY3Rpb24obyl7by5rZXlDb2RlPT09YS51aS5rZXlDb2RlLlNQQUNFJiZhKHRoaXMpLmNsaWNrKCl9KX10aGlzLl9zZXRPcHRpb24oXCJkaXNhYmxlZFwiLGYuZGlzYWJsZWQpO3RoaXMuX3Jlc2V0QnV0dG9uKCl9LF9kZXRlcm1pbmVCdXR0b25UeXBlOmZ1bmN0aW9uKCl7dGhpcy50eXBlPXRoaXMuZWxlbWVudC5pcyhcIjpjaGVja2JveFwiKT9cImNoZWNrYm94XCI6dGhpcy5lbGVtZW50LmlzKFwiOnJhZGlvXCIpP1wicmFkaW9cIjp0aGlzLmVsZW1lbnQuaXMoXCJpbnB1dFwiKT9cImlucHV0XCI6XCJidXR0b25cIjtpZih0aGlzLnR5cGU9PT1cImNoZWNrYm94XCJ8fHRoaXMudHlwZT09PVxuXCJyYWRpb1wiKXt2YXIgYj10aGlzLmVsZW1lbnQucGFyZW50cygpLmZpbHRlcihcIjpsYXN0XCIpLGY9XCJsYWJlbFtmb3I9J1wiK3RoaXMuZWxlbWVudC5hdHRyKFwiaWRcIikrXCInXVwiO3RoaXMuYnV0dG9uRWxlbWVudD1iLmZpbmQoZik7aWYoIXRoaXMuYnV0dG9uRWxlbWVudC5sZW5ndGgpe2I9Yi5sZW5ndGg/Yi5zaWJsaW5ncygpOnRoaXMuZWxlbWVudC5zaWJsaW5ncygpO3RoaXMuYnV0dG9uRWxlbWVudD1iLmZpbHRlcihmKTtpZighdGhpcy5idXR0b25FbGVtZW50Lmxlbmd0aCl0aGlzLmJ1dHRvbkVsZW1lbnQ9Yi5maW5kKGYpfXRoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWhlbHBlci1oaWRkZW4tYWNjZXNzaWJsZVwiKTsoYj10aGlzLmVsZW1lbnQuaXMoXCI6Y2hlY2tlZFwiKSkmJnRoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKTt0aGlzLmJ1dHRvbkVsZW1lbnQuYXR0cihcImFyaWEtcHJlc3NlZFwiLGIpfWVsc2UgdGhpcy5idXR0b25FbGVtZW50PXRoaXMuZWxlbWVudH0sXG53aWRnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5idXR0b25FbGVtZW50fSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlXCIpO3RoaXMuYnV0dG9uRWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLWJ1dHRvbiB1aS13aWRnZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIHVpLXN0YXRlLWhvdmVyIHVpLXN0YXRlLWFjdGl2ZSAgdWktYnV0dG9uLWljb25zLW9ubHkgdWktYnV0dG9uLWljb24tb25seSB1aS1idXR0b24tdGV4dC1pY29ucyB1aS1idXR0b24tdGV4dC1pY29uLXByaW1hcnkgdWktYnV0dG9uLXRleHQtaWNvbi1zZWNvbmRhcnkgdWktYnV0dG9uLXRleHQtb25seVwiKS5yZW1vdmVBdHRyKFwicm9sZVwiKS5yZW1vdmVBdHRyKFwiYXJpYS1wcmVzc2VkXCIpLmh0bWwodGhpcy5idXR0b25FbGVtZW50LmZpbmQoXCIudWktYnV0dG9uLXRleHRcIikuaHRtbCgpKTt0aGlzLmhhc1RpdGxlfHx0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQXR0cihcInRpdGxlXCIpO1xuYS5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKX0sX3NldE9wdGlvbjpmdW5jdGlvbihiLGYpe2EuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtpZihiPT09XCJkaXNhYmxlZFwiKWY/dGhpcy5lbGVtZW50LnByb3BBdHRyKFwiZGlzYWJsZWRcIix0cnVlKTp0aGlzLmVsZW1lbnQucHJvcEF0dHIoXCJkaXNhYmxlZFwiLGZhbHNlKTtlbHNlIHRoaXMuX3Jlc2V0QnV0dG9uKCl9LHJlZnJlc2g6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLmVsZW1lbnQuaXMoXCI6ZGlzYWJsZWRcIik7YiE9PXRoaXMub3B0aW9ucy5kaXNhYmxlZCYmdGhpcy5fc2V0T3B0aW9uKFwiZGlzYWJsZWRcIixiKTtpZih0aGlzLnR5cGU9PT1cInJhZGlvXCIpaSh0aGlzLmVsZW1lbnRbMF0pLmVhY2goZnVuY3Rpb24oKXthKHRoaXMpLmlzKFwiOmNoZWNrZWRcIik/YSh0aGlzKS5idXR0b24oXCJ3aWRnZXRcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIikuYXR0cihcImFyaWEtcHJlc3NlZFwiLFxuXCJ0cnVlXCIpOmEodGhpcykuYnV0dG9uKFwid2lkZ2V0XCIpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpLmF0dHIoXCJhcmlhLXByZXNzZWRcIixcImZhbHNlXCIpfSk7ZWxzZSBpZih0aGlzLnR5cGU9PT1cImNoZWNrYm94XCIpdGhpcy5lbGVtZW50LmlzKFwiOmNoZWNrZWRcIik/dGhpcy5idXR0b25FbGVtZW50LmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpLmF0dHIoXCJhcmlhLXByZXNzZWRcIixcInRydWVcIik6dGhpcy5idXR0b25FbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpLmF0dHIoXCJhcmlhLXByZXNzZWRcIixcImZhbHNlXCIpfSxfcmVzZXRCdXR0b246ZnVuY3Rpb24oKXtpZih0aGlzLnR5cGU9PT1cImlucHV0XCIpdGhpcy5vcHRpb25zLmxhYmVsJiZ0aGlzLmVsZW1lbnQudmFsKHRoaXMub3B0aW9ucy5sYWJlbCk7ZWxzZXt2YXIgYj10aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1idXR0b24taWNvbnMtb25seSB1aS1idXR0b24taWNvbi1vbmx5IHVpLWJ1dHRvbi10ZXh0LWljb25zIHVpLWJ1dHRvbi10ZXh0LWljb24tcHJpbWFyeSB1aS1idXR0b24tdGV4dC1pY29uLXNlY29uZGFyeSB1aS1idXR0b24tdGV4dC1vbmx5XCIpLFxuZj1hKFwiPHNwYW4+PC9zcGFuPlwiKS5hZGRDbGFzcyhcInVpLWJ1dHRvbi10ZXh0XCIpLmh0bWwodGhpcy5vcHRpb25zLmxhYmVsKS5hcHBlbmRUbyhiLmVtcHR5KCkpLnRleHQoKSxqPXRoaXMub3B0aW9ucy5pY29ucyxsPWoucHJpbWFyeSYmai5zZWNvbmRhcnksbz1bXTtpZihqLnByaW1hcnl8fGouc2Vjb25kYXJ5KXtpZih0aGlzLm9wdGlvbnMudGV4dClvLnB1c2goXCJ1aS1idXR0b24tdGV4dC1pY29uXCIrKGw/XCJzXCI6ai5wcmltYXJ5P1wiLXByaW1hcnlcIjpcIi1zZWNvbmRhcnlcIikpO2oucHJpbWFyeSYmYi5wcmVwZW5kKFwiPHNwYW4gY2xhc3M9J3VpLWJ1dHRvbi1pY29uLXByaW1hcnkgdWktaWNvbiBcIitqLnByaW1hcnkrXCInPjwvc3Bhbj5cIik7ai5zZWNvbmRhcnkmJmIuYXBwZW5kKFwiPHNwYW4gY2xhc3M9J3VpLWJ1dHRvbi1pY29uLXNlY29uZGFyeSB1aS1pY29uIFwiK2ouc2Vjb25kYXJ5K1wiJz48L3NwYW4+XCIpO2lmKCF0aGlzLm9wdGlvbnMudGV4dCl7by5wdXNoKGw/XCJ1aS1idXR0b24taWNvbnMtb25seVwiOlxuXCJ1aS1idXR0b24taWNvbi1vbmx5XCIpO3RoaXMuaGFzVGl0bGV8fGIuYXR0cihcInRpdGxlXCIsZil9fWVsc2Ugby5wdXNoKFwidWktYnV0dG9uLXRleHQtb25seVwiKTtiLmFkZENsYXNzKG8uam9pbihcIiBcIikpfX19KTthLndpZGdldChcInVpLmJ1dHRvbnNldFwiLHtvcHRpb25zOntpdGVtczpcIjpidXR0b24sIDpzdWJtaXQsIDpyZXNldCwgOmNoZWNrYm94LCA6cmFkaW8sIGEsIDpkYXRhKGJ1dHRvbilcIn0sX2NyZWF0ZTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWJ1dHRvbnNldFwiKX0sX2luaXQ6ZnVuY3Rpb24oKXt0aGlzLnJlZnJlc2goKX0sX3NldE9wdGlvbjpmdW5jdGlvbihiLGYpe2I9PT1cImRpc2FibGVkXCImJnRoaXMuYnV0dG9ucy5idXR0b24oXCJvcHRpb25cIixiLGYpO2EuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0scmVmcmVzaDpmdW5jdGlvbigpe3ZhciBiPXRoaXMuZWxlbWVudC5jc3MoXCJkaXJlY3Rpb25cIik9PT1cblwibHRyXCI7dGhpcy5idXR0b25zPXRoaXMuZWxlbWVudC5maW5kKHRoaXMub3B0aW9ucy5pdGVtcykuZmlsdGVyKFwiOnVpLWJ1dHRvblwiKS5idXR0b24oXCJyZWZyZXNoXCIpLmVuZCgpLm5vdChcIjp1aS1idXR0b25cIikuYnV0dG9uKCkuZW5kKCkubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIGEodGhpcykuYnV0dG9uKFwid2lkZ2V0XCIpWzBdfSkucmVtb3ZlQ2xhc3MoXCJ1aS1jb3JuZXItYWxsIHVpLWNvcm5lci1sZWZ0IHVpLWNvcm5lci1yaWdodFwiKS5maWx0ZXIoXCI6Zmlyc3RcIikuYWRkQ2xhc3MoYj9cInVpLWNvcm5lci1sZWZ0XCI6XCJ1aS1jb3JuZXItcmlnaHRcIikuZW5kKCkuZmlsdGVyKFwiOmxhc3RcIikuYWRkQ2xhc3MoYj9cInVpLWNvcm5lci1yaWdodFwiOlwidWktY29ybmVyLWxlZnRcIikuZW5kKCkuZW5kKCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1idXR0b25zZXRcIik7dGhpcy5idXR0b25zLm1hcChmdW5jdGlvbigpe3JldHVybiBhKHRoaXMpLmJ1dHRvbihcIndpZGdldFwiKVswXX0pLnJlbW92ZUNsYXNzKFwidWktY29ybmVyLWxlZnQgdWktY29ybmVyLXJpZ2h0XCIpLmVuZCgpLmJ1dHRvbihcImRlc3Ryb3lcIik7XG5hLldpZGdldC5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpfX0pfSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhLGQpe2Z1bmN0aW9uIGMoKXt0aGlzLmRlYnVnPWZhbHNlO3RoaXMuX2N1ckluc3Q9bnVsbDt0aGlzLl9rZXlFdmVudD1mYWxzZTt0aGlzLl9kaXNhYmxlZElucHV0cz1bXTt0aGlzLl9pbkRpYWxvZz10aGlzLl9kYXRlcGlja2VyU2hvd2luZz1mYWxzZTt0aGlzLl9tYWluRGl2SWQ9XCJ1aS1kYXRlcGlja2VyLWRpdlwiO3RoaXMuX2lubGluZUNsYXNzPVwidWktZGF0ZXBpY2tlci1pbmxpbmVcIjt0aGlzLl9hcHBlbmRDbGFzcz1cInVpLWRhdGVwaWNrZXItYXBwZW5kXCI7dGhpcy5fdHJpZ2dlckNsYXNzPVwidWktZGF0ZXBpY2tlci10cmlnZ2VyXCI7dGhpcy5fZGlhbG9nQ2xhc3M9XCJ1aS1kYXRlcGlja2VyLWRpYWxvZ1wiO3RoaXMuX2Rpc2FibGVDbGFzcz1cInVpLWRhdGVwaWNrZXItZGlzYWJsZWRcIjt0aGlzLl91bnNlbGVjdGFibGVDbGFzcz1cInVpLWRhdGVwaWNrZXItdW5zZWxlY3RhYmxlXCI7dGhpcy5fY3VycmVudENsYXNzPVwidWktZGF0ZXBpY2tlci1jdXJyZW50LWRheVwiO3RoaXMuX2RheU92ZXJDbGFzcz1cblwidWktZGF0ZXBpY2tlci1kYXlzLWNlbGwtb3ZlclwiO3RoaXMucmVnaW9uYWw9W107dGhpcy5yZWdpb25hbFtcIlwiXT17Y2xvc2VUZXh0OlwiRG9uZVwiLHByZXZUZXh0OlwiUHJldlwiLG5leHRUZXh0OlwiTmV4dFwiLGN1cnJlbnRUZXh0OlwiVG9kYXlcIixtb250aE5hbWVzOltcIkphbnVhcnlcIixcIkZlYnJ1YXJ5XCIsXCJNYXJjaFwiLFwiQXByaWxcIixcIk1heVwiLFwiSnVuZVwiLFwiSnVseVwiLFwiQXVndXN0XCIsXCJTZXB0ZW1iZXJcIixcIk9jdG9iZXJcIixcIk5vdmVtYmVyXCIsXCJEZWNlbWJlclwiXSxtb250aE5hbWVzU2hvcnQ6W1wiSmFuXCIsXCJGZWJcIixcIk1hclwiLFwiQXByXCIsXCJNYXlcIixcIkp1blwiLFwiSnVsXCIsXCJBdWdcIixcIlNlcFwiLFwiT2N0XCIsXCJOb3ZcIixcIkRlY1wiXSxkYXlOYW1lczpbXCJTdW5kYXlcIixcIk1vbmRheVwiLFwiVHVlc2RheVwiLFwiV2VkbmVzZGF5XCIsXCJUaHVyc2RheVwiLFwiRnJpZGF5XCIsXCJTYXR1cmRheVwiXSxkYXlOYW1lc1Nob3J0OltcIlN1blwiLFwiTW9uXCIsXCJUdWVcIixcIldlZFwiLFwiVGh1XCIsXCJGcmlcIixcIlNhdFwiXSxkYXlOYW1lc01pbjpbXCJTdVwiLFxuXCJNb1wiLFwiVHVcIixcIldlXCIsXCJUaFwiLFwiRnJcIixcIlNhXCJdLHdlZWtIZWFkZXI6XCJXa1wiLGRhdGVGb3JtYXQ6XCJtbS9kZC95eVwiLGZpcnN0RGF5OjAsaXNSVEw6ZmFsc2Usc2hvd01vbnRoQWZ0ZXJZZWFyOmZhbHNlLHllYXJTdWZmaXg6XCJcIn07dGhpcy5fZGVmYXVsdHM9e3Nob3dPbjpcImZvY3VzXCIsc2hvd0FuaW06XCJmYWRlSW5cIixzaG93T3B0aW9uczp7fSxkZWZhdWx0RGF0ZTpudWxsLGFwcGVuZFRleHQ6XCJcIixidXR0b25UZXh0OlwiLi4uXCIsYnV0dG9uSW1hZ2U6XCJcIixidXR0b25JbWFnZU9ubHk6ZmFsc2UsaGlkZUlmTm9QcmV2TmV4dDpmYWxzZSxuYXZpZ2F0aW9uQXNEYXRlRm9ybWF0OmZhbHNlLGdvdG9DdXJyZW50OmZhbHNlLGNoYW5nZU1vbnRoOmZhbHNlLGNoYW5nZVllYXI6ZmFsc2UseWVhclJhbmdlOlwiYy0xMDpjKzEwXCIsc2hvd090aGVyTW9udGhzOmZhbHNlLHNlbGVjdE90aGVyTW9udGhzOmZhbHNlLHNob3dXZWVrOmZhbHNlLGNhbGN1bGF0ZVdlZWs6dGhpcy5pc284NjAxV2VlayxzaG9ydFllYXJDdXRvZmY6XCIrMTBcIixcbm1pbkRhdGU6bnVsbCxtYXhEYXRlOm51bGwsZHVyYXRpb246XCJmYXN0XCIsYmVmb3JlU2hvd0RheTpudWxsLGJlZm9yZVNob3c6bnVsbCxvblNlbGVjdDpudWxsLG9uQ2hhbmdlTW9udGhZZWFyOm51bGwsb25DbG9zZTpudWxsLG51bWJlck9mTW9udGhzOjEsc2hvd0N1cnJlbnRBdFBvczowLHN0ZXBNb250aHM6MSxzdGVwQmlnTW9udGhzOjEyLGFsdEZpZWxkOlwiXCIsYWx0Rm9ybWF0OlwiXCIsY29uc3RyYWluSW5wdXQ6dHJ1ZSxzaG93QnV0dG9uUGFuZWw6ZmFsc2UsYXV0b1NpemU6ZmFsc2UsZGlzYWJsZWQ6ZmFsc2V9O2EuZXh0ZW5kKHRoaXMuX2RlZmF1bHRzLHRoaXMucmVnaW9uYWxbXCJcIl0pO3RoaXMuZHBEaXY9ZShhKCc8ZGl2IGlkPVwiJyt0aGlzLl9tYWluRGl2SWQrJ1wiIGNsYXNzPVwidWktZGF0ZXBpY2tlciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktaGVscGVyLWNsZWFyZml4IHVpLWNvcm5lci1hbGxcIj48L2Rpdj4nKSl9ZnVuY3Rpb24gZShiKXtyZXR1cm4gYi5iaW5kKFwibW91c2VvdXRcIixcbmZ1bmN0aW9uKGYpe2Y9YShmLnRhcmdldCkuY2xvc2VzdChcImJ1dHRvbiwgLnVpLWRhdGVwaWNrZXItcHJldiwgLnVpLWRhdGVwaWNrZXItbmV4dCwgLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIgdGQgYVwiKTtmLmxlbmd0aCYmZi5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyIHVpLWRhdGVwaWNrZXItcHJldi1ob3ZlciB1aS1kYXRlcGlja2VyLW5leHQtaG92ZXJcIil9KS5iaW5kKFwibW91c2VvdmVyXCIsZnVuY3Rpb24oZil7Zj1hKGYudGFyZ2V0KS5jbG9zZXN0KFwiYnV0dG9uLCAudWktZGF0ZXBpY2tlci1wcmV2LCAudWktZGF0ZXBpY2tlci1uZXh0LCAudWktZGF0ZXBpY2tlci1jYWxlbmRhciB0ZCBhXCIpO2lmKCEoYS5kYXRlcGlja2VyLl9pc0Rpc2FibGVkRGF0ZXBpY2tlcihpLmlubGluZT9iLnBhcmVudCgpWzBdOmkuaW5wdXRbMF0pfHwhZi5sZW5ndGgpKXtmLnBhcmVudHMoXCIudWktZGF0ZXBpY2tlci1jYWxlbmRhclwiKS5maW5kKFwiYVwiKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpO1xuZi5hZGRDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpO2YuaGFzQ2xhc3MoXCJ1aS1kYXRlcGlja2VyLXByZXZcIikmJmYuYWRkQ2xhc3MoXCJ1aS1kYXRlcGlja2VyLXByZXYtaG92ZXJcIik7Zi5oYXNDbGFzcyhcInVpLWRhdGVwaWNrZXItbmV4dFwiKSYmZi5hZGRDbGFzcyhcInVpLWRhdGVwaWNrZXItbmV4dC1ob3ZlclwiKX19KX1mdW5jdGlvbiBoKGIsZil7YS5leHRlbmQoYixmKTtmb3IodmFyIGogaW4gZilpZihmW2pdPT1udWxsfHxmW2pdPT1kKWJbal09ZltqXTtyZXR1cm4gYn1hLmV4dGVuZChhLnVpLHtkYXRlcGlja2VyOnt2ZXJzaW9uOlwiMS44LjE2XCJ9fSk7dmFyIGc9KG5ldyBEYXRlKS5nZXRUaW1lKCksaTthLmV4dGVuZChjLnByb3RvdHlwZSx7bWFya2VyQ2xhc3NOYW1lOlwiaGFzRGF0ZXBpY2tlclwiLG1heFJvd3M6NCxsb2c6ZnVuY3Rpb24oKXt0aGlzLmRlYnVnJiZjb25zb2xlLmxvZy5hcHBseShcIlwiLGFyZ3VtZW50cyl9LF93aWRnZXREYXRlcGlja2VyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZHBEaXZ9LFxuc2V0RGVmYXVsdHM6ZnVuY3Rpb24oYil7aCh0aGlzLl9kZWZhdWx0cyxifHx7fSk7cmV0dXJuIHRoaXN9LF9hdHRhY2hEYXRlcGlja2VyOmZ1bmN0aW9uKGIsZil7dmFyIGo9bnVsbDtmb3IodmFyIGwgaW4gdGhpcy5fZGVmYXVsdHMpe3ZhciBvPWIuZ2V0QXR0cmlidXRlKFwiZGF0ZTpcIitsKTtpZihvKXtqPWp8fHt9O3RyeXtqW2xdPWV2YWwobyl9Y2F0Y2gobil7altsXT1vfX19bD1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7bz1sPT1cImRpdlwifHxsPT1cInNwYW5cIjtpZighYi5pZCl7dGhpcy51dWlkKz0xO2IuaWQ9XCJkcFwiK3RoaXMudXVpZH12YXIgaz10aGlzLl9uZXdJbnN0KGEoYiksbyk7ay5zZXR0aW5ncz1hLmV4dGVuZCh7fSxmfHx7fSxqfHx7fSk7aWYobD09XCJpbnB1dFwiKXRoaXMuX2Nvbm5lY3REYXRlcGlja2VyKGIsayk7ZWxzZSBvJiZ0aGlzLl9pbmxpbmVEYXRlcGlja2VyKGIsayl9LF9uZXdJbnN0OmZ1bmN0aW9uKGIsZil7cmV0dXJue2lkOmJbMF0uaWQucmVwbGFjZSgvKFteQS1aYS16MC05Xy1dKS9nLFxuXCJcXFxcXFxcXCQxXCIpLGlucHV0OmIsc2VsZWN0ZWREYXk6MCxzZWxlY3RlZE1vbnRoOjAsc2VsZWN0ZWRZZWFyOjAsZHJhd01vbnRoOjAsZHJhd1llYXI6MCxpbmxpbmU6ZixkcERpdjohZj90aGlzLmRwRGl2OmUoYSgnPGRpdiBjbGFzcz1cIicrdGhpcy5faW5saW5lQ2xhc3MrJyB1aS1kYXRlcGlja2VyIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1oZWxwZXItY2xlYXJmaXggdWktY29ybmVyLWFsbFwiPjwvZGl2PicpKX19LF9jb25uZWN0RGF0ZXBpY2tlcjpmdW5jdGlvbihiLGYpe3ZhciBqPWEoYik7Zi5hcHBlbmQ9YShbXSk7Zi50cmlnZ2VyPWEoW10pO2lmKCFqLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSl7dGhpcy5fYXR0YWNobWVudHMoaixmKTtqLmFkZENsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS5rZXlkb3duKHRoaXMuX2RvS2V5RG93bikua2V5cHJlc3ModGhpcy5fZG9LZXlQcmVzcykua2V5dXAodGhpcy5fZG9LZXlVcCkuYmluZChcInNldERhdGEuZGF0ZXBpY2tlclwiLFxuZnVuY3Rpb24obCxvLG4pe2Yuc2V0dGluZ3Nbb109bn0pLmJpbmQoXCJnZXREYXRhLmRhdGVwaWNrZXJcIixmdW5jdGlvbihsLG8pe3JldHVybiB0aGlzLl9nZXQoZixvKX0pO3RoaXMuX2F1dG9TaXplKGYpO2EuZGF0YShiLFwiZGF0ZXBpY2tlclwiLGYpO2Yuc2V0dGluZ3MuZGlzYWJsZWQmJnRoaXMuX2Rpc2FibGVEYXRlcGlja2VyKGIpfX0sX2F0dGFjaG1lbnRzOmZ1bmN0aW9uKGIsZil7dmFyIGo9dGhpcy5fZ2V0KGYsXCJhcHBlbmRUZXh0XCIpLGw9dGhpcy5fZ2V0KGYsXCJpc1JUTFwiKTtmLmFwcGVuZCYmZi5hcHBlbmQucmVtb3ZlKCk7aWYoail7Zi5hcHBlbmQ9YSgnPHNwYW4gY2xhc3M9XCInK3RoaXMuX2FwcGVuZENsYXNzKydcIj4nK2orXCI8L3NwYW4+XCIpO2JbbD9cImJlZm9yZVwiOlwiYWZ0ZXJcIl0oZi5hcHBlbmQpfWIudW5iaW5kKFwiZm9jdXNcIix0aGlzLl9zaG93RGF0ZXBpY2tlcik7Zi50cmlnZ2VyJiZmLnRyaWdnZXIucmVtb3ZlKCk7aj10aGlzLl9nZXQoZixcInNob3dPblwiKTtpZihqPT1cblwiZm9jdXNcInx8aj09XCJib3RoXCIpYi5mb2N1cyh0aGlzLl9zaG93RGF0ZXBpY2tlcik7aWYoaj09XCJidXR0b25cInx8aj09XCJib3RoXCIpe2o9dGhpcy5fZ2V0KGYsXCJidXR0b25UZXh0XCIpO3ZhciBvPXRoaXMuX2dldChmLFwiYnV0dG9uSW1hZ2VcIik7Zi50cmlnZ2VyPWEodGhpcy5fZ2V0KGYsXCJidXR0b25JbWFnZU9ubHlcIik/YShcIjxpbWcvPlwiKS5hZGRDbGFzcyh0aGlzLl90cmlnZ2VyQ2xhc3MpLmF0dHIoe3NyYzpvLGFsdDpqLHRpdGxlOmp9KTphKCc8YnV0dG9uIHR5cGU9XCJidXR0b25cIj48L2J1dHRvbj4nKS5hZGRDbGFzcyh0aGlzLl90cmlnZ2VyQ2xhc3MpLmh0bWwobz09XCJcIj9qOmEoXCI8aW1nLz5cIikuYXR0cih7c3JjOm8sYWx0OmosdGl0bGU6an0pKSk7YltsP1wiYmVmb3JlXCI6XCJhZnRlclwiXShmLnRyaWdnZXIpO2YudHJpZ2dlci5jbGljayhmdW5jdGlvbigpe2EuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcmJmEuZGF0ZXBpY2tlci5fbGFzdElucHV0PT1iWzBdP2EuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKTpcbmEuZGF0ZXBpY2tlci5fc2hvd0RhdGVwaWNrZXIoYlswXSk7cmV0dXJuIGZhbHNlfSl9fSxfYXV0b1NpemU6ZnVuY3Rpb24oYil7aWYodGhpcy5fZ2V0KGIsXCJhdXRvU2l6ZVwiKSYmIWIuaW5saW5lKXt2YXIgZj1uZXcgRGF0ZSgyMDA5LDExLDIwKSxqPXRoaXMuX2dldChiLFwiZGF0ZUZvcm1hdFwiKTtpZihqLm1hdGNoKC9bRE1dLykpe3ZhciBsPWZ1bmN0aW9uKG8pe2Zvcih2YXIgbj0wLGs9MCxtPTA7bTxvLmxlbmd0aDttKyspaWYob1ttXS5sZW5ndGg+bil7bj1vW21dLmxlbmd0aDtrPW19cmV0dXJuIGt9O2Yuc2V0TW9udGgobCh0aGlzLl9nZXQoYixqLm1hdGNoKC9NTS8pP1wibW9udGhOYW1lc1wiOlwibW9udGhOYW1lc1Nob3J0XCIpKSk7Zi5zZXREYXRlKGwodGhpcy5fZ2V0KGIsai5tYXRjaCgvREQvKT9cImRheU5hbWVzXCI6XCJkYXlOYW1lc1Nob3J0XCIpKSsyMC1mLmdldERheSgpKX1iLmlucHV0LmF0dHIoXCJzaXplXCIsdGhpcy5fZm9ybWF0RGF0ZShiLGYpLmxlbmd0aCl9fSxfaW5saW5lRGF0ZXBpY2tlcjpmdW5jdGlvbihiLFxuZil7dmFyIGo9YShiKTtpZighai5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpe2ouYWRkQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpLmFwcGVuZChmLmRwRGl2KS5iaW5kKFwic2V0RGF0YS5kYXRlcGlja2VyXCIsZnVuY3Rpb24obCxvLG4pe2Yuc2V0dGluZ3Nbb109bn0pLmJpbmQoXCJnZXREYXRhLmRhdGVwaWNrZXJcIixmdW5jdGlvbihsLG8pe3JldHVybiB0aGlzLl9nZXQoZixvKX0pO2EuZGF0YShiLFwiZGF0ZXBpY2tlclwiLGYpO3RoaXMuX3NldERhdGUoZix0aGlzLl9nZXREZWZhdWx0RGF0ZShmKSx0cnVlKTt0aGlzLl91cGRhdGVEYXRlcGlja2VyKGYpO3RoaXMuX3VwZGF0ZUFsdGVybmF0ZShmKTtmLnNldHRpbmdzLmRpc2FibGVkJiZ0aGlzLl9kaXNhYmxlRGF0ZXBpY2tlcihiKTtmLmRwRGl2LmNzcyhcImRpc3BsYXlcIixcImJsb2NrXCIpfX0sX2RpYWxvZ0RhdGVwaWNrZXI6ZnVuY3Rpb24oYixmLGosbCxvKXtiPXRoaXMuX2RpYWxvZ0luc3Q7aWYoIWIpe3RoaXMudXVpZCs9XG4xO3RoaXMuX2RpYWxvZ0lucHV0PWEoJzxpbnB1dCB0eXBlPVwidGV4dFwiIGlkPVwiJysoXCJkcFwiK3RoaXMudXVpZCkrJ1wiIHN0eWxlPVwicG9zaXRpb246IGFic29sdXRlOyB0b3A6IC0xMDBweDsgd2lkdGg6IDBweDsgei1pbmRleDogLTEwO1wiLz4nKTt0aGlzLl9kaWFsb2dJbnB1dC5rZXlkb3duKHRoaXMuX2RvS2V5RG93bik7YShcImJvZHlcIikuYXBwZW5kKHRoaXMuX2RpYWxvZ0lucHV0KTtiPXRoaXMuX2RpYWxvZ0luc3Q9dGhpcy5fbmV3SW5zdCh0aGlzLl9kaWFsb2dJbnB1dCxmYWxzZSk7Yi5zZXR0aW5ncz17fTthLmRhdGEodGhpcy5fZGlhbG9nSW5wdXRbMF0sXCJkYXRlcGlja2VyXCIsYil9aChiLnNldHRpbmdzLGx8fHt9KTtmPWYmJmYuY29uc3RydWN0b3I9PURhdGU/dGhpcy5fZm9ybWF0RGF0ZShiLGYpOmY7dGhpcy5fZGlhbG9nSW5wdXQudmFsKGYpO3RoaXMuX3Bvcz1vP28ubGVuZ3RoP286W28ucGFnZVgsby5wYWdlWV06bnVsbDtpZighdGhpcy5fcG9zKXRoaXMuX3Bvcz1bZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoL1xuMi0xMDArKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0fHxkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQpLGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQvMi0xNTArKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3B8fGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wKV07dGhpcy5fZGlhbG9nSW5wdXQuY3NzKFwibGVmdFwiLHRoaXMuX3Bvc1swXSsyMCtcInB4XCIpLmNzcyhcInRvcFwiLHRoaXMuX3Bvc1sxXStcInB4XCIpO2Iuc2V0dGluZ3Mub25TZWxlY3Q9ajt0aGlzLl9pbkRpYWxvZz10cnVlO3RoaXMuZHBEaXYuYWRkQ2xhc3ModGhpcy5fZGlhbG9nQ2xhc3MpO3RoaXMuX3Nob3dEYXRlcGlja2VyKHRoaXMuX2RpYWxvZ0lucHV0WzBdKTthLmJsb2NrVUkmJmEuYmxvY2tVSSh0aGlzLmRwRGl2KTthLmRhdGEodGhpcy5fZGlhbG9nSW5wdXRbMF0sXCJkYXRlcGlja2VyXCIsYik7cmV0dXJuIHRoaXN9LF9kZXN0cm95RGF0ZXBpY2tlcjpmdW5jdGlvbihiKXt2YXIgZj1cbmEoYiksaj1hLmRhdGEoYixcImRhdGVwaWNrZXJcIik7aWYoZi5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpe3ZhciBsPWIubm9kZU5hbWUudG9Mb3dlckNhc2UoKTthLnJlbW92ZURhdGEoYixcImRhdGVwaWNrZXJcIik7aWYobD09XCJpbnB1dFwiKXtqLmFwcGVuZC5yZW1vdmUoKTtqLnRyaWdnZXIucmVtb3ZlKCk7Zi5yZW1vdmVDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkudW5iaW5kKFwiZm9jdXNcIix0aGlzLl9zaG93RGF0ZXBpY2tlcikudW5iaW5kKFwia2V5ZG93blwiLHRoaXMuX2RvS2V5RG93bikudW5iaW5kKFwia2V5cHJlc3NcIix0aGlzLl9kb0tleVByZXNzKS51bmJpbmQoXCJrZXl1cFwiLHRoaXMuX2RvS2V5VXApfWVsc2UgaWYobD09XCJkaXZcInx8bD09XCJzcGFuXCIpZi5yZW1vdmVDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkuZW1wdHkoKX19LF9lbmFibGVEYXRlcGlja2VyOmZ1bmN0aW9uKGIpe3ZhciBmPWEoYiksaj1hLmRhdGEoYixcImRhdGVwaWNrZXJcIik7aWYoZi5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpe3ZhciBsPVxuYi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmKGw9PVwiaW5wdXRcIil7Yi5kaXNhYmxlZD1mYWxzZTtqLnRyaWdnZXIuZmlsdGVyKFwiYnV0dG9uXCIpLmVhY2goZnVuY3Rpb24oKXt0aGlzLmRpc2FibGVkPWZhbHNlfSkuZW5kKCkuZmlsdGVyKFwiaW1nXCIpLmNzcyh7b3BhY2l0eTpcIjEuMFwiLGN1cnNvcjpcIlwifSl9ZWxzZSBpZihsPT1cImRpdlwifHxsPT1cInNwYW5cIil7Zj1mLmNoaWxkcmVuKFwiLlwiK3RoaXMuX2lubGluZUNsYXNzKTtmLmNoaWxkcmVuKCkucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1kaXNhYmxlZFwiKTtmLmZpbmQoXCJzZWxlY3QudWktZGF0ZXBpY2tlci1tb250aCwgc2VsZWN0LnVpLWRhdGVwaWNrZXIteWVhclwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIil9dGhpcy5fZGlzYWJsZWRJbnB1dHM9YS5tYXAodGhpcy5fZGlzYWJsZWRJbnB1dHMsZnVuY3Rpb24obyl7cmV0dXJuIG89PWI/bnVsbDpvfSl9fSxfZGlzYWJsZURhdGVwaWNrZXI6ZnVuY3Rpb24oYil7dmFyIGY9YShiKSxqPWEuZGF0YShiLFxuXCJkYXRlcGlja2VyXCIpO2lmKGYuaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpKXt2YXIgbD1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7aWYobD09XCJpbnB1dFwiKXtiLmRpc2FibGVkPXRydWU7ai50cmlnZ2VyLmZpbHRlcihcImJ1dHRvblwiKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5kaXNhYmxlZD10cnVlfSkuZW5kKCkuZmlsdGVyKFwiaW1nXCIpLmNzcyh7b3BhY2l0eTpcIjAuNVwiLGN1cnNvcjpcImRlZmF1bHRcIn0pfWVsc2UgaWYobD09XCJkaXZcInx8bD09XCJzcGFuXCIpe2Y9Zi5jaGlsZHJlbihcIi5cIit0aGlzLl9pbmxpbmVDbGFzcyk7Zi5jaGlsZHJlbigpLmFkZENsYXNzKFwidWktc3RhdGUtZGlzYWJsZWRcIik7Zi5maW5kKFwic2VsZWN0LnVpLWRhdGVwaWNrZXItbW9udGgsIHNlbGVjdC51aS1kYXRlcGlja2VyLXllYXJcIikuYXR0cihcImRpc2FibGVkXCIsXCJkaXNhYmxlZFwiKX10aGlzLl9kaXNhYmxlZElucHV0cz1hLm1hcCh0aGlzLl9kaXNhYmxlZElucHV0cyxmdW5jdGlvbihvKXtyZXR1cm4gbz09XG5iP251bGw6b30pO3RoaXMuX2Rpc2FibGVkSW5wdXRzW3RoaXMuX2Rpc2FibGVkSW5wdXRzLmxlbmd0aF09Yn19LF9pc0Rpc2FibGVkRGF0ZXBpY2tlcjpmdW5jdGlvbihiKXtpZighYilyZXR1cm4gZmFsc2U7Zm9yKHZhciBmPTA7Zjx0aGlzLl9kaXNhYmxlZElucHV0cy5sZW5ndGg7ZisrKWlmKHRoaXMuX2Rpc2FibGVkSW5wdXRzW2ZdPT1iKXJldHVybiB0cnVlO3JldHVybiBmYWxzZX0sX2dldEluc3Q6ZnVuY3Rpb24oYil7dHJ5e3JldHVybiBhLmRhdGEoYixcImRhdGVwaWNrZXJcIil9Y2F0Y2goZil7dGhyb3dcIk1pc3NpbmcgaW5zdGFuY2UgZGF0YSBmb3IgdGhpcyBkYXRlcGlja2VyXCI7fX0sX29wdGlvbkRhdGVwaWNrZXI6ZnVuY3Rpb24oYixmLGope3ZhciBsPXRoaXMuX2dldEluc3QoYik7aWYoYXJndW1lbnRzLmxlbmd0aD09MiYmdHlwZW9mIGY9PVwic3RyaW5nXCIpcmV0dXJuIGY9PVwiZGVmYXVsdHNcIj9hLmV4dGVuZCh7fSxhLmRhdGVwaWNrZXIuX2RlZmF1bHRzKTpsP2Y9PVwiYWxsXCI/XG5hLmV4dGVuZCh7fSxsLnNldHRpbmdzKTp0aGlzLl9nZXQobCxmKTpudWxsO3ZhciBvPWZ8fHt9O2lmKHR5cGVvZiBmPT1cInN0cmluZ1wiKXtvPXt9O29bZl09an1pZihsKXt0aGlzLl9jdXJJbnN0PT1sJiZ0aGlzLl9oaWRlRGF0ZXBpY2tlcigpO3ZhciBuPXRoaXMuX2dldERhdGVEYXRlcGlja2VyKGIsdHJ1ZSksaz10aGlzLl9nZXRNaW5NYXhEYXRlKGwsXCJtaW5cIiksbT10aGlzLl9nZXRNaW5NYXhEYXRlKGwsXCJtYXhcIik7aChsLnNldHRpbmdzLG8pO2lmKGshPT1udWxsJiZvLmRhdGVGb3JtYXQhPT1kJiZvLm1pbkRhdGU9PT1kKWwuc2V0dGluZ3MubWluRGF0ZT10aGlzLl9mb3JtYXREYXRlKGwsayk7aWYobSE9PW51bGwmJm8uZGF0ZUZvcm1hdCE9PWQmJm8ubWF4RGF0ZT09PWQpbC5zZXR0aW5ncy5tYXhEYXRlPXRoaXMuX2Zvcm1hdERhdGUobCxtKTt0aGlzLl9hdHRhY2htZW50cyhhKGIpLGwpO3RoaXMuX2F1dG9TaXplKGwpO3RoaXMuX3NldERhdGUobCxuKTt0aGlzLl91cGRhdGVBbHRlcm5hdGUobCk7XG50aGlzLl91cGRhdGVEYXRlcGlja2VyKGwpfX0sX2NoYW5nZURhdGVwaWNrZXI6ZnVuY3Rpb24oYixmLGope3RoaXMuX29wdGlvbkRhdGVwaWNrZXIoYixmLGopfSxfcmVmcmVzaERhdGVwaWNrZXI6ZnVuY3Rpb24oYil7KGI9dGhpcy5fZ2V0SW5zdChiKSkmJnRoaXMuX3VwZGF0ZURhdGVwaWNrZXIoYil9LF9zZXREYXRlRGF0ZXBpY2tlcjpmdW5jdGlvbihiLGYpe2lmKGI9dGhpcy5fZ2V0SW5zdChiKSl7dGhpcy5fc2V0RGF0ZShiLGYpO3RoaXMuX3VwZGF0ZURhdGVwaWNrZXIoYik7dGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGIpfX0sX2dldERhdGVEYXRlcGlja2VyOmZ1bmN0aW9uKGIsZil7KGI9dGhpcy5fZ2V0SW5zdChiKSkmJiFiLmlubGluZSYmdGhpcy5fc2V0RGF0ZUZyb21GaWVsZChiLGYpO3JldHVybiBiP3RoaXMuX2dldERhdGUoYik6bnVsbH0sX2RvS2V5RG93bjpmdW5jdGlvbihiKXt2YXIgZj1hLmRhdGVwaWNrZXIuX2dldEluc3QoYi50YXJnZXQpLGo9dHJ1ZSxsPWYuZHBEaXYuaXMoXCIudWktZGF0ZXBpY2tlci1ydGxcIik7XG5mLl9rZXlFdmVudD10cnVlO2lmKGEuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcpc3dpdGNoKGIua2V5Q29kZSl7Y2FzZSA5OmEuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKTtqPWZhbHNlO2JyZWFrO2Nhc2UgMTM6aj1hKFwidGQuXCIrYS5kYXRlcGlja2VyLl9kYXlPdmVyQ2xhc3MrXCI6bm90KC5cIithLmRhdGVwaWNrZXIuX2N1cnJlbnRDbGFzcytcIilcIixmLmRwRGl2KTtqWzBdJiZhLmRhdGVwaWNrZXIuX3NlbGVjdERheShiLnRhcmdldCxmLnNlbGVjdGVkTW9udGgsZi5zZWxlY3RlZFllYXIsalswXSk7aWYoYj1hLmRhdGVwaWNrZXIuX2dldChmLFwib25TZWxlY3RcIikpe2o9YS5kYXRlcGlja2VyLl9mb3JtYXREYXRlKGYpO2IuYXBwbHkoZi5pbnB1dD9mLmlucHV0WzBdOm51bGwsW2osZl0pfWVsc2UgYS5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpO3JldHVybiBmYWxzZTtjYXNlIDI3OmEuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKTticmVhaztjYXNlIDMzOmEuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShiLnRhcmdldCxcbmIuY3RybEtleT8tYS5kYXRlcGlja2VyLl9nZXQoZixcInN0ZXBCaWdNb250aHNcIik6LWEuZGF0ZXBpY2tlci5fZ2V0KGYsXCJzdGVwTW9udGhzXCIpLFwiTVwiKTticmVhaztjYXNlIDM0OmEuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShiLnRhcmdldCxiLmN0cmxLZXk/K2EuZGF0ZXBpY2tlci5fZ2V0KGYsXCJzdGVwQmlnTW9udGhzXCIpOithLmRhdGVwaWNrZXIuX2dldChmLFwic3RlcE1vbnRoc1wiKSxcIk1cIik7YnJlYWs7Y2FzZSAzNTppZihiLmN0cmxLZXl8fGIubWV0YUtleSlhLmRhdGVwaWNrZXIuX2NsZWFyRGF0ZShiLnRhcmdldCk7aj1iLmN0cmxLZXl8fGIubWV0YUtleTticmVhaztjYXNlIDM2OmlmKGIuY3RybEtleXx8Yi5tZXRhS2V5KWEuZGF0ZXBpY2tlci5fZ290b1RvZGF5KGIudGFyZ2V0KTtqPWIuY3RybEtleXx8Yi5tZXRhS2V5O2JyZWFrO2Nhc2UgMzc6aWYoYi5jdHJsS2V5fHxiLm1ldGFLZXkpYS5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGIudGFyZ2V0LGw/KzE6LTEsXCJEXCIpO2o9XG5iLmN0cmxLZXl8fGIubWV0YUtleTtpZihiLm9yaWdpbmFsRXZlbnQuYWx0S2V5KWEuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShiLnRhcmdldCxiLmN0cmxLZXk/LWEuZGF0ZXBpY2tlci5fZ2V0KGYsXCJzdGVwQmlnTW9udGhzXCIpOi1hLmRhdGVwaWNrZXIuX2dldChmLFwic3RlcE1vbnRoc1wiKSxcIk1cIik7YnJlYWs7Y2FzZSAzODppZihiLmN0cmxLZXl8fGIubWV0YUtleSlhLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYi50YXJnZXQsLTcsXCJEXCIpO2o9Yi5jdHJsS2V5fHxiLm1ldGFLZXk7YnJlYWs7Y2FzZSAzOTppZihiLmN0cmxLZXl8fGIubWV0YUtleSlhLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYi50YXJnZXQsbD8tMTorMSxcIkRcIik7aj1iLmN0cmxLZXl8fGIubWV0YUtleTtpZihiLm9yaWdpbmFsRXZlbnQuYWx0S2V5KWEuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShiLnRhcmdldCxiLmN0cmxLZXk/K2EuZGF0ZXBpY2tlci5fZ2V0KGYsXCJzdGVwQmlnTW9udGhzXCIpOithLmRhdGVwaWNrZXIuX2dldChmLFxuXCJzdGVwTW9udGhzXCIpLFwiTVwiKTticmVhaztjYXNlIDQwOmlmKGIuY3RybEtleXx8Yi5tZXRhS2V5KWEuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShiLnRhcmdldCwrNyxcIkRcIik7aj1iLmN0cmxLZXl8fGIubWV0YUtleTticmVhaztkZWZhdWx0Omo9ZmFsc2V9ZWxzZSBpZihiLmtleUNvZGU9PTM2JiZiLmN0cmxLZXkpYS5kYXRlcGlja2VyLl9zaG93RGF0ZXBpY2tlcih0aGlzKTtlbHNlIGo9ZmFsc2U7aWYoail7Yi5wcmV2ZW50RGVmYXVsdCgpO2Iuc3RvcFByb3BhZ2F0aW9uKCl9fSxfZG9LZXlQcmVzczpmdW5jdGlvbihiKXt2YXIgZj1hLmRhdGVwaWNrZXIuX2dldEluc3QoYi50YXJnZXQpO2lmKGEuZGF0ZXBpY2tlci5fZ2V0KGYsXCJjb25zdHJhaW5JbnB1dFwiKSl7Zj1hLmRhdGVwaWNrZXIuX3Bvc3NpYmxlQ2hhcnMoYS5kYXRlcGlja2VyLl9nZXQoZixcImRhdGVGb3JtYXRcIikpO3ZhciBqPVN0cmluZy5mcm9tQ2hhckNvZGUoYi5jaGFyQ29kZT09ZD9iLmtleUNvZGU6Yi5jaGFyQ29kZSk7XG5yZXR1cm4gYi5jdHJsS2V5fHxiLm1ldGFLZXl8fGo8XCIgXCJ8fCFmfHxmLmluZGV4T2Yoaik+LTF9fSxfZG9LZXlVcDpmdW5jdGlvbihiKXtiPWEuZGF0ZXBpY2tlci5fZ2V0SW5zdChiLnRhcmdldCk7aWYoYi5pbnB1dC52YWwoKSE9Yi5sYXN0VmFsKXRyeXtpZihhLmRhdGVwaWNrZXIucGFyc2VEYXRlKGEuZGF0ZXBpY2tlci5fZ2V0KGIsXCJkYXRlRm9ybWF0XCIpLGIuaW5wdXQ/Yi5pbnB1dC52YWwoKTpudWxsLGEuZGF0ZXBpY2tlci5fZ2V0Rm9ybWF0Q29uZmlnKGIpKSl7YS5kYXRlcGlja2VyLl9zZXREYXRlRnJvbUZpZWxkKGIpO2EuZGF0ZXBpY2tlci5fdXBkYXRlQWx0ZXJuYXRlKGIpO2EuZGF0ZXBpY2tlci5fdXBkYXRlRGF0ZXBpY2tlcihiKX19Y2F0Y2goZil7YS5kYXRlcGlja2VyLmxvZyhmKX1yZXR1cm4gdHJ1ZX0sX3Nob3dEYXRlcGlja2VyOmZ1bmN0aW9uKGIpe2I9Yi50YXJnZXR8fGI7aWYoYi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIT1cImlucHV0XCIpYj1hKFwiaW5wdXRcIixcbmIucGFyZW50Tm9kZSlbMF07aWYoIShhLmRhdGVwaWNrZXIuX2lzRGlzYWJsZWREYXRlcGlja2VyKGIpfHxhLmRhdGVwaWNrZXIuX2xhc3RJbnB1dD09Yikpe3ZhciBmPWEuZGF0ZXBpY2tlci5fZ2V0SW5zdChiKTtpZihhLmRhdGVwaWNrZXIuX2N1ckluc3QmJmEuZGF0ZXBpY2tlci5fY3VySW5zdCE9Zil7YS5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyYmYS5kYXRlcGlja2VyLl90cmlnZ2VyT25DbG9zZShhLmRhdGVwaWNrZXIuX2N1ckluc3QpO2EuZGF0ZXBpY2tlci5fY3VySW5zdC5kcERpdi5zdG9wKHRydWUsdHJ1ZSl9dmFyIGo9YS5kYXRlcGlja2VyLl9nZXQoZixcImJlZm9yZVNob3dcIik7aj1qP2ouYXBwbHkoYixbYixmXSk6e307aWYoaiE9PWZhbHNlKXtoKGYuc2V0dGluZ3Msaik7Zi5sYXN0VmFsPW51bGw7YS5kYXRlcGlja2VyLl9sYXN0SW5wdXQ9YjthLmRhdGVwaWNrZXIuX3NldERhdGVGcm9tRmllbGQoZik7aWYoYS5kYXRlcGlja2VyLl9pbkRpYWxvZyliLnZhbHVlPVxuXCJcIjtpZighYS5kYXRlcGlja2VyLl9wb3Mpe2EuZGF0ZXBpY2tlci5fcG9zPWEuZGF0ZXBpY2tlci5fZmluZFBvcyhiKTthLmRhdGVwaWNrZXIuX3Bvc1sxXSs9Yi5vZmZzZXRIZWlnaHR9dmFyIGw9ZmFsc2U7YShiKS5wYXJlbnRzKCkuZWFjaChmdW5jdGlvbigpe2x8PWEodGhpcykuY3NzKFwicG9zaXRpb25cIik9PVwiZml4ZWRcIjtyZXR1cm4hbH0pO2lmKGwmJmEuYnJvd3Nlci5vcGVyYSl7YS5kYXRlcGlja2VyLl9wb3NbMF0tPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0O2EuZGF0ZXBpY2tlci5fcG9zWzFdLT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wfWo9e2xlZnQ6YS5kYXRlcGlja2VyLl9wb3NbMF0sdG9wOmEuZGF0ZXBpY2tlci5fcG9zWzFdfTthLmRhdGVwaWNrZXIuX3Bvcz1udWxsO2YuZHBEaXYuZW1wdHkoKTtmLmRwRGl2LmNzcyh7cG9zaXRpb246XCJhYnNvbHV0ZVwiLGRpc3BsYXk6XCJibG9ja1wiLHRvcDpcIi0xMDAwcHhcIn0pO2EuZGF0ZXBpY2tlci5fdXBkYXRlRGF0ZXBpY2tlcihmKTtcbmo9YS5kYXRlcGlja2VyLl9jaGVja09mZnNldChmLGosbCk7Zi5kcERpdi5jc3Moe3Bvc2l0aW9uOmEuZGF0ZXBpY2tlci5faW5EaWFsb2cmJmEuYmxvY2tVST9cInN0YXRpY1wiOmw/XCJmaXhlZFwiOlwiYWJzb2x1dGVcIixkaXNwbGF5Olwibm9uZVwiLGxlZnQ6ai5sZWZ0K1wicHhcIix0b3A6ai50b3ArXCJweFwifSk7aWYoIWYuaW5saW5lKXtqPWEuZGF0ZXBpY2tlci5fZ2V0KGYsXCJzaG93QW5pbVwiKTt2YXIgbz1hLmRhdGVwaWNrZXIuX2dldChmLFwiZHVyYXRpb25cIiksbj1mdW5jdGlvbigpe3ZhciBrPWYuZHBEaXYuZmluZChcImlmcmFtZS51aS1kYXRlcGlja2VyLWNvdmVyXCIpO2lmKGsubGVuZ3RoKXt2YXIgbT1hLmRhdGVwaWNrZXIuX2dldEJvcmRlcnMoZi5kcERpdik7ay5jc3Moe2xlZnQ6LW1bMF0sdG9wOi1tWzFdLHdpZHRoOmYuZHBEaXYub3V0ZXJXaWR0aCgpLGhlaWdodDpmLmRwRGl2Lm91dGVySGVpZ2h0KCl9KX19O2YuZHBEaXYuekluZGV4KGEoYikuekluZGV4KCkrMSk7YS5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZz1cbnRydWU7YS5lZmZlY3RzJiZhLmVmZmVjdHNbal0/Zi5kcERpdi5zaG93KGosYS5kYXRlcGlja2VyLl9nZXQoZixcInNob3dPcHRpb25zXCIpLG8sbik6Zi5kcERpdltqfHxcInNob3dcIl0oaj9vOm51bGwsbik7aWYoIWp8fCFvKW4oKTtmLmlucHV0LmlzKFwiOnZpc2libGVcIikmJiFmLmlucHV0LmlzKFwiOmRpc2FibGVkXCIpJiZmLmlucHV0LmZvY3VzKCk7YS5kYXRlcGlja2VyLl9jdXJJbnN0PWZ9fX19LF91cGRhdGVEYXRlcGlja2VyOmZ1bmN0aW9uKGIpe3RoaXMubWF4Um93cz00O3ZhciBmPWEuZGF0ZXBpY2tlci5fZ2V0Qm9yZGVycyhiLmRwRGl2KTtpPWI7Yi5kcERpdi5lbXB0eSgpLmFwcGVuZCh0aGlzLl9nZW5lcmF0ZUhUTUwoYikpO3ZhciBqPWIuZHBEaXYuZmluZChcImlmcmFtZS51aS1kYXRlcGlja2VyLWNvdmVyXCIpO2oubGVuZ3RoJiZqLmNzcyh7bGVmdDotZlswXSx0b3A6LWZbMV0sd2lkdGg6Yi5kcERpdi5vdXRlcldpZHRoKCksaGVpZ2h0OmIuZHBEaXYub3V0ZXJIZWlnaHQoKX0pO1xuYi5kcERpdi5maW5kKFwiLlwiK3RoaXMuX2RheU92ZXJDbGFzcytcIiBhXCIpLm1vdXNlb3ZlcigpO2Y9dGhpcy5fZ2V0TnVtYmVyT2ZNb250aHMoYik7aj1mWzFdO2IuZHBEaXYucmVtb3ZlQ2xhc3MoXCJ1aS1kYXRlcGlja2VyLW11bHRpLTIgdWktZGF0ZXBpY2tlci1tdWx0aS0zIHVpLWRhdGVwaWNrZXItbXVsdGktNFwiKS53aWR0aChcIlwiKTtqPjEmJmIuZHBEaXYuYWRkQ2xhc3MoXCJ1aS1kYXRlcGlja2VyLW11bHRpLVwiK2opLmNzcyhcIndpZHRoXCIsMTcqaitcImVtXCIpO2IuZHBEaXZbKGZbMF0hPTF8fGZbMV0hPTE/XCJhZGRcIjpcInJlbW92ZVwiKStcIkNsYXNzXCJdKFwidWktZGF0ZXBpY2tlci1tdWx0aVwiKTtiLmRwRGl2Wyh0aGlzLl9nZXQoYixcImlzUlRMXCIpP1wiYWRkXCI6XCJyZW1vdmVcIikrXCJDbGFzc1wiXShcInVpLWRhdGVwaWNrZXItcnRsXCIpO2I9PWEuZGF0ZXBpY2tlci5fY3VySW5zdCYmYS5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyYmYi5pbnB1dCYmYi5pbnB1dC5pcyhcIjp2aXNpYmxlXCIpJiZcbiFiLmlucHV0LmlzKFwiOmRpc2FibGVkXCIpJiZiLmlucHV0WzBdIT1kb2N1bWVudC5hY3RpdmVFbGVtZW50JiZiLmlucHV0LmZvY3VzKCk7aWYoYi55ZWFyc2h0bWwpe3ZhciBsPWIueWVhcnNodG1sO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtsPT09Yi55ZWFyc2h0bWwmJmIueWVhcnNodG1sJiZiLmRwRGl2LmZpbmQoXCJzZWxlY3QudWktZGF0ZXBpY2tlci15ZWFyOmZpcnN0XCIpLnJlcGxhY2VXaXRoKGIueWVhcnNodG1sKTtsPWIueWVhcnNodG1sPW51bGx9LDApfX0sX2dldEJvcmRlcnM6ZnVuY3Rpb24oYil7dmFyIGY9ZnVuY3Rpb24oail7cmV0dXJue3RoaW46MSxtZWRpdW06Mix0aGljazozfVtqXXx8an07cmV0dXJuW3BhcnNlRmxvYXQoZihiLmNzcyhcImJvcmRlci1sZWZ0LXdpZHRoXCIpKSkscGFyc2VGbG9hdChmKGIuY3NzKFwiYm9yZGVyLXRvcC13aWR0aFwiKSkpXX0sX2NoZWNrT2Zmc2V0OmZ1bmN0aW9uKGIsZixqKXt2YXIgbD1iLmRwRGl2Lm91dGVyV2lkdGgoKSxvPWIuZHBEaXYub3V0ZXJIZWlnaHQoKSxcbm49Yi5pbnB1dD9iLmlucHV0Lm91dGVyV2lkdGgoKTowLGs9Yi5pbnB1dD9iLmlucHV0Lm91dGVySGVpZ2h0KCk6MCxtPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCthKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkscD1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0K2EoZG9jdW1lbnQpLnNjcm9sbFRvcCgpO2YubGVmdC09dGhpcy5fZ2V0KGIsXCJpc1JUTFwiKT9sLW46MDtmLmxlZnQtPWomJmYubGVmdD09Yi5pbnB1dC5vZmZzZXQoKS5sZWZ0P2EoZG9jdW1lbnQpLnNjcm9sbExlZnQoKTowO2YudG9wLT1qJiZmLnRvcD09Yi5pbnB1dC5vZmZzZXQoKS50b3Araz9hKGRvY3VtZW50KS5zY3JvbGxUb3AoKTowO2YubGVmdC09TWF0aC5taW4oZi5sZWZ0LGYubGVmdCtsPm0mJm0+bD9NYXRoLmFicyhmLmxlZnQrbC1tKTowKTtmLnRvcC09TWF0aC5taW4oZi50b3AsZi50b3Arbz5wJiZwPm8/TWF0aC5hYnMobytrKTowKTtyZXR1cm4gZn0sX2ZpbmRQb3M6ZnVuY3Rpb24oYil7Zm9yKHZhciBmPVxudGhpcy5fZ2V0KHRoaXMuX2dldEluc3QoYiksXCJpc1JUTFwiKTtiJiYoYi50eXBlPT1cImhpZGRlblwifHxiLm5vZGVUeXBlIT0xfHxhLmV4cHIuZmlsdGVycy5oaWRkZW4oYikpOyliPWJbZj9cInByZXZpb3VzU2libGluZ1wiOlwibmV4dFNpYmxpbmdcIl07Yj1hKGIpLm9mZnNldCgpO3JldHVybltiLmxlZnQsYi50b3BdfSxfdHJpZ2dlck9uQ2xvc2U6ZnVuY3Rpb24oYil7dmFyIGY9dGhpcy5fZ2V0KGIsXCJvbkNsb3NlXCIpO2lmKGYpZi5hcHBseShiLmlucHV0P2IuaW5wdXRbMF06bnVsbCxbYi5pbnB1dD9iLmlucHV0LnZhbCgpOlwiXCIsYl0pfSxfaGlkZURhdGVwaWNrZXI6ZnVuY3Rpb24oYil7dmFyIGY9dGhpcy5fY3VySW5zdDtpZighKCFmfHxiJiZmIT1hLmRhdGEoYixcImRhdGVwaWNrZXJcIikpKWlmKHRoaXMuX2RhdGVwaWNrZXJTaG93aW5nKXtiPXRoaXMuX2dldChmLFwic2hvd0FuaW1cIik7dmFyIGo9dGhpcy5fZ2V0KGYsXCJkdXJhdGlvblwiKSxsPWZ1bmN0aW9uKCl7YS5kYXRlcGlja2VyLl90aWR5RGlhbG9nKGYpO1xudGhpcy5fY3VySW5zdD1udWxsfTthLmVmZmVjdHMmJmEuZWZmZWN0c1tiXT9mLmRwRGl2LmhpZGUoYixhLmRhdGVwaWNrZXIuX2dldChmLFwic2hvd09wdGlvbnNcIiksaixsKTpmLmRwRGl2W2I9PVwic2xpZGVEb3duXCI/XCJzbGlkZVVwXCI6Yj09XCJmYWRlSW5cIj9cImZhZGVPdXRcIjpcImhpZGVcIl0oYj9qOm51bGwsbCk7Ynx8bCgpO2EuZGF0ZXBpY2tlci5fdHJpZ2dlck9uQ2xvc2UoZik7dGhpcy5fZGF0ZXBpY2tlclNob3dpbmc9ZmFsc2U7dGhpcy5fbGFzdElucHV0PW51bGw7aWYodGhpcy5faW5EaWFsb2cpe3RoaXMuX2RpYWxvZ0lucHV0LmNzcyh7cG9zaXRpb246XCJhYnNvbHV0ZVwiLGxlZnQ6XCIwXCIsdG9wOlwiLTEwMHB4XCJ9KTtpZihhLmJsb2NrVUkpe2EudW5ibG9ja1VJKCk7YShcImJvZHlcIikuYXBwZW5kKHRoaXMuZHBEaXYpfX10aGlzLl9pbkRpYWxvZz1mYWxzZX19LF90aWR5RGlhbG9nOmZ1bmN0aW9uKGIpe2IuZHBEaXYucmVtb3ZlQ2xhc3ModGhpcy5fZGlhbG9nQ2xhc3MpLnVuYmluZChcIi51aS1kYXRlcGlja2VyLWNhbGVuZGFyXCIpfSxcbl9jaGVja0V4dGVybmFsQ2xpY2s6ZnVuY3Rpb24oYil7aWYoYS5kYXRlcGlja2VyLl9jdXJJbnN0KXtiPWEoYi50YXJnZXQpO2JbMF0uaWQhPWEuZGF0ZXBpY2tlci5fbWFpbkRpdklkJiZiLnBhcmVudHMoXCIjXCIrYS5kYXRlcGlja2VyLl9tYWluRGl2SWQpLmxlbmd0aD09MCYmIWIuaGFzQ2xhc3MoYS5kYXRlcGlja2VyLm1hcmtlckNsYXNzTmFtZSkmJiFiLmhhc0NsYXNzKGEuZGF0ZXBpY2tlci5fdHJpZ2dlckNsYXNzKSYmYS5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyYmIShhLmRhdGVwaWNrZXIuX2luRGlhbG9nJiZhLmJsb2NrVUkpJiZhLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCl9fSxfYWRqdXN0RGF0ZTpmdW5jdGlvbihiLGYsail7Yj1hKGIpO3ZhciBsPXRoaXMuX2dldEluc3QoYlswXSk7aWYoIXRoaXMuX2lzRGlzYWJsZWREYXRlcGlja2VyKGJbMF0pKXt0aGlzLl9hZGp1c3RJbnN0RGF0ZShsLGYrKGo9PVwiTVwiP3RoaXMuX2dldChsLFwic2hvd0N1cnJlbnRBdFBvc1wiKTpcbjApLGopO3RoaXMuX3VwZGF0ZURhdGVwaWNrZXIobCl9fSxfZ290b1RvZGF5OmZ1bmN0aW9uKGIpe2I9YShiKTt2YXIgZj10aGlzLl9nZXRJbnN0KGJbMF0pO2lmKHRoaXMuX2dldChmLFwiZ290b0N1cnJlbnRcIikmJmYuY3VycmVudERheSl7Zi5zZWxlY3RlZERheT1mLmN1cnJlbnREYXk7Zi5kcmF3TW9udGg9Zi5zZWxlY3RlZE1vbnRoPWYuY3VycmVudE1vbnRoO2YuZHJhd1llYXI9Zi5zZWxlY3RlZFllYXI9Zi5jdXJyZW50WWVhcn1lbHNle3ZhciBqPW5ldyBEYXRlO2Yuc2VsZWN0ZWREYXk9ai5nZXREYXRlKCk7Zi5kcmF3TW9udGg9Zi5zZWxlY3RlZE1vbnRoPWouZ2V0TW9udGgoKTtmLmRyYXdZZWFyPWYuc2VsZWN0ZWRZZWFyPWouZ2V0RnVsbFllYXIoKX10aGlzLl9ub3RpZnlDaGFuZ2UoZik7dGhpcy5fYWRqdXN0RGF0ZShiKX0sX3NlbGVjdE1vbnRoWWVhcjpmdW5jdGlvbihiLGYsail7Yj1hKGIpO3ZhciBsPXRoaXMuX2dldEluc3QoYlswXSk7bFtcInNlbGVjdGVkXCIrKGo9PVwiTVwiP1xuXCJNb250aFwiOlwiWWVhclwiKV09bFtcImRyYXdcIisoaj09XCJNXCI/XCJNb250aFwiOlwiWWVhclwiKV09cGFyc2VJbnQoZi5vcHRpb25zW2Yuc2VsZWN0ZWRJbmRleF0udmFsdWUsMTApO3RoaXMuX25vdGlmeUNoYW5nZShsKTt0aGlzLl9hZGp1c3REYXRlKGIpfSxfc2VsZWN0RGF5OmZ1bmN0aW9uKGIsZixqLGwpe3ZhciBvPWEoYik7aWYoIShhKGwpLmhhc0NsYXNzKHRoaXMuX3Vuc2VsZWN0YWJsZUNsYXNzKXx8dGhpcy5faXNEaXNhYmxlZERhdGVwaWNrZXIob1swXSkpKXtvPXRoaXMuX2dldEluc3Qob1swXSk7by5zZWxlY3RlZERheT1vLmN1cnJlbnREYXk9YShcImFcIixsKS5odG1sKCk7by5zZWxlY3RlZE1vbnRoPW8uY3VycmVudE1vbnRoPWY7by5zZWxlY3RlZFllYXI9by5jdXJyZW50WWVhcj1qO3RoaXMuX3NlbGVjdERhdGUoYix0aGlzLl9mb3JtYXREYXRlKG8sby5jdXJyZW50RGF5LG8uY3VycmVudE1vbnRoLG8uY3VycmVudFllYXIpKX19LF9jbGVhckRhdGU6ZnVuY3Rpb24oYil7Yj1hKGIpO1xudGhpcy5fZ2V0SW5zdChiWzBdKTt0aGlzLl9zZWxlY3REYXRlKGIsXCJcIil9LF9zZWxlY3REYXRlOmZ1bmN0aW9uKGIsZil7Yj10aGlzLl9nZXRJbnN0KGEoYilbMF0pO2Y9ZiE9bnVsbD9mOnRoaXMuX2Zvcm1hdERhdGUoYik7Yi5pbnB1dCYmYi5pbnB1dC52YWwoZik7dGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGIpO3ZhciBqPXRoaXMuX2dldChiLFwib25TZWxlY3RcIik7aWYoailqLmFwcGx5KGIuaW5wdXQ/Yi5pbnB1dFswXTpudWxsLFtmLGJdKTtlbHNlIGIuaW5wdXQmJmIuaW5wdXQudHJpZ2dlcihcImNoYW5nZVwiKTtpZihiLmlubGluZSl0aGlzLl91cGRhdGVEYXRlcGlja2VyKGIpO2Vsc2V7dGhpcy5faGlkZURhdGVwaWNrZXIoKTt0aGlzLl9sYXN0SW5wdXQ9Yi5pbnB1dFswXTt0eXBlb2YgYi5pbnB1dFswXSE9XCJvYmplY3RcIiYmYi5pbnB1dC5mb2N1cygpO3RoaXMuX2xhc3RJbnB1dD1udWxsfX0sX3VwZGF0ZUFsdGVybmF0ZTpmdW5jdGlvbihiKXt2YXIgZj10aGlzLl9nZXQoYixcImFsdEZpZWxkXCIpO1xuaWYoZil7dmFyIGo9dGhpcy5fZ2V0KGIsXCJhbHRGb3JtYXRcIil8fHRoaXMuX2dldChiLFwiZGF0ZUZvcm1hdFwiKSxsPXRoaXMuX2dldERhdGUoYiksbz10aGlzLmZvcm1hdERhdGUoaixsLHRoaXMuX2dldEZvcm1hdENvbmZpZyhiKSk7YShmKS5lYWNoKGZ1bmN0aW9uKCl7YSh0aGlzKS52YWwobyl9KX19LG5vV2Vla2VuZHM6ZnVuY3Rpb24oYil7Yj1iLmdldERheSgpO3JldHVybltiPjAmJmI8NixcIlwiXX0saXNvODYwMVdlZWs6ZnVuY3Rpb24oYil7Yj1uZXcgRGF0ZShiLmdldFRpbWUoKSk7Yi5zZXREYXRlKGIuZ2V0RGF0ZSgpKzQtKGIuZ2V0RGF5KCl8fDcpKTt2YXIgZj1iLmdldFRpbWUoKTtiLnNldE1vbnRoKDApO2Iuc2V0RGF0ZSgxKTtyZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJvdW5kKChmLWIpLzg2NEU1KS83KSsxfSxwYXJzZURhdGU6ZnVuY3Rpb24oYixmLGope2lmKGI9PW51bGx8fGY9PW51bGwpdGhyb3dcIkludmFsaWQgYXJndW1lbnRzXCI7Zj10eXBlb2YgZj09XCJvYmplY3RcIj9cbmYudG9TdHJpbmcoKTpmK1wiXCI7aWYoZj09XCJcIilyZXR1cm4gbnVsbDt2YXIgbD0oaj9qLnNob3J0WWVhckN1dG9mZjpudWxsKXx8dGhpcy5fZGVmYXVsdHMuc2hvcnRZZWFyQ3V0b2ZmO2w9dHlwZW9mIGwhPVwic3RyaW5nXCI/bDoobmV3IERhdGUpLmdldEZ1bGxZZWFyKCklMTAwK3BhcnNlSW50KGwsMTApO2Zvcih2YXIgbz0oaj9qLmRheU5hbWVzU2hvcnQ6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzU2hvcnQsbj0oaj9qLmRheU5hbWVzOm51bGwpfHx0aGlzLl9kZWZhdWx0cy5kYXlOYW1lcyxrPShqP2oubW9udGhOYW1lc1Nob3J0Om51bGwpfHx0aGlzLl9kZWZhdWx0cy5tb250aE5hbWVzU2hvcnQsbT0oaj9qLm1vbnRoTmFtZXM6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLm1vbnRoTmFtZXMscD1qPS0xLHE9LTEscz0tMSxyPWZhbHNlLHU9ZnVuY3Rpb24oeil7KHo9SCsxPGIubGVuZ3RoJiZiLmNoYXJBdChIKzEpPT16KSYmSCsrO3JldHVybiB6fSx2PWZ1bmN0aW9uKHope3ZhciBJPVxudSh6KTt6PW5ldyBSZWdFeHAoXCJeXFxcXGR7MSxcIisoej09XCJAXCI/MTQ6ej09XCIhXCI/MjA6ej09XCJ5XCImJkk/NDp6PT1cIm9cIj8zOjIpK1wifVwiKTt6PWYuc3Vic3RyaW5nKHkpLm1hdGNoKHopO2lmKCF6KXRocm93XCJNaXNzaW5nIG51bWJlciBhdCBwb3NpdGlvbiBcIit5O3krPXpbMF0ubGVuZ3RoO3JldHVybiBwYXJzZUludCh6WzBdLDEwKX0sdz1mdW5jdGlvbih6LEksTil7ej1hLm1hcCh1KHopP046SSxmdW5jdGlvbihELEUpe3JldHVybltbRSxEXV19KS5zb3J0KGZ1bmN0aW9uKEQsRSl7cmV0dXJuLShEWzFdLmxlbmd0aC1FWzFdLmxlbmd0aCl9KTt2YXIgSj0tMTthLmVhY2goeixmdW5jdGlvbihELEUpe0Q9RVsxXTtpZihmLnN1YnN0cih5LEQubGVuZ3RoKS50b0xvd2VyQ2FzZSgpPT1ELnRvTG93ZXJDYXNlKCkpe0o9RVswXTt5Kz1ELmxlbmd0aDtyZXR1cm4gZmFsc2V9fSk7aWYoSiE9LTEpcmV0dXJuIEorMTtlbHNlIHRocm93XCJVbmtub3duIG5hbWUgYXQgcG9zaXRpb24gXCIreTt9LHg9XG5mdW5jdGlvbigpe2lmKGYuY2hhckF0KHkpIT1iLmNoYXJBdChIKSl0aHJvd1wiVW5leHBlY3RlZCBsaXRlcmFsIGF0IHBvc2l0aW9uIFwiK3k7eSsrfSx5PTAsSD0wO0g8Yi5sZW5ndGg7SCsrKWlmKHIpaWYoYi5jaGFyQXQoSCk9PVwiJ1wiJiYhdShcIidcIikpcj1mYWxzZTtlbHNlIHgoKTtlbHNlIHN3aXRjaChiLmNoYXJBdChIKSl7Y2FzZSBcImRcIjpxPXYoXCJkXCIpO2JyZWFrO2Nhc2UgXCJEXCI6dyhcIkRcIixvLG4pO2JyZWFrO2Nhc2UgXCJvXCI6cz12KFwib1wiKTticmVhaztjYXNlIFwibVwiOnA9dihcIm1cIik7YnJlYWs7Y2FzZSBcIk1cIjpwPXcoXCJNXCIsayxtKTticmVhaztjYXNlIFwieVwiOmo9dihcInlcIik7YnJlYWs7Y2FzZSBcIkBcIjp2YXIgQz1uZXcgRGF0ZSh2KFwiQFwiKSk7aj1DLmdldEZ1bGxZZWFyKCk7cD1DLmdldE1vbnRoKCkrMTtxPUMuZ2V0RGF0ZSgpO2JyZWFrO2Nhc2UgXCIhXCI6Qz1uZXcgRGF0ZSgodihcIiFcIiktdGhpcy5fdGlja3NUbzE5NzApLzFFNCk7aj1DLmdldEZ1bGxZZWFyKCk7cD1DLmdldE1vbnRoKCkrXG4xO3E9Qy5nZXREYXRlKCk7YnJlYWs7Y2FzZSBcIidcIjppZih1KFwiJ1wiKSl4KCk7ZWxzZSByPXRydWU7YnJlYWs7ZGVmYXVsdDp4KCl9aWYoeTxmLmxlbmd0aCl0aHJvd1wiRXh0cmEvdW5wYXJzZWQgY2hhcmFjdGVycyBmb3VuZCBpbiBkYXRlOiBcIitmLnN1YnN0cmluZyh5KTtpZihqPT0tMSlqPShuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKTtlbHNlIGlmKGo8MTAwKWorPShuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKS0obmV3IERhdGUpLmdldEZ1bGxZZWFyKCklMTAwKyhqPD1sPzA6LTEwMCk7aWYocz4tMSl7cD0xO3E9cztkb3tsPXRoaXMuX2dldERheXNJbk1vbnRoKGoscC0xKTtpZihxPD1sKWJyZWFrO3ArKztxLT1sfXdoaWxlKDEpfUM9dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoaixwLTEscSkpO2lmKEMuZ2V0RnVsbFllYXIoKSE9anx8Qy5nZXRNb250aCgpKzEhPXB8fEMuZ2V0RGF0ZSgpIT1xKXRocm93XCJJbnZhbGlkIGRhdGVcIjtyZXR1cm4gQ30sQVRPTTpcInl5LW1tLWRkXCIsXG5DT09LSUU6XCJELCBkZCBNIHl5XCIsSVNPXzg2MDE6XCJ5eS1tbS1kZFwiLFJGQ184MjI6XCJELCBkIE0geVwiLFJGQ184NTA6XCJERCwgZGQtTS15XCIsUkZDXzEwMzY6XCJELCBkIE0geVwiLFJGQ18xMTIzOlwiRCwgZCBNIHl5XCIsUkZDXzI4MjI6XCJELCBkIE0geXlcIixSU1M6XCJELCBkIE0geVwiLFRJQ0tTOlwiIVwiLFRJTUVTVEFNUDpcIkBcIixXM0M6XCJ5eS1tbS1kZFwiLF90aWNrc1RvMTk3MDooNzE4Njg1K01hdGguZmxvb3IoNDkyLjUpLU1hdGguZmxvb3IoMTkuNykrTWF0aC5mbG9vcig0LjkyNSkpKjI0KjYwKjYwKjFFNyxmb3JtYXREYXRlOmZ1bmN0aW9uKGIsZixqKXtpZighZilyZXR1cm5cIlwiO3ZhciBsPShqP2ouZGF5TmFtZXNTaG9ydDpudWxsKXx8dGhpcy5fZGVmYXVsdHMuZGF5TmFtZXNTaG9ydCxvPShqP2ouZGF5TmFtZXM6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzLG49KGo/ai5tb250aE5hbWVzU2hvcnQ6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLm1vbnRoTmFtZXNTaG9ydDtqPShqP2oubW9udGhOYW1lczpcbm51bGwpfHx0aGlzLl9kZWZhdWx0cy5tb250aE5hbWVzO3ZhciBrPWZ1bmN0aW9uKHUpeyh1PXIrMTxiLmxlbmd0aCYmYi5jaGFyQXQocisxKT09dSkmJnIrKztyZXR1cm4gdX0sbT1mdW5jdGlvbih1LHYsdyl7dj1cIlwiK3Y7aWYoayh1KSlmb3IoO3YubGVuZ3RoPHc7KXY9XCIwXCIrdjtyZXR1cm4gdn0scD1mdW5jdGlvbih1LHYsdyx4KXtyZXR1cm4gayh1KT94W3ZdOndbdl19LHE9XCJcIixzPWZhbHNlO2lmKGYpZm9yKHZhciByPTA7cjxiLmxlbmd0aDtyKyspaWYocylpZihiLmNoYXJBdChyKT09XCInXCImJiFrKFwiJ1wiKSlzPWZhbHNlO2Vsc2UgcSs9Yi5jaGFyQXQocik7ZWxzZSBzd2l0Y2goYi5jaGFyQXQocikpe2Nhc2UgXCJkXCI6cSs9bShcImRcIixmLmdldERhdGUoKSwyKTticmVhaztjYXNlIFwiRFwiOnErPXAoXCJEXCIsZi5nZXREYXkoKSxsLG8pO2JyZWFrO2Nhc2UgXCJvXCI6cSs9bShcIm9cIixNYXRoLnJvdW5kKCgobmV3IERhdGUoZi5nZXRGdWxsWWVhcigpLGYuZ2V0TW9udGgoKSxmLmdldERhdGUoKSkpLmdldFRpbWUoKS1cbihuZXcgRGF0ZShmLmdldEZ1bGxZZWFyKCksMCwwKSkuZ2V0VGltZSgpKS84NjRFNSksMyk7YnJlYWs7Y2FzZSBcIm1cIjpxKz1tKFwibVwiLGYuZ2V0TW9udGgoKSsxLDIpO2JyZWFrO2Nhc2UgXCJNXCI6cSs9cChcIk1cIixmLmdldE1vbnRoKCksbixqKTticmVhaztjYXNlIFwieVwiOnErPWsoXCJ5XCIpP2YuZ2V0RnVsbFllYXIoKTooZi5nZXRZZWFyKCklMTAwPDEwP1wiMFwiOlwiXCIpK2YuZ2V0WWVhcigpJTEwMDticmVhaztjYXNlIFwiQFwiOnErPWYuZ2V0VGltZSgpO2JyZWFrO2Nhc2UgXCIhXCI6cSs9Zi5nZXRUaW1lKCkqMUU0K3RoaXMuX3RpY2tzVG8xOTcwO2JyZWFrO2Nhc2UgXCInXCI6aWYoayhcIidcIikpcSs9XCInXCI7ZWxzZSBzPXRydWU7YnJlYWs7ZGVmYXVsdDpxKz1iLmNoYXJBdChyKX1yZXR1cm4gcX0sX3Bvc3NpYmxlQ2hhcnM6ZnVuY3Rpb24oYil7Zm9yKHZhciBmPVwiXCIsaj1mYWxzZSxsPWZ1bmN0aW9uKG4peyhuPW8rMTxiLmxlbmd0aCYmYi5jaGFyQXQobysxKT09bikmJm8rKztyZXR1cm4gbn0sbz1cbjA7bzxiLmxlbmd0aDtvKyspaWYoailpZihiLmNoYXJBdChvKT09XCInXCImJiFsKFwiJ1wiKSlqPWZhbHNlO2Vsc2UgZis9Yi5jaGFyQXQobyk7ZWxzZSBzd2l0Y2goYi5jaGFyQXQobykpe2Nhc2UgXCJkXCI6Y2FzZSBcIm1cIjpjYXNlIFwieVwiOmNhc2UgXCJAXCI6Zis9XCIwMTIzNDU2Nzg5XCI7YnJlYWs7Y2FzZSBcIkRcIjpjYXNlIFwiTVwiOnJldHVybiBudWxsO2Nhc2UgXCInXCI6aWYobChcIidcIikpZis9XCInXCI7ZWxzZSBqPXRydWU7YnJlYWs7ZGVmYXVsdDpmKz1iLmNoYXJBdChvKX1yZXR1cm4gZn0sX2dldDpmdW5jdGlvbihiLGYpe3JldHVybiBiLnNldHRpbmdzW2ZdIT09ZD9iLnNldHRpbmdzW2ZdOnRoaXMuX2RlZmF1bHRzW2ZdfSxfc2V0RGF0ZUZyb21GaWVsZDpmdW5jdGlvbihiLGYpe2lmKGIuaW5wdXQudmFsKCkhPWIubGFzdFZhbCl7dmFyIGo9dGhpcy5fZ2V0KGIsXCJkYXRlRm9ybWF0XCIpLGw9Yi5sYXN0VmFsPWIuaW5wdXQ/Yi5pbnB1dC52YWwoKTpudWxsLG8sbjtvPW49dGhpcy5fZ2V0RGVmYXVsdERhdGUoYik7XG52YXIgaz10aGlzLl9nZXRGb3JtYXRDb25maWcoYik7dHJ5e289dGhpcy5wYXJzZURhdGUoaixsLGspfHxufWNhdGNoKG0pe3RoaXMubG9nKG0pO2w9Zj9cIlwiOmx9Yi5zZWxlY3RlZERheT1vLmdldERhdGUoKTtiLmRyYXdNb250aD1iLnNlbGVjdGVkTW9udGg9by5nZXRNb250aCgpO2IuZHJhd1llYXI9Yi5zZWxlY3RlZFllYXI9by5nZXRGdWxsWWVhcigpO2IuY3VycmVudERheT1sP28uZ2V0RGF0ZSgpOjA7Yi5jdXJyZW50TW9udGg9bD9vLmdldE1vbnRoKCk6MDtiLmN1cnJlbnRZZWFyPWw/by5nZXRGdWxsWWVhcigpOjA7dGhpcy5fYWRqdXN0SW5zdERhdGUoYil9fSxfZ2V0RGVmYXVsdERhdGU6ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMuX3Jlc3RyaWN0TWluTWF4KGIsdGhpcy5fZGV0ZXJtaW5lRGF0ZShiLHRoaXMuX2dldChiLFwiZGVmYXVsdERhdGVcIiksbmV3IERhdGUpKX0sX2RldGVybWluZURhdGU6ZnVuY3Rpb24oYixmLGope3ZhciBsPWZ1bmN0aW9uKG4pe3ZhciBrPW5ldyBEYXRlO1xuay5zZXREYXRlKGsuZ2V0RGF0ZSgpK24pO3JldHVybiBrfSxvPWZ1bmN0aW9uKG4pe3RyeXtyZXR1cm4gYS5kYXRlcGlja2VyLnBhcnNlRGF0ZShhLmRhdGVwaWNrZXIuX2dldChiLFwiZGF0ZUZvcm1hdFwiKSxuLGEuZGF0ZXBpY2tlci5fZ2V0Rm9ybWF0Q29uZmlnKGIpKX1jYXRjaChrKXt9dmFyIG09KG4udG9Mb3dlckNhc2UoKS5tYXRjaCgvXmMvKT9hLmRhdGVwaWNrZXIuX2dldERhdGUoYik6bnVsbCl8fG5ldyBEYXRlLHA9bS5nZXRGdWxsWWVhcigpLHE9bS5nZXRNb250aCgpO209bS5nZXREYXRlKCk7Zm9yKHZhciBzPS8oWystXT9bMC05XSspXFxzKihkfER8d3xXfG18TXx5fFkpPy9nLHI9cy5leGVjKG4pO3I7KXtzd2l0Y2goclsyXXx8XCJkXCIpe2Nhc2UgXCJkXCI6Y2FzZSBcIkRcIjptKz1wYXJzZUludChyWzFdLDEwKTticmVhaztjYXNlIFwid1wiOmNhc2UgXCJXXCI6bSs9cGFyc2VJbnQoclsxXSwxMCkqNzticmVhaztjYXNlIFwibVwiOmNhc2UgXCJNXCI6cSs9cGFyc2VJbnQoclsxXSwxMCk7bT1cbk1hdGgubWluKG0sYS5kYXRlcGlja2VyLl9nZXREYXlzSW5Nb250aChwLHEpKTticmVhaztjYXNlIFwieVwiOmNhc2UgXCJZXCI6cCs9cGFyc2VJbnQoclsxXSwxMCk7bT1NYXRoLm1pbihtLGEuZGF0ZXBpY2tlci5fZ2V0RGF5c0luTW9udGgocCxxKSk7YnJlYWt9cj1zLmV4ZWMobil9cmV0dXJuIG5ldyBEYXRlKHAscSxtKX07aWYoZj0oZj1mPT1udWxsfHxmPT09XCJcIj9qOnR5cGVvZiBmPT1cInN0cmluZ1wiP28oZik6dHlwZW9mIGY9PVwibnVtYmVyXCI/aXNOYU4oZik/ajpsKGYpOm5ldyBEYXRlKGYuZ2V0VGltZSgpKSkmJmYudG9TdHJpbmcoKT09XCJJbnZhbGlkIERhdGVcIj9qOmYpe2Yuc2V0SG91cnMoMCk7Zi5zZXRNaW51dGVzKDApO2Yuc2V0U2Vjb25kcygwKTtmLnNldE1pbGxpc2Vjb25kcygwKX1yZXR1cm4gdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QoZil9LF9kYXlsaWdodFNhdmluZ0FkanVzdDpmdW5jdGlvbihiKXtpZighYilyZXR1cm4gbnVsbDtiLnNldEhvdXJzKGIuZ2V0SG91cnMoKT5cbjEyP2IuZ2V0SG91cnMoKSsyOjApO3JldHVybiBifSxfc2V0RGF0ZTpmdW5jdGlvbihiLGYsail7dmFyIGw9IWYsbz1iLnNlbGVjdGVkTW9udGgsbj1iLnNlbGVjdGVkWWVhcjtmPXRoaXMuX3Jlc3RyaWN0TWluTWF4KGIsdGhpcy5fZGV0ZXJtaW5lRGF0ZShiLGYsbmV3IERhdGUpKTtiLnNlbGVjdGVkRGF5PWIuY3VycmVudERheT1mLmdldERhdGUoKTtiLmRyYXdNb250aD1iLnNlbGVjdGVkTW9udGg9Yi5jdXJyZW50TW9udGg9Zi5nZXRNb250aCgpO2IuZHJhd1llYXI9Yi5zZWxlY3RlZFllYXI9Yi5jdXJyZW50WWVhcj1mLmdldEZ1bGxZZWFyKCk7aWYoKG8hPWIuc2VsZWN0ZWRNb250aHx8biE9Yi5zZWxlY3RlZFllYXIpJiYhail0aGlzLl9ub3RpZnlDaGFuZ2UoYik7dGhpcy5fYWRqdXN0SW5zdERhdGUoYik7aWYoYi5pbnB1dCliLmlucHV0LnZhbChsP1wiXCI6dGhpcy5fZm9ybWF0RGF0ZShiKSl9LF9nZXREYXRlOmZ1bmN0aW9uKGIpe3JldHVybiFiLmN1cnJlbnRZZWFyfHxiLmlucHV0JiZcbmIuaW5wdXQudmFsKCk9PVwiXCI/bnVsbDp0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShiLmN1cnJlbnRZZWFyLGIuY3VycmVudE1vbnRoLGIuY3VycmVudERheSkpfSxfZ2VuZXJhdGVIVE1MOmZ1bmN0aW9uKGIpe3ZhciBmPW5ldyBEYXRlO2Y9dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoZi5nZXRGdWxsWWVhcigpLGYuZ2V0TW9udGgoKSxmLmdldERhdGUoKSkpO3ZhciBqPXRoaXMuX2dldChiLFwiaXNSVExcIiksbD10aGlzLl9nZXQoYixcInNob3dCdXR0b25QYW5lbFwiKSxvPXRoaXMuX2dldChiLFwiaGlkZUlmTm9QcmV2TmV4dFwiKSxuPXRoaXMuX2dldChiLFwibmF2aWdhdGlvbkFzRGF0ZUZvcm1hdFwiKSxrPXRoaXMuX2dldE51bWJlck9mTW9udGhzKGIpLG09dGhpcy5fZ2V0KGIsXCJzaG93Q3VycmVudEF0UG9zXCIpLHA9dGhpcy5fZ2V0KGIsXCJzdGVwTW9udGhzXCIpLHE9a1swXSE9MXx8a1sxXSE9MSxzPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KCFiLmN1cnJlbnREYXk/XG5uZXcgRGF0ZSg5OTk5LDksOSk6bmV3IERhdGUoYi5jdXJyZW50WWVhcixiLmN1cnJlbnRNb250aCxiLmN1cnJlbnREYXkpKSxyPXRoaXMuX2dldE1pbk1heERhdGUoYixcIm1pblwiKSx1PXRoaXMuX2dldE1pbk1heERhdGUoYixcIm1heFwiKTttPWIuZHJhd01vbnRoLW07dmFyIHY9Yi5kcmF3WWVhcjtpZihtPDApe20rPTEyO3YtLX1pZih1KXt2YXIgdz10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZSh1LmdldEZ1bGxZZWFyKCksdS5nZXRNb250aCgpLWtbMF0qa1sxXSsxLHUuZ2V0RGF0ZSgpKSk7Zm9yKHc9ciYmdzxyP3I6dzt0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZSh2LG0sMSkpPnc7KXttLS07aWYobTwwKXttPTExO3YtLX19fWIuZHJhd01vbnRoPW07Yi5kcmF3WWVhcj12O3c9dGhpcy5fZ2V0KGIsXCJwcmV2VGV4dFwiKTt3PSFuP3c6dGhpcy5mb3JtYXREYXRlKHcsdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUodixtLXAsMSkpLHRoaXMuX2dldEZvcm1hdENvbmZpZyhiKSk7XG53PXRoaXMuX2NhbkFkanVzdE1vbnRoKGIsLTEsdixtKT8nPGEgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLXByZXYgdWktY29ybmVyLWFsbFwiIG9uY2xpY2s9XCJEUF9qUXVlcnlfJytnK1wiLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoJyNcIitiLmlkK1wiJywgLVwiK3ArXCIsICdNJyk7XFxcIiB0aXRsZT1cXFwiXCIrdysnXCI+PHNwYW4gY2xhc3M9XCJ1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLScrKGo/XCJlXCI6XCJ3XCIpKydcIj4nK3crXCI8L3NwYW4+PC9hPlwiOm8/XCJcIjonPGEgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLXByZXYgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1kaXNhYmxlZFwiIHRpdGxlPVwiJyt3KydcIj48c3BhbiBjbGFzcz1cInVpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtJysoaj9cImVcIjpcIndcIikrJ1wiPicrdytcIjwvc3Bhbj48L2E+XCI7dmFyIHg9dGhpcy5fZ2V0KGIsXCJuZXh0VGV4dFwiKTt4PSFuP3g6dGhpcy5mb3JtYXREYXRlKHgsdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUodixcbm0rcCwxKSksdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGIpKTtvPXRoaXMuX2NhbkFkanVzdE1vbnRoKGIsKzEsdixtKT8nPGEgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLW5leHQgdWktY29ybmVyLWFsbFwiIG9uY2xpY2s9XCJEUF9qUXVlcnlfJytnK1wiLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoJyNcIitiLmlkK1wiJywgK1wiK3ArXCIsICdNJyk7XFxcIiB0aXRsZT1cXFwiXCIreCsnXCI+PHNwYW4gY2xhc3M9XCJ1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLScrKGo/XCJ3XCI6XCJlXCIpKydcIj4nK3grXCI8L3NwYW4+PC9hPlwiOm8/XCJcIjonPGEgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLW5leHQgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1kaXNhYmxlZFwiIHRpdGxlPVwiJyt4KydcIj48c3BhbiBjbGFzcz1cInVpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtJysoaj9cIndcIjpcImVcIikrJ1wiPicreCtcIjwvc3Bhbj48L2E+XCI7cD10aGlzLl9nZXQoYixcImN1cnJlbnRUZXh0XCIpO3g9dGhpcy5fZ2V0KGIsXCJnb3RvQ3VycmVudFwiKSYmXG5iLmN1cnJlbnREYXk/czpmO3A9IW4/cDp0aGlzLmZvcm1hdERhdGUocCx4LHRoaXMuX2dldEZvcm1hdENvbmZpZyhiKSk7bj0hYi5pbmxpbmU/JzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwidWktZGF0ZXBpY2tlci1jbG9zZSB1aS1zdGF0ZS1kZWZhdWx0IHVpLXByaW9yaXR5LXByaW1hcnkgdWktY29ybmVyLWFsbFwiIG9uY2xpY2s9XCJEUF9qUXVlcnlfJytnKycuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKTtcIj4nK3RoaXMuX2dldChiLFwiY2xvc2VUZXh0XCIpK1wiPC9idXR0b24+XCI6XCJcIjtsPWw/JzxkaXYgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLWJ1dHRvbnBhbmUgdWktd2lkZ2V0LWNvbnRlbnRcIj4nKyhqP246XCJcIikrKHRoaXMuX2lzSW5SYW5nZShiLHgpPyc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cInVpLWRhdGVwaWNrZXItY3VycmVudCB1aS1zdGF0ZS1kZWZhdWx0IHVpLXByaW9yaXR5LXNlY29uZGFyeSB1aS1jb3JuZXItYWxsXCIgb25jbGljaz1cIkRQX2pRdWVyeV8nK1xuZytcIi5kYXRlcGlja2VyLl9nb3RvVG9kYXkoJyNcIitiLmlkK1wiJyk7XFxcIj5cIitwK1wiPC9idXR0b24+XCI6XCJcIikrKGo/XCJcIjpuKStcIjwvZGl2PlwiOlwiXCI7bj1wYXJzZUludCh0aGlzLl9nZXQoYixcImZpcnN0RGF5XCIpLDEwKTtuPWlzTmFOKG4pPzA6bjtwPXRoaXMuX2dldChiLFwic2hvd1dlZWtcIik7eD10aGlzLl9nZXQoYixcImRheU5hbWVzXCIpO3RoaXMuX2dldChiLFwiZGF5TmFtZXNTaG9ydFwiKTt2YXIgeT10aGlzLl9nZXQoYixcImRheU5hbWVzTWluXCIpLEg9dGhpcy5fZ2V0KGIsXCJtb250aE5hbWVzXCIpLEM9dGhpcy5fZ2V0KGIsXCJtb250aE5hbWVzU2hvcnRcIiksej10aGlzLl9nZXQoYixcImJlZm9yZVNob3dEYXlcIiksST10aGlzLl9nZXQoYixcInNob3dPdGhlck1vbnRoc1wiKSxOPXRoaXMuX2dldChiLFwic2VsZWN0T3RoZXJNb250aHNcIik7dGhpcy5fZ2V0KGIsXCJjYWxjdWxhdGVXZWVrXCIpO2Zvcih2YXIgSj10aGlzLl9nZXREZWZhdWx0RGF0ZShiKSxEPVwiXCIsRT0wO0U8a1swXTtFKyspe3ZhciBQPVxuXCJcIjt0aGlzLm1heFJvd3M9NDtmb3IodmFyIEw9MDtMPGtbMV07TCsrKXt2YXIgUT10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZSh2LG0sYi5zZWxlY3RlZERheSkpLEI9XCIgdWktY29ybmVyLWFsbFwiLEY9XCJcIjtpZihxKXtGKz0nPGRpdiBjbGFzcz1cInVpLWRhdGVwaWNrZXItZ3JvdXAnO2lmKGtbMV0+MSlzd2l0Y2goTCl7Y2FzZSAwOkYrPVwiIHVpLWRhdGVwaWNrZXItZ3JvdXAtZmlyc3RcIjtCPVwiIHVpLWNvcm5lci1cIisoaj9cInJpZ2h0XCI6XCJsZWZ0XCIpO2JyZWFrO2Nhc2Uga1sxXS0xOkYrPVwiIHVpLWRhdGVwaWNrZXItZ3JvdXAtbGFzdFwiO0I9XCIgdWktY29ybmVyLVwiKyhqP1wibGVmdFwiOlwicmlnaHRcIik7YnJlYWs7ZGVmYXVsdDpGKz1cIiB1aS1kYXRlcGlja2VyLWdyb3VwLW1pZGRsZVwiO0I9XCJcIjticmVha31GKz0nXCI+J31GKz0nPGRpdiBjbGFzcz1cInVpLWRhdGVwaWNrZXItaGVhZGVyIHVpLXdpZGdldC1oZWFkZXIgdWktaGVscGVyLWNsZWFyZml4JytCKydcIj4nKygvYWxsfGxlZnQvLnRlc3QoQikmJlxuRT09MD9qP286dzpcIlwiKSsoL2FsbHxyaWdodC8udGVzdChCKSYmRT09MD9qP3c6bzpcIlwiKSt0aGlzLl9nZW5lcmF0ZU1vbnRoWWVhckhlYWRlcihiLG0sdixyLHUsRT4wfHxMPjAsSCxDKSsnPC9kaXY+PHRhYmxlIGNsYXNzPVwidWktZGF0ZXBpY2tlci1jYWxlbmRhclwiPjx0aGVhZD48dHI+Jzt2YXIgRz1wPyc8dGggY2xhc3M9XCJ1aS1kYXRlcGlja2VyLXdlZWstY29sXCI+Jyt0aGlzLl9nZXQoYixcIndlZWtIZWFkZXJcIikrXCI8L3RoPlwiOlwiXCI7Zm9yKEI9MDtCPDc7QisrKXt2YXIgQT0oQituKSU3O0crPVwiPHRoXCIrKChCK24rNiklNz49NT8nIGNsYXNzPVwidWktZGF0ZXBpY2tlci13ZWVrLWVuZFwiJzpcIlwiKSsnPjxzcGFuIHRpdGxlPVwiJyt4W0FdKydcIj4nK3lbQV0rXCI8L3NwYW4+PC90aD5cIn1GKz1HK1wiPC90cj48L3RoZWFkPjx0Ym9keT5cIjtHPXRoaXMuX2dldERheXNJbk1vbnRoKHYsbSk7aWYodj09Yi5zZWxlY3RlZFllYXImJm09PWIuc2VsZWN0ZWRNb250aCliLnNlbGVjdGVkRGF5PU1hdGgubWluKGIuc2VsZWN0ZWREYXksXG5HKTtCPSh0aGlzLl9nZXRGaXJzdERheU9mTW9udGgodixtKS1uKzcpJTc7Rz1NYXRoLmNlaWwoKEIrRykvNyk7dGhpcy5tYXhSb3dzPUc9cT90aGlzLm1heFJvd3M+Rz90aGlzLm1heFJvd3M6RzpHO0E9dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUodixtLDEtQikpO2Zvcih2YXIgUj0wO1I8RztSKyspe0YrPVwiPHRyPlwiO3ZhciBTPSFwP1wiXCI6Jzx0ZCBjbGFzcz1cInVpLWRhdGVwaWNrZXItd2Vlay1jb2xcIj4nK3RoaXMuX2dldChiLFwiY2FsY3VsYXRlV2Vla1wiKShBKStcIjwvdGQ+XCI7Zm9yKEI9MDtCPDc7QisrKXt2YXIgTT16P3ouYXBwbHkoYi5pbnB1dD9iLmlucHV0WzBdOm51bGwsW0FdKTpbdHJ1ZSxcIlwiXSxLPUEuZ2V0TW9udGgoKSE9bSxPPUsmJiFOfHwhTVswXXx8ciYmQTxyfHx1JiZBPnU7Uys9Jzx0ZCBjbGFzcz1cIicrKChCK24rNiklNz49NT9cIiB1aS1kYXRlcGlja2VyLXdlZWstZW5kXCI6XCJcIikrKEs/XCIgdWktZGF0ZXBpY2tlci1vdGhlci1tb250aFwiOlwiXCIpKyhBLmdldFRpbWUoKT09XG5RLmdldFRpbWUoKSYmbT09Yi5zZWxlY3RlZE1vbnRoJiZiLl9rZXlFdmVudHx8Si5nZXRUaW1lKCk9PUEuZ2V0VGltZSgpJiZKLmdldFRpbWUoKT09US5nZXRUaW1lKCk/XCIgXCIrdGhpcy5fZGF5T3ZlckNsYXNzOlwiXCIpKyhPP1wiIFwiK3RoaXMuX3Vuc2VsZWN0YWJsZUNsYXNzK1wiIHVpLXN0YXRlLWRpc2FibGVkXCI6XCJcIikrKEsmJiFJP1wiXCI6XCIgXCIrTVsxXSsoQS5nZXRUaW1lKCk9PXMuZ2V0VGltZSgpP1wiIFwiK3RoaXMuX2N1cnJlbnRDbGFzczpcIlwiKSsoQS5nZXRUaW1lKCk9PWYuZ2V0VGltZSgpP1wiIHVpLWRhdGVwaWNrZXItdG9kYXlcIjpcIlwiKSkrJ1wiJysoKCFLfHxJKSYmTVsyXT8nIHRpdGxlPVwiJytNWzJdKydcIic6XCJcIikrKE8/XCJcIjonIG9uY2xpY2s9XCJEUF9qUXVlcnlfJytnK1wiLmRhdGVwaWNrZXIuX3NlbGVjdERheSgnI1wiK2IuaWQrXCInLFwiK0EuZ2V0TW9udGgoKStcIixcIitBLmdldEZ1bGxZZWFyKCkrJywgdGhpcyk7cmV0dXJuIGZhbHNlO1wiJykrXCI+XCIrKEsmJiFJP1wiJiN4YTA7XCI6Tz8nPHNwYW4gY2xhc3M9XCJ1aS1zdGF0ZS1kZWZhdWx0XCI+JytcbkEuZ2V0RGF0ZSgpK1wiPC9zcGFuPlwiOic8YSBjbGFzcz1cInVpLXN0YXRlLWRlZmF1bHQnKyhBLmdldFRpbWUoKT09Zi5nZXRUaW1lKCk/XCIgdWktc3RhdGUtaGlnaGxpZ2h0XCI6XCJcIikrKEEuZ2V0VGltZSgpPT1zLmdldFRpbWUoKT9cIiB1aS1zdGF0ZS1hY3RpdmVcIjpcIlwiKSsoSz9cIiB1aS1wcmlvcml0eS1zZWNvbmRhcnlcIjpcIlwiKSsnXCIgaHJlZj1cIiNcIj4nK0EuZ2V0RGF0ZSgpK1wiPC9hPlwiKStcIjwvdGQ+XCI7QS5zZXREYXRlKEEuZ2V0RGF0ZSgpKzEpO0E9dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QoQSl9Ris9UytcIjwvdHI+XCJ9bSsrO2lmKG0+MTEpe209MDt2Kyt9Ris9XCI8L3Rib2R5PjwvdGFibGU+XCIrKHE/XCI8L2Rpdj5cIisoa1swXT4wJiZMPT1rWzFdLTE/JzxkaXYgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLXJvdy1icmVha1wiPjwvZGl2Pic6XCJcIik6XCJcIik7UCs9Rn1EKz1QfUQrPWwrKGEuYnJvd3Nlci5tc2llJiZwYXJzZUludChhLmJyb3dzZXIudmVyc2lvbiwxMCk8NyYmIWIuaW5saW5lPyc8aWZyYW1lIHNyYz1cImphdmFzY3JpcHQ6ZmFsc2U7XCIgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLWNvdmVyXCIgZnJhbWVib3JkZXI9XCIwXCI+PC9pZnJhbWU+JzpcblwiXCIpO2IuX2tleUV2ZW50PWZhbHNlO3JldHVybiBEfSxfZ2VuZXJhdGVNb250aFllYXJIZWFkZXI6ZnVuY3Rpb24oYixmLGosbCxvLG4sayxtKXt2YXIgcD10aGlzLl9nZXQoYixcImNoYW5nZU1vbnRoXCIpLHE9dGhpcy5fZ2V0KGIsXCJjaGFuZ2VZZWFyXCIpLHM9dGhpcy5fZ2V0KGIsXCJzaG93TW9udGhBZnRlclllYXJcIikscj0nPGRpdiBjbGFzcz1cInVpLWRhdGVwaWNrZXItdGl0bGVcIj4nLHU9XCJcIjtpZihufHwhcCl1Kz0nPHNwYW4gY2xhc3M9XCJ1aS1kYXRlcGlja2VyLW1vbnRoXCI+JytrW2ZdK1wiPC9zcGFuPlwiO2Vsc2V7az1sJiZsLmdldEZ1bGxZZWFyKCk9PWo7dmFyIHY9byYmby5nZXRGdWxsWWVhcigpPT1qO3UrPSc8c2VsZWN0IGNsYXNzPVwidWktZGF0ZXBpY2tlci1tb250aFwiIG9uY2hhbmdlPVwiRFBfalF1ZXJ5XycrZytcIi5kYXRlcGlja2VyLl9zZWxlY3RNb250aFllYXIoJyNcIitiLmlkK1wiJywgdGhpcywgJ00nKTtcXFwiID5cIjtmb3IodmFyIHc9MDt3PDEyO3crKylpZigoIWt8fHc+PWwuZ2V0TW9udGgoKSkmJlxuKCF2fHx3PD1vLmdldE1vbnRoKCkpKXUrPSc8b3B0aW9uIHZhbHVlPVwiJyt3KydcIicrKHc9PWY/JyBzZWxlY3RlZD1cInNlbGVjdGVkXCInOlwiXCIpK1wiPlwiK21bd10rXCI8L29wdGlvbj5cIjt1Kz1cIjwvc2VsZWN0PlwifXN8fChyKz11KyhufHwhKHAmJnEpP1wiJiN4YTA7XCI6XCJcIikpO2lmKCFiLnllYXJzaHRtbCl7Yi55ZWFyc2h0bWw9XCJcIjtpZihufHwhcSlyKz0nPHNwYW4gY2xhc3M9XCJ1aS1kYXRlcGlja2VyLXllYXJcIj4nK2orXCI8L3NwYW4+XCI7ZWxzZXttPXRoaXMuX2dldChiLFwieWVhclJhbmdlXCIpLnNwbGl0KFwiOlwiKTt2YXIgeD0obmV3IERhdGUpLmdldEZ1bGxZZWFyKCk7az1mdW5jdGlvbih5KXt5PXkubWF0Y2goL2NbKy1dLiovKT9qK3BhcnNlSW50KHkuc3Vic3RyaW5nKDEpLDEwKTp5Lm1hdGNoKC9bKy1dLiovKT94K3BhcnNlSW50KHksMTApOnBhcnNlSW50KHksMTApO3JldHVybiBpc05hTih5KT94Onl9O2Y9ayhtWzBdKTttPU1hdGgubWF4KGYsayhtWzFdfHxcIlwiKSk7Zj1sP01hdGgubWF4KGYsXG5sLmdldEZ1bGxZZWFyKCkpOmY7bT1vP01hdGgubWluKG0sby5nZXRGdWxsWWVhcigpKTptO2ZvcihiLnllYXJzaHRtbCs9JzxzZWxlY3QgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLXllYXJcIiBvbmNoYW5nZT1cIkRQX2pRdWVyeV8nK2crXCIuZGF0ZXBpY2tlci5fc2VsZWN0TW9udGhZZWFyKCcjXCIrYi5pZCtcIicsIHRoaXMsICdZJyk7XFxcIiA+XCI7Zjw9bTtmKyspYi55ZWFyc2h0bWwrPSc8b3B0aW9uIHZhbHVlPVwiJytmKydcIicrKGY9PWo/JyBzZWxlY3RlZD1cInNlbGVjdGVkXCInOlwiXCIpK1wiPlwiK2YrXCI8L29wdGlvbj5cIjtiLnllYXJzaHRtbCs9XCI8L3NlbGVjdD5cIjtyKz1iLnllYXJzaHRtbDtiLnllYXJzaHRtbD1udWxsfX1yKz10aGlzLl9nZXQoYixcInllYXJTdWZmaXhcIik7aWYocylyKz0obnx8IShwJiZxKT9cIiYjeGEwO1wiOlwiXCIpK3U7cis9XCI8L2Rpdj5cIjtyZXR1cm4gcn0sX2FkanVzdEluc3REYXRlOmZ1bmN0aW9uKGIsZixqKXt2YXIgbD1iLmRyYXdZZWFyKyhqPT1cIllcIj9mOjApLG89Yi5kcmF3TW9udGgrXG4oaj09XCJNXCI/ZjowKTtmPU1hdGgubWluKGIuc2VsZWN0ZWREYXksdGhpcy5fZ2V0RGF5c0luTW9udGgobCxvKSkrKGo9PVwiRFwiP2Y6MCk7bD10aGlzLl9yZXN0cmljdE1pbk1heChiLHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGwsbyxmKSkpO2Iuc2VsZWN0ZWREYXk9bC5nZXREYXRlKCk7Yi5kcmF3TW9udGg9Yi5zZWxlY3RlZE1vbnRoPWwuZ2V0TW9udGgoKTtiLmRyYXdZZWFyPWIuc2VsZWN0ZWRZZWFyPWwuZ2V0RnVsbFllYXIoKTtpZihqPT1cIk1cInx8aj09XCJZXCIpdGhpcy5fbm90aWZ5Q2hhbmdlKGIpfSxfcmVzdHJpY3RNaW5NYXg6ZnVuY3Rpb24oYixmKXt2YXIgaj10aGlzLl9nZXRNaW5NYXhEYXRlKGIsXCJtaW5cIik7Yj10aGlzLl9nZXRNaW5NYXhEYXRlKGIsXCJtYXhcIik7Zj1qJiZmPGo/ajpmO3JldHVybiBmPWImJmY+Yj9iOmZ9LF9ub3RpZnlDaGFuZ2U6ZnVuY3Rpb24oYil7dmFyIGY9dGhpcy5fZ2V0KGIsXCJvbkNoYW5nZU1vbnRoWWVhclwiKTtpZihmKWYuYXBwbHkoYi5pbnB1dD9cbmIuaW5wdXRbMF06bnVsbCxbYi5zZWxlY3RlZFllYXIsYi5zZWxlY3RlZE1vbnRoKzEsYl0pfSxfZ2V0TnVtYmVyT2ZNb250aHM6ZnVuY3Rpb24oYil7Yj10aGlzLl9nZXQoYixcIm51bWJlck9mTW9udGhzXCIpO3JldHVybiBiPT1udWxsP1sxLDFdOnR5cGVvZiBiPT1cIm51bWJlclwiP1sxLGJdOmJ9LF9nZXRNaW5NYXhEYXRlOmZ1bmN0aW9uKGIsZil7cmV0dXJuIHRoaXMuX2RldGVybWluZURhdGUoYix0aGlzLl9nZXQoYixmK1wiRGF0ZVwiKSxudWxsKX0sX2dldERheXNJbk1vbnRoOmZ1bmN0aW9uKGIsZil7cmV0dXJuIDMyLXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGIsZiwzMikpLmdldERhdGUoKX0sX2dldEZpcnN0RGF5T2ZNb250aDpmdW5jdGlvbihiLGYpe3JldHVybihuZXcgRGF0ZShiLGYsMSkpLmdldERheSgpfSxfY2FuQWRqdXN0TW9udGg6ZnVuY3Rpb24oYixmLGosbCl7dmFyIG89dGhpcy5fZ2V0TnVtYmVyT2ZNb250aHMoYik7aj10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShqLFxubCsoZjwwP2Y6b1swXSpvWzFdKSwxKSk7ZjwwJiZqLnNldERhdGUodGhpcy5fZ2V0RGF5c0luTW9udGgoai5nZXRGdWxsWWVhcigpLGouZ2V0TW9udGgoKSkpO3JldHVybiB0aGlzLl9pc0luUmFuZ2UoYixqKX0sX2lzSW5SYW5nZTpmdW5jdGlvbihiLGYpe3ZhciBqPXRoaXMuX2dldE1pbk1heERhdGUoYixcIm1pblwiKTtiPXRoaXMuX2dldE1pbk1heERhdGUoYixcIm1heFwiKTtyZXR1cm4oIWp8fGYuZ2V0VGltZSgpPj1qLmdldFRpbWUoKSkmJighYnx8Zi5nZXRUaW1lKCk8PWIuZ2V0VGltZSgpKX0sX2dldEZvcm1hdENvbmZpZzpmdW5jdGlvbihiKXt2YXIgZj10aGlzLl9nZXQoYixcInNob3J0WWVhckN1dG9mZlwiKTtmPXR5cGVvZiBmIT1cInN0cmluZ1wiP2Y6KG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpJTEwMCtwYXJzZUludChmLDEwKTtyZXR1cm57c2hvcnRZZWFyQ3V0b2ZmOmYsZGF5TmFtZXNTaG9ydDp0aGlzLl9nZXQoYixcImRheU5hbWVzU2hvcnRcIiksZGF5TmFtZXM6dGhpcy5fZ2V0KGIsXG5cImRheU5hbWVzXCIpLG1vbnRoTmFtZXNTaG9ydDp0aGlzLl9nZXQoYixcIm1vbnRoTmFtZXNTaG9ydFwiKSxtb250aE5hbWVzOnRoaXMuX2dldChiLFwibW9udGhOYW1lc1wiKX19LF9mb3JtYXREYXRlOmZ1bmN0aW9uKGIsZixqLGwpe2lmKCFmKXtiLmN1cnJlbnREYXk9Yi5zZWxlY3RlZERheTtiLmN1cnJlbnRNb250aD1iLnNlbGVjdGVkTW9udGg7Yi5jdXJyZW50WWVhcj1iLnNlbGVjdGVkWWVhcn1mPWY/dHlwZW9mIGY9PVwib2JqZWN0XCI/Zjp0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShsLGosZikpOnRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGIuY3VycmVudFllYXIsYi5jdXJyZW50TW9udGgsYi5jdXJyZW50RGF5KSk7cmV0dXJuIHRoaXMuZm9ybWF0RGF0ZSh0aGlzLl9nZXQoYixcImRhdGVGb3JtYXRcIiksZix0aGlzLl9nZXRGb3JtYXRDb25maWcoYikpfX0pO2EuZm4uZGF0ZXBpY2tlcj1mdW5jdGlvbihiKXtpZighdGhpcy5sZW5ndGgpcmV0dXJuIHRoaXM7XG5pZighYS5kYXRlcGlja2VyLmluaXRpYWxpemVkKXthKGRvY3VtZW50KS5tb3VzZWRvd24oYS5kYXRlcGlja2VyLl9jaGVja0V4dGVybmFsQ2xpY2spLmZpbmQoXCJib2R5XCIpLmFwcGVuZChhLmRhdGVwaWNrZXIuZHBEaXYpO2EuZGF0ZXBpY2tlci5pbml0aWFsaXplZD10cnVlfXZhciBmPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtpZih0eXBlb2YgYj09XCJzdHJpbmdcIiYmKGI9PVwiaXNEaXNhYmxlZFwifHxiPT1cImdldERhdGVcInx8Yj09XCJ3aWRnZXRcIikpcmV0dXJuIGEuZGF0ZXBpY2tlcltcIl9cIitiK1wiRGF0ZXBpY2tlclwiXS5hcHBseShhLmRhdGVwaWNrZXIsW3RoaXNbMF1dLmNvbmNhdChmKSk7aWYoYj09XCJvcHRpb25cIiYmYXJndW1lbnRzLmxlbmd0aD09MiYmdHlwZW9mIGFyZ3VtZW50c1sxXT09XCJzdHJpbmdcIilyZXR1cm4gYS5kYXRlcGlja2VyW1wiX1wiK2IrXCJEYXRlcGlja2VyXCJdLmFwcGx5KGEuZGF0ZXBpY2tlcixbdGhpc1swXV0uY29uY2F0KGYpKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dHlwZW9mIGI9PVxuXCJzdHJpbmdcIj9hLmRhdGVwaWNrZXJbXCJfXCIrYitcIkRhdGVwaWNrZXJcIl0uYXBwbHkoYS5kYXRlcGlja2VyLFt0aGlzXS5jb25jYXQoZikpOmEuZGF0ZXBpY2tlci5fYXR0YWNoRGF0ZXBpY2tlcih0aGlzLGIpfSl9O2EuZGF0ZXBpY2tlcj1uZXcgYzthLmRhdGVwaWNrZXIuaW5pdGlhbGl6ZWQ9ZmFsc2U7YS5kYXRlcGlja2VyLnV1aWQ9KG5ldyBEYXRlKS5nZXRUaW1lKCk7YS5kYXRlcGlja2VyLnZlcnNpb249XCIxLjguMTZcIjt3aW5kb3dbXCJEUF9qUXVlcnlfXCIrZ109YX0pKGpRdWVyeSk7XG4oZnVuY3Rpb24oYSxkKXt2YXIgYz17YnV0dG9uczp0cnVlLGhlaWdodDp0cnVlLG1heEhlaWdodDp0cnVlLG1heFdpZHRoOnRydWUsbWluSGVpZ2h0OnRydWUsbWluV2lkdGg6dHJ1ZSx3aWR0aDp0cnVlfSxlPXttYXhIZWlnaHQ6dHJ1ZSxtYXhXaWR0aDp0cnVlLG1pbkhlaWdodDp0cnVlLG1pbldpZHRoOnRydWV9LGg9YS5hdHRyRm58fHt2YWw6dHJ1ZSxjc3M6dHJ1ZSxodG1sOnRydWUsdGV4dDp0cnVlLGRhdGE6dHJ1ZSx3aWR0aDp0cnVlLGhlaWdodDp0cnVlLG9mZnNldDp0cnVlLGNsaWNrOnRydWV9O2Eud2lkZ2V0KFwidWkuZGlhbG9nXCIse29wdGlvbnM6e2F1dG9PcGVuOnRydWUsYnV0dG9uczp7fSxjbG9zZU9uRXNjYXBlOnRydWUsY2xvc2VUZXh0OlwiY2xvc2VcIixkaWFsb2dDbGFzczpcIlwiLGRyYWdnYWJsZTp0cnVlLGhpZGU6bnVsbCxoZWlnaHQ6XCJhdXRvXCIsbWF4SGVpZ2h0OmZhbHNlLG1heFdpZHRoOmZhbHNlLG1pbkhlaWdodDoxNTAsbWluV2lkdGg6MTUwLG1vZGFsOmZhbHNlLFxucG9zaXRpb246e215OlwiY2VudGVyXCIsYXQ6XCJjZW50ZXJcIixjb2xsaXNpb246XCJmaXRcIix1c2luZzpmdW5jdGlvbihnKXt2YXIgaT1hKHRoaXMpLmNzcyhnKS5vZmZzZXQoKS50b3A7aTwwJiZhKHRoaXMpLmNzcyhcInRvcFwiLGcudG9wLWkpfX0scmVzaXphYmxlOnRydWUsc2hvdzpudWxsLHN0YWNrOnRydWUsdGl0bGU6XCJcIix3aWR0aDozMDAsekluZGV4OjFFM30sX2NyZWF0ZTpmdW5jdGlvbigpe3RoaXMub3JpZ2luYWxUaXRsZT10aGlzLmVsZW1lbnQuYXR0cihcInRpdGxlXCIpO2lmKHR5cGVvZiB0aGlzLm9yaWdpbmFsVGl0bGUhPT1cInN0cmluZ1wiKXRoaXMub3JpZ2luYWxUaXRsZT1cIlwiO3RoaXMub3B0aW9ucy50aXRsZT10aGlzLm9wdGlvbnMudGl0bGV8fHRoaXMub3JpZ2luYWxUaXRsZTt2YXIgZz10aGlzLGk9Zy5vcHRpb25zLGI9aS50aXRsZXx8XCImIzE2MDtcIixmPWEudWkuZGlhbG9nLmdldFRpdGxlSWQoZy5lbGVtZW50KSxqPShnLnVpRGlhbG9nPWEoXCI8ZGl2PjwvZGl2PlwiKSkuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkuaGlkZSgpLmFkZENsYXNzKFwidWktZGlhbG9nIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIFwiK1xuaS5kaWFsb2dDbGFzcykuY3NzKHt6SW5kZXg6aS56SW5kZXh9KS5hdHRyKFwidGFiSW5kZXhcIiwtMSkuY3NzKFwib3V0bGluZVwiLDApLmtleWRvd24oZnVuY3Rpb24obil7aWYoaS5jbG9zZU9uRXNjYXBlJiYhbi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmbi5rZXlDb2RlJiZuLmtleUNvZGU9PT1hLnVpLmtleUNvZGUuRVNDQVBFKXtnLmNsb3NlKG4pO24ucHJldmVudERlZmF1bHQoKX19KS5hdHRyKHtyb2xlOlwiZGlhbG9nXCIsXCJhcmlhLWxhYmVsbGVkYnlcIjpmfSkubW91c2Vkb3duKGZ1bmN0aW9uKG4pe2cubW92ZVRvVG9wKGZhbHNlLG4pfSk7Zy5lbGVtZW50LnNob3coKS5yZW1vdmVBdHRyKFwidGl0bGVcIikuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctY29udGVudCB1aS13aWRnZXQtY29udGVudFwiKS5hcHBlbmRUbyhqKTt2YXIgbD0oZy51aURpYWxvZ1RpdGxlYmFyPWEoXCI8ZGl2PjwvZGl2PlwiKSkuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctdGl0bGViYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYWxsIHVpLWhlbHBlci1jbGVhcmZpeFwiKS5wcmVwZW5kVG8oaiksXG5vPWEoJzxhIGhyZWY9XCIjXCI+PC9hPicpLmFkZENsYXNzKFwidWktZGlhbG9nLXRpdGxlYmFyLWNsb3NlIHVpLWNvcm5lci1hbGxcIikuYXR0cihcInJvbGVcIixcImJ1dHRvblwiKS5ob3ZlcihmdW5jdGlvbigpe28uYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX0sZnVuY3Rpb24oKXtvLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtaG92ZXJcIil9KS5mb2N1cyhmdW5jdGlvbigpe28uYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX0pLmJsdXIoZnVuY3Rpb24oKXtvLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9KS5jbGljayhmdW5jdGlvbihuKXtnLmNsb3NlKG4pO3JldHVybiBmYWxzZX0pLmFwcGVuZFRvKGwpOyhnLnVpRGlhbG9nVGl0bGViYXJDbG9zZVRleHQ9YShcIjxzcGFuPjwvc3Bhbj5cIikpLmFkZENsYXNzKFwidWktaWNvbiB1aS1pY29uLWNsb3NldGhpY2tcIikudGV4dChpLmNsb3NlVGV4dCkuYXBwZW5kVG8obyk7YShcIjxzcGFuPjwvc3Bhbj5cIikuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctdGl0bGVcIikuYXR0cihcImlkXCIsXG5mKS5odG1sKGIpLnByZXBlbmRUbyhsKTtpZihhLmlzRnVuY3Rpb24oaS5iZWZvcmVjbG9zZSkmJiFhLmlzRnVuY3Rpb24oaS5iZWZvcmVDbG9zZSkpaS5iZWZvcmVDbG9zZT1pLmJlZm9yZWNsb3NlO2wuZmluZChcIipcIikuYWRkKGwpLmRpc2FibGVTZWxlY3Rpb24oKTtpLmRyYWdnYWJsZSYmYS5mbi5kcmFnZ2FibGUmJmcuX21ha2VEcmFnZ2FibGUoKTtpLnJlc2l6YWJsZSYmYS5mbi5yZXNpemFibGUmJmcuX21ha2VSZXNpemFibGUoKTtnLl9jcmVhdGVCdXR0b25zKGkuYnV0dG9ucyk7Zy5faXNPcGVuPWZhbHNlO2EuZm4uYmdpZnJhbWUmJmouYmdpZnJhbWUoKX0sX2luaXQ6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuYXV0b09wZW4mJnRoaXMub3BlbigpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dmFyIGc9dGhpcztnLm92ZXJsYXkmJmcub3ZlcmxheS5kZXN0cm95KCk7Zy51aURpYWxvZy5oaWRlKCk7Zy5lbGVtZW50LnVuYmluZChcIi5kaWFsb2dcIikucmVtb3ZlRGF0YShcImRpYWxvZ1wiKS5yZW1vdmVDbGFzcyhcInVpLWRpYWxvZy1jb250ZW50IHVpLXdpZGdldC1jb250ZW50XCIpLmhpZGUoKS5hcHBlbmRUbyhcImJvZHlcIik7XG5nLnVpRGlhbG9nLnJlbW92ZSgpO2cub3JpZ2luYWxUaXRsZSYmZy5lbGVtZW50LmF0dHIoXCJ0aXRsZVwiLGcub3JpZ2luYWxUaXRsZSk7cmV0dXJuIGd9LHdpZGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnVpRGlhbG9nfSxjbG9zZTpmdW5jdGlvbihnKXt2YXIgaT10aGlzLGIsZjtpZihmYWxzZSE9PWkuX3RyaWdnZXIoXCJiZWZvcmVDbG9zZVwiLGcpKXtpLm92ZXJsYXkmJmkub3ZlcmxheS5kZXN0cm95KCk7aS51aURpYWxvZy51bmJpbmQoXCJrZXlwcmVzcy51aS1kaWFsb2dcIik7aS5faXNPcGVuPWZhbHNlO2lmKGkub3B0aW9ucy5oaWRlKWkudWlEaWFsb2cuaGlkZShpLm9wdGlvbnMuaGlkZSxmdW5jdGlvbigpe2kuX3RyaWdnZXIoXCJjbG9zZVwiLGcpfSk7ZWxzZXtpLnVpRGlhbG9nLmhpZGUoKTtpLl90cmlnZ2VyKFwiY2xvc2VcIixnKX1hLnVpLmRpYWxvZy5vdmVybGF5LnJlc2l6ZSgpO2lmKGkub3B0aW9ucy5tb2RhbCl7Yj0wO2EoXCIudWktZGlhbG9nXCIpLmVhY2goZnVuY3Rpb24oKXtpZih0aGlzIT09XG5pLnVpRGlhbG9nWzBdKXtmPWEodGhpcykuY3NzKFwiei1pbmRleFwiKTtpc05hTihmKXx8KGI9TWF0aC5tYXgoYixmKSl9fSk7YS51aS5kaWFsb2cubWF4Wj1ifXJldHVybiBpfX0saXNPcGVuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2lzT3Blbn0sbW92ZVRvVG9wOmZ1bmN0aW9uKGcsaSl7dmFyIGI9dGhpcyxmPWIub3B0aW9ucztpZihmLm1vZGFsJiYhZ3x8IWYuc3RhY2smJiFmLm1vZGFsKXJldHVybiBiLl90cmlnZ2VyKFwiZm9jdXNcIixpKTtpZihmLnpJbmRleD5hLnVpLmRpYWxvZy5tYXhaKWEudWkuZGlhbG9nLm1heFo9Zi56SW5kZXg7aWYoYi5vdmVybGF5KXthLnVpLmRpYWxvZy5tYXhaKz0xO2Iub3ZlcmxheS4kZWwuY3NzKFwiei1pbmRleFwiLGEudWkuZGlhbG9nLm92ZXJsYXkubWF4Wj1hLnVpLmRpYWxvZy5tYXhaKX1nPXtzY3JvbGxUb3A6Yi5lbGVtZW50LnNjcm9sbFRvcCgpLHNjcm9sbExlZnQ6Yi5lbGVtZW50LnNjcm9sbExlZnQoKX07YS51aS5kaWFsb2cubWF4Wis9MTtcbmIudWlEaWFsb2cuY3NzKFwiei1pbmRleFwiLGEudWkuZGlhbG9nLm1heFopO2IuZWxlbWVudC5hdHRyKGcpO2IuX3RyaWdnZXIoXCJmb2N1c1wiLGkpO3JldHVybiBifSxvcGVuOmZ1bmN0aW9uKCl7aWYoIXRoaXMuX2lzT3Blbil7dmFyIGc9dGhpcyxpPWcub3B0aW9ucyxiPWcudWlEaWFsb2c7Zy5vdmVybGF5PWkubW9kYWw/bmV3IGEudWkuZGlhbG9nLm92ZXJsYXkoZyk6bnVsbDtnLl9zaXplKCk7Zy5fcG9zaXRpb24oaS5wb3NpdGlvbik7Yi5zaG93KGkuc2hvdyk7Zy5tb3ZlVG9Ub3AodHJ1ZSk7aS5tb2RhbCYmYi5iaW5kKFwia2V5cHJlc3MudWktZGlhbG9nXCIsZnVuY3Rpb24oZil7aWYoZi5rZXlDb2RlPT09YS51aS5rZXlDb2RlLlRBQil7dmFyIGo9YShcIjp0YWJiYWJsZVwiLHRoaXMpLGw9ai5maWx0ZXIoXCI6Zmlyc3RcIik7aj1qLmZpbHRlcihcIjpsYXN0XCIpO2lmKGYudGFyZ2V0PT09alswXSYmIWYuc2hpZnRLZXkpe2wuZm9jdXMoMSk7cmV0dXJuIGZhbHNlfWVsc2UgaWYoZi50YXJnZXQ9PT1cbmxbMF0mJmYuc2hpZnRLZXkpe2ouZm9jdXMoMSk7cmV0dXJuIGZhbHNlfX19KTthKGcuZWxlbWVudC5maW5kKFwiOnRhYmJhYmxlXCIpLmdldCgpLmNvbmNhdChiLmZpbmQoXCIudWktZGlhbG9nLWJ1dHRvbnBhbmUgOnRhYmJhYmxlXCIpLmdldCgpLmNvbmNhdChiLmdldCgpKSkpLmVxKDApLmZvY3VzKCk7Zy5faXNPcGVuPXRydWU7Zy5fdHJpZ2dlcihcIm9wZW5cIik7cmV0dXJuIGd9fSxfY3JlYXRlQnV0dG9uczpmdW5jdGlvbihnKXt2YXIgaT10aGlzLGI9ZmFsc2UsZj1hKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctYnV0dG9ucGFuZSB1aS13aWRnZXQtY29udGVudCB1aS1oZWxwZXItY2xlYXJmaXhcIiksaj1hKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctYnV0dG9uc2V0XCIpLmFwcGVuZFRvKGYpO2kudWlEaWFsb2cuZmluZChcIi51aS1kaWFsb2ctYnV0dG9ucGFuZVwiKS5yZW1vdmUoKTt0eXBlb2YgZz09PVwib2JqZWN0XCImJmchPT1udWxsJiZhLmVhY2goZyxcbmZ1bmN0aW9uKCl7cmV0dXJuIShiPXRydWUpfSk7aWYoYil7YS5lYWNoKGcsZnVuY3Rpb24obCxvKXtvPWEuaXNGdW5jdGlvbihvKT97Y2xpY2s6byx0ZXh0Omx9Om87dmFyIG49YSgnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCI+PC9idXR0b24+JykuY2xpY2soZnVuY3Rpb24oKXtvLmNsaWNrLmFwcGx5KGkuZWxlbWVudFswXSxhcmd1bWVudHMpfSkuYXBwZW5kVG8oaik7YS5lYWNoKG8sZnVuY3Rpb24oayxtKXtpZihrIT09XCJjbGlja1wiKWsgaW4gaD9uW2tdKG0pOm4uYXR0cihrLG0pfSk7YS5mbi5idXR0b24mJm4uYnV0dG9uKCl9KTtmLmFwcGVuZFRvKGkudWlEaWFsb2cpfX0sX21ha2VEcmFnZ2FibGU6ZnVuY3Rpb24oKXtmdW5jdGlvbiBnKGwpe3JldHVybntwb3NpdGlvbjpsLnBvc2l0aW9uLG9mZnNldDpsLm9mZnNldH19dmFyIGk9dGhpcyxiPWkub3B0aW9ucyxmPWEoZG9jdW1lbnQpLGo7aS51aURpYWxvZy5kcmFnZ2FibGUoe2NhbmNlbDpcIi51aS1kaWFsb2ctY29udGVudCwgLnVpLWRpYWxvZy10aXRsZWJhci1jbG9zZVwiLFxuaGFuZGxlOlwiLnVpLWRpYWxvZy10aXRsZWJhclwiLGNvbnRhaW5tZW50OlwiZG9jdW1lbnRcIixzdGFydDpmdW5jdGlvbihsLG8pe2o9Yi5oZWlnaHQ9PT1cImF1dG9cIj9cImF1dG9cIjphKHRoaXMpLmhlaWdodCgpO2EodGhpcykuaGVpZ2h0KGEodGhpcykuaGVpZ2h0KCkpLmFkZENsYXNzKFwidWktZGlhbG9nLWRyYWdnaW5nXCIpO2kuX3RyaWdnZXIoXCJkcmFnU3RhcnRcIixsLGcobykpfSxkcmFnOmZ1bmN0aW9uKGwsbyl7aS5fdHJpZ2dlcihcImRyYWdcIixsLGcobykpfSxzdG9wOmZ1bmN0aW9uKGwsbyl7Yi5wb3NpdGlvbj1bby5wb3NpdGlvbi5sZWZ0LWYuc2Nyb2xsTGVmdCgpLG8ucG9zaXRpb24udG9wLWYuc2Nyb2xsVG9wKCldO2EodGhpcykucmVtb3ZlQ2xhc3MoXCJ1aS1kaWFsb2ctZHJhZ2dpbmdcIikuaGVpZ2h0KGopO2kuX3RyaWdnZXIoXCJkcmFnU3RvcFwiLGwsZyhvKSk7YS51aS5kaWFsb2cub3ZlcmxheS5yZXNpemUoKX19KX0sX21ha2VSZXNpemFibGU6ZnVuY3Rpb24oZyl7ZnVuY3Rpb24gaShsKXtyZXR1cm57b3JpZ2luYWxQb3NpdGlvbjpsLm9yaWdpbmFsUG9zaXRpb24sXG5vcmlnaW5hbFNpemU6bC5vcmlnaW5hbFNpemUscG9zaXRpb246bC5wb3NpdGlvbixzaXplOmwuc2l6ZX19Zz1nPT09ZD90aGlzLm9wdGlvbnMucmVzaXphYmxlOmc7dmFyIGI9dGhpcyxmPWIub3B0aW9ucyxqPWIudWlEaWFsb2cuY3NzKFwicG9zaXRpb25cIik7Zz10eXBlb2YgZz09PVwic3RyaW5nXCI/ZzpcIm4sZSxzLHcsc2Usc3csbmUsbndcIjtiLnVpRGlhbG9nLnJlc2l6YWJsZSh7Y2FuY2VsOlwiLnVpLWRpYWxvZy1jb250ZW50XCIsY29udGFpbm1lbnQ6XCJkb2N1bWVudFwiLGFsc29SZXNpemU6Yi5lbGVtZW50LG1heFdpZHRoOmYubWF4V2lkdGgsbWF4SGVpZ2h0OmYubWF4SGVpZ2h0LG1pbldpZHRoOmYubWluV2lkdGgsbWluSGVpZ2h0OmIuX21pbkhlaWdodCgpLGhhbmRsZXM6ZyxzdGFydDpmdW5jdGlvbihsLG8pe2EodGhpcykuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctcmVzaXppbmdcIik7Yi5fdHJpZ2dlcihcInJlc2l6ZVN0YXJ0XCIsbCxpKG8pKX0scmVzaXplOmZ1bmN0aW9uKGwsbyl7Yi5fdHJpZ2dlcihcInJlc2l6ZVwiLFxubCxpKG8pKX0sc3RvcDpmdW5jdGlvbihsLG8pe2EodGhpcykucmVtb3ZlQ2xhc3MoXCJ1aS1kaWFsb2ctcmVzaXppbmdcIik7Zi5oZWlnaHQ9YSh0aGlzKS5oZWlnaHQoKTtmLndpZHRoPWEodGhpcykud2lkdGgoKTtiLl90cmlnZ2VyKFwicmVzaXplU3RvcFwiLGwsaShvKSk7YS51aS5kaWFsb2cub3ZlcmxheS5yZXNpemUoKX19KS5jc3MoXCJwb3NpdGlvblwiLGopLmZpbmQoXCIudWktcmVzaXphYmxlLXNlXCIpLmFkZENsYXNzKFwidWktaWNvbiB1aS1pY29uLWdyaXAtZGlhZ29uYWwtc2VcIil9LF9taW5IZWlnaHQ6ZnVuY3Rpb24oKXt2YXIgZz10aGlzLm9wdGlvbnM7cmV0dXJuIGcuaGVpZ2h0PT09XCJhdXRvXCI/Zy5taW5IZWlnaHQ6TWF0aC5taW4oZy5taW5IZWlnaHQsZy5oZWlnaHQpfSxfcG9zaXRpb246ZnVuY3Rpb24oZyl7dmFyIGk9W10sYj1bMCwwXSxmO2lmKGcpe2lmKHR5cGVvZiBnPT09XCJzdHJpbmdcInx8dHlwZW9mIGc9PT1cIm9iamVjdFwiJiZcIjBcImluIGcpe2k9Zy5zcGxpdD9nLnNwbGl0KFwiIFwiKTpcbltnWzBdLGdbMV1dO2lmKGkubGVuZ3RoPT09MSlpWzFdPWlbMF07YS5lYWNoKFtcImxlZnRcIixcInRvcFwiXSxmdW5jdGlvbihqLGwpe2lmKCtpW2pdPT09aVtqXSl7YltqXT1pW2pdO2lbal09bH19KTtnPXtteTppLmpvaW4oXCIgXCIpLGF0Omkuam9pbihcIiBcIiksb2Zmc2V0OmIuam9pbihcIiBcIil9fWc9YS5leHRlbmQoe30sYS51aS5kaWFsb2cucHJvdG90eXBlLm9wdGlvbnMucG9zaXRpb24sZyl9ZWxzZSBnPWEudWkuZGlhbG9nLnByb3RvdHlwZS5vcHRpb25zLnBvc2l0aW9uOyhmPXRoaXMudWlEaWFsb2cuaXMoXCI6dmlzaWJsZVwiKSl8fHRoaXMudWlEaWFsb2cuc2hvdygpO3RoaXMudWlEaWFsb2cuY3NzKHt0b3A6MCxsZWZ0OjB9KS5wb3NpdGlvbihhLmV4dGVuZCh7b2Y6d2luZG93fSxnKSk7Znx8dGhpcy51aURpYWxvZy5oaWRlKCl9LF9zZXRPcHRpb25zOmZ1bmN0aW9uKGcpe3ZhciBpPXRoaXMsYj17fSxmPWZhbHNlO2EuZWFjaChnLGZ1bmN0aW9uKGosbCl7aS5fc2V0T3B0aW9uKGosbCk7XG5pZihqIGluIGMpZj10cnVlO2lmKGogaW4gZSliW2pdPWx9KTtmJiZ0aGlzLl9zaXplKCk7dGhpcy51aURpYWxvZy5pcyhcIjpkYXRhKHJlc2l6YWJsZSlcIikmJnRoaXMudWlEaWFsb2cucmVzaXphYmxlKFwib3B0aW9uXCIsYil9LF9zZXRPcHRpb246ZnVuY3Rpb24oZyxpKXt2YXIgYj10aGlzLGY9Yi51aURpYWxvZztzd2l0Y2goZyl7Y2FzZSBcImJlZm9yZWNsb3NlXCI6Zz1cImJlZm9yZUNsb3NlXCI7YnJlYWs7Y2FzZSBcImJ1dHRvbnNcIjpiLl9jcmVhdGVCdXR0b25zKGkpO2JyZWFrO2Nhc2UgXCJjbG9zZVRleHRcIjpiLnVpRGlhbG9nVGl0bGViYXJDbG9zZVRleHQudGV4dChcIlwiK2kpO2JyZWFrO2Nhc2UgXCJkaWFsb2dDbGFzc1wiOmYucmVtb3ZlQ2xhc3MoYi5vcHRpb25zLmRpYWxvZ0NsYXNzKS5hZGRDbGFzcyhcInVpLWRpYWxvZyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCBcIitpKTticmVhaztjYXNlIFwiZGlzYWJsZWRcIjppP2YuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctZGlzYWJsZWRcIik6XG5mLnJlbW92ZUNsYXNzKFwidWktZGlhbG9nLWRpc2FibGVkXCIpO2JyZWFrO2Nhc2UgXCJkcmFnZ2FibGVcIjp2YXIgaj1mLmlzKFwiOmRhdGEoZHJhZ2dhYmxlKVwiKTtqJiYhaSYmZi5kcmFnZ2FibGUoXCJkZXN0cm95XCIpOyFqJiZpJiZiLl9tYWtlRHJhZ2dhYmxlKCk7YnJlYWs7Y2FzZSBcInBvc2l0aW9uXCI6Yi5fcG9zaXRpb24oaSk7YnJlYWs7Y2FzZSBcInJlc2l6YWJsZVwiOihqPWYuaXMoXCI6ZGF0YShyZXNpemFibGUpXCIpKSYmIWkmJmYucmVzaXphYmxlKFwiZGVzdHJveVwiKTtqJiZ0eXBlb2YgaT09PVwic3RyaW5nXCImJmYucmVzaXphYmxlKFwib3B0aW9uXCIsXCJoYW5kbGVzXCIsaSk7IWomJmkhPT1mYWxzZSYmYi5fbWFrZVJlc2l6YWJsZShpKTticmVhaztjYXNlIFwidGl0bGVcIjphKFwiLnVpLWRpYWxvZy10aXRsZVwiLGIudWlEaWFsb2dUaXRsZWJhcikuaHRtbChcIlwiKyhpfHxcIiYjMTYwO1wiKSk7YnJlYWt9YS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkoYixhcmd1bWVudHMpfSxfc2l6ZTpmdW5jdGlvbigpe3ZhciBnPVxudGhpcy5vcHRpb25zLGksYixmPXRoaXMudWlEaWFsb2cuaXMoXCI6dmlzaWJsZVwiKTt0aGlzLmVsZW1lbnQuc2hvdygpLmNzcyh7d2lkdGg6XCJhdXRvXCIsbWluSGVpZ2h0OjAsaGVpZ2h0OjB9KTtpZihnLm1pbldpZHRoPmcud2lkdGgpZy53aWR0aD1nLm1pbldpZHRoO2k9dGhpcy51aURpYWxvZy5jc3Moe2hlaWdodDpcImF1dG9cIix3aWR0aDpnLndpZHRofSkuaGVpZ2h0KCk7Yj1NYXRoLm1heCgwLGcubWluSGVpZ2h0LWkpO2lmKGcuaGVpZ2h0PT09XCJhdXRvXCIpaWYoYS5zdXBwb3J0Lm1pbkhlaWdodCl0aGlzLmVsZW1lbnQuY3NzKHttaW5IZWlnaHQ6YixoZWlnaHQ6XCJhdXRvXCJ9KTtlbHNle3RoaXMudWlEaWFsb2cuc2hvdygpO2c9dGhpcy5lbGVtZW50LmNzcyhcImhlaWdodFwiLFwiYXV0b1wiKS5oZWlnaHQoKTtmfHx0aGlzLnVpRGlhbG9nLmhpZGUoKTt0aGlzLmVsZW1lbnQuaGVpZ2h0KE1hdGgubWF4KGcsYikpfWVsc2UgdGhpcy5lbGVtZW50LmhlaWdodChNYXRoLm1heChnLmhlaWdodC1cbmksMCkpO3RoaXMudWlEaWFsb2cuaXMoXCI6ZGF0YShyZXNpemFibGUpXCIpJiZ0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZShcIm9wdGlvblwiLFwibWluSGVpZ2h0XCIsdGhpcy5fbWluSGVpZ2h0KCkpfX0pO2EuZXh0ZW5kKGEudWkuZGlhbG9nLHt2ZXJzaW9uOlwiMS44LjE2XCIsdXVpZDowLG1heFo6MCxnZXRUaXRsZUlkOmZ1bmN0aW9uKGcpe2c9Zy5hdHRyKFwiaWRcIik7aWYoIWcpe3RoaXMudXVpZCs9MTtnPXRoaXMudXVpZH1yZXR1cm5cInVpLWRpYWxvZy10aXRsZS1cIitnfSxvdmVybGF5OmZ1bmN0aW9uKGcpe3RoaXMuJGVsPWEudWkuZGlhbG9nLm92ZXJsYXkuY3JlYXRlKGcpfX0pO2EuZXh0ZW5kKGEudWkuZGlhbG9nLm92ZXJsYXkse2luc3RhbmNlczpbXSxvbGRJbnN0YW5jZXM6W10sbWF4WjowLGV2ZW50czphLm1hcChcImZvY3VzLG1vdXNlZG93bixtb3VzZXVwLGtleWRvd24sa2V5cHJlc3MsY2xpY2tcIi5zcGxpdChcIixcIiksZnVuY3Rpb24oZyl7cmV0dXJuIGcrXCIuZGlhbG9nLW92ZXJsYXlcIn0pLmpvaW4oXCIgXCIpLFxuY3JlYXRlOmZ1bmN0aW9uKGcpe2lmKHRoaXMuaW5zdGFuY2VzLmxlbmd0aD09PTApe3NldFRpbWVvdXQoZnVuY3Rpb24oKXthLnVpLmRpYWxvZy5vdmVybGF5Lmluc3RhbmNlcy5sZW5ndGgmJmEoZG9jdW1lbnQpLmJpbmQoYS51aS5kaWFsb2cub3ZlcmxheS5ldmVudHMsZnVuY3Rpb24oYil7aWYoYShiLnRhcmdldCkuekluZGV4KCk8YS51aS5kaWFsb2cub3ZlcmxheS5tYXhaKXJldHVybiBmYWxzZX0pfSwxKTthKGRvY3VtZW50KS5iaW5kKFwia2V5ZG93bi5kaWFsb2ctb3ZlcmxheVwiLGZ1bmN0aW9uKGIpe2lmKGcub3B0aW9ucy5jbG9zZU9uRXNjYXBlJiYhYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmYi5rZXlDb2RlJiZiLmtleUNvZGU9PT1hLnVpLmtleUNvZGUuRVNDQVBFKXtnLmNsb3NlKGIpO2IucHJldmVudERlZmF1bHQoKX19KTthKHdpbmRvdykuYmluZChcInJlc2l6ZS5kaWFsb2ctb3ZlcmxheVwiLGEudWkuZGlhbG9nLm92ZXJsYXkucmVzaXplKX12YXIgaT0odGhpcy5vbGRJbnN0YW5jZXMucG9wKCl8fFxuYShcIjxkaXY+PC9kaXY+XCIpLmFkZENsYXNzKFwidWktd2lkZ2V0LW92ZXJsYXlcIikpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLmNzcyh7d2lkdGg6dGhpcy53aWR0aCgpLGhlaWdodDp0aGlzLmhlaWdodCgpfSk7YS5mbi5iZ2lmcmFtZSYmaS5iZ2lmcmFtZSgpO3RoaXMuaW5zdGFuY2VzLnB1c2goaSk7cmV0dXJuIGl9LGRlc3Ryb3k6ZnVuY3Rpb24oZyl7dmFyIGk9YS5pbkFycmF5KGcsdGhpcy5pbnN0YW5jZXMpO2khPS0xJiZ0aGlzLm9sZEluc3RhbmNlcy5wdXNoKHRoaXMuaW5zdGFuY2VzLnNwbGljZShpLDEpWzBdKTt0aGlzLmluc3RhbmNlcy5sZW5ndGg9PT0wJiZhKFtkb2N1bWVudCx3aW5kb3ddKS51bmJpbmQoXCIuZGlhbG9nLW92ZXJsYXlcIik7Zy5yZW1vdmUoKTt2YXIgYj0wO2EuZWFjaCh0aGlzLmluc3RhbmNlcyxmdW5jdGlvbigpe2I9TWF0aC5tYXgoYix0aGlzLmNzcyhcInotaW5kZXhcIikpfSk7dGhpcy5tYXhaPWJ9LGhlaWdodDpmdW5jdGlvbigpe3ZhciBnLGk7aWYoYS5icm93c2VyLm1zaWUmJlxuYS5icm93c2VyLnZlcnNpb248Nyl7Zz1NYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0LGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0KTtpPU1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQsZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQpO3JldHVybiBnPGk/YSh3aW5kb3cpLmhlaWdodCgpK1wicHhcIjpnK1wicHhcIn1lbHNlIHJldHVybiBhKGRvY3VtZW50KS5oZWlnaHQoKStcInB4XCJ9LHdpZHRoOmZ1bmN0aW9uKCl7dmFyIGcsaTtpZihhLmJyb3dzZXIubXNpZSl7Zz1NYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsV2lkdGgsZG9jdW1lbnQuYm9keS5zY3JvbGxXaWR0aCk7aT1NYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGgsZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aCk7cmV0dXJuIGc8aT9hKHdpbmRvdykud2lkdGgoKStcInB4XCI6ZytcInB4XCJ9ZWxzZSByZXR1cm4gYShkb2N1bWVudCkud2lkdGgoKStcblwicHhcIn0scmVzaXplOmZ1bmN0aW9uKCl7dmFyIGc9YShbXSk7YS5lYWNoKGEudWkuZGlhbG9nLm92ZXJsYXkuaW5zdGFuY2VzLGZ1bmN0aW9uKCl7Zz1nLmFkZCh0aGlzKX0pO2cuY3NzKHt3aWR0aDowLGhlaWdodDowfSkuY3NzKHt3aWR0aDphLnVpLmRpYWxvZy5vdmVybGF5LndpZHRoKCksaGVpZ2h0OmEudWkuZGlhbG9nLm92ZXJsYXkuaGVpZ2h0KCl9KX19KTthLmV4dGVuZChhLnVpLmRpYWxvZy5vdmVybGF5LnByb3RvdHlwZSx7ZGVzdHJveTpmdW5jdGlvbigpe2EudWkuZGlhbG9nLm92ZXJsYXkuZGVzdHJveSh0aGlzLiRlbCl9fSl9KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEpe2EudWk9YS51aXx8e307dmFyIGQ9L2xlZnR8Y2VudGVyfHJpZ2h0LyxjPS90b3B8Y2VudGVyfGJvdHRvbS8sZT1hLmZuLnBvc2l0aW9uLGg9YS5mbi5vZmZzZXQ7YS5mbi5wb3NpdGlvbj1mdW5jdGlvbihnKXtpZighZ3x8IWcub2YpcmV0dXJuIGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO2c9YS5leHRlbmQoe30sZyk7dmFyIGk9YShnLm9mKSxiPWlbMF0sZj0oZy5jb2xsaXNpb258fFwiZmxpcFwiKS5zcGxpdChcIiBcIiksaj1nLm9mZnNldD9nLm9mZnNldC5zcGxpdChcIiBcIik6WzAsMF0sbCxvLG47aWYoYi5ub2RlVHlwZT09PTkpe2w9aS53aWR0aCgpO289aS5oZWlnaHQoKTtuPXt0b3A6MCxsZWZ0OjB9fWVsc2UgaWYoYi5zZXRUaW1lb3V0KXtsPWkud2lkdGgoKTtvPWkuaGVpZ2h0KCk7bj17dG9wOmkuc2Nyb2xsVG9wKCksbGVmdDppLnNjcm9sbExlZnQoKX19ZWxzZSBpZihiLnByZXZlbnREZWZhdWx0KXtnLmF0PVwibGVmdCB0b3BcIjtsPW89MDtuPXt0b3A6Zy5vZi5wYWdlWSxcbmxlZnQ6Zy5vZi5wYWdlWH19ZWxzZXtsPWkub3V0ZXJXaWR0aCgpO289aS5vdXRlckhlaWdodCgpO249aS5vZmZzZXQoKX1hLmVhY2goW1wibXlcIixcImF0XCJdLGZ1bmN0aW9uKCl7dmFyIGs9KGdbdGhpc118fFwiXCIpLnNwbGl0KFwiIFwiKTtpZihrLmxlbmd0aD09PTEpaz1kLnRlc3Qoa1swXSk/ay5jb25jYXQoW1wiY2VudGVyXCJdKTpjLnRlc3Qoa1swXSk/W1wiY2VudGVyXCJdLmNvbmNhdChrKTpbXCJjZW50ZXJcIixcImNlbnRlclwiXTtrWzBdPWQudGVzdChrWzBdKT9rWzBdOlwiY2VudGVyXCI7a1sxXT1jLnRlc3Qoa1sxXSk/a1sxXTpcImNlbnRlclwiO2dbdGhpc109a30pO2lmKGYubGVuZ3RoPT09MSlmWzFdPWZbMF07alswXT1wYXJzZUludChqWzBdLDEwKXx8MDtpZihqLmxlbmd0aD09PTEpalsxXT1qWzBdO2pbMV09cGFyc2VJbnQoalsxXSwxMCl8fDA7aWYoZy5hdFswXT09PVwicmlnaHRcIiluLmxlZnQrPWw7ZWxzZSBpZihnLmF0WzBdPT09XCJjZW50ZXJcIiluLmxlZnQrPWwvMjtpZihnLmF0WzFdPT09XCJib3R0b21cIiluLnRvcCs9XG5vO2Vsc2UgaWYoZy5hdFsxXT09PVwiY2VudGVyXCIpbi50b3ArPW8vMjtuLmxlZnQrPWpbMF07bi50b3ArPWpbMV07cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBrPWEodGhpcyksbT1rLm91dGVyV2lkdGgoKSxwPWsub3V0ZXJIZWlnaHQoKSxxPXBhcnNlSW50KGEuY3VyQ1NTKHRoaXMsXCJtYXJnaW5MZWZ0XCIsdHJ1ZSkpfHwwLHM9cGFyc2VJbnQoYS5jdXJDU1ModGhpcyxcIm1hcmdpblRvcFwiLHRydWUpKXx8MCxyPW0rcSsocGFyc2VJbnQoYS5jdXJDU1ModGhpcyxcIm1hcmdpblJpZ2h0XCIsdHJ1ZSkpfHwwKSx1PXArcysocGFyc2VJbnQoYS5jdXJDU1ModGhpcyxcIm1hcmdpbkJvdHRvbVwiLHRydWUpKXx8MCksdj1hLmV4dGVuZCh7fSxuKSx3O2lmKGcubXlbMF09PT1cInJpZ2h0XCIpdi5sZWZ0LT1tO2Vsc2UgaWYoZy5teVswXT09PVwiY2VudGVyXCIpdi5sZWZ0LT1tLzI7aWYoZy5teVsxXT09PVwiYm90dG9tXCIpdi50b3AtPXA7ZWxzZSBpZihnLm15WzFdPT09XCJjZW50ZXJcIil2LnRvcC09XG5wLzI7di5sZWZ0PU1hdGgucm91bmQodi5sZWZ0KTt2LnRvcD1NYXRoLnJvdW5kKHYudG9wKTt3PXtsZWZ0OnYubGVmdC1xLHRvcDp2LnRvcC1zfTthLmVhY2goW1wibGVmdFwiLFwidG9wXCJdLGZ1bmN0aW9uKHgseSl7YS51aS5wb3NpdGlvbltmW3hdXSYmYS51aS5wb3NpdGlvbltmW3hdXVt5XSh2LHt0YXJnZXRXaWR0aDpsLHRhcmdldEhlaWdodDpvLGVsZW1XaWR0aDptLGVsZW1IZWlnaHQ6cCxjb2xsaXNpb25Qb3NpdGlvbjp3LGNvbGxpc2lvbldpZHRoOnIsY29sbGlzaW9uSGVpZ2h0OnUsb2Zmc2V0OmosbXk6Zy5teSxhdDpnLmF0fSl9KTthLmZuLmJnaWZyYW1lJiZrLmJnaWZyYW1lKCk7ay5vZmZzZXQoYS5leHRlbmQodix7dXNpbmc6Zy51c2luZ30pKX0pfTthLnVpLnBvc2l0aW9uPXtmaXQ6e2xlZnQ6ZnVuY3Rpb24oZyxpKXt2YXIgYj1hKHdpbmRvdyk7Yj1pLmNvbGxpc2lvblBvc2l0aW9uLmxlZnQraS5jb2xsaXNpb25XaWR0aC1iLndpZHRoKCktYi5zY3JvbGxMZWZ0KCk7Zy5sZWZ0PVxuYj4wP2cubGVmdC1iOk1hdGgubWF4KGcubGVmdC1pLmNvbGxpc2lvblBvc2l0aW9uLmxlZnQsZy5sZWZ0KX0sdG9wOmZ1bmN0aW9uKGcsaSl7dmFyIGI9YSh3aW5kb3cpO2I9aS5jb2xsaXNpb25Qb3NpdGlvbi50b3AraS5jb2xsaXNpb25IZWlnaHQtYi5oZWlnaHQoKS1iLnNjcm9sbFRvcCgpO2cudG9wPWI+MD9nLnRvcC1iOk1hdGgubWF4KGcudG9wLWkuY29sbGlzaW9uUG9zaXRpb24udG9wLGcudG9wKX19LGZsaXA6e2xlZnQ6ZnVuY3Rpb24oZyxpKXtpZihpLmF0WzBdIT09XCJjZW50ZXJcIil7dmFyIGI9YSh3aW5kb3cpO2I9aS5jb2xsaXNpb25Qb3NpdGlvbi5sZWZ0K2kuY29sbGlzaW9uV2lkdGgtYi53aWR0aCgpLWIuc2Nyb2xsTGVmdCgpO3ZhciBmPWkubXlbMF09PT1cImxlZnRcIj8taS5lbGVtV2lkdGg6aS5teVswXT09PVwicmlnaHRcIj9pLmVsZW1XaWR0aDowLGo9aS5hdFswXT09PVwibGVmdFwiP2kudGFyZ2V0V2lkdGg6LWkudGFyZ2V0V2lkdGgsbD0tMippLm9mZnNldFswXTtnLmxlZnQrPVxuaS5jb2xsaXNpb25Qb3NpdGlvbi5sZWZ0PDA/ZitqK2w6Yj4wP2YraitsOjB9fSx0b3A6ZnVuY3Rpb24oZyxpKXtpZihpLmF0WzFdIT09XCJjZW50ZXJcIil7dmFyIGI9YSh3aW5kb3cpO2I9aS5jb2xsaXNpb25Qb3NpdGlvbi50b3AraS5jb2xsaXNpb25IZWlnaHQtYi5oZWlnaHQoKS1iLnNjcm9sbFRvcCgpO3ZhciBmPWkubXlbMV09PT1cInRvcFwiPy1pLmVsZW1IZWlnaHQ6aS5teVsxXT09PVwiYm90dG9tXCI/aS5lbGVtSGVpZ2h0OjAsaj1pLmF0WzFdPT09XCJ0b3BcIj9pLnRhcmdldEhlaWdodDotaS50YXJnZXRIZWlnaHQsbD0tMippLm9mZnNldFsxXTtnLnRvcCs9aS5jb2xsaXNpb25Qb3NpdGlvbi50b3A8MD9mK2orbDpiPjA/ZitqK2w6MH19fX07aWYoIWEub2Zmc2V0LnNldE9mZnNldCl7YS5vZmZzZXQuc2V0T2Zmc2V0PWZ1bmN0aW9uKGcsaSl7aWYoL3N0YXRpYy8udGVzdChhLmN1ckNTUyhnLFwicG9zaXRpb25cIikpKWcuc3R5bGUucG9zaXRpb249XCJyZWxhdGl2ZVwiO3ZhciBiPWEoZyksXG5mPWIub2Zmc2V0KCksaj1wYXJzZUludChhLmN1ckNTUyhnLFwidG9wXCIsdHJ1ZSksMTApfHwwLGw9cGFyc2VJbnQoYS5jdXJDU1MoZyxcImxlZnRcIix0cnVlKSwxMCl8fDA7Zj17dG9wOmkudG9wLWYudG9wK2osbGVmdDppLmxlZnQtZi5sZWZ0K2x9O1widXNpbmdcImluIGk/aS51c2luZy5jYWxsKGcsZik6Yi5jc3MoZil9O2EuZm4ub2Zmc2V0PWZ1bmN0aW9uKGcpe3ZhciBpPXRoaXNbMF07aWYoIWl8fCFpLm93bmVyRG9jdW1lbnQpcmV0dXJuIG51bGw7aWYoZylyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7YS5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsZyl9KTtyZXR1cm4gaC5jYWxsKHRoaXMpfX19KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGEsZCl7YS53aWRnZXQoXCJ1aS5wcm9ncmVzc2JhclwiLHtvcHRpb25zOnt2YWx1ZTowLG1heDoxMDB9LG1pbjowLF9jcmVhdGU6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1wcm9ncmVzc2JhciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbFwiKS5hdHRyKHtyb2xlOlwicHJvZ3Jlc3NiYXJcIixcImFyaWEtdmFsdWVtaW5cIjp0aGlzLm1pbixcImFyaWEtdmFsdWVtYXhcIjp0aGlzLm9wdGlvbnMubWF4LFwiYXJpYS12YWx1ZW5vd1wiOnRoaXMuX3ZhbHVlKCl9KTt0aGlzLnZhbHVlRGl2PWEoXCI8ZGl2IGNsYXNzPSd1aS1wcm9ncmVzc2Jhci12YWx1ZSB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1sZWZ0Jz48L2Rpdj5cIikuYXBwZW5kVG8odGhpcy5lbGVtZW50KTt0aGlzLm9sZFZhbHVlPXRoaXMuX3ZhbHVlKCk7dGhpcy5fcmVmcmVzaFZhbHVlKCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1wcm9ncmVzc2JhciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbFwiKS5yZW1vdmVBdHRyKFwicm9sZVwiKS5yZW1vdmVBdHRyKFwiYXJpYS12YWx1ZW1pblwiKS5yZW1vdmVBdHRyKFwiYXJpYS12YWx1ZW1heFwiKS5yZW1vdmVBdHRyKFwiYXJpYS12YWx1ZW5vd1wiKTtcbnRoaXMudmFsdWVEaXYucmVtb3ZlKCk7YS5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuYXBwbHkodGhpcyxhcmd1bWVudHMpfSx2YWx1ZTpmdW5jdGlvbihjKXtpZihjPT09ZClyZXR1cm4gdGhpcy5fdmFsdWUoKTt0aGlzLl9zZXRPcHRpb24oXCJ2YWx1ZVwiLGMpO3JldHVybiB0aGlzfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGMsZSl7aWYoYz09PVwidmFsdWVcIil7dGhpcy5vcHRpb25zLnZhbHVlPWU7dGhpcy5fcmVmcmVzaFZhbHVlKCk7dGhpcy5fdmFsdWUoKT09PXRoaXMub3B0aW9ucy5tYXgmJnRoaXMuX3RyaWdnZXIoXCJjb21wbGV0ZVwiKX1hLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LF92YWx1ZTpmdW5jdGlvbigpe3ZhciBjPXRoaXMub3B0aW9ucy52YWx1ZTtpZih0eXBlb2YgYyE9PVwibnVtYmVyXCIpYz0wO3JldHVybiBNYXRoLm1pbih0aGlzLm9wdGlvbnMubWF4LE1hdGgubWF4KHRoaXMubWluLGMpKX0sX3BlcmNlbnRhZ2U6ZnVuY3Rpb24oKXtyZXR1cm4gMTAwKlxudGhpcy5fdmFsdWUoKS90aGlzLm9wdGlvbnMubWF4fSxfcmVmcmVzaFZhbHVlOmZ1bmN0aW9uKCl7dmFyIGM9dGhpcy52YWx1ZSgpLGU9dGhpcy5fcGVyY2VudGFnZSgpO2lmKHRoaXMub2xkVmFsdWUhPT1jKXt0aGlzLm9sZFZhbHVlPWM7dGhpcy5fdHJpZ2dlcihcImNoYW5nZVwiKX10aGlzLnZhbHVlRGl2LnRvZ2dsZShjPnRoaXMubWluKS50b2dnbGVDbGFzcyhcInVpLWNvcm5lci1yaWdodFwiLGM9PT10aGlzLm9wdGlvbnMubWF4KS53aWR0aChlLnRvRml4ZWQoMCkrXCIlXCIpO3RoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS12YWx1ZW5vd1wiLGMpfX0pO2EuZXh0ZW5kKGEudWkucHJvZ3Jlc3NiYXIse3ZlcnNpb246XCIxLjguMTZcIn0pfSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhKXthLndpZGdldChcInVpLnNsaWRlclwiLGEudWkubW91c2Use3dpZGdldEV2ZW50UHJlZml4Olwic2xpZGVcIixvcHRpb25zOnthbmltYXRlOmZhbHNlLGRpc3RhbmNlOjAsbWF4OjEwMCxtaW46MCxvcmllbnRhdGlvbjpcImhvcml6b250YWxcIixyYW5nZTpmYWxzZSxzdGVwOjEsdmFsdWU6MCx2YWx1ZXM6bnVsbH0sX2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBkPXRoaXMsYz10aGlzLm9wdGlvbnMsZT10aGlzLmVsZW1lbnQuZmluZChcIi51aS1zbGlkZXItaGFuZGxlXCIpLmFkZENsYXNzKFwidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsXCIpLGg9Yy52YWx1ZXMmJmMudmFsdWVzLmxlbmd0aHx8MSxnPVtdO3RoaXMuX21vdXNlU2xpZGluZz10aGlzLl9rZXlTbGlkaW5nPWZhbHNlO3RoaXMuX2FuaW1hdGVPZmY9dHJ1ZTt0aGlzLl9oYW5kbGVJbmRleD1udWxsO3RoaXMuX2RldGVjdE9yaWVudGF0aW9uKCk7dGhpcy5fbW91c2VJbml0KCk7dGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktc2xpZGVyIHVpLXNsaWRlci1cIitcbnRoaXMub3JpZW50YXRpb24rXCIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGxcIisoYy5kaXNhYmxlZD9cIiB1aS1zbGlkZXItZGlzYWJsZWQgdWktZGlzYWJsZWRcIjpcIlwiKSk7dGhpcy5yYW5nZT1hKFtdKTtpZihjLnJhbmdlKXtpZihjLnJhbmdlPT09dHJ1ZSl7aWYoIWMudmFsdWVzKWMudmFsdWVzPVt0aGlzLl92YWx1ZU1pbigpLHRoaXMuX3ZhbHVlTWluKCldO2lmKGMudmFsdWVzLmxlbmd0aCYmYy52YWx1ZXMubGVuZ3RoIT09MiljLnZhbHVlcz1bYy52YWx1ZXNbMF0sYy52YWx1ZXNbMF1dfXRoaXMucmFuZ2U9YShcIjxkaXY+PC9kaXY+XCIpLmFwcGVuZFRvKHRoaXMuZWxlbWVudCkuYWRkQ2xhc3MoXCJ1aS1zbGlkZXItcmFuZ2UgdWktd2lkZ2V0LWhlYWRlclwiKyhjLnJhbmdlPT09XCJtaW5cInx8Yy5yYW5nZT09PVwibWF4XCI/XCIgdWktc2xpZGVyLXJhbmdlLVwiK2MucmFuZ2U6XCJcIikpfWZvcih2YXIgaT1lLmxlbmd0aDtpPGg7aSs9MSlnLnB1c2goXCI8YSBjbGFzcz0ndWktc2xpZGVyLWhhbmRsZSB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwnIGhyZWY9JyMnPjwvYT5cIik7XG50aGlzLmhhbmRsZXM9ZS5hZGQoYShnLmpvaW4oXCJcIikpLmFwcGVuZFRvKGQuZWxlbWVudCkpO3RoaXMuaGFuZGxlPXRoaXMuaGFuZGxlcy5lcSgwKTt0aGlzLmhhbmRsZXMuYWRkKHRoaXMucmFuZ2UpLmZpbHRlcihcImFcIikuY2xpY2soZnVuY3Rpb24oYil7Yi5wcmV2ZW50RGVmYXVsdCgpfSkuaG92ZXIoZnVuY3Rpb24oKXtjLmRpc2FibGVkfHxhKHRoaXMpLmFkZENsYXNzKFwidWktc3RhdGUtaG92ZXJcIil9LGZ1bmN0aW9uKCl7YSh0aGlzKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpfSkuZm9jdXMoZnVuY3Rpb24oKXtpZihjLmRpc2FibGVkKWEodGhpcykuYmx1cigpO2Vsc2V7YShcIi51aS1zbGlkZXIgLnVpLXN0YXRlLWZvY3VzXCIpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIik7YSh0aGlzKS5hZGRDbGFzcyhcInVpLXN0YXRlLWZvY3VzXCIpfX0pLmJsdXIoZnVuY3Rpb24oKXthKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9KTt0aGlzLmhhbmRsZXMuZWFjaChmdW5jdGlvbihiKXthKHRoaXMpLmRhdGEoXCJpbmRleC51aS1zbGlkZXItaGFuZGxlXCIsXG5iKX0pO3RoaXMuaGFuZGxlcy5rZXlkb3duKGZ1bmN0aW9uKGIpe3ZhciBmPXRydWUsaj1hKHRoaXMpLmRhdGEoXCJpbmRleC51aS1zbGlkZXItaGFuZGxlXCIpLGwsbyxuO2lmKCFkLm9wdGlvbnMuZGlzYWJsZWQpe3N3aXRjaChiLmtleUNvZGUpe2Nhc2UgYS51aS5rZXlDb2RlLkhPTUU6Y2FzZSBhLnVpLmtleUNvZGUuRU5EOmNhc2UgYS51aS5rZXlDb2RlLlBBR0VfVVA6Y2FzZSBhLnVpLmtleUNvZGUuUEFHRV9ET1dOOmNhc2UgYS51aS5rZXlDb2RlLlVQOmNhc2UgYS51aS5rZXlDb2RlLlJJR0hUOmNhc2UgYS51aS5rZXlDb2RlLkRPV046Y2FzZSBhLnVpLmtleUNvZGUuTEVGVDpmPWZhbHNlO2lmKCFkLl9rZXlTbGlkaW5nKXtkLl9rZXlTbGlkaW5nPXRydWU7YSh0aGlzKS5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKTtsPWQuX3N0YXJ0KGIsaik7aWYobD09PWZhbHNlKXJldHVybn1icmVha31uPWQub3B0aW9ucy5zdGVwO2w9ZC5vcHRpb25zLnZhbHVlcyYmZC5vcHRpb25zLnZhbHVlcy5sZW5ndGg/XG4obz1kLnZhbHVlcyhqKSk6KG89ZC52YWx1ZSgpKTtzd2l0Y2goYi5rZXlDb2RlKXtjYXNlIGEudWkua2V5Q29kZS5IT01FOm89ZC5fdmFsdWVNaW4oKTticmVhaztjYXNlIGEudWkua2V5Q29kZS5FTkQ6bz1kLl92YWx1ZU1heCgpO2JyZWFrO2Nhc2UgYS51aS5rZXlDb2RlLlBBR0VfVVA6bz1kLl90cmltQWxpZ25WYWx1ZShsKyhkLl92YWx1ZU1heCgpLWQuX3ZhbHVlTWluKCkpLzUpO2JyZWFrO2Nhc2UgYS51aS5rZXlDb2RlLlBBR0VfRE9XTjpvPWQuX3RyaW1BbGlnblZhbHVlKGwtKGQuX3ZhbHVlTWF4KCktZC5fdmFsdWVNaW4oKSkvNSk7YnJlYWs7Y2FzZSBhLnVpLmtleUNvZGUuVVA6Y2FzZSBhLnVpLmtleUNvZGUuUklHSFQ6aWYobD09PWQuX3ZhbHVlTWF4KCkpcmV0dXJuO289ZC5fdHJpbUFsaWduVmFsdWUobCtuKTticmVhaztjYXNlIGEudWkua2V5Q29kZS5ET1dOOmNhc2UgYS51aS5rZXlDb2RlLkxFRlQ6aWYobD09PWQuX3ZhbHVlTWluKCkpcmV0dXJuO289ZC5fdHJpbUFsaWduVmFsdWUobC1cbm4pO2JyZWFrfWQuX3NsaWRlKGIsaixvKTtyZXR1cm4gZn19KS5rZXl1cChmdW5jdGlvbihiKXt2YXIgZj1hKHRoaXMpLmRhdGEoXCJpbmRleC51aS1zbGlkZXItaGFuZGxlXCIpO2lmKGQuX2tleVNsaWRpbmcpe2QuX2tleVNsaWRpbmc9ZmFsc2U7ZC5fc3RvcChiLGYpO2QuX2NoYW5nZShiLGYpO2EodGhpcykucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIil9fSk7dGhpcy5fcmVmcmVzaFZhbHVlKCk7dGhpcy5fYW5pbWF0ZU9mZj1mYWxzZX0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuaGFuZGxlcy5yZW1vdmUoKTt0aGlzLnJhbmdlLnJlbW92ZSgpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXNsaWRlciB1aS1zbGlkZXItaG9yaXpvbnRhbCB1aS1zbGlkZXItdmVydGljYWwgdWktc2xpZGVyLWRpc2FibGVkIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsXCIpLnJlbW92ZURhdGEoXCJzbGlkZXJcIikudW5iaW5kKFwiLnNsaWRlclwiKTt0aGlzLl9tb3VzZURlc3Ryb3koKTtcbnJldHVybiB0aGlzfSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKGQpe3ZhciBjPXRoaXMub3B0aW9ucyxlLGgsZyxpLGI7aWYoYy5kaXNhYmxlZClyZXR1cm4gZmFsc2U7dGhpcy5lbGVtZW50U2l6ZT17d2lkdGg6dGhpcy5lbGVtZW50Lm91dGVyV2lkdGgoKSxoZWlnaHQ6dGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCl9O3RoaXMuZWxlbWVudE9mZnNldD10aGlzLmVsZW1lbnQub2Zmc2V0KCk7ZT10aGlzLl9ub3JtVmFsdWVGcm9tTW91c2Uoe3g6ZC5wYWdlWCx5OmQucGFnZVl9KTtoPXRoaXMuX3ZhbHVlTWF4KCktdGhpcy5fdmFsdWVNaW4oKSsxO2k9dGhpczt0aGlzLmhhbmRsZXMuZWFjaChmdW5jdGlvbihmKXt2YXIgaj1NYXRoLmFicyhlLWkudmFsdWVzKGYpKTtpZihoPmope2g9ajtnPWEodGhpcyk7Yj1mfX0pO2lmKGMucmFuZ2U9PT10cnVlJiZ0aGlzLnZhbHVlcygxKT09PWMubWluKXtiKz0xO2c9YSh0aGlzLmhhbmRsZXNbYl0pfWlmKHRoaXMuX3N0YXJ0KGQsYik9PT1mYWxzZSlyZXR1cm4gZmFsc2U7XG50aGlzLl9tb3VzZVNsaWRpbmc9dHJ1ZTtpLl9oYW5kbGVJbmRleD1iO2cuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIikuZm9jdXMoKTtjPWcub2Zmc2V0KCk7dGhpcy5fY2xpY2tPZmZzZXQ9IWEoZC50YXJnZXQpLnBhcmVudHMoKS5hbmRTZWxmKCkuaXMoXCIudWktc2xpZGVyLWhhbmRsZVwiKT97bGVmdDowLHRvcDowfTp7bGVmdDpkLnBhZ2VYLWMubGVmdC1nLndpZHRoKCkvMix0b3A6ZC5wYWdlWS1jLnRvcC1nLmhlaWdodCgpLzItKHBhcnNlSW50KGcuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKS0ocGFyc2VJbnQoZy5jc3MoXCJib3JkZXJCb3R0b21XaWR0aFwiKSwxMCl8fDApKyhwYXJzZUludChnLmNzcyhcIm1hcmdpblRvcFwiKSwxMCl8fDApfTt0aGlzLmhhbmRsZXMuaGFzQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKXx8dGhpcy5fc2xpZGUoZCxiLGUpO3JldHVybiB0aGlzLl9hbmltYXRlT2ZmPXRydWV9LF9tb3VzZVN0YXJ0OmZ1bmN0aW9uKCl7cmV0dXJuIHRydWV9LF9tb3VzZURyYWc6ZnVuY3Rpb24oZCl7dmFyIGM9XG50aGlzLl9ub3JtVmFsdWVGcm9tTW91c2Uoe3g6ZC5wYWdlWCx5OmQucGFnZVl9KTt0aGlzLl9zbGlkZShkLHRoaXMuX2hhbmRsZUluZGV4LGMpO3JldHVybiBmYWxzZX0sX21vdXNlU3RvcDpmdW5jdGlvbihkKXt0aGlzLmhhbmRsZXMucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIik7dGhpcy5fbW91c2VTbGlkaW5nPWZhbHNlO3RoaXMuX3N0b3AoZCx0aGlzLl9oYW5kbGVJbmRleCk7dGhpcy5fY2hhbmdlKGQsdGhpcy5faGFuZGxlSW5kZXgpO3RoaXMuX2NsaWNrT2Zmc2V0PXRoaXMuX2hhbmRsZUluZGV4PW51bGw7cmV0dXJuIHRoaXMuX2FuaW1hdGVPZmY9ZmFsc2V9LF9kZXRlY3RPcmllbnRhdGlvbjpmdW5jdGlvbigpe3RoaXMub3JpZW50YXRpb249dGhpcy5vcHRpb25zLm9yaWVudGF0aW9uPT09XCJ2ZXJ0aWNhbFwiP1widmVydGljYWxcIjpcImhvcml6b250YWxcIn0sX25vcm1WYWx1ZUZyb21Nb3VzZTpmdW5jdGlvbihkKXt2YXIgYztpZih0aGlzLm9yaWVudGF0aW9uPT09XCJob3Jpem9udGFsXCIpe2M9XG50aGlzLmVsZW1lbnRTaXplLndpZHRoO2Q9ZC54LXRoaXMuZWxlbWVudE9mZnNldC5sZWZ0LSh0aGlzLl9jbGlja09mZnNldD90aGlzLl9jbGlja09mZnNldC5sZWZ0OjApfWVsc2V7Yz10aGlzLmVsZW1lbnRTaXplLmhlaWdodDtkPWQueS10aGlzLmVsZW1lbnRPZmZzZXQudG9wLSh0aGlzLl9jbGlja09mZnNldD90aGlzLl9jbGlja09mZnNldC50b3A6MCl9Yz1kL2M7aWYoYz4xKWM9MTtpZihjPDApYz0wO2lmKHRoaXMub3JpZW50YXRpb249PT1cInZlcnRpY2FsXCIpYz0xLWM7ZD10aGlzLl92YWx1ZU1heCgpLXRoaXMuX3ZhbHVlTWluKCk7cmV0dXJuIHRoaXMuX3RyaW1BbGlnblZhbHVlKHRoaXMuX3ZhbHVlTWluKCkrYypkKX0sX3N0YXJ0OmZ1bmN0aW9uKGQsYyl7dmFyIGU9e2hhbmRsZTp0aGlzLmhhbmRsZXNbY10sdmFsdWU6dGhpcy52YWx1ZSgpfTtpZih0aGlzLm9wdGlvbnMudmFsdWVzJiZ0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCl7ZS52YWx1ZT10aGlzLnZhbHVlcyhjKTtcbmUudmFsdWVzPXRoaXMudmFsdWVzKCl9cmV0dXJuIHRoaXMuX3RyaWdnZXIoXCJzdGFydFwiLGQsZSl9LF9zbGlkZTpmdW5jdGlvbihkLGMsZSl7dmFyIGg7aWYodGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGgpe2g9dGhpcy52YWx1ZXMoYz8wOjEpO2lmKHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoPT09MiYmdGhpcy5vcHRpb25zLnJhbmdlPT09dHJ1ZSYmKGM9PT0wJiZlPmh8fGM9PT0xJiZlPGgpKWU9aDtpZihlIT09dGhpcy52YWx1ZXMoYykpe2g9dGhpcy52YWx1ZXMoKTtoW2NdPWU7ZD10aGlzLl90cmlnZ2VyKFwic2xpZGVcIixkLHtoYW5kbGU6dGhpcy5oYW5kbGVzW2NdLHZhbHVlOmUsdmFsdWVzOmh9KTt0aGlzLnZhbHVlcyhjPzA6MSk7ZCE9PWZhbHNlJiZ0aGlzLnZhbHVlcyhjLGUsdHJ1ZSl9fWVsc2UgaWYoZSE9PXRoaXMudmFsdWUoKSl7ZD10aGlzLl90cmlnZ2VyKFwic2xpZGVcIixkLHtoYW5kbGU6dGhpcy5oYW5kbGVzW2NdLHZhbHVlOmV9KTtcbmQhPT1mYWxzZSYmdGhpcy52YWx1ZShlKX19LF9zdG9wOmZ1bmN0aW9uKGQsYyl7dmFyIGU9e2hhbmRsZTp0aGlzLmhhbmRsZXNbY10sdmFsdWU6dGhpcy52YWx1ZSgpfTtpZih0aGlzLm9wdGlvbnMudmFsdWVzJiZ0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCl7ZS52YWx1ZT10aGlzLnZhbHVlcyhjKTtlLnZhbHVlcz10aGlzLnZhbHVlcygpfXRoaXMuX3RyaWdnZXIoXCJzdG9wXCIsZCxlKX0sX2NoYW5nZTpmdW5jdGlvbihkLGMpe2lmKCF0aGlzLl9rZXlTbGlkaW5nJiYhdGhpcy5fbW91c2VTbGlkaW5nKXt2YXIgZT17aGFuZGxlOnRoaXMuaGFuZGxlc1tjXSx2YWx1ZTp0aGlzLnZhbHVlKCl9O2lmKHRoaXMub3B0aW9ucy52YWx1ZXMmJnRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoKXtlLnZhbHVlPXRoaXMudmFsdWVzKGMpO2UudmFsdWVzPXRoaXMudmFsdWVzKCl9dGhpcy5fdHJpZ2dlcihcImNoYW5nZVwiLGQsZSl9fSx2YWx1ZTpmdW5jdGlvbihkKXtpZihhcmd1bWVudHMubGVuZ3RoKXt0aGlzLm9wdGlvbnMudmFsdWU9XG50aGlzLl90cmltQWxpZ25WYWx1ZShkKTt0aGlzLl9yZWZyZXNoVmFsdWUoKTt0aGlzLl9jaGFuZ2UobnVsbCwwKX1lbHNlIHJldHVybiB0aGlzLl92YWx1ZSgpfSx2YWx1ZXM6ZnVuY3Rpb24oZCxjKXt2YXIgZSxoLGc7aWYoYXJndW1lbnRzLmxlbmd0aD4xKXt0aGlzLm9wdGlvbnMudmFsdWVzW2RdPXRoaXMuX3RyaW1BbGlnblZhbHVlKGMpO3RoaXMuX3JlZnJlc2hWYWx1ZSgpO3RoaXMuX2NoYW5nZShudWxsLGQpfWVsc2UgaWYoYXJndW1lbnRzLmxlbmd0aClpZihhLmlzQXJyYXkoYXJndW1lbnRzWzBdKSl7ZT10aGlzLm9wdGlvbnMudmFsdWVzO2g9YXJndW1lbnRzWzBdO2ZvcihnPTA7ZzxlLmxlbmd0aDtnKz0xKXtlW2ddPXRoaXMuX3RyaW1BbGlnblZhbHVlKGhbZ10pO3RoaXMuX2NoYW5nZShudWxsLGcpfXRoaXMuX3JlZnJlc2hWYWx1ZSgpfWVsc2UgcmV0dXJuIHRoaXMub3B0aW9ucy52YWx1ZXMmJnRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoP3RoaXMuX3ZhbHVlcyhkKTpcbnRoaXMudmFsdWUoKTtlbHNlIHJldHVybiB0aGlzLl92YWx1ZXMoKX0sX3NldE9wdGlvbjpmdW5jdGlvbihkLGMpe3ZhciBlLGg9MDtpZihhLmlzQXJyYXkodGhpcy5vcHRpb25zLnZhbHVlcykpaD10aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aDthLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7c3dpdGNoKGQpe2Nhc2UgXCJkaXNhYmxlZFwiOmlmKGMpe3RoaXMuaGFuZGxlcy5maWx0ZXIoXCIudWktc3RhdGUtZm9jdXNcIikuYmx1cigpO3RoaXMuaGFuZGxlcy5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpO3RoaXMuaGFuZGxlcy5wcm9wQXR0cihcImRpc2FibGVkXCIsdHJ1ZSk7dGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktZGlzYWJsZWRcIil9ZWxzZXt0aGlzLmhhbmRsZXMucHJvcEF0dHIoXCJkaXNhYmxlZFwiLGZhbHNlKTt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1kaXNhYmxlZFwiKX1icmVhaztjYXNlIFwib3JpZW50YXRpb25cIjp0aGlzLl9kZXRlY3RPcmllbnRhdGlvbigpO1xudGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc2xpZGVyLWhvcml6b250YWwgdWktc2xpZGVyLXZlcnRpY2FsXCIpLmFkZENsYXNzKFwidWktc2xpZGVyLVwiK3RoaXMub3JpZW50YXRpb24pO3RoaXMuX3JlZnJlc2hWYWx1ZSgpO2JyZWFrO2Nhc2UgXCJ2YWx1ZVwiOnRoaXMuX2FuaW1hdGVPZmY9dHJ1ZTt0aGlzLl9yZWZyZXNoVmFsdWUoKTt0aGlzLl9jaGFuZ2UobnVsbCwwKTt0aGlzLl9hbmltYXRlT2ZmPWZhbHNlO2JyZWFrO2Nhc2UgXCJ2YWx1ZXNcIjp0aGlzLl9hbmltYXRlT2ZmPXRydWU7dGhpcy5fcmVmcmVzaFZhbHVlKCk7Zm9yKGU9MDtlPGg7ZSs9MSl0aGlzLl9jaGFuZ2UobnVsbCxlKTt0aGlzLl9hbmltYXRlT2ZmPWZhbHNlO2JyZWFrfX0sX3ZhbHVlOmZ1bmN0aW9uKCl7dmFyIGQ9dGhpcy5vcHRpb25zLnZhbHVlO3JldHVybiBkPXRoaXMuX3RyaW1BbGlnblZhbHVlKGQpfSxfdmFsdWVzOmZ1bmN0aW9uKGQpe3ZhciBjLGU7aWYoYXJndW1lbnRzLmxlbmd0aCl7Yz10aGlzLm9wdGlvbnMudmFsdWVzW2RdO1xucmV0dXJuIGM9dGhpcy5fdHJpbUFsaWduVmFsdWUoYyl9ZWxzZXtjPXRoaXMub3B0aW9ucy52YWx1ZXMuc2xpY2UoKTtmb3IoZT0wO2U8Yy5sZW5ndGg7ZSs9MSljW2VdPXRoaXMuX3RyaW1BbGlnblZhbHVlKGNbZV0pO3JldHVybiBjfX0sX3RyaW1BbGlnblZhbHVlOmZ1bmN0aW9uKGQpe2lmKGQ8PXRoaXMuX3ZhbHVlTWluKCkpcmV0dXJuIHRoaXMuX3ZhbHVlTWluKCk7aWYoZD49dGhpcy5fdmFsdWVNYXgoKSlyZXR1cm4gdGhpcy5fdmFsdWVNYXgoKTt2YXIgYz10aGlzLm9wdGlvbnMuc3RlcD4wP3RoaXMub3B0aW9ucy5zdGVwOjEsZT0oZC10aGlzLl92YWx1ZU1pbigpKSVjO2Q9ZC1lO2lmKE1hdGguYWJzKGUpKjI+PWMpZCs9ZT4wP2M6LWM7cmV0dXJuIHBhcnNlRmxvYXQoZC50b0ZpeGVkKDUpKX0sX3ZhbHVlTWluOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5taW59LF92YWx1ZU1heDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMubWF4fSxfcmVmcmVzaFZhbHVlOmZ1bmN0aW9uKCl7dmFyIGQ9XG50aGlzLm9wdGlvbnMucmFuZ2UsYz10aGlzLm9wdGlvbnMsZT10aGlzLGg9IXRoaXMuX2FuaW1hdGVPZmY/Yy5hbmltYXRlOmZhbHNlLGcsaT17fSxiLGYsaixsO2lmKHRoaXMub3B0aW9ucy52YWx1ZXMmJnRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoKXRoaXMuaGFuZGxlcy5lYWNoKGZ1bmN0aW9uKG8pe2c9KGUudmFsdWVzKG8pLWUuX3ZhbHVlTWluKCkpLyhlLl92YWx1ZU1heCgpLWUuX3ZhbHVlTWluKCkpKjEwMDtpW2Uub3JpZW50YXRpb249PT1cImhvcml6b250YWxcIj9cImxlZnRcIjpcImJvdHRvbVwiXT1nK1wiJVwiO2EodGhpcykuc3RvcCgxLDEpW2g/XCJhbmltYXRlXCI6XCJjc3NcIl0oaSxjLmFuaW1hdGUpO2lmKGUub3B0aW9ucy5yYW5nZT09PXRydWUpaWYoZS5vcmllbnRhdGlvbj09PVwiaG9yaXpvbnRhbFwiKXtpZihvPT09MCllLnJhbmdlLnN0b3AoMSwxKVtoP1wiYW5pbWF0ZVwiOlwiY3NzXCJdKHtsZWZ0OmcrXCIlXCJ9LGMuYW5pbWF0ZSk7aWYobz09PTEpZS5yYW5nZVtoP1wiYW5pbWF0ZVwiOlwiY3NzXCJdKHt3aWR0aDpnLVxuYitcIiVcIn0se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmMuYW5pbWF0ZX0pfWVsc2V7aWYobz09PTApZS5yYW5nZS5zdG9wKDEsMSlbaD9cImFuaW1hdGVcIjpcImNzc1wiXSh7Ym90dG9tOmcrXCIlXCJ9LGMuYW5pbWF0ZSk7aWYobz09PTEpZS5yYW5nZVtoP1wiYW5pbWF0ZVwiOlwiY3NzXCJdKHtoZWlnaHQ6Zy1iK1wiJVwifSx7cXVldWU6ZmFsc2UsZHVyYXRpb246Yy5hbmltYXRlfSl9Yj1nfSk7ZWxzZXtmPXRoaXMudmFsdWUoKTtqPXRoaXMuX3ZhbHVlTWluKCk7bD10aGlzLl92YWx1ZU1heCgpO2c9bCE9PWo/KGYtaikvKGwtaikqMTAwOjA7aVtlLm9yaWVudGF0aW9uPT09XCJob3Jpem9udGFsXCI/XCJsZWZ0XCI6XCJib3R0b21cIl09ZytcIiVcIjt0aGlzLmhhbmRsZS5zdG9wKDEsMSlbaD9cImFuaW1hdGVcIjpcImNzc1wiXShpLGMuYW5pbWF0ZSk7aWYoZD09PVwibWluXCImJnRoaXMub3JpZW50YXRpb249PT1cImhvcml6b250YWxcIil0aGlzLnJhbmdlLnN0b3AoMSwxKVtoP1wiYW5pbWF0ZVwiOlwiY3NzXCJdKHt3aWR0aDpnK1wiJVwifSxcbmMuYW5pbWF0ZSk7aWYoZD09PVwibWF4XCImJnRoaXMub3JpZW50YXRpb249PT1cImhvcml6b250YWxcIil0aGlzLnJhbmdlW2g/XCJhbmltYXRlXCI6XCJjc3NcIl0oe3dpZHRoOjEwMC1nK1wiJVwifSx7cXVldWU6ZmFsc2UsZHVyYXRpb246Yy5hbmltYXRlfSk7aWYoZD09PVwibWluXCImJnRoaXMub3JpZW50YXRpb249PT1cInZlcnRpY2FsXCIpdGhpcy5yYW5nZS5zdG9wKDEsMSlbaD9cImFuaW1hdGVcIjpcImNzc1wiXSh7aGVpZ2h0OmcrXCIlXCJ9LGMuYW5pbWF0ZSk7aWYoZD09PVwibWF4XCImJnRoaXMub3JpZW50YXRpb249PT1cInZlcnRpY2FsXCIpdGhpcy5yYW5nZVtoP1wiYW5pbWF0ZVwiOlwiY3NzXCJdKHtoZWlnaHQ6MTAwLWcrXCIlXCJ9LHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpjLmFuaW1hdGV9KX19fSk7YS5leHRlbmQoYS51aS5zbGlkZXIse3ZlcnNpb246XCIxLjguMTZcIn0pfSkoalF1ZXJ5KTtcbihmdW5jdGlvbihhLGQpe2Z1bmN0aW9uIGMoKXtyZXR1cm4rK2h9ZnVuY3Rpb24gZSgpe3JldHVybisrZ312YXIgaD0wLGc9MDthLndpZGdldChcInVpLnRhYnNcIix7b3B0aW9uczp7YWRkOm51bGwsYWpheE9wdGlvbnM6bnVsbCxjYWNoZTpmYWxzZSxjb29raWU6bnVsbCxjb2xsYXBzaWJsZTpmYWxzZSxkaXNhYmxlOm51bGwsZGlzYWJsZWQ6W10sZW5hYmxlOm51bGwsZXZlbnQ6XCJjbGlja1wiLGZ4Om51bGwsaWRQcmVmaXg6XCJ1aS10YWJzLVwiLGxvYWQ6bnVsbCxwYW5lbFRlbXBsYXRlOlwiPGRpdj48L2Rpdj5cIixyZW1vdmU6bnVsbCxzZWxlY3Q6bnVsbCxzaG93Om51bGwsc3Bpbm5lcjpcIjxlbT5Mb2FkaW5nJiM4MjMwOzwvZW0+XCIsdGFiVGVtcGxhdGU6XCI8bGk+PGEgaHJlZj0nI3tocmVmfSc+PHNwYW4+I3tsYWJlbH08L3NwYW4+PC9hPjwvbGk+XCJ9LF9jcmVhdGU6ZnVuY3Rpb24oKXt0aGlzLl90YWJpZnkodHJ1ZSl9LF9zZXRPcHRpb246ZnVuY3Rpb24oaSxiKXtpZihpPT1cInNlbGVjdGVkXCIpdGhpcy5vcHRpb25zLmNvbGxhcHNpYmxlJiZcbmI9PXRoaXMub3B0aW9ucy5zZWxlY3RlZHx8dGhpcy5zZWxlY3QoYik7ZWxzZXt0aGlzLm9wdGlvbnNbaV09Yjt0aGlzLl90YWJpZnkoKX19LF90YWJJZDpmdW5jdGlvbihpKXtyZXR1cm4gaS50aXRsZSYmaS50aXRsZS5yZXBsYWNlKC9cXHMvZyxcIl9cIikucmVwbGFjZSgvW15cXHdcXHUwMGMwLVxcdUZGRkYtXS9nLFwiXCIpfHx0aGlzLm9wdGlvbnMuaWRQcmVmaXgrYygpfSxfc2FuaXRpemVTZWxlY3RvcjpmdW5jdGlvbihpKXtyZXR1cm4gaS5yZXBsYWNlKC86L2csXCJcXFxcOlwiKX0sX2Nvb2tpZTpmdW5jdGlvbigpe3ZhciBpPXRoaXMuY29va2llfHwodGhpcy5jb29raWU9dGhpcy5vcHRpb25zLmNvb2tpZS5uYW1lfHxcInVpLXRhYnMtXCIrZSgpKTtyZXR1cm4gYS5jb29raWUuYXBwbHkobnVsbCxbaV0uY29uY2F0KGEubWFrZUFycmF5KGFyZ3VtZW50cykpKX0sX3VpOmZ1bmN0aW9uKGksYil7cmV0dXJue3RhYjppLHBhbmVsOmIsaW5kZXg6dGhpcy5hbmNob3JzLmluZGV4KGkpfX0sX2NsZWFudXA6ZnVuY3Rpb24oKXt0aGlzLmxpcy5maWx0ZXIoXCIudWktc3RhdGUtcHJvY2Vzc2luZ1wiKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLXByb2Nlc3NpbmdcIikuZmluZChcInNwYW46ZGF0YShsYWJlbC50YWJzKVwiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGk9XG5hKHRoaXMpO2kuaHRtbChpLmRhdGEoXCJsYWJlbC50YWJzXCIpKS5yZW1vdmVEYXRhKFwibGFiZWwudGFic1wiKX0pfSxfdGFiaWZ5OmZ1bmN0aW9uKGkpe2Z1bmN0aW9uIGIocix1KXtyLmNzcyhcImRpc3BsYXlcIixcIlwiKTshYS5zdXBwb3J0Lm9wYWNpdHkmJnUub3BhY2l0eSYmclswXS5zdHlsZS5yZW1vdmVBdHRyaWJ1dGUoXCJmaWx0ZXJcIil9dmFyIGY9dGhpcyxqPXRoaXMub3B0aW9ucyxsPS9eIy4rLzt0aGlzLmxpc3Q9dGhpcy5lbGVtZW50LmZpbmQoXCJvbCx1bFwiKS5lcSgwKTt0aGlzLmxpcz1hKFwiID4gbGk6aGFzKGFbaHJlZl0pXCIsdGhpcy5saXN0KTt0aGlzLmFuY2hvcnM9dGhpcy5saXMubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIGEoXCJhXCIsdGhpcylbMF19KTt0aGlzLnBhbmVscz1hKFtdKTt0aGlzLmFuY2hvcnMuZWFjaChmdW5jdGlvbihyLHUpe3ZhciB2PWEodSkuYXR0cihcImhyZWZcIiksdz12LnNwbGl0KFwiI1wiKVswXSx4O2lmKHcmJih3PT09bG9jYXRpb24udG9TdHJpbmcoKS5zcGxpdChcIiNcIilbMF18fFxuKHg9YShcImJhc2VcIilbMF0pJiZ3PT09eC5ocmVmKSl7dj11Lmhhc2g7dS5ocmVmPXZ9aWYobC50ZXN0KHYpKWYucGFuZWxzPWYucGFuZWxzLmFkZChmLmVsZW1lbnQuZmluZChmLl9zYW5pdGl6ZVNlbGVjdG9yKHYpKSk7ZWxzZSBpZih2JiZ2IT09XCIjXCIpe2EuZGF0YSh1LFwiaHJlZi50YWJzXCIsdik7YS5kYXRhKHUsXCJsb2FkLnRhYnNcIix2LnJlcGxhY2UoLyMuKiQvLFwiXCIpKTt2PWYuX3RhYklkKHUpO3UuaHJlZj1cIiNcIit2O3U9Zi5lbGVtZW50LmZpbmQoXCIjXCIrdik7aWYoIXUubGVuZ3RoKXt1PWEoai5wYW5lbFRlbXBsYXRlKS5hdHRyKFwiaWRcIix2KS5hZGRDbGFzcyhcInVpLXRhYnMtcGFuZWwgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWJvdHRvbVwiKS5pbnNlcnRBZnRlcihmLnBhbmVsc1tyLTFdfHxmLmxpc3QpO3UuZGF0YShcImRlc3Ryb3kudGFic1wiLHRydWUpfWYucGFuZWxzPWYucGFuZWxzLmFkZCh1KX1lbHNlIGouZGlzYWJsZWQucHVzaChyKX0pO2lmKGkpe3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLXRhYnMgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGxcIik7XG50aGlzLmxpc3QuYWRkQ2xhc3MoXCJ1aS10YWJzLW5hdiB1aS1oZWxwZXItcmVzZXQgdWktaGVscGVyLWNsZWFyZml4IHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWFsbFwiKTt0aGlzLmxpcy5hZGRDbGFzcyhcInVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLXRvcFwiKTt0aGlzLnBhbmVscy5hZGRDbGFzcyhcInVpLXRhYnMtcGFuZWwgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWJvdHRvbVwiKTtpZihqLnNlbGVjdGVkPT09ZCl7bG9jYXRpb24uaGFzaCYmdGhpcy5hbmNob3JzLmVhY2goZnVuY3Rpb24ocix1KXtpZih1Lmhhc2g9PWxvY2F0aW9uLmhhc2gpe2ouc2VsZWN0ZWQ9cjtyZXR1cm4gZmFsc2V9fSk7aWYodHlwZW9mIGouc2VsZWN0ZWQhPT1cIm51bWJlclwiJiZqLmNvb2tpZSlqLnNlbGVjdGVkPXBhcnNlSW50KGYuX2Nvb2tpZSgpLDEwKTtpZih0eXBlb2Ygai5zZWxlY3RlZCE9PVwibnVtYmVyXCImJnRoaXMubGlzLmZpbHRlcihcIi51aS10YWJzLXNlbGVjdGVkXCIpLmxlbmd0aClqLnNlbGVjdGVkPVxudGhpcy5saXMuaW5kZXgodGhpcy5saXMuZmlsdGVyKFwiLnVpLXRhYnMtc2VsZWN0ZWRcIikpO2ouc2VsZWN0ZWQ9ai5zZWxlY3RlZHx8KHRoaXMubGlzLmxlbmd0aD8wOi0xKX1lbHNlIGlmKGouc2VsZWN0ZWQ9PT1udWxsKWouc2VsZWN0ZWQ9LTE7ai5zZWxlY3RlZD1qLnNlbGVjdGVkPj0wJiZ0aGlzLmFuY2hvcnNbai5zZWxlY3RlZF18fGouc2VsZWN0ZWQ8MD9qLnNlbGVjdGVkOjA7ai5kaXNhYmxlZD1hLnVuaXF1ZShqLmRpc2FibGVkLmNvbmNhdChhLm1hcCh0aGlzLmxpcy5maWx0ZXIoXCIudWktc3RhdGUtZGlzYWJsZWRcIiksZnVuY3Rpb24ocil7cmV0dXJuIGYubGlzLmluZGV4KHIpfSkpKS5zb3J0KCk7YS5pbkFycmF5KGouc2VsZWN0ZWQsai5kaXNhYmxlZCkhPS0xJiZqLmRpc2FibGVkLnNwbGljZShhLmluQXJyYXkoai5zZWxlY3RlZCxqLmRpc2FibGVkKSwxKTt0aGlzLnBhbmVscy5hZGRDbGFzcyhcInVpLXRhYnMtaGlkZVwiKTt0aGlzLmxpcy5yZW1vdmVDbGFzcyhcInVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlXCIpO1xuaWYoai5zZWxlY3RlZD49MCYmdGhpcy5hbmNob3JzLmxlbmd0aCl7Zi5lbGVtZW50LmZpbmQoZi5fc2FuaXRpemVTZWxlY3RvcihmLmFuY2hvcnNbai5zZWxlY3RlZF0uaGFzaCkpLnJlbW92ZUNsYXNzKFwidWktdGFicy1oaWRlXCIpO3RoaXMubGlzLmVxKGouc2VsZWN0ZWQpLmFkZENsYXNzKFwidWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmVcIik7Zi5lbGVtZW50LnF1ZXVlKFwidGFic1wiLGZ1bmN0aW9uKCl7Zi5fdHJpZ2dlcihcInNob3dcIixudWxsLGYuX3VpKGYuYW5jaG9yc1tqLnNlbGVjdGVkXSxmLmVsZW1lbnQuZmluZChmLl9zYW5pdGl6ZVNlbGVjdG9yKGYuYW5jaG9yc1tqLnNlbGVjdGVkXS5oYXNoKSlbMF0pKX0pO3RoaXMubG9hZChqLnNlbGVjdGVkKX1hKHdpbmRvdykuYmluZChcInVubG9hZFwiLGZ1bmN0aW9uKCl7Zi5saXMuYWRkKGYuYW5jaG9ycykudW5iaW5kKFwiLnRhYnNcIik7Zi5saXM9Zi5hbmNob3JzPWYucGFuZWxzPW51bGx9KX1lbHNlIGouc2VsZWN0ZWQ9dGhpcy5saXMuaW5kZXgodGhpcy5saXMuZmlsdGVyKFwiLnVpLXRhYnMtc2VsZWN0ZWRcIikpO1xudGhpcy5lbGVtZW50W2ouY29sbGFwc2libGU/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJ1aS10YWJzLWNvbGxhcHNpYmxlXCIpO2ouY29va2llJiZ0aGlzLl9jb29raWUoai5zZWxlY3RlZCxqLmNvb2tpZSk7aT0wO2Zvcih2YXIgbztvPXRoaXMubGlzW2ldO2krKylhKG8pW2EuaW5BcnJheShpLGouZGlzYWJsZWQpIT0tMSYmIWEobykuaGFzQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkXCIpP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwidWktc3RhdGUtZGlzYWJsZWRcIik7ai5jYWNoZT09PWZhbHNlJiZ0aGlzLmFuY2hvcnMucmVtb3ZlRGF0YShcImNhY2hlLnRhYnNcIik7dGhpcy5saXMuYWRkKHRoaXMuYW5jaG9ycykudW5iaW5kKFwiLnRhYnNcIik7aWYoai5ldmVudCE9PVwibW91c2VvdmVyXCIpe3ZhciBuPWZ1bmN0aW9uKHIsdSl7dS5pcyhcIjpub3QoLnVpLXN0YXRlLWRpc2FibGVkKVwiKSYmdS5hZGRDbGFzcyhcInVpLXN0YXRlLVwiK3IpfSxrPWZ1bmN0aW9uKHIsdSl7dS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLVwiK1xucil9O3RoaXMubGlzLmJpbmQoXCJtb3VzZW92ZXIudGFic1wiLGZ1bmN0aW9uKCl7bihcImhvdmVyXCIsYSh0aGlzKSl9KTt0aGlzLmxpcy5iaW5kKFwibW91c2VvdXQudGFic1wiLGZ1bmN0aW9uKCl7ayhcImhvdmVyXCIsYSh0aGlzKSl9KTt0aGlzLmFuY2hvcnMuYmluZChcImZvY3VzLnRhYnNcIixmdW5jdGlvbigpe24oXCJmb2N1c1wiLGEodGhpcykuY2xvc2VzdChcImxpXCIpKX0pO3RoaXMuYW5jaG9ycy5iaW5kKFwiYmx1ci50YWJzXCIsZnVuY3Rpb24oKXtrKFwiZm9jdXNcIixhKHRoaXMpLmNsb3Nlc3QoXCJsaVwiKSl9KX12YXIgbSxwO2lmKGouZngpaWYoYS5pc0FycmF5KGouZngpKXttPWouZnhbMF07cD1qLmZ4WzFdfWVsc2UgbT1wPWouZng7dmFyIHE9cD9mdW5jdGlvbihyLHUpe2EocikuY2xvc2VzdChcImxpXCIpLmFkZENsYXNzKFwidWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmVcIik7dS5oaWRlKCkucmVtb3ZlQ2xhc3MoXCJ1aS10YWJzLWhpZGVcIikuYW5pbWF0ZShwLHAuZHVyYXRpb258fFwibm9ybWFsXCIsXG5mdW5jdGlvbigpe2IodSxwKTtmLl90cmlnZ2VyKFwic2hvd1wiLG51bGwsZi5fdWkocix1WzBdKSl9KX06ZnVuY3Rpb24ocix1KXthKHIpLmNsb3Nlc3QoXCJsaVwiKS5hZGRDbGFzcyhcInVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlXCIpO3UucmVtb3ZlQ2xhc3MoXCJ1aS10YWJzLWhpZGVcIik7Zi5fdHJpZ2dlcihcInNob3dcIixudWxsLGYuX3VpKHIsdVswXSkpfSxzPW0/ZnVuY3Rpb24ocix1KXt1LmFuaW1hdGUobSxtLmR1cmF0aW9ufHxcIm5vcm1hbFwiLGZ1bmN0aW9uKCl7Zi5saXMucmVtb3ZlQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZVwiKTt1LmFkZENsYXNzKFwidWktdGFicy1oaWRlXCIpO2IodSxtKTtmLmVsZW1lbnQuZGVxdWV1ZShcInRhYnNcIil9KX06ZnVuY3Rpb24ocix1KXtmLmxpcy5yZW1vdmVDbGFzcyhcInVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlXCIpO3UuYWRkQ2xhc3MoXCJ1aS10YWJzLWhpZGVcIik7Zi5lbGVtZW50LmRlcXVldWUoXCJ0YWJzXCIpfTtcbnRoaXMuYW5jaG9ycy5iaW5kKGouZXZlbnQrXCIudGFic1wiLGZ1bmN0aW9uKCl7dmFyIHI9dGhpcyx1PWEocikuY2xvc2VzdChcImxpXCIpLHY9Zi5wYW5lbHMuZmlsdGVyKFwiOm5vdCgudWktdGFicy1oaWRlKVwiKSx3PWYuZWxlbWVudC5maW5kKGYuX3Nhbml0aXplU2VsZWN0b3Ioci5oYXNoKSk7aWYodS5oYXNDbGFzcyhcInVpLXRhYnMtc2VsZWN0ZWRcIikmJiFqLmNvbGxhcHNpYmxlfHx1Lmhhc0NsYXNzKFwidWktc3RhdGUtZGlzYWJsZWRcIil8fHUuaGFzQ2xhc3MoXCJ1aS1zdGF0ZS1wcm9jZXNzaW5nXCIpfHxmLnBhbmVscy5maWx0ZXIoXCI6YW5pbWF0ZWRcIikubGVuZ3RofHxmLl90cmlnZ2VyKFwic2VsZWN0XCIsbnVsbCxmLl91aSh0aGlzLHdbMF0pKT09PWZhbHNlKXt0aGlzLmJsdXIoKTtyZXR1cm4gZmFsc2V9ai5zZWxlY3RlZD1mLmFuY2hvcnMuaW5kZXgodGhpcyk7Zi5hYm9ydCgpO2lmKGouY29sbGFwc2libGUpaWYodS5oYXNDbGFzcyhcInVpLXRhYnMtc2VsZWN0ZWRcIikpe2ouc2VsZWN0ZWQ9XG4tMTtqLmNvb2tpZSYmZi5fY29va2llKGouc2VsZWN0ZWQsai5jb29raWUpO2YuZWxlbWVudC5xdWV1ZShcInRhYnNcIixmdW5jdGlvbigpe3Mocix2KX0pLmRlcXVldWUoXCJ0YWJzXCIpO3RoaXMuYmx1cigpO3JldHVybiBmYWxzZX1lbHNlIGlmKCF2Lmxlbmd0aCl7ai5jb29raWUmJmYuX2Nvb2tpZShqLnNlbGVjdGVkLGouY29va2llKTtmLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIsZnVuY3Rpb24oKXtxKHIsdyl9KTtmLmxvYWQoZi5hbmNob3JzLmluZGV4KHRoaXMpKTt0aGlzLmJsdXIoKTtyZXR1cm4gZmFsc2V9ai5jb29raWUmJmYuX2Nvb2tpZShqLnNlbGVjdGVkLGouY29va2llKTtpZih3Lmxlbmd0aCl7di5sZW5ndGgmJmYuZWxlbWVudC5xdWV1ZShcInRhYnNcIixmdW5jdGlvbigpe3Mocix2KX0pO2YuZWxlbWVudC5xdWV1ZShcInRhYnNcIixmdW5jdGlvbigpe3Eocix3KX0pO2YubG9hZChmLmFuY2hvcnMuaW5kZXgodGhpcykpfWVsc2UgdGhyb3dcImpRdWVyeSBVSSBUYWJzOiBNaXNtYXRjaGluZyBmcmFnbWVudCBpZGVudGlmaWVyLlwiO1xuYS5icm93c2VyLm1zaWUmJnRoaXMuYmx1cigpfSk7dGhpcy5hbmNob3JzLmJpbmQoXCJjbGljay50YWJzXCIsZnVuY3Rpb24oKXtyZXR1cm4gZmFsc2V9KX0sX2dldEluZGV4OmZ1bmN0aW9uKGkpe2lmKHR5cGVvZiBpPT1cInN0cmluZ1wiKWk9dGhpcy5hbmNob3JzLmluZGV4KHRoaXMuYW5jaG9ycy5maWx0ZXIoXCJbaHJlZiQ9XCIraStcIl1cIikpO3JldHVybiBpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dmFyIGk9dGhpcy5vcHRpb25zO3RoaXMuYWJvcnQoKTt0aGlzLmVsZW1lbnQudW5iaW5kKFwiLnRhYnNcIikucmVtb3ZlQ2xhc3MoXCJ1aS10YWJzIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIHVpLXRhYnMtY29sbGFwc2libGVcIikucmVtb3ZlRGF0YShcInRhYnNcIik7dGhpcy5saXN0LnJlbW92ZUNsYXNzKFwidWktdGFicy1uYXYgdWktaGVscGVyLXJlc2V0IHVpLWhlbHBlci1jbGVhcmZpeCB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1hbGxcIik7dGhpcy5hbmNob3JzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1cbmEuZGF0YSh0aGlzLFwiaHJlZi50YWJzXCIpO2lmKGIpdGhpcy5ocmVmPWI7dmFyIGY9YSh0aGlzKS51bmJpbmQoXCIudGFic1wiKTthLmVhY2goW1wiaHJlZlwiLFwibG9hZFwiLFwiY2FjaGVcIl0sZnVuY3Rpb24oaixsKXtmLnJlbW92ZURhdGEobCtcIi50YWJzXCIpfSl9KTt0aGlzLmxpcy51bmJpbmQoXCIudGFic1wiKS5hZGQodGhpcy5wYW5lbHMpLmVhY2goZnVuY3Rpb24oKXthLmRhdGEodGhpcyxcImRlc3Ryb3kudGFic1wiKT9hKHRoaXMpLnJlbW92ZSgpOmEodGhpcykucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci10b3AgdWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmUgdWktc3RhdGUtaG92ZXIgdWktc3RhdGUtZm9jdXMgdWktc3RhdGUtZGlzYWJsZWQgdWktdGFicy1wYW5lbCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tIHVpLXRhYnMtaGlkZVwiKX0pO2kuY29va2llJiZ0aGlzLl9jb29raWUobnVsbCxpLmNvb2tpZSk7cmV0dXJuIHRoaXN9LGFkZDpmdW5jdGlvbihpLFxuYixmKXtpZihmPT09ZClmPXRoaXMuYW5jaG9ycy5sZW5ndGg7dmFyIGo9dGhpcyxsPXRoaXMub3B0aW9ucztiPWEobC50YWJUZW1wbGF0ZS5yZXBsYWNlKC8jXFx7aHJlZlxcfS9nLGkpLnJlcGxhY2UoLyNcXHtsYWJlbFxcfS9nLGIpKTtpPSFpLmluZGV4T2YoXCIjXCIpP2kucmVwbGFjZShcIiNcIixcIlwiKTp0aGlzLl90YWJJZChhKFwiYVwiLGIpWzBdKTtiLmFkZENsYXNzKFwidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItdG9wXCIpLmRhdGEoXCJkZXN0cm95LnRhYnNcIix0cnVlKTt2YXIgbz1qLmVsZW1lbnQuZmluZChcIiNcIitpKTtvLmxlbmd0aHx8KG89YShsLnBhbmVsVGVtcGxhdGUpLmF0dHIoXCJpZFwiLGkpLmRhdGEoXCJkZXN0cm95LnRhYnNcIix0cnVlKSk7by5hZGRDbGFzcyhcInVpLXRhYnMtcGFuZWwgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWJvdHRvbSB1aS10YWJzLWhpZGVcIik7aWYoZj49dGhpcy5saXMubGVuZ3RoKXtiLmFwcGVuZFRvKHRoaXMubGlzdCk7by5hcHBlbmRUbyh0aGlzLmxpc3RbMF0ucGFyZW50Tm9kZSl9ZWxzZXtiLmluc2VydEJlZm9yZSh0aGlzLmxpc1tmXSk7XG5vLmluc2VydEJlZm9yZSh0aGlzLnBhbmVsc1tmXSl9bC5kaXNhYmxlZD1hLm1hcChsLmRpc2FibGVkLGZ1bmN0aW9uKG4pe3JldHVybiBuPj1mPysrbjpufSk7dGhpcy5fdGFiaWZ5KCk7aWYodGhpcy5hbmNob3JzLmxlbmd0aD09MSl7bC5zZWxlY3RlZD0wO2IuYWRkQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZVwiKTtvLnJlbW92ZUNsYXNzKFwidWktdGFicy1oaWRlXCIpO3RoaXMuZWxlbWVudC5xdWV1ZShcInRhYnNcIixmdW5jdGlvbigpe2ouX3RyaWdnZXIoXCJzaG93XCIsbnVsbCxqLl91aShqLmFuY2hvcnNbMF0sai5wYW5lbHNbMF0pKX0pO3RoaXMubG9hZCgwKX10aGlzLl90cmlnZ2VyKFwiYWRkXCIsbnVsbCx0aGlzLl91aSh0aGlzLmFuY2hvcnNbZl0sdGhpcy5wYW5lbHNbZl0pKTtyZXR1cm4gdGhpc30scmVtb3ZlOmZ1bmN0aW9uKGkpe2k9dGhpcy5fZ2V0SW5kZXgoaSk7dmFyIGI9dGhpcy5vcHRpb25zLGY9dGhpcy5saXMuZXEoaSkucmVtb3ZlKCksaj10aGlzLnBhbmVscy5lcShpKS5yZW1vdmUoKTtcbmlmKGYuaGFzQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkXCIpJiZ0aGlzLmFuY2hvcnMubGVuZ3RoPjEpdGhpcy5zZWxlY3QoaSsoaSsxPHRoaXMuYW5jaG9ycy5sZW5ndGg/MTotMSkpO2IuZGlzYWJsZWQ9YS5tYXAoYS5ncmVwKGIuZGlzYWJsZWQsZnVuY3Rpb24obCl7cmV0dXJuIGwhPWl9KSxmdW5jdGlvbihsKXtyZXR1cm4gbD49aT8tLWw6bH0pO3RoaXMuX3RhYmlmeSgpO3RoaXMuX3RyaWdnZXIoXCJyZW1vdmVcIixudWxsLHRoaXMuX3VpKGYuZmluZChcImFcIilbMF0salswXSkpO3JldHVybiB0aGlzfSxlbmFibGU6ZnVuY3Rpb24oaSl7aT10aGlzLl9nZXRJbmRleChpKTt2YXIgYj10aGlzLm9wdGlvbnM7aWYoYS5pbkFycmF5KGksYi5kaXNhYmxlZCkhPS0xKXt0aGlzLmxpcy5lcShpKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWRpc2FibGVkXCIpO2IuZGlzYWJsZWQ9YS5ncmVwKGIuZGlzYWJsZWQsZnVuY3Rpb24oZil7cmV0dXJuIGYhPWl9KTt0aGlzLl90cmlnZ2VyKFwiZW5hYmxlXCIsbnVsbCxcbnRoaXMuX3VpKHRoaXMuYW5jaG9yc1tpXSx0aGlzLnBhbmVsc1tpXSkpO3JldHVybiB0aGlzfX0sZGlzYWJsZTpmdW5jdGlvbihpKXtpPXRoaXMuX2dldEluZGV4KGkpO3ZhciBiPXRoaXMub3B0aW9ucztpZihpIT1iLnNlbGVjdGVkKXt0aGlzLmxpcy5lcShpKS5hZGRDbGFzcyhcInVpLXN0YXRlLWRpc2FibGVkXCIpO2IuZGlzYWJsZWQucHVzaChpKTtiLmRpc2FibGVkLnNvcnQoKTt0aGlzLl90cmlnZ2VyKFwiZGlzYWJsZVwiLG51bGwsdGhpcy5fdWkodGhpcy5hbmNob3JzW2ldLHRoaXMucGFuZWxzW2ldKSl9cmV0dXJuIHRoaXN9LHNlbGVjdDpmdW5jdGlvbihpKXtpPXRoaXMuX2dldEluZGV4KGkpO2lmKGk9PS0xKWlmKHRoaXMub3B0aW9ucy5jb2xsYXBzaWJsZSYmdGhpcy5vcHRpb25zLnNlbGVjdGVkIT0tMSlpPXRoaXMub3B0aW9ucy5zZWxlY3RlZDtlbHNlIHJldHVybiB0aGlzO3RoaXMuYW5jaG9ycy5lcShpKS50cmlnZ2VyKHRoaXMub3B0aW9ucy5ldmVudCtcIi50YWJzXCIpO3JldHVybiB0aGlzfSxcbmxvYWQ6ZnVuY3Rpb24oaSl7aT10aGlzLl9nZXRJbmRleChpKTt2YXIgYj10aGlzLGY9dGhpcy5vcHRpb25zLGo9dGhpcy5hbmNob3JzLmVxKGkpWzBdLGw9YS5kYXRhKGosXCJsb2FkLnRhYnNcIik7dGhpcy5hYm9ydCgpO2lmKCFsfHx0aGlzLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIpLmxlbmd0aCE9PTAmJmEuZGF0YShqLFwiY2FjaGUudGFic1wiKSl0aGlzLmVsZW1lbnQuZGVxdWV1ZShcInRhYnNcIik7ZWxzZXt0aGlzLmxpcy5lcShpKS5hZGRDbGFzcyhcInVpLXN0YXRlLXByb2Nlc3NpbmdcIik7aWYoZi5zcGlubmVyKXt2YXIgbz1hKFwic3BhblwiLGopO28uZGF0YShcImxhYmVsLnRhYnNcIixvLmh0bWwoKSkuaHRtbChmLnNwaW5uZXIpfXRoaXMueGhyPWEuYWpheChhLmV4dGVuZCh7fSxmLmFqYXhPcHRpb25zLHt1cmw6bCxzdWNjZXNzOmZ1bmN0aW9uKG4sayl7Yi5lbGVtZW50LmZpbmQoYi5fc2FuaXRpemVTZWxlY3RvcihqLmhhc2gpKS5odG1sKG4pO2IuX2NsZWFudXAoKTtmLmNhY2hlJiZhLmRhdGEoaixcblwiY2FjaGUudGFic1wiLHRydWUpO2IuX3RyaWdnZXIoXCJsb2FkXCIsbnVsbCxiLl91aShiLmFuY2hvcnNbaV0sYi5wYW5lbHNbaV0pKTt0cnl7Zi5hamF4T3B0aW9ucy5zdWNjZXNzKG4sayl9Y2F0Y2gobSl7fX0sZXJyb3I6ZnVuY3Rpb24obixrKXtiLl9jbGVhbnVwKCk7Yi5fdHJpZ2dlcihcImxvYWRcIixudWxsLGIuX3VpKGIuYW5jaG9yc1tpXSxiLnBhbmVsc1tpXSkpO3RyeXtmLmFqYXhPcHRpb25zLmVycm9yKG4sayxpLGopfWNhdGNoKG0pe319fSkpO2IuZWxlbWVudC5kZXF1ZXVlKFwidGFic1wiKTtyZXR1cm4gdGhpc319LGFib3J0OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnF1ZXVlKFtdKTt0aGlzLnBhbmVscy5zdG9wKGZhbHNlLHRydWUpO3RoaXMuZWxlbWVudC5xdWV1ZShcInRhYnNcIix0aGlzLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIpLnNwbGljZSgtMiwyKSk7aWYodGhpcy54aHIpe3RoaXMueGhyLmFib3J0KCk7ZGVsZXRlIHRoaXMueGhyfXRoaXMuX2NsZWFudXAoKTtyZXR1cm4gdGhpc30sXG51cmw6ZnVuY3Rpb24oaSxiKXt0aGlzLmFuY2hvcnMuZXEoaSkucmVtb3ZlRGF0YShcImNhY2hlLnRhYnNcIikuZGF0YShcImxvYWQudGFic1wiLGIpO3JldHVybiB0aGlzfSxsZW5ndGg6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hbmNob3JzLmxlbmd0aH19KTthLmV4dGVuZChhLnVpLnRhYnMse3ZlcnNpb246XCIxLjguMTZcIn0pO2EuZXh0ZW5kKGEudWkudGFicy5wcm90b3R5cGUse3JvdGF0aW9uOm51bGwscm90YXRlOmZ1bmN0aW9uKGksYil7dmFyIGY9dGhpcyxqPXRoaXMub3B0aW9ucyxsPWYuX3JvdGF0ZXx8KGYuX3JvdGF0ZT1mdW5jdGlvbihvKXtjbGVhclRpbWVvdXQoZi5yb3RhdGlvbik7Zi5yb3RhdGlvbj1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dmFyIG49ai5zZWxlY3RlZDtmLnNlbGVjdCgrK248Zi5hbmNob3JzLmxlbmd0aD9uOjApfSxpKTtvJiZvLnN0b3BQcm9wYWdhdGlvbigpfSk7Yj1mLl91bnJvdGF0ZXx8KGYuX3Vucm90YXRlPSFiP2Z1bmN0aW9uKG8pe28uY2xpZW50WCYmXG5mLnJvdGF0ZShudWxsKX06ZnVuY3Rpb24oKXt0PWouc2VsZWN0ZWQ7bCgpfSk7aWYoaSl7dGhpcy5lbGVtZW50LmJpbmQoXCJ0YWJzc2hvd1wiLGwpO3RoaXMuYW5jaG9ycy5iaW5kKGouZXZlbnQrXCIudGFic1wiLGIpO2woKX1lbHNle2NsZWFyVGltZW91dChmLnJvdGF0aW9uKTt0aGlzLmVsZW1lbnQudW5iaW5kKFwidGFic3Nob3dcIixsKTt0aGlzLmFuY2hvcnMudW5iaW5kKGouZXZlbnQrXCIudGFic1wiLGIpO2RlbGV0ZSB0aGlzLl9yb3RhdGU7ZGVsZXRlIHRoaXMuX3Vucm90YXRlfXJldHVybiB0aGlzfX0pfSkoalF1ZXJ5KTtcbn07XG4iLCIvKiFcbiAqIGpRdWVyeSBVSSBUb3VjaCBQdW5jaCAwLjIuMlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBEYXZlIEZ1cmZlcm9cbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICpcbiAqIERlcGVuZHM6XG4gKiAganF1ZXJ5LnVpLndpZGdldC5qc1xuICogIGpxdWVyeS51aS5tb3VzZS5qc1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgkKSB7XG5cbiAgLy8gRGV0ZWN0IHRvdWNoIHN1cHBvcnRcbiAgJC5zdXBwb3J0LnRvdWNoID0gJ29udG91Y2hlbmQnIGluIGRvY3VtZW50O1xuXG4gIC8vIElnbm9yZSBicm93c2VycyB3aXRob3V0IHRvdWNoIHN1cHBvcnRcbiAgaWYgKCEkLnN1cHBvcnQudG91Y2gpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW91c2VQcm90byA9ICQudWkubW91c2UucHJvdG90eXBlLFxuICAgICAgX21vdXNlSW5pdCA9IG1vdXNlUHJvdG8uX21vdXNlSW5pdCxcbiAgICAgIHRvdWNoSGFuZGxlZDtcblxuICAvKipcbiAgICogU2ltdWxhdGUgYSBtb3VzZSBldmVudCBiYXNlZCBvbiBhIGNvcnJlc3BvbmRpbmcgdG91Y2ggZXZlbnRcbiAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50IEEgdG91Y2ggZXZlbnRcbiAgICogQHBhcmFtIHtTdHJpbmd9IHNpbXVsYXRlZFR5cGUgVGhlIGNvcnJlc3BvbmRpbmcgbW91c2UgZXZlbnRcbiAgICovXG4gIGZ1bmN0aW9uIHNpbXVsYXRlTW91c2VFdmVudCAoZXZlbnQsIHNpbXVsYXRlZFR5cGUpIHtcblxuICAgIC8vIElnbm9yZSBtdWx0aS10b3VjaCBldmVudHNcbiAgICBpZiAoZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgdmFyIHRvdWNoID0gZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSxcbiAgICAgICAgc2ltdWxhdGVkRXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnTW91c2VFdmVudHMnKTtcbiAgICBcbiAgICAvLyBJbml0aWFsaXplIHRoZSBzaW11bGF0ZWQgbW91c2UgZXZlbnQgdXNpbmcgdGhlIHRvdWNoIGV2ZW50J3MgY29vcmRpbmF0ZXNcbiAgICBzaW11bGF0ZWRFdmVudC5pbml0TW91c2VFdmVudChcbiAgICAgIHNpbXVsYXRlZFR5cGUsICAgIC8vIHR5cGVcbiAgICAgIHRydWUsICAgICAgICAgICAgIC8vIGJ1YmJsZXMgICAgICAgICAgICAgICAgICAgIFxuICAgICAgdHJ1ZSwgICAgICAgICAgICAgLy8gY2FuY2VsYWJsZSAgICAgICAgICAgICAgICAgXG4gICAgICB3aW5kb3csICAgICAgICAgICAvLyB2aWV3ICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgIDEsICAgICAgICAgICAgICAgIC8vIGRldGFpbCAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgdG91Y2guc2NyZWVuWCwgICAgLy8gc2NyZWVuWCAgICAgICAgICAgICAgICAgICAgXG4gICAgICB0b3VjaC5zY3JlZW5ZLCAgICAvLyBzY3JlZW5ZICAgICAgICAgICAgICAgICAgICBcbiAgICAgIHRvdWNoLmNsaWVudFgsICAgIC8vIGNsaWVudFggICAgICAgICAgICAgICAgICAgIFxuICAgICAgdG91Y2guY2xpZW50WSwgICAgLy8gY2xpZW50WSAgICAgICAgICAgICAgICAgICAgXG4gICAgICBmYWxzZSwgICAgICAgICAgICAvLyBjdHJsS2V5ICAgICAgICAgICAgICAgICAgICBcbiAgICAgIGZhbHNlLCAgICAgICAgICAgIC8vIGFsdEtleSAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgZmFsc2UsICAgICAgICAgICAgLy8gc2hpZnRLZXkgICAgICAgICAgICAgICAgICAgXG4gICAgICBmYWxzZSwgICAgICAgICAgICAvLyBtZXRhS2V5ICAgICAgICAgICAgICAgICAgICBcbiAgICAgIDAsICAgICAgICAgICAgICAgIC8vIGJ1dHRvbiAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgbnVsbCAgICAgICAgICAgICAgLy8gcmVsYXRlZFRhcmdldCAgICAgICAgICAgICAgXG4gICAgKTtcblxuICAgIC8vIERpc3BhdGNoIHRoZSBzaW11bGF0ZWQgZXZlbnQgdG8gdGhlIHRhcmdldCBlbGVtZW50XG4gICAgZXZlbnQudGFyZ2V0LmRpc3BhdGNoRXZlbnQoc2ltdWxhdGVkRXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB0aGUgalF1ZXJ5IFVJIHdpZGdldCdzIHRvdWNoc3RhcnQgZXZlbnRzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgd2lkZ2V0IGVsZW1lbnQncyB0b3VjaHN0YXJ0IGV2ZW50XG4gICAqL1xuICBtb3VzZVByb3RvLl90b3VjaFN0YXJ0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAvLyBJZ25vcmUgdGhlIGV2ZW50IGlmIGFub3RoZXIgd2lkZ2V0IGlzIGFscmVhZHkgYmVpbmcgaGFuZGxlZFxuICAgIGlmICh0b3VjaEhhbmRsZWQgfHwgIXNlbGYuX21vdXNlQ2FwdHVyZShldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICAvLyBTZXQgdGhlIGZsYWcgdG8gcHJldmVudCBvdGhlciB3aWRnZXRzIGZyb20gaW5oZXJpdGluZyB0aGUgdG91Y2ggZXZlbnRcbiAgICB0b3VjaEhhbmRsZWQgPSB0cnVlO1xuXG4gICAgLy8gVHJhY2sgbW92ZW1lbnQgdG8gZGV0ZXJtaW5lIGlmIGludGVyYWN0aW9uIHdhcyBhIGNsaWNrXG4gICAgc2VsZi5fdG91Y2hNb3ZlZCA9IGZhbHNlO1xuXG4gICAgLy8gU2ltdWxhdGUgdGhlIG1vdXNlb3ZlciBldmVudFxuICAgIHNpbXVsYXRlTW91c2VFdmVudChldmVudCwgJ21vdXNlb3ZlcicpO1xuXG4gICAgLy8gU2ltdWxhdGUgdGhlIG1vdXNlbW92ZSBldmVudFxuICAgIHNpbXVsYXRlTW91c2VFdmVudChldmVudCwgJ21vdXNlbW92ZScpO1xuXG4gICAgLy8gU2ltdWxhdGUgdGhlIG1vdXNlZG93biBldmVudFxuICAgIHNpbXVsYXRlTW91c2VFdmVudChldmVudCwgJ21vdXNlZG93bicpO1xuICAgIFxuICB9O1xuXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGpRdWVyeSBVSSB3aWRnZXQncyB0b3VjaG1vdmUgZXZlbnRzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgZG9jdW1lbnQncyB0b3VjaG1vdmUgZXZlbnRcbiAgICovXG4gIG1vdXNlUHJvdG8uX3RvdWNoTW92ZSA9IGZ1bmN0aW9uIChldmVudCkge1xuXG4gICAgLy8gSWdub3JlIGV2ZW50IGlmIG5vdCBoYW5kbGVkXG4gICAgaWYgKCF0b3VjaEhhbmRsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJbnRlcmFjdGlvbiB3YXMgbm90IGEgY2xpY2tcbiAgICB0aGlzLl90b3VjaE1vdmVkID0gdHJ1ZTtcblxuICAgIC8vIFNpbXVsYXRlIHRoZSBtb3VzZW1vdmUgZXZlbnRcbiAgICBzaW11bGF0ZU1vdXNlRXZlbnQoZXZlbnQsICdtb3VzZW1vdmUnKTtcbiAgfTtcblxuICAvKipcbiAgICogSGFuZGxlIHRoZSBqUXVlcnkgVUkgd2lkZ2V0J3MgdG91Y2hlbmQgZXZlbnRzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgZG9jdW1lbnQncyB0b3VjaGVuZCBldmVudFxuICAgKi9cbiAgbW91c2VQcm90by5fdG91Y2hFbmQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcblxuICAgIC8vIElnbm9yZSBldmVudCBpZiBub3QgaGFuZGxlZFxuICAgIGlmICghdG91Y2hIYW5kbGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gU2ltdWxhdGUgdGhlIG1vdXNldXAgZXZlbnRcbiAgICBzaW11bGF0ZU1vdXNlRXZlbnQoZXZlbnQsICdtb3VzZXVwJyk7XG5cbiAgICAvLyBTaW11bGF0ZSB0aGUgbW91c2VvdXQgZXZlbnRcbiAgICBzaW11bGF0ZU1vdXNlRXZlbnQoZXZlbnQsICdtb3VzZW91dCcpO1xuXG4gICAgLy8gSWYgdGhlIHRvdWNoIGludGVyYWN0aW9uIGRpZCBub3QgbW92ZSwgaXQgc2hvdWxkIHRyaWdnZXIgYSBjbGlja1xuICAgIGlmICghdGhpcy5fdG91Y2hNb3ZlZCkge1xuXG4gICAgICAvLyBTaW11bGF0ZSB0aGUgY2xpY2sgZXZlbnRcbiAgICAgIHNpbXVsYXRlTW91c2VFdmVudChldmVudCwgJ2NsaWNrJyk7XG4gICAgfVxuXG4gICAgLy8gVW5zZXQgdGhlIGZsYWcgdG8gYWxsb3cgb3RoZXIgd2lkZ2V0cyB0byBpbmhlcml0IHRoZSB0b3VjaCBldmVudFxuICAgIHRvdWNoSGFuZGxlZCA9IGZhbHNlO1xuICB9O1xuXG4gIC8qKlxuICAgKiBBIGR1Y2sgcHVuY2ggb2YgdGhlICQudWkubW91c2UgX21vdXNlSW5pdCBtZXRob2QgdG8gc3VwcG9ydCB0b3VjaCBldmVudHMuXG4gICAqIFRoaXMgbWV0aG9kIGV4dGVuZHMgdGhlIHdpZGdldCB3aXRoIGJvdW5kIHRvdWNoIGV2ZW50IGhhbmRsZXJzIHRoYXRcbiAgICogdHJhbnNsYXRlIHRvdWNoIGV2ZW50cyB0byBtb3VzZSBldmVudHMgYW5kIHBhc3MgdGhlbSB0byB0aGUgd2lkZ2V0J3NcbiAgICogb3JpZ2luYWwgbW91c2UgZXZlbnQgaGFuZGxpbmcgbWV0aG9kcy5cbiAgICovXG4gIG1vdXNlUHJvdG8uX21vdXNlSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAvLyBEZWxlZ2F0ZSB0aGUgdG91Y2ggaGFuZGxlcnMgdG8gdGhlIHdpZGdldCdzIGVsZW1lbnRcbiAgICBzZWxmLmVsZW1lbnRcbiAgICAgIC5iaW5kKCd0b3VjaHN0YXJ0JywgJC5wcm94eShzZWxmLCAnX3RvdWNoU3RhcnQnKSlcbiAgICAgIC5iaW5kKCd0b3VjaG1vdmUnLCAkLnByb3h5KHNlbGYsICdfdG91Y2hNb3ZlJykpXG4gICAgICAuYmluZCgndG91Y2hlbmQnLCAkLnByb3h5KHNlbGYsICdfdG91Y2hFbmQnKSk7XG5cbiAgICAvLyBDYWxsIHRoZSBvcmlnaW5hbCAkLnVpLm1vdXNlIGluaXQgbWV0aG9kXG4gICAgX21vdXNlSW5pdC5jYWxsKHNlbGYpO1xuICB9O1xuXG59OyIsIi8qKlxuICogRmFyYnRhc3RpYyBDb2xvciBQaWNrZXIgMS4yXG4gKiDCqSAyMDA4IFN0ZXZlbiBXaXR0ZW5zXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZVxuICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSAgVVNBXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihqUXVlcnkpIHtcblxualF1ZXJ5LmZuLmZhcmJ0YXN0aWMgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgJC5mYXJidGFzdGljKHRoaXMsIGNhbGxiYWNrKTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5qUXVlcnkuZmFyYnRhc3RpYyA9IGZ1bmN0aW9uIChjb250YWluZXIsIGNhbGxiYWNrKSB7XG4gIHZhciBjb250YWluZXIgPSAkKGNvbnRhaW5lcikuZ2V0KDApO1xuICByZXR1cm4gY29udGFpbmVyLmZhcmJ0YXN0aWMgfHwgKGNvbnRhaW5lci5mYXJidGFzdGljID0gbmV3IGpRdWVyeS5fZmFyYnRhc3RpYyhjb250YWluZXIsIGNhbGxiYWNrKSk7XG59XG5cbmpRdWVyeS5fZmFyYnRhc3RpYyA9IGZ1bmN0aW9uIChjb250YWluZXIsIGNhbGxiYWNrKSB7XG4gIC8vIFN0b3JlIGZhcmJ0YXN0aWMgb2JqZWN0XG4gIHZhciBmYiA9IHRoaXM7XG5cbiAgLy8gSW5zZXJ0IG1hcmt1cFxuICAkKGNvbnRhaW5lcikuaHRtbCgnPGRpdiBjbGFzcz1cImZhcmJ0YXN0aWNcIj48ZGl2IGNsYXNzPVwiY29sb3JcIj48L2Rpdj48ZGl2IGNsYXNzPVwid2hlZWxcIj48L2Rpdj48ZGl2IGNsYXNzPVwib3ZlcmxheVwiPjwvZGl2PjxkaXYgY2xhc3M9XCJoLW1hcmtlciBtYXJrZXJcIj48L2Rpdj48ZGl2IGNsYXNzPVwic2wtbWFya2VyIG1hcmtlclwiPjwvZGl2PjwvZGl2PicpO1xuICB2YXIgZSA9ICQoJy5mYXJidGFzdGljJywgY29udGFpbmVyKTtcbiAgZmIud2hlZWwgPSAkKCcud2hlZWwnLCBjb250YWluZXIpLmdldCgwKTtcbiAgLy8gRGltZW5zaW9uc1xuICBmYi5yYWRpdXMgPSA4NDtcbiAgZmIuc3F1YXJlID0gMTAwO1xuICBmYi53aWR0aCA9IDE5NDtcblxuICAvLyBGaXggYmFja2dyb3VuZCBQTkdzIGluIElFNlxuICBpZiAobmF2aWdhdG9yLmFwcFZlcnNpb24ubWF0Y2goL01TSUUgWzAtNl1cXC4vKSkge1xuICAgICQoJyonLCBlKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLmN1cnJlbnRTdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgIT0gJ25vbmUnKSB7XG4gICAgICAgIHZhciBpbWFnZSA9IHRoaXMuY3VycmVudFN0eWxlLmJhY2tncm91bmRJbWFnZTtcbiAgICAgICAgaW1hZ2UgPSB0aGlzLmN1cnJlbnRTdHlsZS5iYWNrZ3JvdW5kSW1hZ2Uuc3Vic3RyaW5nKDUsIGltYWdlLmxlbmd0aCAtIDIpO1xuICAgICAgICAkKHRoaXMpLmNzcyh7XG4gICAgICAgICAgJ2JhY2tncm91bmRJbWFnZSc6ICdub25lJyxcbiAgICAgICAgICAnZmlsdGVyJzogXCJwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuQWxwaGFJbWFnZUxvYWRlcihlbmFibGVkPXRydWUsIHNpemluZ01ldGhvZD1jcm9wLCBzcmM9J1wiICsgaW1hZ2UgKyBcIicpXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogTGluayB0byB0aGUgZ2l2ZW4gZWxlbWVudChzKSBvciBjYWxsYmFjay5cbiAgICovXG4gIGZiLmxpbmtUbyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgIC8vIFVuYmluZCBwcmV2aW91cyBub2Rlc1xuICAgIGlmICh0eXBlb2YgZmIuY2FsbGJhY2sgPT0gJ29iamVjdCcpIHtcbiAgICAgICQoZmIuY2FsbGJhY2spLnVuYmluZCgna2V5dXAnLCBmYi51cGRhdGVWYWx1ZSk7XG4gICAgfVxuXG4gICAgLy8gUmVzZXQgY29sb3JcbiAgICBmYi5jb2xvciA9IG51bGw7XG5cbiAgICAvLyBCaW5kIGNhbGxiYWNrIG9yIGVsZW1lbnRzXG4gICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICBmYi5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgY2FsbGJhY2sgPT0gJ29iamVjdCcgfHwgdHlwZW9mIGNhbGxiYWNrID09ICdzdHJpbmcnKSB7XG4gICAgICBmYi5jYWxsYmFjayA9ICQoY2FsbGJhY2spO1xuICAgICAgZmIuY2FsbGJhY2suYmluZCgna2V5dXAgY2hhbmdlIGJsdXInLCBmYi51cGRhdGVWYWx1ZSk7XG4gICAgICBpZiAoZmIuY2FsbGJhY2suZ2V0KDApLnZhbHVlKSB7XG4gICAgICAgIGZiLnNldENvbG9yKGZiLmNhbGxiYWNrLmdldCgwKS52YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGZiLnVwZGF0ZVZhbHVlID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgaWYgKHRoaXMudmFsdWUgJiYgdGhpcy52YWx1ZSAhPSBmYi5jb2xvcikge1xuICAgICAgZmIuc2V0Q29sb3IodGhpcy52YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZSBjb2xvciB3aXRoIEhUTUwgc3ludGF4ICMxMjM0NTZcbiAgICovXG4gIGZiLnNldENvbG9yID0gZnVuY3Rpb24gKGNvbG9yKSB7XG4gICAgdmFyIHVucGFjayA9IGZiLnVucGFjayhjb2xvcik7XG4gICAgaWYgKGZiLmNvbG9yICE9IGNvbG9yICYmIHVucGFjaykge1xuICAgICAgZmIuY29sb3IgPSBjb2xvcjtcbiAgICAgIGZiLnJnYiA9IHVucGFjaztcbiAgICAgIGZiLmhzbCA9IGZiLlJHQlRvSFNMKGZiLnJnYik7XG4gICAgICBmYi51cGRhdGVEaXNwbGF5KCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZSBjb2xvciB3aXRoIEhTTCB0cmlwbGV0IFswLi4xLCAwLi4xLCAwLi4xXVxuICAgKi9cbiAgZmIuc2V0SFNMID0gZnVuY3Rpb24gKGhzbCkge1xuICAgIGZiLmhzbCA9IGhzbDtcbiAgICBmYi5yZ2IgPSBmYi5IU0xUb1JHQihoc2wpO1xuICAgIGZiLmNvbG9yID0gZmIucGFjayhmYi5yZ2IpO1xuICAgIGZiLnVwZGF0ZURpc3BsYXkoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBjb29yZGluYXRlcyBvZiB0aGUgZ2l2ZW4gZXZlbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlclxuICAgKiBvZiB0aGUgd2lkZ2V0LlxuICAgKi9cbiAgZmIud2lkZ2V0Q29vcmRzID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdmFyIHgsIHk7XG4gICAgdmFyIGVsID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnNyY0VsZW1lbnQ7XG4gICAgdmFyIHJlZmVyZW5jZSA9IGZiLndoZWVsO1xuXG4gICAgaWYgKHR5cGVvZiBldmVudC5vZmZzZXRYICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAvLyBVc2Ugb2Zmc2V0IGNvb3JkaW5hdGVzIGFuZCBmaW5kIGNvbW1vbiBvZmZzZXRQYXJlbnRcbiAgICAgIHZhciBwb3MgPSB7IHg6IGV2ZW50Lm9mZnNldFgsIHk6IGV2ZW50Lm9mZnNldFkgfTtcblxuICAgICAgLy8gU2VuZCB0aGUgY29vcmRpbmF0ZXMgdXB3YXJkcyB0aHJvdWdoIHRoZSBvZmZzZXRQYXJlbnQgY2hhaW4uXG4gICAgICB2YXIgZSA9IGVsO1xuICAgICAgd2hpbGUgKGUpIHtcbiAgICAgICAgZS5tb3VzZVggPSBwb3MueDtcbiAgICAgICAgZS5tb3VzZVkgPSBwb3MueTtcbiAgICAgICAgcG9zLnggKz0gZS5vZmZzZXRMZWZ0O1xuICAgICAgICBwb3MueSArPSBlLm9mZnNldFRvcDtcbiAgICAgICAgZSA9IGUub2Zmc2V0UGFyZW50O1xuICAgICAgfVxuXG4gICAgICAvLyBMb29rIGZvciB0aGUgY29vcmRpbmF0ZXMgc3RhcnRpbmcgZnJvbSB0aGUgd2hlZWwgd2lkZ2V0LlxuICAgICAgdmFyIGUgPSByZWZlcmVuY2U7XG4gICAgICB2YXIgb2Zmc2V0ID0geyB4OiAwLCB5OiAwIH1cbiAgICAgIHdoaWxlIChlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZS5tb3VzZVggIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICB4ID0gZS5tb3VzZVggLSBvZmZzZXQueDtcbiAgICAgICAgICB5ID0gZS5tb3VzZVkgLSBvZmZzZXQueTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBvZmZzZXQueCArPSBlLm9mZnNldExlZnQ7XG4gICAgICAgIG9mZnNldC55ICs9IGUub2Zmc2V0VG9wO1xuICAgICAgICBlID0gZS5vZmZzZXRQYXJlbnQ7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlc2V0IHN0b3JlZCBjb29yZGluYXRlc1xuICAgICAgZSA9IGVsO1xuICAgICAgd2hpbGUgKGUpIHtcbiAgICAgICAgZS5tb3VzZVggPSB1bmRlZmluZWQ7XG4gICAgICAgIGUubW91c2VZID0gdW5kZWZpbmVkO1xuICAgICAgICBlID0gZS5vZmZzZXRQYXJlbnQ7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gVXNlIGFic29sdXRlIGNvb3JkaW5hdGVzXG4gICAgICB2YXIgcG9zID0gZmIuYWJzb2x1dGVQb3NpdGlvbihyZWZlcmVuY2UpO1xuICAgICAgeCA9IChldmVudC5wYWdlWCB8fCAwKihldmVudC5jbGllbnRYICsgJCgnaHRtbCcpLmdldCgwKS5zY3JvbGxMZWZ0KSkgLSBwb3MueDtcbiAgICAgIHkgPSAoZXZlbnQucGFnZVkgfHwgMCooZXZlbnQuY2xpZW50WSArICQoJ2h0bWwnKS5nZXQoMCkuc2Nyb2xsVG9wKSkgLSBwb3MueTtcbiAgICB9XG4gICAgLy8gU3VidHJhY3QgZGlzdGFuY2UgdG8gbWlkZGxlXG4gICAgcmV0dXJuIHsgeDogeCAtIGZiLndpZHRoIC8gMiwgeTogeSAtIGZiLndpZHRoIC8gMiB9O1xuICB9XG5cbiAgLyoqXG4gICAqIE1vdXNlZG93biBoYW5kbGVyXG4gICAqL1xuICBmYi5tb3VzZWRvd24gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAvLyBDYXB0dXJlIG1vdXNlXG4gICAgaWYgKCFkb2N1bWVudC5kcmFnZ2luZykge1xuICAgICAgJChkb2N1bWVudCkuYmluZCgnbW91c2Vtb3ZlJywgZmIubW91c2Vtb3ZlKS5iaW5kKCdtb3VzZXVwJywgZmIubW91c2V1cCk7XG4gICAgICBkb2N1bWVudC5kcmFnZ2luZyA9IHRydWU7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgd2hpY2ggYXJlYSBpcyBiZWluZyBkcmFnZ2VkXG4gICAgdmFyIHBvcyA9IGZiLndpZGdldENvb3JkcyhldmVudCk7XG4gICAgZmIuY2lyY2xlRHJhZyA9IE1hdGgubWF4KE1hdGguYWJzKHBvcy54KSwgTWF0aC5hYnMocG9zLnkpKSAqIDIgPiBmYi5zcXVhcmU7XG5cbiAgICAvLyBQcm9jZXNzXG4gICAgZmIubW91c2Vtb3ZlKGV2ZW50KTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogTW91c2Vtb3ZlIGhhbmRsZXJcbiAgICovXG4gIGZiLm1vdXNlbW92ZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgIC8vIEdldCBjb29yZGluYXRlcyByZWxhdGl2ZSB0byBjb2xvciBwaWNrZXIgY2VudGVyXG4gICAgdmFyIHBvcyA9IGZiLndpZGdldENvb3JkcyhldmVudCk7XG5cbiAgICAvLyBTZXQgbmV3IEhTTCBwYXJhbWV0ZXJzXG4gICAgaWYgKGZiLmNpcmNsZURyYWcpIHtcbiAgICAgIHZhciBodWUgPSBNYXRoLmF0YW4yKHBvcy54LCAtcG9zLnkpIC8gNi4yODtcbiAgICAgIGlmIChodWUgPCAwKSBodWUgKz0gMTtcbiAgICAgIGZiLnNldEhTTChbaHVlLCBmYi5oc2xbMV0sIGZiLmhzbFsyXV0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHZhciBzYXQgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCAtKHBvcy54IC8gZmIuc3F1YXJlKSArIC41KSk7XG4gICAgICB2YXIgbHVtID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgLShwb3MueSAvIGZiLnNxdWFyZSkgKyAuNSkpO1xuICAgICAgZmIuc2V0SFNMKFtmYi5oc2xbMF0sIHNhdCwgbHVtXSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3VzZXVwIGhhbmRsZXJcbiAgICovXG4gIGZiLm1vdXNldXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gVW5jYXB0dXJlIG1vdXNlXG4gICAgJChkb2N1bWVudCkudW5iaW5kKCdtb3VzZW1vdmUnLCBmYi5tb3VzZW1vdmUpO1xuICAgICQoZG9jdW1lbnQpLnVuYmluZCgnbW91c2V1cCcsIGZiLm1vdXNldXApO1xuICAgIGRvY3VtZW50LmRyYWdnaW5nID0gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBtYXJrZXJzIGFuZCBzdHlsZXNcbiAgICovXG4gIGZiLnVwZGF0ZURpc3BsYXkgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gTWFya2Vyc1xuICAgIHZhciBhbmdsZSA9IGZiLmhzbFswXSAqIDYuMjg7XG4gICAgJCgnLmgtbWFya2VyJywgZSkuY3NzKHtcbiAgICAgIGxlZnQ6IE1hdGgucm91bmQoTWF0aC5zaW4oYW5nbGUpICogZmIucmFkaXVzICsgZmIud2lkdGggLyAyKSArICdweCcsXG4gICAgICB0b3A6IE1hdGgucm91bmQoLU1hdGguY29zKGFuZ2xlKSAqIGZiLnJhZGl1cyArIGZiLndpZHRoIC8gMikgKyAncHgnXG4gICAgfSk7XG5cbiAgICAkKCcuc2wtbWFya2VyJywgZSkuY3NzKHtcbiAgICAgIGxlZnQ6IE1hdGgucm91bmQoZmIuc3F1YXJlICogKC41IC0gZmIuaHNsWzFdKSArIGZiLndpZHRoIC8gMikgKyAncHgnLFxuICAgICAgdG9wOiBNYXRoLnJvdW5kKGZiLnNxdWFyZSAqICguNSAtIGZiLmhzbFsyXSkgKyBmYi53aWR0aCAvIDIpICsgJ3B4J1xuICAgIH0pO1xuXG4gICAgLy8gU2F0dXJhdGlvbi9MdW1pbmFuY2UgZ3JhZGllbnRcbiAgICAkKCcuY29sb3InLCBlKS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICdyZ2IoJyArIGZiLnBhY2soZmIuSFNMVG9SR0IoW2ZiLmhzbFswXSwgMSwgMC41XSkpICsgJyknKTtcblxuICAgIC8vIExpbmtlZCBlbGVtZW50cyBvciBjYWxsYmFja1xuICAgIGlmICh0eXBlb2YgZmIuY2FsbGJhY2sgPT0gJ29iamVjdCcpIHtcbiAgICAgIC8vIFNldCBiYWNrZ3JvdW5kL2ZvcmVncm91bmQgY29sb3JcbiAgICAgICQoZmIuY2FsbGJhY2spLmNzcyh7XG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYignICsgZmIuY29sb3IgKyAnKScsXG4gICAgICAgIGNvbG9yOiBmYi5oc2xbMl0gPiAwLjUgPyAnIzAwMCcgOiAnI2ZmZidcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDaGFuZ2UgbGlua2VkIHZhbHVlXG4gICAgICAkKGZiLmNhbGxiYWNrKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy52YWx1ZSAhPSBmYi5jb2xvcikge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBmYi5jb2xvcjtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBmYi5jYWxsYmFjayA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICBmYi5jYWxsYmFjay5jYWxsKGZiLCBmYi5jb2xvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhYnNvbHV0ZSBwb3NpdGlvbiBvZiBlbGVtZW50XG4gICAqL1xuICBmYi5hYnNvbHV0ZVBvc2l0aW9uID0gZnVuY3Rpb24gKGVsKSB7XG4gICAgdmFyIHIgPSB7IHg6IGVsLm9mZnNldExlZnQsIHk6IGVsLm9mZnNldFRvcCB9O1xuICAgIC8vIFJlc29sdmUgcmVsYXRpdmUgdG8gb2Zmc2V0UGFyZW50XG4gICAgaWYgKGVsLm9mZnNldFBhcmVudCkge1xuICAgICAgdmFyIHRtcCA9IGZiLmFic29sdXRlUG9zaXRpb24oZWwub2Zmc2V0UGFyZW50KTtcbiAgICAgIHIueCArPSB0bXAueDtcbiAgICAgIHIueSArPSB0bXAueTtcbiAgICB9XG4gICAgcmV0dXJuIHI7XG4gIH07XG5cbiAgLyogVmFyaW91cyBjb2xvciB1dGlsaXR5IGZ1bmN0aW9ucyAqL1xuICBmYi5wYWNrID0gZnVuY3Rpb24gKHJnYiwgaGV4KSB7XG4gICAgdmFyIHIgPSBNYXRoLnJvdW5kKHJnYlswXSAqIDI1NSk7XG4gICAgdmFyIGcgPSBNYXRoLnJvdW5kKHJnYlsxXSAqIDI1NSk7XG4gICAgdmFyIGIgPSBNYXRoLnJvdW5kKHJnYlsyXSAqIDI1NSk7XG4gICAgaWYgKGhleCkge1xuICAgICAgcmV0dXJuICcjJyArIChyIDwgMTYgPyAnMCcgOiAnJykgKyByLnRvU3RyaW5nKDE2KSArXG4gICAgICAgICAgICAgKGcgPCAxNiA/ICcwJyA6ICcnKSArIGcudG9TdHJpbmcoMTYpICtcbiAgICAgICAgICAgICAoYiA8IDE2ID8gJzAnIDogJycpICsgYi50b1N0cmluZygxNik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByLnRvU3RyaW5nKCkgKyAnLCcgKyBnLnRvU3RyaW5nKCkgKyAnLCcgKyBiLnRvU3RyaW5nKCk7XG4gICAgfVxuICB9XG5cbiAgZmIudW5wYWNrID0gZnVuY3Rpb24gKGNvbG9yKSB7XG4gICAgaWYgKCgvXFxkKyxcXGQrLFxcZC8pLnRlc3QoY29sb3IpKSB7XG4gICAgICB2YXIgbnVtcyA9IGNvbG9yLnNwbGl0KC8sLyk7XG4gICAgICByZXR1cm4gW3BhcnNlSW50KG51bXNbMF0sIDEwKSAvIDI1NSxcbiAgICAgICAgcGFyc2VJbnQobnVtc1sxXSwgMTApIC8gMjU1LFxuICAgICAgICBwYXJzZUludChudW1zWzJdLCAxMCkgLyAyNTVdO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb2xvci5sZW5ndGggPT0gNykge1xuICAgICAgcmV0dXJuIFtwYXJzZUludCgnMHgnICsgY29sb3Iuc3Vic3RyaW5nKDEsIDMpKSAvIDI1NSxcbiAgICAgICAgcGFyc2VJbnQoJzB4JyArIGNvbG9yLnN1YnN0cmluZygzLCA1KSkgLyAyNTUsXG4gICAgICAgIHBhcnNlSW50KCcweCcgKyBjb2xvci5zdWJzdHJpbmcoNSwgNykpIC8gMjU1XTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29sb3IubGVuZ3RoID09IDQpIHtcbiAgICAgIHJldHVybiBbcGFyc2VJbnQoJzB4JyArIGNvbG9yLnN1YnN0cmluZygxLCAyKSkgLyAxNSxcbiAgICAgICAgcGFyc2VJbnQoJzB4JyArIGNvbG9yLnN1YnN0cmluZygyLCAzKSkgLyAxNSxcbiAgICAgICAgcGFyc2VJbnQoJzB4JyArIGNvbG9yLnN1YnN0cmluZygzLCA0KSkgLyAxNV07XG4gICAgfVxuICB9XG5cbiAgZmIuSFNMVG9SR0IgPSBmdW5jdGlvbiAoaHNsKSB7XG4gICAgdmFyIG0xLCBtMiwgciwgZywgYjtcbiAgICB2YXIgaCA9IGhzbFswXSwgcyA9IGhzbFsxXSwgbCA9IGhzbFsyXTtcbiAgICBtMiA9IChsIDw9IDAuNSkgPyBsICogKHMgKyAxKSA6IGwgKyBzIC0gbCpzO1xuICAgIG0xID0gbCAqIDIgLSBtMjtcbiAgICByZXR1cm4gW3RoaXMuaHVlVG9SR0IobTEsIG0yLCBoKzAuMzMzMzMpLFxuICAgICAgICB0aGlzLmh1ZVRvUkdCKG0xLCBtMiwgaCksXG4gICAgICAgIHRoaXMuaHVlVG9SR0IobTEsIG0yLCBoLTAuMzMzMzMpXTtcbiAgfVxuXG4gIGZiLmh1ZVRvUkdCID0gZnVuY3Rpb24gKG0xLCBtMiwgaCkge1xuICAgIGggPSAoaCA8IDApID8gaCArIDEgOiAoKGggPiAxKSA/IGggLSAxIDogaCk7XG4gICAgaWYgKGggKiA2IDwgMSkgcmV0dXJuIG0xICsgKG0yIC0gbTEpICogaCAqIDY7XG4gICAgaWYgKGggKiAyIDwgMSkgcmV0dXJuIG0yO1xuICAgIGlmIChoICogMyA8IDIpIHJldHVybiBtMSArIChtMiAtIG0xKSAqICgwLjY2NjY2IC0gaCkgKiA2O1xuICAgIHJldHVybiBtMTtcbiAgfVxuXG4gIGZiLlJHQlRvSFNMID0gZnVuY3Rpb24gKHJnYikge1xuICAgIHZhciBtaW4sIG1heCwgZGVsdGEsIGgsIHMsIGw7XG4gICAgdmFyIHIgPSByZ2JbMF0sIGcgPSByZ2JbMV0sIGIgPSByZ2JbMl07XG4gICAgbWluID0gTWF0aC5taW4ociwgTWF0aC5taW4oZywgYikpO1xuICAgIG1heCA9IE1hdGgubWF4KHIsIE1hdGgubWF4KGcsIGIpKTtcbiAgICBkZWx0YSA9IG1heCAtIG1pbjtcbiAgICBsID0gKG1pbiArIG1heCkgLyAyO1xuICAgIHMgPSAwO1xuICAgIGlmIChsID4gMCAmJiBsIDwgMSkge1xuICAgICAgcyA9IGRlbHRhIC8gKGwgPCAwLjUgPyAoMiAqIGwpIDogKDIgLSAyICogbCkpO1xuICAgIH1cbiAgICBoID0gMDtcbiAgICBpZiAoZGVsdGEgPiAwKSB7XG4gICAgICBpZiAobWF4ID09IHIgJiYgbWF4ICE9IGcpIGggKz0gKGcgLSBiKSAvIGRlbHRhO1xuICAgICAgaWYgKG1heCA9PSBnICYmIG1heCAhPSBiKSBoICs9ICgyICsgKGIgLSByKSAvIGRlbHRhKTtcbiAgICAgIGlmIChtYXggPT0gYiAmJiBtYXggIT0gcikgaCArPSAoNCArIChyIC0gZykgLyBkZWx0YSk7XG4gICAgICBoIC89IDY7XG4gICAgfVxuICAgIHJldHVybiBbaCwgcywgbF07XG4gIH1cblxuICAvLyBJbnN0YWxsIG1vdXNlZG93biBoYW5kbGVyICh0aGUgb3RoZXJzIGFyZSBzZXQgb24gdGhlIGRvY3VtZW50IG9uLWRlbWFuZClcbiAgJCgnKicsIGUpLm1vdXNlZG93bihmYi5tb3VzZWRvd24pO1xuXG4gICAgLy8gSW5pdCBjb2xvclxuICBmYi5zZXRDb2xvcignIzAwMDAwMCcpO1xuXG4gIC8vIFNldCBsaW5rZWQgZWxlbWVudHMvY2FsbGJhY2tcbiAgaWYgKGNhbGxiYWNrKSB7XG4gICAgZmIubGlua1RvKGNhbGxiYWNrKTtcbiAgfVxufVxuXG59OyIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID0gVGhlIGZvbGxvd2luZyBhcmUgc2hvcnQgalF1ZXJ5IGV4dGVuc2lvbnMgdXNlZCBieSBjaHJvbW96b29tID1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigkKSB7XG4gIFxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy5qcycpKCQpLFxuICBmbG9vckhhY2sgPSB1dGlscy5mbG9vckhhY2s7XG5cbi8vIE1ha2UgYSB1bmlxdWUgSUQgZm9yIGFuIGFyYml0YXJ5IGVsZW1lbnQsIHVzaW5nIHRoZSBnaXZlbiBwcmVmaXggc3RyaW5nXG4kLnVuaXFJZCA9IGZ1bmN0aW9uKHByZWZpeCwgYWxzb0Rpc2FsbG93KSB7XG4gIHZhciByYW5kID0gZnVuY3Rpb24oKSB7IHJldHVybiBmbG9vckhhY2soTWF0aC5yYW5kb20oKSoxMDAwMDAwKTsgfTtcbiAgdmFyIG51bSA9IHJhbmQoKTtcbiAgd2hpbGUgKChhbHNvRGlzYWxsb3cgJiYgYWxzb0Rpc2FsbG93W251bV0pIHx8ICQoJyMnK3ByZWZpeCsnLScrbnVtKS5sZW5ndGgpIHsgbnVtID0gcmFuZCgpOyB9XG4gIHJldHVybiBwcmVmaXgrJy0nK251bTtcbn07XG5cbi8vIE1ha2UgYSBuZXcgZWxlbWVudCAoZmFzdGVyIHRoYW4gJChcIjxlbGVtLz5cIikpXG4kLm1rID0gZnVuY3Rpb24oTlMsIGVsZW0pIHsgXG4gIHJldHVybiAoZWxlbSAmJiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMpID8gJChkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoTlMsIGVsZW0pKSBcbiAgICA6ICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbGVtID0gTlMpKTsgXG59XG5cbi8vIGpRdWVyeSBIb3RrZXlzIFBsdWdpbiwgY29weXJpZ2h0IDIwMTAsIEpvaG4gUmVzaWdcbi8vIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzXG4vLyBodHRwczovL2dpdGh1Yi5jb20vamVyZXNpZy9qcXVlcnkuaG90a2V5c1xuJC5ob3RrZXlzID0ge1xuICB2ZXJzaW9uOiBcIjAuOFwiLFxuXG4gIHNwZWNpYWxLZXlzOiB7XG4gICAgODogXCJiYWNrc3BhY2VcIiwgOTogXCJ0YWJcIiwgMTM6IFwicmV0dXJuXCIsIDE2OiBcInNoaWZ0XCIsIDE3OiBcImN0cmxcIiwgMTg6IFwiYWx0XCIsIDE5OiBcInBhdXNlXCIsXG4gICAgMjA6IFwiY2Fwc2xvY2tcIiwgMjc6IFwiZXNjXCIsIDMyOiBcInNwYWNlXCIsIDMzOiBcInBhZ2V1cFwiLCAzNDogXCJwYWdlZG93blwiLCAzNTogXCJlbmRcIiwgMzY6IFwiaG9tZVwiLFxuICAgIDM3OiBcImxlZnRcIiwgMzg6IFwidXBcIiwgMzk6IFwicmlnaHRcIiwgNDA6IFwiZG93blwiLCA0NTogXCJpbnNlcnRcIiwgNDY6IFwiZGVsXCIsIFxuICAgIDk2OiBcIjBcIiwgOTc6IFwiMVwiLCA5ODogXCIyXCIsIDk5OiBcIjNcIiwgMTAwOiBcIjRcIiwgMTAxOiBcIjVcIiwgMTAyOiBcIjZcIiwgMTAzOiBcIjdcIixcbiAgICAxMDQ6IFwiOFwiLCAxMDU6IFwiOVwiLCAxMDY6IFwiKlwiLCAxMDc6IFwiK1wiLCAxMDk6IFwiLVwiLCAxMTA6IFwiLlwiLCAxMTEgOiBcIi9cIiwgXG4gICAgMTEyOiBcImYxXCIsIDExMzogXCJmMlwiLCAxMTQ6IFwiZjNcIiwgMTE1OiBcImY0XCIsIDExNjogXCJmNVwiLCAxMTc6IFwiZjZcIiwgMTE4OiBcImY3XCIsIDExOTogXCJmOFwiLCBcbiAgICAxMjA6IFwiZjlcIiwgMTIxOiBcImYxMFwiLCAxMjI6IFwiZjExXCIsIDEyMzogXCJmMTJcIiwgMTQ0OiBcIm51bWxvY2tcIiwgMTQ1OiBcInNjcm9sbFwiLCAxOTE6IFwiL1wiLCAyMjQ6IFwibWV0YVwiXG4gIH0sXG5cbiAgc2hpZnROdW1zOiB7XG4gICAgXCJgXCI6IFwiflwiLCBcIjFcIjogXCIhXCIsIFwiMlwiOiBcIkBcIiwgXCIzXCI6IFwiI1wiLCBcIjRcIjogXCIkXCIsIFwiNVwiOiBcIiVcIiwgXCI2XCI6IFwiXlwiLCBcIjdcIjogXCImXCIsIFxuICAgIFwiOFwiOiBcIipcIiwgXCI5XCI6IFwiKFwiLCBcIjBcIjogXCIpXCIsIFwiLVwiOiBcIl9cIiwgXCI9XCI6IFwiK1wiLCBcIjtcIjogXCI6IFwiLCBcIidcIjogXCJcXFwiXCIsIFwiLFwiOiBcIjxcIiwgXG4gICAgXCIuXCI6IFwiPlwiLCAgXCIvXCI6IFwiP1wiLCAgXCJcXFxcXCI6IFwifFwiXG4gIH1cbn07XG5cbmZ1bmN0aW9uIGtleUhhbmRsZXIoIGhhbmRsZU9iaiApIHtcbiAgLy8gT25seSBjYXJlIHdoZW4gYSBwb3NzaWJsZSBpbnB1dCBoYXMgYmVlbiBzcGVjaWZpZWRcbiAgaWYgKCB0eXBlb2YgaGFuZGxlT2JqLmRhdGEgIT09IFwic3RyaW5nXCIgKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG9yaWdIYW5kbGVyID0gaGFuZGxlT2JqLmhhbmRsZXIsXG4gICAga2V5cyA9IGhhbmRsZU9iai5kYXRhLnRvTG93ZXJDYXNlKCkuc3BsaXQoXCIgXCIpO1xuXG4gIGhhbmRsZU9iai5oYW5kbGVyID0gZnVuY3Rpb24oIGV2ZW50ICkge1xuICAgIC8vIERvbid0IGZpcmUgaW4gdGV4dC1hY2NlcHRpbmcgaW5wdXRzIHRoYXQgd2UgZGlkbid0IGRpcmVjdGx5IGJpbmQgdG9cbiAgICBpZiAoIHRoaXMgIT09IGV2ZW50LnRhcmdldCAmJiAoL3RleHRhcmVhfHNlbGVjdC9pLnRlc3QoIGV2ZW50LnRhcmdldC5ub2RlTmFtZSApIHx8XG4gICAgICBldmVudC50YXJnZXQudHlwZSA9PT0gXCJ0ZXh0XCIgfHwgZXZlbnQudGFyZ2V0LnR5cGUgPT0gXCJzZWFyY2hcIiB8fCBldmVudC50YXJnZXQudHlwZSA9PT0gXCJ1cmxcIikgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gS2V5cHJlc3MgcmVwcmVzZW50cyBjaGFyYWN0ZXJzLCBub3Qgc3BlY2lhbCBrZXlzXG4gICAgdmFyIHNwZWNpYWwgPSBldmVudC50eXBlICE9PSBcImtleXByZXNzXCIgJiYgJC5ob3RrZXlzLnNwZWNpYWxLZXlzWyBldmVudC53aGljaCBdLFxuICAgICAgY2hhcmFjdGVyID0gU3RyaW5nLmZyb21DaGFyQ29kZSggZXZlbnQud2hpY2ggKS50b0xvd2VyQ2FzZSgpLFxuICAgICAga2V5LCBtb2RpZiA9IFwiXCIsIHBvc3NpYmxlID0ge307XG5cbiAgICAvLyBjaGVjayBjb21iaW5hdGlvbnMgKGFsdHxjdHJsfHNoaWZ0K2FueXRoaW5nKVxuICAgIGlmICggZXZlbnQuYWx0S2V5ICYmIHNwZWNpYWwgIT09IFwiYWx0XCIgKSB7XG4gICAgICBtb2RpZiArPSBcImFsdCtcIjtcbiAgICB9XG5cbiAgICBpZiAoIGV2ZW50LmN0cmxLZXkgJiYgc3BlY2lhbCAhPT0gXCJjdHJsXCIgKSB7XG4gICAgICBtb2RpZiArPSBcImN0cmwrXCI7XG4gICAgfVxuXG4gICAgLy8gVE9ETzogTmVlZCB0byBtYWtlIHN1cmUgdGhpcyB3b3JrcyBjb25zaXN0ZW50bHkgYWNyb3NzIHBsYXRmb3Jtc1xuICAgIGlmICggZXZlbnQubWV0YUtleSAmJiAhZXZlbnQuY3RybEtleSAmJiBzcGVjaWFsICE9PSBcIm1ldGFcIiApIHtcbiAgICAgIG1vZGlmICs9IFwibWV0YStcIjtcbiAgICB9XG5cbiAgICBpZiAoIGV2ZW50LnNoaWZ0S2V5ICYmIHNwZWNpYWwgIT09IFwic2hpZnRcIiApIHtcbiAgICAgIG1vZGlmICs9IFwic2hpZnQrXCI7XG4gICAgfVxuXG4gICAgaWYgKCBzcGVjaWFsICkge1xuICAgICAgcG9zc2libGVbIG1vZGlmICsgc3BlY2lhbCBdID0gdHJ1ZTtcblxuICAgIH0gZWxzZSB7XG4gICAgICBwb3NzaWJsZVsgbW9kaWYgKyBjaGFyYWN0ZXIgXSA9IHRydWU7XG4gICAgICBwb3NzaWJsZVsgbW9kaWYgKyAkLmhvdGtleXMuc2hpZnROdW1zWyBjaGFyYWN0ZXIgXSBdID0gdHJ1ZTtcblxuICAgICAgLy8gXCIkXCIgY2FuIGJlIHRyaWdnZXJlZCBhcyBcIlNoaWZ0KzRcIiBvciBcIlNoaWZ0KyRcIiBvciBqdXN0IFwiJFwiXG4gICAgICBpZiAoIG1vZGlmID09PSBcInNoaWZ0K1wiICkge1xuICAgICAgICBwb3NzaWJsZVsgJC5ob3RrZXlzLnNoaWZ0TnVtc1sgY2hhcmFjdGVyIF0gXSA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yICggdmFyIGkgPSAwLCBsID0ga2V5cy5sZW5ndGg7IGkgPCBsOyBpKysgKSB7XG4gICAgICBpZiAoIHBvc3NpYmxlWyBrZXlzW2ldIF0gKSB7XG4gICAgICAgIHJldHVybiBvcmlnSGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xufVxuXG4kLmVhY2goWyBcImtleWRvd25cIiwgXCJrZXl1cFwiLCBcImtleXByZXNzXCIgXSwgZnVuY3Rpb24oKSB7XG4gICQuZXZlbnQuc3BlY2lhbFsgdGhpcyBdID0geyBhZGQ6IGtleUhhbmRsZXIgfTtcbn0pO1xuXG4vLyBqUXVlcnkgc29ydEVsZW1lbnRzIGJ5IEphbWVzIFBhZG9sc2V5LCBkdWFsIGxpY2Vuc2VkIE1JVC9HUExcbi8vIEZvdW5kIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9wYWRvbHNleS9qUXVlcnktUGx1Z2lucy90cmVlL21hc3Rlci9zb3J0RWxlbWVudHMvXG4kLmZuLnNvcnRFbGVtZW50cyA9IChmdW5jdGlvbigpe1xuICB2YXIgc29ydCA9IFtdLnNvcnQ7XG4gIHJldHVybiBmdW5jdGlvbihjb21wYXJhdG9yLCBnZXRTb3J0YWJsZSkge1xuICAgIGdldFNvcnRhYmxlID0gZ2V0U29ydGFibGUgfHwgZnVuY3Rpb24oKXtyZXR1cm4gdGhpczt9O1xuICAgIHZhciBwbGFjZW1lbnRzID0gdGhpcy5tYXAoZnVuY3Rpb24oKXtcbiAgICAgIHZhciBzb3J0RWxlbWVudCA9IGdldFNvcnRhYmxlLmNhbGwodGhpcyksXG4gICAgICAgIHBhcmVudE5vZGUgPSBzb3J0RWxlbWVudC5wYXJlbnROb2RlLFxuICAgICAgICAvLyBTaW5jZSB0aGUgZWxlbWVudCBpdHNlbGYgd2lsbCBjaGFuZ2UgcG9zaXRpb24sIHdlIGhhdmVcbiAgICAgICAgLy8gdG8gaGF2ZSBzb21lIHdheSBvZiBzdG9yaW5nIGl0cyBvcmlnaW5hbCBwb3NpdGlvbiBpblxuICAgICAgICAvLyB0aGUgRE9NLiBUaGUgZWFzaWVzdCB3YXkgaXMgdG8gaGF2ZSBhICdmbGFnJyBub2RlOlxuICAgICAgICBuZXh0U2libGluZyA9IHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKFxuICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnKSxcbiAgICAgICAgICBzb3J0RWxlbWVudC5uZXh0U2libGluZ1xuICAgICAgICApO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAocGFyZW50Tm9kZSA9PT0gdGhpcykge1xuICAgICAgICAgIHRocm93IFwiWW91IGNhbid0IHNvcnQgZWxlbWVudHMgaWYgYW55IG9uZSBpcyBhIGRlc2NlbmRhbnQgb2YgYW5vdGhlci5cIjtcbiAgICAgICAgfVxuICAgICAgICAvLyBJbnNlcnQgYmVmb3JlIGZsYWc6XG4gICAgICAgIHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMsIG5leHRTaWJsaW5nKTtcbiAgICAgICAgLy8gUmVtb3ZlIGZsYWc6XG4gICAgICAgIHBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobmV4dFNpYmxpbmcpO1xuICAgICAgfTtcbiAgICB9KTtcblxuICAgIHJldHVybiBzb3J0LmNhbGwodGhpcywgY29tcGFyYXRvcikuZWFjaChmdW5jdGlvbihpKXtcbiAgICAgIHBsYWNlbWVudHNbaV0uY2FsbChnZXRTb3J0YWJsZS5jYWxsKHRoaXMpKTtcbiAgICB9KTtcbiAgfTtcbn0pKCk7XG5cbi8vIGpRdWVyeSBDb29raWUgUGx1Z2luLCBmb3VuZCBhdCBodHRwczovL2dpdGh1Yi5jb20vY2FyaGFydGwvanF1ZXJ5LWNvb2tpZVxuLy8gQ29weXJpZ2h0IDIwMTEsIEtsYXVzIEhhcnRsXG4vLyBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbihmdW5jdGlvbigkKSB7XG4gICQuY29va2llID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSwgb3B0aW9ucykge1xuICAgIC8vIGtleSBhbmQgYXQgbGVhc3QgdmFsdWUgZ2l2ZW4sIHNldCBjb29raWUuLi5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgKCEvT2JqZWN0Ly50ZXN0KE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkpIHx8IHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpKSB7XG4gICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIG9wdGlvbnMpO1xuXG4gICAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBvcHRpb25zLmV4cGlyZXMgPSAtMTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmV4cGlyZXMgPT09ICdudW1iZXInKSB7XG4gICAgICAgIHZhciBkYXlzID0gb3B0aW9ucy5leHBpcmVzLCB0ID0gb3B0aW9ucy5leHBpcmVzID0gbmV3IERhdGUoKTtcbiAgICAgICAgdC5zZXREYXRlKHQuZ2V0RGF0ZSgpICsgZGF5cyk7XG4gICAgICB9XG5cbiAgICAgIHZhbHVlID0gU3RyaW5nKHZhbHVlKTtcblxuICAgICAgcmV0dXJuIChkb2N1bWVudC5jb29raWUgPSBbXG4gICAgICAgIGVuY29kZVVSSUNvbXBvbmVudChrZXkpLCAnPScsIG9wdGlvbnMucmF3ID8gdmFsdWUgOiBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpLFxuICAgICAgICAvLyB1c2UgZXhwaXJlcyBhdHRyaWJ1dGUsIG1heC1hZ2UgaXMgbm90IHN1cHBvcnRlZCBieSBJRVxuICAgICAgICBvcHRpb25zLmV4cGlyZXMgPyAnOyBleHBpcmVzPScgKyBvcHRpb25zLmV4cGlyZXMudG9VVENTdHJpbmcoKSA6ICcnLFxuICAgICAgICBvcHRpb25zLnBhdGggICAgPyAnOyBwYXRoPScgKyBvcHRpb25zLnBhdGggOiAnJyxcbiAgICAgICAgb3B0aW9ucy5kb21haW4gID8gJzsgZG9tYWluPScgKyBvcHRpb25zLmRvbWFpbiA6ICcnLFxuICAgICAgICBvcHRpb25zLnNlY3VyZSAgPyAnOyBzZWN1cmUnIDogJydcbiAgICAgIF0uam9pbignJykpO1xuICAgIH1cblxuICAgIC8vIGtleSBhbmQgcG9zc2libHkgb3B0aW9ucyBnaXZlbiwgZ2V0IGNvb2tpZS4uLlxuICAgIG9wdGlvbnMgPSB2YWx1ZSB8fCB7fTtcbiAgICB2YXIgZGVjb2RlID0gb3B0aW9ucy5yYXcgPyBmdW5jdGlvbihzKSB7IHJldHVybiBzOyB9IDogZGVjb2RlVVJJQ29tcG9uZW50O1xuXG4gICAgdmFyIHBhaXJzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7ICcpO1xuICAgIGZvciAodmFyIGkgPSAwLCBwYWlyOyBwYWlyID0gcGFpcnNbaV0gJiYgcGFpcnNbaV0uc3BsaXQoJz0nKTsgaSsrKSB7XG4gICAgICAvLyBJRSBzYXZlcyBjb29raWVzIHdpdGggZW1wdHkgc3RyaW5nIGFzIFwiYzsgXCIsIGUuZy4gd2l0aG91dCBcIj1cIiBhcyBvcHBvc2VkIHRvIEVPTUIsIHRodXMgcGFpclsxXSBtYXkgYmUgdW5kZWZpbmVkXG4gICAgICBpZiAoZGVjb2RlKHBhaXJbMF0pID09PSBrZXkpIHJldHVybiBkZWNvZGUocGFpclsxXSB8fCAnJyk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9O1xufSkoJCk7XG5cbi8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvOTAxMTE1L2dldC1xdWVyeS1zdHJpbmctdmFsdWVzLWluLWphdmFzY3JpcHRcbiQudXJsUGFyYW1zID0gZnVuY3Rpb24oKSB7XG4gIHZhciBwID0ge30sXG4gICAgZSxcbiAgICBhID0gL1xcKy9nLCAgLy8gUmVnZXggZm9yIHJlcGxhY2luZyBhZGRpdGlvbiBzeW1ib2wgd2l0aCBhIHNwYWNlXG4gICAgciA9IC8oW14mPV0rKT0/KFteJl0qKS9nLFxuICAgIGQgPSBmdW5jdGlvbiAocykgeyByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHMucmVwbGFjZShhLCBcIiBcIikpOyB9LFxuICAgIHEgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKTtcblxuICB3aGlsZSAoZSA9IHIuZXhlYyhxKSkgeyBcbiAgICB2YXIgayA9IGQoZVsxXSksIHYgPSBkKGVbMl0pOyBcbiAgICBwW2tdID0gcFtrXSA/IChfLmlzQXJyYXkocFtrXSkgPyBwW2tdLnB1c2godikgOiBbcFtrXSwgdl0pIDogdjsgXG4gIH1cbiAgcmV0dXJuIHA7XG59O1xuXG59OyIsIiAvKlxuICogVGlwVGlwXG4gKiBDb3B5cmlnaHQgMjAxMCBEcmV3IFdpbHNvblxuICogd3d3LmRyZXd3aWxzb24uY29tXG4gKiBjb2RlLmRyZXd3aWxzb24uY29tL2VudHJ5L3RpcHRpcC1qcXVlcnktcGx1Z2luXG4gKlxuICogVmVyc2lvbiAxLjMgICAtICAgVXBkYXRlZDogTWFyLiAyMywgMjAxMFxuICpcbiAqIFRoaXMgUGx1Zy1JbiB3aWxsIGNyZWF0ZSBhIGN1c3RvbSB0b29sdGlwIHRvIHJlcGxhY2UgdGhlIGRlZmF1bHRcbiAqIGJyb3dzZXIgdG9vbHRpcC4gSXQgaXMgZXh0cmVtZWx5IGxpZ2h0d2VpZ2h0IGFuZCB2ZXJ5IHNtYXJ0IGluXG4gKiB0aGF0IGl0IGRldGVjdHMgdGhlIGVkZ2VzIG9mIHRoZSBicm93c2VyIHdpbmRvdyBhbmQgd2lsbCBtYWtlIHN1cmVcbiAqIHRoZSB0b29sdGlwIHN0YXlzIHdpdGhpbiB0aGUgY3VycmVudCB3aW5kb3cgc2l6ZS4gQXMgYSByZXN1bHQgdGhlXG4gKiB0b29sdGlwIHdpbGwgYWRqdXN0IGl0c2VsZiB0byBiZSBkaXNwbGF5ZWQgYWJvdmUsIGJlbG93LCB0byB0aGUgbGVmdCBcbiAqIG9yIHRvIHRoZSByaWdodCBkZXBlbmRpbmcgb24gd2hhdCBpcyBuZWNlc3NhcnkgdG8gc3RheSB3aXRoaW4gdGhlXG4gKiBicm93c2VyIHdpbmRvdy4gSXQgaXMgY29tcGxldGVseSBjdXN0b21pemFibGUgYXMgd2VsbCB2aWEgQ1NTLlxuICpcbiAqIFRoaXMgVGlwVGlwIGpRdWVyeSBwbHVnLWluIGlzIGR1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBhbmQgR1BMIGxpY2Vuc2VzOlxuICogICBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuICogICBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLmh0bWxcbiAqL1xuXG52YXIgXyA9IHJlcXVpcmUoJy4uL3VuZGVyc2NvcmUubWluLmpzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oJCl7XG4gICAgXG4gIHZhciBkZWZhdWx0cyA9IHsgXG4gICAgYWN0aXZhdGlvbjogXCJob3ZlclwiLFxuICAgIGtlZXBBbGl2ZTogZmFsc2UsXG4gICAgZWRnZU9mZnNldDogMyxcbiAgICBkZWZhdWx0UG9zaXRpb246IFwiYm90dG9tXCIsXG4gICAgZGVsYXk6IDQwMCxcbiAgICBmYWRlSW46IDIwMCxcbiAgICBmYWRlT3V0OiAyMDAsXG4gICAgYXR0cmlidXRlOiBcInRpdGxlXCIsXG4gICAgY29udGVudDogZmFsc2UsIC8vIEhUTUwgb3IgU3RyaW5nIHRvIGZpbGwgVGlwVElwIHdpdGhcbiAgICBlbnRlcjogZnVuY3Rpb24oKXt9LFxuICAgIGFzeW5jOiBmYWxzZSxcbiAgICBzdGFydEFjdGl2YXRlZDogZmFsc2VcbiAgfTtcbiAgdmFyICR0aXB0aXBfaG9sZGVyLCAkdGlwdGlwX2NvbnRlbnQsICR0aXB0aXBfYXJyb3csIGFjdGl2YXRpbmdfZWxlbTtcbiAgXG4gIGZ1bmN0aW9uIHNob3dfdGlwdGlwKG9wdHMpIHsgXG4gICAgJHRpcHRpcF9ob2xkZXIuc3RvcCh0cnVlLCB0cnVlKS5mYWRlSW4ob3B0cy5mYWRlSW4pO1xuICAgIGlmIChvcHRzLmFzeW5jICYmICEkKHRoaXMpLmRhdGEoJ3RpcHRpcEFjdGl2ZScpKSB7IHJldHVybjsgfVxuICAgIFxuICB9O1xuICBcbiAgZnVuY3Rpb24gZmlsbF9zaG93X3RpcHRpcChkLCBzZWxmLCBjb250ZW50KSB7XG4gICAgdmFyIG9wdHMgPSBkLm9wdHMsXG4gICAgICAkb3JnX2VsZW0gPSBkLm9yZ19lbGVtLFxuICAgICAgb3JnX3RpdGxlID0gY29udGVudCA/IGNvbnRlbnQgOiBkLm9yZ190aXRsZSxcbiAgICAgIHRpbWVvdXQgPSAkKHNlbGYpLmRhdGEoJ3RpcHRpcFRpbWVvdXQnKSxcbiAgICAgIGFjdGl2ZSA9ICQoc2VsZikuZGF0YSgndGlwdGlwQWN0aXZlJyksXG4gICAgICBmaXJlZEFmdGVyID0gKG5ldyBEYXRlKS5nZXRUaW1lKCkgLSBhY3RpdmU7XG4gICAgICBcbiAgICBpZiAob3B0cy5hc3luYykge1xuICAgICAgaWYgKCFhY3RpdmUpIHsgcmV0dXJuOyB9XG4gICAgICBpZiAoY29udGVudCA9PT0gZmFsc2UpIHsgJCh0aGlzKS5kYXRhKCd0aXB0aXBBY3RpdmUnLCBmYWxzZSk7IHJldHVybjsgfVxuICAgIH1cbiAgICBcbiAgICBpZiAoXy5pc1N0cmluZyhvcmdfdGl0bGUpKSB7ICR0aXB0aXBfY29udGVudC5odG1sKG9yZ190aXRsZSk7IH1cbiAgICBlbHNlIHsgJHRpcHRpcF9jb250ZW50LmVtcHR5KCkuYXBwZW5kKG9yZ190aXRsZSk7IH1cbiAgICAkdGlwdGlwX2hvbGRlci5yZW1vdmVBdHRyKFwiY2xhc3NcIikuY3NzKFwibWFyZ2luXCIsIDApO1xuICAgICR0aXB0aXBfYXJyb3cucmVtb3ZlQXR0cihcInN0eWxlXCIpO1xuXG4gICAgdmFyIG9mZnNldCA9ICRvcmdfZWxlbS5vZmZzZXQoKSxcbiAgICAgIHRvcCA9IG9mZnNldC50b3AsXG4gICAgICBsZWZ0ID0gb2Zmc2V0LmxlZnQsXG4gICAgICBzY3JvbGxfdG9wID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpLFxuICAgICAgc2Nyb2xsX2xlZnQgPSAkKHdpbmRvdykuc2Nyb2xsTGVmdCgpLFxuICAgICAgd2luX3dpZHRoID0gJCh3aW5kb3cpLndpZHRoKCksXG4gICAgICB3aW5faGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpLFxuICAgICAgb3JnX3dpZHRoID0gJG9yZ19lbGVtLm91dGVyV2lkdGgoKSxcbiAgICAgIG9yZ19oZWlnaHQgPSAkb3JnX2VsZW0ub3V0ZXJIZWlnaHQoKTtcblxuICAgIGlmIChsZWZ0IC0gc2Nyb2xsX2xlZnQgPj0gMCkgeyBvcmdfd2lkdGggPSBNYXRoLm1pbihvcmdfd2lkdGgsIHdpbl93aWR0aCAtIChsZWZ0IC0gc2Nyb2xsX2xlZnQpKTsgfVxuICAgIGVsc2UgeyBvcmdfd2lkdGggKz0gKGxlZnQgLSBzY3JvbGxfbGVmdCk7IGxlZnQgPSBzY3JvbGxfbGVmdDsgfVxuICAgIFxuICAgIHZhciB0aXBfdyA9ICR0aXB0aXBfaG9sZGVyLm91dGVyV2lkdGgoKSxcbiAgICAgIHRpcF9oID0gJHRpcHRpcF9ob2xkZXIub3V0ZXJIZWlnaHQoKSxcbiAgICAgIHdfY29tcGFyZSA9IE1hdGgucm91bmQoKG9yZ193aWR0aCAtIHRpcF93KSAvIDIpLFxuICAgICAgaF9jb21wYXJlID0gTWF0aC5yb3VuZCgob3JnX2hlaWdodCAtIHRpcF9oKSAvIDIpLFxuICAgICAgbWFyZ19sZWZ0ID0gTWF0aC5yb3VuZChsZWZ0ICsgd19jb21wYXJlKSxcbiAgICAgIG1hcmdfdG9wID0gTWF0aC5yb3VuZCh0b3AgKyBvcmdfaGVpZ2h0ICsgb3B0cy5lZGdlT2Zmc2V0KSxcbiAgICAgIHRfY2xhc3MgPSBcIlwiLFxuICAgICAgYXJyb3dfdG9wID0gXCJcIixcbiAgICAgIGFycm93X2xlZnQgPSBNYXRoLnJvdW5kKHRpcF93IC0gMTIpIC8gMjtcblxuICAgIHRfY2xhc3MgPSBcIl9cIiArIG9wdHMuZGVmYXVsdFBvc2l0aW9uO1xuXG4gICAgdmFyIHJpZ2h0X2NvbXBhcmUgPSAod19jb21wYXJlICsgbGVmdCkgPCBzY3JvbGxfbGVmdCxcbiAgICAgIGxlZnRfY29tcGFyZSA9ICh0aXBfdyArIGxlZnQpID4gd2luX3dpZHRoO1xuXG4gICAgaWYgKChyaWdodF9jb21wYXJlICYmIHdfY29tcGFyZSA8IDApIHx8ICh0X2NsYXNzID09IFwiX3JpZ2h0XCIgJiYgIWxlZnRfY29tcGFyZSkgXG4gICAgICAgIHx8ICh0X2NsYXNzID09IFwiX2xlZnRcIiAmJiBsZWZ0IDwgKHRpcF93ICsgb3B0cy5lZGdlT2Zmc2V0ICsgNSkpKSB7XG4gICAgICB0X2NsYXNzID0gXCJfcmlnaHRcIjtcbiAgICAgIGFycm93X3RvcCA9IE1hdGgucm91bmQodGlwX2ggLSAxMykgLyAyO1xuICAgICAgYXJyb3dfbGVmdCA9IC0xMjtcbiAgICAgIG1hcmdfbGVmdCA9IE1hdGgucm91bmQobGVmdCArIG9yZ193aWR0aCArIG9wdHMuZWRnZU9mZnNldCk7XG4gICAgICBtYXJnX3RvcCA9IE1hdGgucm91bmQodG9wICsgaF9jb21wYXJlKTtcbiAgICB9IGVsc2UgaWYoKGxlZnRfY29tcGFyZSAmJiB3X2NvbXBhcmUgPCAwKSB8fCAodF9jbGFzcyA9PSBcIl9sZWZ0XCIgJiYgIXJpZ2h0X2NvbXBhcmUpKXtcbiAgICAgIHRfY2xhc3MgPSBcIl9sZWZ0XCI7XG4gICAgICBhcnJvd190b3AgPSBNYXRoLnJvdW5kKHRpcF9oIC0gMTMpIC8gMjtcbiAgICAgIGFycm93X2xlZnQgPSAgTWF0aC5yb3VuZCh0aXBfdyk7XG4gICAgICBtYXJnX2xlZnQgPSBNYXRoLnJvdW5kKGxlZnQgLSAodGlwX3cgKyBvcHRzLmVkZ2VPZmZzZXQgKyA1KSk7XG4gICAgICBtYXJnX3RvcCA9IE1hdGgucm91bmQodG9wICsgaF9jb21wYXJlKTtcbiAgICB9XG5cbiAgICB2YXIgdG9wX2NvbXBhcmUgPSAodG9wICsgb3JnX2hlaWdodCArIG9wdHMuZWRnZU9mZnNldCArIHRpcF9oICsgOCkgPiB3aW5faGVpZ2h0ICsgc2Nyb2xsX3RvcCxcbiAgICAgIGJvdHRvbV9jb21wYXJlID0gKCh0b3AgKyBvcmdfaGVpZ2h0KSAtIChvcHRzLmVkZ2VPZmZzZXQgKyB0aXBfaCArIDgpKSA8IDA7XG5cbiAgICBpZih0b3BfY29tcGFyZSB8fCAodF9jbGFzcyA9PSBcIl9ib3R0b21cIiAmJiB0b3BfY29tcGFyZSkgfHwgKHRfY2xhc3MgPT0gXCJfdG9wXCIgJiYgIWJvdHRvbV9jb21wYXJlKSl7XG4gICAgICBpZih0X2NsYXNzID09IFwiX3RvcFwiIHx8IHRfY2xhc3MgPT0gXCJfYm90dG9tXCIpe1xuICAgICAgICB0X2NsYXNzID0gXCJfdG9wXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0X2NsYXNzID0gdF9jbGFzcytcIl90b3BcIjtcbiAgICAgIH1cbiAgICAgIGFycm93X3RvcCA9IHRpcF9oO1xuICAgICAgbWFyZ190b3AgPSBNYXRoLnJvdW5kKHRvcCAtICh0aXBfaCArIDUgKyBvcHRzLmVkZ2VPZmZzZXQpKTtcbiAgICB9IGVsc2UgaWYoYm90dG9tX2NvbXBhcmUgfCAodF9jbGFzcyA9PSBcIl90b3BcIiAmJiBib3R0b21fY29tcGFyZSkgfHwgKHRfY2xhc3MgPT0gXCJfYm90dG9tXCIgJiYgIXRvcF9jb21wYXJlKSl7XG4gICAgICBpZih0X2NsYXNzID09IFwiX3RvcFwiIHx8IHRfY2xhc3MgPT0gXCJfYm90dG9tXCIpe1xuICAgICAgICB0X2NsYXNzID0gXCJfYm90dG9tXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0X2NsYXNzID0gdF9jbGFzcytcIl9ib3R0b21cIjtcbiAgICAgIH1cbiAgICAgIGFycm93X3RvcCA9IC0xMjsgICAgICAgICAgICBcbiAgICAgIG1hcmdfdG9wID0gTWF0aC5yb3VuZCh0b3AgKyBvcmdfaGVpZ2h0ICsgb3B0cy5lZGdlT2Zmc2V0KTtcbiAgICB9XG5cbiAgICBpZih0X2NsYXNzID09IFwiX3JpZ2h0X3RvcFwiIHx8IHRfY2xhc3MgPT0gXCJfbGVmdF90b3BcIil7XG4gICAgICBtYXJnX3RvcCA9IG1hcmdfdG9wICsgNTtcbiAgICB9IGVsc2UgaWYodF9jbGFzcyA9PSBcIl9yaWdodF9ib3R0b21cIiB8fCB0X2NsYXNzID09IFwiX2xlZnRfYm90dG9tXCIpeyAgIFxuICAgICAgbWFyZ190b3AgPSBtYXJnX3RvcCAtIDU7XG4gICAgfVxuICAgIGlmKHRfY2xhc3MgPT0gXCJfbGVmdF90b3BcIiB8fCB0X2NsYXNzID09IFwiX2xlZnRfYm90dG9tXCIpeyAgXG4gICAgICBtYXJnX2xlZnQgPSBtYXJnX2xlZnQgKyA1O1xuICAgIH1cbiAgICAkdGlwdGlwX2Fycm93LmNzcyh7XCJtYXJnaW4tbGVmdFwiOiBhcnJvd19sZWZ0K1wicHhcIiwgXCJtYXJnaW4tdG9wXCI6IGFycm93X3RvcCtcInB4XCJ9KTtcbiAgICAkdGlwdGlwX2hvbGRlci5jc3Moe1wibWFyZ2luLWxlZnRcIjogbWFyZ19sZWZ0K1wicHhcIiwgXCJtYXJnaW4tdG9wXCI6IG1hcmdfdG9wK1wicHhcIn0pLmF0dHIoXCJjbGFzc1wiLCBcInRpcFwiK3RfY2xhc3MpO1xuXG4gICAgaWYgKHRpbWVvdXQpIHsgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOyB9XG4gICAgaWYgKGZpcmVkQWZ0ZXIgPiBvcHRzLmRlbGF5KSB7IHNob3dfdGlwdGlwKG9wdHMpOyB9IFxuICAgIGVsc2UgeyAkKHNlbGYpLmRhdGEoJ3RpcHRpcFRpbWVvdXQnLCBzZXRUaW1lb3V0KF8uYmluZChzaG93X3RpcHRpcCwgc2VsZiwgb3B0cyksIG9wdHMuZGVsYXkgLSBmaXJlZEFmdGVyKSk7IH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGFjdGl2ZV90aXB0aXAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIGQgPSBlLmRhdGEsXG4gICAgICBjb250ZW50O1xuICAgICQodGhpcykuZGF0YSgndGlwdGlwQWN0aXZlJywgKG5ldyBEYXRlKS5nZXRUaW1lKCkpO1xuICAgIGlmIChhY3RpdmF0aW5nX2VsZW0gJiYgYWN0aXZhdGluZ19lbGVtICE9IHNlbGYpIHsgJC50aXBUaXAuaGlkZSgpOyB9XG4gICAgYWN0aXZhdGluZ19lbGVtID0gc2VsZjtcbiAgICBpZiAoZC5vcHRzLmFzeW5jKSB7IGQub3B0cy5lbnRlci5jYWxsKHRoaXMsIGZ1bmN0aW9uKG5ld0NvbnRlbnQpIHsgZmlsbF9zaG93X3RpcHRpcChkLCBzZWxmLCBuZXdDb250ZW50KTsgfSk7IH1cbiAgICBlbHNlIHtcbiAgICAgIGNvbnRlbnQgPSBkLm9wdHMuZW50ZXIuY2FsbCh0aGlzKTtcbiAgICAgIGZpbGxfc2hvd190aXB0aXAoZCwgdGhpcywgY29udGVudCk7IFxuICAgIH1cbiAgICByZXR1cm4gZC5yZXRGYWxzZSA/IGZhbHNlIDogbnVsbDtcbiAgfVxuICBcbiAgZnVuY3Rpb24gZGVhY3RpdmVfdGlwdGlwKGUsIG5vdykge1xuICAgIHZhciBkID0gZS5kYXRhLFxuICAgICAgdGltZW91dCA9ICQodGhpcykuZGF0YSgndGlwdGlwVGltZW91dCcpO1xuICAgICQodGhpcykuZGF0YSgndGlwdGlwQWN0aXZlJywgZmFsc2UpO1xuICAgIGlmICh0aW1lb3V0KXsgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOyB9XG4gICAgYWN0aXZhdGluZ19lbGVtID0gbnVsbDtcbiAgICAkdGlwdGlwX2hvbGRlci5mYWRlT3V0KG5vdyA/IGQub3B0cy5mYWRlT3V0IDogMCk7XG4gIH1cbiAgXG4gICQudGlwVGlwID0ge1xuICAgIGhpZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyICRhY3RpdmUgPSAkKGFjdGl2YXRpbmdfZWxlbSk7XG4gICAgICBpZiAoJGFjdGl2ZS5wYXJlbnQoKS5sZW5ndGggPiAwKSB7ICRhY3RpdmUudHJpZ2dlcignaGlkZVRpcFRpcCcpOyB9IFxuICAgICAgZWxzZSB7ICR0aXB0aXBfaG9sZGVyICYmICR0aXB0aXBfaG9sZGVyLmhpZGUoKTsgfVxuICAgICAgYWN0aXZhdGluZ19lbGVtID0gbnVsbDtcbiAgICB9XG4gIH07XG4gIFxuICAkLmZuLnRpcFRpcCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICB2YXIgb3B0cyA9ICQuZXh0ZW5kKHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7XG4gICAgXG4gICAgLy8gU2V0dXAgdGlwIHRpcCBlbGVtZW50cyBhbmQgcmVuZGVyIHRoZW0gdG8gdGhlIERPTSwgaWYgdGhpcyB3YXNuJ3QgYWxyZWFkeSBkb25lIHByZXZpb3VzbHlcbiAgICBpZih0eXBlb2YgJHRpcHRpcF9ob2xkZXIgPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgJHRpcHRpcF9ob2xkZXIgPSAkKCc8ZGl2IGlkPVwidGlwdGlwX2hvbGRlclwiPjwvZGl2PicpO1xuICAgICAgJHRpcHRpcF9jb250ZW50ID0gJCgnPGRpdiBpZD1cInRpcHRpcF9jb250ZW50XCI+PC9kaXY+Jyk7XG4gICAgICAkdGlwdGlwX2Fycm93ID0gJCgnPGRpdiBpZD1cInRpcHRpcF9hcnJvd1wiPjwvZGl2PicpO1xuICAgICAgJChcImJvZHlcIikuYXBwZW5kKCR0aXB0aXBfaG9sZGVyLmh0bWwoJHRpcHRpcF9jb250ZW50KS5wcmVwZW5kKCR0aXB0aXBfYXJyb3cuaHRtbCgnPGRpdiBpZD1cInRpcHRpcF9hcnJvd19pbm5lclwiPjwvZGl2PicpKSk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgIHZhciAkb3JnX2VsZW0gPSAkKHRoaXMpO1xuICAgICAgXG4gICAgICBpZiAob3B0cy5jb250ZW50KSB7XG4gICAgICAgIHZhciBvcmdfdGl0bGUgPSBvcHRzLmNvbnRlbnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgb3JnX3RpdGxlID0gJG9yZ19lbGVtLmF0dHIob3B0cy5hdHRyaWJ1dGUpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAob3JnX3RpdGxlICE9IFwiXCIgfHwgb3B0cy5hc3luYykge1xuICAgICAgICAkb3JnX2VsZW0uZGF0YSgndGl0bGUnLCBvcmdfdGl0bGUpO1xuICAgICAgICAkb3JnX2VsZW0ucmVtb3ZlQXR0cihvcHRzLmF0dHJpYnV0ZSk7IC8vcmVtb3ZlIG9yaWdpbmFsIEF0dHJpYnV0ZVxuICAgICAgICB2YXIgZWRhdGEgPSB7b3JnX2VsZW06ICRvcmdfZWxlbSwgb3JnX3RpdGxlOiBvcmdfdGl0bGUsIG9wdHM6IG9wdHN9O1xuICAgICAgICBcbiAgICAgICAgaWYgKG9wdHMuYWN0aXZhdGlvbiA9PSBcImhvdmVyXCIpIHtcbiAgICAgICAgICAkb3JnX2VsZW0uYmluZCgnbW91c2VlbnRlciBzaG93VGlwVGlwJywgZWRhdGEsIGFjdGl2ZV90aXB0aXApO1xuICAgICAgICAgIGlmIChvcHRzLmtlZXBBbGl2ZSkgeyAkdGlwdGlwX2hvbGRlci5iaW5kKCdtb3VzZWxlYXZlIGhpZGVUaXBUaXAnLCBlZGF0YSwgZGVhY3RpdmVfdGlwdGlwKTsgfVxuICAgICAgICAgIGVsc2UgeyAkb3JnX2VsZW0uYmluZCgnbW91c2VsZWF2ZSBoaWRlVGlwVGlwJywgZWRhdGEsIGRlYWN0aXZlX3RpcHRpcCk7IH1cbiAgICAgICAgfSBlbHNlIGlmIChvcHRzLmFjdGl2YXRpb24gPT0gXCJmb2N1c1wiKSB7XG4gICAgICAgICAgJG9yZ19lbGVtLmJpbmQoJ2ZvY3VzIHNob3dUaXBUaXAnLCBlZGF0YSwgYWN0aXZlX3RpcHRpcCkuYmluZCgnYmx1ciBoaWRlVGlwVGlwJywgZWRhdGEsIGRlYWN0aXZlX3RpcHRpcCk7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0cy5hY3RpdmF0aW9uID09IFwiY2xpY2tcIikge1xuICAgICAgICAgICRvcmdfZWxlbS5iaW5kKCdjbGljayBzaG93VGlwVGlwJywgJC5leHRlbmQoe3JldEZhbHNlOiB0cnVlfSwgZWRhdGEpLCBhY3RpdmVfdGlwdGlwKTtcbiAgICAgICAgICBpZihvcHRzLmtlZXBBbGl2ZSl7ICR0aXB0aXBfaG9sZGVyLmJpbmQoJ21vdXNlbGVhdmUgaGlkZVRpcFRpcCcsIGVkYXRhLCBkZWFjdGl2ZV90aXB0aXApOyB9IFxuICAgICAgICAgIGVsc2UgeyAkb3JnX2VsZW0uYmluZCgnbW91c2VsZWF2ZSBoaWRlVGlwVGlwJywgZWRhdGEsIGRlYWN0aXZlX3RpcHRpcCk7IH1cbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0cy5zdGFydEFjdGl2YXRlZCkgeyAkb3JnX2VsZW0udHJpZ2dlcignc2hvd1RpcFRpcCcpOyB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn07IiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigkKSB7XG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gPSBUaGUgZm9sbG93aW5nIGFyZSBoZWxwZXIgZnVuY3Rpb25zIHVzZWQgd2lkZWx5IHRocm91Z2hvdXQgdGhlIHJlc3Qgb2YgdGhlIGNvZGUgPVxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIFxuICB1dGlscyA9IHt9O1xuICBcbiAgLy8gRmFzdGVyIHRoYW4gTWF0aC5mbG9vciAoaHR0cDovL3dlYmRvb2QuY29tLz9wPTIxOSlcbiAgdXRpbHMuZmxvb3JIYWNrID0gZnVuY3Rpb24obnVtKSB7IHJldHVybiAobnVtIDw8IDApIC0gKG51bSA8IDAgPyAxIDogMCk7IH1cbiAgXG4gIC8vIFBhZHMgYSBudW1iZXIgd2l0aCBmcm9udC1sZWFkaW5nIDAncyB0byBnaXZlbiBsZW5ndGhcbiAgdXRpbHMucGFkID0gZnVuY3Rpb24obnVtYmVyLCBsZW5ndGgpIHtcbiAgICB2YXIgc3RyID0gJycgKyBudW1iZXI7XG4gICAgd2hpbGUgKHN0ci5sZW5ndGggPCBsZW5ndGgpIHsgc3RyID0gJzAnICsgc3RyOyB9XG4gICAgcmV0dXJuIHN0cjtcbiAgfVxuXG4gIC8vIFR1cm5zIGFuIGFyYml0cmFyeSBzdHJpbmcgaW50byBzb21ldGhpbmcgdGhhdCBjYW4gYmUgdXNlZCBhcyBhbiBlbGVtZW50J3MgY2xhc3NcbiAgdXRpbHMuY2xhc3NGcmllbmRseSA9IGZ1bmN0aW9uKHZhbCkgeyByZXR1cm4gdmFsLnRvU3RyaW5nKCkucmVwbGFjZSgvW15fYS16QS1aMC05LV0vZywgJy0nKTsgfVxuICBcbiAgLy8gTW9zdGx5IGZvciBkZWJ1Z2dpbmc7IHNob3cgdGhlIGZwcyBpbiB0aGUgYm90dG9tLXJpZ2h0IGNvcm5lciBvZiB0aGUgYnJvd3NlclxuICB1dGlscy5mcHMgPSBmdW5jdGlvbihhLCBiLCBjKSB7XG4gICAgJCgnI2ZwcycpLnRleHQoYSArICcgJyArIHV0aWxzLmZsb29ySGFjaygxMDAwL2IpICsgJyAnICsgdXRpbHMuZmxvb3JIYWNrKGMqMTApLzEwICsgJyAnICsgJCgnI2Jyb3dzZXIgKicpLmxlbmd0aCk7XG4gIH1cbiAgXG4gIC8vIEEgc2ltcGxpc3RpYyBoYXNoIGZ1bmN0aW9uIGZvciBxdWlja2x5IHR1cm5pbmcgc3RyaW5ncyBpbnRvIG51bWJlcnNcbiAgLy8gTm90ZSB0aGF0IHNpbmNlIHRoZSBoYXNoIHNwYWNlIGlzIDJeMzIsIGNvbGxpc2lvbnMgYXJlIHByYWN0aWNhbGx5IGd1YXJhbnRlZWQgYWZ0ZXIgODBrIHN0cmluZ3MsIFxuICAvLyBhbmQgdGhlcmUncyBhIDUlIGNoYW5jZSBhdCAyMGs6IGh0dHA6Ly9iZXR0ZXJleHBsYWluZWQuY29tL2FydGljbGVzL3VuZGVyc3RhbmRpbmctdGhlLWJpcnRoZGF5LXBhcmFkb3gvXG4gIHV0aWxzLnNob3J0SGFzaCA9IGZ1bmN0aW9uKHN0cikge1xuICAgIHZhciBoYXNoID0gMDtcbiAgICBpZiAoc3RyLmxlbmd0aCA9PSAwKSByZXR1cm4gaGFzaDtcbiAgICBmb3IgKGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjaHIgPSBzdHIuY2hhckNvZGVBdChpKTtcbiAgICAgIGhhc2ggPSAoKGhhc2g8PDUpLWhhc2gpK2NocjtcbiAgICAgIGhhc2ggPSBoYXNoICYgaGFzaDtcbiAgICB9XG4gICAgcmV0dXJuIGhhc2g7XG4gIH1cbiAgXG4gIC8vIEdldCB0aGUgbGFzdCBuYW1lIGluIGEgcGF0aC1saWtlIHN0cmluZyAoYWZ0ZXIgdGhlIGxhc3Qgc2xhc2gvYmFja3NsYXNoKVxuICB1dGlscy5iYXNlbmFtZSA9IGZ1bmN0aW9uKHBhdGgpIHsgcmV0dXJuIHBhdGgucmVwbGFjZSgvXi4qW1xcL1xcXFxdL2csICcnKTsgfTtcbiAgXG4gIC8vIERlY29kZSBjaGFyYWN0ZXJzIHRoYXQgYXJlIHNhZmUgd2l0aGluIG91ciBxdWVyeSBzdHJpbmdzLCBmb3IgaW5jcmVhc2VkIHJlYWRhYmlsaXR5XG4gIHV0aWxzLmRlY29kZVNhZmVPY3RldHMgPSBmdW5jdGlvbihxdWVyeSkge1xuICAgIHZhciBzYWZlID0geyczQSc6ICc6JywgJzQwJzogJ0AnLCAnN0MnOiAnfCcsICcyRic6ICcvJ307XG4gICAgcmV0dXJuIHF1ZXJ5LnJlcGxhY2UoLyUoWzAtOUEtRl17Mn0pL2dpLCBmdW5jdGlvbihtLCBvY3QpIHsgcmV0dXJuIHNhZmVbb2N0XSB8fCBtOyB9KTtcbiAgfVxuICBcbiAgLy8gRXNjYXBlIHNvbWV0aGluZyBzbyBpdCBjYW4gYmUgaW5zZXJ0ZWQgaW50byBhIHJlZ3VsYXIgZXhwcmVzc2lvblxuICB1dGlscy5yZWdFeHBRdW90ZSA9IGZ1bmN0aW9uKHN0cikgeyByZXR1cm4gc3RyLnJlcGxhY2UoLyhbLj8qK14kW1xcXVxcXFwoKXt9LV0pL2csIFwiXFxcXCQxXCIpOyB9O1xuICBcbiAgcmV0dXJuIHV0aWxzO1xuICBcbn07IiwiLy8gICAgIFVuZGVyc2NvcmUuanMgMS44LjNcbi8vICAgICBodHRwOi8vdW5kZXJzY29yZWpzLm9yZ1xuLy8gICAgIChjKSAyMDA5LTIwMTUgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnNcbi8vICAgICBVbmRlcnNjb3JlIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLlxuKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuKXtmdW5jdGlvbiB0KHQscixlLHUsaSxvKXtmb3IoO2k+PTAmJm8+aTtpKz1uKXt2YXIgYT11P3VbaV06aTtlPXIoZSx0W2FdLGEsdCl9cmV0dXJuIGV9cmV0dXJuIGZ1bmN0aW9uKHIsZSx1LGkpe2U9YihlLGksNCk7dmFyIG89IWsocikmJm0ua2V5cyhyKSxhPShvfHxyKS5sZW5ndGgsYz1uPjA/MDphLTE7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MyYmKHU9cltvP29bY106Y10sYys9biksdChyLGUsdSxvLGMsYSl9fWZ1bmN0aW9uIHQobil7cmV0dXJuIGZ1bmN0aW9uKHQscixlKXtyPXgocixlKTtmb3IodmFyIHU9Tyh0KSxpPW4+MD8wOnUtMTtpPj0wJiZ1Pmk7aSs9bilpZihyKHRbaV0saSx0KSlyZXR1cm4gaTtyZXR1cm4tMX19ZnVuY3Rpb24gcihuLHQscil7cmV0dXJuIGZ1bmN0aW9uKGUsdSxpKXt2YXIgbz0wLGE9TyhlKTtpZihcIm51bWJlclwiPT10eXBlb2YgaSluPjA/bz1pPj0wP2k6TWF0aC5tYXgoaSthLG8pOmE9aT49MD9NYXRoLm1pbihpKzEsYSk6aSthKzE7ZWxzZSBpZihyJiZpJiZhKXJldHVybiBpPXIoZSx1KSxlW2ldPT09dT9pOi0xO2lmKHUhPT11KXJldHVybiBpPXQobC5jYWxsKGUsbyxhKSxtLmlzTmFOKSxpPj0wP2krbzotMTtmb3IoaT1uPjA/bzphLTE7aT49MCYmYT5pO2krPW4paWYoZVtpXT09PXUpcmV0dXJuIGk7cmV0dXJuLTF9fWZ1bmN0aW9uIGUobix0KXt2YXIgcj1JLmxlbmd0aCxlPW4uY29uc3RydWN0b3IsdT1tLmlzRnVuY3Rpb24oZSkmJmUucHJvdG90eXBlfHxhLGk9XCJjb25zdHJ1Y3RvclwiO2ZvcihtLmhhcyhuLGkpJiYhbS5jb250YWlucyh0LGkpJiZ0LnB1c2goaSk7ci0tOylpPUlbcl0saSBpbiBuJiZuW2ldIT09dVtpXSYmIW0uY29udGFpbnModCxpKSYmdC5wdXNoKGkpfXZhciB1PXRoaXMsaT11Ll8sbz1BcnJheS5wcm90b3R5cGUsYT1PYmplY3QucHJvdG90eXBlLGM9RnVuY3Rpb24ucHJvdG90eXBlLGY9by5wdXNoLGw9by5zbGljZSxzPWEudG9TdHJpbmcscD1hLmhhc093blByb3BlcnR5LGg9QXJyYXkuaXNBcnJheSx2PU9iamVjdC5rZXlzLGc9Yy5iaW5kLHk9T2JqZWN0LmNyZWF0ZSxkPWZ1bmN0aW9uKCl7fSxtPWZ1bmN0aW9uKG4pe3JldHVybiBuIGluc3RhbmNlb2YgbT9uOnRoaXMgaW5zdGFuY2VvZiBtP3ZvaWQodGhpcy5fd3JhcHBlZD1uKTpuZXcgbShuKX07XCJ1bmRlZmluZWRcIiE9dHlwZW9mIGV4cG9ydHM/KFwidW5kZWZpbmVkXCIhPXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzJiYoZXhwb3J0cz1tb2R1bGUuZXhwb3J0cz1tKSxleHBvcnRzLl89bSk6dS5fPW0sbS5WRVJTSU9OPVwiMS44LjNcIjt2YXIgYj1mdW5jdGlvbihuLHQscil7aWYodD09PXZvaWQgMClyZXR1cm4gbjtzd2l0Y2gobnVsbD09cj8zOnIpe2Nhc2UgMTpyZXR1cm4gZnVuY3Rpb24ocil7cmV0dXJuIG4uY2FsbCh0LHIpfTtjYXNlIDI6cmV0dXJuIGZ1bmN0aW9uKHIsZSl7cmV0dXJuIG4uY2FsbCh0LHIsZSl9O2Nhc2UgMzpyZXR1cm4gZnVuY3Rpb24ocixlLHUpe3JldHVybiBuLmNhbGwodCxyLGUsdSl9O2Nhc2UgNDpyZXR1cm4gZnVuY3Rpb24ocixlLHUsaSl7cmV0dXJuIG4uY2FsbCh0LHIsZSx1LGkpfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gbi5hcHBseSh0LGFyZ3VtZW50cyl9fSx4PWZ1bmN0aW9uKG4sdCxyKXtyZXR1cm4gbnVsbD09bj9tLmlkZW50aXR5Om0uaXNGdW5jdGlvbihuKT9iKG4sdCxyKTptLmlzT2JqZWN0KG4pP20ubWF0Y2hlcihuKTptLnByb3BlcnR5KG4pfTttLml0ZXJhdGVlPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHgobix0LDEvMCl9O3ZhciBfPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIGZ1bmN0aW9uKHIpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg7aWYoMj5lfHxudWxsPT1yKXJldHVybiByO2Zvcih2YXIgdT0xO2U+dTt1KyspZm9yKHZhciBpPWFyZ3VtZW50c1t1XSxvPW4oaSksYT1vLmxlbmd0aCxjPTA7YT5jO2MrKyl7dmFyIGY9b1tjXTt0JiZyW2ZdIT09dm9pZCAwfHwocltmXT1pW2ZdKX1yZXR1cm4gcn19LGo9ZnVuY3Rpb24obil7aWYoIW0uaXNPYmplY3QobikpcmV0dXJue307aWYoeSlyZXR1cm4geShuKTtkLnByb3RvdHlwZT1uO3ZhciB0PW5ldyBkO3JldHVybiBkLnByb3RvdHlwZT1udWxsLHR9LHc9ZnVuY3Rpb24obil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiBudWxsPT10P3ZvaWQgMDp0W25dfX0sQT1NYXRoLnBvdygyLDUzKS0xLE89dyhcImxlbmd0aFwiKSxrPWZ1bmN0aW9uKG4pe3ZhciB0PU8obik7cmV0dXJuXCJudW1iZXJcIj09dHlwZW9mIHQmJnQ+PTAmJkE+PXR9O20uZWFjaD1tLmZvckVhY2g9ZnVuY3Rpb24obix0LHIpe3Q9Yih0LHIpO3ZhciBlLHU7aWYoayhuKSlmb3IoZT0wLHU9bi5sZW5ndGg7dT5lO2UrKyl0KG5bZV0sZSxuKTtlbHNle3ZhciBpPW0ua2V5cyhuKTtmb3IoZT0wLHU9aS5sZW5ndGg7dT5lO2UrKyl0KG5baVtlXV0saVtlXSxuKX1yZXR1cm4gbn0sbS5tYXA9bS5jb2xsZWN0PWZ1bmN0aW9uKG4sdCxyKXt0PXgodCxyKTtmb3IodmFyIGU9IWsobikmJm0ua2V5cyhuKSx1PShlfHxuKS5sZW5ndGgsaT1BcnJheSh1KSxvPTA7dT5vO28rKyl7dmFyIGE9ZT9lW29dOm87aVtvXT10KG5bYV0sYSxuKX1yZXR1cm4gaX0sbS5yZWR1Y2U9bS5mb2xkbD1tLmluamVjdD1uKDEpLG0ucmVkdWNlUmlnaHQ9bS5mb2xkcj1uKC0xKSxtLmZpbmQ9bS5kZXRlY3Q9ZnVuY3Rpb24obix0LHIpe3ZhciBlO3JldHVybiBlPWsobik/bS5maW5kSW5kZXgobix0LHIpOm0uZmluZEtleShuLHQsciksZSE9PXZvaWQgMCYmZSE9PS0xP25bZV06dm9pZCAwfSxtLmZpbHRlcj1tLnNlbGVjdD1mdW5jdGlvbihuLHQscil7dmFyIGU9W107cmV0dXJuIHQ9eCh0LHIpLG0uZWFjaChuLGZ1bmN0aW9uKG4scix1KXt0KG4scix1KSYmZS5wdXNoKG4pfSksZX0sbS5yZWplY3Q9ZnVuY3Rpb24obix0LHIpe3JldHVybiBtLmZpbHRlcihuLG0ubmVnYXRlKHgodCkpLHIpfSxtLmV2ZXJ5PW0uYWxsPWZ1bmN0aW9uKG4sdCxyKXt0PXgodCxyKTtmb3IodmFyIGU9IWsobikmJm0ua2V5cyhuKSx1PShlfHxuKS5sZW5ndGgsaT0wO3U+aTtpKyspe3ZhciBvPWU/ZVtpXTppO2lmKCF0KG5bb10sbyxuKSlyZXR1cm4hMX1yZXR1cm4hMH0sbS5zb21lPW0uYW55PWZ1bmN0aW9uKG4sdCxyKXt0PXgodCxyKTtmb3IodmFyIGU9IWsobikmJm0ua2V5cyhuKSx1PShlfHxuKS5sZW5ndGgsaT0wO3U+aTtpKyspe3ZhciBvPWU/ZVtpXTppO2lmKHQobltvXSxvLG4pKXJldHVybiEwfXJldHVybiExfSxtLmNvbnRhaW5zPW0uaW5jbHVkZXM9bS5pbmNsdWRlPWZ1bmN0aW9uKG4sdCxyLGUpe3JldHVybiBrKG4pfHwobj1tLnZhbHVlcyhuKSksKFwibnVtYmVyXCIhPXR5cGVvZiByfHxlKSYmKHI9MCksbS5pbmRleE9mKG4sdCxyKT49MH0sbS5pbnZva2U9ZnVuY3Rpb24obix0KXt2YXIgcj1sLmNhbGwoYXJndW1lbnRzLDIpLGU9bS5pc0Z1bmN0aW9uKHQpO3JldHVybiBtLm1hcChuLGZ1bmN0aW9uKG4pe3ZhciB1PWU/dDpuW3RdO3JldHVybiBudWxsPT11P3U6dS5hcHBseShuLHIpfSl9LG0ucGx1Y2s9ZnVuY3Rpb24obix0KXtyZXR1cm4gbS5tYXAobixtLnByb3BlcnR5KHQpKX0sbS53aGVyZT1mdW5jdGlvbihuLHQpe3JldHVybiBtLmZpbHRlcihuLG0ubWF0Y2hlcih0KSl9LG0uZmluZFdoZXJlPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG0uZmluZChuLG0ubWF0Y2hlcih0KSl9LG0ubWF4PWZ1bmN0aW9uKG4sdCxyKXt2YXIgZSx1LGk9LTEvMCxvPS0xLzA7aWYobnVsbD09dCYmbnVsbCE9bil7bj1rKG4pP246bS52YWx1ZXMobik7Zm9yKHZhciBhPTAsYz1uLmxlbmd0aDtjPmE7YSsrKWU9blthXSxlPmkmJihpPWUpfWVsc2UgdD14KHQsciksbS5lYWNoKG4sZnVuY3Rpb24obixyLGUpe3U9dChuLHIsZSksKHU+b3x8dT09PS0xLzAmJmk9PT0tMS8wKSYmKGk9bixvPXUpfSk7cmV0dXJuIGl9LG0ubWluPWZ1bmN0aW9uKG4sdCxyKXt2YXIgZSx1LGk9MS8wLG89MS8wO2lmKG51bGw9PXQmJm51bGwhPW4pe249ayhuKT9uOm0udmFsdWVzKG4pO2Zvcih2YXIgYT0wLGM9bi5sZW5ndGg7Yz5hO2ErKyllPW5bYV0saT5lJiYoaT1lKX1lbHNlIHQ9eCh0LHIpLG0uZWFjaChuLGZ1bmN0aW9uKG4scixlKXt1PXQobixyLGUpLChvPnV8fDEvMD09PXUmJjEvMD09PWkpJiYoaT1uLG89dSl9KTtyZXR1cm4gaX0sbS5zaHVmZmxlPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxyPWsobik/bjptLnZhbHVlcyhuKSxlPXIubGVuZ3RoLHU9QXJyYXkoZSksaT0wO2U+aTtpKyspdD1tLnJhbmRvbSgwLGkpLHQhPT1pJiYodVtpXT11W3RdKSx1W3RdPXJbaV07cmV0dXJuIHV9LG0uc2FtcGxlPWZ1bmN0aW9uKG4sdCxyKXtyZXR1cm4gbnVsbD09dHx8cj8oayhuKXx8KG49bS52YWx1ZXMobikpLG5bbS5yYW5kb20obi5sZW5ndGgtMSldKTptLnNodWZmbGUobikuc2xpY2UoMCxNYXRoLm1heCgwLHQpKX0sbS5zb3J0Qnk9ZnVuY3Rpb24obix0LHIpe3JldHVybiB0PXgodCxyKSxtLnBsdWNrKG0ubWFwKG4sZnVuY3Rpb24obixyLGUpe3JldHVybnt2YWx1ZTpuLGluZGV4OnIsY3JpdGVyaWE6dChuLHIsZSl9fSkuc29ydChmdW5jdGlvbihuLHQpe3ZhciByPW4uY3JpdGVyaWEsZT10LmNyaXRlcmlhO2lmKHIhPT1lKXtpZihyPmV8fHI9PT12b2lkIDApcmV0dXJuIDE7aWYoZT5yfHxlPT09dm9pZCAwKXJldHVybi0xfXJldHVybiBuLmluZGV4LXQuaW5kZXh9KSxcInZhbHVlXCIpfTt2YXIgRj1mdW5jdGlvbihuKXtyZXR1cm4gZnVuY3Rpb24odCxyLGUpe3ZhciB1PXt9O3JldHVybiByPXgocixlKSxtLmVhY2godCxmdW5jdGlvbihlLGkpe3ZhciBvPXIoZSxpLHQpO24odSxlLG8pfSksdX19O20uZ3JvdXBCeT1GKGZ1bmN0aW9uKG4sdCxyKXttLmhhcyhuLHIpP25bcl0ucHVzaCh0KTpuW3JdPVt0XX0pLG0uaW5kZXhCeT1GKGZ1bmN0aW9uKG4sdCxyKXtuW3JdPXR9KSxtLmNvdW50Qnk9RihmdW5jdGlvbihuLHQscil7bS5oYXMobixyKT9uW3JdKys6bltyXT0xfSksbS50b0FycmF5PWZ1bmN0aW9uKG4pe3JldHVybiBuP20uaXNBcnJheShuKT9sLmNhbGwobik6ayhuKT9tLm1hcChuLG0uaWRlbnRpdHkpOm0udmFsdWVzKG4pOltdfSxtLnNpemU9ZnVuY3Rpb24obil7cmV0dXJuIG51bGw9PW4/MDprKG4pP24ubGVuZ3RoOm0ua2V5cyhuKS5sZW5ndGh9LG0ucGFydGl0aW9uPWZ1bmN0aW9uKG4sdCxyKXt0PXgodCxyKTt2YXIgZT1bXSx1PVtdO3JldHVybiBtLmVhY2gobixmdW5jdGlvbihuLHIsaSl7KHQobixyLGkpP2U6dSkucHVzaChuKX0pLFtlLHVdfSxtLmZpcnN0PW0uaGVhZD1tLnRha2U9ZnVuY3Rpb24obix0LHIpe3JldHVybiBudWxsPT1uP3ZvaWQgMDpudWxsPT10fHxyP25bMF06bS5pbml0aWFsKG4sbi5sZW5ndGgtdCl9LG0uaW5pdGlhbD1mdW5jdGlvbihuLHQscil7cmV0dXJuIGwuY2FsbChuLDAsTWF0aC5tYXgoMCxuLmxlbmd0aC0obnVsbD09dHx8cj8xOnQpKSl9LG0ubGFzdD1mdW5jdGlvbihuLHQscil7cmV0dXJuIG51bGw9PW4/dm9pZCAwOm51bGw9PXR8fHI/bltuLmxlbmd0aC0xXTptLnJlc3QobixNYXRoLm1heCgwLG4ubGVuZ3RoLXQpKX0sbS5yZXN0PW0udGFpbD1tLmRyb3A9ZnVuY3Rpb24obix0LHIpe3JldHVybiBsLmNhbGwobixudWxsPT10fHxyPzE6dCl9LG0uY29tcGFjdD1mdW5jdGlvbihuKXtyZXR1cm4gbS5maWx0ZXIobixtLmlkZW50aXR5KX07dmFyIFM9ZnVuY3Rpb24obix0LHIsZSl7Zm9yKHZhciB1PVtdLGk9MCxvPWV8fDAsYT1PKG4pO2E+bztvKyspe3ZhciBjPW5bb107aWYoayhjKSYmKG0uaXNBcnJheShjKXx8bS5pc0FyZ3VtZW50cyhjKSkpe3R8fChjPVMoYyx0LHIpKTt2YXIgZj0wLGw9Yy5sZW5ndGg7Zm9yKHUubGVuZ3RoKz1sO2w+ZjspdVtpKytdPWNbZisrXX1lbHNlIHJ8fCh1W2krK109Yyl9cmV0dXJuIHV9O20uZmxhdHRlbj1mdW5jdGlvbihuLHQpe3JldHVybiBTKG4sdCwhMSl9LG0ud2l0aG91dD1mdW5jdGlvbihuKXtyZXR1cm4gbS5kaWZmZXJlbmNlKG4sbC5jYWxsKGFyZ3VtZW50cywxKSl9LG0udW5pcT1tLnVuaXF1ZT1mdW5jdGlvbihuLHQscixlKXttLmlzQm9vbGVhbih0KXx8KGU9cixyPXQsdD0hMSksbnVsbCE9ciYmKHI9eChyLGUpKTtmb3IodmFyIHU9W10saT1bXSxvPTAsYT1PKG4pO2E+bztvKyspe3ZhciBjPW5bb10sZj1yP3IoYyxvLG4pOmM7dD8obyYmaT09PWZ8fHUucHVzaChjKSxpPWYpOnI/bS5jb250YWlucyhpLGYpfHwoaS5wdXNoKGYpLHUucHVzaChjKSk6bS5jb250YWlucyh1LGMpfHx1LnB1c2goYyl9cmV0dXJuIHV9LG0udW5pb249ZnVuY3Rpb24oKXtyZXR1cm4gbS51bmlxKFMoYXJndW1lbnRzLCEwLCEwKSl9LG0uaW50ZXJzZWN0aW9uPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdD1bXSxyPWFyZ3VtZW50cy5sZW5ndGgsZT0wLHU9TyhuKTt1PmU7ZSsrKXt2YXIgaT1uW2VdO2lmKCFtLmNvbnRhaW5zKHQsaSkpe2Zvcih2YXIgbz0xO3I+byYmbS5jb250YWlucyhhcmd1bWVudHNbb10saSk7bysrKTtvPT09ciYmdC5wdXNoKGkpfX1yZXR1cm4gdH0sbS5kaWZmZXJlbmNlPWZ1bmN0aW9uKG4pe3ZhciB0PVMoYXJndW1lbnRzLCEwLCEwLDEpO3JldHVybiBtLmZpbHRlcihuLGZ1bmN0aW9uKG4pe3JldHVybiFtLmNvbnRhaW5zKHQsbil9KX0sbS56aXA9ZnVuY3Rpb24oKXtyZXR1cm4gbS51bnppcChhcmd1bWVudHMpfSxtLnVuemlwPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdD1uJiZtLm1heChuLE8pLmxlbmd0aHx8MCxyPUFycmF5KHQpLGU9MDt0PmU7ZSsrKXJbZV09bS5wbHVjayhuLGUpO3JldHVybiByfSxtLm9iamVjdD1mdW5jdGlvbihuLHQpe2Zvcih2YXIgcj17fSxlPTAsdT1PKG4pO3U+ZTtlKyspdD9yW25bZV1dPXRbZV06cltuW2VdWzBdXT1uW2VdWzFdO3JldHVybiByfSxtLmZpbmRJbmRleD10KDEpLG0uZmluZExhc3RJbmRleD10KC0xKSxtLnNvcnRlZEluZGV4PWZ1bmN0aW9uKG4sdCxyLGUpe3I9eChyLGUsMSk7Zm9yKHZhciB1PXIodCksaT0wLG89TyhuKTtvPmk7KXt2YXIgYT1NYXRoLmZsb29yKChpK28pLzIpO3IoblthXSk8dT9pPWErMTpvPWF9cmV0dXJuIGl9LG0uaW5kZXhPZj1yKDEsbS5maW5kSW5kZXgsbS5zb3J0ZWRJbmRleCksbS5sYXN0SW5kZXhPZj1yKC0xLG0uZmluZExhc3RJbmRleCksbS5yYW5nZT1mdW5jdGlvbihuLHQscil7bnVsbD09dCYmKHQ9bnx8MCxuPTApLHI9cnx8MTtmb3IodmFyIGU9TWF0aC5tYXgoTWF0aC5jZWlsKCh0LW4pL3IpLDApLHU9QXJyYXkoZSksaT0wO2U+aTtpKyssbis9cil1W2ldPW47cmV0dXJuIHV9O3ZhciBFPWZ1bmN0aW9uKG4sdCxyLGUsdSl7aWYoIShlIGluc3RhbmNlb2YgdCkpcmV0dXJuIG4uYXBwbHkocix1KTt2YXIgaT1qKG4ucHJvdG90eXBlKSxvPW4uYXBwbHkoaSx1KTtyZXR1cm4gbS5pc09iamVjdChvKT9vOml9O20uYmluZD1mdW5jdGlvbihuLHQpe2lmKGcmJm4uYmluZD09PWcpcmV0dXJuIGcuYXBwbHkobixsLmNhbGwoYXJndW1lbnRzLDEpKTtpZighbS5pc0Z1bmN0aW9uKG4pKXRocm93IG5ldyBUeXBlRXJyb3IoXCJCaW5kIG11c3QgYmUgY2FsbGVkIG9uIGEgZnVuY3Rpb25cIik7dmFyIHI9bC5jYWxsKGFyZ3VtZW50cywyKSxlPWZ1bmN0aW9uKCl7cmV0dXJuIEUobixlLHQsdGhpcyxyLmNvbmNhdChsLmNhbGwoYXJndW1lbnRzKSkpfTtyZXR1cm4gZX0sbS5wYXJ0aWFsPWZ1bmN0aW9uKG4pe3ZhciB0PWwuY2FsbChhcmd1bWVudHMsMSkscj1mdW5jdGlvbigpe2Zvcih2YXIgZT0wLHU9dC5sZW5ndGgsaT1BcnJheSh1KSxvPTA7dT5vO28rKylpW29dPXRbb109PT1tP2FyZ3VtZW50c1tlKytdOnRbb107Zm9yKDtlPGFyZ3VtZW50cy5sZW5ndGg7KWkucHVzaChhcmd1bWVudHNbZSsrXSk7cmV0dXJuIEUobixyLHRoaXMsdGhpcyxpKX07cmV0dXJuIHJ9LG0uYmluZEFsbD1mdW5jdGlvbihuKXt2YXIgdCxyLGU9YXJndW1lbnRzLmxlbmd0aDtpZigxPj1lKXRocm93IG5ldyBFcnJvcihcImJpbmRBbGwgbXVzdCBiZSBwYXNzZWQgZnVuY3Rpb24gbmFtZXNcIik7Zm9yKHQ9MTtlPnQ7dCsrKXI9YXJndW1lbnRzW3RdLG5bcl09bS5iaW5kKG5bcl0sbik7cmV0dXJuIG59LG0ubWVtb2l6ZT1mdW5jdGlvbihuLHQpe3ZhciByPWZ1bmN0aW9uKGUpe3ZhciB1PXIuY2FjaGUsaT1cIlwiKyh0P3QuYXBwbHkodGhpcyxhcmd1bWVudHMpOmUpO3JldHVybiBtLmhhcyh1LGkpfHwodVtpXT1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKSksdVtpXX07cmV0dXJuIHIuY2FjaGU9e30scn0sbS5kZWxheT1mdW5jdGlvbihuLHQpe3ZhciByPWwuY2FsbChhcmd1bWVudHMsMik7cmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtyZXR1cm4gbi5hcHBseShudWxsLHIpfSx0KX0sbS5kZWZlcj1tLnBhcnRpYWwobS5kZWxheSxtLDEpLG0udGhyb3R0bGU9ZnVuY3Rpb24obix0LHIpe3ZhciBlLHUsaSxvPW51bGwsYT0wO3J8fChyPXt9KTt2YXIgYz1mdW5jdGlvbigpe2E9ci5sZWFkaW5nPT09ITE/MDptLm5vdygpLG89bnVsbCxpPW4uYXBwbHkoZSx1KSxvfHwoZT11PW51bGwpfTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZj1tLm5vdygpO2F8fHIubGVhZGluZyE9PSExfHwoYT1mKTt2YXIgbD10LShmLWEpO3JldHVybiBlPXRoaXMsdT1hcmd1bWVudHMsMD49bHx8bD50PyhvJiYoY2xlYXJUaW1lb3V0KG8pLG89bnVsbCksYT1mLGk9bi5hcHBseShlLHUpLG98fChlPXU9bnVsbCkpOm98fHIudHJhaWxpbmc9PT0hMXx8KG89c2V0VGltZW91dChjLGwpKSxpfX0sbS5kZWJvdW5jZT1mdW5jdGlvbihuLHQscil7dmFyIGUsdSxpLG8sYSxjPWZ1bmN0aW9uKCl7dmFyIGY9bS5ub3coKS1vO3Q+ZiYmZj49MD9lPXNldFRpbWVvdXQoYyx0LWYpOihlPW51bGwscnx8KGE9bi5hcHBseShpLHUpLGV8fChpPXU9bnVsbCkpKX07cmV0dXJuIGZ1bmN0aW9uKCl7aT10aGlzLHU9YXJndW1lbnRzLG89bS5ub3coKTt2YXIgZj1yJiYhZTtyZXR1cm4gZXx8KGU9c2V0VGltZW91dChjLHQpKSxmJiYoYT1uLmFwcGx5KGksdSksaT11PW51bGwpLGF9fSxtLndyYXA9ZnVuY3Rpb24obix0KXtyZXR1cm4gbS5wYXJ0aWFsKHQsbil9LG0ubmVnYXRlPWZ1bmN0aW9uKG4pe3JldHVybiBmdW5jdGlvbigpe3JldHVybiFuLmFwcGx5KHRoaXMsYXJndW1lbnRzKX19LG0uY29tcG9zZT1mdW5jdGlvbigpe3ZhciBuPWFyZ3VtZW50cyx0PW4ubGVuZ3RoLTE7cmV0dXJuIGZ1bmN0aW9uKCl7Zm9yKHZhciByPXQsZT1uW3RdLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyLS07KWU9bltyXS5jYWxsKHRoaXMsZSk7cmV0dXJuIGV9fSxtLmFmdGVyPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuLS1uPDE/dC5hcHBseSh0aGlzLGFyZ3VtZW50cyk6dm9pZCAwfX0sbS5iZWZvcmU9ZnVuY3Rpb24obix0KXt2YXIgcjtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4tLW4+MCYmKHI9dC5hcHBseSh0aGlzLGFyZ3VtZW50cykpLDE+PW4mJih0PW51bGwpLHJ9fSxtLm9uY2U9bS5wYXJ0aWFsKG0uYmVmb3JlLDIpO3ZhciBNPSF7dG9TdHJpbmc6bnVsbH0ucHJvcGVydHlJc0VudW1lcmFibGUoXCJ0b1N0cmluZ1wiKSxJPVtcInZhbHVlT2ZcIixcImlzUHJvdG90eXBlT2ZcIixcInRvU3RyaW5nXCIsXCJwcm9wZXJ0eUlzRW51bWVyYWJsZVwiLFwiaGFzT3duUHJvcGVydHlcIixcInRvTG9jYWxlU3RyaW5nXCJdO20ua2V5cz1mdW5jdGlvbihuKXtpZighbS5pc09iamVjdChuKSlyZXR1cm5bXTtpZih2KXJldHVybiB2KG4pO3ZhciB0PVtdO2Zvcih2YXIgciBpbiBuKW0uaGFzKG4scikmJnQucHVzaChyKTtyZXR1cm4gTSYmZShuLHQpLHR9LG0uYWxsS2V5cz1mdW5jdGlvbihuKXtpZighbS5pc09iamVjdChuKSlyZXR1cm5bXTt2YXIgdD1bXTtmb3IodmFyIHIgaW4gbil0LnB1c2gocik7cmV0dXJuIE0mJmUobix0KSx0fSxtLnZhbHVlcz1mdW5jdGlvbihuKXtmb3IodmFyIHQ9bS5rZXlzKG4pLHI9dC5sZW5ndGgsZT1BcnJheShyKSx1PTA7cj51O3UrKyllW3VdPW5bdFt1XV07cmV0dXJuIGV9LG0ubWFwT2JqZWN0PWZ1bmN0aW9uKG4sdCxyKXt0PXgodCxyKTtmb3IodmFyIGUsdT1tLmtleXMobiksaT11Lmxlbmd0aCxvPXt9LGE9MDtpPmE7YSsrKWU9dVthXSxvW2VdPXQobltlXSxlLG4pO3JldHVybiBvfSxtLnBhaXJzPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdD1tLmtleXMobikscj10Lmxlbmd0aCxlPUFycmF5KHIpLHU9MDtyPnU7dSsrKWVbdV09W3RbdV0sblt0W3VdXV07cmV0dXJuIGV9LG0uaW52ZXJ0PWZ1bmN0aW9uKG4pe2Zvcih2YXIgdD17fSxyPW0ua2V5cyhuKSxlPTAsdT1yLmxlbmd0aDt1PmU7ZSsrKXRbbltyW2VdXV09cltlXTtyZXR1cm4gdH0sbS5mdW5jdGlvbnM9bS5tZXRob2RzPWZ1bmN0aW9uKG4pe3ZhciB0PVtdO2Zvcih2YXIgciBpbiBuKW0uaXNGdW5jdGlvbihuW3JdKSYmdC5wdXNoKHIpO3JldHVybiB0LnNvcnQoKX0sbS5leHRlbmQ9XyhtLmFsbEtleXMpLG0uZXh0ZW5kT3duPW0uYXNzaWduPV8obS5rZXlzKSxtLmZpbmRLZXk9ZnVuY3Rpb24obix0LHIpe3Q9eCh0LHIpO2Zvcih2YXIgZSx1PW0ua2V5cyhuKSxpPTAsbz11Lmxlbmd0aDtvPmk7aSsrKWlmKGU9dVtpXSx0KG5bZV0sZSxuKSlyZXR1cm4gZX0sbS5waWNrPWZ1bmN0aW9uKG4sdCxyKXt2YXIgZSx1LGk9e30sbz1uO2lmKG51bGw9PW8pcmV0dXJuIGk7bS5pc0Z1bmN0aW9uKHQpPyh1PW0uYWxsS2V5cyhvKSxlPWIodCxyKSk6KHU9Uyhhcmd1bWVudHMsITEsITEsMSksZT1mdW5jdGlvbihuLHQscil7cmV0dXJuIHQgaW4gcn0sbz1PYmplY3QobykpO2Zvcih2YXIgYT0wLGM9dS5sZW5ndGg7Yz5hO2ErKyl7dmFyIGY9dVthXSxsPW9bZl07ZShsLGYsbykmJihpW2ZdPWwpfXJldHVybiBpfSxtLm9taXQ9ZnVuY3Rpb24obix0LHIpe2lmKG0uaXNGdW5jdGlvbih0KSl0PW0ubmVnYXRlKHQpO2Vsc2V7dmFyIGU9bS5tYXAoUyhhcmd1bWVudHMsITEsITEsMSksU3RyaW5nKTt0PWZ1bmN0aW9uKG4sdCl7cmV0dXJuIW0uY29udGFpbnMoZSx0KX19cmV0dXJuIG0ucGljayhuLHQscil9LG0uZGVmYXVsdHM9XyhtLmFsbEtleXMsITApLG0uY3JlYXRlPWZ1bmN0aW9uKG4sdCl7dmFyIHI9aihuKTtyZXR1cm4gdCYmbS5leHRlbmRPd24ocix0KSxyfSxtLmNsb25lPWZ1bmN0aW9uKG4pe3JldHVybiBtLmlzT2JqZWN0KG4pP20uaXNBcnJheShuKT9uLnNsaWNlKCk6bS5leHRlbmQoe30sbik6bn0sbS50YXA9ZnVuY3Rpb24obix0KXtyZXR1cm4gdChuKSxufSxtLmlzTWF0Y2g9ZnVuY3Rpb24obix0KXt2YXIgcj1tLmtleXModCksZT1yLmxlbmd0aDtpZihudWxsPT1uKXJldHVybiFlO2Zvcih2YXIgdT1PYmplY3QobiksaT0wO2U+aTtpKyspe3ZhciBvPXJbaV07aWYodFtvXSE9PXVbb118fCEobyBpbiB1KSlyZXR1cm4hMX1yZXR1cm4hMH07dmFyIE49ZnVuY3Rpb24obix0LHIsZSl7aWYobj09PXQpcmV0dXJuIDAhPT1ufHwxL249PT0xL3Q7aWYobnVsbD09bnx8bnVsbD09dClyZXR1cm4gbj09PXQ7biBpbnN0YW5jZW9mIG0mJihuPW4uX3dyYXBwZWQpLHQgaW5zdGFuY2VvZiBtJiYodD10Ll93cmFwcGVkKTt2YXIgdT1zLmNhbGwobik7aWYodSE9PXMuY2FsbCh0KSlyZXR1cm4hMTtzd2l0Y2godSl7Y2FzZVwiW29iamVjdCBSZWdFeHBdXCI6Y2FzZVwiW29iamVjdCBTdHJpbmddXCI6cmV0dXJuXCJcIituPT1cIlwiK3Q7Y2FzZVwiW29iamVjdCBOdW1iZXJdXCI6cmV0dXJuK24hPT0rbj8rdCE9PSt0OjA9PT0rbj8xLytuPT09MS90OituPT09K3Q7Y2FzZVwiW29iamVjdCBEYXRlXVwiOmNhc2VcIltvYmplY3QgQm9vbGVhbl1cIjpyZXR1cm4rbj09PSt0fXZhciBpPVwiW29iamVjdCBBcnJheV1cIj09PXU7aWYoIWkpe2lmKFwib2JqZWN0XCIhPXR5cGVvZiBufHxcIm9iamVjdFwiIT10eXBlb2YgdClyZXR1cm4hMTt2YXIgbz1uLmNvbnN0cnVjdG9yLGE9dC5jb25zdHJ1Y3RvcjtpZihvIT09YSYmIShtLmlzRnVuY3Rpb24obykmJm8gaW5zdGFuY2VvZiBvJiZtLmlzRnVuY3Rpb24oYSkmJmEgaW5zdGFuY2VvZiBhKSYmXCJjb25zdHJ1Y3RvclwiaW4gbiYmXCJjb25zdHJ1Y3RvclwiaW4gdClyZXR1cm4hMX1yPXJ8fFtdLGU9ZXx8W107Zm9yKHZhciBjPXIubGVuZ3RoO2MtLTspaWYocltjXT09PW4pcmV0dXJuIGVbY109PT10O2lmKHIucHVzaChuKSxlLnB1c2godCksaSl7aWYoYz1uLmxlbmd0aCxjIT09dC5sZW5ndGgpcmV0dXJuITE7Zm9yKDtjLS07KWlmKCFOKG5bY10sdFtjXSxyLGUpKXJldHVybiExfWVsc2V7dmFyIGYsbD1tLmtleXMobik7aWYoYz1sLmxlbmd0aCxtLmtleXModCkubGVuZ3RoIT09YylyZXR1cm4hMTtmb3IoO2MtLTspaWYoZj1sW2NdLCFtLmhhcyh0LGYpfHwhTihuW2ZdLHRbZl0scixlKSlyZXR1cm4hMX1yZXR1cm4gci5wb3AoKSxlLnBvcCgpLCEwfTttLmlzRXF1YWw9ZnVuY3Rpb24obix0KXtyZXR1cm4gTihuLHQpfSxtLmlzRW1wdHk9ZnVuY3Rpb24obil7cmV0dXJuIG51bGw9PW4/ITA6ayhuKSYmKG0uaXNBcnJheShuKXx8bS5pc1N0cmluZyhuKXx8bS5pc0FyZ3VtZW50cyhuKSk/MD09PW4ubGVuZ3RoOjA9PT1tLmtleXMobikubGVuZ3RofSxtLmlzRWxlbWVudD1mdW5jdGlvbihuKXtyZXR1cm4hKCFufHwxIT09bi5ub2RlVHlwZSl9LG0uaXNBcnJheT1ofHxmdW5jdGlvbihuKXtyZXR1cm5cIltvYmplY3QgQXJyYXldXCI9PT1zLmNhbGwobil9LG0uaXNPYmplY3Q9ZnVuY3Rpb24obil7dmFyIHQ9dHlwZW9mIG47cmV0dXJuXCJmdW5jdGlvblwiPT09dHx8XCJvYmplY3RcIj09PXQmJiEhbn0sbS5lYWNoKFtcIkFyZ3VtZW50c1wiLFwiRnVuY3Rpb25cIixcIlN0cmluZ1wiLFwiTnVtYmVyXCIsXCJEYXRlXCIsXCJSZWdFeHBcIixcIkVycm9yXCJdLGZ1bmN0aW9uKG4pe21bXCJpc1wiK25dPWZ1bmN0aW9uKHQpe3JldHVybiBzLmNhbGwodCk9PT1cIltvYmplY3QgXCIrbitcIl1cIn19KSxtLmlzQXJndW1lbnRzKGFyZ3VtZW50cyl8fChtLmlzQXJndW1lbnRzPWZ1bmN0aW9uKG4pe3JldHVybiBtLmhhcyhuLFwiY2FsbGVlXCIpfSksXCJmdW5jdGlvblwiIT10eXBlb2YvLi8mJlwib2JqZWN0XCIhPXR5cGVvZiBJbnQ4QXJyYXkmJihtLmlzRnVuY3Rpb249ZnVuY3Rpb24obil7cmV0dXJuXCJmdW5jdGlvblwiPT10eXBlb2Ygbnx8ITF9KSxtLmlzRmluaXRlPWZ1bmN0aW9uKG4pe3JldHVybiBpc0Zpbml0ZShuKSYmIWlzTmFOKHBhcnNlRmxvYXQobikpfSxtLmlzTmFOPWZ1bmN0aW9uKG4pe3JldHVybiBtLmlzTnVtYmVyKG4pJiZuIT09K259LG0uaXNCb29sZWFuPWZ1bmN0aW9uKG4pe3JldHVybiBuPT09ITB8fG49PT0hMXx8XCJbb2JqZWN0IEJvb2xlYW5dXCI9PT1zLmNhbGwobil9LG0uaXNOdWxsPWZ1bmN0aW9uKG4pe3JldHVybiBudWxsPT09bn0sbS5pc1VuZGVmaW5lZD1mdW5jdGlvbihuKXtyZXR1cm4gbj09PXZvaWQgMH0sbS5oYXM9ZnVuY3Rpb24obix0KXtyZXR1cm4gbnVsbCE9biYmcC5jYWxsKG4sdCl9LG0ubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiB1Ll89aSx0aGlzfSxtLmlkZW50aXR5PWZ1bmN0aW9uKG4pe3JldHVybiBufSxtLmNvbnN0YW50PWZ1bmN0aW9uKG4pe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBufX0sbS5ub29wPWZ1bmN0aW9uKCl7fSxtLnByb3BlcnR5PXcsbS5wcm9wZXJ0eU9mPWZ1bmN0aW9uKG4pe3JldHVybiBudWxsPT1uP2Z1bmN0aW9uKCl7fTpmdW5jdGlvbih0KXtyZXR1cm4gblt0XX19LG0ubWF0Y2hlcj1tLm1hdGNoZXM9ZnVuY3Rpb24obil7cmV0dXJuIG49bS5leHRlbmRPd24oe30sbiksZnVuY3Rpb24odCl7cmV0dXJuIG0uaXNNYXRjaCh0LG4pfX0sbS50aW1lcz1mdW5jdGlvbihuLHQscil7dmFyIGU9QXJyYXkoTWF0aC5tYXgoMCxuKSk7dD1iKHQsciwxKTtmb3IodmFyIHU9MDtuPnU7dSsrKWVbdV09dCh1KTtyZXR1cm4gZX0sbS5yYW5kb209ZnVuY3Rpb24obix0KXtyZXR1cm4gbnVsbD09dCYmKHQ9bixuPTApLG4rTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKih0LW4rMSkpfSxtLm5vdz1EYXRlLm5vd3x8ZnVuY3Rpb24oKXtyZXR1cm4obmV3IERhdGUpLmdldFRpbWUoKX07dmFyIEI9e1wiJlwiOlwiJmFtcDtcIixcIjxcIjpcIiZsdDtcIixcIj5cIjpcIiZndDtcIiwnXCInOlwiJnF1b3Q7XCIsXCInXCI6XCImI3gyNztcIixcImBcIjpcIiYjeDYwO1wifSxUPW0uaW52ZXJ0KEIpLFI9ZnVuY3Rpb24obil7dmFyIHQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5bdF19LHI9XCIoPzpcIittLmtleXMobikuam9pbihcInxcIikrXCIpXCIsZT1SZWdFeHAociksdT1SZWdFeHAocixcImdcIik7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBuPW51bGw9PW4/XCJcIjpcIlwiK24sZS50ZXN0KG4pP24ucmVwbGFjZSh1LHQpOm59fTttLmVzY2FwZT1SKEIpLG0udW5lc2NhcGU9UihUKSxtLnJlc3VsdD1mdW5jdGlvbihuLHQscil7dmFyIGU9bnVsbD09bj92b2lkIDA6blt0XTtyZXR1cm4gZT09PXZvaWQgMCYmKGU9ciksbS5pc0Z1bmN0aW9uKGUpP2UuY2FsbChuKTplfTt2YXIgcT0wO20udW5pcXVlSWQ9ZnVuY3Rpb24obil7dmFyIHQ9KytxK1wiXCI7cmV0dXJuIG4/bit0OnR9LG0udGVtcGxhdGVTZXR0aW5ncz17ZXZhbHVhdGU6LzwlKFtcXHNcXFNdKz8pJT4vZyxpbnRlcnBvbGF0ZTovPCU9KFtcXHNcXFNdKz8pJT4vZyxlc2NhcGU6LzwlLShbXFxzXFxTXSs/KSU+L2d9O3ZhciBLPS8oLileLyx6PXtcIidcIjpcIidcIixcIlxcXFxcIjpcIlxcXFxcIixcIlxcclwiOlwiclwiLFwiXFxuXCI6XCJuXCIsXCJcXHUyMDI4XCI6XCJ1MjAyOFwiLFwiXFx1MjAyOVwiOlwidTIwMjlcIn0sRD0vXFxcXHwnfFxccnxcXG58XFx1MjAyOHxcXHUyMDI5L2csTD1mdW5jdGlvbihuKXtyZXR1cm5cIlxcXFxcIit6W25dfTttLnRlbXBsYXRlPWZ1bmN0aW9uKG4sdCxyKXshdCYmciYmKHQ9ciksdD1tLmRlZmF1bHRzKHt9LHQsbS50ZW1wbGF0ZVNldHRpbmdzKTt2YXIgZT1SZWdFeHAoWyh0LmVzY2FwZXx8Sykuc291cmNlLCh0LmludGVycG9sYXRlfHxLKS5zb3VyY2UsKHQuZXZhbHVhdGV8fEspLnNvdXJjZV0uam9pbihcInxcIikrXCJ8JFwiLFwiZ1wiKSx1PTAsaT1cIl9fcCs9J1wiO24ucmVwbGFjZShlLGZ1bmN0aW9uKHQscixlLG8sYSl7cmV0dXJuIGkrPW4uc2xpY2UodSxhKS5yZXBsYWNlKEQsTCksdT1hK3QubGVuZ3RoLHI/aSs9XCInK1xcbigoX190PShcIityK1wiKSk9PW51bGw/Jyc6Xy5lc2NhcGUoX190KSkrXFxuJ1wiOmU/aSs9XCInK1xcbigoX190PShcIitlK1wiKSk9PW51bGw/Jyc6X190KStcXG4nXCI6byYmKGkrPVwiJztcXG5cIitvK1wiXFxuX19wKz0nXCIpLHR9KSxpKz1cIic7XFxuXCIsdC52YXJpYWJsZXx8KGk9XCJ3aXRoKG9ianx8e30pe1xcblwiK2krXCJ9XFxuXCIpLGk9XCJ2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4sXCIrXCJwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9O1xcblwiK2krXCJyZXR1cm4gX19wO1xcblwiO3RyeXt2YXIgbz1uZXcgRnVuY3Rpb24odC52YXJpYWJsZXx8XCJvYmpcIixcIl9cIixpKX1jYXRjaChhKXt0aHJvdyBhLnNvdXJjZT1pLGF9dmFyIGM9ZnVuY3Rpb24obil7cmV0dXJuIG8uY2FsbCh0aGlzLG4sbSl9LGY9dC52YXJpYWJsZXx8XCJvYmpcIjtyZXR1cm4gYy5zb3VyY2U9XCJmdW5jdGlvbihcIitmK1wiKXtcXG5cIitpK1wifVwiLGN9LG0uY2hhaW49ZnVuY3Rpb24obil7dmFyIHQ9bShuKTtyZXR1cm4gdC5fY2hhaW49ITAsdH07dmFyIFA9ZnVuY3Rpb24obix0KXtyZXR1cm4gbi5fY2hhaW4/bSh0KS5jaGFpbigpOnR9O20ubWl4aW49ZnVuY3Rpb24obil7bS5lYWNoKG0uZnVuY3Rpb25zKG4pLGZ1bmN0aW9uKHQpe3ZhciByPW1bdF09blt0XTttLnByb3RvdHlwZVt0XT1mdW5jdGlvbigpe3ZhciBuPVt0aGlzLl93cmFwcGVkXTtyZXR1cm4gZi5hcHBseShuLGFyZ3VtZW50cyksUCh0aGlzLHIuYXBwbHkobSxuKSl9fSl9LG0ubWl4aW4obSksbS5lYWNoKFtcInBvcFwiLFwicHVzaFwiLFwicmV2ZXJzZVwiLFwic2hpZnRcIixcInNvcnRcIixcInNwbGljZVwiLFwidW5zaGlmdFwiXSxmdW5jdGlvbihuKXt2YXIgdD1vW25dO20ucHJvdG90eXBlW25dPWZ1bmN0aW9uKCl7dmFyIHI9dGhpcy5fd3JhcHBlZDtyZXR1cm4gdC5hcHBseShyLGFyZ3VtZW50cyksXCJzaGlmdFwiIT09biYmXCJzcGxpY2VcIiE9PW58fDAhPT1yLmxlbmd0aHx8ZGVsZXRlIHJbMF0sUCh0aGlzLHIpfX0pLG0uZWFjaChbXCJjb25jYXRcIixcImpvaW5cIixcInNsaWNlXCJdLGZ1bmN0aW9uKG4pe3ZhciB0PW9bbl07bS5wcm90b3R5cGVbbl09ZnVuY3Rpb24oKXtyZXR1cm4gUCh0aGlzLHQuYXBwbHkodGhpcy5fd3JhcHBlZCxhcmd1bWVudHMpKX19KSxtLnByb3RvdHlwZS52YWx1ZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl93cmFwcGVkfSxtLnByb3RvdHlwZS52YWx1ZU9mPW0ucHJvdG90eXBlLnRvSlNPTj1tLnByb3RvdHlwZS52YWx1ZSxtLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiXCIrdGhpcy5fd3JhcHBlZH0sXCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kJiZkZWZpbmUoXCJ1bmRlcnNjb3JlXCIsW10sZnVuY3Rpb24oKXtyZXR1cm4gbX0pfSkuY2FsbCh0aGlzKTsiXX0=
